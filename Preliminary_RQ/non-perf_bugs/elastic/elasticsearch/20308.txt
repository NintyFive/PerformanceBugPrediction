{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20308","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20308/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20308/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20308/events","html_url":"https://github.com/elastic/elasticsearch/issues/20308","id":174836764,"node_id":"MDU6SXNzdWUxNzQ4MzY3NjQ=","number":20308,"title":"ES keeps bouncing shards around and it doesn't seem to end for a long time","user":{"login":"mkelkarbv","id":8582461,"node_id":"MDQ6VXNlcjg1ODI0NjE=","avatar_url":"https://avatars1.githubusercontent.com/u/8582461?v=4","gravatar_id":"","url":"https://api.github.com/users/mkelkarbv","html_url":"https://github.com/mkelkarbv","followers_url":"https://api.github.com/users/mkelkarbv/followers","following_url":"https://api.github.com/users/mkelkarbv/following{/other_user}","gists_url":"https://api.github.com/users/mkelkarbv/gists{/gist_id}","starred_url":"https://api.github.com/users/mkelkarbv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkelkarbv/subscriptions","organizations_url":"https://api.github.com/users/mkelkarbv/orgs","repos_url":"https://api.github.com/users/mkelkarbv/repos","events_url":"https://api.github.com/users/mkelkarbv/events{/privacy}","received_events_url":"https://api.github.com/users/mkelkarbv/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-09-02T19:58:45Z","updated_at":"2018-03-20T11:41:24Z","closed_at":"2018-03-20T11:41:24Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 1.7.3\n\n**Plugins installed**: cloud-aws\n\n**JVM version**: openjdk version \"1.8.0_65\"\nOpenJDK Runtime Environment (build 1.8.0_65-b17)\nOpenJDK 64-Bit Server VM (build 25.65-b01, mixed mode)\n\n**OS version**: Amazon linux 3.14.35-28.38.amzn1.x86_64\n\n**Description of the problem including expected versus actual behavior**:\n\nElasticsearch keeps moving shards around infinitely...\n\n**Steps to reproduce**:\n1. set cluster settings for include/exclude nodes using shard allocation filtering. \n2. watch the logs for this exception \n   \"Suspect illegal state: trying to move shard from primary mode to replica mode\"\n\nAfter this, shards keep bouncing around infinitely....Usually it finishes moving shards in 3 hours. We waited for almost 10 hours for the same amount of data and it did not finish.\n\nI have tried to get rid of all replicas by updating index settings, but it did not help...\n\n**Provide logs (if relevant)**:\n\nThe only relevant message that I see is \n\n\"Suspect illegal state: trying to move shard from primary mode to replica mode\"\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}