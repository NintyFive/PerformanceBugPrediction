[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255007173","html_url":"https://github.com/elastic/elasticsearch/issues/21033#issuecomment-255007173","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21033","id":255007173,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTAwNzE3Mw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-10-20T04:37:50Z","updated_at":"2016-10-20T04:37:50Z","author_association":"CONTRIBUTOR","body":"I'll have a closer look in the morning. For now you should be able to work\naround it by creating the mapping before starting the reindex. That is\nusually the right way to use reindex anyway. If there is a way to make it\nwork automatically I'll fix it though.\n\nOn Oct 19, 2016 11:39 PM, \"Andrew Selden\" notifications@github.com wrote:\n\n> _Elasticsearch version_:\n> 2.4 and 5.0-RC1\n> \n> _Plugins installed_: []\n> On 2.4 cluster:\n> \n> tiebreaker-0000000082 analysis-icu         2.4.1                j\n> tiebreaker-0000000082 analysis-kuromoji    2.4.1                j\n> tiebreaker-0000000082 analysis-smartcn     2.4.1                j\n> tiebreaker-0000000082 cloud-aws            2.4.1                j\n> tiebreaker-0000000082 found-elasticsearch  1.2.23-2.4.1-c67dc32 j\n> tiebreaker-0000000082 found-license-plugin 2.4.1                j\n> tiebreaker-0000000082 graph                2.4.1                j\n> tiebreaker-0000000082 marvel-agent         2.4.1                j\n> tiebreaker-0000000082 shield               2.4.1                j\n> tiebreaker-0000000082 watcher              2.4.1                j\n> instance-0000000086   analysis-icu         2.4.1                j\n> instance-0000000086   analysis-kuromoji    2.4.1                j\n> instance-0000000086   analysis-smartcn     2.4.1                j\n> instance-0000000086   cloud-aws            2.4.1                j\n> instance-0000000086   found-elasticsearch  1.2.23-2.4.1-c67dc32 j\n> instance-0000000086   found-license-plugin 2.4.1                j\n> instance-0000000086   graph                2.4.1                j\n> instance-0000000086   marvel-agent         2.4.1                j\n> instance-0000000086   shield               2.4.1                j\n> instance-0000000086   watcher              2.4.1                j\n> instance-0000000083   analysis-icu         2.4.1                j\n> instance-0000000083   analysis-kuromoji    2.4.1                j\n> instance-0000000083   analysis-smartcn     2.4.1                j\n> instance-0000000083   cloud-aws            2.4.1                j\n> instance-0000000083   found-elasticsearch  1.2.23-2.4.1-c67dc32 j\n> instance-0000000083   found-license-plugin 2.4.1                j\n> instance-0000000083   graph                2.4.1                j\n> instance-0000000083   marvel-agent         2.4.1                j\n> instance-0000000083   shield               2.4.1                j\n> instance-0000000083   watcher              2.4.1                j\n> \n> On 5.0-RC1 cluster:\n> \n> tiebreaker-0000000003 found-elasticsearch 5.0.0-rc1\n> tiebreaker-0000000003 repository-s3       5.0.0-rc1\n> tiebreaker-0000000003 x-pack              5.0.0-rc1\n> instance-0000000005   found-elasticsearch 5.0.0-rc1\n> instance-0000000005   repository-s3       5.0.0-rc1\n> instance-0000000005   x-pack              5.0.0-rc1\n> instance-0000000004   found-elasticsearch 5.0.0-rc1\n> instance-0000000004   repository-s3       5.0.0-rc1\n> instance-0000000004   x-pack              5.0.0-rc1\n> \n> _JVM version_:\n> Unknown. Both clusters are running on Elastic Cloud.\n> \n> _OS version_:\n> Unknown. Both clusters are running on Elastic Cloud.\n> \n> _Description of the problem including expected versus actual behavior_:\n> When reindexing from a remote 2.4 cluster on to a new 5.0-RC1 cluster,\n> some field mappings were incorrectly set on the new index. Specifically, I\n> noticed that a field of type geo_point was created as type text on the\n> new index on the 5.0-RC1 cluster.\n> \n> Look at the _location_ field on the mappings.\n> \n> Index mapping on 2.4:\n> \n> {\n>   \"ncedc-earthquakes\": {\n>     \"mappings\": {\n>       \"earthquake\": {\n>         \"properties\": {\n>           \"@timestamp\": {\n>             \"type\": \"date\",\n>             \"format\": \"strict_date_optional_time||epoch_millis\"\n>           },\n>           \"@version\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"depth\": {\n>             \"type\": \"double\"\n>           },\n>           \"dmin\": {\n>             \"type\": \"double\"\n>           },\n>           \"event_id\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"gap\": {\n>             \"type\": \"double\"\n>           },\n>           \"host\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"location\": {\n>             \"type\": \"geo_point\"\n>           },\n>           \"mag\": {\n>             \"type\": \"double\"\n>           },\n>           \"magType\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"message\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"nst\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"rms\": {\n>             \"type\": \"double\"\n>           },\n>           \"source\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"tags\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"timestamp\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           },\n>           \"type\": {\n>             \"type\": \"string\",\n>             \"index\": \"not_analyzed\"\n>           }\n>         }\n>       }\n>     }\n>   }\n> }\n> \n> Index mapping on 5.0-RC1 (automatically created during\n> reindex-from-remote):\n> \n> {\n>   \"ncedc-earthquakes\": {\n>     \"mappings\": {\n>       \"earthquake\": {\n>         \"properties\": {\n>           \"@timestamp\": {\n>             \"type\": \"date\"\n>           },\n>           \"@version\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"depth\": {\n>             \"type\": \"float\"\n>           },\n>           \"dmin\": {\n>             \"type\": \"float\"\n>           },\n>           \"event_id\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"gap\": {\n>             \"type\": \"float\"\n>           },\n>           \"host\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"location\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"mag\": {\n>             \"type\": \"float\"\n>           },\n>           \"magType\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"message\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"nst\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"rms\": {\n>             \"type\": \"float\"\n>           },\n>           \"source\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"tags\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"timestamp\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           },\n>           \"type\": {\n>             \"type\": \"text\",\n>             \"fields\": {\n>               \"keyword\": {\n>                 \"type\": \"keyword\",\n>                 \"ignore_above\": 256\n>               }\n>             }\n>           }\n>         }\n>       }\n>     }\n>   }\n> }\n> \n> _Steps to reproduce_:\n> 1. Create an index with a geo_point field in a 2.4 cluster.\n> 2. Reindex from the 2.4 cluster into the 5.0-RC1 cluster.\n> 3. Look at the mappings for the geo_point field.\n> \n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> https://github.com/elastic/elasticsearch/issues/21033, or mute the\n> thread\n> https://github.com/notifications/unsubscribe-auth/AANLovBcFI8qTwE2SsBaIce7AlmQr_Uzks5q1uJagaJpZM4KbsFE\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255081823","html_url":"https://github.com/elastic/elasticsearch/issues/21033#issuecomment-255081823","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21033","id":255081823,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTA4MTgyMw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-10-20T11:37:39Z","updated_at":"2016-10-20T11:37:39Z","author_association":"CONTRIBUTOR","body":"Hmm I'm confused about why reindex from remote is concerned here. Isn't the issue just that Elasticsearch never creates dynamic `geo_point` mappings automatically? Which we do not do since it is hard to know with good confidence whether a string is a geo hash or a random keyword, or whether a double array containing 2 values is a geo point or a double array.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255098122","html_url":"https://github.com/elastic/elasticsearch/issues/21033#issuecomment-255098122","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21033","id":255098122,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTA5ODEyMg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-10-20T12:57:31Z","updated_at":"2016-10-20T12:57:31Z","author_association":"CONTRIBUTOR","body":"If we never do then, yeah, this doesn't have to do with reindex from remote. That is what I was going to look in to this morning. I thought there might be a parameter that reindex could set that'd get the field in a more obvious way. I was tired so I didn't realize how strange that'd be to have in the first place.\n\nIn that case I think we should just close this. We've recently fixed the [docs](https://www.elastic.co/guide/en/elasticsearch/reference/5.0/docs-reindex.html) so they are more clear that reindex doesn't set up the destination index. We have https://github.com/elastic/elasticsearch/pull/20576 where we looked at making reindex not start if the destination index doesn't exist. The implementation is fairly horrible because Elasticsearch doesn't have the right hooks in the right spots and adding them doesn't seem worth it....\n","performed_via_github_app":null}]