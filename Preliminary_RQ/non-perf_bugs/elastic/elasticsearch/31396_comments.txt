[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398137911","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398137911","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398137911,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODEzNzkxMQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T17:45:23Z","updated_at":"2018-06-18T17:45:23Z","author_association":"MEMBER","body":"@schmittberger how much head do you have normally, when you don't run /_cat/indices and how many shards and segments are in these 2 indices?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398138070","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398138070","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398138070,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODEzODA3MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T17:45:51Z","updated_at":"2018-06-18T17:45:51Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398138078","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398138078","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398138078,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODEzODA3OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T17:45:52Z","updated_at":"2018-06-18T17:45:52Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398159305","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398159305","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398159305,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODE1OTMwNQ==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T18:57:17Z","updated_at":"2018-06-18T18:57:17Z","author_association":"NONE","body":"The GC sometimes takes a couple seconds if lots of indexing is going on but the 16 GB were sufficient so far. 1 index has 5 shards and 1 index has only 1 shard. The 5 shards index is 30 GB big, the 1 shard index uses 20 GB. Can't really tell you the number of segments right now. They both contain 18 Mio. documents","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398162746","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398162746","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398162746,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODE2Mjc0Ng==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T19:09:24Z","updated_at":"2018-06-18T19:09:24Z","author_association":"NONE","body":"Attached output of /_cat/segments?v\r\n[es_segments.txt](https://github.com/elastic/elasticsearch/files/2112630/es_segments.txt)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398166538","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398166538","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398166538,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODE2NjUzOA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T19:23:07Z","updated_at":"2018-06-18T19:23:07Z","author_association":"MEMBER","body":"@schmittberger GC should never take a couple of seconds. I think what is happening is that you are running pretty high in terms of memory utilization, so a small bump in required memory sends it overboard. Could you run `GET _nodes/stats/jvm` and see how `heap_used_percent` changes over time?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398187490","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398187490","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398187490,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODE4NzQ5MA==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T20:37:47Z","updated_at":"2018-06-18T20:40:45Z","author_association":"NONE","body":"Currently it is at 19% and it also happens if I run /_cat/indices directly after a fresh startup. I don't think that that is the problem.\r\nI also gave ES 20 and 28 GB just for testing - no improvement.\r\n\r\n{\r\n\"_nodes\": {\r\n\"total\": 1,\r\n\"successful\": 1,\r\n\"failed\": 0\r\n},\r\n\"jvm\": {\r\n\"timestamp\": 1529354041477,\r\n\"uptime_in_millis\": 19156507,\r\n\"mem\": {\r\n\"heap_used_in_bytes\": 3314907056,\r\n\"heap_used_percent\": 19,\r\n\"heap_committed_in_bytes\": 17188257792,\r\n\"heap_max_in_bytes\": 17188257792,\r\n\"non_heap_used_in_bytes\": 104607456,\r\n\"non_heap_committed_in_bytes\": 111734784,\r\n\"pools\": {\r\n\"young\": {\r\n\"used_in_bytes\": 427819008,\r\n\"max_in_bytes\": 0,\r\n\"peak_used_in_bytes\": 1551892480,\r\n\"peak_max_in_bytes\": 0\r\n},\r\n\"survivor\": {\r\n\"used_in_bytes\": 41943040,\r\n\"max_in_bytes\": 0,\r\n\"peak_used_in_bytes\": 209715200,\r\n\"peak_max_in_bytes\": 0\r\n},\r\n\"old\": {\r\n\"used_in_bytes\": 2845145008,\r\n\"max_in_bytes\": 17188257792,\r\n\"peak_used_in_bytes\": 2845145008,\r\n\"peak_max_in_bytes\": 17188257792\r\n}\r\n}\r\n},\r\n\"threads\": {\r\n\"count\": 87,\r\n\"peak_count\": 103\r\n},\r\n\"gc\": {\r\n\"collectors\": {\r\n\"young\": {\r\n\"collection_count\": 11,\r\n\"collection_time_in_millis\": 634\r\n},\r\n\"old\": {\r\n\"collection_count\": 0,\r\n\"collection_time_in_millis\": 0\r\n}\r\n}\r\n},\r\n\"buffer_pools\": {\r\n\"direct\": {\r\n\"count\": 70,\r\n\"used_in_bytes\": 270597657,\r\n\"total_capacity_in_bytes\": 270597656\r\n},\r\n\"mapped\": {\r\n\"count\": 1076,\r\n\"used_in_bytes\": 705365939719,\r\n\"total_capacity_in_bytes\": 705365939719\r\n}\r\n},\r\n\"classes\": {\r\n\"current_loaded_count\": 13264,\r\n\"total_loaded_count\": 13264,\r\n\"total_unloaded_count\": 0\r\n}\r\n}\r\n}\r\n}\r\n}","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398234524","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398234524","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398234524,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODIzNDUyNA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T00:15:25Z","updated_at":"2018-06-19T00:15:25Z","author_association":"MEMBER","body":"From  @schmittberger's description it looks like completion suggester stats might be using a lot (12G+) of heap space. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398347134","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398347134","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398347134,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODM0NzEzNA==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T10:07:43Z","updated_at":"2018-06-19T10:07:43Z","author_association":"NONE","body":"@imotov - what would be your recommendation to solve the problem? More shards, more nodes, ditribute over several machines? More memory is according to the rule to never give more than 31 GB not feasible, is it?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398423811","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398423811","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398423811,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODQyMzgxMQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T14:40:53Z","updated_at":"2018-06-19T14:40:53Z","author_association":"MEMBER","body":"@schmittberger do you have the suggester fields on both indices or only on `autocomplete`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398425736","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398425736","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398425736,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODQyNTczNg==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T14:46:02Z","updated_at":"2018-06-19T14:46:02Z","author_association":"NONE","body":"only on autocomplete","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398466035","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398466035","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398466035,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODQ2NjAzNQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T16:42:44Z","updated_at":"2018-06-19T16:42:44Z","author_association":"MEMBER","body":"@schmittberger are you actually using the autocomplete functionality on this index?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398466848","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398466848","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398466848,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODQ2Njg0OA==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T16:45:21Z","updated_at":"2018-06-19T16:45:21Z","author_association":"NONE","body":"yes, we especially created this index just for autocomplete functionality","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398469480","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398469480","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398469480,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODQ2OTQ4MA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T16:53:30Z","updated_at":"2018-06-19T16:53:30Z","author_association":"MEMBER","body":"Was the result of `GET _nodes/stats/jvm` executed after you run the autocomplete query? If not could you run a few autocomplete requests and then run `GET _nodes/stats/jvm`? Could you also check the mapping to see if you have more than one field with the type \"completion\" in your mapping? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398678461","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-398678461","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":398678461,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODY3ODQ2MQ==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-20T09:04:40Z","updated_at":"2018-06-20T09:04:40Z","author_association":"NONE","body":"Pretty much every field has the completion type. \r\nI deleted the index now to try more shards - so I unfortunately can't tell you the jvm stats anymore right now.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399109424","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-399109424","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":399109424,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTEwOTQyNA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-06-21T13:47:38Z","updated_at":"2018-06-21T13:47:38Z","author_association":"MEMBER","body":"@schmittberger but you don't run the autocomplete functionality on all these fields on a regular bases, correct? I think what's happening here the overall size of FSTs for all fields in your index exceeds the size of your heap space. Since these FSTs are lazily loaded you are not experiencing any issues until you force all of them to load by running stats. I think you should see the same memory  issues if run a query with suggesters on all fields in this index. Could you verify?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400255080","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-400255080","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":400255080,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDI1NTA4MA==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-26T10:09:57Z","updated_at":"2018-06-26T10:09:57Z","author_association":"NONE","body":"@imotov: Our queries usually target only 1 or 2 fields, that's right. I am sure you are right that a query on all fields will have the same effect. The question for me now is how to solve this problem. I tried 5 shards for the autocomplete index now - but after indexing 5 million documents the same behaviour shows up. So the only feasible solution seems to spread across more nodes. But 1 node for every 3-4 mio documents is not a realistic thing to me...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400383481","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-400383481","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":400383481,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDM4MzQ4MQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-06-26T16:42:25Z","updated_at":"2018-06-26T16:42:25Z","author_association":"MEMBER","body":"The FST trees are loaded in memory upon first access. So you need to either increase amount of heap available to shards with completion fields by adding more nodes or by distributing these shards more equally to all nodes, or you need to reduce the amount of required memory by reducing the number of completion fields. \r\n\r\nSince this doesn't seem to be a bug, I am going to close this issue. Let's continue on our discussion forum https://discuss.elastic.co/ If you have any other questions.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400957485","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-400957485","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":400957485,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDk1NzQ4NQ==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2018-06-28T08:35:39Z","updated_at":"2018-06-28T08:35:39Z","author_association":"NONE","body":"OK, thank you for your help. \r\n\r\nI would still say that this should be considered as a bug since the _stats/indices page doesn't really show any information about the autcomplete fields / functionality but the information is still loaded. Also it should not run out of memory (so fast) - the \"normal\" index can take way more documents and still show its stats without problem.\r\nMaybe there are technical reasons I don't know / understand right now - then it is ok, but otherwise I would say it's a bug.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/484165525","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-484165525","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":484165525,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDE2NTUyNQ==","user":{"login":"briceruzand","id":1662004,"node_id":"MDQ6VXNlcjE2NjIwMDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1662004?v=4","gravatar_id":"","url":"https://api.github.com/users/briceruzand","html_url":"https://github.com/briceruzand","followers_url":"https://api.github.com/users/briceruzand/followers","following_url":"https://api.github.com/users/briceruzand/following{/other_user}","gists_url":"https://api.github.com/users/briceruzand/gists{/gist_id}","starred_url":"https://api.github.com/users/briceruzand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/briceruzand/subscriptions","organizations_url":"https://api.github.com/users/briceruzand/orgs","repos_url":"https://api.github.com/users/briceruzand/repos","events_url":"https://api.github.com/users/briceruzand/events{/privacy}","received_events_url":"https://api.github.com/users/briceruzand/received_events","type":"User","site_admin":false},"created_at":"2019-04-17T16:33:10Z","updated_at":"2019-04-17T16:33:10Z","author_association":"NONE","body":"Hello, \r\n\r\nI am facing to the same trouble too, when some users (using cerebro) call `_cat/indices` api, for monitoring indices redexing on our ES cluster, our server crash (on ES 6.5).\r\n\r\n`GET _cat/indices?format=json` consume a lot of memory up to OutOfMemoryError according to the information returned (no data on Completion suggest statistics are returned).\r\n\r\n`GET _stats/` do the same, \"completion\" option activated by default (Completion suggest statistics) lead to load in memory all FST Suggester at the same time (or in a short time, and in parallel way)\r\n\r\nI think is a bug because in real life not all that memory should be loaded a the same time and it could be garbage collected, because FST Suggester are lazy loaded.\r\n\r\n`_stats` and `_cat/indices` should be improve to reduce the cluster memory usage.\r\n\r\nIt can be done on `_stats` by using options like `_stats/store,docs`.\r\n\r\nInformation on FST Suggester should be disabled by default according to the memory needed to only provide statistics (especially on `_cat/indices` api).\r\nOr maybe getting information on \"completion\" should not trigger FST Suggester load.\r\n\r\nAll others feature that I use are fast and work well with a few gigabytes of Ram. I cannot add more nodes or more RAM only for statistics features :-(\r\n\r\nThank you for you interest,\r\n\r\nBest regards\r\nBrice Ruzand","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/484229570","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-484229570","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":484229570,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDIyOTU3MA==","user":{"login":"schmittberger","id":40362431,"node_id":"MDQ6VXNlcjQwMzYyNDMx","avatar_url":"https://avatars2.githubusercontent.com/u/40362431?v=4","gravatar_id":"","url":"https://api.github.com/users/schmittberger","html_url":"https://github.com/schmittberger","followers_url":"https://api.github.com/users/schmittberger/followers","following_url":"https://api.github.com/users/schmittberger/following{/other_user}","gists_url":"https://api.github.com/users/schmittberger/gists{/gist_id}","starred_url":"https://api.github.com/users/schmittberger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmittberger/subscriptions","organizations_url":"https://api.github.com/users/schmittberger/orgs","repos_url":"https://api.github.com/users/schmittberger/repos","events_url":"https://api.github.com/users/schmittberger/events{/privacy}","received_events_url":"https://api.github.com/users/schmittberger/received_events","type":"User","site_admin":false},"created_at":"2019-04-17T19:31:18Z","updated_at":"2019-04-17T19:31:18Z","author_association":"NONE","body":"I also still consider this as a bug that really needs fixing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/484245335","html_url":"https://github.com/elastic/elasticsearch/issues/31396#issuecomment-484245335","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31396","id":484245335,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NDI0NTMzNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-04-17T20:19:02Z","updated_at":"2019-04-17T20:19:02Z","author_association":"MEMBER","body":"> I think is a bug because in real life not all that memory should be loaded a the same time and it could be garbage collected, because FST Suggester are lazy loaded.\r\n\r\nThey are lazily loaded but the memory will be used at some point, it can be suggestion queries that target the completion field, a merge that needs to read the data or the statistics endpoint to get the memory usage. If you cannot afford the memory needed by these completion fields maybe you should remove some of them or merge multiple fields in one. ","performed_via_github_app":null}]