{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37183","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37183/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37183/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37183/events","html_url":"https://github.com/elastic/elasticsearch/issues/37183","id":396450748,"node_id":"MDU6SXNzdWUzOTY0NTA3NDg=","number":37183,"title":"[CI] RecoveryDuringReplicationTests failures","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"labels":[{"id":152510590,"node_id":"MDU6TGFiZWwxNTI1MTA1OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Recovery","name":":Distributed/Recovery","color":"0e8a16","default":false,"description":"Anything around constructing a new shard, either from a local or a remote source."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"assignees":[{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2019-01-07T11:28:06Z","updated_at":"2019-01-16T18:20:04Z","closed_at":"2019-01-16T18:20:04Z","author_association":"MEMBER","active_lock_reason":null,"body":"2 recent failures on 6.5 and 6.6 that do not reproduce\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.5+multijob-darwin-compatibility/147/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.6+multijob-darwin-compatibility/37/console\r\n\r\nBoth failed with the same assertion although the stack trace line numbers are different\r\n**6.5**\r\n```\r\nExpected: a value equal to or greater than <50>\r\n     but: <40> was less than <50>\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.index.replication.RecoveryDuringReplicationTests.lambda$testAddNewReplicas$10(RecoveryDuringReplicationTests.java:718)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:848)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:822)\r\n\tat org.elasticsearch.index.replication.RecoveryDuringReplicationTests.testAddNewReplicas(RecoveryDuringReplicationTests.java:718)\r\n```\r\n\r\n**6.6** \r\n```\r\nExpected: a value equal to or greater than <50>\r\n     but: <48> was less than <50>\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.junit.Assert.assertThat(Assert.java:923)\r\n\tat org.elasticsearch.index.replication.RecoveryDuringReplicationTests.lambda$testAddNewReplicas$10(RecoveryDuringReplicationTests.java:725)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:848)\r\n\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:822)\r\n\tat org.elasticsearch.index.replication.RecoveryDuringReplicationTests.testAddNewReplicas(RecoveryDuringReplicationTests.java:725)\r\n```\r\n\r\nBoth report this error\r\n```\r\ncom.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=409, name=Thread-74, state=RUNNABLE, group=TGRP-RecoveryDuringReplicationTests]\r\nCaused by: java.lang.AssertionError: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n\tat __randomizedtesting.SeedInfo.seed([C20144ADEBC4292B]:0)\r\n\tat org.elasticsearch.index.replication.RecoveryDuringReplicationTests.lambda$testAddNewReplicas$9(RecoveryDuringReplicationTests.java:719)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n\tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:265)\r\n\tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n\tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94)\r\n\tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:245)\r\n\tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.index(ESIndexLevelReplicationTestCase.java:228)\r\n\tat org.elasticsearch.index.replication.RecoveryDuringReplicationTests.lambda$testAddNewReplicas$9(RecoveryDuringReplicationTests.java:707)\r\n\t... 1 more\r\nCaused by: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n\tat org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1601)\r\n\tat org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1595)\r\n\tat org.elasticsearch.index.shard.IndexShard.getReplicationGroup(IndexShard.java:2006)\r\n\tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$PrimaryRef.getReplicationGroup(ESIndexLevelReplicationTestCase.java:628)\r\n\tat org.elasticsearch.action.support.replication.ReplicationOperation.checkActiveShardCount(ReplicationOperation.java:221)\r\n\tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:91)\r\n\tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:570)\r\n\tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:244)\r\n\t... 3 more\r\n```\r\n\r\nReproduce for the 6.5 failures:\r\n```\r\n./gradlew :server:test \\\r\n  -Dtests.seed=E3840CC3FD262F34 \\\r\n  -Dtests.class=org.elasticsearch.index.replication.RecoveryDuringReplicationTests \\\r\n  -Dtests.method=\"testAddNewReplicas\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es-MX \\\r\n  -Dtests.timezone=Africa/Kinshasa \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n\r\n./gradlew :server:test \\\r\n  -Dtests.seed=E3840CC3FD262F34 \\\r\n  -Dtests.class=org.elasticsearch.index.replication.RecoveryDuringReplicationTests \\\r\n  -Dtests.method=\"testRecoveryAfterPrimaryPromotion\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es-MX \\\r\n  -Dtests.timezone=Africa/Kinshasa \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nReproduce for 6.6:\r\n```\r\n./gradlew :server:unitTest \\\r\n  -Dtests.seed=C20144ADEBC4292B \\\r\n  -Dtests.class=org.elasticsearch.index.replication.RecoveryDuringReplicationTests \\\r\n  -Dtests.method=\"testAddNewReplicas\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=pl-PL \\\r\n  -Dtests.timezone=America/Noronha \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}