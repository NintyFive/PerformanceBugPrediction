[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297328759","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-297328759","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":297328759,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzMyODc1OQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T09:58:53Z","updated_at":"2017-04-26T09:58:53Z","author_association":"MEMBER","body":"Something is definitely weird here because in botht hte responses the last non-prediction bucket is:\r\n```\r\n              {\r\n                \"key_as_string\": \"2017-02-26T00:00:00.000Z\",\r\n                \"key\": 1488067200000,\r\n                \"doc_count\": 0,\r\n                \"avg__plt\": {\r\n                  \"value\": 14243.0556640625\r\n                },\r\n                \"avg__connection_time\": {\r\n                  \"value\": null\r\n                },\r\n                \"movavg__plt\": {\r\n                  \"value\": 13210.367580574217\r\n                },\r\n                \"movavg__connection_time\": {\r\n                  \"value\": 359.128475\r\n                }\r\n              }\r\n```\r\nThat bucket has a `doc_count` of 0 which is weird because 1) you have no extended_bounds on your histogram so it should not be returning empty buckets and 2) if the bucket is empty then the `avg__plt` agg should be returning `null` like the `avg__connection_time` agg is because there was no date for the bucket to compute the average for.\r\n\r\n@polyfractal any ideas here? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297329343","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-297329343","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":297329343,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzMyOTM0Mw==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T10:00:26Z","updated_at":"2017-04-26T10:00:26Z","author_association":"MEMBER","body":"@liorg2 are you able to try to come up with a recreation script that should this same behaviour on a fresh index? If so could you provide it here? (it would be good if your recreation script includes creating the index and indexing documents so we can fully reproduce what you are seeing)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297330191","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-297330191","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":297330191,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzMzMDE5MQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T10:02:29Z","updated_at":"2017-04-26T10:02:29Z","author_association":"MEMBER","body":"@liorg2 also, could you do a query for `\"key\":\"75610c7ee12bc268af33ddb31828a4b8\"` and `\"create_date\": [1488067200000 TO 1488153600000]` to see if it matches any documents? (from those above responses it suggests you should get 0 hits","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297370012","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-297370012","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":297370012,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzM3MDAxMg==","user":{"login":"liorg2","id":1691647,"node_id":"MDQ6VXNlcjE2OTE2NDc=","avatar_url":"https://avatars1.githubusercontent.com/u/1691647?v=4","gravatar_id":"","url":"https://api.github.com/users/liorg2","html_url":"https://github.com/liorg2","followers_url":"https://api.github.com/users/liorg2/followers","following_url":"https://api.github.com/users/liorg2/following{/other_user}","gists_url":"https://api.github.com/users/liorg2/gists{/gist_id}","starred_url":"https://api.github.com/users/liorg2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liorg2/subscriptions","organizations_url":"https://api.github.com/users/liorg2/orgs","repos_url":"https://api.github.com/users/liorg2/repos","events_url":"https://api.github.com/users/liorg2/events{/privacy}","received_events_url":"https://api.github.com/users/liorg2/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T11:33:52Z","updated_at":"2017-04-26T11:33:52Z","author_association":"NONE","body":"thanks @colings86 \r\n\r\nthere is one doc by this condition:\r\n\r\n```\r\nGET .../_search?ignore_unavailable\r\n{\r\n  \"size\": 10,\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"range\": {\r\n            \"create_date\": {\r\n              \"gte\": \"2017-02-26T00:00:00\",\r\n              \"lt\": \"2017-02-27T00:00:00\"\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"terms\": {\r\n            \"key\": [\r\n              \"75610c7ee12bc268af33ddb31828a4b8\"\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n\r\n```\r\n\r\nit doesn't have this field though: \"connection_time__stats\"\r\n\r\nis there a quick way to generate such a create/index script you mentioned?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297543074","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-297543074","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":297543074,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzU0MzA3NA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T21:14:04Z","updated_at":"2017-04-26T21:14:04Z","author_association":"MEMBER","body":"Urgh, yeah, I have no idea what's going on here either.  All the values are identical up until the missing prediction bucket.\r\n\r\nI'm wondering if that second-to-last bucket with a count of zero is somehow getting overwritten/merged with a prediction bucket?  E.g. [here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregator.java#L164) we create a new bucket for the prediction -- using any existing buckets -- but set the doc count to zero. \r\n\r\nIf the two series are not \"lined up\" then one of the aggs would overwrite a valid bucket with it's prediction, which may be the case here... I think.\r\n\r\nI'm still not sure why the order matters and why the last bucket shows/doesn't show, but it may be related.  I'll start debugging.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297991641","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-297991641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":297991641,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzk5MTY0MQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T13:01:18Z","updated_at":"2017-04-28T13:01:18Z","author_association":"MEMBER","body":"BTW @liorg2 , if there's any way you can create a small test case that demonstrates this behavior, it would be very appreciated!  Still a bit stumped what's going on here :/","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298030954","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-298030954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":298030954,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODAzMDk1NA==","user":{"login":"liorg2","id":1691647,"node_id":"MDQ6VXNlcjE2OTE2NDc=","avatar_url":"https://avatars1.githubusercontent.com/u/1691647?v=4","gravatar_id":"","url":"https://api.github.com/users/liorg2","html_url":"https://github.com/liorg2","followers_url":"https://api.github.com/users/liorg2/followers","following_url":"https://api.github.com/users/liorg2/following{/other_user}","gists_url":"https://api.github.com/users/liorg2/gists{/gist_id}","starred_url":"https://api.github.com/users/liorg2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liorg2/subscriptions","organizations_url":"https://api.github.com/users/liorg2/orgs","repos_url":"https://api.github.com/users/liorg2/repos","events_url":"https://api.github.com/users/liorg2/events{/privacy}","received_events_url":"https://api.github.com/users/liorg2/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T15:34:33Z","updated_at":"2017-04-28T15:34:33Z","author_association":"NONE","body":"No prob. Will do it on Monday\n\nOn Fri, 28 Apr 2017 at 16:04 Zachary Tong <notifications@github.com> wrote:\n\n> BTW @liorg2 <https://github.com/liorg2> , if there's any way you can\n> create a small test case that demonstrates this behavior, it would be very\n> appreciated! Still a bit stumped what's going on here :/\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/24327#issuecomment-297991641>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/ABnP_ywaSHC62CY1uppgaKd3-9OQDbr3ks5r0eNJgaJpZM4NIihn>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/300522850","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-300522850","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":300522850,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDUyMjg1MA==","user":{"login":"liorg2","id":1691647,"node_id":"MDQ6VXNlcjE2OTE2NDc=","avatar_url":"https://avatars1.githubusercontent.com/u/1691647?v=4","gravatar_id":"","url":"https://api.github.com/users/liorg2","html_url":"https://github.com/liorg2","followers_url":"https://api.github.com/users/liorg2/followers","following_url":"https://api.github.com/users/liorg2/following{/other_user}","gists_url":"https://api.github.com/users/liorg2/gists{/gist_id}","starred_url":"https://api.github.com/users/liorg2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liorg2/subscriptions","organizations_url":"https://api.github.com/users/liorg2/orgs","repos_url":"https://api.github.com/users/liorg2/repos","events_url":"https://api.github.com/users/liorg2/events{/privacy}","received_events_url":"https://api.github.com/users/liorg2/received_events","type":"User","site_admin":false},"created_at":"2017-05-10T15:39:18Z","updated_at":"2017-05-10T15:39:18Z","author_association":"NONE","body":"I'm very sorry, but I don't have access to this data anymore. I really hope that you succeeded to reproduce this issue.....\r\nanyway I think is that the missing field cause this issue\r\n\r\nLior","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302183395","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-302183395","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":302183395,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjE4MzM5NQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2017-05-17T18:22:09Z","updated_at":"2017-05-17T18:22:09Z","author_association":"MEMBER","body":"No luck reproducing, but after looking a bit closer there's definitely a bug with predictions overwriting doc counts on buckets.  Perhaps that's the root cause, not sure.  I'll work up a PR to fix that and hopefully it'll fix your problem :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302332929","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-302332929","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":302332929,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjMzMjkyOQ==","user":{"login":"liorg2","id":1691647,"node_id":"MDQ6VXNlcjE2OTE2NDc=","avatar_url":"https://avatars1.githubusercontent.com/u/1691647?v=4","gravatar_id":"","url":"https://api.github.com/users/liorg2","html_url":"https://github.com/liorg2","followers_url":"https://api.github.com/users/liorg2/followers","following_url":"https://api.github.com/users/liorg2/following{/other_user}","gists_url":"https://api.github.com/users/liorg2/gists{/gist_id}","starred_url":"https://api.github.com/users/liorg2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liorg2/subscriptions","organizations_url":"https://api.github.com/users/liorg2/orgs","repos_url":"https://api.github.com/users/liorg2/repos","events_url":"https://api.github.com/users/liorg2/events{/privacy}","received_events_url":"https://api.github.com/users/liorg2/received_events","type":"User","site_admin":false},"created_at":"2017-05-18T08:10:35Z","updated_at":"2017-05-18T08:14:34Z","author_association":"NONE","body":"Sorry, but the admin here deleted all \"QA indices\" from time to time. I will try to replicate it when I have more time. \r\nBTW, it will be very nice of you guys to add also upper/lower fences, as few other libraries do.\r\nalso, can I ask, if you are using open source lib for the models/prediction calc ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/308160939","html_url":"https://github.com/elastic/elasticsearch/issues/24327#issuecomment-308160939","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24327","id":308160939,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODE2MDkzOQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2017-06-13T15:47:24Z","updated_at":"2017-06-13T15:47:24Z","author_association":"MEMBER","body":"Gonna close this, feel free to re-open if you can provide some more information about the issue you were having.  #24892 fixed the doc_count issue, so perhaps try to upgrade to a version with that bugfix (5.5, 6.0) if you get a chance.\r\n\r\n> BTW, it will be very nice of you guys to add also upper/lower fences, as few other libraries do.\r\nalso, can I ask, if you are using open source lib for the models/prediction calc ?\r\n\r\nWe can look into adding fences, although I'm not quite sure how that applies to moving average?  I've only seen fences in reference to box-plots.\r\n\r\nNo open source lib for models/prediction, just our own code.  We only support pretty simple moving averages and extrapolation, so it wasn't a burden to write it ourself. :)","performed_via_github_app":null}]