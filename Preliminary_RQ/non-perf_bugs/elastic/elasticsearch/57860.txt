{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57860","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57860/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57860/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57860/events","html_url":"https://github.com/elastic/elasticsearch/issues/57860","id":635096559,"node_id":"MDU6SXNzdWU2MzUwOTY1NTk=","number":57860,"title":"Running plugin with \"gradle run --debug-jvm\" seems to be broken after version 7.4.x","user":{"login":"alexklibisz","id":8015228,"node_id":"MDQ6VXNlcjgwMTUyMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/8015228?v=4","gravatar_id":"","url":"https://api.github.com/users/alexklibisz","html_url":"https://github.com/alexklibisz","followers_url":"https://api.github.com/users/alexklibisz/followers","following_url":"https://api.github.com/users/alexklibisz/following{/other_user}","gists_url":"https://api.github.com/users/alexklibisz/gists{/gist_id}","starred_url":"https://api.github.com/users/alexklibisz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexklibisz/subscriptions","organizations_url":"https://api.github.com/users/alexklibisz/orgs","repos_url":"https://api.github.com/users/alexklibisz/repos","events_url":"https://api.github.com/users/alexklibisz/events{/privacy}","received_events_url":"https://api.github.com/users/alexklibisz/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"breskeby","id":77300,"node_id":"MDQ6VXNlcjc3MzAw","avatar_url":"https://avatars3.githubusercontent.com/u/77300?v=4","gravatar_id":"","url":"https://api.github.com/users/breskeby","html_url":"https://github.com/breskeby","followers_url":"https://api.github.com/users/breskeby/followers","following_url":"https://api.github.com/users/breskeby/following{/other_user}","gists_url":"https://api.github.com/users/breskeby/gists{/gist_id}","starred_url":"https://api.github.com/users/breskeby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breskeby/subscriptions","organizations_url":"https://api.github.com/users/breskeby/orgs","repos_url":"https://api.github.com/users/breskeby/repos","events_url":"https://api.github.com/users/breskeby/events{/privacy}","received_events_url":"https://api.github.com/users/breskeby/received_events","type":"User","site_admin":false},"assignees":[{"login":"breskeby","id":77300,"node_id":"MDQ6VXNlcjc3MzAw","avatar_url":"https://avatars3.githubusercontent.com/u/77300?v=4","gravatar_id":"","url":"https://api.github.com/users/breskeby","html_url":"https://github.com/breskeby","followers_url":"https://api.github.com/users/breskeby/followers","following_url":"https://api.github.com/users/breskeby/following{/other_user}","gists_url":"https://api.github.com/users/breskeby/gists{/gist_id}","starred_url":"https://api.github.com/users/breskeby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breskeby/subscriptions","organizations_url":"https://api.github.com/users/breskeby/orgs","repos_url":"https://api.github.com/users/breskeby/repos","events_url":"https://api.github.com/users/breskeby/events{/privacy}","received_events_url":"https://api.github.com/users/breskeby/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2020-06-09T04:15:36Z","updated_at":"2020-11-11T21:36:23Z","closed_at":"2020-06-11T17:58:58Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: Pertains to 7.4.x and up\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): Pertains to 12 and up\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Ubuntu 19.04, 20.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI'm developing a plugin that started with ES version 7.4.x and I want to update it to use the latest 7.7.x. I found that after bumping from 7.4.2 to 7.5.0 I'm no longer able to debug the plugin using `./gradlew run --debug-jvm`. The regular `./gradlew run` still works like normal. \r\n\r\n**Steps to reproduce**:\r\n\r\nI was able to replicate this with an open source plugin maintained by an elastic employee: https://github.com/spinscale/elasticsearch-ingest-langdetect, which I'll use for my example below.\r\n\r\nIf you checkout [the commit that updates to 7.4.2](https://github.com/spinscale/elasticsearch-ingest-langdetect/commit/3b533ee8bd50c72b242629e2606f73edeb1ddbf6), you'll find you can run `./gradlew run --debug-jvm` without issue.\r\n\r\n```\r\n$ git checkout 3b533ee8bd50c72b242629e2606f73edeb1ddbf6\r\n$ ./gradlew run --debug-jvm\r\n```\r\n\r\nThis eventually prints \"Running elasticsearch in debug mode, suspending until connected on port 8000\" and you can connect from an IDE. So it works.\r\n\r\nThen if you checkout [the next commit that updates to 7.5.0](https://github.com/spinscale/elasticsearch-ingest-langdetect/commit/a027abaf19b28320dcd2f61515a34217c8e1ccdd), and run with `--stacktrace`, you get an error.\r\n\r\n```\r\n$ git checkout 28c4c8851cb0d00945286f8c02327ebd00995b09\r\n$ ./gradlew --stacktrace run --debug-jvm\r\n```\r\n\r\nThis eventually prints a large stacktrace, summarized below:\r\n\r\n```\r\n* Exception is:\r\norg.gradle.api.tasks.TaskExecutionException: Execution failed for task ':run'.\r\n        at org.gradle.api.internal.tasks.execution.ExecuteActionsTaskExecuter$3.accept(ExecuteActionsTaskExecuter.java:166)\r\n        ...\r\n        ...\r\nCaused by: org.gradle.process.internal.ExecException: Process 'command './bin/elasticsearch-plugin'' finished with non-zero exit value 2\r\n        at org.gradle.process.internal.DefaultExecHandle$ExecResultImpl.assertNormalExitValue(DefaultExecHandle.java:409)\r\n        ...\r\n```\r\n\r\nI also tried this with the subsequent 7.6.x and 7.7.x updates and it produces the same errors. \r\nNote that both 7.4.2 and 7.5.0 are running on JDK 12. So it doesn't seem to be a JDK bug.\r\nI'm using OpenJDK 12.0.2 in the above example. \r\n\r\n**Provide logs (if relevant)**:\r\n\r\nHere is the full log: https://pastebin.com/6RctUHpL","closed_by":{"login":"breskeby","id":77300,"node_id":"MDQ6VXNlcjc3MzAw","avatar_url":"https://avatars3.githubusercontent.com/u/77300?v=4","gravatar_id":"","url":"https://api.github.com/users/breskeby","html_url":"https://github.com/breskeby","followers_url":"https://api.github.com/users/breskeby/followers","following_url":"https://api.github.com/users/breskeby/following{/other_user}","gists_url":"https://api.github.com/users/breskeby/gists{/gist_id}","starred_url":"https://api.github.com/users/breskeby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breskeby/subscriptions","organizations_url":"https://api.github.com/users/breskeby/orgs","repos_url":"https://api.github.com/users/breskeby/repos","events_url":"https://api.github.com/users/breskeby/events{/privacy}","received_events_url":"https://api.github.com/users/breskeby/received_events","type":"User","site_admin":false},"performed_via_github_app":null}