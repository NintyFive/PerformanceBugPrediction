{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/40546","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40546/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40546/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40546/events","html_url":"https://github.com/elastic/elasticsearch/issues/40546","id":426098110,"node_id":"MDU6SXNzdWU0MjYwOTgxMTA=","number":40546,"title":"org.elasticsearch.xpack.ml.integration.BasicDistributedJobsIT.testFailOverBasics failed","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-03-27T17:41:25Z","updated_at":"2019-06-17T08:26:37Z","closed_at":"2019-06-17T08:26:37Z","author_association":"MEMBER","active_lock_reason":null,"body":"Failure not reproducible locally. \r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+internalClusterTest/3881/consoleFull\r\nReproduce Line:\r\n```\r\n./gradlew :x-pack:plugin:ml:internalClusterTest -Dtests.seed=D9A30C4EA4AC438B -Dtests.class=org.elasticsearch.xpack.ml.integration.BasicDistributedJobsIT -Dtests.method=\"testFailOverBasics\" -Dtests.security.manager=true -Dtests.locale=en-AU -Dtests.timezone=Etc/GMT-14 -Dcompiler.java=12 -Druntime.java=8\r\n```\r\n\r\nDigging into the failure, it appears that the test timed out waiting for `ensureGreen`\r\n```\r\n  1> [2019-03-28T07:05:01,572][INFO ][o.e.x.m.i.BasicDistributedJobsIT] [testFailOverBasics] ensureGreen timed out, cluster state:\r\n```\r\n\r\nThe failure seems as if:\r\n• We killed the master (node0) and they abdicated to node3\r\n• We tried waiting for green but timed out\r\n• This is because `.ml-state` never fully made a replica. Seems that we killed a node too quickly? So the `.ml-state` index kept the cluster from being green. \r\n\r\n ```\r\n1> ----shard_id [.ml-state][0]\r\n  1> --------[.ml-state][0], node[null], [P], recovery_source[existing store recovery; bootstrap_history_uuid=false], s[UNASSIGNED], unassigned_info[[reason=NODE_LEFT], at[2019-03-27T17:04:31.506Z], delayed=false, details[node_left [7teV8OudStufgnfSDcALpw]], allocation_status[no_valid_shard_copy]]\r\n  1> --------[.ml-state][0], node[null], [R], recovery_source[peer recovery], s[UNASSIGNED], unassigned_info[[reason=PRIMARY_FAILED], at[2019-03-27T17:04:31.506Z], delayed=false, details[primary failed while replica initializing], allocation_status[no_attempt]]\r\n```","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}