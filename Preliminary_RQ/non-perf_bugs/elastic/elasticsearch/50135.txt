{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50135","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50135/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50135/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50135/events","html_url":"https://github.com/elastic/elasticsearch/issues/50135","id":536946913,"node_id":"MDU6SXNzdWU1MzY5NDY5MTM=","number":50135,"title":"[ML] Improve error handling when using transforms with inference processors","user":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-12-12T12:24:52Z","updated_at":"2020-02-04T09:50:57Z","closed_at":"2020-02-04T09:50:57Z","author_association":"NONE","active_lock_reason":null,"body":"Found in 7.6.0-SNAPSHOT\r\n\r\nIt is possible to create and update a transform that uses a pipeline that does not exist.\r\n\r\nFor example:\r\n```\r\nPOST _transform/transform-01/_update\r\n{\r\n  \"dest\": {\r\n    \"index\" : \"transform-01\",\r\n    \"pipeline\" : \"this-does-not-exist\"\r\n  }\r\n}\r\n```\r\nReturns `acknowledged: true`\r\n\r\nIf you start this transform, then we log audit messages saying:\r\n`Transform encountered an exception: org.elasticsearch.xpack.transform.transforms.ClientTransformIndexer$BulkIndexingException: Bulk index experienced failures. See the logs of the node running the transform for details. Will attempt again at next scheduled trigger.`\r\n\r\nAnd by looking in the logs on disk, we see \r\n`[2019-12-12T11:49:24,655][DEBUG][o.e.a.b.T.BulkRequestModifier] [node3] failed to execute pipeline [_none] for document [transform-01/_doc/MTWq3Ia7HoVvarOSxUzsmioAAAAAAAAA]\r\njava.lang.IllegalArgumentException: pipeline with id [this-does-not-exist] does not exist`\r\n\r\nThis continuous transform failed after several minutes with `task encountered more than 10 failures; latest failure:`\r\n\r\nSecondly, if the pipeline refers to a model that does not exist, then we have similar audit messages asking you to look in the log files, which have the error:\r\n`Caused by: org.elasticsearch.ResourceNotFoundException: Could not find trained model [this-model-does-not-exist]`\r\n\r\nThis continuous transform also failed after several minutes with `task encountered more than 10 failures; latest failure:`\r\n\r\nShould we:\r\n- Validate a pipeline exists when creating or updating a transform \r\n- Validate that a model exists when creating a inference processor pipeline\r\n(although reindex does not do this.)\r\n\r\nRegardless of whether we validate the pipeline and/or model exists, we should surface the errors as audit messages so that the user does not have to look at log files on disk.\r\n\r\n(note,\r\nif you use reindex with a pipeline that does not exist, it returns all docs as 400 failures\r\n```\r\n...\r\n\"failures\" : [\r\n    {\r\n      \"index\" : \"kibana_sample_data_flights_copy\",\r\n      \"type\" : \"_doc\",\r\n      \"id\" : \"3TDI6m4BXY3wzdkLGbWl\",\r\n      \"cause\" : {\r\n        \"type\" : \"illegal_argument_exception\",\r\n        \"reason\" : \"pipeline with id [pipeline-does-not-exist] does not exist\"\r\n      },\r\n      \"status\" : 400\r\n    },\r\n...\r\n```\r\n\r\nif you use reindex with a pipeline that exists but refers to a model that does not exist, it returns all docs as 404 failures\r\n```\r\n...\r\n\"failures\" : [\r\n    {\r\n      \"index\" : \"kibana_sample_data_flights_copy2\",\r\n      \"type\" : \"_doc\",\r\n      \"id\" : \"3jDI6m4BXY3wzdkLGbWl\",\r\n      \"cause\" : {\r\n        \"type\" : \"resource_not_found_exception\",\r\n        \"reason\" : \"Could not find trained model [model-does-not-exist]\"\r\n      },\r\n      \"status\" : 404\r\n    },\r\n...\r\n```\r\n\r\ncc @hendrikmuhs @benwtrent \r\n","closed_by":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"performed_via_github_app":null}