{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14875","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14875/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14875/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14875/events","html_url":"https://github.com/elastic/elasticsearch/issues/14875","id":117970494,"node_id":"MDU6SXNzdWUxMTc5NzA0OTQ=","number":14875,"title":"Search using alias + type returns {\"error\": null}","user":{"login":"kadishmal","id":978004,"node_id":"MDQ6VXNlcjk3ODAwNA==","avatar_url":"https://avatars1.githubusercontent.com/u/978004?v=4","gravatar_id":"","url":"https://api.github.com/users/kadishmal","html_url":"https://github.com/kadishmal","followers_url":"https://api.github.com/users/kadishmal/followers","following_url":"https://api.github.com/users/kadishmal/following{/other_user}","gists_url":"https://api.github.com/users/kadishmal/gists{/gist_id}","starred_url":"https://api.github.com/users/kadishmal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kadishmal/subscriptions","organizations_url":"https://api.github.com/users/kadishmal/orgs","repos_url":"https://api.github.com/users/kadishmal/repos","events_url":"https://api.github.com/users/kadishmal/events{/privacy}","received_events_url":"https://api.github.com/users/kadishmal/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-11-20T05:52:59Z","updated_at":"2015-11-20T06:43:34Z","closed_at":"2015-11-20T06:43:34Z","author_association":"NONE","active_lock_reason":null,"body":"Very strange. Using ES 1.7.3 on CentOS 6.3 x64.\n1. First, create an alias for an existing index.\n   \n   ```\n   POST /_aliases\n   {\n      \"actions\" : [\n          { \"add\" : { \"index\" : \"v2-log-2015-11-19\", \"alias\" : \"log-2015-11-19\" } }\n      ]\n   }\n   ```\n2. Then perform a search using the new alias:\n   \n   ```\n   POST /log-2015-11-19/webapp/_search?routing=webapp\n   {\n     \"query\": {\n       \"filtered\": {\n         \"filter\": {\n           \"range\": {\n             \"logTime\": {\n               \"from\": 1447910416536,\n               \"to\": 1447996816535\n             }\n           }\n         }\n       }\n     }\n   }\n   ```\n   \n   Returns:\n   \n   ```\n   {\n      \"error\": null\n   }\n   ```\n   \n   The ES logs say:\n   \n   ```\n   [2015-11-20 14:36:38,813][DEBUG][org.eclipse.jetty.io.nio ] [bumbobox.dev] created SCEP@2a7c878a{l(/10.11.12.13:45811)<->r(/10.11.12.15:9200),s=0,open=true,ishut=false,oshut=false,rb=false,wb=false,w=true,i=0}-{AsyncHttpConnection@55a68ad0,g=HttpGenerator{s=0,h=-1,b=-1,c=-1},p=HttpParser{s=-14,l=0,c=0},r=0}\n   [2015-11-20 14:36:38,813][DEBUG][org.eclipse.jetty.server.Server] [bumbobox.dev] REQUEST /log-2015-11-19/webapp/_search on AsyncHttpConnection@55a68ad0,g=HttpGenerator{s=0,h=-1,b=-1,c=-1},p=HttpParser{s=6,l=7,c=-2},r=1\n   [2015-11-20 14:36:38,814][DEBUG][index.analysis.rest      ] [bumbobox.dev] failed to parse search request parameters\n   java.lang.NullPointerException\n           at org.elasticsearch.index.analysis.rest.TokenizerRestAction.handleRequest(TokenizerRestAction.java:93)\n           at org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:53)\n           at org.elasticsearch.rest.RestController.executeHandler(RestController.java:225)\n           at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:170)\n           at org.elasticsearch.http.HttpServer.internalDispatchRequest(HttpServer.java:121)\n           at org.elasticsearch.http.HttpServer$Dispatcher.dispatchRequest(HttpServer.java:83)\n           at com.sonian.elasticsearch.http.jetty.handler.JettyHttpServerTransportHandler.handle(JettyHttpServerTransportHandler.java:69)\n           at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:522)\n           at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n           at org.eclipse.jetty.server.Server.handle(Server.java:366)\n           at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:494)\n           at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:982)\n           at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1043)\n           at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:957)\n           at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240)\n           at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n           at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:696)\n           at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:53)\n           at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n           at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n           at java.lang.Thread.run(Thread.java:745)\n   [2015-11-20 14:36:38,815][DEBUG][org.eclipse.jetty.server.Server] [bumbobox.dev] RESPONSE /log-2015-11-19/webapp/_search  400 handled=false\n   ```\n3. If you search the original index directly, then it works properly:\n   \n   ```\n   POST /v2-log-2015-11-19/webapp/_search?routing=webapp\n   {\n     \"query\": {\n       \"filtered\": {\n         \"filter\": {\n           \"range\": {\n             \"logTime\": {\n               \"from\": 1447910416536,\n               \"to\": 1447996816535\n             }\n           }\n         }\n       }\n     }\n   }\n   ```\n   \n   Returns:\n   \n   ```\n   {\n      \"took\": 2,\n      \"timed_out\": false,\n      \"_shards\": {\n         \"total\": 1,\n         \"successful\": 1,\n         \"failed\": 0\n      },\n      \"hits\": {\n         \"total\": 3960,\n         \"max_score\": 1,\n         \"hits\": [\n            {\n                   ....\n   ```\n4. Alternatively, if you remove the type from the alias based search request, the response is correct.\n   \n   ```\n   POST /log-2015-11-19/_search\n   {\n     \"query\": {\n       \"filtered\": {\n         \"filter\": {\n           \"range\": {\n             \"logTime\": {\n               \"from\": 1447910416536,\n               \"to\": 1447996816535\n             }\n           }\n         }\n       }\n     }\n   }\n   ```\n   \n   Returns:\n   \n   ```\n   {\n      \"took\": 165,\n      \"timed_out\": false,\n      \"_shards\": {\n         \"total\": 15,\n         \"successful\": 15,\n         \"failed\": 0\n      },\n      \"hits\": {\n         \"total\": 68061695,\n         \"max_score\": 1,\n         \"hits\": [\n            {\n                   ....\n   ```\n\nAll the above is same when using any different type.\n\nIs there anything I am doing wrong?\n","closed_by":{"login":"kadishmal","id":978004,"node_id":"MDQ6VXNlcjk3ODAwNA==","avatar_url":"https://avatars1.githubusercontent.com/u/978004?v=4","gravatar_id":"","url":"https://api.github.com/users/kadishmal","html_url":"https://github.com/kadishmal","followers_url":"https://api.github.com/users/kadishmal/followers","following_url":"https://api.github.com/users/kadishmal/following{/other_user}","gists_url":"https://api.github.com/users/kadishmal/gists{/gist_id}","starred_url":"https://api.github.com/users/kadishmal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kadishmal/subscriptions","organizations_url":"https://api.github.com/users/kadishmal/orgs","repos_url":"https://api.github.com/users/kadishmal/repos","events_url":"https://api.github.com/users/kadishmal/events{/privacy}","received_events_url":"https://api.github.com/users/kadishmal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}