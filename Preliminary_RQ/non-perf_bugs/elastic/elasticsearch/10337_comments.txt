[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89021021","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-89021021","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":89021021,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MDIxMDIx","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-04-02T19:41:30Z","updated_at":"2015-04-02T19:41:30Z","author_association":"CONTRIBUTOR","body":"There is a 5 minute cache in the JDK for localhost.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89023037","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-89023037","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":89023037,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MDIzMDM3","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-04-02T19:47:55Z","updated_at":"2015-04-02T19:47:55Z","author_association":"CONTRIBUTOR","body":"Sorry, i meant 5 second :) Look @ InetAddress.java\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89026157","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-89026157","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":89026157,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MDI2MTU3","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2015-04-02T20:00:18Z","updated_at":"2015-04-02T20:00:18Z","author_association":"MEMBER","body":"this is really weird, since you can see we do full connection all the way to the SocketImpl every time... .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89228436","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-89228436","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":89228436,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MjI4NDM2","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-04-03T08:59:14Z","updated_at":"2015-04-03T08:59:14Z","author_association":"MEMBER","body":"@rmuir how do you draw the connection to localhost? This cluster was running on several hosts, no localhost involved in discovery... could the cache still be an issue?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89259944","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-89259944","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":89259944,"node_id":"MDEyOklzc3VlQ29tbWVudDg5MjU5OTQ0","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-04-03T11:29:57Z","updated_at":"2015-04-03T11:29:57Z","author_association":"CONTRIBUTOR","body":"You mentioned a JVM cache, so I gave you one. I wouldn't dismiss the problem: i see ES calling InetAddress.getLocalHost in inconsistent and buggy ways. In one place it even caches it in a static block as if it can never change. broken...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89576926","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-89576926","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":89576926,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NTc2OTI2","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2015-04-04T13:22:12Z","updated_at":"2015-04-04T13:22:12Z","author_association":"MEMBER","body":"@spinscale here is some reference to the caching I was referring to, it revolves around DNS caching done in the JVM: \n- http://wiki.apache.org/hadoop/NoRouteToHost\n- http://docs.oracle.com/javase/8/docs/technotes/guides/net/properties.html\n- http://serverfault.com/questions/459814/clearing-tomcats-dns-cache\n- http://docs.aws.amazon.com/AWSSdkDocsJava/latest//DeveloperGuide/java-dg-jvm-ttl.html\n\nWe might want to consider setting different ttl in our config, unsure yet though, but at least it can explain whats going on.\n\nRegarding the local address caching, its mainly used during startup and for logging. I think we can clean this up, for startup, its ok to simply not use the cache, and conceptually we can do the same for logging, since we set all the loggers anyhow.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89578303","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-89578303","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":89578303,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NTc4MzAz","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2015-04-04T13:30:46Z","updated_at":"2015-04-04T13:30:46Z","author_association":"MEMBER","body":"Btw, another reason why this can happen, and this is more connected to how nodes are serialized over the network. When a node starts up, it gets initialized with an address, and when the cluster state is published it gets streamed to the other node, and it uses the actual IP address to construct back the inet address, and not perform another lookup based on host name. So the IP address of a node is set on startup, and then published so it can be connected to.\n\nThis can result in this failure as well, and to be honest, its a tricky tradeoff here... . There is a way to force serialization to serialize host name, and then do lookup on each deserialization, its in `InetSocketTransportAddress`. \n\nMost other systems I have looked at when investigating this were doing the same thing, which is serializing the IP address itself, I think thats why what you see when a change happens is the common recommendation is to restart the JVM (the combination of the JVM cache and this serialization mode for networked systems)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/171653232","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-171653232","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":171653232,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTY1MzIzMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-14T14:09:06Z","updated_at":"2016-01-14T14:09:06Z","author_association":"CONTRIBUTOR","body":"Has this been resolved by recent changes?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/370867016","html_url":"https://github.com/elastic/elasticsearch/issues/10337#issuecomment-370867016","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10337","id":370867016,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MDg2NzAxNg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-06T17:46:41Z","updated_at":"2018-03-06T17:46:41Z","author_association":"MEMBER","body":"Closed by #21630","performed_via_github_app":null}]