{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30927","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30927/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30927/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30927/events","html_url":"https://github.com/elastic/elasticsearch/issues/30927","id":327317745,"node_id":"MDU6SXNzdWUzMjczMTc3NDU=","number":30927,"title":"[CI] Failiures on IndexLifecycleManagerIntegTests","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":912838879,"node_id":"MDU6TGFiZWw5MTI4Mzg4Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Security","name":":Security/Security","color":"0e8a16","default":false,"description":"Security issues without another label"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-05-29T13:20:40Z","updated_at":"2018-08-02T14:00:56Z","closed_at":"2018-08-02T14:00:55Z","author_association":"MEMBER","active_lock_reason":null,"body":"https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.3+matrix-java-periodic/ES_BUILD_JAVA=java10,ES_RUNTIME_JAVA=java10,nodes=virtual&&linux/68/console\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:security:test \\\r\n  -Dtests.seed=58992C93F13C812D \\\r\n  -Dtests.class=org.elasticsearch.xpack.security.support.IndexLifecycleManagerIntegTests \\\r\n  -Dtests.method=\"testConcurrentOperationsTryingToCreateSecurityIndexAndAlias\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=gd-GB \\\r\n  -Dtests.timezone=Europe/Warsaw\r\n\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:security:test \\\r\n  -Dtests.seed=58992C93F13C812D \\\r\n  -Dtests.class=org.elasticsearch.xpack.security.support.IndexLifecycleManagerIntegTests \\\r\n  -Dtests.method=\"testConcurrentOperationsTryingToCreateSecurityIndexAndAlias\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=gd-GB \\\r\n  -Dtests.timezone=Europe/Warsaw\r\n\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:security:test \\\r\n  -Dtests.seed=58992C93F13C812D \\\r\n  -Dtests.class=org.elasticsearch.xpack.security.support.IndexLifecycleManagerIntegTests \\\r\n  -Dtests.method=\"testConcurrentOperationsTryingToCreateSecurityIndexAndAlias\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=gd-GB \\\r\n  -Dtests.timezone=Europe/Warsaw\r\n\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:security:test \\\r\n  -Dtests.seed=58992C93F13C812D \\\r\n  -Dtests.class=org.elasticsearch.xpack.security.support.IndexLifecycleManagerIntegTests \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=en-US \\\r\n  -Dtests.timezone=Etc/UTC\r\n\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:security:test \\\r\n  -Dtests.seed=58992C93F13C812D \\\r\n  -Dtests.class=org.elasticsearch.xpack.security.support.IndexLifecycleManagerIntegTests \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=en-US \\\r\n  -Dtests.timezone=Etc/UTC\r\n```\r\n\r\nDoes not reproduce locally with the above, in the logs the first exceptions seem to indicate a startup problem:\r\n\r\n```\r\n21:10:12       [get] To: /var/lib/jenkins/workspace/elastic+elasticsearch+6.3+matrix-java-periodic/ES_BUILD_JAVA/java10/ES_RUNTIME_JAVA/java10/nodes/virtual&&linux/plugins/repository-gcs/build/fixtures/googleCloudStorageFixture/cwd/wait.success\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Error opening connection java.io.IOException: Server returned HTTP response code: 500 for URL: http://127.0.0.1:43635\r\n21:10:12       [get] Can't get http://127.0.0.1:43635 to /var/lib/jenkins/workspace/elastic+elasticsearch+6.3+matrix-java-periodic/ES_BUILD_JAVA/java10/ES_RUNTIME_JAVA/java10/nodes/virtual&&linux/plugins/repository-gcs/build/fixtures/googleCloudStorageFixture/cwd/wait.success\r\n```\r\nThe subsequent failures look like follow up problems to me:\r\n```\r\n22:12:43    > Throwable #1: java.lang.RuntimeException: failed to start nodes\r\n22:12:43   2> NOTE: leaving temporary files on disk at: /var/lib/jenkins/workspace/elastic+elasticsearch+6.3+matrix-java-periodic/ES_BUILD_JAVA/java10/ES_RUNTIME_JAVA/java10/nodes/virtual&&linux/x-pack/plugin/security/build/testrun/test/J1/temp/org.elasticsearch.xpack.security.support.IndexLifecycleManagerIntegTests_58992C93F13C812D-001\r\n22:12:43    > \tat org.elasticsearch.test.InternalTestCluster.startAndPublishNodesAndClients(InternalTestCluster.java:1375)\r\n22:12:43    > \tat org.elasticsearch.test.InternalTestCluster.reset(InternalTestCluster.java:1046)\r\n22:12:43   2> May 28, 2018 10:12:34 PM com.carrotsearch.randomizedtesting.ThreadLeakControl checkThreadLeaks\r\n22:12:43   2> WARNING: Will linger awaiting termination of 104 leaked thread(s).\r\n22:12:43    > \tat org.elasticsearch.test.InternalTestCluster.beforeTest(InternalTestCluster.java:973)\r\n22:12:43   2> May 28, 2018 10:12:39 PM com.carrotsearch.randomizedtesting.ThreadLeakControl checkThreadLeaks\r\n22:12:43   2> SEVERE: 106 threads leaked from SUITE scope at org.elasticsearch.xpack.security.support.IndexLifecycleManagerIntegTests: \r\n22:12:43    > \tat org.elasticsearch.test.ESIntegTestCase.beforeInternal(ESIntegTestCase.java:380)\r\n22:12:43   2>    1) Thread[id=1101, name=elasticsearch[node_sm0][[transport_server_worker.default]][T#3], state=RUNNABLE, group=TGRP-IndexLifecycleManagerIntegTests]\r\n22:12:43   2>         at java.base@10/sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)\r\n22:12:43    > \tat org.elasticsearch.test.ESIntegTestCase.setupTestCluster(ESIntegTestCase.java:2067)\r\n22:12:43   2>         at java.base@10/sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:265)\r\n22:12:43    > \tat jdk.internal.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)\r\n22:12:43   2>         at java.base@10/sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:92)\r\n22:12:43   2>         at java.base@10/sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:89)\r\n22:12:43    > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n22:12:43    > \tat java.base/java.lang.reflect.Method.invoke(Method.java:564)\r\n22:12:43    > \tat java.base/java.lang.Thread.run(Thread.java:844)\r\n22:12:43   2>         at java.base@10/sun.nio.ch.SelectorImpl.select(SelectorImpl.java:100)\r\n22:12:43    > Caused by: java.util.concurrent.ExecutionException: BindTransportException[Failed to bind to [30269]]; nested: BindException[Address already in use];\r\n22:12:43   2>         at app//io.netty.channel.nio.NioEventLoop.select(NioEventLoop.java:753)\r\n22:12:43   2>         at app//io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:409)\r\n22:12:43    > \tat java.base/java.util.concurrent.FutureTask.report(FutureTask.java:122)\r\n22:12:43   2>         at app//io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858)\r\n22:12:43    > \tat java.base/java.util.concurrent.FutureTask.get(FutureTask.java:191)\r\n22:12:43    > \tat org.elasticsearch.test.InternalTestCluster.startAndPublishNodesAndClients(InternalTestCluster.java:1370)\r\n22:12:43    > \t... 40 more\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}