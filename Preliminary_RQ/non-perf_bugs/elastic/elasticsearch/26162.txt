{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26162","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26162/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26162/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26162/events","html_url":"https://github.com/elastic/elasticsearch/issues/26162","id":249579368,"node_id":"MDU6SXNzdWUyNDk1NzkzNjg=","number":26162,"title":"Index created on 2.x causing \"unsupported_operation_exception\" in 5.x when used for sorting","user":{"login":"jakommo","id":6436143,"node_id":"MDQ6VXNlcjY0MzYxNDM=","avatar_url":"https://avatars2.githubusercontent.com/u/6436143?v=4","gravatar_id":"","url":"https://api.github.com/users/jakommo","html_url":"https://github.com/jakommo","followers_url":"https://api.github.com/users/jakommo/followers","following_url":"https://api.github.com/users/jakommo/following{/other_user}","gists_url":"https://api.github.com/users/jakommo/gists{/gist_id}","starred_url":"https://api.github.com/users/jakommo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakommo/subscriptions","organizations_url":"https://api.github.com/users/jakommo/orgs","repos_url":"https://api.github.com/users/jakommo/repos","events_url":"https://api.github.com/users/jakommo/events{/privacy}","received_events_url":"https://api.github.com/users/jakommo/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-08-11T09:17:19Z","updated_at":"2017-09-19T13:15:02Z","closed_at":"2017-09-19T13:15:02Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 5.5.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): Java 8 u131\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Ubuntu 16.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\n## Create index in 2.x (I used 2.3.4)\r\n\r\n```\r\nDELETE test1\r\nDELETE test2\r\n\r\nPUT test1\r\n{\r\n  \"mappings\": {\r\n    \"_default_\": {\r\n      \"properties\": {\r\n        \"testfield\": {\r\n          \"type\": \"string\", \"index\": \"not_analyzed\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPUT test2\r\n{\r\n  \"mappings\": {\r\n    \"_default_\": {\r\n      \"properties\": {\r\n        \"testfield\": {\r\n          \"type\": \"string\", \"index\": \"not_analyzed\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST test1/test\r\n{\r\n  \"testfield\": \"my test\"\r\n}\r\n\r\n# Don't index anything into test2\r\n\r\nPOST test*/_search\r\n{\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  },\r\n  \"sort\": [\r\n    {\r\n      \"testfield\": {\r\n        \"order\": \"asc\",\r\n        \"unmapped_type\": \"string\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n## Upgrade to 5.x (I used 5.5.0)\r\n\r\nThe query above, now results in: (Also if I change to \"unmapped_type\": \"keyword\")\r\n\r\n```\r\n{\r\n  \"took\": 19,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 10,\r\n    \"successful\": 5,\r\n    \"failed\": 5,\r\n    \"failures\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"test2\",\r\n        \"node\": \"JBHJ1HPYQbKMOxJ1hSotrw\",\r\n        \"reason\": {\r\n          \"type\": \"unsupported_operation_exception\",\r\n          \"reason\": null\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"hits\": {\r\n    \"total\": 1,\r\n    \"max_score\": null,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"test1\",\r\n        \"_type\": \"test\",\r\n        \"_id\": \"AV3Qh0G3rdu9hzgAfZn2\",\r\n        \"_score\": null,\r\n        \"_source\": {\r\n          \"testfield\": \"my test\"\r\n        },\r\n        \"sort\": [\r\n          \"my test\"\r\n        ]\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\nand is producing this stack trace:\r\n\r\n```\r\n[2017-08-11T11:13:16,153][DEBUG][o.e.a.s.TransportSearchAction] [JBHJ1HP] [test2][0], node[JBHJ1HPYQbKMOxJ1hSotrw], [P], s[STARTED], a[id=OCMZA_bHTA-cdS6nEHIBgA]: Failed to execute [SearchRequest{searchType=QUERY_THEN_FETCH, indices=[test*], indicesOptions=IndicesOptions[id=38, ignore_unavailable=false, allow_no_indices=true, expand_wildcards_open=true, expand_wildcards_closed=false, allow_alisases_to_multiple_indices=true, forbid_closed_indices=true], types=[], routing='null', preference='null', requestCache=null, scroll=null, source={\r\n  \"query\" : {\r\n    \"match_all\" : {\r\n      \"boost\" : 1.0\r\n    }\r\n  },\r\n  \"sort\" : [\r\n    {\r\n      \"testfield\" : {\r\n        \"order\" : \"asc\",\r\n        \"unmapped_type\" : \"keyword\"\r\n      }\r\n    }\r\n  ]\r\n}}] lastShard [true]\r\norg.elasticsearch.transport.RemoteTransportException: [JBHJ1HP][127.0.0.1:9300][indices:data/read/search[phase/query]]\r\nCaused by: java.lang.UnsupportedOperationException\r\n\tat java.util.AbstractMap.put(AbstractMap.java:209) ~[?:1.8.0_131]\r\n\tat org.elasticsearch.index.mapper.KeywordFieldMapper$TypeParser.parse(KeywordFieldMapper.java:152) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.index.mapper.MapperService.unmappedFieldType(MapperService.java:727) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.FieldSortBuilder.build(FieldSortBuilder.java:260) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.SortBuilder.buildSort(SortBuilder.java:156) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:630) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:481) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:457) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:253) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:330) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:327) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:644) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n[2017-08-11T11:13:16,155][DEBUG][o.e.a.s.TransportSearchAction] [JBHJ1HP] [test2][2], node[JBHJ1HPYQbKMOxJ1hSotrw], [P], s[STARTED], a[id=kkIHhfYIRf6vXlBlebIpgg]: Failed to execute [SearchRequest{searchType=QUERY_THEN_FETCH, indices=[test*], indicesOptions=IndicesOptions[id=38, ignore_unavailable=false, allow_no_indices=true, expand_wildcards_open=true, expand_wildcards_closed=false, allow_alisases_to_multiple_indices=true, forbid_closed_indices=true], types=[], routing='null', preference='null', requestCache=null, scroll=null, source={\r\n  \"query\" : {\r\n    \"match_all\" : {\r\n      \"boost\" : 1.0\r\n    }\r\n  },\r\n  \"sort\" : [\r\n    {\r\n      \"testfield\" : {\r\n        \"order\" : \"asc\",\r\n        \"unmapped_type\" : \"keyword\"\r\n      }\r\n    }\r\n  ]\r\n}}] lastShard [true]\r\norg.elasticsearch.transport.RemoteTransportException: [JBHJ1HP][127.0.0.1:9300][indices:data/read/search[phase/query]]\r\nCaused by: java.lang.UnsupportedOperationException\r\n\tat java.util.AbstractMap.put(AbstractMap.java:209) ~[?:1.8.0_131]\r\n\tat org.elasticsearch.index.mapper.KeywordFieldMapper$TypeParser.parse(KeywordFieldMapper.java:152) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.index.mapper.MapperService.unmappedFieldType(MapperService.java:727) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.FieldSortBuilder.build(FieldSortBuilder.java:260) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.SortBuilder.buildSort(SortBuilder.java:156) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:630) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:481) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:457) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:253) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:330) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:327) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:644) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n[2017-08-11T11:13:16,157][DEBUG][o.e.a.s.TransportSearchAction] [JBHJ1HP] [test2][3], node[JBHJ1HPYQbKMOxJ1hSotrw], [P], s[STARTED], a[id=GyLowxvgSeO8ZabUK13b4g]: Failed to execute [SearchRequest{searchType=QUERY_THEN_FETCH, indices=[test*], indicesOptions=IndicesOptions[id=38, ignore_unavailable=false, allow_no_indices=true, expand_wildcards_open=true, expand_wildcards_closed=false, allow_alisases_to_multiple_indices=true, forbid_closed_indices=true], types=[], routing='null', preference='null', requestCache=null, scroll=null, source={\r\n  \"query\" : {\r\n    \"match_all\" : {\r\n      \"boost\" : 1.0\r\n    }\r\n  },\r\n  \"sort\" : [\r\n    {\r\n      \"testfield\" : {\r\n        \"order\" : \"asc\",\r\n        \"unmapped_type\" : \"keyword\"\r\n      }\r\n    }\r\n  ]\r\n}}] lastShard [true]\r\norg.elasticsearch.transport.RemoteTransportException: [JBHJ1HP][127.0.0.1:9300][indices:data/read/search[phase/query]]\r\nCaused by: java.lang.UnsupportedOperationException\r\n\tat java.util.AbstractMap.put(AbstractMap.java:209) ~[?:1.8.0_131]\r\n\tat org.elasticsearch.index.mapper.KeywordFieldMapper$TypeParser.parse(KeywordFieldMapper.java:152) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.index.mapper.MapperService.unmappedFieldType(MapperService.java:727) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.FieldSortBuilder.build(FieldSortBuilder.java:260) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.SortBuilder.buildSort(SortBuilder.java:156) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:630) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:481) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:457) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:253) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:330) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:327) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:644) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n[2017-08-11T11:13:16,161][DEBUG][o.e.a.s.TransportSearchAction] [JBHJ1HP] [test2][1], node[JBHJ1HPYQbKMOxJ1hSotrw], [P], s[STARTED], a[id=WEeR_WDhSW-Uxkys3ChfQg]: Failed to execute [SearchRequest{searchType=QUERY_THEN_FETCH, indices=[test*], indicesOptions=IndicesOptions[id=38, ignore_unavailable=false, allow_no_indices=true, expand_wildcards_open=true, expand_wildcards_closed=false, allow_alisases_to_multiple_indices=true, forbid_closed_indices=true], types=[], routing='null', preference='null', requestCache=null, scroll=null, source={\r\n  \"query\" : {\r\n    \"match_all\" : {\r\n      \"boost\" : 1.0\r\n    }\r\n  },\r\n  \"sort\" : [\r\n    {\r\n      \"testfield\" : {\r\n        \"order\" : \"asc\",\r\n        \"unmapped_type\" : \"keyword\"\r\n      }\r\n    }\r\n  ]\r\n}}] lastShard [true]\r\norg.elasticsearch.transport.RemoteTransportException: [JBHJ1HP][127.0.0.1:9300][indices:data/read/search[phase/query]]\r\nCaused by: java.lang.UnsupportedOperationException\r\n\tat java.util.AbstractMap.put(AbstractMap.java:209) ~[?:1.8.0_131]\r\n\tat org.elasticsearch.index.mapper.KeywordFieldMapper$TypeParser.parse(KeywordFieldMapper.java:152) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.index.mapper.MapperService.unmappedFieldType(MapperService.java:727) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.FieldSortBuilder.build(FieldSortBuilder.java:260) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.SortBuilder.buildSort(SortBuilder.java:156) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:630) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:481) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:457) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:253) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:330) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:327) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:644) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n[2017-08-11T11:13:16,167][DEBUG][o.e.a.s.TransportSearchAction] [JBHJ1HP] [test2][4], node[JBHJ1HPYQbKMOxJ1hSotrw], [P], s[STARTED], a[id=ka-M_4BJStSmPorrvv2_Cw]: Failed to execute [SearchRequest{searchType=QUERY_THEN_FETCH, indices=[test*], indicesOptions=IndicesOptions[id=38, ignore_unavailable=false, allow_no_indices=true, expand_wildcards_open=true, expand_wildcards_closed=false, allow_alisases_to_multiple_indices=true, forbid_closed_indices=true], types=[], routing='null', preference='null', requestCache=null, scroll=null, source={\r\n  \"query\" : {\r\n    \"match_all\" : {\r\n      \"boost\" : 1.0\r\n    }\r\n  },\r\n  \"sort\" : [\r\n    {\r\n      \"testfield\" : {\r\n        \"order\" : \"asc\",\r\n        \"unmapped_type\" : \"keyword\"\r\n      }\r\n    }\r\n  ]\r\n}}]\r\norg.elasticsearch.transport.RemoteTransportException: [JBHJ1HP][127.0.0.1:9300][indices:data/read/search[phase/query]]\r\nCaused by: java.lang.UnsupportedOperationException\r\n\tat java.util.AbstractMap.put(AbstractMap.java:209) ~[?:1.8.0_131]\r\n\tat org.elasticsearch.index.mapper.KeywordFieldMapper$TypeParser.parse(KeywordFieldMapper.java:152) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.index.mapper.MapperService.unmappedFieldType(MapperService.java:727) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.FieldSortBuilder.build(FieldSortBuilder.java:260) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.sort.SortBuilder.buildSort(SortBuilder.java:156) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:630) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:481) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:457) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:253) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:330) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.action.search.SearchTransportService$6.messageReceived(SearchTransportService.java:327) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:644) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.5.0.jar:5.5.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n\r\n```\r\n\r\nAs soon as I index a doc in `test2`, the error goes away and the query is working:\r\n\r\n```\r\nPOST test2/test\r\n{\r\n  \"testfield\": \"my test\"\r\n}\r\n\r\nPOST test*/_search\r\n{\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  },\r\n  \"sort\": [\r\n    {\r\n      \"testfield\": {\r\n        \"order\": \"asc\",\r\n        \"unmapped_type\": \"keyword\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n``` \r\nnow results in:\r\n\r\n```\r\n{\r\n  \"took\": 8,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 10,\r\n    \"successful\": 10,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 2,\r\n    \"max_score\": null,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"test1\",\r\n        \"_type\": \"test\",\r\n        \"_id\": \"AV3Qh0G3rdu9hzgAfZn2\",\r\n        \"_score\": null,\r\n        \"_source\": {\r\n          \"testfield\": \"my test\"\r\n        },\r\n        \"sort\": [\r\n          \"my test\"\r\n        ]\r\n      },\r\n      {\r\n        \"_index\": \"test2\",\r\n        \"_type\": \"test\",\r\n        \"_id\": \"AV3Qku9k6j_T2EVH4QtG\",\r\n        \"_score\": null,\r\n        \"_source\": {\r\n          \"testfield\": \"my test\"\r\n        },\r\n        \"sort\": [\r\n          \"my test\"\r\n        ]\r\n      }\r\n    ]\r\n  }\r\n}\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}