[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/521650216","html_url":"https://github.com/elastic/elasticsearch/issues/45610#issuecomment-521650216","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45610","id":521650216,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMTY1MDIxNg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-15T13:56:51Z","updated_at":"2019-08-15T13:56:51Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/526369185","html_url":"https://github.com/elastic/elasticsearch/issues/45610#issuecomment-526369185","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45610","id":526369185,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNjM2OTE4NQ==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-08-29T21:27:15Z","updated_at":"2019-08-29T21:27:15Z","author_association":"MEMBER","body":"@hendrikmuhs these timeouts that occur around `stop` seem similar to the ones that occurred when I was testing failure state race conditions. Though, I was able to periodically re-create the failure state race conditions. That race condition in particular had to do with another trigger occurring while the previous one was still in `doSaveState` and attempting to wrap up.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/526371979","html_url":"https://github.com/elastic/elasticsearch/issues/45610#issuecomment-526371979","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45610","id":526371979,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNjM3MTk3OQ==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-08-29T21:36:50Z","updated_at":"2019-08-29T21:36:50Z","author_association":"MEMBER","body":"I was able to reproduce it locally. Here are some logs (i turned on trace for async indexer and the task). Digging into it myself for a bit, but this should help if you start looking at this again before I do.\r\n```\r\n[2019-08-29T16:30:06,465][TRACE][o.e.x.d.t.DataFrameTransformPersistentTasksExecutor] [integTest-0] [pivot_continuous] No stats found(new transform), starting the task\r\n[2019-08-29T16:30:06,467][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] start called with force [false] and state [{\"task_state\":\"stopped\",\"indexer_state\":\"stopped\",\"checkpoint\":0}].\r\n[2019-08-29T16:30:06,467][INFO ][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] updating state for data frame transform to [{\"task_state\":\"started\",\"indexer_state\":\"stopped\",\"checkpoint\":0}].\r\n[2019-08-29T16:30:06,529][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] successfully updated state for data frame transform to [{\"task_state\":\"started\",\"indexer_state\":\"stopped\",\"checkpoint\":0}].\r\n[2019-08-29T16:30:06,533][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [data_frame/transforms/schedule_pivot_continuous] data frame indexer schedule has triggered, state: [STARTED].\r\n[2019-08-29T16:30:06,534][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Trigger initial run.\r\n[2019-08-29T16:30:06,535][DEBUG][o.e.x.c.i.AsyncTwoPhaseIndexer] [integTest-0] Schedule was triggered for job [pivot_continuous], state: [STARTED]\r\n[2019-08-29T16:30:06,536][DEBUG][o.e.x.c.i.AsyncTwoPhaseIndexer] [integTest-0] Beginning to index [pivot_continuous], state: [STARTED]\r\n[2019-08-29T16:30:06,540][INFO ][o.e.x.d.t.DataFrameTransformPersistentTasksExecutor] [integTest-0] Successfully completed and scheduled task in node operation\r\n[2019-08-29T16:30:06,547][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] successfully refreshed data frame transform config from index.\r\n[2019-08-29T16:30:06,688][TRACE][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] reset the progress from [null] to [{\r\n  \"docs_remaining\" : 1000,\r\n  \"total_docs\" : 1000,\r\n  \"percent_complete\" : 0.0,\r\n  \"docs_indexed\" : 0,\r\n  \"docs_processed\" : 0\r\n}].\r\n[2019-08-29T16:30:06,690][TRACE][o.e.x.d.t.DataFrameIndexer] [integTest-0] running full run query: {\"size\":0,\"query\":{\"bool\":{\"filter\":[{\"match_all\":{\"boost\":1.0}},{\"range\":{\"timestamp\":{\"from\":null,\"to\":1567113306557,\"include_lower\":true,\"include_upper\":false,\"format\":\"epoch_millis\",\"boost\":1.0}}}],\"adjust_pure_negative\":true,\"boost\":1.0}},\"aggregations\":{\"_data_frame\":{\"composite\":{\"size\":500,\"sources\":[{\"reviewer\":{\"terms\":{\"field\":\"user_id\",\"missing_bucket\":false,\"order\":\"asc\"}}}]},\"aggregations\":{\"avg_rating\":{\"avg\":{\"field\":\"stars\"}}}}}}\r\n[2019-08-29T16:30:06,767][TRACE][o.e.x.d.t.DataFrameIndexer] [integTest-0] running full run query: {\"size\":0,\"query\":{\"bool\":{\"filter\":[{\"match_all\":{\"boost\":1.0}},{\"range\":{\"timestamp\":{\"from\":null,\"to\":1567113306557,\"include_lower\":true,\"include_upper\":false,\"format\":\"epoch_millis\",\"boost\":1.0}}}],\"adjust_pure_negative\":true,\"boost\":1.0}},\"aggregations\":{\"_data_frame\":{\"composite\":{\"size\":500,\"sources\":[{\"reviewer\":{\"terms\":{\"field\":\"user_id\",\"missing_bucket\":false,\"order\":\"asc\"}}}],\"after\":{\"reviewer\":\"user_9\"}},\"aggregations\":{\"avg_rating\":{\"avg\":{\"field\":\"stars\"}}}}}}\r\n[2019-08-29T16:30:06,783][DEBUG][o.e.x.c.i.AsyncTwoPhaseIndexer] [integTest-0] Finished indexing for job [pivot_continuous], saving state and shutting down.\r\n[2019-08-29T16:30:06,788][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] finished indexing for data frame transform checkpoint [0].\r\n[2019-08-29T16:30:06,790][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] updating persistent state of transform to [{\"task_state\":\"started\",\"indexer_state\":\"started\",\"checkpoint\":1,\"progress\":{\"docs_remaining\":0,\"total_docs\":1000,\"percent_complete\":100.0,\"docs_indexed\":27,\"docs_processed\":1000}}].\r\n[2019-08-29T16:30:06,965][TRACE][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] deleted old transform stats and state document\r\n[2019-08-29T16:30:07,161][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_2], returning empty checkpoint\r\n[2019-08-29T16:30:07,161][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_1], returning empty checkpoint\r\n[2019-08-29T16:30:07,204][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_2], returning empty checkpoint\r\n[2019-08-29T16:30:07,204][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_1], returning empty checkpoint\r\n[2019-08-29T16:30:07,246][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_2], returning empty checkpoint\r\n[2019-08-29T16:30:07,246][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_1], returning empty checkpoint\r\n[2019-08-29T16:30:07,303][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_1], returning empty checkpoint\r\n[2019-08-29T16:30:07,306][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_2], returning empty checkpoint\r\n[2019-08-29T16:30:07,397][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_1], returning empty checkpoint\r\n[2019-08-29T16:30:07,398][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_2], returning empty checkpoint\r\n[2019-08-29T16:30:07,444][TRACE][o.e.x.d.p.DataFrameTransformsConfigManager] [integTest-0] found no checkpoint for transform [pivot_1], returning empty checkpoint\r\n[2019-08-29T16:30:07,542][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [data_frame/transforms/schedule_pivot_continuous] data frame indexer schedule has triggered, state: [STARTED].\r\n[2019-08-29T16:30:07,543][DEBUG][o.e.x.c.i.AsyncTwoPhaseIndexer] [integTest-0] Schedule was triggered for job [pivot_continuous], state: [STARTED]\r\n[2019-08-29T16:30:07,544][DEBUG][o.e.x.c.i.AsyncTwoPhaseIndexer] [integTest-0] Beginning to index [pivot_continuous], state: [STARTED]\r\n[2019-08-29T16:30:07,549][TRACE][o.e.x.d.c.TimeBasedCheckpointProvider] [integTest-0] query for changes based on time: {\"size\":0,\"query\":{\"bool\":{\"filter\":[{\"match_all\":{\"boost\":1.0}},{\"range\":{\"timestamp\":{\"from\":1567113306557,\"to\":1567113307549,\"include_lower\":true,\"include_upper\":false,\"format\":\"epoch_millis\",\"boost\":1.0}}}],\"adjust_pure_negative\":true,\"boost\":1.0}},\"track_total_hits\":1}\r\n[2019-08-29T16:30:07,557][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] stop called with force [false] and state [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"checkpoint\":1,\"progress\":{\"docs_remaining\":0,\"total_docs\":1000,\"percent_complete\":100.0,\"docs_indexed\":27,\"docs_processed\":1000}}]\r\n[2019-08-29T16:30:07,559][TRACE][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] change detected [false].\r\n[2019-08-29T16:30:07,561][INFO ][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] data frame transform has stopped.\r\n[2019-08-29T16:30:08,547][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:09,553][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:10,558][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:11,562][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:12,567][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:13,569][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:14,576][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:15,580][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:16,584][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:17,585][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:18,588][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:19,593][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:20,598][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:21,599][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:22,604][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:23,607][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:24,614][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:25,618][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:26,624][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:27,629][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:28,633][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:29,634][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:30,638][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:31,643][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:32,649][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:33,654][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:34,660][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:35,664][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:36,666][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [pivot_continuous] indexer for transform has state [STOPPED]. Ignoring trigger.\r\n[2019-08-29T16:30:37,562][WARN ][r.suppressed             ] [integTest-0] path: /_data_frame/transforms/pivot_continuous/_stop, params: {force=false, id=pivot_continuous, wait_for_completion=true}\r\njava.lang.IllegalStateException: Timed out when waiting for persistent tasks after 30s\r\n\tat org.elasticsearch.persistent.PersistentTasksService$2.onTimeout(PersistentTasksService.java:209) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onTimeout(ClusterStateObserver.java:325) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.onTimeout(ClusterStateObserver.java:252) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService$NotifyTimeout.run(ClusterApplierService.java:589) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:699) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/526376878","html_url":"https://github.com/elastic/elasticsearch/issues/45610#issuecomment-526376878","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45610","id":526376878,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNjM3Njg3OA==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-08-29T21:53:51Z","updated_at":"2019-08-29T22:05:41Z","author_association":"MEMBER","body":"I see the cause of the issue. \r\n\r\nTo avoid thread lock scenarios (which periodically occurred and caused havoc), we wait to determine if there are changes until `onStart` is called. This method is called when the indexer is set to `INDEXING`, and if no changes are found it calls back to https://github.com/benwtrent/elasticsearch/blob/27fab09ba242b5c0a0c24163f538c95be8ecfbd1/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/indexing/AsyncTwoPhaseIndexer.java#L161\r\n\r\nNormally this just quickly toggles the indexer between `INDEXING` and `STARTED`.\r\n\r\nBut, between that check and the call back to the `AsyncTwoPhaseIndexer`, `stop` was called. Since the indexer was set to `INDEXING` at the time, it was transitioned to `STOPPING` and `doSaveState` was never called with the indexer set to `STOPPED`. \r\n\r\nTo fix this we need call `doSaveState` if `AsyncTwoPhaseIndexer` transitions between `STOPPING -> STOPPED` when we don't find any changes.\r\n\r\nIf we DID discover changes, its ok as eventually `checkState` is called and transitions it to `STOPPED` with a call against `doSaveState`. ","performed_via_github_app":null}]