[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/379934742","html_url":"https://github.com/elastic/elasticsearch/issues/29436#issuecomment-379934742","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","id":379934742,"node_id":"MDEyOklzc3VlQ29tbWVudDM3OTkzNDc0Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T00:23:31Z","updated_at":"2018-04-10T00:23:31Z","author_association":"MEMBER","body":"This behavior is by design. Today, recovery sources from the primary shard, and the act of moving a shard triggers a recovery to the target shard. The reason that recovery takes place from the primary shard is because recovery has to be coordinated carefully with replication to ensure that the newly recovered target shard does not miss any operations (there is a moment when the shard is flipped to being a replication target and we have to ensure that all operations before that moment arrive on the replica (via recovery) and all operations after that moment arrive on the replica (via replication). As replication is driven by the primary, this dictates that the source of the recovery is the primary shard. Trying to do this coordination across three nodes (an existing replica copy, the primary, and the target) sounds fraught with peril and we are unlikely to invest effort in this at this time.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/379951762","html_url":"https://github.com/elastic/elasticsearch/issues/29436#issuecomment-379951762","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","id":379951762,"node_id":"MDEyOklzc3VlQ29tbWVudDM3OTk1MTc2Mg==","user":{"login":"klahnakoski","id":2334429,"node_id":"MDQ6VXNlcjIzMzQ0Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/2334429?v=4","gravatar_id":"","url":"https://api.github.com/users/klahnakoski","html_url":"https://github.com/klahnakoski","followers_url":"https://api.github.com/users/klahnakoski/followers","following_url":"https://api.github.com/users/klahnakoski/following{/other_user}","gists_url":"https://api.github.com/users/klahnakoski/gists{/gist_id}","starred_url":"https://api.github.com/users/klahnakoski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klahnakoski/subscriptions","organizations_url":"https://api.github.com/users/klahnakoski/orgs","repos_url":"https://api.github.com/users/klahnakoski/repos","events_url":"https://api.github.com/users/klahnakoski/events{/privacy}","received_events_url":"https://api.github.com/users/klahnakoski/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T02:15:28Z","updated_at":"2018-04-10T02:15:28Z","author_association":"NONE","body":"I can appreciate this design decision. Unfortunately, I used Elasticsearch's historical super-speed-but-lack-of-ACID-compliance as a feature. The consequences are that shard recovery and movement is now 10x or 20x slower than it used to be. Moving the many terabytes of data goes from about-a-day to many-weeks.\r\n\r\nMay you point me to the decision code?  I must patch it locally, I guess. \r\n\r\nThank you\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/379953398","html_url":"https://github.com/elastic/elasticsearch/issues/29436#issuecomment-379953398","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","id":379953398,"node_id":"MDEyOklzc3VlQ29tbWVudDM3OTk1MzM5OA==","user":{"login":"klahnakoski","id":2334429,"node_id":"MDQ6VXNlcjIzMzQ0Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/2334429?v=4","gravatar_id":"","url":"https://api.github.com/users/klahnakoski","html_url":"https://github.com/klahnakoski","followers_url":"https://api.github.com/users/klahnakoski/followers","following_url":"https://api.github.com/users/klahnakoski/following{/other_user}","gists_url":"https://api.github.com/users/klahnakoski/gists{/gist_id}","starred_url":"https://api.github.com/users/klahnakoski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klahnakoski/subscriptions","organizations_url":"https://api.github.com/users/klahnakoski/orgs","repos_url":"https://api.github.com/users/klahnakoski/repos","events_url":"https://api.github.com/users/klahnakoski/events{/privacy}","received_events_url":"https://api.github.com/users/klahnakoski/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T02:26:21Z","updated_at":"2018-04-10T02:26:21Z","author_association":"NONE","body":"There is a small hope someone may be fixing this? https://github.com/elastic/elasticsearch/issues/8369\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/379954044","html_url":"https://github.com/elastic/elasticsearch/issues/29436#issuecomment-379954044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","id":379954044,"node_id":"MDEyOklzc3VlQ29tbWVudDM3OTk1NDA0NA==","user":{"login":"klahnakoski","id":2334429,"node_id":"MDQ6VXNlcjIzMzQ0Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/2334429?v=4","gravatar_id":"","url":"https://api.github.com/users/klahnakoski","html_url":"https://github.com/klahnakoski","followers_url":"https://api.github.com/users/klahnakoski/followers","following_url":"https://api.github.com/users/klahnakoski/following{/other_user}","gists_url":"https://api.github.com/users/klahnakoski/gists{/gist_id}","starred_url":"https://api.github.com/users/klahnakoski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klahnakoski/subscriptions","organizations_url":"https://api.github.com/users/klahnakoski/orgs","repos_url":"https://api.github.com/users/klahnakoski/repos","events_url":"https://api.github.com/users/klahnakoski/events{/privacy}","received_events_url":"https://api.github.com/users/klahnakoski/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T02:30:38Z","updated_at":"2018-04-10T02:30:38Z","author_association":"NONE","body":"Here is a better description of my problem: https://github.com/elastic/elasticsearch/issues/12279","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/379955046","html_url":"https://github.com/elastic/elasticsearch/issues/29436#issuecomment-379955046","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","id":379955046,"node_id":"MDEyOklzc3VlQ29tbWVudDM3OTk1NTA0Ng==","user":{"login":"klahnakoski","id":2334429,"node_id":"MDQ6VXNlcjIzMzQ0Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/2334429?v=4","gravatar_id":"","url":"https://api.github.com/users/klahnakoski","html_url":"https://github.com/klahnakoski","followers_url":"https://api.github.com/users/klahnakoski/followers","following_url":"https://api.github.com/users/klahnakoski/following{/other_user}","gists_url":"https://api.github.com/users/klahnakoski/gists{/gist_id}","starred_url":"https://api.github.com/users/klahnakoski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klahnakoski/subscriptions","organizations_url":"https://api.github.com/users/klahnakoski/orgs","repos_url":"https://api.github.com/users/klahnakoski/repos","events_url":"https://api.github.com/users/klahnakoski/events{/privacy}","received_events_url":"https://api.github.com/users/klahnakoski/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T02:37:08Z","updated_at":"2018-04-10T02:37:08Z","author_association":"NONE","body":"Another example https://github.com/elastic/elasticsearch/issues/29437","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/379960973","html_url":"https://github.com/elastic/elasticsearch/issues/29436#issuecomment-379960973","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","id":379960973,"node_id":"MDEyOklzc3VlQ29tbWVudDM3OTk2MDk3Mw==","user":{"login":"klahnakoski","id":2334429,"node_id":"MDQ6VXNlcjIzMzQ0Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/2334429?v=4","gravatar_id":"","url":"https://api.github.com/users/klahnakoski","html_url":"https://github.com/klahnakoski","followers_url":"https://api.github.com/users/klahnakoski/followers","following_url":"https://api.github.com/users/klahnakoski/following{/other_user}","gists_url":"https://api.github.com/users/klahnakoski/gists{/gist_id}","starred_url":"https://api.github.com/users/klahnakoski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klahnakoski/subscriptions","organizations_url":"https://api.github.com/users/klahnakoski/orgs","repos_url":"https://api.github.com/users/klahnakoski/repos","events_url":"https://api.github.com/users/klahnakoski/events{/privacy}","received_events_url":"https://api.github.com/users/klahnakoski/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T03:18:37Z","updated_at":"2018-04-10T03:24:54Z","author_association":"NONE","body":"<strike>Looked through some code, maybe the decision point is here: https://github.com/elastic/elasticsearch/blob/ec657109267e801024c90d144dc84ec58bd3aa1c/server/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java#L487\r\n\r\nI will look more tomorrow.</strike>\r\n\r\nBah!  Blame seems to indicate that check is for something else. I am too tired.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/380051126","html_url":"https://github.com/elastic/elasticsearch/issues/29436#issuecomment-380051126","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","id":380051126,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MDA1MTEyNg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T10:25:58Z","updated_at":"2018-04-10T10:25:58Z","author_association":"MEMBER","body":"> I can appreciate this design decision. Unfortunately, I used Elasticsearch's historical super-speed-but-lack-of-ACID-compliance as a feature. The consequences are that shard recovery and movement is now 10x or 20x slower than it used to be.\r\n\r\nThis behavior is as old as time and have never been different. I suggest you open a topic on discuss.elastic.co and we can help figure out what exactly has caused this change.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/380054319","html_url":"https://github.com/elastic/elasticsearch/issues/29436#issuecomment-380054319","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29436","id":380054319,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MDA1NDMxOQ==","user":{"login":"klahnakoski","id":2334429,"node_id":"MDQ6VXNlcjIzMzQ0Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/2334429?v=4","gravatar_id":"","url":"https://api.github.com/users/klahnakoski","html_url":"https://github.com/klahnakoski","followers_url":"https://api.github.com/users/klahnakoski/followers","following_url":"https://api.github.com/users/klahnakoski/following{/other_user}","gists_url":"https://api.github.com/users/klahnakoski/gists{/gist_id}","starred_url":"https://api.github.com/users/klahnakoski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klahnakoski/subscriptions","organizations_url":"https://api.github.com/users/klahnakoski/orgs","repos_url":"https://api.github.com/users/klahnakoski/repos","events_url":"https://api.github.com/users/klahnakoski/events{/privacy}","received_events_url":"https://api.github.com/users/klahnakoski/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T10:38:53Z","updated_at":"2018-04-10T10:38:53Z","author_association":"NONE","body":"> This behavior is as old as time and have never been different. I suggest you open a topic on discuss.elastic.co and we can help figure out what exactly has caused this change.\r\n\r\n@bleskes, Elasticsearch version 1.7 does not have this problem. Also, I am not sure what change you are referring to when you say \"figure out what exactly has caused this change\".  It has recently become an issue as we upgrade our clusters.  I started a discussion on this topic already: https://discuss.elastic.co/t/moving-shards-is-slow/127363","performed_via_github_app":null}]