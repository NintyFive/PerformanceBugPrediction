{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53219","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53219/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53219/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53219/events","html_url":"https://github.com/elastic/elasticsearch/issues/53219","id":576857767,"node_id":"MDU6SXNzdWU1NzY4NTc3Njc=","number":53219,"title":"[ML] Add an estimate model memory endpoint for anomaly detection","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"assignees":[{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-03-06T11:02:00Z","updated_at":"2020-03-24T21:38:20Z","closed_at":"2020-03-24T21:38:20Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"At present the ML UI has functionality to calculate a rough estimate of the model memory requirement for certain types of anomaly detection jobs.  However, it doesn't cover all detector functions and doesn't cover population jobs.\r\n\r\nThe ML API in Elasticsearch should provide an endpoint that encapsulates the various formulas, can be extended to cover all possible configurations, and can be kept up to date when model sizes change.\r\n\r\nThe inputs to this endpoint will be:\r\n\r\n1. An `analysis_config`, in the same format as would be provided to the create job endpoint - documented in https://www.elastic.co/guide/en/elasticsearch/reference/current/ml-put-job.html#ml-put-job-path-parms\r\n2. Overall cardinalities for the `by`, `over` and `partition` fields\r\n3. Max bucket cardinalities for `influencer` fields that are not also `by`, `over` or `partition` fields\r\n\r\nAn example of the proposed request format is:\r\n\r\n```\r\nPOST _ml/anomaly_detectors/_estimate_model_memory\r\n{\r\n  \"analysis_config\": {\r\n    \"bucket_span\": \"10m\",\r\n    \"detectors\": [\r\n      {\r\n        \"function\": \"sum\",\r\n        \"field_name\": \"bytes\",\r\n        \"partition_field_name\": \"src_ip\"\r\n      }\r\n    ],\r\n    \"influencers\": [ \"src_ip\", \"dest_ip\" ]\r\n  },\r\n  \"overall_cardinality\": {\r\n    \"src_ip\": 567483\r\n  },\r\n  \"max_bucket_cardinality\": {\r\n    \"dest_ip\": 7456\r\n  }\r\n}\r\n```\r\n\r\nAn example of the proposed response format is:\r\n\r\n```\r\n{\r\n  \"model_memory_estimate\": \"836mb\"\r\n}\r\n```","closed_by":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"performed_via_github_app":null}