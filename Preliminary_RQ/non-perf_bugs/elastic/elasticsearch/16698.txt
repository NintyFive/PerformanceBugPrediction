{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16698","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16698/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16698/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16698/events","html_url":"https://github.com/elastic/elasticsearch/issues/16698","id":134230313,"node_id":"MDU6SXNzdWUxMzQyMzAzMTM=","number":16698,"title":"Index template create problem with logstash 2.1.1","user":{"login":"paltryeffort","id":5689739,"node_id":"MDQ6VXNlcjU2ODk3Mzk=","avatar_url":"https://avatars0.githubusercontent.com/u/5689739?v=4","gravatar_id":"","url":"https://api.github.com/users/paltryeffort","html_url":"https://github.com/paltryeffort","followers_url":"https://api.github.com/users/paltryeffort/followers","following_url":"https://api.github.com/users/paltryeffort/following{/other_user}","gists_url":"https://api.github.com/users/paltryeffort/gists{/gist_id}","starred_url":"https://api.github.com/users/paltryeffort/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paltryeffort/subscriptions","organizations_url":"https://api.github.com/users/paltryeffort/orgs","repos_url":"https://api.github.com/users/paltryeffort/repos","events_url":"https://api.github.com/users/paltryeffort/events{/privacy}","received_events_url":"https://api.github.com/users/paltryeffort/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-02-17T09:42:58Z","updated_at":"2018-02-13T20:39:51Z","closed_at":"2016-02-28T23:32:50Z","author_association":"NONE","active_lock_reason":null,"body":"I am trying to upgrade from logstash 1.4.2 to logstash 2.1.1 and I have a problem when a new index gets created. I tried to reduce all configs to the minimum and now I have the following:\n\nThe most important piece is my index_template.json:\n\n```\n{\n  \"template\" : \"logstash-*\",\n  \"settings\" : {\n    \"index.refresh_interval\" : \"5s\",\n    \"index.number_of_shards\" : 5,\n    \"index.number_of_replicas\" : 1\n  },\n  \"mappings\" : {\n    \"_default_\" : {\n       \"_all\" : {\"enabled\" : true},\n       \"dynamic_templates\" : [ {\n         \"string_fields\" : {\n           \"match\" : \"*\",\n           \"match_mapping_type\" : \"string\",\n           \"mapping\" : {\n             \"type\" : \"string\", \"index\" : \"analyzed\", \"omit_norms\" : true,\n               \"fields\" : {\n                 \"raw\" : {\"type\": \"string\", \"index\" : \"not_analyzed\", \"ignore_above\" : 256}\n               }\n           }\n         }\n       } ],\n       \"properties\" : {\n         \"@version\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n         \"receive_time\" : {\n           \"type\" : \"string\"\n         }\n       }\n    }\n  }\n}\n```\n\nI am forcing the \"receive_time\" to be a string. However with logstash 2.1.1 this field is _sometimes_ a \"string\" and _sometimes_ a \"date\"\n\nMy logstash config:\n\n```\ninput {\n    file {\n        path => \"/tmp/logfile\"\n        sincedb_path => \"/tmp/logfile.sincedb\"\n        start_position => \"end\"\n    }\n}\nfilter {\n   mutate {\n       #copy timestamp. In the index_template this field is forced to be a \"string\"\n       add_field => [ \"receive_time\", \"%{@timestamp}\" ]\n   }\n}\noutput {\n        elasticsearch {\n          hosts => [ \"elasticsearch:9200\" ]\n          flush_size => 100\n          workers => 2\n          template => \"index_template.json\"\n          template_overwrite => true\n        }\n}\n```\n\nHow to reproduce:\n- install elasticsearch 1.5.1 e.g. \"docker pull elasticsearch:1.5.1\" and run it\n- run logstash 2.1.1 with the above mentioned config and index_template\n- create log entries:\n  for i in $(seq 1000); do echo \"line number $i\"; done >>/tmp/logfile\n\nNow check the type of the field \"receive_time\". This should be a string.\n- stop elasticsearch and delete all data (e.g. remove the container and create a new one)\n- repeat creating log entries\n\nCheck the type of the field \"receive_time\". Now this field is of type \"date\".\n\nIf you do the same steps with logstash 1.4.2 this never happens. Maybe because \"receive_time\" is always a string in this version.\n\nObviously I don't delete all my elasticsearch data daily. In my stage environment this happens when a new index gets created. Sometimes it is a \"string\" and sometimes it's a \"date\". In the latter case I get errors in elasticsearch like this:\n\n```\norg.elasticsearch.index.mapper.MapperParsingException: failed to parse [receive_time]\nCaused by: org.elasticsearch.index.mapper.MapperParsingException: failed to parse date field [2016-02-03 12:40:32 +0100], tried both date format [dateOptionalTime], and timestamp number with locale []\nCaused by: java.lang.IllegalArgumentException: Invalid format: \"2016-02-03 12:40:32 +0100\" is malformed at \" 12:40:32 +0100\"\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}