{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25754","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25754/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25754/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25754/events","html_url":"https://github.com/elastic/elasticsearch/issues/25754","id":243435446,"node_id":"MDU6SXNzdWUyNDM0MzU0NDY=","number":25754,"title":"ES S3 Snapshot : \"indices\" parameter ignored","user":{"login":"jayannah","id":4325281,"node_id":"MDQ6VXNlcjQzMjUyODE=","avatar_url":"https://avatars0.githubusercontent.com/u/4325281?v=4","gravatar_id":"","url":"https://api.github.com/users/jayannah","html_url":"https://github.com/jayannah","followers_url":"https://api.github.com/users/jayannah/followers","following_url":"https://api.github.com/users/jayannah/following{/other_user}","gists_url":"https://api.github.com/users/jayannah/gists{/gist_id}","starred_url":"https://api.github.com/users/jayannah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jayannah/subscriptions","organizations_url":"https://api.github.com/users/jayannah/orgs","repos_url":"https://api.github.com/users/jayannah/repos","events_url":"https://api.github.com/users/jayannah/events{/privacy}","received_events_url":"https://api.github.com/users/jayannah/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":73544,"node_id":"MDU6TGFiZWw3MzU0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Enon-issue","name":">non-issue","color":"cfcfcf","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-07-17T15:32:15Z","updated_at":"2018-02-14T13:55:56Z","closed_at":"2017-07-19T18:13:46Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\nWe have several application logs in our cluster with some prefix to differentiate different application data.  We would like to take snapshot of only few applications data which are critical using their name prefixed to indicate the application type..\r\n\r\nSo as per this URL https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-snapshots.html#_snapshot , we shall pass the index names in \"indices\" parameter in the s3-repository.\r\n\r\nCurrent in this POC environment, we have some indices with e-xxx, w-xxx & internal indices.\r\n\r\nCurrently we are testing to take snapshot of indices which are prefixed with w-* .\r\n\r\nBut, the indices field value is ignore and it is taking snapshot of all indices.. That is not the expected behavior. \r\n\r\n**Elasticsearch version**: 5.4.0\r\n\r\n**Plugins installed**: S3-repositor, x-pack\r\n\r\n**JVM version** (`java -version`): 1.8.73\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):   3.13.0-119-generic #166-Ubuntu SMP Wed May 3 12:18:55 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWe have index name in ES cluster few prefixed with e- , few with w- and the internal indices. E.g:\r\ne-perflog-<date>, w-perflog-<date>.. \r\n\r\n\r\n**Steps to reproduce**:\r\n 1. Create the s3 repository with \"indices\" parameter to take snapshot of few indices only..\r\n 2. Initiate the snapshot\r\n\r\nObserve that the output of snapshot is indicating it has taken snapshot of all indices, not just names or pattern mentioned in the \"indices\" parameter in the s3 repository registration.\r\n\r\nPUT /_snapshot/emmo_esdata_sandbox_region_westv2\r\n{\r\n  \"type\": \"s3\",\r\n  \"settings\": {\r\n    \"bucket\": \"emmo-elk-eastwest-backup-data-test\",\r\n    \"region\": \"us-east\",\r\n    \"base_path\": \"west_sandbox_backup_v2\",\r\n    \"server_side_encryption\": true,\r\n    \"indices\" : \"w-*\"\r\n  }\r\n}\r\nGET /_cat/snapshots/emmo_esdata_sandbox_region_westv2?v\r\nPUT /_snapshot/emmo_esdata_sandbox_region_westv2/snapshot_07172017v2?wait_for_completion=true\r\n\r\n{\r\n   \"snapshot\": {\r\n      \"snapshot\": \"snapshot_07172017v2\",\r\n      \"uuid\": \"WACdcTk2RWqDORnNH-MwXA\",\r\n      \"version_id\": 5040099,\r\n      \"version\": \"5.4.0\",\r\n      \"indices\": [\r\n         \"w-testing-2017.07.17\",\r\n         \".monitoring-kibana-2-2017.07.15\",\r\n         \"e-testing-2017.07.11\",\r\n         \"w-testing-2017.06.28\",\r\n         \"e-testing-2017.07.07\",\r\n         \".watches\",\r\n         \"e-testing-2017.06.30\",\r\n         \".watcher-history-3-2017.06.26\",\r\n         \"w-testing-2017.07.06\",\r\n         \".monitoring-kibana-2-2017.07.14\",\r\n         \".watcher-history-3-2017.07.17\",\r\n         \"w-testing-2017.06.29\",\r\n         \"w-testing-2017.07.02\",\r\n         \".watcher-history-3-2017.06.27\",\r\n         \".monitoring-kibana-2-2017.07.16\",\r\n         \"w-testing-2017.07.11\",\r\n         \"w-eapi_cloud-2017.06.27\",\r\n         \".monitoring-es-2-2017.07.16\",\r\n         \".watcher-history-3-2017.07.06\",\r\n...\r\n..\r\n..\r\n      ],\r\n      \"state\": \"SUCCESS\",\r\n      \"start_time\": \"2017-07-17T15:22:53.002Z\",\r\n      \"start_time_in_millis\": 1500304973002,\r\n      \"end_time\": \"2017-07-17T15:23:25.497Z\",\r\n      \"end_time_in_millis\": 1500305005497,\r\n      \"duration_in_millis\": 32495,\r\n      \"failures\": [],\r\n      \"shards\": {\r\n         \"total\": 261,\r\n         \"failed\": 0,\r\n         \"successful\": 261\r\n      }\r\n   }\r\n}\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n\r\n","closed_by":{"login":"jayannah","id":4325281,"node_id":"MDQ6VXNlcjQzMjUyODE=","avatar_url":"https://avatars0.githubusercontent.com/u/4325281?v=4","gravatar_id":"","url":"https://api.github.com/users/jayannah","html_url":"https://github.com/jayannah","followers_url":"https://api.github.com/users/jayannah/followers","following_url":"https://api.github.com/users/jayannah/following{/other_user}","gists_url":"https://api.github.com/users/jayannah/gists{/gist_id}","starred_url":"https://api.github.com/users/jayannah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jayannah/subscriptions","organizations_url":"https://api.github.com/users/jayannah/orgs","repos_url":"https://api.github.com/users/jayannah/repos","events_url":"https://api.github.com/users/jayannah/events{/privacy}","received_events_url":"https://api.github.com/users/jayannah/received_events","type":"User","site_admin":false},"performed_via_github_app":null}