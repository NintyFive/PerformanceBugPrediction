[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52709309","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52709309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52709309,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzA5MzA5","user":{"login":"OlegYch","id":268312,"node_id":"MDQ6VXNlcjI2ODMxMg==","avatar_url":"https://avatars1.githubusercontent.com/u/268312?v=4","gravatar_id":"","url":"https://api.github.com/users/OlegYch","html_url":"https://github.com/OlegYch","followers_url":"https://api.github.com/users/OlegYch/followers","following_url":"https://api.github.com/users/OlegYch/following{/other_user}","gists_url":"https://api.github.com/users/OlegYch/gists{/gist_id}","starred_url":"https://api.github.com/users/OlegYch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OlegYch/subscriptions","organizations_url":"https://api.github.com/users/OlegYch/orgs","repos_url":"https://api.github.com/users/OlegYch/repos","events_url":"https://api.github.com/users/OlegYch/events{/privacy}","received_events_url":"https://api.github.com/users/OlegYch/received_events","type":"User","site_admin":false},"created_at":"2014-08-19T22:31:13Z","updated_at":"2014-08-19T22:31:13Z","author_association":"NONE","body":"CheckIndex reports no errors\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52709559","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52709559","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52709559,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzA5NTU5","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-08-19T22:33:26Z","updated_at":"2014-08-19T22:33:26Z","author_association":"MEMBER","body":"@OlegYch can you double check that the directory `/home/shared_dir/indices/` exists and points to the same location on all nodes?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52710625","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52710625","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52710625,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzEwNjI1","user":{"login":"OlegYch","id":268312,"node_id":"MDQ6VXNlcjI2ODMxMg==","avatar_url":"https://avatars1.githubusercontent.com/u/268312?v=4","gravatar_id":"","url":"https://api.github.com/users/OlegYch","html_url":"https://github.com/OlegYch","followers_url":"https://api.github.com/users/OlegYch/followers","following_url":"https://api.github.com/users/OlegYch/following{/other_user}","gists_url":"https://api.github.com/users/OlegYch/gists{/gist_id}","starred_url":"https://api.github.com/users/OlegYch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OlegYch/subscriptions","organizations_url":"https://api.github.com/users/OlegYch/orgs","repos_url":"https://api.github.com/users/OlegYch/repos","events_url":"https://api.github.com/users/OlegYch/events{/privacy}","received_events_url":"https://api.github.com/users/OlegYch/received_events","type":"User","site_admin":false},"created_at":"2014-08-19T22:41:59Z","updated_at":"2014-08-19T22:41:59Z","author_association":"NONE","body":"yep, just did and they are all there, and restore worked except for the failed shards \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52711207","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52711207","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52711207,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzExMjA3","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-08-19T22:46:36Z","updated_at":"2014-08-19T22:46:36Z","author_association":"MEMBER","body":"Can you send me logs from the node where these shards failed?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52714709","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52714709","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52714709,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzE0NzA5","user":{"login":"OlegYch","id":268312,"node_id":"MDQ6VXNlcjI2ODMxMg==","avatar_url":"https://avatars1.githubusercontent.com/u/268312?v=4","gravatar_id":"","url":"https://api.github.com/users/OlegYch","html_url":"https://github.com/OlegYch","followers_url":"https://api.github.com/users/OlegYch/followers","following_url":"https://api.github.com/users/OlegYch/following{/other_user}","gists_url":"https://api.github.com/users/OlegYch/gists{/gist_id}","starred_url":"https://api.github.com/users/OlegYch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OlegYch/subscriptions","organizations_url":"https://api.github.com/users/OlegYch/orgs","repos_url":"https://api.github.com/users/OlegYch/repos","events_url":"https://api.github.com/users/OlegYch/events{/privacy}","received_events_url":"https://api.github.com/users/OlegYch/received_events","type":"User","site_admin":false},"created_at":"2014-08-19T23:28:16Z","updated_at":"2014-08-19T23:28:16Z","author_association":"NONE","body":"the exceptions in the log are all like this (the full log is bloated with unrelated stuff):\n\n```\n[2014-08-19 22:57:34,967][WARN ][snapshots                ] [redacted] [[my_idx_redacted_7][10]] [prod:2014-08-19-22-55-04] failed to create snapshot\norg.elasticsearch.index.snapshots.IndexShardSnapshotFailedException: [my_idx_redacted_7][10] Failed to perform snapshot (index files)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$SnapshotContext.snapshot(BlobStoreIndexShardRepository.java:489)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository.snapshot(BlobStoreIndexShardRepository.java:131)\n        at org.elasticsearch.index.snapshots.IndexShardSnapshotAndRestoreService.snapshot(IndexShardSnapshotAndRestoreService.java:86)\n        at org.elasticsearch.snapshots.SnapshotsService$6.run(SnapshotsService.java:829)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\nCaused by: java.io.FileNotFoundException: /home/shared_dir/indices/my_idx_redacted_7/10/__1 (No such file or directory)\n        at java.io.RandomAccessFile.open(Native Method)\n        at java.io.RandomAccessFile.<init>(RandomAccessFile.java:241)\n        at org.elasticsearch.common.blobstore.fs.FsImmutableBlobContainer$1.run(FsImmutableBlobContainer.java:50)\n        ... 3 more\n```\n\nsuspiciously only two out of 6 nodes have failures and on those nodes it looks like all of shards have failed to snapshot\nes and nfs have exactly the same configuration on all nodes in the cluster though, and overall the configuration is pretty much identical..\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52716005","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52716005","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52716005,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzE2MDA1","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-08-19T23:45:39Z","updated_at":"2014-08-19T23:45:39Z","author_association":"MEMBER","body":"If there is nothing else in the logs, the only scenario that I can think of that would lead to this failure is if during the snapshot process this nfs mount was somehow unavailable on these two nodes and it became available afterwards when you checked. Is this mount accessible to the user that elasticsearch is running under?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52718540","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52718540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52718540,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzE4NTQw","user":{"login":"OlegYch","id":268312,"node_id":"MDQ6VXNlcjI2ODMxMg==","avatar_url":"https://avatars1.githubusercontent.com/u/268312?v=4","gravatar_id":"","url":"https://api.github.com/users/OlegYch","html_url":"https://github.com/OlegYch","followers_url":"https://api.github.com/users/OlegYch/followers","following_url":"https://api.github.com/users/OlegYch/following{/other_user}","gists_url":"https://api.github.com/users/OlegYch/gists{/gist_id}","starred_url":"https://api.github.com/users/OlegYch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OlegYch/subscriptions","organizations_url":"https://api.github.com/users/OlegYch/orgs","repos_url":"https://api.github.com/users/OlegYch/repos","events_url":"https://api.github.com/users/OlegYch/events{/privacy}","received_events_url":"https://api.github.com/users/OlegYch/received_events","type":"User","site_admin":false},"created_at":"2014-08-20T00:16:38Z","updated_at":"2014-08-20T00:16:38Z","author_association":"NONE","body":"indeed\n\n```\nsudo -u elasticsearch touch /home/shared_dir/hello\n```\n\nfails on those nodes with Permission denied\nand 'id elasticsearch' reports different values even though ls -la reports that the directory is owned by the same user...\nany idea how to make the snapshot under those circumstances ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52718931","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52718931","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52718931,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzE4OTMx","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-08-20T00:20:25Z","updated_at":"2014-08-20T00:20:25Z","author_association":"MEMBER","body":"The snapshot directory has to be writable from all data nodes that contain primary shards of the indices that are getting snapshotted. So, I think fixing the permission issue would be the way to go.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52798178","html_url":"https://github.com/elastic/elasticsearch/issues/7344#issuecomment-52798178","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7344","id":52798178,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNzk4MTc4","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-08-20T15:50:19Z","updated_at":"2014-08-20T15:50:19Z","author_association":"MEMBER","body":"Since this particular issue was caused by incorrect permission settings, I am going to close it. In general, we are planning to address the confusion that this issue caused by adding repository validation as part of #7096. It should simplify troubleshooting of issues like this. \n","performed_via_github_app":null}]