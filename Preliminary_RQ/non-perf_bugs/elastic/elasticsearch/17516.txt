{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17516","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17516/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17516/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17516/events","html_url":"https://github.com/elastic/elasticsearch/issues/17516","id":145759763,"node_id":"MDU6SXNzdWUxNDU3NTk3NjM=","number":17516,"title":"NullPointerException in moving average agg when window isn't specified","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-04-04T18:04:55Z","updated_at":"2016-04-06T14:57:08Z","closed_at":"2016-04-06T14:57:08Z","author_association":"MEMBER","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: master\n\n**JVM version**: 1.8.0_74\n\n**OS version**: Win 10\n\n**Description of the problem including expected versus actual behavior**:\n\nMoving average throws a NPE when the optional `window` parameter isn't specified.\n\n**Steps to reproduce**:\n\n```\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"projects_started_per_month\": {\n      \"date_histogram\": {\n        \"field\": \"startedOn\",\n        \"interval\": \"month\"\n      },\n      \"aggs\": {\n        \"commits\": {\n          \"sum\": {\n            \"field\": \"numberOfCommits\"\n          }\n        },\n        \"commits_moving_avg\": {\n          \"moving_avg\": {\n            \"buckets_path\": \"commits\",\n            \"gap_policy\": \"insert_zeros\",\n            \"model\": \"linear\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nResponse:\n\n```\n{\n  \"error\" : {\n    \"root_cause\" : [ {\n      \"type\" : \"null_pointer_exception\",\n      \"reason\" : null\n    } ],\n    \"type\" : \"null_pointer_exception\",\n    \"reason\" : null\n  },\n  \"status\" : 500\n}\n```\n\nChanging the above request and specifying a window returns the expected response.\n\n**Provide logs (if relevant)**:\n\n```\njava.lang.NullPointerException\n    at org.elasticsearch.search.aggregations.pipeline.movavg.MovAvgParser.parse(MovAvgParser.java:166)\n    at org.elasticsearch.search.aggregations.pipeline.movavg.MovAvgParser.parse(MovAvgParser.java:38)\n    at org.elasticsearch.search.aggregations.AggregatorParsers.parseAggregators(AggregatorParsers.java:204)\n    at org.elasticsearch.search.aggregations.AggregatorParsers.parseAggregators(AggregatorParsers.java:185)\n    at org.elasticsearch.search.aggregations.AggregatorParsers.parseAggregators(AggregatorParsers.java:109)\n    at org.elasticsearch.search.builder.SearchSourceBuilder.parseXContent(SearchSourceBuilder.java:864)\n    at org.elasticsearch.rest.action.search.RestSearchAction.parseSearchRequest(RestSearchAction.java:133)\n    at org.elasticsearch.rest.action.search.RestSearchAction.handleRequest(RestSearchAction.java:95)\n    at org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:51)\n    at org.elasticsearch.rest.RestController.executeHandler(RestController.java:214)\n    at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:174)\n    at org.elasticsearch.http.HttpServer.dispatchRequest(HttpServer.java:101)\n    at org.elasticsearch.http.netty.NettyHttpServerTransport.dispatchRequest(NettyHttpServerTransport.java:487)\n    at org.elasticsearch.http.netty.HttpRequestHandler.messageReceived(HttpRequestHandler.java:65)\n    at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.elasticsearch.http.netty.pipelining.HttpPipeliningHandler.messageReceived(HttpPipeliningHandler.java:85)\n    at org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.jboss.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145)\n    at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.jboss.netty.handler.codec.http.HttpContentDecoder.messageReceived(HttpContentDecoder.java:108)\n    at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n    at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459)\n    at org.jboss.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536)\n    at org.jboss.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435)\n    at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n    at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:83)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n    at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n    at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n    at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n    at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n    at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n    at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337)\n    at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n    at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n    at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n    at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}