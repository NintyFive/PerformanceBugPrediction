{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7487","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7487/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7487/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7487/events","html_url":"https://github.com/elastic/elasticsearch/issues/7487","id":41327962,"node_id":"MDU6SXNzdWU0MTMyNzk2Mg==","number":7487,"title":"StackOverflowError running query script and agg script","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111540092,"node_id":"MDU6TGFiZWwxMTE1NDAwOTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.4.0.Beta1","name":"v1.4.0.Beta1","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2014-08-27T20:37:06Z","updated_at":"2014-09-26T08:00:46Z","closed_at":"2014-09-26T08:00:46Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This query was generated by a benchmarking framework that creates random combinations of clauses and this combo of scripted agg and script_score that references \"_score\" causes a StackOverflowError\n\n```\ncurl -XPUT \"http://localhost:9200/test?pretty=true\" -d'\n{\n  \"mappings\": {\n    \"car\": {\n      \"properties\": {\n        \"make\": {\n          \"type\": \"string\",\n          \"index\": \"not_analyzed\"\n        },\n        \"model\": {\n          \"type\": \"string\",\n          \"index\": \"not_analyzed\"\n        },\n        \"mileage\": {\n          \"type\": \"integer\"\n        }\n      }\n    }\n  }\n}'\ncurl -XPOST \"http://localhost:9200/test/car/1?pretty=true\" -d'\n{\n  \"make\": \"bmw\",\n  \"model\": \"m3\",\n  \"mileage\": 30000\n}'  \ncurl -XPOST \"http://localhost:9200/test/car/_search?pretty\" -d'\n{\n   \"query\": {\n      \"function_score\": {\n         \"query\": {\n            \"term\": {\n               \"model\": \"m3\"\n            }\n         },\n         \"script_score\": {\n            \"script\": \"_score * doc[\\\"mileage\\\"].value \"\n         },\n         \"boost_mode\": \"replace\"\n      }\n   },\n   \"aggs\": {\n      \"makes\": {\n         \"terms\": {\n            \"script\": \"doc[\\\"make\\\"].value\"\n         }\n      }\n   }\n}'  \n```\n","closed_by":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"performed_via_github_app":null}