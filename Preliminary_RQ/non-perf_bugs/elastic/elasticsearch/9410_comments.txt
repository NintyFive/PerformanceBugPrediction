[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71526477","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-71526477","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":71526477,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTI2NDc3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-26T19:56:54Z","updated_at":"2015-01-26T19:56:54Z","author_association":"CONTRIBUTOR","body":"First Elasticsearch checks the unknown string field against the list of date formats in `dynamic_date_formats` to determine whether the field contains a date or a string.\n\nOnce it decides that it is a date, it applies the mapping found in the templates, in which you don't specify the date format.  Thus it uses the default matching format which is `dateOptionalTime`.  Why not just specify the format you want in the template mapping?  eg:\n\n```\nDELETE test\n\nPOST /test\n{\n  \"mappings\": {\n    \"test\": {\n      \"dynamic_date_formats\": [\n        \"yyyy/MM/dd\"  \n      ],\n      \"dynamic_templates\": [\n        {\n          \"dates_ignore_malformed\": {\n            \"path_match\": \"*\",\n            \"match_mapping_type\": \"date\",\n            \"mapping\": {\n              \"format\": \"yyyy/MM/dd\",\n              \"ignore_malformed\": true\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n\nPOST /test/test/1\n{\n  \"format_one\": \"2014-01-05\"\n}\n\nPOST /test/test/2\n{\n  \"format_two\": \"2014/01/05\"\n}\n\nGET _mapping\n```\n\nThis returns:\n\n```\n{\n   \"test\": {\n      \"mappings\": {\n         \"test\": {\n            \"dynamic_date_formats\": [\n               \"yyyy/MM/dd\"\n            ],\n            \"dynamic_templates\": [\n               {\n                  \"dates_ignore_malformed\": {\n                     \"mapping\": {\n                        \"ignore_malformed\": true,\n                        \"format\": \"yyyy/MM/dd\"\n                     },\n                     \"match_mapping_type\": \"date\",\n                     \"path_match\": \"*\"\n                  }\n               }\n            ],\n            \"properties\": {\n               \"format_one\": {\n                  \"type\": \"string\"\n               },\n               \"format_two\": {\n                  \"type\": \"date\",\n                  \"ignore_malformed\": true,\n                  \"format\": \"yyyy/MM/dd\"\n               }\n            }\n         }\n      }\n   }\n} \n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71567447","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-71567447","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":71567447,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTY3NDQ3","user":{"login":"SergeyTsalkov","id":3589642,"node_id":"MDQ6VXNlcjM1ODk2NDI=","avatar_url":"https://avatars1.githubusercontent.com/u/3589642?v=4","gravatar_id":"","url":"https://api.github.com/users/SergeyTsalkov","html_url":"https://github.com/SergeyTsalkov","followers_url":"https://api.github.com/users/SergeyTsalkov/followers","following_url":"https://api.github.com/users/SergeyTsalkov/following{/other_user}","gists_url":"https://api.github.com/users/SergeyTsalkov/gists{/gist_id}","starred_url":"https://api.github.com/users/SergeyTsalkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergeyTsalkov/subscriptions","organizations_url":"https://api.github.com/users/SergeyTsalkov/orgs","repos_url":"https://api.github.com/users/SergeyTsalkov/repos","events_url":"https://api.github.com/users/SergeyTsalkov/events{/privacy}","received_events_url":"https://api.github.com/users/SergeyTsalkov/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T00:25:45Z","updated_at":"2015-01-27T00:25:45Z","author_association":"NONE","body":"So what if you wanted to use dynamic_date_formats to specify multiple possible formats? Does that prevent you from also using ignore_malformed?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71614223","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-71614223","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":71614223,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjE0MjIz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T09:19:41Z","updated_at":"2015-01-27T09:19:41Z","author_association":"CONTRIBUTOR","body":"The first time that field is seen, it will be mapped as a date only if it matches one of the formats you listed in `dynamic_date_formats`, otherwise it will be mapped as a string.\n\nOnce the field is mapped, then `ignore_malformed` will allow you to ignore malformed dates later on.  But if the first date seen is malformed, then the field will be a string instead.  \n\nThis is the same way that the mapping would work if you do not specify dynamic_date_formats or templates.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71618329","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-71618329","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":71618329,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjE4MzI5","user":{"login":"SergeyTsalkov","id":3589642,"node_id":"MDQ6VXNlcjM1ODk2NDI=","avatar_url":"https://avatars1.githubusercontent.com/u/3589642?v=4","gravatar_id":"","url":"https://api.github.com/users/SergeyTsalkov","html_url":"https://github.com/SergeyTsalkov","followers_url":"https://api.github.com/users/SergeyTsalkov/followers","following_url":"https://api.github.com/users/SergeyTsalkov/following{/other_user}","gists_url":"https://api.github.com/users/SergeyTsalkov/gists{/gist_id}","starred_url":"https://api.github.com/users/SergeyTsalkov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergeyTsalkov/subscriptions","organizations_url":"https://api.github.com/users/SergeyTsalkov/orgs","repos_url":"https://api.github.com/users/SergeyTsalkov/repos","events_url":"https://api.github.com/users/SergeyTsalkov/events{/privacy}","received_events_url":"https://api.github.com/users/SergeyTsalkov/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T09:51:44Z","updated_at":"2015-01-27T09:51:44Z","author_association":"NONE","body":"I appreciate you taking the time to help me clear this up, but it still seems like the thing I want to do isn't possible. In my data set, the date might be in one of several formats, and I won't know which one ahead of time. That's why I'm trying to use dynamic_date_formats to specify the possibilities, but I guess my first example was unclear because I only listed one. This is more what I was going for:\n\n```\n{\n  \"mappings\": {\n    \"test\": {\n      \"dynamic_date_formats\": [\n        \"yyyy-MM-dd\",\n        \"yyyy/MM/dd\"\n      ],\n      \"dynamic_templates\": [\n        {\n          \"dates_ignore_malformed\": {\n            \"path_match\": \"*\",\n            \"match_mapping_type\": \"date\",\n            \"mapping\": {\n              \"ignore_malformed\": true\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nSo whichever format the first date has would be applied to the new field, and the date would be expected in that format from then on. If it came in a different format from then on, ignore_malformed would cause it to be ignored.\n\nI guess that isn't possible with ElasticSearch?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71621661","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-71621661","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":71621661,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjIxNjYx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T10:16:31Z","updated_at":"2015-01-27T10:16:31Z","author_association":"CONTRIBUTOR","body":"@SergeyTsalkov Actually you're completely right - the `dynamic_date_formats` are not used after adding the mapping to determine the `format` for the date field:\n\n```\nDELETE test\n\nPOST /test\n{\n  \"mappings\": {\n    \"test\": {\n      \"dynamic_date_formats\": [\n        \"yyyy-MM-dd\"  ,\n        \"dd/MM/yyyy\"\n      ],\n      \"dynamic_templates\": [\n        {\n          \"dates_ignore_malformed\": {\n            \"path_match\": \"*\",\n            \"match_mapping_type\": \"date\",\n            \"mapping\": {\n              \"type\":\"date\"\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nThis results in a date field with format `dateOptionalTime`:\n\n```\nPOST /test/test/1\n{\n  \"format_one\": \"2014-01-05\"\n}\n```\n\nThis throws an exception indicating that it is ignoring the `dynamic_date_formats`:  failed to parse date field [05/01/2014], tried both date format [dateOptionalTime], and timestamp number with locale []\n\n```\nPOST /test/test/2\n{\n  \"format_two\": \"05/01/2014\"\n}\n\nGET _mapping\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71668216","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-71668216","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":71668216,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjY4MjE2","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T15:38:43Z","updated_at":"2015-01-27T15:38:43Z","author_association":"MEMBER","body":"> the dynamic_date_formats are not used after adding the mapping to determine the format for the date field\n\nBut that's the way it should be? As you said before, `dynamic_date_formats` is to determine _what_ is a date.  There was then no format put on the dynamic field, and when it tried to parse the value (with the actual field mapping format of `dateOptionalTime`) it failed. I don't think `dynamic_date_formats` should in any ways adjust the dynamic field's format (that is what the dynamic field mapping is for).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71695980","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-71695980","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":71695980,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjk1OTgw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T18:03:40Z","updated_at":"2015-01-27T18:03:40Z","author_association":"CONTRIBUTOR","body":"@rjernst if you didn't specify any dynamic_date_formats or any templates, then it would check a string against the default list of dynamic date formats and apply the first format that matches to the field.\n\nWith the example above, it uses the specified dynamic date formats to determine whether the field is a date or not, but then it uses the default list of dynamic date formats to determine which format to apply.  Instead, it should use the custom list.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/253382087","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-253382087","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":253382087,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzM4MjA4Nw==","user":{"login":"sqlboy","id":9151,"node_id":"MDQ6VXNlcjkxNTE=","avatar_url":"https://avatars1.githubusercontent.com/u/9151?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlboy","html_url":"https://github.com/sqlboy","followers_url":"https://api.github.com/users/sqlboy/followers","following_url":"https://api.github.com/users/sqlboy/following{/other_user}","gists_url":"https://api.github.com/users/sqlboy/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlboy/subscriptions","organizations_url":"https://api.github.com/users/sqlboy/orgs","repos_url":"https://api.github.com/users/sqlboy/repos","events_url":"https://api.github.com/users/sqlboy/events{/privacy}","received_events_url":"https://api.github.com/users/sqlboy/received_events","type":"User","site_admin":false},"created_at":"2016-10-13T01:01:51Z","updated_at":"2016-10-13T01:03:17Z","author_association":"NONE","body":"This is the way to do it. Set your dynamic_date_format, then set the same ones as the value of \"format\" in your dynamic mapping.\n\n```\n  \"dynamic_date_formats\": [\n        \"yyyy/MM/dd HH:mm:ss Z\",\n        \"yyyy/MM/dd Z\",\n        \"yyyy/MM/dd HH:mm:ss\",\n        \"yyyy/MM/dd\",\n        \"yyyy-MM-dd HH:mm:ss Z\",\n        \"yyyy-MM-dd Z\",\n        \"yyyy-MM-dd HH:mm:ss\",\n        \"yyyy-MM-dd\",\n        \"MM/dd/yyyy\",\n        \"MM-dd-yyyy\"\n      ],\n```\n\n```\n          \"date_template\": {\n            \"match\": \"*\",\n            \"match_mapping_type\": \"date\",\n            \"mapping\": {\n              \"type\": \"date\",\n              \"index\": \"not_analyzed\",\n              \"format\": \"yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z||yyyy/MM/dd HH:mm:ss||yyyy/MM/dd||yyyy-MM-dd HH:mm:ss Z||yyyy-MM-dd Z||yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||MM/dd/yyyy||MM-dd-yyyy\"\n            }\n          }\n```\n\nThis way, you can add dates of different format and the field doesn't get locked down to a single format.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/270712183","html_url":"https://github.com/elastic/elasticsearch/issues/9410#issuecomment-270712183","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9410","id":270712183,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDcxMjE4Mw==","user":{"login":"Fairledger","id":24640592,"node_id":"MDQ6VXNlcjI0NjQwNTky","avatar_url":"https://avatars1.githubusercontent.com/u/24640592?v=4","gravatar_id":"","url":"https://api.github.com/users/Fairledger","html_url":"https://github.com/Fairledger","followers_url":"https://api.github.com/users/Fairledger/followers","following_url":"https://api.github.com/users/Fairledger/following{/other_user}","gists_url":"https://api.github.com/users/Fairledger/gists{/gist_id}","starred_url":"https://api.github.com/users/Fairledger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fairledger/subscriptions","organizations_url":"https://api.github.com/users/Fairledger/orgs","repos_url":"https://api.github.com/users/Fairledger/repos","events_url":"https://api.github.com/users/Fairledger/events{/privacy}","received_events_url":"https://api.github.com/users/Fairledger/received_events","type":"User","site_admin":false},"created_at":"2017-01-05T18:01:48Z","updated_at":"2017-01-05T18:01:48Z","author_association":"NONE","body":"I'm using Elasticsearch 2.3.1 and the dynamic mapping posted above fails for me:\r\n          \"date_template\": {\r\n            \"match\": \"*\",\r\n            \"match_mapping_type\": \"date\",\r\n            \"mapping\": {\r\n              \"type\": \"date\",\r\n              \"index\": \"not_analyzed\",\r\n              \"format\": \"yyyy/MM/dd HH:mm:ss Z||yyyy/MM/dd Z||yyyy/MM/dd HH:mm:ss||yyyy/MM/dd||yyyy-MM-dd HH:mm:ss Z||yyyy-MM-dd Z||yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||MM/dd/yyyy||MM-dd-yyyy\"\r\n            }\r\n          }\r\n\r\nI've also tried the following but it too does not give me the behavior I want.  I do not always know the format of my date field for an index before indexing a document.  I want the index to be able to accept different formats.\r\n\r\n  \"dynamic_date_formats\": [\r\n        \"yyyy/MM/dd HH:mm:ss Z\",\r\n        \"yyyy/MM/dd Z\",\r\n        \"yyyy/MM/dd HH:mm:ss\",\r\n        \"yyyy/MM/dd\",\r\n        \"yyyy-MM-dd HH:mm:ss Z\",\r\n        \"yyyy-MM-dd Z\",\r\n        \"yyyy-MM-dd HH:mm:ss\",\r\n        \"yyyy-MM-dd\",\r\n        \"MM/dd/yyyy\",\r\n        \"MM-dd-yyyy\"\r\n      ],\r\n      \"dynamic_templates\": [\r\n      {\r\n        \"dates\": {\r\n              \"match_mapping_type\": [\"*time\", \"date\", \"TIME\"],\r\n              \"match_pattern\": \"regex\",\r\n              \"mapping\": {\r\n                  \"type\": \"date\",\r\n                  \"format\": \"YYYY-MM-dd HH:mm:ss | YYYY-MM-dd | YYYY-MM-dd HH:mm:ss.SS | YYYY:MM-dd HH:mm:ss.SSSS\"\r\n               }\r\n          }\r\n       }\r\n     ]\r\n","performed_via_github_app":null}]