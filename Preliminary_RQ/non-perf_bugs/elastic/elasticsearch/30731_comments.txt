[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390239022","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-390239022","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":390239022,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDIzOTAyMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-18T15:13:25Z","updated_at":"2018-05-18T15:13:25Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390239045","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-390239045","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":390239045,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDIzOTA0NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-18T15:13:29Z","updated_at":"2018-05-18T15:13:29Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390239061","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-390239061","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":390239061,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDIzOTA2MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-18T15:13:33Z","updated_at":"2018-05-18T15:13:33Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390629095","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-390629095","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":390629095,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDYyOTA5NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-05-21T11:32:32Z","updated_at":"2018-05-21T11:32:32Z","author_association":"MEMBER","body":"Thank for putting this list up. I think we should also deal with the [TokenMetaData](https://github.com/elastic/elasticsearch/blob/master/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/authc/TokenMetaData.java) injected [here](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/cluster/service/ClusterService.java#L83)  when called from [here](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/gateway/Gateway.java#L150).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390666836","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-390666836","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":390666836,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDY2NjgzNg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-05-21T14:16:15Z","updated_at":"2018-05-21T14:16:15Z","author_association":"MEMBER","body":"> I think we should also deal with the TokenMetaData injected here when called from here.\r\n\r\nIt looks like @ywelsch took care of it in https://github.com/elastic/elasticsearch/pull/30743/files","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391436262","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391436262","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391436262,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTQzNjI2Mg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-05-23T17:41:19Z","updated_at":"2018-05-23T17:41:19Z","author_association":"CONTRIBUTOR","body":"Now that #30743 is merged I wanted to test this. The 6.3 branch works perfectly for me. The 6.x branch is failing though. That *probably* isn't a 6.3 release blocker but it is weird. The failure comes during the 5.6.10 upgrade to 6.x. The failure is:\r\n```\r\n[2018-05-23T12:59:33,101][ERROR][o.e.x.w.s.WatcherIndexTemplateRegistry] [node-0] Error adding watcher template [.watch-history-8]\r\norg.elasticsearch.transport.RemoteTransportException: [node-2][127.0.0.1:41731][indices:admin/template/put]\r\nCaused by: java.lang.IllegalArgumentException: unknown setting [index.xpack.watcher.template.version] please check that any required plugins are installed, or check the breaking changes documentation for removed settings\r\n        at org.elasticsearch.common.settings.AbstractScopedSettings.validate(AbstractScopedSettings.java:293) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.settings.AbstractScopedSettings.validate(AbstractScopedSettings.java:256) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.settings.AbstractScopedSettings.validate(AbstractScopedSettings.java:246) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.action.admin.indices.template.put.TransportPutIndexTemplateAction.masterOperation(TransportPutIndexTemplateAction.java:80) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.action.admin.indices.template.put.TransportPutIndexTemplateAction.masterOperation(TransportPutIndexTemplateAction.java:42) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.action.support.master.TransportMasterNodeAction.masterOperation(TransportMasterNodeAction.java:87) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n```\r\n\r\nThe test that actually fails is \" org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT.test {p0=mixed_cluster/10_basic/Test old multi type stuff}\" but it only fails because one of its actions times out because the cluster is busy trying the thing above over and over again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391454796","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391454796","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391454796,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTQ1NDc5Ng==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-23T18:41:28Z","updated_at":"2018-05-23T18:41:28Z","author_association":"CONTRIBUTOR","body":"@nik9000 This is a real problem (the x-pack node tries to add a template with x-pack only settings, and the OSS master rejects it). I'm not sure why it's not triggered by the test on the 6.3 branch as the same templating behavior exists there (for Watcher, Security etc.) as well. I consider this a blocker for 6.3 and will work on a solution tomorrow.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391455838","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391455838","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391455838,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTQ1NTgzOA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-05-23T18:45:09Z","updated_at":"2018-05-23T18:45:09Z","author_association":"CONTRIBUTOR","body":"> I consider this a blocker for 6.3 and will work on a solution tomorrow.\r\n\r\n:heart:\r\n\r\nIt might not come up in 6.3 because I got lucky the couple of times I ran it. Maybe the 6.3 node won the master election.\r\n\r\nIt might still be a problem in the 6.3 branch but not bad enough to slow the tests down enough to fail. I'll see if I can write a test that outright fails without this. I didn't want to have to use watcher in these tests because it has so much state, but I suspect I have no choice here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391457974","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391457974","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391457974,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTQ1Nzk3NA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-05-23T18:52:26Z","updated_at":"2018-05-23T18:52:26Z","author_association":"MEMBER","body":"> I consider this a blocker for 6.3 and will work on a solution tomorrow.\r\n\r\n+1, this is a blocker.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391622267","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391622267","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391622267,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTYyMjI2Nw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-24T07:49:51Z","updated_at":"2018-05-24T07:49:51Z","author_association":"CONTRIBUTOR","body":"The issue with Watcher is that it uses a custom setting in its template. I've gone through the other XPack services to check if they present the same issue:\r\n\r\n- SecurityIndexManager adds templates (security-index-template.json) but no custom settings in template\r\n- IndexAuditTrail adds templates (security_audit_log.json) but no custom settings in template\r\n- LocalExporter adds templates (monitoring-*.json) but no custom settings. It also adds an ingest pipeline, but again no customs.\r\n- WatcherIndexTemplateRegistry adds templates (triggered-watches.json, watch-history.json, watches.json). Only `watch-history` uses a custom setting (`xpack.watcher.template.version`).\r\n\r\nI'll explore getting rid of the `xpack.watcher.template.version` setting, and using the same approach as has been used for the other templates (e.g. `security-index-template` or `security_audit_log.json`) where there's a custom `_meta` field in the mapping.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391635085","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391635085","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391635085,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTYzNTA4NQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-24T08:36:21Z","updated_at":"2018-05-24T08:36:21Z","author_association":"CONTRIBUTOR","body":"I've opened #30832 for the watcher issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391644237","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391644237","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391644237,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTY0NDIzNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-24T09:07:56Z","updated_at":"2018-05-24T09:07:56Z","author_association":"CONTRIBUTOR","body":"> It might not come up in 6.3 because I got lucky the couple of times I ran it. Maybe the 6.3 node won the master election.\r\n\r\n@nik9000 I've run the mixed-cluster tests a few times on 6.3, and I've seen this exception spamming the logs. The tests not failing on 6.3 are more of an indication that we need to add more tests.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391693426","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391693426","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391693426,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTY5MzQyNg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-05-24T12:19:43Z","updated_at":"2018-05-24T12:19:43Z","author_association":"CONTRIBUTOR","body":"> @nik9000 I've run the mixed-cluster tests a few times on 6.3, and I've seen this exception spamming the logs. The tests not failing on 6.3 are more of an indication that we need to add more tests.\r\n\r\nI figured as much. Earlier I'd said:\r\n\r\n> It might still be a problem in the 6.3 branch but not bad enough to slow the tests down enough to fail. I'll see if I can write a test that outright fails without this.\r\n\r\nand that is still my plan. I got distracted by other things and didn't end up writing the test.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391863136","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391863136","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391863136,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTg2MzEzNg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-05-24T21:08:45Z","updated_at":"2018-05-24T21:08:45Z","author_association":"CONTRIBUTOR","body":"So in my grand tradition of finding things, I believe the following is flaky:\r\n```\r\ngit checkout 6.x\r\nwhile ./gradlew -p qa/rolling-upgrade/ check -Dtests.distribution=zip; do echo ok; done\r\n```\r\n\r\nOn my desktop about half of those runs fail with:\r\n```\r\n[2018-05-24T16:51:55,044][INFO ][o.e.c.s.MasterService    ] [node-0] zen-disco-elected-as-master ([2] nodes joined)[, ], reason: new_master {node-0}{EI796DscQYWC8OejKoXa5Q}{ikSXu_0GTiaygCs4aLzfug}{127.0.0.1}{127\r\n.0.0.1:34129}{ml.machine_memory=33651564544, xpack.installed=true, testattr=test, ml.max_open_jobs=20, ml.enabled=true}\r\n[2018-05-24T16:51:55,060][INFO ][o.e.c.s.ClusterApplierService] [node-0] new_master {node-0}{EI796DscQYWC8OejKoXa5Q}{ikSXu_0GTiaygCs4aLzfug}{127.0.0.1}{127.0.0.1:34129}{ml.machine_memory=33651564544, xpack.insta\r\nlled=true, testattr=test, ml.max_open_jobs=20, ml.enabled=true}, reason: apply cluster state (from master [master {node-0}{EI796DscQYWC8OejKoXa5Q}{ikSXu_0GTiaygCs4aLzfug}{127.0.0.1}{127.0.0.1:34129}{ml.machine_m\r\nemory=33651564544, xpack.installed=true, testattr=test, ml.max_open_jobs=20, ml.enabled=true} committed version [751] source [zen-disco-elected-as-master ([2] nodes joined)[, ]]])\r\n[2018-05-24T16:51:55,085][WARN ][o.e.d.z.ZenDiscovery     ] [node-0] zen-disco-failed-to-publish, current nodes: nodes: \r\n   {node-0}{GsF5lxmmSQiemBzLM6Csbw}{lu_kNBYlROqRavg-7XxHSg}{127.0.0.1}{127.0.0.1:40615}{testattr=test, ml.machine_memory=33651564544, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}\r\n   {node-0}{EI796DscQYWC8OejKoXa5Q}{ikSXu_0GTiaygCs4aLzfug}{127.0.0.1}{127.0.0.1:34129}{ml.machine_memory=33651564544, xpack.installed=true, testattr=test, ml.max_open_jobs=20, ml.enabled=true}, local, master\r\n   {node-2}{ZOcWRGW1QNaBzGNXwigiBw}{xiHQaAk_ToS9Y52SnpY4Ww}{127.0.0.1}{127.0.0.1:42023}{testattr=test, gen=old, ml.machine_memory=33651564544, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}\r\n\r\n[2018-05-24T16:51:55,085][WARN ][o.e.c.s.MasterService    ] [node-0] failing [maybe generate license for cluster]: failed to commit cluster state version [752]\r\norg.elasticsearch.discovery.Discovery$FailedToCommitClusterStateException: failed to get enough masters to ack sent cluster state. [1] left\r\n        at org.elasticsearch.discovery.zen.PublishClusterStateAction$SendingController.waitForCommit(PublishClusterStateAction.java:525) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.discovery.zen.PublishClusterStateAction.innerPublish(PublishClusterStateAction.java:196) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.discovery.zen.PublishClusterStateAction.publish(PublishClusterStateAction.java:161) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.discovery.zen.ZenDiscovery.publish(ZenDiscovery.java:336) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:225) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:132) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:625) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) [?:?]\r\n        at java.lang.Thread.run(Thread.java:844) [?:?]\r\n[2018-05-24T16:51:55,086][ERROR][o.e.l.StartupSelfGeneratedLicenseTask] [node-0] unexpected failure during [maybe generate license for cluster]\r\norg.elasticsearch.discovery.Discovery$FailedToCommitClusterStateException: failed to get enough masters to ack sent cluster state. [1] left\r\n        at org.elasticsearch.discovery.zen.PublishClusterStateAction$SendingController.waitForCommit(PublishClusterStateAction.java:525) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.discovery.zen.PublishClusterStateAction.innerPublish(PublishClusterStateAction.java:196) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.discovery.zen.PublishClusterStateAction.publish(PublishClusterStateAction.java:161) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.discovery.zen.ZenDiscovery.publish(ZenDiscovery.java:336) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:225) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:132) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:625) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) [?:?]\r\n        at java.lang.Thread.run(Thread.java:844) [?:?]\r\n```\r\n\r\nWhich *looks* pretty incriminating. There are totally three 3 available, master eligible nodes. It just logged about them.\r\n\r\nBut this is 6.x testing the upgrade from 6.3. I've seen no trouble going from 5.6 to 6.x or 6.2 going to 6.x. Go figure.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391863833","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391863833","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391863833,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTg2MzgzMw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-05-24T21:11:07Z","updated_at":"2018-05-24T21:11:07Z","author_association":"CONTRIBUTOR","body":"The other nodes see `NotMasterException`, but I *think* they are deserializing that from the master. Which doesn't think it is a master.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391982558","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391982558","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391982558,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTk4MjU1OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-25T08:34:17Z","updated_at":"2018-05-25T08:34:17Z","author_association":"CONTRIBUTOR","body":"The underlying issue has to do with the licensing component, which looks to be backwards-incompatible between 6.3 and 6.4. A 6.3 x-pack node cannot read the license metadata issued by a 6.4 x-pack node. This is caused by the recent PR https://github.com/elastic/elasticsearch/pull/30251 which changes the `License.VERSION_CURRENT` field. The last time this field was changed was for 5.0 where we required a full-cluster restart for upgrades. As this does not affect upgrades from 5.x/6{<3} to 6.3, this should not be a blocker for the 6.3 release. It will be a blocker for the 6.4 release and prevent any further testing of rolling-upgrade from 6.3 to 6.4.\r\n\r\nThe full stack trace is:\r\n\r\n```\r\n[2018-05-25T10:03:27,213][DEBUG][o.e.d.z.PublishClusterStateAction] [node-0] failed to send cluster state to {node-2}{TElgN8JNRH6EXapvEUzXlA}{bR5b0qKpSqiioj0sWLpjMA}{127.0.0.1}{127.0.0.1:38939}{testattr=test, gen=old, ml.machine_memory=67423862784, ml.max_open_jobs=20, xpack.installed=true, ml.enabled=true}\r\norg.elasticsearch.transport.RemoteTransportException: [node-2][127.0.0.1:38939][internal:discovery/zen/publish/send]\r\nCaused by: org.elasticsearch.ElasticsearchException: Unknown license version found, please upgrade all nodes to the latest elasticsearch-license plugin\r\n\tat org.elasticsearch.license.License.readLicense(License.java:306) ~[?:?]\r\n\tat org.elasticsearch.license.LicensesMetaData.<init>(LicensesMetaData.java:175) ~[?:?]\r\n\tat org.elasticsearch.common.io.stream.NamedWriteableAwareStreamInput.readNamedWriteable(NamedWriteableAwareStreamInput.java:46) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.AbstractNamedDiffable$CompleteNamedDiff.<init>(AbstractNamedDiffable.java:87) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.AbstractNamedDiffable.readDiffFrom(AbstractNamedDiffable.java:47) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.license.LicensesMetaData.readDiffFrom(LicensesMetaData.java:188) ~[?:?]\r\n\tat org.elasticsearch.common.io.stream.NamedWriteableAwareStreamInput.readNamedWriteable(NamedWriteableAwareStreamInput.java:46) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.NamedDiffableValueSerializer.readDiff(NamedDiffableValueSerializer.java:56) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.NamedDiffableValueSerializer.readDiff(NamedDiffableValueSerializer.java:30) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.DiffableUtils$MapDiff.<init>(DiffableUtils.java:392) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.DiffableUtils$ImmutableOpenMapDiff.<init>(DiffableUtils.java:221) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.DiffableUtils.readImmutableOpenMapDiff(DiffableUtils.java:120) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.metadata.MetaData$MetaDataDiff.<init>(MetaData.java:726) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.metadata.MetaData.readDiffFrom(MetaData.java:682) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.ClusterState$ClusterStateDiff.<init>(ClusterState.java:743) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.cluster.ClusterState.readDiffFrom(ClusterState.java:660) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.discovery.zen.PublishClusterStateAction.handleIncomingClusterStateRequest(PublishClusterStateAction.java:385) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.discovery.zen.PublishClusterStateAction$SendClusterStateRequestHandler.messageReceived(PublishClusterStateAction.java:436) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.discovery.zen.PublishClusterStateAction$SendClusterStateRequestHandler.messageReceived(PublishClusterStateAction.java:432) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler$1.doRun(SecurityServerTransportInterceptor.java:246) ~[?:?]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:304) ~[?:?]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1542) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:135) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TcpTransport.handleRequest(TcpTransport.java:1501) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:1371) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:64) [transport-netty4-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) [netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:297) [netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:413) [netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265) [netty-codec-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.handler.logging.LoggingHandler.channelRead(LoggingHandler.java:241) [netty-handler-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1359) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:935) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:134) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:545) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:499) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459) [netty-transport-4.1.16.Final.jar:4.1.16.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858) [netty-common-4.1.16.Final.jar:4.1.16.Final]\r\n\tat java.lang.Thread.run(Thread.java:844) [?:?]\r\n```\r\n\r\n/cc: @jkakavas @jaymode @rjernst \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/391990827","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-391990827","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":391990827,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MTk5MDgyNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-25T09:06:15Z","updated_at":"2018-05-25T09:06:15Z","author_association":"CONTRIBUTOR","body":"I've created #30859 as a fix for the licensing serialization issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/392013819","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-392013819","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":392013819,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MjAxMzgxOQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-25T10:38:31Z","updated_at":"2018-05-25T10:38:31Z","author_association":"CONTRIBUTOR","body":"@nik9000 With my fix in #30859, I have this consistently passing now","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/392022290","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-392022290","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":392022290,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MjAyMjI5MA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-25T11:19:12Z","updated_at":"2018-05-25T11:19:12Z","author_association":"CONTRIBUTOR","body":"The fix only helps in case of a rolling restart, so the mixed-cluster tests still fail with this fix on 6.x. I will have to discuss with @elastic/es-security what can be done about the mixed-cluster situation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393225264","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-393225264","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":393225264,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MzIyNTI2NA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-05-30T16:23:44Z","updated_at":"2018-05-30T16:23:44Z","author_association":"CONTRIBUTOR","body":"Reminder to self: We also need to fix `PersistentTaskParams` so that it knows about the versions etc. Assume for example a mixed 6.2 / 6.3 x-pack cluster. If you start a rollup task, this will be put as persistent task into the cluster state. A 6.2 x-pack node cannot deserialize this task.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393904818","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-393904818","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":393904818,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MzkwNDgxOA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-06-01T14:51:29Z","updated_at":"2018-06-01T14:51:29Z","author_association":"CONTRIBUTOR","body":"> add more tests (e.g. that rollups cannot be created in a mixed OSS/X-Pack cluster. Mixed-cluster X-pack tests)\r\n\r\nI'll take this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/394327949","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-394327949","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":394327949,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NDMyNzk0OQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2018-06-04T11:50:45Z","updated_at":"2018-06-04T11:50:45Z","author_association":"MEMBER","body":"We have [another test failure](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+default-distro/32/consoleFull) that I *believe* belongs here as well (there are several tests failing but they appear to do so for the same reason).\r\n\r\nThe first one of them has the reproduction line:\r\n\r\n```\r\n./gradlew :qa:rolling-upgrade:v6.3.0-SNAPSHOT#twoThirdsUpgradedTestRunner -Dtests.seed=F070E6B561B268B2 -Dtests.class=org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT -Dtests.method=\"test {p0=mixed_cluster/10_basic/Verify custom cluster metadata still exists during upgrade}\" -Dtests.security.manager=true -Dtests.locale=nl-BE -Dtests.timezone=America/Cuiaba -Dtests.distribution=zip -Dtests.rest.suite=mixed_cluster\r\n```\r\n\r\n<details>\r\n    <summary>Click arrow for failure details</summary>\r\n    <pre>\r\n07:23:15 ERROR   67.1s | UpgradeClusterClientYamlTestSuiteIT.test {p0=mixed_cluster/10_basic/Verify custom cluster metadata still exists during upgrade} <<< FAILURES!\r\n07:23:15    > Throwable #1: org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:40576], URI [/], status line [HTTP/1.1 503 Service Unavailable]\r\n07:23:15    > {\r\n07:23:15    >   \"name\" : \"node-0\",\r\n07:23:15    >   \"cluster_name\" : \"rolling-upgrade\",\r\n07:23:15    >   \"cluster_uuid\" : \"OhN80TdsRXmqjvybzQA48A\",\r\n07:23:15    >   \"version\" : {\r\n07:23:15    >     \"number\" : \"6.4.0\",\r\n07:23:15    >     \"build_flavor\" : \"default\",\r\n07:23:15    >     \"build_type\" : \"zip\",\r\n07:23:15    >     \"build_hash\" : \"1eede11\",\r\n07:23:15    >     \"build_date\" : \"2018-06-04T06:30:39.454194Z\",\r\n07:23:15    >     \"build_snapshot\" : true,\r\n07:23:15    >     \"lucene_version\" : \"7.4.0\",\r\n07:23:15    >     \"minimum_wire_compatibility_version\" : \"5.6.0\",\r\n07:23:15    >     \"minimum_index_compatibility_version\" : \"5.0.0\"\r\n07:23:15    >   },\r\n07:23:15    >   \"tagline\" : \"You Know, for Search\"\r\n07:23:15    > }\r\n07:23:15    > \tat org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:821)\r\n07:23:15    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:182)\r\n07:23:15    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:227)\r\n07:23:15    > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.readVersionsFromInfo(ESClientYamlSuiteTestCase.java:282)\r\n07:23:15    > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.initAndResetContext(ESClientYamlSuiteTestCase.java:106)\r\n07:23:15    > \tat java.lang.Thread.run(Thread.java:748)\r\n07:23:15    > Caused by: org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:40576], URI [/], status line [HTTP/1.1 503 Service Unavailable]\r\n07:23:15    > {\r\n07:23:15    >   \"name\" : \"node-0\",\r\n07:23:15    >   \"cluster_name\" : \"rolling-upgrade\",\r\n07:23:15    >   \"cluster_uuid\" : \"OhN80TdsRXmqjvybzQA48A\",\r\n07:23:15    >   \"version\" : {\r\n07:23:15    >     \"number\" : \"6.4.0\",\r\n07:23:15    >     \"build_flavor\" : \"default\",\r\n07:23:15    >     \"build_type\" : \"zip\",\r\n07:23:15    >     \"build_hash\" : \"1eede11\",\r\n07:23:15    >     \"build_date\" : \"2018-06-04T06:30:39.454194Z\",\r\n07:23:15    >     \"build_snapshot\" : true,\r\n07:23:15    >     \"lucene_version\" : \"7.4.0\",\r\n07:23:15    >     \"minimum_wire_compatibility_version\" : \"5.6.0\",\r\n07:23:15    >     \"minimum_index_compatibility_version\" : \"5.0.0\"\r\n07:23:15    >   },\r\n07:23:15    >   \"tagline\" : \"You Know, for Search\"\r\n07:23:15    > }\r\n07:23:15    > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:495)\r\n07:23:15    > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:484)\r\n07:23:15    > \tat org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n07:23:15    > \tat org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n07:23:15    > \tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n07:23:15    > \tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n07:23:15    > \tat org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n07:23:15    > \tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n07:23:15    > \tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n07:23:15    > \tat org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n07:23:15    > \tat org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n07:23:15    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n07:23:15    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n07:23:15    > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n07:23:15    > \tat org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n07:23:15    > \tat org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n07:23:15    > \t... 1 moreThrowable #2: java.lang.AssertionError: there are still running tasks:\r\n07:23:15    > {time_in_queue=15ms, time_in_queue_millis=15, source=zen-disco-elected-as-master ([2] nodes joined), executing=true, priority=URGENT, insert_order=185}\r\n07:23:15    > {time_in_queue=1ms, time_in_queue_millis=1, source=install-token-metadata, executing=false, priority=URGENT, insert_order=186}\r\n07:23:15    > {time_in_queue=0s, time_in_queue_millis=0, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=187}\r\n07:23:15    > \tat org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForClusterStateUpdatesToFinish$0(ESRestTestCase.java:347)\r\n07:23:15    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:767)\r\n07:23:15    > \tat org.elasticsearch.test.rest.ESRestTestCase.waitForClusterStateUpdatesToFinish(ESRestTestCase.java:338)\r\n07:23:15    > \tat org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:151)\r\n07:23:15    > \tat java.lang.Thread.run(Thread.java:748)\r\n07:23:15    > \tSuppressed: java.lang.AssertionError: there are still running tasks:\r\n07:23:15    > {time_in_queue=86ms, time_in_queue_millis=86, source=cluster_reroute(async_shard_fetch), executing=true, priority=HIGH, insert_order=42}\r\n07:23:15    > {time_in_queue=71ms, time_in_queue_millis=71, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=46}\r\n07:23:15    > {time_in_queue=4ms, time_in_queue_millis=4, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=47}\r\n07:23:15    > \t\tat org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForClusterStateUpdatesToFinish$0(ESRestTestCase.java:347)\r\n07:23:15    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:755)\r\n07:23:15    > \t\t... 37 more\r\n07:23:15    > \tSuppressed: java.lang.AssertionError: there are still running tasks:\r\n07:23:15    > {time_in_queue=96ms, time_in_queue_millis=96, source=cluster_reroute(async_shard_fetch), executing=true, priority=HIGH, insert_order=42}\r\n07:23:15    > {time_in_queue=81ms, time_in_queue_millis=81, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=46}\r\n07:23:15    > {time_in_queue=14ms, time_in_queue_millis=14, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=47}\r\n07:23:15    > \t\tat org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForClusterStateUpdatesToFinish$0(ESRestTestCase.java:347)\r\n07:23:15    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:755)\r\n07:23:15    > \t\t... 37 more\r\n07:23:15    > \tSuppressed: java.lang.AssertionError: there are still running tasks:\r\n07:23:15    > {time_in_queue=102ms, time_in_queue_millis=102, source=cluster_reroute(async_shard_fetch), executing=true, priority=HIGH, insert_order=42}\r\n07:23:15    > {time_in_queue=86ms, time_in_queue_millis=86, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=46}\r\n07:23:15    > {time_in_queue=20ms, time_in_queue_millis=20, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=47}\r\n07:23:15    > \t\tat org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForClusterStateUpdatesToFinish$0(ESRestTestCase.java:347)\r\n07:23:15    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:755)\r\n07:23:15    > \t\t... 37 more\r\n07:23:15    > \tSuppressed: java.lang.AssertionError: there are still running tasks:\r\n07:23:15    > {time_in_queue=109ms, time_in_queue_millis=109, source=cluster_reroute(async_shard_fetch), executing=true, priority=HIGH, insert_order=42}\r\n07:23:15    > {time_in_queue=94ms, time_in_queue_millis=94, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=46}\r\n07:23:15    > {time_in_queue=27ms, time_in_queue_millis=27, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=47}\r\n07:23:15    > \t\tat org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForClusterStateUpdatesToFinish$0(ESRestTestCase.java:347)\r\n07:23:15    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:755)\r\n07:23:15    > \t\t... 37 more\r\n07:23:15    > \tSuppressed: java.lang.AssertionError: there are still running tasks:\r\n07:23:15    > {time_in_queue=106ms, time_in_queue_millis=106, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=46}\r\n07:23:15    > {time_in_queue=40ms, time_in_queue_millis=40, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=47}\r\n07:23:15    > {time_in_queue=0s, time_in_queue_millis=0, source=maybe generate license for cluster, executing=false, priority=NORMAL, insert_order=49}\r\n07:23:15    > \t\tat org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForClusterStateUpdatesToFinish$0(ESRestTestCase.java:347)\r\n07:23:15    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:755)\r\n07:23:15    > \t\t... 37 more    \r\n    </pre>\r\n</details>\r\n\r\n\r\nFull cluster logs are available in [rolling-upgrade-cluster-logs.zip](https://github.com/elastic/elasticsearch/files/2068082/rolling-upgrade-cluster-logs.zip)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/394401343","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-394401343","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":394401343,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NDQwMTM0Mw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-06-04T15:41:30Z","updated_at":"2018-06-04T15:41:30Z","author_association":"CONTRIBUTOR","body":"I had a look at @danielmitterdorfer's failure. A few things:\r\n1. This is an xpack to xpack upgrade from 6.3 to 6.x\r\n2. I read the logs to say that:\r\n a. Everything goes fine until the we upgrade the second node.\r\n b. Once the second upgraded node comes online the first upgraded node is elected the master.\r\n c. It starts doing housekeeping like upgrading templates.\r\n d. It can't sync the cluster state\r\n\r\n\r\nI'd *expect* there to be a failure *somewhere* in the log describing how the cluster state sync failed. But I can't find one. All of the exceptions have to do with the restarts and the cluster not having a valid master after the incident.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/394648727","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-394648727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":394648727,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NDY0ODcyNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-06-05T09:44:38Z","updated_at":"2018-06-05T09:44:38Z","author_association":"CONTRIBUTOR","body":"@nik9000 @danielmitterdorfer this will be fixed by #30859. It's not blocking the 6.3 release, but the 6.4 release.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/394819472","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-394819472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":394819472,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NDgxOTQ3Mg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-06-05T18:49:00Z","updated_at":"2018-06-05T18:49:00Z","author_association":"CONTRIBUTOR","body":"I've opened #31112 to make the x-pack upgrade tests (all three of them) use three nodes. It isn't perfect but it is about as complex as I'd like to get and still backport to 6.3.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/395448689","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-395448689","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":395448689,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NTQ0ODY4OQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-06-07T14:49:34Z","updated_at":"2018-06-07T17:54:20Z","author_association":"CONTRIBUTOR","body":"So I merged #31112 to master and 6.x yesterday but that caused all kinds of problems. I'm trying to un-break them now. I'll merge to 6.3 once everything is calmer in the branches I've already merged to.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/395841854","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-395841854","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":395841854,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NTg0MTg1NA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-06-08T18:05:00Z","updated_at":"2018-06-08T18:05:00Z","author_association":"CONTRIBUTOR","body":"I've finished backporting #31112 to 6.3. We can see how it does over the weekend.\r\n\r\n#31195 is still open to enable one of the tests after the backport but it is a upgrade from 5.6.10 to 6.3 test so I *think* we're fairly ok. It is almost certainly a test bug.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/396278634","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-396278634","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":396278634,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NjI3ODYzNA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-06-11T15:11:40Z","updated_at":"2018-06-11T15:11:40Z","author_association":"CONTRIBUTOR","body":"The weekend went well as far as the backwards compatibility builds goes! I'm happy to say that the upgrades looked great. I think I'm done here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/396430653","html_url":"https://github.com/elastic/elasticsearch/issues/30731#issuecomment-396430653","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30731","id":396430653,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NjQzMDY1Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-06-12T00:47:39Z","updated_at":"2018-06-12T00:47:39Z","author_association":"MEMBER","body":"Thank you all that contributed to the effort here, this was a great effort all around.\r\n\r\nClosed by the hard work of a lot of people","performed_via_github_app":null}]