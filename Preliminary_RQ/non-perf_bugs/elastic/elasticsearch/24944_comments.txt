[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/304796598","html_url":"https://github.com/elastic/elasticsearch/issues/24944#issuecomment-304796598","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24944","id":304796598,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDc5NjU5OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-05-30T07:26:06Z","updated_at":"2017-05-30T07:26:06Z","author_association":"CONTRIBUTOR","body":"@pandrese thanks for such a good recreation\r\n\r\n@nknize please could you take a look","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/386405442","html_url":"https://github.com/elastic/elasticsearch/issues/24944#issuecomment-386405442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24944","id":386405442,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjQwNTQ0Mg==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-05-03T19:12:37Z","updated_at":"2018-05-03T19:12:37Z","author_association":"MEMBER","body":"So, this is a tricky one. The problem here is that expression likes `\"loc\": [\"44\", \"55\"]` to a human eye might look like a location with lon: 44 and lat: 55. However, elasticsearch interprets it as 2 locations: one with [geohash 44](http://geohash.org/44) and another with [geohash 55](http://geohash.org/55). So, instead of a single location somewhere in Central Russia, we get two locations near Antarctica. When coordinates have dots and we ignore malformed locations, only one geopoint makes it in causing unexpected and difficult to interpret results. I am planning to add some validation to geohash parsing as part of fix for #23579, which will at least fix the error message, so instead of `illegal latitude value [269.12109375] for loc` we would get a more easily interpretable `illegal symbol [.] in geohash [55.5]`, but besides this, I am not really sure how to deal with this.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/387098899","html_url":"https://github.com/elastic/elasticsearch/issues/24944#issuecomment-387098899","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24944","id":387098899,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzA5ODg5OQ==","user":{"login":"pandrese","id":1724167,"node_id":"MDQ6VXNlcjE3MjQxNjc=","avatar_url":"https://avatars3.githubusercontent.com/u/1724167?v=4","gravatar_id":"","url":"https://api.github.com/users/pandrese","html_url":"https://github.com/pandrese","followers_url":"https://api.github.com/users/pandrese/followers","following_url":"https://api.github.com/users/pandrese/following{/other_user}","gists_url":"https://api.github.com/users/pandrese/gists{/gist_id}","starred_url":"https://api.github.com/users/pandrese/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pandrese/subscriptions","organizations_url":"https://api.github.com/users/pandrese/orgs","repos_url":"https://api.github.com/users/pandrese/repos","events_url":"https://api.github.com/users/pandrese/events{/privacy}","received_events_url":"https://api.github.com/users/pandrese/received_events","type":"User","site_admin":false},"created_at":"2018-05-07T15:16:25Z","updated_at":"2018-05-07T15:16:25Z","author_association":"NONE","body":"@imotov Your proposal for a better error message would help a lot to pinpoint the problem.\r\n\r\nIt has been a while, but as far as I remember when you set \"ignore_malformed\" on the type mapping, my expected behavior would be that malformed value should be ignored, and not saved in the document.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/387451549","html_url":"https://github.com/elastic/elasticsearch/issues/24944#issuecomment-387451549","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24944","id":387451549,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NzQ1MTU0OQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-05-08T15:54:45Z","updated_at":"2018-05-08T15:54:45Z","author_association":"MEMBER","body":"> It has been a while, but as far as I remember when you set \"ignore_malformed\" on the type mapping, my expected behavior would be that malformed value should be ignored, and not saved in the document.\r\n\r\nThat is the behaviour. As I tried to explain above `[\"5\", \"55.5\"]` are parsed as 2 geohashes. The first geohash `5` is correct and stored as a geopoint `70°00'00.0\"S 39°00'00.0\"W` (geohash `50000`). The second value `55.5` is an incorrect geohash - it used to produce a confusing error `illegal latitude value [269.12109375] for loc`, after I merged #30376 it produces a more meaningful error `unsupported symbol [.] in geohash [55.5]`. If `ignore_malformed` is set to `true` the first \"correct\" value `\"5\"` is indexed and the second incorrect value `\"55.5\"` is ignored. If `ignore_malformed` is set to `false` the entire document is ignored, so both points are not indexed.\r\n\r\nI cannot think of any additional work that can be done in order to improve the situation here. So, if there are no other suggestions, I am going to close this issue for now.\r\n\r\n","performed_via_github_app":null}]