{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28316","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28316/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28316/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28316/events","html_url":"https://github.com/elastic/elasticsearch/issues/28316","id":290076858,"node_id":"MDU6SXNzdWUyOTAwNzY4NTg=","number":28316,"title":"Setting persistent settings causes transient settings not to be applied","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-01-19T19:08:34Z","updated_at":"2018-01-22T18:55:55Z","closed_at":"2018-01-22T18:55:55Z","author_association":"MEMBER","active_lock_reason":null,"body":"Given the following scenario in a multi-node cluster:\r\n\r\n- apply some set of transient settings\r\n- ensure settings are applied\r\n- apply addition persistent setting\r\n- transient settings are ignored but still available in cluster state\r\n\r\nThis is reproducible with the following:\r\n\r\n- Create 6 nodes\r\n- Create a \"test\" index (default settings)\r\n- Apply transient settings to exclude 3 of the nodes by `_name` with allocation filtering\r\n- Ensure shards have moved off of the 3 excluded nodes\r\n- Apply a persistent setting (I used `cluster.info.update.interval` but any setting will work)\r\n- Shards no longer conform to the transient allocation filtering settings\r\n- Settings are still shown in the cluster state\r\n\r\nThis reproduces on master, 6.x, and 6.1, but does not on 6.0 and earlier.\r\n\r\nAttached is the (very quickly hacked together) test that reproduces this:\r\n[ClusterBugIT.java.txt](https://github.com/elastic/elasticsearch/files/1647618/ClusterBugIT.java.txt)","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}