{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23815","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23815/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23815/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23815/events","html_url":"https://github.com/elastic/elasticsearch/issues/23815","id":218110917,"node_id":"MDU6SXNzdWUyMTgxMTA5MTc=","number":23815,"title":"All threads hanged and not responding anymore","user":{"login":"yogeshbelur","id":19167940,"node_id":"MDQ6VXNlcjE5MTY3OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/19167940?v=4","gravatar_id":"","url":"https://api.github.com/users/yogeshbelur","html_url":"https://github.com/yogeshbelur","followers_url":"https://api.github.com/users/yogeshbelur/followers","following_url":"https://api.github.com/users/yogeshbelur/following{/other_user}","gists_url":"https://api.github.com/users/yogeshbelur/gists{/gist_id}","starred_url":"https://api.github.com/users/yogeshbelur/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yogeshbelur/subscriptions","organizations_url":"https://api.github.com/users/yogeshbelur/orgs","repos_url":"https://api.github.com/users/yogeshbelur/repos","events_url":"https://api.github.com/users/yogeshbelur/events{/privacy}","received_events_url":"https://api.github.com/users/yogeshbelur/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-03-30T07:55:14Z","updated_at":"2017-03-30T13:04:58Z","closed_at":"2017-03-30T08:01:18Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n**Elasticsearch version**:\r\n2.4.1\r\n**Plugins installed**: []\r\n\r\n**JVM version**:\r\n1.8\r\n**OS version**:\r\nLinux\r\n**Description of the problem including expected versus actual behavior**:\r\nI am running the es searh queries using transport client. After some time am running into a state where there are no response, i have taken the thread dump and i see all threads are parked waiting for a signal\r\n**Steps to reproduce**:\r\n 1.code is as below\r\n`SearchRequestBuilder setQuery = dataStoreConnection.getTransportClient().prepareSearch().setIndices(indexName)\r\n\t\t\t\t.setTypes(mappingName).setQuery(filterBuilder).setSize(0);\r\n\t\tif (null != buildMetricsQuery) {\r\n\t\t\tfor (AbstractAggregationBuilder metricsAggregationBuilder : buildMetricsQuery) {\r\n\t\t\t\tsetQuery.addAggregation(metricsAggregationBuilder);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlogger.info(\"Executing query: \" + setQuery);\r\n\t\tSearchResponse searchResponse = setQuery.get();\r\n\t\tlogger.info(\"Response obtained is: \" + searchResponse);`\r\n 2.\r\nThread dump has below parked threads\r\n`\"pool-1-thread-7\" #31 prio=5 os_prio=0 tid=0x00007f75f80d2000 nid=0xbfb waiting on condition [0x00007f75da146000]\r\n   java.lang.Thread.State: WAITING (parking)\r\n        at sun.misc.Unsafe.park(Native Method)\r\n        - parking to wait for  <0x00000000dad6dd18> (a org.elasticsearch.common.util.concurrent.BaseFuture$Sync)\r\n        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:997)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304)\r\n        at org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:280)\r\n        at org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:120)\r\n        at org.elasticsearch.action.support.AdapterActionFuture.actionGet(AdapterActionFuture.java:42)\r\n        at org.elasticsearch.action.ActionRequestBuilder.get(ActionRequestBuilder.java:64)\r\n        at net.appcito.reporting.engine.dao.DaoImpl.search(DaoImpl.java:43)\r\n        at net.appcito.reporting.engine.repository.RepositoryImpl.handleBasedOnContext(RepositoryImpl.java:66)\r\n        at net.appcito.reporting.engine.repository.RepositoryImpl.query(RepositoryImpl.java:50)\r\n        at net.appcito.reporting.engine.service.ReportingEngineService.query(ReportingEngineService.java:97)\r\n        at sun.reflect.GeneratedMethodAccessor46.invoke(Unknown Source)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:205)\r\n        at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:133)\r\n        at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:116)\r\n        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:827)\r\n        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:738)\r\n        at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)\r\n        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:963)\r\n        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:897)\r\n        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:970)\r\n        at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:872)\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\r\n        at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:846)\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\r\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:812)\r\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:587)`\r\n\r\n\r\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}