{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15060","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15060/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15060/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15060/events","html_url":"https://github.com/elastic/elasticsearch/issues/15060","id":119177323,"node_id":"MDU6SXNzdWUxMTkxNzczMjM=","number":15060,"title":"Testing classpath plugins in a node has become cumbersome in ES 2.1","user":{"login":"jprante","id":635745,"node_id":"MDQ6VXNlcjYzNTc0NQ==","avatar_url":"https://avatars1.githubusercontent.com/u/635745?v=4","gravatar_id":"","url":"https://api.github.com/users/jprante","html_url":"https://github.com/jprante","followers_url":"https://api.github.com/users/jprante/followers","following_url":"https://api.github.com/users/jprante/following{/other_user}","gists_url":"https://api.github.com/users/jprante/gists{/gist_id}","starred_url":"https://api.github.com/users/jprante/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jprante/subscriptions","organizations_url":"https://api.github.com/users/jprante/orgs","repos_url":"https://api.github.com/users/jprante/repos","events_url":"https://api.github.com/users/jprante/events{/privacy}","received_events_url":"https://api.github.com/users/jprante/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-11-27T11:03:26Z","updated_at":"2015-11-28T11:16:51Z","closed_at":"2015-11-28T11:16:51Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Testing classpath plugins in a single temporary node has become cumbersome in ES 2.1.\n\nIn ES 2.0 it was easy to use a NodeBuilder. The node started and picked up the plugins. \n\nWith ES 2.1, the NodeBuilder has been rendered useless, since it does no longer provides\nthe necessary control to load plugins from classpath.\n\nEven worse, plugin authors have to write an auxilliary class in package org.elasticsearch.node\nto be able to use the new Node class constructor to pass the classpath plugins to be tested.\nThe new class constructor has to be used in addition to the `plugin.types` setting in \nthe node settings or the plugins do not load. \n\nThese wrinkles make code longer and hard to understand/maintain for plugin authors.\n\nI suggest to enhance NodeBuilder to be able to test plugins from classpath easily, without \nthe auxilliary `MockNode` class, and without double declaration of plugins, as it was the case in ES 2.0\n\nES 2.0\n\n```\nSettings nodeSettings = Settings.settingsBuilder()\n        .put(\"path.home\", System.getProperty(\"path.home\"))\n        .put(\"plugin.types\", MyPlugin.class.getName())\n        .put(\"index.number_of_shards\", 1)\n        .put(\"index.number_of_replica\", 0)\n        .build();\nNode node = NodeBuilder.nodeBuilder().settings(nodeSettings).local(true).build().start();\nnode.start();\nreturn node;\n```\n\nES 2.1\n\n```\nSettings nodeSettings = Settings.settingsBuilder()\n        .put(\"path.home\", System.getProperty(\"path.home\"))\n        .put(\"plugin.types\", MyPlugin.class.getName())\n        .put(\"index.number_of_shards\", 1)\n        .put(\"index.number_of_replica\", 0)\n        .build();\n// ES 2.1 renders NodeBuilder as useless\n//Node node = NodeBuilder.nodeBuilder().settings(nodeSettings).local(true).build().start();\nSet<Class<? extends Plugin>> plugins = new HashSet<>();\nplugins.add(MyPlugin.class);\nNode node = new MockNode(nodeSettings, plugins);\nnode.start();\nreturn node;\n```\n\n```\npackage org.elasticsearch.node;\n\nimport org.elasticsearch.Version;\nimport org.elasticsearch.common.settings.Settings;\nimport org.elasticsearch.plugins.Plugin;\n\nimport java.util.Collection;\n\npublic class MockNode extends Node {\n\n    public MockNode(Settings settings, Collection<Class<? extends Plugin>> classpathPlugins) {\n        super(settings, Version.CURRENT, classpathPlugins);\n    }\n\n}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}