{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21893","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21893/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21893/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21893/events","html_url":"https://github.com/elastic/elasticsearch/issues/21893","id":192632828,"node_id":"MDU6SXNzdWUxOTI2MzI4Mjg=","number":21893,"title":"RecoverySourceHandler error message has source and target doc counts switched","user":{"login":"henakamaMSFT","id":8988382,"node_id":"MDQ6VXNlcjg5ODgzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8988382?v=4","gravatar_id":"","url":"https://api.github.com/users/henakamaMSFT","html_url":"https://github.com/henakamaMSFT","followers_url":"https://api.github.com/users/henakamaMSFT/followers","following_url":"https://api.github.com/users/henakamaMSFT/following{/other_user}","gists_url":"https://api.github.com/users/henakamaMSFT/gists{/gist_id}","starred_url":"https://api.github.com/users/henakamaMSFT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henakamaMSFT/subscriptions","organizations_url":"https://api.github.com/users/henakamaMSFT/orgs","repos_url":"https://api.github.com/users/henakamaMSFT/repos","events_url":"https://api.github.com/users/henakamaMSFT/events{/privacy}","received_events_url":"https://api.github.com/users/henakamaMSFT/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":152510590,"node_id":"MDU6TGFiZWwxNTI1MTA1OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Recovery","name":":Distributed/Recovery","color":"0e8a16","default":false,"description":"Anything around constructing a new shard, either from a local or a remote source."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2016-11-30T17:44:57Z","updated_at":"2018-02-13T19:36:50Z","closed_at":"2017-01-10T08:57:58Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In all versions of Elasticsearch where I've checked the source code, there's a bug in the error message for when a shard can't recover from the primary because the number of docs differ.\r\n\r\nIt lists numDocsTarget as the doc count for the source node, and numDocsSource as the doc count for the target node, but it should be the other way around. Since the only way I've found to fix these problems is to remove the shard that we've deemed to be wrong, this can be really dangerous and cause removal of the wrong shard.\r\n\r\nRelevant line of RecoverySourceHandler.java:\r\n\r\n> if (numDocsTarget != numDocsSource) {\r\n>     throw new IllegalStateException(\"try to recover \" + request.shardId() + \" from primary shard with sync id but number of docs differ: \" + **numDocsTarget** + \" (\" + **request.sourceNode().getName()** + \", primary) vs \" + **numDocsSource** + \"(\" + **request.targetNode().getName()** + \")\");\r\n> }\r\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}