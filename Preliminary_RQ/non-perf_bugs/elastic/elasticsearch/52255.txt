{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52255","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52255/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52255/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52255/events","html_url":"https://github.com/elastic/elasticsearch/issues/52255","id":563801611,"node_id":"MDU6SXNzdWU1NjM4MDE2MTE=","number":52255,"title":"[discovery-ec2] plugin should look at ENI security groups instead","user":{"login":"michael-robbins","id":1548818,"node_id":"MDQ6VXNlcjE1NDg4MTg=","avatar_url":"https://avatars1.githubusercontent.com/u/1548818?v=4","gravatar_id":"","url":"https://api.github.com/users/michael-robbins","html_url":"https://github.com/michael-robbins","followers_url":"https://api.github.com/users/michael-robbins/followers","following_url":"https://api.github.com/users/michael-robbins/following{/other_user}","gists_url":"https://api.github.com/users/michael-robbins/gists{/gist_id}","starred_url":"https://api.github.com/users/michael-robbins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michael-robbins/subscriptions","organizations_url":"https://api.github.com/users/michael-robbins/orgs","repos_url":"https://api.github.com/users/michael-robbins/repos","events_url":"https://api.github.com/users/michael-robbins/events{/privacy}","received_events_url":"https://api.github.com/users/michael-robbins/received_events","type":"User","site_admin":false},"labels":[{"id":160579278,"node_id":"MDU6TGFiZWwxNjA1NzkyNzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Discovery-Plugins","name":":Distributed/Discovery-Plugins","color":"0e8a16","default":false,"description":"Anything related to our integration plugins with EC2, GCP and Azure"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-02-12T07:18:22Z","updated_at":"2020-02-12T10:47:27Z","closed_at":"2020-02-12T10:33:18Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\ndiscovery-ec2 currently look at an instances security groups, but not any security groups attached to the network interfaces on the EC2 host.\r\n\r\nInstead it would be good if we looped over the network interfaces attached to the EC2 host, if the security group for that network interface matches what's provided in 'discovery.ec2.groups' then we use the IP address assigned to that network interface.\r\n\r\nReason: We are currently using ECS's awsvpc networking mode that creates a new network interface for every task it creates (isolating the containers networking from the host networking).\r\n\r\nThis means Elasticsearch on cluster creation cannot easily find the other master eligible nodes (can't hardcode as the IP/hostnames, as they are not known at creation/deployment time).\r\n\r\nBy knowing the Security Groups that will be attached to these dynamic network interfaces before, we *can* hardcode them, allowing us to link an IP address to an ES node, allowing for dynamically configured cluster creation.","closed_by":{"login":"michael-robbins","id":1548818,"node_id":"MDQ6VXNlcjE1NDg4MTg=","avatar_url":"https://avatars1.githubusercontent.com/u/1548818?v=4","gravatar_id":"","url":"https://api.github.com/users/michael-robbins","html_url":"https://github.com/michael-robbins","followers_url":"https://api.github.com/users/michael-robbins/followers","following_url":"https://api.github.com/users/michael-robbins/following{/other_user}","gists_url":"https://api.github.com/users/michael-robbins/gists{/gist_id}","starred_url":"https://api.github.com/users/michael-robbins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michael-robbins/subscriptions","organizations_url":"https://api.github.com/users/michael-robbins/orgs","repos_url":"https://api.github.com/users/michael-robbins/repos","events_url":"https://api.github.com/users/michael-robbins/events{/privacy}","received_events_url":"https://api.github.com/users/michael-robbins/received_events","type":"User","site_admin":false},"performed_via_github_app":null}