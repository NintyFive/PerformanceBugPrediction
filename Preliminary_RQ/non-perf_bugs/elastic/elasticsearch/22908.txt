{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22908","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22908/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22908/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22908/events","html_url":"https://github.com/elastic/elasticsearch/issues/22908","id":204640847,"node_id":"MDU6SXNzdWUyMDQ2NDA4NDc=","number":22908,"title":"Painless code generation error when returning nothing from a Function","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":511906923,"node_id":"MDU6TGFiZWw1MTE5MDY5MjM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.3.0","name":"v5.3.0","color":"DDDDDD","default":false,"description":null},{"id":334286612,"node_id":"MDU6TGFiZWwzMzQyODY2MTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.0-alpha1","name":"v6.0.0-alpha1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-02-01T16:55:53Z","updated_at":"2018-02-14T13:21:35Z","closed_at":"2017-02-03T21:38:48Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This blows up on the `Debug.explain`.\r\n\r\n```\r\nDELETE /test\r\n\r\nPUT /test\r\n{\r\n  \"settings\": {\r\n    \"number_of_replicas\": 0,\r\n    \"number_of_shards\": 2\r\n  },\r\n  \"mappings\": {\r\n    \"test\": {\r\n      \"properties\": {\r\n        \"k\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"dc\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"d\": {\r\n          \"type\": \"date\",\r\n          \"format\": \"yyyy-MM-dd\"\r\n        },\r\n        \"v\": {\r\n          \"type\": \"long\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST /test/test\r\n{\"k\": \"a\", \"dc\": \"dc1\", \"d\": \"2017-01-01\", \"v\": 1}\r\nPOST /test/test\r\n{\"k\": \"a\", \"dc\": \"dc1\", \"d\": \"2017-01-02\", \"v\": 2}\r\nPOST /test/test\r\n{\"k\": \"b\", \"dc\": \"dc1\", \"d\": \"2017-01-01\", \"v\": 3}\r\nPOST /test/test\r\n{\"k\": \"c\", \"dc\": \"dc2\", \"d\": \"2017-01-01\", \"v\": 4}\r\nPOST /test/test\r\n{\"k\": \"c\", \"dc\": \"dc2\", \"d\": \"2017-01-02\", \"v\": 5}\r\nPOST /test/_refresh\r\n\r\nPOST /test/_search?size=0\r\n{\r\n  \"aggs\": {\r\n    \"dc\": {\r\n      \"terms\": {\r\n        \"field\": \"dc\"\r\n      },\r\n      \"aggs\": {\r\n        \"k\": {\r\n          \"terms\": {\"field\": \"k\"},\r\n          \"aggs\": {\r\n            \"k\": {\r\n              \"top_hits\": {\r\n                \"size\": 1,\r\n                \"sort\": [\r\n                  {\r\n                    \"d\": {\r\n                      \"order\": \"desc\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            \"last_k\": {\r\n              \"scripted_metric\": {\r\n                \"init_script\": \"params._agg.v = 0; params._agg.t = 0\",\r\n                \"map_script\": \"if (doc.d.value > params._agg.t) {params._agg.t = doc.d.value; params._agg.v = doc.v}\",\r\n                \"reduce_script\": \"params._aggs.stream().reduce((lhs, rhs) -> lhs.t > rhs.t ? lhs.v : rhs.v).map(agg -> Debug.explain(agg)).orElse(0)\", \r\n                \"combine_script\": \"params._agg\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n```","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}