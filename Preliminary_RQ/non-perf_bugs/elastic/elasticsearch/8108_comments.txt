[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59424545","html_url":"https://github.com/elastic/elasticsearch/issues/8108#issuecomment-59424545","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8108","id":59424545,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDI0NTQ1","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T20:25:06Z","updated_at":"2014-10-16T20:25:06Z","author_association":"CONTRIBUTOR","body":"What concerns me most here is that if we have something that **needs** sampling in order to have a reasonable runtime, then I am wondering if it should be an aggregation. I can see value in sampling, but rather as a way to trade precision for speed.\n\nI think I would prefer the sampling agg to be explicit (both in the requests and responses) because this way we can have the options that are specific to sampling in the sampling aggregation and only there. And in responses, it would help know how many documents were sampled in a given bucket?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59479857","html_url":"https://github.com/elastic/elasticsearch/issues/8108#issuecomment-59479857","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8108","id":59479857,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDc5ODU3","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T08:07:51Z","updated_at":"2014-10-17T08:07:51Z","author_association":"CONTRIBUTOR","body":"> What concerns me most here is that if we have something that needs sampling in order to have a reasonable runtime, then I am wondering if it should be an aggregation\n\nThe only existing agg I'd put in that category is \"top_hits\" \n\nThe significant_terms agg as it stands today works for a large number of use cases _without_ sampling but has the potential to be slow if the query, number of docs and field cardinality combine to produce a high number of term frequency look-ups. In the movie recommendation example above, finding what movies people who watched a lesser-known movie such as \"Brazil\" liked may be quick but slow if you are querying for people who have watched a more popular movie like \"Star Wars\". \nAs it happens the MovieLens dataset of user behaviours is sufficiently small for it not to be a problem but I encountered some performance issues doing a similar analysis based on Wikipedia's link structure due to the volume of docs. A quality-based sampling helps avoid the over-linked docs that cause problems due to length-norms ranking (avoids the person who has watched ALL movies or the Wikipedia article that lists all living actors). Note this is nothing to do with \"free-text\" analytics which is a distinction we previously drew as possible justification for removing significant_terms from the aggs tree. There are structured applications of this background-frequency checking logic.\n\nIf an agg is generally fast enough but has the potential to overrun in the wrong conditions the improved timeout controls (e.g. https://github.com/elasticsearch/elasticsearch/pull/4586 ) will help steer people towards redefining the query appropriately \n\nI'm happy to start work on a sampling agg but uncertain about what your comments might mean for the future of top_hits.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75217244","html_url":"https://github.com/elastic/elasticsearch/issues/8108#issuecomment-75217244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8108","id":75217244,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MjE3MjQ0","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2015-02-20T10:26:17Z","updated_at":"2015-02-20T10:26:17Z","author_association":"CONTRIBUTOR","body":"Waiting on recent Lucene 5.1 snapshot that adds DiversifiedTopDocsCollector from https://issues.apache.org/jira/browse/LUCENE-6066. I think this is the PR that will bring this in: https://github.com/elasticsearch/elasticsearch/pull/9746\nThis means our samples can optionally have a choice of key on which to diversify e.g. max 5 tweets from the same author in our sample of 1000 top-scoring tweets. Diversity is important if you choose to sample.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75238471","html_url":"https://github.com/elastic/elasticsearch/issues/8108#issuecomment-75238471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8108","id":75238471,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MjM4NDcx","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-02-20T13:35:52Z","updated_at":"2015-02-20T13:35:52Z","author_association":"CONTRIBUTOR","body":"I just pushed the upgrade, with the new topdocscollector. Sorry for the delay.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75240567","html_url":"https://github.com/elastic/elasticsearch/issues/8108#issuecomment-75240567","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8108","id":75240567,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MjQwNTY3","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2015-02-20T13:52:25Z","updated_at":"2015-02-20T13:52:25Z","author_association":"CONTRIBUTOR","body":"Thanks! Wasn't it expecting to happen so soon. Excited to get this in.\n","performed_via_github_app":null}]