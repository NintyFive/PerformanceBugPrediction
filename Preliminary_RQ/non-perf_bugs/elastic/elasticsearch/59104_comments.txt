[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/654496735","html_url":"https://github.com/elastic/elasticsearch/issues/59104#issuecomment-654496735","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/59104","id":654496735,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDQ5NjczNQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-07-06T22:30:57Z","updated_at":"2020-07-06T22:30:57Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/Allocation)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/654655388","html_url":"https://github.com/elastic/elasticsearch/issues/59104#issuecomment-654655388","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/59104","id":654655388,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDY1NTM4OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2020-07-07T07:28:43Z","updated_at":"2020-07-07T07:28:43Z","author_association":"CONTRIBUTOR","body":"Can you reduce `cluster.routing.allocation.cluster_concurrent_rebalance` back to 2 (the default), let the cluster juggle shards for a bit and see if that helps? Based on the above settings, it also sounds like your cluster is way over-sharded.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/654741852","html_url":"https://github.com/elastic/elasticsearch/issues/59104#issuecomment-654741852","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/59104","id":654741852,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDc0MTg1Mg==","user":{"login":"awick","id":427321,"node_id":"MDQ6VXNlcjQyNzMyMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/427321?v=4","gravatar_id":"","url":"https://api.github.com/users/awick","html_url":"https://github.com/awick","followers_url":"https://api.github.com/users/awick/followers","following_url":"https://api.github.com/users/awick/following{/other_user}","gists_url":"https://api.github.com/users/awick/gists{/gist_id}","starred_url":"https://api.github.com/users/awick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awick/subscriptions","organizations_url":"https://api.github.com/users/awick/orgs","repos_url":"https://api.github.com/users/awick/repos","events_url":"https://api.github.com/users/awick/events{/privacy}","received_events_url":"https://api.github.com/users/awick/received_events","type":"User","site_admin":false},"created_at":"2020-07-07T09:58:17Z","updated_at":"2020-07-07T09:58:17Z","author_association":"NONE","body":"I forgot to put in my standard background info\r\n* I've been running large Elasticsearch clusters since 2011\r\n* I've been using the current persistent settings for several years, and the last time I even changed my elasticsearch.yml file was Nov 2019 (I use ansible so I have every version ever used)\r\n* This behavior is new, I've never seen it in any of the previous versions I've used.\r\n\r\nI will try reducing it to 2, but I don't think I can leave it that way. I forgot to mention on 1 cluster I did try changing cluster.routing.allocation.cluster_concurrent_rebalance to 0 to stop all rebalancing and let it sit for a while and then I turned back on and it started moving things again.\r\n\r\nI'm not sure what you mean by oversharding. I keep my typical shard size ~100G after force_merge\r\n\r\nIt sure seems like there is something in the disk decider or awareness algorithms that changed where it constantly thinks it can do better and never settles down. Like maybe some random seed or sort algorithm changed between versions.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/661059899","html_url":"https://github.com/elastic/elasticsearch/issues/59104#issuecomment-661059899","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/59104","id":661059899,"node_id":"MDEyOklzc3VlQ29tbWVudDY2MTA1OTg5OQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2020-07-20T14:03:31Z","updated_at":"2020-07-20T14:03:31Z","author_association":"CONTRIBUTOR","body":"> Can you reduce cluster.routing.allocation.cluster_concurrent_rebalance back to 2 (the default), let the cluster juggle shards for a bit and see if that helps?\r\n\r\nWhat's been the effect of this?\r\n\r\nAre you perhaps close to your disk watermarks, which can cause shard movements?\r\n\r\n> It sure seems like there is something in the disk decider or awareness algorithms that changed where it constantly thinks it can do better and never settles down. Like maybe some random seed or sort algorithm changed between versions.\r\n\r\nI'm not aware of any changes in 7.8.0 that would explain the behavior observed. Is there any kind of pattern you see in these relocations? For example, is it always the same shards moving back and forth? The only option I see to debug this further would be to enable debug/trace logging on `org.elasticsearch.cluster.routing.allocation`, which will create a lot of logging output on the master (so better just put as transient setting), but will perhaps provide some information as to why shards are moving.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/689167867","html_url":"https://github.com/elastic/elasticsearch/issues/59104#issuecomment-689167867","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/59104","id":689167867,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTE2Nzg2Nw==","user":{"login":"cjcenizal","id":1238659,"node_id":"MDQ6VXNlcjEyMzg2NTk=","avatar_url":"https://avatars2.githubusercontent.com/u/1238659?v=4","gravatar_id":"","url":"https://api.github.com/users/cjcenizal","html_url":"https://github.com/cjcenizal","followers_url":"https://api.github.com/users/cjcenizal/followers","following_url":"https://api.github.com/users/cjcenizal/following{/other_user}","gists_url":"https://api.github.com/users/cjcenizal/gists{/gist_id}","starred_url":"https://api.github.com/users/cjcenizal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cjcenizal/subscriptions","organizations_url":"https://api.github.com/users/cjcenizal/orgs","repos_url":"https://api.github.com/users/cjcenizal/repos","events_url":"https://api.github.com/users/cjcenizal/events{/privacy}","received_events_url":"https://api.github.com/users/cjcenizal/received_events","type":"User","site_admin":false},"created_at":"2020-09-08T22:24:07Z","updated_at":"2020-09-08T22:24:07Z","author_association":"CONTRIBUTOR","body":"No further feedback received. @awick if you have any more information for us please add it in a comment and we can look at re-opening this issue.","performed_via_github_app":null}]