[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40355044","html_url":"https://github.com/elastic/elasticsearch/issues/5770#issuecomment-40355044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5770","id":40355044,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzU1MDQ0","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2014-04-14T11:12:17Z","updated_at":"2014-04-14T11:12:17Z","author_association":"MEMBER","body":"Hey,\n\nwhat linux distribution did you try this on. The only call in question in the `prerm` script is\n\n```\nrmdir -p --ignore-fail-on-non-empty /var/lib/elasticsearch\n```\n\nAgreed, the `-p` parameter does not make a lot of sense. But apart from that you should not get any invalid error message, except that the `--ignore-fail-on-non-empty` is somehow ignored... can you try on the commandline, if it works?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40376163","html_url":"https://github.com/elastic/elasticsearch/issues/5770#issuecomment-40376163","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5770","id":40376163,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzc2MTYz","user":{"login":"XANi","id":147394,"node_id":"MDQ6VXNlcjE0NzM5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/147394?v=4","gravatar_id":"","url":"https://api.github.com/users/XANi","html_url":"https://github.com/XANi","followers_url":"https://api.github.com/users/XANi/followers","following_url":"https://api.github.com/users/XANi/following{/other_user}","gists_url":"https://api.github.com/users/XANi/gists{/gist_id}","starred_url":"https://api.github.com/users/XANi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XANi/subscriptions","organizations_url":"https://api.github.com/users/XANi/orgs","repos_url":"https://api.github.com/users/XANi/repos","events_url":"https://api.github.com/users/XANi/events{/privacy}","received_events_url":"https://api.github.com/users/XANi/received_events","type":"User","site_admin":false},"created_at":"2014-04-14T15:06:17Z","updated_at":"2014-04-14T15:06:17Z","author_association":"NONE","body":"It was install->uninstall on debian wheezy/sid (i installed 1.0.2 and realized I need older version so I purged it)\n\n\"failed to remove directory '/var/lib'\" only occurs when directory above (in my case /var/lib) is also a mount:\n\n```\n☠ mount | grep lib\n/dev/mapper/rootvg-lib on /var/lib type xfs (rw,noatime,attr2,inode64,noquota)\n/dev/mapper/rootvg-collectd on /var/lib/collectd type reiserfs (rw,noatime)\n/dev/mapper/rootvg-elasticsearch on /var/lib/elasticsearch type xfs (rw,noatime,attr2,inode64,sunit=1024,swidth=2048,noquota)\n☠ mkdir /usr/test; rmdir -p --ignore-fail-on-non-empty /usr/test\n☠ mkdir /var/lib/test; rmdir -p --ignore-fail-on-non-empty /var/lib/test\nrmdir: failed to remove directory '/var/lib'\n```\n\nbut that is basically a bug in rmdir, it should just return silently, instead:\n\n```\nmkdir /asd;rmdir -p /asd\nrmdir: failed to remove directory '/': Device or resource busy\n```\n\nand it's some old bug, as I see same behaviour on old centos 5 systems\n\nIt works if directory exists but it will fail if it is a mounted partition.\n\nIt will also fail if directory was already removed (like admin first removing mount ,then purging package).\n\nI think just ignoring exit code of rmdir should be fine.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40377784","html_url":"https://github.com/elastic/elasticsearch/issues/5770#issuecomment-40377784","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5770","id":40377784,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzc3Nzg0","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2014-04-14T15:17:57Z","updated_at":"2014-04-14T15:17:57Z","author_association":"MEMBER","body":"great explanation, thanks for digging into this.. so removing `-p` and ignoring the error seems the way to go.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40408199","html_url":"https://github.com/elastic/elasticsearch/issues/5770#issuecomment-40408199","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5770","id":40408199,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDA4MTk5","user":{"login":"XANi","id":147394,"node_id":"MDQ6VXNlcjE0NzM5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/147394?v=4","gravatar_id":"","url":"https://api.github.com/users/XANi","html_url":"https://github.com/XANi","followers_url":"https://api.github.com/users/XANi/followers","following_url":"https://api.github.com/users/XANi/following{/other_user}","gists_url":"https://api.github.com/users/XANi/gists{/gist_id}","starred_url":"https://api.github.com/users/XANi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XANi/subscriptions","organizations_url":"https://api.github.com/users/XANi/orgs","repos_url":"https://api.github.com/users/XANi/repos","events_url":"https://api.github.com/users/XANi/events{/privacy}","received_events_url":"https://api.github.com/users/XANi/received_events","type":"User","site_admin":false},"created_at":"2014-04-14T19:33:34Z","updated_at":"2014-04-14T19:33:34Z","author_association":"NONE","body":"-p only works well when used with relative paths.\n\nIf you want to clean up empty dirs,\n\n```\nfind /tmp/dir -type d -empty  -delete\n```\n\nworks much better, but still exit code have to be handled/ignored\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65388146","html_url":"https://github.com/elastic/elasticsearch/issues/5770#issuecomment-65388146","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5770","id":65388146,"node_id":"MDEyOklzc3VlQ29tbWVudDY1Mzg4MTQ2","user":{"login":"t-lo","id":71888,"node_id":"MDQ6VXNlcjcxODg4","avatar_url":"https://avatars2.githubusercontent.com/u/71888?v=4","gravatar_id":"","url":"https://api.github.com/users/t-lo","html_url":"https://github.com/t-lo","followers_url":"https://api.github.com/users/t-lo/followers","following_url":"https://api.github.com/users/t-lo/following{/other_user}","gists_url":"https://api.github.com/users/t-lo/gists{/gist_id}","starred_url":"https://api.github.com/users/t-lo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/t-lo/subscriptions","organizations_url":"https://api.github.com/users/t-lo/orgs","repos_url":"https://api.github.com/users/t-lo/repos","events_url":"https://api.github.com/users/t-lo/events{/privacy}","received_events_url":"https://api.github.com/users/t-lo/received_events","type":"User","site_admin":false},"created_at":"2014-12-03T10:41:30Z","updated_at":"2014-12-03T10:41:30Z","author_association":"CONTRIBUTOR","body":"With #7078 merged does the issue still exist?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65766570","html_url":"https://github.com/elastic/elasticsearch/issues/5770#issuecomment-65766570","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5770","id":65766570,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NzY2NTcw","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2014-12-05T09:37:41Z","updated_at":"2014-12-05T09:37:41Z","author_association":"MEMBER","body":"@t-lo you are right, this should be fixed. Closing.\n","performed_via_github_app":null}]