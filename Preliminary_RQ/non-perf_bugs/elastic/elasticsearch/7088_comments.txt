[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50598308","html_url":"https://github.com/elastic/elasticsearch/issues/7088#issuecomment-50598308","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7088","id":50598308,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTk4MzA4","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2014-07-30T10:29:54Z","updated_at":"2014-07-30T10:29:54Z","author_association":"MEMBER","body":"Hi @mal,\n\nI'm trying to reproduce this issue with your example, I actually get a different exception due to `GroovyCollections` not being allowed by the groovy sandbox. Is it possible that you are running mixed versions of Elasticsearch in your environment?\n\nCan you give me the full stacktrace of the exception?\n\nAlso, when you put the script in `config/scripts`, do you see the log message about the script being compiled by Elasticsearch?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50599183","html_url":"https://github.com/elastic/elasticsearch/issues/7088#issuecomment-50599183","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7088","id":50599183,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTk5MTgz","user":{"login":"mal","id":591257,"node_id":"MDQ6VXNlcjU5MTI1Nw==","avatar_url":"https://avatars0.githubusercontent.com/u/591257?v=4","gravatar_id":"","url":"https://api.github.com/users/mal","html_url":"https://github.com/mal","followers_url":"https://api.github.com/users/mal/followers","following_url":"https://api.github.com/users/mal/following{/other_user}","gists_url":"https://api.github.com/users/mal/gists{/gist_id}","starred_url":"https://api.github.com/users/mal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mal/subscriptions","organizations_url":"https://api.github.com/users/mal/orgs","repos_url":"https://api.github.com/users/mal/repos","events_url":"https://api.github.com/users/mal/events{/privacy}","received_events_url":"https://api.github.com/users/mal/received_events","type":"User","site_admin":false},"created_at":"2014-07-30T10:41:41Z","updated_at":"2014-07-30T10:43:19Z","author_association":"NONE","body":"Aha, it fails to compile so I guess it doesn't get found and ES assumes `lowest` is a dynamic script.\n\n```\n[2014-07-30 11:36:37,180][WARN ][script                   ] [Honcho] failed to load/compile script [lowest]\norg.elasticsearch.script.groovy.GroovyScriptCompilationException: MultipleCompilationErrorsException[startup failed:\nGeneral error during canonicalization: Method calls not allowed on [groovy.util.GroovyCollections]\n```\n\nI tried adding `groovy.util.GroovyCollections` to the `receiver_whitelist`, but that didn't work either:\n\n```\n[2014-07-30 11:39:53,907][WARN ][script                   ] [Heart Attack] failed to load/compile script [lowest]\norg.elasticsearch.script.groovy.GroovyScriptCompilationException: MultipleCompilationErrorsException[startup failed:\nGeneral error during canonicalization: Property access not allowed on [java.lang.Object]\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50599310","html_url":"https://github.com/elastic/elasticsearch/issues/7088#issuecomment-50599310","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7088","id":50599310,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTk5MzEw","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2014-07-30T10:43:31Z","updated_at":"2014-07-30T10:43:31Z","author_association":"MEMBER","body":"> I tried adding groovy.util.GroovyCollections to the receiver_whitelist, but that didn't work either:\n\nHow did you add it to the `receiver_whitelist`? I can try to reproduce it.\n\nAlso, going forward, looking at the javadoc I don't see any reason why `GroovyCollections` shouldn't be part of the default whitelist, so I will open a separate issue to add that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50599393","html_url":"https://github.com/elastic/elasticsearch/issues/7088#issuecomment-50599393","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7088","id":50599393,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTk5Mzkz","user":{"login":"mal","id":591257,"node_id":"MDQ6VXNlcjU5MTI1Nw==","avatar_url":"https://avatars0.githubusercontent.com/u/591257?v=4","gravatar_id":"","url":"https://api.github.com/users/mal","html_url":"https://github.com/mal","followers_url":"https://api.github.com/users/mal/followers","following_url":"https://api.github.com/users/mal/following{/other_user}","gists_url":"https://api.github.com/users/mal/gists{/gist_id}","starred_url":"https://api.github.com/users/mal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mal/subscriptions","organizations_url":"https://api.github.com/users/mal/orgs","repos_url":"https://api.github.com/users/mal/repos","events_url":"https://api.github.com/users/mal/events{/privacy}","received_events_url":"https://api.github.com/users/mal/received_events","type":"User","site_admin":false},"created_at":"2014-07-30T10:44:25Z","updated_at":"2014-07-30T10:44:25Z","author_association":"NONE","body":"I added the following line to `elasticsearch.yml`:\n\n```\nscript.groovy.sandbox.receiver_whitelist: groovy.util.GroovyCollections\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50599603","html_url":"https://github.com/elastic/elasticsearch/issues/7088#issuecomment-50599603","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7088","id":50599603,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTk5NjAz","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2014-07-30T10:47:32Z","updated_at":"2014-07-30T10:47:32Z","author_association":"MEMBER","body":"@mal ahh okay, this is because the whitelist has to be entirely enumerated (it replaces the default whitelist, doesn't add to it), so adding that line removed the other whitelisted classes (like `Object`).\n\nSee: https://github.com/elasticsearch/elasticsearch/blob/b43b56a6a85f7dd131086fd83dc9267aecbbf0a3/src/main/java/org/elasticsearch/script/groovy/GroovySandboxExpressionChecker.java#L90-L111\n\nI think this does need to be clarified in the docs, and it would be nice to have the functionality of both (replacing and adding to the whitelist).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50599673","html_url":"https://github.com/elastic/elasticsearch/issues/7088#issuecomment-50599673","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7088","id":50599673,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTk5Njcz","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2014-07-30T10:48:25Z","updated_at":"2014-07-30T10:48:25Z","author_association":"MEMBER","body":"Opened #7089 for adding the `GroovyCollections` class to the whitelist.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50600002","html_url":"https://github.com/elastic/elasticsearch/issues/7088#issuecomment-50600002","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7088","id":50600002,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjAwMDAy","user":{"login":"mal","id":591257,"node_id":"MDQ6VXNlcjU5MTI1Nw==","avatar_url":"https://avatars0.githubusercontent.com/u/591257?v=4","gravatar_id":"","url":"https://api.github.com/users/mal","html_url":"https://github.com/mal","followers_url":"https://api.github.com/users/mal/followers","following_url":"https://api.github.com/users/mal/following{/other_user}","gists_url":"https://api.github.com/users/mal/gists{/gist_id}","starred_url":"https://api.github.com/users/mal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mal/subscriptions","organizations_url":"https://api.github.com/users/mal/orgs","repos_url":"https://api.github.com/users/mal/repos","events_url":"https://api.github.com/users/mal/events{/privacy}","received_events_url":"https://api.github.com/users/mal/received_events","type":"User","site_admin":false},"created_at":"2014-07-30T10:52:50Z","updated_at":"2014-07-30T10:52:50Z","author_association":"NONE","body":"Ahh ok, is there any disadvantage to disabling the sandbox given dynamic scripting is already off and that an attacker would already need root access to edit installed scripts? If not I'll probably just do that for now.\n\nThanks for your help!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50600088","html_url":"https://github.com/elastic/elasticsearch/issues/7088#issuecomment-50600088","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7088","id":50600088,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjAwMDg4","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2014-07-30T10:53:51Z","updated_at":"2014-07-30T10:53:51Z","author_association":"MEMBER","body":"> Ahh ok, is there any disadvantage to disabling the sandbox given dynamic scripting is already off and that an attacker would already need root access to edit installed scripts? If not I'll probably just do that for now.\n\nYea, you can do this, disable the sandbox and since dynamic scripting is disabled by default, you'll just have to put it on disk.\n\nI'll treat this issue as an issue to update the docs, thanks for the report!\n","performed_via_github_app":null}]