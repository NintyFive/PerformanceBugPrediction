{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39467","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39467/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39467/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39467/events","html_url":"https://github.com/elastic/elasticsearch/issues/39467","id":415205463,"node_id":"MDU6SXNzdWU0MTUyMDU0NjM=","number":39467,"title":"FollowerFailOverIT.testFailOverOnFollower fails on CI","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"labels":[{"id":912824565,"node_id":"MDU6TGFiZWw5MTI4MjQ1NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CCR","name":":Distributed/CCR","color":"0e8a16","default":false,"description":"Issues around the Cross Cluster State Replication features"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":92913658,"node_id":"MDU6TGFiZWw5MjkxMzY1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/blocker","name":"blocker","color":"e11d21","default":false,"description":null},{"id":1163688906,"node_id":"MDU6TGFiZWwxMTYzNjg4OTA2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.7.0","name":"v6.7.0","color":"dddddd","default":false,"description":""},{"id":1287946339,"node_id":"MDU6TGFiZWwxMjg3OTQ2MzM5","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-rc1","name":"v7.0.0-rc1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"assignees":[{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2019-02-27T16:14:01Z","updated_at":"2019-03-25T01:39:33Z","closed_at":"2019-03-05T16:22:04Z","author_association":"MEMBER","active_lock_reason":null,"body":"The test `FollowerFailOverIT.testFailOverOnFollower` failed today on 7.0: \r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.0+internalClusterTest/1446\r\n\r\nIt does not reproduce locally with:\r\n```\r\n ./gradlew :x-pack:plugin:ccr:internalClusterTest \\\r\n  -Dtests.seed=D87CDC85B26F55B8 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.FollowerFailOverIT \\\r\n  -Dtests.method=\"testFailOverOnFollower\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=id-ID \\\r\n  -Dtests.timezone=Africa/Ndjamena \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nIt is maybe related to #35403 or #38633 but I haven't found the same exact errors so I'm opening a new issue.\r\n\r\nThe log shows some timeout issues with the `GlobalCheckpointListeners`:\r\n```\r\n14:23:04   1> [2019-02-27T15:20:06,932][TRACE][o.e.i.s.IndexShard       ] [leader1] [leader_test_failover][0] global checkpoint listener timed out\r\n14:23:04   1> java.util.concurrent.TimeoutException: 10ms\r\n14:23:04   1> \tat org.elasticsearch.index.shard.GlobalCheckpointListeners.lambda$add$3(GlobalCheckpointListeners.java:141) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n14:23:04   1> \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_202]\r\n14:23:04   1> \tat java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_202]\r\n14:23:04   1> \tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_202]\r\n14:23:04   1> \tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_202]\r\n14:23:04   1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_202]\r\n14:23:04   1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) \r\n```\r\n\r\nAnd some mismatched documents:\r\n```\r\n14:23:54    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n14:23:54    > \t\tat org.elasticsearch.xpack.CcrIntegTestCase.lambda$assertIndexFullyReplicatedToFollower$4(CcrIntegTestCase.java:505)\r\n14:23:54    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:856)\r\n14:23:54    > \t\t... 39 more\r\n14:23:54    > \tSuppressed: java.lang.AssertionError: mismatched documents [{0=[DocIdSeqNoAndTerm{id='133 seqNo=135 primaryTerm=1}, DocIdSeqNoAndTerm{id='132 seqNo=134 primaryTerm=1}, DocIdSeqNoAndTerm{id='131 seqNo=133 primaryTerm=1}]}]\r\n```\r\n\r\nI tried to isolate the relevant test log:\r\n[consoleText.txt](https://github.com/elastic/elasticsearch/files/2911173/consoleText.txt)\r\n","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}