{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7299","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7299/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7299/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7299/events","html_url":"https://github.com/elastic/elasticsearch/issues/7299","id":40373368,"node_id":"MDU6SXNzdWU0MDM3MzM2OA==","number":7299,"title":"It is possible to index a document that contains two discrete JSON objects","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":113234020,"node_id":"MDU6TGFiZWwxMTMyMzQwMjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/stalled","name":"stalled","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-08-15T18:45:57Z","updated_at":"2015-10-30T13:19:14Z","closed_at":"2015-10-30T13:19:14Z","author_association":"MEMBER","active_lock_reason":null,"body":"This is most noticeable with bulk requests because of the bulk format.  Since the newline is used as a separator, omitting a newline will index a document that contains two JSON objects.  The first JSON object is indexed properly, while the second is completely ignored (not found in the mapping, etc).\n\nHowever, this causes problems with source retrieval, search, GET, etc because the JSON is invalid.\n\nThere should either be an error returned when trying to index a document containing two (or more) discrete objects, or the non-indexed objects should be removed from the source.  The exception seems preferable so the user knows something went wrong.\n#### Reproduction (Bulk):\n\n``` bash\ncurl -XPOST \"http://localhost:9200/cars/transactions/_bulk\" -d'\n{ \"index\": {\"_id\":1}}\n{ \"price\" : 10000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-10-28\" }{ \"index\": {\"_id\":2}}\n{ \"price\" : 20000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-11-05\" }\n{ \"index\": {\"_id\":3}}\n{ \"price\" : 30000, \"color\" : \"green\", \"make\" : \"ford\", \"sold\" : \"2014-05-18\" }\n'\n\n{\n   \"took\": 72,\n   \"errors\": false,\n   \"items\": [\n      {\n         \"index\": {\n            \"_index\": \"cars\",\n            \"_type\": \"transactions\",\n            \"_id\": \"1\",\n            \"_version\": 1,\n            \"status\": 201\n         }\n      }\n   ]\n}\n```\n\n``` bash\ncurl -XGET \"http://localhost:9200/cars/transactions/1\"\n\n{\n   \"_index\":\"cars\",\n   \"_type\":\"transactions\",\n   \"_id\":\"1\",\n   \"_version\":1,\n   \"found\":true,\n   \"_source\":{\n      \"price\":10000,\n      \"color\":\"red\",\n      \"make\":\"honda\",\n      \"sold\":\"2014-10-28\"\n   }   {\n      \"index\":{\n         \"_id\":2\n      }\n   }\n}\n```\n#### Reproduction (Single Doc):\n\n``` bash\ncurl -XPOST \"http://localhost:9200/cars/transactions/5\" -d'\n{ \"price\" : 10000, \"color\" : \"red\", \"make\" : \"honda\", \"sold\" : \"2014-10-28\" }{ \"index\": {\"_id\":2}}'\n\n{\n   \"_index\": \"cars\",\n   \"_type\": \"transactions\",\n   \"_id\": \"5\",\n   \"_version\": 1,\n   \"created\": true\n}\n```\n\n``` bash\ncurl -XGET \"http://localhost:9200/cars/transactions/5\"\n\n{\n   \"_index\":\"cars\",\n   \"_type\":\"transactions\",\n   \"_id\":\"5\",\n   \"_version\":1,\n   \"found\":true,\n   \"_source\":{\n      \"price\":10000,\n      \"color\":\"red\",\n      \"make\":\"honda\",\n      \"sold\":\"2014-10-28\"\n   }   {\n      \"index\":{\n         \"_id\":2\n      }\n   }\n}\n```\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}