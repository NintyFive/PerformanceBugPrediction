{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8345","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8345/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8345/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8345/events","html_url":"https://github.com/elastic/elasticsearch/issues/8345","id":47760027,"node_id":"MDU6SXNzdWU0Nzc2MDAyNw==","number":8345,"title":"Customize advanced shard recovery strategy to alleviate split-brain impact","user":{"login":"mitkook","id":2125692,"node_id":"MDQ6VXNlcjIxMjU2OTI=","avatar_url":"https://avatars0.githubusercontent.com/u/2125692?v=4","gravatar_id":"","url":"https://api.github.com/users/mitkook","html_url":"https://github.com/mitkook","followers_url":"https://api.github.com/users/mitkook/followers","following_url":"https://api.github.com/users/mitkook/following{/other_user}","gists_url":"https://api.github.com/users/mitkook/gists{/gist_id}","starred_url":"https://api.github.com/users/mitkook/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitkook/subscriptions","organizations_url":"https://api.github.com/users/mitkook/orgs","repos_url":"https://api.github.com/users/mitkook/repos","events_url":"https://api.github.com/users/mitkook/events{/privacy}","received_events_url":"https://api.github.com/users/mitkook/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-11-04T20:19:25Z","updated_at":"2014-11-05T11:34:59Z","closed_at":"2014-11-05T11:34:59Z","author_association":"NONE","active_lock_reason":null,"body":"I post the same issue on ES forum a few months back, at: https://groups.google.com/forum/#!msg/elasticsearch/xPpH1HbAGBc/75td8RPkVUgJ.\nThanks to ES team, most of ES split-brain issues have been addressed in 1.4.x. But, during my local tests, I still found an issue after shard recovery.\n\nThe problem occurs in 2 nodes cluster with quorum size of 1. I know this is not a recommend setting by ES. But user might have specific requirement of 2 nodes cluster. And I think it is would be better to have high availability in 2 nodes cluster as well. \n\nHere is the issue with 2 nodes cluster and quorum size of 1 in 1.4.0.Beta1:\n- cut off the network between node#1 and node#2, both of nodes become master\n- then bring back the network, split-brain occurs, modify two record with different values respectively:\n  - 1st record value, modify node#1’s to A first, then node#2’s to B\n  - 2nd record value, modify node#2’s to A first, then node#1’s to B\n- after that, restart node#2, cluster turn back to normal status:\n  - node#1 is the master, records got merged.\n  - BUT, 1st record == A, 2nd record == B. That is because all primary shards located in node#1.\n- bring down node#1, node#2 become master, then bring back node#1.\n  - Now, all primary shards located in node#2. \n  - 1st record == A, 2nd record == B still. That means replica shards got synced with primary.\n\nThe above test shows we could have data loss with this kind of setting.\n**What if we could customize our advanced shard recovery strategy that, document with the latest timestamp overwrites the old one?** In this case, we could guarantee that latest modification got preserved in ES cluster, right? Is it possible to have this feature in later release? Thanks.\n\n~ Jing Liu\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}