{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33387","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33387/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33387/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33387/events","html_url":"https://github.com/elastic/elasticsearch/issues/33387","id":356882370,"node_id":"MDU6SXNzdWUzNTY4ODIzNzA=","number":33387,"title":"[ingest] Per processor metrics","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"assignees":[{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-09-04T16:16:10Z","updated_at":"2018-10-20T21:01:02Z","closed_at":"2018-10-20T21:01:02Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Currently if trying to review metrics for the ingest node, the lowest granularity is per pipeline [1].  Ideally the metrics would also show per process information too. \r\n\r\nThe current behavior of `GET _nodes/stats/ingest`\r\n```json\r\n\"nodes\": {\r\n  ...\r\n      \"ingest\": {\r\n        \"total\": {\r\n          \"count\": 25,\r\n          \"time_in_millis\": 8,\r\n          \"current\": 0,\r\n          \"failed\": 0\r\n        },\r\n        \"pipelines\": {\r\n          \"mypipeline3\": {\r\n            \"count\": 0,\r\n            \"time_in_millis\": 0,\r\n            \"current\": 0,\r\n            \"failed\": 0\r\n          },\r\n          \"mypipeline2\": {\r\n            \"count\": 6,\r\n            \"time_in_millis\": 0,\r\n            \"current\": 0,\r\n            \"failed\": 0\r\n          },\r\n          \"mypipeline\": {\r\n            \"count\": 19,\r\n            \"time_in_millis\": 8,\r\n            \"current\": 0,\r\n            \"failed\": 0\r\n          }\r\n        }\r\n      }\r\n    }\r\n```\r\n\r\nThe proposal is here is to add the same stats as the pipeline has, but also to the processor. For example:\r\n\r\n```json\r\n{\r\n   \"mypipeline\":{\r\n      \"count\":19,\r\n      \"time_in_millis\":8,\r\n      \"current\":0,\r\n      \"failed\":0,\r\n      \"processors\":[\r\n         {\r\n            \"set\":{\r\n            \"count\":19,\r\n            \"time_in_millis\":4,\r\n            \"current\":0,\r\n            \"failed\":0\r\n            }\r\n         },\r\n         {\r\n            \"rename\":{\r\n            \"count\":19,\r\n            \"time_in_millis\":4,\r\n            \"current\":0,\r\n            \"failed\":0\r\n           }\r\n         }\r\n      ]\r\n   }\r\n}\r\n```\r\n\r\n~Since each processor can have a on_failure processor, and that on_failure processor can also have multiple processors with other on_failure processors, the resultant JSON can (if pipeline are defined this way) result in quite verbose tree like structures. However, I suspect that most pipeline don't go too deep into setting multiple on_failure handlers.~\r\n\r\nEDIT: After further discussion, the on_failure processors should be considered part of the parent processor.\r\n\r\nSome recent additions to the ingest node capability should also be addressed here too. (open for discussion)\r\n* conditional `if` https://github.com/elastic/elasticsearch/pull/32398 . Attempts should be made to hide implementation details for the `if` conditional report any metrics that include the time take and/errors produced by the `if` conditional as part of the processor itself. \r\n* calling other pipelines via the pipeline processor : https://github.com/elastic/elasticsearch/pull/32473 . The pipeline processor should show as any other processor, however, the metrics for `this` pipeline AND `that` pipeline should both increase. \r\n\r\nAlso, tag's should be supported in the naming. Likely via the main name, for example `rename:my_tag` if the tag is defined. \r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-stats.html#ingest-stats","closed_by":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}