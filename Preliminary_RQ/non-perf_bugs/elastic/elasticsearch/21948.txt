{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21948","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21948/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21948/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21948/events","html_url":"https://github.com/elastic/elasticsearch/issues/21948","id":193245368,"node_id":"MDU6SXNzdWUxOTMyNDUzNjg=","number":21948,"title":"use pattern implemented for sorting within nested objects to enable decay functions to be applied to properties within nested objects","user":{"login":"rhbecker","id":224732,"node_id":"MDQ6VXNlcjIyNDczMg==","avatar_url":"https://avatars2.githubusercontent.com/u/224732?v=4","gravatar_id":"","url":"https://api.github.com/users/rhbecker","html_url":"https://github.com/rhbecker","followers_url":"https://api.github.com/users/rhbecker/followers","following_url":"https://api.github.com/users/rhbecker/following{/other_user}","gists_url":"https://api.github.com/users/rhbecker/gists{/gist_id}","starred_url":"https://api.github.com/users/rhbecker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhbecker/subscriptions","organizations_url":"https://api.github.com/users/rhbecker/orgs","repos_url":"https://api.github.com/users/rhbecker/repos","events_url":"https://api.github.com/users/rhbecker/events{/privacy}","received_events_url":"https://api.github.com/users/rhbecker/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-12-02T23:45:11Z","updated_at":"2016-12-12T14:13:23Z","closed_at":"2016-12-12T14:13:23Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:\r\n\r\nIn order to enable [decay functions](https://www.elastic.co/guide/en/elasticsearch/reference/2.0/query-dsl-function-score-query.html#function-decay) to be applied to properties within nested objects, follow the pattern implemented for [sorting within nested objects](https://www.elastic.co/guide/en/elasticsearch/reference/5.0/search-request-sort.html#nested-sorting) - i.e. allow functions like `gauss` to accept `nested_path` and `nested_filter` parameters.\r\n\r\nIf I have a property whose value is an array of nested objects like ...\r\n```\r\n\"locations\": [\r\n  {\r\n    \"name\": \"home\",\r\n    \"coordinates\": [-87, 41]\r\n  },\r\n  {\r\n    \"name\": \"work\",\r\n    \"coordinates\": [-74, 20]\r\n  }\r\n]\r\n```\r\n\r\nI could then do a search like ...\r\n```\r\nGET /my_index/_search\r\n{\r\n  \"query\": {\r\n    \"function_score\":{\r\n      \"functions\": [\r\n        {\r\n          \"gauss\": {\r\n            \"locations.coordinates\": {\r\n              \"origin\": { \"lat\": 42, \"lon\": -88 },\r\n              \"scale\": \"100km\"\r\n            }\r\n          },\r\n          \"nested_path\": \"exposedItems\"\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n`multi_value_mode` (documented [here](multi_value_mode)) would then need to understand how to evaluate the appropriate property of each nested object in deciding which to use to calculate the score - e.g. in the example above, `\"multi_value_mode\": \"min\"` would compare the `coordinates` value from both locations against `origin` and score the match based on the closer one.\r\n\r\nApologies if this is already somehow supported. I've been scouring documentation, issues in this repo, and discuss.elastic.co threads without finding much guidance on how `function_score` and nested objects are supposed to play together.","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}