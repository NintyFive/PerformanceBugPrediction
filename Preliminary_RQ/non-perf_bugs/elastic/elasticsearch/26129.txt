{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26129","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26129/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26129/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26129/events","html_url":"https://github.com/elastic/elasticsearch/issues/26129","id":249186199,"node_id":"MDU6SXNzdWUyNDkxODYxOTk=","number":26129,"title":"[CI] MixedClusterClientYamlTestSuiteIT fielddata issues","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"labels":[{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"}],"state":"closed","locked":false,"assignee":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2017-08-09T22:59:10Z","updated_at":"2017-08-10T13:37:19Z","closed_at":"2017-08-10T13:37:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"could not reproduce, but CI is failing frequently on this.\r\n\r\nlink: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-darwin-compatibility/1046/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/3850/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=opensuse/1410/console\r\n\r\n```\r\n> There were test failures: 2 suites, 689 tests, 5 failures, 17 ignored (17 assumptions) [seed: E709E299BE7B9695]\r\n\r\nREPRODUCE WITH: gradle :qa:mixed-cluster:v6.1.0-SNAPSHOT#mixedClusterTestRunner \\\r\n  -Dtests.seed=E709E299BE7B9695 \\\r\n  -Dtests.class=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=search/110_field_collapsing/field collapsing, inner_hits and maxConcurrentGroupRequests}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-IQ \\\r\n  -Dtests.timezone=Europe/Andorra\r\n\r\nREPRODUCE WITH: gradle :qa:mixed-cluster:v6.1.0-SNAPSHOT#mixedClusterTestRunner \\\r\n  -Dtests.seed=E709E299BE7B9695 \\\r\n  -Dtests.class=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=search/90_search_after/search with search_after parameter}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-IQ \\\r\n  -Dtests.timezone=Europe/Andorra\r\n\r\nREPRODUCE WITH: gradle :qa:mixed-cluster:v6.1.0-SNAPSHOT#mixedClusterTestRunner \\\r\n  -Dtests.seed=E709E299BE7B9695 \\\r\n  -Dtests.class=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=search/110_field_collapsing/field collapsing and multiple inner_hits}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-IQ \\\r\n  -Dtests.timezone=Europe/Andorra\r\n\r\nREPRODUCE WITH: gradle :qa:mixed-cluster:v6.1.0-SNAPSHOT#mixedClusterTestRunner \\\r\n  -Dtests.seed=E709E299BE7B9695 \\\r\n  -Dtests.class=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=search/110_field_collapsing/field collapsing and inner_hits}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-IQ \\\r\n  -Dtests.timezone=Europe/Andorra\r\n\r\nREPRODUCE WITH: gradle :qa:mixed-cluster:v6.1.0-SNAPSHOT#mixedClusterTestRunner \\\r\n  -Dtests.seed=E709E299BE7B9695 \\\r\n  -Dtests.class=org.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=msearch/20_typed_keys/Multisearch test with typed_keys parameter}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-IQ \\\r\n  -Dtests.timezone=Europe/Andorra\r\nStacktraces attached for these tests:\r\n\r\norg.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT test {p0=msearch/20_typed_keys/Multisearch test with typed_keys parameter}\r\norg.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT test {p0=search/110_field_collapsing/field collapsing and inner_hits}\r\norg.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT test {p0=search/110_field_collapsing/field collapsing and multiple inner_hits}\r\norg.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT test {p0=search/110_field_collapsing/field collapsing, inner_hits and maxConcurrentGroupRequests}\r\norg.elasticsearch.backwards.MixedClusterClientYamlTestSuiteIT test {p0=search/90_search_after/search with search_after parameter}\r\n```\r\n\r\nstacktrace:\r\n```\r\nCaused by: java.lang.IllegalArgumentException: Fielddata is disabled on text fields by default. Set fielddata=true on [bar] in order to load fielddata in memory by uninverting the inverted index. Note that this can however use significant memory. Alternatively use a keyword field instead.\r\n\tat org.elasticsearch.index.mapper.TextFieldMapper$TextFieldType.fielddataBuilder(TextFieldMapper.java:288) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.index.fielddata.IndexFieldDataService.getForField(IndexFieldDataService.java:115) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.index.query.QueryShardContext.getForField(QueryShardContext.java:168) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.sort.FieldSortBuilder.build(FieldSortBuilder.java:278) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.sort.SortBuilder.buildSort(SortBuilder.java:154) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.SearchService.parseSource(SearchService.java:687) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.SearchService.createContext(SearchService.java:531) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:507) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:303) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:289) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:285) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.search.SearchService$3.doRun(SearchService.java:952) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_141]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_141]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_141]\r\n[2017-08-09T06:21:35,174][DEBUG][o.e.a.s.TransportSearchAction] [node-2] [test2][1], node[5c63mMdET4-DT1RdwNdnaw], [R], s[STARTED], a[id=V4sUJ4kQRw2BgxZUlXW0NQ]: Failed to execute [SearchRequest{searchType=QUERY_THEN_FETCH, indices=[], indicesOptions=IndicesOptions[id=38, ignore_unavailable=false, allow_no_indices=true, expand_wildcards_open=true, expand_wildcards_closed=false, allow_aliases_to_multiple_indices=true, forbid_closed_indices=true, ignore_aliases=false], types=[], routing='null', preference='null', requestCache=null, scroll=null, maxConcurrentShardRequests=20, batchedReduceSize=512, preFilterShardSize=128, source={\r\n  \"sort\" : [\r\n    {\r\n      \"bar\" : {\r\n        \"order\" : \"asc\"\r\n      }\r\n    },\r\n    {\r\n      \"baz\" : {\r\n        \"order\" : \"asc\"\r\n      }\r\n    }\r\n  ]\r\n}}] lastShard [true]\r\norg.elasticsearch.transport.RemoteTransportException: [node-3][127.0.0.1:50023][indices:data/read/search[phase/query]]\r\n```","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}