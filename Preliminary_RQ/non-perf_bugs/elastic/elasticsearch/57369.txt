{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57369","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57369/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57369/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57369/events","html_url":"https://github.com/elastic/elasticsearch/issues/57369","id":627394336,"node_id":"MDU6SXNzdWU2MjczOTQzMzY=","number":57369,"title":"ES Creating too many files in /tmp","user":{"login":"lanerjo","id":20589998,"node_id":"MDQ6VXNlcjIwNTg5OTk4","avatar_url":"https://avatars2.githubusercontent.com/u/20589998?v=4","gravatar_id":"","url":"https://api.github.com/users/lanerjo","html_url":"https://github.com/lanerjo","followers_url":"https://api.github.com/users/lanerjo/followers","following_url":"https://api.github.com/users/lanerjo/following{/other_user}","gists_url":"https://api.github.com/users/lanerjo/gists{/gist_id}","starred_url":"https://api.github.com/users/lanerjo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lanerjo/subscriptions","organizations_url":"https://api.github.com/users/lanerjo/orgs","repos_url":"https://api.github.com/users/lanerjo/repos","events_url":"https://api.github.com/users/lanerjo/events{/privacy}","received_events_url":"https://api.github.com/users/lanerjo/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-05-29T16:39:26Z","updated_at":"2020-11-11T22:03:26Z","closed_at":"2020-06-09T23:06:20Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.5.2\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): openjdk-11_28\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux 3.10.0-1062.el7.x86_64 #1 SMP Thu Jul 18 20:25:13 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI am running into an issue since upgrading elasticsearch from 6.7.2 to 7.5.2, where elasticsearch is now creating 1000's of files in /tmp on the host machines.\r\nFilenames are elasticsearch-* and controller_log_*\r\nElasticsearch instances are not being restarted 1000's of times, and I have been unable to determine where these files are being created.\r\nI am aware that elasticsearch disables the periodic cleaning of the /tmp directory for elasticsearch related files. But creating 1000 files per day is unacceptable, this will cause system instability and many other issues.\r\n\r\n    prw-------  1 elasticsearch    elasticsearch          0 May 26 19:03 controller_log_99392\r\n    prw-------  1 elasticsearch    elasticsearch          0 May 26 17:18 controller_log_99520\r\n    prw-------  1 elasticsearch    elasticsearch          0 May 26 19:03 controller_log_99621\r\n    prw-------  1 elasticsearch    elasticsearch          0 May 26 18:14 controller_log_9965\r\n    prw-------  1 elasticsearch    elasticsearch          0 May 26 17:18 controller_log_99761\r\n    prw-------  1 elasticsearch    elasticsearch          0 May 27 09:20 controller_log_9987\r\n    prw-------  1 elasticsearch    elasticsearch          0 May 26 17:18 controller_log_99958\r\nand\r\n\r\n    drwx------  2 elasticsearch    elasticsearch       4096 May 27 04:13 elasticsearch-9900697386538499675\r\n    drwx------  2 elasticsearch    elasticsearch       4096 May 26 15:59 elasticsearch- 9906081905532042965\r\n    drwx------  2 elasticsearch    elasticsearch       4096 May 26 20:32 elasticsearch-9934128230626817962\r\n    drwx------  2 elasticsearch    elasticsearch       4096 May 26 19:38 elasticsearch-9959566056361653972\r\n    drwx------  2 elasticsearch    elasticsearch       4096 May 27 04:42 elasticsearch-9967643642543549351\r\n    drwx------  2 elasticsearch    elasticsearch       4096 May 26 23:50 elasticsearch-9987506565151338674\r\n    drwx------  2 elasticsearch    elasticsearch       4096 May 26 16:18 elasticsearch-999953937332847863\r\nHere are the counts of the files from one node that was cleared out completely yesterday. As you can see if this is not cleaned up regularly, it will (has in my case) cause an out of iNode issue.\r\n\r\n    ls -lah | grep controller_log | wc -l\r\n    1103\r\n\r\n    ls -lah | grep elasticsearch- | wc -l\r\n    1104\r\nOutput from ps -ef\r\n\r\n    ps -ef | grep elastic\r\n    496      135301      1 80 Mar17 ?        56-21:38:51 /usr/java/openjdk-11_28/jdk-11/bin/java - Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.numDirectArenas=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.locale.providers=COMPAT -Xms30500m -Xmx30500m -Xlog:gc*,gc+age=trace,safepoint:file=/var/log/elasticsearch/es-data0/es_gc_%t_%p.log:utctime,pid,tags:filecount=5,filesize=64m -Djna.tmpdir=/home/elasticsearch/jnatmp -XX:+UseG1GC -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30 -XX:G1HeapRegionSize=16m -XX:MaxGCPauseMillis=200 -XX:ParallelGCThreads=5 -XX:ConcGCThreads=5 -server -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.type=unpooled -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Dlog4j.skipJansi=true -XX:+HeapDumpOnOutOfMemoryError -verbose:gc -Djdk.tls.ephemeralDHKeySize=2048 -XX:MaxDirectMemorySize=15997075456 -Des.path.home=/usr/share/elasticsearch -Des.path.conf=/etc/elasticsearch/es-data0 -Des.distribution.flavor=default -Des.distribution.type=rpm -Des.bundled_jdk=true -cp /usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch -p /var/run/elasticsearch-es-data0/elasticsearch-es-data0.pid -d\r\n    496      135733      1 92 Mar17 ?        65-16:46:49 /usr/java/openjdk-11_28/jdk-11/bin/java -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.numDirectArenas=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.locale.providers=COMPAT -Xms30500m -Xmx30500m -Xlog:gc*,gc+age=trace,safepoint:file=/var/log/elasticsearch/es-data1/es_gc_%t_%p.log:utctime,pid,tags:filecount=5,filesize=64m -Djna.tmpdir=/home/elasticsearch/jnatmp -XX:+UseG1GC -XX:G1ReservePercent=25 -XX:InitiatingHeapOccupancyPercent=30 -XX:G1HeapRegionSize=16m -XX:MaxGCPauseMillis=200 -XX:ParallelGCThreads=5 -XX:ConcGCThreads=5 -server -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -Dio.netty.allocator.type=unpooled -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Dlog4j.skipJansi=true -XX:+HeapDumpOnOutOfMemoryError -verbose:gc -Djdk.tls.ephemeralDHKeySize=2048 -XX:MaxDirectMemorySize=15997075456 -Des.path.home=/usr/share/elasticsearch -Des.path.conf=/etc/elasticsearch/es-data1 -Des.distribution.flavor=default -Des.distribution.type=rpm -Des.bundled_jdk=true -cp /usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch -p /var/run/elasticsearch-es-data1/elasticsearch-es-data1.pid -d\r\n    496      136037 135301  0 Mar17 ?        00:00:00 /usr/share/elasticsearch/modules/x-pack-ml/platform/linux-x86_64/bin/controller\r\n    496      136701 135733  0 Mar17 ?        00:00:00 /usr/share/elasticsearch/modules/x-pack-ml/platform/linux-x86_64/bin/controller\r\nX-pack machine learning is supposed to be disabled.\r\n\r\n    xpack.ml.enabled: false\r\n    xpack.monitoring.enabled: false\r\n    xpack.watcher.enabled: false\r\n\r\n\r\n\r\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}