[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/166700675","html_url":"https://github.com/elastic/elasticsearch/issues/15609#issuecomment-166700675","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15609","id":166700675,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NjcwMDY3NQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-22T18:44:56Z","updated_at":"2015-12-22T18:44:56Z","author_association":"CONTRIBUTOR","body":"Can you check how `measure` is mapped on all types of the following indices:\n- index1_2015-12-19\n- index1_2015-12-20\n- index1_2015-12-21\n- index1_2015-12-22\n- index1_2015-12-23\n\nIf it is mapped as a double on any of these types, then it is the cause of the issue that you are seeing.\n\nOtherwise it could mean that you are hit by this bug: #8688.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/166706522","html_url":"https://github.com/elastic/elasticsearch/issues/15609#issuecomment-166706522","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15609","id":166706522,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NjcwNjUyMg==","user":{"login":"prog8","id":6692291,"node_id":"MDQ6VXNlcjY2OTIyOTE=","avatar_url":"https://avatars0.githubusercontent.com/u/6692291?v=4","gravatar_id":"","url":"https://api.github.com/users/prog8","html_url":"https://github.com/prog8","followers_url":"https://api.github.com/users/prog8/followers","following_url":"https://api.github.com/users/prog8/following{/other_user}","gists_url":"https://api.github.com/users/prog8/gists{/gist_id}","starred_url":"https://api.github.com/users/prog8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prog8/subscriptions","organizations_url":"https://api.github.com/users/prog8/orgs","repos_url":"https://api.github.com/users/prog8/repos","events_url":"https://api.github.com/users/prog8/events{/privacy}","received_events_url":"https://api.github.com/users/prog8/received_events","type":"User","site_admin":false},"created_at":"2015-12-22T19:12:56Z","updated_at":"2015-12-22T19:12:56Z","author_association":"NONE","body":"On all types this field is mapped to long \n\n```\n\"measure\" : {\n            \"type\" : \"long\",\n            \"doc_values\" : true\n          }\n```\n\nI realized that now it fails also when I query single index (index1_2015-12-22 and index1_2015-12-21). Maybe you are right that I hit the bug #8688\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/166741949","html_url":"https://github.com/elastic/elasticsearch/issues/15609#issuecomment-166741949","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15609","id":166741949,"node_id":"MDEyOklzc3VlQ29tbWVudDE2Njc0MTk0OQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-22T22:01:04Z","updated_at":"2015-12-22T22:01:04Z","author_association":"CONTRIBUTOR","body":"Thanks for checking. Then I confirm it is very likely caused by #8688. Unfortunately it is required to reindex the data in order to fix the problem. The only way to prevent it from happening is to either map fields explicitly or use dynamic templates to that elasticsearch never has to decide whether to use a long or a double by itself.\n\nThe issue is fixed in 2.0, but you could still have the issue when querying multiple indices. For instance if the first document that is indexed looks like the following:\n\n```\n{\n  \"measure\": 3.0\n}\n```\n\nthen the field will be mapped as a double, so if you run an aggregation against several indices including this one and another index that has the field mapped as a long, then you could still get this exception.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/166749964","html_url":"https://github.com/elastic/elasticsearch/issues/15609#issuecomment-166749964","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15609","id":166749964,"node_id":"MDEyOklzc3VlQ29tbWVudDE2Njc0OTk2NA==","user":{"login":"prog8","id":6692291,"node_id":"MDQ6VXNlcjY2OTIyOTE=","avatar_url":"https://avatars0.githubusercontent.com/u/6692291?v=4","gravatar_id":"","url":"https://api.github.com/users/prog8","html_url":"https://github.com/prog8","followers_url":"https://api.github.com/users/prog8/followers","following_url":"https://api.github.com/users/prog8/following{/other_user}","gists_url":"https://api.github.com/users/prog8/gists{/gist_id}","starred_url":"https://api.github.com/users/prog8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prog8/subscriptions","organizations_url":"https://api.github.com/users/prog8/orgs","repos_url":"https://api.github.com/users/prog8/repos","events_url":"https://api.github.com/users/prog8/events{/privacy}","received_events_url":"https://api.github.com/users/prog8/received_events","type":"User","site_admin":false},"created_at":"2015-12-22T22:24:05Z","updated_at":"2015-12-22T22:24:05Z","author_association":"NONE","body":"I'm considering adding a raw \"sub-field\" to measure field which would be string. This will prevent from terms aggregation problems. I checked and a few other aggregations work (avg, min, max) so raw field should resolve all problems, including the case you mentioned\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/166761206","html_url":"https://github.com/elastic/elasticsearch/issues/15609#issuecomment-166761206","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15609","id":166761206,"node_id":"MDEyOklzc3VlQ29tbWVudDE2Njc2MTIwNg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-22T23:24:29Z","updated_at":"2015-12-22T23:24:29Z","author_association":"CONTRIBUTOR","body":"@prog8 if you control the mappings, then let's map the field explicitly when creating the index (possibly via index templates) as a long instead of using sub fields?\n","performed_via_github_app":null}]