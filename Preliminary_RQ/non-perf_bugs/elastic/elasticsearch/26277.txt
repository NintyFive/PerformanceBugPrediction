{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26277","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26277/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26277/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26277/events","html_url":"https://github.com/elastic/elasticsearch/issues/26277","id":251196143,"node_id":"MDU6SXNzdWUyNTExOTYxNDM=","number":26277,"title":"when i use fvh to highlight my search result, i find that the highlight is dislocation","user":{"login":"th72228120","id":9714377,"node_id":"MDQ6VXNlcjk3MTQzNzc=","avatar_url":"https://avatars3.githubusercontent.com/u/9714377?v=4","gravatar_id":"","url":"https://api.github.com/users/th72228120","html_url":"https://github.com/th72228120","followers_url":"https://api.github.com/users/th72228120/followers","following_url":"https://api.github.com/users/th72228120/following{/other_user}","gists_url":"https://api.github.com/users/th72228120/gists{/gist_id}","starred_url":"https://api.github.com/users/th72228120/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/th72228120/subscriptions","organizations_url":"https://api.github.com/users/th72228120/orgs","repos_url":"https://api.github.com/users/th72228120/repos","events_url":"https://api.github.com/users/th72228120/events{/privacy}","received_events_url":"https://api.github.com/users/th72228120/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-08-18T09:53:14Z","updated_at":"2017-08-18T10:13:36Z","closed_at":"2017-08-18T10:07:59Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**: \r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 2.3.3\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 1.8.0_74\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nwhen i use fvh to highlight my search result, i find that the highlight is dislocation\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. create index and add mapping\r\ncurl web1:6200/test_1/_mapping?pretty\r\n{\r\n  \"test_1\" : {\r\n    \"mappings\" : {\r\n      \"mtype\" : {\r\n        \"properties\" : {\r\n          \"doc\" : {\r\n            \"type\" : \"string\",\r\n            \"term_vector\" : \"with_positions_offsets\",\r\n            \"analyzer\" : \"ik\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n 2. insert a document\r\ncurl -XPUT web1:6200/test_1/mtype/2 -d '{\"doc\":[\"泌尿系疾病\", \"结核\", \"细菌感染和真菌病\", \"结核病后遗症\", \"(1)2型糖尿病 糖尿病肾病IV期 糖尿病足清创术后（左足）（2） 陈旧性肺结核（右肺上叶）\", \"呼吸道疾病\", \"陈旧性肺结核\", \"血管疾病\", \"腿溃疡\", \"皮肤和结缔组织疾病\", \"糖尿病血管病变\", \"糖尿病神经病变\", \"糖尿病足\", \"放线菌目感染\", \"足溃疡\", \"糖尿病\", \"葡萄糖代谢障碍\", \"呼吸道感染\", \"营养和代谢性疾病\", \"分枝杆菌感染\", \"未特指的糖尿病\", \"肺结核\", \"肾疾病\", \"(1)2型糖尿病 糖尿病肾病IV期 糖尿病足清创术后(左足)(2) 陈旧性肺结核(右肺上叶)\", \"糖尿病肾病\", \"糖尿病并发症\", \"糖尿病肾病IV期\", \"细菌感染\", \"代谢疾病\", \"皮肤疾病\", \"女性泌尿生殖系统疾病\", \"呼吸道结核和未特指结核的后遗症\", \"未特指的糖尿病伴有周围循环 并发症\", \"革兰氏阳性菌感染\", \"心血管疾病\", \"内分泌系统疾病\", \"2型糖尿病\", \"肺疾病\", \"非胰岛素依赖型糖尿病\", \"男性泌尿生殖系统疾病\", \"皮肤溃疡\", \"非胰岛素依赖型糖尿病不伴有并发症\"]}'\r\n\r\n 3.search with highlight\r\n{\r\n    \"query\":{\r\n        \"multi_match\": {\r\n                        \"slop\": 2,\r\n                        \"fields\": [\r\n                          \"doc\"\r\n                        ],\r\n                        \"minimum_should_match\": 1,\r\n                        \"operator\": \"and\",\r\n                        \"query\": \"2型糖尿病\",\r\n                        \"type\": \"phrase\"\r\n                      }\r\n        },\r\n    \"highlight\":{\r\n        \"fields\":{\r\n            \"doc\":{\r\n                  \"fragment_size\": 18,\r\n                  \"number_of_fragments\": 15,\r\n                  \"boundary_chars\":  \".,!? ，。！？、\" \r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n4. the return is like this:\r\n{\r\n  \"took\" : 4,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 1,\r\n    \"max_score\" : 0.26849622,\r\n    \"hits\" : [{\r\n      \"_index\" : \"test_1\",\r\n      \"_type\" : \"mtype\",\r\n      \"_id\" : \"2\",\r\n      \"_score\" : 0.17439342,\r\n      \"_source\" : {\r\n        \"doc\" : [ \"泌尿系疾病\", \"结核\", \"细菌感染和真菌病\", \"结核病后遗症\", \"(1)2型糖尿病 糖尿病肾病IV期 糖尿病足清创术后（左足）（2） 陈旧性肺结核（右肺上叶）\", \"呼吸道疾病\", \"陈旧性肺结核\", \"血管疾病\", \"腿溃疡\", \"皮肤和结缔组织疾病\", \"糖尿病血管病变\", \"糖尿病神经病变\", \"糖尿病足\", \"放线菌目感染\", \"足溃疡\", \"糖尿病\", \"葡萄糖代谢障碍\", \"呼吸道感染\", \"营养和代谢性疾病\", \"分枝杆菌感染\", \"未特指的糖尿病\", \"肺结核\", \"肾疾病\", \"(1)2型糖尿病 糖尿病肾病IV期 糖尿病足清创术后(左足)(2) 陈旧性肺结核(右肺上叶)\", \"糖尿病肾病\", \"糖尿病并发症\", \"糖尿病肾病IV期\", \"细菌感染\", \"代谢疾病\", \"皮肤疾病\", \"女性泌尿生殖系统疾病\", \"呼吸道结核和未特指结核的后遗症\", \"未特指的糖尿病伴有周围循环并发症\", \"革兰氏阳性菌感染\", \"心血管疾病\", \"内分泌系统疾病\", \"2型糖尿病\", \"肺疾病\", \"非胰岛素依赖型糖尿病\", \"男性泌尿生殖系统疾病\", \"皮肤溃疡\", \"非胰岛素依赖型糖尿病不伴有并发症\" ]\r\n      },\r\n      \"highlight\" : {\r\n        \"doc\" : [ \"(1)\\<em\\>2型糖尿病\\</em\\> 糖尿病肾病IV期\", \"(1\\<em\\>)2型糖尿\\</em\\>病 糖尿病肾病IV期\", \"内分泌系统疾\\<em\\>病\\</em\\>\", \"\\<em\\>2型糖\\</em\\>尿病\" ]\r\n      }\r\n    } ]\r\n  }\r\n}\r\n\r\n one of the highlight is \"\\<em\\>2型糖\\</em\\>尿病\". but it should be \"\\<em\\>2型糖尿病\\</em\\>\".\r\nso what should I do to resolve this problem? please give me some suggestions, thanks .\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}