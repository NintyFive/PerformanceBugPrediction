[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/382418966","html_url":"https://github.com/elastic/elasticsearch/issues/29580#issuecomment-382418966","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29580","id":382418966,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MjQxODk2Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-18T15:03:30Z","updated_at":"2018-04-18T15:03:30Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/382723573","html_url":"https://github.com/elastic/elasticsearch/issues/29580#issuecomment-382723573","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29580","id":382723573,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MjcyMzU3Mw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-04-19T12:55:13Z","updated_at":"2018-04-19T12:55:13Z","author_association":"MEMBER","body":"What sort of sub-aggs are you wanting to run on the top_hits?  Metric style aggs (min, max, avg, etc)?  Or are you using top_hits for sorting purposes?\r\n\r\nThe new [bucket_sort](https://www.elastic.co/guide/en/elasticsearch/reference/6.x/search-aggregations-pipeline-bucket-sort-aggregation.html) pipeline agg can help in some of the sorting use-cases.\r\n\r\nFor metrics, you can sometimes re-arrange your aggregation tree in a way to get what you need, without relying on top_hits.  \r\n\r\nThe limitation around sub-aggs and top_hits still exists, nothing has changed on that front in the framework.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383518624","html_url":"https://github.com/elastic/elasticsearch/issues/29580#issuecomment-383518624","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29580","id":383518624,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzUxODYyNA==","user":{"login":"jstrassb","id":21360627,"node_id":"MDQ6VXNlcjIxMzYwNjI3","avatar_url":"https://avatars3.githubusercontent.com/u/21360627?v=4","gravatar_id":"","url":"https://api.github.com/users/jstrassb","html_url":"https://github.com/jstrassb","followers_url":"https://api.github.com/users/jstrassb/followers","following_url":"https://api.github.com/users/jstrassb/following{/other_user}","gists_url":"https://api.github.com/users/jstrassb/gists{/gist_id}","starred_url":"https://api.github.com/users/jstrassb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jstrassb/subscriptions","organizations_url":"https://api.github.com/users/jstrassb/orgs","repos_url":"https://api.github.com/users/jstrassb/repos","events_url":"https://api.github.com/users/jstrassb/events{/privacy}","received_events_url":"https://api.github.com/users/jstrassb/received_events","type":"User","site_admin":false},"created_at":"2018-04-23T09:48:57Z","updated_at":"2018-04-23T09:48:57Z","author_association":"NONE","body":"Thanks for the input @polyfractal! They do indeed want to have a sum aggregation on the top_hits.\r\n\r\nBasically they want to use top_hits to get the most recent documents only and then sum up their sizes. E.g.\r\n```\r\n  { \"name\": \"foo\", \"size\": 123, \"tstamp\": \"2018-01-01\" }\r\n  { \"name\": \"foo\", \"size\": 456, \"tstamp\": \"2018-02-02\" }\r\n  { \"name\": \"bar\", \"size\": 789, \"tstamp\": \"2018-01-01\" }     \r\n``` \r\nOnly summing up the more recent foo (456) and bar.\r\n\r\nBucket_sort seems exactly what they would need, only they are still on 5.6. Will ask if upgrading would be an option.","performed_via_github_app":null}]