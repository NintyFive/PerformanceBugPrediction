{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20101","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20101/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20101/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20101/events","html_url":"https://github.com/elastic/elasticsearch/issues/20101","id":172420678,"node_id":"MDU6SXNzdWUxNzI0MjA2Nzg=","number":20101,"title":"Match parent docs & root in nested query","user":{"login":"rainbow-alex","id":613752,"node_id":"MDQ6VXNlcjYxMzc1Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/613752?v=4","gravatar_id":"","url":"https://api.github.com/users/rainbow-alex","html_url":"https://github.com/rainbow-alex","followers_url":"https://api.github.com/users/rainbow-alex/followers","following_url":"https://api.github.com/users/rainbow-alex/following{/other_user}","gists_url":"https://api.github.com/users/rainbow-alex/gists{/gist_id}","starred_url":"https://api.github.com/users/rainbow-alex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rainbow-alex/subscriptions","organizations_url":"https://api.github.com/users/rainbow-alex/orgs","repos_url":"https://api.github.com/users/rainbow-alex/repos","events_url":"https://api.github.com/users/rainbow-alex/events{/privacy}","received_events_url":"https://api.github.com/users/rainbow-alex/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-08-22T10:39:23Z","updated_at":"2018-09-07T08:07:08Z","closed_at":"2018-03-21T20:41:20Z","author_association":"NONE","active_lock_reason":null,"body":"In my app I am building complex queries on documents containing nested documents. The queries are built on the fly from user input combined with configurable authorization rules. (Needless to say the queries get quite complex.) I am running into trouble when I need to logically combine (using and/or/not) queries on the root document with queries on a _single_ nested document.\n\nIn its simplest form:\n\n```\n{root query 1 OR nested query 1} AND {root query 2 OR nested query 2}\n```\n\nWhere nested query 1 & 2 should pertain to the same nested document. This is only possible if the nested queries are written as a single nested query, with the boolean combinator inside; but then the root queries have no fields to match...\n\n@markharwood suggested [rewriting the query](https://discuss.elastic.co/t/query-on-fields-of-owning-document-inside-nested-query/58369) but I am not sure that is logically possible in all cases. In any case it is very inconvenient whether you are writing queries by hand or building them some other way.\n\n**Is it possible to provide a '`reverse_nested`' query that goes back to a parent document/root context?** Logically this query would return to a parent context to evaluate the given filter.\n\nP.S. My current workaround is copying the required root fields to each nested document -- :(\n","closed_by":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"performed_via_github_app":null}