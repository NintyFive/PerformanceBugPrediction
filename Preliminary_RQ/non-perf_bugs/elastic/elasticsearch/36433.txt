{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36433","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36433/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36433/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36433/events","html_url":"https://github.com/elastic/elasticsearch/issues/36433","id":389329901,"node_id":"MDU6SXNzdWUzODkzMjk5MDE=","number":36433,"title":"Error using two synonym file filters with overlapping tokens in same chain","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-12-10T14:37:05Z","updated_at":"2018-12-17T23:12:06Z","closed_at":"2018-12-10T19:47:32Z","author_association":"MEMBER","active_lock_reason":null,"body":"This was originally reported in https://discuss.elastic.co/t/invalid-synonym-rule-when-using-two-files/158603 and I think its worth discussing\r\nwhether it is a bug or at least an unexpected behaviour that we could try tackling in a future enhancement.\r\n\r\nThe situation is as follows: two distinct, e.g. language specific synonym files are used, like in the discuss issue.\r\n\r\n`en_synonyms file` :\r\n```\r\ncereal, semolina, wheat\r\n```\r\n`fr_synonyms file `:\r\n```\r\nble, cereale, wheat\r\n```\r\n\r\nNow, using those in separate synonym filters like so:\r\n```\r\nPUT test_index\r\n{\r\n  \"mappings\": {\r\n    \"wheat\": {\r\n      \"properties\": {\r\n        \"description\": {\r\n          \"type\": \"text\",\r\n          \"fields\": {\r\n            \"synonyms\": {\r\n              \"type\": \"text\",\r\n              \"analyzer\": \"syn_text\"\r\n            },\r\n            \"keyword\": {\r\n             \"type\": \"keyword\",\r\n              \"ignore_above\": 256\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"settings\": {\r\n    \"number_of_shards\": 1,\r\n    \"analysis\": {\r\n      \"filter\": {\r\n        \"en_synonyms\": {\r\n          \"type\": \"synonym\",\r\n          \"tokenizer\": \"keyword\",\r\n          \"synonyms_path\" : \"en_synonyms.txt\"\r\n        },\r\n        \"fr_synonyms\": {\r\n          \"type\": \"synonym\",\r\n          \"tokenizer\": \"keyword\",\r\n          \"synonyms_path\" : \"fr_synonyms.txt\"\r\n        }\r\n      },\r\n      \"analyzer\": {\r\n        \"syn_text\": {\r\n          \"tokenizer\": \"standard\",\r\n          \"filter\": [\"lowercase\", \"en_synonyms\", \"fr_synonyms\" ]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nResults in the following error:\r\n```\r\n\"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"failed to build synonyms\",\r\n    \"caused_by\": {\r\n      \"type\": \"parse_exception\",\r\n      \"reason\": \"Invalid synonym rule at line 1\",\r\n      \"caused_by\": {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"term: wheat analyzed to a token (cereal) with position increment != 1 (got: 0)\"\r\n      }\r\n    }\r\n```\r\n\r\nThe same works with in-place `synonyms` definition, also when the two files are simply concatenated into one and only one filter is used.\r\nThere might be reasons for this behaviour in which case we might want to document it better, but at least to me the behaviour is irritating.","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}