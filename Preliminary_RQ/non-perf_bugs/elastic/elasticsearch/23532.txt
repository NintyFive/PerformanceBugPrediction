{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23532","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23532/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23532/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23532/events","html_url":"https://github.com/elastic/elasticsearch/issues/23532","id":213245350,"node_id":"MDU6SXNzdWUyMTMyNDUzNTA=","number":23532,"title":"I use docker-compose build a es cluster, how to connect it ?","user":{"login":"silence-liu","id":20079928,"node_id":"MDQ6VXNlcjIwMDc5OTI4","avatar_url":"https://avatars0.githubusercontent.com/u/20079928?v=4","gravatar_id":"","url":"https://api.github.com/users/silence-liu","html_url":"https://github.com/silence-liu","followers_url":"https://api.github.com/users/silence-liu/followers","following_url":"https://api.github.com/users/silence-liu/following{/other_user}","gists_url":"https://api.github.com/users/silence-liu/gists{/gist_id}","starred_url":"https://api.github.com/users/silence-liu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/silence-liu/subscriptions","organizations_url":"https://api.github.com/users/silence-liu/orgs","repos_url":"https://api.github.com/users/silence-liu/repos","events_url":"https://api.github.com/users/silence-liu/events{/privacy}","received_events_url":"https://api.github.com/users/silence-liu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-03-10T05:04:48Z","updated_at":"2017-03-10T06:37:52Z","closed_at":"2017-03-10T05:15:25Z","author_association":"NONE","active_lock_reason":null,"body":"I used docker-compose build a es cluster and reference official documents。 link:https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html\r\nI found that each of the docker-container Ip are automatically generated, and we are in the same network, we can't connect es cluster, I would like to ask this is because I configuration wrong?\r\n\r\ndocker-compose.yml 设置：\r\n```\r\nversion: '2'\r\nservices:\r\n  es_balance:\r\n    image: elasticsearch_master:2.0\r\n    container_name: es_balance\r\n    environment:\r\n      - cluster.name=elasticsearch-cluster\r\n      - bootstrap.memory_lock=true\r\n      - \"ES_JAVA_OPTS=-Xms512m -Xmx512m\"\r\n      - node.master=false \r\n      - node.data=false \r\n    ulimits:\r\n      memlock:\r\n        soft: -1\r\n        hard: -1\r\n      nofile:\r\n        soft: 65536\r\n        hard: 65536\r\n    mem_limit: 1g\r\n    cap_add:\r\n      - IPC_LOCK\r\n    ports:\r\n      - 9200:9200\r\n    networks:\r\n      - esnet\r\n  es_cluster:\r\n    image: elasticsearch_slave:2.0\r\n    environment:\r\n      - cluster.name=elasticsearch-cluster\r\n      - bootstrap.memory_lock=true\r\n      - \"ES_JAVA_OPTS=-Xms512m -Xmx512m\"\r\n      - \"discovery.zen.ping.unicast.hosts=es_balance\"\r\n    ulimits:\r\n      memlock:\r\n        soft: -1\r\n        hard: -1\r\n      nofile:\r\n        soft: 65536\r\n        hard: 65536\r\n    mem_limit: 1g\r\n    cap_add:\r\n      - IPC_LOCK\r\n    networks:\r\n      - esnet\r\nnetworks:\r\n  esnet:\r\n    driver: bridge\r\n```\r\nvisit http://local:9200/_cat/nodes?v\r\n![image](https://cloud.githubusercontent.com/assets/20079928/23781270/0dba057c-0587-11e7-944f-2897be43b6dd.png)\r\nvisit http://local:9200/_cat/indices?v\r\n![image](https://cloud.githubusercontent.com/assets/20079928/23781330/8625640c-0587-11e7-984d-52ad3b242d64.png)\r\n\r\nJavaCode:\r\n\r\n`String masterHost = \"172.18.0.3\";\r\n\r\nString bakHost = \"172.18.0.2\";\r\n\r\n// on startup\r\n\r\nSettings settings = Settings.builder()\r\n\r\n.put(\"cluster.name\", \"elasticsearch-cluster\").build();\r\n\r\n\r\n\r\nTransportClient client = new PreBuiltTransportClient(settings)\r\n\r\n.addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(masterHost), 9300));\r\n\r\n//.addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(bakHost), 9300));\r\n\r\n\r\n\r\n//Get API\r\n\r\nGetResponse response = client.prepareGet(\"face\", \"summary\", \"AVqxwjBi2zdNu9G4HdIc\").get();\r\n\r\n\r\n\r\n\r\n\r\nMap<String, Object> source = response.getSource();\r\n\r\n\r\n\r\nsource.forEach((k,v)->System.out.println(\"------\"+k));`\r\n\r\nException : \r\nException in thread \"main\" NoNodeAvailableException[None of the configured nodes are available: [{#transport#-1}{BrxMkowhS9S9dZwmZcaEWg}{bigdata4.gds.com}{192.168.0.204:9300}]]\r\nat org.elasticsearch.client.transport.TransportClientNodesService.ensureNodesAreAvailable(TransportClientNodesService.java:344)\r\nat org.elasticsearch.client.transport.TransportClientNodesService.execute(TransportClientNodesService.java:242)\r\nat org.elasticsearch.client.transport.TransportProxyClient.execute(TransportProxyClient.java:59)\r\nat org.elasticsearch.client.transport.TransportClient.doExecute(TransportClient.java:356)\r\nat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:403)\r\nat org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:80)\r\nat org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:54)\r\nat org.elasticsearch.action.ActionRequestBuilder.get(ActionRequestBuilder.java:62)\r\nat gds.bigdata.elk.TestAPIDemo.main(TestAPIDemo.java:26)\r\n\r\nI think this is network problem? please give me some suguestion. 3Q!\r\nall of docker-compose.yml use image is official image, I renamed it !\r\n\r\n\r\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}