[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17309878","html_url":"https://github.com/elastic/elasticsearch/issues/2968#issuecomment-17309878","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2968","id":17309878,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzA5ODc4","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2013-05-01T22:12:12Z","updated_at":"2013-05-01T22:12:12Z","author_association":"MEMBER","body":"you need to wrap the `filtered` element in a `query` element, we should fail if this structure is provided..., can you provide with a full curl recreation, so we can see why we don't fail with this malformed search request, and we will fix it?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17310071","html_url":"https://github.com/elastic/elasticsearch/issues/2968#issuecomment-17310071","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2968","id":17310071,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzEwMDcx","user":{"login":"tishma","id":4130604,"node_id":"MDQ6VXNlcjQxMzA2MDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/4130604?v=4","gravatar_id":"","url":"https://api.github.com/users/tishma","html_url":"https://github.com/tishma","followers_url":"https://api.github.com/users/tishma/followers","following_url":"https://api.github.com/users/tishma/following{/other_user}","gists_url":"https://api.github.com/users/tishma/gists{/gist_id}","starred_url":"https://api.github.com/users/tishma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tishma/subscriptions","organizations_url":"https://api.github.com/users/tishma/orgs","repos_url":"https://api.github.com/users/tishma/repos","events_url":"https://api.github.com/users/tishma/events{/privacy}","received_events_url":"https://api.github.com/users/tishma/received_events","type":"User","site_admin":false},"created_at":"2013-05-01T22:17:08Z","updated_at":"2013-05-01T22:17:08Z","author_association":"NONE","body":"Actually I use Elastica\\Query\\Builder, and it appears to wrap `filtered` in `query` twice for some reason, which is why I removed it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17310088","html_url":"https://github.com/elastic/elasticsearch/issues/2968#issuecomment-17310088","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2968","id":17310088,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzEwMDg4","user":{"login":"tishma","id":4130604,"node_id":"MDQ6VXNlcjQxMzA2MDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/4130604?v=4","gravatar_id":"","url":"https://api.github.com/users/tishma","html_url":"https://github.com/tishma","followers_url":"https://api.github.com/users/tishma/followers","following_url":"https://api.github.com/users/tishma/following{/other_user}","gists_url":"https://api.github.com/users/tishma/gists{/gist_id}","starred_url":"https://api.github.com/users/tishma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tishma/subscriptions","organizations_url":"https://api.github.com/users/tishma/orgs","repos_url":"https://api.github.com/users/tishma/repos","events_url":"https://api.github.com/users/tishma/events{/privacy}","received_events_url":"https://api.github.com/users/tishma/received_events","type":"User","site_admin":false},"created_at":"2013-05-01T22:17:34Z","updated_at":"2013-05-01T22:17:34Z","author_association":"NONE","body":"Thanks for the quick reply, btw :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17310146","html_url":"https://github.com/elastic/elasticsearch/issues/2968#issuecomment-17310146","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2968","id":17310146,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzEwMTQ2","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2013-05-01T22:18:37Z","updated_at":"2013-05-01T22:18:37Z","author_association":"MEMBER","body":"@tishma so its working fine? you need a top level `query` element always to wrap your actual query (in your case `filtered`).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17310233","html_url":"https://github.com/elastic/elasticsearch/issues/2968#issuecomment-17310233","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2968","id":17310233,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzEwMjMz","user":{"login":"tishma","id":4130604,"node_id":"MDQ6VXNlcjQxMzA2MDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/4130604?v=4","gravatar_id":"","url":"https://api.github.com/users/tishma","html_url":"https://github.com/tishma","followers_url":"https://api.github.com/users/tishma/followers","following_url":"https://api.github.com/users/tishma/following{/other_user}","gists_url":"https://api.github.com/users/tishma/gists{/gist_id}","starred_url":"https://api.github.com/users/tishma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tishma/subscriptions","organizations_url":"https://api.github.com/users/tishma/orgs","repos_url":"https://api.github.com/users/tishma/repos","events_url":"https://api.github.com/users/tishma/events{/privacy}","received_events_url":"https://api.github.com/users/tishma/received_events","type":"User","site_admin":false},"created_at":"2013-05-01T22:21:05Z","updated_at":"2013-05-01T22:21:05Z","author_association":"NONE","body":"I'm still trying to get it to work... WIll let you know.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17310739","html_url":"https://github.com/elastic/elasticsearch/issues/2968#issuecomment-17310739","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2968","id":17310739,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzEwNzM5","user":{"login":"tishma","id":4130604,"node_id":"MDQ6VXNlcjQxMzA2MDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/4130604?v=4","gravatar_id":"","url":"https://api.github.com/users/tishma","html_url":"https://github.com/tishma","followers_url":"https://api.github.com/users/tishma/followers","following_url":"https://api.github.com/users/tishma/following{/other_user}","gists_url":"https://api.github.com/users/tishma/gists{/gist_id}","starred_url":"https://api.github.com/users/tishma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tishma/subscriptions","organizations_url":"https://api.github.com/users/tishma/orgs","repos_url":"https://api.github.com/users/tishma/repos","events_url":"https://api.github.com/users/tishma/events{/privacy}","received_events_url":"https://api.github.com/users/tishma/received_events","type":"User","site_admin":false},"created_at":"2013-05-01T22:33:11Z","updated_at":"2013-05-01T22:33:11Z","author_association":"NONE","body":"OK. My bad. I was sending empty request body when I was getting 12 results, and query is totally wrong... Should I continue elsewhere if you are willing to help?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/17311675","html_url":"https://github.com/elastic/elasticsearch/issues/2968#issuecomment-17311675","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2968","id":17311675,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzExNjc1","user":{"login":"tishma","id":4130604,"node_id":"MDQ6VXNlcjQxMzA2MDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/4130604?v=4","gravatar_id":"","url":"https://api.github.com/users/tishma","html_url":"https://github.com/tishma","followers_url":"https://api.github.com/users/tishma/followers","following_url":"https://api.github.com/users/tishma/following{/other_user}","gists_url":"https://api.github.com/users/tishma/gists{/gist_id}","starred_url":"https://api.github.com/users/tishma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tishma/subscriptions","organizations_url":"https://api.github.com/users/tishma/orgs","repos_url":"https://api.github.com/users/tishma/repos","events_url":"https://api.github.com/users/tishma/events{/privacy}","received_events_url":"https://api.github.com/users/tishma/received_events","type":"User","site_admin":false},"created_at":"2013-05-01T22:58:21Z","updated_at":"2013-05-01T22:58:21Z","author_association":"NONE","body":"@kimchy Thanks. It works like this. I still have to see why query (and even sort) are being wrapped twice, but it is hardly your concern.\n\n``` javascript\n{\n    \"query\": {\n        \"filtered\": {\n            \"query\": {\n                \"query_string\": {\n                    \"query\": \"auto\"\n                }\n            },\n            \"filter\": {\n                \"term\": {\n                    \"lang_id\": \"1\"\n                }\n            }\n        }\n    },\n    \"sort\": {\n            \"deal_id\": {\n                \"order\": \"desc\"\n        }\n    },\n    \"from\": \"0\",\n    \"size\": \"12\"\n\n}\n```\n","performed_via_github_app":null}]