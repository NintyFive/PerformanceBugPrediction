{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9393/events","html_url":"https://github.com/elastic/elasticsearch/issues/9393","id":55246485,"node_id":"MDU6SXNzdWU1NTI0NjQ4NQ==","number":9393,"title":"Type qualification within children aggregations","user":{"login":"perryn","id":40276,"node_id":"MDQ6VXNlcjQwMjc2","avatar_url":"https://avatars3.githubusercontent.com/u/40276?v=4","gravatar_id":"","url":"https://api.github.com/users/perryn","html_url":"https://github.com/perryn","followers_url":"https://api.github.com/users/perryn/followers","following_url":"https://api.github.com/users/perryn/following{/other_user}","gists_url":"https://api.github.com/users/perryn/gists{/gist_id}","starred_url":"https://api.github.com/users/perryn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/perryn/subscriptions","organizations_url":"https://api.github.com/users/perryn/orgs","repos_url":"https://api.github.com/users/perryn/repos","events_url":"https://api.github.com/users/perryn/events{/privacy}","received_events_url":"https://api.github.com/users/perryn/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2015-01-23T05:26:47Z","updated_at":"2016-03-29T16:25:15Z","closed_at":"2015-12-04T14:02:09Z","author_association":"NONE","active_lock_reason":null,"body":"Hi there,\n\nI'm working with child aggregations and have found some points of confusion\n\n1) The documentation isn't clear on when and if you need to qualify references to fields within a children aggregation with the type of the child documents. It is shown being done in the guide: (\"field\": \"employee.hobby\") \n\nhttp://www.elasticsearch.org/guide/en/elasticsearch/guide/current/children-agg.html\n\nbut not in the reference (\"field\": \"owner.display_name\")\n\nhttp://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-children-aggregation.html\n\nIt would be good if the documentation were clearer on this point.\n\n2) In my case, I apparently needed to put the type qualification in. If I don't, I get an error that is not particularly helpful in diagnosing the problem:\n\n```\norg.elasticsearch.ElasticsearchIllegalStateException: Invalid context - aggregation must use addResults() to collect child results\n```\n\nIt would be good if the error were more 'user facing'\n\n3) Lastly the need for type qualification lead me to suspect that I could sub-aggregate (below the children aggregation) based of fields from the parent. This doesn't seem to be the case, so perhaps it would be less confusing all round to not require type qualification at all (since it can only be one type anyway)\n\nHappy to help out with pull requests if someone can give me some guidance\n\ncheers\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}