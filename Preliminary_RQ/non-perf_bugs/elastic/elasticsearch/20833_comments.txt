[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252618152","html_url":"https://github.com/elastic/elasticsearch/issues/20833#issuecomment-252618152","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20833","id":252618152,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjYxODE1Mg==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T13:27:44Z","updated_at":"2016-10-10T13:27:44Z","author_association":"CONTRIBUTOR","body":"@cbuescher can you look\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/260315991","html_url":"https://github.com/elastic/elasticsearch/issues/20833#issuecomment-260315991","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20833","id":260315991,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDMxNTk5MQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-11-14T11:50:05Z","updated_at":"2016-11-14T11:50:29Z","author_association":"MEMBER","body":"I couldn't reproduce this on master with the given seed anymore, but going back to some earlier commit I was able get the random parameters that made the test trip in this case. Problem in that test occurs with:\n\n```\nDateTimeUnit.DAY_OF_MONTH\nDateTimeZone.forID(\"Atlantic/Azores\")\ndate = 1729989444634l;\n```\n\n Still need to do some digging what goes wrong here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/260317243","html_url":"https://github.com/elastic/elasticsearch/issues/20833#issuecomment-260317243","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20833","id":260317243,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDMxNzI0Mw==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2016-11-14T11:57:02Z","updated_at":"2016-11-14T11:57:02Z","author_association":"MEMBER","body":"@cbuescher Just a side note but I updated JodaTime to v2.9.5 recently and they fixed some bugs like https://github.com/JodaOrg/joda-time/issues/373. Maybe related to this issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/260395599","html_url":"https://github.com/elastic/elasticsearch/issues/20833#issuecomment-260395599","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20833","id":260395599,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDM5NTU5OQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2016-11-14T17:05:15Z","updated_at":"2016-11-14T17:49:14Z","author_association":"MEMBER","body":"I found the root cause for this. The test error reveals an interesting edge case with DST overlaps (happening usually on DST end, turning back the clock one hour) in combination with rounding to day intervals.\n\nIn this particular case (tz: \"Atlantic/Azores\", dates around the DST transition on e.g. 2000-10-29T01:00:00.000Z) we currently get the overlapping part during the DST transition as a separate rounding interval as illustrated in this table:\n\n| date | round(date) | nextRoundingValue(date) |\n| --- | --- | --- |\n| 2000-10-28T22:00:00.000Z |  2000-10-28T00:00:00.000Z | 2000-10-29T00:00:00.000Z |\n| 2000-10-28T23:00:00.000Z |  2000-10-28T00:00:00.000Z | 2000-10-29T00:00:00.000Z |\n| **2000-10-29T00:00:00.000Z** |  **2000-10-29T00:00:00.000Z** | 2000-10-30T00:00:00.000-01:00 |\n| **2000-10-29T00:00:00.000-01:00** |  **2000-10-29T00:00:00.000-01:00** | 2000-10-30T00:00:00.000-01:00 |\n| 2000-10-29T01:00:00.000-01:00 |  2000-10-29T00:00:00.000-01:00 | 2000-10-30T00:00:00.000-01:00 |\n| 2000-10-29T02:00:00.000-01:00 |  2000-10-29T00:00:00.000-01:00 | 2000-10-30T00:00:00.000-01:00 |\n\nAccording to https://www.timeanddate.com/time/change/portugal/horta?year=2000 the DST change happenes on Oct-29th at 1am local time, turning back the clock one hour (to offset -01:00). Currently the dates between \"2000-10-29T00:00:00.000Z\" and \"2000-10-29T01:00:00.000Z\" all round down to \"2000-10-29T00:00:00.000Z\" (before the transition) and the dates after but before next midnight round down to \"2000-10-29T00:00:00.000-01:00\". For a day rounding we would prefer a 25h hour bucket for \"2000-10-29\" to a one hour + another 24h bucket I guess. I think I have a fix that detects this kind of situation and merges the two intervals.\n","performed_via_github_app":null}]