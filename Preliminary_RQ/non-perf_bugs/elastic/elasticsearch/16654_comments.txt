[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/183778740","html_url":"https://github.com/elastic/elasticsearch/issues/16654#issuecomment-183778740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16654","id":183778740,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Mzc3ODc0MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-14T00:13:23Z","updated_at":"2016-02-14T00:13:23Z","author_association":"CONTRIBUTOR","body":"@bleskes what do you think?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/184225525","html_url":"https://github.com/elastic/elasticsearch/issues/16654#issuecomment-184225525","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16654","id":184225525,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NDIyNTUyNQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-02-15T14:17:36Z","updated_at":"2016-02-15T14:17:36Z","author_association":"MEMBER","body":"This indeed an unfortunate case where internal and external versioning do not mix well. Internal version mean that ES is the source of truth for changes - it is incremented with every change in ES and starts with 1. External versioning assumes that some other system tracks document changes (including deletes). Originally 0 was an invalid value for external versioning but it wasn't enforced in code. When we fixed the latter people complained and we have changed semantics to allow 0 as a valid external value (see https://github.com/elastic/elasticsearch/issues/5662). Now you can insert a value that's valid as an external version but is illegal for internal.\n\nThe delete by query plugin uses internal versioning to make sure the documents it deletes didn't change during it's operations. However, since the documents were indexed using the external versioning, their version is 0 which is illegal.  \n\nCan you tell us a bit more about your setup? Why are you using the delete by query plugin where you have some external source of truth? I would presume you would delete documents there first and have those propagated to ES as deletes with an external version?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/184253330","html_url":"https://github.com/elastic/elasticsearch/issues/16654#issuecomment-184253330","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16654","id":184253330,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NDI1MzMzMA==","user":{"login":"natelapp","id":15839796,"node_id":"MDQ6VXNlcjE1ODM5Nzk2","avatar_url":"https://avatars1.githubusercontent.com/u/15839796?v=4","gravatar_id":"","url":"https://api.github.com/users/natelapp","html_url":"https://github.com/natelapp","followers_url":"https://api.github.com/users/natelapp/followers","following_url":"https://api.github.com/users/natelapp/following{/other_user}","gists_url":"https://api.github.com/users/natelapp/gists{/gist_id}","starred_url":"https://api.github.com/users/natelapp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/natelapp/subscriptions","organizations_url":"https://api.github.com/users/natelapp/orgs","repos_url":"https://api.github.com/users/natelapp/repos","events_url":"https://api.github.com/users/natelapp/events{/privacy}","received_events_url":"https://api.github.com/users/natelapp/received_events","type":"User","site_admin":false},"created_at":"2016-02-15T15:27:01Z","updated_at":"2016-02-15T15:27:01Z","author_association":"NONE","body":"We receive our data from a third-party that supplies versions, starting with 0.  For one of our indexes, we only care about the most recent version of a given resource, but need to be able to support reloading old data (mapping changes, etc).  In order to ensure we're only keeping the latest (regardless of order received) we've gone with indexing using `external_gte`.  Our process simply ignores the VersionConflictException that gets returned when attempting to add an older version.  It has worked rather well for us.\n\nPeriodically, we'll need to delete data, for a variety of reasons.  These are one-off deletes, usually related to expiring license agreements and such, and are separate from any versioning scheme.  Historically we've just manually done a delete by query to handle these cases, which has served us well until recently.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/250569009","html_url":"https://github.com/elastic/elasticsearch/issues/16654#issuecomment-250569009","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16654","id":250569009,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MDU2OTAwOQ==","user":{"login":"niemyjski","id":1020579,"node_id":"MDQ6VXNlcjEwMjA1Nzk=","avatar_url":"https://avatars3.githubusercontent.com/u/1020579?v=4","gravatar_id":"","url":"https://api.github.com/users/niemyjski","html_url":"https://github.com/niemyjski","followers_url":"https://api.github.com/users/niemyjski/followers","following_url":"https://api.github.com/users/niemyjski/following{/other_user}","gists_url":"https://api.github.com/users/niemyjski/gists{/gist_id}","starred_url":"https://api.github.com/users/niemyjski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niemyjski/subscriptions","organizations_url":"https://api.github.com/users/niemyjski/orgs","repos_url":"https://api.github.com/users/niemyjski/repos","events_url":"https://api.github.com/users/niemyjski/events{/privacy}","received_events_url":"https://api.github.com/users/niemyjski/received_events","type":"User","site_admin":false},"created_at":"2016-09-29T19:37:17Z","updated_at":"2016-09-29T19:37:17Z","author_association":"CONTRIBUTOR","body":"I'm using internal indexing and hitting this on index...\n\n illegal version value [0] for version type [INTERNAL];\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251085159","html_url":"https://github.com/elastic/elasticsearch/issues/16654#issuecomment-251085159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16654","id":251085159,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTA4NTE1OQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-10-03T11:35:55Z","updated_at":"2016-10-03T11:35:55Z","author_association":"MEMBER","body":"@niemyjski as we discussed in another issue, your issue is different than this one.\n\n@natelapp thanks for the update. The problem is that currently doesn't align with the main use case for external versioning, where some external source owns all changes to the documents, including deletes. I haven't come up with a clean way of allowing you to do what you need plus making other use cases work without surprises. As a workaround for now, I think the easiest for you is to always +1 the version you get from your data source (to allow a delete by query operation).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476643760","html_url":"https://github.com/elastic/elasticsearch/issues/16654#issuecomment-476643760","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16654","id":476643760,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjY0Mzc2MA==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T13:44:22Z","updated_at":"2019-03-26T13:44:22Z","author_association":"CONTRIBUTOR","body":"@natelapp thanks for reporting this issue. The issue has been fixed in the upcoming 6.7 and 7.0 versions and I will therefore close this issue.","performed_via_github_app":null}]