{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45819","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45819/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45819/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45819/events","html_url":"https://github.com/elastic/elasticsearch/issues/45819","id":483630293,"node_id":"MDU6SXNzdWU0ODM2MzAyOTM=","number":45819,"title":"Remove use of synchronization in XPackLicenseState?","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"labels":[{"id":912841668,"node_id":"MDU6TGFiZWw5MTI4NDE2Njg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/License","name":":Security/License","color":"0e8a16","default":false,"description":"License functionality for commercial features"},{"id":837440720,"node_id":"MDU6TGFiZWw4Mzc0NDA3MjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Erefactoring","name":">refactoring","color":"dddddd","default":false,"description":null},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-08-21T20:16:28Z","updated_at":"2019-08-22T15:05:50Z","closed_at":"2019-08-22T15:05:49Z","author_association":"MEMBER","active_lock_reason":null,"body":"`XPackLicenseState` synchronizes access to the internal `Status`, which was probably sufficient in the past since calls to various `isFooEnabled()` methods were infrequent.  But the surface area of xpack features is growing, and we are beginning to introduce features which will require frequent checks.  E.g. imagine a licensed aggregation, which needs to be checked on each execution.  This could be a lot more frequent than checking during a `PutWatch` for example.\r\n\r\nThe caller can cache the value locally with a cluster state listener (that's the path I took on a recent PR), but it would perhaps be better solved centrally instead of having each caller reinvent the same caching behavior?\r\n\r\nI only skimmed, but it looks like the status object is always re-assigned, and only updated by `LicenseService` so making `status` volatile and dropping synchronization on getters would probably work. Volatile always scares me though :)  Maybe protect it with a RWLock or similar? \r\n\r\nNot trying to over-engineer it, but the `synchronized` behavior concerns me moving forward :)\r\n\r\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}