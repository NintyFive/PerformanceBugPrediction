{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32365","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32365/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32365/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32365/events","html_url":"https://github.com/elastic/elasticsearch/issues/32365","id":344491988,"node_id":"MDU6SXNzdWUzNDQ0OTE5ODg=","number":32365,"title":"s3 repository canned_acl is not working for some files during snapshot creation ","user":{"login":"point911","id":1827832,"node_id":"MDQ6VXNlcjE4Mjc4MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/1827832?v=4","gravatar_id":"","url":"https://api.github.com/users/point911","html_url":"https://github.com/point911","followers_url":"https://api.github.com/users/point911/followers","following_url":"https://api.github.com/users/point911/following{/other_user}","gists_url":"https://api.github.com/users/point911/gists{/gist_id}","starred_url":"https://api.github.com/users/point911/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/point911/subscriptions","organizations_url":"https://api.github.com/users/point911/orgs","repos_url":"https://api.github.com/users/point911/repos","events_url":"https://api.github.com/users/point911/events{/privacy}","received_events_url":"https://api.github.com/users/point911/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"}],"state":"closed","locked":false,"assignee":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2018-07-25T15:23:42Z","updated_at":"2019-09-19T13:00:59Z","closed_at":"2019-09-19T13:00:59Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.3.2\r\n\r\n**Plugins installed**: [\"repository-s3\"]\r\n\r\n**JVM version** (`java -version`): javac 1.8.0_141\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):  4.14.51-60.38.amzn1.x86_64 \r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWe have an ES cluster in AWS. When we want to take a snapshot we are doing into S3 bucket which is located in another account.\r\nwhen we creating an S3 repository in elastic search we enabling following option:\r\n\r\n\"canned_acl\": \"bucket-owner-full-control\"\r\n\r\nNot all files from snapshot have ACL for full control for bucket owner.\r\nFiles which DO NOT HAVE proper permissions.\r\n1 . All files which have index-0 in their's name\r\n2. index.latest\r\n3. incompatible-snapshots.\r\n\r\nAll other files have correct ACL both for snapshot creator account and bucket owner account.\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Setup ES cluster in AWS account 1.\r\n2. Setup S3 bucket in AWS account 2.\r\n3. Grant permissions to ES to save snapshots to S3 bucket in AWS account 2.\r\n4. Setup a repository in ES cluster with option  \"canned_acl\": \"bucket-owner-full-control\"\r\n5. Create a snapshot.\r\n6. Check file permissions for files with names index-0,  index.latest and incompatible-snapshots.\r\nThey will not have bucket owner FULL ADMIN permissions\r\naws s3api get-object-acl --bucket BUCKET_NAME --key PATH_TO_S3_OBJECT\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}