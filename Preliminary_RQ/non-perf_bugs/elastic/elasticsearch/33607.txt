{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33607","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33607/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33607/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33607/events","html_url":"https://github.com/elastic/elasticsearch/issues/33607","id":359124678,"node_id":"MDU6SXNzdWUzNTkxMjQ2Nzg=","number":33607,"title":"On Debian, installing java and elasticsearch in the same apt-get run fails","user":{"login":"sanvila","id":6770151,"node_id":"MDQ6VXNlcjY3NzAxNTE=","avatar_url":"https://avatars3.githubusercontent.com/u/6770151?v=4","gravatar_id":"","url":"https://api.github.com/users/sanvila","html_url":"https://github.com/sanvila","followers_url":"https://api.github.com/users/sanvila/followers","following_url":"https://api.github.com/users/sanvila/following{/other_user}","gists_url":"https://api.github.com/users/sanvila/gists{/gist_id}","starred_url":"https://api.github.com/users/sanvila/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sanvila/subscriptions","organizations_url":"https://api.github.com/users/sanvila/orgs","repos_url":"https://api.github.com/users/sanvila/repos","events_url":"https://api.github.com/users/sanvila/events{/privacy}","received_events_url":"https://api.github.com/users/sanvila/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-09-11T16:28:19Z","updated_at":"2020-11-11T21:56:20Z","closed_at":"2018-09-11T17:18:53Z","author_association":"NONE","active_lock_reason":null,"body":"I'm using Debian 9 and elasticsearch 6.4.0. In a freshly installed Debian system I do this:\r\n\r\n`apt-get install elasticsearch openjdk-8-jre-headless`\r\n\r\nand it fails with this error:\r\n\r\n```\r\ndpkg: error processing archive /var/cache/apt/archives/elasticsearch_6.4.0_all.deb (--unpack):\r\n subprocess new pre-installation script returned error exit status 1\r\nErrors were encountered while processing:\r\n /var/cache/apt/archives/elasticsearch_6.4.0_all.deb\r\nE: Sub-process /usr/bin/dpkg returned an error code (1)\r\n```\r\nThis happens because the preinst (not the postinst) checks that java is in the PATH, and it fails if it's not, but java will not be in the PATH until we let the openjdk-8-jre-headless package to be configured, since the /usr/bin/java executable is handled via the alternatives mechanism.\r\n\r\nI could of course install java first and then elasticsearch, in separate apt-get runs, but that would be only a workaround and not a real and elegant solution.\r\n\r\nIt would be better to tell dpkg that the java package should be configured first, and this already happens when a simple Depends is used.\r\n\r\n`Depends: openjdk-8-jre-headless | every-other-package-providing-java-8`\r\n\r\nThen the current stuff in the preinst could be moved to postinst again, where it probably belongs.\r\n\r\nBTW: The current Depends field is not very orthodox:\r\n\r\n`Depends: bash, libc6, adduser, coreutils`\r\n\r\nBoth bash and coreutils are essential, so they don't need to be there.\r\n\r\nThe dependency on libc6 is also suspicious because normally they are versioned and created automatically by dpkg-shlibdeps, and this one seems to be added by hand. If the package does not contain any ELF binary, there is no need to add a dependency on libc6.\r\n\r\nThanks.","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}