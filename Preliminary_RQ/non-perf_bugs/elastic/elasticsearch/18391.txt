{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18391","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18391/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18391/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18391/events","html_url":"https://github.com/elastic/elasticsearch/issues/18391","id":155206294,"node_id":"MDU6SXNzdWUxNTUyMDYyOTQ=","number":18391,"title":"Ignoring deleted stopwords while generating shingles","user":{"login":"vchalmel","id":12208673,"node_id":"MDQ6VXNlcjEyMjA4Njcz","avatar_url":"https://avatars0.githubusercontent.com/u/12208673?v=4","gravatar_id":"","url":"https://api.github.com/users/vchalmel","html_url":"https://github.com/vchalmel","followers_url":"https://api.github.com/users/vchalmel/followers","following_url":"https://api.github.com/users/vchalmel/following{/other_user}","gists_url":"https://api.github.com/users/vchalmel/gists{/gist_id}","starred_url":"https://api.github.com/users/vchalmel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vchalmel/subscriptions","organizations_url":"https://api.github.com/users/vchalmel/orgs","repos_url":"https://api.github.com/users/vchalmel/repos","events_url":"https://api.github.com/users/vchalmel/events{/privacy}","received_events_url":"https://api.github.com/users/vchalmel/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2016-05-17T08:46:59Z","updated_at":"2020-09-12T13:53:27Z","closed_at":"2016-05-17T10:45:44Z","author_association":"NONE","active_lock_reason":null,"body":"Hi ! \nI have the same issue that the one exposed here : [#12819 ](https://github.com/elastic/elasticsearch/issues/12819) (before closing due to the lack of feedback asked by @clintongormley to the author @apanimesh061)\n\nI discussed it here [on stackoverflow](http://stackoverflow.com/questions/37205478/how-to-prevent-duplicate-tokens-with-same-start-pos-but-different-end?noredirect=1#comment61964513_37205478) because I thought I made a mistake in my parameters\n\nWhen using a shingle token filter after removal of stopwords why don't we have a parameter to completely ignore stopwords ?\nThere would be two huge benefits for me :\n- Even with \"filler_token\":\"\" (or \"filler_token\":\" \" then a \"trim\" token filter) there are duplicated shingles generated, with the same text, \"pos\" and \"start\" but only differing by \"end\" that might tweak the queries scores for the duplicated words as seen [here :](http://i.stack.imgur.com/nboTe.png)\n- If a word is surrounded by stopwords, no shingles would be generated associating it with other words around, several (deleted) stopwords away...\n\nI shall add that those duplicated tokens are not removed by a \"unique\" token filter... and that I don't understand why.\n\nHere is my analysis (I only kept the \"test\" analyzer which I used to generate examples but I have a few others ):\n\n``` json\n\"settings\": {\n    \"index\": {\n        \"analysis\": {\n            \"filter\": {\n                \"fr_stop\": {\n                    \"ignore_case\": \"true\",\n                    \"remove_trailing\": \"true\",\n                    \"type\": \"stop\",\n                    \"stopwords\": \"_french_\"\n                },\n                \"fr_worddelimiter\": {\n                    \"type\": \"word_delimiter\",\n                    \"language\": \"french\"\n                },\n                \"fr_snowball\": {\n                    \"type\": \"snowball\",\n                    \"language\": \"french\"\n                },\n                \"custom_nGram\": {\n                    \"type\": \"ngram\",\n                    \"min_gram\": \"3\",\n                    \"max_gram\": \"10\"\n                },\n                \"custom_shingles\": {\n                    \"max_shingle_size\": \"4\",\n                    \"min_shingle_size\": \"2\",\n                    \"token_separator\": \" \",\n                    \"output_unigrams\": \"true\",\n                    \"filler_token\":\"\",\n                    \"type\": \"shingle\"\n                },\n                \"custom_unique\": {\n                    \"type\": \"unique\",\n                    \"only_on_same_position\": \"true\"\n                },\n                \"fr_elision\": {\n                    \"type\": \"elision\",\n                    \"articles\": [\n                        \"l\",\n                        \"m\",\n                        \"t\",\n                        \"qu\",\n                        \"n\",\n                        \"s\",\n                        \"j\",\n                        \"d\",\n                        \"c\",\n                        \"jusqu\",\n                        \"quoiqu\",\n                        \"lorsqu\",\n                        \"puisqu\",\n                        \"parce qu\",\n                        \"parcequ\",\n                        \"entr\",\n                        \"presqu\",\n                        \"quelqu\"\n                    ]\n                }\n            },\n            \"charfilter\": \"html_strip\",\n            \"analyzer\": {\n                \"test\": {\n                    \"filter\": [\n                        \"asciifolding\",\n                        \"lowercase\",\n                        \"fr_stop\",\n                        \"fr_elision\",\n                        \"custom_shingles\"\n                        \"trim\",\n                        \"custom_unique\",\n                    ],\n                    \"type\": \"custom\",\n                    \"tokenizer\": \"standard\"\n                }\n            },\n            \"tokenizer\": {\n                \"custom_edgeNGram\": {\n                    \"token_chars\": [\n                        \"letter\",\n                        \"digit\"\n                    ],\n                    \"min_gram\": \"3\",\n                    \"type\": \"edgeNGram\",\n                    \"max_gram\": \"20\"\n                },\n                \"custom_nGram\": {\n                    \"token_chars\": [\n                        \"letter\",\n                        \"digit\"\n                    ],\n                    \"min_gram\": \"3\",\n                    \"type\": \"nGram\",\n                    \"max_gram\": \"20\"\n                }\n            }\n        }\n    }\n}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}