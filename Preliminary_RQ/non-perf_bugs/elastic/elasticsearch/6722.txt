{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6722","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6722/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6722/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6722/events","html_url":"https://github.com/elastic/elasticsearch/issues/6722","id":37148755,"node_id":"MDU6SXNzdWUzNzE0ODc1NQ==","number":6722,"title":"Replace empty bool queries with match_all to prevent NullPointerExceptions","user":{"login":"macnibblet","id":1127626,"node_id":"MDQ6VXNlcjExMjc2MjY=","avatar_url":"https://avatars3.githubusercontent.com/u/1127626?v=4","gravatar_id":"","url":"https://api.github.com/users/macnibblet","html_url":"https://github.com/macnibblet","followers_url":"https://api.github.com/users/macnibblet/followers","following_url":"https://api.github.com/users/macnibblet/following{/other_user}","gists_url":"https://api.github.com/users/macnibblet/gists{/gist_id}","starred_url":"https://api.github.com/users/macnibblet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/macnibblet/subscriptions","organizations_url":"https://api.github.com/users/macnibblet/orgs","repos_url":"https://api.github.com/users/macnibblet/repos","events_url":"https://api.github.com/users/macnibblet/events{/privacy}","received_events_url":"https://api.github.com/users/macnibblet/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":101489188,"node_id":"MDU6TGFiZWwxMDE0ODkxODg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.1.3","name":"v1.1.3","color":"DDDDDD","default":false,"description":null},{"id":104188881,"node_id":"MDU6TGFiZWwxMDQxODg4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.2.2","name":"v1.2.2","color":"DDDDDD","default":false,"description":null},{"id":95090930,"node_id":"MDU6TGFiZWw5NTA5MDkzMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.3.0","name":"v1.3.0","color":"DDDDDD","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2014-07-04T08:04:06Z","updated_at":"2015-06-07T19:33:12Z","closed_at":"2014-07-04T09:20:04Z","author_association":"NONE","active_lock_reason":null,"body":"I have setup a parent/child relationship where parent is optional and i handle the routing in that case. And this worked fine in 1.0.1 but when i bumped to 1.2.1 to use aggregations it stopped working.\n\nThe exception i get\n\n``` java\n[2014-07-04 07:59:30,333][INFO ][node                     ] [Tantra] version[1.2.1], pid[23438], build[6c95b75/2014-06-03T15:02:52Z]\n[2014-07-04 07:59:30,334][INFO ][node                     ] [Tantra] initializing ...\n[2014-07-04 07:59:30,339][INFO ][plugins                  ] [Tantra] loaded [], sites []\n[2014-07-04 07:59:32,581][INFO ][script                   ] [Tantra] compiling script file [/etc/elasticsearch/scripts/activity-period.mvel]\n[2014-07-04 07:59:33,016][INFO ][node                     ] [Tantra] initialized\n[2014-07-04 07:59:33,016][INFO ][node                     ] [Tantra] starting ...\n[2014-07-04 07:59:33,092][INFO ][transport                ] [Tantra] bound_address {inet[/0:0:0:0:0:0:0:0:9300]}, publish_address {inet[/10.0.2.15:9300]}\n[2014-07-04 07:59:36,133][INFO ][cluster.service          ] [Tantra] new_master [Tantra][jUaCLA6GTyadduwbg_tTwg][packer-virtualbox][inet[/10.0.2.15:9300]], reason: zen-disco-join (elected_as_master)\n[2014-07-04 07:59:36,171][INFO ][discovery                ] [Tantra] elasticsearch/jUaCLA6GTyadduwbg_tTwg\n[2014-07-04 07:59:36,262][INFO ][http                     ] [Tantra] bound_address {inet[/0:0:0:0:0:0:0:0:9200]}, publish_address {inet[/10.0.2.15:9200]}\n[2014-07-04 07:59:37,094][INFO ][gateway                  ] [Tantra] recovered [33] indices into cluster_state\n[2014-07-04 07:59:37,116][INFO ][node                     ] [Tantra] started\n[2014-07-04 07:59:45,985][DEBUG][action.search.type       ] [Tantra] [application][2], node[jUaCLA6GTyadduwbg_tTwg], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@6fa23b68] lastShard [true]\norg.elasticsearch.search.SearchParseException: [application][2]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"has_parent\": {\n                \"type\": \"clients\",\n                \"query\": {\n                  \"bool\": {\n                    \"must\": [],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                },\n                \"filter\": {\n                  \"bool\": {\n                    \"must\": [\n                      {\n                        \"terms\": {\n                          \"interests\": [\n                            \"hello\"\n                          ]\n                        }\n                      }\n                    ],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                }\n              }\n            },\n            {\n              \"geo_distance\": {\n                \"distance\": \"20km\",\n                \"coordinate\": \"59.85499699999999,17.6490213\"\n              }\n            }\n          ],\n          \"must_not\": [],\n          \"should\": []\n        }\n      },\n      \"query\": []\n    }\n  },\n  \"size\": 25\n}\n]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:649)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:511)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:483)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:252)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:206)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:203)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:517)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.common.xcontent.XContentHelper.createParser(XContentHelper.java:46)\n    at org.elasticsearch.index.query.support.XContentStructure.asQuery(XContentStructure.java:88)\n    at org.elasticsearch.index.query.support.XContentStructure$InnerQuery.asQuery(XContentStructure.java:154)\n    at org.elasticsearch.index.query.HasParentFilterParser.parse(HasParentFilterParser.java:115)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.BoolFilterParser.parse(BoolFilterParser.java:92)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.FilteredQueryParser.parse(FilteredQueryParser.java:74)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:334)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:260)\n    at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:633)\n    ... 9 more\n[2014-07-04 07:59:45,985][DEBUG][action.search.type       ] [Tantra] [application][1], node[jUaCLA6GTyadduwbg_tTwg], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@6fa23b68] lastShard [true]\norg.elasticsearch.search.SearchParseException: [application][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"has_parent\": {\n                \"type\": \"clients\",\n                \"query\": {\n                  \"bool\": {\n                    \"must\": [],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                },\n                \"filter\": {\n                  \"bool\": {\n                    \"must\": [\n                      {\n                        \"terms\": {\n                          \"interests\": [\n                            \"hello\"\n                          ]\n                        }\n                      }\n                    ],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                }\n              }\n            },\n            {\n              \"geo_distance\": {\n                \"distance\": \"20km\",\n                \"coordinate\": \"59.85499699999999,17.6490213\"\n              }\n            }\n          ],\n          \"must_not\": [],\n          \"should\": []\n        }\n      },\n      \"query\": []\n    }\n  },\n  \"size\": 25\n}\n]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:649)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:511)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:483)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:252)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:206)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:203)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:517)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.common.xcontent.XContentHelper.createParser(XContentHelper.java:46)\n    at org.elasticsearch.index.query.support.XContentStructure.asQuery(XContentStructure.java:88)\n    at org.elasticsearch.index.query.support.XContentStructure$InnerQuery.asQuery(XContentStructure.java:154)\n    at org.elasticsearch.index.query.HasParentFilterParser.parse(HasParentFilterParser.java:115)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.BoolFilterParser.parse(BoolFilterParser.java:92)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.FilteredQueryParser.parse(FilteredQueryParser.java:74)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:334)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:260)\n    at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:633)\n    ... 9 more\n[2014-07-04 07:59:45,985][DEBUG][action.search.type       ] [Tantra] [application][0], node[jUaCLA6GTyadduwbg_tTwg], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@6fa23b68] lastShard [true]\norg.elasticsearch.search.SearchParseException: [application][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"has_parent\": {\n                \"type\": \"clients\",\n                \"query\": {\n                  \"bool\": {\n                    \"must\": [],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                },\n                \"filter\": {\n                  \"bool\": {\n                    \"must\": [\n                      {\n                        \"terms\": {\n                          \"interests\": [\n                            \"hello\"\n                          ]\n                        }\n                      }\n                    ],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                }\n              }\n            },\n            {\n              \"geo_distance\": {\n                \"distance\": \"20km\",\n                \"coordinate\": \"59.85499699999999,17.6490213\"\n              }\n            }\n          ],\n          \"must_not\": [],\n          \"should\": []\n        }\n      },\n      \"query\": []\n    }\n  },\n  \"size\": 25\n}\n]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:649)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:511)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:483)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:252)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:206)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:203)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:517)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.common.xcontent.XContentHelper.createParser(XContentHelper.java:46)\n    at org.elasticsearch.index.query.support.XContentStructure.asQuery(XContentStructure.java:88)\n    at org.elasticsearch.index.query.support.XContentStructure$InnerQuery.asQuery(XContentStructure.java:154)\n    at org.elasticsearch.index.query.HasParentFilterParser.parse(HasParentFilterParser.java:115)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.BoolFilterParser.parse(BoolFilterParser.java:92)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.FilteredQueryParser.parse(FilteredQueryParser.java:74)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:334)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:260)\n    at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:633)\n    ... 9 more\n[2014-07-04 07:59:45,985][DEBUG][action.search.type       ] [Tantra] [application][4], node[jUaCLA6GTyadduwbg_tTwg], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@6fa23b68] lastShard [true]\norg.elasticsearch.search.SearchParseException: [application][4]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"has_parent\": {\n                \"type\": \"clients\",\n                \"query\": {\n                  \"bool\": {\n                    \"must\": [],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                },\n                \"filter\": {\n                  \"bool\": {\n                    \"must\": [\n                      {\n                        \"terms\": {\n                          \"interests\": [\n                            \"hello\"\n                          ]\n                        }\n                      }\n                    ],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                }\n              }\n            },\n            {\n              \"geo_distance\": {\n                \"distance\": \"20km\",\n                \"coordinate\": \"59.85499699999999,17.6490213\"\n              }\n            }\n          ],\n          \"must_not\": [],\n          \"should\": []\n        }\n      },\n      \"query\": []\n    }\n  },\n  \"size\": 25\n}\n]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:649)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:511)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:483)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:252)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:206)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:203)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:517)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.common.xcontent.XContentHelper.createParser(XContentHelper.java:46)\n    at org.elasticsearch.index.query.support.XContentStructure.asQuery(XContentStructure.java:88)\n    at org.elasticsearch.index.query.support.XContentStructure$InnerQuery.asQuery(XContentStructure.java:154)\n    at org.elasticsearch.index.query.HasParentFilterParser.parse(HasParentFilterParser.java:115)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.BoolFilterParser.parse(BoolFilterParser.java:92)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.FilteredQueryParser.parse(FilteredQueryParser.java:74)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:334)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:260)\n    at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:633)\n    ... 9 more\n[2014-07-04 07:59:45,985][DEBUG][action.search.type       ] [Tantra] [application][3], node[jUaCLA6GTyadduwbg_tTwg], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@6fa23b68]\norg.elasticsearch.search.SearchParseException: [application][3]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"has_parent\": {\n                \"type\": \"clients\",\n                \"query\": {\n                  \"bool\": {\n                    \"must\": [],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                },\n                \"filter\": {\n                  \"bool\": {\n                    \"must\": [\n                      {\n                        \"terms\": {\n                          \"interests\": [\n                            \"hello\"\n                          ]\n                        }\n                      }\n                    ],\n                    \"must_not\": [],\n                    \"should\": []\n                  }\n                }\n              }\n            },\n            {\n              \"geo_distance\": {\n                \"distance\": \"20km\",\n                \"coordinate\": \"59.85499699999999,17.6490213\"\n              }\n            }\n          ],\n          \"must_not\": [],\n          \"should\": []\n        }\n      },\n      \"query\": []\n    }\n  },\n  \"size\": 25\n}\n]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:649)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:511)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:483)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:252)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:206)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:203)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:517)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.common.xcontent.XContentHelper.createParser(XContentHelper.java:46)\n    at org.elasticsearch.index.query.support.XContentStructure.asQuery(XContentStructure.java:88)\n    at org.elasticsearch.index.query.support.XContentStructure$InnerQuery.asQuery(XContentStructure.java:154)\n    at org.elasticsearch.index.query.HasParentFilterParser.parse(HasParentFilterParser.java:115)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.BoolFilterParser.parse(BoolFilterParser.java:92)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:283)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:264)\n    at org.elasticsearch.index.query.FilteredQueryParser.parse(FilteredQueryParser.java:74)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:334)\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:260)\n    at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:633)\n    ... 9 more\n[2014-07-04 07:59:45,999][DEBUG][action.search.type       ] [Tantra] All shards failed for phase: [query]\n```\n\nMapping\n\n``` json\n{\n    \"application\": {\n        \"mappings\": {\n            \"clients\": {\n                \"properties\": {\n                    \"createdAt\": {\n                        \"format\": \"date_time_no_millis\",\n                        \"type\": \"date\"\n                    },\n                    \"email\": {\n                        \"type\": \"string\"\n                    },\n                    \"facebookId\": {\n                        \"type\": \"long\"\n                    },\n                    \"favorites\": {\n                        \"type\": \"integer\"\n                    },\n                    \"id\": {\n                        \"type\": \"integer\"\n                    },\n                    \"interests\": {\n                        \"type\": \"string\"\n                    },\n                    \"name\": {\n                        \"type\": \"string\"\n                    },\n                    \"surname\": {\n                        \"type\": \"string\"\n                    },\n                    \"updatedAt\": {\n                        \"format\": \"date_time_no_millis\",\n                        \"type\": \"date\"\n                    }\n                }\n            },\n            \"devices\": {\n                \"_parent\": {\n                    \"type\": \"clients\"\n                },\n                \"_routing\": {\n                    \"required\": true\n                },\n                \"properties\": {\n                    \"active\": {\n                        \"type\": \"boolean\"\n                    },\n                    \"appName\": {\n                        \"type\": \"string\"\n                    },\n                    \"appVersion\": {\n                        \"type\": \"string\"\n                    },\n                    \"carrier\": {\n                        \"type\": \"string\"\n                    },\n                    \"coordinate\": {\n                        \"type\": \"geo_point\"\n                    },\n                    \"country\": {\n                        \"index\": \"not_analyzed\",\n                        \"type\": \"string\"\n                    },\n                    \"createdAt\": {\n                        \"format\": \"date_time_no_millis\",\n                        \"type\": \"date\"\n                    },\n                    \"deviceId\": {\n                        \"index\": \"not_analyzed\",\n                        \"type\": \"string\"\n                    },\n                    \"deviceModel\": {\n                        \"type\": \"string\"\n                    },\n                    \"deviceName\": {\n                        \"type\": \"string\"\n                    },\n                    \"id\": {\n                        \"index\": \"not_analyzed\",\n                        \"type\": \"string\"\n                    },\n                    \"inactivatedAt\": {\n                        \"format\": \"date_time_no_millis\",\n                        \"type\": \"date\"\n                    },\n                    \"mobileCountryCode\": {\n                        \"index\": \"not_analyzed\",\n                        \"type\": \"string\"\n                    },\n                    \"os\": {\n                        \"type\": \"string\"\n                    },\n                    \"osVersion\": {\n                        \"type\": \"string\"\n                    },\n                    \"pushNotificationId\": {\n                        \"index\": \"not_analyzed\",\n                        \"type\": \"string\"\n                    },\n                    \"updatedAt\": {\n                        \"format\": \"date_time_no_millis\",\n                        \"type\": \"date\"\n                    }\n                }\n            }\n        }\n    }\n}\n```\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}