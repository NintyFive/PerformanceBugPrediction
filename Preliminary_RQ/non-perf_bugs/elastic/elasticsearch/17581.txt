{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17581","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17581/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17581/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17581/events","html_url":"https://github.com/elastic/elasticsearch/issues/17581","id":146516629,"node_id":"MDU6SXNzdWUxNDY1MTY2Mjk=","number":17581,"title":"No correct phrase highlighting with plain highlighter","user":{"login":"schoch","id":154128,"node_id":"MDQ6VXNlcjE1NDEyOA==","avatar_url":"https://avatars2.githubusercontent.com/u/154128?v=4","gravatar_id":"","url":"https://api.github.com/users/schoch","html_url":"https://github.com/schoch","followers_url":"https://api.github.com/users/schoch/followers","following_url":"https://api.github.com/users/schoch/following{/other_user}","gists_url":"https://api.github.com/users/schoch/gists{/gist_id}","starred_url":"https://api.github.com/users/schoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schoch/subscriptions","organizations_url":"https://api.github.com/users/schoch/orgs","repos_url":"https://api.github.com/users/schoch/repos","events_url":"https://api.github.com/users/schoch/events{/privacy}","received_events_url":"https://api.github.com/users/schoch/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2016-04-07T05:57:40Z","updated_at":"2016-07-11T07:30:39Z","closed_at":"2016-04-12T18:30:24Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3.2\n\n**JVM version**: Java(TM) SE Runtime Environment (build 1.8.0_40-b27)\n\n**OS version**: OSX 10.11.3\n\n**Description of the problem including expected versus actual behavior**:\nThe plain highlighter highlights single terms of phases that do not completely match. My expected behavior would be that a given search phrase must completely match, before it is used for highlighting.\n\n**Steps to reproduce**:\n1. Create a new document\n   `PUT sample/doc/1\n   {\n   \"content\": \"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sed hendrerit ante.\" \n   }`\n2. Do a query_string query with a quoted phrase\n   `GET sample/doc/_search\n   {\n   \"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"query_string\": {\n          \"default_field\": \"content\",\n          \"query\": \"\\\"lorem something\\\" OR ipsum\" \n        }\n      }\n   }\n   },\n   \"highlight\": {\n    \"fields\": {\n      \"content\": {}\n   }\n   }\n   }`\n   _lorem_ gets highlighted, but I do not expect that since the phrase _lorem something_ does not exist in the document\n3. Do an equivalent bool query\n   `GET sample/doc/_search\n   {\n   \"query\": {\n    \"bool\": {\n      \"should\": [\n        {\n          \"match_phrase\": {\n            \"content\": \"lorem something\" \n          }\n        },\n        {\n          \"match\": {\n            \"content\": \"ipsum\" \n          }\n        }\n      ]\n   }\n   },\n   \"highlight\": {\n    \"fields\": {\n      \"content\": {}\n   }\n   }\n   }`\n   Same result.\n4. Switch the elements of the bool query\n   `GET sample/doc/_search\n   {\n   \"query\": {\n    \"bool\": {\n      \"should\": [\n         {\n          \"match\": {\n            \"content\": \"ipsum\" \n          }\n        },\n        {\n          \"match_phrase\": {\n            \"content\": \"lorem something\" \n          }\n        }\n      ]\n   }\n   },\n   \"highlight\": {\n    \"fields\": {\n      \"content\": {}\n   }\n   }\n   }`\n\nWhats that? Just _ipsum_ gets highlighted (as expected). That seems like a bug to be. I did not try to reproduce that with the other highlighters.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}