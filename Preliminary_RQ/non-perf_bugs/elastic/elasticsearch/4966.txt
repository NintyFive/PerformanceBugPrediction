{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4966","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4966/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4966/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4966/events","html_url":"https://github.com/elastic/elasticsearch/issues/4966","id":26689361,"node_id":"MDU6SXNzdWUyNjY4OTM2MQ==","number":4966,"title":"Missing filter not working for field name 'location' but works if prefixed by type name","user":{"login":"gtwijma","id":3517248,"node_id":"MDQ6VXNlcjM1MTcyNDg=","avatar_url":"https://avatars2.githubusercontent.com/u/3517248?v=4","gravatar_id":"","url":"https://api.github.com/users/gtwijma","html_url":"https://github.com/gtwijma","followers_url":"https://api.github.com/users/gtwijma/followers","following_url":"https://api.github.com/users/gtwijma/following{/other_user}","gists_url":"https://api.github.com/users/gtwijma/gists{/gist_id}","starred_url":"https://api.github.com/users/gtwijma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gtwijma/subscriptions","organizations_url":"https://api.github.com/users/gtwijma/orgs","repos_url":"https://api.github.com/users/gtwijma/repos","events_url":"https://api.github.com/users/gtwijma/events{/privacy}","received_events_url":"https://api.github.com/users/gtwijma/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-01-31T15:44:48Z","updated_at":"2014-12-24T19:03:27Z","closed_at":"2014-12-24T19:03:27Z","author_association":"NONE","active_lock_reason":null,"body":"We ran into a very strange issue where a missing filter would not work for a specific field name 'location'. We filled this field with names of cities like Amsterdam, Londen, etc. Here is an example query:\n\n```\n{\n  \"from\": 0,\n  \"size\": 100,\n  \"sort\": {\n    \"order\": \"asc\"\n  },\n  \"explain\": true,\n  \"query\": {\n    \"constant_score\": {\n      \"filter\": {\n        \"and\": [\n          {\n            \"missing\": {\n              \"field\": \"location\"\n            }\n          },\n          {\n            \"term\": {\n              \"type\": \"VacancySearchSeo\"\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\nThe problem is that the missing filter is completely ignored. You can see that in the result\n\n```\nConstantScore(+*:* +cache(type:VacancySearchSeo))\n```\n\nIf we replace the location field with any other field in the index the missing filter works. If we prefix the location field with the name of the type it also works.\n\n```\nConstantScore(++cache(_type:vacancysearchseo) +cache(NotFilter(cache(BooleanFilter(location:[* TO *])))) +cache(type:VacancySearchSeo))\n```\n\nIt seems like the problem is the name of the field. We have also a type with the same name.\nThe funny thing is that it only happens with the missing filter. A normal term filter on this field does work correctly.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}