{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18775","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18775/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18775/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18775/events","html_url":"https://github.com/elastic/elasticsearch/issues/18775","id":159088168,"node_id":"MDU6SXNzdWUxNTkwODgxNjg=","number":18775,"title":"snapshot delete getting stuck on 2.3","user":{"login":"devarajphukan","id":8536463,"node_id":"MDQ6VXNlcjg1MzY0NjM=","avatar_url":"https://avatars2.githubusercontent.com/u/8536463?v=4","gravatar_id":"","url":"https://api.github.com/users/devarajphukan","html_url":"https://github.com/devarajphukan","followers_url":"https://api.github.com/users/devarajphukan/followers","following_url":"https://api.github.com/users/devarajphukan/following{/other_user}","gists_url":"https://api.github.com/users/devarajphukan/gists{/gist_id}","starred_url":"https://api.github.com/users/devarajphukan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/devarajphukan/subscriptions","organizations_url":"https://api.github.com/users/devarajphukan/orgs","repos_url":"https://api.github.com/users/devarajphukan/repos","events_url":"https://api.github.com/users/devarajphukan/events{/privacy}","received_events_url":"https://api.github.com/users/devarajphukan/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2016-06-08T06:24:00Z","updated_at":"2018-06-11T17:17:41Z","closed_at":"2017-03-31T14:47:51Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3\n\n**JVM version**: 1.8.0_91\n\n**OS version**: Ubuntu 14.04\n\n**Description of the problem including expected versus actual behavior**:\n\nI am running a 8 node cluster, with 5 master eligible nodes. The cluster is configured to take snapshots to an azure container. When a snapshot process was taking too long I ran the delete command and the curl request got stuck. While the snapshot state shows \"IN PROGRESS\" and the some indices of the cluster shows \"DONE\" and some \"ABORTED\".\nBy running the delete command, an ongoing snapshot should have stopped and deleted the files. Now I can't delete or stop the snapshot process, nor can I start a new snapshot process.\n\n**Steps to reproduce**:\n1. Start a snapshot process.\n2. Run Delete command while the snapshot process is running.\n3. Try Starting a new Snapshot\n\n**Provide logs (if relevant)**:\n\n**curl -XGET \"localhost:9200/_snapshot/my_backup/_all?pretty\"**\n{\n  \"snapshots\" : [ {\n    \"snapshot\" : \"20160606-114625\",\n    \"version_id\" : 2030299,\n    \"version\" : \"2.3.2\",\n    \"indices\" : [ \".marvel-es-1-2016.06.06\", \"igdata_archive_v1\", \".kibana\", \"fbdata_archive_v1\", \".marvel-es-data-1\", \"twitterv1\" ],\n    \"state\" : \"IN_PROGRESS\",\n    \"start_time\" : \"2016-06-06T11:46:36.198Z\",\n    \"start_time_in_millis\" : 1465213596198,\n    \"failures\" : [ ],\n    \"shards\" : {\n      \"total\" : 0,\n      \"failed\" : 0,\n      \"successful\" : 0\n    }\n  } ]\n}\n\n**curl -XGET \"localhost:9200/_snapshot/my_backup/_status?pretty\"**\n\n{\n  \"snapshots\" : [ {\n    \"snapshot\" : \"20160606-114625\",\n    \"version_id\" : 2030299,\n    \"version\" : \"2.3.2\",\n    \"indices\" : [ \".marvel-es-1-2016.06.06\", \"igdata_archive_v1\", \".kibana\", \"fbdata_archive_v1\", \".marvel-es-data-1\", \"twitterv1\" ],\n    \"state\" : \"IN_PROGRESS\",\n    \"start_time\" : \"2016-06-06T11:46:36.198Z\",\n    \"start_time_in_millis\" : 1465213596198,\n    \"failures\" : [ ],\n    \"shards\" : {\n      \"total\" : 0,\n      \"failed\" : 0,\n      \"successful\" : 0\n    }\n  } ]\n}\nfrrole@es-prod-0:~$ curl -XGET \"localhost:9200/_snapshot/my_backup/_status?pretty\"{\n  \"snapshots\" : [ {\n    \"snapshot\" : \"20160606-114625\",\n    \"repository\" : \"my_backup\",\n    \"state\" : \"ABORTED\",\n    \"shards_stats\" : {\n      \"initializing\" : 0,\n      \"started\" : 0,\n      \"finalizing\" : 0,\n      \"done\" : 19,\n      \"failed\" : 8,\n      \"total\" : 27\n    },\n    \"stats\" : {\n      \"number_of_files\" : 2569,\n      \"processed_files\" : 1414,\n      \"total_size_in_bytes\" : 894619893816,\n      \"processed_size_in_bytes\" : 273115600981,\n      \"start_time_in_millis\" : 1465213597658,\n      \"time_in_millis\" : 2580664\n    },\n    \"indices\" : {\n      \"igdata_archive_v1\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 8,\n          \"failed\" : 0,\n          \"total\" : 8\n        },\n        \"stats\" : {\n          \"number_of_files\" : 315,\n          \"processed_files\" : 315,\n          \"total_size_in_bytes\" : 640498637,\n          \"processed_size_in_bytes\" : 640498637,\n          \"start_time_in_millis\" : 1465213597710,\n          \"time_in_millis\" : 17707\n        },\n        \"shards\" : {\n          \"0\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 42,\n              \"processed_files\" : 42,\n              \"total_size_in_bytes\" : 78022449,\n              \"processed_size_in_bytes\" : 78022449,\n              \"start_time_in_millis\" : 1465213597745,\n              \"time_in_millis\" : 14713\n            }\n          },\n          \"1\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 49,\n              \"processed_files\" : 49,\n              \"total_size_in_bytes\" : 78835393,\n              \"processed_size_in_bytes\" : 78835393,\n              \"start_time_in_millis\" : 1465213597774,\n              \"time_in_millis\" : 17218\n            }\n          },\n          \"2\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 32,\n              \"processed_files\" : 32,\n              \"total_size_in_bytes\" : 82103826,\n              \"processed_size_in_bytes\" : 82103826,\n              \"start_time_in_millis\" : 1465213597755,\n              \"time_in_millis\" : 12653\n            }\n          },\n          \"3\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 61,\n              \"processed_files\" : 61,\n              \"total_size_in_bytes\" : 80134234,\n              \"processed_size_in_bytes\" : 80134234,\n              \"start_time_in_millis\" : 1465213597763,\n              \"time_in_millis\" : 17654\n            }\n          },\n          \"4\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 29,\n              \"processed_files\" : 29,\n              \"total_size_in_bytes\" : 82384445,\n              \"processed_size_in_bytes\" : 82384445,\n              \"start_time_in_millis\" : 1465213598887,\n              \"time_in_millis\" : 12094\n            }\n          },\n          \"5\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 36,\n              \"processed_files\" : 36,\n              \"total_size_in_bytes\" : 79855636,\n              \"processed_size_in_bytes\" : 79855636,\n              \"start_time_in_millis\" : 1465213597738,\n              \"time_in_millis\" : 13382\n            }\n          },\n          \"6\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 33,\n              \"processed_files\" : 33,\n              \"total_size_in_bytes\" : 77978824,\n              \"processed_size_in_bytes\" : 77978824,\n              \"start_time_in_millis\" : 1465213597710,\n              \"time_in_millis\" : 13688\n            }\n          },\n          \"7\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 33,\n              \"processed_files\" : 33,\n              \"total_size_in_bytes\" : 81183830,\n              \"processed_size_in_bytes\" : 81183830,\n              \"start_time_in_millis\" : 1465213597747,\n              \"time_in_millis\" : 13045\n            }\n          }\n        }\n      },\n      \".marvel-es-data-1\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 1,\n          \"failed\" : 0,\n          \"total\" : 1\n        },\n        \"stats\" : {\n          \"number_of_files\" : 4,\n          \"processed_files\" : 4,\n          \"total_size_in_bytes\" : 5120,\n          \"processed_size_in_bytes\" : 5120,\n          \"start_time_in_millis\" : 1465213597655,\n          \"time_in_millis\" : 1192\n        },\n        \"shards\" : {\n          \"0\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 4,\n              \"processed_files\" : 4,\n              \"total_size_in_bytes\" : 5120,\n              \"processed_size_in_bytes\" : 5120,\n              \"start_time_in_millis\" : 1465213597655,\n              \"time_in_millis\" : 1192\n            }\n          }\n        }\n      },\n      \"fbdata_archive_v1\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 8,\n          \"failed\" : 0,\n          \"total\" : 8\n        },\n        \"stats\" : {\n          \"number_of_files\" : 530,\n          \"processed_files\" : 530,\n          \"total_size_in_bytes\" : 1284798959,\n          \"processed_size_in_bytes\" : 1284798959,\n          \"start_time_in_millis\" : 1465213597772,\n          \"time_in_millis\" : 68473\n        },\n        \"shards\" : {\n          \"0\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 83,\n              \"processed_files\" : 83,\n              \"total_size_in_bytes\" : 252055047,\n              \"processed_size_in_bytes\" : 252055047,\n              \"start_time_in_millis\" : 1465213611060,\n              \"time_in_millis\" : 37487\n            }\n          },\n          \"2\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 38,\n              \"processed_files\" : 38,\n              \"total_size_in_bytes\" : 58202386,\n              \"processed_size_in_bytes\" : 58202386,\n              \"start_time_in_millis\" : 1465213597774,\n              \"time_in_millis\" : 13730\n            }\n          },\n          \"1\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 49,\n              \"processed_files\" : 49,\n              \"total_size_in_bytes\" : 160284115,\n              \"processed_size_in_bytes\" : 160284115,\n              \"start_time_in_millis\" : 1465213597781,\n              \"time_in_millis\" : 22071\n            }\n          },\n          \"4\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 49,\n              \"processed_files\" : 49,\n              \"total_size_in_bytes\" : 85370756,\n              \"processed_size_in_bytes\" : 85370756,\n              \"start_time_in_millis\" : 1465213612519,\n              \"time_in_millis\" : 15931\n            }\n          },\n          \"3\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 78,\n              \"processed_files\" : 78,\n              \"total_size_in_bytes\" : 165212008,\n              \"processed_size_in_bytes\" : 165212008,\n              \"start_time_in_millis\" : 1465213597772,\n              \"time_in_millis\" : 25008\n            }\n          },\n          \"6\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 67,\n              \"processed_files\" : 67,\n              \"total_size_in_bytes\" : 129844814,\n              \"processed_size_in_bytes\" : 129844814,\n              \"start_time_in_millis\" : 1465213597786,\n              \"time_in_millis\" : 20858\n            }\n          },\n          \"5\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 64,\n              \"processed_files\" : 64,\n              \"total_size_in_bytes\" : 117159311,\n              \"processed_size_in_bytes\" : 117159311,\n              \"start_time_in_millis\" : 1465213615057,\n              \"time_in_millis\" : 19244\n            }\n          },\n          \"7\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 102,\n              \"processed_files\" : 102,\n              \"total_size_in_bytes\" : 316670522,\n              \"processed_size_in_bytes\" : 316670522,\n              \"start_time_in_millis\" : 1465213615536,\n              \"time_in_millis\" : 50709\n            }\n          }\n        }\n      },\n      \".kibana\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 1,\n          \"failed\" : 0,\n          \"total\" : 1\n        },\n        \"stats\" : {\n          \"number_of_files\" : 11,\n          \"processed_files\" : 11,\n          \"total_size_in_bytes\" : 51305,\n          \"processed_size_in_bytes\" : 51305,\n          \"start_time_in_millis\" : 1465213597658,\n          \"time_in_millis\" : 2041\n        },\n        \"shards\" : {\n          \"0\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 11,\n              \"processed_files\" : 11,\n              \"total_size_in_bytes\" : 51305,\n              \"processed_size_in_bytes\" : 51305,\n              \"start_time_in_millis\" : 1465213597658,\n              \"time_in_millis\" : 2041\n            }\n          }\n        }\n      },\n      \".marvel-es-1-2016.06.06\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 1,\n          \"failed\" : 0,\n          \"total\" : 1\n        },\n        \"stats\" : {\n          \"number_of_files\" : 22,\n          \"processed_files\" : 22,\n          \"total_size_in_bytes\" : 1381698,\n          \"processed_size_in_bytes\" : 1381698,\n          \"start_time_in_millis\" : 1465213611530,\n          \"time_in_millis\" : 3997\n        },\n        \"shards\" : {\n          \"0\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 22,\n              \"processed_files\" : 22,\n              \"total_size_in_bytes\" : 1381698,\n              \"processed_size_in_bytes\" : 1381698,\n              \"start_time_in_millis\" : 1465213611530,\n              \"time_in_millis\" : 3997\n            }\n          }\n        }\n      },\n      \"twitterv1\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 0,\n          \"failed\" : 8,\n          \"total\" : 8\n        },\n        \"stats\" : {\n          \"number_of_files\" : 1687,\n          \"processed_files\" : 532,\n          \"total_size_in_bytes\" : 892693158097,\n          \"processed_size_in_bytes\" : 271188865262,\n          \"start_time_in_millis\" : 1465213597920,\n          \"time_in_millis\" : 2580402\n        },\n        \"shards\" : {\n          \"6\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 221,\n              \"processed_files\" : 65,\n              \"total_size_in_bytes\" : 124216528136,\n              \"processed_size_in_bytes\" : 41597344471,\n              \"start_time_in_millis\" : 1465213597987,\n              \"time_in_millis\" : 2580283\n            },\n            \"reason\" : \"IndexShardSnapshotFailedException[Aborted]\"\n          },\n          \"7\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 218,\n              \"processed_files\" : 69,\n              \"total_size_in_bytes\" : 127543286629,\n              \"processed_size_in_bytes\" : 38811410641,\n              \"start_time_in_millis\" : 1465213610744,\n              \"time_in_millis\" : 2567483\n            },\n            \"reason\" : \"IndexShardSnapshotFailedException[Aborted]\"\n          },\n          \"2\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 227,\n              \"processed_files\" : 74,\n              \"total_size_in_bytes\" : 127390735566,\n              \"processed_size_in_bytes\" : 36220956572,\n              \"start_time_in_millis\" : 1465213597877,\n              \"time_in_millis\" : 2580272\n            },\n            \"reason\" : \"IndexShardSnapshotFailedException[Aborted]\"\n          },\n          \"3\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"4\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 245,\n              \"processed_files\" : 111,\n              \"total_size_in_bytes\" : 125007807167,\n              \"processed_size_in_bytes\" : 41813102390,\n              \"start_time_in_millis\" : 1465213597920,\n              \"time_in_millis\" : 2580319\n            },\n            \"reason\" : \"IndexShardSnapshotFailedException[Aborted]\"\n          },\n          \"5\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 265,\n              \"processed_files\" : 65,\n              \"total_size_in_bytes\" : 134373968301,\n              \"processed_size_in_bytes\" : 39058558697,\n              \"start_time_in_millis\" : 1465213598117,\n              \"time_in_millis\" : 2580205\n            },\n            \"reason\" : \"IndexShardSnapshotFailedException[Aborted]\"\n          },\n          \"0\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 256,\n              \"processed_files\" : 86,\n              \"total_size_in_bytes\" : 130201274206,\n              \"processed_size_in_bytes\" : 39822216979,\n              \"start_time_in_millis\" : 1465213598039,\n              \"time_in_millis\" : 2580168\n            },\n            \"reason\" : \"IndexShardSnapshotFailedException[Aborted]\"\n          },\n          \"1\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 255,\n              \"processed_files\" : 62,\n              \"total_size_in_bytes\" : 123959558092,\n              \"processed_size_in_bytes\" : 33865275512,\n              \"start_time_in_millis\" : 1465213628544,\n              \"time_in_millis\" : 2549621\n            },\n            \"reason\" : \"IndexShardSnapshotFailedException[Aborted]\"\n          }\n        }\n      }\n    }\n  } ]\n}\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}