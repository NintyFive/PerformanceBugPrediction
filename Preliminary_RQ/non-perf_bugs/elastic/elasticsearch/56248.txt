{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/56248","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56248/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56248/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56248/events","html_url":"https://github.com/elastic/elasticsearch/issues/56248","id":612916277,"node_id":"MDU6SXNzdWU2MTI5MTYyNzc=","number":56248,"title":"Docs: watching-meetup-data.html example has 3 errors preventing example from working","user":{"login":"jasonslater2000","id":1718983,"node_id":"MDQ6VXNlcjE3MTg5ODM=","avatar_url":"https://avatars2.githubusercontent.com/u/1718983?v=4","gravatar_id":"","url":"https://api.github.com/users/jasonslater2000","html_url":"https://github.com/jasonslater2000","followers_url":"https://api.github.com/users/jasonslater2000/followers","following_url":"https://api.github.com/users/jasonslater2000/following{/other_user}","gists_url":"https://api.github.com/users/jasonslater2000/gists{/gist_id}","starred_url":"https://api.github.com/users/jasonslater2000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasonslater2000/subscriptions","organizations_url":"https://api.github.com/users/jasonslater2000/orgs","repos_url":"https://api.github.com/users/jasonslater2000/repos","events_url":"https://api.github.com/users/jasonslater2000/events{/privacy}","received_events_url":"https://api.github.com/users/jasonslater2000/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"},{"id":1967497573,"node_id":"MDU6TGFiZWwxOTY3NDk3NTcz","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Docs","name":"Team:Docs","color":"fef2c0","default":false,"description":"Meta label for docs team"}],"state":"closed","locked":false,"assignee":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"assignees":[{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-05-05T21:48:55Z","updated_at":"2020-05-12T19:39:01Z","closed_at":"2020-05-12T19:39:01Z","author_association":"NONE","active_lock_reason":null,"body":"Our meetup watcher example has 3 errors which prevent it from working as published\r\n\r\ndoc page:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/master/watching-meetup-data.html\r\n\r\nerrors:\r\n(1)\r\n        \"indices\": [\r\n          \"<logstash-{now-1h}>\",\r\n          \"<logstash-{now}>\"\r\n        ],\r\ndoesn't work with the index names logstash will create if ILM is enabled, e.g.\r\nlogstash-2020.05.05-000001\r\n\r\nI believe these indices should have \"-*\" appended, but please verify this for exactly what values are correct under the default ILM policy \"logstash-policy\"\r\n\r\n(2) the field for the three aggs in the query should reference .keyword and not .raw, otherwise the aggs don't work\r\n\r\n         \"aggs\": {\r\n            \"group_by_city\": {\r\n              \"terms\": {\r\n                \"field\": \"group.group_city.raw\",  <-- should be .keyword\r\n                \"size\": 5\r\n              },\r\n              \"aggs\": {\r\n                \"group_by_event\": {\r\n                  \"terms\": {\r\n                    \"field\": \"event.event_url.raw\",  <-- should be .keyword\r\n                    \"size\": 5\r\n                  },\r\n                  \"aggs\": {\r\n                    \"get_latest\": {\r\n                      \"terms\": {\r\n                        \"field\": \"@timestamp\", \r\n                        \"size\": 1,\r\n                        \"order\": {\r\n                          \"_key\": \"desc\"\r\n                        }\r\n                      },\r\n                      \"aggs\": {\r\n                        \"group_by_event_name\": {\r\n                          \"terms\": {\r\n                            \"field\": \"event.event_name.raw\"  <-- should be .keyword\r\n                          }\r\n                        }\r\n                      }\r\n                    }\r\n                  }\r\n\r\n(3) condition should be ctx.payload.hits.total and not ctx.payload.hits.total.value -- the latter does not exist in the result body and the condition is never met\r\n\r\nINCORRECT:\r\n  \"condition\": {\r\n    \"compare\": {\r\n      \"ctx.payload.hits.total.value\": {\r\n        \"gt\": 0\r\n      }\r\n    }\r\n  },\r\n\r\nCORRECT:\r\n  \"condition\": {\r\n    \"compare\": {\r\n      \"ctx.payload.hits.total\": {\r\n        \"gt\": 0\r\n      }\r\n    }\r\n  },\r\n\r\n","closed_by":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"performed_via_github_app":null}