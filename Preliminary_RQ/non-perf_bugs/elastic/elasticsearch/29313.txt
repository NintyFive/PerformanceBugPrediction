{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29313","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29313/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29313/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29313/events","html_url":"https://github.com/elastic/elasticsearch/issues/29313","id":310024831,"node_id":"MDU6SXNzdWUzMTAwMjQ4MzE=","number":29313,"title":"Range datatypes reindex failed when upgrading from 5.6 to 6.2 using remote reindex api","user":{"login":"ydalbj","id":7308871,"node_id":"MDQ6VXNlcjczMDg4NzE=","avatar_url":"https://avatars1.githubusercontent.com/u/7308871?v=4","gravatar_id":"","url":"https://api.github.com/users/ydalbj","html_url":"https://github.com/ydalbj","followers_url":"https://api.github.com/users/ydalbj/followers","following_url":"https://api.github.com/users/ydalbj/following{/other_user}","gists_url":"https://api.github.com/users/ydalbj/gists{/gist_id}","starred_url":"https://api.github.com/users/ydalbj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydalbj/subscriptions","organizations_url":"https://api.github.com/users/ydalbj/orgs","repos_url":"https://api.github.com/users/ydalbj/repos","events_url":"https://api.github.com/users/ydalbj/events{/privacy}","received_events_url":"https://api.github.com/users/ydalbj/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-03-30T09:45:48Z","updated_at":"2018-03-30T15:45:26Z","closed_at":"2018-03-30T15:45:26Z","author_association":"NONE","active_lock_reason":null,"body":"report error:  \"[expected_attendees] is defined as an object in mapping [mytype] but this name is already used for a field in other types\"\r\n\r\nHere is what I did.\r\n\r\n1. Ceate index and add 1 doc on old host with Elasticsearch 5.6, just as the doc example.\r\n``` \r\nPUT range_index_old\r\n{\r\n  \"mappings\": {\r\n    \"mytype\": {\r\n      \"properties\": {\r\n        \"expected_attendees\": {\r\n          \"type\": \"integer_range\"\r\n        },\r\n        \"time_frame\": {\r\n          \"type\": \"date_range\", \r\n          \"format\": \"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPUT range_index_old/mytype/1\r\n{\r\n  \"expected_attendees\" : { \r\n    \"gte\" : 10,\r\n    \"lte\" : 20\r\n  },\r\n  \"time_frame\" : { \r\n    \"gte\" : \"2015-10-31 12:00:00\", \r\n    \"lte\" : \"2015-11-01\"\r\n  }\r\n}\r\n``` \r\n\r\n2.  Create a index with the same mapping on new host with Elasticsearch 6.2\r\n```\r\nPUT range_index_new\r\n{\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"expected_attendees\": {\r\n          \"type\": \"integer_range\"\r\n        },\r\n        \"time_frame\": {\r\n          \"type\": \"date_range\", \r\n          \"format\": \"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n```\r\n\r\n3.  then reindex from old host to new host following the docs( https://www.elastic.co/guide/en/elasticsearch/reference/current/reindex-upgrade-remote.html#reindex-upgrade-remote )\r\n```\r\nPOST _reindex\r\n{\r\n  \"source\": {\r\n    \"remote\": {\r\n      \"host\": \"http://oldhost:9200\",\r\n      \"username\": \"user\",\r\n      \"password\": \"pass\"\r\n    },\r\n    \"index\": \"range_index_old\"\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"range_index_new\"\r\n  }\r\n}\r\n\r\n```\r\n\r\n\r\n4. I'm getting this error response\r\n```\r\n{\r\n  \"took\": 14,\r\n  \"timed_out\": false,\r\n  \"total\": 1,\r\n  \"updated\": 0,\r\n  \"created\": 0,\r\n  \"deleted\": 0,\r\n  \"batches\": 1,\r\n  \"version_conflicts\": 0,\r\n  \"noops\": 0,\r\n  \"retries\": {\r\n    \"bulk\": 0,\r\n    \"search\": 0\r\n  },\r\n  \"throttled_millis\": 0,\r\n  \"requests_per_second\": -1,\r\n  \"throttled_until_millis\": 0,\r\n  \"failures\": [\r\n    {\r\n      \"index\": \"range_index_new\",\r\n      \"type\": \"mytype\",\r\n      \"id\": \"1\",\r\n      \"cause\": {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"[expected_attendees] is defined as an object in mapping [mytype] but this name is already used for a field in other types\"\r\n      },\r\n      \"status\": 400\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n","closed_by":{"login":"ydalbj","id":7308871,"node_id":"MDQ6VXNlcjczMDg4NzE=","avatar_url":"https://avatars1.githubusercontent.com/u/7308871?v=4","gravatar_id":"","url":"https://api.github.com/users/ydalbj","html_url":"https://github.com/ydalbj","followers_url":"https://api.github.com/users/ydalbj/followers","following_url":"https://api.github.com/users/ydalbj/following{/other_user}","gists_url":"https://api.github.com/users/ydalbj/gists{/gist_id}","starred_url":"https://api.github.com/users/ydalbj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ydalbj/subscriptions","organizations_url":"https://api.github.com/users/ydalbj/orgs","repos_url":"https://api.github.com/users/ydalbj/repos","events_url":"https://api.github.com/users/ydalbj/events{/privacy}","received_events_url":"https://api.github.com/users/ydalbj/received_events","type":"User","site_admin":false},"performed_via_github_app":null}