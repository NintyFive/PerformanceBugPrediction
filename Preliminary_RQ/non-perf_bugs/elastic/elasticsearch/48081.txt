{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48081","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48081/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48081/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48081/events","html_url":"https://github.com/elastic/elasticsearch/issues/48081","id":507425687,"node_id":"MDU6SXNzdWU1MDc0MjU2ODc=","number":48081,"title":"NPE ES 7.4 Script score ","user":{"login":"UW-SG","id":22990912,"node_id":"MDQ6VXNlcjIyOTkwOTEy","avatar_url":"https://avatars1.githubusercontent.com/u/22990912?v=4","gravatar_id":"","url":"https://api.github.com/users/UW-SG","html_url":"https://github.com/UW-SG","followers_url":"https://api.github.com/users/UW-SG/followers","following_url":"https://api.github.com/users/UW-SG/following{/other_user}","gists_url":"https://api.github.com/users/UW-SG/gists{/gist_id}","starred_url":"https://api.github.com/users/UW-SG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UW-SG/subscriptions","organizations_url":"https://api.github.com/users/UW-SG/orgs","repos_url":"https://api.github.com/users/UW-SG/repos","events_url":"https://api.github.com/users/UW-SG/events{/privacy}","received_events_url":"https://api.github.com/users/UW-SG/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-10-15T19:01:57Z","updated_at":"2019-10-23T20:45:11Z","closed_at":"2019-10-23T20:45:11Z","author_association":"NONE","active_lock_reason":null,"body":"NPE when using script scores query across multiple indices.\r\n\r\nWhen a range clause is written on a field that exists in just one index, the other indices throw NPE.\r\n\r\norg.elasticsearch.transport.RemoteTransportException: [MSEAIT1034064][127.0.0.1:9300][indices:data/read/search[phase/dfs]]\r\n\r\nCaused by: java.lang.NullPointerException\r\n\r\nat org.elasticsearch.index.query.functionscore.ScriptScoreQueryBuilder.doRewrite(ScriptScoreQueryBuilder.java:176) ~[elasticsearch-7.4.0.jar:7.4.0]\r\nat org.elasticsearch.index.query.AbstractQueryBuilder.rewrite(AbstractQueryBuilder.java:265) ~[elasticsearch-7.4.0.jar:7.4.0]\r\nat org.elasticsearch.search.builder.SearchSourceBuilder.rewrite(SearchSourceBuilder.java:962) ~[elasticsearch-7.4.0.jar:7.4.0]\r\nat org.elasticsearch.search.builder.SearchSourceBuilder.rewrite(SearchSourceBuilder.java:82) ~[elasticsearch-7.4.0.jar:7.4.0]\r\nat org.elasticsearch.index.query.Rewriteable.rewrite(Rewriteable.java:68) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n\r\nIf the script_score clause is removed, the query runs fine.\r\n\r\n\r\nPOST ind1, ind2, ind3/_search?search_type=dfs_query_then_fetch\r\n```\r\n{\r\n  \"query\": {\r\n    \"script_score\": {\r\n      \"query\": {\r\n        \"bool\": {\r\n          \"should\": [\r\n            {\r\n              \"multi_match\": {\r\n                \"query\": \"HR policies\",\r\n                \"fields\": [\r\n                  \"title\",\r\n                  \"body\"\r\n                ]\r\n              }\r\n            },\r\n            {\r\n              \"range\": {\r\n                \"ind1+valid_to\": {\r\n                  \"from\": \"now\",\r\n                  \"to\": null,\r\n                  \"include_lower\": true,\r\n                  \"include_upper\": true,\r\n                  \"boost\": 1\r\n                }\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      },\r\n      \"script\": {\r\n        \"source\": \"return 1;\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}