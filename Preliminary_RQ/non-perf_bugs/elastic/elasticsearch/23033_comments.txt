[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278766909","html_url":"https://github.com/elastic/elasticsearch/issues/23033#issuecomment-278766909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23033","id":278766909,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODc2NjkwOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-02-09T20:41:25Z","updated_at":"2017-02-09T20:41:25Z","author_association":"CONTRIBUTOR","body":"@nik9000 could you reply please?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278770631","html_url":"https://github.com/elastic/elasticsearch/issues/23033#issuecomment-278770631","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23033","id":278770631,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODc3MDYzMQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-02-09T20:54:47Z","updated_at":"2017-02-09T20:54:47Z","author_association":"CONTRIBUTOR","body":"Sure, sure. We chose not to let reindex index back to the same index because for the most part it isn't the right thing to do. It is very easy to get into trouble with versioning when you reindex back to the same index or to make duplicate copies, etc. At the time we figured \"folks can always do the _scroll/_bulk process themselves\". And, you totally can. `_reindex` still doesn't do anything you couldn't do with a script running on the coordinating node. It is much easier though.\r\n\r\nAnd the process you are trying to do is fairly fraught - moving a document from one parent to another means you very well *might* have two copies of the document. You might not, if the two parents happened to be on the same shard.\r\n\r\nAnyway, presuming you work around that issue on your own, you actually *can* reindex to the same index. As soon as you turn on `remote` reindex turns off the same index check. So you can totally try it.\r\n\r\nPersonally I'd write a script that deletes and indexes each document. If you do it in two bulks, both of which `refresh=true` or `refresh=wait_for`, putting all the deletes first and all the indexes second then you won't see duplicate documents. You will miss documents though, but that is the price we pay for not coordinating refreshes across shards.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278770979","html_url":"https://github.com/elastic/elasticsearch/issues/23033#issuecomment-278770979","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23033","id":278770979,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODc3MDk3OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-02-09T20:56:03Z","updated_at":"2017-02-09T20:56:03Z","author_association":"CONTRIBUTOR","body":"thanks @nik9000 ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278843797","html_url":"https://github.com/elastic/elasticsearch/issues/23033#issuecomment-278843797","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23033","id":278843797,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODg0Mzc5Nw==","user":{"login":"maxosprojects","id":7192573,"node_id":"MDQ6VXNlcjcxOTI1NzM=","avatar_url":"https://avatars3.githubusercontent.com/u/7192573?v=4","gravatar_id":"","url":"https://api.github.com/users/maxosprojects","html_url":"https://github.com/maxosprojects","followers_url":"https://api.github.com/users/maxosprojects/followers","following_url":"https://api.github.com/users/maxosprojects/following{/other_user}","gists_url":"https://api.github.com/users/maxosprojects/gists{/gist_id}","starred_url":"https://api.github.com/users/maxosprojects/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxosprojects/subscriptions","organizations_url":"https://api.github.com/users/maxosprojects/orgs","repos_url":"https://api.github.com/users/maxosprojects/repos","events_url":"https://api.github.com/users/maxosprojects/events{/privacy}","received_events_url":"https://api.github.com/users/maxosprojects/received_events","type":"User","site_admin":false},"created_at":"2017-02-10T02:51:31Z","updated_at":"2017-02-10T02:51:31Z","author_association":"NONE","body":"Thank you for your response!\r\nI do understand the risks when applying it without due care. However, at the same time there are plenty other ways to screw your data.\r\n\r\nCould you please elaborate on \"You will miss documents though, but that is the price we pay for not coordinating refreshes across shards\"? Is that in case we delete first?\r\nAlso, I'm not sure if I missed a feature in Elasticsearch or you're referring to some script to run outside elasticsearch when you say \"Personally I'd write a script that deletes and indexes each document\". Could you please clarify?\r\n\r\nAnd one more thing, \"folks can always do the _scroll/_bulk process themselves\" assumes physically loading documents to the application and then reindexing them from that application back, did I get that right?\r\n\r\nI know it is recommended to delete first, but in order to not lose a single document we can't do that (there are plenty possible failure scenarios that would interrupt indexing documents back). The way our index is set up it is easy to find and delete old copies (that has been accounted for) - the new copies will belong to new parent and both have some identifying information, so it's easy to delete old copies by query.\r\n\r\nThanks again for taking time to respond!","performed_via_github_app":null}]