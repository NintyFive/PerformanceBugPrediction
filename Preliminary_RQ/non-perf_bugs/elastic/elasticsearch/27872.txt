{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27872","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27872/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27872/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27872/events","html_url":"https://github.com/elastic/elasticsearch/issues/27872","id":282980241,"node_id":"MDU6SXNzdWUyODI5ODAyNDE=","number":27872,"title":"Elastic nodes goes down as gc kicks in","user":{"login":"dhruvr","id":11910246,"node_id":"MDQ6VXNlcjExOTEwMjQ2","avatar_url":"https://avatars1.githubusercontent.com/u/11910246?v=4","gravatar_id":"","url":"https://api.github.com/users/dhruvr","html_url":"https://github.com/dhruvr","followers_url":"https://api.github.com/users/dhruvr/followers","following_url":"https://api.github.com/users/dhruvr/following{/other_user}","gists_url":"https://api.github.com/users/dhruvr/gists{/gist_id}","starred_url":"https://api.github.com/users/dhruvr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dhruvr/subscriptions","organizations_url":"https://api.github.com/users/dhruvr/orgs","repos_url":"https://api.github.com/users/dhruvr/repos","events_url":"https://api.github.com/users/dhruvr/events{/privacy}","received_events_url":"https://api.github.com/users/dhruvr/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-12-18T18:37:56Z","updated_at":"2019-07-05T09:14:52Z","closed_at":"2017-12-18T18:48:30Z","author_association":"NONE","active_lock_reason":null,"body":"ES Version: 5.4.1\r\nOS: Ubuntu\r\nJava:1.8\r\n\r\n### Issue \r\n\r\n We currently upgraded our systems from es 2.3 to es5.4.1, everything was going well till we deployed it on production. It started with es node going for some time randomly. On  investigation, we saw under logs in es\r\n```\r\n[2017-12-15T20:33:28,459][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][1723] overhead, spent [252ms] collecting in the last [1s]\r\n[2017-12-15T20:42:53,599][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][2288] overhead, spent [288ms] collecting in the last [1s]\r\n[2017-12-15T20:53:55,846][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][2950] overhead, spent [313ms] collecting in the last [1s]\r\n[2017-12-15T21:03:18,145][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][3512] overhead, spent [325ms] collecting in the last [1s]\r\n[2017-12-15T21:45:45,815][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6059] overhead, spent [340ms] collecting in the last [1s]\r\n[2017-12-15T21:46:39,834][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6113] overhead, spent [445ms] collecting in the last [1s]\r\n[2017-12-15T21:46:59,895][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6133] overhead, spent [281ms] collecting in the last [1s]\r\n[2017-12-15T21:47:27,901][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6161] overhead, spent [306ms] collecting in the last [1s]\r\n[2017-12-15T21:51:56,093][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6429] overhead, spent [297ms] collecting in the last [1.1s]\r\n[2017-12-15T21:51:57,094][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6430] overhead, spent [353ms] collecting in the last [1s]\r\n[2017-12-15T21:57:56,361][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6789] overhead, spent [398ms] collecting in the last [1.1s]\r\n[2017-12-15T21:58:23,407][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6816] overhead, spent [284ms] collecting in the last [1s]\r\n[2017-12-15T21:58:24,444][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][6817] overhead, spent [341ms] collecting in the last [1s]\r\n[2017-12-15T22:01:29,536][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][7002] overhead, spent [341ms] collecting in the last [1s]\r\n[2017-12-15T22:01:31,663][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][7004] overhead, spent [399ms] collecting in the last [1.1s]\r\n[2017-12-15T22:01:35,664][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][7008] overhead, spent [273ms] collecting in the last [1s]\r\n[2017-12-15T22:03:08,779][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][7101] overhead, spent [281ms] collecting in the last [1s]\r\n[2017-12-15T22:05:54,928][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][7267] overhead, spent [310ms] collecting in the last [1.1s]\r\n[2017-12-15T22:05:55,928][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][7268] overhead, spent [305ms] collecting in the last [1s]\r\n[2017-12-15T22:05:58,929][INFO ][o.e.m.j.JvmGcMonitorService] [vzvV7bX] [gc][7271] overhead, spent [287ms] collecting in the last [1s]\r\n\r\n```\r\nEarlier the ES 2.3 used to work with 8gb memory on the system with 32 GB ram. We increased the heap space from 8 to 12 and then we increased system ram to 64 GB and give 32 GB heap to elastic search but the es nodes keep going down when there is any heavy query. Please note that earlier everything was working fine.\r\n\r\n\r\nFor 12 GB the details are as under\r\n   \r\n```\r\n  \"jvm\" : {\r\n        \"timestamp\" : 1513422077508,\r\n        \"uptime_in_millis\" : 16750330,\r\n        \"mem\" : {\r\n          \"heap_used_in_bytes\" : 9402202880,\r\n          \"heap_used_percent\" : 73,\r\n          \"heap_committed_in_bytes\" : 12815171584,\r\n          \"heap_max_in_bytes\" : 12815171584,\r\n          \"non_heap_used_in_bytes\" : 97693480,\r\n          \"non_heap_committed_in_bytes\" : 103424000,\r\n          \"pools\" : {\r\n            \"young\" : {\r\n              \"used_in_bytes\" : 441150480,\r\n              \"max_in_bytes\" : 558432256,\r\n              \"peak_used_in_bytes\" : 558432256,\r\n              \"peak_max_in_bytes\" : 558432256\r\n            },\r\n            \"survivor\" : {\r\n              \"used_in_bytes\" : 42550952,\r\n              \"max_in_bytes\" : 69730304,\r\n              \"peak_used_in_bytes\" : 69730304,\r\n              \"peak_max_in_bytes\" : 69730304\r\n            },\r\n            \"old\" : {\r\n              \"used_in_bytes\" : 8918501448,\r\n              \"max_in_bytes\" : 12187009024,\r\n              \"peak_used_in_bytes\" : 8918501448,\r\n              \"peak_max_in_bytes\" : 12187009024\r\n            }\r\n          }\r\n        },\r\n        \"threads\" : {\r\n          \"count\" : 71,\r\n          \"peak_count\" : 95\r\n        },\r\n        \"gc\" : {\r\n          \"collectors\" : {\r\n            \"young\" : {\r\n              \"collection_count\" : 104,\r\n              \"collection_time_in_millis\" : 7078\r\n            },\r\n            \"old\" : {\r\n              \"collection_count\" : 1,\r\n              \"collection_time_in_millis\" : 170\r\n            }\r\n          }\r\n        },\r\n        \"buffer_pools\" : {\r\n          \"direct\" : {\r\n            \"count\" : 67,\r\n            \"used_in_bytes\" : 847203522,\r\n            \"total_capacity_in_bytes\" : 847203521\r\n          },\r\n          \"mapped\" : {\r\n            \"count\" : 1204,\r\n            \"used_in_bytes\" : 16787345787,\r\n            \"total_capacity_in_bytes\" : 16787345787\r\n          }\r\n        },\r\n        \"classes\" : {\r\n          \"current_loaded_count\" : 11025,\r\n          \"total_loaded_count\" : 11025,\r\n          \"total_unloaded_count\" : 0\r\n        }\r\n      }\r\n    }\r\n```\r\n\r\nBut till right now we are not able to find any concrete soln to the problem\r\n\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}