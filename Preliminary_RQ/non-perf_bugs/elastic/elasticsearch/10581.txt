{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10581","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10581/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10581/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10581/events","html_url":"https://github.com/elastic/elasticsearch/issues/10581","id":68196392,"node_id":"MDU6SXNzdWU2ODE5NjM5Mg==","number":10581,"title":"Endless re-syncing mappings","user":{"login":"heffergm","id":629729,"node_id":"MDQ6VXNlcjYyOTcyOQ==","avatar_url":"https://avatars1.githubusercontent.com/u/629729?v=4","gravatar_id":"","url":"https://api.github.com/users/heffergm","html_url":"https://github.com/heffergm","followers_url":"https://api.github.com/users/heffergm/followers","following_url":"https://api.github.com/users/heffergm/following{/other_user}","gists_url":"https://api.github.com/users/heffergm/gists{/gist_id}","starred_url":"https://api.github.com/users/heffergm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/heffergm/subscriptions","organizations_url":"https://api.github.com/users/heffergm/orgs","repos_url":"https://api.github.com/users/heffergm/repos","events_url":"https://api.github.com/users/heffergm/events{/privacy}","received_events_url":"https://api.github.com/users/heffergm/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"assignees":[{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2015-04-13T21:16:43Z","updated_at":"2015-04-15T16:02:22Z","closed_at":"2015-04-15T16:02:19Z","author_association":"NONE","active_lock_reason":null,"body":"We're running into an recurring issue of late where any change in cluster state (typically a node restart during an upgrade for example) results in the following errors streaming to the log of the currently elected master, as well as very high I/O on all eligible masters:\n\n```\n[2015-04-13 21:02:37,917][WARN ][cluster.metadata         ] [elasticsearch-master2.localdomain] [pelias] \nre-syncing mappings with cluster state for types [[osmway, locality, openaddresses, geonames\nosmaddress, admin0, neighborhood, admin2, osmnode, admin1, local_admin]]\n```\n\nWe are presently running 1.5.1, but we had the same issue on 1.5.0. I'm cannot say with certainty whether we experienced the issue under 1.4.x. The production cluster setup is as follows, but we have also seen this problem in local development (single node):\n- 3 master eligible nodes\n- 2 routing (no data, no master) nodes\n- 8 data nodes\n- 40 shards, no replicas, ~600gb of data\n\nThe problematic mapping seems to be the `location` part of the suggester field:\n\n```\nPUT pelias\n{\n  \"mappings\": {\n    \"admin0\": {\n      \"properties\": {\n        \"suggest\": {\n          \"context\": {\n            \"dataset\": {\n              \"default\": [],\n              \"path\": \"_type\",\n              \"type\": \"category\"\n            },\n            \"location\": {\n              \"default\": [],\n              \"neighbors\": true,\n              \"path\": \"center_point\",\n              \"precision\": [2,3,1,5,4],\n              \"type\": \"geo\"\n            }\n          },\n          \"max_input_length\": 50,\n          \"payloads\": false,\n          \"preserve_position_increments\": false,\n          \"preserve_separators\": false,\n          \"type\": \"completion\"\n        }\n      }\n    }\n  }\n}\n```\n","closed_by":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}