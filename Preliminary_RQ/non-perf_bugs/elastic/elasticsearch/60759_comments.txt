[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/669298136","html_url":"https://github.com/elastic/elasticsearch/issues/60759#issuecomment-669298136","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60759","id":669298136,"node_id":"MDEyOklzc3VlQ29tbWVudDY2OTI5ODEzNg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-08-05T16:32:42Z","updated_at":"2020-08-05T16:32:42Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core (:ml)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/671359906","html_url":"https://github.com/elastic/elasticsearch/issues/60759#issuecomment-671359906","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60759","id":671359906,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MTM1OTkwNg==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-08-10T13:39:11Z","updated_at":"2020-08-10T13:39:11Z","author_association":"CONTRIBUTOR","body":"There were a similar set of failures in https://gradle-enterprise.elastic.co/s/eikzb6eka4hk4\r\n\r\nThe `ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean` failed with this:\r\n\r\n```\r\njava.lang.AssertionError: Stats were: {\"id\":\"classification_training_percent_is_50_boolean\",\"state\":\"starting\",\"progress\":[{\"phase\":\"reindexing\",\"progress_percent\":1},{\"phase\":\"loading_data\",\"progress_percent\":0},{\"phase\":\"feature_selection\",\"progress_percent\":0},{\"phase\":\"coarse_parameter_search\",\"progress_percent\":0},{\"phase\":\"fine_tuning_parameters\",\"progress_percent\":0},{\"phase\":\"final_training\",\"progress_percent\":0},{\"phase\":\"writing_results\",\"progress_percent\":0},{\"phase\":\"inference\",\"progress_percent\":0}],\"data_counts\":{\"training_docs_count\":0,\"test_docs_count\":0,\"skipped_docs_count\":0},\"memory_usage\":{\"peak_usage_bytes\":0,\"status\":\"ok\"},\"node\":{\"id\":\"_cUVYHvfR9WfE9JsYwk_6Q\",\"name\":\"integTest-2\",\"ephemeral_id\":\"T2Py-4dsRyqVIYV2kHqN9Q\",\"transport_address\":\"127.0.0.1:56721\",\"attributes\":{\"testattr\":\"test\",\"ml.machine_memory\":\"101104721920\",\"ml.max_open_jobs\":\"20\",\"xpack.installed\":\"true\",\"transform.node\":\"true\"}},\"assignment_explanation\":\"\"}\r\n   Expected: <stopped>\r\n   but: was <starting> \r\n```\r\n\r\nThen 6 more tests failed afterwards with a timeout on cluster health during their test cleanup.  The reason for that is that one of the nodes dies due to an assertion error:\r\n\r\n```\r\n[2020-08-10T12:50:27,133][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [integTest-0] fatal error in thread [elasticsearch[integTest-0][ml_job_comms][T#1]], exiting\r\njava.lang.AssertionError: null\r\n        at org.elasticsearch.xpack.core.ml.inference.trainedmodel.inference.EnsembleInferenceModel.innerInfer(EnsembleInferenceModel.java:139) ~[?:?]\r\n        at org.elasticsearch.xpack.core.ml.inference.trainedmodel.inference.EnsembleInferenceModel.infer(EnsembleInferenceModel.java:123) ~[?:?]\r\n        at org.elasticsearch.xpack.core.ml.inference.trainedmodel.inference.InferenceDefinition.infer(InferenceDefinition.java:80) ~[?:?]\r\n        at org.elasticsearch.xpack.ml.inference.loadingservice.LocalModel.inferNoStats(LocalModel.java:121) ~[?:?]\r\n        at org.elasticsearch.xpack.ml.dataframe.inference.InferenceRunner.inferTestDocs(InferenceRunner.java:116) ~[?:?]\r\n        at org.elasticsearch.xpack.ml.dataframe.inference.InferenceRunner.run(InferenceRunner.java:88) ~[?:?]\r\n        at org.elasticsearch.xpack.ml.dataframe.process.AnalyticsProcessManager.runInference(AnalyticsProcessManager.java:343) ~[?:?]\r\n        at org.elasticsearch.xpack.ml.dataframe.process.AnalyticsProcessManager.processData(AnalyticsProcessManager.java:196) ~[?:?]\r\n        at org.elasticsearch.xpack.ml.dataframe.process.AnalyticsProcessManager.lambda$runJob$1(AnalyticsProcessManager.java:146) ~[?:?]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:651) ~[elasticsearch-7.10.0-SNAPSHOT.jar:7.10.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_241]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_241]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_241]\r\n```\r\n\r\nBecause the tests are against a multi-node cluster the subsequent tests all succeed running against the two nodes that are left (which is good), and the only thing that fails is the check that the cluster is fully healthy.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/671361389","html_url":"https://github.com/elastic/elasticsearch/issues/60759#issuecomment-671361389","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60759","id":671361389,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MTM2MTM4OQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-08-10T13:42:00Z","updated_at":"2020-08-10T13:42:00Z","author_association":"CONTRIBUTOR","body":"The assertion that's failing is `assert featureNames != null && featureNames.length > 0`, so it seems that `ClassificationIT.testWithOnlyTrainingRowsAndTrainingPercentIsFifty_DependentVariableIsBoolean` can cause that sometimes.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/688346666","html_url":"https://github.com/elastic/elasticsearch/issues/60759#issuecomment-688346666","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60759","id":688346666,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODM0NjY2Ng==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2020-09-07T14:03:37Z","updated_at":"2020-09-07T14:03:37Z","author_association":"MEMBER","body":"Another failure on 7.x \r\n\r\nhttps://gradle-enterprise.elastic.co/s/aamxj7fftpyim\r\n\r\nSimilar to the analysis above subsequent tests failed because the cluster cannot get to a green state with 2 nodes \r\n\r\n\r\n```\r\njava.lang.AssertionError: Stats were: {\"id\":\"classification_training_percent_is_50_integer\",\"state\":\"starting\",\"progress\":[{\"phase\":\"reindexing\",\"progress_percent\":1},{\"phase\":\"loading_data\",\"progress_percent\":0},{\"phase\":\"feature_selection\",\"progress_percent\":0},{\"phase\":\"coarse_parameter_search\",\"progress_percent\":0},{\"phase\":\"fine_tuning_parameters\",\"progress_percent\":0},{\"phase\":\"final_training\",\"progress_percent\":0},{\"phase\":\"writing_results\",\"progress_percent\":0},{\"phase\":\"inference\",\"progress_percent\":0}],\"data_counts\":{\"training_docs_count\":0,\"test_docs_count\":0,\"skipped_docs_count\":0},\"memory_usage\":{\"peak_usage_bytes\":0,\"status\":\"ok\"},\"node\":{\"id\":\"7JwK-kHNQ0SRII5ZIGvn0g\",\"name\":\"javaRestTest-2\",\"ephemeral_id\":\"8XZaFiNoQ--_HfVw_beZGA\",\"transport_address\":\"127.0.0.1:52456\",\"attributes\":{\"testattr\":\"test\",\"ml.machine_memory\":\"34359738368\",\"ml.max_open_jobs\":\"20\",\"xpack.installed\":\"true\",\"transform.node\":\"true\"}},\"assignment_explanation\":\"\"}\r\nExpected: <stopped>\r\n     but: was <starting>\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/688817515","html_url":"https://github.com/elastic/elasticsearch/issues/60759#issuecomment-688817515","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60759","id":688817515,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODgxNzUxNQ==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2020-09-08T11:53:34Z","updated_at":"2020-09-08T11:53:34Z","author_association":"MEMBER","body":"The interesting logs:\r\n```\r\n[2020-09-07T06:34:11,718][INFO ][o.e.x.m.d.i.InferenceRunner] [javaRestTest-1] [classification_training_percent_is_50_integer] Started inference on test data against model [classification_training_percent_is_50_integer-1599485651478]\r\n[2020-09-07T06:34:11,720][DEBUG][o.e.x.c.m.i.t.i.EnsembleInferenceModel] [javaRestTest-1] rewriting features {}\r\n[2020-09-07T06:34:11,721][DEBUG][o.e.x.c.m.i.t.i.EnsembleInferenceModel] [javaRestTest-1] detected submodel feature names []\r\n[2020-09-07T06:34:11,721][DEBUG][o.e.x.c.m.i.t.i.TreeInferenceModel] [javaRestTest-1] rewriting features {}\r\n[2020-09-07T06:34:11,721][DEBUG][o.e.x.m.d.i.InferenceRunner] [javaRestTest-1] Loaded inference model [LocalModel{trainedModelDefinition=org.elasticsearch.xpack.core.ml.inference.trainedmodel.inference.InferenceDefinition@68a52920, modelId='classification_training_percent_is_50_integer-1599485651478', fieldNames=[text-field, keyword-field, boolean-field, outer-field.inner-field, alias-to-nested-field, numerical-field, alias-to-keyword-field], defaultFieldMap=null, statsAccumulator=org.elasticsearch.xpack.core.ml.inference.trainedmodel.InferenceStats$Accumulator@54e136, trainedModelStatsService=org.elasticsearch.xpack.ml.inference.TrainedModelStatsService@715eaf81, persistenceQuotient=100, currentInferenceCount=0, inferenceConfig=org.elasticsearch.xpack.core.ml.inference.trainedmodel.ClassificationConfig@646a9ae6, licenseLevel=PLATINUM, trainedModelCircuitBreaker=org.elasticsearch.common.breaker.ChildMemoryCircuitBreaker@28450ef0, referenceCount=1}]\r\n[2020-09-07T06:34:11,725][DEBUG][o.e.x.c.m.i.t.i.EnsembleInferenceModel] [javaRestTest-1] Inference called with feature names []\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/697979868","html_url":"https://github.com/elastic/elasticsearch/issues/60759#issuecomment-697979868","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/60759","id":697979868,"node_id":"MDEyOklzc3VlQ29tbWVudDY5Nzk3OTg2OA==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2020-09-23T21:22:15Z","updated_at":"2020-09-23T21:22:15Z","author_association":"MEMBER","body":"I think we just saw the same failure on 7.9: https://gradle-enterprise.elastic.co/s/kb6rkdcgxggim. Should the fix be backported to 7.9 as well?","performed_via_github_app":null}]