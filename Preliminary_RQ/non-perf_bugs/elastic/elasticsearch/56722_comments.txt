[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/628273868","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-628273868","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":628273868,"node_id":"MDEyOklzc3VlQ29tbWVudDYyODI3Mzg2OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-05-13T22:15:16Z","updated_at":"2020-05-13T22:15:16Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Build)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/628273880","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-628273880","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":628273880,"node_id":"MDEyOklzc3VlQ29tbWVudDYyODI3Mzg4MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-05-13T22:15:17Z","updated_at":"2020-05-13T22:15:17Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-ql (:Query Languages/SQL)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/628274552","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-628274552","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":628274552,"node_id":"MDEyOklzc3VlQ29tbWVudDYyODI3NDU1Mg==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-05-13T22:17:03Z","updated_at":"2020-05-13T22:17:03Z","author_association":"CONTRIBUTOR","body":"It's possible that this somewhat overlaps with what @jakelandis is doing with REST compatibility, as this is another type of forwards compatibility, although implemented a bit differently. Again, in that case (correct me if I'm wrong) newer branches grab the artifact (in this case the rest specs) from the older branch and run them against the current version.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/628293680","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-628293680","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":628293680,"node_id":"MDEyOklzc3VlQ29tbWVudDYyODI5MzY4MA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2020-05-13T23:14:32Z","updated_at":"2020-05-13T23:14:32Z","author_association":"MEMBER","body":"> We'll need to sort out a few things here, such as which direction we test in. Do we do backwards testing, where in which future branches grab the older JDBC drivers and run the tests, or forwards testing, where older branches grab the new Elasticsearch distribution and run the tests?\r\n\r\nI think we should continue with backwards compatibility testing, for a few reasons:\r\n* The compatibility layer is implemented in the \"future\" version. ie in 7.x, we have the compatibility layer with earlier versions, ie backwards compatibility. Thus that is where 7.x should be tested against all the versions it is compatible with.\r\n* As you say, backcompat is the model of tests that we already have. We already have build infrastructure for iterating over compatible versions to build tests against each version.\r\n* It fits better with our branching model. We rarely commit directly to release branches, but instead go through our unreleased branches. It is better to catch compatibility problems in the initial commit rather than only once we backport to a release branch.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/630058200","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-630058200","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":630058200,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDA1ODIwMA==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2020-05-18T09:21:58Z","updated_at":"2020-05-18T09:21:58Z","author_association":"CONTRIBUTOR","body":"FYI I've opened: #56872, to \"isolate\" the jdbc integration tests and avoid hidden bugs because of possible unnecessary pulled in dependencies, and to prepare for the support compatibility testing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/630274196","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-630274196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":630274196,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDI3NDE5Ng==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2020-05-18T15:53:41Z","updated_at":"2020-05-18T15:53:41Z","author_association":"CONTRIBUTOR","body":"I also agree with keeping the bwc scheme. So for example: for 7.8 we can check for each 7.7.x and 7.8.x released versions of ES nodes with the [7.7.0 -> es node version - 1].\r\n\r\nWe'd like to have something soon as new features are blocked by this (for example date_nanos support PR awaits on this).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640535279","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-640535279","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":640535279,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDUzNTI3OQ==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2020-06-08T11:06:28Z","updated_at":"2020-06-08T11:06:28Z","author_association":"CONTRIBUTOR","body":"@mark-vieira @rjernst  Can we please have an ETA for this?\r\n\r\nThe JDBC tests are already split into a separate `jdbc` module under `sql/qa` and we really need this soon as there is already a feature (date_nanos) blocked by it and soon we want to add array support which also needs JDBC changes.\r\n\r\nThank you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/640989458","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-640989458","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":640989458,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MDk4OTQ1OA==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-06-09T02:24:41Z","updated_at":"2020-06-09T02:24:41Z","author_association":"CONTRIBUTOR","body":"I don't have a concrete ETA for you but I've thrown this on the top of the list for upcoming work.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/645517673","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-645517673","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":645517673,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NTUxNzY3Mw==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-06-17T17:35:00Z","updated_at":"2020-06-17T17:35:00Z","author_association":"CONTRIBUTOR","body":"@matriv I presume that the set of tests that we want to perform compatibility testing with are everything under `:x-pack:plugin:sq:qa:jdbc`. Essentially the suite of tests represented by this build: https://gradle-enterprise.elastic.co/s/5sd7brkq23oi6/tests?collapse-all\r\n\r\nThe tests in `:x-pack:plugin:sql:jdbc` are simply unit tests, so compatibility testing is not applicable there. Correct?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/645863380","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-645863380","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":645863380,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NTg2MzM4MA==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2020-06-18T08:24:04Z","updated_at":"2020-06-18T08:24:04Z","author_association":"CONTRIBUTOR","body":"@mark-vieira Correct! only the `:x-pack:plugin:sq:qa:jdbc`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/649793813","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-649793813","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":649793813,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTc5MzgxMw==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-06-25T20:13:55Z","updated_at":"2020-06-25T20:14:28Z","author_association":"CONTRIBUTOR","body":"One thing I ran into here is that it's going to be problematic to use the shadowjar as the test artifact here. To do so, we have to exclude any dependencies from the test classpath that are bundled in the JDBC driver fatjar (things like core libs, etc). The problem is, then we use the libraries from the BWC jar when testing, which causes errors like this:\r\n\r\nhttps://gradle-enterprise.elastic.co/s/cxm6mvbcixo4c/tests/:x-pack:plugin:sql:qa:jdbc:single-node:v7.8.1%23bwcTest/org.elasticsearch.xpack.sql.qa.jdbc.single_node.JdbcFetchSizeIT/initializationError#1\r\n\r\nWe are relying on the JDBC driver jar to bring in that class, but it doesn't exist in `7.8` and thus the test fails. I'm not sure we have a good solution here other than to use the \"slim\" jar for testing and otherwise use the ES dependencies from the current branch. This is bound to cause other issues though, as we are likely to have incompatibilities between the two.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/649796355","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-649796355","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":649796355,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTc5NjM1NQ==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-06-25T20:19:20Z","updated_at":"2020-06-25T20:48:03Z","author_association":"CONTRIBUTOR","body":"I'm struggling to find a good way forward here given the way these tests are currently architected. The problem is our `:test:framework` code brings in `:server` and other core libraries which are going to clash with the same classes coming in from the JDBC driver jar. In my mind we have two options here if we want to do compatibility testing with older JDBC driver jars:\r\n\r\n1. We rearchitect the tests such that they load the JDBC driver fatjar in some kind of isolated classloader that can't see the rest of the test runner classpath.\r\n2. We relocate `org.elasticsearch` classes in the JDBC driver jar under a different package so they can both exist on the same classpath simultaneously.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/649811329","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-649811329","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":649811329,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTgxMTMyOQ==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-06-25T20:52:01Z","updated_at":"2020-06-25T20:52:01Z","author_association":"CONTRIBUTOR","body":"I'll add a third item:\r\n\r\n3. We don't use `ESRestTestCase`, remove the dependency on `:test:framework` altogether and directly extend `LuceneTestCase` for these tests. I don't see much need to use `ESRestTestCase` anyhow.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/649812884","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-649812884","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":649812884,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTgxMjg4NA==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-06-25T20:55:34Z","updated_at":"2020-06-25T20:55:34Z","author_association":"CONTRIBUTOR","body":"Ok item (3) likely won't work since these tests rely on `RestClient` to setup test data.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/650719115","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-650719115","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":650719115,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDcxOTExNQ==","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"created_at":"2020-06-28T08:44:09Z","updated_at":"2020-06-28T08:44:09Z","author_association":"MEMBER","body":"Thanks for looking into this @mark-vieira. Both (1) and (2) work for me - I have a slight preference towards (2) since, despite not being a fan of shadowing packages, medium term this might prove beneficial as embedding JDBC drivers in other Java apps that use ES, will lead to the same problem that you are facing - classpath issues.\r\nSo moving all packages out of the way would address both problems.\r\n\r\nThe concern that I have though is this feature will be available only moving forward so past releases (in this case 7.7) would miss out on this. However I'd rather have us acting quickly through (2) and then look into ways to address 7.7 later down the road if we really have to.\r\n\r\nSo 👍 for going with (2).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/651255282","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-651255282","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":651255282,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTI1NTI4Mg==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-06-29T17:23:10Z","updated_at":"2020-06-29T17:23:10Z","author_association":"CONTRIBUTOR","body":"> The concern that I have though is this feature will be available only moving forward so past releases (in this case 7.7) would miss out on this.\r\n\r\nCorrect, with this option we effectively cannot do compatibility testing with existing releases. We would have to start with `7.8.1` given that would be the first available version with relocated packages. That means that we will not know if we break backcompat with the 7.7 driver (although 7.8.1 will be a pretty close analog).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/651687149","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-651687149","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":651687149,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTY4NzE0OQ==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2020-06-30T09:47:00Z","updated_at":"2020-06-30T09:47:00Z","author_association":"CONTRIBUTOR","body":"Even though this is not ideal, we can assume that is safe enough to start with `7.8.1`, so if (1) is difficult to implement, it's fine also by me to go with the (2) approach.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/651877989","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-651877989","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":651877989,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTg3Nzk4OQ==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-06-30T15:43:51Z","updated_at":"2020-06-30T15:43:51Z","author_association":"CONTRIBUTOR","body":"> so if (1) is difficult to implement, it's fine also by me to go with the (2) approach\r\n\r\nTo clarify, I've not investigated what it would take to implement solution (1). I suspect someone more familiar with the tests would be better suited to do that. It might be worth looking into in parallel with this. Course (2) is not necessarily an easy win, package relocation might not easily work, as it doesn't play nicely with things like reflection. We may find out that we have to make code changes in the JDBC driver or some of it's dependencies to make that work, at which point refactoring the tests might be an easier road.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/652608088","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-652608088","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":652608088,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjYwODA4OA==","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"created_at":"2020-07-01T19:35:32Z","updated_at":"2020-07-01T19:35:32Z","author_association":"MEMBER","body":"> Course (2) is not necessarily an easy win, package relocation might not easily work, as it doesn't play nicely with things like reflection. We may find out that we have to make code changes in the JDBC driver or some of it's dependencies to make that work, at which point refactoring the tests might be an easier road.\r\n\r\nHave you tried changing the packages and encountered failures? The JDBC driver is not using reflection nor does it depend on the package name; maybe the `org.elasticsearch` dependency does but this would be easy to find out by just trying things out.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/652610745","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-652610745","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":652610745,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjYxMDc0NQ==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-07-01T19:41:49Z","updated_at":"2020-07-01T19:41:49Z","author_association":"CONTRIBUTOR","body":"> Have you tried changing the packages and encountered failures? \r\n\r\nI have not yet, I'll be giving this a try soon.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/655804960","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-655804960","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":655804960,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTgwNDk2MA==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-07-08T23:13:59Z","updated_at":"2020-07-08T23:13:59Z","author_association":"CONTRIBUTOR","body":"Ok, with some tinkering I was able to get a green build of the current integration test suite against a shadowjar with relocated `org.elasticsearch` packages.\r\n\r\nhttps://gradle-enterprise.elastic.co/s/3cutzwlvii6lq/tests\r\n\r\nI'll move on to testing this against similarly configured BWC branch as well.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/655813296","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-655813296","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":655813296,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTgxMzI5Ng==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-07-08T23:42:24Z","updated_at":"2020-07-08T23:42:49Z","author_association":"CONTRIBUTOR","body":"Here we are folks. This is a successful run of building the 7.8.1 JDBC driver (with relocated shadowed dependencies) and testing against a 7.9 Elasticsearch cluster.\r\n\r\nhttps://gradle-enterprise.elastic.co/s/sqjzlft75tx42/tests\r\n\r\nSince this approach seems to be ok I'll move forward with getting the necessary changes made in the 7.8 branch and forward. I'd also highly suggest we expand the existing test suite to also validate the current JDBC driver version is what we expect. I'm going to inject a `jdbc.driver.version` system property into the test runner with the \"expected\" JDBC jar version. We should add a unit test to validate that matches the reality of what's on the test classpath. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/665930929","html_url":"https://github.com/elastic/elasticsearch/issues/56722#issuecomment-665930929","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56722","id":665930929,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NTkzMDkyOQ==","user":{"login":"mark-vieira","id":4106672,"node_id":"MDQ6VXNlcjQxMDY2NzI=","avatar_url":"https://avatars2.githubusercontent.com/u/4106672?v=4","gravatar_id":"","url":"https://api.github.com/users/mark-vieira","html_url":"https://github.com/mark-vieira","followers_url":"https://api.github.com/users/mark-vieira/followers","following_url":"https://api.github.com/users/mark-vieira/following{/other_user}","gists_url":"https://api.github.com/users/mark-vieira/gists{/gist_id}","starred_url":"https://api.github.com/users/mark-vieira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mark-vieira/subscriptions","organizations_url":"https://api.github.com/users/mark-vieira/orgs","repos_url":"https://api.github.com/users/mark-vieira/repos","events_url":"https://api.github.com/users/mark-vieira/events{/privacy}","received_events_url":"https://api.github.com/users/mark-vieira/received_events","type":"User","site_admin":false},"created_at":"2020-07-29T21:12:45Z","updated_at":"2020-07-29T21:12:45Z","author_association":"CONTRIBUTOR","body":"Alright with https://github.com/elastic/elasticsearch/pull/60430 merged we now have this in place. We didn't make this in to 7.8 so we are beginning compatibility testing with 7.9. As mentioned above, I would highly recommend putting some assertions in place to confirm the JDBC driver being loaded is the version that's expected in case we muck up the build wiring somehow.","performed_via_github_app":null}]