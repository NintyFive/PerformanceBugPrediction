{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27568","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27568/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27568/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27568/events","html_url":"https://github.com/elastic/elasticsearch/issues/27568","id":277477146,"node_id":"MDU6SXNzdWUyNzc0NzcxNDY=","number":27568,"title":"Deprecate and remove parsing of fractional bytes values","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"},{"id":33660,"node_id":"MDU6TGFiZWwzMzY2MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebreaking","name":">breaking","color":"d93f0b","default":false,"description":null},{"id":189346177,"node_id":"MDU6TGFiZWwxODkzNDYxNzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edeprecation","name":">deprecation","color":"ce18a7","default":false,"description":null},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2017-11-28T17:47:31Z","updated_at":"2019-02-07T10:44:48Z","closed_at":"2017-12-14T12:17:18Z","author_association":"MEMBER","active_lock_reason":null,"body":"We use ByteSizeValue to represent settings and API parameters that are byte values. This allows the user to specify the values in a human readable form and Elasticsearch to interpret it in the units most convenient to what it wants to do with the value (e.g. the user specifies the index buffer size as `\"56MB\"` but Elasticsearch converts this to 58720256 bytes and uses that value.\r\n\r\nHowever, the current implementation has a few problems:\r\n* The `toString()` method outputs fractional values (to 1 decimal place) preventing round trip parsing\r\n* Parsing is sensitive to double rounding errors\r\n* The parsing always converts the provided value to bytes so can overflow which results in the value being Long.MAX_VALUE bytes for large values (in PB range)\r\n* The unit is not serialised so on deserialisation the value is the bytes value\r\n\r\nWe should instead prevent fractional values from being used and store the value in the original units.\r\n\r\n@jasontedor and I spoke about this an propose the following approach:\r\n* In 6.x \r\n    * Deprecate fractional parsing\r\n    * Rename ByteSizeValue -> LegacyByteSizeValue\r\n    * Add `@Deprecated` to LegacyByteSizeValue\r\n    * Introduce ByteSizeValue with desired behavior:\r\n        * Add a `getStringRep()` method which like TimeValue will output a String with the current value and unit\r\n        * Throw an exception in the `parseByteSizeValue()` method if the input string contains a fractional value\r\n        * Keep the original unit when parsing (e.g. 20MB is represented with units MB rather than converting it to bytes)\r\n    * Use ByteSizeValue (the new one) in new APIs/settings\r\n* In 7.0:\r\n    * Auto-upgrade cluster and index settings from LegacyByteSizeValue to ByteSizeValue (the new one) and remove LegacyByteSizeValue. Fractional bytes values in elasticsearch.yml will need to be manually changed by the user when upgrading to 7.0 or can be changed before upgrading.","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}