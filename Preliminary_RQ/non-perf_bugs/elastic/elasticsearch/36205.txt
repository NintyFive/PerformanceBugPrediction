{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36205","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36205/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36205/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36205/events","html_url":"https://github.com/elastic/elasticsearch/issues/36205","id":387190269,"node_id":"MDU6SXNzdWUzODcxOTAyNjk=","number":36205,"title":"Test Failure: NetworkDisruptionIT fails ","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":1222918656,"node_id":"MDU6TGFiZWwxMjIyOTE4NjU2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.0","name":"v7.2.0","color":"DDDDDD","default":false,"description":""},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-12-04T09:22:39Z","updated_at":"2020-11-11T21:50:02Z","closed_at":"2019-05-23T09:00:37Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"As part of  #36107 tests that did not run before from `tests/framework` are enabled uncovering these failures.\r\n\r\nReproduce with (note that changes from #36107 and un-muting are required to reproduce):\r\n```\r\n./gradlew :test:framework:integTest -Dtests.seed=B9241F7F0412788F\r\n```\r\nFails with (specific to this seed):\r\n```\r\nFAILURE 1.44s J0 | NetworkDisruptionIT.testNetworkPartitionRemovalRestoresConnections <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: max must be >= min: 1, 0\r\n   >    at __randomizedtesting.SeedInfo.seed([B9241F7F0412788F:78B82F532E5AB157]:0)\r\n   >    at com.carrotsearch.randomizedtesting.generators.RandomNumbers.randomIntBetween(RandomNumbers.java:16)\r\n   >    at org.elasticsearch.test.ESTestCase.randomIntBetween(ESTestCase.java:539)\r\n   >    at org.elasticsearch.test.disruption.NetworkDisruptionIT.testNetworkPartitionRemovalRestoresConnections(NetworkDisruptionIT.java:64)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n   >    at java.base/java.lang.Thread.run(Thread.java:834)\r\nIGNOR/A 0.00s J0 | NetworkDisruptionIT.testNetworkPartitionWithNodeShutdown\r\n```\r\n\r\nAnd:\r\n```\r\n  2> REPRODUCE WITH: ./gradlew :test:framework:integTest -Dtests.seed=41410B614A82118A -Dtests.class=org.elasticsearch.test.disruption.NetworkDisruptionIT -Dtests.method=\"testNetworkPartitionWithNodeShutdown\" -Dtests.security.manager=true -Dtests.locale=no -Dtests.timezone=Europe/Vaduz -Dcompiler.java=11 -Druntime.java=11\r\nERROR   35.5s J0 | NetworkDisruptionIT.testNetworkPartitionWithNodeShutdown <<< FAILURES!\r\n   > Throwable #1: ElasticsearchException[failed to update minimum master node to [1] (current masters [2])]; nested: MasterNotDiscoveredException[FailedToCommitClusterStateException[timed out while waiting for enough masters to ack sent cluster state. [1] left]]; nested: FailedToCommitClusterStateException[timed out while waiting for enough masters to ack sent cluster state. [1] left];\r\n   >    at __randomizedtesting.SeedInfo.seed([41410B614A82118A:1DCCF52EC8AF773]:0)\r\n   >    at org.elasticsearch.test.InternalTestCluster.updateMinMasterNodes(InternalTestCluster.java:1926)\r\n   >    at org.elasticsearch.test.InternalTestCluster.stopNodesAndClients(InternalTestCluster.java:1606)\r\n   >    at org.elasticsearch.test.InternalTestCluster.stopNodesAndClient(InternalTestCluster.java:1599)\r\n   >    at org.elasticsearch.test.InternalTestCluster.stopRandomNode(InternalTestCluster.java:1508)\r\n   >    at org.elasticsearch.test.disruption.NetworkDisruptionIT.testNetworkPartitionWithNodeShutdown(NetworkDisruptionIT.java:50)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n   >    at java.base/java.lang.Thread.run(Thread.java:834)\r\n   > Caused by: MasterNotDiscoveredException[FailedToCommitClusterStateException[timed out while waiting for enough masters to ack sent cluster state. [1] left]]; nested: FailedToCommitClusterStateException[timed out while waiting for enough masters to ack sent cluster state. [1] left];\r\n   >    at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$4.onTimeout(TransportMasterNodeAction.java:259)\r\n   >    at org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onTimeout(ClusterStateObserver.java:322)\r\n   >    at org.elasticsearch.cluster.ClusterStateObserver.waitForNextChange(ClusterStateObserver.java:146)\r\n   >    at org.elasticsearch.cluster.ClusterStateObserver.waitForNextChange(ClusterStateObserver.java:117)\r\n   >    at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction.retry(TransportMasterNodeAction.java:243)\r\n   >    at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction.access$400(TransportMasterNodeAction.java:141)\r\n   >    at org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$1.onFailure(TransportMasterNodeAction.java:199)\r\n   >    at org.elasticsearch.cluster.AckedClusterStateUpdateTask.onFailure(AckedClusterStateUpdateTask.java:79)\r\n   >    at org.elasticsearch.action.admin.cluster.settings.TransportClusterUpdateSettingsAction$1.onFailure(TransportClusterUpdateSettingsAction.java:176)\r\n   >    at org.elasticsearch.cluster.service.MasterService$SafeClusterStateTaskListener.onFailure(MasterService.java:457)\r\n   >    at org.elasticsearch.cluster.service.MasterService$TaskOutputs.lambda$publishingFailed$0(MasterService.java:361)\r\n   >    at java.util.ArrayList.forEach(ArrayList.java:1540)\r\n   >    at org.elasticsearch.cluster.service.MasterService$TaskOutputs.publishingFailed(MasterService.java:361)\r\n   >    at org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:235)\r\n   >    at org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:137)\r\n   >    at org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150)\r\n   >    at org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188)\r\n   >    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:660)\r\n   >    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244)\r\n   >    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207)\r\n   >    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n   >    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n   >    at java.lang.Thread.run(Thread.java:834)\r\n   > Caused by: FailedToCommitClusterStateException[timed out while waiting for enough masters to ack sent cluster state. [1] left]\r\n   >    at org.elasticsearch.discovery.zen.PublishClusterStateAction$SendingController.waitForCommit(PublishClusterStateAction.java:541)\r\n   >    at org.elasticsearch.discovery.zen.PublishClusterStateAction.innerPublish(PublishClusterStateAction.java:199)\r\n   >    at org.elasticsearch.discovery.zen.PublishClusterStateAction.publish(PublishClusterStateAction.java:162)\r\n   >    at org.elasticsearch.discovery.zen.ZenDiscovery.publish(ZenDiscovery.java:340)\r\n   >    at org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:230)\r\n   >    ... 9 more\r\n```","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}