[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422982414","html_url":"https://github.com/elastic/elasticsearch/issues/33872#issuecomment-422982414","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33872","id":422982414,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjk4MjQxNA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-19T22:41:47Z","updated_at":"2018-09-19T22:41:47Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423053585","html_url":"https://github.com/elastic/elasticsearch/issues/33872#issuecomment-423053585","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33872","id":423053585,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzA1MzU4NQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T06:17:51Z","updated_at":"2018-09-20T06:17:51Z","author_association":"CONTRIBUTOR","body":"@rlhh are you getting any failures in the logs that might indicate why the shard failed? If not, can you set the logger level of `org.elasticsearch.cluster.action.shard` to `DEBUG`, and try to reproduce this again?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423201300","html_url":"https://github.com/elastic/elasticsearch/issues/33872#issuecomment-423201300","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33872","id":423201300,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzIwMTMwMA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T14:19:46Z","updated_at":"2018-09-20T14:20:16Z","author_association":"CONTRIBUTOR","body":"I tried to reproduce this and could not. I started a three-node cluster and created a one-shard one-replica index:\r\n\r\n```\r\nPUT /i\r\n{\r\n  \"settings\": {\r\n    \"number_of_shards\": 1,\r\n    \"number_of_replicas\": 1,\r\n    \"refresh_interval\": 0\r\n  }\r\n}\r\n```\r\n\r\nI then started 30 processes concurrently bulk-indexing documents into this shard (10 per node), each repeatedly doing this:\r\n\r\n```\r\nPOST /i/_doc/_bulk\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n{\"index\":{}}\r\n{}\r\n```\r\n\r\nI then repeatedly moved the primary shard between the two nodes that didn't hold the replica using this:\r\n\r\n```\r\nPOST /_cluster/reroute\r\n{\r\n  \"commands\": [\r\n    {\r\n      \"move\": {\r\n        \"index\": \"i\",\r\n        \"shard\": 0,\r\n        \"from_node\": \"node-0\",\r\n        \"to_node\": \"node-1\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n\r\nGET _cluster/health?wait_for_no_relocating_shards=true\r\n\r\nPOST /_cluster/reroute\r\n{\r\n  \"commands\": [\r\n    {\r\n      \"move\": {\r\n        \"index\": \"i\",\r\n        \"shard\": 0,\r\n        \"from_node\": \"node-1\",\r\n        \"to_node\": \"node-0\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n\r\nGET _cluster/health?wait_for_no_relocating_shards=true\r\n```\r\n\r\nAt no point did I see a log message indicating there were any unallocated shards, or that the cluster health had dropped from GREEN. However, it was notable that sometimes the relocation took quite some time, and in this case stopping the source node prematurely would result in an unassigned shard. Is this perhaps what's happening?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/423346441","html_url":"https://github.com/elastic/elasticsearch/issues/33872#issuecomment-423346441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33872","id":423346441,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzM0NjQ0MQ==","user":{"login":"rlhh","id":3825824,"node_id":"MDQ6VXNlcjM4MjU4MjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/3825824?v=4","gravatar_id":"","url":"https://api.github.com/users/rlhh","html_url":"https://github.com/rlhh","followers_url":"https://api.github.com/users/rlhh/followers","following_url":"https://api.github.com/users/rlhh/following{/other_user}","gists_url":"https://api.github.com/users/rlhh/gists{/gist_id}","starred_url":"https://api.github.com/users/rlhh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rlhh/subscriptions","organizations_url":"https://api.github.com/users/rlhh/orgs","repos_url":"https://api.github.com/users/rlhh/repos","events_url":"https://api.github.com/users/rlhh/events{/privacy}","received_events_url":"https://api.github.com/users/rlhh/received_events","type":"User","site_admin":false},"created_at":"2018-09-20T21:54:27Z","updated_at":"2018-09-20T21:54:27Z","author_association":"NONE","body":"I just tried reproducing this earlier today and was unable to. The only cluster setting change that we've made since opening this issue in the first place is that we've turned off tcp compression (because it has been slowing down our recoveries https://github.com/elastic/elasticsearch/issues/33844#issuecomment-423251859). I'll close this for now and report back again if I can reproduce it. ","performed_via_github_app":null}]