{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1873","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1873/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1873/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1873/events","html_url":"https://github.com/elastic/elasticsearch/issues/1873","id":4175410,"node_id":"MDU6SXNzdWU0MTc1NDEw","number":1873,"title":"Nodes drop their copy of auto-expanded data when coming up, only to sync it again","user":{"login":"avar","id":45301,"node_id":"MDQ6VXNlcjQ1MzAx","avatar_url":"https://avatars3.githubusercontent.com/u/45301?v=4","gravatar_id":"","url":"https://api.github.com/users/avar","html_url":"https://github.com/avar","followers_url":"https://api.github.com/users/avar/followers","following_url":"https://api.github.com/users/avar/following{/other_user}","gists_url":"https://api.github.com/users/avar/gists{/gist_id}","starred_url":"https://api.github.com/users/avar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avar/subscriptions","organizations_url":"https://api.github.com/users/avar/orgs","repos_url":"https://api.github.com/users/avar/repos","events_url":"https://api.github.com/users/avar/events{/privacy}","received_events_url":"https://api.github.com/users/avar/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":110557212,"node_id":"MDU6TGFiZWwxMTA1NTcyMTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/high%20hanging%20fruit","name":"high hanging fruit","color":"fc6149","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"assignees":[{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2012-04-18T16:16:56Z","updated_at":"2018-05-07T20:26:32Z","closed_at":"2018-05-07T20:26:32Z","author_association":"NONE","active_lock_reason":null,"body":"When you have an index with `index.auto_expand_replicas=0-all` running on 3 nodes and you bring down one node the number of replicas will be reduced by the master from 2 to 1. Then when the node that just went down comes up again ElasticSearch on that node will will:\n1. Go up, notice that the number of replicas for that index is 1, and promptly drop its own data as redundant\n2. The master will notice that it has a new node in the cluster, set the number of replicas to 2.\n3. The node that just dropped its data will now have the data it just dropped re-synced to it.\n\nInstead ElasticSearch should:\n1. Go up, wait for the master to adjust the number of replicas if needed\n2. Only after that's done drop anything, if needed.\n3. Not re-sync any data since it didn't drop the data in the brief interim when the master was adjusting the number of replicas from 1 to 2.\n\nThis'll aid recovery time where you have a setup where a relatively small index is available on all the nodes for capacity reasons, and you bring up a new node that should serve search requests right away.\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}