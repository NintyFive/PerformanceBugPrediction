{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32883","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32883/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32883/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32883/events","html_url":"https://github.com/elastic/elasticsearch/issues/32883","id":350924113,"node_id":"MDU6SXNzdWUzNTA5MjQxMTM=","number":32883,"title":"Rollover API is inconsistent and does not guarantee the index rollover successfully","user":{"login":"adeshp","id":9387270,"node_id":"MDQ6VXNlcjkzODcyNzA=","avatar_url":"https://avatars1.githubusercontent.com/u/9387270?v=4","gravatar_id":"","url":"https://api.github.com/users/adeshp","html_url":"https://github.com/adeshp","followers_url":"https://api.github.com/users/adeshp/followers","following_url":"https://api.github.com/users/adeshp/following{/other_user}","gists_url":"https://api.github.com/users/adeshp/gists{/gist_id}","starred_url":"https://api.github.com/users/adeshp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adeshp/subscriptions","organizations_url":"https://api.github.com/users/adeshp/orgs","repos_url":"https://api.github.com/users/adeshp/repos","events_url":"https://api.github.com/users/adeshp/events{/privacy}","received_events_url":"https://api.github.com/users/adeshp/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-08-15T18:54:30Z","updated_at":"2019-09-06T19:46:38Z","closed_at":"2019-09-06T19:46:38Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch version: 6.2.4,\r\nlucene_version :  7.2.1,\r\nPlugins installed: Kibana\r\nJVM version(`java -version`):\r\n         openjdk version \"1.8.0_181\"\r\n         OpenJDK Runtime Environment (build 1.8.0_181-8u181-b13-0ubuntu0.16.04.1-b13)\r\n         OpenJDK 64-Bit Server VM (build 25.181-b13, mixed mode)\r\n\r\nOS version (`uname -a` if on a Unix-like system):  \r\n          Linux 4.4.0-1062-aws #71-Ubuntu SMP  x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nDescription of the problem including expected versus actual behavior:\r\n\r\n     ES rollover API should create a new index for a given alias.\r\n     (https://www.elastic.co/guide/en/elasticsearch/reference/master/indices-rollover-index.html)\r\n     \r\n    Actual Behavior is inconsistent. Sometimes it does rollover as it should and create a new index\r\n    with the index name provided in the API request and the alias provided to it.\r\n\r\n     Other times, it creates the new index but uses the alias name to name the index rather than the \r\n     provided index name in the API parameter.\r\n\r\n    And there were also couple of instances when it created the the new index using the alias name, \r\n    then  threw exception that the source alias is a concrete index.\r\n \r\n \r\n**Steps to reproduce**:\r\n\r\n\r\n 1. Create an index.\r\n 2. Add an alias to it.\r\n 3. Use Rollover API provided to rollover this index by providing the new index name that you want to \r\n      be created and the above alias.\r\n\r\n      As the behavior is inconsistent, you may need to try doing it multiple times.\r\n\r\n**Provide logs (if relevant)**:\r\nI used Elastic search PHP client latest one. (6.0)\r\nThe API is documented at https://www.elastic.co/guide/en/elasticsearch/client/php-api/master/ElasticsearchPHP_Endpoints.html#Elasticsearch_Namespaces_IndicesNamespacerollover_rollover.\r\n\r\n\r\nThe exception that I got:\r\n\r\n{\"error\":{\"root_cause\":[{\"type\":\"remote_transport_exception\",\"reason\":\"[i-0d69a7ef7e924b55b][172.17.5.70:9300][indices:admin/rollover]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"source alias is a concrete index\"},\"status\":400}\r\n\r\nfor the request that I sent:\r\n\r\n```\r\nArray\r\n(\r\n    [newIndex] => 1-emails-index-2018-08-13-1\r\n    [alias] => 1-emails-index\r\n    [body] => Array\r\n        (\r\n            [conditions] => Array\r\n                (\r\n                    [max_age] => 167h\r\n                )\r\n            [aliases] => Array\r\n                (\r\n                    [1-emails-index-search] => stdClass Object\r\n                        (\r\n                        )\r\n\r\n                )\r\n            [settings] => Array\r\n                (\r\n                    [number_of_shards] => 1\r\n                    [number_of_replicas] => 3\r\n                )\r\n        )\r\n)\r\n\r\n```\r\n\r\n\r\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}