{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25956","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25956/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25956/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25956/events","html_url":"https://github.com/elastic/elasticsearch/issues/25956","id":246486646,"node_id":"MDU6SXNzdWUyNDY0ODY2NDY=","number":25956,"title":"NPE when searching * against an index with default field set (but field does not exist)","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2017-07-29T00:26:57Z","updated_at":"2018-02-14T13:28:43Z","closed_at":"2017-08-02T08:06:35Z","author_association":"MEMBER","active_lock_reason":null,"body":"ES 5.5\r\n\r\nWhen an index has a default field defined in the index settings\r\n\r\n```\r\n\"settings\": {\r\n   \"index\": {\r\n    \"query\": {\r\n     \"default_field\": \"message\"\r\n    },\r\n    \"number_of_replicas\": \"1\"\r\n   }\r\n  }\r\n```\r\n\r\nbut the actual field does not exist, a * query will cause a NPE:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"query_shard_exception\",\r\n        \"reason\": \"failed to create query: {\\n  \\\"bool\\\" : {\\n    \\\"must\\\" : [\\n      {\\n        \\\"query_string\\\" : {\\n          \\\"query\\\" : \\\"*\\\",\\n          \\\"fields\\\" : [ ],\\n          \\\"use_dis_max\\\" : true,\\n          \\\"tie_breaker\\\" : 0.0,\\n          \\\"default_operator\\\" : \\\"or\\\",\\n          \\\"auto_generate_phrase_queries\\\" : false,\\n          \\\"max_determinized_states\\\" : 10000,\\n          \\\"enable_position_increments\\\" : true,\\n          \\\"fuzziness\\\" : \\\"AUTO\\\",\\n          \\\"fuzzy_prefix_length\\\" : 0,\\n          \\\"fuzzy_max_expansions\\\" : 50,\\n          \\\"phrase_slop\\\" : 0,\\n          \\\"escape\\\" : false,\\n          \\\"split_on_whitespace\\\" : true,\\n          \\\"boost\\\" : 1.0\\n        }\\n      }\\n    ],\\n    \\\"disable_coord\\\" : false,\\n    \\\"adjust_pure_negative\\\" : true,\\n    \\\"boost\\\" : 1.0\\n  }\\n}\",\r\n        \"index_uuid\": \"SRYVdIE4R5mF0kHJgHBZVw\",\r\n        \"index\": \"logstash-test\"\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"logstash-test\",\r\n        \"node\": \"68R5f1xiTwyxWmchtjr1Ww\",\r\n        \"reason\": {\r\n          \"type\": \"query_shard_exception\",\r\n          \"reason\": \"failed to create query: {\\n  \\\"bool\\\" : {\\n    \\\"must\\\" : [\\n      {\\n        \\\"query_string\\\" : {\\n          \\\"query\\\" : \\\"*\\\",\\n          \\\"fields\\\" : [ ],\\n          \\\"use_dis_max\\\" : true,\\n          \\\"tie_breaker\\\" : 0.0,\\n          \\\"default_operator\\\" : \\\"or\\\",\\n          \\\"auto_generate_phrase_queries\\\" : false,\\n          \\\"max_determinized_states\\\" : 10000,\\n          \\\"enable_position_increments\\\" : true,\\n          \\\"fuzziness\\\" : \\\"AUTO\\\",\\n          \\\"fuzzy_prefix_length\\\" : 0,\\n          \\\"fuzzy_max_expansions\\\" : 50,\\n          \\\"phrase_slop\\\" : 0,\\n          \\\"escape\\\" : false,\\n          \\\"split_on_whitespace\\\" : true,\\n          \\\"boost\\\" : 1.0\\n        }\\n      }\\n    ],\\n    \\\"disable_coord\\\" : false,\\n    \\\"adjust_pure_negative\\\" : true,\\n    \\\"boost\\\" : 1.0\\n  }\\n}\",\r\n          \"index_uuid\": \"SRYVdIE4R5mF0kHJgHBZVw\",\r\n          \"index\": \"logstash-test\",\r\n          \"caused_by\": {\r\n            \"type\": \"null_pointer_exception\",\r\n            \"reason\": null\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nSee repro and log snippet [here](https://gist.github.com/ppf2/d58a318ee58a06f7e2b58473758fb25c).\r\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}