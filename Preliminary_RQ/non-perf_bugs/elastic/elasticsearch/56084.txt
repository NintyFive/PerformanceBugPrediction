{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/56084","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56084/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56084/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56084/events","html_url":"https://github.com/elastic/elasticsearch/issues/56084","id":611350638,"node_id":"MDU6SXNzdWU2MTEzNTA2Mzg=","number":56084,"title":"SQL: JDBC error when setting date related query params","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"labels":[{"id":912794284,"node_id":"MDU6TGFiZWw5MTI3OTQyODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/SQL","name":":Query Languages/SQL","color":"0e8a16","default":false,"description":"SQL querying"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967501040,"node_id":"MDU6TGFiZWwxOTY3NTAxMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:QL","name":"Team:QL","color":"fef2c0","default":false,"description":"Meta label for query languages team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-05-03T07:11:39Z","updated_at":"2020-05-12T11:25:21Z","closed_at":"2020-05-12T09:46:38Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"```\r\n@Test\r\npublic void testEsJdbcPreparedStatetement() {\r\n    try (Connection connection = DriverManager.getConnection(\"jdbc:es://localhost:9200/\", \"elastic\", \"elastic\")) {\r\n\r\n        try(PreparedStatement preparedStatement = connection.prepareStatement(\"SELECT emp_no FROM test_emp WHERE birth_date = ?\")) {\r\n\r\n            java.sql.Date ts = new java.sql.Date(1510348539123L);\r\n            preparedStatement.setObject(1, ts);\r\n            try (ResultSet resultSet = preparedStatement.executeQuery()) {\r\n                while (resultSet.next()) {\r\n                    System.out.println(resultSet.getInt(1));\r\n                }\r\n            }\r\n        }\r\n    } catch (SQLException e) {\r\n        e.printStackTrace();\r\n    }\r\n}\r\n```\r\n\r\nresults in:\r\n```\r\njava.lang.IllegalArgumentException: cannot write time value xcontent for unknown value of type class java.util.Date\r\n\r\n\tat org.elasticsearch.common.xcontent.XContentBuilder.timeValue(XContentBuilder.java:751)\r\n\tat org.elasticsearch.common.xcontent.XContentBuilder.unknownValue(XContentBuilder.java:815)\r\n\tat org.elasticsearch.common.xcontent.XContentBuilder.value(XContentBuilder.java:804)\r\n\tat org.elasticsearch.common.xcontent.XContentBuilder.field(XContentBuilder.java:789)\r\n\tat org.elasticsearch.xpack.sql.proto.SqlTypedParamValue.toXContent(SqlTypedParamValue.java:50)\r\n\tat org.elasticsearch.xpack.sql.proto.SqlQueryRequest.toXContent(SqlQueryRequest.java:186)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.toXContent(HttpClient.java:148)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.post(HttpClient.java:101)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.query(HttpClient.java:81)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcHttpClient.query(JdbcHttpClient.java:69)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcStatement.initResultSet(JdbcStatement.java:160)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcPreparedStatement.executeQuery(JdbcPreparedStatement.java:60)\r\n\tat PostgresJdbcTest.testEsJdbcPreparedStatetement(PostgresJdbcTest.java:58)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:564)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\r\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\r\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\r\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\r\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\r\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\r\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\r\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\r\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\r\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\r\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)\r\n\tat com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)\r\n\tat com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230)\r\n\tat com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)\r\n\tSuppressed: java.lang.IllegalStateException: Failed to close the XContentBuilder\r\n\t\tat org.elasticsearch.common.xcontent.XContentBuilder.close(XContentBuilder.java:1011)\r\n\t\tat org.elasticsearch.xpack.sql.client.HttpClient.toXContent(HttpClient.java:144)\r\n\t\t... 28 more\r\n\tCaused by: java.io.IOException: Unclosed object or array found\r\n\t\tat org.elasticsearch.common.xcontent.json.JsonXContentGenerator.close(JsonXContentGenerator.java:469)\r\n\t\tat org.elasticsearch.common.xcontent.XContentBuilder.close(XContentBuilder.java:1009)\r\n\t\t... 29 more\r\n```","closed_by":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"performed_via_github_app":null}