{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8931","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8931/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8931/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8931/events","html_url":"https://github.com/elastic/elasticsearch/issues/8931","id":51824625,"node_id":"MDU6SXNzdWU1MTgyNDYyNQ==","number":8931,"title":"Phrase Suggester doesn't work on multi-field","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2014-12-12T16:29:09Z","updated_at":"2014-12-15T17:23:53Z","closed_at":"2014-12-15T13:59:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Consider the following:\n\n```\nDELETE /_template/template1\nDELETE /suggestions-v1\n\nPOST /suggestions-v1/foo\n{\n    \"term\": \"television\"\n}\n\nPOST /suggestions-v1/foo\n{\n    \"term\": \"telescope\"\n}\n\nPOST /suggestions-v1/foo\n{\n    \"term\": \"eurovision\"\n}\n\nPOST /suggestions-v1/foo\n{\n    \"term\": \"paper\"\n}\n\nPOST /suggestions-v1/foo\n{\n    \"term\": \"troll\"\n}\n\nPOST /suggestions-v1/foo\n{\n    \"term\": \"paper\"\n}\n\nPOST /suggestions-v1/foo\n{\n    \"term\": \"test\"\n}\n\nPOST /suggestions-v1/_suggest\n{\n   \"text\" : \"telvision\",\n   \"corrections\" : {\n     \"phrase\" : {\n       \"field\" : \"term\",\n       \"size\" : 5,\n       \"real_word_error_likelihood\" : 0.95,\n       \"max_errors\" : 0.5,\n       \"gram_size\" : 2,\n       \"direct_generator\" : [ {\n         \"field\" : \"term\",\n         \"suggest_mode\" : \"always\",\n         \"min_word_length\" : 1\n       } ],\n       \"highlight\": {\n         \"pre_tag\": \"<em>\",\n         \"post_tag\": \"</em>\"\n       }\n     }\n   }\n}\n```\n\nThis works nicely, returning \"television\" as a suggestion option. However, if you'll put the following template before re-playing this scenario, the multi-field mapping will prevent the Phrase Suggester query from returning results:\n\n```\nPUT /_template/template1\n{\n   \"template\": \"suggestions-*\",\n   \"settings\": {\n       \"index\": {\n           \"number_of_replicas\": \"0\",\n           \"number_of_shards\": \"1\",\n           \"analysis\": {\n             \"tokenizer\":{\n               \"bigram_tokenizer\": { \n                 \"type\"       : \"ngram\",\n                 \"min_gram\"   : 2, \n                 \"max_gram\"   : 2,\n                 \"token_chars\": [ \"letter\", \"digit\" ] \n               } \n             },\n             \"analyzer\": {\n               \"lower_keyword\": {\n                 \"type\": \"custom\",\n                 \"tokenizer\": \"keyword\",\n                 \"filter\": [\"asciifolding\", \"lowercase\"]\n               },\n               \"bigram\" : {\n                 \"type\"        : \"custom\",\n                 \"tokenizer\"   : \"bigram_tokenizer\",\n                 \"filter\"      : [\"asciifolding\", \"lowercase\"]\n               } \n             }\n           }\n       }\n     },\n     \"mappings\": {\n        \"foo\": {\n           \"_all\" : {\"enabled\" : false},\n           \"properties\": {\n              \"term\": {\n               \"type\": \"multi_field\",\n               \"analyzer\": \"simple\",\n               \"fields\": {\n                   \"term_bigram\": {\"type\": \"string\", \"index\": \"analyzed\",\"analyzer\":\"bigram\"}\n               }\n              }\n           }\n        }\n     }\n}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}