{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27477","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27477/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27477/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27477/events","html_url":"https://github.com/elastic/elasticsearch/issues/27477","id":275716617,"node_id":"MDU6SXNzdWUyNzU3MTY2MTc=","number":27477,"title":"Searching with java.util.Date","user":{"login":"ojusti","id":5447030,"node_id":"MDQ6VXNlcjU0NDcwMzA=","avatar_url":"https://avatars0.githubusercontent.com/u/5447030?v=4","gravatar_id":"","url":"https://api.github.com/users/ojusti","html_url":"https://github.com/ojusti","followers_url":"https://api.github.com/users/ojusti/followers","following_url":"https://api.github.com/users/ojusti/following{/other_user}","gists_url":"https://api.github.com/users/ojusti/gists{/gist_id}","starred_url":"https://api.github.com/users/ojusti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ojusti/subscriptions","organizations_url":"https://api.github.com/users/ojusti/orgs","repos_url":"https://api.github.com/users/ojusti/repos","events_url":"https://api.github.com/users/ojusti/events{/privacy}","received_events_url":"https://api.github.com/users/ojusti/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-11-21T13:44:30Z","updated_at":"2018-02-14T13:28:24Z","closed_at":"2017-11-21T14:41:11Z","author_association":"NONE","active_lock_reason":null,"body":"1. With the default mapping, Elasticsearch accepts java.util.Date as field values but not as query filters.\r\nWhile indexing ES systematically transforms java.util.Date to long and back to some joda's date. While searching, ES calls Date.toString and then tries to use the field format and obviously fails.\r\n\r\n2. Even if the field's format is modified to java.util.Date.toString's format \"EEE MMM dd HH:mm:ss zzz yyyy\" (with uppercase Z because of joda), some queries may still fail because toString method cuts away the millisecond part ( try someDate < someDate+1ms)\r\n\r\nTo reproduce 1/ execute the attached junit test with 6.0.0 or 5.6.4. The issue does not exist on older versions (2.x).\r\n[DateSearchTest.java.txt](https://github.com/elastic/elasticsearch/files/1491454/DateSearchTest.java.txt)\r\n\r\n<dependency>\r\n <groupId>org.elasticsearch</groupId>\r\n <artifactId>elasticsearch</artifactId>\r\n <version>6.0.0</version>\r\n</dependency>\r\n<dependency>\r\n <groupId>org.elasticsearch.plugin</groupId>\r\n <artifactId>transport-netty4-client</artifactId>\r\n <version>6.0.0</version>\r\n</dependency>\r\n\r\njava version \"1.8.0_74\"\r\nwindows 10\r\n\r\nObtained error:\r\n[stacktrace.txt](https://github.com/elastic/elasticsearch/files/1491458/stacktrace.txt)\r\n","closed_by":{"login":"ojusti","id":5447030,"node_id":"MDQ6VXNlcjU0NDcwMzA=","avatar_url":"https://avatars0.githubusercontent.com/u/5447030?v=4","gravatar_id":"","url":"https://api.github.com/users/ojusti","html_url":"https://github.com/ojusti","followers_url":"https://api.github.com/users/ojusti/followers","following_url":"https://api.github.com/users/ojusti/following{/other_user}","gists_url":"https://api.github.com/users/ojusti/gists{/gist_id}","starred_url":"https://api.github.com/users/ojusti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ojusti/subscriptions","organizations_url":"https://api.github.com/users/ojusti/orgs","repos_url":"https://api.github.com/users/ojusti/repos","events_url":"https://api.github.com/users/ojusti/events{/privacy}","received_events_url":"https://api.github.com/users/ojusti/received_events","type":"User","site_admin":false},"performed_via_github_app":null}