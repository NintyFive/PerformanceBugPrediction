{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20618","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20618/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20618/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20618/events","html_url":"https://github.com/elastic/elasticsearch/issues/20618","id":178414018,"node_id":"MDU6SXNzdWUxNzg0MTQwMTg=","number":20618,"title":"action.auto_create_index: true and index.mapper.dynamic: false does not allow automatic index creation","user":{"login":"oldenbur","id":4369022,"node_id":"MDQ6VXNlcjQzNjkwMjI=","avatar_url":"https://avatars0.githubusercontent.com/u/4369022?v=4","gravatar_id":"","url":"https://api.github.com/users/oldenbur","html_url":"https://github.com/oldenbur","followers_url":"https://api.github.com/users/oldenbur/followers","following_url":"https://api.github.com/users/oldenbur/following{/other_user}","gists_url":"https://api.github.com/users/oldenbur/gists{/gist_id}","starred_url":"https://api.github.com/users/oldenbur/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oldenbur/subscriptions","organizations_url":"https://api.github.com/users/oldenbur/orgs","repos_url":"https://api.github.com/users/oldenbur/repos","events_url":"https://api.github.com/users/oldenbur/events{/privacy}","received_events_url":"https://api.github.com/users/oldenbur/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2016-09-21T17:36:46Z","updated_at":"2016-09-23T12:33:33Z","closed_at":"2016-09-23T12:33:33Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3.4\n\n**Plugins installed**: []\n\n**JVM version**: \nopenjdk version \"1.8.0_77\"\nOpenJDK Runtime Environment (build 1.8.0_77-b03)\nOpenJDK 64-Bit Server VM (build 25.77-b03, mixed mode)\n\n**OS version**:\nCentOS Linux release 7.2.1511 (Core) \n\n**Description of the problem including expected versus actual behavior**:\nWhen `action.auto_create_index: true` and `index.mapper.dynamic: false`, new indices are not auto-created when a document is inserted, even in the presence of a template for that index. Only once the index is explicitly created, can a document be inserted into the index.\n\n**Steps to reproduce**:\n1. In the elasticsearch config (elasticsearch.yml) set action.auto_create_index: true and index.mapper.dynamic: false\n2. Add a valid template for an index/type/document that does not yet exist\n3. Attempt to insert a document into the new index and an error like appears:\n   `\n   {\n     \"index\": {\n       \"_id\": \"e2249700-8008-11e6-85f6-74867aea71fe\",\n       \"_index\": \"logs-2016-09-20\",\n       \"_type\": \"logs\",\n       \"error\": {\n         \"index\": \"logs-2016-09-20\",\n         \"reason\": \"no such index\",\n         \"resource.id\": \"logs-2016-09-20\",\n         \"resource.type\": \"index_expression\",\n         \"type\": \"index_not_found_exception\"\n       },\n       \"status\": 404\n     }\n   }\n   `\n\n**Provide logs (if relevant)**:\n\n```\n[2016-09-21 16:52:10,662][WARN ][action.index             ] [lrdx0000] unexpected error during the primary phase for action [indices:data/write/index], request [index {[logs-2016-09-20][logs][00002189-7a23-4518\n-86ab-290ba886033a], source[{\n  \"priority\": 0,\n  \"rootEntityId\": 8,\n  \"vendorMessageId\": \"4634\"\n}\n]}]\n[logs-2016-09-20] IndexNotFoundException[no such index]\n        at org.elasticsearch.cluster.metadata.IndexNameExpressionResolver.concreteIndices(IndexNameExpressionResolver.java:151)\n        at org.elasticsearch.cluster.metadata.IndexNameExpressionResolver.concreteIndices(IndexNameExpressionResolver.java:95)\n        at org.elasticsearch.cluster.metadata.IndexNameExpressionResolver.concreteSingleIndex(IndexNameExpressionResolver.java:208)\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase.doRun(TransportReplicationAction.java:451)\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n        at org.elasticsearch.action.support.replication.TransportReplicationAction.doExecute(TransportReplicationAction.java:131)\n        at org.elasticsearch.action.index.TransportIndexAction.innerExecute(TransportIndexAction.java:135)\n        at org.elasticsearch.action.index.TransportIndexAction.doExecute(TransportIndexAction.java:119)\n        at org.elasticsearch.action.index.TransportIndexAction.doExecute(TransportIndexAction.java:66)\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:137)\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:85)\n        at org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:58)\n        at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:359)\n        at org.elasticsearch.client.FilterClient.doExecute(FilterClient.java:52)\n        at org.elasticsearch.rest.BaseRestHandler$HeadersAndContextCopyClient.doExecute(BaseRestHandler.java:83)\n        at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:359)\n        at org.elasticsearch.client.support.AbstractClient.index(AbstractClient.java:371)\n        at org.elasticsearch.rest.action.index.RestIndexAction.handleRequest(RestIndexAction.java:102)\n        at org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:54)\n        at org.elasticsearch.rest.RestController.executeHandler(RestController.java:205)\n        at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:166)\n        at org.elasticsearch.http.HttpServer.internalDispatchRequest(HttpServer.java:128)\n        at org.elasticsearch.http.HttpServer$Dispatcher.dispatchRequest(HttpServer.java:86)\n        at org.elasticsearch.http.netty.NettyHttpServerTransport.dispatchRequest(NettyHttpServerTransport.java:449)\n        at org.elasticsearch.http.netty.HttpRequestHandler.messageReceived(HttpRequestHandler.java:61)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.http.netty.pipelining.HttpPipeliningHandler.messageReceived(HttpPipeliningHandler.java:60)\n        at org.jboss.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.jboss.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.jboss.netty.handler.codec.http.HttpContentDecoder.messageReceived(HttpContentDecoder.java:108)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n        at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459)\n        at org.jboss.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536)\n        at org.jboss.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:75)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n        at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n        at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337)\n        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n        at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n        at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}