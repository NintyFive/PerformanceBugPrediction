{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23537","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23537/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23537/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23537/events","html_url":"https://github.com/elastic/elasticsearch/issues/23537","id":213397501,"node_id":"MDU6SXNzdWUyMTMzOTc1MDE=","number":23537,"title":"search_after -> Failed to parse search_after value for field [__anonymous_date].","user":{"login":"GuillaumeCisco","id":1155244,"node_id":"MDQ6VXNlcjExNTUyNDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1155244?v=4","gravatar_id":"","url":"https://api.github.com/users/GuillaumeCisco","html_url":"https://github.com/GuillaumeCisco","followers_url":"https://api.github.com/users/GuillaumeCisco/followers","following_url":"https://api.github.com/users/GuillaumeCisco/following{/other_user}","gists_url":"https://api.github.com/users/GuillaumeCisco/gists{/gist_id}","starred_url":"https://api.github.com/users/GuillaumeCisco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GuillaumeCisco/subscriptions","organizations_url":"https://api.github.com/users/GuillaumeCisco/orgs","repos_url":"https://api.github.com/users/GuillaumeCisco/repos","events_url":"https://api.github.com/users/GuillaumeCisco/events{/privacy}","received_events_url":"https://api.github.com/users/GuillaumeCisco/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-03-10T17:06:08Z","updated_at":"2017-03-13T17:19:36Z","closed_at":"2017-03-13T17:19:36Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.2.2\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**:\r\n\r\n**OS version**: Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI was trying the `search_after` option for paginate large **sorted** dataset (>10000) but came across an error I can't explain.\r\n\r\nI've got logs object in my elasticsearch storage with fiedls like `@timestamp`, `abs_timestamp`, `device : {id}`, `category`, `message` and more.\r\n\r\nContext : page_size  = 500\r\nI first make a query like that (page 1 example):\r\n```\r\n{'from': 0,\r\n 'query': {'bool': {'filter': [{'term': {'tag': u'headband.logs'}}],\r\n                    'must': [{'match': {u'device.id': UUID('ce510315-25ec-4455-8b90-7b7761e0ce15')}},\r\n                             {'range': {u'abs_timestamp': {u'format': u\"yyyy-MM-dd'T'HH:mm:ssZ\",\r\n                                                           u'gte': '2017-03-09T08:59:55+0000',\r\n                                                           u'lte': '2017-03-10T08:59:55+0000'}}}]}},\r\n 'size': 500,\r\n 'sort': [{u'_uid': {u'order': u'desc'},\r\n           u'abs_timestamp': {u'order': u'asc', u'unmapped_type': u'date'}}]}\r\n```\r\nI get my objects correctly.\r\nDue to restriction with from/size, a query with a top + page_size > 10 000 will fail : \r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-from-size.html\r\n\r\nSo I decided to use the new `search_after` option like that:\r\n\r\n```\r\n{'from': -1,\r\n 'query': {'bool': {'filter': [{'term': {'tag': u'headband.logs'}}],\r\n                    'must': [{'match': {u'device.id': UUID('ce510315-25ec-4455-8b90-7b7761e0ce15')}},\r\n                             {'range': {u'abs_timestamp': {u'format': u\"yyyy-MM-dd'T'HH:mm:ssZ\",\r\n                                                           u'gte': '2017-03-09T08:59:55+0000',\r\n                                                           u'lte': '2017-03-10T08:59:55+0000'}}}]}},\r\n u'search_after': [u'2017-03-09T14:34:16.026000Z', u'AVqzvRDe_-VptwkQaduX'],\r\n 'size': 500,\r\n 'sort': [{u'_uid': {u'order': u'desc'},\r\n           u'abs_timestamp': {u'order': u'asc', u'unmapped_type': u'date'}}]}\r\n```\r\nI get the `search_after` values from my precedent query (last object returned)\r\nWhen I execute this query I get an error:\r\n`RequestError: TransportError(400, u'search_phase_execution_exception', u'Failed to parse search_after value for field [__anonymous_date].')`\r\n\r\nI've looked into the code here https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/search/searchafter/SearchAfterBuilder.java and can't find a way to correct my query.\r\n\r\nI don't know if it's a bug or if I didn't write my query correctly.\r\n\r\nThank you\r\n","closed_by":{"login":"GuillaumeCisco","id":1155244,"node_id":"MDQ6VXNlcjExNTUyNDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1155244?v=4","gravatar_id":"","url":"https://api.github.com/users/GuillaumeCisco","html_url":"https://github.com/GuillaumeCisco","followers_url":"https://api.github.com/users/GuillaumeCisco/followers","following_url":"https://api.github.com/users/GuillaumeCisco/following{/other_user}","gists_url":"https://api.github.com/users/GuillaumeCisco/gists{/gist_id}","starred_url":"https://api.github.com/users/GuillaumeCisco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GuillaumeCisco/subscriptions","organizations_url":"https://api.github.com/users/GuillaumeCisco/orgs","repos_url":"https://api.github.com/users/GuillaumeCisco/repos","events_url":"https://api.github.com/users/GuillaumeCisco/events{/privacy}","received_events_url":"https://api.github.com/users/GuillaumeCisco/received_events","type":"User","site_admin":false},"performed_via_github_app":null}