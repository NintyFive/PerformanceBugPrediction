{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3444","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3444/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3444/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3444/events","html_url":"https://github.com/elastic/elasticsearch/issues/3444","id":17647328,"node_id":"MDU6SXNzdWUxNzY0NzMyOA==","number":3444,"title":"Using parent property in update API with doc_as_upsert=true does not work","user":{"login":"poorvamandar","id":3928115,"node_id":"MDQ6VXNlcjM5MjgxMTU=","avatar_url":"https://avatars2.githubusercontent.com/u/3928115?v=4","gravatar_id":"","url":"https://api.github.com/users/poorvamandar","html_url":"https://github.com/poorvamandar","followers_url":"https://api.github.com/users/poorvamandar/followers","following_url":"https://api.github.com/users/poorvamandar/following{/other_user}","gists_url":"https://api.github.com/users/poorvamandar/gists{/gist_id}","starred_url":"https://api.github.com/users/poorvamandar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/poorvamandar/subscriptions","organizations_url":"https://api.github.com/users/poorvamandar/orgs","repos_url":"https://api.github.com/users/poorvamandar/repos","events_url":"https://api.github.com/users/poorvamandar/events{/privacy}","received_events_url":"https://api.github.com/users/poorvamandar/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":45109570,"node_id":"MDU6TGFiZWw0NTEwOTU3MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.3","name":"v0.90.3","color":"DDDDDD","default":false,"description":null},{"id":37906111,"node_id":"MDU6TGFiZWwzNzkwNjExMQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.Beta1","name":"v1.0.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"assignees":[{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2013-08-05T17:36:06Z","updated_at":"2013-12-23T21:24:23Z","closed_at":"2013-08-06T10:25:38Z","author_association":"NONE","active_lock_reason":null,"body":"If I try to add a document using the bulk update API (doc_as_upsert=true) and set its parent property, I do not see the document as the child of the specified parent when I make a has_parent query. Can you please help see what could be wrong with the below. Thanks in advance.\n\nFollowing is the mapping:\n\nmappings: {\n    store: {\n        properties: {\n            name: {\n                type: string\n            }\n            owner: {\n                type: string\n            }\n        }\n    }\n    department: {\n        _routing: {\n            required: true\n        }\n        properties: {\n            name: {\n                type: string\n            }\n            numberOfProducts: {\n                type: long\n            }\n        }\n       _parent: {\n            type: store\n        }\n    }\n}\n\nFollowing is the bulk input file:\n\n{ \"index\" : { \"_index\" : \"parent_child\", \"_type\" : \"store\", \"_id\" : \"store1\" } }\n{ \"name\" : \"auchan\", \"owner\" : \"chris\" }\n{ \"index\" : { \"_index\" : \"parent_child\", \"_type\" : \"department\", \"_id\" : \"department1\", \"parent\" : \"store1\" } }\n{ \"name\" : \"toys\", \"numberOfProducts\" : 150  }\n{ \"update\" : { \"_index\" : \"parent_child\", \"_type\" : \"department\", \"_id\" : \"department2\", \"parent\" : \"store1\" } }\n{\"doc\" : { \"name\" : \"dolls\", \"numberOfProducts\" : 300  }, \"doc_as_upsert\" : \"true\"}\n\nQuery - \n\n{\n  \"query\": {\n    \"has_parent\": {\n      \"type\": \"store\",\n      \"query\": {\n        \"match_all\": {}\n      }\n    }\n  }\n}\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}