{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30968","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30968/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30968/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30968/events","html_url":"https://github.com/elastic/elasticsearch/issues/30968","id":327780788,"node_id":"MDU6SXNzdWUzMjc3ODA3ODg=","number":30968,"title":"Add flag to ignore synonym token filter exceptions due to analyzer processing","user":{"login":"jtreher","id":1258179,"node_id":"MDQ6VXNlcjEyNTgxNzk=","avatar_url":"https://avatars1.githubusercontent.com/u/1258179?v=4","gravatar_id":"","url":"https://api.github.com/users/jtreher","html_url":"https://github.com/jtreher","followers_url":"https://api.github.com/users/jtreher/followers","following_url":"https://api.github.com/users/jtreher/following{/other_user}","gists_url":"https://api.github.com/users/jtreher/gists{/gist_id}","starred_url":"https://api.github.com/users/jtreher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtreher/subscriptions","organizations_url":"https://api.github.com/users/jtreher/orgs","repos_url":"https://api.github.com/users/jtreher/repos","events_url":"https://api.github.com/users/jtreher/events{/privacy}","received_events_url":"https://api.github.com/users/jtreher/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-05-30T15:22:10Z","updated_at":"2018-07-13T21:58:43Z","closed_at":"2018-07-13T21:58:43Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\nElasticSearch 6.0 introduced a breaking change in the way the synonym token filter behaves in custom analyzers. The tokenizer of the analyzer and the tokenfilters preceding the synonym token filter in the analyzer will be applied to each synonym. If a synonym is removed as a result of applying them, it will throw, causing index creation to fail. \r\n\r\nI propose that a flag be added to index settings on the synonym token filter settings to simply ignore the error that is thrown or do some other check to prevent throwing. This will allow those of us with complex synonym strategies to be flexible with our usage of synonyms with the full understanding that some synonyms will be ignored in some analyzers.\r\n\r\nThe main use case here is that we have a thousands of synonyms managed by a content team. We emit a single synonyms config file for configuration that is used in many custom analyzers for many variations on text fields. This strategy has worked very well for us. Coupling the validity of a synonym to a specific analyzer requires a specific synonym configuration per analyzer in addition to a non-technical team  having a full understanding of elasticsearch analyzers, both of which are obtrusive. \r\n\r\nExample:\r\n\r\nTake the synonym `&,and`\r\n\r\nThe ampersand will be eliminated by the standard tokenizer used in custom analyzer `A` which will throw causing the index creation to throw. However, that's a synonym that is useful in a different custom analyzer, `B`, that uses the whitespace tokenizer where the `&` is preserved.\r\n\r\nReference:\r\n\r\nhttps://discuss.elastic.co/t/why-the-synonym-filter-change-in-6-0/133740\r\n\r\nhttps://github.com/elastic/elasticsearch/issues/27481\r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/breaking_60_analysis_changes.html","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}