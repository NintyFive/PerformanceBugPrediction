{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20633","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20633/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20633/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20633/events","html_url":"https://github.com/elastic/elasticsearch/issues/20633","id":178605684,"node_id":"MDU6SXNzdWUxNzg2MDU2ODQ=","number":20633,"title":"Azure repository creation Issue in Elasticsearch 2.4.0","user":{"login":"GaneshbabuRamamoorthy","id":20658619,"node_id":"MDQ6VXNlcjIwNjU4NjE5","avatar_url":"https://avatars0.githubusercontent.com/u/20658619?v=4","gravatar_id":"","url":"https://api.github.com/users/GaneshbabuRamamoorthy","html_url":"https://github.com/GaneshbabuRamamoorthy","followers_url":"https://api.github.com/users/GaneshbabuRamamoorthy/followers","following_url":"https://api.github.com/users/GaneshbabuRamamoorthy/following{/other_user}","gists_url":"https://api.github.com/users/GaneshbabuRamamoorthy/gists{/gist_id}","starred_url":"https://api.github.com/users/GaneshbabuRamamoorthy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GaneshbabuRamamoorthy/subscriptions","organizations_url":"https://api.github.com/users/GaneshbabuRamamoorthy/orgs","repos_url":"https://api.github.com/users/GaneshbabuRamamoorthy/repos","events_url":"https://api.github.com/users/GaneshbabuRamamoorthy/events{/privacy}","received_events_url":"https://api.github.com/users/GaneshbabuRamamoorthy/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2016-09-22T13:10:22Z","updated_at":"2018-08-27T11:05:52Z","closed_at":"2016-10-06T14:01:16Z","author_association":"NONE","active_lock_reason":null,"body":"Hi All,\n\nI want to take snapshot and restore using azure repository in Linux, I have configured these below setting in yml,\n\n```\n##################### Azure cloud plugin for repository ######################\n\ncloud:\n  azure:\n    storage:\n      account: \"https://XXX.blob.core.windows.net/\"\n      key: \"...\"\n```\n\nwith the above setting, service is started, but i am m getting below error when creating repository in Elasticsearch 2.4.0,\n\n```\nPUT snapshot/mybackup\n{\n\"type\": \"azure\"\n}\n```\n\nError msg:-\n\n``` json\n{\n   \"error\": {\n      \"root_cause\": [\n         {\n            \"type\": \"repository_exception\",\n            \"reason\": \"[elasticsearch-snapshots] Can not find an azure client for account [null]\"\n         }\n      ],\n      \"type\": \"repository_exception\",\n      \"reason\": \"[elasticsearch-snapshots] Can not find an azure client for account [null]\"\n   },\n   \"status\": 500\n}\n```\n\nWhen I looked into the ES logs I could see cloud storage account not getting created at the start of elasticsearch\n\n```\n2016-09-22 07:30:23,221][INFO ][http                     ] [mue2rhegrdd002_RD_NDX_MASTER] publish_address {10.247.0.4:9200}, bound_addresses {10.247.0.4:9200}\n[2016-09-22 07:30:23,221][INFO ][node                     ] [mue2rhegrdd002_RD_NDX_MASTER] started\n[2016-09-22 07:30:23,258][INFO ][cluster.service          ] [mue2rhegrdd002_RD_NDX_MASTER] new_master {mue2rhegrdd002_RD_NDX_MASTER}{-mRr-uLKQkyEJwfqLLI_2Q}{10.247.0.4}{10.247.0.4:9300}{data=false, max_local_storage_nodes=1, master=true}, added {{mue2rhegrdd001_RD_NDX_DATA}{O-JSVOlMQXCuwb5nf5XheQ}{10.247.0.5}{10.247.0.5:9260}{max_local_storage_nodes=1, master=false},{mue2rhegrdd001_RD_NDX_MASTER}{DMAPO7O6QEuXmcsP6aGuAQ}{10.247.0.5}{10.247.0.5:9300}{data=false, max_local_storage_nodes=1, master=true},}, reason: zen-disco-join(elected_as_master, [1] joins received)\n**[2016-09-22 07:30:24,576][ERROR][cloud.azure.storage      ] [mue2rhegrdd002_RD_NDX_MASTER] can not create azure storage client: Primary and secondary location URIs in a StorageUri must point to the same resource.**\n[2016-09-22 07:30:24,589][INFO ][watcher                  ] [mue2rhegrdd002_RD_NDX_MASTER] starting watch service...\n[2016-09-22 07:30:24,590][INFO ][watcher                  ] [mue2rhegrdd002_RD_NDX_MASTER] watch service has started\n[2016-09-22 07:30:24,631][INFO ][license.plugin.core      ] [mue2rhegrdd002_RD_NDX_MASTER] license [cf8a2152-4f41-4739-8459-4137cac8105b] - valid\n[2016-09-22 07:30:25,489][INFO ][gateway                  ] [mue2rhegrdd002_RD_NDX_MASTER] recovered [20] indices into cluster_state\n[2016-09-22 07:30:26,021][INFO ][http                     ] [mue2rhegrdd002_RD_NDX_DATA] publish_address {10.247.0.4:9240}, bound_addresses {10.247.0.4:9240}\n[2016-09-22 07:30:26,021][INFO ][node                     ] [mue2rhegrdd002_RD_NDX_DATA] started\n[2016-09-22 07:30:26,622][INFO ][cluster.service          ] [mue2rhegrdd002_RD_NDX_MASTER] added {{mue2rhegrdd002_RD_NDX_DATA}{eE1n1iLMQom6VEgYfBwJ9g}{10.247.0.4}{10.247.0.4:9260}{max_local_storage_nodes=1, master=false},}, reason: zen-disco-join(join from node[{mue2rhegrdd002_RD_NDX_DATA}{eE1n1iLMQom6VEgYfBwJ9g}{10.247.0.4}{10.247.0.4:9260}{max_local_storage_nodes=1, master=false}])\n[2016-09-22 07:30:26,678][INFO ][cluster.service          ] [mue2rhegrdd002_RD_NDX_DATA] detected_master {mue2rhegrdd002_RD_NDX_MASTER}{-mRr-uLKQkyEJwfqLLI_2Q}{10.247.0.4}{10.247.0.4:9300}{data=false, max_local_storage_nodes=1, master=true}, added {{mue2rhegrdd001_RD_NDX_DATA}{O-JSVOlMQXCuwb5nf5XheQ}{10.247.0.5}{10.247.0.5:9260}{max_local_storage_nodes=1, master=false},{mue2rhegrdd001_RD_NDX_MASTER}{DMAPO7O6QEuXmcsP6aGuAQ}{10.247.0.5}{10.247.0.5:9300}{data=false, max_local_storage_nodes=1, master=true},{mue2rhegrdd002_RD_NDX_MASTER}{-mRr-uLKQkyEJwfqLLI_2Q}{10.247.0.4}{10.247.0.4:9300}{data=false, max_local_storage_nodes=1, master=true},}, reason: zen-disco-receive(from master [{mue2rhegrdd002_RD_NDX_MASTER}{-mRr-uLKQkyEJwfqLLI_2Q}{10.247.0.4}{10.247.0.4:9300}{data=false, max_local_storage_nodes=1, master=true}])\n**[2016-09-22 07:30:26,711][ERROR][cloud.azure.storage      ] [mue2rhegrdd002_RD_NDX_DATA] can not create azure storage client: Primary and secondary location URIs in a StorageUri must point to the same resource.**\n[2016-09-22 07:30:26,764][INFO ][license.plugin.core      ] [mue2rhegrdd002_RD_NDX_DATA] license [cf8a2152-4f41-4739-8459-4137cac8105b] - valid\n```\n\nPlease let me know your suggestions to resolve this.\n\nThanks,\nGaneshbabu R\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}