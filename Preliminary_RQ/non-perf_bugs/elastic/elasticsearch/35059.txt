{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/35059","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35059/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35059/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35059/events","html_url":"https://github.com/elastic/elasticsearch/issues/35059","id":375172211,"node_id":"MDU6SXNzdWUzNzUxNzIyMTE=","number":35059,"title":"WKT polygon format validated with geo_shape, where coerce set to true","user":{"login":"artemabalmasov","id":4420234,"node_id":"MDQ6VXNlcjQ0MjAyMzQ=","avatar_url":"https://avatars2.githubusercontent.com/u/4420234?v=4","gravatar_id":"","url":"https://api.github.com/users/artemabalmasov","html_url":"https://github.com/artemabalmasov","followers_url":"https://api.github.com/users/artemabalmasov/followers","following_url":"https://api.github.com/users/artemabalmasov/following{/other_user}","gists_url":"https://api.github.com/users/artemabalmasov/gists{/gist_id}","starred_url":"https://api.github.com/users/artemabalmasov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/artemabalmasov/subscriptions","organizations_url":"https://api.github.com/users/artemabalmasov/orgs","repos_url":"https://api.github.com/users/artemabalmasov/repos","events_url":"https://api.github.com/users/artemabalmasov/events{/privacy}","received_events_url":"https://api.github.com/users/artemabalmasov/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2018-10-29T19:09:02Z","updated_at":"2019-06-18T16:33:18Z","closed_at":"2018-11-12T23:37:01Z","author_association":"NONE","active_lock_reason":null,"body":"Good day, trying to integrate twitter location data in WKT format, run into following issue:\r\n\r\n**System**\r\n```\r\nversion: \r\n{\r\n  \"name\": \"3w66Vhm\",\r\n  \"cluster_name\": \"docker-cluster\",\r\n  \"cluster_uuid\": \"9dWrPtnVQfWUinPFppNJmA\",\r\n  \"version\": {\r\n    \"number\": \"6.4.2\",\r\n    \"build_flavor\": \"default\",\r\n    \"build_type\": \"tar\",\r\n    \"build_hash\": \"04711c2\",\r\n    \"build_date\": \"2018-09-26T13:34:09.098244Z\",\r\n    \"build_snapshot\": false,\r\n    \"lucene_version\": \"7.4.0\",\r\n    \"minimum_wire_compatibility_version\": \"5.6.0\",\r\n    \"minimum_index_compatibility_version\": \"5.0.0\"\r\n  },\r\n  \"tagline\": \"You Know, for Search\"\r\n}\r\n```\r\njvm: 1.8\r\nplugins: raw docker img from https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nDifferent validation rules for WKT vs own format \r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Mapping for example with weak requirements (for twitter) from  https://github.com/elastic/elasticsearch/pull/11161\r\n```\r\nPUT /example\r\n{\r\n    \"mappings\": {\r\n        \"doc\": {\r\n            \"properties\": {\r\n                \"location\": {\r\n                    \"type\": \"geo_shape\",\r\n                    \"tree\": \"quadtree\",\r\n                    \"precision\": \"100m\",\r\n                    \"coerce\": true\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n 2. Coordinates with usual type works perfectly\r\n```\r\nPOST /example/doc\r\n{\r\n    \"location\" : {\r\n        \"type\" : \"polygon\",\r\n        \"coordinates\" : [\r\n            [ [114.200488, -8.413208], [114.200488, -8.348076], [114.317869, -8.348076], [114.317869, -8.413208] ]\r\n        ]\r\n    }\r\n}\r\n```\r\n 3. WKT-format procuses error\r\n```\r\nPOST /example/doc\r\n{\r\n    \"location\" : \"Polygon((114.200488 -8.413208, 114.200488 -8.348076, 114.317869 -8.348076, 114.317869 -8.413208))\"\r\n}\r\n```\r\nOutput:\r\n```\r\n{\r\n   \"error\": {\r\n      \"root_cause\": [\r\n         {\r\n            \"type\": \"mapper_parsing_exception\",\r\n            \"reason\": \"failed to parse [location]\"\r\n         }\r\n      ],\r\n      \"type\": \"mapper_parsing_exception\",\r\n      \"reason\": \"failed to parse [location]\",\r\n      \"caused_by\": {\r\n         \"type\": \"illegal_argument_exception\",\r\n         \"reason\": \"invalid LinearRing found (coordinates are not closed)\"\r\n      }\r\n   },\r\n   \"status\": 400\r\n}\r\n```","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}