{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22916","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22916/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22916/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22916/events","html_url":"https://github.com/elastic/elasticsearch/issues/22916","id":204739272,"node_id":"MDU6SXNzdWUyMDQ3MzkyNzI=","number":22916,"title":"ES + Spark: setting es.scroll.limit non-negative sometimes causes NPE","user":{"login":"ndimiduk","id":45484,"node_id":"MDQ6VXNlcjQ1NDg0","avatar_url":"https://avatars0.githubusercontent.com/u/45484?v=4","gravatar_id":"","url":"https://api.github.com/users/ndimiduk","html_url":"https://github.com/ndimiduk","followers_url":"https://api.github.com/users/ndimiduk/followers","following_url":"https://api.github.com/users/ndimiduk/following{/other_user}","gists_url":"https://api.github.com/users/ndimiduk/gists{/gist_id}","starred_url":"https://api.github.com/users/ndimiduk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ndimiduk/subscriptions","organizations_url":"https://api.github.com/users/ndimiduk/orgs","repos_url":"https://api.github.com/users/ndimiduk/repos","events_url":"https://api.github.com/users/ndimiduk/events{/privacy}","received_events_url":"https://api.github.com/users/ndimiduk/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-02-01T23:37:07Z","updated_at":"2017-02-02T00:18:24Z","closed_at":"2017-02-02T00:01:20Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.3 (218bdf10790eef486ff2c41a3df5cfa32dadcfde)\r\n**Elasticsearch Hadoop version**: elasticsearch-spark_2.10 2.3.3\r\n**Spark version**: Apache Spark 1.6.3-bin-hadoop2.6\r\n\r\n**Plugins installed**: [ kopf 2.0.1 ]\r\n\r\n**JVM version**:\r\n```\r\njava version \"1.8.0_72\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_72-b15)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.72-b15, mixed mode)\r\n```\r\n**OS version**: Ubuntu 14.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nSetting a non-negative value for `es.scroll.limit` will sometimes cause an NPE. Spark tasks fail with\r\n\r\n```\r\n2017-02-01 23:02:03,925 ERROR [Executor task launch worker-0] executor.Executor: Exception in task 0.0 in stage 0.0 (TID 0)\r\njava.lang.NullPointerException\r\n        at org.elasticsearch.hadoop.rest.ScrollQuery.hasNext(ScrollQuery.java:87)\r\n        at org.elasticsearch.spark.rdd.AbstractEsRDDIterator.hasNext(AbstractEsRDDIterator.scala:43)\r\n        at scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:327)\r\n        at scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:327)\r\n        at scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:327)\r\n        at scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:327)\r\n        at scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:327)\r\n        at scala.collection.Iterator$class.foreach(Iterator.scala:727)\r\n        at scala.collection.AbstractIterator.foreach(Iterator.scala:1157)\r\n        at scala.collection.TraversableOnce$class.foldLeft(TraversableOnce.scala:144)\r\n        at scala.collection.AbstractIterator.foldLeft(Iterator.scala:1157)\r\n        at scala.collection.TraversableOnce$class.aggregate(TraversableOnce.scala:201)\r\n        at scala.collection.AbstractIterator.aggregate(Iterator.scala:1157)\r\n        at org.apache.spark.rdd.RDD$$anonfun$treeAggregate$1$$anonfun$23.apply(RDD.scala:1135)\r\n        at org.apache.spark.rdd.RDD$$anonfun$treeAggregate$1$$anonfun$23.apply(RDD.scala:1135)\r\n        at org.apache.spark.rdd.RDD$$anonfun$treeAggregate$1$$anonfun$24.apply(RDD.scala:1136)\r\n        at org.apache.spark.rdd.RDD$$anonfun$treeAggregate$1$$anonfun$24.apply(RDD.scala:1136)\r\n        at org.apache.spark.rdd.RDD$$anonfun$mapPartitions$1$$anonfun$apply$20.apply(RDD.scala:710)\r\n        at org.apache.spark.rdd.RDD$$anonfun$mapPartitions$1$$anonfun$apply$20.apply(RDD.scala:710)\r\n        at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)\r\n        at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:306)\r\n        at org.apache.spark.rdd.RDD.iterator(RDD.scala:270)\r\n        at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:66)\r\n        at org.apache.spark.scheduler.Task.run(Task.scala:89)\r\n        at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:227)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n        at java.lang.Thread.run(Thread.java:745)\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}