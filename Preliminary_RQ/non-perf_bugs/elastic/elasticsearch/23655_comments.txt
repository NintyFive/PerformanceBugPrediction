[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/287828529","html_url":"https://github.com/elastic/elasticsearch/issues/23655#issuecomment-287828529","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23655","id":287828529,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NzgyODUyOQ==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2017-03-20T17:08:14Z","updated_at":"2017-03-20T17:08:14Z","author_association":"MEMBER","body":"It would be good to also add that you can change the settings when re-trying the restore to allow it to succeed or by tagging nodes, etc.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356302882","html_url":"https://github.com/elastic/elasticsearch/issues/23655#issuecomment-356302882","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23655","id":356302882,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NjMwMjg4Mg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-01-09T14:42:17Z","updated_at":"2018-01-09T14:42:17Z","author_association":"MEMBER","body":"> On 5.x, it's better because we have a cluster allocate explain api that can be used to get an explanation. However, the above of the restored shards stuck in INIT recovery state can be misleading to users and they may not immediately realize that they have to go run the cluster allocation explain api.\r\n\r\nThis has been improved in #27493: in the situation you described, the shards won't be allocated and will be UNASSIGNED. The next logical step is to use the Cluster Allocation Explain API and it will return something like:\r\n```\r\n\"deciders\" : [\r\n        {\r\n          \"decider\" : \"restore_in_progress\",\r\n          \"decision\" : \"NO\",\r\n          \"explanation\" : \"shard has failed to be restored from the snapshot [repository:snap-0/Vf5oSPe5SEm_OXeap3h93A] because of [restore_source[repository/snap-0]] - manually close or delete the index [books] in order to retry to restore the snapshot again or use the reroute API to force the allocation of an empty primary shard\"\r\n        },\r\n        {\r\n          \"decider\" : \"filter\",\r\n          \"decision\" : \"NO\",\r\n          \"explanation\" : \"node does not match index setting [index.routing.allocation.include] filters [size:\\\"foo\\\"]\"\r\n        }\r\n      ]\r\n```\r\n\r\nwhich I think is enough, what do you think?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376166694","html_url":"https://github.com/elastic/elasticsearch/issues/23655#issuecomment-376166694","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23655","id":376166694,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjE2NjY5NA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T13:32:06Z","updated_at":"2018-03-26T13:32:06Z","author_association":"CONTRIBUTOR","body":"I think that the fix mentioned by @tlrx should improve the situation here, so I'm closing this issue.","performed_via_github_app":null}]