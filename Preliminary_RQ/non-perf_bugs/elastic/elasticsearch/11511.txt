{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11511","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11511/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11511/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11511/events","html_url":"https://github.com/elastic/elasticsearch/issues/11511","id":85501651,"node_id":"MDU6SXNzdWU4NTUwMTY1MQ==","number":11511,"title":"Add safeguards to prevent simple user errors","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null},{"id":777829541,"node_id":"MDU6TGFiZWw3Nzc4Mjk1NDE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.3","name":"v6.0.3","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":24,"created_at":"2015-06-05T10:30:11Z","updated_at":"2019-01-11T14:35:09Z","closed_at":"2018-03-14T09:07:57Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"There are a number of places where a naive user can break Elasticsearch very easily.  We should add more (dynamically overridable) safeguards that prevent users from hurting themselves.\r\n\r\nNote:\r\n- We are adding high limits to start so that we don't suddenly disable things that users already do today, but so that sysadmins have tools that they can use to protect their clusters.  We can revisit the limits later on.\r\n- All these settings should be prefixed by `policy.` to make them easier to document together and to understand their purpose.\r\n\r\nAccepted limits:\r\n- [x] #9311 Hard limit on `from`/`size` \r\n- [x] #12149 Global default value for search timeouts (Could be ridiculously high like an hour and it would still help)\r\n- [x] #17386 Disable fielddata-loading on analyzed text fields by default (Adrien)\r\n- [x] #17396 Limit the max number of shards to 1000 (Adrien)\r\n- [x] #17133 Limit the size of all in-flight requests (Daniel)\r\n- [x] #17357 Limit the number of fields that can be added to a mapping to 1000 \r\n- [x] #17400 Add maximum mapping depth to 20 \r\n- [ ] Add sane limits for thread size and queue size (Jim)\r\n- ~#26423 Don't allow search requests greater than (eg) 10MB (Adrien)~\r\n- [x] #14983 Limit the number of `nested` fields per index to 50 (Yannick) \r\n- [x] #17522 Limit `window_size` in rescore API (@nik9000)\r\n- [x] #17558 Disable script access to `_source` fields by default\r\n- [ ] #18739 Limit the number of shards that can be rerouted at the same time\r\n- [x] #26492 Hard limit on `from`/`size` in top hits and inner hits (much smaller than a normal query) (MVG)\r\n- [x] #19694 Limit script compilation rate to avoid hard coding of params in scripts\r\n- [ ] #20705 Max number of shards per node (enforced as total shards per cluster)\r\n- [ ] #20760 Limit index creation rate\r\n- [ ] #23268 Add upper limit for `scroll` expiry time (Jim)\r\n- [x] #26390 Add upper limit for the number of requested doc-values fields (Christoph)\r\n\r\n---\r\n\r\nFor discussion:\r\n- [ ] #29050 Disable certain query types, eg wildcard, span etc?\r\n- [ ] #14046 Limit on the number of buckets returned by aggs \r\n- [ ] #9310 Limit the size of the response (eg for very large doc bodies)\r\n- [ ] ~~Kill slow scripts when search timeout has lapsed aka while(true) should not require a rolling restart to recover from~~ Don't run a script a second time when the first execution takes longer than 1 second\r\n- [ ] ~~#6470 Disable searching on all indices by default~~ Handled by max number of shards\r\n- [ ] Limit the number nested Lucene documents per document. #26962\r\n\r\nAny other ideas?\r\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}