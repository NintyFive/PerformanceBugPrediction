{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3164","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3164/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3164/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3164/events","html_url":"https://github.com/elastic/elasticsearch/issues/3164","id":15439688,"node_id":"MDU6SXNzdWUxNTQzOTY4OA==","number":3164,"title":"Phrase suggest run 100% CPU when giving long sentences","user":{"login":"damienalexandre","id":225704,"node_id":"MDQ6VXNlcjIyNTcwNA==","avatar_url":"https://avatars2.githubusercontent.com/u/225704?v=4","gravatar_id":"","url":"https://api.github.com/users/damienalexandre","html_url":"https://github.com/damienalexandre","followers_url":"https://api.github.com/users/damienalexandre/followers","following_url":"https://api.github.com/users/damienalexandre/following{/other_user}","gists_url":"https://api.github.com/users/damienalexandre/gists{/gist_id}","starred_url":"https://api.github.com/users/damienalexandre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/damienalexandre/subscriptions","organizations_url":"https://api.github.com/users/damienalexandre/orgs","repos_url":"https://api.github.com/users/damienalexandre/repos","events_url":"https://api.github.com/users/damienalexandre/events{/privacy}","received_events_url":"https://api.github.com/users/damienalexandre/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2013-06-12T08:25:59Z","updated_at":"2013-06-13T13:33:29Z","closed_at":"2013-06-13T13:33:29Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hi,\n\nI run into an issue with the Suggester, using \"phrase\". Here is a gist, but I have to warn you: your CPU will melt if you do not stop ES :fire:!\n\nhttps://gist.github.com/damienalexandre/5763504\n\nYou can test with:\n\n``` json\n{\"query\": {\n    \"match\" : {\n      \"_all\": {\n        \"query\": \"queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen queen \"\n      }\n    }\n   },\n  \"suggest\": {\n    \"text\": \"queen\",\n    \"my-suggest\": {\n      \"phrase\": {\n        \"field\": \"name\",\n        \"analyzer\" : \"francais\"\n      }\n    }\n  }\n}\n```\n\nAnd that will works. So the issue is only when the `text` is long. \n\nTo prevent serious issues in production, I have to implement a truncate on the client side, avoiding long user contributed sentences.\n\nI do not know if this is an ES bug or a bad usage from me - using a suggester on a phrase is not clever BUT as this is a public search engine, I can't expect user to use simple search terms.\n\nES 0.90.1 on Ubuntu 12.04 (but same issue on FreeBSD).\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}