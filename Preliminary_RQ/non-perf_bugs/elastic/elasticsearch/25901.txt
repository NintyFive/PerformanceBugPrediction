{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25901","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25901/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25901/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25901/events","html_url":"https://github.com/elastic/elasticsearch/issues/25901","id":245671630,"node_id":"MDU6SXNzdWUyNDU2NzE2MzA=","number":25901,"title":"Aggregation with geodistance sorting","user":{"login":"Akshayprmar","id":30464870,"node_id":"MDQ6VXNlcjMwNDY0ODcw","avatar_url":"https://avatars1.githubusercontent.com/u/30464870?v=4","gravatar_id":"","url":"https://api.github.com/users/Akshayprmar","html_url":"https://github.com/Akshayprmar","followers_url":"https://api.github.com/users/Akshayprmar/followers","following_url":"https://api.github.com/users/Akshayprmar/following{/other_user}","gists_url":"https://api.github.com/users/Akshayprmar/gists{/gist_id}","starred_url":"https://api.github.com/users/Akshayprmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Akshayprmar/subscriptions","organizations_url":"https://api.github.com/users/Akshayprmar/orgs","repos_url":"https://api.github.com/users/Akshayprmar/repos","events_url":"https://api.github.com/users/Akshayprmar/events{/privacy}","received_events_url":"https://api.github.com/users/Akshayprmar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-07-26T10:09:23Z","updated_at":"2017-07-31T06:19:21Z","closed_at":"2017-07-27T12:11:32Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:\r\ni have need to aggregation for id and sorting to geodistance data...\r\nwhen i try to sorting with sort field that time giving below error..\r\n\"reason\": \"Invalid term-aggregates order path [sort]. Unknown aggregation [sort]\"\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version**: elasticsearch-5.4.3\r\n**Mapping **\r\n\r\n> PUT /museums\r\n> {\r\n>     \"mappings\": {\r\n>         \"doc\": {\r\n>             \"properties\": {\r\n>                 \"location\": {\r\n>                     \"type\": \"geo_point\"\r\n>                 }\r\n>             }\r\n>         }\r\n>     }\r\n> }\r\n\r\n** DATA **\r\nPOST /museums/doc/_bulk?refresh\r\n\r\n> {\"index\":{\"_id\":1}}\r\n> {\"location\": \"52.374081,4.912350\", \"name\": \"NEMO Science Museum\"}\r\n> {\"index\":{\"_id\":2}}\r\n> {\"location\": \"52.369219,4.901618\", \"name\": \"Museum Het Rembrandthuis\"}\r\n> {\"index\":{\"_id\":3}}\r\n> {\"location\": \"52.371667,4.914722\", \"name\": \"Nederlands Scheepvaartmuseum\"}\r\n> {\"index\":{\"_id\":4}}\r\n> {\"location\": \"51.222900,4.405200\", \"name\": \"Letterenhuis\"}\r\n> {\"index\":{\"_id\":5}}\r\n> {\"location\": \"48.861111,2.336389\", \"name\": \"Musée du Louvre\"}\r\n> {\"index\":{\"_id\":6}}\r\n> {\"location\": \"48.860000,2.327000\", \"name\": \"Musée d'Orsay\"}\r\n> {\"index\":{\"_id\":7}}\r\n> {\"location\": \"52.374081,4.912350\", \"name\": \"NEMO Science Museum\"}\r\n> {\"index\":{\"_id\":8}}\r\n> {\"location\": \"48.861111,2.336389\", \"name\": \"Musée du Louvre\"}\r\n\r\n**Elastic Query**\r\n\r\n> POST /museums/_search?size=0\r\n> {\r\n>         \"query\": {\r\n> \r\n>         },\r\n>         \"sort\": {\r\n>             \"_geo_distance\": {\r\n>                 \"location\": {\r\n>                         \"lat\": 52.3760,\r\n>                         \"lon\": 4.894\r\n>                 },\r\n>                 \"order\": \"asc\",\r\n>                 \"unit\": \"km\",\r\n>                 \"distance_type\": \"arc\"\r\n>             }\r\n>         },\r\n>         \"aggregations\": {\r\n>             \"by_id\": {\r\n>                 \"terms\": {\r\n>                     \"field\": \"name.keyword\",\r\n>                     \"order\": {\r\n>                       \"_count\": \"asc\"\r\n>                     },\r\n>                     \"size\": 20\r\n>                 },\r\n>                 \"aggregations\":{\r\n>                   \"top\":{\r\n>                     \"top_hits\":\r\n>                     {\r\n>                       \"sort\":{\r\n>                         \"_geo_distance\":{\r\n> \"location\":{\"lat\":19.143172,\"lon\":72.824966\r\n>                           }\r\n>               }\r\n>     }\r\n> }\r\n> }\r\n> }\r\n> }\r\n> }\r\n> }","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}