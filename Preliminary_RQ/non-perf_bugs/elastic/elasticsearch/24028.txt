{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24028","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24028/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24028/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24028/events","html_url":"https://github.com/elastic/elasticsearch/issues/24028","id":220751712,"node_id":"MDU6SXNzdWUyMjA3NTE3MTI=","number":24028,"title":"_bulk request with `action.auto_create_index` configured doesn't return the right bulk response","user":{"login":"ph","id":640,"node_id":"MDQ6VXNlcjY0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/640?v=4","gravatar_id":"","url":"https://api.github.com/users/ph","html_url":"https://github.com/ph","followers_url":"https://api.github.com/users/ph/followers","following_url":"https://api.github.com/users/ph/following{/other_user}","gists_url":"https://api.github.com/users/ph/gists{/gist_id}","starred_url":"https://api.github.com/users/ph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ph/subscriptions","organizations_url":"https://api.github.com/users/ph/orgs","repos_url":"https://api.github.com/users/ph/repos","events_url":"https://api.github.com/users/ph/events{/privacy}","received_events_url":"https://api.github.com/users/ph/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":30486044,"node_id":"MDU6TGFiZWwzMDQ4NjA0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eregression","name":">regression","color":"d7e102","default":false,"description":null},{"id":534335216,"node_id":"MDU6TGFiZWw1MzQzMzUyMTY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.4.0","name":"v5.4.0","color":"dddddd","default":false,"description":null},{"id":334286612,"node_id":"MDU6TGFiZWwzMzQyODY2MTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.0-alpha1","name":"v6.0.0-alpha1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2017-04-10T19:52:47Z","updated_at":"2018-02-13T19:39:12Z","closed_at":"2017-04-21T22:56:05Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**: 5.3.0\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen whitelisting index name using the `action.auto_create_index` and sending a bulk request to ES with a forbidden index name doesn't return the expected bulk response.\r\n\r\nThe response is missing a **items** fields, allowing us to check if each document succeeded or not\r\n\r\nmore details at https://github.com/logstash-plugins/logstash-output-elasticsearch/issues/584\r\n\r\n**Steps to reproduce**:\r\n1. Adding the following to the *elasticsearch.yml*\r\n```yaml\r\n action.auto_create_index: .security,.monitoring*,.watches,.triggered_watches,.watcher-history*\r\n```\r\n\r\n2. using this json document.\r\n```\r\ncat /tmp/x\r\n{\"index\":{\"_id\":null,\"_index\":\".logstash-2017.04.08\",\"_type\":\"stdin\",\"_routing\":null}}\r\n{\"@timestamp\":\"2017-04-09T10:34:25.253Z\",\"@version\":\"1\",\"host\":\"localhost.localdomain\",\"message\":\"testing\",\"type\":\"stdin\"}\r\n```\r\n\r\n3. \r\n```\r\ncurl -D- --data-binary @/tmp/x localhost:9200/_bulk?pretty\r\n```\r\n\r\n```json\r\nHTTP/1.1 404 Not Found\r\nWarning: 299 Elasticsearch-5.3.0-3adb13b \"Content type detection for rest requests is deprecated. Specify the content type using the [Content-Type] header.\" \"Mon, 10 Apr 2017 19:46:17 GMT\"\r\ncontent-type: application/json; charset=UTF-8\r\ncontent-length: 612\r\n\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"index_not_found_exception\",\r\n        \"reason\" : \"no such index and [action.auto_create_index] ([.security,.monitoring*,.watches,.triggered_watches,.watcher-history*]) doesn't match\",\r\n        \"index_uuid\" : \"_na_\",\r\n        \"index\" : \".logstash-2017.04.08\"\r\n      }\r\n    ],\r\n    \"type\" : \"index_not_found_exception\",\r\n    \"reason\" : \"no such index and [action.auto_create_index] ([.security,.monitoring*,.watches,.triggered_watches,.watcher-history*]) doesn't match\",\r\n    \"index_uuid\" : \"_na_\",\r\n    \"index\" : \".logstash-2017.04.08\"\r\n  },\r\n  \"status\" : 404\r\n}\r\n```\r\n\r\nTested in 5.1.2 returns a correct response:\r\n\r\n```\r\n% curl -D- --data-binary @/tmp/x localhost:9200/_bulk?pretty\r\nHTTP/1.1 200 OK\r\ncontent-type: application/json; charset=UTF-8\r\ncontent-length: 496\r\n\r\n{\r\n  \"took\" : 0,\r\n  \"errors\" : true,\r\n  \"items\" : [\r\n    {\r\n      \"index\" : {\r\n        \"_index\" : \"logstash-2017.04.09\",\r\n        \"_type\" : \"stdin\",\r\n        \"_id\" : null,\r\n        \"status\" : 404,\r\n        \"error\" : {\r\n          \"type\" : \"index_not_found_exception\",\r\n          \"reason\" : \"no such index\",\r\n          \"resource.type\" : \"index_expression\",\r\n          \"resource.id\" : \"logstash-2017.04.09\",\r\n          \"index_uuid\" : \"_na_\",\r\n          \"index\" : \"logstash-2017.04.09\"\r\n        }\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n4. If in a single bulk request you target 2 different index, it will return a single bulk response in the `bulk`\r\n\r\n**Request**\r\n```json\r\n{\"index\":{\"_id\":null,\"_index\":\".logstash-2017.04.08\",\"_type\":\"stdin\",\"_routing\":null}}\r\n{\"@timestamp\":\"2017-04-09T10:34:25.253Z\",\"@version\":\"1\",\"host\":\"localhost.localdomain\",\"message\":\"testing\",\"type\":\"stdin\"}\r\n{\"index\":{\"_id\":null,\"_index\":\".monitoring-2017.04.08\",\"_type\":\"stdin\",\"_routing\":null}}\r\n{\"@timestamp\":\"2017-04-09T10:34:25.253Z\",\"@version\":\"1\",\"host\":\"localhost.localdomain\",\"message\":\"testing 2\",\"type\":\"stdin\"}\r\n```\r\n**Response:**\r\n```json\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"index_not_found_exception\",\r\n        \"reason\" : \"no such index and [action.auto_create_index] ([.security,.monitoring*,.watches,.triggered_watches,.watcher-history*]) doesn't match\",\r\n        \"index_uuid\" : \"_na_\",\r\n        \"index\" : \".logstash-2017.04.08\"\r\n      }\r\n    ],\r\n    \"type\" : \"index_not_found_exception\",\r\n    \"reason\" : \"no such index and [action.auto_create_index] ([.security,.monitoring*,.watches,.triggered_watches,.watcher-history*]) doesn't match\",\r\n    \"index_uuid\" : \"_na_\",\r\n    \"index\" : \".logstash-2017.04.08\"\r\n  },\r\n  \"status\" : 404\r\n}\r\n````","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}