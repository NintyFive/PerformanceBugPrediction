{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25113","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25113/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25113/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25113/events","html_url":"https://github.com/elastic/elasticsearch/issues/25113","id":234286810,"node_id":"MDU6SXNzdWUyMzQyODY4MTA=","number":25113,"title":"TribeNode / TribeMaster ignores CONF_DIR after Upgrade to ES 5.3.1 or higher","user":{"login":"h8h","id":953856,"node_id":"MDQ6VXNlcjk1Mzg1Ng==","avatar_url":"https://avatars1.githubusercontent.com/u/953856?v=4","gravatar_id":"","url":"https://api.github.com/users/h8h","html_url":"https://github.com/h8h","followers_url":"https://api.github.com/users/h8h/followers","following_url":"https://api.github.com/users/h8h/following{/other_user}","gists_url":"https://api.github.com/users/h8h/gists{/gist_id}","starred_url":"https://api.github.com/users/h8h/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/h8h/subscriptions","organizations_url":"https://api.github.com/users/h8h/orgs","repos_url":"https://api.github.com/users/h8h/repos","events_url":"https://api.github.com/users/h8h/events{/privacy}","received_events_url":"https://api.github.com/users/h8h/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2017-06-07T17:34:38Z","updated_at":"2020-11-11T21:57:26Z","closed_at":"2018-03-12T05:27:44Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 5.3.1\r\n\r\n**Plugins installed**: [x-pack]\r\n\r\n**JVM version** (`java -version`): will be given later, debian jessie backports 8u131-b11-1~bpo8+1\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Debian Jessie 8, 64bit.\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nAfter upgrade the Tribe Master from ES 5.3.0 to ES 5.3.1 and x-pack the CONF_DIR variable gets ignored and ES searches for files in wrong directories, `/usr/share/elasticsearch` instead of `/etc/elasticsearch`.\r\n\r\nOnly the Tribe Master is affected.\r\n\r\nA Tribe Master is in my opinion a system with at least the following configuration:\r\n```\r\ntribe:\r\n    t1: \r\n        cluster.name:   cluster_one\r\n    t2: \r\n        cluster.name:   cluster_two\r\n```\r\nIf I delete the tribe block, everything works again, even with ES 5.3.1\r\n\r\n*The problem is not fixed in the later versions*\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n1. Upgrade Debian ES 5.3.0 to ES 5.3.1 \r\n2. Restart ES (`systemctl restart elasticsearch`)\r\n3. Restart failed, see logs above\r\n4. Downgrade to ES 5.3.0 (`apt-get install elasticsearch=5.3.0`)\r\n5. ES works again\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\njava.security.AccessControlException: access denied\r\n(\"java.io.FilePermission\" \"/usr/share/elasticsearch/config/scripts\" \"read\")\r\n\tat\r\njava.security.AccessControlContext.checkPermission(AccessControlContext.java\r\n:472) ~[?:1.8.0_131]\r\n\tat\r\njava.security.AccessController.checkPermission(AccessController.java:884)\r\n~[?:1.8.0_131]\r\n\tat\r\njava.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n~[?:1.8.0_131]\r\norg.elasticsearch.bootstrap.StartupException:\r\njava.security.AccessControlException: access denied\r\n(\"java.io.FilePermission\" \"/usr/share/elasticsearch/config/scripts\" \"read\")\r\nCaused by: java.security.AccessControlException: access denied\r\n(\"java.io.FilePermission\" \"/usr/share/elasticsearch/config/scripts\" \"read\")\r\n\tat\r\njava.security.AccessControlContext.checkPermission(AccessControlContext.java\r\n:472) ~[?:1.8.0_131]\r\n\tat\r\njava.security.AccessController.checkPermission(AccessController.java:884)\r\n~[?:1.8.0_131]\r\n\tat\r\njava.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n~[?:1.8.0_131]\r\njava.security.AccessControlException: access denied\r\n(\"java.io.FilePermission\" \"/usr/share/elasticsearch/config/scripts\" \"read\")\r\n\tat\r\njava.security.AccessControlContext.checkPermission(AccessControlContext.java\r\n:472) ~[?:1.8.0_131]\r\n\tat\r\njava.security.AccessController.checkPermission(AccessController.java:884)\r\n~[?:1.8.0_131]\r\n\tat\r\njava.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n~[?:1.8.0_131]\r\norg.elasticsearch.bootstrap.StartupException:\r\njava.security.AccessControlException: access denied\r\n(\"java.io.FilePermission\" \"/usr/share/elasticsearch/config/scripts\" \"read\")\r\nCaused by: java.security.AccessControlException: access denied\r\n(\"java.io.FilePermission\" \"/usr/share/elasticsearch/config/scripts\" \"read\")\r\n\tat\r\njava.security.AccessControlContext.checkPermission(AccessControlContext.java\r\n:472) ~[?:1.8.0_131]\r\n\tat\r\njava.security.AccessController.checkPermission(AccessController.java:884)\r\n~[?:1.8.0_131]\r\n\tat\r\njava.lang.SecurityManager.checkPermission(SecurityManager.java:549)\r\n~[?:1.8.0_131]\r\norg.elasticsearch.bootstrap.StartupException: ElasticsearchException[Failed\r\nto load plugin class [org.elasticsearch.xpack.XPackPlugin]]; nested:\r\nInvocationTargetException; nested: AccessControlException[access denied\r\n(\"java.io.FilePermission\"\r\n\"/usr/share/elasticsearch/config/x-pack/system_key\" \"read\")];\r\n```\r\n\r\n\r\n/etc/default/elasticsearch\r\n```\r\n################################\r\n# Elasticsearch\r\n################################\r\n\r\n# Elasticsearch home directory\r\n#ES_HOME=/usr/share/elasticsearch\r\n\r\n# Elasticsearch Java path\r\n#JAVA_HOME=\r\n\r\n# Elasticsearch configuration directory\r\n#CONF_DIR=/etc/elasticsearch\r\n\r\n# Elasticsearch data directory\r\n#DATA_DIR=/var/lib/elasticsearch\r\n\r\n# Elasticsearch logs directory\r\n#LOG_DIR=/var/log/elasticsearch\r\n\r\n# Elasticsearch PID directory\r\n#PID_DIR=/var/run/elasticsearch\r\n\r\n# Additional Java OPTS\r\nES_JAVA_OPTS=\"\"\r\n\r\n# Configure restart on package upgrade (true, every other setting will lead\r\nto not restarting)\r\n#RESTART_ON_UPGRADE=true\r\n\r\n################################\r\n# Elasticsearch service\r\n################################\r\n\r\n# SysV init.d\r\n#\r\n# When executing the init script, this user will be used to run the\r\nelasticsearch service.\r\n# The default value is 'elasticsearch' and is declared in the init.d file.\r\n# Note that this setting is only used by the init script. If changed, make\r\nsure that\r\n# the configured user can read and write into the data, work, plugins and\r\nlog directories.\r\n# For systemd service, the user is usually configured in file\r\n/usr/lib/systemd/system/elasticsearch.service\r\n#ES_USER=elasticsearch\r\n#ES_GROUP=elasticsearch\r\n\r\n# The number of seconds to wait before checking if Elasticsearch started\r\nsuccessfully as a daemon process\r\nES_STARTUP_SLEEP_TIME=5\r\n\r\n################################\r\n# System properties\r\n################################\r\n\r\n# Specifies the maximum file descriptor number that can be opened by this\r\nprocess\r\n# When using Systemd, this setting is ignored and the LimitNOFILE defined in\r\n# /usr/lib/systemd/system/elasticsearch.service takes precedence\r\n#MAX_OPEN_FILES=65536\r\n\r\n# The maximum number of bytes of memory that may be locked into RAM\r\n# Set to \"unlimited\" if you use the 'bootstrap.memory_lock: true' option\r\n# in elasticsearch.yml.\r\n# When using Systemd, the LimitMEMLOCK property must be set\r\n# in /usr/lib/systemd/system/elasticsearch.service\r\n#MAX_LOCKED_MEMORY=unlimited\r\n\r\n# Maximum number of VMA (Virtual Memory Areas) a process can own\r\n# When using Systemd, this setting is ignored and the 'vm.max_map_count'\r\n# property is set at boot time in /usr/lib/sysctl.d/elasticsearch.conf\r\n#MAX_MAP_COUNT=262144\r\n```\r\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}