[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68110903","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-68110903","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":68110903,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTEwOTAz","user":{"login":"matthuhiggins","id":8185,"node_id":"MDQ6VXNlcjgxODU=","avatar_url":"https://avatars1.githubusercontent.com/u/8185?v=4","gravatar_id":"","url":"https://api.github.com/users/matthuhiggins","html_url":"https://github.com/matthuhiggins","followers_url":"https://api.github.com/users/matthuhiggins/followers","following_url":"https://api.github.com/users/matthuhiggins/following{/other_user}","gists_url":"https://api.github.com/users/matthuhiggins/gists{/gist_id}","starred_url":"https://api.github.com/users/matthuhiggins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthuhiggins/subscriptions","organizations_url":"https://api.github.com/users/matthuhiggins/orgs","repos_url":"https://api.github.com/users/matthuhiggins/repos","events_url":"https://api.github.com/users/matthuhiggins/events{/privacy}","received_events_url":"https://api.github.com/users/matthuhiggins/received_events","type":"User","site_admin":false},"created_at":"2014-12-25T19:14:09Z","updated_at":"2014-12-25T19:14:09Z","author_association":"NONE","body":"I frequently find that the queue_size is not picked up when using a live update. In my particular case it is for bulk.queue_size. Do all writes to the cluster need to completely stop to give ES time to switch over?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71346966","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-71346966","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":71346966,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMzQ2OTY2","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2015-01-25T02:06:34Z","updated_at":"2015-01-25T02:06:34Z","author_association":"MEMBER","body":"@matthuhiggins could you share a bit more details here? Which version of elasticsearch are you using? How exactly do you try to change the bulk thread pool queue size? How do you verify that your changes were not picked up?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71786819","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-71786819","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":71786819,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNzg2ODE5","user":{"login":"matthuhiggins","id":8185,"node_id":"MDQ6VXNlcjgxODU=","avatar_url":"https://avatars1.githubusercontent.com/u/8185?v=4","gravatar_id":"","url":"https://api.github.com/users/matthuhiggins","html_url":"https://github.com/matthuhiggins","followers_url":"https://api.github.com/users/matthuhiggins/followers","following_url":"https://api.github.com/users/matthuhiggins/following{/other_user}","gists_url":"https://api.github.com/users/matthuhiggins/gists{/gist_id}","starred_url":"https://api.github.com/users/matthuhiggins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthuhiggins/subscriptions","organizations_url":"https://api.github.com/users/matthuhiggins/orgs","repos_url":"https://api.github.com/users/matthuhiggins/repos","events_url":"https://api.github.com/users/matthuhiggins/events{/privacy}","received_events_url":"https://api.github.com/users/matthuhiggins/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T06:19:08Z","updated_at":"2015-01-28T06:19:08Z","author_association":"NONE","body":"I was using elasticsearch 1.4.0. I used the index update settings API to increase the bulk queue size capacity to 100. For up to 30 minutes after, I continued to see `[rejected execution (queue capacity 50) ..` for bulk requests. It was eventually picked up. (I unfortunately then started seeing `queue capacity 100` errors. I set the queue capacity to -1 and restarted the cluster because I continued to see errors with capacity of 100).\n\nI tried both transient and persistent settings. The reason I think there is a bug is because of the case where I saw `queue capacity 50` errors for up to 30 minutes after the change. Without any changes on my part, the setting was finally picked up after all index writes were stopped.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71913387","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-71913387","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":71913387,"node_id":"MDEyOklzc3VlQ29tbWVudDcxOTEzMzg3","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T20:52:13Z","updated_at":"2015-01-28T20:52:13Z","author_association":"MEMBER","body":"@matthuhiggins when queue size is updated elasticsearch retires old executor and replaces it with a new executor. So, this lingering error is only possible is some component is holding to the old instance of the executor and continues to reuse it instead of asking for a new one. I checked all places where we are using BULK thread pool and don't really see how it can continue clinging to the old instance for 30 minutes. Do you still have the log file with this error? I would love to see a complete stack trace to figure out who is hanging to this thread pool for so long. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71916728","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-71916728","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":71916728,"node_id":"MDEyOklzc3VlQ29tbWVudDcxOTE2NzI4","user":{"login":"matthuhiggins","id":8185,"node_id":"MDQ6VXNlcjgxODU=","avatar_url":"https://avatars1.githubusercontent.com/u/8185?v=4","gravatar_id":"","url":"https://api.github.com/users/matthuhiggins","html_url":"https://github.com/matthuhiggins","followers_url":"https://api.github.com/users/matthuhiggins/followers","following_url":"https://api.github.com/users/matthuhiggins/following{/other_user}","gists_url":"https://api.github.com/users/matthuhiggins/gists{/gist_id}","starred_url":"https://api.github.com/users/matthuhiggins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthuhiggins/subscriptions","organizations_url":"https://api.github.com/users/matthuhiggins/orgs","repos_url":"https://api.github.com/users/matthuhiggins/repos","events_url":"https://api.github.com/users/matthuhiggins/events{/privacy}","received_events_url":"https://api.github.com/users/matthuhiggins/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T21:11:09Z","updated_at":"2015-01-28T21:11:24Z","author_association":"NONE","body":"I do not, and I imagine it will be hard to retrace. The cluster returns the new settings immediately after the update, and my only guess is that something held reference to the older executor. (In my case, we had a 5 node cluster with 80 processes writing to it).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71918246","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-71918246","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":71918246,"node_id":"MDEyOklzc3VlQ29tbWVudDcxOTE4MjQ2","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T21:19:36Z","updated_at":"2015-01-28T21:19:36Z","author_association":"MEMBER","body":"@matthuhiggins what did you use to bulk index data into elasticsearch?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71924381","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-71924381","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":71924381,"node_id":"MDEyOklzc3VlQ29tbWVudDcxOTI0Mzgx","user":{"login":"matthuhiggins","id":8185,"node_id":"MDQ6VXNlcjgxODU=","avatar_url":"https://avatars1.githubusercontent.com/u/8185?v=4","gravatar_id":"","url":"https://api.github.com/users/matthuhiggins","html_url":"https://github.com/matthuhiggins","followers_url":"https://api.github.com/users/matthuhiggins/followers","following_url":"https://api.github.com/users/matthuhiggins/following{/other_user}","gists_url":"https://api.github.com/users/matthuhiggins/gists{/gist_id}","starred_url":"https://api.github.com/users/matthuhiggins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthuhiggins/subscriptions","organizations_url":"https://api.github.com/users/matthuhiggins/orgs","repos_url":"https://api.github.com/users/matthuhiggins/repos","events_url":"https://api.github.com/users/matthuhiggins/events{/privacy}","received_events_url":"https://api.github.com/users/matthuhiggins/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T21:53:30Z","updated_at":"2015-01-28T21:53:30Z","author_association":"NONE","body":"Resque workers reading from a postgres table and sending that raw data to elasticsearch. (Each worker was told to work on a range of the data). Were you curious or will this help you debug?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71928809","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-71928809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":71928809,"node_id":"MDEyOklzc3VlQ29tbWVudDcxOTI4ODA5","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T22:19:23Z","updated_at":"2015-01-28T22:19:23Z","author_association":"MEMBER","body":"@matthuhiggins I was just trying to rule out a remote possibility that you used a plugin that was hoarding old bulk executors.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71930452","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-71930452","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":71930452,"node_id":"MDEyOklzc3VlQ29tbWVudDcxOTMwNDUy","user":{"login":"matthuhiggins","id":8185,"node_id":"MDQ6VXNlcjgxODU=","avatar_url":"https://avatars1.githubusercontent.com/u/8185?v=4","gravatar_id":"","url":"https://api.github.com/users/matthuhiggins","html_url":"https://github.com/matthuhiggins","followers_url":"https://api.github.com/users/matthuhiggins/followers","following_url":"https://api.github.com/users/matthuhiggins/following{/other_user}","gists_url":"https://api.github.com/users/matthuhiggins/gists{/gist_id}","starred_url":"https://api.github.com/users/matthuhiggins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matthuhiggins/subscriptions","organizations_url":"https://api.github.com/users/matthuhiggins/orgs","repos_url":"https://api.github.com/users/matthuhiggins/repos","events_url":"https://api.github.com/users/matthuhiggins/events{/privacy}","received_events_url":"https://api.github.com/users/matthuhiggins/received_events","type":"User","site_admin":false},"created_at":"2015-01-28T22:29:01Z","updated_at":"2015-01-28T22:29:01Z","author_association":"NONE","body":"Nope. It's just simple bulk requests over http. I imagine that the scenario could be reproduced with a multi-node cluster and sufficient load - if not, no worries.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75903310","html_url":"https://github.com/elastic/elasticsearch/issues/2509#issuecomment-75903310","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2509","id":75903310,"node_id":"MDEyOklzc3VlQ29tbWVudDc1OTAzMzEw","user":{"login":"djdenv","id":711107,"node_id":"MDQ6VXNlcjcxMTEwNw==","avatar_url":"https://avatars3.githubusercontent.com/u/711107?v=4","gravatar_id":"","url":"https://api.github.com/users/djdenv","html_url":"https://github.com/djdenv","followers_url":"https://api.github.com/users/djdenv/followers","following_url":"https://api.github.com/users/djdenv/following{/other_user}","gists_url":"https://api.github.com/users/djdenv/gists{/gist_id}","starred_url":"https://api.github.com/users/djdenv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djdenv/subscriptions","organizations_url":"https://api.github.com/users/djdenv/orgs","repos_url":"https://api.github.com/users/djdenv/repos","events_url":"https://api.github.com/users/djdenv/events{/privacy}","received_events_url":"https://api.github.com/users/djdenv/received_events","type":"User","site_admin":false},"created_at":"2015-02-25T04:20:59Z","updated_at":"2015-02-25T04:20:59Z","author_association":"NONE","body":"I had to do this as well with the bulk queue_size. In my scenario, I was using elastic search via the grails plugin. The plugin binds to the domain model and queues up index updates asynchronously. The application was performing an immense amount of database activity (importing a very large CSV file into database) and quickly surpassed the default queue_size of 50 (saw same error as @matthuhiggins. Using the Java API, I was able to update the queue size like so:\n\nThreadPool threadPool = elasticSearchAdminService.elasticSearchHelper.elasticSearchClient.admin().cluster().threadPool()\n       threadPool.updateSettings(ImmutableSettings.settingsBuilder().put(\"threadpool.bulk.queue_size\", \"1000\").build())\n\nNote that \"elasticSearchAdminService\" is the injected grails service provided by the plugin.\nHope this is helpful to someone...\n","performed_via_github_app":null}]