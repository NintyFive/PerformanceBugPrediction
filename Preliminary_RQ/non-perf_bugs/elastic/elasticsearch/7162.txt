{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7162","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7162/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7162/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7162/events","html_url":"https://github.com/elastic/elasticsearch/issues/7162","id":39514293,"node_id":"MDU6SXNzdWUzOTUxNDI5Mw==","number":7162,"title":"Issues with index routing allocation in 1.3.1","user":{"login":"JamesDooley","id":1665724,"node_id":"MDQ6VXNlcjE2NjU3MjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1665724?v=4","gravatar_id":"","url":"https://api.github.com/users/JamesDooley","html_url":"https://github.com/JamesDooley","followers_url":"https://api.github.com/users/JamesDooley/followers","following_url":"https://api.github.com/users/JamesDooley/following{/other_user}","gists_url":"https://api.github.com/users/JamesDooley/gists{/gist_id}","starred_url":"https://api.github.com/users/JamesDooley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JamesDooley/subscriptions","organizations_url":"https://api.github.com/users/JamesDooley/orgs","repos_url":"https://api.github.com/users/JamesDooley/repos","events_url":"https://api.github.com/users/JamesDooley/events{/privacy}","received_events_url":"https://api.github.com/users/JamesDooley/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2014-08-05T12:36:36Z","updated_at":"2014-08-20T15:45:44Z","closed_at":"2014-08-20T15:45:44Z","author_association":"NONE","active_lock_reason":null,"body":"I noticed an issue after upgrading from 0.90.9 to 1.3.1 that the index.routing.allocation.include._ip setting per index is not being properly handled.  I have used this setting in the past to move indices to an archiving server for long term storage (outside of the cluster).\n\nIn  the past the past I have been able to do the following:\n\nPre-move settings:\n\n``` perl\n'index' => {\n    'routing' => {\n        'allocation' => {\n            'include' => {\n                'tag' => 'storage',\n            },\n            'total_shards_per_node' => '2'\n        }\n    }\n}\n```\n\nMove settings:\n\n``` perl\n'index' => {\n    'routing' => {\n        'allocation' => {\n            'include' => {\n                'tag' => '',\n                '_ip' => '192.168.0.51',\n            },\n            'total_shards_per_node' => '999'\n        }\n    }\n}\n```\n\nThis would force one copy of each shard to migrate to the archiving server from the storage cluster.\n\nNow in 1.3.1 the shards do not move at all with these settings, instead I have to set the following:\n\n``` perl\n'index' => {\n    'routing' => {\n        'allocation' => {\n            'include' => {\n                'tag' => 'storage,backup',\n                '_ip' => '192.168.0.51',\n            },\n            'total_shards_per_node' => '999'\n        }\n    }\n}\n```\n\nI did a quick test and it does look like if I do not provide the _ip setting, but only use the tags setting the migration works as intended.  This leads me to believe that the _ip field is being completely ignored.\n\nIn my use case I can't rely on the backup tag since I will have more than one backup server (using that tag), but need all of the data to go to a single server (ie need _ip, _host, etc).\n\nUnfortunately, I was running on an old cluster for awhile so I am not sure  exactly where this broke at. But would have been somewhere between 0.90.9 and 1.3.1.\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}