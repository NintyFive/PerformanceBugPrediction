{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32208","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32208/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32208/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32208/events","html_url":"https://github.com/elastic/elasticsearch/issues/32208","id":342839369,"node_id":"MDU6SXNzdWUzNDI4MzkzNjk=","number":32208,"title":"[CI] Connection failures in `repository-s3:integTestMinioRunner` credentials tests","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":160579278,"node_id":"MDU6TGFiZWwxNjA1NzkyNzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Discovery-Plugins","name":":Distributed/Discovery-Plugins","color":"0e8a16","default":false,"description":"Anything related to our integration plugins with EC2, GCP and Azure"},{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2018-07-19T18:25:40Z","updated_at":"2018-10-26T10:55:21Z","closed_at":"2018-10-26T10:55:21Z","author_association":"MEMBER","active_lock_reason":null,"body":"https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-unix-compatibility/os=ubuntu&&virtual/1190/consoleFull\r\n\r\nI cannot reproduce this locally, so it might be temporary. Just filing an issue in case there are more occasions of this:\r\n```\r\nREPRODUCE WITH: ./gradlew :plugins:repository-s3:integTestMinioRunner \\\r\n  -Dtests.seed=180F1CCF65203FAC \\\r\n  -Dtests.class=org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {yaml=repository_s3/20_repository_permanent_credentials/Snapshot and Restore with repository-s3 using permanent credentials}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=lt-LT \\\r\n  -Dtests.timezone=Asia/Pontianak \\\r\n  -Dtests.rest.blacklist=repository_s3/30_repository_temporary_credentials/*,repository_s3/40_repository_ec2_credentials/*\r\n\r\nREPRODUCE WITH: ./gradlew :plugins:repository-s3:integTestMinioRunner \\\r\n  -Dtests.seed=180F1CCF65203FAC \\\r\n  -Dtests.class=org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {yaml=repository_s3/20_repository_permanent_credentials/Register a repository with a non existing bucket}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=lt-LT \\\r\n  -Dtests.timezone=Asia/Pontianak \\\r\n  -Dtests.rest.blacklist=repository_s3/30_repository_temporary_credentials/*,repository_s3/40_repository_ec2_credentials/*\r\n\r\nREPRODUCE WITH: ./gradlew :plugins:repository-s3:integTestMinioRunner \\\r\n  -Dtests.seed=180F1CCF65203FAC \\\r\n  -Dtests.class=org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {yaml=repository_s3/20_repository_permanent_credentials/teardown}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=lt-LT \\\r\n  -Dtests.timezone=Asia/Pontianak \\\r\n  -Dtests.rest.blacklist=repository_s3/30_repository_temporary_credentials/*,repository_s3/40_repository_ec2_credentials/*\r\n\r\nREPRODUCE WITH: ./gradlew :plugins:repository-s3:integTestMinioRunner \\\r\n  -Dtests.seed=180F1CCF65203FAC \\\r\n  -Dtests.class=org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {yaml=repository_s3/20_repository_permanent_credentials/Restore a non existing snapshot}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=lt-LT \\\r\n  -Dtests.timezone=Asia/Pontianak \\\r\n  -Dtests.rest.blacklist=repository_s3/30_repository_temporary_credentials/*,repository_s3/40_repository_ec2_credentials/*\r\n\r\nREPRODUCE WITH: ./gradlew :plugins:repository-s3:integTestMinioRunner \\\r\n  -Dtests.seed=180F1CCF65203FAC \\\r\n  -Dtests.class=org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {yaml=repository_s3/20_repository_permanent_credentials/Delete a non existing snapshot}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=lt-LT \\\r\n  -Dtests.timezone=Asia/Pontianak \\\r\n  -Dtests.rest.blacklist=repository_s3/30_repository_temporary_credentials/*,repository_s3/40_repository_ec2_credentials/*\r\n\r\nREPRODUCE WITH: ./gradlew :plugins:repository-s3:integTestMinioRunner \\\r\n  -Dtests.seed=180F1CCF65203FAC \\\r\n  -Dtests.class=org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {yaml=repository_s3/20_repository_permanent_credentials/Get a non existing snapshot}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=lt-LT \\\r\n  -Dtests.timezone=Asia/Pontianak \\\r\n  -Dtests.rest.blacklist=repository_s3/30_repository_temporary_credentials/*,repository_s3/40_repository_ec2_credentials/*\r\n\r\nREPRODUCE WITH: ./gradlew :plugins:repository-s3:integTestMinioRunner \\\r\n  -Dtests.seed=180F1CCF65203FAC \\\r\n  -Dtests.class=org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {yaml=repository_s3/20_repository_permanent_credentials/Register a repository with a non existing client}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=lt-LT \\\r\n  -Dtests.timezone=Asia/Pontianak \\\r\n  -Dtests.rest.blacklist=repository_s3/30_repository_temporary_credentials/*,repository_s3/40_repository_ec2_credentials/*\r\n```\r\n\r\n```\r\n09:06:01 Suite: org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT\r\n09:06:01   1> [2018-07-19T14:05:56,864][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test {yaml=repository_s3/20_repository_permanent_credentials/Snapshot and Restore with repository-s3 using permanent credentials}]: before test\r\n09:06:01   1> [2018-07-19T14:05:56,967][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] initializing REST clients against [http://[::1]:40403]\r\n09:06:01   1> [2018-07-19T14:05:57,518][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] initializing yaml client, minimum es version: [6.4.0] master version: [6.4.0] hosts: [http://[::1]:40403]\r\n09:06:01   1> [2018-07-19T14:05:58,178][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] Stash dump on test failure [{\r\n09:06:01   1>   \"stash\" : {\r\n09:06:01   1>     \"body\" : {\r\n09:06:01   1>       \"error\" : {\r\n09:06:01   1>         \"root_cause\" : [\r\n09:06:01   1>           {\r\n09:06:01   1>             \"type\" : \"repository_verification_exception\",\r\n09:06:01   1>             \"reason\" : \"[repository_permanent] path [integration_test] is not accessible on master node\",\r\n09:06:01   1>             \"stack_trace\" : \"RepositoryVerificationException[[repository_permanent] path [integration_test] is not accessible on master node]; nested: IOException[Unable to upload object [integration_test/tests-Wze0pZCRRB6KLdsRZAwZOg/master.dat] using a single upload]; nested: SdkClientException[Unable to execute HTTP request: Connect to 127.0.0.1:60920 [/127.0.0.1] failed: Connection refused (Connection refused)]; nested: HttpHostConnectException[Connect to 127.0.0.1:60920 [/127.0.0.1] failed: Connection refused (Connection refused)]; nested: ConnectException[Connection refused (Connection refused)];\r\n09:06:01   1> \tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.startVerification(BlobStoreRepository.java:644)\r\n09:06:01   1> \tat org.elasticsearch.repositories.RepositoriesService.lambda$verifyRepository$2(RepositoriesService.java:218)\r\n09:06:01   1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:624)\r\n09:06:01   1> \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135)\r\n09:06:01   1> \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n09:06:01   1> \tat java.base/java.lang.Thread.run(Thread.java:844)\r\n09:06:01   1> Caused by: java.io.IOException: Unable to upload object [integration_test/tests-Wze0pZCRRB6KLdsRZAwZOg/master.dat] using a single upload\r\n09:06:01   1> \tat org.elasticsearch.repositories.s3.S3BlobContainer.executeSingleUpload(S3BlobContainer.java:199)\r\n09:06:01   1> \tat org.elasticsearch.repositories.s3.S3BlobContainer.lambda$writeBlob$2(S3BlobContainer.java:100)\r\n09:06:01   1> \tat java.base/java.security.AccessController.doPrivileged(Native Method)\r\n09:06:01   1> \tat org.elasticsearch.repositories.s3.SocketAccess.doPrivilegedIOException(SocketAccess.java:48)\r\n09:06:01   1> \tat org.elasticsearch.repositories.s3.S3BlobContainer.writeBlob(S3BlobContainer.java:98)\r\n09:06:01   1> \tat org.elasticsearch.common.blobstore.BlobContainer.writeBlobAtomic(BlobContainer.java:102)\r\n09:06:01   1> \tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.startVerification(BlobStoreRepository.java:639)\r\n09:06:01   1> \t... 5 more\r\n09:06:01   1> Caused by: com.amazonaws.SdkClientException: Unable to execute HTTP request: Connect to 127.0.0.1:60920 [/127.0.0.1] failed: Connection refused (Connection refused)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutor.handleRetryableException(AmazonHttpClient.java:1114)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeHelper(AmazonHttpClient.java:1064)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutor.doExecute(AmazonHttpClient.java:743)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeWithTimer(AmazonHttpClient.java:717)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutor.execute(AmazonHttpClient.java:699)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutor.access$500(AmazonHttpClient.java:667)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutionBuilderImpl.execute(AmazonHttpClient.java:649)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient.execute(AmazonHttpClient.java:513)\r\n09:06:01   1> \tat com.amazonaws.services.s3.AmazonS3Client.invoke(AmazonS3Client.java:4247)\r\n09:06:01   1> \tat com.amazonaws.services.s3.AmazonS3Client.invoke(AmazonS3Client.java:4194)\r\n09:06:01   1> \tat com.amazonaws.services.s3.AmazonS3Client.putObject(AmazonS3Client.java:1738)\r\n09:06:01   1> \tat org.elasticsearch.repositories.s3.S3BlobContainer.lambda$executeSingleUpload$7(S3BlobContainer.java:196)\r\n09:06:01   1> \tat org.elasticsearch.repositories.s3.SocketAccess.lambda$doPrivilegedVoid$0(SocketAccess.java:57)\r\n09:06:01   1> \tat java.base/java.security.AccessController.doPrivileged(Native Method)\r\n09:06:01   1> \tat org.elasticsearch.repositories.s3.SocketAccess.doPrivilegedVoid(SocketAccess.java:56)\r\n09:06:01   1> \tat org.elasticsearch.repositories.s3.S3BlobContainer.executeSingleUpload(S3BlobContainer.java:195)\r\n09:06:01   1> \t... 11 more\r\n09:06:01   1> Caused by: org.apache.http.conn.HttpHostConnectException: Connect to 127.0.0.1:60920 [/127.0.0.1] failed: Connection refused (Connection refused)\r\n09:06:01   1> \tat org.apache.http.impl.conn.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:158)\r\n09:06:01   1> \tat org.apache.http.impl.conn.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:353)\r\n09:06:01   1> \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n09:06:01   1> \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n09:06:01   1> \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n09:06:01   1> \tat java.base/java.lang.reflect.Method.invoke(Method.java:564)\r\n09:06:01   1> \tat com.amazonaws.http.conn.ClientConnectionManagerFactory$Handler.invoke(ClientConnectionManagerFactory.java:76)\r\n09:06:01   1> \tat com.amazonaws.http.conn.$Proxy28.connect(Unknown Source)\r\n09:06:01   1> \tat org.apache.http.impl.execchain.MainClientExec.establishRoute(MainClientExec.java:380)\r\n09:06:01   1> \tat org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:236)\r\n09:06:01   1> \tat org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:184)\r\n09:06:01   1> \tat org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:184)\r\n09:06:01   1> \tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)\r\n09:06:01   1> \tat org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:55)\r\n09:06:01   1> \tat com.amazonaws.http.apache.client.impl.SdkHttpClient.execute(SdkHttpClient.java:72)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeOneRequest(AmazonHttpClient.java:1236)\r\n09:06:01   1> \tat com.amazonaws.http.AmazonHttpClient$RequestExecutor.executeHelper(AmazonHttpClient.java:1056)\r\n09:06:01   1> \t... 25 more\r\n```","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}