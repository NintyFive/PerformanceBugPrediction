{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26601","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26601/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26601/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26601/events","html_url":"https://github.com/elastic/elasticsearch/issues/26601","id":257021918,"node_id":"MDU6SXNzdWUyNTcwMjE5MTg=","number":26601,"title":"Whitespace tokenizer splits at 255 characters by default","user":{"login":"quilin","id":5960226,"node_id":"MDQ6VXNlcjU5NjAyMjY=","avatar_url":"https://avatars3.githubusercontent.com/u/5960226?v=4","gravatar_id":"","url":"https://api.github.com/users/quilin","html_url":"https://github.com/quilin","followers_url":"https://api.github.com/users/quilin/followers","following_url":"https://api.github.com/users/quilin/following{/other_user}","gists_url":"https://api.github.com/users/quilin/gists{/gist_id}","starred_url":"https://api.github.com/users/quilin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/quilin/subscriptions","organizations_url":"https://api.github.com/users/quilin/orgs","repos_url":"https://api.github.com/users/quilin/repos","events_url":"https://api.github.com/users/quilin/events{/privacy}","received_events_url":"https://api.github.com/users/quilin/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":534335216,"node_id":"MDU6TGFiZWw1MzQzMzUyMTY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.4.0","name":"v5.4.0","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"assignees":[{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2017-09-12T12:15:56Z","updated_at":"2017-09-14T09:45:14Z","closed_at":"2017-09-14T09:45:14Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch Version: 5.4.0, Build: 780f8c4/2017-04-28T17:43:27.229Z, JVM: 1.8.0_131\r\n\r\njava version \"1.8.0_131\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_131-b11)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.131-b11, mixed mode)\r\n\r\nOS Name\tMicrosoft Windows 10 Enterprise\r\nVersion\t10.0.14393 Build 14393\r\nBut the issue seems to reporoduce on some Linux machine (in AWS) as well\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nThe false positive match against the analyzed field. Expected nothing to be found, but found a match instead.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Create the index\r\n  `curl -XPUT localhost:9200/test_index_bug {\"settings\":{\"analysis\":{\"analyzer\":{\"caseInsensitiveKeyAnalyzer\":{\"type\":\"custom\",\"filter\":[\"lowercase\"],\"tokenizer\":\"whitespace\"}}}},\"mappings\":{\"ric\":{\"properties\":{\"id\":{\"type\":\"integer\"},\"ricName\":{\"type\":\"text\",\"fields\":{\"keyword\":{\"type\":\"keyword\",\"ignore_above\":256},\"ricName\":{\"type\":\"text\",\"analyzer\":\"caseInsensitiveKeyAnalyzer\"}}},\"displayName\":{\"type\":\"text\",\"fields\":{\"keyword\":{\"type\":\"keyword\",\"ignore_above\":256},\"displayName\":{\"type\":\"text\",\"analyzer\":\"caseInsensitiveKeyAnalyzer\"}}},\"exchangeCode\":{\"type\":\"text\",\"fields\":{\"keyword\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"exchangeName\":{\"type\":\"text\",\"fields\":{\"keyword\":{\"type\":\"keyword\",\"ignore_above\":256}}},\"domain\":{\"type\":\"integer\"},\"peId\":{\"type\":\"integer\"},\"isAlias\":{\"type\":\"boolean\"},\"createdDate\":{\"type\":\"date\"},\"updatedDate\":{\"type\":\"date\"}}}}}`\r\n 2. Put the document\r\n  `curl -XPUT localhost:9200/test_index_bug/123 {\"id\":123,\"publicId\":\"F\",\"ricName\":\"F\",\"createdDate\":\"2017-09-12T11:54:51.1421471Z\",\"updatedDate\":\"2017-09-12T11:54:51.1421471Z\",\"domain\":123,\"displayName\":\"test\",\"exchangeNumber\":123,\"exchangeName\":\"test\",\"exchangeCode\":\"test\",\"peId\":123,\"isAlias\":false}`\r\n 3. Search for the document\r\n  `curl -XPOST localhost:9200/_search {\"size\":1,\"query\":{\"bool\":{\"must\":[{\"bool\":{\"should\":[{\"match\":{\"ricName.ricName\":{\"query\":\"dgsdlruityhaekljeha;izudyvklaejrbt09834576hgadagyhrtertkghsldkjrhtweiorugysdokljagvalkjdrthwieuartyad78z967agyhdajklskjrntjre.skdauygusldbnalwkeruty57840w67yrukshgdajklsghkdajghslkduayhtweuiry68593470498576wiuergпавыапргцыкше8рполдваяыловраолпдфлгвангшфщыгывнаолдыоамлсичрядлывороалфдцоукрегкшвщышгапниоладчитоваирыолфdhsgjsksrtsrtkdghkdhgkdhkdgkhaasadjlknknkjsgdnm,.sdagnn,mhjlkwerthjlksdgahjklyoiugadsgnm.,hjlkyoiudbnjgadkbkjgadbhkjadgshkjdaghjksdahgshdagjkshgkjahskjlhgakjshgakjsdgdshaglkjsdhgakjdshgakjdslgf\"}}}]}}]}}}`\r\n\r\nExpect nothing to be found, but instead, a hit with a single document is returned:\r\n\r\n  `{\r\n  \"took\": 1,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 1,\r\n    \"max_score\": 0.2876821,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"test_index_bug\",\r\n        \"_type\": \"ric\",\r\n        \"_id\": \"123\",\r\n        \"_score\": 0.2876821,\r\n        \"_source\": {\r\n          \"id\": 123,\r\n          \"publicId\": \"F\",\r\n          \"ricName\": \"F\",\r\n          \"createdDate\": \"2017-09-12T11:54:51.1421471Z\",\r\n          \"updatedDate\": \"2017-09-12T11:54:51.1421471Z\",\r\n          \"domain\": 123,\r\n          \"displayName\": \"test\",\r\n          \"exchangeNumber\": 123,\r\n          \"exchangeName\": \"test\",\r\n          \"exchangeCode\": \"test\",\r\n          \"peId\": 123,\r\n          \"isAlias\": false\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}`\r\n\r\nThe length of the query string is 511 symbols. If I change the length or replace the last letter (\"f\" for anything but \"F\"), the response is empty as expected.\r\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}