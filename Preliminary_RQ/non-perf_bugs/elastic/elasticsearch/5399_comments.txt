[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37408739","html_url":"https://github.com/elastic/elasticsearch/issues/5399#issuecomment-37408739","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5399","id":37408739,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NDA4NzM5","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-03-12T13:40:21Z","updated_at":"2014-03-12T13:57:26Z","author_association":"MEMBER","body":"What happens here is that the _parent mapping doesn't take the current type into account for the term filter. It simply takes the first mapping with parent it can find it prefixes the type and that is why the first term filter on _parent field works, but the second one doesn't.\n\nI think this behaviour should change? If the type is specifically set in the url, use that type. If multiple types are specified use the first type with parent field mapping and if no type is specified fall back to all types with a _parent field.\n\nAlso it is possible to not let ES automatically detect the parent type, but specify it specifically in the term filter as a prefix in the term filter, like this:\n\n```\nPOST /myindex/GrandChild/_search\n{\n  \"query\": {\n    \"term\": {\n      \"_parent\": \"Child#bob\"\n    }\n  }\n}\n```\n\nThis request does work correctly.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37409391","html_url":"https://github.com/elastic/elasticsearch/issues/5399#issuecomment-37409391","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5399","id":37409391,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NDA5Mzkx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-03-12T13:46:25Z","updated_at":"2014-03-12T13:46:25Z","author_association":"CONTRIBUTOR","body":"Ah OK.  Yes I agree it should change. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138816815","html_url":"https://github.com/elastic/elasticsearch/issues/5399#issuecomment-138816815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5399","id":138816815,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODgxNjgxNQ==","user":{"login":"kaliseo","id":1506320,"node_id":"MDQ6VXNlcjE1MDYzMjA=","avatar_url":"https://avatars2.githubusercontent.com/u/1506320?v=4","gravatar_id":"","url":"https://api.github.com/users/kaliseo","html_url":"https://github.com/kaliseo","followers_url":"https://api.github.com/users/kaliseo/followers","following_url":"https://api.github.com/users/kaliseo/following{/other_user}","gists_url":"https://api.github.com/users/kaliseo/gists{/gist_id}","starred_url":"https://api.github.com/users/kaliseo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaliseo/subscriptions","organizations_url":"https://api.github.com/users/kaliseo/orgs","repos_url":"https://api.github.com/users/kaliseo/repos","events_url":"https://api.github.com/users/kaliseo/events{/privacy}","received_events_url":"https://api.github.com/users/kaliseo/received_events","type":"User","site_admin":false},"created_at":"2015-09-09T07:57:12Z","updated_at":"2015-09-09T07:57:12Z","author_association":"NONE","body":"Ohhh !! Thanks a lot for this tip ! It helped me a lot !\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148080302","html_url":"https://github.com/elastic/elasticsearch/issues/5399#issuecomment-148080302","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5399","id":148080302,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODA4MDMwMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-10-14T15:12:48Z","updated_at":"2015-10-14T15:12:48Z","author_association":"CONTRIBUTOR","body":"Rethinking this..  The `has_parent` query does the right thing.  I think we should deprecate the use of the `_parent` field for search, unless something has changed in the new parent-child functionality in 2.0? /cc @martijnvg \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/156814603","html_url":"https://github.com/elastic/elasticsearch/issues/5399#issuecomment-156814603","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5399","id":156814603,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NjgxNDYwMw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-11-15T14:22:01Z","updated_at":"2015-11-15T14:22:01Z","author_association":"MEMBER","body":"Agreed, I think we should remove support to refer to the `_parent` field in the dsl. It allows us to clean things up a bit more (mapping code).\n\nThe only reason this field still exists is because the `_parent` lucene field is used in the fetch phase and get api to as source to include the parent id.\n\nThe pre 2.x parent/child join impl. relied on this field in the Lucene index, the 2.x parent/child join impl. doesn't use the `_parent` lucene field. The `_parent` mapping creates docvalues field for the join support depending on the name of the parent type.\n\nMy idea is (and was) to no longer use the `_parent` Lucene field and solely rely on the doc values fields for the join and retrieving the parent id in the fetch phase. \n\nI think there are still use cases for being able to return all child docs with a certain parent id, but I think we can create a separate query for it that uses the doc values fields? (instead of just using `_parent` field in queries like we do today)\n\nA while back I started to do this for a bug fix in the `_parent` mapping for one of the 2.0 betas/rcs. Code for relying on doc values join fields for the fetch phase: https://github.com/martijnvg/elasticsearch/commit/26e2e5d95d2b3a3f778a759ed7a7ea2de9b09842#diff-b633d10e30dc0e0a476eb1e1a40736b7R41\n\nAnd code for a `_parent_id` query to retrieve docs with a certain parent id value:\nhttps://github.com/martijnvg/elasticsearch/commit/26e2e5d95d2b3a3f778a759ed7a7ea2de9b09842#diff-2be3c59879d9d984bd9a33fc42c1c940R32\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169039686","html_url":"https://github.com/elastic/elasticsearch/issues/5399#issuecomment-169039686","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5399","id":169039686,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTAzOTY4Ng==","user":{"login":"timeu","id":374296,"node_id":"MDQ6VXNlcjM3NDI5Ng==","avatar_url":"https://avatars2.githubusercontent.com/u/374296?v=4","gravatar_id":"","url":"https://api.github.com/users/timeu","html_url":"https://github.com/timeu","followers_url":"https://api.github.com/users/timeu/followers","following_url":"https://api.github.com/users/timeu/following{/other_user}","gists_url":"https://api.github.com/users/timeu/gists{/gist_id}","starred_url":"https://api.github.com/users/timeu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timeu/subscriptions","organizations_url":"https://api.github.com/users/timeu/orgs","repos_url":"https://api.github.com/users/timeu/repos","events_url":"https://api.github.com/users/timeu/events{/privacy}","received_events_url":"https://api.github.com/users/timeu/received_events","type":"User","site_admin":false},"created_at":"2016-01-05T15:46:02Z","updated_at":"2016-01-05T15:46:02Z","author_association":"NONE","body":"I ran into this issue today when I upgraded from 1.7.3 to 2.1.1. \nI need to fix the queries in my application code. The question if I should switch to the `has_parent`  query or just use the workaround with `\"_parent\":\"type#id\"` ? As far as I understand it, the use of `_parent` in a query will be deprecated right ? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/173554629","html_url":"https://github.com/elastic/elasticsearch/issues/5399#issuecomment-173554629","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5399","id":173554629,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzU1NDYyOQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-01-21T12:19:59Z","updated_at":"2016-01-21T12:19:59Z","author_association":"MEMBER","body":"Closing this issue as this has been fixed as part of #16045. From 3.0 there will be a `parent_id` query in the dsl that allows to easily query for child docs that refer to a specific parent id.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/173554789","html_url":"https://github.com/elastic/elasticsearch/issues/5399#issuecomment-173554789","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5399","id":173554789,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzU1NDc4OQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-01-21T12:20:58Z","updated_at":"2016-01-21T12:20:58Z","author_association":"MEMBER","body":"@timeu The workaround you mention will remain to work in all 2.x versions. From 3.0 you should switch to the `parent_id` query instead.\n","performed_via_github_app":null}]