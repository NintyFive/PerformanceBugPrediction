[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3124089","html_url":"https://github.com/elastic/elasticsearch/issues/1536#issuecomment-3124089","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1536","id":3124089,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjQwODk=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2011-12-13T15:11:55Z","updated_at":"2011-12-13T15:11:55Z","author_association":"MEMBER","body":"Does the gist recreates the failure each time? I used the gist on a fresh 0.18.5 and it works well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3124814","html_url":"https://github.com/elastic/elasticsearch/issues/1536#issuecomment-3124814","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1536","id":3124814,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjQ4MTQ=","user":{"login":"Alex-Ikanow","id":851950,"node_id":"MDQ6VXNlcjg1MTk1MA==","avatar_url":"https://avatars2.githubusercontent.com/u/851950?v=4","gravatar_id":"","url":"https://api.github.com/users/Alex-Ikanow","html_url":"https://github.com/Alex-Ikanow","followers_url":"https://api.github.com/users/Alex-Ikanow/followers","following_url":"https://api.github.com/users/Alex-Ikanow/following{/other_user}","gists_url":"https://api.github.com/users/Alex-Ikanow/gists{/gist_id}","starred_url":"https://api.github.com/users/Alex-Ikanow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Alex-Ikanow/subscriptions","organizations_url":"https://api.github.com/users/Alex-Ikanow/orgs","repos_url":"https://api.github.com/users/Alex-Ikanow/repos","events_url":"https://api.github.com/users/Alex-Ikanow/events{/privacy}","received_events_url":"https://api.github.com/users/Alex-Ikanow/received_events","type":"User","site_admin":false},"created_at":"2011-12-13T15:57:55Z","updated_at":"2011-12-13T15:58:22Z","author_association":"NONE","body":"Ha, I figured it was more likely to be a bit random vs having \"nested\"  in the name!\nMy steps were:\n- upgrade index from 0.17.9 to 0.18.5\n- delete random indexes from previous debug (different names)\n- run above test (\"nested\" fails, \"test_type\" works)\n- delete indexes\n- rerun above test, same result\n\nSo on a sample of 2, yes! I'll fire up my VM and try a few more samples/deleting ES and rebuilding from scratch.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3125889","html_url":"https://github.com/elastic/elasticsearch/issues/1536#issuecomment-3125889","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1536","id":3125889,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjU4ODk=","user":{"login":"Alex-Ikanow","id":851950,"node_id":"MDQ6VXNlcjg1MTk1MA==","avatar_url":"https://avatars2.githubusercontent.com/u/851950?v=4","gravatar_id":"","url":"https://api.github.com/users/Alex-Ikanow","html_url":"https://github.com/Alex-Ikanow","followers_url":"https://api.github.com/users/Alex-Ikanow/followers","following_url":"https://api.github.com/users/Alex-Ikanow/following{/other_user}","gists_url":"https://api.github.com/users/Alex-Ikanow/gists{/gist_id}","starred_url":"https://api.github.com/users/Alex-Ikanow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Alex-Ikanow/subscriptions","organizations_url":"https://api.github.com/users/Alex-Ikanow/orgs","repos_url":"https://api.github.com/users/Alex-Ikanow/repos","events_url":"https://api.github.com/users/Alex-Ikanow/events{/privacy}","received_events_url":"https://api.github.com/users/Alex-Ikanow/received_events","type":"User","site_admin":false},"created_at":"2011-12-13T17:07:40Z","updated_at":"2011-12-13T17:07:40Z","author_association":"NONE","body":"Of course, now my super simple gist works fine :(\n\nHmm, interestingly I'm not the first person to have this problem happen consistently and then disappear the next day....\n\nhttps://github.com/elasticsearch/elasticsearch/issues/1263 (vanished on all versions after installing a new version; some other dude had a different but similar NPE still open?)\nhttps://github.com/elasticsearch/elasticsearch/issues/1510 (still open, you couldn't reproduce)\nhttp://pastebin.com/8rxqY954 (couldn't find the parent issue - the code for this one was uncannily similar to my report)\n\nUp to you whether to keep this one open or close it (or join it?)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3126756","html_url":"https://github.com/elastic/elasticsearch/issues/1536#issuecomment-3126756","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1536","id":3126756,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjY3NTY=","user":{"login":"Alex-Ikanow","id":851950,"node_id":"MDQ6VXNlcjg1MTk1MA==","avatar_url":"https://avatars2.githubusercontent.com/u/851950?v=4","gravatar_id":"","url":"https://api.github.com/users/Alex-Ikanow","html_url":"https://github.com/Alex-Ikanow","followers_url":"https://api.github.com/users/Alex-Ikanow/followers","following_url":"https://api.github.com/users/Alex-Ikanow/following{/other_user}","gists_url":"https://api.github.com/users/Alex-Ikanow/gists{/gist_id}","starred_url":"https://api.github.com/users/Alex-Ikanow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Alex-Ikanow/subscriptions","organizations_url":"https://api.github.com/users/Alex-Ikanow/orgs","repos_url":"https://api.github.com/users/Alex-Ikanow/repos","events_url":"https://api.github.com/users/Alex-Ikanow/events{/privacy}","received_events_url":"https://api.github.com/users/Alex-Ikanow/received_events","type":"User","site_admin":false},"created_at":"2011-12-13T18:02:02Z","updated_at":"2011-12-13T18:02:02Z","author_association":"NONE","body":"FWIW I just had a look at https://github.com/elasticsearch/elasticsearch/blob/a8fd2d48b8f3f17d68ed27c3104e2c9e2eb6cc9c/src/main/java/org/elasticsearch/index/query/NestedQueryParser.java and (apologies for super naive probably dumb question...)\n\nIs it not possible to get \"stuck\" with a LateBindingParentFilter with \"filter\" member == null if you exception out in between lines 66 and 124? (ie usAsParentFilter gets created and set in the threadlocal on line 64, but doesn't have its filter parameter set until 124)\n\n(and obviously the NPEs reported above are all caused by LateBindingParentFilter::filter not being set, and this would be semi consistent with the intermittent reproducability, you'd only see the problem if you made an invalid query at some point)\n\nI'll see if I can reproduce that...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3126815","html_url":"https://github.com/elastic/elasticsearch/issues/1536#issuecomment-3126815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1536","id":3126815,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjY4MTU=","user":{"login":"Alex-Ikanow","id":851950,"node_id":"MDQ6VXNlcjg1MTk1MA==","avatar_url":"https://avatars2.githubusercontent.com/u/851950?v=4","gravatar_id":"","url":"https://api.github.com/users/Alex-Ikanow","html_url":"https://github.com/Alex-Ikanow","followers_url":"https://api.github.com/users/Alex-Ikanow/followers","following_url":"https://api.github.com/users/Alex-Ikanow/following{/other_user}","gists_url":"https://api.github.com/users/Alex-Ikanow/gists{/gist_id}","starred_url":"https://api.github.com/users/Alex-Ikanow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Alex-Ikanow/subscriptions","organizations_url":"https://api.github.com/users/Alex-Ikanow/orgs","repos_url":"https://api.github.com/users/Alex-Ikanow/repos","events_url":"https://api.github.com/users/Alex-Ikanow/events{/privacy}","received_events_url":"https://api.github.com/users/Alex-Ikanow/received_events","type":"User","site_admin":false},"created_at":"2011-12-13T18:04:52Z","updated_at":"2011-12-13T18:04:52Z","author_association":"NONE","body":"Bingo!\n\nTo reproduce the error in my gist first do:\n\ncurl -XGET 'http://localhost:9200/nested_test/nested/_search?pretty=true' -d'{\"query\":{\"nested\": { \"path\":\"obj1\"}}}}'\n\nthen subsequent valid calls, eg:\n\ncurl -XGET 'http://localhost:9200/nested_test/nested/_search?pretty=true' -d'{\"query\":{\"nested\": { \"path\":\"obj1\", \"query\": { \"match_all\":{}}}}}'\n\nWill return the error in the various error reports\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3133617","html_url":"https://github.com/elastic/elasticsearch/issues/1536#issuecomment-3133617","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1536","id":3133617,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzM2MTc=","user":{"login":"deverton","id":287143,"node_id":"MDQ6VXNlcjI4NzE0Mw==","avatar_url":"https://avatars1.githubusercontent.com/u/287143?v=4","gravatar_id":"","url":"https://api.github.com/users/deverton","html_url":"https://github.com/deverton","followers_url":"https://api.github.com/users/deverton/followers","following_url":"https://api.github.com/users/deverton/following{/other_user}","gists_url":"https://api.github.com/users/deverton/gists{/gist_id}","starred_url":"https://api.github.com/users/deverton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deverton/subscriptions","organizations_url":"https://api.github.com/users/deverton/orgs","repos_url":"https://api.github.com/users/deverton/repos","events_url":"https://api.github.com/users/deverton/events{/privacy}","received_events_url":"https://api.github.com/users/deverton/received_events","type":"User","site_admin":false},"created_at":"2011-12-14T00:49:56Z","updated_at":"2011-12-14T00:49:56Z","author_association":"CONTRIBUTOR","body":"I'm some other dude :) I could never get it down to a test case so I didn't open a new bug. Following the steps in your last comment generates the error every time for me. The exact steps are in https://gist.github.com/1474679 I just pulled it in to a simple shell script\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3139201","html_url":"https://github.com/elastic/elasticsearch/issues/1536#issuecomment-3139201","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1536","id":3139201,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzkyMDE=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2011-12-14T13:07:09Z","updated_at":"2011-12-14T13:07:09Z","author_association":"MEMBER","body":"Heya, great catch and simple recreation!. Yes, the problem was when an invalid nested query was sent, things were not being cleared up properly on the relevant thread that executed the search, which left it \"dirty\", a fix is coming shortly.\n","performed_via_github_app":null}]