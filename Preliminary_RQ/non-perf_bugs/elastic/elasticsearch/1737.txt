{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1737","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1737/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1737/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1737/events","html_url":"https://github.com/elastic/elasticsearch/issues/1737","id":3375242,"node_id":"MDU6SXNzdWUzMzc1MjQy","number":1737,"title":"sorting failed when same name under different types with different mapping","user":{"login":"medcl","id":64487,"node_id":"MDQ6VXNlcjY0NDg3","avatar_url":"https://avatars0.githubusercontent.com/u/64487?v=4","gravatar_id":"","url":"https://api.github.com/users/medcl","html_url":"https://github.com/medcl","followers_url":"https://api.github.com/users/medcl/followers","following_url":"https://api.github.com/users/medcl/following{/other_user}","gists_url":"https://api.github.com/users/medcl/gists{/gist_id}","starred_url":"https://api.github.com/users/medcl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/medcl/subscriptions","organizations_url":"https://api.github.com/users/medcl/orgs","repos_url":"https://api.github.com/users/medcl/repos","events_url":"https://api.github.com/users/medcl/events{/privacy}","received_events_url":"https://api.github.com/users/medcl/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2012-02-24T16:39:50Z","updated_at":"2014-07-08T14:25:14Z","closed_at":"2014-07-08T14:25:14Z","author_association":"MEMBER","active_lock_reason":null,"body":"if there are same fieldname with different data type in different type,\nfor example,datetime and string,\ntype_a have field:time,data type is date\ntype_b have field:time,data type is string,(this type may be created dynamic)\n\nif i want to query against type_a use this query:\nhttp://localhost:9200/index/type_a/_search?q=*&sort=time\n\nperhaps,you may get  this error(not always,occasional after a restart)\n\n{\"error\":\"SearchPhaseExecutionException[Failed to execute phase [query], total failure; shardFailures {[Pqdw_LAFSbOfyo9yVU9aaw][index][0]: QueryPhaseExecutionException[[index][0]: query[ConstantScore(_:_)],from[0],size[10],sort[<custom:\\\"time\\\": org.elasticsearch.index.field.data.strings.StringFieldDataType$1@1693f17f>]: Query Failed [Failed to execute main query]]; nested: IOException[Can't sort on string types with more than one value per doc, or more than one token per field]; }{[Pqdw_LAFSbOfyo9yVU9aaw][index][1]: QueryPhaseExecutionException[[index][1]: query[ConstantScore(_:_)],from[0],size[10],sort[<custom:\\\"time\\\": org.elasticsearch.index.field.data.strings.StringFieldDataType$1@3a18c8ca>]: Query Failed [Failed to execute main query]]; nested: IOException[Can't sort on string types with more than one value per doc, or more than one token per field]; }{[Pqdw_LAFSbOfyo9yVU9aaw][xxx][2]: QueryPhaseExecutionException[[index][2]: query[ConstantScore(_:_)],from[0],size[10],sort[<custom:\\\"time\\\": org.elasticsearch.index.field.data.strings.StringFieldDataType$1@31266392>]: Query Failed [Failed to execute main query]]; nested: IOException[Can't sort on string types with more than one value per doc, or more than one token per field]; }]\",\"status\":500}\n\nthis line:\nhttps://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/search/sort/SortParseElement.java#L159\nit returned the wrong FieldMapper,it should be \"LongFieldMapper\" but actually returned is :\"StringFieldMapper\",did'nt load the right data,so sorting failed ,\nwith the given parameter \"fieldName\",it didn't know which mapping will be used,and elasticsearch should be more smart,to choose the right mapping,in this case,if we have explicit specify the type(in url:http://localhost:9200/index/type_a/_search),es can select the mapping within type:type_a.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}