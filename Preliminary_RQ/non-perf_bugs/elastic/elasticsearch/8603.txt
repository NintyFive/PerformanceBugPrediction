{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8603","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8603/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8603/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8603/events","html_url":"https://github.com/elastic/elasticsearch/issues/8603","id":49754103,"node_id":"MDU6SXNzdWU0OTc1NDEwMw==","number":8603,"title":"Implement default and more granular logging on deleted files","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2014-11-21T22:05:12Z","updated_at":"2014-11-26T13:16:37Z","closed_at":"2014-11-26T10:10:52Z","author_association":"MEMBER","active_lock_reason":null,"body":"We have seen various occurrences of shard initialization failures due to file not found exceptions (potentially corrupted indices), eg. \n\n```\n[2014-11-19 19:59:06,126][WARN ][index.store              ] [node_name] [index_name][3] Can't open file to read checksums\njava.io.FileNotFoundException: No such file [_ym1.fdt]\n    at org.elasticsearch.index.store.DistributorDirectory.getDirectory(DistributorDirectory.java:176)\n    at org.elasticsearch.index.store.DistributorDirectory.getDirectory(DistributorDirectory.java:144)\n    at org.elasticsearch.index.store.DistributorDirectory.openInput(DistributorDirectory.java:130)\n    at org.elasticsearch.index.store.Store$MetadataSnapshot.checksumFromLuceneFile(Store.java:542)\n    at org.elasticsearch.index.store.Store$MetadataSnapshot.buildMetadata(Store.java:480)\n    at org.elasticsearch.index.store.Store$MetadataSnapshot.<init>(Store.java:456)\n    at org.elasticsearch.index.store.Store.getMetadata(Store.java:154)\n    at org.elasticsearch.index.store.Store.getMetadata(Store.java:143)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.applyInitializingShard(IndicesClusterStateService.java:728)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.applyNewOrUpdatedShards(IndicesClusterStateService.java:580)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.clusterChanged(IndicesClusterStateService.java:184)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:444)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:153)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n    at java.lang.Thread.run(Unknown Source)\n```\n\nExample other files affected:\njava.io.FileNotFoundException: No such file [_ym1_es090_0.blm]\njava.io.FileNotFoundException: No such file [_zrj_Lucene49_0.dvd]\njava.io.FileNotFoundException: No such file [_yie_es090_0.pos]\n\nThe default logging does not indicate when files are deleted by Lucene or Elasticsearch.  Without this information, it will be difficult to speculate on whether the missing file exceptions are due to intentional deletes by Lucene or ES, or if there is a potential file system issue.\n\n@rmuir mentioned that Lucene already provides a way to get \"info stream\" of deleted files\nbut logging for this is not enabled by default in ES and also not as granular/targeted as desired for debugging this type of situation.\n\nSo this is a request to improve our default logging on deleted files, eg.\n- Provide a way to tap into Lucene's info stream specific to the deletion of files\n- Provide a similar logging facility for the ES side of things when we delete non-Lucene managed files like .blm, etc..\n","closed_by":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"performed_via_github_app":null}