{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8937","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8937/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8937/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8937/events","html_url":"https://github.com/elastic/elasticsearch/issues/8937","id":51857164,"node_id":"MDU6SXNzdWU1MTg1NzE2NA==","number":8937,"title":"Completion type mapping is not idempotent","user":{"login":"missinglink","id":738069,"node_id":"MDQ6VXNlcjczODA2OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/738069?v=4","gravatar_id":"","url":"https://api.github.com/users/missinglink","html_url":"https://github.com/missinglink","followers_url":"https://api.github.com/users/missinglink/followers","following_url":"https://api.github.com/users/missinglink/following{/other_user}","gists_url":"https://api.github.com/users/missinglink/gists{/gist_id}","starred_url":"https://api.github.com/users/missinglink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/missinglink/subscriptions","organizations_url":"https://api.github.com/users/missinglink/orgs","repos_url":"https://api.github.com/users/missinglink/repos","events_url":"https://api.github.com/users/missinglink/events{/privacy}","received_events_url":"https://api.github.com/users/missinglink/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"assignees":[{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2014-12-12T21:50:09Z","updated_at":"2015-04-15T16:02:22Z","closed_at":"2015-04-15T16:02:20Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Completion mapping is not idempotent in the same way other field types are, probably due to the internal re-ordering of the `precision` array.\n\nIn the example below you can see that updating the mapping twice causes an error, if you start afresh and use the `precision` values `[ 1,2,3 ]` the issue goes away.\n\n**Note** when you `PUT` the mapping as below and then `GET` it back you'll notice the ordering of the precision array is now `[2,3,1,4]`.\n\n``` bash\n#!/bin/bash\n\n################################################\n# Completion Mapping Idempotence\n################################################\n\nES='localhost:9200';\n\n# drop/create index\ncurl -s -XDELETE \"$ES/testcase?pretty=true\" >/dev/null;\ncurl -s -XPUT \"$ES/testcase?pretty=true\" >/dev/null;\n\n# update mapping\nupdate_mapping() {\n  curl -s -XPUT \"$ES/testcase/_mapping/mytype?pretty=true\" -d '\n  {\n     \"properties\": {\n        \"suggest\": {\n           \"type\": \"completion\",\n           \"context\": {\n              \"location\": {\n                 \"type\": \"geo\",\n                 \"precision\": [ 1, 2, 3, 4 ]\n              }\n           }\n        }\n     }\n  }';\n}\n\nupdate_mapping;\n# \"acknowledged\" : true\n\nupdate_mapping;\n# \"error\" : \"MergeMappingException[Merge failed with failures {[mapper [suggest] has different 'context_mapping' values]}]\"\n\ncurl -s \"$ES/testcase/mytype/_mapping?pretty=true\" | grep precision\n# \"precision\" : [ 2, 3, 1, 4 ]\n```\n\ncc/ @markharwood as it may be related to https://github.com/elasticsearch/elasticsearch/commit/c0aef4adc4ffaf791ed9a42864cc578b7dc50ffc and @areek as it relates to context suggesters\n","closed_by":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}