{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19829","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19829/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19829/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19829/events","html_url":"https://github.com/elastic/elasticsearch/issues/19829","id":169617854,"node_id":"MDU6SXNzdWUxNjk2MTc4NTQ=","number":19829,"title":"Elasticsearch fails to shutdown, blocked by ","user":{"login":"gehel","id":1415765,"node_id":"MDQ6VXNlcjE0MTU3NjU=","avatar_url":"https://avatars1.githubusercontent.com/u/1415765?v=4","gravatar_id":"","url":"https://api.github.com/users/gehel","html_url":"https://github.com/gehel","followers_url":"https://api.github.com/users/gehel/followers","following_url":"https://api.github.com/users/gehel/following{/other_user}","gists_url":"https://api.github.com/users/gehel/gists{/gist_id}","starred_url":"https://api.github.com/users/gehel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gehel/subscriptions","organizations_url":"https://api.github.com/users/gehel/orgs","repos_url":"https://api.github.com/users/gehel/repos","events_url":"https://api.github.com/users/gehel/events{/privacy}","received_events_url":"https://api.github.com/users/gehel/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"assignees":[{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false}],"milestone":null,"comments":22,"created_at":"2016-08-05T14:19:20Z","updated_at":"2016-08-18T21:45:02Z","closed_at":"2016-08-18T21:45:02Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.3\n\n**JVM version**:\n\n```\n$ java -version\njava version \"1.7.0_111\"\nOpenJDK Runtime Environment (IcedTea 2.6.7) (7u111-2.6.7-1~deb8u1)\nOpenJDK 64-Bit Server VM (build 24.111-b01, mixed mode)\n```\n\n**OS version**: Debian Jessie (8.2)\n\n**Description of the problem including expected versus actual behavior**:\n\nWhen doing a routine cluster restart, one of our elasticsearch node refused to shutdown (`sudo service elasticsearch restart`) for a long time. We ended up doing a `kill -9`. Taking [thread dumps](https://gist.github.com/gehel/3e5bab4228d40670afe99d428d18faae), we see:\n- The shutdown handler is blocked, waiting on `Thread.join()`, letting me think there is a non background thread still doing work.\n- It seems that the only activity left was a [lucene merge that was in progress](https://gist.github.com/gehel/3e5bab4228d40670afe99d428d18faae#file-threaddump-elasticsearch-L213).\n- This looks very similar to #12941.\n\n**Steps to reproduce**:\nWe don't know how to reproduce this in a reliable way. This seems to be related to shutting down elasticsearch while a merge is in progress\n\n**Provide logs (if relevant)**:\n- Thread dumps: https://gist.github.com/gehel/3e5bab4228d40670afe99d428d18faae\n","closed_by":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"performed_via_github_app":null}