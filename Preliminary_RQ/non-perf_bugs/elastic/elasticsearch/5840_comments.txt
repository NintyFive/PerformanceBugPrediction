[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40682877","html_url":"https://github.com/elastic/elasticsearch/issues/5840#issuecomment-40682877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5840","id":40682877,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjgyODc3","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-04-17T05:40:43Z","updated_at":"2014-04-17T05:40:43Z","author_association":"MEMBER","body":"Thanks for reporting this bug! This bugs manifests if `filter`, `query`, `facet` or `aggs` is specified in the percolate request. \n\nWhen any of the above features is used, the persisted queries stored as documents in the shard (Lucene index) are used. Deleted documents usually stay around on disk before being being purged.  \nThe issue here is that percolator isn't taking deleted docs into account, which it should. This is why the old version of your percolator query with id `query1` is also reported as a match, which a duplicate.\n","performed_via_github_app":null}]