{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18328","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18328/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18328/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18328/events","html_url":"https://github.com/elastic/elasticsearch/issues/18328","id":154706756,"node_id":"MDU6SXNzdWUxNTQ3MDY3NTY=","number":18328,"title":"`DateTimeZone.forID` doesn't work in ES 2.x","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-05-13T13:02:49Z","updated_at":"2016-05-16T16:49:25Z","closed_at":"2016-05-13T13:05:57Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version**: 2.x\n\n**JVM version**: 1.8\n\n**OS version**: Any\n\n**The following works in 1.x**:\n\n```\nPUT try\n{\n  \"mappings\": {\n    \"type\": {\n      \"properties\": {\n        \"time\": {\n          \"type\": \"date\"\n        }\n      }\n    }\n  }\n}\n\nPOST try/type\n{\n  \"time\": \"2016-05-09T14:33:36.202Z\"\n}\n\nPOST try/_search\n{\n  \"script_fields\": {\n    \"FIELD\": {\n      \"script\": \"doc['time'].date.setZone(DateTimeZone.forID('America/New_York')); return doc['time'].date;\"\n    }\n  }\n}\n```\n\n**The following DOES NOT work in 2.x**\n\n```\nPUT try\n{\n  \"mappings\": {\n    \"type\": {\n      \"properties\": {\n        \"time\": {\n          \"type\": \"date\"\n        }\n      }\n    }\n  }\n}\n\nPOST try/type\n{\n  \"time\": \"2016-05-09T14:33:36.202Z\"\n}\n\nPOST try/_search\n{\n  \"fields\": [],\n  \"script_fields\": {\n    \"FIELD\": {\n      \"script\": {\n        \"inline\": \"doc['time'].date.setZone(DateTimeZone.forID('America/New_York'))\"\n      }\n    }\n  }\n}\n```\n\nThe error is the following:\n\n```\n{\n  \"took\": 429,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 4,\n    \"failed\": 1,\n    \"failures\": [\n      {\n        \"shard\": 4,\n        \"index\": \"try\",\n        \"node\": \"YY36CprdRhq_oWPHloHqOA\",\n        \"reason\": {\n          \"type\": \"script_exception\",\n          \"reason\": \"failed to run inline script [doc['time'].date.setZone(DateTimeZone.forID('America/New_York'))] using lang [groovy]\",\n          \"caused_by\": {\n            \"type\": \"illegal_argument_exception\",\n            \"reason\": \"The datetime zone id 'America/New_York' is not recognised\"\n          }\n        }\n      }\n    ]\n  },\n  \"hits\": {\n    \"total\": 1,\n    \"max_score\": 1,\n    \"hits\": []\n  }\n}\n```\n\nIn the logs, i see the following:\n\n```\n[2016-05-13 10:02:00,471][DEBUG][action.search            ] [Karl Lykos] [4] Failed to execute fetch phase\nRemoteTransportException[[Karl Lykos][127.0.0.1:9300][indices:data/read/search[phase/fetch/id]]]; nested: ScriptException[failed to run inline script [doc['time'].date.setZone(DateTimeZone.forID('America/New_York'))] using lang [groovy]]; nested: IllegalArgumentException[The datetime zone id 'America/New_York' is not recognised];\nCaused by: ScriptException[failed to run inline script [doc['time'].date.setZone(DateTimeZone.forID('America/New_York'))] using lang [groovy]]; nested: IllegalArgumentException[The datetime zone id 'America/New_York' is not recognised];\n    at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:320)\n    at org.elasticsearch.search.fetch.script.ScriptFieldsFetchSubPhase.hitExecute(ScriptFieldsFetchSubPhase.java:85)\n    at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:188)\n    at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:592)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$FetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:408)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$FetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:405)\n    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.IllegalArgumentException: The datetime zone id 'America/New_York' is not recognised\n    at org.joda.time.DateTimeZone.forID(DateTimeZone.java:229)\n    at org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:228)\n    at 5b2c7c46fa5b2546451451ee1ff497b431ee701d.run(5b2c7c46fa5b2546451451ee1ff497b431ee701d:1)\n    at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript$1.run(GroovyScriptEngineService.java:313)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:310)\n    ... 12 more\n```\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}