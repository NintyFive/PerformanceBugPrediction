{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33185","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33185/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33185/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33185/events","html_url":"https://github.com/elastic/elasticsearch/issues/33185","id":354426527,"node_id":"MDU6SXNzdWUzNTQ0MjY1Mjc=","number":33185,"title":"Watcher: Mysterious rolling upgrade failure","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":14,"created_at":"2018-08-27T18:29:29Z","updated_at":"2020-02-21T06:31:00Z","closed_at":"2020-02-21T06:31:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"[This](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/6925/console) rolling upgrade build failed fairly mysteriously. This is what the failure looks like:\r\n\r\n```\r\n15:24:46   1> [2018-08-26T15:24:37,459][INFO ][o.e.u.UpgradeClusterClientYamlTestSuiteIT] [test] Stash dump on test failure [{\r\n15:24:46   1>   \"stash\" : {\r\n15:24:46   1>     \"record_id\" : \"my_watch_0be15ae1-d0c1-4516-b2fc-7291a51c00a6-2018-08-26T15:24:37.281Z\",\r\n15:24:46   1>     \"body\" : {\r\n15:24:46   1>       \"_id\" : \"my_watch_0be15ae1-d0c1-4516-b2fc-7291a51c00a6-2018-08-26T15:24:37.281Z\",\r\n15:24:46   1>       \"watch_record\" : {\r\n15:24:46   1>         \"watch_id\" : \"my_watch\",\r\n15:24:46   1>         \"node\" : \"j6O-Ii5MRcuZismjV2mJPA\",\r\n15:24:46   1>         \"state\" : \"failed\",\r\n15:24:46   1>         \"user\" : \"test_user\",\r\n15:24:46   1>         \"status\" : {\r\n15:24:46   1>           \"state\" : {\r\n15:24:46   1>             \"active\" : true,\r\n15:24:46   1>             \"timestamp\" : \"2018-08-26T15:24:36.992Z\"\r\n15:24:46   1>           },\r\n15:24:46   1>           \"actions\" : {\r\n15:24:46   1>             \"logging\" : {\r\n15:24:46   1>               \"ack\" : {\r\n15:24:46   1>                 \"timestamp\" : \"2018-08-26T15:24:36.992Z\",\r\n15:24:46   1>                 \"state\" : \"awaits_successful_execution\"\r\n15:24:46   1>               }\r\n15:24:46   1>             }\r\n15:24:46   1>           },\r\n15:24:46   1>           \"execution_state\" : \"failed\",\r\n15:24:46   1>           \"version\" : 1\r\n15:24:46   1>         },\r\n15:24:46   1>         \"trigger_event\" : {\r\n15:24:46   1>           \"type\" : \"manual\",\r\n15:24:46   1>           \"triggered_time\" : \"2018-08-26T15:24:37.279Z\",\r\n15:24:46   1>           \"manual\" : {\r\n15:24:46   1>             \"schedule\" : {\r\n15:24:46   1>               \"scheduled_time\" : \"2018-08-26T15:24:37.279Z\"\r\n15:24:46   1>             }\r\n15:24:46   1>           }\r\n15:24:46   1>         },\r\n15:24:46   1>         \"input\" : {\r\n15:24:46   1>           \"simple\" : { }\r\n15:24:46   1>         },\r\n15:24:46   1>         \"condition\" : {\r\n15:24:46   1>           \"always\" : { }\r\n15:24:46   1>         },\r\n15:24:46   1>         \"result\" : {\r\n15:24:46   1>           \"execution_time\" : \"2018-08-26T15:24:37.281Z\",\r\n15:24:46   1>           \"execution_duration\" : 1535297077283,\r\n15:24:46   1>           \"actions\" : [ ]\r\n15:24:46   1>         },\r\n15:24:46   1>         \"exception\" : {\r\n15:24:46   1>           \"type\" : \"illegal_state_exception\",\r\n15:24:46   1>           \"reason\" : \"could not register execution [my_watch]. current executions are sealed and forbid registrations of additional executions.\"\r\n15:24:46   1>         }\r\n15:24:46   1>       }\r\n15:24:46   1>     }\r\n15:24:46   1>   }\r\n15:24:46   1> }]\r\n15:24:46   1> [2018-08-26T15:24:37,502][INFO ][o.e.u.UpgradeClusterClientYamlTestSuiteIT] [test] [p0=old_cluster/60_watcher/CRUD watch APIs] after test\r\n15:24:46 FAILURE 0.96s | UpgradeClusterClientYamlTestSuiteIT.test {p0=old_cluster/60_watcher/CRUD watch APIs} <<< FAILURES!\r\n15:24:46    > Throwable #1: java.lang.AssertionError: Failure at [old_cluster/60_watcher:43]: watch_record.state didn't match expected value:\r\n15:24:46    >             watch_record.state: expected [executed] but was [failed]\r\n```\r\n\r\nThis is in the \"old\" cluster so the cluster state is empty, but we still get an error as though the watch was running.","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}