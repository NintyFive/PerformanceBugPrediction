[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/481159282","html_url":"https://github.com/elastic/elasticsearch/issues/40998#issuecomment-481159282","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40998","id":481159282,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MTE1OTI4Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-04-09T08:41:40Z","updated_at":"2019-04-09T08:41:40Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/481162619","html_url":"https://github.com/elastic/elasticsearch/issues/40998#issuecomment-481162619","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40998","id":481162619,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MTE2MjYxOQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-04-09T08:51:07Z","updated_at":"2019-04-09T08:51:07Z","author_association":"CONTRIBUTOR","body":"My test against 7.0.0-rc1 was flawed, sorry. I tried again and it was rejected as expected, but I got a different rejection message:\r\n\r\n```\r\n# 400 Bad Request\r\n# {\r\n#   \"status\": 400,\r\n#   \"error\": {\r\n#     \"caused_by\": {\r\n#       \"reason\": \"first and last points of the linear ring must be the same (it must close itself): lats[0]=0.0 lats[2]=3.0\",\r\n#       \"type\": \"illegal_argument_exception\"\r\n#     },\r\n#     \"reason\": \"failed to parse field [f] of type [geo_shape]\",\r\n#     \"root_cause\": [\r\n#       {\r\n#         \"reason\": \"failed to parse field [f] of type [geo_shape]\",\r\n#         \"type\": \"mapper_parsing_exception\"\r\n#       }\r\n#     ],\r\n#     \"type\": \"mapper_parsing_exception\"\r\n#   }\r\n# }\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/481234000","html_url":"https://github.com/elastic/elasticsearch/issues/40998#issuecomment-481234000","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40998","id":481234000,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MTIzNDAwMA==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2019-04-09T12:40:09Z","updated_at":"2019-04-09T12:40:09Z","author_association":"CONTRIBUTOR","body":"This error is due to the polygon hitting this part of the code which is introduced to handle complex polygons over the date line:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/68149b6058a720ec891974e8a6982c5e480fb9f1/server/src/main/java/org/elasticsearch/common/geo/builders/PolygonBuilder.java#L439\r\n\r\nThe logic tries to split the polygon and generates an invalid one (first and last point are not equal). In this case there is not enough points and we get the error above, in other cases error looks like:\r\n\r\n```\r\n IllegalArgumentException[first and last points of the linear ring must be the same (it must close itself)\r\n```\r\n\r\nI wonder if we just need to close the generated polygon.","performed_via_github_app":null}]