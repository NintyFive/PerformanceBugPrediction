[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/493467435","html_url":"https://github.com/elastic/elasticsearch/issues/42196#issuecomment-493467435","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42196","id":493467435,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzQ2NzQzNQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-05-17T14:09:22Z","updated_at":"2019-05-17T14:09:22Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/493494746","html_url":"https://github.com/elastic/elasticsearch/issues/42196#issuecomment-493494746","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42196","id":493494746,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzQ5NDc0Ng==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-05-17T15:25:51Z","updated_at":"2019-05-17T15:25:51Z","author_association":"MEMBER","body":"Agreed!  We actually have an issue [open here](https://github.com/elastic/elasticsearch/issues/36487) tracking this general issue. We chatted about it in the past and decided that bucket_sort really shouldn't accept `gap_policy`, since it doesn't make sense at all for this agg.\r\n\r\nThere's a community PR open, but we ran into some backwards compatibility issues that need resolved (not overly difficult, just some work to make sure it doesn't break existing users).  We should revisit on that PR, or see if one of the ES devs should take it over and do the BWC work.\r\n\r\nI'm going to close this in favor of https://github.com/elastic/elasticsearch/issues/36487, just so we have a single tracking location.  But I'm 100% agreed this is something that we should get fixed.  Sorry you ran into this behavior!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/493653584","html_url":"https://github.com/elastic/elasticsearch/issues/42196#issuecomment-493653584","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42196","id":493653584,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzY1MzU4NA==","user":{"login":"jcornez","id":3865253,"node_id":"MDQ6VXNlcjM4NjUyNTM=","avatar_url":"https://avatars2.githubusercontent.com/u/3865253?v=4","gravatar_id":"","url":"https://api.github.com/users/jcornez","html_url":"https://github.com/jcornez","followers_url":"https://api.github.com/users/jcornez/followers","following_url":"https://api.github.com/users/jcornez/following{/other_user}","gists_url":"https://api.github.com/users/jcornez/gists{/gist_id}","starred_url":"https://api.github.com/users/jcornez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcornez/subscriptions","organizations_url":"https://api.github.com/users/jcornez/orgs","repos_url":"https://api.github.com/users/jcornez/repos","events_url":"https://api.github.com/users/jcornez/events{/privacy}","received_events_url":"https://api.github.com/users/jcornez/received_events","type":"User","site_admin":false},"created_at":"2019-05-18T06:47:06Z","updated_at":"2019-05-18T06:47:06Z","author_association":"NONE","body":"Fair enough.  Meantime, do you know if there is any workaround?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/494009113","html_url":"https://github.com/elastic/elasticsearch/issues/42196#issuecomment-494009113","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42196","id":494009113,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NDAwOTExMw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-05-20T14:23:09Z","updated_at":"2019-05-20T14:23:09Z","author_association":"MEMBER","body":"Oh wow, I completely misread the agg in this ticket; bucket_script not bucket_sort.  Sorry about that!  I was on the road last week and my brain was a bit frazzled.  Thanks for leaving a note on the ticket about bucket_script.  \r\n\r\nUnfortunately, I don't think there's any workaround here.  The bucket_script is interpreting `doc_count: 0` as an \"empty\" bucket and applying the gap policy.  Theoretically setting `min_doc_count: 1` would fix it... but pipeline aggs require that the min doc count is zero so that's not an option.\r\n\r\nThis actually relates to https://github.com/elastic/elasticsearch/issues/27377 more than #36487, now that I'm reading closer. There are various issues with the pipeline aggs which all revolve around empty bucket handling.  \r\n\r\nEssentially, we need to refactor the framework to either wrap values in Optionals (so that each new agg can see if the value is \"missing\" vs \"null\"), or pass both value and doc_count to pipeline aggs so that they can make better decisions.  And in the case of a script, the user would be able to decide what to do.\r\n\r\nIt's on our radar, and I'm hoping to get to it soon, but I'm not sure there is a workaround at this time :(","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/494013252","html_url":"https://github.com/elastic/elasticsearch/issues/42196#issuecomment-494013252","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42196","id":494013252,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NDAxMzI1Mg==","user":{"login":"jcornez","id":3865253,"node_id":"MDQ6VXNlcjM4NjUyNTM=","avatar_url":"https://avatars2.githubusercontent.com/u/3865253?v=4","gravatar_id":"","url":"https://api.github.com/users/jcornez","html_url":"https://github.com/jcornez","followers_url":"https://api.github.com/users/jcornez/followers","following_url":"https://api.github.com/users/jcornez/following{/other_user}","gists_url":"https://api.github.com/users/jcornez/gists{/gist_id}","starred_url":"https://api.github.com/users/jcornez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcornez/subscriptions","organizations_url":"https://api.github.com/users/jcornez/orgs","repos_url":"https://api.github.com/users/jcornez/repos","events_url":"https://api.github.com/users/jcornez/events{/privacy}","received_events_url":"https://api.github.com/users/jcornez/received_events","type":"User","site_admin":false},"created_at":"2019-05-20T14:33:47Z","updated_at":"2019-05-20T14:33:47Z","author_association":"NONE","body":"Thank you.  Just to note that I do want the bucket with `doc_count: 0`.  I'm working with values from siblings that are computed by moving_fn and so even though _this_ bucket might be empty, a moving_fn can indeed have a value here.","performed_via_github_app":null}]