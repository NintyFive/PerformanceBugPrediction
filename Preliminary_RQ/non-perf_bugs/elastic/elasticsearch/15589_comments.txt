[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170386266","html_url":"https://github.com/elastic/elasticsearch/issues/15589#issuecomment-170386266","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15589","id":170386266,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDM4NjI2Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-10T20:01:19Z","updated_at":"2016-01-10T20:01:19Z","author_association":"CONTRIBUTOR","body":"@danielmitterdorfer any ideas?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170545925","html_url":"https://github.com/elastic/elasticsearch/issues/15589#issuecomment-170545925","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15589","id":170545925,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDU0NTkyNQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2016-01-11T13:19:13Z","updated_at":"2016-01-11T13:20:01Z","author_association":"MEMBER","body":"The reason is straightforward: The [size calculation for scripts](https://github.com/elastic/elasticsearch/blob/ace1b33c3c5ddcd933045cb88c04475799fa96ea/core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java#L163) in `BulkRequest` does only take into account the script size (i.e. the actual source code of the script) but not its parameters. That's why in the first case, only 34 is returned.\n\nThe second case does something different: Internally, we create a new update request and treat the provided `Map` as its source. The source of a request is always considered in total in the size calculation. That's why we get a size of 231511 in this case.\n\nWe _could_ do something similar in the script case but this will add some overhead both in terms of time and code complexity as we'd have to prematurely have to serialize it, just to determine the size.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372985939","html_url":"https://github.com/elastic/elasticsearch/issues/15589#issuecomment-372985939","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15589","id":372985939,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjk4NTkzOQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T11:14:31Z","updated_at":"2018-03-14T11:14:31Z","author_association":"MEMBER","body":"Closing... determining the size in bytes for script params requires extra overhead that determining the size of a normal index request has not.","performed_via_github_app":null}]