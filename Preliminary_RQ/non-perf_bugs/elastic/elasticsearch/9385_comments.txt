[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71060254","html_url":"https://github.com/elastic/elasticsearch/issues/9385#issuecomment-71060254","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9385","id":71060254,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMDYwMjU0","user":{"login":"kul","id":1580309,"node_id":"MDQ6VXNlcjE1ODAzMDk=","avatar_url":"https://avatars3.githubusercontent.com/u/1580309?v=4","gravatar_id":"","url":"https://api.github.com/users/kul","html_url":"https://github.com/kul","followers_url":"https://api.github.com/users/kul/followers","following_url":"https://api.github.com/users/kul/following{/other_user}","gists_url":"https://api.github.com/users/kul/gists{/gist_id}","starred_url":"https://api.github.com/users/kul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kul/subscriptions","organizations_url":"https://api.github.com/users/kul/orgs","repos_url":"https://api.github.com/users/kul/repos","events_url":"https://api.github.com/users/kul/events{/privacy}","received_events_url":"https://api.github.com/users/kul/received_events","type":"User","site_admin":false},"created_at":"2015-01-22T17:26:46Z","updated_at":"2015-01-22T17:26:46Z","author_association":"CONTRIBUTOR","body":"i think `setQuery(x)` puts x inside a {\"query\" : x} so the behaviour seems ok.\nSo the main issue here is that `setSource` is not respecting the query.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71480937","html_url":"https://github.com/elastic/elasticsearch/issues/9385#issuecomment-71480937","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9385","id":71480937,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNDgwOTM3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-26T15:45:23Z","updated_at":"2015-01-26T15:45:23Z","author_association":"CONTRIBUTOR","body":"Hi @kul \n\nAny reason you aren't just using `setQuery` and `addSort`?\n\nSee http://www.elasticsearch.org/guide/en/elasticsearch/client/java-api/current/search.html#scrolling\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71486009","html_url":"https://github.com/elastic/elasticsearch/issues/9385#issuecomment-71486009","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9385","id":71486009,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNDg2MDA5","user":{"login":"kul","id":1580309,"node_id":"MDQ6VXNlcjE1ODAzMDk=","avatar_url":"https://avatars3.githubusercontent.com/u/1580309?v=4","gravatar_id":"","url":"https://api.github.com/users/kul","html_url":"https://github.com/kul","followers_url":"https://api.github.com/users/kul/followers","following_url":"https://api.github.com/users/kul/following{/other_user}","gists_url":"https://api.github.com/users/kul/gists{/gist_id}","starred_url":"https://api.github.com/users/kul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kul/subscriptions","organizations_url":"https://api.github.com/users/kul/orgs","repos_url":"https://api.github.com/users/kul/repos","events_url":"https://api.github.com/users/kul/events{/privacy}","received_events_url":"https://api.github.com/users/kul/received_events","type":"User","site_admin":false},"created_at":"2015-01-26T16:12:36Z","updated_at":"2015-01-26T16:12:36Z","author_association":"CONTRIBUTOR","body":"Yes sure, it will work. But what if you dont want/have control overy query and sorting seperately. Ideally it would take only some parsing but IMO `setSource` not being respected is a bug which would be better to be fixed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71532183","html_url":"https://github.com/elastic/elasticsearch/issues/9385#issuecomment-71532183","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9385","id":71532183,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTMyMTgz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-26T20:30:38Z","updated_at":"2015-01-26T20:30:38Z","author_association":"CONTRIBUTOR","body":"@kul the docs for setSource say that setting anything else will overwrite it, but I'm not familiar enough with the Java API to know if it is a bug or not.  I tried setExtraSource which didn't appear to work either.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71610680","html_url":"https://github.com/elastic/elasticsearch/issues/9385#issuecomment-71610680","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9385","id":71610680,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjEwNjgw","user":{"login":"kul","id":1580309,"node_id":"MDQ6VXNlcjE1ODAzMDk=","avatar_url":"https://avatars3.githubusercontent.com/u/1580309?v=4","gravatar_id":"","url":"https://api.github.com/users/kul","html_url":"https://github.com/kul","followers_url":"https://api.github.com/users/kul/followers","following_url":"https://api.github.com/users/kul/following{/other_user}","gists_url":"https://api.github.com/users/kul/gists{/gist_id}","starred_url":"https://api.github.com/users/kul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kul/subscriptions","organizations_url":"https://api.github.com/users/kul/orgs","repos_url":"https://api.github.com/users/kul/repos","events_url":"https://api.github.com/users/kul/events{/privacy}","received_events_url":"https://api.github.com/users/kul/received_events","type":"User","site_admin":false},"created_at":"2015-01-27T08:50:11Z","updated_at":"2015-01-27T08:50:11Z","author_association":"CONTRIBUTOR","body":"@clintongormley,\n As you mentioned `setSource` was being overwritten with `setSize` which i was using but forgot to mention in issue description. But strangely `setExtraSource` did the trick for me! Can you verify this? Here is a junit test I am using in SearchScrollTest.java to verify the behaviour\n\n``` java\n    @Test\n    public void testSetSourceWithScrolling() throws Exception {\n        client().admin().indices().prepareCreate(\"test\").setSettings(ImmutableSettings.settingsBuilder().put(\"index.number_of_shards\", 3)).execute().actionGet();\n        client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();\n\n        client().admin().cluster().prepareHealth().setWaitForEvents(Priority.LANGUID).setWaitForGreenStatus().execute().actionGet();\n\n        for (int i = 0; i < 100; i++) {\n            client().prepareIndex(\"test\", \"type1\", Integer.toString(i)).setSource(jsonBuilder().startObject().field(\"field\", i).endObject()).execute().actionGet();\n        }\n\n        client().admin().indices().prepareRefresh().execute().actionGet();\n\n        SearchResponse searchResponse = client().prepareSearch()\n                .setExtraSource(\"{\\\"query\\\":{\\\"range\\\": {\\\"field\\\":{\\\"lt\\\": 50}}}, \\\"sort\\\":[{\\\"field\\\": \\\"asc\\\"}]}\")\n                .setSize(35)\n                .setScroll(TimeValue.timeValueMinutes(2))\n                .execute().actionGet();\n        try {\n            long counter = 0;\n\n            assertThat(searchResponse.getHits().getTotalHits(), equalTo(50l));\n            assertThat(searchResponse.getHits().hits().length, equalTo(35));\n            for (SearchHit hit : searchResponse.getHits()) {\n                assertThat(((Number) hit.sortValues()[0]).longValue(), equalTo(counter++));\n            }\n\n            searchResponse = client().prepareSearchScroll(searchResponse.getScrollId())\n                    .setScroll(TimeValue.timeValueMinutes(2))\n                    .execute().actionGet();\n\n            assertThat(searchResponse.getHits().getTotalHits(), equalTo(50l));\n            assertThat(searchResponse.getHits().hits().length, equalTo(15));\n            for (SearchHit hit : searchResponse.getHits()) {\n                assertThat(((Number) hit.sortValues()[0]).longValue(), equalTo(counter++));\n            }\n        } finally {\n            clearScroll(searchResponse.getScrollId());\n        }\n    }\n```\n\nIdeally i would like `setSource` to behave as `setExtraSource` but thats a different debate. I would be closing the issue and PR. Please reopen if you see any problems.\n\nThanks\n","performed_via_github_app":null}]