{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27789","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27789/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27789/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27789/events","html_url":"https://github.com/elastic/elasticsearch/issues/27789","id":281683984,"node_id":"MDU6SXNzdWUyODE2ODM5ODQ=","number":27789,"title":"painless cannot parse escaped characters correctly","user":{"login":"CJSoldier","id":11347209,"node_id":"MDQ6VXNlcjExMzQ3MjA5","avatar_url":"https://avatars1.githubusercontent.com/u/11347209?v=4","gravatar_id":"","url":"https://api.github.com/users/CJSoldier","html_url":"https://github.com/CJSoldier","followers_url":"https://api.github.com/users/CJSoldier/followers","following_url":"https://api.github.com/users/CJSoldier/following{/other_user}","gists_url":"https://api.github.com/users/CJSoldier/gists{/gist_id}","starred_url":"https://api.github.com/users/CJSoldier/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CJSoldier/subscriptions","organizations_url":"https://api.github.com/users/CJSoldier/orgs","repos_url":"https://api.github.com/users/CJSoldier/repos","events_url":"https://api.github.com/users/CJSoldier/events{/privacy}","received_events_url":"https://api.github.com/users/CJSoldier/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"}],"state":"closed","locked":false,"assignee":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"assignees":[{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2017-12-13T09:45:30Z","updated_at":"2020-09-24T14:16:15Z","closed_at":"2017-12-14T04:22:48Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):5.6.3\r\n\r\n**Plugins installed**: [smartcn ]\r\n\r\n**JVM version** (`java -version`): \r\njava version \"1.8.0_152\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_152-b16)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.152-b16, mixed mode)\r\n\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nCentOS Linux release 7.2.1511 (Core)\r\n\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. insert a new doc.\r\n```\r\ncurl -XPUT 'http://192.168.40.106:9200/janusgraph_vertices/vertices/1111' -d '{ \"Person_emailList\":[\"aa@qq.com\"] }'\r\n```\r\n 2.update multi value field via painless script.\r\n```\r\ncurl -XPOST '192.168.40.106:9200/_bulk?pretty' -H 'Content-Type: application/json' -d'\r\n{\"update\":{\"_index\":\"janusgraph_vertices\",\"_type\":\"vertices\",\"_id\":\"1111\"}}\r\n{\"script\":{\"source\":\"if(ctx._source[\\\"Person_emailList\\\"] == null){ctx._source[\\\"Person_emailList\\\"] = [];}ctx._source[\\\"Person_emailList\\\"].add(\\\"\\\\\\\"bb@qq.com\\\\t\\\");\",\"lang\":\"painless\"},\"upsert\":{\"Person_emailList\":[\"\\\"bb@qq.com\\t\"]}}\r\n'\r\n```\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n{\r\n  \"took\" : 94,\r\n  \"errors\" : true,\r\n  \"items\" : [\r\n    {\r\n      \"update\" : {\r\n        \"_index\" : \"janusgraph_vertices\",\r\n        \"_type\" : \"vertices\",\r\n        \"_id\" : \"1111\",\r\n        \"status\" : 400,\r\n        \"error\" : {\r\n          \"type\" : \"illegal_argument_exception\",\r\n          \"reason\" : \"failed to execute script\",\r\n          \"caused_by\" : {\r\n            \"type\" : \"script_exception\",\r\n            \"reason\" : \"compile error\",\r\n            \"script_stack\" : [\r\n              \"... [\\\"Person_emailList\\\"].add(\\\"\\\\\\\"bb@qq.com\\\\t\\\");\",\r\n              \"                             ^---- HERE\"\r\n            ],\r\n            \"script\" : \"if(ctx._source[\\\"Person_emailList\\\"] == null){ctx._source[\\\"Person_emailList\\\"] = [];}ctx._source[\\\"Person_emailList\\\"].add(\\\"\\\\\\\"bb@qq.com\\\\t\\\");\",\r\n            \"lang\" : \"painless\",\r\n            \"caused_by\" : {\r\n              \"type\" : \"illegal_argument_exception\",\r\n              \"reason\" : \"unexpected character [\\\"\\\\\\\"bb@qq.com\\\\t]. The only valid escape sequences in strings starting with [\\\"] are [\\\\\\\\] and [\\\\\\\"].\",\r\n              \"caused_by\" : {\r\n                \"type\" : \"lexer_no_viable_alt_exception\",\r\n                \"reason\" : null\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}