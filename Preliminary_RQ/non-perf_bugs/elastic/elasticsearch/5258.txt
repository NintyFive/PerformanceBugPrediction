{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5258","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5258/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5258/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5258/events","html_url":"https://github.com/elastic/elasticsearch/issues/5258","id":28279793,"node_id":"MDU6SXNzdWUyODI3OTc5Mw==","number":5258,"title":"Add support of field boost in common terms query","user":{"login":"spigene","id":2709179,"node_id":"MDQ6VXNlcjI3MDkxNzk=","avatar_url":"https://avatars1.githubusercontent.com/u/2709179?v=4","gravatar_id":"","url":"https://api.github.com/users/spigene","html_url":"https://github.com/spigene","followers_url":"https://api.github.com/users/spigene/followers","following_url":"https://api.github.com/users/spigene/following{/other_user}","gists_url":"https://api.github.com/users/spigene/gists{/gist_id}","starred_url":"https://api.github.com/users/spigene/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spigene/subscriptions","organizations_url":"https://api.github.com/users/spigene/orgs","repos_url":"https://api.github.com/users/spigene/repos","events_url":"https://api.github.com/users/spigene/events{/privacy}","received_events_url":"https://api.github.com/users/spigene/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":82340461,"node_id":"MDU6TGFiZWw4MjM0MDQ2MQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.13","name":"v0.90.13","color":"dddddd","default":false,"description":null},{"id":82340516,"node_id":"MDU6TGFiZWw4MjM0MDUxNg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.2","name":"v1.0.2","color":"dddddd","default":false,"description":null},{"id":75962075,"node_id":"MDU6TGFiZWw3NTk2MjA3NQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.1.0","name":"v1.1.0","color":"DDDDDD","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-02-25T20:22:36Z","updated_at":"2014-03-27T16:03:37Z","closed_at":"2014-02-27T14:06:08Z","author_association":"NONE","active_lock_reason":null,"body":"As for now, ES ignores field level boost factors specified in mapping during computation of documents' score for common terms query.\nThis places certain restrictions on the client of ES. \nE.g., the client has to specify different boost factors manually if he want to have distinct scores for the same term retrieved from two fields.\nThis quickly becomes unmanageable if the client has no direct control over search fields or if this number grows fast.\nThe absence of the described functionally looks especially weird comparing to the way how regular terms query works (it does honor field level boosts, see below).\n\nSample setup:\n\n**1. Create index and mapping.**\n\n``` bash\ncurl -XPUT 'http://localhost:9200/messages/'\n```\n\n``` bash\ncurl -XPUT 'http://localhost:9200/messages/message/_mapping' -d '\n{\n    \"message\" : {\n        \"properties\" : {\n            \"message\" : {\"type\" : \"string\", \"store\" : true },\n            \"comment\" : {\"type\" : \"string\", \"store\" : true , \"boost\" : 5.0 }\n        }\n    }\n}'\n```\n\n**2. Create sample docs**\n\n``` bash\ncurl -XPUT 'http://localhost:9200/messages/message/1' -d '{\n    \"user\" : \"user1\",\n    \"message\" : \"test message\",\n    \"comment\" : \"whatever\"\n}'\n\ncurl -XPUT 'http://localhost:9200/messages/message/2' -d '{\n    \"user\" : \"user2\",\n    \"message\" : \"hello world\",\n    \"comment\" : \"test comment\"\n}'\n```\n\n**3. Wait for ES to be synced**\n\n``` bash\ncurl -XPOST 'http://localhost:9200/messages/_refresh' \n```\n\n**4. Search in default catch-all field using term query**\n\n``` bash\ncurl -XPOST 'http://localhost:9200/messages/_search' -d '{ \"query\" : { \"query_string\" : { \"query\" : \"test\" } } , \"explain\" : true }' | python -mjson.tool\n```\n\n**5. Search in default catch-all field using common terms query**\n\n``` bash\ncurl -XPOST 'http://localhost:9200/messages/_search' -d '{ \"query\" : { \"common\" : { \"_all\" : { \"query\" : \"test\" } } } , \"explain\" : true }' | python -mjson.tool\n```\n\nThe first query (step 4) works as expected -- document with id equal to 2 has higher score.\nThe result of second query (step 5) is opposite.\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}