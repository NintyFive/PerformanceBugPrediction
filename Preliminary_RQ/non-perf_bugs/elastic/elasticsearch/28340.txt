{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28340","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28340/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28340/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28340/events","html_url":"https://github.com/elastic/elasticsearch/issues/28340","id":290837691,"node_id":"MDU6SXNzdWUyOTA4Mzc2OTE=","number":28340,"title":"ES shut down with JVM crash from  unified highlighter","user":{"login":"bhavyarm","id":7074629,"node_id":"MDQ6VXNlcjcwNzQ2Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/7074629?v=4","gravatar_id":"","url":"https://api.github.com/users/bhavyarm","html_url":"https://github.com/bhavyarm","followers_url":"https://api.github.com/users/bhavyarm/followers","following_url":"https://api.github.com/users/bhavyarm/following{/other_user}","gists_url":"https://api.github.com/users/bhavyarm/gists{/gist_id}","starred_url":"https://api.github.com/users/bhavyarm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bhavyarm/subscriptions","organizations_url":"https://api.github.com/users/bhavyarm/orgs","repos_url":"https://api.github.com/users/bhavyarm/repos","events_url":"https://api.github.com/users/bhavyarm/events{/privacy}","received_events_url":"https://api.github.com/users/bhavyarm/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":249799053,"node_id":"MDU6TGFiZWwyNDk3OTkwNTM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/jvm%20bug","name":"jvm bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-01-23T13:30:51Z","updated_at":"2018-01-31T13:23:13Z","closed_at":"2018-01-31T13:23:13Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.2.0 BC1\r\n\r\n**Plugins installed**: None\r\n\r\n**JVM version** (`java -version`):\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Darwin Kernel Version 15.6.0: Sun Jun  4 21:43:07 PDT 2017; root:xnu-3248.70.3~1/RELEASE_X86_64 x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**: ES shut down all of a sudden with a fatal error in logs. I was testing index pattern creation in Safari/Firefox and chrome in Kibana. Both safari and firefox restarted (?). \r\n\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Load ES/Kibana/Metricbeat of BC1 of 6.2.0 with metricbeat indexpattern and dashboards loaded\r\n 2. Try to create and recreate metricbeat index pattern in Kibana multiple times\r\n 3. Noticed that ES crashed at one point.\r\n\r\n**Provide logs (if relevant)**:\r\nES logs:\r\n\r\n```\r\n[2018-01-22T12:47:29,344][INFO ][o.e.c.s.MasterService    ] [SanPFt1] zen-disco-elected-as-master ([0] nodes joined), reason: new_master {SanPFt1}{SanPFt1mQjeKHVG6oJ6NJA}{kZ_rCjSGQEyJb1X0JDLHrA}{127.0.0.1}{127.0.0.1:9300}\r\n[2018-01-22T12:47:29,349][INFO ][o.e.c.s.ClusterApplierService] [SanPFt1] new_master {SanPFt1}{SanPFt1mQjeKHVG6oJ6NJA}{kZ_rCjSGQEyJb1X0JDLHrA}{127.0.0.1}{127.0.0.1:9300}, reason: apply cluster state (from master [master {SanPFt1}{SanPFt1mQjeKHVG6oJ6NJA}{kZ_rCjSGQEyJb1X0JDLHrA}{127.0.0.1}{127.0.0.1:9300} committed version [1] source [zen-disco-elected-as-master ([0] nodes joined)]])\r\n[2018-01-22T12:47:29,374][INFO ][o.e.h.n.Netty4HttpServerTransport] [SanPFt1] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200}\r\n[2018-01-22T12:47:29,374][INFO ][o.e.n.Node               ] [SanPFt1] started\r\n[2018-01-22T12:47:29,726][INFO ][o.e.g.GatewayService     ] [SanPFt1] recovered [2] indices into cluster_state\r\n[2018-01-22T12:47:30,249][INFO ][o.e.c.r.a.AllocationService] [SanPFt1] Cluster health status changed from [RED] to [YELLOW] (reason: [shards started [[.kibana][0]] ...]).\r\n[2018-01-23T00:00:08,359][INFO ][o.e.c.m.MetaDataCreateIndexService] [SanPFt1] [metricbeat-6.2.0-2018.01.23] creating index, cause [auto(bulk api)], templates [metricbeat-6.2.0], shards [1]/[1], mappings [doc]\r\n#\r\n# A fatal error has been detected by the Java Runtime Environment:\r\n#\r\n#  SIGSEGV (0xb) at pc=0x000000010d6b85d3, pid=1172, tid=0x0000000000004603\r\n#\r\n# JRE version: Java(TM) SE Runtime Environment (8.0_111-b14) (build 1.8.0_111-b14)\r\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (25.111-b14 mixed mode bsd-amd64 compressed oops)\r\n# Problematic frame:\r\n# V  [libjvm.dylib+0x2b85d3]  InstanceKlass::remove_dependent_nmethod(nmethod*, bool)+0xc7\r\n#\r\n# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again\r\n#\r\n# An error report file with more information is saved as:\r\n# /Users/bhavyarajumandya/Desktop/BC1_6.2.0/elasticsearch-6.2.0/hs_err_pid1172.log\r\nCompiled method (c2) 45804036 9121       4       org.apache.lucene.search.uhighlight.UnifiedHighlighter::highlightFieldsAsObjects (572 bytes)\r\n total in heap  [0x000000010ed26610,0x000000010ed47a60] = 136272\r\n relocation     [0x000000010ed26738,0x000000010ed271f8] = 2752\r\n constants      [0x000000010ed27200,0x000000010ed27220] = 32\r\n main code      [0x000000010ed27220,0x000000010ed30d20] = 39680\r\n stub code      [0x000000010ed30d20,0x000000010ed310c8] = 936\r\n oops           [0x000000010ed310c8,0x000000010ed311c0] = 248\r\n metadata       [0x000000010ed311c0,0x000000010ed31830] = 1648\r\n scopes data    [0x000000010ed31830,0x000000010ed45338] = 80648\r\n scopes pcs     [0x000000010ed45338,0x000000010ed469b8] = 5760\r\n dependencies   [0x000000010ed469b8,0x000000010ed46a78] = 192\r\n handler table  [0x000000010ed46a78,0x000000010ed47840] = 3528\r\n nul chk table  [0x000000010ed47840,0x000000010ed47a60] = 544\r\n#\r\n# If you would like to submit a bug report, please visit:\r\n#   http://bugreport.java.com/bugreport/crash.jsp\r\n#\r\nAbort trap: 6\r\n```\r\n\r\n**Kibana dev console:**\r\n\r\n<img width=\"1280\" alt=\"console_dev\" src=\"https://user-images.githubusercontent.com/7074629/35278117-00d6de94-0017-11e8-9dc0-e09875d916e7.png\">\r\n\r\nhs_err_pid1172.log:\r\n[hs_err_pid1172.log](https://github.com/elastic/elasticsearch/files/1656076/hs_err_pid1172.log)\r\n\r\n\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}