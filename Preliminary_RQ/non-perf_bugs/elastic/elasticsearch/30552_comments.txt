[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388726676","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-388726676","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":388726676,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODcyNjY3Ng==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-05-14T07:46:48Z","updated_at":"2018-05-14T07:46:48Z","author_association":"MEMBER","body":"`split_on_whitespace` is an option for the `query_string` query only.  It doesn't work with a `match` query and was the source of all sort of confusions when the analyzer of the field needs to handle multi-words. The switch to a `query_string` that does not split on whitespace solved this issue. Though there are some valid cases where splitting on whitespace prior to analysis may be needed. For instance if the field is a `keyword` field you may want to split on whitespace first and apply the normalizer of the field after the split. For this purpose we plan to add the support to split on whitespace at query time for `keyword` fields but not only for the `query_string` but for all the analyzed queries (`match`, `multi_match`, `query_string`,  `simple_query_string`). This option could be activated or not in the mapping directly. Would this solution solve your issue with upgrading ?\r\nhttps://github.com/elastic/elasticsearch/issues/30393","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388729671","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-388729671","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":388729671,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODcyOTY3MQ==","user":{"login":"odmby","id":31470522,"node_id":"MDQ6VXNlcjMxNDcwNTIy","avatar_url":"https://avatars3.githubusercontent.com/u/31470522?v=4","gravatar_id":"","url":"https://api.github.com/users/odmby","html_url":"https://github.com/odmby","followers_url":"https://api.github.com/users/odmby/followers","following_url":"https://api.github.com/users/odmby/following{/other_user}","gists_url":"https://api.github.com/users/odmby/gists{/gist_id}","starred_url":"https://api.github.com/users/odmby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/odmby/subscriptions","organizations_url":"https://api.github.com/users/odmby/orgs","repos_url":"https://api.github.com/users/odmby/repos","events_url":"https://api.github.com/users/odmby/events{/privacy}","received_events_url":"https://api.github.com/users/odmby/received_events","type":"User","site_admin":false},"created_at":"2018-05-14T07:58:44Z","updated_at":"2018-05-14T07:58:44Z","author_association":"NONE","body":"Thanks for the quick feedback jimczi.\r\nAs most of our fields are indeed keywords (\"not analyzed\") this could solve the issue, but it must work directly from the Kibana search bar, and not only as an optional flag when working directly with elastic.\r\nWhen is this feature planned to be released? And just to I understand - is this something that needs to be added to each field in each index in the mapping, or is it a general configuration?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388731511","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-388731511","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":388731511,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODczMTUxMQ==","user":{"login":"odmby","id":31470522,"node_id":"MDQ6VXNlcjMxNDcwNTIy","avatar_url":"https://avatars3.githubusercontent.com/u/31470522?v=4","gravatar_id":"","url":"https://api.github.com/users/odmby","html_url":"https://github.com/odmby","followers_url":"https://api.github.com/users/odmby/followers","following_url":"https://api.github.com/users/odmby/following{/other_user}","gists_url":"https://api.github.com/users/odmby/gists{/gist_id}","starred_url":"https://api.github.com/users/odmby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/odmby/subscriptions","organizations_url":"https://api.github.com/users/odmby/orgs","repos_url":"https://api.github.com/users/odmby/repos","events_url":"https://api.github.com/users/odmby/events{/privacy}","received_events_url":"https://api.github.com/users/odmby/received_events","type":"User","site_admin":false},"created_at":"2018-05-14T08:06:13Z","updated_at":"2018-05-14T08:06:13Z","author_association":"NONE","body":"And will we have to change the mapping of all the existing indexes for this to work?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388758201","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-388758201","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":388758201,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODc1ODIwMQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-05-14T09:42:07Z","updated_at":"2018-05-14T09:42:07Z","author_association":"MEMBER","body":"> And just to I understand - is this something that needs to be added to each field in each index in the mapping, or is it a general configuration?\r\n> And will we have to change the mapping of all the existing indexes for this to work?\r\n\r\nProbably. We still need to discuss internally but the option considered at the moment is to add a `split_queries_on_whitespace` option in the mapping option of the `keyword` field which defaults to false. \r\nThough if you rely on whitespace splitting at query time I wonder how do you ensure that you don't index terms with whitespaces in your `keyword` field ? Could these fields be defined as `text` field with a `keyword` index analyzer and a `whitespace` query analyzer instead ? This would require reindexing but would be more consistent with the real intent. There is no good way to split a `keyword` field at query time especially when the query is derived from a search bar filled with free text. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388770115","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-388770115","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":388770115,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODc3MDExNQ==","user":{"login":"odmby","id":31470522,"node_id":"MDQ6VXNlcjMxNDcwNTIy","avatar_url":"https://avatars3.githubusercontent.com/u/31470522?v=4","gravatar_id":"","url":"https://api.github.com/users/odmby","html_url":"https://github.com/odmby","followers_url":"https://api.github.com/users/odmby/followers","following_url":"https://api.github.com/users/odmby/following{/other_user}","gists_url":"https://api.github.com/users/odmby/gists{/gist_id}","starred_url":"https://api.github.com/users/odmby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/odmby/subscriptions","organizations_url":"https://api.github.com/users/odmby/orgs","repos_url":"https://api.github.com/users/odmby/repos","events_url":"https://api.github.com/users/odmby/events{/privacy}","received_events_url":"https://api.github.com/users/odmby/received_events","type":"User","site_admin":false},"created_at":"2018-05-14T10:25:29Z","updated_at":"2018-05-14T10:25:29Z","author_association":"NONE","body":"We do have values with whitespaces, but when querying on them users place quotation marks.\r\nHowever most of the usage is for lists of values that we know don't have whitespaces (e.g. lists of id's) that are copy-pasted by users to the search bar. We don't have an intention of splitting the keyword field - our queries in kibana are many times more similar to Terms Set Query than to a full text search.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388812188","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-388812188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":388812188,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODgxMjE4OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-14T13:15:10Z","updated_at":"2018-05-14T13:15:10Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/390454131","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-390454131","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":390454131,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MDQ1NDEzMQ==","user":{"login":"akotlar","id":5543229,"node_id":"MDQ6VXNlcjU1NDMyMjk=","avatar_url":"https://avatars1.githubusercontent.com/u/5543229?v=4","gravatar_id":"","url":"https://api.github.com/users/akotlar","html_url":"https://github.com/akotlar","followers_url":"https://api.github.com/users/akotlar/followers","following_url":"https://api.github.com/users/akotlar/following{/other_user}","gists_url":"https://api.github.com/users/akotlar/gists{/gist_id}","starred_url":"https://api.github.com/users/akotlar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akotlar/subscriptions","organizations_url":"https://api.github.com/users/akotlar/orgs","repos_url":"https://api.github.com/users/akotlar/repos","events_url":"https://api.github.com/users/akotlar/events{/privacy}","received_events_url":"https://api.github.com/users/akotlar/received_events","type":"User","site_admin":false},"created_at":"2018-05-20T03:02:40Z","updated_at":"2018-05-20T03:03:57Z","author_association":"NONE","body":"@jimczi In my case the solution is simply to trim before indexing, and trimming whitespace is probably the most common text-parsing operation I do at least. Not sure I quite understand what you mean \"There is no good way to split a keyword field at query time especially when the query is derived from a search bar filled with free text.\" Isn't the stupidest/easiest option the only one? Just split the tokens, trim, unless they're quoted.\r\n\r\nI like your idea of a default false `split_on_whitespace` option for keyword mappings; alternatively exposing search_mapping on keyword fields for a more flexible transformation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/402136308","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-402136308","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":402136308,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjEzNjMwOA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-07-03T12:21:26Z","updated_at":"2018-07-03T12:21:26Z","author_association":"MEMBER","body":"ping @elastic/es-search-aggs  this may have fallen through the cracks as it was labelled feedback_needed, but I think we got the info we asked for.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/402145592","html_url":"https://github.com/elastic/elasticsearch/issues/30552#issuecomment-402145592","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30552","id":402145592,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjE0NTU5Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-07-03T12:51:37Z","updated_at":"2018-07-03T12:51:37Z","author_association":"MEMBER","body":"Thanks for noticing @javanna , the support for the option described in https://github.com/elastic/elasticsearch/issues/30393 has been added in https://github.com/elastic/elasticsearch/pull/30691. The new option will be available in 6.4 so I am going to close this issue.","performed_via_github_app":null}]