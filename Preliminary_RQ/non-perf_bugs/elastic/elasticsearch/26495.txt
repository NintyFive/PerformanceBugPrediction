{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26495","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26495/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26495/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26495/events","html_url":"https://github.com/elastic/elasticsearch/issues/26495","id":255055949,"node_id":"MDU6SXNzdWUyNTUwNTU5NDk=","number":26495,"title":"_analyze API skips char_filter when no tokenizer/filters specified","user":{"login":"kurtado","id":1161427,"node_id":"MDQ6VXNlcjExNjE0Mjc=","avatar_url":"https://avatars1.githubusercontent.com/u/1161427?v=4","gravatar_id":"","url":"https://api.github.com/users/kurtado","html_url":"https://github.com/kurtado","followers_url":"https://api.github.com/users/kurtado/followers","following_url":"https://api.github.com/users/kurtado/following{/other_user}","gists_url":"https://api.github.com/users/kurtado/gists{/gist_id}","starred_url":"https://api.github.com/users/kurtado/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kurtado/subscriptions","organizations_url":"https://api.github.com/users/kurtado/orgs","repos_url":"https://api.github.com/users/kurtado/repos","events_url":"https://api.github.com/users/kurtado/events{/privacy}","received_events_url":"https://api.github.com/users/kurtado/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":{"login":"johtani","id":1142449,"node_id":"MDQ6VXNlcjExNDI0NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/1142449?v=4","gravatar_id":"","url":"https://api.github.com/users/johtani","html_url":"https://github.com/johtani","followers_url":"https://api.github.com/users/johtani/followers","following_url":"https://api.github.com/users/johtani/following{/other_user}","gists_url":"https://api.github.com/users/johtani/gists{/gist_id}","starred_url":"https://api.github.com/users/johtani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johtani/subscriptions","organizations_url":"https://api.github.com/users/johtani/orgs","repos_url":"https://api.github.com/users/johtani/repos","events_url":"https://api.github.com/users/johtani/events{/privacy}","received_events_url":"https://api.github.com/users/johtani/received_events","type":"User","site_admin":false},"assignees":[{"login":"johtani","id":1142449,"node_id":"MDQ6VXNlcjExNDI0NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/1142449?v=4","gravatar_id":"","url":"https://api.github.com/users/johtani","html_url":"https://github.com/johtani","followers_url":"https://api.github.com/users/johtani/followers","following_url":"https://api.github.com/users/johtani/following{/other_user}","gists_url":"https://api.github.com/users/johtani/gists{/gist_id}","starred_url":"https://api.github.com/users/johtani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johtani/subscriptions","organizations_url":"https://api.github.com/users/johtani/orgs","repos_url":"https://api.github.com/users/johtani/repos","events_url":"https://api.github.com/users/johtani/events{/privacy}","received_events_url":"https://api.github.com/users/johtani/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2017-09-04T14:20:17Z","updated_at":"2017-10-27T08:31:30Z","closed_at":"2017-10-27T08:31:30Z","author_association":"MEMBER","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 5.5.1 (probably others)\r\n\r\n**JVM version**: 1.8.0_111\r\n\r\n**OS version**: MacOS\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen using the `_analyze` API, if the request body only specifies a `char_filter`, it will simply use the default analyzer and not include the `char_filter` as well. \r\n\r\n**Steps to reproduce**:\r\nThis works as expected, executing the` char_filter` before  the tokenizer:\r\n```\r\nGET _analyze\r\n{\r\n  \"tokenizer\": \"standard\",\r\n  \"char_filter\": [\r\n      {\r\n        \"type\" : \"mapping\",\r\n        \"mappings\" : [ \"- => _\"]\r\n      }\r\n    ],\r\n  \"text\": \"foo-bar\"\r\n}\r\n```\r\nresponse:\r\n```\r\n{\r\n  \"tokens\": [\r\n    {\r\n      \"token\": \"foo_bar\",\r\n      \"start_offset\": 0,\r\n      \"end_offset\": 7,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 0\r\n    }\r\n  ]\r\n}\r\n```\r\nHowever, omitting the `tokenizer`, the `char_filter` doesn't appear to execute:\r\n```\r\nGET _analyze\r\n{\r\n  \"char_filter\": [\r\n      {\r\n        \"type\" : \"mapping\",\r\n        \"mappings\" : [ \"- => _\"]\r\n      }\r\n    ],\r\n  \"text\": \"foo-bar\"\r\n}\r\n```\r\nresponse:\r\n```\r\n{\r\n  \"tokens\": [\r\n    {\r\n      \"token\": \"foo\",\r\n      \"start_offset\": 0,\r\n      \"end_offset\": 3,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 0\r\n    },\r\n    {\r\n      \"token\": \"bar\",\r\n      \"start_offset\": 4,\r\n      \"end_offset\": 7,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 1\r\n    }\r\n  ]\r\n}\r\n```\r\nFurther evidence: running with an unknown `char_filter` doesn't generate an error:\r\n```\r\nGET _analyze\r\n{\r\n  \"char_filter\": [\r\n      {\r\n        \"type\" : \"mmmmmmapping\",\r\n        \"mappings\" : [ \"- => _\"]\r\n      }\r\n    ],\r\n  \"text\": \"foo-bar\"\r\n}\r\n```\r\nresponse:\r\n```\r\n{\r\n  \"tokens\": [\r\n    {\r\n      \"token\": \"foo\",\r\n      \"start_offset\": 0,\r\n      \"end_offset\": 3,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 0\r\n    },\r\n    {\r\n      \"token\": \"bar\",\r\n      \"start_offset\": 4,\r\n      \"end_offset\": 7,\r\n      \"type\": \"<ALPHANUM>\",\r\n      \"position\": 1\r\n    }\r\n  ]\r\n}\r\n```\r\nwhereas, normally it would:\r\n```\r\nGET _analyze\r\n{\r\n  \"tokenizer\": \"standard\", \r\n  \"char_filter\": [\r\n      {\r\n        \"type\" : \"mmmmmmapping\",\r\n        \"mappings\" : [ \"- => _\"]\r\n      }\r\n    ],\r\n  \"text\": \"foo-bar\"\r\n}\r\n```\r\nresponse:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"remote_transport_exception\",\r\n        \"reason\": \"[s17n1jN][127.0.0.1:9300][indices:admin/analyze[s]]\"\r\n      }\r\n    ],\r\n    \"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"failed to find global char filter under [mmmmmmapping]\"\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n","closed_by":{"login":"johtani","id":1142449,"node_id":"MDQ6VXNlcjExNDI0NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/1142449?v=4","gravatar_id":"","url":"https://api.github.com/users/johtani","html_url":"https://github.com/johtani","followers_url":"https://api.github.com/users/johtani/followers","following_url":"https://api.github.com/users/johtani/following{/other_user}","gists_url":"https://api.github.com/users/johtani/gists{/gist_id}","starred_url":"https://api.github.com/users/johtani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johtani/subscriptions","organizations_url":"https://api.github.com/users/johtani/orgs","repos_url":"https://api.github.com/users/johtani/repos","events_url":"https://api.github.com/users/johtani/events{/privacy}","received_events_url":"https://api.github.com/users/johtani/received_events","type":"User","site_admin":false},"performed_via_github_app":null}