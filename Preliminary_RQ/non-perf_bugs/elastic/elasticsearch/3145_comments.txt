[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19065919","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19065919","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19065919,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDY1OTE5","user":{"login":"eonnen","id":63275,"node_id":"MDQ6VXNlcjYzMjc1","avatar_url":"https://avatars2.githubusercontent.com/u/63275?v=4","gravatar_id":"","url":"https://api.github.com/users/eonnen","html_url":"https://github.com/eonnen","followers_url":"https://api.github.com/users/eonnen/followers","following_url":"https://api.github.com/users/eonnen/following{/other_user}","gists_url":"https://api.github.com/users/eonnen/gists{/gist_id}","starred_url":"https://api.github.com/users/eonnen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eonnen/subscriptions","organizations_url":"https://api.github.com/users/eonnen/orgs","repos_url":"https://api.github.com/users/eonnen/repos","events_url":"https://api.github.com/users/eonnen/events{/privacy}","received_events_url":"https://api.github.com/users/eonnen/received_events","type":"User","site_admin":false},"created_at":"2013-06-06T18:46:54Z","updated_at":"2013-06-06T18:46:54Z","author_association":"NONE","body":"One additional data point I've discovered, this issue is only reproducible when generating _concurrent_ load with multiple clients. If I drop my clients down to a single thread, no problems. When I step up to two threads executing index calls (using TransportClient), I can reproduce the issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19093249","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19093249","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19093249,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDkzMjQ5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-06-07T07:41:43Z","updated_at":"2013-06-07T07:41:43Z","author_association":"CONTRIBUTOR","body":"hi eric, \n\nthis is interesting though, is it possible to reproduce this error with a certain document you could share or does the document not matter at all here? as far as I understand you are indexing into 2 nodes with transport client and as soon as you switch to TransportClient and concurrent requests you see the problems happening, right? Yet, do you get exceptions in your client as well or do you see failing index requests? Is there any chance that your client uses a different es version by any chance?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19095177","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19095177","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19095177,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MDk1MTc3","user":{"login":"jprante","id":635745,"node_id":"MDQ6VXNlcjYzNTc0NQ==","avatar_url":"https://avatars1.githubusercontent.com/u/635745?v=4","gravatar_id":"","url":"https://api.github.com/users/jprante","html_url":"https://github.com/jprante","followers_url":"https://api.github.com/users/jprante/followers","following_url":"https://api.github.com/users/jprante/following{/other_user}","gists_url":"https://api.github.com/users/jprante/gists{/gist_id}","starred_url":"https://api.github.com/users/jprante/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jprante/subscriptions","organizations_url":"https://api.github.com/users/jprante/orgs","repos_url":"https://api.github.com/users/jprante/repos","events_url":"https://api.github.com/users/jprante/events{/privacy}","received_events_url":"https://api.github.com/users/jprante/received_events","type":"User","site_admin":false},"created_at":"2013-06-07T08:35:06Z","updated_at":"2013-06-07T08:35:06Z","author_association":"CONTRIBUTOR","body":"Duplicate older thread here (no solution yet) https://groups.google.com/d/msg/elasticsearch/MSrKvfgKwy0/Tfk6nhlqYxYJ\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19117099","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19117099","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19117099,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MTE3MDk5","user":{"login":"eonnen","id":63275,"node_id":"MDQ6VXNlcjYzMjc1","avatar_url":"https://avatars2.githubusercontent.com/u/63275?v=4","gravatar_id":"","url":"https://api.github.com/users/eonnen","html_url":"https://github.com/eonnen","followers_url":"https://api.github.com/users/eonnen/followers","following_url":"https://api.github.com/users/eonnen/following{/other_user}","gists_url":"https://api.github.com/users/eonnen/gists{/gist_id}","starred_url":"https://api.github.com/users/eonnen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eonnen/subscriptions","organizations_url":"https://api.github.com/users/eonnen/orgs","repos_url":"https://api.github.com/users/eonnen/repos","events_url":"https://api.github.com/users/eonnen/events{/privacy}","received_events_url":"https://api.github.com/users/eonnen/received_events","type":"User","site_admin":false},"created_at":"2013-06-07T16:18:27Z","updated_at":"2013-06-07T16:18:27Z","author_association":"NONE","body":"Hey Simon! You're correct, I see no exceptions at the client layer and all is fine. I'm indexing a stream of very similar documents and when I only run a single indexer thread, I encounter no problems. As soon as I change to multiple threads on the client I can reproduce the issue. Given that I have no problems single threaded, I'm fairly certain this isn't a document-specific issue. I can't really pinpoint a specific problematic document as the exception doesn't make it back to the client.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19117139","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19117139","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19117139,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MTE3MTM5","user":{"login":"eonnen","id":63275,"node_id":"MDQ6VXNlcjYzMjc1","avatar_url":"https://avatars2.githubusercontent.com/u/63275?v=4","gravatar_id":"","url":"https://api.github.com/users/eonnen","html_url":"https://github.com/eonnen","followers_url":"https://api.github.com/users/eonnen/followers","following_url":"https://api.github.com/users/eonnen/following{/other_user}","gists_url":"https://api.github.com/users/eonnen/gists{/gist_id}","starred_url":"https://api.github.com/users/eonnen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eonnen/subscriptions","organizations_url":"https://api.github.com/users/eonnen/orgs","repos_url":"https://api.github.com/users/eonnen/repos","events_url":"https://api.github.com/users/eonnen/events{/privacy}","received_events_url":"https://api.github.com/users/eonnen/received_events","type":"User","site_admin":false},"created_at":"2013-06-07T16:19:02Z","updated_at":"2013-06-07T16:19:02Z","author_association":"NONE","body":"Oh and yes, I am using the same client version as the server assuming the maven version of the client is correct.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19117420","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19117420","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19117420,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MTE3NDIw","user":{"login":"eonnen","id":63275,"node_id":"MDQ6VXNlcjYzMjc1","avatar_url":"https://avatars2.githubusercontent.com/u/63275?v=4","gravatar_id":"","url":"https://api.github.com/users/eonnen","html_url":"https://github.com/eonnen","followers_url":"https://api.github.com/users/eonnen/followers","following_url":"https://api.github.com/users/eonnen/following{/other_user}","gists_url":"https://api.github.com/users/eonnen/gists{/gist_id}","starred_url":"https://api.github.com/users/eonnen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eonnen/subscriptions","organizations_url":"https://api.github.com/users/eonnen/orgs","repos_url":"https://api.github.com/users/eonnen/repos","events_url":"https://api.github.com/users/eonnen/events{/privacy}","received_events_url":"https://api.github.com/users/eonnen/received_events","type":"User","site_admin":false},"created_at":"2013-06-07T16:24:30Z","updated_at":"2013-06-07T16:24:30Z","author_association":"NONE","body":"With further testing, the issue does not seem to present itself when I disable the geo_point field from my mappings.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19123677","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19123677","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19123677,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MTIzNjc3","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-06-07T18:12:59Z","updated_at":"2013-06-07T18:12:59Z","author_association":"CONTRIBUTOR","body":"man, that is good input! I will check this soonish! thanks man... will report back once I have something\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19183990","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19183990","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19183990,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MTgzOTkw","user":{"login":"jprante","id":635745,"node_id":"MDQ6VXNlcjYzNTc0NQ==","avatar_url":"https://avatars1.githubusercontent.com/u/635745?v=4","gravatar_id":"","url":"https://api.github.com/users/jprante","html_url":"https://github.com/jprante","followers_url":"https://api.github.com/users/jprante/followers","following_url":"https://api.github.com/users/jprante/following{/other_user}","gists_url":"https://api.github.com/users/jprante/gists{/gist_id}","starred_url":"https://api.github.com/users/jprante/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jprante/subscriptions","organizations_url":"https://api.github.com/users/jprante/orgs","repos_url":"https://api.github.com/users/jprante/repos","events_url":"https://api.github.com/users/jprante/events{/privacy}","received_events_url":"https://api.github.com/users/jprante/received_events","type":"User","site_admin":false},"created_at":"2013-06-10T07:25:25Z","updated_at":"2013-06-10T07:25:25Z","author_association":"CONTRIBUTOR","body":"A popular reason of this kind of error is a server-side exception generated by an optional jar, which is not present at client side. Geo uses the optional spatial4j jar so my recommendation is to add the spatial4j jar to the client classpath.\nThis also holds for all kind of plugins, if plugin jars are not present in client classpath and throw exceptions, they might fail while decoding.\nAnother option is to add more logging statements on server side so it is easier to track runtime execptions in the server logs.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19273166","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19273166","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19273166,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MjczMTY2","user":{"login":"eonnen","id":63275,"node_id":"MDQ6VXNlcjYzMjc1","avatar_url":"https://avatars2.githubusercontent.com/u/63275?v=4","gravatar_id":"","url":"https://api.github.com/users/eonnen","html_url":"https://github.com/eonnen","followers_url":"https://api.github.com/users/eonnen/followers","following_url":"https://api.github.com/users/eonnen/following{/other_user}","gists_url":"https://api.github.com/users/eonnen/gists{/gist_id}","starred_url":"https://api.github.com/users/eonnen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eonnen/subscriptions","organizations_url":"https://api.github.com/users/eonnen/orgs","repos_url":"https://api.github.com/users/eonnen/repos","events_url":"https://api.github.com/users/eonnen/events{/privacy}","received_events_url":"https://api.github.com/users/eonnen/received_events","type":"User","site_admin":false},"created_at":"2013-06-11T16:25:47Z","updated_at":"2013-06-11T16:25:47Z","author_association":"NONE","body":"@jprante, doesn't the TransportClient simply submit a JSON representation of a document with nested fields? I'm not sure I understand why the client needs to have the ability to create a geospatial representation of what is effectively a text document. Regardless, the client's classpath was that of the POM which includes lucene-spatial and as a dependency spatial4j.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19274809","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19274809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19274809,"node_id":"MDEyOklzc3VlQ29tbWVudDE5Mjc0ODA5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-06-11T16:54:35Z","updated_at":"2013-06-11T16:54:35Z","author_association":"CONTRIBUTOR","body":"@eonnen I had no luck reproducing this one yesterday but I will give it another go tomorrow. Yet, the transport client still talks binary and not json via HTTP\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/19397133","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-19397133","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":19397133,"node_id":"MDEyOklzc3VlQ29tbWVudDE5Mzk3MTMz","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-06-13T14:55:52Z","updated_at":"2013-06-13T14:55:52Z","author_association":"CONTRIBUTOR","body":"@eonnen I used 0.90 and started 2 nodes on localhost:9200 and localhost:9201 (transport 9300 / 9301 respectively) Then I ran  https://gist.github.com/s1monw/5774329 and I don't see any issues. Can you try to run this against your setup or extend it so that it reproduces?\n\nsimon\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/26333352","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-26333352","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":26333352,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzMzMzUy","user":{"login":"tkurki","id":1049678,"node_id":"MDQ6VXNlcjEwNDk2Nzg=","avatar_url":"https://avatars3.githubusercontent.com/u/1049678?v=4","gravatar_id":"","url":"https://api.github.com/users/tkurki","html_url":"https://github.com/tkurki","followers_url":"https://api.github.com/users/tkurki/followers","following_url":"https://api.github.com/users/tkurki/following{/other_user}","gists_url":"https://api.github.com/users/tkurki/gists{/gist_id}","starred_url":"https://api.github.com/users/tkurki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tkurki/subscriptions","organizations_url":"https://api.github.com/users/tkurki/orgs","repos_url":"https://api.github.com/users/tkurki/repos","events_url":"https://api.github.com/users/tkurki/events{/privacy}","received_events_url":"https://api.github.com/users/tkurki/received_events","type":"User","site_admin":false},"created_at":"2013-10-15T13:24:10Z","updated_at":"2013-10-15T13:24:10Z","author_association":"NONE","body":"I am seeing something similar here, but my case is really different: client throws \n\n```\nCaused by: java.io.EOFException\n    at java.io.ObjectInputStream$BlockDataInputStream.peekByte(ObjectInputStream.java:2597)\n    at java.io.ObjectInputStream.skipCustomData(ObjectInputStream.java:1942)\n    at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1916)\n...\n    at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370)\n    at org.elasticsearch.transport.netty.MessageChannelHandler.handlerResponseError(MessageChannelHandler.java:301)\n```\n\nwhen doing simple search.\n\nDigging strings from the data in the buffer just previous to trying to read it with ThrowableObjectInputStream shows stuff like\n\n```\n4org.elasticsearch.transport.RemoteTransportExceptionxr\n4org.elasticsearch.transport.ActionTransportExceptionxr\n.org.elasticsearch.transport.TransportExceptionxr\n(org.elasticsearch.ElasticSearchExceptionxr\njava.lang.RuntimeExceptionxr\njava.lang.Throwablexpsr\n/org.elasticsearch.indices.IndexMissingExceptionxr\n&org.elasticsearch.index.IndexExceptionxq\n```\n\nso in my case it looks like a simple case of missing index, but reporting the error is breaking. \n\nOnly it isn't, because the index is there and you can search it via http json...\n\nI have been previously burned by trying to return serialized Exceptions over the wire  and the client failing because of some incompatibility between server and client side classpaths. I think the prudent way of handling server side errors is to return String based well defined Error objects and logging stacktraces on the server side. Otherwise this type of \"sorry, we failed while failing\" can crop up. \n\nHaven't looked at the code yet though, it is possible I'm barking up the wrong tree.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/27453710","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-27453710","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":27453710,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NDUzNzEw","user":{"login":"fizx","id":8024,"node_id":"MDQ6VXNlcjgwMjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/8024?v=4","gravatar_id":"","url":"https://api.github.com/users/fizx","html_url":"https://github.com/fizx","followers_url":"https://api.github.com/users/fizx/followers","following_url":"https://api.github.com/users/fizx/following{/other_user}","gists_url":"https://api.github.com/users/fizx/gists{/gist_id}","starred_url":"https://api.github.com/users/fizx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fizx/subscriptions","organizations_url":"https://api.github.com/users/fizx/orgs","repos_url":"https://api.github.com/users/fizx/repos","events_url":"https://api.github.com/users/fizx/events{/privacy}","received_events_url":"https://api.github.com/users/fizx/received_events","type":"User","site_admin":false},"created_at":"2013-10-31T01:02:57Z","updated_at":"2013-10-31T01:02:57Z","author_association":"NONE","body":"This error can easily be duplicated by starting a cluster with some nodes running JRE 1.7.0_17, and other nodes running JRE 1.7.0_45.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/27455667","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-27455667","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":27455667,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NDU1NjY3","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2013-10-31T01:55:22Z","updated_at":"2013-10-31T01:55:22Z","author_association":"MEMBER","body":"This happens because sadly, Java broke backward compatibility between 1.7.0_17 and 1.7.0_2x in how InetAddress gets serialized over the network. The only place in ES where we use Java serialization is when we serialize exceptions (since we don't want to write custom serializers for each one), and we use exception for state management (i.e. try to perform an operation on a node that is not ready). Sadly, part of those exception is an InetAddress, which causes this serialization problem...\n\nThere is nothing much we can do with current versions, except for asking to make sure not to run on mixed <=1.7.0_17 and >= 1.7.0_2x versions in the same cluster....\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29014479","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-29014479","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":29014479,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDE0NDc5","user":{"login":"JacekLach","id":1210649,"node_id":"MDQ6VXNlcjEyMTA2NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/1210649?v=4","gravatar_id":"","url":"https://api.github.com/users/JacekLach","html_url":"https://github.com/JacekLach","followers_url":"https://api.github.com/users/JacekLach/followers","following_url":"https://api.github.com/users/JacekLach/following{/other_user}","gists_url":"https://api.github.com/users/JacekLach/gists{/gist_id}","starred_url":"https://api.github.com/users/JacekLach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JacekLach/subscriptions","organizations_url":"https://api.github.com/users/JacekLach/orgs","repos_url":"https://api.github.com/users/JacekLach/repos","events_url":"https://api.github.com/users/JacekLach/events{/privacy}","received_events_url":"https://api.github.com/users/JacekLach/received_events","type":"User","site_admin":false},"created_at":"2013-11-21T19:18:24Z","updated_at":"2013-11-21T19:18:24Z","author_association":"NONE","body":"FYI: this also happens on java6 between 1.6.0_43 and 1.6.0_45.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29541505","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-29541505","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":29541505,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NTQxNTA1","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2013-11-29T23:35:14Z","updated_at":"2013-11-29T23:35:14Z","author_association":"MEMBER","body":"grrr, so annoying..., though we don't really have control over it, apologies....\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/33411884","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-33411884","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":33411884,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNDExODg0","user":{"login":"josegonzalez","id":65675,"node_id":"MDQ6VXNlcjY1Njc1","avatar_url":"https://avatars2.githubusercontent.com/u/65675?v=4","gravatar_id":"","url":"https://api.github.com/users/josegonzalez","html_url":"https://github.com/josegonzalez","followers_url":"https://api.github.com/users/josegonzalez/followers","following_url":"https://api.github.com/users/josegonzalez/following{/other_user}","gists_url":"https://api.github.com/users/josegonzalez/gists{/gist_id}","starred_url":"https://api.github.com/users/josegonzalez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josegonzalez/subscriptions","organizations_url":"https://api.github.com/users/josegonzalez/orgs","repos_url":"https://api.github.com/users/josegonzalez/repos","events_url":"https://api.github.com/users/josegonzalez/events{/privacy}","received_events_url":"https://api.github.com/users/josegonzalez/received_events","type":"User","site_admin":false},"created_at":"2014-01-27T19:35:04Z","updated_at":"2014-01-27T19:35:04Z","author_association":"CONTRIBUTOR","body":"I just ran into this issue. Shards are constantly reallocating themselves and failing :(\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/33413004","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-33413004","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":33413004,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNDEzMDA0","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-01-27T19:46:19Z","updated_at":"2014-01-27T19:46:19Z","author_association":"MEMBER","body":"@josegonzalez make sure you run the same Java version across nodes?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/33413467","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-33413467","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":33413467,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNDEzNDY3","user":{"login":"josegonzalez","id":65675,"node_id":"MDQ6VXNlcjY1Njc1","avatar_url":"https://avatars2.githubusercontent.com/u/65675?v=4","gravatar_id":"","url":"https://api.github.com/users/josegonzalez","html_url":"https://github.com/josegonzalez","followers_url":"https://api.github.com/users/josegonzalez/followers","following_url":"https://api.github.com/users/josegonzalez/following{/other_user}","gists_url":"https://api.github.com/users/josegonzalez/gists{/gist_id}","starred_url":"https://api.github.com/users/josegonzalez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josegonzalez/subscriptions","organizations_url":"https://api.github.com/users/josegonzalez/orgs","repos_url":"https://api.github.com/users/josegonzalez/repos","events_url":"https://api.github.com/users/josegonzalez/events{/privacy}","received_events_url":"https://api.github.com/users/josegonzalez/received_events","type":"User","site_admin":false},"created_at":"2014-01-27T19:50:26Z","updated_at":"2014-01-27T19:50:26Z","author_association":"CONTRIBUTOR","body":"Yeah I fixed it. Here's what happened in my case:\n\nWe brought up a new node for our api elasticsearch cluster, and this new node had Java `1.7.0_51`. The old nodes ran `1.7.0_16` (I believe). I ended up updating java everywhere.\n\nOnce java is installed, elasticsearch is started. Installing java does not automatically restart elasticsearch, and neither does upgrading. So we ended up running two different versions for in the cluster, even though `java -version` produced `1.7.0_51` everywhere.\n\nI had to restart all older nodes in the cluster, which then allowed replication to proceed as advertised.\n\nJava should really have a sticker on it \"please don't touch me, ok thx bye\" :)\n\nMight be worth mentioning this in the docs somewhere, maybe an FAQ.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/33998261","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-33998261","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":33998261,"node_id":"MDEyOklzc3VlQ29tbWVudDMzOTk4MjYx","user":{"login":"matiwinnetou","id":335933,"node_id":"MDQ6VXNlcjMzNTkzMw==","avatar_url":"https://avatars0.githubusercontent.com/u/335933?v=4","gravatar_id":"","url":"https://api.github.com/users/matiwinnetou","html_url":"https://github.com/matiwinnetou","followers_url":"https://api.github.com/users/matiwinnetou/followers","following_url":"https://api.github.com/users/matiwinnetou/following{/other_user}","gists_url":"https://api.github.com/users/matiwinnetou/gists{/gist_id}","starred_url":"https://api.github.com/users/matiwinnetou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matiwinnetou/subscriptions","organizations_url":"https://api.github.com/users/matiwinnetou/orgs","repos_url":"https://api.github.com/users/matiwinnetou/repos","events_url":"https://api.github.com/users/matiwinnetou/events{/privacy}","received_events_url":"https://api.github.com/users/matiwinnetou/received_events","type":"User","site_admin":false},"created_at":"2014-02-03T20:49:24Z","updated_at":"2014-02-03T20:49:24Z","author_association":"NONE","body":"Would it make sense to replace standard Java Serialization with another serialization protocol?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34009813","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-34009813","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":34009813,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDA5ODEz","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-02-03T22:43:52Z","updated_at":"2014-02-03T22:43:52Z","author_association":"MEMBER","body":"@mati1979 we only use standard Java serialization for serializing exceptions, for most cases where the request/response are not exception driven, we use our own custom serialization\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40274254","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-40274254","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":40274254,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjc0MjU0","user":{"login":"aphyr","id":3748,"node_id":"MDQ6VXNlcjM3NDg=","avatar_url":"https://avatars3.githubusercontent.com/u/3748?v=4","gravatar_id":"","url":"https://api.github.com/users/aphyr","html_url":"https://github.com/aphyr","followers_url":"https://api.github.com/users/aphyr/followers","following_url":"https://api.github.com/users/aphyr/following{/other_user}","gists_url":"https://api.github.com/users/aphyr/gists{/gist_id}","starred_url":"https://api.github.com/users/aphyr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aphyr/subscriptions","organizations_url":"https://api.github.com/users/aphyr/orgs","repos_url":"https://api.github.com/users/aphyr/repos","events_url":"https://api.github.com/users/aphyr/events{/privacy}","received_events_url":"https://api.github.com/users/aphyr/received_events","type":"User","site_admin":false},"created_at":"2014-04-12T07:41:52Z","updated_at":"2014-04-12T07:41:52Z","author_association":"NONE","body":"Chiming in that this also breaks _clients_ which use different JVM patchlevels, and I imagine it makes doing any kind of rolling upgrade something of a headache. Might consider serializing exceptions as a [classname-str message-str [stacktrace-line stacktrace-line ...]] structure, under the premise that some information is better than no information about the underlying error. If you're relying on try/catch dispatch for Elasticsch exception types, you can always define a custom deserializer for those; it's only the underlying exceptions you don't control that need a fallback mechanism.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40274372","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-40274372","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":40274372,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjc0Mzcy","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-04-12T07:47:54Z","updated_at":"2014-04-12T07:52:26Z","author_association":"MEMBER","body":"there is a thread on the mailing list about it. This is the first time Java broke serialization for exceptions in the 4.5 years the codebase exists. While annoying, the question is if we should now write custom logic to serialize exceptions. \n\nExceptions hold more than just what you described, since they also hold variables and the class type itself, so your solution won't work. One option is to use something like Jackson object mapper to serialize the exceptions in a generic fashion. If we see this pattern repeating in java (at least one more time), then we will do it (which comes with other costs obviously, you still rely on _a_ serialization).\n\nSide note, you are running your servers on 1.7.0_03, make sure you don't do that as it is known to be a problematic java version (in many different aspects). Use _25.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40274505","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-40274505","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":40274505,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjc0NTA1","user":{"login":"aphyr","id":3748,"node_id":"MDQ6VXNlcjM3NDg=","avatar_url":"https://avatars3.githubusercontent.com/u/3748?v=4","gravatar_id":"","url":"https://api.github.com/users/aphyr","html_url":"https://github.com/aphyr","followers_url":"https://api.github.com/users/aphyr/followers","following_url":"https://api.github.com/users/aphyr/following{/other_user}","gists_url":"https://api.github.com/users/aphyr/gists{/gist_id}","starred_url":"https://api.github.com/users/aphyr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aphyr/subscriptions","organizations_url":"https://api.github.com/users/aphyr/orgs","repos_url":"https://api.github.com/users/aphyr/repos","events_url":"https://api.github.com/users/aphyr/events{/privacy}","received_events_url":"https://api.github.com/users/aphyr/received_events","type":"User","site_admin":false},"created_at":"2014-04-12T07:55:27Z","updated_at":"2014-04-12T07:55:27Z","author_association":"NONE","body":"I am not really an expert in these sorts of things, and of course defer to your judgement and expertise, but might I suggest defining a taxonomy of the errors which occur in your system, and having a formally specified, platform-independent representation of those errors on the wire--such that clients running on other JVMs or even clients from other runtimes could interpret those errors in a common fashion?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40275408","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-40275408","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":40275408,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMjc1NDA4","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-04-12T08:48:14Z","updated_at":"2014-04-12T08:48:14Z","author_association":"MEMBER","body":"that would be nice!, and something that potentially will be worth the investment to do. \n\nThe taxonomy of external errors today for external clients follows the rest status codes, as most of our clients talk to ES through HTTP. In JVM based languages using the java client, each error can be cast to an http response code.\n\nFor internal errors, or node (client) to node erros the idea behind using Java serialization for exceptions is to try and preserve the full information of the exception and propagate it through the chain of nodes that handles the request. Those exceptions many times come from low level operations like network or file system. This allows for example to give detailed information on why something failed not necessarily on the node that it actually failed on (this helps a lot when it comes to debugging). \n\nFor example, if a shard failed, the master node will log that information without needing to go and chase where that shard failed to try and understand why it failed.\n\nLast, the other aspect that makes it super hard is the fact that Java doesn't have a good taxonomy of exceptions. Just check IOException :). At least in that case, by not loosing the type and info, we can potentially do better not only where the actual type is around...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/41771784","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-41771784","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":41771784,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzcxNzg0","user":{"login":"ppuschmann","id":3431761,"node_id":"MDQ6VXNlcjM0MzE3NjE=","avatar_url":"https://avatars0.githubusercontent.com/u/3431761?v=4","gravatar_id":"","url":"https://api.github.com/users/ppuschmann","html_url":"https://github.com/ppuschmann","followers_url":"https://api.github.com/users/ppuschmann/followers","following_url":"https://api.github.com/users/ppuschmann/following{/other_user}","gists_url":"https://api.github.com/users/ppuschmann/gists{/gist_id}","starred_url":"https://api.github.com/users/ppuschmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppuschmann/subscriptions","organizations_url":"https://api.github.com/users/ppuschmann/orgs","repos_url":"https://api.github.com/users/ppuschmann/repos","events_url":"https://api.github.com/users/ppuschmann/events{/privacy}","received_events_url":"https://api.github.com/users/ppuschmann/received_events","type":"User","site_admin":false},"created_at":"2014-04-30T08:23:41Z","updated_at":"2014-04-30T08:23:41Z","author_association":"NONE","body":"Hi, I also ran in the same issue when applying security fixes for one server (1.6.0_18 vs. 1.6.0_31) running an ES 0.19.12 cluster (with only http-clients).\n\nVery interesting to see that the one node with the wrong (higher) version-number had no entries in its log-files while others that want to replicate shards to \"the one\" had a lot of exceptions.\n\nIs there a plan how to get this fixed? And how should we do an update of the JRE?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/141693038","html_url":"https://github.com/elastic/elasticsearch/issues/3145#issuecomment-141693038","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3145","id":141693038,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MTY5MzAzOA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-19T17:44:37Z","updated_at":"2015-09-19T17:44:37Z","author_association":"CONTRIBUTOR","body":"This has been implemented in #11910\n","performed_via_github_app":null}]