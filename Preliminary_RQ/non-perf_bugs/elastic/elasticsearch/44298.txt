{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44298","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44298/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44298/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44298/events","html_url":"https://github.com/elastic/elasticsearch/issues/44298","id":467616360,"node_id":"MDU6SXNzdWU0Njc2MTYzNjA=","number":44298,"title":"Consider adding field alias information to field caps.","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-07-12T21:59:33Z","updated_at":"2019-11-18T19:18:21Z","closed_at":"2019-11-18T19:18:21Z","author_association":"MEMBER","active_lock_reason":null,"body":"When used in a search, field aliases have some limitations compared to concrete fields (as described in [unsupported APIs](https://www.elastic.co/guide/en/elasticsearch/reference/master/alias.html#unsupported-apis)). One important limitation is that field aliases do not appear in the document `_source`, and so their values cannot be retrieved through `_source` filtering.\r\n\r\nFor this reason, applications may need to add special handling for field aliases when working with the `_source` from search results. Currently, the `_field_caps` API presents a completely transparent view of field aliases -- requesting field caps for an alias will return the same output as if it were mapped as a concrete field. One proposal is to include a new `aliases` section that indicates the field is an alias, and gives information about its target:\r\n\r\n```\r\n{\r\n  \"indices\" : [ \"index1\", \"index2\" ],\r\n  \"fields\" : {\r\n    \"alias_field\" : {\r\n      \"keyword\" : {\r\n        \"type\" : \"keyword\",\r\n        \"searchable\" : true,\r\n        \"aggregatable\" : true\r\n      }\r\n    }\r\n  },\r\n  \"aliases\": {\r\n    \"alias_field\": [{\r\n      \"path\": \"concrete_field\",\r\n      \"indices\": [ \"index2\" ]\r\n    }]\r\n  }\r\n}\r\n```\r\n\r\nTo me this seems like an acceptable addition to field caps and is not just creating a 'leaky abstraction'. The fact that a field is an alias has an impact on its capabilities, and an application may want to add special handling for this case.\r\n\r\n**Motivation**\r\n\r\nES SQL currently loads field values from `doc_values`, but is exploring loading some values from `_source` (https://github.com/elastic/elasticsearch/pull/44062). If a field alias is specified, SQL needs to understand that it is an alias in order to either fall back to `doc_values`, or resolve it to its target in order to extract its value from `_source`. ES SQL uses field caps to retrieve information about fields across indices/ clusters, and does not have knowledge of the original field mappings.\r\n\r\nIn Kibana's Discover app, field aliases currently do not show up on the left-hand panel or in the body of search results, because this data is pulled directly from `_source`. Having knowledge of field aliases in the index pattern could allow Kibana to show the aliases associated with concrete fields in the documents (https://github.com/elastic/kibana/issues/28570). Kibana index patterns pull information from field caps, so this could be a helpful addition to the API.\r\n\r\n**Alternative approaches**\r\n\r\nAnother approach would be to try to take field aliases into account when filtering and returning `_source`. To me this seems more confusing from an API perspective:\r\n- Would filtering on `\"my_object.*\"` look up matching field aliases and try to include their targets in the returned `_source`? Or is it interpreted as just taking the `_source` and filtering out the parts that don't match `\"my_object.*\"`?\r\n- It's not clear how field alias information could be returned as part of the `_source`. We do not want to modify or rewrite `_source` because it should represent exactly what was provided when indexing the document.","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}