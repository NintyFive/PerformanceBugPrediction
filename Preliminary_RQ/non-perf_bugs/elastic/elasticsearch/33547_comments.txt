[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419715191","html_url":"https://github.com/elastic/elasticsearch/issues/33547#issuecomment-419715191","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33547","id":419715191,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTcxNTE5MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-09-09T13:13:31Z","updated_at":"2018-09-09T13:13:31Z","author_association":"MEMBER","body":"The v6.4.0 tag in the repository is wrong, it is not pointing to the commit used for the 6.4.0 release. Currently it is pointing to 1a122904dd29df3f8692310437fd37267706d84b yet it should be 595516e45d054483dcdaf12f0468a59cb34bb568.\r\n\r\nI can imagine this having cost you precious time, I am so sorry that you were led astray by this. We will take steps in our release process to ensure that a mistake like this does not happen again.\r\n\r\nDownload 6.4.0:\r\n\r\n```\r\n08:45:54 1d [jason@totoro:~] $ cd /tmp\r\n08:49:37 1d [jason@totoro:/tmp] $ mkdir -p elasticsearch/6.4.0\r\n08:49:51 1d [jason@totoro:/tmp] $ cd elasticsearch/6.4.0/\r\n08:49:54 1d [jason@totoro:/tmp/elasticsearch/6.4.0] $ curl -L https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.4.0.tar.gz | tar zx --strip-components=1 -C .\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 93.3M  100 93.3M    0     0  19.0M      0  0:00:04  0:00:04 --:--:-- 27.6M\r\n08:50:47 1d [jason@totoro:/tmp/elasticsearch/6.4.0] $ cd modules/x-pack-rollup/\r\n```\r\n\r\nExtract the rollup JAR:\r\n\r\n```\r\n08:51:11 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup] $ mkdir jar\r\n08:51:18 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup] $ cp x-pack-rollup-6.4.0.jar jar\r\n08:51:21 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup] $ cd jar\r\n08:51:22 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup/jar] $ jar xf x-pack-rollup-6.4.0.jar \r\nbash: jar: command not found...\r\n08:51:29 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup/jar] 127 $ /opt/java/jdk-10/bin/jar xf x-pack-rollup-6.4.0.jar \r\n```\r\n\r\nCheck the manifest:\r\n\r\n```\r\n08:51:38 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup/jar] $ cat META-INF/MANIFEST.MF \r\nManifest-Version: 1.0\r\nImplementation-Title: org.elasticsearch.plugin#rollup;6.4.0\r\nImplementation-Version: 6.4.0\r\nBuilt-Status: integration\r\nBuilt-By: vagrant\r\nBuilt-OS: Linux\r\nBuild-Date: 2018-08-17T23:23:09.084479Z\r\nGradle-Version: 4.9\r\nCreated-By: 10+46 (Oracle Corporation)\r\nBuild-Java-Version: 1.10\r\nModule-Source: /x-pack/plugin/rollup\r\nModule-Origin: git@github.com:elastic/elasticsearch.git\r\nChange: 595516e\r\nBranch: 595516e45d054483dcdaf12f0468a59cb34bb568\r\nX-Compile-Target-JDK: 1.8\r\nX-Compile-Source-JDK: 1.8\r\nX-Compile-Elasticsearch-Version: 6.4.0\r\nX-Compile-Lucene-Version: 7.4.0\r\nX-Compile-Elasticsearch-Snapshot: false\r\n\r\n```\r\n\r\nLooks good. Let's disassemble the code:\r\n\r\n```\r\n08:51:58 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup/jar] $ /opt/java/jdk-10/bin/javap -c org.elasticsearch.xpack.rollup.Rollup\r\nCompiled from \"Rollup.java\"\r\npublic class org.elasticsearch.xpack.rollup.Rollup extends org.elasticsearch.plugins.Plugin implements org.elasticsearch.plugins.ActionPlugin,org.elasticsearch.plugins.PersistentTaskPlugin {\r\n  public static final java.lang.String BASE_PATH;\r\n\r\n  public static final int ROLLUP_VERSION_V1;\r\n\r\n  public static final int ROLLUP_VERSION_V2;\r\n\r\n  public static final int CURRENT_ROLLUP_VERSION;\r\n\r\n  public static final java.lang.String TASK_THREAD_POOL_NAME;\r\n\r\n  public static final java.lang.String SCHEDULE_THREAD_POOL_NAME;\r\n\r\n  public static final java.lang.String MAPPING_METADATA_PLACEHOLDER;\r\n\r\n  public static final java.lang.String ROLLUP_TEMPLATE_VERSION_FIELD;\r\n\r\n  public static final java.lang.String ROLLUP_TEMPLATE_VERSION_PATTERN;\r\n\r\n  public static final java.lang.String DYNAMIC_MAPPING_TEMPLATE;\r\n\r\n  public static final java.util.Set<java.lang.String> HEADER_FILTERS;\r\n\r\n  public org.elasticsearch.xpack.rollup.Rollup(org.elasticsearch.common.settings.Settings);\r\n    Code:\r\n       0: aload_0\r\n       1: invokespecial #3                  // Method org/elasticsearch/plugins/Plugin.\"<init>\":()V\r\n       4: aload_0\r\n       5: aload_1\r\n       6: putfield      #4                  // Field settings:Lorg/elasticsearch/common/settings/Settings;\r\n       9: aload_0\r\n      10: getstatic     #5                  // Field org/elasticsearch/xpack/core/XPackSettings.ROLLUP_ENABLED:Lorg/elasticsearch/common/settings/Setting;\r\n      13: aload_1\r\n      14: invokevirtual #6                  // Method org/elasticsearch/common/settings/Setting.get:(Lorg/elasticsearch/common/settings/Settings;)Ljava/lang/Object;\r\n      17: checkcast     #7                  // class java/lang/Boolean\r\n      20: invokevirtual #8                  // Method java/lang/Boolean.booleanValue:()Z\r\n      23: putfield      #9                  // Field enabled:Z\r\n      26: aload_0\r\n      27: aload_1\r\n      28: invokestatic  #10                 // Method org/elasticsearch/xpack/core/XPackPlugin.transportClientMode:(Lorg/elasticsearch/common/settings/Settings;)Z\r\n      31: putfield      #11                 // Field transportClientMode:Z\r\n      34: return\r\n\r\n  public java.util.Collection<java.lang.Object> createComponents(org.elasticsearch.client.Client, org.elasticsearch.cluster.service.ClusterService, org.elasticsearch.threadpool.ThreadPool, org.elasticsearch.watcher.ResourceWatcherService, org.elasticsearch.script.ScriptService, org.elasticsearch.common.xcontent.NamedXContentRegistry, org.elasticsearch.env.Environment, org.elasticsearch.env.NodeEnvironment, org.elasticsearch.common.io.stream.NamedWriteableRegistry);\r\n    Code:\r\n       0: invokestatic  #12                 // Method java/util/Collections.emptyList:()Ljava/util/List;\r\n       3: areturn\r\n\r\n  public java.util.Collection<org.elasticsearch.common.inject.Module> createGuiceModules();\r\n    Code:\r\n       0: new           #13                 // class java/util/ArrayList\r\n       3: dup\r\n       4: invokespecial #14                 // Method java/util/ArrayList.\"<init>\":()V\r\n       7: astore_1\r\n       8: aload_0\r\n       9: getfield      #11                 // Field transportClientMode:Z\r\n      12: ifeq          17\r\n      15: aload_1\r\n      16: areturn\r\n      17: aload_1\r\n      18: invokedynamic #15,  0             // InvokeDynamic #0:configure:()Lorg/elasticsearch/common/inject/Module;\r\n      23: invokeinterface #16,  2           // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z\r\n      28: pop\r\n      29: aload_1\r\n      30: areturn\r\n\r\n  protected org.elasticsearch.license.XPackLicenseState getLicenseState();\r\n    Code:\r\n       0: invokestatic  #17                 // Method org/elasticsearch/xpack/core/XPackPlugin.getSharedLicenseState:()Lorg/elasticsearch/license/XPackLicenseState;\r\n       3: areturn\r\n\r\n  public java.util.List<org.elasticsearch.rest.RestHandler> getRestHandlers(org.elasticsearch.common.settings.Settings, org.elasticsearch.rest.RestController, org.elasticsearch.common.settings.ClusterSettings, org.elasticsearch.common.settings.IndexScopedSettings, org.elasticsearch.common.settings.SettingsFilter, org.elasticsearch.cluster.metadata.IndexNameExpressionResolver, java.util.function.Supplier<org.elasticsearch.cluster.node.DiscoveryNodes>);\r\n    Code:\r\n       0: aload_0\r\n       1: getfield      #9                  // Field enabled:Z\r\n       4: ifne          11\r\n       7: invokestatic  #12                 // Method java/util/Collections.emptyList:()Ljava/util/List;\r\n      10: areturn\r\n      11: bipush        8\r\n      13: anewarray     #18                 // class org/elasticsearch/rest/RestHandler\r\n      16: dup\r\n      17: iconst_0\r\n      18: new           #19                 // class org/elasticsearch/xpack/rollup/rest/RestRollupSearchAction\r\n      21: dup\r\n      22: aload_1\r\n      23: aload_2\r\n      24: invokespecial #20                 // Method org/elasticsearch/xpack/rollup/rest/RestRollupSearchAction.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/rest/RestController;)V\r\n      27: aastore\r\n      28: dup\r\n      29: iconst_1\r\n      30: new           #21                 // class org/elasticsearch/xpack/rollup/rest/RestPutRollupJobAction\r\n      33: dup\r\n      34: aload_1\r\n      35: aload_2\r\n      36: invokespecial #22                 // Method org/elasticsearch/xpack/rollup/rest/RestPutRollupJobAction.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/rest/RestController;)V\r\n      39: aastore\r\n      40: dup\r\n      41: iconst_2\r\n      42: new           #23                 // class org/elasticsearch/xpack/rollup/rest/RestStartRollupJobAction\r\n      45: dup\r\n      46: aload_1\r\n      47: aload_2\r\n      48: invokespecial #24                 // Method org/elasticsearch/xpack/rollup/rest/RestStartRollupJobAction.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/rest/RestController;)V\r\n      51: aastore\r\n      52: dup\r\n      53: iconst_3\r\n      54: new           #25                 // class org/elasticsearch/xpack/rollup/rest/RestStopRollupJobAction\r\n      57: dup\r\n      58: aload_1\r\n      59: aload_2\r\n      60: invokespecial #26                 // Method org/elasticsearch/xpack/rollup/rest/RestStopRollupJobAction.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/rest/RestController;)V\r\n      63: aastore\r\n      64: dup\r\n      65: iconst_4\r\n      66: new           #27                 // class org/elasticsearch/xpack/rollup/rest/RestDeleteRollupJobAction\r\n      69: dup\r\n      70: aload_1\r\n      71: aload_2\r\n      72: invokespecial #28                 // Method org/elasticsearch/xpack/rollup/rest/RestDeleteRollupJobAction.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/rest/RestController;)V\r\n      75: aastore\r\n      76: dup\r\n      77: iconst_5\r\n      78: new           #29                 // class org/elasticsearch/xpack/rollup/rest/RestGetRollupJobsAction\r\n      81: dup\r\n      82: aload_1\r\n      83: aload_2\r\n      84: invokespecial #30                 // Method org/elasticsearch/xpack/rollup/rest/RestGetRollupJobsAction.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/rest/RestController;)V\r\n      87: aastore\r\n      88: dup\r\n      89: bipush        6\r\n      91: new           #31                 // class org/elasticsearch/xpack/rollup/rest/RestGetRollupCapsAction\r\n      94: dup\r\n      95: aload_1\r\n      96: aload_2\r\n      97: invokespecial #32                 // Method org/elasticsearch/xpack/rollup/rest/RestGetRollupCapsAction.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/rest/RestController;)V\r\n     100: aastore\r\n     101: dup\r\n     102: bipush        7\r\n     104: new           #33                 // class org/elasticsearch/xpack/rollup/rest/RestGetRollupIndexCapsAction\r\n     107: dup\r\n     108: aload_1\r\n     109: aload_2\r\n     110: invokespecial #34                 // Method org/elasticsearch/xpack/rollup/rest/RestGetRollupIndexCapsAction.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/rest/RestController;)V\r\n     113: aastore\r\n     114: invokestatic  #35                 // Method java/util/Arrays.asList:([Ljava/lang/Object;)Ljava/util/List;\r\n     117: areturn\r\n\r\n  public java.util.List<org.elasticsearch.plugins.ActionPlugin$ActionHandler<? extends org.elasticsearch.action.ActionRequest, ? extends org.elasticsearch.action.ActionResponse>> getActions();\r\n    Code:\r\n       0: aload_0\r\n       1: getfield      #9                  // Field enabled:Z\r\n       4: ifne          11\r\n       7: invokestatic  #12                 // Method java/util/Collections.emptyList:()Ljava/util/List;\r\n      10: areturn\r\n      11: bipush        8\r\n      13: anewarray     #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n      16: dup\r\n      17: iconst_0\r\n      18: new           #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n      21: dup\r\n      22: getstatic     #37                 // Field org/elasticsearch/xpack/core/rollup/action/RollupSearchAction.INSTANCE:Lorg/elasticsearch/xpack/core/rollup/action/RollupSearchAction;\r\n      25: ldc           #38                 // class org/elasticsearch/xpack/rollup/action/TransportRollupSearchAction\r\n      27: iconst_0\r\n      28: anewarray     #39                 // class java/lang/Class\r\n      31: invokespecial #40                 // Method org/elasticsearch/plugins/ActionPlugin$ActionHandler.\"<init>\":(Lorg/elasticsearch/action/GenericAction;Ljava/lang/Class;[Ljava/lang/Class;)V\r\n      34: aastore\r\n      35: dup\r\n      36: iconst_1\r\n      37: new           #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n      40: dup\r\n      41: getstatic     #41                 // Field org/elasticsearch/xpack/core/rollup/action/PutRollupJobAction.INSTANCE:Lorg/elasticsearch/xpack/core/rollup/action/PutRollupJobAction;\r\n      44: ldc           #42                 // class org/elasticsearch/xpack/rollup/action/TransportPutRollupJobAction\r\n      46: iconst_0\r\n      47: anewarray     #39                 // class java/lang/Class\r\n      50: invokespecial #40                 // Method org/elasticsearch/plugins/ActionPlugin$ActionHandler.\"<init>\":(Lorg/elasticsearch/action/GenericAction;Ljava/lang/Class;[Ljava/lang/Class;)V\r\n      53: aastore\r\n      54: dup\r\n      55: iconst_2\r\n      56: new           #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n      59: dup\r\n      60: getstatic     #43                 // Field org/elasticsearch/xpack/core/rollup/action/StartRollupJobAction.INSTANCE:Lorg/elasticsearch/xpack/core/rollup/action/StartRollupJobAction;\r\n      63: ldc           #44                 // class org/elasticsearch/xpack/rollup/action/TransportStartRollupAction\r\n      65: iconst_0\r\n      66: anewarray     #39                 // class java/lang/Class\r\n      69: invokespecial #40                 // Method org/elasticsearch/plugins/ActionPlugin$ActionHandler.\"<init>\":(Lorg/elasticsearch/action/GenericAction;Ljava/lang/Class;[Ljava/lang/Class;)V\r\n      72: aastore\r\n      73: dup\r\n      74: iconst_3\r\n      75: new           #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n      78: dup\r\n      79: getstatic     #45                 // Field org/elasticsearch/xpack/core/rollup/action/StopRollupJobAction.INSTANCE:Lorg/elasticsearch/xpack/core/rollup/action/StopRollupJobAction;\r\n      82: ldc           #46                 // class org/elasticsearch/xpack/rollup/action/TransportStopRollupAction\r\n      84: iconst_0\r\n      85: anewarray     #39                 // class java/lang/Class\r\n      88: invokespecial #40                 // Method org/elasticsearch/plugins/ActionPlugin$ActionHandler.\"<init>\":(Lorg/elasticsearch/action/GenericAction;Ljava/lang/Class;[Ljava/lang/Class;)V\r\n      91: aastore\r\n      92: dup\r\n      93: iconst_4\r\n      94: new           #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n      97: dup\r\n      98: getstatic     #47                 // Field org/elasticsearch/xpack/core/rollup/action/DeleteRollupJobAction.INSTANCE:Lorg/elasticsearch/xpack/core/rollup/action/DeleteRollupJobAction;\r\n     101: ldc           #48                 // class org/elasticsearch/xpack/rollup/action/TransportDeleteRollupJobAction\r\n     103: iconst_0\r\n     104: anewarray     #39                 // class java/lang/Class\r\n     107: invokespecial #40                 // Method org/elasticsearch/plugins/ActionPlugin$ActionHandler.\"<init>\":(Lorg/elasticsearch/action/GenericAction;Ljava/lang/Class;[Ljava/lang/Class;)V\r\n     110: aastore\r\n     111: dup\r\n     112: iconst_5\r\n     113: new           #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n     116: dup\r\n     117: getstatic     #49                 // Field org/elasticsearch/xpack/core/rollup/action/GetRollupJobsAction.INSTANCE:Lorg/elasticsearch/xpack/core/rollup/action/GetRollupJobsAction;\r\n     120: ldc           #50                 // class org/elasticsearch/xpack/rollup/action/TransportGetRollupJobAction\r\n     122: iconst_0\r\n     123: anewarray     #39                 // class java/lang/Class\r\n     126: invokespecial #40                 // Method org/elasticsearch/plugins/ActionPlugin$ActionHandler.\"<init>\":(Lorg/elasticsearch/action/GenericAction;Ljava/lang/Class;[Ljava/lang/Class;)V\r\n     129: aastore\r\n     130: dup\r\n     131: bipush        6\r\n     133: new           #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n     136: dup\r\n     137: getstatic     #51                 // Field org/elasticsearch/xpack/core/rollup/action/GetRollupCapsAction.INSTANCE:Lorg/elasticsearch/xpack/core/rollup/action/GetRollupCapsAction;\r\n     140: ldc           #52                 // class org/elasticsearch/xpack/rollup/action/TransportGetRollupCapsAction\r\n     142: iconst_0\r\n     143: anewarray     #39                 // class java/lang/Class\r\n     146: invokespecial #40                 // Method org/elasticsearch/plugins/ActionPlugin$ActionHandler.\"<init>\":(Lorg/elasticsearch/action/GenericAction;Ljava/lang/Class;[Ljava/lang/Class;)V\r\n     149: aastore\r\n     150: dup\r\n     151: bipush        7\r\n     153: new           #36                 // class org/elasticsearch/plugins/ActionPlugin$ActionHandler\r\n     156: dup\r\n     157: getstatic     #53                 // Field org/elasticsearch/xpack/core/rollup/action/GetRollupIndexCapsAction.INSTANCE:Lorg/elasticsearch/xpack/core/rollup/action/GetRollupIndexCapsAction;\r\n     160: ldc           #54                 // class org/elasticsearch/xpack/rollup/action/TransportGetRollupIndexCapsAction\r\n     162: iconst_0\r\n     163: anewarray     #39                 // class java/lang/Class\r\n     166: invokespecial #40                 // Method org/elasticsearch/plugins/ActionPlugin$ActionHandler.\"<init>\":(Lorg/elasticsearch/action/GenericAction;Ljava/lang/Class;[Ljava/lang/Class;)V\r\n     169: aastore\r\n     170: invokestatic  #35                 // Method java/util/Arrays.asList:([Ljava/lang/Object;)Ljava/util/List;\r\n     173: areturn\r\n\r\n  public java.util.List<org.elasticsearch.threadpool.ExecutorBuilder<?>> getExecutorBuilders(org.elasticsearch.common.settings.Settings);\r\n    Code:\r\n       0: iconst_0\r\n       1: aload_0\r\n       2: getfield      #9                  // Field enabled:Z\r\n       5: if_icmpeq     15\r\n       8: aload_0\r\n       9: getfield      #11                 // Field transportClientMode:Z\r\n      12: ifeq          19\r\n      15: invokestatic  #12                 // Method java/util/Collections.emptyList:()Ljava/util/List;\r\n      18: areturn\r\n      19: new           #55                 // class org/elasticsearch/threadpool/FixedExecutorBuilder\r\n      22: dup\r\n      23: aload_1\r\n      24: ldc           #56                 // String rollup_indexing\r\n      26: iconst_4\r\n      27: iconst_4\r\n      28: ldc           #57                 // String xpack.rollup.task_thread_pool\r\n      30: invokespecial #58                 // Method org/elasticsearch/threadpool/FixedExecutorBuilder.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Ljava/lang/String;IILjava/lang/String;)V\r\n      33: astore_2\r\n      34: aload_2\r\n      35: invokestatic  #59                 // Method java/util/Collections.singletonList:(Ljava/lang/Object;)Ljava/util/List;\r\n      38: areturn\r\n\r\n  public java.util.List<org.elasticsearch.persistent.PersistentTasksExecutor<?>> getPersistentTasksExecutor(org.elasticsearch.cluster.service.ClusterService, org.elasticsearch.threadpool.ThreadPool, org.elasticsearch.client.Client);\r\n    Code:\r\n       0: aload_0\r\n       1: getfield      #9                  // Field enabled:Z\r\n       4: ifeq          14\r\n       7: aload_0\r\n       8: getfield      #11                 // Field transportClientMode:Z\r\n      11: ifeq          18\r\n      14: invokestatic  #12                 // Method java/util/Collections.emptyList:()Ljava/util/List;\r\n      17: areturn\r\n      18: new           #60                 // class org/elasticsearch/xpack/core/scheduler/SchedulerEngine\r\n      21: dup\r\n      22: aload_0\r\n      23: invokevirtual #61                 // Method getClock:()Ljava/time/Clock;\r\n      26: invokespecial #62                 // Method org/elasticsearch/xpack/core/scheduler/SchedulerEngine.\"<init>\":(Ljava/time/Clock;)V\r\n      29: astore        4\r\n      31: new           #63                 // class org/elasticsearch/xpack/rollup/job/RollupJobTask$RollupJobPersistentTasksExecutor\r\n      34: dup\r\n      35: aload_0\r\n      36: getfield      #4                  // Field settings:Lorg/elasticsearch/common/settings/Settings;\r\n      39: aload_3\r\n      40: aload         4\r\n      42: aload_2\r\n      43: invokespecial #64                 // Method org/elasticsearch/xpack/rollup/job/RollupJobTask$RollupJobPersistentTasksExecutor.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/client/Client;Lorg/elasticsearch/xpack/core/scheduler/SchedulerEngine;Lorg/elasticsearch/threadpool/ThreadPool;)V\r\n      46: invokestatic  #59                 // Method java/util/Collections.singletonList:(Ljava/lang/Object;)Ljava/util/List;\r\n      49: areturn\r\n\r\n  protected java.time.Clock getClock();\r\n    Code:\r\n       0: invokestatic  #65                 // Method java/time/Clock.systemUTC:()Ljava/time/Clock;\r\n       3: areturn\r\n\r\n  static {};\r\n    Code:\r\n       0: ldc           #68                 // String ${rollup.dynamic_template.version}\r\n       2: invokestatic  #69                 // Method java/util/regex/Pattern.quote:(Ljava/lang/String;)Ljava/lang/String;\r\n       5: putstatic     #70                 // Field ROLLUP_TEMPLATE_VERSION_PATTERN:Ljava/lang/String;\r\n       8: ldc           #71                 // String /rollup-dynamic-template.json\r\n      10: getstatic     #72                 // Field org/elasticsearch/Version.CURRENT:Lorg/elasticsearch/Version;\r\n      13: invokevirtual #73                 // Method org/elasticsearch/Version.toString:()Ljava/lang/String;\r\n      16: getstatic     #70                 // Field ROLLUP_TEMPLATE_VERSION_PATTERN:Ljava/lang/String;\r\n      19: invokestatic  #74                 // Method org/elasticsearch/xpack/core/template/TemplateUtils.loadTemplate:(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;\r\n      22: putstatic     #75                 // Field DYNAMIC_MAPPING_TEMPLATE:Ljava/lang/String;\r\n      25: new           #76                 // class java/util/HashSet\r\n      28: dup\r\n      29: iconst_2\r\n      30: anewarray     #77                 // class java/lang/String\r\n      33: dup\r\n      34: iconst_0\r\n      35: ldc           #78                 // String es-security-runas-user\r\n      37: aastore\r\n      38: dup\r\n      39: iconst_1\r\n      40: ldc           #79                 // String _xpack_security_authentication\r\n      42: aastore\r\n      43: invokestatic  #35                 // Method java/util/Arrays.asList:([Ljava/lang/Object;)Ljava/util/List;\r\n      46: invokespecial #80                 // Method java/util/HashSet.\"<init>\":(Ljava/util/Collection;)V\r\n      49: putstatic     #81                 // Field HEADER_FILTERS:Ljava/util/Set;\r\n      52: return\r\n}\r\n08:53:13 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup/jar] $ \r\n```\r\n\r\nLooking more closely at `org.elasticsearch.xpack.rollup.Rollup#getPersistentTasksExecutor`:\r\n\r\n```\r\n  public java.util.List<org.elasticsearch.persistent.PersistentTasksExecutor<?>> getPersistentTasksExecutor(org.elasticsearch.cluster.service.ClusterService, org.elasticsearch.threadpool.ThreadPool, org.elasticsearch.client.Client);\r\n    Code:\r\n       0: aload_0\r\n       1: getfield      #9                  // Field enabled:Z\r\n       4: ifeq          14\r\n       7: aload_0\r\n       8: getfield      #11                 // Field transportClientMode:Z\r\n      11: ifeq          18\r\n      14: invokestatic  #12                 // Method java/util/Collections.emptyList:()Ljava/util/List;\r\n      17: areturn\r\n      18: new           #60                 // class org/elasticsearch/xpack/core/scheduler/SchedulerEngine\r\n      21: dup\r\n      22: aload_0\r\n      23: invokevirtual #61                 // Method getClock:()Ljava/time/Clock;\r\n      26: invokespecial #62                 // Method org/elasticsearch/xpack/core/scheduler/SchedulerEngine.\"<init>\":(Ljava/time/Clock;)V\r\n      29: astore        4\r\n      31: new           #63                 // class org/elasticsearch/xpack/rollup/job/RollupJobTask$RollupJobPersistentTasksExecutor\r\n      34: dup\r\n      35: aload_0\r\n      36: getfield      #4                  // Field settings:Lorg/elasticsearch/common/settings/Settings;\r\n      39: aload_3\r\n      40: aload         4\r\n      42: aload_2\r\n      43: invokespecial #64                 // Method org/elasticsearch/xpack/rollup/job/RollupJobTask$RollupJobPersistentTasksExecutor.\"<init>\":(Lorg/elasticsearch/common/settings/Settings;Lorg/elasticsearch/client/Client;Lorg/elasticsearch/xpack/core/scheduler/SchedulerEngine;Lorg/elasticsearch/threadpool/ThreadPool;)V\r\n      46: invokestatic  #59                 // Method java/util/Collections.singletonList:(Ljava/lang/Object;)Ljava/util/List;\r\n      49: areturn\r\n\r\n```\r\n\r\nThis looks like the code matching the commit hash: https://github.com/elastic/elasticsearch/blob/595516e45d054483dcdaf12f0468a59cb34bb568/x-pack/plugin/rollup/src/main/java/org/elasticsearch/xpack/rollup/Rollup.java#L190-L199\r\n\r\nThe problem here is that the v6.4.0 tag was applied incorrectly:\r\n\r\n```\r\n09:09:47 1d [jason@totoro:/tmp/elasticsearch/6.4.0/modules/x-pack-rollup/jar] $ git -C ~/src/elastic/elasticsearch rev-list -n 1 v6.4.0\r\n1a122904dd29df3f8692310437fd37267706d84b\r\n```\r\n\r\nThat is wrong, per the manifest it should be: `595516e45d054483dcdaf12f0468a59cb34bb568`\r\n\r\nI will fix the tag later this morning.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419720288","html_url":"https://github.com/elastic/elasticsearch/issues/33547#issuecomment-419720288","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33547","id":419720288,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTcyMDI4OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-09-09T14:38:14Z","updated_at":"2018-09-09T14:38:14Z","author_association":"MEMBER","body":"I removed the incorrect tag and pushed the correct tag.","performed_via_github_app":null}]