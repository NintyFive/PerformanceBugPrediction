{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57630","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57630/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57630/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57630/events","html_url":"https://github.com/elastic/elasticsearch/issues/57630","id":630360796,"node_id":"MDU6SXNzdWU2MzAzNjA3OTY=","number":57630,"title":"UNC paths in `path.repo` are prepended with `path.home`","user":{"login":"rossiya","id":23565954,"node_id":"MDQ6VXNlcjIzNTY1OTU0","avatar_url":"https://avatars0.githubusercontent.com/u/23565954?v=4","gravatar_id":"","url":"https://api.github.com/users/rossiya","html_url":"https://github.com/rossiya","followers_url":"https://api.github.com/users/rossiya/followers","following_url":"https://api.github.com/users/rossiya/following{/other_user}","gists_url":"https://api.github.com/users/rossiya/gists{/gist_id}","starred_url":"https://api.github.com/users/rossiya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rossiya/subscriptions","organizations_url":"https://api.github.com/users/rossiya/orgs","repos_url":"https://api.github.com/users/rossiya/repos","events_url":"https://api.github.com/users/rossiya/events{/privacy}","received_events_url":"https://api.github.com/users/rossiya/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"assignees":[{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-06-03T21:59:54Z","updated_at":"2020-11-09T15:36:49Z","closed_at":"2020-11-09T15:36:49Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): \r\n\r\n- `Version: 7.7.0, Build: default/docker/81a1e9eda8e6183f5237786246f6dced26a10eaf/2020-05-12T02:01:37.602180Z, JVM: 14`\r\n\r\n- `Version: 7.5.2, Build: default/docker/8bec50e1e0ad29dad5653712cf3bb580cd1afcdf/2020-01-15T12:11:52.313576Z, JVM: 13.0.1`\r\n\r\n(replicated on multiple versions)\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nFollowing directions for using UNC on Registering a Snapshot Repository on https://www.elastic.co/guide/en/elasticsearch/reference/current/snapshots-register-repository.html, suggests setting\r\n\r\n> The path.repo setting supports Microsoft Windows UNC paths as long as at least server name and share are specified as a prefix and back slashes are properly escaped.\r\n> `path.repo: [\"\\\\\\\\MY_SERVER\\\\Snapshots\"]`\r\n\r\nThis results in UNC path being prepended with `path.home` and it fails to reach the server.\r\n\r\n**Steps to reproduce**:\r\n`docker-compose.yml` set as:\r\n```\r\nversion: '2.2'\r\nservices:\r\n  dev-es01:\r\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.7.0\r\n    container_name: dev-es01\r\n    environment:\r\n      - node.name=dev-es01\r\n      - cluster.name=es-docker-cluster\r\n      - discovery.seed_hosts=dev-es02,dev-es03\r\n      - cluster.initial_master_nodes=dev-es01,dev-es02,dev-es03\r\n      - bootstrap.memory_lock=true\r\n      - \"ES_JAVA_OPTS=-Xms2g -Xmx2g\"\r\n    ulimits:\r\n      memlock:\r\n        soft: -1\r\n        hard: -1\r\n    volumes:\r\n      - dev-data01:/usr/share/elasticsearch/data\r\n      - ./elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml:ro\r\n    ports:\r\n      - 7200:9200\r\n    networks:\r\n      - elastic\r\n  dev-es02:\r\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.7.0\r\n    container_name: dev-es02\r\n    environment:\r\n      - node.name=dev-es02\r\n      - cluster.name=es-docker-cluster\r\n      - discovery.seed_hosts=dev-es01,dev-es03\r\n      - cluster.initial_master_nodes=dev-es01,dev-es02,dev-es03\r\n      - bootstrap.memory_lock=true\r\n      - \"ES_JAVA_OPTS=-Xms2g -Xmx2g\"\r\n    ulimits:\r\n      memlock:\r\n        soft: -1\r\n        hard: -1\r\n    volumes:\r\n      - dev-data02:/usr/share/elasticsearch/data\r\n    ports:\r\n      - 7201:9200\r\n    networks:\r\n      - elastic\r\n  dev-es03:\r\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.7.0\r\n    container_name: dev-es03\r\n    environment:\r\n      - node.name=dev-es03\r\n      - cluster.name=es-docker-cluster\r\n      - discovery.seed_hosts=dev-es01,dev-es02\r\n      - cluster.initial_master_nodes=dev-es01,dev-es02,dev-es03\r\n      - bootstrap.memory_lock=true\r\n      - \"ES_JAVA_OPTS=-Xms2g -Xmx2g\"\r\n    ulimits:\r\n      memlock:\r\n        soft: -1\r\n        hard: -1\r\n    volumes:\r\n      - dev-data03:/usr/share/elasticsearch/data\r\n    ports:\r\n      - 7202:9200\r\n    networks:\r\n      - elastic\r\n  dev-kib01:\r\n    image: docker.elastic.co/kibana/kibana:7.7.0\r\n    container_name: dev-kib01\r\n    ports:\r\n      - 7601:5601\r\n    environment:\r\n      ELASTICSEARCH_URL: http://dev-es01:7200\r\n      ELASTICSEARCH_HOSTS: http://dev-es01:7200\r\n    networks:\r\n      - elastic\r\n    depends_on:\r\n      - dev-es01\r\n      - dev-es02\r\n      - dev-es03\r\n  dev-ls01:\r\n    image: docker.elastic.co/logstash/logstash:7.7.0\r\n    container_name: dev-ls01\r\n    volumes:\r\n      - ./logstash/config/logstash.yml:/usr/share/logstash/config/logstash.yml\r\n      - ./logstash/pipeline:/usr/share/logstash/pipeline\r\n    environment:\r\n      LS_JAVA_OPTS: \"-Xmx256m -Xms256m\"\r\n    ports:\r\n      - 7300:9300\r\n    networks:\r\n      - elastic    \r\n    depends_on:\r\n      - dev-es01\r\n      - dev-es02\r\n      - dev-es03\r\nvolumes:\r\n  dev-data01:\r\n    driver: local\r\n  dev-data02:\r\n    driver: local\r\n  dev-data03:\r\n    driver: local\r\nnetworks:\r\n  elastic:\r\n    driver: bridge\r\n```\r\nConfigured elasticsearch.yml as such:\r\n```\r\ncluster.name: \"docker-cluster\"\r\nnetwork.host: 0.0.0.0\r\npath.repo: [\"/\", \"\\\\\\\\10.10.10.10\\\\elastic\"]\r\n```\r\n\r\nUnfortunately, this yields in path.repo being set as the below, where an the UNC path is prepended with `/usr/share/elasticsearch/`\r\n```\r\ncurl 10.10.10.11:7200/_nodes?pretty -s |grep \"\\\"repo\\\"\" -B3 -A4\r\n        \"path\" : {\r\n          \"logs\" : \"/usr/share/elasticsearch/logs\",\r\n          \"home\" : \"/usr/share/elasticsearch\",\r\n          \"repo\" : [\r\n            \"/\",\r\n            \"/usr/share/elasticsearch/\\\\\\\\10.10.10.10\\\\elastic\"\r\n          ]\r\n        },\r\n```\r\nPlease include a *minimal* but *complete* recreation of the problem,\r\nincluding (e.g.) index creation, mappings, settings, query etc.  The easier\r\nyou make for us to reproduce it, the more likely that somebody will take the\r\ntime to look at it.\r\n\r\n 1. start cluster with the above config\r\n     `docker-compose up -d`\r\n 2. validate if `path.repo` was set correctly\r\n     `curl 10.10.10.11:7200/_nodes?pretty -s |grep \"\\\"repo\\\"\" -B3 -A4`\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n\r\n","closed_by":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"performed_via_github_app":null}