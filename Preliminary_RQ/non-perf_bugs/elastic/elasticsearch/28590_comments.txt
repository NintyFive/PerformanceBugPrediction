[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/364362528","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-364362528","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":364362528,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NDM2MjUyOA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-02-09T08:01:47Z","updated_at":"2018-02-09T08:01:47Z","author_association":"MEMBER","body":"@jasontedor I'm assigning to you but there may well be someone else better suited to look at this so feel free to pass it on to them. Also maybe @Mpdreamz has some thoughts about what might be going on here?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372874278","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-372874278","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":372874278,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjg3NDI3OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T01:30:00Z","updated_at":"2018-03-14T01:30:00Z","author_association":"MEMBER","body":"At this time we do not support running in a Windows container.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419414156","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-419414156","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":419414156,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTQxNDE1Ng==","user":{"login":"sixeyed","id":157413,"node_id":"MDQ6VXNlcjE1NzQxMw==","avatar_url":"https://avatars1.githubusercontent.com/u/157413?v=4","gravatar_id":"","url":"https://api.github.com/users/sixeyed","html_url":"https://github.com/sixeyed","followers_url":"https://api.github.com/users/sixeyed/followers","following_url":"https://api.github.com/users/sixeyed/following{/other_user}","gists_url":"https://api.github.com/users/sixeyed/gists{/gist_id}","starred_url":"https://api.github.com/users/sixeyed/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sixeyed/subscriptions","organizations_url":"https://api.github.com/users/sixeyed/orgs","repos_url":"https://api.github.com/users/sixeyed/repos","events_url":"https://api.github.com/users/sixeyed/events{/privacy}","received_events_url":"https://api.github.com/users/sixeyed/received_events","type":"User","site_admin":false},"created_at":"2018-09-07T11:43:17Z","updated_at":"2018-09-07T11:43:17Z","author_association":"NONE","body":"One day you might support Windows :) Confirming that this issue is with the latest releases of Elasticsearch. Version `5.6.11` works correctly in Windows containers. If you install `6.4.0` instead then you get this problem.\r\n\r\nIf you're interested you can test this from [my repo](https://github.com/sixeyed/dockerfiles-windows/tree/master/elasticsearch). The Dockerfile defaults to installing `5.6.11` which gives you a working container. Build the same Dockerfile with `--build-arg ES_VERSION=6.4.0` and you'll get the file not found issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/428230894","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-428230894","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":428230894,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODIzMDg5NA==","user":{"login":"rifaterdemsahin","id":5270036,"node_id":"MDQ6VXNlcjUyNzAwMzY=","avatar_url":"https://avatars3.githubusercontent.com/u/5270036?v=4","gravatar_id":"","url":"https://api.github.com/users/rifaterdemsahin","html_url":"https://github.com/rifaterdemsahin","followers_url":"https://api.github.com/users/rifaterdemsahin/followers","following_url":"https://api.github.com/users/rifaterdemsahin/following{/other_user}","gists_url":"https://api.github.com/users/rifaterdemsahin/gists{/gist_id}","starred_url":"https://api.github.com/users/rifaterdemsahin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rifaterdemsahin/subscriptions","organizations_url":"https://api.github.com/users/rifaterdemsahin/orgs","repos_url":"https://api.github.com/users/rifaterdemsahin/repos","events_url":"https://api.github.com/users/rifaterdemsahin/events{/privacy}","received_events_url":"https://api.github.com/users/rifaterdemsahin/received_events","type":"User","site_admin":false},"created_at":"2018-10-09T15:09:53Z","updated_at":"2018-10-09T15:10:01Z","author_association":"NONE","body":"any updates on this one ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458951780","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-458951780","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":458951780,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODk1MTc4MA==","user":{"login":"a4chet","id":31446009,"node_id":"MDQ6VXNlcjMxNDQ2MDA5","avatar_url":"https://avatars0.githubusercontent.com/u/31446009?v=4","gravatar_id":"","url":"https://api.github.com/users/a4chet","html_url":"https://github.com/a4chet","followers_url":"https://api.github.com/users/a4chet/followers","following_url":"https://api.github.com/users/a4chet/following{/other_user}","gists_url":"https://api.github.com/users/a4chet/gists{/gist_id}","starred_url":"https://api.github.com/users/a4chet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a4chet/subscriptions","organizations_url":"https://api.github.com/users/a4chet/orgs","repos_url":"https://api.github.com/users/a4chet/repos","events_url":"https://api.github.com/users/a4chet/events{/privacy}","received_events_url":"https://api.github.com/users/a4chet/received_events","type":"User","site_admin":false},"created_at":"2019-01-30T13:55:08Z","updated_at":"2019-01-30T14:02:31Z","author_association":"NONE","body":"I have Elasticsearch working in a nanoserver (1803) (`docker pull mcr.microsoft.com/powershell:nanoserver`) + OpenJDK11, Windows 10 host environment (1809) using process isolation. The recent fixes to the symbolic links in 1809 fix this problem. \r\n\r\nHere are my dockerfiles & docker-compose yaml for my sample test. I use a locally hosted artifactory instance to proxy our docker images. Substitute with docker hub or your repo appropriately.\r\n\r\nDockerfile for building an openJDK:\r\n\r\n```\r\nFROM docker.artifactory.org:8080/microsoft/nanoserver:28Jan19_ps1803\r\nSHELL [\"pwsh\", \"-Command\", \"$ErrorActionPreference = 'Stop';\"]\r\n\r\nADD http://artifactory:8081/artifactory/system-thirdparty/net/java/openjdk/11/openjdk-11-x64.zip openjdk.zip\r\n\r\nENV JAVA_HOME=C:\\\\jdk-11 \\\r\n       PATH=C:\\\\jdk-11\\\\bin;C:\\\\windows\\\\system32${PATH}\r\n\t   \r\nRUN       Expand-Archive -Path c:/openjdk.zip -DestinationPath c:/ ;\\\r\n      Remove-Item c:/openjdk.zip -Force     \r\n```\r\n\r\nHere is elastic search dockerfile based on the OpenJDK image above:\r\n```\r\nFROM docker.artifactory.org:8080/openjdk/openjdk:11_28_win1803\r\nSHELL [\"pwsh\", \"-Command\", \"$ErrorActionPreference = 'Stop';\"]\r\n\r\nADD http://artifactory:8081/artifactory/system-thirdparty/com/elastic/elasticsearch/6.0.0/elasticsearch-6.0.0.zip /elasticsearch.zip\r\n\r\nRUN Expand-Archive -Path c:/elasticsearch.zip -DestinationPath c:/ ;\\\r\n        Rename-Item c:/elasticsearch-6.0.0 c:/elasticsearch ;\\\r\n        Remove-Item c:/elasticsearch.zip -Force ;\\\r\n        New-Item -Path c:/temp -ItemType \"directory\"\r\n        \r\n\r\n# These mapped drive letters are no longer needed on Win10/1809!\r\n# Need to mount external volumes as their own drive letters\r\n# This is a bug in Java (sun.nio.fs.WindowsLinkSupport.getRealPath(WindowsLinkSupport.java:242))\r\n# running in Docker for Windows. Java cannot resolve the Docker sym link mounted in the container.\r\n#RUN Set-ItemProperty -path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\DOS Devices' -Name 'L:' -Value '\\??\\C:\\elasticsearch\\logs' -Type String\r\n#RUN Set-ItemProperty -path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\DOS Devices' -Name 'D:' -Value '\\??\\C:\\elasticsearch\\data' -Type String\r\n#RUN Set-ItemProperty -path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\DOS Devices' -Name 'X:' -Value '\\??\\C:\\elasticsearch\\config' -Type String\r\n\r\nSHELL [\"cmd\", \"/S\", \"/C\"]\r\n\r\nENV ES_PATH_CONF='c:\\\\\\\\elasticsearch\\\\\\\\config'\r\n\r\n# We will mount the configuration externally        \r\nRUN del c:\\elasticsearch\\config /F /S /Q         \r\n\r\nWORKDIR c:/elasticsearch/bin\r\nCMD [\"cmd\",  \"/C\",\"elasticsearch.bat\"]\r\n```\r\n\r\nSnippet of docker-compose yaml:\r\n```\r\nversion: '3.7'\r\nservices:\r\n  elasticsearch:\r\n    image: test/elasticsearch\r\n    isolation: process\r\n    build:\r\n      context: ./docker/elasticsearch\r\n    volumes:\r\n      - \"./docker/elasticsearch/config:c:/elasticsearch/config\"\r\n      - \"./docker/elasticsearch/data:c:/elasticsearch/data\"\r\n      - \"./docker/elasticsearch/logs:c:/elasticsearch/logs\"\r\n    ports:\r\n      - \"9200:9200\"\r\n    networks:\r\n      - default      \r\nnetworks:\r\n  default:\r\n    driver: nat\r\n```\r\n\r\n(Adding relevant elasticsearch.yml):\r\n```\r\npath.data: c:\\elasticsearch\\data\r\n...\r\npath.logs: c:\\elasticsearch\\logs\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/501749338","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-501749338","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":501749338,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMTc0OTMzOA==","user":{"login":"nikfot","id":15029024,"node_id":"MDQ6VXNlcjE1MDI5MDI0","avatar_url":"https://avatars3.githubusercontent.com/u/15029024?v=4","gravatar_id":"","url":"https://api.github.com/users/nikfot","html_url":"https://github.com/nikfot","followers_url":"https://api.github.com/users/nikfot/followers","following_url":"https://api.github.com/users/nikfot/following{/other_user}","gists_url":"https://api.github.com/users/nikfot/gists{/gist_id}","starred_url":"https://api.github.com/users/nikfot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikfot/subscriptions","organizations_url":"https://api.github.com/users/nikfot/orgs","repos_url":"https://api.github.com/users/nikfot/repos","events_url":"https://api.github.com/users/nikfot/events{/privacy}","received_events_url":"https://api.github.com/users/nikfot/received_events","type":"User","site_admin":false},"created_at":"2019-06-13T15:20:10Z","updated_at":"2019-06-13T15:20:10Z","author_association":"NONE","body":"> I have Elasticsearch working in a nanoserver (1803) (`docker pull mcr.microsoft.com/powershell:nanoserver`) + OpenJDK11, Windows 10 host environment (1809) using process isolation. The recent fixes to the symbolic links in 1809 fix this problem.\r\n> \r\n> Here are my dockerfiles & docker-compose yaml for my sample test. I use a locally hosted artifactory instance to proxy our docker images. Substitute with docker hub or your repo appropriately.\r\n> \r\n> Dockerfile for building an openJDK:\r\n> \r\n> ```\r\n> FROM docker.artifactory.org:8080/microsoft/nanoserver:28Jan19_ps1803\r\n> SHELL [\"pwsh\", \"-Command\", \"$ErrorActionPreference = 'Stop';\"]\r\n> \r\n> ADD http://artifactory:8081/artifactory/system-thirdparty/net/java/openjdk/11/openjdk-11-x64.zip openjdk.zip\r\n> \r\n> ENV JAVA_HOME=C:\\\\jdk-11 \\\r\n>        PATH=C:\\\\jdk-11\\\\bin;C:\\\\windows\\\\system32${PATH}\r\n> \t   \r\n> RUN       Expand-Archive -Path c:/openjdk.zip -DestinationPath c:/ ;\\\r\n>       Remove-Item c:/openjdk.zip -Force     \r\n> ```\r\n> \r\n> Here is elastic search dockerfile based on the OpenJDK image above:\r\n> \r\n> ```\r\n> FROM docker.artifactory.org:8080/openjdk/openjdk:11_28_win1803\r\n> SHELL [\"pwsh\", \"-Command\", \"$ErrorActionPreference = 'Stop';\"]\r\n> \r\n> ADD http://artifactory:8081/artifactory/system-thirdparty/com/elastic/elasticsearch/6.0.0/elasticsearch-6.0.0.zip /elasticsearch.zip\r\n> \r\n> RUN Expand-Archive -Path c:/elasticsearch.zip -DestinationPath c:/ ;\\\r\n>         Rename-Item c:/elasticsearch-6.0.0 c:/elasticsearch ;\\\r\n>         Remove-Item c:/elasticsearch.zip -Force ;\\\r\n>         New-Item -Path c:/temp -ItemType \"directory\"\r\n>         \r\n> \r\n> # These mapped drive letters are no longer needed on Win10/1809!\r\n> # Need to mount external volumes as their own drive letters\r\n> # This is a bug in Java (sun.nio.fs.WindowsLinkSupport.getRealPath(WindowsLinkSupport.java:242))\r\n> # running in Docker for Windows. Java cannot resolve the Docker sym link mounted in the container.\r\n> #RUN Set-ItemProperty -path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\DOS Devices' -Name 'L:' -Value '\\??\\C:\\elasticsearch\\logs' -Type String\r\n> #RUN Set-ItemProperty -path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\DOS Devices' -Name 'D:' -Value '\\??\\C:\\elasticsearch\\data' -Type String\r\n> #RUN Set-ItemProperty -path 'HKLM:\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\DOS Devices' -Name 'X:' -Value '\\??\\C:\\elasticsearch\\config' -Type String\r\n> \r\n> SHELL [\"cmd\", \"/S\", \"/C\"]\r\n> \r\n> ENV ES_PATH_CONF='c:\\\\\\\\elasticsearch\\\\\\\\config'\r\n> \r\n> # We will mount the configuration externally        \r\n> RUN del c:\\elasticsearch\\config /F /S /Q         \r\n> \r\n> WORKDIR c:/elasticsearch/bin\r\n> CMD [\"cmd\",  \"/C\",\"elasticsearch.bat\"]\r\n> ```\r\n> \r\n> Snippet of docker-compose yaml:\r\n> \r\n> ```\r\n> version: '3.7'\r\n> services:\r\n>   elasticsearch:\r\n>     image: test/elasticsearch\r\n>     isolation: process\r\n>     build:\r\n>       context: ./docker/elasticsearch\r\n>     volumes:\r\n>       - \"./docker/elasticsearch/config:c:/elasticsearch/config\"\r\n>       - \"./docker/elasticsearch/data:c:/elasticsearch/data\"\r\n>       - \"./docker/elasticsearch/logs:c:/elasticsearch/logs\"\r\n>     ports:\r\n>       - \"9200:9200\"\r\n>     networks:\r\n>       - default      \r\n> networks:\r\n>   default:\r\n>     driver: nat\r\n> ```\r\n> \r\n> (Adding relevant elasticsearch.yml):\r\n> \r\n> ```\r\n> path.data: c:\\elasticsearch\\data\r\n> ...\r\n> path.logs: c:\\elasticsearch\\logs\r\n> ```\r\n\r\nInteresting workaround. Did you build it exactly the way you mention? Because I tried it, but i had a problem with java_home on the elasticsearch image\r\n`could not find java in JAVA_HOME or bundled at C:\\elasticsearch\\jdk\r\n`\r\nAny ideas?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/501771533","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-501771533","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":501771533,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMTc3MTUzMw==","user":{"login":"a4chet","id":31446009,"node_id":"MDQ6VXNlcjMxNDQ2MDA5","avatar_url":"https://avatars0.githubusercontent.com/u/31446009?v=4","gravatar_id":"","url":"https://api.github.com/users/a4chet","html_url":"https://github.com/a4chet","followers_url":"https://api.github.com/users/a4chet/followers","following_url":"https://api.github.com/users/a4chet/following{/other_user}","gists_url":"https://api.github.com/users/a4chet/gists{/gist_id}","starred_url":"https://api.github.com/users/a4chet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a4chet/subscriptions","organizations_url":"https://api.github.com/users/a4chet/orgs","repos_url":"https://api.github.com/users/a4chet/repos","events_url":"https://api.github.com/users/a4chet/events{/privacy}","received_events_url":"https://api.github.com/users/a4chet/received_events","type":"User","site_admin":false},"created_at":"2019-06-13T16:13:56Z","updated_at":"2019-06-13T16:13:56Z","author_association":"NONE","body":"Most likely your Java unzip location is not the same as mine so your ENV JAVA_HOME is incorrect ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/502013643","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-502013643","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":502013643,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjAxMzY0Mw==","user":{"login":"nikfot","id":15029024,"node_id":"MDQ6VXNlcjE1MDI5MDI0","avatar_url":"https://avatars3.githubusercontent.com/u/15029024?v=4","gravatar_id":"","url":"https://api.github.com/users/nikfot","html_url":"https://github.com/nikfot","followers_url":"https://api.github.com/users/nikfot/followers","following_url":"https://api.github.com/users/nikfot/following{/other_user}","gists_url":"https://api.github.com/users/nikfot/gists{/gist_id}","starred_url":"https://api.github.com/users/nikfot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikfot/subscriptions","organizations_url":"https://api.github.com/users/nikfot/orgs","repos_url":"https://api.github.com/users/nikfot/repos","events_url":"https://api.github.com/users/nikfot/events{/privacy}","received_events_url":"https://api.github.com/users/nikfot/received_events","type":"User","site_admin":false},"created_at":"2019-06-14T08:10:43Z","updated_at":"2019-06-14T08:10:43Z","author_association":"NONE","body":"> Most likely your Java unzip location is not the same as mine so your ENV JAVA_HOME is incorrect\r\n\r\nSorry, my bad. I forgot to mention I tried elasticsearch 7.1.1 instead of 6. I just took a look at the ES 6 elasticsearch.bat and it has these commands at the end:\r\n\r\n`%JAVA% %ES_JAVA_OPTS% -Delasticsearch -Des.path.home=\"%ES_HOME%\" -Des.path.conf=\"%ES_PATH_CONF%\" -cp \"%ES_CLASSPATH%\" \"org.elasticsearch.bootstrap.Elasticsearch\" !newparams!`\r\n\r\nWhile the elasticsearch.bat in ES7 looks like this:\r\n`%JAVA% %ES_JAVA_OPTS% -Delasticsearch -Des.path.home=\"%ES_HOME%\" -Des.path.conf=\"%ES_PATH_CONF%\" -Des.distribution.flavor=\"%ES_DISTRIBUTION_FLAVOR%\" -Des.distribution.type=\"%ES_DISTRIBUTION_TYPE%\" -Des.bundled_jd=\"%ES_BUNDLED_JDK%\" -cp \"%ES_CLASSPATH%\" \"org.elasticsearch.bootstrap.Elasticsearch\" !newparams!`\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/596997507","html_url":"https://github.com/elastic/elasticsearch/issues/28590#issuecomment-596997507","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","id":596997507,"node_id":"MDEyOklzc3VlQ29tbWVudDU5Njk5NzUwNw==","user":{"login":"BewotecDaVinci","id":16084582,"node_id":"MDQ6VXNlcjE2MDg0NTgy","avatar_url":"https://avatars0.githubusercontent.com/u/16084582?v=4","gravatar_id":"","url":"https://api.github.com/users/BewotecDaVinci","html_url":"https://github.com/BewotecDaVinci","followers_url":"https://api.github.com/users/BewotecDaVinci/followers","following_url":"https://api.github.com/users/BewotecDaVinci/following{/other_user}","gists_url":"https://api.github.com/users/BewotecDaVinci/gists{/gist_id}","starred_url":"https://api.github.com/users/BewotecDaVinci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BewotecDaVinci/subscriptions","organizations_url":"https://api.github.com/users/BewotecDaVinci/orgs","repos_url":"https://api.github.com/users/BewotecDaVinci/repos","events_url":"https://api.github.com/users/BewotecDaVinci/events{/privacy}","received_events_url":"https://api.github.com/users/BewotecDaVinci/received_events","type":"User","site_admin":false},"created_at":"2020-03-10T09:52:14Z","updated_at":"2020-03-10T09:52:14Z","author_association":"NONE","body":"After spending some days now to get a elastic cluster running in a windows docker based scenario, trying all various configurations to solve node lock issues and already been quite frustrated I came across this GIT Issue-Entry which just states \"At this time we do not support running in a Windows container.\".\r\n\r\nSince elastic search supports windows based operating systems it is not quite obvious that windows docker based images are not supported, and there is not any single comment about this on the \"Install elastic search with docker\" site. Would be great to add this in some way to prevent others for stumbling into the same trap.\r\n\r\nAnyway, here are my experiences with various setups:\r\n- it doesn't really matter which version I tried, elastic search 5.6.11, any version 6.X or version 7.6.0\r\n- it doesn't matter if I use volume mounts or bind mounts\r\n- windows container version also does not really matter \r\n\r\nEverything runs smoothly after the first cluster startup. Data is filled in and returned if searched, no issues. \r\nBut after shutting down the elastic cluster by sending a docker-compose down or a docker-compose up while the containers are rebuilded the following error occurs on one or more nodes:\r\n\r\nfailed to obtain node locks, tried [[C:\\dockerdata\\data]] with lock id [0]; maybe these locations are not writable or multiple nodes were started without increasing [node.max_local_storage_nodes] (was [1])?\r\n\r\nSo while investigating various forum entries regarding this isue I came across some suggestions to either increase max_local_storage_nodes, which will not be supported anymore in future versions, or just remove the node.lock file during the next cluster startup. Removing the file works, but leads directly to the next issue coming from existing write.lock files. After also removing the write.lock files everything starts up but the indices data is lost / corrupted and not accessible.\r\n\r\nFor some reason it looks like the data is not persisted correctly during docker shutdown. Even after adding a delay to the docker shutdown, by using a separated process which starts elastic search and waits several seconds after receiving the docker SIGTERM/SIGKILL notification, the elastic nodes are in an invalid state.\r\n\r\nWould greatly appreciate to have this fixed in any upcoming elastic search version. If you are interested in further details please let me know.\r\n\r\nRegards\r\n","performed_via_github_app":null}]