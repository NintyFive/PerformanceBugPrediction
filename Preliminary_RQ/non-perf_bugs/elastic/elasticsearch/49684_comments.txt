[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559517760","html_url":"https://github.com/elastic/elasticsearch/issues/49684#issuecomment-559517760","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49684","id":559517760,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTUxNzc2MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T14:38:01Z","updated_at":"2019-11-28T14:38:01Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Percolator)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559572153","html_url":"https://github.com/elastic/elasticsearch/issues/49684#issuecomment-559572153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49684","id":559572153,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTU3MjE1Mw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T17:48:10Z","updated_at":"2019-11-28T17:48:10Z","author_association":"MEMBER","body":"Wasn't able to reproduce locally either, but for anybody else giving it a try, here's the REPRODUCE line:\r\n```\r\nREPRODUCE WITH: ./gradlew ':modules:percolator:test' --tests \"org.elasticsearch.percolator.CandidateQueryTests.testDuel2\" -Dtests.seed=957B0F4D9C5DCC90 -Dtests.security.manager=true -Dtests.locale=fi-FI -Dtests.timezone=Africa/Mbabane -Dcompiler.java=12\r\n```\r\n\r\nSome details from the log that show the actual and the control documents:\r\n```\r\n\r\n1> [2019-11-28T06:13:03,870][INFO ][o.e.c.m.MetaDataCreateIndexService] [node_s_0] [test] creating index, cause [api], templates [one_shard_index_template, random-soft-deletes-template], shards [1]/[0], mappings []\r\n--\r\n1> [2019-11-28T06:13:03,989][INFO ][o.e.c.r.a.AllocationService] [node_s_0] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[test][0]]]).\r\n1> [2019-11-28T06:13:04,100][INFO ][o.e.p.CandidateQueryTests] [testDuel2] Test with document: {}Document<indexed,tokenized<string_field:value1>>\r\n1> [2019-11-28T06:13:04,114][INFO ][o.e.p.CandidateQueryTests] [testDuel2] Test with document: {}Document<indexed,tokenized<string_field:value1> indexed,tokenized<string_field:value2>>\r\n1> [2019-11-28T06:13:04,131][INFO ][o.e.p.CandidateQueryTests] [testDuel2] Test with document: {}Document<indexed,tokenized<string_field:value1> indexed,tokenized<string_field:value2> indexed,tokenized<string_field:value3>>\r\n1> [2019-11-28T06:13:04,159][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.totalHits=6 hits\r\n1> [2019-11-28T06:13:04,159][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.totalHits=7 hits\r\n1> [2019-11-28T06:13:04,160][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs.length=6\r\n1> [2019-11-28T06:13:04,160][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs.length=7\r\n1> [2019-11-28T06:13:04,160][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[0].doc=9\r\n1> [2019-11-28T06:13:04,161][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[0].score=1.0\r\n1> [2019-11-28T06:13:04,161][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[1].doc=1\r\n1> [2019-11-28T06:13:04,161][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[1].score=0.39229375\r\n1> [2019-11-28T06:13:04,161][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[2].doc=5\r\n1> [2019-11-28T06:13:04,161][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[2].score=0.39229372\r\n1> [2019-11-28T06:13:04,162][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[3].doc=7\r\n1> [2019-11-28T06:13:04,162][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[3].score=0.26152915\r\n1> [2019-11-28T06:13:04,162][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[4].doc=0\r\n1> [2019-11-28T06:13:04,162][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[4].score=0.13076457\r\n1> [2019-11-28T06:13:04,162][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[5].doc=6\r\n1> [2019-11-28T06:13:04,163][ERROR][o.e.p.CandidateQueryTests] [testDuel2] topDocs.scoreDocs[5].score=0.13076457\r\n1> [2019-11-28T06:13:04,163][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[0].doc=9\r\n1> [2019-11-28T06:13:04,165][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[0].score=1.0\r\n1> [2019-11-28T06:13:04,167][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[0].query_to_string=*:*\r\n1> [2019-11-28T06:13:04,170][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[0].query_terms_field=\r\n1> [2019-11-28T06:13:04,174][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[0].minimum_should_match_field=0\r\n1> [2019-11-28T06:13:04,174][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[1].doc=1\r\n1> [2019-11-28T06:13:04,175][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[1].score=0.39229375\r\n1> [2019-11-28T06:13:04,175][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[1].query_to_string=string_field:\"value1 value2 value3\"\r\n1> [2019-11-28T06:13:04,176][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[1].query_terms_field=string_fieldvalue1,string_fieldvalue2,string_fieldvalue3,\r\n1> [2019-11-28T06:13:04,176][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[1].minimum_should_match_field=3\r\n1> [2019-11-28T06:13:04,176][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[2].doc=5\r\n1> [2019-11-28T06:13:04,176][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[2].score=0.39229372\r\n1> [2019-11-28T06:13:04,177][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[2].query_to_string=(((((string_field:value2 int_field:[15 TO 50] ((string_field:value3)~1) (string_field:value2))~2))~1) (((((#string_field:value2) ((int_field:[15 TO 50] string_field:value1 string_field:value3 string_field:value1)~4) +int_field:[0 TO 10])~2))~1))~1\r\n1> [2019-11-28T06:13:04,177][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[2].query_terms_field=string_fieldvalue1,string_fieldvalue2,string_fieldvalue3,\r\n1> [2019-11-28T06:13:04,177][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[2].minimum_should_match_field=1\r\n1> [2019-11-28T06:13:04,178][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[3].doc=7\r\n1> [2019-11-28T06:13:04,178][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[3].score=0.26152915\r\n1> [2019-11-28T06:13:04,178][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[3].query_to_string=(string_field:value2 (#((int_field:[15 TO 50]) ((string_field:value1 int_field:[15 TO 50] string_field:value1 string_field:value2)~4)) +((int_field:[0 TO 10])~1)) (+(+(string_field:value2))))~1\r\n1> [2019-11-28T06:13:04,178][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[3].query_terms_field=string_fieldvalue1,string_fieldvalue2,\r\n1> [2019-11-28T06:13:04,178][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[3].minimum_should_match_field=1\r\n1> [2019-11-28T06:13:04,179][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[4].doc=0\r\n1> [2019-11-28T06:13:04,179][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[4].score=0.13076457\r\n1> [2019-11-28T06:13:04,179][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[4].query_to_string=string_field:value1\r\n1> [2019-11-28T06:13:04,179][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[4].query_terms_field=string_fieldvalue1,\r\n1> [2019-11-28T06:13:04,179][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[4].minimum_should_match_field=1\r\n1> [2019-11-28T06:13:04,180][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[5].doc=4\r\n1> [2019-11-28T06:13:04,180][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[5].score=0.13076457\r\n1> [2019-11-28T06:13:04,180][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[5].query_to_string=(string_field:value3 int_field:[0 TO 10] #string_field:value3)~1\r\n1> [2019-11-28T06:13:04,180][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[5].query_terms_field=string_fieldvalue3,\r\n1> [2019-11-28T06:13:04,180][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[5].minimum_should_match_field=2\r\n1> [2019-11-28T06:13:04,181][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[6].doc=6\r\n1> [2019-11-28T06:13:04,181][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[6].score=0.13076457\r\n1> [2019-11-28T06:13:04,181][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[6].query_to_string=(string_field:value2)~1\r\n1> [2019-11-28T06:13:04,181][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[6].query_terms_field=string_fieldvalue2,\r\n1> [2019-11-28T06:13:04,181][ERROR][o.e.p.CandidateQueryTests] [testDuel2] controlTopDocs.scoreDocs[6].minimum_should_match_field=1\r\n1> [2019-11-28T06:13:04,212][INFO ][o.e.p.CandidateQueryTests] [testDuel2] after test\r\n```\r\n\r\nIt appears in this case `controlTopDocs.scoreDocs[5].doc=4` is the culprit that's either missing or too much when comparing the hit count.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/561193738","html_url":"https://github.com/elastic/elasticsearch/issues/49684#issuecomment-561193738","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49684","id":561193738,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MTE5MzczOA==","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"created_at":"2019-12-03T14:33:01Z","updated_at":"2019-12-03T14:33:01Z","author_association":"CONTRIBUTOR","body":"The query `#((((string_field:value1 int_field:[15 TO 50] string_field:value1 string_field:value2)~2))~1) #string_field:value2 +((+((int_field:[-5 TO 5])~1)) #string_field:value2 +string_field:value1)` is being analyzed to require a document to contain `string_field:value1` and `string_field:value` with a minimum should match of 3, which is obviously not possible.  Working on a fix now.","performed_via_github_app":null}]