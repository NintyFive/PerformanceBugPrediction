[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372839827","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-372839827","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":372839827,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjgzOTgyNw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T22:25:51Z","updated_at":"2018-03-13T22:25:51Z","author_association":"MEMBER","body":"> no elasticsearch packages match the following declared Java services\r\n\r\nCan you elaborate on this? I think Codec and DocValuesFormat are leftover from long ago when we had custom versions of these in ES. PostingsFormat contains Completion50PostingsFormat which is still used. Is the issue just that Codec and DocValuesFormat are empty (we can remove them)?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372849057","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-372849057","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":372849057,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjg0OTA1Nw==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T23:07:38Z","updated_at":"2018-03-13T23:07:38Z","author_association":"NONE","body":"I added a Gradle test module in the PR, but I couldn't reproduce my maven project behaviour.\r\nMaybe it is just a Maven issue.\r\n\r\n@rjernst,\r\nI didn't see that both of them were empty.\r\nStill, the issue is also caused by org.apache.lucene.codecs.PostingsFormat for which I had to add 2 fake classes:\r\n- https://github.com/Cosium/elasticsearch/blob/e4cac84d72413d1abfaa0b975d8f0b6959310db5/server/src/main/java/org/apache/lucene/search/suggest/document/JigsawMarker.java\r\n- https://github.com/Cosium/elasticsearch/blob/e4cac84d72413d1abfaa0b975d8f0b6959310db5/server/src/main/java/org/apache/lucene/codecs/JigsawMarker.java\r\n\r\nThis is really weird.\r\nI am creating a git repository with a Maven project reproducing the issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372856657","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-372856657","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":372856657,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjg1NjY1Nw==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T23:44:14Z","updated_at":"2018-03-13T23:44:14Z","author_association":"NONE","body":"I created https://github.com/Cosium/jigsaw-elasticsearch which allows to reproduce the issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372860097","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-372860097","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":372860097,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjg2MDA5Nw==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T00:03:04Z","updated_at":"2018-03-14T00:03:04Z","author_association":"NONE","body":"And a ticket in Maven compiler tracker https://issues.apache.org/jira/browse/MCOMPILER-328","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372982010","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-372982010","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":372982010,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjk4MjAxMA==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T10:59:08Z","updated_at":"2018-03-14T10:59:08Z","author_association":"NONE","body":"https://issues.apache.org/jira/browse/MCOMPILER-328?focusedCommentId=16398365&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16398365 confirms that Maven get the automodule name directly from the JDK.\r\n\r\nThat would mean that Gradle computes the module name itself, which is more brittle.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372985487","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-372985487","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":372985487,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjk4NTQ4Nw==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T11:12:47Z","updated_at":"2018-03-14T11:30:28Z","author_association":"NONE","body":"I created a Gradle equivalent:\r\nhttps://github.com/Cosium/jigsaw-elasticsearch-gradle\r\nI reproduce the same issue as Maven.\r\n\r\nTherefore:\r\n- Gradle fails like Maven\r\n- this issue still stands\r\n- the Gradle consumer module that I added in the PR has another issue\r\n- IntelliJ does not display the error => https://youtrack.jetbrains.com/issue/IDEA-188233","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373005798","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-373005798","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":373005798,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzAwNTc5OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T12:37:15Z","updated_at":"2018-03-14T12:37:15Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/373322067","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-373322067","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":373322067,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzMyMjA2Nw==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-03-15T09:59:25Z","updated_at":"2018-03-15T10:09:08Z","author_association":"NONE","body":"After much debugging !\r\n\r\n# Classpath vs Modulepath in Java 9\r\n\r\nThe modulepath should contain all modular jars. That includes jars containing well defined `module-info.java` and jar *eligible* to automodule.\r\nElasticsearch is not currently eligible to automodule because it violates some Jigsaw encapsulation about Java services.\r\n\r\nA jar in the module path can't access a jar in the classpath.\r\n\r\n# Maven behaviour\r\n\r\nFor each jar:\r\n- Maven provides the jar to JDK ModuleFinder\r\n- If the ModuleFinder considers the Jar as a module, Maven adds the Jar to --module-path\r\n- If the ModuleFinder does not consider the Jar as a module (i.e. elasticsearch), Maven adds it to -classpath\r\n\r\nWith elasticsearch as unique dependency:\r\n```\r\n[DEBUG] Command line options:\r\n[DEBUG] -d /srv/git/cosium/jigsaw-elasticsearch/target/classes \\\r\n-classpath /srv/git/cosium/jigsaw-elasticsearch/target/classes:/home/rhousni/.m2/repository/org/elasticsearch/elasticsearch/6.2.2/elasticsearch-6.2.2.jar: \\\r\n-sourcepath /srv/git/cosium/jigsaw-elasticsearch/src/main/java:/srv/git/cosium/jigsaw-elasticsearch/target/generated-sources/annotations: \\\r\n-s /srv/git/cosium/jigsaw-elasticsearch/target/generated-sources/annotations \\\r\n-g -verbose -nowarn -target 9 -source 9\r\n```\r\n\r\nWith commons-io as unique dependency:\r\n```\r\n[DEBUG] Command line options:\r\n[DEBUG] -d /srv/git/cosium/jigsaw-elasticsearch/target/classes \\\r\n-classpath /srv/git/cosium/jigsaw-elasticsearch/target/classes: \\\r\n--module-path /home/rhousni/.m2/repository/commons-io/commons-io/2.4/commons-io-2.4.jar: \\\r\n-sourcepath /srv/git/cosium/jigsaw-elasticsearch/src/main/java:/srv/git/cosium/jigsaw-elasticsearch/target/generated-sources/annotations: \\\r\n-s /srv/git/cosium/jigsaw-elasticsearch/target/generated-sources/annotations \\\r\n-g -verbose -nowarn -target 9 -source 9\r\n```\r\n\r\n# Gradle behaviour\r\n\r\nGradle doesn't make any kind of jigsaw module autodetection.\r\nBy default, even in Java 9, Gradle will put all dependencies into the `classpath`.\r\nThis is confirmed by the [tutorial](https://guides.gradle.org/building-java-9-modules/#modify_the_code_compilejava_code_task_to_produce_a_module) that expects us to populate the `--module-path` and override `-classpath` manually.\r\n\r\nThe experimental jigsaw plugin, seems to do the same thing: \r\nhttps://github.com/gradle/gradle-java-modules/blob/master/src/main/java/org/gradle/java/JigsawPlugin.java\r\n\r\n# Conclusion\r\n\r\nThe jar built by my project being defined by a `module-info.java`, it must resides in `--module-path`. Since elasticsearch fails the JDK automodule selection phase during Maven build, elasticsearch ends in `-classpath`, making it unreachable by my jar.\r\n\r\nIMO, there is no point in trying to reproduce the current issue with a dedicated Gradle module, since it entirely depends on the way the end user will configure Gradle. Besides, it is unlikely that Gradle user is aware of the current issue since he will probably never use the JDK api allowing to select automodules.\r\n\r\nSo the fix seems to be the good one to me. \r\nThe question seems to be what kind of automatic test could detect this kind of defect.\r\n\r\nI think it would be easier to have a Maven module, since Maven has the correct behaviour. \r\nWhat do you think?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376798474","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-376798474","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":376798474,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Njc5ODQ3NA==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-03-28T08:05:58Z","updated_at":"2018-03-28T08:05:58Z","author_association":"NONE","body":"Ping @rjernst , @jasontedor","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383396709","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-383396709","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":383396709,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzM5NjcwOQ==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-04-22T17:08:40Z","updated_at":"2018-04-22T17:08:40Z","author_association":"NONE","body":"Ping @rjernst, @jasontedor","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400181798","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-400181798","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":400181798,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDE4MTc5OA==","user":{"login":"nipafx","id":6537432,"node_id":"MDQ6VXNlcjY1Mzc0MzI=","avatar_url":"https://avatars1.githubusercontent.com/u/6537432?v=4","gravatar_id":"","url":"https://api.github.com/users/nipafx","html_url":"https://github.com/nipafx","followers_url":"https://api.github.com/users/nipafx/followers","following_url":"https://api.github.com/users/nipafx/following{/other_user}","gists_url":"https://api.github.com/users/nipafx/gists{/gist_id}","starred_url":"https://api.github.com/users/nipafx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nipafx/subscriptions","organizations_url":"https://api.github.com/users/nipafx/orgs","repos_url":"https://api.github.com/users/nipafx/repos","events_url":"https://api.github.com/users/nipafx/events{/privacy}","received_events_url":"https://api.github.com/users/nipafx/received_events","type":"User","site_admin":false},"created_at":"2018-06-26T05:18:42Z","updated_at":"2018-06-26T05:19:31Z","author_association":"NONE","body":"I don't understand how this is a `>non-issue`. On the contrary, this is a serious issue for anyone who wants to use Elasticsearch with the module system and I think it should be investigated.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400208118","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-400208118","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":400208118,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDIwODExOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-06-26T07:28:04Z","updated_at":"2018-06-26T07:28:04Z","author_association":"MEMBER","body":"@nicolaiparlog The label was a mislabeling and I have removed it. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404091319","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-404091319","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":404091319,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDA5MTMxOQ==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2018-07-11T08:40:31Z","updated_at":"2018-07-11T08:40:31Z","author_association":"NONE","body":"@jasontedor the label is still on the linked PR","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412004195","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-412004195","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":412004195,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjAwNDE5NQ==","user":{"login":"tomdw","id":1496448,"node_id":"MDQ6VXNlcjE0OTY0NDg=","avatar_url":"https://avatars1.githubusercontent.com/u/1496448?v=4","gravatar_id":"","url":"https://api.github.com/users/tomdw","html_url":"https://github.com/tomdw","followers_url":"https://api.github.com/users/tomdw/followers","following_url":"https://api.github.com/users/tomdw/following{/other_user}","gists_url":"https://api.github.com/users/tomdw/gists{/gist_id}","starred_url":"https://api.github.com/users/tomdw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomdw/subscriptions","organizations_url":"https://api.github.com/users/tomdw/orgs","repos_url":"https://api.github.com/users/tomdw/repos","events_url":"https://api.github.com/users/tomdw/events{/privacy}","received_events_url":"https://api.github.com/users/tomdw/received_events","type":"User","site_admin":false},"created_at":"2018-08-10T07:46:40Z","updated_at":"2018-08-10T07:46:40Z","author_association":"NONE","body":"@jasontedor any idea on when this will be fixed/included in a release? thx!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418538144","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-418538144","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":418538144,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODUzODE0NA==","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2018-09-04T22:27:31Z","updated_at":"2018-09-04T22:27:31Z","author_association":"CONTRIBUTOR","body":"You can only fix this by making Elasticsearch a real module. Automodules don't work for Elasticsearch. There are several problems: Elasticsearch contains classes from a package it does not own (org.apache.lucene) and also defines SPIs for them. This needs to be exposed via module-info.java. But this won't still not work, as Lucene is not module conformant (for the same reasons).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418605619","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-418605619","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":418605619,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODYwNTYxOQ==","user":{"login":"tomdw","id":1496448,"node_id":"MDQ6VXNlcjE0OTY0NDg=","avatar_url":"https://avatars1.githubusercontent.com/u/1496448?v=4","gravatar_id":"","url":"https://api.github.com/users/tomdw","html_url":"https://github.com/tomdw","followers_url":"https://api.github.com/users/tomdw/followers","following_url":"https://api.github.com/users/tomdw/following{/other_user}","gists_url":"https://api.github.com/users/tomdw/gists{/gist_id}","starred_url":"https://api.github.com/users/tomdw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomdw/subscriptions","organizations_url":"https://api.github.com/users/tomdw/orgs","repos_url":"https://api.github.com/users/tomdw/repos","events_url":"https://api.github.com/users/tomdw/events{/privacy}","received_events_url":"https://api.github.com/users/tomdw/received_events","type":"User","site_admin":false},"created_at":"2018-09-05T05:39:47Z","updated_at":"2018-09-05T05:39:47Z","author_association":"NONE","body":"@uschindler as the discussion in this issue shows, there is a fix available, it only has to be merged and released. So converting to an explicit module is not needed yet. Putting an automatic module name in the manifest does no harm, on the contrary, it makes sure that elasticsearch reserves its module name.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418611473","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-418611473","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":418611473,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODYxMTQ3Mw==","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2018-09-05T06:14:37Z","updated_at":"2018-09-05T06:14:37Z","author_association":"CONTRIBUTOR","body":"The problem is that it won't still not work at runtime, because the SPI won't load. The good thing is that Elasticsearch does no longer implement SPIs (Codecs). And if you just use the Elasticsearch client, you won't run into trouble, because Lucene is just a dependency, but it's actually not used (only for classloading).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418613563","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-418613563","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":418613563,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODYxMzU2Mw==","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2018-09-05T06:25:41Z","updated_at":"2018-09-05T06:25:41Z","author_association":"CONTRIBUTOR","body":"So in short there are multiple problems: The empty/missing META-INF/services are a bug in Elasticsearch. This violates the spec (also for older Java versions, but nothing cares). Once you have fixed this and added an automatic module name, it compiles.\r\nBut this does not mean that it works at the end. Lucene unfortunately is defining the same packages in several modules, so at runtime this would cause issues with automatic modules. There is no fix for this at the moment and there won't be one for longer time (this would require a complete restructuring of Lucene). In addition, the SPI infrastructure of Lucene needs an update to be Java 9 compliant, which is also not yet done.\r\nIf you use Elasticsearch at the moment just as a client, then it could be fine also at runtime, but that's just because Java does not fully verify the module requirements/corectness at the moment.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419104877","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-419104877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":419104877,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTEwNDg3Nw==","user":{"login":"tomdw","id":1496448,"node_id":"MDQ6VXNlcjE0OTY0NDg=","avatar_url":"https://avatars1.githubusercontent.com/u/1496448?v=4","gravatar_id":"","url":"https://api.github.com/users/tomdw","html_url":"https://github.com/tomdw","followers_url":"https://api.github.com/users/tomdw/followers","following_url":"https://api.github.com/users/tomdw/following{/other_user}","gists_url":"https://api.github.com/users/tomdw/gists{/gist_id}","starred_url":"https://api.github.com/users/tomdw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomdw/subscriptions","organizations_url":"https://api.github.com/users/tomdw/orgs","repos_url":"https://api.github.com/users/tomdw/repos","events_url":"https://api.github.com/users/tomdw/events{/privacy}","received_events_url":"https://api.github.com/users/tomdw/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T14:02:17Z","updated_at":"2018-09-06T14:02:17Z","author_association":"NONE","body":"@uschindler thx for the clarification. I do think that if this gets fixed for elasticsearch it can be deployed as automatic module and we can keep lucene on the classpath for now. (automatic modules can read from the classpath) That way at least explicit modules can use the elasticsearch automatic module, and lucene remains on the classpath until a redesign has been done.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453751387","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-453751387","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":453751387,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1Mzc1MTM4Nw==","user":{"login":"tomdw","id":1496448,"node_id":"MDQ6VXNlcjE0OTY0NDg=","avatar_url":"https://avatars1.githubusercontent.com/u/1496448?v=4","gravatar_id":"","url":"https://api.github.com/users/tomdw","html_url":"https://github.com/tomdw","followers_url":"https://api.github.com/users/tomdw/followers","following_url":"https://api.github.com/users/tomdw/following{/other_user}","gists_url":"https://api.github.com/users/tomdw/gists{/gist_id}","starred_url":"https://api.github.com/users/tomdw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomdw/subscriptions","organizations_url":"https://api.github.com/users/tomdw/orgs","repos_url":"https://api.github.com/users/tomdw/repos","events_url":"https://api.github.com/users/tomdw/events{/privacy}","received_events_url":"https://api.github.com/users/tomdw/received_events","type":"User","site_admin":false},"created_at":"2019-01-12T14:22:00Z","updated_at":"2019-01-12T14:22:00Z","author_association":"NONE","body":"@jasontedor can someone prioritise this issue so that the elasticsearch jar is at least compatible with jdk specs? i.e. including META-INF/services files for classes and packages that don't exist in the jar is just wrong. \r\n\r\nThen the community can start using elasticsearch on the module path of the jdk.\r\n\r\nThx in advance.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/459721230","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-459721230","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":459721230,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1OTcyMTIzMA==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2019-02-01T13:23:58Z","updated_at":"2019-02-01T13:23:58Z","author_association":"CONTRIBUTOR","body":"I did some tests on the current master. Since we  don't support elasticsearch, I think that the us-case that triggers this is being able to write a modularized application that talks to ES via one of the clients. \r\nSince ES doesn't produce modules yet, one can only use automatic modules.\r\nthe approach I took was to start with this `modules-info.java`:\r\n```\r\nmodule org.elasticsearch.qa { \r\n   requires elasticsearch.rest.high.level.client;\r\n}\r\n```\r\nAnd just a class to test the communication:\r\n```\r\npackage org.elasticsearch.qa;\r\n\r\nimport org.apache.http.HttpHost;\r\nimport org.elasticsearch.action.search.SearchRequest;\r\nimport org.elasticsearch.client.RequestOptions;\r\nimport org.elasticsearch.client.RestClient;\r\nimport org.elasticsearch.client.RestHighLevelClient;\r\nimport org.elasticsearch.index.query.QueryBuilders;\r\nimport org.elasticsearch.search.builder.SearchSourceBuilder;\r\n\r\npublic class SmokeTestHighLevelRestClient {\r\n\r\n    public static void main(String [] args) {\r\n        var client = new RestHighLevelClient(\r\n            RestClient.builder(new HttpHost(\"localhost\", 9200, \"http\"))\r\n        );\r\n        var searchRequest = new SearchRequest();\r\n        var searchSourceBuilder = new SearchSourceBuilder();\r\n        searchSourceBuilder.query(QueryBuilders.matchAllQuery());\r\n        searchRequest.source(searchSourceBuilder);\r\n        client.search(searchRequest, RequestOptions.DEFAULT);\r\n    }\r\n}\r\n```\r\n\r\nNote that this now requires to have more requires in `modules-info.java`:\r\n```\r\nmodule org.elasticsearch.qa { \r\n   requires elasticsearch.rest.high.level.client;\r\n   requires elasticsearch;\r\n   requires httpcore;\r\n}\r\n```\r\n\r\nWe have to tell Gradle to put these jars on the module path and make them automatic modules. \r\n```\r\nconfigurations {\r\n    modulePath\r\n}\r\n\r\ndependencies {\r\n    modulePath \"org.elasticsearch.client:elasticsearch-rest-client:$version\"\r\n}\r\n\r\nconfigurations {\r\n    modulePath\r\n    compile.extendsFrom modulePath\r\n}\r\n\r\ndependencies {\r\n    modulePath \"org.elasticsearch.client:elasticsearch-rest-client:$version\"  {\r\n       exclude group: \" org.apache.lucene\"\r\n   }\r\n}\r\n```\r\n\r\nLike @uschindler mentions, elasticsearch has classes in lucene packages and lucene itself has packages  spread across modules. \r\nThe lather wouldn't be a problem for ES  at least not with automatic modules as we could keep Lucene on the classpath only as automatic modules are allowed to access it and it's used for class-loading.  \r\nElasticsearch itself  however has the same problem as lucene, it uses the same package in different modules, and fixing that would require shuffling packages around and breaking changes. E.x. both the `elasticsearch`  and `high-level-rest-client` jar have `org.elasticsearch.client`.\r\n\r\nProbably the best path to be able to use the high level rest client in a modular application is to remove elasticsearch(server) as a dependency, and reshuffle packages so it doesn't have any in common with the low level rest client. If the dependencies allow it we could potentially make it into a real module. \r\n\r\nI was not able to replicate the issues with the empty service files just by requiring elasticsearch from a modules-info. I haven't checked what changed, but the linked PR that adds a reproduction is old. I tried against latest master. \r\n```\r\nmodule org.elasticsearch.qa {\r\n   requires elasticsearch;\r\n}\r\n```\r\nWith this Gradle setup\r\n```\r\nonfigurations {\r\n    modulePath {\r\n        transitive false\r\n    }\r\n}\r\n\r\ndependencies {\r\n    modulePath \"org.elasticsearch:elasticsearch:$version\"\r\n}\r\n\r\ncompileJava {\r\n    doFirst {\r\n        options.compilerArgs += [\r\n            '--module-path', configurations.modulePath.asPath,\r\n        ]\r\n    }\r\n}\r\n```\r\nI'm not saying we shouldn't remove the empty service files. I'll create a PR for that, no need to keep them around, but I don't see how this setup could be useful. \r\nIt doesn't pick up transitive dependencies so it can't do anything usefully, and picking up transitive dependencies on the module path breaks it.\r\n\r\nTo summarize I would like to move forward with the following: \r\n - open a PR just to remove empty service files \r\n - close this issue and the linked  PR \r\n - submit a new issue to make the high level rest client into a module and take the discussion there for clarity. Note the the effort required to do so is significant and involves breaking changes that can only be done in major versions. \r\n\r\n@jasontedor @rjernst  thoughts  ?\r\n\r\nRight now the best bet for modular applications is to use the low level rest client, or keep all the elasticsearch jars on the classpath and have all ES specific code localized in an automated module in their application to be able to access them. This would allow the rest of the application to benefit from modularization without requiring elasticsearch to change. \r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/459725018","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-459725018","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":459725018,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1OTcyNTAxOA==","user":{"login":"reda-alaoui","id":2890843,"node_id":"MDQ6VXNlcjI4OTA4NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/2890843?v=4","gravatar_id":"","url":"https://api.github.com/users/reda-alaoui","html_url":"https://github.com/reda-alaoui","followers_url":"https://api.github.com/users/reda-alaoui/followers","following_url":"https://api.github.com/users/reda-alaoui/following{/other_user}","gists_url":"https://api.github.com/users/reda-alaoui/gists{/gist_id}","starred_url":"https://api.github.com/users/reda-alaoui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reda-alaoui/subscriptions","organizations_url":"https://api.github.com/users/reda-alaoui/orgs","repos_url":"https://api.github.com/users/reda-alaoui/repos","events_url":"https://api.github.com/users/reda-alaoui/events{/privacy}","received_events_url":"https://api.github.com/users/reda-alaoui/received_events","type":"User","site_admin":false},"created_at":"2019-02-01T13:38:10Z","updated_at":"2019-02-01T13:38:39Z","author_association":"NONE","body":"> I was not able to replicate the issues with the empty service files just by requiring elasticsearch from a modules-info\r\n\r\nAs mentionned in the previous messages, if you did that with Gradle it's normal.\r\nTry with Maven.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460163361","html_url":"https://github.com/elastic/elasticsearch/issues/28984#issuecomment-460163361","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28984","id":460163361,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDE2MzM2MQ==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2019-02-04T08:20:38Z","updated_at":"2019-02-04T08:20:38Z","author_association":"CONTRIBUTOR","body":"Closing in favor of #38299","performed_via_github_app":null}]