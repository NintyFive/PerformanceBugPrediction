{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37093","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37093/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37093/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37093/events","html_url":"https://github.com/elastic/elasticsearch/issues/37093","id":395440312,"node_id":"MDU6SXNzdWUzOTU0NDAzMTI=","number":37093,"title":"elastic6.5.1 导入时差问题","user":{"login":"Zoomtoo","id":33661840,"node_id":"MDQ6VXNlcjMzNjYxODQw","avatar_url":"https://avatars3.githubusercontent.com/u/33661840?v=4","gravatar_id":"","url":"https://api.github.com/users/Zoomtoo","html_url":"https://github.com/Zoomtoo","followers_url":"https://api.github.com/users/Zoomtoo/followers","following_url":"https://api.github.com/users/Zoomtoo/following{/other_user}","gists_url":"https://api.github.com/users/Zoomtoo/gists{/gist_id}","starred_url":"https://api.github.com/users/Zoomtoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Zoomtoo/subscriptions","organizations_url":"https://api.github.com/users/Zoomtoo/orgs","repos_url":"https://api.github.com/users/Zoomtoo/repos","events_url":"https://api.github.com/users/Zoomtoo/events{/privacy}","received_events_url":"https://api.github.com/users/Zoomtoo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-01-03T02:30:35Z","updated_at":"2019-01-03T02:49:32Z","closed_at":"2019-01-03T02:40:09Z","author_association":"NONE","active_lock_reason":null,"body":"原始数据在mysql中，同步数据我用的logstach，同步完成后，原始数据类型是datetime的字段，\r\n到es中，比原来快了5个小时，尝试过在logstach的jdbc配置文件input中加入jdbc_default_timezone，也尝试过利用filter-ruby加入字段，减少5个小时，但并未见效，请问是什么原因，我的配置文件应该怎么写？\r\n我的配置文件内容如下：\r\n\r\ninput {\r\n    stdin{\r\n    }\r\n    jdbc {\r\n      # 数据库\r\n      jdbc_connection_string => \"jdbc:mysql://xxxx:xxxx/bigdata?useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull\"\r\n      jdbc_user => \"xxx\"\r\n      jdbc_password => \"xxx\"\r\n      # mysql驱动解压的位置\r\n      jdbc_driver_library => \"/home/elk1/software/logstash-6.5.3/logstash-core/lib/jars/mysql-connector-java-8.0.13.jar\"\r\n       # mysql驱动类\r\n      jdbc_driver_class => \"com.mysql.jdbc.Driver\"\r\n      jdbc_paging_enabled => \"true\"\r\n      jdbc_page_size => \"50000\"\r\n      #可以使用sql文件的方式\r\n      #statement_filepath => \"config-mysql/tag.sql\"\r\n      #要同步的表\r\n      statement => \"select * from axh_active_user limit 5\"\r\n      schedule => \"*/3 * * * *\"\r\n      #索引type\r\n      type => \"active\"\r\n      #索引设置时区\r\n      jdbc_default_timezone => \"Asia/Shanghai\"\r\n    }\r\n}\r\n\r\nfilter{\r\n    date {\r\n    match => [\"add_time\",\"UNIX_MS\"]\r\n    target => \"@timestamp\"   \r\n  }\r\n  ruby { \r\n   code => \"event.set('timestamp', event.get('@timestamp').time.localtime - 5*60*60)\" \r\n }\r\n ruby {\r\n   code => \"event.set('@timestamp',event.get('timestamp'))\"\r\n }\r\n mutate {\r\n   remove_field => [\"timestamp\"]\r\n }\r\n}\r\noutput {\r\n    elasticsearch {\r\n        hosts => \"xxxx:xxxx\"\r\n        #索引名称\r\n        index => \"test\"\r\n        document_id => \"%{id}\"\r\n        user => \"u\"\r\n        password => \"p\"\r\n        \"document_type\" => \"%{type}\"\r\n    }\r\n    stdout {\r\n        codec => json_lines\r\n    }\r\n}\r\n","closed_by":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"performed_via_github_app":null}