{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17395","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17395/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17395/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17395/events","html_url":"https://github.com/elastic/elasticsearch/issues/17395","id":144478965,"node_id":"MDU6SXNzdWUxNDQ0Nzg5NjU=","number":17395,"title":"/_cat/indices: race condition/exception thrown when creating/deleting indices rapidly ","user":{"login":"joshuar","id":7401,"node_id":"MDQ6VXNlcjc0MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/7401?v=4","gravatar_id":"","url":"https://api.github.com/users/joshuar","html_url":"https://github.com/joshuar","followers_url":"https://api.github.com/users/joshuar/followers","following_url":"https://api.github.com/users/joshuar/following{/other_user}","gists_url":"https://api.github.com/users/joshuar/gists{/gist_id}","starred_url":"https://api.github.com/users/joshuar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshuar/subscriptions","organizations_url":"https://api.github.com/users/joshuar/orgs","repos_url":"https://api.github.com/users/joshuar/repos","events_url":"https://api.github.com/users/joshuar/events{/privacy}","received_events_url":"https://api.github.com/users/joshuar/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-03-30T06:38:44Z","updated_at":"2018-02-14T14:05:44Z","closed_at":"2016-05-25T08:02:15Z","author_association":"MEMBER","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch Versions**:\n2.1.x - 2.2.x\n\n**JVM Version**:\nOpenJDK 64-Bit Server VM (build 25.77-b03, mixed mode)\n\n**Description of the problem including expected versus actual behavior**:\n\nIt looks like if you create and delete indices very rapidly you can sometimes end up getting a 404 index_not_found_exception from the `/_cat/indices` API. So basically rather than seeing the indices that still exist, you get an exception because one index was created and deleted between when the endpoint resolves indices and then call indices stats api for those indices.\n\n**Steps to reproduce**:\n\nAttached is a script that should hopefully reproduce the problem, but it can take some time (few minutes  depending on the ability of your ES cluster to handle responses :)\n\n[cat-indices-issue.sh.zip](https://github.com/elastic/elasticsearch/files/194945/cat-indices-issue.sh.zip)\n\nThe script is Bash. It will run a number of background processes that simply spin creating and then deleting an index with the REST API.  The script waits until the output of `_cat/indices` produces the exception, then exits. **NOTE:** It will clean-up any background processes it creates but won't clean up any test indices that might still exist.\n\nWhen the script dies, it will produce output like:\n\n```\n{\"error\":{\"root_cause\":[{\"type\":\"index_not_found_exception\",\"reason\":\"no such index\",\"resource.type\":\"index_or_alias\",\"resource.id\":\"testindex3\",\"index\":\"testindex3\"}],\"type\":\"index_not_found_exception\",\"reason\":\"no such index\",\"resource.type\":\"index_or_alias\",\"resource.id\":\"testindex3\",\"index\":\"testindex3\"},\"status\":404}\n...output of the script cleaning up after itself...\n```\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}