{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32712","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32712/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32712/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32712/events","html_url":"https://github.com/elastic/elasticsearch/issues/32712","id":348700882,"node_id":"MDU6SXNzdWUzNDg3MDA4ODI=","number":32712,"title":"Phrase suggester not respecting certain filters in collate query","user":{"login":"nickdatum","id":18681774,"node_id":"MDQ6VXNlcjE4NjgxNzc0","avatar_url":"https://avatars1.githubusercontent.com/u/18681774?v=4","gravatar_id":"","url":"https://api.github.com/users/nickdatum","html_url":"https://github.com/nickdatum","followers_url":"https://api.github.com/users/nickdatum/followers","following_url":"https://api.github.com/users/nickdatum/following{/other_user}","gists_url":"https://api.github.com/users/nickdatum/gists{/gist_id}","starred_url":"https://api.github.com/users/nickdatum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickdatum/subscriptions","organizations_url":"https://api.github.com/users/nickdatum/orgs","repos_url":"https://api.github.com/users/nickdatum/repos","events_url":"https://api.github.com/users/nickdatum/events{/privacy}","received_events_url":"https://api.github.com/users/nickdatum/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-08-08T12:18:18Z","updated_at":"2018-10-02T11:46:28Z","closed_at":"2018-10-02T11:46:28Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.3.2\r\n\r\n**Plugins installed**: none\r\n\r\n**JVM version** (`java -version`): Java HotSpot(TM) 64-Bit Server VM 18.3 (build 10.0.2+13, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Ubuntu 14.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen adding bool / filter to the collate as inline query, the results do not return accurately. This did not happen on a small index with my test environment but did on a larger index with several thousand items\r\n\r\nIn the example below, when deleted was changed from status \"no\" to \"yes\", suggestions were still occuring.\r\n\r\nThis works fine on my local test environment setup on Vagrant with the same setup as live, the only difference is my test environment has a small index of about 10 documents where the live environment has hundreds of documents in the index.\r\n\r\n**Steps to reproduce**:\r\n\r\nRequest:\r\n\r\n`{\"index\":\"r_search_2\",\"type\":\"_doc\",\"request_cache\":false,\"body\":{\"size\":1,\"suggest\":{\"text\":\"qwertt\",\"ruby_search_2\":{\"phrase\":{\"field\":\"Name\",\"max_errors\":2,\"confidence\":1,\"highlight\":{\"pre_tag\":\"<strong>\",\"post_tag\":\"<\\/strong>\"},\"size\":1,\"collate\":{\"query\":{\"inline\":{\"bool\":{\"filter\":[{\"term\":{\"Deleted\":\"no\"}}]}}},\"prune\":false}}}}}}`\r\n\r\n```\r\n(\r\n    [index] => r_search_2\r\n    [type] => _doc\r\n    [body] => Array\r\n        (\r\n            [size] => 1\r\n            [suggest] => Array\r\n                (\r\n                    [text] => qwertt\r\n                    [r_search_2] => Array\r\n                        (\r\n                            [phrase] => Array\r\n                                (\r\n                                    [field] => Name\r\n                                    [max_errors] => 2\r\n                                    [confidence] => 1\r\n                                    [highlight] => Array\r\n                                        (\r\n                                            [pre_tag] => <strong>\r\n                                            [post_tag] => </strong>\r\n                                        )\r\n                                    [size] => 1\r\n                                    [collate] => Array\r\n                                        (\r\n                                            [query] => Array\r\n                                                (\r\n                                                    [inline] => Array\r\n                                                        (\r\n                                                            [bool] => Array\r\n                                                                (\r\n                                                                    [filter] => Array\r\n                                                                        (\r\n                                                                            [0] => Array\r\n                                                                                (\r\n                                                                                    [term] => Array\r\n                                                                                        (\r\n                                                                                            [Deleted] => no\r\n                                                                                        )\r\n                                                                                )\r\n                                                                        )\r\n                                                                )\r\n                                                        )\r\n                                                )\r\n                                            [prune] => false\r\n                                        )\r\n                                )\r\n                        )\r\n                )\r\n        )\r\n)\r\n```\r\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}