[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476054244","html_url":"https://github.com/elastic/elasticsearch/issues/40397#issuecomment-476054244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40397","id":476054244,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjA1NDI0NA==","user":{"login":"ravi-kumar-yadav","id":11976090,"node_id":"MDQ6VXNlcjExOTc2MDkw","avatar_url":"https://avatars3.githubusercontent.com/u/11976090?v=4","gravatar_id":"","url":"https://api.github.com/users/ravi-kumar-yadav","html_url":"https://github.com/ravi-kumar-yadav","followers_url":"https://api.github.com/users/ravi-kumar-yadav/followers","following_url":"https://api.github.com/users/ravi-kumar-yadav/following{/other_user}","gists_url":"https://api.github.com/users/ravi-kumar-yadav/gists{/gist_id}","starred_url":"https://api.github.com/users/ravi-kumar-yadav/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ravi-kumar-yadav/subscriptions","organizations_url":"https://api.github.com/users/ravi-kumar-yadav/orgs","repos_url":"https://api.github.com/users/ravi-kumar-yadav/repos","events_url":"https://api.github.com/users/ravi-kumar-yadav/events{/privacy}","received_events_url":"https://api.github.com/users/ravi-kumar-yadav/received_events","type":"User","site_admin":false},"created_at":"2019-03-25T04:52:06Z","updated_at":"2019-03-25T14:42:58Z","author_association":"NONE","body":"@jimczi, @javanna: I saw a similar [PR](https://github.com/elastic/elasticsearch/pull/36996) that you worked on. Could you please help me with this issue ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476193689","html_url":"https://github.com/elastic/elasticsearch/issues/40397#issuecomment-476193689","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40397","id":476193689,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjE5MzY4OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-25T13:21:59Z","updated_at":"2019-03-25T13:21:59Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/476848025","html_url":"https://github.com/elastic/elasticsearch/issues/40397#issuecomment-476848025","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40397","id":476848025,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Njg0ODAyNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-26T20:54:56Z","updated_at":"2019-03-26T20:54:56Z","author_association":"MEMBER","body":"> Let me know if we could do it with a small tweak in existing ES-6.5 source code\r\n\r\nNo we can't, the completion suggester uses a data structure independent of the inverted lists so it is not possible to use fields outside of the suggester. One workaround I can think of would be to add the user_id as a suffix in your suggestion input. So you could replace `Nevermind` with `Nevermind_user12` for instance and then retrieve the original value in the client by removing the suffix from the responses. The deduplication would work on the entire input (`Nevermind_user12`) so you would be able to filter suggestions that share the same surface form and user id at the cost of a small rewriting at ingest time and when handling the response. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/477080575","html_url":"https://github.com/elastic/elasticsearch/issues/40397#issuecomment-477080575","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40397","id":477080575,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzA4MDU3NQ==","user":{"login":"ravi-kumar-yadav","id":11976090,"node_id":"MDQ6VXNlcjExOTc2MDkw","avatar_url":"https://avatars3.githubusercontent.com/u/11976090?v=4","gravatar_id":"","url":"https://api.github.com/users/ravi-kumar-yadav","html_url":"https://github.com/ravi-kumar-yadav","followers_url":"https://api.github.com/users/ravi-kumar-yadav/followers","following_url":"https://api.github.com/users/ravi-kumar-yadav/following{/other_user}","gists_url":"https://api.github.com/users/ravi-kumar-yadav/gists{/gist_id}","starred_url":"https://api.github.com/users/ravi-kumar-yadav/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ravi-kumar-yadav/subscriptions","organizations_url":"https://api.github.com/users/ravi-kumar-yadav/orgs","repos_url":"https://api.github.com/users/ravi-kumar-yadav/repos","events_url":"https://api.github.com/users/ravi-kumar-yadav/events{/privacy}","received_events_url":"https://api.github.com/users/ravi-kumar-yadav/received_events","type":"User","site_admin":false},"created_at":"2019-03-27T10:19:13Z","updated_at":"2019-03-27T10:19:13Z","author_association":"NONE","body":"Thanks @jimczi  .\r\n\r\nBut I noticed that: `Class: Option (org.elasticsearch.search.suggest.completion)` takes docID in constructor, but it's always set to `0`. If we could populate this with our `local_id` or any fix doc-field  during Option-object creation and use it during de-duplication (instead of suggestion-input which is being used as default metric), then will it help ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/477511251","html_url":"https://github.com/elastic/elasticsearch/issues/40397#issuecomment-477511251","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40397","id":477511251,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzUxMTI1MQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-28T09:12:45Z","updated_at":"2019-03-28T09:12:45Z","author_association":"MEMBER","body":"The `Option` class is used to merge the results of different shards so this would not solve the original issue. As said above the completion suggester uses a different data structure where documents are not sorted by docID so it is not possible to use another field when we perform lookups. The deduplication based on the input can be fast because suggestions are indexed in a tree-like structure where we can prune the paths that we already visited. The solution here is to append the `local_id` field to your suggestion inputs as advised above. I hope you don't mind if I close this issue but the completion suggester is already quite complex and this feature can be implemented client-side with little effort.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/477534455","html_url":"https://github.com/elastic/elasticsearch/issues/40397#issuecomment-477534455","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40397","id":477534455,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzUzNDQ1NQ==","user":{"login":"ravi-kumar-yadav","id":11976090,"node_id":"MDQ6VXNlcjExOTc2MDkw","avatar_url":"https://avatars3.githubusercontent.com/u/11976090?v=4","gravatar_id":"","url":"https://api.github.com/users/ravi-kumar-yadav","html_url":"https://github.com/ravi-kumar-yadav","followers_url":"https://api.github.com/users/ravi-kumar-yadav/followers","following_url":"https://api.github.com/users/ravi-kumar-yadav/following{/other_user}","gists_url":"https://api.github.com/users/ravi-kumar-yadav/gists{/gist_id}","starred_url":"https://api.github.com/users/ravi-kumar-yadav/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ravi-kumar-yadav/subscriptions","organizations_url":"https://api.github.com/users/ravi-kumar-yadav/orgs","repos_url":"https://api.github.com/users/ravi-kumar-yadav/repos","events_url":"https://api.github.com/users/ravi-kumar-yadav/events{/privacy}","received_events_url":"https://api.github.com/users/ravi-kumar-yadav/received_events","type":"User","site_admin":false},"created_at":"2019-03-28T10:20:16Z","updated_at":"2019-03-28T10:20:16Z","author_association":"NONE","body":"@jimczi : Thanks for quick reply, I will try the approach shared above.","performed_via_github_app":null}]