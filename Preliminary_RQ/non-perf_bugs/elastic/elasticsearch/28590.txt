{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28590/events","html_url":"https://github.com/elastic/elasticsearch/issues/28590","id":295725580,"node_id":"MDU6SXNzdWUyOTU3MjU1ODA=","number":28590,"title":"Elastic 6.2.1 in a Windows 2016 container crashes on startup if path.data is a volume","user":{"login":"chrisvanderpennen","id":5905218,"node_id":"MDQ6VXNlcjU5MDUyMTg=","avatar_url":"https://avatars2.githubusercontent.com/u/5905218?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisvanderpennen","html_url":"https://github.com/chrisvanderpennen","followers_url":"https://api.github.com/users/chrisvanderpennen/followers","following_url":"https://api.github.com/users/chrisvanderpennen/following{/other_user}","gists_url":"https://api.github.com/users/chrisvanderpennen/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisvanderpennen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisvanderpennen/subscriptions","organizations_url":"https://api.github.com/users/chrisvanderpennen/orgs","repos_url":"https://api.github.com/users/chrisvanderpennen/repos","events_url":"https://api.github.com/users/chrisvanderpennen/events{/privacy}","received_events_url":"https://api.github.com/users/chrisvanderpennen/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2018-02-09T01:31:43Z","updated_at":"2020-03-10T09:52:14Z","closed_at":"2018-03-14T01:30:00Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n`Version: 6.2.1, Build: 7299dc3/2018-02-07T19:34:26.990113Z, JVM: 9.0.4` (just in case)\r\n`Version: 6.2.1, Build: 7299dc3/2018-02-07T19:34:26.990113Z, JVM: 1.8.0_162`\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\nOracle server JRE windows/x64, versions:\r\n```\r\njava version \"9.0.4\"\r\nJava(TM) SE Runtime Environment (build 9.0.4+11)\r\nJava HotSpot(TM) 64-Bit Server VM (build 9.0.4+11, mixed mode)\r\n```\r\n```\r\njava version \"1.8.0_162\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_162-b12)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.162-b12, mixed mode)\r\n```\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nDocker version 17.06.2-ee-4\r\n\r\nWindows 2016 nanoserver container\r\n```\r\nPlatform Version\r\n-------- -------\r\n Win32NT 10.0.14393.0\r\n```\r\nWindows 2016 server core container\r\n```\r\nPlatform ServicePack Version      VersionString\r\n-------- ----------- -------      -------------\r\n Win32NT             10.0.14393.0 Microsoft Windows NT 10.0.14393.0\r\n```\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen running Elastic inside a windows container, If `path.data` resides in a docker volume mount Elastic crashes on startup.  The workaround described in https://github.com/moby/moby/issues/27537#issuecomment-271546031 worked for Elastic 5.6.7, but no longer works for Elastic 6.2.1.\r\n\r\n**Steps to reproduce**:\r\nClone https://github.com/chrisvanderpennen/elastic-wincontainer-crash\r\nDownload Elastic and Oracle's server JRE to `assets/`, replacing the URLs in the placeholder files\r\n`docker build -t elastic:crash .`\r\n`docker run --rm elastic:crash`\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n[2018-02-09T12:05:14,409][INFO ][o.e.n.Node               ] [057F70EA3551] initializing ...\r\n[2018-02-09T12:05:14,466][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [057F70EA3551] uncaught exception in thread [main]\r\norg.elasticsearch.bootstrap.StartupException: java.lang.IllegalStateException: failed to obtain node locks, tried [[G:\\db\\elastic]] with lock id [0]; maybe these locations are not writable or multiple nodes were started without increasing [node.max_local_storage_nodes] (was [1])?\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:125) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:112) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[elasticsearch-cli-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:85) ~[elasticsearch-6.2.1.jar:6.2.1]\r\nCaused by: java.lang.IllegalStateException: failed to obtain node locks, tried [[G:\\db\\elastic]] with lock id [0]; maybe these locations are not writable or multiple nodes were started without increasing [node.max_local_storage_nodes] (was [1])?\r\n        at org.elasticsearch.env.NodeEnvironment.<init>(NodeEnvironment.java:244) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:264) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:246) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:213) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:213) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:323) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        ... 6 more\r\nCaused by: java.io.IOException: failed to obtain lock on G:\\db\\nodes\\0\r\n        at org.elasticsearch.env.NodeEnvironment.<init>(NodeEnvironment.java:223) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:264) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:246) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:213) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:213) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:323) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        ... 6 more\r\nCaused by: java.nio.file.NoSuchFileException: G:\\db\\nodes\\0\r\n        at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:79) ~[?:?]\r\n        at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97) ~[?:?]\r\n        at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:102) ~[?:?]\r\n        at sun.nio.fs.WindowsLinkSupport.getFinalPath(WindowsLinkSupport.java:82) ~[?:?]\r\n        at sun.nio.fs.WindowsFileStore.create(WindowsFileStore.java:94) ~[?:?]\r\n        at sun.nio.fs.WindowsFileSystemProvider.getFileStore(WindowsFileSystemProvider.java:482) ~[?:?]\r\n        at java.nio.file.Files.getFileStore(Files.java:1461) ~[?:1.8.0_162]\r\n        at org.elasticsearch.env.Environment.getFileStore(Environment.java:306) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.env.NodeEnvironment$NodePath.<init>(NodeEnvironment.java:104) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.env.NodeEnvironment.<init>(NodeEnvironment.java:210) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:264) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:246) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:213) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:213) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:323) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:121) ~[elasticsearch-6.2.1.jar:6.2.1]\r\n        ... 6 more\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}