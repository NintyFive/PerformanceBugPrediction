{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38685","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38685/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38685/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38685/events","html_url":"https://github.com/elastic/elasticsearch/issues/38685","id":408642236,"node_id":"MDU6SXNzdWU0MDg2NDIyMzY=","number":38685,"title":"Version qualifier in main response breaks testLuceneVersionConstant","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"assignees":[{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-02-11T05:46:28Z","updated_at":"2020-11-11T21:49:46Z","closed_at":"2019-02-11T10:26:18Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In https://github.com/elastic/elasticsearch/pull/35412 we added the `-SNAPSHOT` qualifier to the version in the response for the main action `GET /`\r\n\r\nFor example:\r\n```\r\n{\r\n  \"name\" : \"node01\",\r\n  \"cluster_name\" : \"elasticsearch\",\r\n  \"cluster_uuid\" : \"E7dTpDuGR12x4qR_OOP6Rg\",\r\n  \"version\" : {\r\n    \"number\" : \"7.0.0-SNAPSHOT\",\r\n    \"build_flavor\" : \"default\",\r\n    \"build_type\" : \"tar\",\r\n    \"build_hash\" : \"6964083\",\r\n    \"build_date\" : \"2019-02-06T06:59:02.386711Z\",\r\n    \"build_snapshot\" : true,\r\n    \"lucene_version\" : \"8.0.0\",\r\n    \"minimum_wire_compatibility_version\" : \"6.7.0\",\r\n    \"minimum_index_compatibility_version\" : \"6.0.0-beta1\"\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}\r\n```\r\n\r\nIn 6.x the qualifier was not included:\r\n```\r\n{\r\n  \"name\" : \"node01\",\r\n  \"cluster_name\" : \"elasticsearch\",\r\n  \"cluster_uuid\" : \"j1Cagrq6Sa6_OxA4g7iu-Q\",\r\n  \"version\" : {\r\n    \"number\" : \"6.7.0\",\r\n    \"build_flavor\" : \"default\",\r\n    \"build_type\" : \"zip\",\r\n    \"build_hash\" : \"Unknown\",\r\n    \"build_date\" : \"2019-01-24T04:05:16.950403Z\",\r\n    \"build_snapshot\" : true,\r\n    \"lucene_version\" : \"7.6.0\",\r\n    \"minimum_wire_compatibility_version\" : \"5.6.0\",\r\n    \"minimum_index_compatibility_version\" : \"5.0.0\"\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}\r\n```\r\n\r\nThis causes `VerifyVersionConstantsIT.testLuceneVersionConstant` to fail ([log](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+default-distro-bwc-tests/14/console)) becuase it tries to pass the `version.number` through `Version.fromString` and fromString does not accept `-SNAPSHOT` qualifiers for versions new than 2.x\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/b8be6cb5c7ca7af0b10522426e525192b6b145dc/server/src/main/java/org/elasticsearch/Version.java#L297-L299\r\n\r\nREPRODUCE WITH: \r\n```\r\n./gradlew :qa:verify-version-constants:v7.0.0#oldClusterTestRunner -Dtests.seed=D70B4DC789F67CC -Dtests.class=org.elasticsearch.qa.verify_version_constants.VerifyVersionConstantsIT -Dtests.method=\"testLuceneVersionConstant\" -Dtests.security.manager=true -Dtests.locale=es-ES -Dtests.timezone=Antarctica/Rothera -Dtests.distribution=default -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n\r\nIt looks we either need to:\r\n1. Drop the qualifier from the main response in 7.0\r\n2. Accept the qualifier in `Version.fromString` if we're now including them again\r\n3. Work around it in `testLuceneVersionConstant` (but I suspect that won't be the only place).\r\n","closed_by":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"performed_via_github_app":null}