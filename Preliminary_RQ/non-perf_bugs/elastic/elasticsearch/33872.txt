{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33872","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33872/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33872/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33872/events","html_url":"https://github.com/elastic/elasticsearch/issues/33872","id":361885433,"node_id":"MDU6SXNzdWUzNjE4ODU0MzM=","number":33872,"title":"Cluster goes into a yellow state when relocating active primary shards","user":{"login":"rlhh","id":3825824,"node_id":"MDQ6VXNlcjM4MjU4MjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/3825824?v=4","gravatar_id":"","url":"https://api.github.com/users/rlhh","html_url":"https://github.com/rlhh","followers_url":"https://api.github.com/users/rlhh/followers","following_url":"https://api.github.com/users/rlhh/following{/other_user}","gists_url":"https://api.github.com/users/rlhh/gists{/gist_id}","starred_url":"https://api.github.com/users/rlhh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rlhh/subscriptions","organizations_url":"https://api.github.com/users/rlhh/orgs","repos_url":"https://api.github.com/users/rlhh/repos","events_url":"https://api.github.com/users/rlhh/events{/privacy}","received_events_url":"https://api.github.com/users/rlhh/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-09-19T19:02:29Z","updated_at":"2018-09-20T21:54:27Z","closed_at":"2018-09-20T21:54:27Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.3.2\r\n\r\n**Plugins installed**: []\r\n\r\nJVM version (java -version): openJDK 8\r\n\r\nOS version (uname -a if on a Unix-like system): Ubuntu 14.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhile trying to decommission nodes by using \"index.routing.allocation.exclude._ip\", we noticed that the cluster will go into a yellow state when it's  trying to move a primary shard for an index that's still receiving data. The same behaviour is observed when we use a move command. \r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Find a primary shard for an active index, note down the node id and shard number\r\n 2. Find a node where you can move the shard  to\r\n 3. Use the cluster/reroute to move the shard\r\n`\r\nPOST /_cluster/reroute\r\n{\r\n    \"commands\" : [\r\n        {\r\n            \"move\" : {\r\n                \"index\" : \"auditbeat-2018.09.07.17.00-1\", \"shard\" : 0, \"from_node\": \"qeAlD-qDS8yY_Okmcfqihg\", \"to_node\": \"zLhxQOynRJSF8a_58D-vyA\"\r\n            }\r\n        }\r\n    ]\r\n}\r\n`\r\n 4. You'll notice that the cluster is now in a yellow state now because there's a shard that's not allocated\r\n\r\n\r\nThe move and relocation of inactive primary shards are however ok. Is this the expected behaviour? \r\n\r\n\r\n","closed_by":{"login":"rlhh","id":3825824,"node_id":"MDQ6VXNlcjM4MjU4MjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/3825824?v=4","gravatar_id":"","url":"https://api.github.com/users/rlhh","html_url":"https://github.com/rlhh","followers_url":"https://api.github.com/users/rlhh/followers","following_url":"https://api.github.com/users/rlhh/following{/other_user}","gists_url":"https://api.github.com/users/rlhh/gists{/gist_id}","starred_url":"https://api.github.com/users/rlhh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rlhh/subscriptions","organizations_url":"https://api.github.com/users/rlhh/orgs","repos_url":"https://api.github.com/users/rlhh/repos","events_url":"https://api.github.com/users/rlhh/events{/privacy}","received_events_url":"https://api.github.com/users/rlhh/received_events","type":"User","site_admin":false},"performed_via_github_app":null}