[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/171949730","html_url":"https://github.com/elastic/elasticsearch/issues/16007#issuecomment-171949730","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16007","id":171949730,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTk0OTczMA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-15T12:35:22Z","updated_at":"2016-01-15T12:35:22Z","author_association":"CONTRIBUTOR","body":"Hi @manioc2015 \n\nYou have provided only snippets of the example, not a full recreation, so it is difficult to guess exactly where you are going wrong, but here's a recreation that shows that things do work correctly:\n\n```\nPUT t\n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"catalogs\": {\n          \"type\": \"nested\",\n          \"include_in_parent\": true,\n          \"properties\": {\n            \"id\": {\n              \"type\": \"string\"\n            },\n            \"status\": {\n              \"type\": \"string\"\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\nPUT t/t/1\n{\n  \"manufacturer\": {\n    \"id\": \"xxx\"\n  },\n  \"category\": {\n    \"id\": \"yyy\"\n  },\n  \"catalogs\": {\n    \"id\": \"55cdeece0a41216c008b4584\",\n    \"status\": \"visible\"\n  }\n}\n\nGET _search\n{\n  \"from\": 0,\n  \"size\": 0,\n  \"sort\": [\n    {\n      \"name.raw\": {\n        \"order\": \"asc\",\n        \"ignore_unmapped\": true\n      }\n    }\n  ],\n  \"aggregations\": {\n    \"manufacturers\": {\n      \"terms\": {\n        \"field\": \"manufacturer.id\",\n        \"size\": 40000\n      }\n    },\n    \"category\": {\n      \"terms\": {\n        \"field\": \"category.id\",\n        \"size\": 40000\n      }\n    }\n  },\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"nested\": {\n            \"path\": \"catalogs\",\n            \"query\": {\n              \"bool\": {\n                \"must\": [\n                  {\n                    \"match\": {\n                      \"catalogs.id\": \"55cdeece0a41216c008b4584\"\n                    }\n                  },\n                  {\n                    \"match\": {\n                      \"catalogs.status\": \"visible\"\n                    }\n                  }\n                ]\n              }\n            }\n          }\n        }\n      ]\n    }\n  }\n}\n```\n\nIt sounds like you have something incorrect, rather than there being a bug. Please ask these questions (with more details, and the version of ES that you're using) in the forums: http://discuss.elastic.co/\n","performed_via_github_app":null}]