[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/325576756","html_url":"https://github.com/elastic/elasticsearch/issues/26408#issuecomment-325576756","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26408","id":325576756,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNTU3Njc1Ng==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-08-29T07:18:02Z","updated_at":"2017-08-29T07:18:02Z","author_association":"MEMBER","body":"Thanks @jmlucjav \r\n\r\nWe always set `terminated_early` when the top hits collector was able to shortcut the collection even when `track_total_hits` is not disabled. When you set a size of 1 in your request, early termination is activated but it's also activated when you set the size to 5 because your shard contains only 2 documents. In such case the maximum size value is 2 and early termination kicks in on the last document, if you want to test a search without early termination you can send a query with size set to 3. \r\n`terminated_early` just means that the top hits collection did not check all documents to select the best N. Setting `track_total_hits` to false allows the entire query to terminate early (we don't need to count the total number of docs). Not sure if we should remove the flag when `track_total_hits` is not disabled, this is not a bug I did it conscientiously. IMO this is a good indication that the search was able to use the index sort to shortcut the collection (even if we had to count all documents). @jpountz WDYT ?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/325650081","html_url":"https://github.com/elastic/elasticsearch/issues/26408#issuecomment-325650081","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26408","id":325650081,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNTY1MDA4MQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-08-29T12:36:12Z","updated_at":"2017-08-29T12:36:12Z","author_association":"CONTRIBUTOR","body":">  Not sure if we should remove the flag when track_total_hits is not disabled\r\n\r\nI was thinking along the same lines.\r\n\r\nI can see why the `terminated_early` flag can be confusing. Sometimes it means results are partial, sometimes it means that we were able to early terminate the collection of top docs but results are complete. It is also not clear to which part of the request it applies: when `terminate_after` is used then it applies to everything while it otherwise it only applies to top docs.\r\n\r\nI'm actually wondering about going one step further than your proposal: maybe we should only put `terminated_early` in the response as a way to indicate partial results, ie. when `terminate_after` is used.\r\n\r\n> Hits \"total\" : -1 is debatable, we asked for it so it could be ok if set, but it also can be argued that as it had the correct info it should return it?\r\n\r\nIn this special case with few matches, we could indeed know the match count. However we don't know it in the general case so I'd rather keep things the way they are today and potentially improve documentation in order to say that we will return `-1` when `track_total_hits` is `false` even if we had to visit all matches. I think this behaviour is also beneficial for testing: you would get similar results with a few documents in your index or millions of documents.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/328552148","html_url":"https://github.com/elastic/elasticsearch/issues/26408#issuecomment-328552148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26408","id":328552148,"node_id":"MDEyOklzc3VlQ29tbWVudDMyODU1MjE0OA==","user":{"login":"EricMCornelius","id":748917,"node_id":"MDQ6VXNlcjc0ODkxNw==","avatar_url":"https://avatars1.githubusercontent.com/u/748917?v=4","gravatar_id":"","url":"https://api.github.com/users/EricMCornelius","html_url":"https://github.com/EricMCornelius","followers_url":"https://api.github.com/users/EricMCornelius/followers","following_url":"https://api.github.com/users/EricMCornelius/following{/other_user}","gists_url":"https://api.github.com/users/EricMCornelius/gists{/gist_id}","starred_url":"https://api.github.com/users/EricMCornelius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EricMCornelius/subscriptions","organizations_url":"https://api.github.com/users/EricMCornelius/orgs","repos_url":"https://api.github.com/users/EricMCornelius/repos","events_url":"https://api.github.com/users/EricMCornelius/events{/privacy}","received_events_url":"https://api.github.com/users/EricMCornelius/received_events","type":"User","site_admin":false},"created_at":"2017-09-11T14:44:59Z","updated_at":"2017-09-11T14:46:16Z","author_association":"NONE","body":"Just hit upon this issue myself.  I agree with @jpountz  that interpreting \"terminated_early\" as indicating partial results is what most current users expect (given this only happens on \"terminate_after\" at present), so keeping that behavior intact with index sorting would be very much appreciated.\r\n\r\nAs for the special case, I imagine there might actually be many situations where users want to know if they're seeing a complete or partial set of hits.\r\n\r\nGranted, I believe this is actually the same as a client setting `hits.total = (query.size > hits.hits.length) ? hits.hits.length : -1`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346166895","html_url":"https://github.com/elastic/elasticsearch/issues/26408#issuecomment-346166895","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26408","id":346166895,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NjE2Njg5NQ==","user":{"login":"jmlucjav","id":1813237,"node_id":"MDQ6VXNlcjE4MTMyMzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1813237?v=4","gravatar_id":"","url":"https://api.github.com/users/jmlucjav","html_url":"https://github.com/jmlucjav","followers_url":"https://api.github.com/users/jmlucjav/followers","following_url":"https://api.github.com/users/jmlucjav/following{/other_user}","gists_url":"https://api.github.com/users/jmlucjav/gists{/gist_id}","starred_url":"https://api.github.com/users/jmlucjav/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jmlucjav/subscriptions","organizations_url":"https://api.github.com/users/jmlucjav/orgs","repos_url":"https://api.github.com/users/jmlucjav/repos","events_url":"https://api.github.com/users/jmlucjav/events{/privacy}","received_events_url":"https://api.github.com/users/jmlucjav/received_events","type":"User","site_admin":false},"created_at":"2017-11-21T21:28:45Z","updated_at":"2017-11-21T21:28:45Z","author_association":"NONE","body":"I just realized that my email was not public at the time I opened this ticket. Is the pioneer program still on? do I need to do something?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346263153","html_url":"https://github.com/elastic/elasticsearch/issues/26408#issuecomment-346263153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26408","id":346263153,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NjI2MzE1Mw==","user":{"login":"markwalkom","id":3184718,"node_id":"MDQ6VXNlcjMxODQ3MTg=","avatar_url":"https://avatars0.githubusercontent.com/u/3184718?v=4","gravatar_id":"","url":"https://api.github.com/users/markwalkom","html_url":"https://github.com/markwalkom","followers_url":"https://api.github.com/users/markwalkom/followers","following_url":"https://api.github.com/users/markwalkom/following{/other_user}","gists_url":"https://api.github.com/users/markwalkom/gists{/gist_id}","starred_url":"https://api.github.com/users/markwalkom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markwalkom/subscriptions","organizations_url":"https://api.github.com/users/markwalkom/orgs","repos_url":"https://api.github.com/users/markwalkom/repos","events_url":"https://api.github.com/users/markwalkom/events{/privacy}","received_events_url":"https://api.github.com/users/markwalkom/received_events","type":"User","site_admin":false},"created_at":"2017-11-22T07:14:30Z","updated_at":"2017-11-22T07:14:41Z","author_association":"MEMBER","body":"@jmlucjav If you want to reach out to us (community@elastic.co) we will make sure the things that need to happen happen :)","performed_via_github_app":null}]