{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8530","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8530/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8530/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8530/events","html_url":"https://github.com/elastic/elasticsearch/issues/8530","id":49204978,"node_id":"MDU6SXNzdWU0OTIwNDk3OA==","number":8530,"title":"Can't sort on field with custom date format mapping","user":{"login":"jensbengtsson","id":1673887,"node_id":"MDQ6VXNlcjE2NzM4ODc=","avatar_url":"https://avatars0.githubusercontent.com/u/1673887?v=4","gravatar_id":"","url":"https://api.github.com/users/jensbengtsson","html_url":"https://github.com/jensbengtsson","followers_url":"https://api.github.com/users/jensbengtsson/followers","following_url":"https://api.github.com/users/jensbengtsson/following{/other_user}","gists_url":"https://api.github.com/users/jensbengtsson/gists{/gist_id}","starred_url":"https://api.github.com/users/jensbengtsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jensbengtsson/subscriptions","organizations_url":"https://api.github.com/users/jensbengtsson/orgs","repos_url":"https://api.github.com/users/jensbengtsson/repos","events_url":"https://api.github.com/users/jensbengtsson/events{/privacy}","received_events_url":"https://api.github.com/users/jensbengtsson/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2014-11-18T10:33:33Z","updated_at":"2016-04-28T17:44:35Z","closed_at":"2014-11-25T13:44:28Z","author_association":"NONE","active_lock_reason":null,"body":"I'm running elasticsearch 1.4\n\n``` javascript\n{\n\n    \"status\": 200,\n    \"name\": \"Bevatron\",\n    \"cluster_name\": \"poc\",\n    \"version\": {\n        \"number\": \"1.4.0\",\n        \"build_hash\": \"bc94bd81298f81c656893ab1ddddd30a99356066\",\n        \"build_timestamp\": \"2014-11-05T14:26:12Z\",\n        \"build_snapshot\": false,\n        \"lucene_version\": \"4.10.2\"\n    },\n    \"tagline\": \"You Know, for Search\"\n\n}\n```\n\nI have a type with the following mapping:\n\n``` javascript\n{\n   \"bopo\": {\n      \"mappings\": {\n         \"ProductionTypeCapacity\": {\n            \"properties\": {\n               \"AddedDate\": {\n                  \"type\": \"date\",\n                  \"format\": \"dateOptionalTime\"\n               },\n               \"ChangedDate\": {\n                  \"type\": \"date\",\n                  \"format\": \"dateOptionalTime\"\n               },\n               \"CorporateBrandCapacities\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n               },\n               \"HadesScriptUsed\": {\n                  \"type\": \"string\"\n               },\n               \"Key\": {\n                  \"type\": \"string\"\n               },\n               \"Month\": {\n                  \"type\": \"date\",\n                  \"format\": \"yyyy-MM\"\n               },\n               \"ProductionUnitId\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n               },\n               \"SupplierId\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n               }\n            }\n         }\n      }\n   }\n}\n```\n\nA hit looks like this:\n\n``` javascript\n  {\n            \"_index\": \"bopo\",\n            \"_type\": \"ProductionTypeCapacity\",\n            \"_id\": \"ProductionTypeCapacity-120886-120288-2014-12\",\n            \"_score\": 1,\n            \"_source\": {\n               \"Key\": \"120886-120288-2014-12\",\n               \"AddedDate\": \"2014-03-04T02:33:04.9430000\",\n               \"ChangedDate\": \"2014-03-04T10:12:24.3830000\",\n               \"CorporateBrandCapacities\": \"Home\",\n               \"Month\": \"2014-12\",\n               \"ProductionUnitId\": \"120288\",\n               \"SupplierId\": \"120886\",\n               \"HadesScriptUsed\": \"CapacityRegistrationScript\"\n            }\n         }\n```\n\nWhen I execute the following query:\n\n``` javascript\nPOST bopo/ProductionTypeCapacity/_search\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"sort\": [\n    {\n      \"Month\": {\n        \"order\": \"desc\"\n      }\n    }\n  ]\n}\n```\n\nI get this error:\n\n``` javascript\n{\n   \"error\": \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[81vkOCltQm6PWmlJSmiVog][bopo][0]: QueryPhaseExecutionException[[bopo][0]: query[ConstantScore(cache(_type:ProductionTypeCapacity))],from[0],size[10],sort[<custom:\\\"Month\\\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@149bf6c8>!]: Query Failed [Failed to execute main query]]; nested: ClassCastException[org.elasticsearch.index.fielddata.plain.AbstractAtomicOrdinalsFieldData$1 cannot be cast to org.elasticsearch.index.fielddata.AtomicNumericFieldData]; }{[81vkOCltQm6PWmlJSmiVog][bopo][1]: QueryPhaseExecutionException[[bopo][1]: query[ConstantScore(cache(_type:ProductionTypeCapacity))],from[0],size[10],sort[<custom:\\\"Month\\\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@603af23>!]: Query Failed [Failed to execute main query]]; nested: ClassCastException[org.elasticsearch.index.fielddata.plain.AbstractAtomicOrdinalsFieldData$1 cannot be cast to org.elasticsearch.index.fielddata.AtomicNumericFieldData]; }{[81vkOCltQm6PWmlJSmiVog][bopo][2]: QueryPhaseExecutionException[[bopo][2]: query[ConstantScore(cache(_type:ProductionTypeCapacity))],from[0],size[10],sort[<custom:\\\"Month\\\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@695b5d68>!]: Query Failed [Failed to execute main query]]; nested: ClassCastException[org.elasticsearch.index.fielddata.plain.AbstractAtomicOrdinalsFieldData$1 cannot be cast to org.elasticsearch.index.fielddata.AtomicNumericFieldData]; }{[81vkOCltQm6PWmlJSmiVog][bopo][3]: QueryPhaseExecutionException[[bopo][3]: query[ConstantScore(cache(_type:ProductionTypeCapacity))],from[0],size[10],sort[<custom:\\\"Month\\\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@4627c21b>!]: Query Failed [Failed to execute main query]]; nested: ClassCastException[org.elasticsearch.index.fielddata.plain.AbstractAtomicOrdinalsFieldData$1 cannot be cast to org.elasticsearch.index.fielddata.AtomicNumericFieldData]; }{[81vkOCltQm6PWmlJSmiVog][bopo][4]: QueryPhaseExecutionException[[bopo][4]: query[ConstantScore(cache(_type:ProductionTypeCapacity))],from[0],size[10],sort[<custom:\\\"Month\\\": org.elasticsearch.index.fielddata.fieldcomparator.LongValuesComparatorSource@446d2a0b>!]: Query Failed [Failed to execute main query]]; nested: ClassCastException[org.elasticsearch.index.fielddata.plain.AbstractAtomicOrdinalsFieldData$1 cannot be cast to org.elasticsearch.index.fielddata.AtomicNumericFieldData]; }]\",\n   \"status\": 500\n}\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}