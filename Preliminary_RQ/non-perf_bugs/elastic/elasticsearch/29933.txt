{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933/events","html_url":"https://github.com/elastic/elasticsearch/issues/29933","id":317449589,"node_id":"MDU6SXNzdWUzMTc0NDk1ODk=","number":29933,"title":".security with status yellow when cluster.routing.allocation.same_shard.host enabled","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":912838879,"node_id":"MDU6TGFiZWw5MTI4Mzg4Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Security","name":":Security/Security","color":"0e8a16","default":false,"description":"Security issues without another label"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"assignees":[{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2017-04-28T13:02:21Z","updated_at":"2018-08-24T18:51:23Z","closed_at":"2018-08-24T18:51:23Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"*Original comment by @MarxDimitri:*\n\nEnabling cluster.routing.allocation.same_shard.host on deployments with multiple nodes on a single host puts .security to yellow. Tested with the version 5.3.\r\n\r\n```\r\nGET /_cat/indices\r\nhealth status index                             uuid                   pri rep docs.count docs.deleted store.size pri.store.size\r\n…\r\nyellow open   .security                         bpl6HgGdRcqmwZEqAAGBnw   1  11          1            0     17.3kb          2.8kb\r\n…\r\n```\r\n\r\n```\r\nGET /_cluster/allocation/explain\r\n{\r\n  \"index\": \".security\",\r\n  \"shard\": 0,\r\n  \"primary\": false,\r\n  \"current_state\": \"unassigned\",\r\n  \"unassigned_info\": {\r\n    \"reason\": \"REPLICA_ADDED\",\r\n    \"at\": \"2017-04-24T11:50:54.057Z\",\r\n    \"last_allocation_status\": \"no_attempt\"\r\n  },\r\n  \"can_allocate\": \"no\",\r\n  \"allocate_explanation\": \"cannot allocate because allocation is not permitted to any of the nodes\",\r\n  \"node_allocation_decisions\": [\r\n    {\r\n      \"node_id\": \"9-hnXjLEThy-c4TbfgqUTg\",\r\n      \"node_name\": \"esindex-il03_warm_2\",\r\n      \"transport_address\": \"172.27.130.206:9300\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"warm\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated to the same node on which a copy of the shard already exists [[.security][0], node[9-hnXjLEThy-c4TbfgqUTg], [R], s[STARTED], a[id=yutvMaxhTfCHI6lUgyvCDQ]]\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"FSGDMHoIQwWtypVKi-Tf2A\",\r\n      \"node_name\": \"esindex-il05_warm_2\",\r\n      \"transport_address\": \"172.27.130.208:9301\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"warm\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated to the same node on which a copy of the shard already exists [[.security][0], node[FSGDMHoIQwWtypVKi-Tf2A], [R], s[STARTED], a[id=ffHbyCIaT0WcNpB25Xu17g]]\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"G7FHRbvPSWKgrbLdwgP5Cw\",\r\n      \"node_name\": \"esindex-il05_warm_1\",\r\n      \"transport_address\": \"172.27.130.208:9300\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"warm\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated on host address [172.27.130.208], where it already exists on node [G7FHRbvPSWKgrbLdwgP5Cw]; set cluster setting [cluster.routing.allocation.same_shard.host] to false to allow multiple nodes on the same host to hold the same shard copies\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"I0IBpNXYQj63CtqFzXEQng\",\r\n      \"node_name\": \"esindex-il01_hot_2\",\r\n      \"transport_address\": \"172.27.130.198:9301\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"hot\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated on host address [172.27.130.198], where it already exists on node [I0IBpNXYQj63CtqFzXEQng]; set cluster setting [cluster.routing.allocation.same_shard.host] to false to allow multiple nodes on the same host to hold the same shard copies\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"Wht2Q3m4ShCG9fDb1_WPAA\",\r\n      \"node_name\": \"esindex-il04_warm_2\",\r\n      \"transport_address\": \"172.27.130.207:9301\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"warm\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated on host address [172.27.130.207], where it already exists on node [Wht2Q3m4ShCG9fDb1_WPAA]; set cluster setting [cluster.routing.allocation.same_shard.host] to false to allow multiple nodes on the same host to hold the same shard copies\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"XZMimYlLThSbMY3L9sYFbA\",\r\n      \"node_name\": \"esindex-il03_warm_1\",\r\n      \"transport_address\": \"172.27.130.206:9301\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"warm\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated on host address [172.27.130.206], where it already exists on node [XZMimYlLThSbMY3L9sYFbA]; set cluster setting [cluster.routing.allocation.same_shard.host] to false to allow multiple nodes on the same host to hold the same shard copies\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"XiYyR0iMR6Kmb49DYoeuTw\",\r\n      \"node_name\": \"esindex-il00_hot_2\",\r\n      \"transport_address\": \"172.27.130.197:9300\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"hot\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated to the same node on which a copy of the shard already exists [[.security][0], node[XiYyR0iMR6Kmb49DYoeuTw], [R], s[STARTED], a[id=0IuYqdzeRs-FXqHpzNDSjQ]]\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"ZSk0zfN3SJeg09PDkK8E6Q\",\r\n      \"node_name\": \"esindex-il01_hot_1\",\r\n      \"transport_address\": \"172.27.130.198:9300\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"hot\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated to the same node on which a copy of the shard already exists [[.security][0], node[ZSk0zfN3SJeg09PDkK8E6Q], [R], s[STARTED], a[id=yDdnf-wkSlySVhwhm2JsNA]]\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"ceG6PFJ6Qq2s2ia8dAB68w\",\r\n      \"node_name\": \"esindex-il02_hot_2\",\r\n      \"transport_address\": \"172.27.130.199:9301\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"hot\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated on host address [172.27.130.199], where it already exists on node [ceG6PFJ6Qq2s2ia8dAB68w]; set cluster setting [cluster.routing.allocation.same_shard.host] to false to allow multiple nodes on the same host to hold the same shard copies\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"eE8aD3CwTJeEEg30KbfFDg\",\r\n      \"node_name\": \"esindex-il00_hot_1\",\r\n      \"transport_address\": \"172.27.130.197:9301\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"hot\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated on host address [172.27.130.197], where it already exists on node [eE8aD3CwTJeEEg30KbfFDg]; set cluster setting [cluster.routing.allocation.same_shard.host] to false to allow multiple nodes on the same host to hold the same shard copies\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"uKD4Gy6ZRe-SolYYQNVMmw\",\r\n      \"node_name\": \"esindex-il02_hot_1\",\r\n      \"transport_address\": \"172.27.130.199:9300\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"hot\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated to the same node on which a copy of the shard already exists [[.security][0], node[uKD4Gy6ZRe-SolYYQNVMmw], [R], s[STARTED], a[id=Yln4Q0N6TrGD1FCuFvXgMg]]\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"node_id\": \"ui7i2lC3S7K_hvjF8_BMtw\",\r\n      \"node_name\": \"esindex-il04_warm_1\",\r\n      \"transport_address\": \"172.27.130.207:9300\",\r\n      \"node_attributes\": {\r\n        \"firezone\": \"l\",\r\n        \"box_type\": \"warm\"\r\n      },\r\n      \"node_decision\": \"no\",\r\n      \"deciders\": [\r\n        {\r\n          \"decider\": \"same_shard\",\r\n          \"decision\": \"NO\",\r\n          \"explanation\": \"the shard cannot be allocated to the same node on which a copy of the shard already exists [[.security][0], node[ui7i2lC3S7K_hvjF8_BMtw], [P], s[STARTED], a[id=cNLniAwgS4mrZDFDPRxc3g]]\"\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}\r\n```\r\n","closed_by":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"performed_via_github_app":null}