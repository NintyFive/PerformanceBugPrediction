{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25185","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25185/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25185/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25185/events","html_url":"https://github.com/elastic/elasticsearch/issues/25185","id":235344501,"node_id":"MDU6SXNzdWUyMzUzNDQ1MDE=","number":25185,"title":"[CI] Rolling upgrade mixed cluster tests timeout waiting for green cluster health","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"labels":[{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"}],"state":"closed","locked":false,"assignee":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"assignees":[{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false}],"milestone":null,"comments":10,"created_at":"2017-06-12T19:44:36Z","updated_at":"2017-07-06T21:09:56Z","closed_at":"2017-07-06T18:35:54Z","author_association":"MEMBER","active_lock_reason":null,"body":"The rolling upgrade tests failed on the 5.5 branch due to the call to the cluster health API not returning anything after 30 seconds in the `mixed_cluster/10_basic/Index data and search on the mixed cluster` test.\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.5+bwc-tests/18/console\r\n\r\n```\r\nREPRODUCE WITH: gradle :qa:rolling-upgrade:v5.0.2#mixedClusterTestRunner -Dtests.seed=48F336D5A9FD5B28 -Dtests.class=org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT -Dtests.method=\"test {p0=mixed_cluster/10_basic/Index data and search on the mixed cluster}\" -Dtests.security.manager=true -Dtests.locale=de-AT -Dtests.timezone=Africa/Maseru -Dtests.rest.suite=mixed_cluster\r\nERROR   30.5s | UpgradeClusterClientYamlTestSuiteIT.test {p0=mixed_cluster/10_basic/Index data and search on the mixed cluster} <<< FAILURES!\r\n   > Throwable #1: java.lang.RuntimeException: Failure at [mixed_cluster/10_basic:3]: listener timeout after waiting for [30000] ms\r\n   > \tat __randomizedtesting.SeedInfo.seed([48F336D5A9FD5B28:C0A7090F070136D0]:0)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:343)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:325)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: java.io.IOException: listener timeout after waiting for [30000] ms\r\n   > \tat org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:660)\r\n   > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:219)\r\n   > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:191)\r\n   > \tat org.elasticsearch.test.rest.yaml.ClientYamlTestClient.callApi(ClientYamlTestClient.java:173)\r\n   > \tat org.elasticsearch.test.rest.yaml.ClientYamlTestExecutionContext.callApiInternal(ClientYamlTestExecutionContext.java:161)\r\n   > \tat org.elasticsearch.test.rest.yaml.ClientYamlTestExecutionContext.callApi(ClientYamlTestExecutionContext.java:93)\r\n   > \tat org.elasticsearch.test.rest.yaml.section.DoSection.execute(DoSection.java:221)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:341)\r\n   > \t... 38 more\r\n```\r\n\r\nOne enhancement that may help for future failure debugging is to change the timeout of either the cluster health request or the rest client so that the cluster health call times out on the server and we get a response rather than the test just aborting due to the rest client timeout.\r\n\r\n@abeyad assigning to you based on the git history.","closed_by":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"performed_via_github_app":null}