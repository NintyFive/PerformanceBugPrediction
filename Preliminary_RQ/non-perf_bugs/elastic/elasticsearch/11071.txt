{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11071","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11071/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11071/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11071/events","html_url":"https://github.com/elastic/elasticsearch/issues/11071","id":74506154,"node_id":"MDU6SXNzdWU3NDUwNjE1NA==","number":11071,"title":"Transport exception processing BigDecimal type from groovy script","user":{"login":"bradvido","id":884611,"node_id":"MDQ6VXNlcjg4NDYxMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/884611?v=4","gravatar_id":"","url":"https://api.github.com/users/bradvido","html_url":"https://github.com/bradvido","followers_url":"https://api.github.com/users/bradvido/followers","following_url":"https://api.github.com/users/bradvido/following{/other_user}","gists_url":"https://api.github.com/users/bradvido/gists{/gist_id}","starred_url":"https://api.github.com/users/bradvido/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradvido/subscriptions","organizations_url":"https://api.github.com/users/bradvido/orgs","repos_url":"https://api.github.com/users/bradvido/repos","events_url":"https://api.github.com/users/bradvido/events{/privacy}","received_events_url":"https://api.github.com/users/bradvido/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2015-05-08T21:43:50Z","updated_at":"2016-08-24T16:57:02Z","closed_at":"2015-07-16T16:31:21Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I'm using ElasticSearch 1.5.2.\n\nI have a **groovy** script_file \n`disk_total_free_percent.groovy`:\n\n```\ndef totalSize = doc['Machine.disk_total_size_(mb)'].value;\ndef freeSpace = doc['Machine.disk_total_free_space_(mb)'].value;\nif(totalSize == 0) { \n    //none is free, since the disk has no size\n    0.0 //percent\n}else {\n    freeSpace / totalSize   \n}\n```\n\nWhen I execute a search with `script_fields` including the above script, I get an error from ES\n`[indices:data/read/search[phase/fetch/id]]]; nested: IOException[Can't write type [class java.math.BigDecimal]];` \nThis is generated by [this line of code in StreamOutput.java](https://github.com/elastic/elasticsearch/blob/master/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java#L402)\n\nIt's also interesting that the number of shards that fail with this exception varies (for the same query). Sometimes it's 1, sometimes 2 or 3.\n\n---\n\nFor comparison, I installed the **javascript** scripting plugin and tried the same script (replacing `def` with `var`)\n`disk_total_free_percent.js`:\n\n```\nvar totalSize = doc['Machine.disk_total_size_(mb)'].value;\nvar freeSpace = doc['Machine.disk_total_free_space_(mb)'].value;\nif(totalSize == 0) { \n    //none is free, since the disk has no size\n    0.0 //percent\n}else {\n    freeSpace / totalSize   \n}\n```\n\nAnd **it worked** without any exceptions. This makes me think it's a problem with the Groovy scripting module.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}