[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/168789211","html_url":"https://github.com/elastic/elasticsearch/issues/15757#issuecomment-168789211","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15757","id":168789211,"node_id":"MDEyOklzc3VlQ29tbWVudDE2ODc4OTIxMQ==","user":{"login":"eskibars","id":2246002,"node_id":"MDQ6VXNlcjIyNDYwMDI=","avatar_url":"https://avatars0.githubusercontent.com/u/2246002?v=4","gravatar_id":"","url":"https://api.github.com/users/eskibars","html_url":"https://github.com/eskibars","followers_url":"https://api.github.com/users/eskibars/followers","following_url":"https://api.github.com/users/eskibars/following{/other_user}","gists_url":"https://api.github.com/users/eskibars/gists{/gist_id}","starred_url":"https://api.github.com/users/eskibars/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eskibars/subscriptions","organizations_url":"https://api.github.com/users/eskibars/orgs","repos_url":"https://api.github.com/users/eskibars/repos","events_url":"https://api.github.com/users/eskibars/events{/privacy}","received_events_url":"https://api.github.com/users/eskibars/received_events","type":"User","site_admin":false},"created_at":"2016-01-04T20:00:56Z","updated_at":"2016-01-04T20:00:56Z","author_association":"CONTRIBUTOR","body":"Can you reproduce consistently with the Java API?  If so, can you provide an example snippet in a gist or the like?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/168964334","html_url":"https://github.com/elastic/elasticsearch/issues/15757#issuecomment-168964334","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15757","id":168964334,"node_id":"MDEyOklzc3VlQ29tbWVudDE2ODk2NDMzNA==","user":{"login":"TheHound","id":1637134,"node_id":"MDQ6VXNlcjE2MzcxMzQ=","avatar_url":"https://avatars2.githubusercontent.com/u/1637134?v=4","gravatar_id":"","url":"https://api.github.com/users/TheHound","html_url":"https://github.com/TheHound","followers_url":"https://api.github.com/users/TheHound/followers","following_url":"https://api.github.com/users/TheHound/following{/other_user}","gists_url":"https://api.github.com/users/TheHound/gists{/gist_id}","starred_url":"https://api.github.com/users/TheHound/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheHound/subscriptions","organizations_url":"https://api.github.com/users/TheHound/orgs","repos_url":"https://api.github.com/users/TheHound/repos","events_url":"https://api.github.com/users/TheHound/events{/privacy}","received_events_url":"https://api.github.com/users/TheHound/received_events","type":"User","site_admin":false},"created_at":"2016-01-05T10:19:48Z","updated_at":"2016-01-05T10:23:31Z","author_association":"NONE","body":"Hi, apologies for the misleading issue above I have finally reproduced with curl (I had missed something from my mapping previously). This seems to be cause by nested fields. In the last step outlined below there are 2 results. If the mapping for entityContent is removed then there are no results (this is correct)\n\nN.B. Not sure if this helps or not but this is a regression from 1.7.3 caught by one of our tests as part of me upgrading to 2.1.0\n\nSteps:\n\n```\n#Create Index\ncurl -XPUT \"http://localhost:9200/index1\"\n\n#Create mappings\ncurl -XPUT --data @index1.type1.json \"http://localhost:9200/index1/type1/_mapping\"\ncurl -XPUT --data @index1.type2.json \"http://localhost:9200/index1/type2/_mapping\"\n\n#Add Data\ncurl -XPUT --data @index1.data.json \"http://localhost:9200/index1/type1/2\"\ncurl -XPUT --data @index1.data.json \"http://localhost:9200/index1/type2/2\"\n\n#Creates 2 hits\ncurl \"http://localhost:9200/index1/a,b/_search?q=test\"\n```\n\nFiles:\nindex1.type1.json\n\n```\n{\n    \"type1\" : {\n        \"properties\" : {\n            \"content\" : {\n                \"type\" : \"string\"\n            },\n            \"entityContent\" : {\n                \"type\" : \"nested\",\n                \"properties\" : {\n                    \"field1\" : {\n                        \"type\" : \"string\"\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\nindex1.type2.json\n\n```\n{\n    \"type2\" : {\n        \"properties\" : {\n            \"content\" : {\n                \"type\" : \"string\"\n            }\n        }\n    }\n}\n```\n\nindex1.data.json\n\n```\n{\n    \"content\" : \"This is a Test.\"\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169066063","html_url":"https://github.com/elastic/elasticsearch/issues/15757#issuecomment-169066063","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15757","id":169066063,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTA2NjA2Mw==","user":{"login":"TheHound","id":1637134,"node_id":"MDQ6VXNlcjE2MzcxMzQ=","avatar_url":"https://avatars2.githubusercontent.com/u/1637134?v=4","gravatar_id":"","url":"https://api.github.com/users/TheHound","html_url":"https://github.com/TheHound","followers_url":"https://api.github.com/users/TheHound/followers","following_url":"https://api.github.com/users/TheHound/following{/other_user}","gists_url":"https://api.github.com/users/TheHound/gists{/gist_id}","starred_url":"https://api.github.com/users/TheHound/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheHound/subscriptions","organizations_url":"https://api.github.com/users/TheHound/orgs","repos_url":"https://api.github.com/users/TheHound/repos","events_url":"https://api.github.com/users/TheHound/events{/privacy}","received_events_url":"https://api.github.com/users/TheHound/received_events","type":"User","site_admin":false},"created_at":"2016-01-05T17:13:36Z","updated_at":"2016-01-05T17:13:36Z","author_association":"NONE","body":"Having a quick read through the elasticsearch code base I assume this is going wrong on line 534 of \nhttps://github.com/elastic/elasticsearch/blob/1a47226d9af373e4627cd360ad8a8a7b93ea7882/core/src/main/java/org/elasticsearch/index/mapper/MapperService.java though not familiar enough to say for certain.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170343132","html_url":"https://github.com/elastic/elasticsearch/issues/15757#issuecomment-170343132","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15757","id":170343132,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDM0MzEzMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-10T12:59:12Z","updated_at":"2016-01-10T12:59:12Z","author_association":"CONTRIBUTOR","body":"Hi @TheHound \n\nI don't understand this issue at all, or how what you see is different from what you expect.  The example you give above returns two documents, which is what I'd expect to get.  You're searching the `_all` field for the word `test`, which matches both documents.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170476761","html_url":"https://github.com/elastic/elasticsearch/issues/15757#issuecomment-170476761","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15757","id":170476761,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDQ3Njc2MQ==","user":{"login":"TheHound","id":1637134,"node_id":"MDQ6VXNlcjE2MzcxMzQ=","avatar_url":"https://avatars2.githubusercontent.com/u/1637134?v=4","gravatar_id":"","url":"https://api.github.com/users/TheHound","html_url":"https://github.com/TheHound","followers_url":"https://api.github.com/users/TheHound/followers","following_url":"https://api.github.com/users/TheHound/following{/other_user}","gists_url":"https://api.github.com/users/TheHound/gists{/gist_id}","starred_url":"https://api.github.com/users/TheHound/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TheHound/subscriptions","organizations_url":"https://api.github.com/users/TheHound/orgs","repos_url":"https://api.github.com/users/TheHound/repos","events_url":"https://api.github.com/users/TheHound/events{/privacy}","received_events_url":"https://api.github.com/users/TheHound/received_events","type":"User","site_admin":false},"created_at":"2016-01-11T09:07:26Z","updated_at":"2016-01-11T09:07:26Z","author_association":"NONE","body":"Hi @clintongormley \n\nI would expect the path part of the URL /a,b/ to act as a type filter. Since those types do not exist I would expect no results.\n\nSo:\n\n```\ncurl 'http://127.0.0.1:9200/index1/type1/_search?q=test\n```\n\nOnly returns 1 hit. I would therefore expect this to only return 1 hit:\n\n```\ncurl 'http://127.0.0.1:9200/index1/type1,type3/_search?q=test\n```\n\nBut instead returns 2, 1 for type1 and 1 for type2.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170549121","html_url":"https://github.com/elastic/elasticsearch/issues/15757#issuecomment-170549121","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15757","id":170549121,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDU0OTEyMQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-11T13:29:04Z","updated_at":"2016-01-11T13:29:04Z","author_association":"CONTRIBUTOR","body":"OK gotcha, here's a recreation:\n\n```\nPUT index1\n\nPUT index1/type1/_mapping\n{\n  \"type1\": {\n    \"properties\": {\n      \"entityContent\": {\n        \"type\": \"nested\",\n        \"properties\": {\n          \"field1\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    }\n  }\n}\n\nPUT index1/type1/1\n{\n    \"content\" : \"This is a Test.\"\n}\n\nPUT index1/type2/2\n{\n    \"content\" : \"This is a test.\"\n}\n```\n\nQuerying with a known type plus an unknown type returns both documents incorrectly:\n\n```\nGET index1/type1,type3/_search?q=test\n```\n\nThe explanation for this query (when there is a nested document mapped):\n\n```\nGET index1/type1,type3/_validate/query?q=test&explain\n```\n\nis:\n\n```\n\"+_all:test #ConstantScore(+ConstantScore(ConstantScore(_type:type1) _type:type3 +(+*:* -_type:__*)))\"\n```\n\nHowever, if you repeat the explanation without the nested doc mapping, you get:\n\n```\n\"+_all:test #ConstantScore(+ConstantScore(ConstantScore(_type:type1) _type:type3))\"\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/171218317","html_url":"https://github.com/elastic/elasticsearch/issues/15757#issuecomment-171218317","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15757","id":171218317,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MTIxODMxNw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-01-13T08:51:03Z","updated_at":"2016-01-13T08:51:03Z","author_association":"MEMBER","body":"@TheHound Thanks for reporting this issue! I'll back port it to all 2.x branches.\n","performed_via_github_app":null}]