{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41882","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41882/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41882/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41882/events","html_url":"https://github.com/elastic/elasticsearch/issues/41882","id":441131652,"node_id":"MDU6SXNzdWU0NDExMzE2NTI=","number":41882,"title":"[CI] RepositoryS3ClientYamlTestSuiteIT.test  failed to restore snapshot","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-05-07T09:27:15Z","updated_at":"2019-05-07T16:18:10Z","closed_at":"2019-05-07T16:18:10Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Failed for master: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+third-party-tests-s3/345/console\r\n\r\n## Reproduction line\r\n(does not) reproduce locally\r\n```\r\nREPRODUCE WITH: ./gradlew :plugins:repository-s3:integTestRunner --tests \"org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT.test {yaml=repository_s3/20_repository_permanent_credentials/Snapshot and Restore with repository-s3 using permanent credentials}\" \\\r\n  -Dtests.seed=9663B0FDBBFB410C \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=es-419 \\\r\n  -Dtests.timezone=Europe/Berlin \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=11 \\\r\n  -Dtests.rest.blacklist=repository_s3/30_repository_temporary_credentials/*,repository_s3/40_repository_ec2_credentials/*,repository_s3/50_repository_ecs_credentials/*\r\n```\r\n\r\n## Example relevant log:\r\n```\r\n10:48:30 Suite: Test class org.elasticsearch.repositories.s3.RepositoryS3ClientYamlTestSuiteIT\r\n10:48:30   1> [2019-05-07T10:47:55,406][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/20_repository_permanent_credentials/teardown] before test\r\n10:48:30   1> [2019-05-07T10:47:55,561][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] initializing REST clients against [http://[::1]:33993, http://127.0.0.1:33472]\r\n10:48:30   1> [2019-05-07T10:47:56,079][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] initializing client, minimum es version [8.0.0], master version, [8.0.0], hosts [http://[::1]:33993, http://127.0.0.1:33472]\r\n10:48:30   1> [2019-05-07T10:47:58,677][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/20_repository_permanent_credentials/teardown] after test\r\n10:48:30   1> [2019-05-07T10:47:58,710][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/40_repository_ec2_credentials/teardown] before test\r\n10:48:30   1> [2019-05-07T10:47:58,745][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/40_repository_ec2_credentials/teardown] after test\r\n10:48:30   1> [2019-05-07T10:47:58,764][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/50_repository_ecs_credentials/Register a repository with a non existing client] before test\r\n10:48:30   1> [2019-05-07T10:47:58,793][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/50_repository_ecs_credentials/Register a repository with a non existing client] after test\r\n10:48:30   1> [2019-05-07T10:47:58,809][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/30_repository_temporary_credentials/Register a repository with a non existing bucket] before test\r\n10:48:30   1> [2019-05-07T10:47:58,839][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/30_repository_temporary_credentials/Register a repository with a non existing bucket] after test\r\n10:48:30   1> [2019-05-07T10:47:58,856][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/40_repository_ec2_credentials/Register a read-only repository with a non existing client] before test\r\n10:48:30   1> [2019-05-07T10:47:58,883][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/40_repository_ec2_credentials/Register a read-only repository with a non existing client] after test\r\n10:48:30   1> [2019-05-07T10:47:58,897][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] [yaml=repository_s3/20_repository_permanent_credentials/Snapshot and Restore with repository-s3 using permanent credentials] before test\r\n10:48:30   1> [2019-05-07T10:48:01,168][WARN ][o.e.c.RestClient         ] [test] request [PUT http://[::1]:33993/_bulk?refresh=true&error_trace=true] returned 1 warnings: [299 Elasticsearch-8.0.0-SNAPSHOT-8d01747 \"[types removal] Specifying types in bulk requests is deprecated.\"]\r\n10:48:30   1> [2019-05-07T10:48:07,517][INFO ][o.e.r.s.RepositoryS3ClientYamlTestSuiteIT] [test] Stash dump on test failure [{\r\n10:48:30   1>   \"stash\" : {\r\n10:48:30   1>     \"body\" : {\r\n10:48:30   1>       \"error\" : {\r\n10:48:30   1>         \"root_cause\" : [\r\n10:48:30   1>           {\r\n10:48:30   1>             \"type\" : \"snapshot_missing_exception\",\r\n10:48:30   1>             \"reason\" : \"[repository_permanent:snapshot-two/pYvfikZ7QwavHHyIACcXMA] is missing\",\r\n10:48:30   1>             \"stack_trace\" : \"SnapshotMissingException[[repository_permanent:snapshot-two/pYvfikZ7QwavHHyIACcXMA] is missing]; nested: NoSuchFileException[Blob object [snap-pYvfikZ7QwavHHyIACcXMA.dat] not found: The specified key does not exist. (Service: Amazon S3; Status Code: 404; Error Code: NoSuchKey; Request ID: 813EA991EA6571BE; S3 Extended Request ID: 4jLVEk5kpDsSQXmNCsuiw26MzMKOj4VdbsQwX1ginUXk/4mklCkzwBtdcxiTYRbkKHHOliCOX7s=)];\r\n10:48:30   1> \tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.getSnapshotInfo(BlobStoreRepository.java:553)\r\n10:48:30   1> \tat org.elasticsearch.snapshots.SnapshotsService.snapshots(SnapshotsService.java:207)\r\n10:48:30   1> \tat org.elasticsearch.action.admin.cluster.snapshots.get.TransportGetSnapshotsAction.masterOperation(TransportGetSnapshotsAction.java:135)\r\n10:48:30   1> \tat org.elasticsearch.action.admin.cluster.snapshots.get.TransportGetSnapshotsAction.masterOperation(TransportGetSnapshotsAction.java:54)\r\n10:48:30   1> \tat org.elasticsearch.action.support.master.TransportMasterNodeAction.masterOperation(TransportMasterNodeAction.java:127)\r\n10:48:30   1> \tat org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$1.doRun(TransportMasterNodeAction.java:200)\r\n10:48:30   1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:757)\r\n10:48:30   1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n10:48:30   1> \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n10:48:30   1> \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n10:48:30   1> \tat java.base/java.lang.Thread.run(Thread.java:834)\r\n10:48:30   1> Caused by: java.nio.file.NoSuchFileException: Blob object [snap-pYvfikZ7QwavHHyIACcXMA.dat] not found: The specified key does not exist. (Service: Amazon S3; Status Code: 404; Error Code: NoSuchKey; Request ID: 813EA991EA6571BE; S3 Extended Request ID: 4jLVEk5kpDsSQXmNCsuiw26MzMKOj4VdbsQwX1ginUXk/4mklCkzwBtdcxiTYRbkKHHOliCOX7s=)\r\n10:48:30   1> \tat org.elasticsearch.repositories.s3.S3BlobContainer.readBlob(S3BlobContainer.java:98)\r\n10:48:30   1> \tat org.elasticsearch.repositories.blobstore.ChecksumBlobStoreFormat.readBlob(ChecksumBlobStoreFormat.java:101)\r\n10:48:30   1> \tat org.elasticsearch.repositories.blobstore.BlobStoreFormat.read(BlobStoreFormat.java:90)\r\n10:48:30   1> \tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.getSnapshotInfo(BlobStoreRepository.java:551)\r\n10:48:30   1> \t... 10 more\r\n```\r\n```\r\n10:48:30   [2019-05-07T08:48:22,239][WARN ][o.e.s.RestoreService     ] [integTest-1] [repository_permanent:missing] failed to restore snapshot\r\n10:48:30   org.elasticsearch.snapshots.SnapshotRestoreException: [repository_permanent:missing] snapshot does not exist\r\n10:48:30   \tat org.elasticsearch.snapshots.RestoreService.restoreSnapshot(RestoreService.java:190) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n10:48:30   \tat org.elasticsearch.action.admin.cluster.snapshots.restore.TransportRestoreSnapshotAction.masterOperation(TransportRestoreSnapshotAction.java:77) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n10:48:30   \tat org.elasticsearch.action.admin.cluster.snapshots.restore.TransportRestoreSnapshotAction.masterOperation(TransportRestoreSnapshotAction.java:38) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n10:48:30   \tat org.elasticsearch.action.support.master.TransportMasterNodeAction.masterOperation(TransportMasterNodeAction.java:127) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n10:48:30   \tat org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$1.doRun(TransportMasterNodeAction.java:200) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n10:48:30   \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:757) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n10:48:30   \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n10:48:30   \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n10:48:30   \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n10:48:30   \tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n```\r\n\r\n## Frequency\r\n1st failure","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}