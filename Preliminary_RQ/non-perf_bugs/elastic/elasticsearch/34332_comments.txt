[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427393481","html_url":"https://github.com/elastic/elasticsearch/issues/34332#issuecomment-427393481","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34332","id":427393481,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzM5MzQ4MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T14:53:53Z","updated_at":"2018-10-05T14:53:53Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427402188","html_url":"https://github.com/elastic/elasticsearch/issues/34332#issuecomment-427402188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34332","id":427402188,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzQwMjE4OA==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T15:19:44Z","updated_at":"2018-10-05T15:21:00Z","author_association":"CONTRIBUTOR","body":"Errors are \r\n```\r\n2> REPRODUCE WITH: ./gradlew :x-pack:qa:saml-idp-tests:integTestRunner -Dtests.seed=EF941323E50925A6 -Dtests.class=org.elasticsearch.xpack.security.authc.saml.SamlAuthenticationIT -Dtests.method=\"testLoginUserWithSamlRoleMapping\" -Dtests.\r\nsecurity.manager=true -Dtests.locale=ar-TN -Dtests.timezone=Asia/Khandyga -Dcompiler.java=11 -Druntime.java=8\r\n  2> NOTE: leaving temporary files on disk at: /var/lib/jenkins/workspace/elastic+elasticsearch+master+multijob-unix-compatibility/os/centos/x-pack/qa/saml-idp-tests/build/testrun/integTestRunner/J0/temp/org.elasticsearch.xpack.security.aut\r\nhc.saml.SamlAuthenticationIT_EF941323E50925A6-001\r\n  2> NOTE: test params are: codec=Asserting(Lucene80): {}, docValues:{}, maxPointsInLeafNode=922, maxMBSortInHeap=5.702762557240961, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@53100397), locale=ar-TN, timezone=A\r\nsia/Khandyga\r\n  2> NOTE: Linux 3.10.0-862.3.2.el7.x86_64 amd64/Oracle Corporation 1.8.0_181 (64-bit)/cpus=8,threads=1,free=423419192,total=514850816\r\n  2> NOTE: All tests run in this JVM: [SamlAuthenticationIT]\r\n   >    at __randomizedtesting.SeedInfo.seed([EF941323E50925A6:BDE91C5C41A4571E]:0)\r\n   >    at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:687)\r\n   >    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:218)\r\n   >    at org.elasticsearch.xpack.security.authc.saml.SamlAuthenticationIT.verifyElasticsearchRefreshToken(SamlAuthenticationIT.java:331)\r\n   >    at org.elasticsearch.xpack.security.authc.saml.SamlAuthenticationIT.testLoginUserWithAuthorizingRealm(SamlAuthenticationIT.java:255)\r\n   >    at java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:33482], URI [/_xpack/security/oauth2/token], status line [HTTP/1.1 400 Bad Request]\r\n   > {\"error\":\"invalid_grant\",\"error_description\":\"token is missing metadata\"}\r\n   >    at org.elasticsearch.client.RestClient$1.completed(RestClient.java:307)\r\n   >    at org.elasticsearch.client.RestClient$1.completed(RestClient.java:292)\r\n   >    at org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n   >    at org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n   >    at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n   >    ... 1 more\r\n```\r\n\r\nThere are some warnings right above that (probably unrelated)\r\n```\r\n.security.manager=true -Dtests.locale=ar-TN -Dtests.timezone=Asia/Khandyga -Dcompiler.java=11 -Druntime.java=8\r\n  1> [2018-10-05T15:11:09,522][WARN ][o.e.b.JNANatives         ] [[SUITE-SamlAuthenticationIT-seed#[EF941323E50925A6]]] Unable to lock JVM Memory: error=12, reason=Cannot allocate memory\r\n  1> [2018-10-05T15:11:09,524][WARN ][o.e.b.JNANatives         ] [[SUITE-SamlAuthenticationIT-seed#[EF941323E50925A6]]] This can result in part of the JVM being swapped out.\r\n  1> [2018-10-05T15:11:09,524][WARN ][o.e.b.JNANatives         ] [[SUITE-SamlAuthenticationIT-seed#[EF941323E50925A6]]] Increase RLIMIT_MEMLOCK, soft limit: 65536, hard limit: 65536\r\n  1> [2018-10-05T15:11:09,524][WARN ][o.e.b.JNANatives         ] [[SUITE-SamlAuthenticationIT-seed#[EF941323E50925A6]]] These can be adjusted by modifying /etc/security/limits.conf, for example: \r\n\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427610629","html_url":"https://github.com/elastic/elasticsearch/issues/34332#issuecomment-427610629","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34332","id":427610629,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzYxMDYyOQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-10-06T22:25:07Z","updated_at":"2018-10-06T22:25:48Z","author_association":"CONTRIBUTOR","body":"This seems to be caused by #34290, and I have a pretty good theory about why.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/472689649","html_url":"https://github.com/elastic/elasticsearch/issues/34332#issuecomment-472689649","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34332","id":472689649,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjY4OTY0OQ==","user":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"created_at":"2019-03-14T03:21:32Z","updated_at":"2019-03-14T03:21:32Z","author_association":"CONTRIBUTOR","body":"This reproduced here again:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+multijob-unix-compatibility/os=ubuntu-14.04&&immutable/71/console\r\n\r\nIt did not reproduce locally for me on 7.x\r\nRepro command:\r\n```\r\n./gradlew :x-pack:qa:saml-idp-tests:integTestRunner \\\r\n  -Dtests.seed=15C1EC2DCBCEAFF \\\r\n  -Dtests.class=org.elasticsearch.xpack.security.authc.saml.SamlAuthenticationIT \\\r\n  -Dtests.method=\"testLoginUserWithAuthorizingRealm\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ga \\\r\n  -Dtests.timezone=America/Araguaina \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/472690993","html_url":"https://github.com/elastic/elasticsearch/issues/34332#issuecomment-472690993","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34332","id":472690993,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjY5MDk5Mw==","user":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"created_at":"2019-03-14T03:29:50Z","updated_at":"2019-03-14T03:29:50Z","author_association":"CONTRIBUTOR","body":"Looks like the reason is different than this one and its failing on master, 7.x.\r\nI will open a new one and close this one.","performed_via_github_app":null}]