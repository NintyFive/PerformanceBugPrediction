{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5705/events","html_url":"https://github.com/elastic/elasticsearch/issues/5705","id":30969037,"node_id":"MDU6SXNzdWUzMDk2OTAzNw==","number":5705,"title":"After restart elasticsearch reads double as array of string","user":{"login":"alexey-medvedchikov","id":65190,"node_id":"MDQ6VXNlcjY1MTkw","avatar_url":"https://avatars0.githubusercontent.com/u/65190?v=4","gravatar_id":"","url":"https://api.github.com/users/alexey-medvedchikov","html_url":"https://github.com/alexey-medvedchikov","followers_url":"https://api.github.com/users/alexey-medvedchikov/followers","following_url":"https://api.github.com/users/alexey-medvedchikov/following{/other_user}","gists_url":"https://api.github.com/users/alexey-medvedchikov/gists{/gist_id}","starred_url":"https://api.github.com/users/alexey-medvedchikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexey-medvedchikov/subscriptions","organizations_url":"https://api.github.com/users/alexey-medvedchikov/orgs","repos_url":"https://api.github.com/users/alexey-medvedchikov/repos","events_url":"https://api.github.com/users/alexey-medvedchikov/events{/privacy}","received_events_url":"https://api.github.com/users/alexey-medvedchikov/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":16,"created_at":"2014-04-07T09:24:13Z","updated_at":"2015-06-07T21:38:16Z","closed_at":"2014-04-18T14:09:32Z","author_association":"NONE","active_lock_reason":null,"body":"Hello, first of all I want to say you making crazy useful things, guys, thank you!\n\nI have two elasticsearch twin (versions, configuration, everything) servers with the same data, replicated by logstash: ES1 and ES2. ES1 I restarted for a few hours ago and now I have a problems.\n\nMy mapping for logstash type, same for both servers.\n\n```\n\"nginx_accesslog\": {\n        \"dynamic_templates\": [\n                {\n                        \"string_template\": {\n                                \"mapping\": { \"index\": \"not_analyzed\", \"type\": \"string\" },\n                                \"match\": \"*\",\n                                \"match_mapping_type\": \"string\"\n                        }\n                }\n        ],\n        \"_all\": { \"enabled\": false },\n        \"_source\": { \"compress\": true },\n        \"properties\": { \n                \"@timestamp\": { \"type\": \"date\", \"format\": \"dateOptionalTime\" },\n                \"@version\": { \"type\": \"long\" },\n                \"api_key\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"body_bytes_sent\": { \"type\": \"long\" },\n                \"host\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"http_host\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"http_method\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"http_referer\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"http_user_agent\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"http_version\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"http_x_forwarded_for\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"message\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"path\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"remote_addr\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"remote_user\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"request\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"request_time\": { \"type\": \"double\" },\n                \"status\": { \"type\": \"long\" },\n                \"tags\": { \"type\": \"string\", \"index\": \"not_analyzed\" },\n                \"type\": { \"type\": \"string\", \"index\": \"not_analyzed\" }\n        }\n}\n```\n\nQuery (I'm using Sense add-on)\n\n```\nPOST /logstash-2014.04.07/_search\n{\n    \"script_fields\": {\n       \"s_request_time\": {\n          \"script\": \"doc['request_time'].value\"\n       }\n    },\n    \"size\": 20\n}\n```\n\nES2, everything is normal:\n\n```\n{\n   \"took\": 63,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 4,\n      \"successful\": 4,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 17041240,\n      \"max_score\": 1,\n      \"hits\": [\n         {\n            \"_index\": \"logstash-2014.04.07\",\n            \"_type\": \"nginx_accesslog\",\n            \"_id\": \"LSfAaBwSSDS5rL6utSHQJA\",\n            \"_score\": 1,\n            \"fields\": {\n               \"s_request_time\": 0.014\n            }\n         },\n...\n```\n\nES1: Ooops!\n\n```\n{\n   \"took\": 51,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 4,\n      \"successful\": 4,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 17041131,\n      \"max_score\": 1,\n      \"hits\": [\n         {\n            \"_index\": \"logstash-2014.04.07\",\n            \"_type\": \"nginx_accesslog\",\n            \"_id\": \"tjZo1_JmRpOu5kE2WRfURw\",\n            \"_score\": 1,\n            \"fields\": {\n               \"s_request_time\": [\n                  \" \\u0001?PZ\\u000e+\\u0001\\u0003\\t\\u001c\" <-- WAT?!\n               ]\n            }\n         },\n```\n\nIt's most obvious demonstration of my problem. Another thing is when I'm using data_histogram facet (in kibana) I got ClassCastException[org.elasticsearch.index.fielddata.plain.PagedBytesIndexFieldData cannot be cast to org.elasticsearch.index.fielddata.IndexNumericFieldData.\n\nPurging all indexes fixes problem. Not only new, but old data too misenterpreted as arrays of one string.\nWell, I want my doubles back. :)\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}