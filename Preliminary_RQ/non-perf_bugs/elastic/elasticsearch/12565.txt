{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12565","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12565/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12565/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12565/events","html_url":"https://github.com/elastic/elasticsearch/issues/12565","id":98239364,"node_id":"MDU6SXNzdWU5ODIzOTM2NA==","number":12565,"title":"_termvectors `took` parameter alternating between small and large number","user":{"login":"drewr","id":6202,"node_id":"MDQ6VXNlcjYyMDI=","avatar_url":"https://avatars3.githubusercontent.com/u/6202?v=4","gravatar_id":"","url":"https://api.github.com/users/drewr","html_url":"https://github.com/drewr","followers_url":"https://api.github.com/users/drewr/followers","following_url":"https://api.github.com/users/drewr/following{/other_user}","gists_url":"https://api.github.com/users/drewr/gists{/gist_id}","starred_url":"https://api.github.com/users/drewr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drewr/subscriptions","organizations_url":"https://api.github.com/users/drewr/orgs","repos_url":"https://api.github.com/users/drewr/repos","events_url":"https://api.github.com/users/drewr/events{/privacy}","received_events_url":"https://api.github.com/users/drewr/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-07-30T19:00:00Z","updated_at":"2018-03-21T17:52:40Z","closed_at":"2018-03-21T17:52:40Z","author_association":"MEMBER","active_lock_reason":null,"body":"I have an index `dlstats` that has a single shard with one replica, in a two-node cluster:\n\n```\nindex   shard prirep state   docs   store ip       node\ndlstats 0     p      STARTED   21 265.6kb 10.0.0.5 Donald Pierce\ndlstats 0     r      STARTED   21 265.6kb 10.0.0.5 Peepers\n```\n\nWhen looking at the (blank) termvectors for a doc, I get alternating `took` times. It seems to be an issue with round-robining the request. If I set `_preference:_primary` it still does it:\n\n```\n% for i in `seq 10`; do curl -s foo:secret@localhost:9200/dlstats/blob/2012-12-17/_termvectors\\?_preference:_primary\\&format=yaml | grep -F took; done\ntook: 1\ntook: 1438281967692\ntook: 1\ntook: 1438281967750\ntook: 1\ntook: 1438281967802\ntook: 1\ntook: 1438281967840\ntook: 1\ntook: 1438281967875\n```\n\nBut if I actually turn replicas off, it does not:\n\n```\nindex   shard prirep state   docs   store ip       node\ndlstats 0     p      STARTED   21 265.6kb 10.0.0.5 Donald Pierce\n```\n\n```\n% for i in `seq 10`; do curl -s foo:secret@localhost:9200/dlstats/blob/2012-12-17/_termvectors\\?_preference:_primary\\&format=yaml | grep -F took; done\ntook: 1\ntook: 1\ntook: 1\ntook: 1\ntook: 1\ntook: 1\ntook: 1\ntook: 1\ntook: 1\ntook: 1\n```\n\nAdding a replica back, does the same thing again:\n\n```\n% for i in `seq 10`; do curl -s foo:secret@localhost:9200/dlstats/blob/2012-12-17/_termvectors\\?_preference:_primary\\&format=yaml | grep -F took; done\ntook: 1\ntook: 1438282196274\ntook: 1\ntook: 1438282196304\ntook: 1\ntook: 1438282196339\ntook: 1\ntook: 1438282196362\ntook: 1\ntook: 1438282196402\n```\n\nThen if I add another node and another replica, the funny `took` seems to happen per replica:\n\n```\n% for i in `seq 10`; do curl -s foo:secret@localhost:9200/dlstats/blob/2012-12-17/_termvectors\\?_preference:_primary\\&format=yaml | grep -F took; done\ntook: 1438282274784\ntook: 1438282274796\ntook: 1\ntook: 1438282274828\ntook: 1438282274841\ntook: 1\ntook: 1438282274873\ntook: 1438282274885\ntook: 1\ntook: 1438282274912\n```\n\nSo maybe there is a bug there and in `*TermVectors*` handling of `_preference`?\n\nES version:\n\n```\n{\n  \"name\" : \"Donald Pierce\",\n  \"cluster_name\" : \"elasticsearch\",\n  \"version\" : {\n    \"number\" : \"2.0.0-beta1\",\n    \"build_hash\" : \"c315d54c2a6695301512fecdccb8f7de22e3ccfe\",\n    \"build_timestamp\" : \"2015-07-16T19:42:13Z\",\n    \"build_snapshot\" : true,\n    \"lucene_version\" : \"5.2.1\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}