{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18719/events","html_url":"https://github.com/elastic/elasticsearch/issues/18719","id":158336856,"node_id":"MDU6SXNzdWUxNTgzMzY4NTY=","number":18719,"title":"Term filters with an array of terms only match on the last term in the array","user":{"login":"pineapplemachine","id":7266412,"node_id":"MDQ6VXNlcjcyNjY0MTI=","avatar_url":"https://avatars2.githubusercontent.com/u/7266412?v=4","gravatar_id":"","url":"https://api.github.com/users/pineapplemachine","html_url":"https://github.com/pineapplemachine","followers_url":"https://api.github.com/users/pineapplemachine/followers","following_url":"https://api.github.com/users/pineapplemachine/following{/other_user}","gists_url":"https://api.github.com/users/pineapplemachine/gists{/gist_id}","starred_url":"https://api.github.com/users/pineapplemachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pineapplemachine/subscriptions","organizations_url":"https://api.github.com/users/pineapplemachine/orgs","repos_url":"https://api.github.com/users/pineapplemachine/repos","events_url":"https://api.github.com/users/pineapplemachine/events{/privacy}","received_events_url":"https://api.github.com/users/pineapplemachine/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-06-03T10:22:39Z","updated_at":"2016-06-03T11:22:01Z","closed_at":"2016-06-03T10:37:32Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: Reproduced in 1.5.2 and 1.7.2 on 3 June 2016. First noticed around 31 May.\n\n**JVM version**: 1.8.0_40 w/ ES 1.5.2 and 1.7.0_71 w/ ES 1.7.2\n\n**OS version**: OSX 10.11.3 w/ ES 1.5.2 and OSX 10.9.5 w/ ES 1.7.2\n\n**Description of the problem including expected versus actual behavior**:\n\nWe have an Elasticsearch index containing documents with ids like `divvybot:1:13`. Previously term filters behaved as expected: The requests described matched and returned one document for every id, since all of the ids in these examples exist in the index I'm querying.\n\n```\ncurl -XPOST localhost:9200/divvy.bots/divvy.bot/_search -d '\n{\n    \"size\": 10,\n    \"filter\": {\n        \"term\": {\"_id\": [\n            \"divvybot:1:10\", \"divvybot:1:11\",\n            \"divvybot:1:12\", \"divvybot:1:13\"\n        ]}\n    }\n}\n'\n```\n\nCurrently the query gets one hit, the document for `divvybot:1:13`.\n\n```\ncurl -XPOST localhost:9200/divvy.bots/divvy.bot/_search -d '\n{\n    \"size\": 10,\n    \"filter\": {\n        \"term\": {\"_id\": [\n            \"divvybot:1:10\", \"divvybot:1:11\",\n            \"divvybot:1:12\"\n        ]}\n    }\n}\n'\n```\n\nThis query also gets one hit, in this case the document for `divvybot:1:12`.\n\nIn every case I've tried, including for other indexes and other fields, when I attempt to match using a list of terms only the last term in the list is actually matched. I have tried disabling caching for the term filter and enclosing the term within `\"bool\": {\"must\": [{ <term> }]}`, as well as within `\"query\": {\"constant_score\": { <filter> }}` and found no difference in behavior in any case.\n\n**Steps to reproduce**:\nUnknown. Especially confounding is how this issue has occurred simultaneously on two different systems with differing setups, both mine and another developer's.\n\n**Addendum**:\n\nI spent a moment feeling like an idiot for using `term` instead of `terms`, but there is no question that using `term` for an array of terms to match absolutely worked before, and has stopped working without bothering to explain itself.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}