{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13012","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13012/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13012/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13012/events","html_url":"https://github.com/elastic/elasticsearch/issues/13012","id":102078816,"node_id":"MDU6SXNzdWUxMDIwNzg4MTY=","number":13012,"title":"optimize one shard failed - caused by org.apache.lucene.store.BufferedChecksumIndexInput cannot seek backwards","user":{"login":"kjelle","id":598905,"node_id":"MDQ6VXNlcjU5ODkwNQ==","avatar_url":"https://avatars2.githubusercontent.com/u/598905?v=4","gravatar_id":"","url":"https://api.github.com/users/kjelle","html_url":"https://github.com/kjelle","followers_url":"https://api.github.com/users/kjelle/followers","following_url":"https://api.github.com/users/kjelle/following{/other_user}","gists_url":"https://api.github.com/users/kjelle/gists{/gist_id}","starred_url":"https://api.github.com/users/kjelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kjelle/subscriptions","organizations_url":"https://api.github.com/users/kjelle/orgs","repos_url":"https://api.github.com/users/kjelle/repos","events_url":"https://api.github.com/users/kjelle/events{/privacy}","received_events_url":"https://api.github.com/users/kjelle/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2015-08-20T07:24:53Z","updated_at":"2019-01-29T14:46:16Z","closed_at":"2016-01-28T12:52:00Z","author_association":"NONE","active_lock_reason":null,"body":"Hello.\n\nIm running ES v1.7.1 on ubuntu 14.04 servers. I write data to an alias for \"today's index\" (storm-YYYY-MM-DD). I have 24 nodes, and today's index have 24 shards and 0 replicas. At midnight I update my aliases, and issue a \"curator optimize --max_num_segments 1\" on \"yesterday's index\" and enable 3 replicas. I update \"yesterday's index\" _settings with setting \"index.store.throttle.type\" to none before starting the optimize (running at the night - almost no searches going).\n\nWhen I call the optimize I see a long list of segments (last night 1127 segments). When it finished I noticed an exception in my master node's log and shard0 was not optimized. The other 23 shards, 1-23, had exactly 1 segment. To check the list of segments i call \"_cat/segments/$YESTERDAY_INDEX?pretty&v\". This list was long and ugly before the optimize. Afterwards, it only displayed shard 1-23 (shard 0 is absent). When I call the same API a few seconds later, shard0 i present with it's previous 45ish segment count.\n\n```\n[DEBUG][action.admin.indices.optimize] [s01-master-01] [storm-2015-08-18][0], node[hsfByw1LT46uvyHKjImkiA], [P], s[STARTED]: failed to execute [OptimizeRequest{maxNumSegments=1, onlyExpungeDeletes=false, flush=true, force=false}]\norg.elasticsearch.transport.RemoteTransportException: [l06-data-02][inet[/192.168.1.19:9302]][indices:admin/optimize[s]]\nCaused by: org.elasticsearch.index.engine.OptimizeFailedEngineException: [storm-2015-08-18][0] force merge failed\n        at org.elasticsearch.index.engine.InternalEngine.forceMerge(InternalEngine.java:829)\n        at org.elasticsearch.index.shard.IndexShard.optimize(IndexShard.java:734)\n        at org.elasticsearch.action.admin.indices.optimize.TransportOptimizeAction.shardOperation(TransportOptimizeAction.java:110)\n        at org.elasticsearch.action.admin.indices.optimize.TransportOptimizeAction.shardOperation(TransportOptimizeAction.java:49)\n        at org.elasticsearch.action.support.broadcast.TransportBroadcastOperationAction$ShardTransportHandler.messageReceived(TransportBroadcastOperationAction.java:338)\n        at org.elasticsearch.action.support.broadcast.TransportBroadcastOperationAction$ShardTransportHandler.messageReceived(TransportBroadcastOperationAction.java:324)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:279)\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:36)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.io.IOException: background merge hit exception: _fm(4.10.4):C7401808 _7z6(4.10.4):c7051806 _96x(4.10.4):c7006519 _9kz(4.10.4):c7033966 _6t7(4.10.4):c7038676 _4r0(4.10.4):c7040730 _8do(4.10.4):c7012751 _3v7(4.10.4):c7061041 _16c(4.10.4):C6950686 _9li(4.10.4):c263395 _9ky(4.10.4):c231955 _9j2(4.10.4):c187371 _9lg(4.10.4):c137054 _9jt(4.10.4):c89542 _9lh(4.10.4):c86325 _9j3(4.10.4):c59804 _9kq(4.10.4):c34919 _9jy(4.10.4):c33735 _9lj(4.10.4):c32217 _9ka(4.10.4):c31557 _9js(4.10.4):c18749 _9ke(4.10.4):c17671 _9lb(4.10.4):c14342 _9la(4.10.4):c13163 _9l5(4.10.4):c12237 _9l4(4.10.4):c11045 _9le(4.10.4):c10496 _9l8(4.10.4):c6735 _9l2(4.10.4):c6319 _9kv(4.10.4):c40 into _9lk [maxNumSegments=1]\n        at org.apache.lucene.index.IndexWriter.forceMerge(IndexWriter.java:1829)\n        at org.elasticsearch.index.engine.InternalEngine.forceMerge(InternalEngine.java:817)\n        ... 10 more\nCaused by: java.lang.IllegalStateException: class org.apache.lucene.store.BufferedChecksumIndexInput cannot seek backwards\n        at org.apache.lucene.store.ChecksumIndexInput.seek(ChecksumIndexInput.java:49)\n        at org.apache.lucene.codecs.compressing.CompressingStoredFieldsReader$ChunkIterator.next(CompressingStoredFieldsReader.java:442)\n        at org.apache.lucene.codecs.compressing.CompressingStoredFieldsWriter.merge(CompressingStoredFieldsWriter.java:368)\n        at org.apache.lucene.index.SegmentMerger.mergeFields(SegmentMerger.java:332)\n        at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:100)\n        at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4223)\n        at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3811)\n        at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:409)\n        at org.apache.lucene.index.TrackingConcurrentMergeScheduler.doMerge(TrackingConcurrentMergeScheduler.java:107)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:486)\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}