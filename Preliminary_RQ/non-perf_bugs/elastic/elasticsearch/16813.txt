{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16813","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16813/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16813/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16813/events","html_url":"https://github.com/elastic/elasticsearch/issues/16813","id":136495131,"node_id":"MDU6SXNzdWUxMzY0OTUxMzE=","number":16813,"title":"max file descriptor issues on OS X","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-02-25T20:04:24Z","updated_at":"2016-02-27T14:36:19Z","closed_at":"2016-02-27T00:56:08Z","author_association":"MEMBER","active_lock_reason":null,"body":"With the recent change in #16733 we introduced the notion of running in a production mode, which is detected by inspecting whether `network.host` is set. On OS X this is problematic with the Oracle JDK, since it [limits the java process](https://developer.apple.com/library/mac/documentation/Java/Reference/Java_VMOptionsRef/Articles/JavaVirtualMachineOptions.html) to `10240` file descriptors by default unless the `-XX:-MaxFDLimit` VM option is passed. This limit will cause elasticsearch to fail to start (see below).\n\nThe [JDK 7 documentation](http://www.oracle.com/technetwork/articles/java/vmoptions-jsp-140102.html) states that this option is only relevant to solaris, but according to this [issue](https://bugs.openjdk.java.net/browse/JDK-8010126) it is relevant to all platforms but the documentation won't be updated. The JDK8 documentation does not list this option anymore even though it is still in use.\n\nSome output from a terminal:\n\n```\n$ java -version\njava version \"1.8.0_60\"\nJava(TM) SE Runtime Environment (build 1.8.0_60-b27)\nJava HotSpot(TM) 64-Bit Server VM (build 25.60-b23, mixed mode)\n$ ulimit -n\n65536\n$ launchctl limit\n    cpu         unlimited      unlimited      \n    filesize    unlimited      unlimited      \n    data        unlimited      unlimited      \n    stack       8388608        67104768       \n    core        0              unlimited      \n    rss         unlimited      unlimited      \n    memlock     unlimited      unlimited      \n    maxproc     2048           2048           \n    maxfiles    65536          65536  \n$ bin/elasticsearch\nException in thread \"main\" java.lang.IllegalStateException: max file descriptors [10240] for elasticsearch process likely too low, increase it to at least [65536]\n    at org.elasticsearch.bootstrap.Bootstrap.enforceOrLogLimits(Bootstrap.java:401)\n    at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:192)\n    at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:283)\n    at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:37)\nRefer to the log for complete error details.\n$ export ES_JAVA_OPTS=-XX:-MaxFDLimit\n$ bin/elasticsearch\n[2016-02-25 15:00:33,638][INFO ][node                     ] [Hector] version[3.0.0], pid[30941], build[c9c4cac/2016-02-25T13:06:48.503Z]\n[2016-02-25 15:00:33,638][INFO ][node                     ] [Hector] initializing ...\n[2016-02-25 15:00:33,988][INFO ][plugins                  ] [Hector] modules [lang-mustache, lang-painless, ingest-grok, lang-expression, lang-groovy], plugins []\n[2016-02-25 15:00:34,008][INFO ][env                      ] [Hector] using [1] data paths, mounts [[/ (/dev/disk1)]], net usable_space [123.2gb], net total_space [232.6gb], spins? [unknown], types [hfs]\n[2016-02-25 15:00:34,008][INFO ][env                      ] [Hector] heap size [989.8mb], compressed ordinary object pointers [true]\n[2016-02-25 15:00:35,338][INFO ][node                     ] [Hector] initialized\n[2016-02-25 15:00:35,338][INFO ][node                     ] [Hector] starting ...\n[2016-02-25 15:00:35,414][INFO ][transport                ] [Hector] publish_address {127.0.0.1:9300}, bound_addresses {127.0.0.1:9300}\n[2016-02-25 15:00:35,420][INFO ][discovery                ] [Hector] elasticsearch/pqUOEZAZQtGy_Sbax5uLIg\n[2016-02-25 15:00:38,453][INFO ][cluster.service          ] [Hector] new_master {Hector}{pqUOEZAZQtGy_Sbax5uLIg}{127.0.0.1}{127.0.0.1:9300}, reason: zen-disco-join(elected_as_master, [0] joins received)\n[2016-02-25 15:00:38,473][INFO ][http                     ] [Hector] publish_address {127.0.0.1:9200}, bound_addresses {127.0.0.1:9200}\n[2016-02-25 15:00:38,474][INFO ][node                     ] [Hector] started\n[2016-02-25 15:00:38,492][INFO ][gateway                  ] [Hector] recovered [0] indices into cluster_state\n```\n\nIn the above scenario, the only change to elasticsearch.yml is setting `network.host` to `localhost` and I am running a build from master.\n\nWe may want to consider adding this option to the `elasticsearch` script or documenting it.\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}