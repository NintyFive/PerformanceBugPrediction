{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39360","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39360/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39360/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39360/events","html_url":"https://github.com/elastic/elasticsearch/issues/39360","id":414103851,"node_id":"MDU6SXNzdWU0MTQxMDM4NTE=","number":39360,"title":"Feature Request: Return tag or field value in bulk import http response ","user":{"login":"mbudge","id":15329154,"node_id":"MDQ6VXNlcjE1MzI5MTU0","avatar_url":"https://avatars0.githubusercontent.com/u/15329154?v=4","gravatar_id":"","url":"https://api.github.com/users/mbudge","html_url":"https://github.com/mbudge","followers_url":"https://api.github.com/users/mbudge/followers","following_url":"https://api.github.com/users/mbudge/following{/other_user}","gists_url":"https://api.github.com/users/mbudge/gists{/gist_id}","starred_url":"https://api.github.com/users/mbudge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbudge/subscriptions","organizations_url":"https://api.github.com/users/mbudge/orgs","repos_url":"https://api.github.com/users/mbudge/repos","events_url":"https://api.github.com/users/mbudge/events{/privacy}","received_events_url":"https://api.github.com/users/mbudge/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-02-25T13:26:44Z","updated_at":"2019-02-26T01:32:40Z","closed_at":"2019-02-25T15:22:06Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\n\r\nWould it be possible to add a field or tag when doing an index with bulk import?\r\nThe user could either set a tag or specify a field and elastic returns the field value in the bulk import http response.\r\n\r\n{ \"index\" : { \"_index\" : \"domains\", \"_type\" : \"_doc\", \"_id\" : \"1\", \"tag\": \"google.com\" } }\r\n{ \"domain\" : \"google.com\" }\r\n\r\nSo when we index something we get the ID and the TAG in the bulk import http response. We could cache the tag value and ID in redis/memcache so we can quickly retrieve this when doing an upsert/update the next day.\r\n\r\n`{\r\n   \"took\": 30,\r\n   \"errors\": false,\r\n   \"items\": [\r\n      {\r\n         \"index\": {\r\n            \"_index\": \"test\",\r\n            \"_type\": \"_doc\",\r\n            \"_id\": \"1\",\r\n            \"tag\": \"google.com\",\r\n            \"_version\": 1,\r\n            \"result\": \"created\",\r\n            \"_shards\": {\r\n               \"total\": 2,\r\n               \"successful\": 1,\r\n               \"failed\": 0\r\n            },\r\n            \"status\": 201,\r\n            \"_seq_no\" : 0,\r\n            \"_primary_term\": 1\r\n         }\r\n      }\r\n]\r\n]`\r\n\r\nThis would be very very useful as it would allow us to do bulk index and de-duplicate without manually setting a document ID to the hash of the domain. Instead we could do the bulk import without specifying a document ID, but instead get the new document ID and value of the tag from the bulk index response, which we can cache in redis or memcache so we can quickly lookup the domain's document ID without doing a slower elastic query. \r\n\r\nOf course if the tag value isn't cached we would lookup the ID in elastic.\r\nIf users loose the cached ID to tag/field value correlation, they could use the scroll to iterate through all documents and reload ID's and target values to the cache.\r\n\r\nEven better would to create or upsert depending on whether a tag or field value exists in the index , so the user wouldn't need to lookup cached ID's or specify hashes as document ID's. \r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}