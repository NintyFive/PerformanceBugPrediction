{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2692","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2692/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2692/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2692/events","html_url":"https://github.com/elastic/elasticsearch/issues/2692","id":11399841,"node_id":"MDU6SXNzdWUxMTM5OTg0MQ==","number":2692,"title":"Using Java node client and deleting all indexes cause system hungs","user":{"login":"lordofthejars","id":1517153,"node_id":"MDQ6VXNlcjE1MTcxNTM=","avatar_url":"https://avatars2.githubusercontent.com/u/1517153?v=4","gravatar_id":"","url":"https://api.github.com/users/lordofthejars","html_url":"https://github.com/lordofthejars","followers_url":"https://api.github.com/users/lordofthejars/followers","following_url":"https://api.github.com/users/lordofthejars/following{/other_user}","gists_url":"https://api.github.com/users/lordofthejars/gists{/gist_id}","starred_url":"https://api.github.com/users/lordofthejars/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lordofthejars/subscriptions","organizations_url":"https://api.github.com/users/lordofthejars/orgs","repos_url":"https://api.github.com/users/lordofthejars/repos","events_url":"https://api.github.com/users/lordofthejars/events{/privacy}","received_events_url":"https://api.github.com/users/lordofthejars/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":28458722,"node_id":"MDU6TGFiZWwyODQ1ODcyMg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.20.6","name":"v0.20.6","color":"DDDDDD","default":false,"description":null},{"id":29805870,"node_id":"MDU6TGFiZWwyOTgwNTg3MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.0.RC1","name":"v0.90.0.RC1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2013-02-26T09:26:42Z","updated_at":"2013-03-03T18:28:06Z","closed_at":"2013-03-01T14:17:12Z","author_association":"NONE","active_lock_reason":null,"body":"Using elasticsearch 0.20.5 in Java 1.6 with Ubuntu 12.04 (but also happens with Windows), the system is frozen when you try to delete all indexes when there are no indexes yet into the elasticsearch. This error is a bit strange but I can reproduce it without any problem.\n\nFirst of all create a new project in Eclipse (in my case but of course in command line or Intellij should do the same). Then add elasticsearch 0.20.5 as dependency and write one simple test:\n\n``` java\nNode node = nodeBuilder().local(true).node();\nClient client = node.client();\n\nDeleteByQueryRequestBuilder deleteByQueryRequestBuilder = new DeleteByQueryRequestBuilder(client);\n\ndeleteByQueryRequestBuilder.setQuery(QueryBuilders.matchAllQuery());\ndeleteByQueryRequestBuilder.execute().actionGet();\n\nnode.close();\n```\n\nThen I run the test and the output is:\n\n```\n26-feb-2013 10:17:31 org.elasticsearch.node\nINFO: [Assassin] {0.20.5}[4352]: initializing ...\n26-feb-2013 10:17:31 org.elasticsearch.plugins\nINFO: [Assassin] loaded [], sites []\n26-feb-2013 10:17:33 org.elasticsearch.node\nINFO: [Assassin] {0.20.5}[4352]: initialized\n26-feb-2013 10:17:33 org.elasticsearch.node\nINFO: [Assassin] {0.20.5}[4352]: starting ...\n26-feb-2013 10:17:33 org.elasticsearch.transport\nINFO: [Assassin] bound_address {local[1]}, publish_address {local[1]}\n26-feb-2013 10:17:33 org.elasticsearch.cluster.service\nINFO: [Assassin] new_master [Assassin][1][local[1]]{local=true}, reason: local-disco-initial_connect(master)\n26-feb-2013 10:17:33 org.elasticsearch.discovery\nINFO: [Assassin] elasticsearch/1\n26-feb-2013 10:17:33 org.elasticsearch.http\nINFO: [Assassin] bound_address {inet[/0.0.0.0:9200]}, publish_address {inet[/<ipaddress>:9200]}\n26-feb-2013 10:17:33 org.elasticsearch.node\nINFO: [Assassin] {0.20.5}[4352]: started\n26-feb-2013 10:17:33 org.elasticsearch.gateway\nINFO: [Assassin] recovered [0] indices into cluster_state\n```\n\nBut the test never ends, the actionGet() call does not return any result it is hung there.\n\nThen I abort the test and I do the next modification in test:\n\n``` java\nNode node = nodeBuilder().local(true).node();\nClient client = node.client();\n\nString json = \"{\" +\n            \"\\\"user\\\":\\\"kimchy\\\",\" +\n            \"\\\"postDate\\\":\\\"2013-01-30\\\",\" +\n            \"\\\"message\\\":\\\"trying out Elastic Search\\\"\" +\n        \"}\";\n\nIndexResponse response = client.prepareIndex(\"twitter\", \"tweet\")\n                .setSource(json)\n                .execute()\n                .actionGet();\n\nDeleteByQueryRequestBuilder deleteByQueryRequestBuilder = new DeleteByQueryRequestBuilder(client);\n\ndeleteByQueryRequestBuilder.setQuery(QueryBuilders.matchAllQuery());\ndeleteByQueryRequestBuilder.execute().actionGet();\n\nnode.close();\n```\n\nAnd then it works as expected, but now comes the \"paranoic\" part, I rerun the first test again without preparing an index before deleting:\n\n``` java\nNode node = nodeBuilder().local(true).node();\nClient client = node.client();\n\nDeleteByQueryRequestBuilder deleteByQueryRequestBuilder = new DeleteByQueryRequestBuilder(client);\n\ndeleteByQueryRequestBuilder.setQuery(QueryBuilders.matchAllQuery());\ndeleteByQueryRequestBuilder.execute().actionGet();\n\nnode.close();\n```\n\nBut now also it works as expected, mostly because there is one index. (data directory is there already created so can work perfectly).\n\n```\nINFO: [Cold War] recovered [1] indices into cluster_state\n```\n\nSo it seems that delete all command does not work correctly when there is no indexes to remove (first time you start the node). Maybe I am doing wrong about how to remove all indexes, but anyway there is still an error on operation which makes all application (test in my case) hungs.\n\nAlex.\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}