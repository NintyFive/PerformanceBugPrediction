{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/49997","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49997/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49997/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49997/events","html_url":"https://github.com/elastic/elasticsearch/issues/49997","id":535301307,"node_id":"MDU6SXNzdWU1MzUzMDEzMDc=","number":49997,"title":"Build EQL Query Parser and planner on top of reusable xQL components","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"labels":[{"id":1690690117,"node_id":"MDU6TGFiZWwxNjkwNjkwMTE3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/EQL","name":":Query Languages/EQL","color":"0e8a16","default":false,"description":"EQL querying"},{"id":912794284,"node_id":"MDU6TGFiZWw5MTI3OTQyODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/SQL","name":":Query Languages/SQL","color":"0e8a16","default":false,"description":"SQL querying"},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"assignees":[{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-12-09T20:48:07Z","updated_at":"2020-02-27T17:42:32Z","closed_at":"2020-02-27T17:42:32Z","author_association":"MEMBER","active_lock_reason":null,"body":"Meta issue describing the rough steps for reusing the SQL\r\ncommon core inside EQL.\r\n\r\n### Parsing & AST\r\n- [x] Make EQL parser take advantage of the new `Node` and `Source` packages\r\n- [x] Create EQL specific exceptions based on the common ones to properly catch\r\n- [x] Hook parser to the `Expression` tree and map `WHERE` query to a `Filter`\r\n\r\n### Session & Analysis\r\n- [x] Create dedicated `Analyzer` for EQL using a subset of rules from SQL. In particular those around CTE and missing references should not be needed. It's worth starting with a small set and expand later if needed.\r\n- [x] Pay special attention to the index resolution. As oppose to SQL, the index is resolved before the query so the index information `EsIndex` is already available.\r\nIn practice this translates to a simpler `PlanExecutor`, that is the entry point in converting the query into an actual plan.\r\n- [x] Start defining a `Session` and `Configuration` class - while it shares a lot of things, for the most part this can be EQL specific since the risk of duplication is low (quantity wise as well).\r\n- [x] Add dedicated `Verifier` - just like with the `Analyzer` this will likely have a smaller set of rule. As a tangent, it is a good opportunity to potentially add some generic ones such as verifying that the input of a node is at most a subset of its child.\r\nThis can act as a good deterrent in catching potential bugs that work across nodes.\r\n\r\n### Optimizer\r\n- [x] Add EQL Optimizer - for the most part it will contain the common rules around `Expression` as most `LogicalPlan` ones are not useful at this stage.\r\n- [ ] It might be worth adding a basic second Verifier to check that the Optimizer hasn't introduced any bugs\r\n\r\n### Query translator\r\n- [x] Move querying AST in QL\r\n- [x] Extract basic rules for translating search queries (not aggregations) to QL\r\n\r\n### Query Planner\r\n\r\n- [x] As the first release handles only basic queries, a trivial/basic query planner will be used (there's no planning required).\r\n\r\n### Query Executor\r\n- [x] Create result representation across different response types\r\n- [x] Reuse `SearchHitExtractor` from QL for parsing result set\r\n- [ ] Introduce `search_after` querying. This will be useful in the future for sequence/joins. Investigate whether serialization is required for the first stage.\r\n\r\nRelates to #49773 ","closed_by":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}