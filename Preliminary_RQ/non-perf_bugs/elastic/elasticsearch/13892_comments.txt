[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/144869000","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-144869000","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":144869000,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NDg2OTAwMA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-10-01T22:45:53Z","updated_at":"2015-10-01T22:45:53Z","author_association":"MEMBER","body":"Can we just make GeoPoint immutable without adding another class?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/145033454","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-145033454","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":145033454,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTAzMzQ1NA==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2015-10-02T14:17:03Z","updated_at":"2015-10-02T14:17:03Z","author_association":"CONTRIBUTOR","body":"After thinking a bit more, how about a simple mutable GeoPoint class that extends an immutable Point base class? Since we want to eventually support 3 or 4 dimensions this would give us both the read-only protection we need for Query state and the foundation for extending into higher dimensions - without creating a class for each dimension like other libraries do (e.g., Point2D, Point3D).  This would be very useful for coordinate reprojection and 3rd party plugin support.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157039670","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-157039670","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":157039670,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzAzOTY3MA==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2015-11-16T14:07:07Z","updated_at":"2015-11-16T14:08:31Z","author_association":"MEMBER","body":"Although it seems practical, this breaks the Liskov Substitution Principle and can lead to surprises:\n\n```\n//MutablePoint inherits from ImmutablePoint\nMutablePoint pm = new MutablePoint(0, 0);\nImmutablePoint pi = pm;\n\n// in another method far, far away, the x coordinate is cached since pi is immutable\n\nfinal int x = pi.getX();\n\n// now we update the value somewhere else again ...\npm.setX(3);\n\n// ... and the cached value 'x' is wrong although 'pi' was advertised as immutable :(\n```\n\nIt is also tricky to implement concurrent updates correctly. I think you would have to reimplement the mutable point class from scratch anyway and also provide an API that allows for atomic updates of a point coordinate (assuming concurrent updates are supported).\n\nI am also not sure how your design would help extending to more than two dimensions.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157257605","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-157257605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":157257605,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzI1NzYwNQ==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T03:32:53Z","updated_at":"2015-11-17T03:44:45Z","author_association":"CONTRIBUTOR","body":"This is how I was planning: https://github.com/nknize/elasticsearch/blob/immutableGeopoint/core/src/main/java/org/elasticsearch/common/geo/GeoPoint.java\n\nThe following would throw a ClassCastException:\n\n``` java\n    GeoPoint mp = GeoPoint.mutable(-89.0, 125.0);\n    GeoPoint gp2 = (Immutable)mp;\n    ((Mutable)mp).reset(-87.0, 122.0);\n```\n\nGood point on the concurrency issue. It was not planned so we could start by updating the javadocs with this warning, and then (if needed) update for concurrency support.\n\nBut this may be OBE as I believe we can make GeoPoint immutable (as Ryan mentioned) with low impact and less risk.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157299061","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-157299061","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":157299061,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzI5OTA2MQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T07:31:39Z","updated_at":"2015-11-17T07:32:08Z","author_association":"MEMBER","body":"Thanks for the code example. This makes it much clearer.\n\nHowever, as the `GeoPoint` fields are not final, the class is not immutable but just effectively immutable. This will be no problem as long as `GeoPoint` is only used from a single thread but you (might) get into trouble if you have multiple threads and you publish `GeoPoint` with a data race. If the fields of `GeoPoint` would be final, you'd be even safe in this case (due to the guarantees defined in [JLS 17.5](https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.5)).\n\nLong story short, this would work perfectly fine in a single threaded case but it is not safe for multithreading.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157407006","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-157407006","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":157407006,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzQwNzAwNg==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T15:39:23Z","updated_at":"2015-11-17T15:39:23Z","author_association":"CONTRIBUTOR","body":"Thanks for the review and great input @danielmitterdorfer  If/when this lands I'll give you a heads up to review the PR. @colings86 how urgent is GeoPoint immutability?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157411072","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-157411072","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":157411072,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzQxMTA3Mg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T15:52:36Z","updated_at":"2015-11-17T15:52:36Z","author_association":"MEMBER","body":"@nknize its not that urgent. More like a nice to have really. It just means we won't need to do any copying of points to make sure the don't change\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157412528","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-157412528","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":157412528,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzQxMjUyOA==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2015-11-17T15:57:13Z","updated_at":"2015-11-17T15:57:13Z","author_association":"MEMBER","body":"@nknize Thanks, I'm glad I could help. :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/299484437","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-299484437","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":299484437,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTQ4NDQzNw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-05-05T14:45:31Z","updated_at":"2017-05-05T14:45:43Z","author_association":"MEMBER","body":"@nknize Is this something yet to be done? Anything left to discuss on the matter?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376293588","html_url":"https://github.com/elastic/elasticsearch/issues/13892#issuecomment-376293588","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13892","id":376293588,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjI5MzU4OA==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T20:03:37Z","updated_at":"2018-03-26T20:03:37Z","author_association":"CONTRIBUTOR","body":"closing for now.. it hasn't been that pressing and we can reopen later.","performed_via_github_app":null}]