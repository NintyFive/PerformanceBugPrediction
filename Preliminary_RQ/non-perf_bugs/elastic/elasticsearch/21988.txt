{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21988","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21988/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21988/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21988/events","html_url":"https://github.com/elastic/elasticsearch/issues/21988","id":193600157,"node_id":"MDU6SXNzdWUxOTM2MDAxNTc=","number":21988,"title":"Incorrect Metrics Reported in version 5.0.1","user":{"login":"animageofmine","id":6426633,"node_id":"MDQ6VXNlcjY0MjY2MzM=","avatar_url":"https://avatars3.githubusercontent.com/u/6426633?v=4","gravatar_id":"","url":"https://api.github.com/users/animageofmine","html_url":"https://github.com/animageofmine","followers_url":"https://api.github.com/users/animageofmine/followers","following_url":"https://api.github.com/users/animageofmine/following{/other_user}","gists_url":"https://api.github.com/users/animageofmine/gists{/gist_id}","starred_url":"https://api.github.com/users/animageofmine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/animageofmine/subscriptions","organizations_url":"https://api.github.com/users/animageofmine/orgs","repos_url":"https://api.github.com/users/animageofmine/repos","events_url":"https://api.github.com/users/animageofmine/events{/privacy}","received_events_url":"https://api.github.com/users/animageofmine/received_events","type":"User","site_admin":false},"labels":[{"id":146836529,"node_id":"MDU6TGFiZWwxNDY4MzY1Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Stats","name":":Core/Features/Stats","color":"0e8a16","default":false,"description":"Statistics tracking and retrieval APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2016-12-05T20:20:57Z","updated_at":"2017-01-12T10:44:27Z","closed_at":"2016-12-13T19:55:30Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**: 5.0.1\r\n\r\n**Plugins installed**: N/A\r\n\r\n**JVM version**: \r\nopenjdk version \"1.8.0_111\"\r\nOpenJDK Runtime Environment (build 1.8.0_111-8u111-b14-2~bpo8+1-b14)\r\nOpenJDK 64-Bit Server VM (build 25.111-b14, mixed mode)\r\n\r\n**OS version**:\r\nLinux elasticsearchClient1 3.10.0-327.36.1.el7.x86_64 #1 SMP Sun Sep 18 13:04:29 UTC 2016 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nThe issue is report here: https://discuss.elastic.co/t/incorrect-metrics-reported-in-version-5-0-1/67909\r\n\r\nBasically, few of the metrics reported by Elasticsearch for version 5.0.1 seem incorrect. I verified by comparing the metrics from version 2.4.2 \r\n\r\nVersion 2.4.2 clearly shows free memory around 11G, but version 5.0.1 reports 25G which is more than the memory of the host, scary!:open_mouth:\r\n\r\nWe are planning to deploy things to production, so your quick response will be very much appreciated. \r\n\r\n**Steps to reproduce**:\r\n 1. Start a dockerized (debian) container for elasticsearch 5.0.1\r\n 2. curl -XGET 'http://localhost:9200/_nodes/stats' | jq . | more\r\n 3. Look for metric os.mem.free_in_bytes. It should show memory more than that is reported by OS\r\n 4. Stop the docker container \"docker stop <containerIdOrName> \r\n 5. Start dockerized (debian) container for elasticsearch 2.4.2 \r\n 6. Perform steps 2-3 and compare the same metric. 2.4.2 reports accurate numbers / metrics, while 5.0.1 does not. \r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n             total       used       free     shared    buffers     cached\r\nMem:           14G       4.0G        10G       508K       1.3M       3.1G\r\n-/+ buffers/cache:       990M        13G\r\nSwap:         3.9G         0B       3.9G\r\n\r\n```\r\nVERSION 5.0.1 (INCORRECT)\r\n```\r\ncurl -XGET 'http://localhost:9200/_nodes/stats' | jq . | more\r\n\"os\": {\r\n        \"timestamp\": 1480968507747,\r\n        \"cpu\": {\r\n          \"percent\": 0,\r\n          \"load_average\": {\r\n            \"1m\": 0.07,\r\n            \"5m\": 0.07,\r\n            \"15m\": 0.06\r\n          }\r\n        },\r\n        \"mem\": {\r\n          \"total_in_bytes\": 31170383872,\r\n          \"free_in_bytes\": 24336519168,\r\n          \"used_in_bytes\": 6833864704,\r\n          \"free_percent\": 78,\r\n          \"used_percent\": 22\r\n        },\r\n        \"swap\": {\r\n          \"total_in_bytes\": 4194299904,\r\n          \"free_in_bytes\": 4194299904,\r\n          \"used_in_bytes\": 0\r\n        }\r\n      },\r\n```\r\n```\r\ntop - 20:13:30 up 5 days, 23:12,  0 users,  load average: 0.02, 0.06, 0.07\r\nTasks:   5 total,   1 running,   4 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  0.8 us,  0.2 sy,  0.0 ni, 99.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nKiB Mem:  14972960 total,  6439536 used,  8533424 free,     1332 buffers\r\nKiB Swap:  4095996 total,        0 used,  4095996 free.  3229128 cached Mem\r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\r\n    1 root      20   0   21888   1864   1440 S   0.0  0.0   0:00.07 start.sh\r\n   60 elastic+  20   0 5812272 2.359g  16132 S   0.0 16.5   0:20.18 java\r\n  143 root      20   0    5952    612    524 S   0.0  0.0   0:00.00 tail\r\n  161 root      20   0   21952   2160   1652 S   0.0  0.0   0:00.07 bash\r\n  172 root      20   0   23492   1352   1076 R   0.0  0.0   0:00.00 top\r\n\r\n```\r\nVERSION 2.4.2 (CORRECT)\r\n```\r\ncurl -XGET 'http://localhost:9200/_nodes/stats' | jq . | more\r\n\"os\": {\r\n        \"timestamp\": 1480966154732,\r\n        \"cpu_percent\": 1,\r\n        \"load_average\": 0.44,\r\n        \"mem\": {\r\n          \"total_in_bytes\": 15332311040,\r\n          \"free_in_bytes\": 11011239936,\r\n          \"used_in_bytes\": 4321071104,\r\n          \"free_percent\": 72,\r\n          \"used_percent\": 28\r\n        },\r\n        \"swap\": {\r\n          \"total_in_bytes\": 4194299904,\r\n          \"free_in_bytes\": 4194299904,\r\n          \"used_in_bytes\": 0\r\n        }\r\n      },\r\n```\r\n```\r\ntop - 20:17:03 up 5 days, 23:15,  0 users,  load average: 0.03, 0.06, 0.06\r\nTasks:   3 total,   1 running,   2 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  0.8 us,  0.2 sy,  0.0 ni, 99.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nKiB Mem:  14972960 total,  4220556 used, 10752404 free,     1332 buffers\r\nKiB Swap:  4095996 total,        0 used,  4095996 free.  3229396 cached Mem\r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\r\n    1 elastic+  20   0 4655716 239172  15852 S   0.0  1.6   0:08.50 java\r\n   94 root      20   0   21944   2112   1632 S   0.0  0.0   0:00.07 bash\r\n  103 root      20   0   23492   1352   1076 R   0.0  0.0   0:00.00 top\r\n```\r\n\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}