{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29052/events","html_url":"https://github.com/elastic/elasticsearch/issues/29052","id":305079812,"node_id":"MDU6SXNzdWUzMDUwNzk4MTI=","number":29052,"title":"NullPointerException on snapshot","user":{"login":"gkozyryatskyy","id":7124946,"node_id":"MDQ6VXNlcjcxMjQ5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7124946?v=4","gravatar_id":"","url":"https://api.github.com/users/gkozyryatskyy","html_url":"https://github.com/gkozyryatskyy","followers_url":"https://api.github.com/users/gkozyryatskyy/followers","following_url":"https://api.github.com/users/gkozyryatskyy/following{/other_user}","gists_url":"https://api.github.com/users/gkozyryatskyy/gists{/gist_id}","starred_url":"https://api.github.com/users/gkozyryatskyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gkozyryatskyy/subscriptions","organizations_url":"https://api.github.com/users/gkozyryatskyy/orgs","repos_url":"https://api.github.com/users/gkozyryatskyy/repos","events_url":"https://api.github.com/users/gkozyryatskyy/events{/privacy}","received_events_url":"https://api.github.com/users/gkozyryatskyy/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false}],"milestone":null,"comments":11,"created_at":"2018-03-14T09:26:05Z","updated_at":"2018-04-27T14:30:38Z","closed_at":"2018-04-27T14:30:38Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.6.8 (Docker image docker.elastic.co/elasticsearch/elasticsearch:5.6.8)\r\n\r\n**Plugins installed**: \r\n```\r\ningest-geoip\r\ningest-user-agent\r\nrepository-s3\r\nx-pack\r\n```\r\n\r\n**JVM version** (`java -version`): \r\n```\r\nopenjdk version \"1.8.0_161\"\r\nOpenJDK Runtime Environment (build 1.8.0_161-b14)\r\nOpenJDK 64-Bit Server VM (build 25.161-b14, mixed mode)\r\n```\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n```\r\nLinux b5f28c65ef45 4.9.60-linuxkit-aufs #1 SMP Mon Nov 6 16:00:12 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI have an s3 snapshot repo\r\n```\r\ncurl localhost:9200/_snapshot/*?pretty\r\n{\r\n  \"weavo-backup\" : {\r\n    \"type\" : \"s3\",\r\n    \"settings\" : {\r\n      \"bucket\" : \"...\",\r\n      \"region\" : \"us-east-1\",\r\n      \"base_path\" : \"dev/weavo-backup\"\r\n    }\r\n  }\r\n}\r\n```\r\nWhen im trying to snapshot im getting `java.lang.NullPointerException`\r\n```\r\ncurl -XPUT 'localhost:9200/_snapshot/weavo-backup/snapshot_1?wait_for_completion=true'\r\n{\r\n  \"error\":{\r\n    \"root_cause\":[\r\n      {\r\n        \"type\":\"null_pointer_exception\",\r\n        \"reason\":null\r\n      }\r\n    ],\r\n    \"type\":\"null_pointer_exception\",\r\n    \"reason\":null\r\n  },\r\n  \"status\":500\r\n}\r\n```\r\nWhen im trying to delete snapshot im getting `java.lang.NullPointerException`\r\n```\r\ncurl -XDELETE localhost:9200/_snapshot/weavo-backup/curator-20180224000000?pretty\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"null_pointer_exception\",\r\n        \"reason\" : null\r\n      }\r\n    ],\r\n    \"type\" : \"null_pointer_exception\",\r\n    \"reason\" : null\r\n  },\r\n  \"status\" : 500\r\n}\r\n```\r\n\r\n**Provide logs (if relevant)**:\r\nSnapshot logs error \r\n```\r\n[2018-03-14T08:17:29,967][INFO ][o.e.s.SnapshotShardsService] [iatu_s1] snapshot [weavo-backup:snapshot_1/ueYAa0XASNu1RK_2i2rTZQ] is done\r\n[2018-03-14T08:17:30,086][WARN ][o.e.s.SnapshotsService   ] [iatu_s1] [weavo-backup:snapshot_1/ueYAa0XASNu1RK_2i2rTZQ] failed to finalize snapshot\r\njava.lang.NullPointerException: null\r\n\tat org.elasticsearch.repositories.RepositoryData.snapshotsToXContent(RepositoryData.java:357) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.writeIndexGen(BlobStoreRepository.java:838) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.finalizeSnapshot(BlobStoreRepository.java:568) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.snapshots.SnapshotsService$5.run(SnapshotsService.java:978) [elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:575) [elasticsearch-5.6.8.jar:5.6.8]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_161]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\n[2018-03-14T08:17:30,088][WARN ][r.suppressed             ] path: /_snapshot/weavo-backup/snapshot_1, params: {repository=weavo-backup, wait_for_completion=true, snapshot=snapshot_1}\r\njava.lang.NullPointerException: null\r\n\tat org.elasticsearch.repositories.RepositoryData.snapshotsToXContent(RepositoryData.java:357) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.writeIndexGen(BlobStoreRepository.java:838) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.finalizeSnapshot(BlobStoreRepository.java:568) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.snapshots.SnapshotsService$5.run(SnapshotsService.java:978) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:575) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_161]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\n```\r\nDelete logs error\r\n```\r\n[2018-03-14T01:00:02,957][WARN ][r.suppressed             ] path: /_snapshot/weavo-backup/curator-20180224000000, params: {repository=weavo-backup, snapshot=curator-20180224000000}\r\njava.lang.NullPointerException: null\r\n\tat org.elasticsearch.repositories.RepositoryData.snapshotsToXContent(RepositoryData.java:357) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.writeIndexGen(BlobStoreRepository.java:838) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.deleteSnapshot(BlobStoreRepository.java:445) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.snapshots.SnapshotsService.lambda$deleteSnapshotFromRepository$6(SnapshotsService.java:1309) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:575) ~[elasticsearch-5.6.8.jar:5.6.8]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_161]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\n```","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}