{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26830","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26830/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26830/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26830/events","html_url":"https://github.com/elastic/elasticsearch/issues/26830","id":261581825,"node_id":"MDU6SXNzdWUyNjE1ODE4MjU=","number":26830,"title":"Lucene CustomScoreQuery not enumerating long primitives","user":{"login":"dsafaric","id":8641151,"node_id":"MDQ6VXNlcjg2NDExNTE=","avatar_url":"https://avatars0.githubusercontent.com/u/8641151?v=4","gravatar_id":"","url":"https://api.github.com/users/dsafaric","html_url":"https://github.com/dsafaric","followers_url":"https://api.github.com/users/dsafaric/followers","following_url":"https://api.github.com/users/dsafaric/following{/other_user}","gists_url":"https://api.github.com/users/dsafaric/gists{/gist_id}","starred_url":"https://api.github.com/users/dsafaric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dsafaric/subscriptions","organizations_url":"https://api.github.com/users/dsafaric/orgs","repos_url":"https://api.github.com/users/dsafaric/repos","events_url":"https://api.github.com/users/dsafaric/events{/privacy}","received_events_url":"https://api.github.com/users/dsafaric/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-09-29T09:23:39Z","updated_at":"2017-09-29T09:42:40Z","closed_at":"2017-09-29T09:42:40Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): Version: 5.6.1, Build: 667b497/2017-09-14T19:22:05.189Z, JVM: 1.8.0_144\r\n\r\n**Plugins installed**: [custom plugin]\r\n\r\n**JVM version** (`java -version`): 1.8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): #39~16.04.1-Ubuntu SMP Wed Sep 13 09:02:42 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI've written a custom Lucene `CustomScoreQuery` subclass that is expected to: (1) classify documents using a `long` field type as matched or not, (2) score the hit documents using another `long` field type. The problem I am facing is that the `CustomScoreQuery`'s subquery is not iterating through the terms of the given field. If I change the field type from `long` to `keyword` for example, the `getTermsEnum()` function of the subquery is executed and a FilteredTermsEnum instance is returned, which is the expected behaviour. In addition, I've used the plugin successfully in Apache Solr, however the same does not imply to Elastic. The most important implementation details may be found [here](https://discuss.elastic.co/t/querys-gettermsenum-not-executed/101501).\r\n\r\nThe index mapping I've defined is as follows:\r\n\r\n```\r\n{\r\n  \"images\" : {\r\n    \"mappings\" : {\r\n      \"descriptors\" : {\r\n        \"properties\" : {\r\n          \"image_descriptor_long\" : {\r\n            \"type\" : \"long\"\r\n          },\r\n          \"image_descriptor_short\" : {\r\n            \"type\" : \"long\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n``` ","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}