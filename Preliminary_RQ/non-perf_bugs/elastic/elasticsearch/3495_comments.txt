[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38628799","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-38628799","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":38628799,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjI4Nzk5","user":{"login":"drewish","id":68750,"node_id":"MDQ6VXNlcjY4NzUw","avatar_url":"https://avatars0.githubusercontent.com/u/68750?v=4","gravatar_id":"","url":"https://api.github.com/users/drewish","html_url":"https://github.com/drewish","followers_url":"https://api.github.com/users/drewish/followers","following_url":"https://api.github.com/users/drewish/following{/other_user}","gists_url":"https://api.github.com/users/drewish/gists{/gist_id}","starred_url":"https://api.github.com/users/drewish/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drewish/subscriptions","organizations_url":"https://api.github.com/users/drewish/orgs","repos_url":"https://api.github.com/users/drewish/repos","events_url":"https://api.github.com/users/drewish/events{/privacy}","received_events_url":"https://api.github.com/users/drewish/received_events","type":"User","site_admin":false},"created_at":"2014-03-25T22:22:05Z","updated_at":"2014-03-25T22:22:05Z","author_association":"NONE","body":"Yeah I've also been a little stumped trying to figure out how to find documents without a nested object... in my case the nested object is an array of objects.... I'd like to find them when the array is empty. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38629909","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-38629909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":38629909,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NjI5OTA5","user":{"login":"drewish","id":68750,"node_id":"MDQ6VXNlcjY4NzUw","avatar_url":"https://avatars0.githubusercontent.com/u/68750?v=4","gravatar_id":"","url":"https://api.github.com/users/drewish","html_url":"https://github.com/drewish","followers_url":"https://api.github.com/users/drewish/followers","following_url":"https://api.github.com/users/drewish/following{/other_user}","gists_url":"https://api.github.com/users/drewish/gists{/gist_id}","starred_url":"https://api.github.com/users/drewish/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drewish/subscriptions","organizations_url":"https://api.github.com/users/drewish/orgs","repos_url":"https://api.github.com/users/drewish/repos","events_url":"https://api.github.com/users/drewish/events{/privacy}","received_events_url":"https://api.github.com/users/drewish/received_events","type":"User","site_admin":false},"created_at":"2014-03-25T22:34:05Z","updated_at":"2014-03-25T22:34:05Z","author_association":"NONE","body":"Ah I found a solution at http://grokbase.com/t/gg/elasticsearch/13bfq5qbse/missing-filter-with-nested-objects\n\n```\ncurl -XPOST \"http://ocvli-apw602:9200/test2/IR/_search\" -d'\n{\n    \"filter\": {\n       \"not\": {\n          \"nested\": {\n             \"path\": \"priosenio\",\n             \"filter\": {\n                \"match_all\": {}\n             }\n          }\n       }\n    }\n}'\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/125960685","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-125960685","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":125960685,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNTk2MDY4NQ==","user":{"login":"caseywebdev","id":1181237,"node_id":"MDQ6VXNlcjExODEyMzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1181237?v=4","gravatar_id":"","url":"https://api.github.com/users/caseywebdev","html_url":"https://github.com/caseywebdev","followers_url":"https://api.github.com/users/caseywebdev/followers","following_url":"https://api.github.com/users/caseywebdev/following{/other_user}","gists_url":"https://api.github.com/users/caseywebdev/gists{/gist_id}","starred_url":"https://api.github.com/users/caseywebdev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caseywebdev/subscriptions","organizations_url":"https://api.github.com/users/caseywebdev/orgs","repos_url":"https://api.github.com/users/caseywebdev/repos","events_url":"https://api.github.com/users/caseywebdev/events{/privacy}","received_events_url":"https://api.github.com/users/caseywebdev/received_events","type":"User","site_admin":false},"created_at":"2015-07-29T13:58:38Z","updated_at":"2015-07-29T13:58:38Z","author_association":"NONE","body":"I just ran into this. The workaround highlighted by @drewish feels pretty clunky though :confused: \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142034241","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-142034241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":142034241,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjAzNDI0MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-21T16:26:05Z","updated_at":"2015-12-01T09:21:28Z","author_association":"CONTRIBUTOR","body":"Here's a simple recreation that describes the problem:\n\n```\nPUT t\n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"foo\": {\n          \"type\": \"nested\"\n        }\n      }\n    }\n  }\n}\n\nPUT t/t/1\n{\n  \"foo\": {\n    \"bar\": \"bar\"\n  }\n}\n\nPUT t/t/2\n{\n  \"xyz\": \"xyz\"\n}\n```\n\nThis request matches doc 1, because it has a nested doc which is missing the field, but not doc 2 because it has no nested docs:\n\n```\nGET t/_search\n{\n  \"query\": {\n    \"nested\": {\n      \"path\": \"foo\",\n      \"query\": {\n        \"missing\": {\n          \"field\": \"foo.baz\"\n        }\n      }\n    }\n  }\n}\n```\n\nThis workaround works correctly for both docs:\n\n```\nGET t/_search\n{\n  \"query\": {\n    \"not\": {\n      \"nested\": {\n        \"path\": \"foo\",\n        \"query\": {\n          \"exists\": {\n            \"field\": \"foo.baz\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\n@martijnvg @jpountz is this fixable?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148041192","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-148041192","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":148041192,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODA0MTE5Mg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-10-14T12:54:59Z","updated_at":"2015-10-14T12:54:59Z","author_association":"CONTRIBUTOR","body":"It is not fixable, unless the missing query can detect it is being used within a nested query, which I would like to avoid at all costs. We don't index missing fields in documents, only existing fields, so the `missing` query is internally implemented as the negation of an `exists` query. This raises problems as described here given that putting the `not` inside of the `nested` query has a totally different effect than putting it outside as your workaround does.\n\nI think the way to fix this trap would be to deprecate the `missing` query in favor of explicit negations of the `exists` query.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/148046273","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-148046273","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":148046273,"node_id":"MDEyOklzc3VlQ29tbWVudDE0ODA0NjI3Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-10-14T13:16:06Z","updated_at":"2015-10-14T13:16:06Z","author_association":"CONTRIBUTOR","body":"@jpountz ++ makes sense.\n\nClosing in favour of #14112\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/284276614","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-284276614","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":284276614,"node_id":"MDEyOklzc3VlQ29tbWVudDI4NDI3NjYxNA==","user":{"login":"spati-java","id":7353530,"node_id":"MDQ6VXNlcjczNTM1MzA=","avatar_url":"https://avatars2.githubusercontent.com/u/7353530?v=4","gravatar_id":"","url":"https://api.github.com/users/spati-java","html_url":"https://github.com/spati-java","followers_url":"https://api.github.com/users/spati-java/followers","following_url":"https://api.github.com/users/spati-java/following{/other_user}","gists_url":"https://api.github.com/users/spati-java/gists{/gist_id}","starred_url":"https://api.github.com/users/spati-java/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spati-java/subscriptions","organizations_url":"https://api.github.com/users/spati-java/orgs","repos_url":"https://api.github.com/users/spati-java/repos","events_url":"https://api.github.com/users/spati-java/events{/privacy}","received_events_url":"https://api.github.com/users/spati-java/received_events","type":"User","site_admin":false},"created_at":"2017-03-06T00:28:53Z","updated_at":"2017-03-06T00:29:20Z","author_association":"NONE","body":"Since the \"not\" is deprecated , you can use the must not . \r\n\r\nPOST /my_index/my_type/_search\r\n`{\r\n    \"filter\": {\r\n        \"bool\": {\r\n            \"must_not\": [\r\n               {\r\n                   \"nested\": {\r\n                      \"path\": \"path_to_nested_doc\",\r\n                      \"query\": {\r\n                          \"match_all\": {}\r\n                      }\r\n                   }\r\n               }\r\n            ]\r\n        }\r\n    }\r\n} `","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324589484","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-324589484","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":324589484,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDU4OTQ4NA==","user":{"login":"manuprasanth","id":31308662,"node_id":"MDQ6VXNlcjMxMzA4NjYy","avatar_url":"https://avatars1.githubusercontent.com/u/31308662?v=4","gravatar_id":"","url":"https://api.github.com/users/manuprasanth","html_url":"https://github.com/manuprasanth","followers_url":"https://api.github.com/users/manuprasanth/followers","following_url":"https://api.github.com/users/manuprasanth/following{/other_user}","gists_url":"https://api.github.com/users/manuprasanth/gists{/gist_id}","starred_url":"https://api.github.com/users/manuprasanth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/manuprasanth/subscriptions","organizations_url":"https://api.github.com/users/manuprasanth/orgs","repos_url":"https://api.github.com/users/manuprasanth/repos","events_url":"https://api.github.com/users/manuprasanth/events{/privacy}","received_events_url":"https://api.github.com/users/manuprasanth/received_events","type":"User","site_admin":false},"created_at":"2017-08-24T09:52:52Z","updated_at":"2017-08-24T09:53:31Z","author_association":"NONE","body":"This works for me\r\n\r\nGET /type/_search?pretty=true\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must_not\": [\r\n        {\r\n          \"nested\": {\r\n            \"path\": \"outcome\",\r\n            \"query\": {\r\n              \"exists\": {\r\n                \"field\": \"outcome.outcomeName\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/454351000","html_url":"https://github.com/elastic/elasticsearch/issues/3495#issuecomment-454351000","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3495","id":454351000,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDM1MTAwMA==","user":{"login":"CSantiStSup","id":32196666,"node_id":"MDQ6VXNlcjMyMTk2NjY2","avatar_url":"https://avatars0.githubusercontent.com/u/32196666?v=4","gravatar_id":"","url":"https://api.github.com/users/CSantiStSup","html_url":"https://github.com/CSantiStSup","followers_url":"https://api.github.com/users/CSantiStSup/followers","following_url":"https://api.github.com/users/CSantiStSup/following{/other_user}","gists_url":"https://api.github.com/users/CSantiStSup/gists{/gist_id}","starred_url":"https://api.github.com/users/CSantiStSup/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CSantiStSup/subscriptions","organizations_url":"https://api.github.com/users/CSantiStSup/orgs","repos_url":"https://api.github.com/users/CSantiStSup/repos","events_url":"https://api.github.com/users/CSantiStSup/events{/privacy}","received_events_url":"https://api.github.com/users/CSantiStSup/received_events","type":"User","site_admin":false},"created_at":"2019-01-15T10:54:46Z","updated_at":"2019-01-15T10:54:46Z","author_association":"NONE","body":"Any update on this ? the query from @manuprasanth does not return any document for me, while some of my nested elements are empty. What I find even stranger is that if I do the same query with _must_ instead of _mustnot_, I get the correct output (my empty elements are not returned).","performed_via_github_app":null}]