[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170341005","html_url":"https://github.com/elastic/elasticsearch/issues/15797#issuecomment-170341005","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15797","id":170341005,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDM0MTAwNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-10T12:25:37Z","updated_at":"2016-01-10T12:25:37Z","author_association":"CONTRIBUTOR","body":"@sumitjainn Would you mind expanding your example to include a copy-paste runnable recreation of what you are doing today, so that we have something concrete to play with?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170450076","html_url":"https://github.com/elastic/elasticsearch/issues/15797#issuecomment-170450076","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15797","id":170450076,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDQ1MDA3Ng==","user":{"login":"sumitjainn","id":657557,"node_id":"MDQ6VXNlcjY1NzU1Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/657557?v=4","gravatar_id":"","url":"https://api.github.com/users/sumitjainn","html_url":"https://github.com/sumitjainn","followers_url":"https://api.github.com/users/sumitjainn/followers","following_url":"https://api.github.com/users/sumitjainn/following{/other_user}","gists_url":"https://api.github.com/users/sumitjainn/gists{/gist_id}","starred_url":"https://api.github.com/users/sumitjainn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sumitjainn/subscriptions","organizations_url":"https://api.github.com/users/sumitjainn/orgs","repos_url":"https://api.github.com/users/sumitjainn/repos","events_url":"https://api.github.com/users/sumitjainn/events{/privacy}","received_events_url":"https://api.github.com/users/sumitjainn/received_events","type":"User","site_admin":false},"created_at":"2016-01-11T07:00:06Z","updated_at":"2016-01-11T07:00:36Z","author_association":"NONE","body":"@clintongormley  Here is an example query which fails\n\n``` json\n{\n  \"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"match_all\": {}\n      },\n      \"filter\": {\n        \"bool\": {\n          \"must\": [\n            {\n              \"nested\": {\n                \"path\": \"rooms\",\n                \"query\": {\n                  \"filtered\": {\n                    \"query\": {\n                      \"term\": {\n                        \"amenities\": \"wifi\"\n                      }\n                    },\n                    \"filter\": {\n                      \"bool\": {\n                        \"must\": [\n                          {\n                            \"nested\": {\n                              \"path\": \"rooms.priceInventory\",\n                              \"query\": {\n                                \"bool\": {\n                                  \"must\": [\n                                    {\n                                      \"range\": {\n                                        \"price\": {\n                                          \"gte\": 200,\n                                          \"lte\": 950\n                                        }\n                                      }\n                                    },\n                                    {\n                                      \"term\": {\n                                        \"date\": 1450290600000\n                                      }\n                                    }\n                                  ]\n                                }\n                              }\n                            }\n                          },\n                          {\n                            \"nested\": {\n                              \"path\": \"rooms.priceInventory\",\n                              \"query\": {\n                                \"bool\": {\n                                  \"must\": [\n                                    {\n                                      \"range\": {\n                                        \"price\": {\n                                          \"gte\": 200,\n                                          \"lte\": 950\n                                        }\n                                      }\n                                    },\n                                    {\n                                      \"term\": {\n                                        \"date\": 1450377000000\n                                      }\n                                    }\n                                  ]\n                                }\n                              }\n                            }\n                          }\n                        ]\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          ]\n        }\n      }\n    }\n  },\n  \"sort\": [{\n    \"rooms.priceInventory.price\": {\n      \"order\": \"desc\",\n      \"mode\":\"max\",\n      \"nested_filter\":{\n          \"range\": {\n             \"rooms.priceInventory.price\": {\n               \"gte\": 20,\n               \"lte\": 950\n             }\n           }\n        }\n    }\n  }]\n }\n```\n\nI cannot specify filters at multiple levels in nested_filter, such that complete main query (sans the top level) cannot be repeated. This sorts on price of rooms which don't have wifi amenity.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/243229493","html_url":"https://github.com/elastic/elasticsearch/issues/15797#issuecomment-243229493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15797","id":243229493,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MzIyOTQ5Mw==","user":{"login":"vikasdp","id":1795964,"node_id":"MDQ6VXNlcjE3OTU5NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1795964?v=4","gravatar_id":"","url":"https://api.github.com/users/vikasdp","html_url":"https://github.com/vikasdp","followers_url":"https://api.github.com/users/vikasdp/followers","following_url":"https://api.github.com/users/vikasdp/following{/other_user}","gists_url":"https://api.github.com/users/vikasdp/gists{/gist_id}","starred_url":"https://api.github.com/users/vikasdp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vikasdp/subscriptions","organizations_url":"https://api.github.com/users/vikasdp/orgs","repos_url":"https://api.github.com/users/vikasdp/repos","events_url":"https://api.github.com/users/vikasdp/events{/privacy}","received_events_url":"https://api.github.com/users/vikasdp/received_events","type":"User","site_admin":false},"created_at":"2016-08-29T19:30:46Z","updated_at":"2016-08-29T19:30:46Z","author_association":"NONE","body":"@sumitjainn - under `nested_filter{}` don't you need an entire query that you have in the main (top) level query clause for this to work? https://www.elastic.co/guide/en/elasticsearch/guide/current/nested-sorting.html \n\ncc @clintongormley \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/244065234","html_url":"https://github.com/elastic/elasticsearch/issues/15797#issuecomment-244065234","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15797","id":244065234,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NDA2NTIzNA==","user":{"login":"sumitjainn","id":657557,"node_id":"MDQ6VXNlcjY1NzU1Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/657557?v=4","gravatar_id":"","url":"https://api.github.com/users/sumitjainn","html_url":"https://github.com/sumitjainn","followers_url":"https://api.github.com/users/sumitjainn/followers","following_url":"https://api.github.com/users/sumitjainn/following{/other_user}","gists_url":"https://api.github.com/users/sumitjainn/gists{/gist_id}","starred_url":"https://api.github.com/users/sumitjainn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sumitjainn/subscriptions","organizations_url":"https://api.github.com/users/sumitjainn/orgs","repos_url":"https://api.github.com/users/sumitjainn/repos","events_url":"https://api.github.com/users/sumitjainn/events{/privacy}","received_events_url":"https://api.github.com/users/sumitjainn/received_events","type":"User","site_admin":false},"created_at":"2016-09-01T12:36:17Z","updated_at":"2016-09-01T12:36:17Z","author_association":"NONE","body":"@vikasdp No, multi level/path nesting does not work in the sort clause.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375057125","html_url":"https://github.com/elastic/elasticsearch/issues/15797#issuecomment-375057125","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15797","id":375057125,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTA1NzEyNQ==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T18:53:28Z","updated_at":"2018-03-21T18:53:28Z","author_association":"CONTRIBUTOR","body":"This was implemented in https://github.com/elastic/elasticsearch/pull/26395\r\n\r\nDocumentation can be found at https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-sort.html#nested-sorting","performed_via_github_app":null}]