{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20777","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20777/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20777/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20777/events","html_url":"https://github.com/elastic/elasticsearch/issues/20777","id":181390323,"node_id":"MDU6SXNzdWUxODEzOTAzMjM=","number":20777,"title":"Agrregation on multiple input in elasticsearch","user":{"login":"SravanTurbo","id":14091342,"node_id":"MDQ6VXNlcjE0MDkxMzQy","avatar_url":"https://avatars3.githubusercontent.com/u/14091342?v=4","gravatar_id":"","url":"https://api.github.com/users/SravanTurbo","html_url":"https://github.com/SravanTurbo","followers_url":"https://api.github.com/users/SravanTurbo/followers","following_url":"https://api.github.com/users/SravanTurbo/following{/other_user}","gists_url":"https://api.github.com/users/SravanTurbo/gists{/gist_id}","starred_url":"https://api.github.com/users/SravanTurbo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SravanTurbo/subscriptions","organizations_url":"https://api.github.com/users/SravanTurbo/orgs","repos_url":"https://api.github.com/users/SravanTurbo/repos","events_url":"https://api.github.com/users/SravanTurbo/events{/privacy}","received_events_url":"https://api.github.com/users/SravanTurbo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-10-06T11:29:28Z","updated_at":"2016-10-12T15:23:33Z","closed_at":"2016-10-07T18:23:01Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.4.1\n\n**Plugins installed**: watcher\n\n**Description of the problem including expected versus actual behavior**\n\n I am monitoring the input sources and trying to output the sources which are not active. below is the watch implemented and the result, \n\nI have 3 input sources  [\"192.168.48.8\", \"192.168.30.150\", \"192.168.190.8\"], out of which \"192.168.190.8\" is inactive, \n\nI was able to get the name of active sources in my alert.  \n\nIs there a way to  notify the names of inactive sources (may be by subtracting the aggregated active sources from Input sources )\n\nThanks in advance!!!\n\n**Watch**:\n\n```\n\"trigger\"\n  {\n    \"schedule\" : { \"interval\" : \"1m\" }\n  },\n  \"input\" : {\n    \"chain\": {\n      \"inputs\": [\n        {\n          \"first\": {\n            \"simple\" : {\n              \"Input_hosts\" : [\"192.168.48.8\", \"192.168.30.150\", \"192.168.190.8\"]\n            }\n          }\n        },\n        {\n          \"second\": {\n            \"search\" : {\n              \"request\" : {\n                \"indices\" : [ \"firewalls\" ],\n                \"body\" : {\n                  \"query\" : {\n                    \"bool\": {\n                      \"must\": [\n                {\n                          \"range\": {\n                            \"@timestamp\": {\n                              \"gte\": \"now-4d\"\n                            }\n                          }\n                        },\n                { \"bool\": {\n                        \"should\": [\n                              { \"bool\": { \"must_not\": { \"match\" : {\"host\": \"192.168.190.8\"}}}}, \n                              { \"bool\": { \"must_not\": {\"match\" : {\"host\": \"192.168.48.8\"}}}},\n                              { \"bool\": { \"must_not\": {\"match\" : {\"host\": \"192.168.30.150\"}}}}]\n                          }           \n                        }\n                      ]\n                    }   \n                  },\n                  \"size\": 0,\n                  \"aggregations\": {\n                            'hosts': { \"terms\": { \"field\": \"host\" } }\n                  }     \n                }\n              }\n            }\n          }\n        }\n      ]\n    } \n  },\n  \"condition\" : {\n    \"compare\" : { \"ctx.payload.second.hits.total\" : { \"gt\" : 0 }} \n  },\n  \"throttle_period\" : \"12h\",\n  \"actions\" : {\n    \"send_email\" : {     \n      \"email\" : {\n        \"to\" : [\"abc@def.com\"],\n        \"subject\" : \"{{ctx.watch_id}}\",\n        \"body\" : \"Input Sources: {{ctx.payload.first.Input_hosts}}\\n\\nSome sources are not contributing;\\n\\nActive Sources: {{ctx.payload.second.aggregations.hosts.buckets}}\",\n        \"attach_data\" : true\n      }\n    }\n  }\n}'\n\n```\n\n**Output**:\n\"Input Sources: {0=192.168.48.8, 1=192.168.30.150, 2=192.168.190.8}\n\nSome sources are not contributing;\n\nActive Sources: {0={doc_count=52729, key=192.168.30.150}, 1={doc_count=40149, key=192.168.48.8}}\"\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}