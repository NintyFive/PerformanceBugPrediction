{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30685","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30685/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30685/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30685/events","html_url":"https://github.com/elastic/elasticsearch/issues/30685","id":324035285,"node_id":"MDU6SXNzdWUzMjQwMzUyODU=","number":30685,"title":"Attempt to get cardinality or the count of buckets in date histogram ","user":{"login":"toddferg","id":34006787,"node_id":"MDQ6VXNlcjM0MDA2Nzg3","avatar_url":"https://avatars2.githubusercontent.com/u/34006787?v=4","gravatar_id":"","url":"https://api.github.com/users/toddferg","html_url":"https://github.com/toddferg","followers_url":"https://api.github.com/users/toddferg/followers","following_url":"https://api.github.com/users/toddferg/following{/other_user}","gists_url":"https://api.github.com/users/toddferg/gists{/gist_id}","starred_url":"https://api.github.com/users/toddferg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/toddferg/subscriptions","organizations_url":"https://api.github.com/users/toddferg/orgs","repos_url":"https://api.github.com/users/toddferg/repos","events_url":"https://api.github.com/users/toddferg/events{/privacy}","received_events_url":"https://api.github.com/users/toddferg/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2018-05-17T13:57:57Z","updated_at":"2018-10-03T15:42:25Z","closed_at":"2018-09-21T07:12:01Z","author_association":"NONE","active_lock_reason":null,"body":"It would be helpful to have a method to retrieve the count of available buckets before querying all of the documents.  In the query to prevent extremely large queries from taking place.  For example: it would be helpful to be able to run this aggregation to see the total number of buckets that could be returned before actually querying the bucket size.\r\n\r\nAn example aggregation that gets close by returning the count of the buckets but this query still hits all of the documents : \r\n\r\n```\r\nGET unifi-2018*/_search\r\n{\r\n  \"size\": 0, \r\n  \"aggs\": {\r\n    \"date_histo\": {\r\n      \"date_histogram\": {\r\n        \"field\": \"@timestamp\",\r\n        \"interval\": \"month\"\r\n      }\r\n    },\r\n    \"count_buckets\" : {\r\n      \"stats_bucket\": {\r\n        \"buckets_path\": \"date_histo._count\"\r\n      }\r\n      }\r\n    }\r\n}\r\n```\r\n\r\nBeing able to get the list of the potential buckets before executing the query would be helpful to prevent a cluster from being overwhelmed by an extremely large date range. \r\n\r\n\r\n","closed_by":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}