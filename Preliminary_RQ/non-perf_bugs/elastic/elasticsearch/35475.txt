{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/35475","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35475/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35475/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35475/events","html_url":"https://github.com/elastic/elasticsearch/issues/35475","id":379998649,"node_id":"MDU6SXNzdWUzNzk5OTg2NDk=","number":35475,"title":"Feature request: Normalize timelion graph with sparse data, and also split by top N values for a specified field.","user":{"login":"pixrrs","id":19270793,"node_id":"MDQ6VXNlcjE5MjcwNzkz","avatar_url":"https://avatars0.githubusercontent.com/u/19270793?v=4","gravatar_id":"","url":"https://api.github.com/users/pixrrs","html_url":"https://github.com/pixrrs","followers_url":"https://api.github.com/users/pixrrs/followers","following_url":"https://api.github.com/users/pixrrs/following{/other_user}","gists_url":"https://api.github.com/users/pixrrs/gists{/gist_id}","starred_url":"https://api.github.com/users/pixrrs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pixrrs/subscriptions","organizations_url":"https://api.github.com/users/pixrrs/orgs","repos_url":"https://api.github.com/users/pixrrs/repos","events_url":"https://api.github.com/users/pixrrs/events{/privacy}","received_events_url":"https://api.github.com/users/pixrrs/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-11-12T23:50:00Z","updated_at":"2018-11-13T15:54:24Z","closed_at":"2018-11-13T10:31:18Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\nThis was discussed with Jason Alcorn in a support request. When it turned out what I wanted to do is not currently possible, they suggested filing a feature request.\r\n\r\nI'm working with a sparse data set that I need to normalize to count-per-minute, similar to what's done here:\r\nhttps://www.elastic.co/blog/sparse-timeseries-and-timelion\r\n\r\nI also want to split the graph by a field. So far, the only way I've found to make this work is to plot each tool of interest separately, but that's both unwieldy and inflexible. \r\n\r\nWhat I expect when I do a split on the data in the right place is to get something that looks the same as if I made individual queries for the top N contributors, but that doesn't seem possible. \r\n\r\nSome things I tried in the demo site: \r\n(1) \r\n> .es(index=sys_rpg_tabledump_queue-*).if(eq, 0, null, .es(metric=\"sum:count\", index=sys_rpg_tabledump_queue-*)).label(\"normalized total for all tools\").fit(scale).scale_interval(1m).multiply(-1).bars().trim().title(\"no split\")\r\n\r\nThis shows the normalized count for everything, and has values around 500,000\r\n\r\n(2) \r\n> .es(split=tool:3, index=sys_rpg_tabledump_queue-*).if(eq, 0, null, .es(metric=\"sum:count\", split=tool:3, index=sys_rpg_tabledump_queue-*)).fit(scale).scale_interval(1m).multiply(-1).bars().trim().title(\"split in both\")\r\n\r\nHere I put the split by tool in both calls to .es and somehow the totals for the top 3 tools are around 800,000\r\n\r\n(3) \r\n> .es(index=sys_rpg_tabledump_queue-*).if(eq, 0, null, .es(metric=\"sum:count\", index=sys_rpg_tabledump_queue-*, split=tool:3)).fit(scale).scale_interval(1m).bars().trim().multiply(-1).title(\"split in if\")\r\n\r\nHere I only put the split in the .es call within the if statement. You don't see any split in the graph, but I'm assuming it might be showing just the top tool since the numbers are around 300,000\r\n\r\n(4) \r\n> .es(index=sys_rpg_tabledump_queue-*, split=tool:3).if(eq, 0, null, .es(metric=\"sum:count\", index=sys_rpg_tabledump_queue-*)).fit(scale).scale_interval(1m).bars().trim().multiply(-1).title(\"split in 1st\")\r\n\r\nHere I only put the split in the 1st .es call, and you can see the top 3 tools, but somehow the values are around 1,500,000\r\n\r\n(5) \r\n> .es(index=metricbeat-*).if(eq, 0, null, .es(metric=\"sum:apache.status.bytes_per_sec\", q=host.name:gke-prod-demo-elastic--default-pool-2-6c749820-w1w7, index=metricbeat-*)).label(\"normalized total for 2-6c749820-w1w7\").fit(scale).scale_interval(1m).multiply(-1).bars(stack=true).trim().title(\"individual queries\"), .es(index=metricbeat-*).if(eq, 0, null, .es(metric=\"sum:apache.status.bytes_per_sec\", q=host.name:gke-prod-demo-elastic--default-pool-1-8c155651-v29q, index=metricbeat-*)).label(\"normalized total for 1-8c155651-v29q\").fit(scale).scale_interval(1m).multiply(-1).bars().trim().title(\"individual queries\"), .es(index=metricbeat-*).if(eq, 0, null, .es(metric=\"sum:apache.status.bytes_per_sec\", q=host.name:gke-prod-demo-elastic--default-pool-0-57d2bcba-jn8r, index=metricbeat-*)).label(\"normalized total for 0-57d2bcba-jn8r\").fit(scale).scale_interval(1m).multiply(-1).bars().trim().title(\"individual queries\")\r\n\r\nHere I have a separate query for each of 3 host names. This seems to get the right numbers, but it's long and messy and you have to know the host names you want to split on. \r\n\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}