[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499134080","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499134080","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499134080,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTEzNDA4MA==","user":{"login":"yrodiere","id":412878,"node_id":"MDQ6VXNlcjQxMjg3OA==","avatar_url":"https://avatars1.githubusercontent.com/u/412878?v=4","gravatar_id":"","url":"https://api.github.com/users/yrodiere","html_url":"https://github.com/yrodiere","followers_url":"https://api.github.com/users/yrodiere/followers","following_url":"https://api.github.com/users/yrodiere/following{/other_user}","gists_url":"https://api.github.com/users/yrodiere/gists{/gist_id}","starred_url":"https://api.github.com/users/yrodiere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yrodiere/subscriptions","organizations_url":"https://api.github.com/users/yrodiere/orgs","repos_url":"https://api.github.com/users/yrodiere/repos","events_url":"https://api.github.com/users/yrodiere/events{/privacy}","received_events_url":"https://api.github.com/users/yrodiere/received_events","type":"User","site_admin":false},"created_at":"2019-06-05T15:30:58Z","updated_at":"2019-06-05T15:30:58Z","author_association":"NONE","body":"Hi,\r\n\r\nI'm submitting this as an issue to get some opinion.\r\n\r\nThe problem is impacting our ability to index `BigDecimals` in Hibernate Search, so I'd be more than happy to try and contribute a fix if the issue is deemed valid.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499370540","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499370540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499370540,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTM3MDU0MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-06-06T06:45:14Z","updated_at":"2019-06-06T06:45:14Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499589661","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499589661","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499589661,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTU4OTY2MQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-06T17:23:52Z","updated_at":"2019-06-06T17:23:52Z","author_association":"MEMBER","body":"This is fixed by #42554, hence closing","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499589783","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499589783","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499589783,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTU4OTc4Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-06T17:24:13Z","updated_at":"2019-06-06T17:24:13Z","author_association":"MEMBER","body":"Oups wrong issue, sorry","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499596905","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499596905","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499596905,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTU5NjkwNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-06T17:43:51Z","updated_at":"2019-06-06T17:43:51Z","author_association":"MEMBER","body":"We could do the parsing from the string representation but I don't think that this field should be used to index `BigDecimal`. The field expects a number represented as a double so anything that requires more accuracy is rounded to a double first. This is also consistent with what we do for the other numeric types. Can you explain how and why you want to index `BigDecimal` with `scaled_float` ? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499772503","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499772503","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499772503,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTc3MjUwMw==","user":{"login":"yrodiere","id":412878,"node_id":"MDQ6VXNlcjQxMjg3OA==","avatar_url":"https://avatars1.githubusercontent.com/u/412878?v=4","gravatar_id":"","url":"https://api.github.com/users/yrodiere","html_url":"https://github.com/yrodiere","followers_url":"https://api.github.com/users/yrodiere/followers","following_url":"https://api.github.com/users/yrodiere/following{/other_user}","gists_url":"https://api.github.com/users/yrodiere/gists{/gist_id}","starred_url":"https://api.github.com/users/yrodiere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yrodiere/subscriptions","organizations_url":"https://api.github.com/users/yrodiere/orgs","repos_url":"https://api.github.com/users/yrodiere/repos","events_url":"https://api.github.com/users/yrodiere/events{/privacy}","received_events_url":"https://api.github.com/users/yrodiere/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T06:25:48Z","updated_at":"2019-06-07T06:29:23Z","author_association":"NONE","body":"Ok, here is an explanation.\r\n\r\nWhen using a `BigDecimal` in an application, we typically want more precision than a `double`. Otherwise, we'd just pick `double`.\r\n\r\n`scaled_float` is the only floating-point type advertising a precision higher than that of a `double`, since it is described as \"indexed as a long\", which could theoretically give 64 bits of precision.\r\n\r\nEDIT: also, the documentation doesn't mention that the purpose of `scaled_float` is to index doubles. It only mentions \"floating-point data\", which `BigDecimal` definitely is.\r\n\r\nAlso... even though Elasticsearch is not a relational database, the relational world uses similar concepts to store arbitrary-precision, arbitrary-scale floating-point values.\r\nIn JPA: you configure the scale and precision you want using `javax.persistence.Column#precision` and `javax.persistence.Column#scale`.\r\nWhen dealing with relational databases directly, you configure the `NUMERIC`/`DECIMAL` type in a similar way.\r\nFrom a user's perspective, the only difference, really, is that `scaled_float` doesn't allow setting the precision. But at least it is better than that of a `double`.\r\n\r\nSo here we are: `scaled_float` is functionally very similar to what is used in the relational world to store a `BigDecimal`, and it is already (internally) able to provide more precision than a double, but it just happens to not allow that because of a parsing issue... Isn't that a shame?\r\n\r\nI'm not saying that this type should be turned as \"the\" way to index arbitrary-precision numbers. I know there are plans to provide that, possibly using different data types.\r\nI'm just saying that until these new data types are there, the only choice is using `double` or `scaled_float`, and it would be great if there was a way to fully take advantage of `scaled_float`.\r\n\r\nNote that theoretically, the scaling factor could be turned into a `BigDecimal`, too, allowing to indexing of values with far larger or smaller exponents. It doesn't seem like it would have much impact on the type.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499788692","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499788692","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499788692,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTc4ODY5Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T07:37:18Z","updated_at":"2019-06-07T07:37:18Z","author_association":"MEMBER","body":"As said above we treat this field as if it was indexed with doubles this is why you can use it in aggregations where values are translated back to doubles. With more precision we'd need to treat them differently in aggregations or even worse drop the support for it. I understand that not supporting  `BigDecimal` is an issue for you but I also don't think that `scaled_float` is the solution, not now and probably never. We discussed the support for `BigDecimal` [here](https://github.com/elastic/elasticsearch/issues/17006) and we agreed that we wouldn't be able to provide a good support for it in terms of storage, queries and aggregations so there is no real value to expose this feature unless new ideas emerge on how to handle this type.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499821909","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499821909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499821909,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTgyMTkwOQ==","user":{"login":"yrodiere","id":412878,"node_id":"MDQ6VXNlcjQxMjg3OA==","avatar_url":"https://avatars1.githubusercontent.com/u/412878?v=4","gravatar_id":"","url":"https://api.github.com/users/yrodiere","html_url":"https://github.com/yrodiere","followers_url":"https://api.github.com/users/yrodiere/followers","following_url":"https://api.github.com/users/yrodiere/following{/other_user}","gists_url":"https://api.github.com/users/yrodiere/gists{/gist_id}","starred_url":"https://api.github.com/users/yrodiere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yrodiere/subscriptions","organizations_url":"https://api.github.com/users/yrodiere/orgs","repos_url":"https://api.github.com/users/yrodiere/repos","events_url":"https://api.github.com/users/yrodiere/events{/privacy}","received_events_url":"https://api.github.com/users/yrodiere/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T09:34:54Z","updated_at":"2019-06-07T09:34:54Z","author_association":"NONE","body":"I'm certainly not asking for support for `BigDecimal`, which I only mentioned to explain my use case. I fully understand it would require a lot of work and cannot be implemented completely.\r\nI'm not even asking to change querying, storage or aggregations.\r\nI'm just proposing to fix a parsing issues that prevents from taking advantage of a 64-bit precision that is *already there*, and is not being exploited to its full potential.\r\n\r\nIt would improve precision of range queries, which is nice.\r\nIt may not improve precision of storage or aggregations, which from why I understand use doubles internally. A shame, but at long as it isn't worse than it used to be, I don't see how that's a problem.\r\n\r\nThat being said, I can understand that what matters more is whether the developers have a problem with maintaining such a \"feature\".\r\n\r\nI'd be happy to deliver a patch if you agree to just fixing parsing of strings. I'll add tests for match/range queries, and maybe some other tests to check that storage/aggregations still work, just with 53-bit precision instead of 64.\r\n\r\nOtherwise, well... Thanks for taking the time to answer.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499849437","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-499849437","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":499849437,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTg0OTQzNw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T11:22:40Z","updated_at":"2019-06-07T11:22:40Z","author_association":"MEMBER","body":"I agree that the change is simple, we could just parse the input with BigDecimal directly rather than using a double first. However as said above my main concern is that we'll lose the precision in scripts and aggregations (where we use doubles) so it would only help for sorting and querying which is deceptive for users. I don't think that the maintenance is an issue here, it is more about the contract that we have on this field and the fact that the behavior should remain consistent in queries, aggregations and any consumer of this field.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508811321","html_url":"https://github.com/elastic/elasticsearch/issues/42898#issuecomment-508811321","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42898","id":508811321,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODgxMTMyMQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T16:36:13Z","updated_at":"2019-07-05T16:36:13Z","author_association":"MEMBER","body":"I am going to close this issue for the reasons exposed in the previous comments. We want to keep the consistency between sort and aggregations so we are not inclined to make a change that would add more precision to one but not the other.","performed_via_github_app":null}]