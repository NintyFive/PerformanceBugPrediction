[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42024256","html_url":"https://github.com/elastic/elasticsearch/issues/6018#issuecomment-42024256","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6018","id":42024256,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDI0MjU2","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2014-05-02T12:16:23Z","updated_at":"2014-05-02T12:16:23Z","author_association":"CONTRIBUTOR","body":"> So I dug in and discovered one problem, I think caused by the\n> super.flush and then delegate.flush in BufferedChecksumIndexOutput,\n> where the RateLimiter is always alternately called first on 8192 bytes\n> then on 0 bytes. If I fix RateLimiter to just ignore those 0 bytes,\n> the merge time with 50 MB/sec throttle drops to 49.9 sec: better, but\n> still too long. (I think once we cutover to Lucene's checksums this 0\n> byte issue will be fixed?)\n\nIt will solve it in that place: the BufferedChecksumIndexOutput. Note that RateLimitedIndexOutput itself has a similar construction, we should ensure its not doing anything stupid too.\n\nAnother similar expensive call is any digester's updateBytes(). We want to avoid calling this native method frequently (e.g. for zero bytes) for the same reasons.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42174916","html_url":"https://github.com/elastic/elasticsearch/issues/6018#issuecomment-42174916","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6018","id":42174916,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTc0OTE2","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-05-05T10:17:47Z","updated_at":"2014-05-05T10:17:47Z","author_association":"CONTRIBUTOR","body":"I opened https://issues.apache.org/jira/browse/LUCENE-5641 to fix this in Lucene; I'll carry the fix over to ES once that's in ...\n","performed_via_github_app":null}]