{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711/events","html_url":"https://github.com/elastic/elasticsearch/issues/9711","id":57823623,"node_id":"MDU6SXNzdWU1NzgyMzYyMw==","number":9711,"title":"[Query DSL] Do not consider empty object at the end of array invalid token","user":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2015-02-16T16:21:23Z","updated_at":"2016-09-09T18:01:07Z","closed_at":"2015-02-27T23:42:12Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This might sound weird at start but I actually think is very useful feature, thus filling ticket to keep it around.\n\nWhen I use search templates it can happen that I need to populate something from parameter that is an array. In some situations this can lead to challenging situation in Query DSL. For example, imagine I need to pass in an array of tags that goes to `or` filter:\n\n```\n\"filter\": {\n    \"or\": [\n        { \"term\": { \"tag\": \"param_value1\" }},\n        { \"term\": { \"tag\": \"param_value2\" }},\n        ...\n        { \"term\": { \"tag\": \"param_valueN\" }}\n    ]\n}\n```\n\nGenerating such output from Mustache template does not seem to be easy to me. There are some tricky parts that need to be handled correctly. First, it is not easy to omit whole `or` filter part (or even whole `filter` part in this case) if tags array is empty. Secondly, we need to omit comma after the last element in the array. The best I have come up with so far is the following template:\n\n```\n\"filter\": { \"or\": [ {{#tags}} { \"term\": { \"tag\": \"{{.}}\" }}, {{/tags}} {} ] }\n```\n\nThis results into the following output:\n\n```\n\"filter\": {\n    \"or\": [\n        { \"term\": { \"tag\": \"param_value1\" }},\n        { \"term\": { \"tag\": \"param_value2\" }},\n        ...\n        { \"term\": { \"tag\": \"param_valueN\" }},\n        {}\n    ]\n}\n```\n\nIf the `tags` parameter is empty or missing then it will result into the following:\n\n```\n\"filter\": {\n    \"or\": [\n        {}\n    ]\n}\n```\n\nIgnoring the `{}` token greatly simplify Mustache templating. May be ES is already intelligently doing this but I am not sure if this was intentional or just a luck. If the later I would like to suggest making it an official feature and part of \"official\" Query DSL grammar.\n\nHope this makes sense.\n","closed_by":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}