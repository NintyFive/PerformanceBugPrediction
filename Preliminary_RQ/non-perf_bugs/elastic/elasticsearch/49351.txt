{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/49351","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49351/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49351/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49351/events","html_url":"https://github.com/elastic/elasticsearch/issues/49351","id":525372351,"node_id":"MDU6SXNzdWU1MjUzNzIzNTE=","number":49351,"title":"Regression in date parsing (\"2016-11-30T12+01\" accepted before ES 7","user":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-11-20T01:58:10Z","updated_at":"2020-01-08T13:05:23Z","closed_at":"2020-01-08T13:05:23Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\n\r\n5.6.12 vs 74.2\r\n\r\n**Plugins installed**: []\r\nunrelated\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_232\"\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\ncentos8 container\r\nLinux 044afd19e126 4.9.184-linuxkit #1 SMP Tue Jul 2 22:58:16 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\nThis admittedly weird, incomplete date time string with a timezone offset:\r\n`2016-11-30T12+01`\r\nis accepted as a `date` by ES 5.6.12 but **fails** on ES 7.4.2 (probably any 7.x?) with:\r\n```\r\nHTTP/1.1 400 Bad Request\r\n\r\n      \"type\" : \"illegal_argument_exception\",\r\n      \"reason\" : \"failed to parse date field [2016-11-30T12+01] with format [strict_date_optional_time||epoch_millis]\",\r\n``` \r\n```\r\ncurl -X PUT \"elasticsearch:9200/my_index?pretty\" -H 'Content-Type: application/json' --data-binary '{\r\n  \"mappings\": {\r\n    \"doc\": {\r\n      \"properties\": {\r\n        \"date\": {\r\n          \"type\":   \"date\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n\r\ncurl -i -XPUT -H 'Content-type: application/json' http://elasticsearch:9200/my_index/doc/1 --data-binary  '{\"date\": \"2016-11-30T12+01\"}'\r\nHTTP/1.1 201 Created\r\n```\r\n\r\n```\r\ncurl -X PUT \"elasticsearch:9200/my_index?include_type_name=true&pretty\" -H 'Content-Type: application/json' --data-binary '{            \r\n\"mappings\": {\r\n   \"doc\" : {\r\n      \"properties\": {\r\n        \"date\": {\r\n          \"type\":   \"date\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n\r\ncurl -i -XPUT -H 'Content-type: application/json' http://elasticsearch:9200/my_index/doc/1?pretty --data-binary  '{\"date\": \"2016-11-30T12+01\"}'\r\n\r\nHTTP/1.1 400 Bad Request\r\nWarning: 299 Elasticsearch-7.4.2-2f90bbf7b93631e52bafb59b3b049cb44ec25e96 \"[types removal] Specifying types in document index requests is deprecated, use the typeless endpoints instead (/{index}/_doc/{id}, /{index}/_doc, or /{index}/_create/{id}).\"\r\ncontent-type: application/json; charset=UTF-8\r\ncontent-length: 767\r\n\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"mapper_parsing_exception\",\r\n        \"reason\" : \"failed to parse field [date] of type [date] in document with id '1'. Preview of field's value: '2016-11-30T12+01'\"\r\n      }\r\n    ],\r\n    \"type\" : \"mapper_parsing_exception\",\r\n    \"reason\" : \"failed to parse field [date] of type [date] in document with id '1'. Preview of field's value: '2016-11-30T12+01'\",\r\n    \"caused_by\" : {\r\n      \"type\" : \"illegal_argument_exception\",\r\n      \"reason\" : \"failed to parse date field [2016-11-30T12+01] with format [strict_date_optional_time||epoch_millis]\",\r\n      \"caused_by\" : {\r\n        \"type\" : \"date_time_parse_exception\",\r\n        \"reason\" : \"Failed to parse with all enclosed parsers\"\r\n      }\r\n    }\r\n  },\r\n  \"status\" : 400\r\n}\r\n```\r\nBtw same behavior if the `strict_date_optional_time` is used explicitly in the mapping, it's the default in both elasticsearch versions.\r\n```\r\n          \"format\": \"strict_date_optional_time||epoch_millis\"\r\n```\r\n**Provide logs (if relevant)**:\r\n\r\nSee output above, it just seems like a change in what the date parser accepts. Can that be fixed or is this by design?\r\n\r\nBesides the regression and incompatibility this introduces for users upgrading, can this cause any in-place **upgrade** problems with ES 5 => 7? ","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}