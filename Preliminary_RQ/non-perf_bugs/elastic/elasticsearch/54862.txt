{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/54862","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54862/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54862/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54862/events","html_url":"https://github.com/elastic/elasticsearch/issues/54862","id":595671145,"node_id":"MDU6SXNzdWU1OTU2NzExNDU=","number":54862,"title":"[Transform] add throttling based on configuration parameter","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-04-07T07:58:41Z","updated_at":"2020-06-03T06:15:30Z","closed_at":"2020-05-05T09:35:00Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Running transform can increase load on the cluster. Especially in _batch_ mode and for the _first checkpoint_ of a continuous transform this can have bad side effects on the cluster.\r\n\r\nTransform should support throttling similar to [reindex](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-reindex.html#docs-reindex-throttle). Throttling is configured _in reindex_ with the setting `requests_per_second`.\r\n\r\nBecause transform works as a reducer (reindex is conceptually a mapper), transform should throttle differently:\r\n\r\n  - we be base the calculation on the number of _input_ documents\r\n  - most runtime is spend for search/aggregations\r\n  - the number of _output_ documents can differ, even within one transform due to data and configuration\r\n\r\n**For transform we decided to go for `docs_per_second`.**\r\n\r\nSetting `docs_per_second` to `null` disables throttling (instead of `null` you can also use `-1`), setting `docs_per_second` to `0` is disallowed.\r\n\r\nConfiguration:\r\n```\r\n{\r\n  \"source\": {...},\r\n  \"dest\": {...}\r\n  \"pivot\": {\r\n      \"group_by\": {...},\r\n      \"aggregations\"\" {...}\r\n  },\r\n  \"settings\": {\r\n      \"max_page_search_size\": XX,\r\n      \"docs_per_second\": XX\r\n  }\r\n}\r\n```\r\n\r\n`docs_per_second` is located under a new object: `settings`.\r\n\r\nThe setting `max_page_search_size` which is part of `pivot` will be moved there, too (the old place is deprecated but kept for BWC). If both are specified, the one under settings win, because it could be a leftover after updating an old configuration.\r\n\r\nThe whole settings object will be update-able with the [update](https://www.elastic.co/guide/en/elasticsearch/reference/master/update-transform.html) API.\r\n\r\nUpdate will be \r\n - **immediate** for settings\r\n - **delayed** until the next checkpoint for the rest","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}