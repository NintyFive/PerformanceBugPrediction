[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499965117","html_url":"https://github.com/elastic/elasticsearch/issues/42996#issuecomment-499965117","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42996","id":499965117,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTk2NTExNw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T17:10:33Z","updated_at":"2019-06-07T17:10:33Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499966027","html_url":"https://github.com/elastic/elasticsearch/issues/42996#issuecomment-499966027","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42996","id":499966027,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTk2NjAyNw==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T17:13:22Z","updated_at":"2019-06-07T17:13:22Z","author_association":"MEMBER","body":"ping @s1monw","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500328758","html_url":"https://github.com/elastic/elasticsearch/issues/42996#issuecomment-500328758","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42996","id":500328758,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDMyODc1OA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-10T08:02:58Z","updated_at":"2019-06-10T08:02:58Z","author_association":"MEMBER","body":"This is related to the number of `slices` that the DBQ should run with. When the number of slices is not a factor of the number of shards the reindex family will split the work into separate tasks that use the `_id` field to segregate documents. This can work only if the postings for the `_id` field are preserved which is not the case anymore for indices with soft deletes enabled (due to https://github.com/elastic/elasticsearch/pull/40741). This is something we should check in all reindex command and maybe fail the request if the number of slices is not a factor of the number of shards. In the meantime we should also remove the static value that is set in `DataFrame` to perform a DBQ:\r\nhttps://github.com/elastic/elasticsearch/blob/7c503ce20d762b82da975764482cc6eace542fa2/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/persistence/DataFrameTransformsConfigManager.java#L253\r\n@benwtrent can it be set to the number of shards instead (or removed entirely) ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500331417","html_url":"https://github.com/elastic/elasticsearch/issues/42996#issuecomment-500331417","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42996","id":500331417,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDMzMTQxNw==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-06-10T08:13:12Z","updated_at":"2019-06-10T08:13:12Z","author_association":"CONTRIBUTOR","body":"Notice that the use of `_id` is explicitly mentioned on the scroll search reference docs here:\r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-scroll.html\r\n\r\nI think those would be affected too?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500333493","html_url":"https://github.com/elastic/elasticsearch/issues/42996#issuecomment-500333493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42996","id":500333493,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDMzMzQ5Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-10T08:21:06Z","updated_at":"2019-06-10T08:21:06Z","author_association":"MEMBER","body":"> I think those would be affected too?\r\n\r\nYes, the check should be implemented in the `_scroll` API since that's what all reindex commands use.\r\nThe default for `_scroll` is to not use any slicing but we should add a note in the documentation and a check in the code that `slice` are not used on indices that can remove the postings for the `_id` field. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500712195","html_url":"https://github.com/elastic/elasticsearch/issues/42996#issuecomment-500712195","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42996","id":500712195,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDcxMjE5NQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-06-11T06:55:25Z","updated_at":"2019-06-11T06:55:25Z","author_association":"CONTRIBUTOR","body":"> This can work only if the postings for the _id field are preserved which is not the case anymore for indices with soft deletes enabled (due to #40741)\r\n\r\nCan't this still work, even with #40741, which just drops the `_id` field on soft-deleted docs? Given that reindex and friends care about livedocs, there's no reason for this slicing functionality not to work anymore if only postings of soft-deleted docs are pruned. I wonder if this is rather a bug in `TermsSliceQuery` which assumes that there's always a terms index for the given field.\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500714135","html_url":"https://github.com/elastic/elasticsearch/issues/42996#issuecomment-500714135","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42996","id":500714135,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDcxNDEzNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-11T07:02:25Z","updated_at":"2019-06-11T07:02:25Z","author_association":"MEMBER","body":"> I wonder if this is rather a bug in TermsSliceQuery which assumes that there's always a terms index for the given field.\r\n\r\nGood call @ywelsch , I misread the change and assumed that all postings for the `_id` field were removed. If it's only for soft deleted documents then slicing should work and the `TermsSliceQuery` just need to verify that the segment contain entries for the `_id` field. I'll work on a patch.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500775373","html_url":"https://github.com/elastic/elasticsearch/issues/42996#issuecomment-500775373","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42996","id":500775373,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDc3NTM3Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-06-11T10:03:43Z","updated_at":"2019-06-11T10:03:43Z","author_association":"MEMBER","body":"Thanks to Yannick I pushed a fix in https://github.com/elastic/elasticsearch/pull/43078 and we don't need to do anything in the scroll or reindex family since slicing should work as usual. Sorry for the confusion.","performed_via_github_app":null}]