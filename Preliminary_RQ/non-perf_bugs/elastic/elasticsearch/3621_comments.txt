[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23837029","html_url":"https://github.com/elastic/elasticsearch/issues/3621#issuecomment-23837029","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3621","id":23837029,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM3MDI5","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2013-09-05T00:49:00Z","updated_at":"2013-09-05T00:49:00Z","author_association":"MEMBER","body":"Based on the stack traces, you have many search failures going on (almost as if all your search requests fail), do you see failures in the log?\n\nThis will not cause ES to become unresponsive, I see based on the stack trace that you also send a multi search request, how many search requests do you have in that multi search request?\n\nWhat do you mean when you say its not responsive? To which operations does not it not respond?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23837531","html_url":"https://github.com/elastic/elasticsearch/issues/3621#issuecomment-23837531","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3621","id":23837531,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM3NTMx","user":{"login":"rdeaton","id":671370,"node_id":"MDQ6VXNlcjY3MTM3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/671370?v=4","gravatar_id":"","url":"https://api.github.com/users/rdeaton","html_url":"https://github.com/rdeaton","followers_url":"https://api.github.com/users/rdeaton/followers","following_url":"https://api.github.com/users/rdeaton/following{/other_user}","gists_url":"https://api.github.com/users/rdeaton/gists{/gist_id}","starred_url":"https://api.github.com/users/rdeaton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdeaton/subscriptions","organizations_url":"https://api.github.com/users/rdeaton/orgs","repos_url":"https://api.github.com/users/rdeaton/repos","events_url":"https://api.github.com/users/rdeaton/events{/privacy}","received_events_url":"https://api.github.com/users/rdeaton/received_events","type":"User","site_admin":false},"created_at":"2013-09-05T01:04:52Z","updated_at":"2013-09-05T01:04:52Z","author_association":"NONE","body":"I should have mentioned above that this trace is from a master-only node.\n\nThe multisearch request is 4 searches per multisearch. I am however doing a very high volume of searches.\n\nWhen I say not responsive, I mean that calling anything via the HTTP interface times out, and the other master nodes in my cluster also end up hitting fd.timeouts on this node most of the time.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23837597","html_url":"https://github.com/elastic/elasticsearch/issues/3621#issuecomment-23837597","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3621","id":23837597,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODM3NTk3","user":{"login":"rdeaton","id":671370,"node_id":"MDQ6VXNlcjY3MTM3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/671370?v=4","gravatar_id":"","url":"https://api.github.com/users/rdeaton","html_url":"https://github.com/rdeaton","followers_url":"https://api.github.com/users/rdeaton/followers","following_url":"https://api.github.com/users/rdeaton/following{/other_user}","gists_url":"https://api.github.com/users/rdeaton/gists{/gist_id}","starred_url":"https://api.github.com/users/rdeaton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdeaton/subscriptions","organizations_url":"https://api.github.com/users/rdeaton/orgs","repos_url":"https://api.github.com/users/rdeaton/repos","events_url":"https://api.github.com/users/rdeaton/events{/privacy}","received_events_url":"https://api.github.com/users/rdeaton/received_events","type":"User","site_admin":false},"created_at":"2013-09-05T01:06:45Z","updated_at":"2013-09-05T01:06:45Z","author_association":"NONE","body":"As for the failures, it is possible that a high number of failures are coming back. This issue seems to be triggered after an issue that is cropping up as the result of some other problems on the master nodes where they very quickly become backed up on requests to the point where the threadpool is full and they start rejecting searches. At least some of these instances seem to be related to some of my previous bug reports.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23871552","html_url":"https://github.com/elastic/elasticsearch/issues/3621#issuecomment-23871552","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3621","id":23871552,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODcxNTUy","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2013-09-05T14:28:36Z","updated_at":"2013-09-05T14:28:36Z","author_association":"MEMBER","body":"The master node doesn't coordinate search requests, you can send the request to any node and it will be the coordinator for that scatter/gather type search request.\n\nI wonder if you are creating many HTTP connections to the nodes, resulting in exhausting the capability to open new sockets? \n\nYou mean that those failure might relate to the NPE you get with the completion service? That can cause excessive load on a cluster (as its unexepcted).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/23876130","html_url":"https://github.com/elastic/elasticsearch/issues/3621#issuecomment-23876130","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3621","id":23876130,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODc2MTMw","user":{"login":"mattweber","id":173955,"node_id":"MDQ6VXNlcjE3Mzk1NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mattweber","html_url":"https://github.com/mattweber","followers_url":"https://api.github.com/users/mattweber/followers","following_url":"https://api.github.com/users/mattweber/following{/other_user}","gists_url":"https://api.github.com/users/mattweber/gists{/gist_id}","starred_url":"https://api.github.com/users/mattweber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattweber/subscriptions","organizations_url":"https://api.github.com/users/mattweber/orgs","repos_url":"https://api.github.com/users/mattweber/repos","events_url":"https://api.github.com/users/mattweber/events{/privacy}","received_events_url":"https://api.github.com/users/mattweber/received_events","type":"User","site_admin":false},"created_at":"2013-09-05T15:26:31Z","updated_at":"2013-09-05T15:26:31Z","author_association":"CONTRIBUTOR","body":"Thanks Shay,\n\nGood point about the open sockets, we will distribute the http load across all 13 servers (10 data, 3 master) to see if that helps.  I am thinking this might be due to NPE in the completion service:\n1.  NPE happens\n2.  The shard with the NPE goes into initializing state: https://groups.google.com/forum/#!topic/elasticsearch/aySF9A51UVU \n3.  Since we have a shard not serving traffic, traffic shifts to one of the other replicas\n4.  Search queue starts to get backed up from all the extra traffic\n5.  The NPE happens on other shards in the cluster thus multiple shards are initializing not serving traffic\n6.  The sockets from master -> overloaded data node are blocked and eat up all available sockets.\n7.  Eventually the master stops responding\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/51629825","html_url":"https://github.com/elastic/elasticsearch/issues/3621#issuecomment-51629825","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3621","id":51629825,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNjI5ODI1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-08-08T17:04:04Z","updated_at":"2014-08-08T17:04:04Z","author_association":"CONTRIBUTOR","body":"Closed in favour of #6444 \n","performed_via_github_app":null}]