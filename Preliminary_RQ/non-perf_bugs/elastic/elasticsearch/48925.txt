{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48925","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48925/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48925/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48925/events","html_url":"https://github.com/elastic/elasticsearch/issues/48925","id":520576815,"node_id":"MDU6SXNzdWU1MjA1NzY4MTU=","number":48925,"title":"`GET _cat/pending_tasks` will return some pending tasks that have been executed","user":{"login":"kkewwei","id":16730433,"node_id":"MDQ6VXNlcjE2NzMwNDMz","avatar_url":"https://avatars1.githubusercontent.com/u/16730433?v=4","gravatar_id":"","url":"https://api.github.com/users/kkewwei","html_url":"https://github.com/kkewwei","followers_url":"https://api.github.com/users/kkewwei/followers","following_url":"https://api.github.com/users/kkewwei/following{/other_user}","gists_url":"https://api.github.com/users/kkewwei/gists{/gist_id}","starred_url":"https://api.github.com/users/kkewwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kkewwei/subscriptions","organizations_url":"https://api.github.com/users/kkewwei/orgs","repos_url":"https://api.github.com/users/kkewwei/repos","events_url":"https://api.github.com/users/kkewwei/events{/privacy}","received_events_url":"https://api.github.com/users/kkewwei/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-11-10T09:35:43Z","updated_at":"2019-11-11T09:21:14Z","closed_at":"2019-11-11T09:21:14Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"ES_VERSION: 7.3.1\r\n**Description of the problem including expected versus actual behavior:**\r\nWe can get pending tasks from cluster by `GET _cat/pending_tasks`, it should return the tasks that status are pending or starting. Actually, it will return some pending tasks that have being executed.\r\n\r\nAs we know that master will receive the requests from data nodes that shards have been started, then it will update ClusterState about those shards. If there are some another `shard-started` tasks pending at the same time, master will batch  execute those `shard-started` tasks together, the `processed` status of `shard-started` tasks will been set `true`, but they are still exist in `PrioritizedEsThreadPoolExecutor.workQueue`, so if we get the pending tasks by `GET _cat/pending_tasks`, it will return the `shard-started` tasks that have been executed.\r\n\r\n**Solution:**\r\nIf we should filter those `shard-started` tasks whether they have been executed before return?\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}