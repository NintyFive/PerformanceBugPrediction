[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324306013","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-324306013","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":324306013,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDMwNjAxMw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-08-23T11:54:50Z","updated_at":"2017-08-23T11:54:50Z","author_association":"MEMBER","body":"I'm struggling to find a use case for `_primary` and `_replica`. Should we deprecate and remove them?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324402886","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-324402886","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":324402886,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDQwMjg4Ng==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2017-08-23T17:16:24Z","updated_at":"2017-08-23T17:16:24Z","author_association":"MEMBER","body":"If I recall correctly, `_replica` was originally added back in the day for shadow replicas (see: https://github.com/elastic/elasticsearch/pull/12244). Which have been removed, so +1 on removing `_replica` and `_replica_first`.\r\n\r\n`_primary` was useful back in the days of asynchronous replication, since your document may not have reached the replicas yet. We don't allow it any more though, so it's probably not strictly necessary.\r\n\r\n*However*, having `_primary` and `_replica` *can* be nice for debugging things, for instance, if you suspect that a copy of the data is somehow misbehaving, or you want to compare an analyzer on one node with a (perhaps misconfigured) analyzer on a second node, it can be very helpful to be able to use `_primary` and `_replica` to route the request to the desired node, so overall I'm probably +0.5 on keeping them.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324626240","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-324626240","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":324626240,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDYyNjI0MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-08-24T12:53:43Z","updated_at":"2017-08-24T12:53:43Z","author_association":"MEMBER","body":"@dakrone thanks for filling in the context and history. I should have done it in the first place.\r\n\r\n> However, having _primary and _replica can be nice for debugging things\r\n\r\nI think this use case is better served by the `_prefer_nodes` and `_only_nodes` options. It works for primaries (with some extra effort of figuring out where the primary is) and is actually needed for replicas when people run with >1 replicas.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324672580","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-324672580","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":324672580,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDY3MjU4MA==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2017-08-24T15:36:16Z","updated_at":"2017-08-24T15:36:16Z","author_association":"MEMBER","body":"> I think this use case is better served by the `_prefer_nodes` and `_only_nodes` options.\r\n\r\nThose work also, so +1 to removing the others if no one else objects. Perhaps the title of this issues should be changed to reflect the discussion?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329146893","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-329146893","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":329146893,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTE0Njg5Mw==","user":{"login":"liketic","id":3806117,"node_id":"MDQ6VXNlcjM4MDYxMTc=","avatar_url":"https://avatars0.githubusercontent.com/u/3806117?v=4","gravatar_id":"","url":"https://api.github.com/users/liketic","html_url":"https://github.com/liketic","followers_url":"https://api.github.com/users/liketic/followers","following_url":"https://api.github.com/users/liketic/following{/other_user}","gists_url":"https://api.github.com/users/liketic/gists{/gist_id}","starred_url":"https://api.github.com/users/liketic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liketic/subscriptions","organizations_url":"https://api.github.com/users/liketic/orgs","repos_url":"https://api.github.com/users/liketic/repos","events_url":"https://api.github.com/users/liketic/events{/privacy}","received_events_url":"https://api.github.com/users/liketic/received_events","type":"User","site_admin":false},"created_at":"2017-09-13T12:05:45Z","updated_at":"2017-09-13T12:05:45Z","author_association":"CONTRIBUTOR","body":"From what I understand, we only need to keep the two preference `_prefer_nodes` and `_only_nodes` and remove all others? Thanks!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329193877","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-329193877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":329193877,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTE5Mzg3Nw==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2017-09-13T14:54:16Z","updated_at":"2017-09-13T14:54:16Z","author_association":"MEMBER","body":"@liketic there are others that should still be kept, I believe the consensus was just to remove `_primary` and `_replica`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329195292","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-329195292","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":329195292,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTE5NTI5Mg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-09-13T14:58:43Z","updated_at":"2017-09-13T14:58:43Z","author_association":"MEMBER","body":"@dakrone Do we have a valid use case for `(_primary|_replica)_first`? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329196885","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-329196885","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":329196885,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTE5Njg4NQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2017-09-13T15:03:35Z","updated_at":"2017-09-13T15:03:35Z","author_association":"MEMBER","body":"@bleskes other than them being nicer than having to determine the nodes themselves? I'm not sure. The only thing I could think would be a very script-heavy update where you wanted to use `_replica` so that you avoided load on the primaries that were doing the fetch-run-script-and-update.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329197581","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-329197581","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":329197581,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTE5NzU4MQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-09-13T15:05:46Z","updated_at":"2017-09-13T15:05:46Z","author_association":"MEMBER","body":"> @bleskes other than them being nicer than having to determine the nodes themselves? \r\n\r\nThe question is why would you like to do that?  I would op to remove those. It just confuses people to think that primaries are special (and we should remove cases where they are..)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329201369","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-329201369","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":329201369,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTIwMTM2OQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2017-09-13T15:17:44Z","updated_at":"2017-09-13T15:17:44Z","author_association":"MEMBER","body":"> The question is why would you like to do that? \r\n\r\nThat (the update scenario) was the only scenario I could think of\r\n\r\n> I would op to remove those.\r\n\r\nSure, if you think the scenario I mentioned isn't valid\r\n\r\n> It just confuses people to think that primaries are special (and we should remove cases where they are..)\r\n\r\nI'm not sure if we're going to be able to move away from update scripts running on the primary shard? At least definitely not on the short term","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329354255","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-329354255","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":329354255,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTM1NDI1NQ==","user":{"login":"liketic","id":3806117,"node_id":"MDQ6VXNlcjM4MDYxMTc=","avatar_url":"https://avatars0.githubusercontent.com/u/3806117?v=4","gravatar_id":"","url":"https://api.github.com/users/liketic","html_url":"https://github.com/liketic","followers_url":"https://api.github.com/users/liketic/followers","following_url":"https://api.github.com/users/liketic/following{/other_user}","gists_url":"https://api.github.com/users/liketic/gists{/gist_id}","starred_url":"https://api.github.com/users/liketic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liketic/subscriptions","organizations_url":"https://api.github.com/users/liketic/orgs","repos_url":"https://api.github.com/users/liketic/repos","events_url":"https://api.github.com/users/liketic/events{/privacy}","received_events_url":"https://api.github.com/users/liketic/received_events","type":"User","site_admin":false},"created_at":"2017-09-14T02:49:44Z","updated_at":"2017-09-14T02:49:44Z","author_association":"CONTRIBUTOR","body":"So it's OK to remove `_primary` and `_replica` now? Thanks. ðŸ˜„ ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/329371098","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-329371098","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":329371098,"node_id":"MDEyOklzc3VlQ29tbWVudDMyOTM3MTA5OA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-09-14T04:52:26Z","updated_at":"2017-09-14T04:52:26Z","author_association":"MEMBER","body":"@dakrone OK. I'll add a discuss label to this so it will be picked up in fix it friday and we make a final decision. I tend to say remove them all (we can fix the update issue by making it read from any replica, but I agree that's not happening soon)\r\n\r\n@liketic can you hold off for a few days? I appreciate the willing to contribute.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/331927896","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-331927896","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":331927896,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMTkyNzg5Ng==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T15:59:07Z","updated_at":"2017-09-25T15:59:07Z","author_association":"MEMBER","body":"@jasontedor, I just want to make sure that I understand the requirement correctly. We will deprecate the preference \"_primary*\" and \"_replica*\" in 6.x and remove them in 7.x. Thank you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/331953971","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-331953971","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":331953971,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMTk1Mzk3MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-09-25T17:30:29Z","updated_at":"2017-09-25T17:30:29Z","author_association":"MEMBER","body":"@dnhatn Yes.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/332048546","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-332048546","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":332048546,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjA0ODU0Ng==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2017-09-26T00:11:17Z","updated_at":"2017-09-26T00:11:17Z","author_association":"MEMBER","body":"@jasontedor I am not sure if the recommendation to use `preference=_primary` for `read-then-update` is still valid. We document it at [https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-versioning](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html#index-versioning)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/332070641","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-332070641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":332070641,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjA3MDY0MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-09-26T02:47:37Z","updated_at":"2017-09-26T02:47:37Z","author_association":"MEMBER","body":"@dnhatn Not reading from the primary is okay in the case of optimistic concurrency control; if the read is from a stale value, the dependent write will be rejected anyway and the read will simply have to be retried. This is okay for a workflow using optimistic concurrency control. Therefore, I think we can simply remove this recommendation from the documentation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363567264","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-363567264","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":363567264,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzU2NzI2NA==","user":{"login":"aewhite","id":4342706,"node_id":"MDQ6VXNlcjQzNDI3MDY=","avatar_url":"https://avatars1.githubusercontent.com/u/4342706?v=4","gravatar_id":"","url":"https://api.github.com/users/aewhite","html_url":"https://github.com/aewhite","followers_url":"https://api.github.com/users/aewhite/followers","following_url":"https://api.github.com/users/aewhite/following{/other_user}","gists_url":"https://api.github.com/users/aewhite/gists{/gist_id}","starred_url":"https://api.github.com/users/aewhite/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aewhite/subscriptions","organizations_url":"https://api.github.com/users/aewhite/orgs","repos_url":"https://api.github.com/users/aewhite/repos","events_url":"https://api.github.com/users/aewhite/events{/privacy}","received_events_url":"https://api.github.com/users/aewhite/received_events","type":"User","site_admin":false},"created_at":"2018-02-06T21:16:59Z","updated_at":"2018-02-06T21:21:08Z","author_association":"NONE","body":"Sorry, late to the conversation on this but we use `_primary` as a cache hitting optimization. Unless something has changed, ES can hit non-primary shards to answer search requests. By preferring primaries only then filter caches:\r\n\r\n* Warm up faster\r\n* Have a higher cache hit rate \r\n* Are more \"dense\" (ie, a node only has to maintain primary caches)\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363705323","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-363705323","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":363705323,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzcwNTMyMw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-02-07T09:15:27Z","updated_at":"2018-02-07T09:15:27Z","author_association":"MEMBER","body":"@aewhite you can better use a random string which will stick to a random copy (see https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-preference.html ). ES assumes primaries do just as much work as replicas when balancing the cluster. As noted about the `_primary` preference is dangerous. Anything that sticks to the primary may cause hot spots. I presume you have enough resources since you don't rely on your replicas at all, but still. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384851603","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-384851603","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":384851603,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDg1MTYwMw==","user":{"login":"paullovessearch","id":1406946,"node_id":"MDQ6VXNlcjE0MDY5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/1406946?v=4","gravatar_id":"","url":"https://api.github.com/users/paullovessearch","html_url":"https://github.com/paullovessearch","followers_url":"https://api.github.com/users/paullovessearch/followers","following_url":"https://api.github.com/users/paullovessearch/following{/other_user}","gists_url":"https://api.github.com/users/paullovessearch/gists{/gist_id}","starred_url":"https://api.github.com/users/paullovessearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paullovessearch/subscriptions","organizations_url":"https://api.github.com/users/paullovessearch/orgs","repos_url":"https://api.github.com/users/paullovessearch/repos","events_url":"https://api.github.com/users/paullovessearch/events{/privacy}","received_events_url":"https://api.github.com/users/paullovessearch/received_events","type":"User","site_admin":false},"created_at":"2018-04-27T03:15:08Z","updated_at":"2018-04-27T03:16:09Z","author_association":"NONE","body":"I too am frustrated that this is being removed. We have lots of situations with very large indexes and very low query volume. When only one query is likely to be executing at a time, it is preferred to use the primary shards so that the index files can be cached into OS disk cache. Having the queries go back and forth between primary and replica simply means doubling the amount of RAM required for the same performance. The \"random string\" doesn't help at all for this use case and I'm not even sure why it was mentioned. We have low query volume (like, 1 QPS) so hot spots are not an issue. And we want the system to automatically fail over to the replica when the primary machine goes down and suffer some degraded performance until the machine is restored.\r\n\r\nLarge index + low query volume is quite a common use case in our world, and it seems that you're forcing us to double our OS disk cache RAM requirement. Do you have recommendations for reducing hardware cost for this scenario?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384884891","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-384884891","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":384884891,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDg4NDg5MQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-04-27T07:07:56Z","updated_at":"2018-04-27T07:07:56Z","author_association":"CONTRIBUTOR","body":"> ... it is preferred to use the primary shards so that the index files can be cached into OS disk cache\r\n\r\nIt makes sense that you want to route repeated queries to the same set of shard copies each time to make best use of disk cache, but there's no need for those copies to be primaries.\r\n\r\n> Having the queries go back and forth between primary and replica simply means doubling the amount of RAM required for the same performance.\r\n\r\nI think you're misunderstanding what happens when using `GET /_search?preference=xyzabc123`. The query is routed to one copy of each shard, which may or may not be the primary, but there's no communication between primary and replica. In the steady state, the copy chosen is a pure function of the `xyzabc123` string, so repeated queries will hit the same copy each time.\r\n\r\nIndeed, the random string should give you more even node usage than `_primary` after a node restart, because the restarted node will hold no primaries, possibly for a long time, but the \"random string\" preference will start to make use of the new node right away.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385414147","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-385414147","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":385414147,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTQxNDE0Nw==","user":{"login":"paullovessearch","id":1406946,"node_id":"MDQ6VXNlcjE0MDY5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/1406946?v=4","gravatar_id":"","url":"https://api.github.com/users/paullovessearch","html_url":"https://github.com/paullovessearch","followers_url":"https://api.github.com/users/paullovessearch/followers","following_url":"https://api.github.com/users/paullovessearch/following{/other_user}","gists_url":"https://api.github.com/users/paullovessearch/gists{/gist_id}","starred_url":"https://api.github.com/users/paullovessearch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paullovessearch/subscriptions","organizations_url":"https://api.github.com/users/paullovessearch/orgs","repos_url":"https://api.github.com/users/paullovessearch/repos","events_url":"https://api.github.com/users/paullovessearch/events{/privacy}","received_events_url":"https://api.github.com/users/paullovessearch/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T14:26:16Z","updated_at":"2018-04-30T14:26:16Z","author_association":"NONE","body":"I see. So you're saying to use the same preference value for _all_ queries, and not a random unique one for every query. Okay - so that makes sense.\r\n\r\nAnd I presume that if the normal shard targeted by preference=X goes down, then the replica will be used? If so, then I completely agree that this is a fine solution. Thanks!\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385727867","html_url":"https://github.com/elastic/elasticsearch/issues/26335#issuecomment-385727867","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26335","id":385727867,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTcyNzg2Nw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-05-01T17:13:23Z","updated_at":"2018-05-01T17:13:23Z","author_association":"CONTRIBUTOR","body":"> I presume that if the normal shard targeted by preference=X goes down, then the replica will be used?\r\n\r\nYes. `?preference=X` really chooses a preferred order of all the available shard copies to try in a search, and so will fail-over sensibly if a node goes down.","performed_via_github_app":null}]