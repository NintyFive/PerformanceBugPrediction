[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278332961","html_url":"https://github.com/elastic/elasticsearch/issues/22989#issuecomment-278332961","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","id":278332961,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODMzMjk2MQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-02-08T13:47:29Z","updated_at":"2017-02-08T13:47:29Z","author_association":"CONTRIBUTOR","body":"Good catch, the behaviour did indeed change as we are now only applying the character-level filters of the analysis chain (like ascii folding or lowercasing), which means we ignore the tokenizer and some filters like synonyms or stemming filters.\r\n\r\nFor most users this should be transparent and might even fix queries that did not work before. However in that case, this causes the punctuation characters to remain in `*brö\\\\{\\\\\\\\\\\\\\\"\\\\/\\\\)*`, which means it cannot match anything since your analyzer discards punctuation.\r\n\r\nI am unclear how `name.search:*brö\\\\{\\\\\\\\\\\\\\\"\\\\/\\\\)*` should be parsed so I am tempted to just document this as a possible breaking change. I'll leave this issue open with the `discuss` label to see what others think.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278382677","html_url":"https://github.com/elastic/elasticsearch/issues/22989#issuecomment-278382677","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","id":278382677,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODM4MjY3Nw==","user":{"login":"mweibel","id":307427,"node_id":"MDQ6VXNlcjMwNzQyNw==","avatar_url":"https://avatars1.githubusercontent.com/u/307427?v=4","gravatar_id":"","url":"https://api.github.com/users/mweibel","html_url":"https://github.com/mweibel","followers_url":"https://api.github.com/users/mweibel/followers","following_url":"https://api.github.com/users/mweibel/following{/other_user}","gists_url":"https://api.github.com/users/mweibel/gists{/gist_id}","starred_url":"https://api.github.com/users/mweibel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mweibel/subscriptions","organizations_url":"https://api.github.com/users/mweibel/orgs","repos_url":"https://api.github.com/users/mweibel/repos","events_url":"https://api.github.com/users/mweibel/events{/privacy}","received_events_url":"https://api.github.com/users/mweibel/received_events","type":"User","site_admin":false},"created_at":"2017-02-08T16:39:53Z","updated_at":"2017-02-08T16:39:53Z","author_association":"NONE","body":"@jpountz thanks for your reply and confirmation :) I'd also vote for documenting this just as a breaking change. Am I correct in the assumption the new but experimental `normalizer` feature could be used as an alternative? (besides ensuring only _valid_ characters get passed to the search string)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278405120","html_url":"https://github.com/elastic/elasticsearch/issues/22989#issuecomment-278405120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","id":278405120,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODQwNTEyMA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-02-08T17:45:28Z","updated_at":"2017-02-08T17:45:28Z","author_association":"CONTRIBUTOR","body":"Actually the `normalizer` feature works on top of this normalization which has originally been designed to make query parsing \"do the right thing\" when it comes to analyzing partial terms for prefix, wildcard or fuzzy queries.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278610367","html_url":"https://github.com/elastic/elasticsearch/issues/22989#issuecomment-278610367","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","id":278610367,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODYxMDM2Nw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-02-09T10:59:12Z","updated_at":"2017-02-09T10:59:12Z","author_association":"MEMBER","body":"> I am unclear how name.search:*brö\\\\{\\\\\\\\\\\\\\\"\\\\/\\\\)* should be parsed so I am tempted to just document this as a possible breaking change. I'll leave this issue open with the discuss label to see what others think.\r\n\r\nI think the situation is not ideal because the punctuation is removed by the tokenizer even though it could be considered as a `normalization` phase. The alternative could be to add a `char_filter` that removes the punctuation but it could break the tokenization... \r\nJust an idea but now that we have a `normalizer` type we could maybe allow to define a `normalizer` AND an `analyzer` for text fields only ? \r\nIt makes sense to restrict `analyze_wildcard` to single leading and trailing wildcard only. Today it is \"correctly\" applied on `prefix` query but not on `suffix` query. IMO for complex `wildcard` query we should document that this setting is not honored. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/280649558","html_url":"https://github.com/elastic/elasticsearch/issues/22989#issuecomment-280649558","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","id":280649558,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDY0OTU1OA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-02-17T13:30:17Z","updated_at":"2017-02-17T13:30:17Z","author_association":"CONTRIBUTOR","body":"We agreed in FixitFriday on documenting this behaviour and potentially adapt based on feedback when we get some.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375111624","html_url":"https://github.com/elastic/elasticsearch/issues/22989#issuecomment-375111624","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","id":375111624,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTExMTYyNA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T22:06:14Z","updated_at":"2018-03-21T22:06:14Z","author_association":"CONTRIBUTOR","body":"cc @elastic/es-search-aggs\r\n\r\nStill need to document better the details of working of  `analyze_wildcard`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438572835","html_url":"https://github.com/elastic/elasticsearch/issues/22989#issuecomment-438572835","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","id":438572835,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODU3MjgzNQ==","user":{"login":"xtrembaker","id":1638252,"node_id":"MDQ6VXNlcjE2MzgyNTI=","avatar_url":"https://avatars2.githubusercontent.com/u/1638252?v=4","gravatar_id":"","url":"https://api.github.com/users/xtrembaker","html_url":"https://github.com/xtrembaker","followers_url":"https://api.github.com/users/xtrembaker/followers","following_url":"https://api.github.com/users/xtrembaker/following{/other_user}","gists_url":"https://api.github.com/users/xtrembaker/gists{/gist_id}","starred_url":"https://api.github.com/users/xtrembaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xtrembaker/subscriptions","organizations_url":"https://api.github.com/users/xtrembaker/orgs","repos_url":"https://api.github.com/users/xtrembaker/repos","events_url":"https://api.github.com/users/xtrembaker/events{/privacy}","received_events_url":"https://api.github.com/users/xtrembaker/received_events","type":"User","site_admin":false},"created_at":"2018-11-14T08:05:30Z","updated_at":"2018-11-14T08:12:42Z","author_association":"NONE","body":"Hello all !\r\n\r\nI'm currently using ElasticSearch v6.2.3, and I encountered similar problem.\r\n\r\nI got this mapping on my index:\r\n```\r\n{\r\n    \"settings\": {\r\n        \"analysis\": {\r\n            \"normalizer\": {\r\n                \"lowercaseasciifolding\": {\r\n                    \"type\": \"custom\",\r\n                    \"char_filter\": [],\r\n                    \"filter\": [\r\n                        \"lowercase\",\r\n                        \"asciifolding\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"mappings\": {\r\n        \"doc\": {\r\n            \"dynamic\": false,\r\n            \"properties\": {\r\n                \"uuid\": {\r\n                    \"type\": \"text\",\r\n                    \"index\": false\r\n                },\r\n                \"id\": {\r\n                    \"type\": \"long\",\r\n                    \"index\": false\r\n                },\r\n                \"account_id\": {\r\n                    \"type\": \"integer\",\r\n                    \"index\": true\r\n                },\r\n                \"budgea_category_id\": {\r\n                    \"type\": \"integer\",\r\n                    \"index\": false\r\n                },\r\n                \"budgea_id\": {\r\n                    \"type\": \"text\",\r\n                    \"index\": false\r\n                },\r\n                \"category_id\": {\r\n                    \"type\": \"integer\",\r\n                    \"index\": true\r\n                },\r\n                \"date\": {\r\n                    \"type\": \"date\",\r\n                    \"index\": true\r\n                },\r\n                \"rdate\": {\r\n                    \"type\": \"date\",\r\n                    \"index\": true\r\n                },\r\n                \"deleted_at\": {\r\n                    \"type\": \"date\",\r\n                    \"index\": false\r\n                },\r\n                \"updated_at\": {\r\n                    \"type\": \"date\",\r\n                    \"index\": false\r\n                },\r\n                \"created_at\": {\r\n                    \"type\": \"date\",\r\n                    \"index\": false\r\n                },\r\n                \"value\": {\r\n                    \"type\": \"float\",\r\n                    \"index\": false\r\n                },\r\n                \"type\": {\r\n                    \"type\": \"text\",\r\n                    \"index\": false\r\n                },\r\n                \"original_wording\": {\r\n                    \"type\": \"text\",\r\n                    \"index\": false\r\n                },\r\n                \"stemmed_wording\": {\r\n                    \"type\": \"text\",\r\n                    \"index\": false\r\n                },\r\n                \"wording\": {\r\n                    \"type\": \"text\",\r\n                    \"fields\": {\r\n                        \"sort\": {\r\n                            \"type\": \"keyword\",\r\n                            \"normalizer\": \"lowercaseasciifolding\"\r\n                        },\r\n                        \"matching\": {\r\n                            \"type\": \"text\",\r\n                            \"analyzer\": \"french\"\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nWhen running the following query, it **does** match \r\n```\r\n{  \r\n   \"explain\":false,\r\n   \"from\":0,\r\n   \"size\":100,\r\n   \"query\":{  \r\n      \"bool\":{  \r\n         \"filter\":[  \r\n            {  \r\n               \"term\":{  \r\n                  \"account_id\":\"2590000\"\r\n               }\r\n            },\r\n            {  \r\n               \"range\":{  \r\n                  \"rdate\":[  \r\n                     {  \r\n                        \"gte\":\"2018-05-13\"\r\n                     }\r\n                  ]\r\n               }\r\n            }\r\n         ],\r\n         \"must\":[  \r\n            {  \r\n               \"query_string\":{  \r\n                  \"default_field\":\"wording\",\r\n                  \"query\":\"Itunes.Com\\\\/bill\",\r\n                  \"analyze_wildcard\":\"true\"\r\n               }\r\n            }\r\n         ]\r\n      }\r\n   },\r\n   \"sort\":[  \r\n      {  \r\n         \"rdate\":{  \r\n            \"order\":\"desc\"\r\n         }\r\n      },\r\n      \"_doc\"\r\n   ]\r\n}\r\n\r\n```\r\n\r\nBut with this other query, ES **doesn't** match any result (notice the * around the query):\r\n```\r\n{  \r\n   \"explain\":false,\r\n   \"from\":0,\r\n   \"size\":100,\r\n   \"query\":{  \r\n      \"bool\":{  \r\n         \"filter\":[  \r\n            {  \r\n               \"term\":{  \r\n                  \"account_id\":\"2590000\"\r\n               }\r\n            },\r\n            {  \r\n               \"range\":{  \r\n                  \"rdate\":[  \r\n                     {  \r\n                        \"gte\":\"2018-05-13\"\r\n                     }\r\n                  ]\r\n               }\r\n            }\r\n         ],\r\n         \"must\":[  \r\n            {  \r\n               \"query_string\":{  \r\n                  \"default_field\":\"wording\",\r\n                  \"query\":\"*Itunes.Com\\\\/bill*\",\r\n                  \"analyze_wildcard\":\"true\"\r\n               }\r\n            }\r\n         ]\r\n      }\r\n   },\r\n   \"sort\":[  \r\n      {  \r\n         \"rdate\":{  \r\n            \"order\":\"desc\"\r\n         }\r\n      },\r\n      \"_doc\"\r\n   ]\r\n}\r\n```\r\n\r\nCan anyone help me ? Is there a workaround to make this work ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/496183085","html_url":"https://github.com/elastic/elasticsearch/issues/22989#issuecomment-496183085","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","id":496183085,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NjE4MzA4NQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-05-27T11:39:19Z","updated_at":"2019-05-27T11:39:19Z","author_association":"MEMBER","body":"Closing as duplicate of https://github.com/elastic/elasticsearch/issues/25940","performed_via_github_app":null}]