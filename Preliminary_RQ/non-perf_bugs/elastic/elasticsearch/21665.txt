{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21665","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21665/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21665/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21665/events","html_url":"https://github.com/elastic/elasticsearch/issues/21665","id":190351017,"node_id":"MDU6SXNzdWUxOTAzNTEwMTc=","number":21665,"title":"Error when running \"multi_match\" on double field with scientific notation and analyzer","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":334286612,"node_id":"MDU6TGFiZWwzMzQyODY2MTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.0-alpha1","name":"v6.0.0-alpha1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-11-18T15:46:18Z","updated_at":"2018-02-14T13:32:08Z","closed_at":"2017-04-12T08:47:44Z","author_association":"MEMBER","active_lock_reason":null,"body":"This strange combination of three parameters just came in via CI:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.x+multijob-unix-compatibility/os=debian/252/console\r\n\r\nThe query that trips this looks like this (simplified):\r\n```\r\n\"multi_match\" : {\r\n    \"query\" : 6.075210893508043E-4,\r\n    \"fields\" : [\r\n      \"mapped_double^1.0\"\r\n    ],    \r\n    \"analyzer\" : \"simple\"\r\n  }\r\n```\r\n\r\nSo although this is a double field, the value gets analyzed in lucenes QueryBuilder#analyzeTerm which leaves only the String \"e\" which in turn cannot be parsed to a double. This later leads to a NumberFormatException:\r\n\r\n```\r\njava.lang.NumberFormatException: For input string: \"e\"\r\n\tat __randomizedtesting.SeedInfo.seed([8BA49CFAC7249C2F:7C5F9EC4B6A759C5]:0)\r\n\tat sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:2043)\r\n\tat sun.misc.FloatingDecimal.parseDouble(FloatingDecimal.java:110)\r\n\tat java.lang.Double.parseDouble(Double.java:538)\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$3.parse(NumberFieldMapper.java:350)\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberType$3.termQuery(NumberFieldMapper.java:360)\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberFieldType.termQuery(NumberFieldMapper.java:801)\r\n\tat org.elasticsearch.index.search.MatchQuery.termQuery(MatchQuery.java:273)\r\n\tat org.elasticsearch.index.search.MatchQuery.blendTermQuery(MatchQuery.java:385)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery.blendTermQuery(MultiMatchQuery.java:316)\r\n\tat org.elasticsearch.index.search.MatchQuery$MatchQueryBuilder.newTermQuery(MatchQuery.java:303)\r\n\tat org.apache.lucene.util.QueryBuilder.analyzeTerm(QueryBuilder.java:277)\r\n\tat org.apache.lucene.util.QueryBuilder.createFieldQuery(QueryBuilder.java:241)\r\n\tat org.apache.lucene.util.QueryBuilder.createBooleanQuery(QueryBuilder.java:88)\r\n\tat org.elasticsearch.index.search.MatchQuery.parse(MatchQuery.java:249)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery.parseAndApply(MultiMatchQuery.java:63)\r\n\tat org.elasticsearch.index.search.MultiMatchQuery.parse(MultiMatchQuery.java:81)\r\n\tat org.elasticsearch.index.query.MultiMatchQueryBuilder.doToQuery(MultiMatchQueryBuilder.java:748)\r\n\tat org.elasticsearch.index.query.AbstractQueryBuilder.toQuery(AbstractQueryBuilder.java:97)\r\n\tat org.elasticsearch.index.query.MultiMatchQueryBuilderTests.testAnalyzerOnDoubleField(MultiMatchQueryBuilderTests.java:313)\r\n```\r\n\r\nI wonder where we should catch this. Should we always throw an error when specifying an analyzer together with a numeric field in the query builder already? I think that would make sense. ","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}