[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/523888145","html_url":"https://github.com/elastic/elasticsearch/issues/45834#issuecomment-523888145","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45834","id":523888145,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMzg4ODE0NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-22T12:40:19Z","updated_at":"2019-08-22T12:40:19Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/523935257","html_url":"https://github.com/elastic/elasticsearch/issues/45834#issuecomment-523935257","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45834","id":523935257,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMzkzNTI1Nw==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-08-22T14:40:01Z","updated_at":"2019-08-22T16:10:39Z","author_association":"MEMBER","body":">  missing Insufficient memory message\r\n\r\nYeah, that should be added back for sure.\r\n\r\n> frequency of messages\r\n\r\nI will have to double check, I am not sure there is context around when a retry has occurred. I *THINK* it is handled like any periodic failure and we just retry again on the next trigger without knowing the full context of what the specific previous failure was. When auditing failures, we do a message comparison, if it is the EXACT same message as previously audited (when handling a failure), we don't audit it again. This is to hopefully reduce a flood of failures when the user has their trigger frequency set very high.\r\n\r\n> Failed transform\r\n\r\nThe failure to persist message is pretty important, but we should probably include WHAT it failed to persist. If it failed to persist a FAILURE, that means that if the transform crashes and restarts, it will not be seen as FAILED. \r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/523953148","html_url":"https://github.com/elastic/elasticsearch/issues/45834#issuecomment-523953148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45834","id":523953148,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMzk1MzE0OA==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-08-22T15:22:57Z","updated_at":"2019-08-22T15:22:57Z","author_association":"MEMBER","body":"@sophiec20 Are you 100% sure that the message `Insufficient memory for search,...` is not audited. Here is the code that is in `master` (not changed for a while I think)\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/master/x-pack/plugin/data-frame/src/main/java/org/elasticsearch/xpack/dataframe/transforms/DataFrameIndexer.java#L478..L481\r\n\r\n```\r\n       String message = DataFrameMessages.getMessage(DataFrameMessages.LOG_DATA_FRAME_TRANSFORM_PIVOT_REDUCE_PAGE_SIZE, pageSize,\r\n                newPageSize);\r\n        auditor.info(getJobId(), message);\r\n        logger.info(\"Data frame transform [\" + getJobId() + \"]:\" + message);\r\n```\r\n\r\nIt is definitely being written to the audit. If it is not showing up at all, there may be another problem.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/523968429","html_url":"https://github.com/elastic/elasticsearch/issues/45834#issuecomment-523968429","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45834","id":523968429,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMzk2ODQyOQ==","user":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"created_at":"2019-08-22T16:00:41Z","updated_at":"2019-08-22T16:00:41Z","author_association":"NONE","body":"I searched for it in the notifications index. It appears that it is being written for batch but not continuous. :lightbulb:\r\n \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/523972368","html_url":"https://github.com/elastic/elasticsearch/issues/45834#issuecomment-523972368","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45834","id":523972368,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMzk3MjM2OA==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-08-22T16:10:50Z","updated_at":"2019-08-22T16:10:50Z","author_association":"MEMBER","body":"ðŸ˜– ðŸ˜• ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/524039677","html_url":"https://github.com/elastic/elasticsearch/issues/45834#issuecomment-524039677","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45834","id":524039677,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNDAzOTY3Nw==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-08-22T19:17:14Z","updated_at":"2019-08-22T19:23:01Z","author_association":"MEMBER","body":"> I searched for it in the notifications index. It appears that it is being written for batch but not continuous.\r\n\r\n@sophiec20 looking at the job definitions you are using, and the logs, there seems to have been only one continuous job where this was the case (where it reduced page size, logged it, but did not audit it). I turned on debug logging for our auditing system so that we can see when writing an audit message fails. I think that this was just an intermittent failure, and not a bug in the program. \r\n\r\nI propose the following updates for now:\r\n\r\n* All failures that are later retried, we state as much in the message (that we will try again later)\r\n* When we fail to write to the cluster state, we give better messaging (i.e. what the state and reason were at the time of attempting to update).\r\n* Adding better messaging with `Failed to retrieve|create checkpoint` messages. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/524252106","html_url":"https://github.com/elastic/elasticsearch/issues/45834#issuecomment-524252106","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45834","id":524252106,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNDI1MjEwNg==","user":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"created_at":"2019-08-23T09:50:53Z","updated_at":"2019-08-23T09:50:53Z","author_association":"NONE","body":"After another night of continuous running, there are a couple of \"Insufficient memory\" messages - so must have been intermittent as you diagnosed.\r\n\r\nYour proposals SGTM.\r\n","performed_via_github_app":null}]