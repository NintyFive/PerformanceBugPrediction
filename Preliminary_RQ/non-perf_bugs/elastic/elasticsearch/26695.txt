{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26695","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26695/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26695/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26695/events","html_url":"https://github.com/elastic/elasticsearch/issues/26695","id":258508675,"node_id":"MDU6SXNzdWUyNTg1MDg2NzU=","number":26695,"title":"[CI] Interesting refresh errors ","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"labels":[{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2017-09-18T14:51:27Z","updated_at":"2017-09-18T17:55:26Z","closed_at":"2017-09-18T17:26:30Z","author_association":"MEMBER","active_lock_reason":null,"body":"The test in question (`ParentChildClientYamlTestSuiteIT#{yaml=/20_parent_join/Test parent_id query}`) seems to be unrelated to the refresh error that occurred:\r\n\r\n```\r\n 1> [2017-09-18T08:18:19,728][INFO ][o.e.j.ParentChildClientYamlTestSuiteIT] Stash dump on failure [{\r\n  1>   \"stash\" : {\r\n  1>     \"body\" : {\r\n  1>       \"_shards\" : {\r\n  1>         \"total\" : 10,\r\n  1>         \"successful\" : 4,\r\n  1>         \"failed\" : 2,\r\n  1>         \"failures\" : [\r\n  1>           {\r\n  1>             \"shard\" : 2,\r\n  1>             \"index\" : \"test\",\r\n  1>             \"status\" : \"INTERNAL_SERVER_ERROR\",\r\n  1>             \"reason\" : {\r\n  1>               \"type\" : \"refresh_failed_engine_exception\",\r\n  1>               \"reason\" : \"Refresh failed\",\r\n  1>               \"index_uuid\" : \"Bnhv8wlQQHK9VBRkcCjM1w\",\r\n  1>               \"shard\" : \"2\",\r\n  1>               \"index\" : \"test\",\r\n  1>               \"caused_by\" : {\r\n  1>                 \"type\" : \"null_pointer_exception\",\r\n  1>                 \"reason\" : null\r\n  1>               }\r\n  1>             }\r\n  1>           }\r\n  1>         ]\r\n  1>       }\r\n  1>     }\r\n  1>   }\r\n  1> }]\r\nFAILURE 1.59s | ParentChildClientYamlTestSuiteIT.test {yaml=/20_parent_join/Test parent_id query} <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: Failure at [/20_parent_join:57]: expected [2xx] status code but api [indices.refresh] returned [500 Internal Server Error] [{\"_shards\":{\"total\":10,\"successful\":4,\"failed\":2,\"failures\":[{\"shard\":2,\"index\":\"test\",\"status\":\"INTERNAL_SERVER_ERROR\",\"reason\":{\"type\":\"refresh_failed_engine_exception\",\"reason\":\"Refresh failed\",\"index_uuid\":\"Bnhv8wlQQHK9VBRkcCjM1w\",\"shard\":\"2\",\"index\":\"test\",\"caused_by\":{\"type\":\"null_pointer_exception\",\"reason\":null}}}]}}]\r\n   > \tat __randomizedtesting.SeedInfo.seed([B44C6C8C3359D807:3C1853569DA5B5FF]:0)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:352)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:323)\r\n   > \tat java.lang.Thread.run(Thread.java:745)\r\n   > Caused by: java.lang.AssertionError: expected [2xx] status code but api [indices.refresh] returned [500 Internal Server Error] [{\"_shards\":{\"total\":10,\"successful\":4,\"failed\":2,\"failures\":[{\"shard\":2,\"index\":\"test\",\"status\":\"INTERNAL_SERVER_ERROR\",\"reason\":{\"type\":\"refresh_failed_engine_exception\",\"reason\":\"Refresh failed\",\"index_uuid\":\"Bnhv8wlQQHK9VBRkcCjM1w\",\"shard\":\"2\",\"index\":\"test\",\"caused_by\":{\"type\":\"null_pointer_exception\",\"reason\":null}}}]}}]\r\n   > \tat org.elasticsearch.test.rest.yaml.section.DoSection.execute(DoSection.java:238)\r\n   > \tat org.elasti\r\n```\r\n\r\nActual NPE on the server side:\r\n\r\n```\r\n[2017-09-18T12:18:19,590][WARN ][o.e.i.e.Engine           ] [node-0] [test][2] failed engine [refresh failed]\r\njava.lang.NullPointerException: null\r\n\tat org.apache.lucene.codecs.lucene70.Lucene70DocValuesProducer.<init>(Lucene70DocValuesProducer.java:111) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.codecs.lucene70.Lucene70DocValuesFormat.fieldsProducer(Lucene70DocValuesFormat.java:132) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.codecs.perfield.PerFieldDocValuesFormat$FieldsReader.<init>(PerFieldDocValuesFormat.java:292) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.codecs.perfield.PerFieldDocValuesFormat.fieldsProducer(PerFieldDocValuesFormat.java:375) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.SegmentDocValues.newDocValuesProducer(SegmentDocValues.java:51) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.SegmentDocValues.getDocValuesProducer(SegmentDocValues.java:67) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.SegmentReader.initDocValuesProducer(SegmentReader.java:175) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.SegmentReader.<init>(SegmentReader.java:94) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.ReadersAndUpdates.getReader(ReadersAndUpdates.java:208) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.ReadersAndUpdates.getReadOnlyClone(ReadersAndUpdates.java:258) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.StandardDirectoryReader.open(StandardDirectoryReader.java:105) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:490) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.StandardDirectoryReader.doOpenFromWriter(StandardDirectoryReader.java:293) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.StandardDirectoryReader.doOpenIfChanged(StandardDirectoryReader.java:268) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.StandardDirectoryReader.doOpenIfChanged(StandardDirectoryReader.java:258) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.FilterDirectoryReader.doOpenIfChanged(FilterDirectoryReader.java:104) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.index.DirectoryReader.openIfChanged(DirectoryReader.java:140) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.search.SearcherManager.refreshIfNeeded(SearcherManager.java:156) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.search.SearcherManager.refreshIfNeeded(SearcherManager.java:58) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.search.ReferenceManager.doMaybeRefresh(ReferenceManager.java:176) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.apache.lucene.search.ReferenceManager.maybeRefreshBlocking(ReferenceManager.java:253) ~[lucene-core-7.0.0-snapshot-d94a5f0.jar:7.0.0-snapshot-d94a5f0 d94a5f00f08c1d0552320d3a87daeec9fab29c2f - jpountz - 2017-08-30 13:24:04]\r\n\tat org.elasticsearch.index.engine.InternalEngine.refresh(InternalEngine.java:1189) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.refresh(IndexShard.java:830) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.admin.indices.refresh.TransportShardRefreshAction.shardOperationOnPrimary(TransportShardRefreshAction.java:58) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.admin.indices.refresh.TransportShardRefreshAction.shardOperationOnPrimary(TransportShardRefreshAction.java:38) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:999) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:977) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:104) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.onResponse(TransportReplicationAction.java:340) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.onResponse(TransportReplicationAction.java:280) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$1.onResponse(TransportReplicationAction.java:940) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$1.onResponse(TransportReplicationAction.java:937) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:238) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationPermit(IndexShard.java:2120) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.acquirePrimaryShardReference(TransportReplicationAction.java:949) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.access$500(TransportReplicationAction.java:95) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.doRun(TransportReplicationAction.java:301) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:276) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:263) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:649) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.0.0-rc1-SNAPSHOT.jar:6.0.0-rc1-SNAPSHOT]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_111]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_111]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_111]\r\n```\r\n\r\nBuild url: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.0+periodic/31/\r\n\r\n\r\n[Console.txt](https://github.com/elastic/elasticsearch/files/1311064/Console.txt)\r\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}