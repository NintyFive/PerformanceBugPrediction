{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11526","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11526/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11526/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11526/events","html_url":"https://github.com/elastic/elasticsearch/issues/11526","id":85782793,"node_id":"MDU6SXNzdWU4NTc4Mjc5Mw==","number":11526,"title":"JVM running elasticsearhc gets stuck in GC loop on Haswell nodes","user":{"login":"smorovic","id":5859622,"node_id":"MDQ6VXNlcjU4NTk2MjI=","avatar_url":"https://avatars0.githubusercontent.com/u/5859622?v=4","gravatar_id":"","url":"https://api.github.com/users/smorovic","html_url":"https://github.com/smorovic","followers_url":"https://api.github.com/users/smorovic/followers","following_url":"https://api.github.com/users/smorovic/following{/other_user}","gists_url":"https://api.github.com/users/smorovic/gists{/gist_id}","starred_url":"https://api.github.com/users/smorovic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smorovic/subscriptions","organizations_url":"https://api.github.com/users/smorovic/orgs","repos_url":"https://api.github.com/users/smorovic/repos","events_url":"https://api.github.com/users/smorovic/events{/privacy}","received_events_url":"https://api.github.com/users/smorovic/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-06-06T17:15:01Z","updated_at":"2015-06-12T10:18:18Z","closed_at":"2015-06-12T10:18:18Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nOur farm consists of ~ 900 Linux nodes with elasticsearch configured to use 1 GB heap, locked memory and these parameters (apart from enabling GC logging):\n-XX:NewSize=500m -XX:MaxNewSize=600m\" \n\nRoughly half of the cluster are recently purchased (Haswell architecture, 12x2 cores dual socket E5-2680 with 64 GB RAM). We are running Scientific Linux 6.6, which is a RHEL6 equivalent.\n\nOnly on these nodes we experience random lockups seen as very long GC where virtually all CPUs are spinning endlessly and never get out of that loop.\n\nThere is a way to get the process out of this by either attaching and detaching debugger (or runnning gstack against the process). Then the GC finally finishes, printing a very large elapsed time.\nSee for example:\n\n2015-06-06T02:10:54.752+0200: 659391.663: [GC (Allocation Failure)  658250K->167958K(987136K), 0.0734349 secs]\n\n2015-06-06T02:25:42.360+0200: 660279.271: [GC (Allocation Failure)  659441K->167230K(987136K), 25788.3097757 secs]\n\n2015-06-06T09:35:41.052+0200: 686077.962: [GC (Allocation Failure)  658735K->202317K(987136K), 0.0538601 secs]\n\nElasticsearch version is 1.4.2, but I don't think that it is relevant in this case. Initially we used java-1.7.0-openjdk (v75). We now migrated to java-1.8.0-oracle-headless v45, and the problem persists.\n\nWe don't have much memory prssure on nodes, and no unusual patter appears with long GC as above.\nPerhaps we are hitting JVM, or even Linux, or evne hardeware bug here?\n\nps -L shows many, usually O(10-30) threads using a lot of CPU, most likely in GC. \n\nEssentially we are posting it here to share out problem, in case someone else has seen this problem, or if we could be pointed to better methods to investigate (gdb is not very helpful since it \"fixes\" the problem).\n","closed_by":{"login":"smorovic","id":5859622,"node_id":"MDQ6VXNlcjU4NTk2MjI=","avatar_url":"https://avatars0.githubusercontent.com/u/5859622?v=4","gravatar_id":"","url":"https://api.github.com/users/smorovic","html_url":"https://github.com/smorovic","followers_url":"https://api.github.com/users/smorovic/followers","following_url":"https://api.github.com/users/smorovic/following{/other_user}","gists_url":"https://api.github.com/users/smorovic/gists{/gist_id}","starred_url":"https://api.github.com/users/smorovic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smorovic/subscriptions","organizations_url":"https://api.github.com/users/smorovic/orgs","repos_url":"https://api.github.com/users/smorovic/repos","events_url":"https://api.github.com/users/smorovic/events{/privacy}","received_events_url":"https://api.github.com/users/smorovic/received_events","type":"User","site_admin":false},"performed_via_github_app":null}