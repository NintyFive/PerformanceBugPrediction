{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/65108","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/65108/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/65108/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/65108/events","html_url":"https://github.com/elastic/elasticsearch/issues/65108","id":744270265,"node_id":"MDU6SXNzdWU3NDQyNzAyNjU=","number":65108,"title":"EQL: Retrieving async searches occasionally return 404s","user":{"login":"rylnd","id":657252,"node_id":"MDQ6VXNlcjY1NzI1Mg==","avatar_url":"https://avatars0.githubusercontent.com/u/657252?v=4","gravatar_id":"","url":"https://api.github.com/users/rylnd","html_url":"https://github.com/rylnd","followers_url":"https://api.github.com/users/rylnd/followers","following_url":"https://api.github.com/users/rylnd/following{/other_user}","gists_url":"https://api.github.com/users/rylnd/gists{/gist_id}","starred_url":"https://api.github.com/users/rylnd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rylnd/subscriptions","organizations_url":"https://api.github.com/users/rylnd/orgs","repos_url":"https://api.github.com/users/rylnd/repos","events_url":"https://api.github.com/users/rylnd/events{/privacy}","received_events_url":"https://api.github.com/users/rylnd/received_events","type":"User","site_admin":false},"labels":[{"id":1690690117,"node_id":"MDU6TGFiZWwxNjkwNjkwMTE3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/EQL","name":":Query Languages/EQL","color":"0e8a16","default":false,"description":"EQL querying"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967501040,"node_id":"MDU6TGFiZWwxOTY3NTAxMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:QL","name":"Team:QL","color":"fef2c0","default":false,"description":"Meta label for query languages team"},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-11-16T23:01:54Z","updated_at":"2020-11-18T08:02:06Z","closed_at":"2020-11-18T08:02:06Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:\r\n7.10\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen previewing EQL queries via the EQL search strategy in kibana, users will occasionally see an error toast caused by a 404 returned by elasticsearch. The pathology is as follows:\r\n\r\n1. User initiates an EQL request (EQL rule preview) that becomes async\r\n2. Client code (search interceptor) receives the async search ID and subsequently requests it\r\n3. Elasticsearch returns a 404 for said ID, causing client code to perform a request “cancellation”\r\n4. Request cancellation comes in the form of a DELETE request for said ID, which returns a 200.\r\n\r\nI believe the DELETE request succeeding is evidence that the query exists but is temporarily unavailable at the time it is requested.\r\n\r\n ~~This seems related to [this issue](https://github.com/elastic/elasticsearch/pull/63652), and the current theory is that a similar fix is needed for EQL's async implementation (if it in fact differs).~~ Update: nope, that issue is unrelated.\r\n\r\n\r\n**Steps to reproduce**:\r\n\r\nAs this all happens in quick succession, it is hard to reproduce manually. Additionally, the error manifests sporadically, so reproduction steps are fuzzy at this point. However, the behavior has been observed by multiple users in multiple environments, and **I've got a deployment in cloud that can demonstrate the issue relatively reliably**. A few other speculative data points that may be helpful:\r\n\r\n* I've been unable to reproduce the issue without data\r\n   * seemingly because the query is quick and completes synchronously\r\n* Slower, more expensive queries _seem_ to increase the likelihood of manifesting the behavior. \r\n\r\n**Provide logs (if relevant)**:\r\nWithin kibana, the 404 is logged from the client: \r\n\r\n```\r\nserver    log   [10:46:29.496] [error][data][elasticsearch] [resource_not_found_exception]: FlN0bEJtS3czUnhHZDdvTHdQOHJIQlEfNnpLdk1MbTNSUU9sQnV6SF83NEExZzo1NTIxOTgwNw==\r\n```\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}