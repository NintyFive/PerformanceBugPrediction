[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/374566059","html_url":"https://github.com/elastic/elasticsearch/issues/29161#issuecomment-374566059","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29161","id":374566059,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NDU2NjA1OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-20T11:36:17Z","updated_at":"2018-03-20T11:36:17Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384552672","html_url":"https://github.com/elastic/elasticsearch/issues/29161#issuecomment-384552672","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29161","id":384552672,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDU1MjY3Mg==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-04-26T08:11:33Z","updated_at":"2018-04-26T08:11:33Z","author_association":"MEMBER","body":"Another failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.3+multijob-unix-compatibility/os=opensuse/4/console\r\n\r\nThis time it is a suite time out: \r\n[consoleLogs1.txt](https://github.com/elastic/elasticsearch/files/1950278/consoleLogs1.txt)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384981315","html_url":"https://github.com/elastic/elasticsearch/issues/29161#issuecomment-384981315","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29161","id":384981315,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDk4MTMxNQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-04-27T14:09:11Z","updated_at":"2018-04-27T14:09:11Z","author_association":"CONTRIBUTOR","body":"I've looked at the latest instance provided by @martijnvg. The reason the suite times out is that a primary gets stuck relocating because it cannot acquire the operations permit for the relocation handoff (it waits up to 30 minutes for that) and the test waits for replication operations to complete, one of which does not seem to complete (and not release the operation permit). The operation that is not completing / releasing the operations permit is `‚ñô‚ñó‚ñã‚ñà‚ñå‚ñÄ‚ñá‚ñã‚ñîa195`. The logs show:\r\n\r\n```\r\n[2018-04-26T05:30:47,233][TRACE][o.e.a.b.TransportShardBulkAction] [node_t0] send action [indices:data/write/bulk[s]] on primary [[test][1]] for request [BulkShardRequest [[test][1]] containing [index {[test][type1][‚ñô‚ñó‚ñã‚ñà‚ñå‚ñÄ‚ñá‚ñã‚ñîa195], source[{\"field1\":\"one hundred ninety-five \"}]}]] with cluster state version [10] to [rFPIA0SCTROJbSppOfu2yA]\r\n[2018-04-26T05:30:47,234][TRACE][o.e.a.b.TransportShardBulkAction] [node_t3] send action [indices:data/write/bulk[s][p]] to local primary [[test][1]] for request [BulkShardRequest [[test][1]] containing [index {[test][type1][‚ñô‚ñó‚ñã‚ñà‚ñå‚ñÄ‚ñá‚ñã‚ñîa195], source[{\"field1\":\"one hundred ninety-five \"}]}]] with cluster state version [10] to [rFPIA0SCTROJbSppOfu2yA]\r\n```\r\n\r\nbut misses the message showing completion of the operation on the primary, e.g. something along the lines of\r\n\r\n```\r\n[2018-04-26T05:30:47,253][TRACE][o.e.a.b.TransportShardBulkAction] [node_t1] [[test][4]] op [indices:data/write/bulk[s]] completed on primary for request [BulkShardRequest [[test][4]] containing [index {[test][type1][ùååùå•ùåÅùååaa232], source[{\"field1\":\"two hundred thirty-two \"}]}]]\r\n```\r\n\r\nThe thread dump does not show any activity for the write thread on node_t3 so it does not look like the index operation is actively stuck on the primary. I'm not sure how the operation could have terminated, however, without releasing the permit?\r\n\r\nThis looks potentially dangerous.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385952878","html_url":"https://github.com/elastic/elasticsearch/issues/29161#issuecomment-385952878","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29161","id":385952878,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTk1Mjg3OA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-05-02T11:55:53Z","updated_at":"2018-05-02T11:55:53Z","author_association":"MEMBER","body":"@ywelsch I'm moving the discussion about the relevance of https://github.com/elastic/elasticsearch/pull/30316 here - you mention that you had an indexing  operation that failed to complete? can you tell if it was indexing after the primary tried to relocate? if that seems likely then I would agree we can see #30316 as an explanation ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399399948","html_url":"https://github.com/elastic/elasticsearch/issues/29161#issuecomment-399399948","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29161","id":399399948,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTM5OTk0OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-06-22T10:35:14Z","updated_at":"2018-06-22T10:35:14Z","author_association":"CONTRIBUTOR","body":"My analysis was unfortunately inconclusive on this. There have also been no more occurrences of this since @martijnvg reported the last failure. I'm suggesting to close this one for now, and reopen if it occurs again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/519559008","html_url":"https://github.com/elastic/elasticsearch/issues/29161#issuecomment-519559008","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29161","id":519559008,"node_id":"MDEyOklzc3VlQ29tbWVudDUxOTU1OTAwOA==","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"created_at":"2019-08-08T15:06:54Z","updated_at":"2019-08-08T15:06:54Z","author_association":"CONTRIBUTOR","body":"Got another failure of this test. Not sure it is the same reason.\r\n\r\nThe build is https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.3+EAR/73/console\r\n\r\nand the relevant scan is https://gradle-enterprise.elastic.co/s/ois5x3v567mlq/tests/kyv2y2z3r4v7m-xytyvorqhynac?openStackTraces=WzFd\r\n\r\nThe failure this time is:\r\n\r\n```\r\ncom.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=274, name=elasticsearch[node_t1][generic][T#1], state=RUNNABLE, group=TGRP-RelocationIT]Open stacktrace\r\nCaused by: java.lang.AssertionError: (No message provided)Close stacktrace\r\nat __randomizedtesting.SeedInfo.seed([E725949EF7A0F9A3]:0)\r\nat org.elasticsearch.index.shard.IndexShard.activateWithPrimaryContext(IndexShard.java:2275)\r\nat org.elasticsearch.indices.recovery.RecoveryTarget.handoffPrimaryContext(RecoveryTarget.java:319)\r\nat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$HandoffPrimaryContextRequestHandler.messageReceived(PeerRecoveryTargetService.java:457)\r\nat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$HandoffPrimaryContextRequestHandler.messageReceived(PeerRecoveryTargetService.java:451)\r\nat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63)\r\nat org.elasticsearch.transport.InboundHandler$RequestHandler.doRun(InboundHandler.java:267)\r\nat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:758)\r\nat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\nat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nReproduce with:\r\n\r\n```\r\n./gradlew :server:integTest --tests \"org.elasticsearch.recovery.RelocationIT.testIndexAndRelocateConcurrently\" -Dtests.seed=E725949EF7A0F9A3 -Dtests.security.manager=true -Dtests.locale=da-DK -Dtests.timezone=Pacific/Yap -Dcompiler.java=12 -Druntime.java=8\r\n```","performed_via_github_app":null}]