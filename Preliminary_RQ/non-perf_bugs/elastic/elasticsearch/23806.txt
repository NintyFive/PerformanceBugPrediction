{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806/events","html_url":"https://github.com/elastic/elasticsearch/issues/23806","id":218038851,"node_id":"MDU6SXNzdWUyMTgwMzg4NTE=","number":23806,"title":"S3 Restore - Repo index files not refreshed","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2017-03-29T23:27:18Z","updated_at":"2017-03-30T16:54:33Z","closed_at":"2017-03-29T23:30:23Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.1.1\r\n\r\n**Plugins installed**: [discovery-ec2, repository-s3]\r\n\r\n**JVM version**: 1.8.0_121\"\r\n\r\n**OS version**: Amazon Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWe hit an issue with trying to restore a from a 2.3.2 ES cluster S3 Repository to a ES 5.1.1 cluster. \r\n\r\nWhen two clusters have repositories pointing to the same S3 bucket, it looks like different versions of ES get the list of available snapshots for the bucket differently. ES 2.3 uses the index and ES 5.1.1 uses the index-[number] files.\r\n\r\n**Steps to reproduce**:\r\n1. Create an S3 repository on a ES 2.3.2 cluster\r\n2. Take a snapshot for the repository created in Step 1.\r\n3. Create a S3 repository on a ES 5.1.1 cluster with the same bucket used in step 1.\r\n4. List snapshots for the repository created in step 3 on the ES 5.1.1 cluster.\r\n5. Create another snapshot in the ES 2.3.2 cluster\r\n6. List snapshots on the ES 5.1.1 cluster repository created in step 3. The results will not contain the snapshot created in step 5.\r\n\r\nWorkaround:\r\n1. On the ES 5.1.1 S3 repository, delete the index-x files.\r\n2. Issue a list snapshots for the ES 5.1.1 repository forcing the index-x files to be recreated with the current list of snapshots.\r\n\r\n\r\n","closed_by":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"performed_via_github_app":null}