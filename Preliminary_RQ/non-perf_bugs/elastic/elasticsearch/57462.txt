{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/57462","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57462/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57462/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57462/events","html_url":"https://github.com/elastic/elasticsearch/issues/57462","id":628638508,"node_id":"MDU6SXNzdWU2Mjg2Mzg1MDg=","number":57462,"title":"Cast exception error while using the get api","user":{"login":"cristi-","id":11157105,"node_id":"MDQ6VXNlcjExMTU3MTA1","avatar_url":"https://avatars3.githubusercontent.com/u/11157105?v=4","gravatar_id":"","url":"https://api.github.com/users/cristi-","html_url":"https://github.com/cristi-","followers_url":"https://api.github.com/users/cristi-/followers","following_url":"https://api.github.com/users/cristi-/following{/other_user}","gists_url":"https://api.github.com/users/cristi-/gists{/gist_id}","starred_url":"https://api.github.com/users/cristi-/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cristi-/subscriptions","organizations_url":"https://api.github.com/users/cristi-/orgs","repos_url":"https://api.github.com/users/cristi-/repos","events_url":"https://api.github.com/users/cristi-/events{/privacy}","received_events_url":"https://api.github.com/users/cristi-/received_events","type":"User","site_admin":false},"labels":[{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"}],"state":"closed","locked":false,"assignee":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"assignees":[{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2020-06-01T18:27:48Z","updated_at":"2020-06-16T07:07:12Z","closed_at":"2020-06-16T07:07:12Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n\r\n7.6.0\r\n\r\n**Plugins installed**: [analysis-icu analysis-kuramoji es-restlog es-shopname-tokenizer repository-gcs]\r\n\r\n**JVM version** (`java -version`): \r\nopenjdk version \"13.0.2\" 2020-01-14\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux elastic2-es-data-14 4.14.138+ #1 SMP Tue Sep 3 02:58:08 PDT 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nFrom time to time, while retrieving documents using the [GET Api](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-get.html) from a index that receives no search requests, we see the following exception:\r\n\r\n```\r\nException in thread \"main\" NotSerializableExceptionWrapper[class_cast_exception: class java.lang.String cannot be cast to class java.lang.Number (java.lang.String and java.lang.Number are in module java.base of loader 'bootstrap')]\r\n\tat org.elasticsearch.index.mapper.NumberFieldMapper$NumberFieldType.valueForDisplay(NumberFieldMapper.java:966)\r\n\tat org.elasticsearch.index.fieldvisitor.FieldsVisitor.postProcess(FieldsVisitor.java:104)\r\n\tat org.elasticsearch.index.get.ShardGetService.innerGetLoadFromStoredFields(ShardGetService.java:284)\r\n\tat org.elasticsearch.index.get.ShardGetService.innerGet(ShardGetService.java:194)\r\n\tat org.elasticsearch.index.get.ShardGetService.get(ShardGetService.java:104)\r\n\tat org.elasticsearch.index.get.ShardGetService.get(ShardGetService.java:95)\r\n\tat org.elasticsearch.action.get.TransportGetAction.shardOperation(TransportGetAction.java:106)\r\n\tat org.elasticsearch.action.get.TransportGetAction.shardOperation(TransportGetAction.java:45)\r\n\tat org.elasticsearch.action.support.single.shard.TransportSingleShardAction.lambda$asyncShardOperation$0(TransportSingleShardAction.java:110)\r\n\tat org.elasticsearch.action.ActionRunnable.lambda$supply$0(ActionRunnable.java:58)\r\n\tat org.elasticsearch.action.ActionRunnable$2.doRun(ActionRunnable.java:73)\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n\tat java.lang.Thread.run(Thread.java:830)\r\n```\r\n\r\nThe index has the following mapping:\r\n```\r\n{ - \r\n  \"index-timestamps-1589491666\": { - \r\n    \"mappings\": { - \r\n      \"properties\": { - \r\n        \"timestamp\": { - \r\n          \"type\": \"date\",\r\n          \"store\": true,\r\n          \"format\": \"dateOptionalTime\"\r\n        },\r\n        \"value\": { - \r\n          \"type\": \"long\",\r\n          \"store\": true\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThe changes added in https://github.com/elastic/elasticsearch/pull/48843 used the following logic to parse data from translog files: https://github.com/elastic/elasticsearch/pull/48843/files#diff-04af9607316b0935c611e5ebfd5e7c61R256-R265\r\n\r\nHowever in https://github.com/apache/lucene-solr/blob/a6a02ac0e5116f4cf061fd3afeb930c3cc379f5a/lucene/core/src/java/org/apache/lucene/document/Field.java#L252-L264 `stringValue()` will return the `fieldsData.toString();`  even for numeric values.\r\n\r\n![image](https://user-images.githubusercontent.com/11157105/83441020-85f43580-a44e-11ea-9a77-3a0767514a25.png)\r\n\r\nThis string value reaches valueForDisplay() where the exception occurs:\r\n\r\n \r\n![image](https://user-images.githubusercontent.com/11157105/83441316-0024ba00-a44f-11ea-9b1b-10e897ba7577.png)\r\n\r\n\r\n\r\n\r\n**Steps to reproduce**:\r\n\r\nUnfortunately I don't have a easy way to reproduce this right now.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n\r\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}