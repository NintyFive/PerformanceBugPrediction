[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/406507362","html_url":"https://github.com/elastic/elasticsearch/issues/32202#issuecomment-406507362","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32202","id":406507362,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjUwNzM2Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-20T06:58:44Z","updated_at":"2018-07-20T06:58:44Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/406744660","html_url":"https://github.com/elastic/elasticsearch/issues/32202#issuecomment-406744660","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32202","id":406744660,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjc0NDY2MA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-07-20T22:44:24Z","updated_at":"2018-07-20T22:44:24Z","author_association":"MEMBER","body":"@vandanachadha could you make sure that `locP` has a `geo_point` type? By looking at your output I suspect it might be mapped as an object. I was trying to reproduce it with 6.3.1 and everything seems to work as expected after I applied the proper mapping and fixed the locP format. This is the reproduction that I used:\r\n\r\n```\r\nDELETE test\r\n\r\nPUT test\r\n{\r\n  \"mappings\": {\r\n    \"doc\": {\r\n      \"properties\": {\r\n        \"autoCompleteName\": {\r\n          \"type\": \"completion\",\r\n          \"analyzer\": \"standard\",\r\n          \"preserve_separators\": true,\r\n          \"preserve_position_increments\": false,\r\n          \"max_input_length\": 50,\r\n          \"contexts\": [\r\n            {\r\n              \"name\": \"locationContext\",\r\n              \"type\": \"geo\",\r\n              \"precision\": \"25m\",\r\n              \"path\": \"locP\"\r\n            }\r\n          ]\r\n        },\r\n        \"locP\": {\r\n          \"type\": \"geo_point\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n\r\nPUT test/doc/1\r\n{\r\n  \"venueId\": \"457ebeaaf964a5203f3f1fe3\",\r\n  \"name\": \"Eleven Madison Park\",\r\n  \"locP\": {\r\n    \"lat\": 40.74164831951294,\r\n    \"lon\": -73.98714780807495\r\n  },\r\n  \"autoCompleteName\": \"Südsteiermark, Tement, Zieregg 2008\"\r\n}\r\n\r\nGET test/doc/_search\r\n{\r\n  \"suggest\": {\r\n    \"suggestion\": {\r\n      \"prefix\": \"Südsteiermark\",\r\n      \"completion\": {\r\n        \"field\": \"autoCompleteName\",\r\n        \"size\": 10,\r\n        \"contexts\": {\r\n          \"locationContext\": [\r\n            {\r\n              \"lat\": \"40.74164831951294\",\r\n              \"lon\": \"-73.98714780807495\",\r\n              \"precision\": 12\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nIn the future when you have questions like this, it might be the best to start with asking them in our discussion forum https://discuss.elastic.co/ Also having a small reproduction similar to one I pasted above instead of small bits and pieces really helps the person who is trying to understand your issue and help you. \r\n\r\n\r\nSaying this, I have to agree, that is indeed trappy, and we should probably add additional check to make sure that something like this causes an error message instead of silently ignoring the context:\r\n\r\n```\r\nPUT test\r\n{\r\n  \"mappings\": {\r\n    \"doc\": {\r\n      \"properties\": {\r\n        \"autoCompleteName\": {\r\n          \"type\": \"completion\",\r\n          \"analyzer\": \"standard\",\r\n          \"preserve_separators\": true,\r\n          \"preserve_position_increments\": false,\r\n          \"max_input_length\": 50,\r\n          \"contexts\": [\r\n            {\r\n              \"name\": \"locationContext\",\r\n              \"type\": \"geo\",\r\n              \"precision\": \"25m\",\r\n              \"path\": \"locP\"\r\n            }\r\n          ]\r\n        },\r\n        \"locP\": {\r\n          \"type\": \"object\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nI can see [some code](https://github.com/elastic/elasticsearch/blob/15ff3da653c5dd9eae7f7a654a9ee6a931d478b7/server/src/main/java/org/elasticsearch/search/suggest/completion/context/GeoContextMapping.java#L141-L144) that seems to be there to prevent this from happening, but it doesn't seem to work. I will dig into it next week.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/406772011","html_url":"https://github.com/elastic/elasticsearch/issues/32202#issuecomment-406772011","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32202","id":406772011,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjc3MjAxMQ==","user":{"login":"vandanachadha","id":982568,"node_id":"MDQ6VXNlcjk4MjU2OA==","avatar_url":"https://avatars3.githubusercontent.com/u/982568?v=4","gravatar_id":"","url":"https://api.github.com/users/vandanachadha","html_url":"https://github.com/vandanachadha","followers_url":"https://api.github.com/users/vandanachadha/followers","following_url":"https://api.github.com/users/vandanachadha/following{/other_user}","gists_url":"https://api.github.com/users/vandanachadha/gists{/gist_id}","starred_url":"https://api.github.com/users/vandanachadha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vandanachadha/subscriptions","organizations_url":"https://api.github.com/users/vandanachadha/orgs","repos_url":"https://api.github.com/users/vandanachadha/repos","events_url":"https://api.github.com/users/vandanachadha/events{/privacy}","received_events_url":"https://api.github.com/users/vandanachadha/received_events","type":"User","site_admin":false},"created_at":"2018-07-21T05:27:10Z","updated_at":"2018-07-21T05:27:10Z","author_association":"NONE","body":"@imotov  Thanks for your detailed reply. I will make sure that next problem I post on the blog, have already done it infact.\r\nFor this problem at hand, I changed the locationContext path to \"locP.coordinates\", as you rightly pointed out that locP seems to be an object, as follows:\r\n        \"contexts\": [\r\n                {\r\n                    \"name\":\"locationContext\",\r\n                    \"type\":\"geo\",\r\n                    \"precision\":\"25m\",\r\n                    \"path\":\"locP.coordinates\"\r\n                }\r\n            ]\r\nAnd mapping for locP is as follows:\r\n  \"locP\": {\r\n            \"properties\": {\r\n              \"coordinates\": {\r\n                \"type\": \"geo_point\",\r\n                \"store\": true\r\n              },\r\n              \"type\": {\r\n                \"type\": \"text\",\r\n                \"fields\": {\r\n                  \"keyword\": {\r\n                    \"type\": \"keyword\",\r\n                    \"ignore_above\": 256\r\n                  }\r\n                }\r\n              }\r\n\r\nBut now I get a number_format_exception for the coordinates when creating the index.  What am I dong wrong here?\r\n\r\nError:\r\n{\"_index\":\"vandanatest\",\"_type\":\"venues\",\"_id\":\"5b31cac1a49bd4a95249da5e\",\"status\":400,\"error\":{\"type\":\"number_format_exception\",\"reason\":\"For input string: \\\"30.72995086887028, 76.79127881291227\\\"\"}}},\r\n\r\nPls note that I am using mongo-connector for indexing\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407068036","html_url":"https://github.com/elastic/elasticsearch/issues/32202#issuecomment-407068036","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32202","id":407068036,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzA2ODAzNg==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-07-23T14:00:44Z","updated_at":"2018-07-23T14:00:44Z","author_association":"MEMBER","body":"@vandanachadha I would need to see your document to answer that question. I cannot reproduce this error based on your description. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407319486","html_url":"https://github.com/elastic/elasticsearch/issues/32202#issuecomment-407319486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32202","id":407319486,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzMxOTQ4Ng==","user":{"login":"vandanachadha","id":982568,"node_id":"MDQ6VXNlcjk4MjU2OA==","avatar_url":"https://avatars3.githubusercontent.com/u/982568?v=4","gravatar_id":"","url":"https://api.github.com/users/vandanachadha","html_url":"https://github.com/vandanachadha","followers_url":"https://api.github.com/users/vandanachadha/followers","following_url":"https://api.github.com/users/vandanachadha/following{/other_user}","gists_url":"https://api.github.com/users/vandanachadha/gists{/gist_id}","starred_url":"https://api.github.com/users/vandanachadha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vandanachadha/subscriptions","organizations_url":"https://api.github.com/users/vandanachadha/orgs","repos_url":"https://api.github.com/users/vandanachadha/repos","events_url":"https://api.github.com/users/vandanachadha/events{/privacy}","received_events_url":"https://api.github.com/users/vandanachadha/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T08:08:01Z","updated_at":"2018-07-24T08:08:01Z","author_association":"NONE","body":"@imotov \r\nThe number_format error got fixed once I removed the \"store true\" from the geo-point mapping:\r\n\"locP\": {\r\n\"properties\": {\r\n\"coordinates\": {\r\n\"type\": \"geo_point\",\r\n\"store\": true\r\n}\r\n\r\nDont understand why though.\r\n\r\nBut thanks a lot for putting me in the right direction for using the correct property for geo context. My suggest now works with geo-context\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407397952","html_url":"https://github.com/elastic/elasticsearch/issues/32202#issuecomment-407397952","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32202","id":407397952,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzM5Nzk1Mg==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T13:00:39Z","updated_at":"2018-07-24T13:00:39Z","author_association":"MEMBER","body":"@vandanachadha Thank you for letting me know about this, I am looking into this code at the moment and going to try fixing this issue as well. ","performed_via_github_app":null}]