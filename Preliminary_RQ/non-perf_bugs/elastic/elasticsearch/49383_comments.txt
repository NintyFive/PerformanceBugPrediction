[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/556037584","html_url":"https://github.com/elastic/elasticsearch/issues/49383#issuecomment-556037584","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49383","id":556037584,"node_id":"MDEyOklzc3VlQ29tbWVudDU1NjAzNzU4NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-11-20T14:53:16Z","updated_at":"2019-11-20T14:53:16Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Search)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/562667319","html_url":"https://github.com/elastic/elasticsearch/issues/49383#issuecomment-562667319","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49383","id":562667319,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MjY2NzMxOQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-12-06T17:35:32Z","updated_at":"2019-12-06T17:35:32Z","author_association":"CONTRIBUTOR","body":"The same failure just occurred in `XPackRestIT test {p0=vectors/35_sparse_vector_l1l2/L1 norm}` in https://gradle-enterprise.elastic.co/s/oopg7rdugmzne:\r\n\r\n```\r\nCaused by: java.lang.AssertionError: \r\ndid not get expected warning header [\r\n\tThe [sparse_vector] field type is deprecated and will be removed in 8.0.\r\n]\r\n```\r\n\r\nThis didn't reproduce locally using:\r\n\r\n```\r\n./gradlew ':x-pack:plugin:integTestRunner' --tests \"org.elasticsearch.xpack.test.rest.XPackRestIT.test {p0=vectors/35_sparse_vector_l1l2/L1 norm}\" \\\r\n  -Dtests.seed=82A7DCDC265AC010 \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=sr-Latn-RS \\\r\n  -Dtests.timezone=Etc/GMT+4 \\\r\n  -Dcompiler.java=12 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nThis failure is _extremely_ intermittent.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/564335782","html_url":"https://github.com/elastic/elasticsearch/issues/49383#issuecomment-564335782","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49383","id":564335782,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDMzNTc4Mg==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2019-12-11T01:27:58Z","updated_at":"2019-12-11T01:27:58Z","author_association":"MEMBER","body":"The stash dump shows that the search hit two shards, but the test index only has one shard:\r\n\r\n```\r\n-- | --\r\n  | 1>   \"stash\" : { |  \r\n  | 1>     \"body\" : { |  \r\n  | 1>       \"took\" : 2, |  \r\n  | 1>       \"timed_out\" : false, |  \r\n  | 1>       \"_shards\" : { |  \r\n  | 1>         \"total\" : 2, |  \r\n  | 1>         \"successful\" : 2, |  \r\n  | 1>         \"skipped\" : 0, |  \r\n  | 1>         \"failed\" : 0 |  \r\n  | 1>       }, |  \r\n  | 1>       \"hits\" : { \r\n...\r\n```\r\n\r\nA theory as to what is happening:\r\n1. There is an extra empty index present in addition to the test index. Since the search doesn't specify an index name, it hits both the test index and this extra empty index.\r\n2. The shard responses from the extra index don't produce deprecation warnings because it's empty and we never try to execute the script. If not all shard responses contain the warning headers, then certain deprecation warnings can be lost (due to the bug described in #33936).\r\n\r\nI'm not clear on how there could be an extra empty index present. But it is good practice to specify the index name directly in searches -- I'll plan to change the search calls to specify `test-index` directly and then monitor whether we see more failures.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/564676153","html_url":"https://github.com/elastic/elasticsearch/issues/49383#issuecomment-564676153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49383","id":564676153,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDY3NjE1Mw==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2019-12-11T18:36:26Z","updated_at":"2019-12-11T18:36:26Z","author_association":"MEMBER","body":"I'm going to close this now that #50061 has merged, we can re-open it if we see the failure again.","performed_via_github_app":null}]