{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38877","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38877/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38877/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38877/events","html_url":"https://github.com/elastic/elasticsearch/issues/38877","id":410094787,"node_id":"MDU6SXNzdWU0MTAwOTQ3ODc=","number":38877,"title":"[CI] wipeRollupJobs fails to cleanup job and causes multiple test failures ","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"labels":[{"id":912843355,"node_id":"MDU6TGFiZWw5MTI4NDMzNTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Rollup","name":":Analytics/Rollup","color":"0e8a16","default":false,"description":"Turn fine-grained time-based data into coarser-grained data"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"assignees":[{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false}],"milestone":null,"comments":10,"created_at":"2019-02-14T02:23:01Z","updated_at":"2019-02-26T18:54:50Z","closed_at":"2019-02-26T18:54:50Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"From https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+intake/92/consoleFull\r\n\r\nThe first failure seems to have been actually running the `stop-job` snippet:\r\n```\r\n23:26:34   1> [2019-02-14T00:24:33,170][ERROR][o.e.s.DocsClientYamlTestSuiteIT] [test] This failing test was generated by documentation starting at reference/rollup/apis/stop-job.asciidoc:line_54. It may include many snippets. See docs/README.asciidoc for an explanation of test generation.\r\n23:26:34 ERROR   10.4s | DocsClientYamlTestSuiteIT.test {yaml=reference/rollup/apis/stop-job/line_54} <<< FAILURES!\r\n23:26:34    > Throwable #1: org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:39829], URI [/_rollup/job/sensor/_stop?wait_for_completion=true&timeout=10s], status line [HTTP/1.1 500 Internal Server Error]\r\n23:26:34    > {\"error\":{\"root_cause\":[{\"type\":\"timeout_exception\",\"reason\":\"Timed out after [10s] while waiting for rollup job [sensor] to stop. State was [STOPPING]\"}],\"type\":\"timeout_exception\",\"reason\":\"Timed out after [10s] while waiting for rollup job [sensor] to stop. State was [STOPPING]\"},\"status\":500}\r\n23:26:34    > \tat __randomizedtesting.SeedInfo.seed([4C8232EC98ABC116:C4D60D363657ACEE]:0)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.convertResponse(RestClient.java:260)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:238)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:212)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.wipeRollupJobs(ESRestTestCase.java:597)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.wipeCluster(ESRestTestCase.java:509)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:295)\r\n23:26:34    > \tat java.lang.Thread.run(Thread.java:748)\r\n23:26:34   1> [2019-02-14T00:24:33,179][INFO ][o.e.s.DocsClientYamlTestSuiteIT] [test] [yaml=reference/ml/detector-custom-rules/line_146] before test\r\n23:26:34   1> [2019-02-14T00:24:43,241][INFO ][o.e.s.DocsClientY\r\n```\r\n\r\nBut this caused other doc snippets to fail as they tried to clean up the cluster\r\n```\r\n23:26:34 ERROR   10.2s | DocsClientYamlTestSuiteIT.test {yaml=reference/indices/forcemerge/line_47} <<< FAILURES!\r\n23:26:34    > Throwable #1: org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:39829], URI [/_rollup/job/sensor/_stop?wait_for_completion=true&timeout=10s], status line [HTTP/1.1 500 Internal Server Error]\r\n23:26:34    > {\"error\":{\"root_cause\":[{\"type\":\"timeout_exception\",\"reason\":\"Timed out after [10s] while waiting for rollup job [sensor] to stop. State was [STOPPING]\"}],\"type\":\"timeout_exception\",\"reason\":\"Timed out after [10s] while waiting for rollup job [sensor] to stop. State was [STOPPING]\"},\"status\":500}\r\n23:26:34    > \tat __randomizedtesting.SeedInfo.seed([4C8232EC98ABC116:C4D60D363657ACEE]:0)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.convertResponse(RestClient.java:260)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:238)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:212)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.wipeRollupJobs(ESRestTestCase.java:597)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.wipeCluster(ESRestTestCase.java:509)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:295)\r\n23:26:34    > \tat java.lang.Thread.run(Thread.java:748)\r\n23:26:34   1> [2019-02-14T00:25:03,686][INFO ][o.e.s.DocsClientYamlTestSuiteIT] [test] [yaml=reference/how-to/search-speed/line_87] before test\r\n23:26:34   1> [2019-02-14T00:25:13,898][INFO ][o.e.s.DocsClientYamlTestSuiteIT] [test] [yaml=reference/how-to/search-speed/line_87] after test\r\n23:26:34   1> [2019-02-14T00:25:13,898][ERROR][o.e.s.DocsClientYamlTestSuiteIT] [test] This failing test was generated by documentation starting at reference/how-to/search-speed.asciidoc:line_87. It may include many snippets. See docs/README.asciidoc for an explanation of test generation.\r\n23:26:34 ERROR   10.2s | DocsClientYamlTestSuiteIT.test {yaml=reference/how-to/search-speed/line_87} <<< FAILURES!\r\n23:26:34    > Throwable #1: org.elasticsearch.client.ResponseException: method [POST], host [http://[::1]:39829], URI [/_rollup/job/sensor/_stop?wait_for_completion=true&timeout=10s], status line [HTTP/1.1 500 Internal Server Error]\r\n23:26:34    > {\"error\":{\"root_cause\":[{\"type\":\"timeout_exception\",\"reason\":\"Timed out after [10s] while waiting for rollup job [sensor] to stop. State was [STOPPING]\"}],\"type\":\"timeout_exception\",\"reason\":\"Timed out after [10s] while waiting for rollup job [sensor] to stop. State was [STOPPING]\"},\"status\":500}\r\n23:26:34    > \tat __randomizedtesting.SeedInfo.seed([4C8232EC98ABC116:C4D60D363657ACEE]:0)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.convertResponse(RestClient.java:260)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:238)\r\n23:26:34    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:212)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.wipeRollupJobs(ESRestTestCase.java:597)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.wipeCluster(ESRestTestCase.java:509)\r\n23:26:34    > \tat org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:295)\r\n23:26:34    > \tat java.lang.Thread.run(Thread.java:748)\r\n23:26:34   1> [2019-02-14T00:25:13,905][INFO ][o.e.s.DocsClientYamlTestSuiteIT] [test] [yaml=reference/aggregations/bucket/terms-aggregation/line_57] before test\r\n```\r\n\r\nWith an end result of these failures\r\n- DocsClientYamlTestSuiteIT test {yaml=reference/frozen-indices/line_52}\r\n- DocsClientYamlTestSuiteIT test {yaml=reference/how-to/search-speed/line_87}\r\n- DocsClientYamlTestSuiteIT test {yaml=reference/indices/forcemerge/line_47}\r\n- DocsClientYamlTestSuiteIT test {yaml=reference/ml/detector-custom-rules/line_146}\r\n- DocsClientYamlTestSuiteIT test {yaml=reference/rollup/apis/stop-job/line_54}\r\n\r\nIt (unsurprisingly) doesn't reproduce for me.\r\n[job-92-consoleLog.txt.gz](https://github.com/elastic/elasticsearch/files/2863007/job-92-consoleLog.txt.gz)\r\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}