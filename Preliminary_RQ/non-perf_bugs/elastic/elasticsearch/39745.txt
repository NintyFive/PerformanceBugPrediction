{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39745","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39745/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39745/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39745/events","html_url":"https://github.com/elastic/elasticsearch/issues/39745","id":417815289,"node_id":"MDU6SXNzdWU0MTc4MTUyODk=","number":39745,"title":"High level REST client XContent tests are misleading","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":837440720,"node_id":"MDU6TGFiZWw4Mzc0NDA3MjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Erefactoring","name":">refactoring","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false},"assignees":[{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2019-03-06T13:55:17Z","updated_at":"2019-10-30T19:57:33Z","closed_at":"2019-10-30T19:57:32Z","author_association":"MEMBER","active_lock_reason":null,"body":"Many high-level REST client XContent tests where we use a dedicated client class (e.g., `org.elasticsearch.client.core.AcknowledgeResponse`) are misleading and not actually testing what occurs in production.\r\n\r\nFor example, let us consider the case of `org.elasticsearch.core.AcknowledgedResponse` for which `XContent` is tested via `org.elasticsearch.client.core.AcknowledgedResponseTests`. However, this test does not actually test what occurs in production.\r\n\r\nWhat occurs in production is that a concrete instance of `org.elasticsearch.action.support.master.AcknowledgedResponse` is serialized to `XContent` on the REST layer, and then client side is deserialized from `XContent` by the HLRC. We need confidence that this translation is working.\r\n\r\nThe test that we have today based on `AbstractXContentTestCase#xContentTester` does not actually test this. Instead, it creates a concrete instance of `org.elasticsearch.client.core.AcknowledgedResponse`, converts this to `XContent` via non-production test code, and then checks that that `XContent` can be converted back to an instance of `org.elasticsearch.client.core.AcknowledgedResponse`. This does not give us confidence that the translation between a serialized `XContent` of `org.elasticsearch.action.support.master.AcknowledgedResponse` is properly deserialized to an instance of `org.elasticsearch.client.core.AcknowledgedResponse` in the HLRC. That's the production code path that we want to test.\r\n\r\nWe probably want a dedicated framework like `AbstractXContentTestCase#xContentTester` for this. See #39713 [comment](https://github.com/elastic/elasticsearch/pull/39718#discussion_r262926544) for the discussion that triggered this issue, and a test that is based on production code rather than non-production code.","closed_by":{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false},"performed_via_github_app":null}