{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50054","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50054/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50054/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50054/events","html_url":"https://github.com/elastic/elasticsearch/issues/50054","id":536037100,"node_id":"MDU6SXNzdWU1MzYwMzcxMDA=","number":50054,"title":"[Monitoring] [UI] Multiple logstash pipelines aggregations are broken","user":{"login":"chrisronline","id":56682,"node_id":"MDQ6VXNlcjU2Njgy","avatar_url":"https://avatars1.githubusercontent.com/u/56682?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisronline","html_url":"https://github.com/chrisronline","followers_url":"https://api.github.com/users/chrisronline/followers","following_url":"https://api.github.com/users/chrisronline/following{/other_user}","gists_url":"https://api.github.com/users/chrisronline/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisronline/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisronline/subscriptions","organizations_url":"https://api.github.com/users/chrisronline/orgs","repos_url":"https://api.github.com/users/chrisronline/repos","events_url":"https://api.github.com/users/chrisronline/events{/privacy}","received_events_url":"https://api.github.com/users/chrisronline/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913658,"node_id":"MDU6TGFiZWw5MjkxMzY1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/blocker","name":"blocker","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-12-10T22:44:14Z","updated_at":"2019-12-12T14:06:34Z","closed_at":"2019-12-12T14:06:34Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"See https://github.com/elastic/elasticsearch/issues/44914#issuecomment-564161902\r\n\r\nSomething changed recently in ES, triggering a slew of test failures (https://github.com/elastic/kibana/issues/52470, https://github.com/elastic/kibana/issues/52471, https://github.com/elastic/kibana/issues/52476,https://github.com/elastic/kibana/issues/52476). \r\n\r\nThe culprit seems to be using `bucket_script` aggregations somewhere under a `nested` aggregation. In this scenario, the `bucket_script` aggregation doesn't seem to ever run, as the response does not contain the data.\r\n\r\n(Partial copy-paste from the comment linked above)\r\nSee this example here: https://gist.github.com/chrisronline/836dbbdb594d5848538e412236f32147\r\n\r\nFor 7.5 and below, the output is:\r\n```\r\n{\r\n  \"aggregations\" : {\r\n    \"date_histo\" : {\r\n      \"buckets\" : [\r\n        {\r\n          \"in_nested\" : {\r\n            \"types\" : {\r\n              \"buckets\" : [\r\n                {\r\n                  \"bs_value\" : {\r\n                    \"value\" : 1.0\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"high_level_bs_value\" : {\r\n            \"value\" : 0.0\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nFor 7.6 and above, the output is:\r\n```\r\n{\r\n  \"aggregations\" : {\r\n    \"date_histo\" : {\r\n      \"buckets\" : [\r\n        {\r\n          \"high_level_bs_value\" : {\r\n            \"value\" : 0.0\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nLuckily, we have good test coverage for this, but this needs to be a blocker for 7.6\r\n\r\nI've pinged @polyfractal about this and he is currently investigating. It sounds like this is also affecting other aggregation types too.\r\n\r\ncc @elastic/stack-monitoring ","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}