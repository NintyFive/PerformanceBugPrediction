{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8054","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8054/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8054/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8054/events","html_url":"https://github.com/elastic/elasticsearch/issues/8054","id":45537172,"node_id":"MDU6SXNzdWU0NTUzNzE3Mg==","number":8054,"title":"Dropped shard after delete by query","user":{"login":"clly","id":778297,"node_id":"MDQ6VXNlcjc3ODI5Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/778297?v=4","gravatar_id":"","url":"https://api.github.com/users/clly","html_url":"https://github.com/clly","followers_url":"https://api.github.com/users/clly/followers","following_url":"https://api.github.com/users/clly/following{/other_user}","gists_url":"https://api.github.com/users/clly/gists{/gist_id}","starred_url":"https://api.github.com/users/clly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clly/subscriptions","organizations_url":"https://api.github.com/users/clly/orgs","repos_url":"https://api.github.com/users/clly/repos","events_url":"https://api.github.com/users/clly/events{/privacy}","received_events_url":"https://api.github.com/users/clly/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-10-11T01:12:01Z","updated_at":"2014-10-11T07:45:16Z","closed_at":"2014-10-11T07:45:16Z","author_association":"NONE","active_lock_reason":null,"body":"After performing a delete by query on an index, a few hours later it drops one of the shards with an a MergePolicyException ArrayIndexOutOfBoundsException.  Elasticsearch version is 0.90.13\n\nException in thread \"elasticsearch[servername][[index][0]: Lucene Merge Thread #5228]\" org.apache.lucene.index.MergePolicy$MergeException: java.lang.ArrayIndexOutOfBoundsException: 79001\n        at org.apache.lucene.index.ConcurrentMergeScheduler.handleMergeException(ConcurrentMergeScheduler.java:545)\n        at org.elasticsearch.index.merge.scheduler.ConcurrentMergeSchedulerProvider$CustomConcurrentMergeScheduler.handleMergeException(ConcurrentMergeSchedulerProvider.java:110)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:518)\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 79001\n        at org.apache.lucene.codecs.lucene40.BitVector.get(BitVector.java:147)\n        at org.apache.lucene.index.MergeState$DocMap$1.get(MergeState.java:87)\n        at org.apache.lucene.codecs.MappingMultiDocsAndPositionsEnum.nextDoc(MappingMultiDocsAndPositionsEnum.java:107)\n        at org.apache.lucene.codecs.PostingsConsumer.merge(PostingsConsumer.java:109)\n        at org.apache.lucene.codecs.TermsConsumer.merge(TermsConsumer.java:164)\n        at org.apache.lucene.codecs.FieldsConsumer.merge(FieldsConsumer.java:72)\n        at org.apache.lucene.index.SegmentMerger.mergeTerms(SegmentMerger.java:383)\n        at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:106)\n        at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4071)\n        at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3668)\n        at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:405)\n        at org.apache.lucene.index.TrackingConcurrentMergeScheduler.doMerge(TrackingConcurrentMergeScheduler.java:107)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:482)\n\n[2014-10-10 18:30:30,802][WARN ][index.merge.scheduler    ] [servername] [index][0] failed to merge\njava.lang.ArrayIndexOutOfBoundsException: 79001\n        at org.apache.lucene.codecs.lucene40.BitVector.get(BitVector.java:147)\n        at org.apache.lucene.index.MergeState$DocMap$1.get(MergeState.java:87)\n        at org.apache.lucene.codecs.MappingMultiDocsAndPositionsEnum.nextDoc(MappingMultiDocsAndPositionsEnum.java:107)\n        at org.apache.lucene.codecs.PostingsConsumer.merge(PostingsConsumer.java:109)\n        at org.apache.lucene.codecs.TermsConsumer.merge(TermsConsumer.java:164)\n        at org.apache.lucene.codecs.FieldsConsumer.merge(FieldsConsumer.java:72)\n        at org.apache.lucene.index.SegmentMerger.mergeTerms(SegmentMerger.java:383)\n        at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:106)\n        at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4071)\n        at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3668)\n        at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:405)\n        at org.apache.lucene.index.TrackingConcurrentMergeScheduler.doMerge(TrackingConcurrentMergeScheduler.java:107)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:482)\n[2014-10-10 18:30:30,896][WARN ][index.engine.robin       ] [servername] [index][0] failed engine\norg.apache.lucene.index.MergePolicy$MergeException: java.lang.ArrayIndexOutOfBoundsException: 79001\n        at org.elasticsearch.index.merge.scheduler.ConcurrentMergeSchedulerProvider$CustomConcurrentMergeScheduler.handleMergeException(ConcurrentMergeSchedulerProvider.java:109)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:518)\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 79001\n        at org.apache.lucene.codecs.lucene40.BitVector.get(BitVector.java:147)\n        at org.apache.lucene.index.MergeState$DocMap$1.get(MergeState.java:87)\n        at org.apache.lucene.codecs.MappingMultiDocsAndPositionsEnum.nextDoc(MappingMultiDocsAndPositionsEnum.java:107)\n        at org.apache.lucene.codecs.PostingsConsumer.merge(PostingsConsumer.java:109)\n        at org.apache.lucene.codecs.TermsConsumer.merge(TermsConsumer.java:164)\n        at org.apache.lucene.codecs.FieldsConsumer.merge(FieldsConsumer.java:72)\n        at org.apache.lucene.index.SegmentMerger.mergeTerms(SegmentMerger.java:383)\n        at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:106)\n        at org.apache.lucene.index.IndexWriter.mergeMiddle(IndexWriter.java:4071)\n        at org.apache.lucene.index.IndexWriter.merge(IndexWriter.java:3668)\n        at org.apache.lucene.index.ConcurrentMergeScheduler.doMerge(ConcurrentMergeScheduler.java:405)\n        at org.apache.lucene.index.TrackingConcurrentMergeScheduler.doMerge(TrackingConcurrentMergeScheduler.java:107)\n        at org.apache.lucene.index.ConcurrentMergeScheduler$MergeThread.run(ConcurrentMergeScheduler.java:482)\n[2014-10-10 18:30:30,962][DEBUG][index.shard.service      ] [servername] [index][0] state: [STARTED]->[CLOSED], reason [engine failure [MergeException[java.lang.ArrayIndexOutOfBoundsException: 79001]; nested: ArrayIndexOutOfBoundsException[79001]; ]]\n[2014-10-10 18:30:30,994][WARN ][cluster.action.shard     ] [servername] [index][0] sending failed shard for [index][0], node[3cPPL9a5RTOL8UMpWLJBbQ], [P], s[STARTED], indexUUID [_na_], reason [engine failure, message [MergeException[java.lang.ArrayIndexOutOfBoundsException: 79001]; nested: ArrayIndexOutOfBoundsException[79001]; ]]\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}