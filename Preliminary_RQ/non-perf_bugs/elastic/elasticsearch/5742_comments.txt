[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40032734","html_url":"https://github.com/elastic/elasticsearch/issues/5742#issuecomment-40032734","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5742","id":40032734,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDMyNzM0","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2014-04-10T00:46:54Z","updated_at":"2014-04-10T00:46:54Z","author_association":"MEMBER","body":"You should be able to restore all indices that were successfully snapshotted except the incomplete index by excluding the incomplete index from the restore operation:\n\n```\n$ curl -XPOST \"localhost:9200/_snapshot/my_backup/snapshot_1/_restore\" -d '{\n    \"indices\": \"-corrupted_index\",\n    \"include_global_state\": false\n}'\n```\n\nThere is no way simple to force incomplete index to be restored at the moment. What type of failures do you see when you run the following command:\n\n```\n$ curl -XGET localhost:9200/_snapshot/repository_name/snapshot_name\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40034105","html_url":"https://github.com/elastic/elasticsearch/issues/5742#issuecomment-40034105","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5742","id":40034105,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDM0MTA1","user":{"login":"geekpete","id":2070843,"node_id":"MDQ6VXNlcjIwNzA4NDM=","avatar_url":"https://avatars2.githubusercontent.com/u/2070843?v=4","gravatar_id":"","url":"https://api.github.com/users/geekpete","html_url":"https://github.com/geekpete","followers_url":"https://api.github.com/users/geekpete/followers","following_url":"https://api.github.com/users/geekpete/following{/other_user}","gists_url":"https://api.github.com/users/geekpete/gists{/gist_id}","starred_url":"https://api.github.com/users/geekpete/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geekpete/subscriptions","organizations_url":"https://api.github.com/users/geekpete/orgs","repos_url":"https://api.github.com/users/geekpete/repos","events_url":"https://api.github.com/users/geekpete/events{/privacy}","received_events_url":"https://api.github.com/users/geekpete/received_events","type":"User","site_admin":false},"created_at":"2014-04-10T01:15:49Z","updated_at":"2014-04-10T01:15:49Z","author_association":"MEMBER","body":"I have it working. :)\n\nYou can adjust the metadata files in the snapshot to allow the restore to work.\n\nAfter restoring the incomplete index, I get an incomplete/uninitialisable shard that must be replaced with a blank one from a temporary index to get the cluster back to green (as I was able to prove the data for that shard was simply missing from the snapshot.) \n\nBut an override to the usual behaviour would be nice to do the following:\n-allow restoration of incomplete indexes from snapshots\n-provide the ability to zero out the data in bad/incomplete shards if the data is missing to ensure green state when restored\n-provide detailed feedback on the shards that have been reset to blank and how much data and how many documents were lost\n\nI do realise that once again my case is probably an edge case so not that high priority compared to other features/bugs. :)\n\nThanks.\n","performed_via_github_app":null}]