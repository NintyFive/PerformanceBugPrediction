{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10967","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10967/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10967/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10967/events","html_url":"https://github.com/elastic/elasticsearch/issues/10967","id":73140184,"node_id":"MDU6SXNzdWU3MzE0MDE4NA==","number":10967,"title":"Log Storm on Bad Query","user":{"login":"rossbrower","id":12072726,"node_id":"MDQ6VXNlcjEyMDcyNzI2","avatar_url":"https://avatars3.githubusercontent.com/u/12072726?v=4","gravatar_id":"","url":"https://api.github.com/users/rossbrower","html_url":"https://github.com/rossbrower","followers_url":"https://api.github.com/users/rossbrower/followers","following_url":"https://api.github.com/users/rossbrower/following{/other_user}","gists_url":"https://api.github.com/users/rossbrower/gists{/gist_id}","starred_url":"https://api.github.com/users/rossbrower/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rossbrower/subscriptions","organizations_url":"https://api.github.com/users/rossbrower/orgs","repos_url":"https://api.github.com/users/rossbrower/repos","events_url":"https://api.github.com/users/rossbrower/events{/privacy}","received_events_url":"https://api.github.com/users/rossbrower/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-05-04T22:04:08Z","updated_at":"2015-05-05T17:30:10Z","closed_at":"2015-05-05T08:30:29Z","author_association":"NONE","active_lock_reason":null,"body":"I am seeing massive log spam on my servers with 1.5.2. The errors below are resulting in up to 10 GB log files for a given day. It seems like a pretty vicious logging loop. I will certainly delete this query as a temporary workaround but a single \"bad\" search should not allow this kind of storm to happen.\n\n[2015-05-04 14:53:00,768][DEBUG][action.search.type       ] [White Fang] [probes][0], node[aZkN-qLtSHyUpn08VqAN6A], [R], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@a5cc7e7] lastShard [true]\norg.elasticsearch.transport.RemoteTransportException: [Ecstasy][inet[/192.168.102.135:9300]][indices:data/read/search[phase/query]]\nCaused by: org.elasticsearch.search.SearchParseException: [probes][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\"filter\":{\"bool\":{\"must\":[{\"range\":{\"@timestamp\":{\"gt\":\"now-61s\"}}},{\"term\":{\"_type\":\"custom_win32_perfformatteddata_perfos_memory\"}},{\"script\":{\"lang\":\"expression\",\"script\":\"doc['custom_win32_perfformatteddata_perfos_memory.AvailableMBytes'].value \\* 1000000.0 / doc['custom_win32_perfformatteddata_perfos_memory.TotalPhysicalMemory'].value < 0.1\"}}]}},\"size\":10}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:721)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:557)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:529)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:291)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:776)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:767)\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:277)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:36)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.expression.ExpressionScriptCompilationException: Field [custom_win32_perfformatteddata_perfos_memory.AvailableMBytes] used in expression does not exist in mappings\n    at org.elasticsearch.script.expression.ExpressionScriptEngineService.search(ExpressionScriptEngineService.java:129)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:432)\n    at org.elasticsearch.index.query.ScriptFilterParser$ScriptFilter.<init>(ScriptFilterParser.java:135)\n    at org.elasticsearch.index.query.ScriptFilterParser.parse(ScriptFilterParser.java:114)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:368)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:349)\n    at org.elasticsearch.index.query.BoolFilterParser.parse(BoolFilterParser.java:92)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:368)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:349)\n    at org.elasticsearch.index.query.IndexQueryParserService.parseInnerFilter(IndexQueryParserService.java:295)\n    at org.elasticsearch.search.query.PostFilterParseElement.parse(PostFilterParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:705)\n    ... 10 more\n[2015-05-04 14:53:00,768][DEBUG][action.search.type       ] [White Fang] [issues-2015.05.01][1], node[aZkN-qLtSHyUpn08VqAN6A], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@a5cc7e7] lastShard [true]\norg.elasticsearch.transport.RemoteTransportException: [Ecstasy][inet[/192.168.102.135:9300]][indices:data/read/search[phase/query]]\nCaused by: org.elasticsearch.search.SearchParseException: [issues-2015.05.01][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\"filter\":{\"bool\":{\"must\":[{\"range\":{\"@timestamp\":{\"gt\":\"now-61s\"}}},{\"term\":{\"_type\":\"custom_win32_perfformatteddata_perfos_memory\"}},{\"script\":{\"lang\":\"expression\",\"script\":\"doc['custom_win32_perfformatteddata_perfos_memory.AvailableMBytes'].value \\* 1000000.0 / doc['custom_win32_perfformatteddata_perfos_memory.TotalPhysicalMemory'].value < 0.1\"}}]}},\"size\":10}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:721)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:557)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:529)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:291)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:776)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:767)\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:277)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:36)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.expression.ExpressionScriptCompilationException: Field [custom_win32_perfformatteddata_perfos_memory.AvailableMBytes] used in expression does not exist in mappings\n    at org.elasticsearch.script.expression.ExpressionScriptEngineService.search(ExpressionScriptEngineService.java:129)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:432)\n    at org.elasticsearch.index.query.ScriptFilterParser$ScriptFilter.<init>(ScriptFilterParser.java:135)\n    at org.elasticsearch.index.query.ScriptFilterParser.parse(ScriptFilterParser.java:114)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:368)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:349)\n    at org.elasticsearch.index.query.BoolFilterParser.parse(BoolFilterParser.java:92)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:368)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:349)\n    at org.elasticsearch.index.query.IndexQueryParserService.parseInnerFilter(IndexQueryParserService.java:295)\n    at org.elasticsearch.search.query.PostFilterParseElement.parse(PostFilterParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:705)\n    ... 10 more\n[2015-05-04 14:53:00,768][DEBUG][action.search.type       ] [White Fang] [secrets][2], node[aZkN-qLtSHyUpn08VqAN6A], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@a5cc7e7] lastShard [true]\norg.elasticsearch.transport.RemoteTransportException: [Ecstasy][inet[/192.168.102.135:9300]][indices:data/read/search[phase/query]]\nCaused by: org.elasticsearch.search.SearchParseException: [secrets][2]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\"filter\":{\"bool\":{\"must\":[{\"range\":{\"@timestamp\":{\"gt\":\"now-61s\"}}},{\"term\":{\"_type\":\"custom_win32_perfformatteddata_perfos_memory\"}},{\"script\":{\"lang\":\"expression\",\"script\":\"doc['custom_win32_perfformatteddata_perfos_memory.AvailableMBytes'].value \\* 1000000.0 / doc['custom_win32_perfformatteddata_perfos_memory.TotalPhysicalMemory'].value < 0.1\"}}]}},\"size\":10}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:721)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:557)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:529)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:291)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:776)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:767)\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:277)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:36)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.expression.ExpressionScriptCompilationException: Field [custom_win32_perfformatteddata_perfos_memory.AvailableMBytes] used in expression does not exist in mappings\n    at org.elasticsearch.script.expression.ExpressionScriptEngineService.search(ExpressionScriptEngineService.java:129)\n    at org.elasticsearch.script.ScriptService.search(ScriptService.java:432)\n    at org.elasticsearch.index.query.ScriptFilterParser$ScriptFilter.<init>(ScriptFilterParser.java:135)\n    at org.elasticsearch.index.query.ScriptFilterParser.parse(ScriptFilterParser.java:114)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:368)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:349)\n    at org.elasticsearch.index.query.BoolFilterParser.parse(BoolFilterParser.java:92)\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:368)\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:349)\n    at org.elasticsearch.index.query.IndexQueryParserService.parseInnerFilter(IndexQueryParserService.java:295)\n    at org.elasticsearch.search.query.PostFilterParseElement.parse(PostFilterParseElement.java:33)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:705)\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}