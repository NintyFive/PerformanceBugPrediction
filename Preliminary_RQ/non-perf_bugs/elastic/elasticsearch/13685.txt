{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13685","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13685/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13685/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13685/events","html_url":"https://github.com/elastic/elasticsearch/issues/13685","id":107556387,"node_id":"MDU6SXNzdWUxMDc1NTYzODc=","number":13685,"title":"Possibly leak of lock, if plugin hits exception on close()","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"labels":[{"id":146832994,"node_id":"MDU6TGFiZWwxNDY4MzI5OTQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Plugins","name":":Core/Infra/Plugins","color":"0e8a16","default":false,"description":"Plugin API and infrastructure"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":246685314,"node_id":"MDU6TGFiZWwyNDY2ODUzMTQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.0.0-alpha1","name":"v5.0.0-alpha1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2015-09-21T17:07:28Z","updated_at":"2016-02-01T09:31:53Z","closed_at":"2016-02-01T09:17:58Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"here is how to reproduce (i know, kinda crazy):\n1. force GroovyScriptEngineService to make NPE on close:\n\n```\n+++ b/core/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java\n@@ -99,17 +99,19 @@ public class GroovyScriptEngineService extends AbstractComponent implements Scri\n         }\n\n         // Groovy class loader to isolate Groovy-land code\n-        this.loader = new GroovyClassLoader(getClass().getClassLoader(), config);\n+        this.loader = null; //new GroovyClassLoader(getClass().getClassLoader(), config);\n```\n1. mvn install -DskipTests from core/\n2. mvn test from plugins/cloud-azure. \n\nLeakFS detects a file leak:\n\n```\nThrowable #1: java.lang.RuntimeException: file handle leaks: [FileChannel(/home/rmuir/workspace/elasticsearch/plugins/cloud-azure/target/J0/temp/org.elasticsearch.index.store.SmbMMapFsTests_2C60FEE3D73A0680-001/tempDir-001/d0/SUITE-CHILD_VM=[0]-CLUSTER_SEED=[-1301520842927563395]-HASH=[11EC1C68B1C5F]-cluster/nodes/2/node.lock), \n```\n\nThe issue might just be our test harness stuff, but my concern is it could happen \"for real\" too. In the case of SimpleFSLock it could be annoying (user has to then remove lock file).\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}