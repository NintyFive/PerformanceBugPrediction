{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3795","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3795/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3795/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3795/events","html_url":"https://github.com/elastic/elasticsearch/issues/3795","id":20187566,"node_id":"MDU6SXNzdWUyMDE4NzU2Ng==","number":3795,"title":"geo_shape filter yields 0 results for exact point match.","user":{"login":"olimcc","id":842983,"node_id":"MDQ6VXNlcjg0Mjk4Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/842983?v=4","gravatar_id":"","url":"https://api.github.com/users/olimcc","html_url":"https://github.com/olimcc","followers_url":"https://api.github.com/users/olimcc/followers","following_url":"https://api.github.com/users/olimcc/following{/other_user}","gists_url":"https://api.github.com/users/olimcc/gists{/gist_id}","starred_url":"https://api.github.com/users/olimcc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/olimcc/subscriptions","organizations_url":"https://api.github.com/users/olimcc/orgs","repos_url":"https://api.github.com/users/olimcc/repos","events_url":"https://api.github.com/users/olimcc/events{/privacy}","received_events_url":"https://api.github.com/users/olimcc/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2013-09-27T18:42:08Z","updated_at":"2014-08-08T17:39:05Z","closed_at":"2014-08-08T17:39:05Z","author_association":"NONE","active_lock_reason":null,"body":"Given a document with a point geometry attribute, performing a geo_shape filter with that exact point as the query coordinate yields no results. I've included a reproducible case below.\n\nI've also verified that the same query successfully yields results if the indexed shapes are polygons, and that providing a polygon as the query coordinates will correctly find the point document.\n\nES Version: 0.90.5\n\n```\n# create a test index\ncurl -XPUT  http://localhost:9200/test\n\n# specify mapping with geo_shape type\ncurl -XPUT http://localhost:9200/test/testtype/_mapping -d'{\n    \"testtype\": {\n    \"properties\": {\n        \"geometry\": {\n            \"type\": \"geo_shape\",\n            \"tree\": \"quadtree\",\n            \"tree_levels\": \"14\"\n        }\n    }\n    }\n}'\n\n# create a point document \ncurl -XPUT http://localhost:9200/test/testtype/doc1 -d'\n{\n    \"id\": \"doc1\",\n    \"geometry\": {\n        \"type\": \"point\",\n        \"coordinates\": [-88.31, 40.05]\n    }\n}'\n\n# perform a point search, exact match for the inserted document coordinate\n# yields 0 results\ncurl -XPOST \"http://localhost:9200/test/testtype/_search\" -d'\n{\n    \"query\": {\n        \"filtered\": {\n            \"query\": {\n                \"match_all\": {}\n            },\n            \"filter\": {\n                \"geo_shape\": {\n                    \"geometry\": {\n                        \"shape\": {\n                            \"type\": \"point\",\n                            \"coordinates\": [-88.31, 40.05]\n                        }\n                    }\n                }\n            }\n        }\n    }\n}'\n\n# envelope search around the area yields the doc \ncurl -XPOST \"http://localhost:9200/test/testtype/_search/\" -d'\n{\n    \"query\": {\n        \"filtered\": {\n            \"query\": {\n                \"match_all\": {}\n            },\n            \"filter\": {\n                \"geo_shape\": {\n                    \"geometry\": {\n                        \"shape\": {\n                            \"type\": \"envelope\",\n                            \"coordinates\": [\n                                [-88.32, 40.06],\n                                [-88.31, 40.05]\n                            ]\n                        }\n                    }\n                }\n            }\n        }\n    }\n}'\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}