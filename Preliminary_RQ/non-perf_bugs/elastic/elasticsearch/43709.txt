{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43709","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43709/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43709/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43709/events","html_url":"https://github.com/elastic/elasticsearch/issues/43709","id":461667281,"node_id":"MDU6SXNzdWU0NjE2NjcyODE=","number":43709,"title":"OpenID Connect realm fails when special characters are present in client id","user":{"login":"cpmoore","id":22562764,"node_id":"MDQ6VXNlcjIyNTYyNzY0","avatar_url":"https://avatars2.githubusercontent.com/u/22562764?v=4","gravatar_id":"","url":"https://api.github.com/users/cpmoore","html_url":"https://github.com/cpmoore","followers_url":"https://api.github.com/users/cpmoore/followers","following_url":"https://api.github.com/users/cpmoore/following{/other_user}","gists_url":"https://api.github.com/users/cpmoore/gists{/gist_id}","starred_url":"https://api.github.com/users/cpmoore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cpmoore/subscriptions","organizations_url":"https://api.github.com/users/cpmoore/orgs","repos_url":"https://api.github.com/users/cpmoore/repos","events_url":"https://api.github.com/users/cpmoore/events{/privacy}","received_events_url":"https://api.github.com/users/cpmoore/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1410529450,"node_id":"MDU6TGFiZWwxNDEwNTI5NDUw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.1","name":"v7.2.1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"assignees":[{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-06-27T17:53:45Z","updated_at":"2019-07-02T10:34:39Z","closed_at":"2019-07-02T10:34:39Z","author_association":"NONE","active_lock_reason":null,"body":"If special characters are present in the client id, the token request fails with the following error\r\n\r\n```\r\n[2019-06-27T08:33:56,252][TRACE][o.e.x.s.a.o.OpenIdConnectAuthenticator] [node1] Received Token Response from OP with status [400] and content [{\"error\":\"invalid_request\",\"error_description\":\"MSIS9692: Received invalid OAuth request. The Basic Authorization header must have ClientID and ClientSecret UrlEncoded then separated by \\u0027:\\u0027.\"}]\r\n```\r\nThe original client_id was in the format of `http://adfshost/client`, after being changed to a client id without / or : in it, authentication started working.\r\n\r\nLooking at the code for the realm it appears as if the client id and secret are not being url encoded when set as the basic authentication header.  \r\nhttps://github.com/elastic/elasticsearch/blob/46d5d68bbbb8dd68720aec2ac186061ab63d31dc/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authc/oidc/OpenIdConnectAuthenticator.java#L468-L470\r\n\r\n","closed_by":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"performed_via_github_app":null}