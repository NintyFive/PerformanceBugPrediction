{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31853","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31853/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31853/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31853/events","html_url":"https://github.com/elastic/elasticsearch/issues/31853","id":338844967,"node_id":"MDU6SXNzdWUzMzg4NDQ5Njc=","number":31853,"title":"XContent: Trying to use a writer with date formats results in serialization issues","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":30486044,"node_id":"MDU6TGFiZWwzMDQ4NjA0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eregression","name":">regression","color":"d7e102","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2018-07-06T08:09:35Z","updated_at":"2018-08-29T08:00:18Z","closed_at":"2018-08-29T08:00:18Z","author_association":"MEMBER","active_lock_reason":null,"body":"fails under 6.3.1/6.3.0. \r\n\r\n```\r\nPUT foo/bar/1?refresh=true\r\n{\r\n  \"key\" : 123\r\n}\r\n\r\nGET foo/_search\r\n{\r\n  \"script_fields\": {\r\n    \"custom\": {\r\n      \"script\": {\r\n        \"source\" : \"return Instant.ofEpochMilli(123)\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nresults in\r\n\r\n```\r\n# GET foo/_search\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"cannot write xcontent for unknown value of type class java.time.Instant\"\r\n      }\r\n    ],\r\n    \"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"cannot write xcontent for unknown value of type class java.time.Instant\"\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nexact stack trace\r\n\r\n```\r\njava.lang.IllegalArgumentException: cannot write xcontent for unknown value of type class java.time.Instant\r\n\tat org.elasticsearch.common.xcontent.XContentBuilder.unknownValue(XContentBuilder.java:755)\r\n\tat org.elasticsearch.common.xcontent.XContentBuilder.value(XContentBuilder.java:726)\r\n\tat org.elasticsearch.common.document.DocumentField.toXContent(DocumentField.java:131)\r\n\tat org.elasticsearch.search.SearchHit.toInnerXContent(SearchHit.java:456)\r\n\tat org.elasticsearch.search.SearchHit.toXContent(SearchHit.java:398)\r\n\tat org.elasticsearch.search.SearchHits.toXContent(SearchHits.java:117)\r\n\tat org.elasticsearch.action.search.SearchResponseSections.toXContent(SearchResponseSections.java:106)\r\n\tat org.elasticsearch.action.search.SearchResponse.innerToXContent(SearchResponse.java:241)\r\n\tat org.elasticsearch.action.search.SearchResponse.toXContent(SearchResponse.java:221)\r\n\tat org.elasticsearch.rest.action.RestStatusToXContentListener.buildResponse(RestStatusToXContentListener.java:57)\r\n\tat org.elasticsearch.rest.action.RestStatusToXContentListener.buildResponse(RestStatusToXContentListener.java:33)\r\n\tat org.elasticsearch.rest.action.RestToXContentListener.buildResponse(RestToXContentListener.java:42)\r\n\tat org.elasticsearch.rest.action.RestToXContentListener.buildResponse(RestToXContentListener.java:34)\r\n\tat org.elasticsearch.rest.action.RestResponseListener.processResponse(RestResponseListener.java:37)\r\n\tat org.elasticsearch.rest.action.RestActionListener.onResponse(RestActionListener.java:47)\r\n\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:85)\r\n\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:81)\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onResponse(AbstractSearchAsyncAction.java:308)\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onResponse(AbstractSearchAsyncAction.java:48)\r\n\tat org.elasticsearch.action.search.FetchSearchPhase$3.run(FetchSearchPhase.java:212)\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:155)\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:148)\r\n\tat org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:118)\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:155)\r\n\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:148)\r\n\tat org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:205)\r\n\tat org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$2(FetchSearchPhase.java:104)\r\n\tat org.elasticsearch.action.search.CountedCollector.countDown(CountedCollector.java:53)\r\n\tat org.elasticsearch.action.search.CountedCollector.onResult(CountedCollector.java:64)\r\n\tat org.elasticsearch.action.search.FetchSearchPhase$2.innerOnResponse(FetchSearchPhase.java:165)\r\n\tat org.elasticsearch.action.search.FetchSearchPhase$2.innerOnResponse(FetchSearchPhase.java:162)\r\n\tat org.elasticsearch.action.search.SearchActionListener.onResponse(SearchActionListener.java:45)\r\n\tat org.elasticsearch.action.search.SearchActionListener.onResponse(SearchActionListener.java:29)\r\n\tat org.elasticsearch.action.ActionListenerResponseHandler.handleResponse(ActionListenerResponseHandler.java:46)\r\n\tat org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleResponse(SearchTransportService.java:518)\r\n\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1096)\r\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.processResponse(TransportService.java:1165)\r\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1155)\r\n\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1144)\r\n\tat org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:54)\r\n\tat org.elasticsearch.action.search.SearchTransportService$11.messageReceived(SearchTransportService.java:441)\r\n\tat org.elasticsearch.action.search.SearchTransportService$11.messageReceived(SearchTransportService.java:437)\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler$1.doRun(SecurityServerTransportInterceptor.java:259)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:317)\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66)\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:664)\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:725)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n\tat java.base/java.lang.Thread.run(Thread.java:844)\r\n\"\r\n```","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}