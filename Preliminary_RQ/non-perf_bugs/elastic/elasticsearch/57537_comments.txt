[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/638073855","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-638073855","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":638073855,"node_id":"MDEyOklzc3VlQ29tbWVudDYzODA3Mzg1NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-06-03T09:18:53Z","updated_at":"2020-06-03T09:18:53Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Search)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/638427829","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-638427829","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":638427829,"node_id":"MDEyOklzc3VlQ29tbWVudDYzODQyNzgyOQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2020-06-03T19:55:18Z","updated_at":"2020-06-03T19:55:18Z","author_association":"MEMBER","body":"I don't think we should tied this to the Kibana admin user. IMO the main question is whether we want to expose the metadata associated with an async search to any user. These metadata infos shouldn't contain any sensible information so I don't see why we couldn't. The following question is how should it be exposed, maybe an additional parameter on the get API  is enough ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/643751152","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-643751152","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":643751152,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Mzc1MTE1Mg==","user":{"login":"lizozom","id":3016806,"node_id":"MDQ6VXNlcjMwMTY4MDY=","avatar_url":"https://avatars1.githubusercontent.com/u/3016806?v=4","gravatar_id":"","url":"https://api.github.com/users/lizozom","html_url":"https://github.com/lizozom","followers_url":"https://api.github.com/users/lizozom/followers","following_url":"https://api.github.com/users/lizozom/following{/other_user}","gists_url":"https://api.github.com/users/lizozom/gists{/gist_id}","starred_url":"https://api.github.com/users/lizozom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lizozom/subscriptions","organizations_url":"https://api.github.com/users/lizozom/orgs","repos_url":"https://api.github.com/users/lizozom/repos","events_url":"https://api.github.com/users/lizozom/events{/privacy}","received_events_url":"https://api.github.com/users/lizozom/received_events","type":"User","site_admin":false},"created_at":"2020-06-14T11:03:42Z","updated_at":"2020-06-14T11:03:42Z","author_association":"NONE","body":"@jimczi note that when we do query for meta data - we will always do so for multiple objects (i.e. take all running background searches, and fetch their metadata).\r\n\r\nMaybe it's worth adding another route for that altogether?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/644154654","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-644154654","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":644154654,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NDE1NDY1NA==","user":{"login":"lizozom","id":3016806,"node_id":"MDQ6VXNlcjMwMTY4MDY=","avatar_url":"https://avatars1.githubusercontent.com/u/3016806?v=4","gravatar_id":"","url":"https://api.github.com/users/lizozom","html_url":"https://github.com/lizozom","followers_url":"https://api.github.com/users/lizozom/followers","following_url":"https://api.github.com/users/lizozom/following{/other_user}","gists_url":"https://api.github.com/users/lizozom/gists{/gist_id}","starred_url":"https://api.github.com/users/lizozom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lizozom/subscriptions","organizations_url":"https://api.github.com/users/lizozom/orgs","repos_url":"https://api.github.com/users/lizozom/repos","events_url":"https://api.github.com/users/lizozom/events{/privacy}","received_events_url":"https://api.github.com/users/lizozom/received_events","type":"User","site_admin":false},"created_at":"2020-06-15T14:03:18Z","updated_at":"2020-06-15T14:03:40Z","author_association":"NONE","body":"@jimczi I implemented the monitoring task I would like to run to track the completion of async requests.\r\nYou can see the place where I would like to query that new API here https://github.com/lizozom/kibana/pull/8/files#diff-462f5bdb3bd70cec29416a1967e9119fR44","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/681962684","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-681962684","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":681962684,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTk2MjY4NA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2020-08-27T13:52:37Z","updated_at":"2020-08-27T14:43:28Z","author_association":"CONTRIBUTOR","body":"> we will always do so for multiple objects\r\n\r\n@lizozom Do you need an API that provides metadata about a particular single async request? Or metadata about all async requests available?  \r\n\r\nOr perhaps you would like to submit to this API a list of several async requests IDs?\r\n\r\n---\r\nIf you just need metadata about a single async request, as @jimczi suggested we can reuse the same GET request with a `metadata` parameter:\r\n\r\n```js\r\nGET /_async_search/FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=?metadata=true\r\n```\r\n\r\nIn response we will get the same response as in GET request, but without  data sections (sections `hits`, `aggs`, `suggestions` will not be included).\r\n\r\n```js\r\n{\r\n  \"id\" : \"FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=\",\r\n  \"is_partial\" : true, \r\n  \"is_running\" : true, \r\n  \"start_time_in_millis\" : 1583945890986,\r\n  \"expiration_time_in_millis\" : 1584377890986, \r\n  \"response\" : {\r\n    \"took\" : 12144,\r\n    \"timed_out\" : false,\r\n    \"num_reduce_phases\" : 46, \r\n    \"_shards\" : {\r\n      \"total\" : 562, \r\n      \"successful\" : 188,\r\n      \"skipped\" : 0,\r\n      \"failed\" : 0\r\n    }\r\n  }\r\n}\r\n``` \r\n---\r\nFor an alternative where it is possible to get metadata about several async requests IDs, we can introduce a new endpoint – `metadata`:\r\n\r\n```js\r\nGET /_async_search/metadata\r\n{\r\n  \"async_search_ids\" : [\r\n      \"FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=\",\r\n      \"DnF1ZXJ5VGhlbkZldGNoBQAAAAAJFUFEaMkZ5QTVSTZSaVN3WlNFVmtlWHJsdzoxMDc=\"\r\n    ]\r\n}\r\n```\r\n\r\nand a response here will consists of several responses:\r\n```js\r\n{\r\n  \"took\": 0,\r\n  \"responses\": [\r\n    {\r\n      \"id\": \"FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=\",\r\n      \"is_partial\": true,\r\n      \"is_running\": true,\r\n      \"start_time_in_millis\": 1583945890986,\r\n      \"expiration_time_in_millis\": 1584377890986,\r\n      \"response\": {\r\n        \"took\": 12144,\r\n        \"timed_out\": false,\r\n        \"num_reduce_phases\": 46,\r\n        \"_shards\": {\r\n          \"total\": 562,\r\n          \"successful\": 188,\r\n          \"skipped\": 0,\r\n          \"failed\": 0\r\n        }\r\n      }\r\n    },\r\n    {\r\n      \"id\": \"DnF1ZXJ5VGhlbkZldGNoBQAAAAAJFUFEaMkZ5QTVSTZSaVN3WlNFVmtlWHJsdzoxMDc=\",\r\n      \"is_partial\": true,\r\n      \"is_running\": true,\r\n      \"start_time_in_millis\": 1583945890986,\r\n      \"expiration_time_in_millis\": 1584377890986,\r\n      \"response\": {\r\n        \"took\": 12144,\r\n        \"timed_out\": false,\r\n        \"num_reduce_phases\": 46,\r\n        \"_shards\": {\r\n          \"total\": 562,\r\n          \"successful\": 188,\r\n          \"skipped\": 0,\r\n          \"failed\": 0\r\n        }\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/682167098","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-682167098","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":682167098,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MjE2NzA5OA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2020-08-27T20:12:33Z","updated_at":"2020-08-27T20:12:33Z","author_association":"MEMBER","body":"thanks for your thoughts @mayya-sharipova ! I have a preference for a specific API, given that the functionality it offers differ quite a bit from that of the get async search API that is used to retrieve results. It is more of a way to poll for the `status` of the async search. Also, given that we want this functionality to require different permissions, it may make sense to make it its own endpoint and transport action that requires its own role.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/683757063","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-683757063","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":683757063,"node_id":"MDEyOklzc3VlQ29tbWVudDY4Mzc1NzA2Mw==","user":{"login":"lizozom","id":3016806,"node_id":"MDQ6VXNlcjMwMTY4MDY=","avatar_url":"https://avatars1.githubusercontent.com/u/3016806?v=4","gravatar_id":"","url":"https://api.github.com/users/lizozom","html_url":"https://github.com/lizozom","followers_url":"https://api.github.com/users/lizozom/followers","following_url":"https://api.github.com/users/lizozom/following{/other_user}","gists_url":"https://api.github.com/users/lizozom/gists{/gist_id}","starred_url":"https://api.github.com/users/lizozom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lizozom/subscriptions","organizations_url":"https://api.github.com/users/lizozom/orgs","repos_url":"https://api.github.com/users/lizozom/repos","events_url":"https://api.github.com/users/lizozom/events{/privacy}","received_events_url":"https://api.github.com/users/lizozom/received_events","type":"User","site_admin":false},"created_at":"2020-08-31T12:49:10Z","updated_at":"2020-08-31T12:49:10Z","author_association":"NONE","body":"@mayya-sharipova I think there is no single answer to this question:\r\n\r\nFrom the perspective of Kibana, having a bulk API would be better, as that would allow us grouping queries, at least per Background Session, and minimizing the number of requests to be made.\r\nFrom the perspective of simplicity for Elasticsearch, I assume, a per-async-search API is better, but then Kibana would be hitting it *a lot* more.\r\n\r\nSo as long as it's efficient enough for Elasticsearch, and as long as we can get the status of each async search somehow, then it's good.\r\n\r\nI do think that having the same route have different permissions based on the `metadata=true` option is a bit weird. Don't you think?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/684693191","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-684693191","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":684693191,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NDY5MzE5MQ==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2020-09-01T09:54:08Z","updated_at":"2020-09-01T09:54:08Z","author_association":"CONTRIBUTOR","body":"@javanna  @lizozom Thank you for your feedback. It makes sense to me.\r\n\r\nSo, let's have the following API that can provide the status of several async searches. This API will be accessible to any user. \r\n\r\n```js\r\nGET /_async_search/status\r\n{\r\n  \"async_search_ids\" : [\r\n      \"FmRldE8zREVEUzA2ZVpUeGs2ejJFUFEaMkZ5QTVrSTZSaVN3WlNFVmtlWHJsdzoxMDc=\",\r\n      \"DnF1ZXJ5VGhlbkZldGNoBQAAAAAJFUFEaMkZ5QTVSTZSaVN3WlNFVmtlWHJsdzoxMDc=\"\r\n    ]\r\n}\r\n```\r\n\r\n@jimczi  Do you have any objections/suggestions about this API? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/685788039","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-685788039","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":685788039,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NTc4ODAzOQ==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2020-09-02T14:50:36Z","updated_at":"2020-09-02T14:50:36Z","author_association":"CONTRIBUTOR","body":"I've chatted with @jimczi  and @javanna  offline, and we've decided for now on an API to  retrieve metadata about an individual async search:\r\n\r\n```js\r\nGET /_async_search/status/<id> \r\n```\r\n\r\nIn future, we will also consider retrieving metadata in bulk. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/687076120","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-687076120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":687076120,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzA3NjEyMA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2020-09-04T10:59:47Z","updated_at":"2020-09-04T10:59:47Z","author_association":"CONTRIBUTOR","body":"Forgot to say about permissions, I am thinking this endpoint should have \"cluster:monitor\" privilege, that `kibana_admin` user should also have. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/703308147","html_url":"https://github.com/elastic/elasticsearch/issues/57537#issuecomment-703308147","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57537","id":703308147,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMzMwODE0Nw==","user":{"login":"lizozom","id":3016806,"node_id":"MDQ6VXNlcjMwMTY4MDY=","avatar_url":"https://avatars1.githubusercontent.com/u/3016806?v=4","gravatar_id":"","url":"https://api.github.com/users/lizozom","html_url":"https://github.com/lizozom","followers_url":"https://api.github.com/users/lizozom/followers","following_url":"https://api.github.com/users/lizozom/following{/other_user}","gists_url":"https://api.github.com/users/lizozom/gists{/gist_id}","starred_url":"https://api.github.com/users/lizozom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lizozom/subscriptions","organizations_url":"https://api.github.com/users/lizozom/orgs","repos_url":"https://api.github.com/users/lizozom/repos","events_url":"https://api.github.com/users/lizozom/events{/privacy}","received_events_url":"https://api.github.com/users/lizozom/received_events","type":"User","site_admin":false},"created_at":"2020-10-04T20:01:47Z","updated_at":"2020-10-04T20:01:47Z","author_association":"NONE","body":"@mayya-sharipova permissions sound ok.\r\nAnd as a first phase, the individual API is ok.\r\n\r\nThanks :+1: ","performed_via_github_app":null}]