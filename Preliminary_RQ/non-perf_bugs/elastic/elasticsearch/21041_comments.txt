[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255207169","html_url":"https://github.com/elastic/elasticsearch/issues/21041#issuecomment-255207169","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041","id":255207169,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTIwNzE2OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-10-20T19:40:27Z","updated_at":"2016-10-20T19:40:27Z","author_association":"MEMBER","body":"@dadoonet Can you again please run with `-Djava.security.debug=access,failure` so we can see what exact method is trying to read the file (and then we can look at the SDK and see if it will be cached after the first call, which is what I expect).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255318550","html_url":"https://github.com/elastic/elasticsearch/issues/21041#issuecomment-255318550","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041","id":255318550,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTMxODU1MA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-10-21T07:58:12Z","updated_at":"2016-10-21T07:58:23Z","author_association":"MEMBER","body":"```\naccess: access denied (\"java.io.FilePermission\" \"/home/ubuntu/.aws/credentials\" \"read\")\njava.lang.Exception: Stack trace\n    at java.lang.Thread.dumpStack(Thread.java:1329)\n    at java.security.AccessControlContext.checkPermission(AccessControlContext.java:462)\n    at java.security.AccessController.checkPermission(AccessController.java:884)\n    at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\n    at java.lang.SecurityManager.checkRead(SecurityManager.java:888)\n    at java.io.File.exists(File.java:814)\n    at com.amazonaws.auth.profile.ProfilesConfigFile.getCredentialProfilesFile(ProfilesConfigFile.java:200)\n    at com.amazonaws.auth.profile.ProfilesConfigFile.<init>(ProfilesConfigFile.java:96)\n    at com.amazonaws.auth.profile.ProfileCredentialsProvider.getCredentials(ProfileCredentialsProvider.java:159)\n    at com.amazonaws.auth.AWSCredentialsProviderChain.getCredentials(AWSCredentialsProviderChain.java:115)\n    at com.amazonaws.services.ec2.AmazonEC2Client.invoke(AmazonEC2Client.java:11117)\n    at com.amazonaws.services.ec2.AmazonEC2Client.describeInstances(AmazonEC2Client.java:5403)\n    at org.elasticsearch.discovery.ec2.AwsEc2UnicastHostsProvider.fetchDynamicNodes(AwsEc2UnicastHostsProvider.java:116)\n    at org.elasticsearch.discovery.ec2.AwsEc2UnicastHostsProvider$DiscoNodesCache.refresh(AwsEc2UnicastHostsProvider.java:234)\n    at org.elasticsearch.discovery.ec2.AwsEc2UnicastHostsProvider$DiscoNodesCache.refresh(AwsEc2UnicastHostsProvider.java:219)\n    at org.elasticsearch.common.util.SingleObjectCache.getOrRefresh(SingleObjectCache.java:54)\n    at org.elasticsearch.discovery.ec2.AwsEc2UnicastHostsProvider.buildDynamicNodes(AwsEc2UnicastHostsProvider.java:102)\n    at org.elasticsearch.discovery.zen.ping.unicast.UnicastZenPing.sendPings(UnicastZenPing.java:358)\n    at org.elasticsearch.discovery.zen.ping.unicast.UnicastZenPing$1$1.doRun(UnicastZenPing.java:276)\n    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\nSo yes it is cached but after some time, it's checked again according to their code:\n\n``` java\n    public AWSCredentials getCredentials() {\n        if (profilesConfigFile == null) {\n            synchronized (this) {\n                if (profilesConfigFile == null) {\n                    profilesConfigFile = new ProfilesConfigFile();\n                    lastRefreshed = System.nanoTime();\n                }\n            }\n        }\n\n        // Periodically check if the file on disk has been modified\n        // since we last read it.\n        //\n        // For active applications, only have one thread block.\n        // For applications that use this method in bursts, ensure the\n        // credentials are never too stale.\n        long now = System.nanoTime();\n        long age = now - lastRefreshed;\n        if (age > refreshForceIntervalNanos) {\n            refresh();\n        } else if (age > refreshIntervalNanos) {\n            if (refreshSemaphore.tryAcquire()) {\n                try {\n                    refresh();\n                } finally {\n                    refreshSemaphore.release();\n                }\n            }\n        }\n\n        return profilesConfigFile.getCredentials(profileName);\n    }\n```\n\nSo we can probably make it work when the plugin is loaded but then it will probably fail again later, right?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/268975224","html_url":"https://github.com/elastic/elasticsearch/issues/21041#issuecomment-268975224","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041","id":268975224,"node_id":"MDEyOklzc3VlQ29tbWVudDI2ODk3NTIyNA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-12-23T11:13:48Z","updated_at":"2016-12-23T11:13:48Z","author_association":"MEMBER","body":"@rjernst Any opinion on this one?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269044176","html_url":"https://github.com/elastic/elasticsearch/issues/21041#issuecomment-269044176","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041","id":269044176,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTA0NDE3Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-12-23T20:50:12Z","updated_at":"2016-12-23T20:50:12Z","author_association":"MEMBER","body":"I don't think we should be using any credentials files. With the new key store tool, all secure settings should be in there. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/269046361","html_url":"https://github.com/elastic/elasticsearch/issues/21041#issuecomment-269046361","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041","id":269046361,"node_id":"MDEyOklzc3VlQ29tbWVudDI2OTA0NjM2MQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-12-23T21:15:06Z","updated_at":"2016-12-23T21:15:06Z","author_association":"MEMBER","body":"I agree. Thanks for confirming.\r\nI'll remove this from the credential chain so we won't try it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/272812504","html_url":"https://github.com/elastic/elasticsearch/issues/21041#issuecomment-272812504","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041","id":272812504,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjgxMjUwNA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-01-16T09:31:38Z","updated_at":"2017-01-16T09:31:38Z","author_association":"MEMBER","body":"Closing in favor of #22567 which will take care of that.","performed_via_github_app":null}]