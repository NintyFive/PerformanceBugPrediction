{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33954","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33954/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33954/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33954/events","html_url":"https://github.com/elastic/elasticsearch/issues/33954","id":362674202,"node_id":"MDU6SXNzdWUzNjI2NzQyMDI=","number":33954,"title":"[CCR] Tweak the retry-able error list","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"labels":[{"id":912824565,"node_id":"MDU6TGFiZWw5MTI4MjQ1NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CCR","name":":Distributed/CCR","color":"0e8a16","default":false,"description":"Issues around the Cross Cluster State Replication features"}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-09-21T15:47:34Z","updated_at":"2018-09-28T11:33:10Z","closed_at":"2018-09-28T11:33:10Z","author_association":"MEMBER","active_lock_reason":null,"body":"When a shard follow tasks encounters an error, it determines whether it is a retry-able error or a non retry-able error. A retry-able error is retried in back off like manner. A non retry-able error is not retried and fails the shard follow task.\r\n\r\nThe follow list of errors is retried at the moment:\r\n* java.net.ConnectException\r\n* java.nio.ClosedChannelException\r\n* \"Connecion reset\" (any error with this message)\r\n* \"connection was aborted\" (any exception with this message)\r\n* \"forcibly closed\" (any exception with this message)\r\n* \"Broken pipe\" (any exception with this message)\r\n* \"Connection timed out\" (any exception with this message)\r\n* \"Socket is closed\" (any exception with this message)\r\n* \"Socket closed\" (any exception with this message)\r\n* ShardNotFoundException\r\n* IndexNotFoundException\r\n* IllegalIndexShardStateException\r\n* NoShardAvailableActionException\r\n* UnavailableShardsException\r\n* AlreadyClosedException\r\n\r\nI think we should make the following changes to this list of retry-able errors:\r\n* Add ElasticsearchSecurityException. For in the case the current user has insufficient privileges while an index is being followed. Prior to following ccr checks whether the current user has sufficient privileges and if not the follow api fails with an error. \r\n* Add Index block exception. If the leader index gets closed, this exception is returned. \r\n* Add ClusterBlockException service unavailable. In case for example the leader cluster is without elected master.\r\n* Remove IndexNotFoundException. If the leader / follower index has been deleted, ccr will need to stop the shard follow tasks with an error.\r\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}