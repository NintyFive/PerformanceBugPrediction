{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29805","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29805/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29805/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29805/events","html_url":"https://github.com/elastic/elasticsearch/issues/29805","id":317448094,"node_id":"MDU6SXNzdWUzMTc0NDgwOTQ=","number":29805,"title":"[CI] UpgradeClusterClientYamlTestSuiteIT fails after encountering master_not_discovered_exception","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"assignees":[{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2017-08-11T21:18:19Z","updated_at":"2018-04-25T12:43:21Z","closed_at":"2018-04-25T12:43:20Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"*Original comment by @andyb-elastic:*\n\nLINK REDACTED\r\n\r\nTests\r\n\r\n```\r\nold_cluster/10_basic/Index data and search on the old cluster\r\nold_cluster/10_basic/Index data and search on the old cluster\r\nold_cluster/10_basic/Index data and search on the old cluster\r\nold_cluster/20_security/Verify native store security actions\r\nold_cluster/30_ml_jobs_crud/Put job on the old cluster and post some data\r\nold_cluster/30_ml_jobs_crud/Put job on the old cluster and post some data\r\nold_cluster/30_ml_jobs_crud/Put job on the old cluster and post some data\r\nold_cluster/40_ml_datafeed_crud/Put job and datafeed in old cluster\r\nold_cluster/40_ml_datafeed_crud/Put job and datafeed in old cluster\r\nold_cluster/40_ml_datafeed_crud/Put job and datafeed in old cluster\r\n```\r\n\r\n```\r\nREPRODUCE WITH: gradle :x-pack-elasticsearch:qa:rolling-upgrade:with-system-key:v5.6.0-SNAPSHOT#oldClusterTestRunner \\\r\n  -Dtests.seed=EA73CDD1DB804652 \\\r\n  -Dtests.class=org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=old_cluster/30_ml_jobs_crud/Put job on the old cluster and post some data}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=fi \\\r\n  -Dtests.timezone=Brazil/Acre \\\r\n  -Dtests.rest.suite=old_cluster\r\n\r\nREPRODUCE WITH: gradle :x-pack-elasticsearch:qa:rolling-upgrade:with-system-key:v5.6.0-SNAPSHOT#oldClusterTestRunner \\\r\n  -Dtests.seed=EA73CDD1DB804652 \\\r\n  -Dtests.class=org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=old_cluster/30_ml_jobs_crud/Put job on the old cluster and post some data}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=fi \\\r\n  -Dtests.timezone=Brazil/Acre \\\r\n  -Dtests.rest.suite=old_cluster\r\n\r\nREPRODUCE WITH: gradle :x-pack-elasticsearch:qa:rolling-upgrade:with-system-key:v5.6.0-SNAPSHOT#oldClusterTestRunner \\\r\n  -Dtests.seed=EA73CDD1DB804652 \\\r\n  -Dtests.class=org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=old_cluster/30_ml_jobs_crud/Put job on the old cluster and post some data}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=fi \\\r\n  -Dtests.timezone=Brazil/Acre \\\r\n  -Dtests.rest.suite=old_cluster\r\n\r\nREPRODUCE WITH: gradle :x-pack-elasticsearch:qa:rolling-upgrade:with-system-key:v5.6.0-SNAPSHOT#oldClusterTestRunner \\\r\n  -Dtests.seed=EA73CDD1DB804652 \\\r\n  -Dtests.class=org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=old_cluster/40_ml_datafeed_crud/Put job and datafeed in old cluster}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=fi \\\r\n  -Dtests.timezone=Brazil/Acre \\\r\n  -Dtests.rest.suite=old_cluster\r\n```\r\n\r\nMost of the responses are 503 and look like this\r\n\r\n```\r\n > \tSuppressed: java.net.ConnectException: Connection refused\r\n   > \t\tat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)\r\n   > \t\tat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvent(DefaultConnectingIOReactor.java:171)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvents(DefaultConnectingIOReactor.java:145)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.reactor.AbstractMultiworkerIOReactor.execute(AbstractMultiworkerIOReactor.java:348)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.conn.PoolingNHttpClientConnectionManager.execute(PoolingNHttpClientConnectionManager.java:192)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.client.CloseableHttpAsyncClientBase$1.run(CloseableHttpAsyncClientBase.java:64)\r\n   > \t\t... 1 moreThrowable LINK REDACTED: org.elasticsearch.client.ResponseException: GET http://[::1]:41863_snapshot/_all: HTTP/1.1 503 Service Unavailable\r\n   > {\"error\":{\"root_cause\":[{\"type\":\"master_not_discovered_exception\",\"reason\":null}],\"type\":\"master_not_discovered_exception\",\"reason\":null},\"status\":503}\r\n   > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:354)\r\n   > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:343)\r\n   > \tat org.elasticsearch.client.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n   > \tat org.elasticsearch.client.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n   > \tat org.elasticsearch.client.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n   > \tat org.elasticsearch.client.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n   > \tat org.elasticsearch.client.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n   > \tat org.elasticsearch.client.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n   > \tat org.elasticsearch.client.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n   > \tat org.elasticsearch.client.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n   > \tat org.elasticsearch.client.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n   > \tat org.elasticsearch.client.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n   > \tat org.elasticsearch.client.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n   > \tat org.elasticsearch.client.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n   > \tat org.elasticsearch.client.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n   > \tat org.elasticsearch.client.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > \tSuppressed: java.net.ConnectException: Connection refused\r\n   > \t\tat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)\r\n   > \t\tat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvent(DefaultConnectingIOReactor.java:171)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvents(DefaultConnectingIOReactor.java:145)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.reactor.AbstractMultiworkerIOReactor.execute(AbstractMultiworkerIOReactor.java:348)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.conn.PoolingNHttpClientConnectionManager.execute(PoolingNHttpClientConnectionManager.java:192)\r\n   > \t\tat org.elasticsearch.client.http.impl.nio.client.CloseableHttpAsyncClientBase$1.run(CloseableHttpAsyncClientBase.java:64)\r\n   > \t\t... 1 moreThrowable LINK REDACTED: java.lang.NullPointerException\r\n```","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}