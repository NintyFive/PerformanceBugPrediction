{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20359","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20359/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20359/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20359/events","html_url":"https://github.com/elastic/elasticsearch/issues/20359","id":175448449,"node_id":"MDU6SXNzdWUxNzU0NDg0NDk=","number":20359,"title":"Missing documents from Percolation requests","user":{"login":"motherhubbard","id":3320683,"node_id":"MDQ6VXNlcjMzMjA2ODM=","avatar_url":"https://avatars0.githubusercontent.com/u/3320683?v=4","gravatar_id":"","url":"https://api.github.com/users/motherhubbard","html_url":"https://github.com/motherhubbard","followers_url":"https://api.github.com/users/motherhubbard/followers","following_url":"https://api.github.com/users/motherhubbard/following{/other_user}","gists_url":"https://api.github.com/users/motherhubbard/gists{/gist_id}","starred_url":"https://api.github.com/users/motherhubbard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/motherhubbard/subscriptions","organizations_url":"https://api.github.com/users/motherhubbard/orgs","repos_url":"https://api.github.com/users/motherhubbard/repos","events_url":"https://api.github.com/users/motherhubbard/events{/privacy}","received_events_url":"https://api.github.com/users/motherhubbard/received_events","type":"User","site_admin":false},"labels":[{"id":156502592,"node_id":"MDU6TGFiZWwxNTY1MDI1OTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Percolator","name":":Search/Percolator","color":"0e8a16","default":false,"description":"Reverse search: find queries that match a document"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2016-09-07T08:56:24Z","updated_at":"2016-09-14T10:23:55Z","closed_at":"2016-09-14T10:23:55Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: \n\n2.3.2\n\n**Plugins installed**: \n\n[]\n\n**JVM version**: \n\njava version \"1.8.0_91\"\nJava(TM) SE Runtime Environment (build 1.8.0_91-b14)\nJava HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode\n\n**OS version**:\n\nCentOS Linux release 7.2.1511 (Core)\n\n**Description of the problem including expected versus actual behavior**:\n\nWe are submitting a percolation request to potentially multiple indices in the form of a POST to:\n/index1,index2,index3/type/_percolate\n`{\n    \"doc\": {\n         Our doc\n    }\n}`\n\nWe have noticed that percolations sometimes do not hit on all the queries they should. Also when this happens the shard counts in the response show some shards have not contributed to the result (ie total != success + failed). There are no messages in the logs of use. \n\nIf I manually POST the document to the index hosting the queries that are missing they are then correctly returned.\nIf I manually post the request to multiple indices the shards are also correctly returned and the matching queries are as expected.\n\nAn example broken response is shown below:\n`{\"took\":99,\"_shards\":{\"total\":15,\"successful\":5,\"failed\":0},\"total\":3,\"matches\":[{\"_index\":\"index1\",\"_id\":\"313\"},{\"_index\":\"index1\",\"_id\":\"50100\"},{\"_index\":\"index1,\"_id\":\"367\"}]}`\n\nIn this instance there should have been 4 matches and you can see the shard counts look wrong.\n\n**Steps to reproduce**:\n\nI can't reproduce this on demand but it happens fairly frequently (100s of times a day for millions of documents tested) in our production environment.\n\n**Provide logs (if relevant)**:\n\nN/A\n","closed_by":{"login":"motherhubbard","id":3320683,"node_id":"MDQ6VXNlcjMzMjA2ODM=","avatar_url":"https://avatars0.githubusercontent.com/u/3320683?v=4","gravatar_id":"","url":"https://api.github.com/users/motherhubbard","html_url":"https://github.com/motherhubbard","followers_url":"https://api.github.com/users/motherhubbard/followers","following_url":"https://api.github.com/users/motherhubbard/following{/other_user}","gists_url":"https://api.github.com/users/motherhubbard/gists{/gist_id}","starred_url":"https://api.github.com/users/motherhubbard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/motherhubbard/subscriptions","organizations_url":"https://api.github.com/users/motherhubbard/orgs","repos_url":"https://api.github.com/users/motherhubbard/repos","events_url":"https://api.github.com/users/motherhubbard/events{/privacy}","received_events_url":"https://api.github.com/users/motherhubbard/received_events","type":"User","site_admin":false},"performed_via_github_app":null}