[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/145862027","html_url":"https://github.com/elastic/elasticsearch/issues/13943#issuecomment-145862027","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13943","id":145862027,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTg2MjAyNw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-10-06T13:50:54Z","updated_at":"2015-10-06T13:50:54Z","author_association":"CONTRIBUTOR","body":"Hi @thomasquatorze \n\nThe first exception indicates that you have a corrupted translog.  You'll need to delete it in order to continue.  2.0 no longer allows translog corruptions.\n\nThe second error is probably a result of two shards trying to add the same field at the same time, one as a date and one as a string. The date version won, but the string version continued to be used on the losing shard.  Now, when moving the shard to another node, official mapping has been applied.\n\nThis has also been fixed in 2.0: dynamic mappings are now added synchronously.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/145863548","html_url":"https://github.com/elastic/elasticsearch/issues/13943#issuecomment-145863548","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13943","id":145863548,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTg2MzU0OA==","user":{"login":"thomasquatorze","id":13577078,"node_id":"MDQ6VXNlcjEzNTc3MDc4","avatar_url":"https://avatars3.githubusercontent.com/u/13577078?v=4","gravatar_id":"","url":"https://api.github.com/users/thomasquatorze","html_url":"https://github.com/thomasquatorze","followers_url":"https://api.github.com/users/thomasquatorze/followers","following_url":"https://api.github.com/users/thomasquatorze/following{/other_user}","gists_url":"https://api.github.com/users/thomasquatorze/gists{/gist_id}","starred_url":"https://api.github.com/users/thomasquatorze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thomasquatorze/subscriptions","organizations_url":"https://api.github.com/users/thomasquatorze/orgs","repos_url":"https://api.github.com/users/thomasquatorze/repos","events_url":"https://api.github.com/users/thomasquatorze/events{/privacy}","received_events_url":"https://api.github.com/users/thomasquatorze/received_events","type":"User","site_admin":false},"created_at":"2015-10-06T13:56:24Z","updated_at":"2015-10-06T13:56:24Z","author_association":"NONE","body":"Hi @clintongormley \nThanks for following up. The second condition went on for 12 hours with all shards continuously failing and initializing. This was not a one shard one time incident. It also does not explain why a shard would fail on indexing instead of just failing to index the document.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/145944752","html_url":"https://github.com/elastic/elasticsearch/issues/13943#issuecomment-145944752","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13943","id":145944752,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTk0NDc1Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-10-06T17:51:11Z","updated_at":"2015-10-06T17:51:11Z","author_association":"CONTRIBUTOR","body":"@thomasquatorze here are the important bits of the exception:\n\n```\n[RecoveryFailedException[[logstash-main-index-2015.10.05]\n[internal:index/shard/recovery/translog_ops]\n; nested: MapperParsingException[failed to parse [activity_id]\n; nested: MapperParsingException[failed to parse date field [01B56E68-901E-4256-ABB5-0537FB51AE99]\n, tried both date format [dateOptionalTime]\n, and timestamp number with locale []\n]\n; nested: IllegalArgumentException[Invalid format: \"01B58E68-921E-4256-ACB5-0537FB21AE99\" is malformed at \"B58E68-921E-4256-ACB5-0537FB21AE99\"]\n```\n\nThis exception fails while trying to recover a shard replica, during the translog phase.  The document in the translog has a string field where the mapping expects a date field.\n\nHowever this occurred (and the scenario I described above is the most likely), this would cause a recovery exception.  Elasticsearch would then try to recover this shard on another node and have the same problem.\n","performed_via_github_app":null}]