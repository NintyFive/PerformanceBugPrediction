{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50416","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50416/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50416/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50416/events","html_url":"https://github.com/elastic/elasticsearch/issues/50416","id":540785970,"node_id":"MDU6SXNzdWU1NDA3ODU5NzA=","number":50416,"title":"sum_of_squares calculation and docs don't align","user":{"login":"jmceniery","id":56210812,"node_id":"MDQ6VXNlcjU2MjEwODEy","avatar_url":"https://avatars3.githubusercontent.com/u/56210812?v=4","gravatar_id":"","url":"https://api.github.com/users/jmceniery","html_url":"https://github.com/jmceniery","followers_url":"https://api.github.com/users/jmceniery/followers","following_url":"https://api.github.com/users/jmceniery/following{/other_user}","gists_url":"https://api.github.com/users/jmceniery/gists{/gist_id}","starred_url":"https://api.github.com/users/jmceniery/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jmceniery/subscriptions","organizations_url":"https://api.github.com/users/jmceniery/orgs","repos_url":"https://api.github.com/users/jmceniery/repos","events_url":"https://api.github.com/users/jmceniery/events{/privacy}","received_events_url":"https://api.github.com/users/jmceniery/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967499105,"node_id":"MDU6TGFiZWwxOTY3NDk5MTA1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Analytics","name":"Team:Analytics","color":"fef2c0","default":false,"description":"Meta label for analytics/geo team"},{"id":1967497573,"node_id":"MDU6TGFiZWwxOTY3NDk3NTcz","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Docs","name":"Team:Docs","color":"fef2c0","default":false,"description":"Meta label for docs team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-12-20T06:05:50Z","updated_at":"2020-07-31T18:05:11Z","closed_at":"2020-07-31T18:05:11Z","author_association":"MEMBER","active_lock_reason":null,"body":"Potentially a link in the docs to a Wikipedia article is incorrect and should be removed, or the function to calculate the intended usage of the sum of squares is incorrect and needs to be updated.\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\nExpecting a sum_of_squares output in the Extended Stats Aggregation to align with the formula provided by [Wikipedia](https://en.wikipedia.org/wiki/Total_sum_of_squares) and many other statistical sources. \r\n\r\n\r\n<!-- Bug report -->\r\nThe current calculation for the Extended Stats Aggregation for the `sum_of_squares` is calculated using the following equation: `sumOfSquares += value * value;` The [docs](https://www.elastic.co/guide/en/elasticsearch/reference/7.5/sql-functions-aggs.html#sql-functions-aggs-sum-squares) references a [Wikipedia](https://en.wikipedia.org/wiki/Total_sum_of_squares) article which provides a different function. \r\n\r\n![image](https://user-images.githubusercontent.com/56210812/71232680-cbaabf00-2342-11ea-86a9-7805d20cc8da.png)\r\n\r\n**Elasticsearch version**: Tested on `6.5.4, 7.5.0`\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nCurrent calculation of the sum of squares does not align to the statistical technique used to calculate the sum of squares.\r\n\r\nSum of squares is a statistical technique used in regression analysis to determine the dispersion of data points. In a regression analysis, the goal is to determine how well a data series can be fitted to a function that might help to explain how the data series was generated. Sum of squares is used as a mathematical way to find the function that best fits (varies least) from the data.\r\n\r\nMany sum of squares calculators do not align to the way the sum of \r\n**Steps to reproduce**:\r\n\r\n**List of Numbers**: `74.01,74.77,73.94,73.61,73.40`\r\n**Expected outcome:**\r\n\r\n\r\n```\r\nSS = (74.01 - 73.95)2 + (74.77 - 73.95)2 + (73.94 - 73.95)2 + (73.61 - 73.95)2 + (73.40 - 73.95)2\r\nSS = (0.06) 2 + (0.82)2 + (-0.01)2 + (-0.34)2 + (-0.55)2\r\nSS = 1.0942\r\n```\r\n**Actual Outcome**:\r\nElastic looks to be using the following formula to calculate the sum_of_squares:\r\n```\r\nSS = (74.01 )2 + (74.77)2 + (73.94)2 + (73.61)2 + (73.40)2\r\nSS = 5477.4801 + 5590.5529 + 5467.1236 + 5418.4321 + 5387.56\r\nSS = 27341.1487\r\n```\r\n\r\n**Recreate**:\r\nCreated an index:\r\n```\r\nPUT /sum_of_squares_test_2\r\n{\r\n    \"settings\" : {\r\n        \"index\" : {\r\n            \"number_of_shards\" : 1, \r\n            \"number_of_replicas\" : 1\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nAdd some Docs\r\n```\r\nPOST /sum_of_squares_test_2/_doc/\r\n{\r\n  \"grade\": 74.01\r\n}\r\n\r\nPOST /sum_of_squares_test_2/_doc\r\n{\r\n  \"grade\": 74.77\r\n}\r\n\r\nPOST /sum_of_squares_test_2/_doc\r\n{\r\n  \"grade\": 73.94\r\n}\r\n\r\nPOST /sum_of_squares_test_2/_doc\r\n{\r\n  \"grade\": 73.61\r\n}\r\n\r\nPOST /sum_of_squares_test_2/_doc\r\n{\r\n  \"grade\": 73.40\r\n}\r\n```\r\n\r\nSearch the index:\r\n```\r\nGET sum_of_squares_test_2/_search\r\n{\r\n  \"size\":0,\r\n  \"aggs\":{\r\n    \"grade_stats\":{\r\n      \"extended_stats\":{\r\n        \"field\":\"grade\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nResponse:\r\n```\r\n{\r\n  \"took\" : 1,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 1,\r\n    \"successful\" : 1,\r\n    \"skipped\" : 0,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : {\r\n      \"value\" : 5,\r\n      \"relation\" : \"eq\"\r\n    },\r\n    \"max_score\" : null,\r\n    \"hits\" : [ ]\r\n  },\r\n  \"aggregations\" : {\r\n    \"grade_stats\" : {\r\n      \"count\" : 5,\r\n...\r\n      \"sum_of_squares\" : 27341.149189099146,\r\n...\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n\r\nSearch the index using SQL\r\n```\r\nPOST /_xpack/sql?format=txt\r\n{\r\n    \"query\": \"SELECT SUM_OF_SQUARES(grade) AS sumsq FROM sum_of_squares_test_2\"\r\n}\r\n```\r\nResponse:\r\n```\r\n      sumsq       \r\n------------------\r\n27341.149189099146\r\n```\r\n\r\nCan the statistical method also be added if the current method is as expected. The link in the docs will need to be removed if the current method is correct. I am happy to put in the PR once I have the clarification.","closed_by":{"login":"jrodewig","id":40268737,"node_id":"MDQ6VXNlcjQwMjY4NzM3","avatar_url":"https://avatars1.githubusercontent.com/u/40268737?v=4","gravatar_id":"","url":"https://api.github.com/users/jrodewig","html_url":"https://github.com/jrodewig","followers_url":"https://api.github.com/users/jrodewig/followers","following_url":"https://api.github.com/users/jrodewig/following{/other_user}","gists_url":"https://api.github.com/users/jrodewig/gists{/gist_id}","starred_url":"https://api.github.com/users/jrodewig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrodewig/subscriptions","organizations_url":"https://api.github.com/users/jrodewig/orgs","repos_url":"https://api.github.com/users/jrodewig/repos","events_url":"https://api.github.com/users/jrodewig/events{/privacy}","received_events_url":"https://api.github.com/users/jrodewig/received_events","type":"User","site_admin":false},"performed_via_github_app":null}