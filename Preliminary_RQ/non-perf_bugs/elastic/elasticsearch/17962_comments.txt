[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/214749050","html_url":"https://github.com/elastic/elasticsearch/issues/17962#issuecomment-214749050","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17962","id":214749050,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNDc0OTA1MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-26T13:41:56Z","updated_at":"2016-04-26T13:41:56Z","author_association":"CONTRIBUTOR","body":"The equivalent written for the REST api works just fine:\n\nPUT t/t/1\n    {\n      \"form\": {\n        \"id\": \"1\"\n      },\n      \"version\": \"v1\",\n      \"indexDate\": \"2016-04-22T16:02:32.738-07:00\"\n    }\n\n```\nPUT t/t/2\n{\n  \"form\": {\n    \"id\": \"2\"\n  },\n  \"version\": \"v2\",\n  \"indexDate\": \"2016-04-22T16:02:33-07:00\"\n}\n\nGET t/t/_search?size=0\n{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"range\": {\n            \"indexDate\": {\n              \"lte\": \"2016-04-22T16:02:33-07:00\"\n            }\n          }\n        }\n      ]\n    }\n  },\n  \"aggs\": {\n    \"form.id\": {\n      \"terms\": {\n        \"field\": \"form.id\",\n        \"size\": 0\n      },\n      \"aggs\": {\n        \"top\": {\n          \"top_hits\": {\n            \"size\": 1\n          }\n        }\n      }\n    }\n  },\n  \"sort\": {\n    \"indexDate\": {\n      \"order\": \"desc\"\n    }\n  }\n}\n```\n\nMy suspicion is that either the way you're using the Java API isn't correct, or there is something fishy about your docs.\n\nCould you provide your docs as curl statements, and use toXContent on your query to output what it looks like in JSON - that'll help figure out why this isn't working.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/221230947","html_url":"https://github.com/elastic/elasticsearch/issues/17962#issuecomment-221230947","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17962","id":221230947,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTIzMDk0Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-05-24T10:36:47Z","updated_at":"2016-05-24T10:36:47Z","author_association":"CONTRIBUTOR","body":"No further feedback.  Closing\n","performed_via_github_app":null}]