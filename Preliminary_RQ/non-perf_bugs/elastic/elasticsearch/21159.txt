{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21159","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21159/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21159/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21159/events","html_url":"https://github.com/elastic/elasticsearch/issues/21159","id":185746128,"node_id":"MDU6SXNzdWUxODU3NDYxMjg=","number":21159,"title":"Scroll - Java Array Index Out Of Bounds Exception","user":{"login":"saudurehman","id":6074264,"node_id":"MDQ6VXNlcjYwNzQyNjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/6074264?v=4","gravatar_id":"","url":"https://api.github.com/users/saudurehman","html_url":"https://github.com/saudurehman","followers_url":"https://api.github.com/users/saudurehman/followers","following_url":"https://api.github.com/users/saudurehman/following{/other_user}","gists_url":"https://api.github.com/users/saudurehman/gists{/gist_id}","starred_url":"https://api.github.com/users/saudurehman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saudurehman/subscriptions","organizations_url":"https://api.github.com/users/saudurehman/orgs","repos_url":"https://api.github.com/users/saudurehman/repos","events_url":"https://api.github.com/users/saudurehman/events{/privacy}","received_events_url":"https://api.github.com/users/saudurehman/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-10-27T18:31:18Z","updated_at":"2016-11-02T09:11:14Z","closed_at":"2016-11-02T09:11:14Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.4.0\n\n**Plugins installed**: [cloud-aws, kopf, license, marvel-agent]\n\n**JVM version**: 1.8.0_101\n\n**OS version**: Linux - 3.13.0-95-generic\n\n**Description of the problem including expected versus actual behavior**: \n[2016-10-26 22:28:48,314][WARN ][rest.suppressed          ] path: /_search/scroll, params: {scroll=5m}\njava.lang.ArrayIndexOutOfBoundsException: -131071\n\n**Steps to reproduce**:\n1. Scroll with size 1000, index with 300 shards, with haschild and inner hits of size 300 query.\n\n**Provide logs (if relevant)**:\n\n```\n[2016-10-26 22:28:48,314][WARN ][rest.suppressed          ] path: /_search/scroll, params: {scroll=5m}\njava.lang.ArrayIndexOutOfBoundsException: -131071\n        at org.elasticsearch.common.util.BigByteArray.set(BigByteArray.java:97)\n        at org.elasticsearch.common.io.stream.BytesStreamOutput.writeBytes(BytesStreamOutput.java:93)\n        at org.elasticsearch.common.io.stream.StreamOutput.write(StreamOutput.java:299)\n        at com.fasterxml.jackson.core.json.UTF8JsonGenerator._flushBuffer(UTF8JsonGenerator.java:2014)\n        at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1027)\n        at org.elasticsearch.common.xcontent.json.JsonXContentGenerator.flush(JsonXContentGenerator.java:436)\n        at org.elasticsearch.common.xcontent.json.JsonXContentGenerator.writeRawField(JsonXContentGenerator.java:369)\n        at org.elasticsearch.common.xcontent.XContentBuilder.rawField(XContentBuilder.java:914)\n        at org.elasticsearch.common.xcontent.XContentHelper.writeRawField(XContentHelper.java:378)\n        at org.elasticsearch.search.internal.InternalSearchHit.toXContent(InternalSearchHit.java:476)\n        at org.elasticsearch.search.internal.InternalSearchHits.toXContent(InternalSearchHits.java:184)\n        at org.elasticsearch.search.internal.InternalSearchResponse.toXContent(InternalSearchResponse.java:111)\n        at org.elasticsearch.action.search.SearchResponse.toXContent(SearchResponse.java:195)\n        at org.elasticsearch.rest.action.support.RestStatusToXContentListener.buildResponse(RestStatusToXContentListener.java:43)\n        at org.elasticsearch.rest.action.support.RestStatusToXContentListener.buildResponse(RestStatusToXContentListener.java:38)\n        at org.elasticsearch.rest.action.support.RestStatusToXContentListener.buildResponse(RestStatusToXContentListener.java:30)\n        at org.elasticsearch.rest.action.support.RestResponseListener.processResponse(RestResponseListener.java:43)\n        at org.elasticsearch.rest.action.support.RestActionListener.onResponse(RestActionListener.java:49)\n        at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:89)\n        at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:85)\n        at org.elasticsearch.action.search.SearchScrollScanAsyncAction.innerFinishHim(SearchScrollScanAsyncAction.java:210)\n        at org.elasticsearch.action.search.SearchScrollScanAsyncAction.finishHim(SearchScrollScanAsyncAction.java:167)\n        at org.elasticsearch.action.search.SearchScrollScanAsyncAction.access$200(SearchScrollScanAsyncAction.java:42)\n        at org.elasticsearch.action.search.SearchScrollScanAsyncAction$1.onResponse(SearchScrollScanAsyncAction.java:143)\n        at org.elasticsearch.action.search.SearchScrollScanAsyncAction$1.onResponse(SearchScrollScanAsyncAction.java:136)\n        at org.elasticsearch.action.ActionListenerResponseHandler.handleResponse(ActionListenerResponseHandler.java:41)\n        at org.elasticsearch.transport.netty.MessageChannelHandler.handleResponse(MessageChannelHandler.java:158)\n        at org.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(MessageChannelHandler.java:124)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n        at org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462)\n        at org.jboss.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443)\n        at org.jboss.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:310)\n        at org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n        at org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n        at org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n        at org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337)\n        at org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n        at org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n        at org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n```\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n\n**Describe the feature**:\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}