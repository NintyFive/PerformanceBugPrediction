{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24616","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24616/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24616/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24616/events","html_url":"https://github.com/elastic/elasticsearch/issues/24616","id":227975683,"node_id":"MDU6SXNzdWUyMjc5NzU2ODM=","number":24616,"title":"Illegal longitude value for geoLocation on valid geo_point","user":{"login":"jvwilge","id":251901,"node_id":"MDQ6VXNlcjI1MTkwMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/251901?v=4","gravatar_id":"","url":"https://api.github.com/users/jvwilge","html_url":"https://github.com/jvwilge","followers_url":"https://api.github.com/users/jvwilge/followers","following_url":"https://api.github.com/users/jvwilge/following{/other_user}","gists_url":"https://api.github.com/users/jvwilge/gists{/gist_id}","starred_url":"https://api.github.com/users/jvwilge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvwilge/subscriptions","organizations_url":"https://api.github.com/users/jvwilge/orgs","repos_url":"https://api.github.com/users/jvwilge/repos","events_url":"https://api.github.com/users/jvwilge/events{/privacy}","received_events_url":"https://api.github.com/users/jvwilge/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2017-05-11T12:33:40Z","updated_at":"2018-04-16T16:37:38Z","closed_at":"2018-04-16T16:37:38Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: tried with 2.3.5, 2.4.4, 5.2.1 and 5.4.0\r\n\r\n**Plugins installed**: nope\r\n\r\n**JVM version** : 1.8.0_121-b13 (on mac os) and 1.8.0_111-8u111-b14-2ubuntu0.16.04.2-b14 \r\n\r\n**OS version** : mac os 10.12.4 and Ubuntu 16.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen using a `geo-point` the inserts sometimes fail with an 'illegal longitude value' error. The longitude value in the error could be interpreted as valid, when you subtract 360 it will give you the valid value (360 degrees are in a sphere like the earth). It might have something to do with the length in characters of the geohash (h4rr13h4rr13x fails, h4rr13h4rr13 succeeds). Another search direction might be a rounding error.\r\n\r\n**Steps to reproduce**:\r\n\r\nCreate an index-mapping with a `geo_point`\r\n\r\n```\r\ncurl -XPUT 'http://localhost:9200/my-index' -d '{\r\n  \"mappings\": {\r\n    \"user\": { \r\n      \"_all\":       { \"enabled\": false  }, \r\n      \"properties\": { \r\n          \"geoLocation\": {\r\n            \"type\": \"geo_point\"\r\n          }\r\n      }\r\n    }\r\n  }\r\n}'\r\n```\r\n\r\nInsert two documents : \r\n\r\n```\r\ncurl -XPUT 'http://localhost:9200/my-index/user/4' -d '{\"geoLocation\":\"h4rr13\"}'\r\ncurl -XPUT 'http://localhost:9200/my-index/user/5' -d '{\"geoLocation\":\"h4rr13h4rr13x\"}'\r\n```\r\n\r\nThe first insert succeeds and the second one fails : \r\n\r\n```\r\n{\"error\":{\"root_cause\":[{\"type\":\"mapper_parsing_exception\",\"reason\":\"failed to parse\"}],\"type\":\"mapper_parsing_exception\",\"reason\":\"failed to parse\",\"caused_by\":{\"type\":\"illegal_argument_exception\",\"reason\":\"illegal longitude value [370.25605011731386] for geoLocation\"}},\"status\":400}\r\n```\r\n\r\nThe second call should also succeed since it is a valid place : http://geohash.org/h4rr13h4rr13x\r\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}