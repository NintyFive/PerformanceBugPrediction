[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66384351","html_url":"https://github.com/elastic/elasticsearch/issues/8860#issuecomment-66384351","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8860","id":66384351,"node_id":"MDEyOklzc3VlQ29tbWVudDY2Mzg0MzUx","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2014-12-10T00:22:20Z","updated_at":"2014-12-10T00:22:20Z","author_association":"MEMBER","body":"Hey @ppf2 , I assume by EMERGENCY you mean URGENT. Answering based on that assumption..\n\n>  Or is it because once an EMERGENCY task starts to run, even if an IMMEDIATE task comes in, it will still have to wait till these running EMERGENCY tasks have completed? \n\nYes, this is correct. The cluster state tasks are executed by a single thread to make sure things stay consistent. While the queue is being prioritized with every task insertion, you have to wait for the thread to finish it's current task and pickup on the next highest priority task. The assumption is that no task should take long (although you may have many tasks queued up). The question is what task was taking so long in your case? You can run hot threads to see what the cluster state update thread is doing.  Another thing to try is to increase the timeout of the cluster state settings update call to 1m and see if it helps to get it in (the master wait for up to 30s for the nodes to respond when publishing the cluster state so this might be it as well).\n\nPS - even if the api call times out , the task is still queued up and will be executed when the thread is free. So the setting will be applied, albeit after the call returns\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66386204","html_url":"https://github.com/elastic/elasticsearch/issues/8860#issuecomment-66386204","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8860","id":66386204,"node_id":"MDEyOklzc3VlQ29tbWVudDY2Mzg2MjA0","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2014-12-10T00:41:24Z","updated_at":"2014-12-10T00:41:24Z","author_association":"MEMBER","body":"Thanks will get hot threads, and yes, I meant urgent tasks, not emergency :D\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66422891","html_url":"https://github.com/elastic/elasticsearch/issues/8860#issuecomment-66422891","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8860","id":66422891,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NDIyODkx","user":{"login":"miccon","id":455015,"node_id":"MDQ6VXNlcjQ1NTAxNQ==","avatar_url":"https://avatars3.githubusercontent.com/u/455015?v=4","gravatar_id":"","url":"https://api.github.com/users/miccon","html_url":"https://github.com/miccon","followers_url":"https://api.github.com/users/miccon/followers","following_url":"https://api.github.com/users/miccon/following{/other_user}","gists_url":"https://api.github.com/users/miccon/gists{/gist_id}","starred_url":"https://api.github.com/users/miccon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/miccon/subscriptions","organizations_url":"https://api.github.com/users/miccon/orgs","repos_url":"https://api.github.com/users/miccon/repos","events_url":"https://api.github.com/users/miccon/events{/privacy}","received_events_url":"https://api.github.com/users/miccon/received_events","type":"User","site_admin":false},"created_at":"2014-12-10T09:13:14Z","updated_at":"2014-12-10T09:13:14Z","author_association":"NONE","body":"We were having a similar issue with IMMEDIATE tasks queuing up. See issue #8804.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66423489","html_url":"https://github.com/elastic/elasticsearch/issues/8860#issuecomment-66423489","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8860","id":66423489,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NDIzNDg5","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2014-12-10T09:18:26Z","updated_at":"2014-12-10T09:18:26Z","author_association":"MEMBER","body":"@miccon yeah, you have the same issue - a single cluster state update task takes way too long (which was fixed in your case in #8803  and disabling the include relocations as a work around)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158686787","html_url":"https://github.com/elastic/elasticsearch/issues/8860#issuecomment-158686787","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8860","id":158686787,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODY4Njc4Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-21T22:26:51Z","updated_at":"2015-11-21T22:26:51Z","author_association":"CONTRIBUTOR","body":"This has probably been resolved by async shard store fetching.  Please reopen if you still see this on recent versions\n","performed_via_github_app":null}]