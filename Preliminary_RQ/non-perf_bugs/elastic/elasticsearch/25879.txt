{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25879","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25879/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25879/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25879/events","html_url":"https://github.com/elastic/elasticsearch/issues/25879","id":245361639,"node_id":"MDU6SXNzdWUyNDUzNjE2Mzk=","number":25879,"title":"AbstractXContentParser - logger is not static","user":{"login":"prog8","id":6692291,"node_id":"MDQ6VXNlcjY2OTIyOTE=","avatar_url":"https://avatars0.githubusercontent.com/u/6692291?v=4","gravatar_id":"","url":"https://api.github.com/users/prog8","html_url":"https://github.com/prog8","followers_url":"https://api.github.com/users/prog8/followers","following_url":"https://api.github.com/users/prog8/following{/other_user}","gists_url":"https://api.github.com/users/prog8/gists{/gist_id}","starred_url":"https://api.github.com/users/prog8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prog8/subscriptions","organizations_url":"https://api.github.com/users/prog8/orgs","repos_url":"https://api.github.com/users/prog8/repos","events_url":"https://api.github.com/users/prog8/events{/privacy}","received_events_url":"https://api.github.com/users/prog8/received_events","type":"User","site_admin":false},"labels":[{"id":151561891,"node_id":"MDU6TGFiZWwxNTE1NjE4OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Logging","name":":Core/Infra/Logging","color":"0e8a16","default":false,"description":"Log management and logging utilities"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":651959372,"node_id":"MDU6TGFiZWw2NTE5NTkzNzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.5.2","name":"v5.5.2","color":"dddddd","default":false,"description":null},{"id":621009276,"node_id":"MDU6TGFiZWw2MjEwMDkyNzY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.6.0","name":"v5.6.0","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-07-25T10:49:15Z","updated_at":"2017-08-14T21:55:22Z","closed_at":"2017-07-25T13:58:14Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch 5.5.0\r\nI realized that logger in AbstractXContentParser is not static. This causes a lot of new logger instantiations\r\n\r\n```\r\n    private final DeprecationLogger deprecationLogger = new DeprecationLogger(Loggers.getLogger(getClass()));\r\n```\r\n\r\nThis is unfortunately very expensive when I have a script which looks into _source to extract value from it. It seems this logger is instantiated for each document which has very significant impact on performance. See below. Many threads are hanging on \"sun.reflect.Reflection.getCallerClass(Native Method)\"\r\n\r\n```       java.lang.Thread.State: RUNNABLE\r\n            at sun.reflect.Reflection.getCallerClass(Native Method)\r\n            at java.lang.Class.newInstance(Class.java:397)\r\n            at org.apache.logging.log4j.spi.AbstractLogger.createDefaultMessageFactory(AbstractLogger.java:212)\r\n            at org.apache.logging.log4j.spi.AbstractLogger.<init>(AbstractLogger.java:128)\r\n            at org.apache.logging.log4j.spi.ExtendedLoggerWrapper.<init>(ExtendedLoggerWrapper.java:44)\r\n            at org.elasticsearch.common.logging.PrefixLogger.<init>(PrefixLogger.java:46)\r\n            at org.elasticsearch.common.logging.ESLoggerFactory.getLogger(ESLoggerFactory.java:53)\r\n            at org.elasticsearch.common.logging.ESLoggerFactory.getLogger(ESLoggerFactory.java:49)\r\n            at org.elasticsearch.common.logging.ESLoggerFactory.getLogger(ESLoggerFactory.java:57)\r\n            at org.elasticsearch.common.logging.Loggers.getLogger(Loggers.java:101)\r\n```\r\n\r\nCan this logger be as static one?\r\n\r\n","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}