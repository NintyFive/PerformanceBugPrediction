{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27463","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27463/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27463/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27463/events","html_url":"https://github.com/elastic/elasticsearch/issues/27463","id":275518235,"node_id":"MDU6SXNzdWUyNzU1MTgyMzU=","number":27463,"title":"Terms aggregation with nested Boolean field does not work","user":{"login":"revitalbarletz","id":2212620,"node_id":"MDQ6VXNlcjIyMTI2MjA=","avatar_url":"https://avatars0.githubusercontent.com/u/2212620?v=4","gravatar_id":"","url":"https://api.github.com/users/revitalbarletz","html_url":"https://github.com/revitalbarletz","followers_url":"https://api.github.com/users/revitalbarletz/followers","following_url":"https://api.github.com/users/revitalbarletz/following{/other_user}","gists_url":"https://api.github.com/users/revitalbarletz/gists{/gist_id}","starred_url":"https://api.github.com/users/revitalbarletz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/revitalbarletz/subscriptions","organizations_url":"https://api.github.com/users/revitalbarletz/orgs","repos_url":"https://api.github.com/users/revitalbarletz/repos","events_url":"https://api.github.com/users/revitalbarletz/events{/privacy}","received_events_url":"https://api.github.com/users/revitalbarletz/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-11-20T22:17:54Z","updated_at":"2017-12-18T09:18:26Z","closed_at":"2017-12-18T09:18:26Z","author_association":"NONE","active_lock_reason":null,"body":"with ES version 1.7 I have created the following index with the following mapping:\r\nGET http://localhost:9200/ds1_fqvwhdrtbw/_mapping HTTP/1.1\r\nUser-Agent: Fiddler\r\nHost: localhost:9200\r\nContent-Length: 0\r\n\r\n\r\nHTTP/1.1 200 OK\r\nContent-Type: application/json; charset=UTF-8\r\nContent-Length: 775\r\n\r\n{\"ds1_fqvwhdrtbw\":\r\n{\"mappings\":{\r\n\"docs\":{\"_all\":{\"enabled\":false},\r\n\"properties\":{\r\n\"a$author$c\":{\r\n\"properties\":{\r\n\"a$subCount$c\":{\"type\":\"integer\",\"index\":\"no\",\"doc_values\":true},\r\n\"a$subFlagged$c\":{\"type\":\"boolean\",\"index\":\"no\"},\r\n\"a$subFlaggedCollection$c\":{\"type\":\"boolean\",\"index\":\"no\"}}},\r\n\"a$key$s\":{\"type\":\"string\",\"index_analyzer\":\"suggestionsix\",\"search_analyzer\":\"suggestionsq\"},\r\n\"author\":{\"properties\":{\r\n\"subCount\":{\"type\":\"integer\",\"copy_to\":[\"a$author$c.a$subCount$c\"]},\r\n\"subFlagged\":{\"type\":\"boolean\",\"copy_to\":[\"a$author$c.a$subFlagged$c\"]},\r\n\"subFlaggedCollection\":{\"type\":\"boolean\",\"copy_to\":[\"a$author$c.a$subFlaggedCollection$c\"]}}},\r\n\"flagged\":{\"type\":\"boolean\"},\"key\":{\"type\":\"string\",\"index\":\"not_analyzed\",\"fields\":{\"$smf\":{\"type\":\"string\",\"index_options\":\"offsets\"}}}\r\n}}}}}\r\n\r\nWhen running the following query with terms aggregation \"\r\n{\"query\":{\"match_all\":{}},\"from\":0,\"size\":51,\"_source\":[\"key\",\"flagged\",\"author\"],\"aggregations\":{\"author/subFlagged\":{\"terms\":{\"field\":\"a$author$c.a$subFlagged$c\"}}}}\r\n\r\nI get 0 buckets even though there is one document with true value.\r\nWhen I run exactly the same setup only this time with ES 5, I get the below mapping with 1 bucket for the same aggregation query:\r\n\r\nHTTP/1.1 200 OK\r\ncontent-type: application/json; charset=UTF-8\r\ncontent-length: 728\r\n\r\n{\"ds1_fvviamjfkp\":\r\n{\"mappings\":{\r\n\"docs\":{\"_all\":{\"enabled\":false},\r\n\"properties\":{\r\n\"a$author$c\":{\r\n\"properties\":{\r\n\"a$subCount$c\":{\"type\":\"integer\",\"index\":false},\r\n\"a$subFlagged$c\":{\"type\":\"boolean\",\"index\":false},\r\n\"a$subFlaggedCollection$c\":{\"type\":\"boolean\",\"index\":false}}},\"\r\na$key$s\":{\"type\":\"text\",\"analyzer\":\"suggestionsix\",\"search_analyzer\":\"suggestionsq\"},\r\n\"author\":{\"properties\":{\r\n\"subCount\":{\"type\":\"integer\",\"copy_to\":[\"a$author$c.a$subCount$c\"]},\r\n\"subFlagged\":{\"type\":\"boolean\",\"copy_to\":[\"a$author$c.a$subFlagged$c\"]},\r\n\"subFlaggedCollection\":{\"type\":\"boolean\",\"copy_to\":[\"a$author$c.a$subFlaggedCollection$c\"]}}},\r\n\"flagged\":{\"type\":\"boolean\"},\"key\":{\"type\":\"keyword\",\"fields\":{\"$smf\":{\"type\":\"text\",\"index_options\":\"offsets\"}}}}}}}}\r\n\r\n\r\n\r\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}