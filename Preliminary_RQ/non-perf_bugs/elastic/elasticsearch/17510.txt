{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17510","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17510/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17510/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17510/events","html_url":"https://github.com/elastic/elasticsearch/issues/17510","id":145723462,"node_id":"MDU6SXNzdWUxNDU3MjM0NjI=","number":17510,"title":"NullPointerException in BoolQueryBuilder.doXArrayContent","user":{"login":"diegosep","id":2809338,"node_id":"MDQ6VXNlcjI4MDkzMzg=","avatar_url":"https://avatars3.githubusercontent.com/u/2809338?v=4","gravatar_id":"","url":"https://api.github.com/users/diegosep","html_url":"https://github.com/diegosep","followers_url":"https://api.github.com/users/diegosep/followers","following_url":"https://api.github.com/users/diegosep/following{/other_user}","gists_url":"https://api.github.com/users/diegosep/gists{/gist_id}","starred_url":"https://api.github.com/users/diegosep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diegosep/subscriptions","organizations_url":"https://api.github.com/users/diegosep/orgs","repos_url":"https://api.github.com/users/diegosep/repos","events_url":"https://api.github.com/users/diegosep/events{/privacy}","received_events_url":"https://api.github.com/users/diegosep/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-04-04T15:45:10Z","updated_at":"2016-04-06T10:04:56Z","closed_at":"2016-04-06T10:04:56Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, i'm getting an error but only when i have a massive requests. Let me explain, I have a service that communicate with ES, and my service receives a lot of request per second, and in a random way i'm getting this error (please see the stacktrace) when I build the request to ES from the service, is not always the same request (i have a stack of request with performance test), for example, from 100 request 4 fail, and in another time 0 fails, it's random. When the tests run, are the unique application that is consuming the service. In average there are 10 concurrent user ( configuration with Gatling test)  requesting to the service.\n\nFor my case it's only with a BoolQueryBuilder (all queries are builded using this class)\n\nMy configuration is\n- 1.7.2 ES version \n- 1.7.2 version of Java connector.\n- Spring Boot 1.2.3.RELEASE version\n- Java 1.8.0_25 version\n\nThis is my stacktrace\n\n```\njava.lang.NullPointerException: null\n    at org.elasticsearch.index.query.BoolQueryBuilder.doXArrayContent(BoolQueryBuilder.java:181) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.index.query.BoolQueryBuilder.doXContent(BoolQueryBuilder.java:152) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.index.query.BaseQueryBuilder.toXContent(BaseQueryBuilder.java:66) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.index.query.BoolQueryBuilder.doXArrayContent(BoolQueryBuilder.java:181) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.index.query.BoolQueryBuilder.doXContent(BoolQueryBuilder.java:150) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.index.query.BaseQueryBuilder.toXContent(BaseQueryBuilder.java:66) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.action.support.QuerySourceBuilder.innerToXContent(QuerySourceBuilder.java:59) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.search.builder.SearchSourceBuilder.innerToXContent(SearchSourceBuilder.java:789) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.search.builder.SearchSourceBuilder.toXContent(SearchSourceBuilder.java:767) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.search.builder.SearchSourceBuilder.buildAsBytes(SearchSourceBuilder.java:756) ~[elasticsearch-1.7.2.jar!/:na]\n    ... 81 common frames omitted\nWrapped by: org.elasticsearch.search.builder.SearchSourceBuilderException: Failed to build search source\n    at org.elasticsearch.search.builder.SearchSourceBuilder.buildAsBytes(SearchSourceBuilder.java:759) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.action.search.SearchRequest.source(SearchRequest.java:253) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.action.search.SearchRequestBuilder.request(SearchRequestBuilder.java:1102) ~[elasticsearch-1.7.2.jar!/:na]\n    at org.elasticsearch.action.search.MultiSearchRequestBuilder.add(MultiSearchRequestBuilder.java:57) ~[elasticsearch-1.7.2.jar!/:na]\n    at com.search.repository.SearchRepository.executeQuery(SearchRepository.java:86) ~[search-io-service-sdk-1.1.0-SNAPSHOT.jar!/:na]\n    at com.search.repository.SearchRepository$$FastClassBySpringCGLIB$$dcf9ea4e.invoke(<generated>) [spring-core-4.1.6.RELEASE.jar!/:na]\n    at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) [spring-core-4.1.6.RELEASE.jar!/:4.1.6.RELEASE]\n    at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:717) [spring-aop-4.1.6.RELEASE.jar!/:4.1.6.RELEASE]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) [spring-aop-4.1.6.RELEASE.jar!/:4.1.6.RELEASE]\n    at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:136) [spring-tx-4.1.6.RELEASE.jar!/:4.1.6.RELEASE]\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) [spring-aop-4.1.6.RELEASE.jar!/:4.1.6.RELEASE]\n    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:653) [spring-aop-4.1.6.RELEASE.jar!/:4.1.6.RELEASE]\n```\n\nI need to know if this problem could be caused by the concurrent user requests to the service , or could be a ES issue. If you need more details, please let me know.\n\nThank you :)\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}