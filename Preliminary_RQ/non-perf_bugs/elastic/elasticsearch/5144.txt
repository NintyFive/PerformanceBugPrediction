{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5144","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5144/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5144/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5144/events","html_url":"https://github.com/elastic/elasticsearch/issues/5144","id":27721107,"node_id":"MDU6SXNzdWUyNzcyMTEwNw==","number":5144,"title":"Network outage keeps split brain status (no recovery by ES)","user":{"login":"snazy","id":957468,"node_id":"MDQ6VXNlcjk1NzQ2OA==","avatar_url":"https://avatars0.githubusercontent.com/u/957468?v=4","gravatar_id":"","url":"https://api.github.com/users/snazy","html_url":"https://github.com/snazy","followers_url":"https://api.github.com/users/snazy/followers","following_url":"https://api.github.com/users/snazy/following{/other_user}","gists_url":"https://api.github.com/users/snazy/gists{/gist_id}","starred_url":"https://api.github.com/users/snazy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/snazy/subscriptions","organizations_url":"https://api.github.com/users/snazy/orgs","repos_url":"https://api.github.com/users/snazy/repos","events_url":"https://api.github.com/users/snazy/events{/privacy}","received_events_url":"https://api.github.com/users/snazy/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2014-02-17T14:10:54Z","updated_at":"2014-12-29T11:48:32Z","closed_at":"2014-12-29T11:48:32Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nwe have a 4 node ES cluster running (\"plain\" Zen discovery - no cloud stuff). Two nodes are in one DC - two nodes in another DC.\n\nWhen the network connection between both DCs fails, ES forms two two-node ES clusters - a split brain. When the network is operative again, the split brain situation is remains persistent.\n\nI've setup a small local test with a 4 node ES cluster:\n\n```\n+--------+                         +--------+\n| Node A | ----\\             /---- | Node C |\n+--------+      \\.........../      +--------+\n+--------+      /           \\      +--------+\n| Node B | ----/             \\---- | Node D |\n+--------+                         +--------+\n               Single ES cluster\n```\n\nWhen the network connection fails, two two node clusters exists (split brain). I've simulated that with \"iptables -A INPUT/OUTPUT -s/d <IP> -j DROP\" statements.\n\n```\n+--------+                         +--------+\n| Node A | ----\\             /---- | Node C |\n+--------+      \\           /      +--------+\n+--------+      /           \\      +--------+\n| Node B | ----/             \\---- | Node D |\n+--------+                         +--------+\n  ES cluster                      ES cluster\n```\n\nWhen the network between nodes AB and CD is operative again, the single cluster status is not restored (split brain is persistent).\n\nIt did not make a difference, whether unicast or multicast ZEN discovery is used.\n\nAnother issue is that operating system keepalive settings affects the time after which ES detects a node failure. Keepalive timeout settings (e.g. net.ipv4.tcp_keepalive_time/probes/intvl) directly influence the node failure detection.\n\nThere should be some task, that regularly polls the \"alive\" status of all known other nodes.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}