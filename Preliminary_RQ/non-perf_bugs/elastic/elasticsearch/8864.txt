{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8864","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8864/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8864/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8864/events","html_url":"https://github.com/elastic/elasticsearch/issues/8864","id":51527919,"node_id":"MDU6SXNzdWU1MTUyNzkxOQ==","number":8864,"title":"underscore \"_\" not handled properly when both parent and child field names have it.","user":{"login":"vi3k6i5","id":3116482,"node_id":"MDQ6VXNlcjMxMTY0ODI=","avatar_url":"https://avatars2.githubusercontent.com/u/3116482?v=4","gravatar_id":"","url":"https://api.github.com/users/vi3k6i5","html_url":"https://github.com/vi3k6i5","followers_url":"https://api.github.com/users/vi3k6i5/followers","following_url":"https://api.github.com/users/vi3k6i5/following{/other_user}","gists_url":"https://api.github.com/users/vi3k6i5/gists{/gist_id}","starred_url":"https://api.github.com/users/vi3k6i5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vi3k6i5/subscriptions","organizations_url":"https://api.github.com/users/vi3k6i5/orgs","repos_url":"https://api.github.com/users/vi3k6i5/repos","events_url":"https://api.github.com/users/vi3k6i5/events{/privacy}","received_events_url":"https://api.github.com/users/vi3k6i5/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-12-10T07:42:33Z","updated_at":"2014-12-10T08:32:35Z","closed_at":"2014-12-10T08:32:35Z","author_association":"NONE","active_lock_reason":null,"body":"This issue is found when running search query on filelds which have \"_\"(underscore) in their name as well as parent field name.\n\nHow to reproduce:\n1. Download the latest version of elasticsearch and run it.\n\nrun the following curl commands:\n\nI. Create a simple entry\ncurl -XPUT \"http://localhost:9200/movies/movie/2\" -d'\n{\n    \"title\": \"Fake\",\n    \"director_details\": {\n        \"director_name\":\"No idea\",\n        \"test\":\"123\"\n    },\n    \"year\": 2014\n}'\n\noutput:\n\n{\n    \"_index\": \"movies\",\n    \"_type\": \"movie\",\n    \"_id\": \"2\",\n    \"_version\": 1,\n    \"created\": true\n}\n\nII. Query that fails:\ncurl -XGET \"http://localhost:9200/movies/movie/_search\" -d '\n{\n  \"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"match_all\": {}\n      },\n      \"filter\": {\n        \"term\": {\n          \"director_details.director_name\" : \"No idea\"\n        }\n      }\n    }\n  }\n}'\n\noutput:\n{\n    \"took\": 71,\n    \"timed_out\": false,\n    \"_shards\": {\n        \"total\": 5,\n        \"successful\": 5,\n        \"failed\": 0\n    },\n    \"hits\": {\n        \"total\": 0,\n        \"max_score\": null,\n        \"hits\": []\n    }\n}\n\nIII: query that passes\ncurl -XGET \"http://localhost:9200/movies/movie/_search\" -d '\n{\n  \"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"match_all\": {}\n      },\n      \"filter\": {\n        \"term\": {\n          \"director_details.test\" : \"123\"\n        }\n      }\n    }\n  }\n}'\n\noutput:\n{\n    \"took\": 31,\n    \"timed_out\": false,\n    \"_shards\": {\n        \"total\": 5,\n        \"successful\": 5,\n        \"failed\": 0\n    },\n    \"hits\": {\n        \"total\": 1,\n        \"max_score\": 1,\n        \"hits\": [\n            {\n                \"_index\": \"movies\",\n                \"_type\": \"movie\",\n                \"_id\": \"2\",\n                \"_score\": 1,\n                \"_source\": {\n                    \"title\": \"Fake\",\n                    \"director_details\": {\n                        \"director_name\": \"No idea\",\n                        \"test\": \"123\"\n                    },\n                    \"year\": 2014\n                }\n            }\n        ]\n    }\n}\n\nMapping is :\n\nhttp://localhost:9200/movies/movie/_mapping?pretty=true\n\n{\n  \"movies\" : {\n    \"mappings\" : {\n      \"movie\" : {\n        \"properties\" : {\n          \"director_details\" : {\n            \"properties\" : {\n              \"director_name\" : {\n                \"type\" : \"string\"\n              },\n              \"test\" : {\n                \"type\" : \"string\"\n              }\n            }\n          },\n          \"title\" : {\n            \"type\" : \"string\"\n          },\n          \"year\" : {\n            \"type\" : \"long\"\n          }\n        }\n      }\n    }\n  }\n}\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}