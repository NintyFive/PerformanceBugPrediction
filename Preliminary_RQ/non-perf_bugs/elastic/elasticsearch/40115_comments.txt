[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/473413548","html_url":"https://github.com/elastic/elasticsearch/issues/40115#issuecomment-473413548","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40115","id":473413548,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzQxMzU0OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-15T19:27:40Z","updated_at":"2019-03-15T19:27:40Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/482273881","html_url":"https://github.com/elastic/elasticsearch/issues/40115#issuecomment-482273881","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40115","id":482273881,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MjI3Mzg4MQ==","user":{"login":"Bukhtawar","id":12809319,"node_id":"MDQ6VXNlcjEyODA5MzE5","avatar_url":"https://avatars0.githubusercontent.com/u/12809319?v=4","gravatar_id":"","url":"https://api.github.com/users/Bukhtawar","html_url":"https://github.com/Bukhtawar","followers_url":"https://api.github.com/users/Bukhtawar/followers","following_url":"https://api.github.com/users/Bukhtawar/following{/other_user}","gists_url":"https://api.github.com/users/Bukhtawar/gists{/gist_id}","starred_url":"https://api.github.com/users/Bukhtawar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bukhtawar/subscriptions","organizations_url":"https://api.github.com/users/Bukhtawar/orgs","repos_url":"https://api.github.com/users/Bukhtawar/repos","events_url":"https://api.github.com/users/Bukhtawar/events{/privacy}","received_events_url":"https://api.github.com/users/Bukhtawar/received_events","type":"User","site_admin":false},"created_at":"2019-04-11T19:31:12Z","updated_at":"2019-04-12T16:10:34Z","author_association":"CONTRIBUTOR","body":"Summarizing the proposal\r\n1. Compute LWMA of `avg_collection_time = collection_time / collections` (measure of GC effectiveness) and `overhead = 100 * current_gc_collection_time / time_elapsed`(measure of GC throughput) per GC and possibly expose this metrics via `/_node/stats` API. The computations are the same from `JVMGcMonitorService` which currently only serves for logging\r\n2. The circuit breaker can start to trip request based on configurable thresholds(controlled probably through new settings) or leveraging some factor of `monitor.jvm.*` settings(will add more details) consuming the above stats[1].\r\n3. Maintain per node Circuit breaker status `OPEN/CLOSED` state and time elapsed since the last state change also expose this stats.\r\n4. Since we are tripping requests to avoid nodes from going OOM it could also so happen that the garbage is non-collectible(possible memory leaks) or stays longer(#35564) and the node takes a fairly longer time to go OOM(longer outages), the node should gracefully shutdown if even after tripping requests the node is unable to recover from slow/long GCs based on the stats from [3] and some configurable thresholds (will add more details)\r\n5. The nodes can be re-started the same way as OOM scenarios(mostly externally)\r\n\r\n@not-napoleon  Please share your thoughts on the same","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/483535112","html_url":"https://github.com/elastic/elasticsearch/issues/40115#issuecomment-483535112","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40115","id":483535112,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MzUzNTExMg==","user":{"login":"Bukhtawar","id":12809319,"node_id":"MDQ6VXNlcjEyODA5MzE5","avatar_url":"https://avatars0.githubusercontent.com/u/12809319?v=4","gravatar_id":"","url":"https://api.github.com/users/Bukhtawar","html_url":"https://github.com/Bukhtawar","followers_url":"https://api.github.com/users/Bukhtawar/followers","following_url":"https://api.github.com/users/Bukhtawar/following{/other_user}","gists_url":"https://api.github.com/users/Bukhtawar/gists{/gist_id}","starred_url":"https://api.github.com/users/Bukhtawar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bukhtawar/subscriptions","organizations_url":"https://api.github.com/users/Bukhtawar/orgs","repos_url":"https://api.github.com/users/Bukhtawar/repos","events_url":"https://api.github.com/users/Bukhtawar/events{/privacy}","received_events_url":"https://api.github.com/users/Bukhtawar/received_events","type":"User","site_admin":false},"created_at":"2019-04-16T06:55:42Z","updated_at":"2019-04-16T06:55:42Z","author_association":"CONTRIBUTOR","body":"Hi @not-napoleon please let me know what you think on the proposal. I'll be more that happy to work on the PR","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/483671509","html_url":"https://github.com/elastic/elasticsearch/issues/40115#issuecomment-483671509","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40115","id":483671509,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MzY3MTUwOQ==","user":{"login":"not-napoleon","id":979663,"node_id":"MDQ6VXNlcjk3OTY2Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/979663?v=4","gravatar_id":"","url":"https://api.github.com/users/not-napoleon","html_url":"https://github.com/not-napoleon","followers_url":"https://api.github.com/users/not-napoleon/followers","following_url":"https://api.github.com/users/not-napoleon/following{/other_user}","gists_url":"https://api.github.com/users/not-napoleon/gists{/gist_id}","starred_url":"https://api.github.com/users/not-napoleon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-napoleon/subscriptions","organizations_url":"https://api.github.com/users/not-napoleon/orgs","repos_url":"https://api.github.com/users/not-napoleon/repos","events_url":"https://api.github.com/users/not-napoleon/events{/privacy}","received_events_url":"https://api.github.com/users/not-napoleon/received_events","type":"User","site_admin":false},"created_at":"2019-04-16T13:59:51Z","updated_at":"2019-04-16T13:59:51Z","author_association":"CONTRIBUTOR","body":"@jaymode Would you mind commenting on this?  I labeled it when it came in, but it's not really in my focus area and I don't have a good sense of what the right direction is.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/483673950","html_url":"https://github.com/elastic/elasticsearch/issues/40115#issuecomment-483673950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40115","id":483673950,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MzY3Mzk1MA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2019-04-16T14:05:34Z","updated_at":"2019-04-16T14:05:34Z","author_association":"MEMBER","body":"Hi @Bukhtawar, thanks for opening the issue and providing an idea. We'll plan to discuss this as a team and summarize our thoughts after we've discussed. @danielmitterdorfer @dakrone you may be interested in this based on the work you've done on circuit breakers in the past.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/487144436","html_url":"https://github.com/elastic/elasticsearch/issues/40115#issuecomment-487144436","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40115","id":487144436,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4NzE0NDQzNg==","user":{"login":"Bukhtawar","id":12809319,"node_id":"MDQ6VXNlcjEyODA5MzE5","avatar_url":"https://avatars0.githubusercontent.com/u/12809319?v=4","gravatar_id":"","url":"https://api.github.com/users/Bukhtawar","html_url":"https://github.com/Bukhtawar","followers_url":"https://api.github.com/users/Bukhtawar/followers","following_url":"https://api.github.com/users/Bukhtawar/following{/other_user}","gists_url":"https://api.github.com/users/Bukhtawar/gists{/gist_id}","starred_url":"https://api.github.com/users/Bukhtawar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bukhtawar/subscriptions","organizations_url":"https://api.github.com/users/Bukhtawar/orgs","repos_url":"https://api.github.com/users/Bukhtawar/repos","events_url":"https://api.github.com/users/Bukhtawar/events{/privacy}","received_events_url":"https://api.github.com/users/Bukhtawar/received_events","type":"User","site_admin":false},"created_at":"2019-04-26T17:51:27Z","updated_at":"2019-04-26T17:51:27Z","author_association":"CONTRIBUTOR","body":"Hi @jaymode @danielmitterdorfer @dakrone, did we get a chance to review this. I'm awaiting a response on the proposal.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/502131153","html_url":"https://github.com/elastic/elasticsearch/issues/40115#issuecomment-502131153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40115","id":502131153,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjEzMTE1Mw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2019-06-14T14:29:20Z","updated_at":"2019-06-14T14:29:20Z","author_association":"CONTRIBUTOR","body":"We discussed it in FixitFriday and made the following points:\r\n - the real-memory circuit breaker is expected to already helping with this since GC pressure typically correlates with high-memory usage\r\n - the problem is that circuit breakers don't intercept all memory allocations, some of the linked issues are about deserializing mappings for instance, which doesn't try to let circuit breakers know about memory allocations - this is a very hard problem to solve with complex graphs of tiny Java objects\r\n - we don't see a path forward that wouldn't also increase the risk that we prevent a request that would have run fine otherwise\r\n\r\nAs a consequence we decided not to move forward on this and close the issue. Thank you for bringing this up though @Bukhtawar!","performed_via_github_app":null}]