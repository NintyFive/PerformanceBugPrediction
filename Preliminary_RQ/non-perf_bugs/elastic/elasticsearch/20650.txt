{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20650","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20650/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20650/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20650/events","html_url":"https://github.com/elastic/elasticsearch/issues/20650","id":179046055,"node_id":"MDU6SXNzdWUxNzkwNDYwNTU=","number":20650,"title":"Should shadow indices reuse allocation ids when promoting a replica to primary","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":92913658,"node_id":"MDU6TGFiZWw5MjkxMzY1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/blocker","name":"blocker","color":"e11d21","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":442569761,"node_id":"MDU6TGFiZWw0NDI1Njk3NjE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.0.0","name":"v5.0.0","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-09-24T18:57:47Z","updated_at":"2018-02-13T19:27:30Z","closed_at":"2016-10-11T15:57:15Z","author_association":"MEMBER","active_lock_reason":null,"body":"Shadow replica to primary promotion is special in that that it requires the `ShadowIndexShard` of the replica to be replaced with a new `IndexShard` instance. At the moment this is achieved be giving the shard a new allocation id, triggering a cleanup in `IndicesClusterStateService`. This is the easiest solution from the `IndicesClusterStateService` perspective but it have the down side that it cause the in sync replica list to be out of date / empty and may cause problems if the cluster is shut down before the new primary is started. We should decide whether we want to align this with how normal shard work (reuse of allocation ids) or come up with another solutions.\n\nThis was all discovered while working on #20637 and adding extra validation logic [here](https://github.com/elastic/elasticsearch/pull/20637/commits/3b23135cefd6a49c8942d93c929a021255d0aef4#diff-814ec451d0e00936e3a5f9cb6811e5bdR143)\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}