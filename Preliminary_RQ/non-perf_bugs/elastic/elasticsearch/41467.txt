{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41467","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41467/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41467/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41467/events","html_url":"https://github.com/elastic/elasticsearch/issues/41467","id":436491923,"node_id":"MDU6SXNzdWU0MzY0OTE5MjM=","number":41467,"title":"stackoverflowerror when search data with a big query","user":{"login":"distroy","id":3428297,"node_id":"MDQ6VXNlcjM0MjgyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/3428297?v=4","gravatar_id":"","url":"https://api.github.com/users/distroy","html_url":"https://github.com/distroy","followers_url":"https://api.github.com/users/distroy/followers","following_url":"https://api.github.com/users/distroy/following{/other_user}","gists_url":"https://api.github.com/users/distroy/gists{/gist_id}","starred_url":"https://api.github.com/users/distroy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/distroy/subscriptions","organizations_url":"https://api.github.com/users/distroy/orgs","repos_url":"https://api.github.com/users/distroy/repos","events_url":"https://api.github.com/users/distroy/events{/privacy}","received_events_url":"https://api.github.com/users/distroy/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-04-24T04:29:39Z","updated_at":"2019-05-06T07:32:58Z","closed_at":"2019-05-06T07:32:58Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:\r\nour nodes are crashing caused by stackoverflowerror often，if happens when search data with a big query.\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n6.6.2\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_201\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_201-b09)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux 4.15.0-42 #46~16.04.1+3 SMP Mon Dec 17 18:14:20 +08 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nour nodes are crashing caused by stackoverflowerror often，if happens when search with a big query。\r\n1 node, 2 indices, 5 shards per index, 30million documents\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1.if happens when search with a big query。\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\njava.lang.StackOverflowError: null\r\n        at org.elasticsearch.common.xcontent.json.JsonXContentParser.nextToken(JsonXContentParser.java:52) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:298) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.parseInnerQueryBuilder(AbstractQueryBuilder.java:328) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.fromXContent(BoolQueryBuilder.java:323) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.search.SearchModule.lambda$registerQuery$12(SearchModule.java:798) ~[elasticsearch-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.NamedXContentRegistry.parseNamedObject(NamedXContentRegistry.java:141) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n        at org.elasticsearch.common.xcontent.support.AbstractXContentParser.namedObject(AbstractXContentParser.java:433) ~[elasticsearch-x-content-6.6.2.jar:6.6.2]\r\n```\r\n\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}