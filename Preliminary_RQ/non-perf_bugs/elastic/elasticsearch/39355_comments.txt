[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466985570","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-466985570","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":466985570,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Njk4NTU3MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-02-25T11:59:23Z","updated_at":"2019-02-25T11:59:23Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466986984","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-466986984","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":466986984,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Njk4Njk4NA==","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"created_at":"2019-02-25T12:04:05Z","updated_at":"2019-02-25T12:04:14Z","author_association":"MEMBER","body":"Might be a side-effect of memory locking (there are several warnings in the logs):\r\n\r\n```\r\norg.elasticsearch.client.ResponseException: method [PUT], host [http://[::1]:43237], URI [/not_supported/_ccr/follow?wait_for_active_shards=1], status line [HTTP/1.1 400 Bad Request]\r\n{\"error\":{\"root_cause\":[{\"type\":\"remote_transport_exception\",\"reason\":\"[upgraded-node-leader-0][127.0.0.1:33013][indices:admin/xpack/ccr/put_follow]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"no index stats available for the leader index\"},\"status\":400}\r\n\tat __randomizedtesting.SeedInfo.seed([5BD57230DCE13991:D58A82BC76C8228A]:0)\r\n\tat org.elasticsearch.client.RestClient.convertResponse(RestClient.java:260)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:238)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:212)\r\n\tat org.elasticsearch.upgrades.CcrRollingUpgradeIT.followIndex(CcrRollingUpgradeIT.java:311)\r\n\tat org.elasticsearch.upgrades.CcrRollingUpgradeIT.testCannotFollowLeaderInUpgradedCluster(CcrRollingUpgradeIT.java:227)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467041307","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-467041307","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":467041307,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NzA0MTMwNw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-02-25T14:55:41Z","updated_at":"2019-02-25T14:55:41Z","author_association":"MEMBER","body":"This is a test issue. The `no index stats available for the leader index` error is thrown when none of the leader index shards are started. This likely to happen in other tests too. \r\n\r\nI can add awaitYellow/Green statement before they put follow is executed in `CcrRollingUpgradeIT.testCannotFollowLeaderInUpgradedCluster()` test, but I wonder whether we should change the put follow api (and resume follow api) to wait for at least all leader primary shards to be started before fetching the indices stats to figure out the historyUUIDS in `CcrLicenseChecker#fetchLeaderHistoryUUIDs(...)` method. \r\n\r\n@dnhatn @jasontedor what do you think about this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469303559","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-469303559","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":469303559,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTMwMzU1OQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T15:52:40Z","updated_at":"2019-03-04T15:52:40Z","author_association":"MEMBER","body":"The old failure doesn't occur any more. Unfortunately it just failed with a different failure several times. \r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:qa:rolling-upgrade-multi-cluster:v8.0.0#follower#upgradedClusterTestRunner -Dtests.seed=1F0AD97401B9839A -Dtests.class=org.elasticsearch.upgrades.CcrRollingUpgradeIT -Dtests.method=\"testCannotFollowLeaderInUpgradedCluster\" -Dtests.security.manager=true -Dtests.locale=en-AI -Dtests.timezone=Etc/GMT-12 -Dcompiler.java=11 -Druntime.java=11\r\nFAILURE 3.45s | CcrRollingUpgradeIT.testCannotFollowLeaderInUpgradedCluster <<< FAILURES!\r\n   > Throwable #1: junit.framework.AssertionFailedError: Expected exception ResponseException but no exception was thrown\r\n   >    at __randomizedtesting.SeedInfo.seed([1F0AD97401B9839A:915529F8AB909881]:0)\r\n   >    at org.apache.lucene.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2685)\r\n   >    at org.apache.lucene.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2670)\r\n   >    at org.elasticsearch.upgrades.CcrRollingUpgradeIT.testCannotFollowLeaderInUpgradedCluster(CcrRollingUpgradeIT.java:219)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   >    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   >    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   >    at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n   >    at java.base/java.lang.Thread.run(Thread.java:834)\r\n```\r\n\r\nI guess it wasn't notice because bwc tests were active for a while\r\n\r\nThis failure reproduces. I will mute and then work on a fix.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469305555","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-469305555","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":469305555,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTMwNTU1NQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T15:57:37Z","updated_at":"2019-03-04T15:57:37Z","author_association":"MEMBER","body":"Muted test on [master](https://github.com/elastic/elasticsearch/commit/a4c3e7f4c1c65ab127b92b0e273f6e0cac718268), [7.x](https://github.com/elastic/elasticsearch/commit/691b4e9709d8833071416d90837b535d327d27bd), [7.0](https://github.com/elastic/elasticsearch/commit/e1494f2c50176ccec15bb29b8ce860e34627f287) and [6.7](https://github.com/elastic/elasticsearch/commit/46392f2d3060a3f860317a94e5706ddd99bd51f3).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470608448","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-470608448","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":470608448,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDYwODQ0OA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-03-07T17:01:32Z","updated_at":"2019-03-07T17:01:32Z","author_association":"MEMBER","body":"The problem, that the expected failure doesn't occur, only occurs on master branch. So i've unmuted the test on the other branches.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/658875259","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-658875259","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":658875259,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODg3NTI1OQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2020-07-15T16:46:00Z","updated_at":"2020-07-15T16:46:00Z","author_association":"MEMBER","body":"This failed again today, but I was unable to reproduce it: https://gradle-enterprise.elastic.co/s/bsxqgpj54davc","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/658992259","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-658992259","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":658992259,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODk5MjI1OQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2020-07-15T20:28:55Z","updated_at":"2020-07-15T20:28:55Z","author_association":"MEMBER","body":"Already muted as part of https://github.com/elastic/elasticsearch/issues/59625","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/659437834","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-659437834","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":659437834,"node_id":"MDEyOklzc3VlQ29tbWVudDY1OTQzNzgzNA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2020-07-16T14:09:52Z","updated_at":"2020-07-16T15:22:52Z","author_association":"MEMBER","body":"Close in favor of https://github.com/elastic/elasticsearch/issues/59625","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/659480156","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-659480156","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":659480156,"node_id":"MDEyOklzc3VlQ29tbWVudDY1OTQ4MDE1Ng==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2020-07-16T15:16:35Z","updated_at":"2020-07-16T15:16:35Z","author_association":"MEMBER","body":"@dnhatn I'm a little confused by this, did you mean to close this issue in favor of itself?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/659484975","html_url":"https://github.com/elastic/elasticsearch/issues/39355#issuecomment-659484975","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39355","id":659484975,"node_id":"MDEyOklzc3VlQ29tbWVudDY1OTQ4NDk3NQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2020-07-16T15:23:58Z","updated_at":"2020-07-16T15:23:58Z","author_association":"MEMBER","body":"@dakrone Thanks for noticing that. I referred to a wrong issue. It should be #59625 instead. ","performed_via_github_app":null}]