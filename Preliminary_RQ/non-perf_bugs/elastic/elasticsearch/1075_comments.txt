[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/1546021","html_url":"https://github.com/elastic/elasticsearch/issues/1075#issuecomment-1546021","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1075","id":1546021,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NDYwMjE=","user":{"login":"AdrianRossouw","id":115108,"node_id":"MDQ6VXNlcjExNTEwOA==","avatar_url":"https://avatars3.githubusercontent.com/u/115108?v=4","gravatar_id":"","url":"https://api.github.com/users/AdrianRossouw","html_url":"https://github.com/AdrianRossouw","followers_url":"https://api.github.com/users/AdrianRossouw/followers","following_url":"https://api.github.com/users/AdrianRossouw/following{/other_user}","gists_url":"https://api.github.com/users/AdrianRossouw/gists{/gist_id}","starred_url":"https://api.github.com/users/AdrianRossouw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AdrianRossouw/subscriptions","organizations_url":"https://api.github.com/users/AdrianRossouw/orgs","repos_url":"https://api.github.com/users/AdrianRossouw/repos","events_url":"https://api.github.com/users/AdrianRossouw/events{/privacy}","received_events_url":"https://api.github.com/users/AdrianRossouw/received_events","type":"User","site_admin":false},"created_at":"2011-07-11T12:20:38Z","updated_at":"2011-07-11T12:20:38Z","author_association":"NONE","body":"I have been experiencing the same, and it was confirmed by kimchy that this is a a problem he is debugging.\n\n### Description\n\nThe JVM process steadily consuming more memory until the system becomes starved of resources and falls over. This additional memory consumption is not tied to the reported heap/non-heap memory consumption from BigDesk or the nodes/stats API.\n\nWhile initially considered ubuntu specific, there have been reports of it happening on other linux distributions, but the low memory configuration of the 'problem systems' makes the issue more pronounced, and these systems have been running ubuntu so far.\n\n### Solutions tried\n\n**switch to oracle jre**\n\nno effect.\n\n**stop using the servicewrapper**\n\nno effect.\n\n**determine if open files/sockets cause the problem**\n\nDebugging with lsof and netstat return reasonable results, showing that the pipes are being closed correctly according to the operating system.\n\n**remove native libraries to check for leaks in them**\n\nUpon kimchy's instructions i removed the sigar, jna and jline libraries from /lib, and restarted the server. [These are the results after 4 days](https://gist.github.com/2dbd3d8eb77cb5fd01a4)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/1553617","html_url":"https://github.com/elastic/elasticsearch/issues/1075#issuecomment-1553617","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1075","id":1553617,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NTM2MTc=","user":{"login":"AdrianRossouw","id":115108,"node_id":"MDQ6VXNlcjExNTEwOA==","avatar_url":"https://avatars3.githubusercontent.com/u/115108?v=4","gravatar_id":"","url":"https://api.github.com/users/AdrianRossouw","html_url":"https://github.com/AdrianRossouw","followers_url":"https://api.github.com/users/AdrianRossouw/followers","following_url":"https://api.github.com/users/AdrianRossouw/following{/other_user}","gists_url":"https://api.github.com/users/AdrianRossouw/gists{/gist_id}","starred_url":"https://api.github.com/users/AdrianRossouw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AdrianRossouw/subscriptions","organizations_url":"https://api.github.com/users/AdrianRossouw/orgs","repos_url":"https://api.github.com/users/AdrianRossouw/repos","events_url":"https://api.github.com/users/AdrianRossouw/events{/privacy}","received_events_url":"https://api.github.com/users/AdrianRossouw/received_events","type":"User","site_admin":false},"created_at":"2011-07-12T11:41:09Z","updated_at":"2011-07-12T11:41:09Z","author_association":"NONE","body":"I have cloned one of the environments and made different changes to each clone.\n1. upgraded the clone 'spin1' to ubuntu 10.10 from 10.04.\n2. upgraded the clone 'spin2' to the latest jre (update 26).\n\nInitial states:  [spin1](https://gist.github.com/a87c2e6cd7922aba1550) and [spin2](https://gist.github.com/171b42d6bd5636204f2e)\n12 hours later: [spin1](https://gist.github.com/793db965da0be8d139f8) and [spin2](https://gist.github.com/cea58b0a966689973c3c)\n\nThis is too early to tell what is going wrong, but on telling difference has shown up.\nNamely, the tcp connection count on spin1 is incredibly high, much higher than\nspin2 with the newer JRE. These figures are provided by sigar, and a connection\nreference leak is a possible cause for a memory leak of this nature.\n\n```\n  # from spin2 \n\n    \"tcp\" : {\n      \"active_opens\" : 72,\n      \"passive_opens\" : 2980,\n      \"curr_estab\" : 29,\n      \"in_segs\" : 130486,\n      \"out_segs\" : 98255,\n      \"retrans_segs\" : 69,\n      \"estab_resets\" : 6,\n      \"attempt_fails\" : 7,\n      \"in_errs\" : 0,\n      \"out_rsts\" : 6\n    }\n\n    # from spin1\n    \"tcp\" : {\n      \"active_opens\" : 10256,\n      \"passive_opens\" : 14670,\n      \"curr_estab\" : 29,\n      \"in_segs\" : 205680,\n      \"out_segs\" : 204016,\n      \"retrans_segs\" : 108,\n      \"estab_resets\" : 59,\n      \"attempt_fails\" : 7,\n      \"in_errs\" : 0,\n      \"out_rsts\" : 44\n    }\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/1553941","html_url":"https://github.com/elastic/elasticsearch/issues/1075#issuecomment-1553941","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1075","id":1553941,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NTM5NDE=","user":{"login":"ThePixelDeveloper","id":47728,"node_id":"MDQ6VXNlcjQ3NzI4","avatar_url":"https://avatars3.githubusercontent.com/u/47728?v=4","gravatar_id":"","url":"https://api.github.com/users/ThePixelDeveloper","html_url":"https://github.com/ThePixelDeveloper","followers_url":"https://api.github.com/users/ThePixelDeveloper/followers","following_url":"https://api.github.com/users/ThePixelDeveloper/following{/other_user}","gists_url":"https://api.github.com/users/ThePixelDeveloper/gists{/gist_id}","starred_url":"https://api.github.com/users/ThePixelDeveloper/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ThePixelDeveloper/subscriptions","organizations_url":"https://api.github.com/users/ThePixelDeveloper/orgs","repos_url":"https://api.github.com/users/ThePixelDeveloper/repos","events_url":"https://api.github.com/users/ThePixelDeveloper/events{/privacy}","received_events_url":"https://api.github.com/users/ThePixelDeveloper/received_events","type":"User","site_admin":false},"created_at":"2011-07-12T12:45:42Z","updated_at":"2011-07-12T12:51:09Z","author_association":"NONE","body":"Since my last post I've updated to the latest JRE (update 26) and still experience the same issues. \n\n![](http://i.imgur.com/Vlg62.png)\n\nHere are node stats after it's been running for a few days:\n\nhttps://gist.github.com/754639add60d4196e8f5\n\nStats after an elasticsearch restart:\n\nhttps://gist.github.com/17587c560f58a363e5ad\n\nIt should also be noted that my network stats are mostly the same with regard to active opens.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/1558773","html_url":"https://github.com/elastic/elasticsearch/issues/1075#issuecomment-1558773","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1075","id":1558773,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NTg3NzM=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2011-07-12T23:25:51Z","updated_at":"2011-07-12T23:25:51Z","author_association":"MEMBER","body":"Heya, I think I found the issue, which is a leak in the JVM itself when using GarbageCollectorMXBean#getLastGcInfo. It get called periodically in elasticsearch (every 1 second), and also on node stats API.\n\nI have pushed a change to disable it into both 0.16 branch and master.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/1571469","html_url":"https://github.com/elastic/elasticsearch/issues/1075#issuecomment-1571469","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1075","id":1571469,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzE0Njk=","user":{"login":"AdrianRossouw","id":115108,"node_id":"MDQ6VXNlcjExNTEwOA==","avatar_url":"https://avatars3.githubusercontent.com/u/115108?v=4","gravatar_id":"","url":"https://api.github.com/users/AdrianRossouw","html_url":"https://github.com/AdrianRossouw","followers_url":"https://api.github.com/users/AdrianRossouw/followers","following_url":"https://api.github.com/users/AdrianRossouw/following{/other_user}","gists_url":"https://api.github.com/users/AdrianRossouw/gists{/gist_id}","starred_url":"https://api.github.com/users/AdrianRossouw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AdrianRossouw/subscriptions","organizations_url":"https://api.github.com/users/AdrianRossouw/orgs","repos_url":"https://api.github.com/users/AdrianRossouw/repos","events_url":"https://api.github.com/users/AdrianRossouw/events{/privacy}","received_events_url":"https://api.github.com/users/AdrianRossouw/received_events","type":"User","site_admin":false},"created_at":"2011-07-14T13:31:05Z","updated_at":"2011-07-14T13:31:05Z","author_association":"NONE","body":"Adding -Des.monitor.jvm.enabled=false to the command line solved the issue.\n\nAfter 1 day, the test environment is using 160mb of memory, while the control is using 200mb.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/1571575","html_url":"https://github.com/elastic/elasticsearch/issues/1075#issuecomment-1571575","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1075","id":1571575,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzE1NzU=","user":{"login":"aloiscochard","id":215476,"node_id":"MDQ6VXNlcjIxNTQ3Ng==","avatar_url":"https://avatars2.githubusercontent.com/u/215476?v=4","gravatar_id":"","url":"https://api.github.com/users/aloiscochard","html_url":"https://github.com/aloiscochard","followers_url":"https://api.github.com/users/aloiscochard/followers","following_url":"https://api.github.com/users/aloiscochard/following{/other_user}","gists_url":"https://api.github.com/users/aloiscochard/gists{/gist_id}","starred_url":"https://api.github.com/users/aloiscochard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aloiscochard/subscriptions","organizations_url":"https://api.github.com/users/aloiscochard/orgs","repos_url":"https://api.github.com/users/aloiscochard/repos","events_url":"https://api.github.com/users/aloiscochard/events{/privacy}","received_events_url":"https://api.github.com/users/aloiscochard/received_events","type":"User","site_admin":false},"created_at":"2011-07-14T13:45:00Z","updated_at":"2011-07-14T13:45:00Z","author_association":"NONE","body":"kimchy.karma += 100k\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/1571587","html_url":"https://github.com/elastic/elasticsearch/issues/1075#issuecomment-1571587","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1075","id":1571587,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzE1ODc=","user":{"login":"ThePixelDeveloper","id":47728,"node_id":"MDQ6VXNlcjQ3NzI4","avatar_url":"https://avatars3.githubusercontent.com/u/47728?v=4","gravatar_id":"","url":"https://api.github.com/users/ThePixelDeveloper","html_url":"https://github.com/ThePixelDeveloper","followers_url":"https://api.github.com/users/ThePixelDeveloper/followers","following_url":"https://api.github.com/users/ThePixelDeveloper/following{/other_user}","gists_url":"https://api.github.com/users/ThePixelDeveloper/gists{/gist_id}","starred_url":"https://api.github.com/users/ThePixelDeveloper/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ThePixelDeveloper/subscriptions","organizations_url":"https://api.github.com/users/ThePixelDeveloper/orgs","repos_url":"https://api.github.com/users/ThePixelDeveloper/repos","events_url":"https://api.github.com/users/ThePixelDeveloper/events{/privacy}","received_events_url":"https://api.github.com/users/ThePixelDeveloper/received_events","type":"User","site_admin":false},"created_at":"2011-07-14T13:46:18Z","updated_at":"2011-07-14T13:46:18Z","author_association":"NONE","body":"I've been running off 0.16 head for the past day and can confirm the memory leak has been fixed\n\n![](http://i.imgur.com/ox031.png)\n![](http://i.imgur.com/z8Vk0.png)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/1573049","html_url":"https://github.com/elastic/elasticsearch/issues/1075#issuecomment-1573049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1075","id":1573049,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzMwNDk=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2011-07-14T16:47:37Z","updated_at":"2011-07-14T16:47:37Z","author_association":"MEMBER","body":"cool, I will release 0.16.4 today that disables that by default, and also does not have the leak when calling node stats.\n","performed_via_github_app":null}]