{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/49135","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49135/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49135/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49135/events","html_url":"https://github.com/elastic/elasticsearch/issues/49135","id":523305044,"node_id":"MDU6SXNzdWU1MjMzMDUwNDQ=","number":49135,"title":" elasticsearch client node OutOfMemoryError","user":{"login":"lovelly","id":13118848,"node_id":"MDQ6VXNlcjEzMTE4ODQ4","avatar_url":"https://avatars2.githubusercontent.com/u/13118848?v=4","gravatar_id":"","url":"https://api.github.com/users/lovelly","html_url":"https://github.com/lovelly","followers_url":"https://api.github.com/users/lovelly/followers","following_url":"https://api.github.com/users/lovelly/following{/other_user}","gists_url":"https://api.github.com/users/lovelly/gists{/gist_id}","starred_url":"https://api.github.com/users/lovelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lovelly/subscriptions","organizations_url":"https://api.github.com/users/lovelly/orgs","repos_url":"https://api.github.com/users/lovelly/repos","events_url":"https://api.github.com/users/lovelly/events{/privacy}","received_events_url":"https://api.github.com/users/lovelly/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-11-15T07:34:04Z","updated_at":"2019-11-15T07:43:05Z","closed_at":"2019-11-15T07:36:33Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\nI have a client node.\r\nNode.master: false\r\nNode.data: false\r\n\r\nI allocated memory to jvm:\r\n-Xms10g\r\n-Xmx10g\r\n\r\nI use the bulk api to insert data for a long time.\r\nThe elasticsearch client node runs for about 10 minutes, and the memory usage becomes 100%. It does not decrease.\r\n![image](https://user-images.githubusercontent.com/13118848/68924371-a4008e00-07bb-11ea-9bd5-9a1b49dd8a46.png)\r\nAfter a while, the clinet node crashes.\r\n```\r\njava.lang.OutOfMemoryError: Java heap space\r\nDumping heap to data/java_pid3851.hprof ...\r\nHeap dump file created [11703693630 bytes in 97.763 secs]\r\n[2019-11-15T16:34:56,625][ERROR][o.e.ExceptionsHelper     ] [es] fatal error\r\n\tat org.elasticsearch.ExceptionsHelper.lambda$maybeDieOnAnotherThread$4(ExceptionsHelper.java:300)\r\n\tat java.base/java.util.Optional.ifPresent(Optional.java:176)\r\n\tat org.elasticsearch.ExceptionsHelper.maybeDieOnAnotherThread(ExceptionsHelper.java:290)\r\n\tat org.elasticsearch.transport.netty4.Netty4TcpChannel.lambda$addPromise$1(Netty4TcpChannel.java:88)\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:500)\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:474)\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:413)\r\n\tat io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:538)\r\n\tat io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:531)\r\n\r\n```\r\n\r\n**Plugins installed**: [none]\r\n\r\n**JVM version** (`java -version`):\r\nJVM: 13.0.1 ES: 7.4.2\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux es 3.10.0-1062.4.1.el7.x86_64 #1 SMP Fri Oct 18 17:15:30 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nelasticsearch log:\r\n```\r\n[2019-11-15T16:20:33,317][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2331] overhead, spent [1.4s] collecting in the last [2.3s]\r\n[2019-11-15T16:20:40,712][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2337] overhead, spent [1.7s] collecting in the last [2.3s]\r\n[2019-11-15T16:20:48,607][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2344] overhead, spent [1.5s] collecting in the last [1.8s]\r\n[2019-11-15T16:20:55,414][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2350] overhead, spent [1.6s] collecting in the last [1.8s]\r\n[2019-11-15T16:21:04,547][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2358] overhead, spent [1.7s] collecting in the last [2.1s]\r\n[2019-11-15T16:21:10,891][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2363] overhead, spent [1.6s] collecting in the last [2.3s]\r\n[2019-11-15T16:21:37,683][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2389] overhead, spent [1.6s] collecting in the last [1.6s]\r\n[2019-11-15T16:21:48,849][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2399] overhead, spent [1.5s] collecting in the last [2.1s]\r\n[2019-11-15T16:22:00,279][WARN ][o.e.m.j.JvmGcMonitorService] [es] [gc][2410] overhead, spent [1.3s] collecting in the last [1.3s]\r\n```\r\n\r\nElasticseach go sdk client A lot of the following errors:\r\n```\r\nerror:map[bytes_limit:1.0200547328e+10 bytes_wanted:1.0648510022e+10 durability:TRANSIENT\r\nreason:[parent] Data too large, data for [<http_request>] would be [10648510022/9.9gb], which is \r\nlarger than the limit of [10200547328/9.5gb], real usage: [10638953944/9.9gb], new bytes \r\nreserved: [9556078/9.1mb], usages [request=6040780800/5.6gb, fielddata=0/0b, \r\nin_flight_requests=212138460/202.3mb, accounting=0/0b] root_cause:\r\n[map[bytes_limit:1.0200547328e+10 bytes_wanted:1.0648510022e+10 durability:TRANSIENT \r\nreason:[parent] Data too large, data for [<http_request>] would be [10648510022/9.9gb], which is\r\nlarger than the limit of [10200547328/9.5gb], real usage: [10638953944/9.9gb], new bytes \r\nreserved: [9556078/9.1mb], usages [request=6040780800/5.6gb, fielddata=0/0b, \r\nin_flight_requests=212138460/202.3mb, accounting=0/0b] type:circuit_breaking_exception]] \r\ntype:circuit_breaking_exception] status:429\r\n\r\n```","closed_by":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"performed_via_github_app":null}