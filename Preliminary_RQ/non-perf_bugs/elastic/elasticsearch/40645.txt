{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/40645","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40645/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40645/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40645/events","html_url":"https://github.com/elastic/elasticsearch/issues/40645","id":427087364,"node_id":"MDU6SXNzdWU0MjcwODczNjQ=","number":40645,"title":"Geo distance query builder ignoring unit of measurement","user":{"login":"Schachte","id":7055226,"node_id":"MDQ6VXNlcjcwNTUyMjY=","avatar_url":"https://avatars1.githubusercontent.com/u/7055226?v=4","gravatar_id":"","url":"https://api.github.com/users/Schachte","html_url":"https://github.com/Schachte","followers_url":"https://api.github.com/users/Schachte/followers","following_url":"https://api.github.com/users/Schachte/following{/other_user}","gists_url":"https://api.github.com/users/Schachte/gists{/gist_id}","starred_url":"https://api.github.com/users/Schachte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Schachte/subscriptions","organizations_url":"https://api.github.com/users/Schachte/orgs","repos_url":"https://api.github.com/users/Schachte/repos","events_url":"https://api.github.com/users/Schachte/events{/privacy}","received_events_url":"https://api.github.com/users/Schachte/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-03-29T17:04:28Z","updated_at":"2019-03-31T06:04:06Z","closed_at":"2019-03-31T06:04:06Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.5.4\r\n\r\n\r\n**JVM version** (`java -version`): 8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): mac os x latest\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI'm trying to generate a `geo_distance` filter from my OGC filter and it seems as if the unit is being ignored, even if I hardcode it.\r\n\r\n## Java\r\n\r\n```\r\nboolQueryBuilder.must(\r\n          geoDistanceQuery(ANY_GEO_MAPPING)\r\n              .point(coords[0].getOrdinate(1), coords[0].getOrdinate(0))\r\n              .distance(filter.getDistance(), DistanceUnit.FEET));\r\n      return boolQueryBuilder;\r\n```\r\n\r\n## Resulting JSON\r\n\r\n```\r\n{\r\n  \"bool\" : {\r\n    \"must\" : [\r\n      {\r\n        \"geo_distance\" : {\r\n          \"anyGeo\" : [\r\n            -107.908977,\r\n            41.306675\r\n          ],\r\n          \"distance\" : 663.5960582256,\r\n          \"distance_type\" : \"arc\",\r\n          \"validation_method\" : \"STRICT\",\r\n          \"ignore_unmapped\" : false,\r\n          \"boost\" : 1.0\r\n        }\r\n      }\r\n    ],\r\n    \"adjust_pure_negative\" : true,\r\n    \"boost\" : 1.0\r\n  }\r\n}\r\n\r\n```\r\n\r\n## Expectation:\r\n\r\nIn this case, I'd expected `\"distance\" : 663.5960582256` to be suffixed with `feet` or `ft`\r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/common-options.html#distance-units\r\n","closed_by":{"login":"Schachte","id":7055226,"node_id":"MDQ6VXNlcjcwNTUyMjY=","avatar_url":"https://avatars1.githubusercontent.com/u/7055226?v=4","gravatar_id":"","url":"https://api.github.com/users/Schachte","html_url":"https://github.com/Schachte","followers_url":"https://api.github.com/users/Schachte/followers","following_url":"https://api.github.com/users/Schachte/following{/other_user}","gists_url":"https://api.github.com/users/Schachte/gists{/gist_id}","starred_url":"https://api.github.com/users/Schachte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Schachte/subscriptions","organizations_url":"https://api.github.com/users/Schachte/orgs","repos_url":"https://api.github.com/users/Schachte/repos","events_url":"https://api.github.com/users/Schachte/events{/privacy}","received_events_url":"https://api.github.com/users/Schachte/received_events","type":"User","site_admin":false},"performed_via_github_app":null}