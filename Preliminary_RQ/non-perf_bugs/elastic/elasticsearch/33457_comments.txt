[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419008925","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-419008925","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":419008925,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTAwODkyNQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T08:24:45Z","updated_at":"2018-09-06T08:24:45Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419013361","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-419013361","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":419013361,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTAxMzM2MQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T08:40:16Z","updated_at":"2018-09-06T08:40:16Z","author_association":"MEMBER","body":"I can reproduce this locally by just running the test in a loop (seed doesn't matter it seems).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419025204","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-419025204","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":419025204,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTAyNTIwNA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T09:19:23Z","updated_at":"2018-09-06T09:19:23Z","author_association":"MEMBER","body":"Prior to the assertion failure this happens:\r\n\r\n```\r\n WARNING: Uncaught exception in thread: Thread[elasticsearch[org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests][generic][T#3],5,TGRP-ShardFollowTaskReplicationTests]\r\n21:54:26   2> org.apache.lucene.store.AlreadyClosedException: engine is closed\r\n21:54:26   2> \tat __randomizedtesting.SeedInfo.seed([4CD8F74ECBDE3230]:0)\r\n21:54:26   2> \tat org.elasticsearch.index.shard.IndexShard.getEngine(IndexShard.java:2055)\r\n21:54:26   2> \tat org.elasticsearch.index.shard.IndexShard.seqNoStats(IndexShard.java:959)\r\n21:54:26   1> [2018-09-05T22:54:25,675][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testFailLeaderReplicaShard] after test\r\n21:54:26   2> \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests$2.lambda$innerSendShardChangesRequest$1(ShardFollowTaskReplicationTests.java:208)\r\n21:54:26   2> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:624)\r\n21:54:26   2> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n21:54:26   2> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419025585","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-419025585","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":419025585,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTAyNTU4NQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T09:20:42Z","updated_at":"2018-09-06T09:20:42Z","author_association":"MEMBER","body":"@original-brownbear Thanks. I saw the engine closed error too locally when running with `-Dtests.iters=512`. \r\n\r\nI think I have a fix for this locally. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419025997","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-419025997","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":419025997,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTAyNTk5Nw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T09:22:10Z","updated_at":"2018-09-06T09:22:10Z","author_association":"MEMBER","body":"@martijnvg \r\n\r\n> I think I have a fix for this locally.\r\n\r\nyeay :)\r\nI wasn't smart enough to find one :)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419027542","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-419027542","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":419027542,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTAyNzU0Mg==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T09:27:05Z","updated_at":"2018-09-06T09:27:05Z","author_association":"MEMBER","body":"heh :)\r\n\r\nWe were fetching the seqNoStats (`final SeqNoStats seqNoStats = indexShard.seqNoStats();`) outside the try-catch-block in ShardFollowTaskReplicationTests#innerSendShardChangesRequest(...).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419034603","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-419034603","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":419034603,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTAzNDYwMw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-09-06T09:50:53Z","updated_at":"2018-09-06T09:50:53Z","author_association":"MEMBER","body":"I've pushed: cdd82bb2034b4b34a3d7d7424b7a14baea232fd1\r\nI will keep this issue open to ensure the test failure is fixed.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422189013","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-422189013","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":422189013,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjE4OTAxMw==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-09-17T22:12:39Z","updated_at":"2018-09-17T22:12:39Z","author_association":"MEMBER","body":"The build log is gone. I am closing this and reopen if it fails again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422322988","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-422322988","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":422322988,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjMyMjk4OA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T09:27:58Z","updated_at":"2018-09-18T09:27:58Z","author_association":"MEMBER","body":"I failed again: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+multijob-windows-compatibility/7/console\r\n\r\nI'm looking into it.\r\n\r\n```\r\n09:15:07 Suite: org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests\r\n09:15:07   1> [2018-09-18T12:15:03,671][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testChangeHistoryUUID] before test\r\n09:15:07   1> [2018-09-18T12:15:05,402][INFO ][o.e.x.c.a.ShardFollowNodeTask] [testChangeHistoryUUID] [follow_index][0] Started to follow leader shard [leader_index][0], followGlobalCheckPoint=-1, mappingVersion=1\r\n09:15:07   2> sept. 18, 2018 12:15:07 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n09:15:07   2> WARNING: Uncaught exception in thread: Thread[Thread-3,5,TGRP-ShardFollowTaskReplicationTests]\r\n09:15:07   2> java.lang.AssertionError: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n09:15:07   2> \tat __randomizedtesting.SeedInfo.seed([FCF60CAAE5D18178]:0)\r\n09:15:07   1> [2018-09-18T12:15:05,886][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testChangeHistoryUUID] after test\r\n09:15:07   1> [2018-09-18T12:15:05,893][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testSimpleCcrReplication] before test\r\n09:15:07   2> \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:111)\r\n09:15:07   1> [2018-09-18T12:15:06,284][INFO ][o.e.x.c.a.ShardFollowNodeTask] [testSimpleCcrReplication] [follow_index][0] Started to follow leader shard [leader_index][0], followGlobalCheckPoint=-1, mappingVersion=1\r\n09:15:07   1> [2018-09-18T12:15:07,181][INFO ][o.e.x.c.a.ShardFollowNodeTask] [org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests] [follow_index][0] shard follow task has been stopped\r\n09:15:07   1> [2018-09-18T12:15:07,281][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testSimpleCcrReplication] after test\r\n09:15:08   2> \tat java.lang.Thread.run(Thread.java:748)\r\n09:15:08   2> Caused by: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n09:15:08   2> \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:265)\r\n09:15:08   2> \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n09:15:08   1> [2018-09-18T12:15:07,306][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testFailLeaderReplicaShard] before test\r\n09:15:08   2> \tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94)\r\n09:15:08   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:227)\r\n09:15:08   1> [2018-09-18T12:15:07,532][INFO ][o.e.x.c.a.ShardFollowNodeTask] [testFailLeaderReplicaShard] [follow_index][0] Started to follow leader shard [leader_index][0], followGlobalCheckPoint=-1, mappingVersion=1\r\n09:15:08   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.index(ESIndexLevelReplicationTestCase.java:210)\r\n09:15:08   1> [2018-09-18T12:15:07,825][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testFailLeaderReplicaShard] after test\r\n09:15:08 ERROR   0.55s J3 | ShardFollowTaskReplicationTests.testFailLeaderReplicaShard <<< FAILURES!\r\n09:15:08   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.appendDocs(ESIndexLevelReplicationTestCase.java:199)\r\n09:15:08    > Throwable #1: java.lang.AssertionError: \r\n09:15:08   2> \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:108)\r\n09:15:08    > Expected: <256>\r\n09:15:08    >      but: was <2>\r\n09:15:08   2> \t... 1 more\r\n09:15:08    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n09:15:08   2> Caused by: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n09:15:08   2> \tat org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1543)\r\n09:15:08   2> \tat org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1537)\r\n09:15:08   2> \tat org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationPermit(IndexShard.java:2352)\r\n09:15:08   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef.performOn(ESIndexLevelReplicationTestCase.java:564)\r\n09:15:08   2> \tat org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplica(ReplicationOperation.java:160)\r\n09:15:08   2> \tat org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplicas(ReplicationOperation.java:148)\r\n09:15:08   2> \tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:119)\r\n09:15:08   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:496)\r\n09:15:08   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:226)\r\n09:15:08   2> \t... 4 more\r\n09:15:08   2> REPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:test -Dtests.seed=FCF60CAAE5D18178 -Dtests.class=org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests -Dtests.method=\"testFailLeaderReplicaShard\" -Dtests.security.manager=true -Dtests.locale=lv -Dtests.timezone=W-SU -Dcompiler.java=10 -Druntime.java=8\r\n09:15:08   2> REPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:test -Dtests.seed=FCF60CAAE5D18178 -Dtests.class=org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests -Dtests.method=\"testFailLeaderReplicaShard\" -Dtests.security.manager=true -Dtests.locale=lv -Dtests.timezone=W-SU -Dcompiler.java=10 -Druntime.java=8\r\n09:15:08   2> NOTE: leaving temporary files on disk at: /var/lib/jenkins/workspace/elastic+elasticsearch+6.x+multijob-unix-compatibility/os/opensuse/x-pack/plugin/ccr/build/testrun/test/J3/temp/org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests_FCF60CAAE5D18178-001\r\n09:15:08   2> NOTE: test params are: codec=Asserting(Lucene70): {}, docValues:{}, maxPointsInLeafNode=1844, maxMBSortInHeap=7.5056449030244785, sim=RandomSimilarity(queryNorm=false): {}, locale=lv, timezone=W-SU\r\n09:15:08   2> NOTE: Linux 4.4.104-39-default amd64/Oracle Corporation 1.8.0_181 (64-bit)/cpus=16,threads=1,free=445402808,total=514850816\r\n09:15:08   2> NOTE: All tests run in this JVM: [CcrStatsCollectorTests, ShardChangesResponseTests, ShardFollowTaskReplicationTests]\r\n09:15:08    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.assertAllEqual(ESIndexLevelReplicationTestCase.java:398)\r\n09:15:08    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.testFailLeaderReplicaShard(ShardFollowTaskReplicationTests.java:126)\r\n09:15:08    > \tat java.lang.Thread.run(Thread.java:748)Throwable #2: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=49, name=Thread-3, state=RUNNABLE, group=TGRP-ShardFollowTaskReplicationTests]\r\n09:15:08    > Caused by: java.lang.AssertionError: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n09:15:08    > \tat __randomizedtesting.SeedInfo.seed([FCF60CAAE5D18178]:0)\r\n09:15:08    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:111)\r\n09:15:08    > \tat java.lang.Thread.run(Thread.java:748)\r\n09:15:08    > Caused by: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n09:15:08    > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:265)\r\n09:15:08    > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n09:15:08    > \tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94)\r\n09:15:08    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:227)\r\n09:15:08    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.index(ESIndexLevelReplicationTestCase.java:210)\r\n09:15:08    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.appendDocs(ESIndexLevelReplicationTestCase.java:199)\r\n09:15:08    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:108)\r\n09:15:08    > \t... 1 more\r\n09:15:08    > Caused by: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n09:15:08    > \tat org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1543)\r\n09:15:08    > \tat org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1537)\r\n09:15:08    > \tat org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationPermit(IndexShard.java:2352)\r\n09:15:08    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef.performOn(ESIndexLevelReplicationTestCase.java:564)\r\n09:15:08    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplica(ReplicationOperation.java:160)\r\n09:15:08    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplicas(ReplicationOperation.java:148)\r\n09:15:08    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:119)\r\n09:15:08    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:496)\r\n09:15:08    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:226)\r\n09:15:08    > \t... 4 more\r\n09:15:08 Completed [17/25] on J3 in 4.26s, 3 tests, 1 error <<< FAILURES!\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426620106","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-426620106","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":426620106,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjYyMDEwNg==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2018-10-03T12:31:45Z","updated_at":"2018-10-03T12:31:45Z","author_association":"CONTRIBUTOR","body":"Same again in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+periodic/112/console\r\n\r\n```\r\n11:15:59    > Throwable #1: java.lang.AssertionError: \r\n11:15:59    > Expected: <256>\r\n11:15:59    >      but: was <2>\r\n11:15:59    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n11:15:59    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.assertAllEqual(ESIndexLevelReplicationTestCase.java:412)\r\n11:15:59    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.testFailLeaderReplicaShard(ShardFollowTaskReplicationTests.java:134)\r\n11:15:59    > \tat java.lang.Thread.run(Thread.java:748)\r\n11:15:59    > \tSuppressed: java.lang.AssertionError: \r\n11:15:59    > Expected: <1538565329404L>\r\n11:15:59    >      but: was <1538565329395L>\r\n11:15:59    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n11:15:59    > \t\tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.close(ESIndexLevelReplicationTestCase.java:447)\r\n11:15:59    > \t\tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.$closeResource(ShardFollowTaskReplicationTests.java:95)\r\n11:15:59    > \t\tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.testFailLeaderReplicaShard(ShardFollowTaskReplicationTests.java:139)\r\n11:15:59    > \t\t... 37 moreThrowable #2: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=46, name=Thread-2, state=RUNNABLE, group=TGRP-ShardFollowTaskReplicationTests]\r\n11:15:59    > Caused by: java.lang.AssertionError: java.util.concurrent.ExecutionException: java.util.NoSuchElementException: No value present\r\n11:15:59    > \tat __randomizedtesting.SeedInfo.seed([957CFC10C20DF8BE]:0)\r\n11:15:59    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:119)\r\n11:15:59    > \tat java.lang.Thread.run(Thread.java:748)\r\n11:15:59    > Caused by: java.util.concurrent.ExecutionException: java.util.NoSuchElementException: No value present\r\n11:15:59    > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:265)\r\n11:15:59    > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n11:15:59    > \tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94)\r\n11:15:59    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:241)\r\n11:15:59    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.index(ESIndexLevelReplicationTestCase.java:224)\r\n11:15:59    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.appendDocs(ESIndexLevelReplicationTestCase.java:213)\r\n11:15:59    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:116)\r\n11:15:59    > \t... 1 more\r\n11:15:59    > Caused by: java.util.NoSuchElementException: No value present\r\n11:15:59    > \tat java.util.Optional.get(Optional.java:135)\r\n11:15:59    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef.performOn(ESIndexLevelReplicationTestCase.java:590)\r\n11:15:59    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplica(ReplicationOperation.java:166)\r\n11:15:59    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplicas(ReplicationOperation.java:153)\r\n11:15:59    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:124)\r\n11:15:59    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:517)\r\n11:15:59    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:240)\r\n11:15:59    > \t... 4 more\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/430133190","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-430133190","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":430133190,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMDEzMzE5MA==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2018-10-16T07:37:15Z","updated_at":"2018-10-16T07:37:15Z","author_association":"MEMBER","body":"again in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=amazon/57/consoleFull\r\n\r\n```\r\n06:15:23 ERROR   0.87s J3 | ShardFollowTaskReplicationTests.testFailLeaderReplicaShard <<< FAILURES!\r\n06:15:23    > Throwable #1: java.lang.AssertionError: \r\n06:15:23   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:519)\r\n06:15:23    > Expected: <256>\r\n06:15:23   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:241)\r\n06:15:23    >      but: was <4>\r\n06:15:23    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n06:15:23   2> \t... 4 more\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.assertAllEqual(ESIndexLevelReplicationTestCase.java:413)\r\n06:15:23    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.testFailLeaderReplicaShard(ShardFollowTaskReplicationTests.java:140)\r\n06:15:23    > \tat java.lang.Thread.run(Thread.java:748)\r\n06:15:23   2> Caused by: [test/uuid][[test][0]] IllegalIndexShardStateException[CurrentState[CLOSED] operation only allowed when shard state is one of [RECOVERING, POST_RECOVERY, STARTED], origin [REPLICA]]\r\n06:15:23    > \tSuppressed: java.lang.AssertionError: \r\n06:15:23    > Expected: <[DocIdSeqNoAndTerm{id='eqmia2YBF_ihSIXXxJTA seqNo=0 primaryTerm=92}]>\r\n06:15:23   2> \tat org.elasticsearch.index.shard.IndexShard.ensureWriteAllowed(IndexShard.java:1491)\r\n06:15:23    >      but: was <[DocIdSeqNoAndTerm{id='e6mia2YBF_ihSIXXxJT2 seqNo=1 primaryTerm=92}, DocIdSeqNoAndTerm{id='eqmia2YBF_ihSIXXxJTA seqNo=0 primaryTerm=92}, DocIdSeqNoAndTerm{id='fKmia2YBF_ihSIXXxJT7 seqNo=2 primaryTerm=92}, DocIdSeqNoAndTerm{id='famia2YBF_ihSIXXxJT8 seqNo=3 primaryTerm=92}]>\r\n06:15:23   2> \tat org.elasticsearch.index.shard.IndexShard.applyIndexOperation(IndexShard.java:695)\r\n06:15:23    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n06:15:23    > \t\tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.close(ESIndexLevelReplicationTestCase.java:451)\r\n06:15:23    > \t\tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.testFailLeaderReplicaShard(ShardFollowTaskReplicationTests.java:105)\r\n06:15:23   2> \tat org.elasticsearch.index.shard.IndexShard.applyIndexOperationOnReplica(IndexShard.java:686)\r\n06:15:23    > \t\t... 37 moreThrowable #2: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=51, name=Thread-3, state=RUNNABLE, group=TGRP-ShardFollowTaskReplicationTests]\r\n06:15:23   2> \tat org.elasticsearch.action.bulk.TransportShardBulkAction.performOpOnReplica(TransportShardBulkAction.java:425)\r\n06:15:23    > Caused by: java.lang.AssertionError: java.util.concurrent.ExecutionException: java.lang.UnsupportedOperationException: failing shard [test][0], node[s1], [R], recovery_source[peer recovery], s[INITIALIZING], a[id=CGyfPmgCRg2RTGGZX8Z1-Q], unassigned_info[[reason=ALLOCATION_FAILED], at[2018-10-13T04:15:20.927Z], failed_attempts[1], delayed=false, details[auto generated for test], allocation_status[no_attempt]] isn't supported. failure: failed to perform indexing on replica [test][0], node[s1], [R], recovery_source[peer recovery], s[INITIALIZING], a[id=CGyfPmgCRg2RTGGZX8Z1-Q], unassigned_info[[reason=ALLOCATION_FAILED], at[2018-10-13T04:15:20.927Z], failed_attempts[1], delayed=false, details[auto generated for test], allocation_status[no_attempt]]\r\n06:15:23    > \tat __randomizedtesting.SeedInfo.seed([246DD1D92AF4EE78]:0)\r\n06:15:23   2> \tat org.elasticsearch.action.bulk.TransportShardBulkAction.performOnReplica(TransportShardBulkAction.java:393)\r\n06:15:23    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:125)\r\n06:15:23    > \tat java.lang.Thread.run(Thread.java:748)\r\n06:15:23   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase.executeShardBulkOnReplica(ESIndexLevelReplicationTestCase.java:711)\r\n06:15:23    > Caused by: java.util.concurrent.ExecutionException: java.lang.UnsupportedOperationException: failing shard [test][0], node[s1], [R], recovery_source[peer recovery], s[INITIALIZING], a[id=CGyfPmgCRg2RTGGZX8Z1-Q], unassigned_info[[reason=ALLOCATION_FAILED], at[2018-10-13T04:15:20.927Z], failed_attempts[1], delayed=false, details[auto generated for test], allocation_status[no_attempt]] isn't supported. failure: failed to perform indexing on replica [test][0], node[s1], [R], recovery_source[peer recovery], s[INITIALIZING], a[id=CGyfPmgCRg2RTGGZX8Z1-Q], unassigned_info[[reason=ALLOCATION_FAILED], at[2018-10-13T04:15:20.927Z], failed_attempts[1], delayed=false, details[auto generated for test], allocation_status[no_attempt]]\r\n06:15:23    > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:265)\r\n06:15:23    > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n06:15:23   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase.access$2100(ESIndexLevelReplicationTestCase.java:103)\r\n06:15:23    > \tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94)\r\n06:15:23   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$WriteReplicationAction.performOnReplica(ESIndexLevelReplicationTestCase.java:673)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:242)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.index(ESIndexLevelReplicationTestCase.java:225)\r\n06:15:23   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$WriteReplicationAction.performOnReplica(ESIndexLevelReplicationTestCase.java:658)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.appendDocs(ESIndexLevelReplicationTestCase.java:214)\r\n06:15:23    > \tat org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:122)\r\n06:15:23    > \t... 1 more\r\n06:15:23   2> \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef$1.onResponse(ESIndexLevelReplicationTestCase.java:601)\r\n06:15:23    > Caused by: java.lang.UnsupportedOperationException: failing shard [test][0], node[s1], [R], recovery_source[peer recovery], s[INITIALIZING], a[id=CGyfPmgCRg2RTGGZX8Z1-Q], unassigned_info[[reason=ALLOCATION_FAILED], at[2018-10-13T04:15:20.927Z], failed_attempts[1], delayed=false, details[auto generated for test], allocation_status[no_attempt]] isn't supported. failure: failed to perform indexing on replica [test][0], node[s1], [R], recovery_source[peer recovery], s[INITIALIZING], a[id=CGyfPmgCRg2RTGGZX8Z1-Q], unassigned_info[[reason=ALLOCATION_FAILED], at[2018-10-13T04:15:20.927Z], failed_attempts[1], delayed=false, details[auto generated for test], allocation_status[no_attempt]]\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef.failShardIfNeeded(ESIndexLevelReplicationTestCase.java:622)\r\n06:15:23   2> \t... 16 more\r\n06:15:23    > \tat org.elasticsearch.action.support.replication.ReplicationOperation$1.onFailure(ReplicationOperation.java:195)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef$1.onResponse(ESIndexLevelReplicationTestCase.java:606)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef$1.onResponse(ESIndexLevelReplicationTestCase.java:597)\r\n06:15:23    > \tat org.elasticsearch.index.shard.IndexShard$3.onResponse(IndexShard.java:2387)\r\n06:15:23    > \tat org.elasticsearch.index.shard.IndexShard$3.onResponse(IndexShard.java:2365)\r\n06:15:23    > \tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:267)\r\n06:15:23    > \tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:234)\r\n06:15:23    > \tat org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationPermit(IndexShard.java:2364)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef.performOn(ESIndexLevelReplicationTestCase.java:593)\r\n06:15:23    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplica(ReplicationOperation.java:166)\r\n06:15:23    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplicas(ReplicationOperation.java:153)\r\n06:15:23    > \tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:124)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:519)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:241)\r\n06:15:23    > \t... 4 more\r\n06:15:23    > Caused by: [test/uuid][[test][0]] IllegalIndexShardStateException[CurrentState[CLOSED] operation only allowed when shard state is one of [RECOVERING, POST_RECOVERY, STARTED], origin [REPLICA]]\r\n06:15:23    > \tat org.elasticsearch.index.shard.IndexShard.ensureWriteAllowed(IndexShard.java:1491)\r\n06:15:23    > \tat org.elasticsearch.index.shard.IndexShard.applyIndexOperation(IndexShard.java:695)\r\n06:15:23    > \tat org.elasticsearch.index.shard.IndexShard.applyIndexOperationOnReplica(IndexShard.java:686)\r\n06:15:23    > \tat org.elasticsearch.action.bulk.TransportShardBulkAction.performOpOnReplica(TransportShardBulkAction.java:425)\r\n06:15:23    > \tat org.elasticsearch.action.bulk.TransportShardBulkAction.performOnReplica(TransportShardBulkAction.java:393)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase.executeShardBulkOnReplica(ESIndexLevelReplicationTestCase.java:711)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase.access$2100(ESIndexLevelReplicationTestCase.java:103)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$WriteReplicationAction.performOnReplica(ESIndexLevelReplicationTestCase.java:673)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$WriteReplicationAction.performOnReplica(ESIndexLevelReplicationTestCase.java:658)\r\n06:15:23    > \tat org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef$1.onResponse(ESIndexLevelReplicationTestCase.java:601)\r\n06:15:23    > \t... 16 more\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431002818","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-431002818","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":431002818,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTAwMjgxOA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-10-18T13:12:21Z","updated_at":"2018-10-18T13:12:21Z","author_association":"CONTRIBUTOR","body":"This looks to be still failing:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=ubuntu&&virtual/4/consoleText\r\n \r\n```\r\njava.lang.AssertionError: java.util.concurrent.ExecutionException: java.util.NoSuchElementException: No value present\r\n```\r\n\r\n@dnhatn can you have another look?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/441244437","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-441244437","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":441244437,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTI0NDQzNw==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2018-11-23T13:43:10Z","updated_at":"2018-11-23T13:43:10Z","author_association":"MEMBER","body":"I hit this error in a PR build. Admittedly this was on a feature branch but it was recently merged with master in this commit https://github.com/elastic/elasticsearch/commit/d01436de3c55b9c206b89b868c5281a68b06f7d4\r\n\r\nThe [console output from jenkins](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+pull-request-2/255/console) is mangled but separating the lines marked with `1>`, `2>` and those without either I get. \r\n\r\n```\r\n13:17:46   1> [2018-11-23T13:17:34,379][WARN ][o.e.b.JNANatives         ] [[SUITE-ShardFollowTaskReplicationTests-seed#[C6BC6CCDF1C7D887]]] Unable to lock JVM Memory: error=12, reason=Cannot allocate memory\r\n13:17:46   1> [2018-11-23T13:17:34,385][WARN ][o.e.b.JNANatives         ] [[SUITE-ShardFollowTaskReplicationTests-seed#[C6BC6CCDF1C7D887]]] This can result in part of the JVM being swapped out.\r\n13:17:46   1> [2018-11-23T13:17:34,386][WARN ][o.e.b.JNANatives         ] [[SUITE-ShardFollowTaskReplicationTests-seed#[C6BC6CCDF1C7D887]]] Increase RLIMIT_MEMLOCK, soft limit: 65536, hard limit: 65536\r\n13:17:46   1> [2018-11-23T13:17:34,386][WARN ][o.e.b.JNANatives         ] [[SUITE-ShardFollowTaskReplicationTests-seed#[C6BC6CCDF1C7D887]]] These can be adjusted by modifying /etc/security/limits.conf, for example:\r\n13:17:46   1>   # allow user 'jenkins' mlockall\r\n13:17:46   1>   jenkins soft memlock unlimited\r\n13:17:46   1>   jenkins hard memlock unlimited\r\n13:17:46   1> [2018-11-23T13:17:34,387][WARN ][o.e.b.JNANatives         ] [[SUITE-ShardFollowTaskReplicationTests-seed#[C6BC6CCDF1C7D887]]] If you are logged in interactively, you will have to re-login for the new limits to take effect.\r\n13:17:46   1> [2018-11-23T15:17:37,060][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testSimpleCcrReplication] before test\r\n13:17:46   1> [2018-11-23T15:17:42,198][INFO ][o.e.x.c.a.ShardFollowNodeTask] [testSimpleCcrReplication] [follow_index][0] following leader shard [leader_index][0], follower global checkpoint=[-1], mapping version=[1], settings version=[1]\r\n13:17:46   1> [2018-11-23T15:17:43,751][INFO ][o.e.x.c.a.ShardFollowNodeTask] [org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests] [follow_index][0] shard follow task has been stopped\r\n13:17:46   1> [2018-11-23T15:17:44,078][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testSimpleCcrReplication] after test\r\n13:17:46   1> [2018-11-23T15:17:44,095][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testFailLeaderReplicaShard] before test\r\n13:17:46   1> [2018-11-23T15:17:44,355][INFO ][o.e.x.c.a.ShardFollowNodeTask] [testFailLeaderReplicaShard] [follow_index][0] following leader shard [leader_index][0], follower global checkpoint=[-1], mapping version=[1], settings version=[1]\r\n13:17:46   1> [2018-11-23T15:17:44,599][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testFailLeaderReplicaShard] after test\r\n13:17:46   1> [2018-11-23T15:17:44,656][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testChangeFollowerHistoryUUID] before test\r\n13:17:46   1> [2018-11-23T15:17:44,772][INFO ][o.e.x.c.a.ShardFollowNodeTask] [testChangeFollowerHistoryUUID] [follow_index][0] following leader shard [leader_index][0], follower global checkpoint=[-1], mapping version=[1], settings version=[1]\r\n13:17:46   1> [2018-11-23T15:17:44,913][WARN ][o.e.x.c.a.ShardFollowNodeTask] [org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests] shard follow task encounter non-retryable error\r\n13:17:46   1> java.lang.IllegalStateException: unexpected history uuid, expected [G-vFe7hdRDWtzbCyLHry7Q], actual [haj2ZP35Q8u1fZgrLmDtow], shard is likely restored from snapshot or force allocated\r\n13:17:46   1>   at org.elasticsearch.xpack.ccr.action.bulk.TransportBulkShardOperationsAction.shardOperationOnPrimary(TransportBulkShardOperationsAction.java:115) ~[main/:?]\r\n13:17:46   1>   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests$CcrAction.performOnPrimary(ShardFollowTaskReplicationTests.java:520) ~[test/:?]\r\n13:17:46   1>   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests$CcrAction.performOnPrimary(ShardFollowTaskReplicationTests.java:508) ~[test/:?]\r\n13:17:46   1>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$PrimaryRef.perform(ESIndexLevelReplicationTestCase.java:598) ~[framework-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n13:17:46   1>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$PrimaryRef.perform(ESIndexLevelReplicationTestCase.java:584) ~[framework-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n13:17:46   1>   at org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:102) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n13:17:46   1>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:570) ~[framework-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n13:17:46   1>   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests$3.lambda$innerSendBulkShardOperationsRequest$0(ShardFollowTaskReplicationTests.java:422) ~[test/:?]\r\n13:17:46   1>   at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:627) [elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n13:17:46   1>   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_192]\r\n13:17:46   1>   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_192]\r\n13:17:46   1>   at java.lang.Thread.run(Thread.java:748) [?:1.8.0_192]\r\n13:17:46   1> [2018-11-23T15:17:44,925][INFO ][o.e.x.c.a.ShardFollowNodeTask] [org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests] [follow_index][0] shard follow task has been stopped\r\n13:17:46   1> [2018-11-23T15:17:44,926][INFO ][o.e.x.c.a.ShardFollowNodeTask] [org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests] [follow_index][0] shard follow task has been stopped\r\n13:17:46   1> [2018-11-23T15:17:45,006][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testChangeFollowerHistoryUUID] after test\r\n13:17:46   1> [2018-11-23T15:17:45,012][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testAddNewFollowingReplica] before test\r\n13:17:46   1> [2018-11-23T15:17:45,242][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testAddNewFollowingReplica] after test\r\n13:17:46   1> [2018-11-23T15:17:45,249][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testRetryBulkShardOperations] before test\r\n13:17:46   1> [2018-11-23T15:17:45,512][INFO ][o.e.x.c.a.ShardFollowNodeTask] [testRetryBulkShardOperations] [follow_index][0] following leader shard [leader_index][0], follower global checkpoint=[-1], mapping version=[1], settings version=[1]\r\n13:17:46   1> [2018-11-23T15:17:45,548][INFO ][o.e.i.s.IndexShard       ] [org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests] [test][0] primary-replica resync completed with 0 operations\r\n13:17:46   1> [2018-11-23T15:17:45,679][INFO ][o.e.x.c.a.ShardFollowNodeTask] [org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests] [follow_index][0] shard follow task has been stopped\r\n13:17:46   1> [2018-11-23T15:17:45,700][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testRetryBulkShardOperations] after test\r\n13:17:46   1> [2018-11-23T15:17:45,708][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testChangeLeaderHistoryUUID] before test\r\n13:17:46   1> [2018-11-23T15:17:45,813][INFO ][o.e.x.c.a.ShardFollowNodeTask] [testChangeLeaderHistoryUUID] [follow_index][0] following leader shard [leader_index][0], follower global checkpoint=[-1], mapping version=[1], settings version=[1]\r\n13:17:46   1> [2018-11-23T15:17:45,898][WARN ][o.e.x.c.a.ShardFollowNodeTask] [org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests] shard follow task encounter non-retryable error\r\n13:17:46   1> java.lang.IllegalStateException: unexpected history uuid, expected [g_4zPgZOR_GdaX24aTdYQw], actual [3JLN3KM_TDisa-PcdA1yag]\r\n13:17:46   1>   at org.elasticsearch.xpack.ccr.action.ShardChangesAction.getOperations(ShardChangesAction.java:505) ~[main/:?]\r\n13:17:46   1>   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests$3.lambda$innerSendShardChangesRequest$1(ShardFollowTaskReplicationTests.java:445) ~[test/:?]\r\n13:17:46   1>   at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:627) [elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n13:17:46   1>   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_192]\r\n13:17:46   1>   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_192]\r\n13:17:46   1>   at java.lang.Thread.run(Thread.java:748) [?:1.8.0_192]\r\n13:17:46   1> [2018-11-23T15:17:45,951][INFO ][o.e.x.c.a.ShardFollowTaskReplicationTests] [testChangeLeaderHistoryUUID] after test\r\n```\r\n\r\n```\r\n13:17:46   2> nov. 23, 2018 3:17:44 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n13:17:46   2> AVERTISSEMENT: Uncaught exception in thread: Thread[Thread-3,5,TGRP-ShardFollowTaskReplicationTests]\r\n13:17:46   2> java.lang.AssertionError: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n13:17:46   2>   at __randomizedtesting.SeedInfo.seed([C6BC6CCDF1C7D887]:0)\r\n13:17:46   2>   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:130)\r\n13:17:46   2>   at java.lang.Thread.run(Thread.java:748)\r\n13:17:46   2> Caused by: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n13:17:46   2>   at org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:265)\r\n13:17:46   2>   at org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n13:17:46   2>   at org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94)\r\n13:17:46   2>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:245)\r\n13:17:46   2>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.index(ESIndexLevelReplicationTestCase.java:228)\r\n13:17:46   2>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.appendDocs(ESIndexLevelReplicationTestCase.java:217)\r\n13:17:46   2>   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:127)\r\n13:17:46   2>   ... 1 more\r\n13:17:46   2> Caused by: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n13:17:46   2>   at org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1526)\r\n13:17:46   2>   at org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1520)\r\n13:17:46   2>   at org.elasticsearch.index.shard.IndexShard.innerAcquireReplicaOperationPermit(IndexShard.java:2402)\r\n13:17:46   2>   at org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationPermit(IndexShard.java:2371)\r\n13:17:46   2>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef.performOn(ESIndexLevelReplicationTestCase.java:643)\r\n13:17:46   2>   at org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplica(ReplicationOperation.java:166)\r\n13:17:46   2>   at org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplicas(ReplicationOperation.java:153)\r\n13:17:46   2>   at org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:124)\r\n13:17:46   2>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:570)\r\n13:17:46   2>   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:244)\r\n13:17:46   2>   ... 4 more\r\n13:17:46   2> nov. 23, 2018 3:17:44 PM com.carrotsearch.randomizedtesting.RandomizedRunner$QueueUncaughtExceptionsHandler uncaughtException\r\n13:17:46   2> AVERTISSEMENT: Uncaught exception in thread: Thread[elasticsearch[org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests][generic][T#2],5,TGRP-ShardFollowTaskReplicationTests]\r\n13:17:46   2> org.elasticsearch.common.util.concurrent.EsRejectedExecutionException: rejected execution of java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask@3393dfb7 on java.util.concurrent.ScheduledThreadPoolExecutor@4e747682[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]\r\n13:17:46   2>   at __randomizedtesting.SeedInfo.seed([C6BC6CCDF1C7D887]:0)\r\n13:17:46   2>   at org.elasticsearch.common.util.concurrent.EsAbortPolicy.rejectedExecution(EsAbortPolicy.java:48)\r\n13:17:46   2>   at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:830)\r\n13:17:46   2>   at java.util.concurrent.ScheduledThreadPoolExecutor.delayedExecute(ScheduledThreadPoolExecutor.java:326)\r\n13:17:46   2>   at java.util.concurrent.ScheduledThreadPoolExecutor.schedule(ScheduledThreadPoolExecutor.java:533)\r\n13:17:46   2>   at org.elasticsearch.threadpool.ThreadPool.schedule(ThreadPool.java:351)\r\n13:17:46   2>   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$createShardFollowTask$11(ShardFollowTaskReplicationTests.java:384)\r\n13:17:46   2>   at org.elasticsearch.xpack.ccr.action.ShardFollowNodeTask.handleFailure(ShardFollowNodeTask.java:427)\r\n13:17:46   2>   at org.elasticsearch.xpack.ccr.action.ShardFollowNodeTask.lambda$sendShardChangesRequest$4(ShardFollowNodeTask.java:278)\r\n13:17:46   2>   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests$3.lambda$innerSendShardChangesRequest$1(ShardFollowTaskReplicationTests.java:464)\r\n13:17:46   2>   at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:627)\r\n13:17:46   2>   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n13:17:46   2>   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n13:17:46   2>   at java.lang.Thread.run(Thread.java:748)\r\n13:17:46   2> REPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:test -Dtests.seed=C6BC6CCDF1C7D887 -Dtests.class=org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests -Dtests.method=\"testFailLeaderReplicaShard\" -Dtests.security.manager=true -Dtests.locale=fr-BE -Dtests.timezone=Asia/Hebron -Dcompiler.java=11 -Druntime.java=8\r\n13:17:46   2> REPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:test -Dtests.seed=C6BC6CCDF1C7D887 -Dtests.class=org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests -Dtests.method=\"testFailLeaderReplicaShard\" -Dtests.security.manager=true -Dtests.locale=fr-BE -Dtests.timezone=Asia/Hebron -Dcompiler.java=11 -Druntime.java=8\r\n13:17:46   2> REPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:test -Dtests.seed=C6BC6CCDF1C7D887 -Dtests.class=org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests -Dtests.method=\"testFailLeaderReplicaShard\" -Dtests.security.manager=true -Dtests.locale=fr-BE -Dtests.timezone=Asia/Hebron -Dcompiler.java=11 -Druntime.java=8\r\n13:17:46    >      but: was <2>\r\n13:17:46   2> NOTE: leaving temporary files on disk at: /var/lib/jenkins/workspace/elastic+elasticsearch+pull-request-2/x-pack/plugin/ccr/build/testrun/test/J3/temp/org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests_C6BC6CCDF1C7D887-001\r\n13:17:46   2> NOTE: test params are: codec=Asserting(Lucene80): {}, docValues:{}, maxPointsInLeafNode=1965, maxMBSortInHeap=5.650392842402848, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@35d797ae), locale=fr-BE, timezone=Asia/Hebron\r\n13:17:46   2> NOTE: Linux 3.10.0-862.14.4.el7.x86_64 amd64/Oracle Corporation 1.8.0_192 (64-bit)/cpus=16,threads=1,free=473948104,total=513277952\r\n13:17:46   2> NOTE: All tests run in this JVM: [ShardFollowTaskReplicationTests]\r\n```\r\n\r\n```\r\n13:17:46 ERROR   0.54s J3 | ShardFollowTaskReplicationTests.testFailLeaderReplicaShard <<< FAILURES!\r\n13:17:46    > Throwable #1: java.lang.AssertionError:\r\n13:17:46    > Expected: <256>\r\n13:17:46    >   at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n13:17:46    >   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.assertAllEqual(ESIndexLevelReplicationTestCase.java:427)\r\n13:17:46    >   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.testFailLeaderReplicaShard(ShardFollowTaskReplicationTests.java:145)\r\n13:17:46    >   at java.lang.Thread.run(Thread.java:748)Throwable #2: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=35, name=Thread-3, state=RUNNABLE, group=TGRP-ShardFollowTaskReplicationTests]\r\n13:17:46    > Caused by: java.lang.AssertionError: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n13:17:46    >   at __randomizedtesting.SeedInfo.seed([C6BC6CCDF1C7D887]:0)\r\n13:17:46    >   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:130)\r\n13:17:46    >   at java.lang.Thread.run(Thread.java:748)\r\n13:17:46    > Caused by: java.util.concurrent.ExecutionException: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n13:17:46    >   at org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:265)\r\n13:17:46    >   at org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n13:17:46    >   at org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94)\r\n13:17:46    >   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:245)\r\n13:17:46    >   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.index(ESIndexLevelReplicationTestCase.java:228)\r\n13:17:46    >   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.appendDocs(ESIndexLevelReplicationTestCase.java:217)\r\n13:17:46    >   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$testFailLeaderReplicaShard$2(ShardFollowTaskReplicationTests.java:127)\r\n13:17:46    >   ... 1 more\r\n13:17:46    > Caused by: [test/uuid][[test][0]] IndexShardClosedException[CurrentState[CLOSED] operation only allowed when not closed]\r\n13:17:46    >   at org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1526)\r\n13:17:46    >   at org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1520)\r\n13:17:46    >   at org.elasticsearch.index.shard.IndexShard.innerAcquireReplicaOperationPermit(IndexShard.java:2402)\r\n13:17:46    >   at org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationPermit(IndexShard.java:2371)\r\n13:17:46    >   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction$ReplicasRef.performOn(ESIndexLevelReplicationTestCase.java:643)\r\n13:17:46    >   at org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplica(ReplicationOperation.java:166)\r\n13:17:46    >   at org.elasticsearch.action.support.replication.ReplicationOperation.performOnReplicas(ReplicationOperation.java:153)\r\n13:17:46    >   at org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:124)\r\n13:17:46    >   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationAction.execute(ESIndexLevelReplicationTestCase.java:570)\r\n13:17:46    >   at org.elasticsearch.index.replication.ESIndexLevelReplicationTestCase$ReplicationGroup.executeWriteRequest(ESIndexLevelReplicationTestCase.java:244)\r\n13:17:46    >   ... 4 moreThrowable #3: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=32, name=elasticsearch[org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests][generic][T#2], state=RUNNABLE, group=TGRP-ShardFollowTaskReplicationTests]\r\n13:17:46    > Caused by: org.elasticsearch.common.util.concurrent.EsRejectedExecutionException: rejected execution of java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask@3393dfb7 on java.util.concurrent.ScheduledThreadPoolExecutor@4e747682[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]\r\n13:17:46    >   at __randomizedtesting.SeedInfo.seed([C6BC6CCDF1C7D887]:0)\r\n13:17:46    >   at org.elasticsearch.common.util.concurrent.EsAbortPolicy.rejectedExecution(EsAbortPolicy.java:48)\r\n13:17:46    >   at java.util.concurrent.ThreadPoolExecutor.reject(ThreadPoolExecutor.java:830)\r\n13:17:46    >   at java.util.concurrent.ScheduledThreadPoolExecutor.delayedExecute(ScheduledThreadPoolExecutor.java:326)\r\n13:17:46    >   at java.util.concurrent.ScheduledThreadPoolExecutor.schedule(ScheduledThreadPoolExecutor.java:533)\r\n13:17:46    >   at org.elasticsearch.threadpool.ThreadPool.schedule(ThreadPool.java:351)\r\n13:17:46    >   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests.lambda$createShardFollowTask$11(ShardFollowTaskReplicationTests.java:384)\r\n13:17:46    >   at org.elasticsearch.xpack.ccr.action.ShardFollowNodeTask.handleFailure(ShardFollowNodeTask.java:427)\r\n13:17:46    >   at org.elasticsearch.xpack.ccr.action.ShardFollowNodeTask.lambda$sendShardChangesRequest$4(ShardFollowNodeTask.java:278)\r\n13:17:46    >   at org.elasticsearch.xpack.ccr.action.ShardFollowTaskReplicationTests$3.lambda$innerSendShardChangesRequest$1(ShardFollowTaskReplicationTests.java:464)\r\n13:17:46    >   at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:627)\r\n13:17:46    >   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n13:17:46    >   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n13:17:46    >   at java.lang.Thread.run(Thread.java:748)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/445422627","html_url":"https://github.com/elastic/elasticsearch/issues/33457#issuecomment-445422627","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33457","id":445422627,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTQyMjYyNw==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-12-08T02:28:01Z","updated_at":"2018-12-08T02:28:01Z","author_association":"MEMBER","body":"Another instance on 6.x: \r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+intake/517/console","performed_via_github_app":null}]