[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28873161","html_url":"https://github.com/elastic/elasticsearch/issues/3846#issuecomment-28873161","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3846","id":28873161,"node_id":"MDEyOklzc3VlQ29tbWVudDI4ODczMTYx","user":{"login":"JimminiKin","id":1327193,"node_id":"MDQ6VXNlcjEzMjcxOTM=","avatar_url":"https://avatars3.githubusercontent.com/u/1327193?v=4","gravatar_id":"","url":"https://api.github.com/users/JimminiKin","html_url":"https://github.com/JimminiKin","followers_url":"https://api.github.com/users/JimminiKin/followers","following_url":"https://api.github.com/users/JimminiKin/following{/other_user}","gists_url":"https://api.github.com/users/JimminiKin/gists{/gist_id}","starred_url":"https://api.github.com/users/JimminiKin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JimminiKin/subscriptions","organizations_url":"https://api.github.com/users/JimminiKin/orgs","repos_url":"https://api.github.com/users/JimminiKin/repos","events_url":"https://api.github.com/users/JimminiKin/events{/privacy}","received_events_url":"https://api.github.com/users/JimminiKin/received_events","type":"User","site_admin":false},"created_at":"2013-11-20T09:19:59Z","updated_at":"2013-11-20T09:19:59Z","author_association":"NONE","body":"Follow up to this bug : \n\nin the example I first gave and for versions 0.90.1 to 0.90.5, setting statistical.field to \"price\" was working, as of 0.90.6 (also true for 0.90.7), setting statistical.field to the full field path (\"prices.price\") is necessary.\n\nThe initial issue is still there though.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/33368216","html_url":"https://github.com/elastic/elasticsearch/issues/3846#issuecomment-33368216","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3846","id":33368216,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMzY4MjE2","user":{"login":"Kamapcuc","id":3963805,"node_id":"MDQ6VXNlcjM5NjM4MDU=","avatar_url":"https://avatars2.githubusercontent.com/u/3963805?v=4","gravatar_id":"","url":"https://api.github.com/users/Kamapcuc","html_url":"https://github.com/Kamapcuc","followers_url":"https://api.github.com/users/Kamapcuc/followers","following_url":"https://api.github.com/users/Kamapcuc/following{/other_user}","gists_url":"https://api.github.com/users/Kamapcuc/gists{/gist_id}","starred_url":"https://api.github.com/users/Kamapcuc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kamapcuc/subscriptions","organizations_url":"https://api.github.com/users/Kamapcuc/orgs","repos_url":"https://api.github.com/users/Kamapcuc/repos","events_url":"https://api.github.com/users/Kamapcuc/events{/privacy}","received_events_url":"https://api.github.com/users/Kamapcuc/received_events","type":"User","site_admin":false},"created_at":"2014-01-27T13:45:18Z","updated_at":"2014-01-27T13:45:33Z","author_association":"NONE","body":"@JimminiKin We encountered with that bug too. We have expensive query, so it's very undesirable to make one more request just for calculating facet values. :( \n+1 vote for fixing that\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37549441","html_url":"https://github.com/elastic/elasticsearch/issues/3846#issuecomment-37549441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3846","id":37549441,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTQ5NDQx","user":{"login":"cmenning","id":2422228,"node_id":"MDQ6VXNlcjI0MjIyMjg=","avatar_url":"https://avatars0.githubusercontent.com/u/2422228?v=4","gravatar_id":"","url":"https://api.github.com/users/cmenning","html_url":"https://github.com/cmenning","followers_url":"https://api.github.com/users/cmenning/followers","following_url":"https://api.github.com/users/cmenning/following{/other_user}","gists_url":"https://api.github.com/users/cmenning/gists{/gist_id}","starred_url":"https://api.github.com/users/cmenning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmenning/subscriptions","organizations_url":"https://api.github.com/users/cmenning/orgs","repos_url":"https://api.github.com/users/cmenning/repos","events_url":"https://api.github.com/users/cmenning/events{/privacy}","received_events_url":"https://api.github.com/users/cmenning/received_events","type":"User","site_admin":false},"created_at":"2014-03-13T15:50:58Z","updated_at":"2014-03-13T15:50:58Z","author_association":"NONE","body":"I'm also running into this. I've got a nested terms facet, and am trying to filter it on the parent document. \n- Without a filter, the nested terms facet returns all nested terms across all parent documents.\n- With the filter, the nested terms facet returns no results, even though there are matching documents. \n\nMy filter works properly on non-nested facets.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37557148","html_url":"https://github.com/elastic/elasticsearch/issues/3846#issuecomment-37557148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3846","id":37557148,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTU3MTQ4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-03-13T16:54:32Z","updated_at":"2014-03-13T16:54:32Z","author_association":"CONTRIBUTOR","body":"With the facets framework, there is no way of fixing this particular issue. It is a question of exposing either the root doc's context or the nested doc's context.\n\nHowever, with the new aggregations, you can now do what you need. It's a bit verbose but it works:\n\n```\nPOST /test/object/_search?size=0\n{\n  \"query\": {\n    \"terms\": {\n      \"tags\": [\n        \"one\"\n      ]\n    }\n  },\n  \"aggs\": {\n    \"all_docs\": {\n      \"global\": {},\n      \"aggs\": {\n        \"tags_one\": {\n          \"filter\": {\n            \"term\": {\n              \"tags\": \"one\"\n            }\n          },\n          \"aggs\": {\n            \"prices\": {\n              \"nested\": {\n                \"path\": \"prices\"\n              },\n              \"aggs\": {\n                \"type_one\": {\n                  \"filter\": {\n                    \"term\": {\n                      \"prices.type\": \"TYPEONE\"\n                    }\n                  },\n                  \"aggs\": {\n                    \"min_max\": {\n                      \"stats\": {\n                        \"field\": \"prices.price\"\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n","performed_via_github_app":null}]