{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39375","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39375/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39375/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39375/events","html_url":"https://github.com/elastic/elasticsearch/issues/39375","id":414291593,"node_id":"MDU6SXNzdWU0MTQyOTE1OTM=","number":39375,"title":"epoch_millis filter doesn't allow negative values","user":{"login":"flash1293","id":1508364,"node_id":"MDQ6VXNlcjE1MDgzNjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/1508364?v=4","gravatar_id":"","url":"https://api.github.com/users/flash1293","html_url":"https://github.com/flash1293","followers_url":"https://api.github.com/users/flash1293/followers","following_url":"https://api.github.com/users/flash1293/following{/other_user}","gists_url":"https://api.github.com/users/flash1293/gists{/gist_id}","starred_url":"https://api.github.com/users/flash1293/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flash1293/subscriptions","organizations_url":"https://api.github.com/users/flash1293/orgs","repos_url":"https://api.github.com/users/flash1293/repos","events_url":"https://api.github.com/users/flash1293/events{/privacy}","received_events_url":"https://api.github.com/users/flash1293/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-02-25T20:27:08Z","updated_at":"2019-03-19T16:07:09Z","closed_at":"2019-03-19T16:07:09Z","author_association":"NONE","active_lock_reason":null,"body":"Prior to 7.0 it was possible to use negative values in an epoc_millis range filter. This now fails with a parse exception\r\n\r\nSteps to reproduce:\r\n```\r\nPUT my_index/_doc/1\r\n{\r\n  \"datefield\": \"2015-03-03\"\r\n}\r\n\r\nGET my_index/_search\r\n{\r\n  \"query\": {\r\n    \"range\": {\r\n      \"datefield\": {\r\n        \"gte\": -500,\r\n        \"format\": \"epoch_millis\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nVersion 6.6 correctly returns the search result containing one hit, 7.0.0 gives\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"parse_exception\",\r\n        \"reason\": \"failed to parse date field [-500] with format [epoch_millis]: [Text '-500' could not be parsed: Invalid value for NanoOfSecond (valid values 0 - 999999999): -500000000]\"\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"my_index\",\r\n        \"node\": \"Q0HRRl8ISLuL5b64A9n3IA\",\r\n        \"reason\": {\r\n          \"type\": \"parse_exception\",\r\n          \"reason\": \"failed to parse date field [-500] with format [epoch_millis]: [Text '-500' could not be parsed: Invalid value for NanoOfSecond (valid values 0 - 999999999): -500000000]\",\r\n          \"caused_by\": {\r\n            \"type\": \"date_time_parse_exception\",\r\n            \"reason\": \"Text '-500' could not be parsed: Invalid value for NanoOfSecond (valid values 0 - 999999999): -500000000\",\r\n            \"caused_by\": {\r\n              \"type\": \"date_time_exception\",\r\n              \"reason\": \"Invalid value for NanoOfSecond (valid values 0 - 999999999): -500000000\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nServer log stack trace:\r\n```\r\n info archService.java:582) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:385) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService.access$100(SearchService.java:123) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:357) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:353) [elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1068) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n   │      \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n   │      \tat java.lang.Thread.run(Thread.java:834) ~[?:?]\r\n   │      Caused by: java.time.DateTimeException: Invalid value for NanoOfSecond (valid values 0 - 999999999): -500000000\r\n   │      \tat java.time.temporal.ValueRange.checkValidValue(ValueRange.java:311) ~[?:?]\r\n   │      \tat java.time.temporal.ChronoField.checkValidValue(ChronoField.java:717) ~[?:?]\r\n   │      \tat java.time.format.Parsed.resolveTimeFields(Parsed.java:454) ~[?:?]\r\n   │      \tat java.time.format.Parsed.resolveFields(Parsed.java:321) ~[?:?]\r\n   │      \tat java.time.format.Parsed.resolve(Parsed.java:253) ~[?:?]\r\n   │      \tat java.time.format.DateTimeParseContext.toResolved(DateTimeParseContext.java:331) ~[?:?]\r\n   │      \tat java.time.format.DateTimeFormatter.parseResolved0(DateTimeFormatter.java:2052) ~[?:?]\r\n   │      \tat java.time.format.DateTimeFormatter.parse(DateTimeFormatter.java:1874) ~[?:?]\r\n   │      \tat org.elasticsearch.common.time.JavaDateMathParser.parseDateTime(JavaDateMathParser.java:221) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.time.JavaDateMathParser.parse(JavaDateMathParser.java:75) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.index.mapper.DateFieldMapper$DateFieldType.parseToLong(DateFieldMapper.java:397) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.index.mapper.DateFieldMapper$DateFieldType.isFieldWithinQuery(DateFieldMapper.java:411) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.index.query.RangeQueryBuilder.getRelation(RangeQueryBuilder.java:447) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.index.query.RangeQueryBuilder.doRewrite(RangeQueryBuilder.java:464) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.index.query.AbstractQueryBuilder.rewrite(AbstractQueryBuilder.java:265) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.builder.SearchSourceBuilder.rewrite(SearchSourceBuilder.java:962) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.builder.SearchSourceBuilder.rewrite(SearchSourceBuilder.java:82) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.index.query.Rewriteable.rewrite(Rewriteable.java:68) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.index.query.Rewriteable.rewrite(Rewriteable.java:51) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.internal.ShardSearchLocalRequest$RequestRewritable.rewrite(ShardSearchLocalRequest.java:291) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.internal.ShardSearchLocalRequest$RequestRewritable.rewrite(ShardSearchLocalRequest.java:281) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.index.query.Rewriteable.rewrite(Rewriteable.java:68) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService.createSearchContext(SearchService.java:659) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService.createSearchContext(SearchService.java:638) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService.createContext(SearchService.java:601) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:582) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:385) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService.access$100(SearchService.java:123) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:357) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:353) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1068) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n   │      \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n   │      \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n   │      \tat java.lang.Thread.run(Thread.java:834) ~[?:?]\r\n```\r\n\r\nIs this an intended breaking change? I don't find anything about this is the change docs but maybe I'm looking for the wrong keywords.","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}