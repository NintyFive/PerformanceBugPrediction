[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/534316385","html_url":"https://github.com/elastic/elasticsearch/issues/46988#issuecomment-534316385","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46988","id":534316385,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDMxNjM4NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-09-23T22:56:19Z","updated_at":"2019-09-23T22:56:19Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/534317736","html_url":"https://github.com/elastic/elasticsearch/issues/46988#issuecomment-534317736","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46988","id":534317736,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDMxNzczNg==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2019-09-23T23:01:49Z","updated_at":"2019-09-23T23:01:49Z","author_association":"MEMBER","body":"Thanks for opening this and describing the problem Gordon. My opinion is that this should be as easy as possible for a user to reason about, and for that reason, I am +1 on the failure handling and +1 for the \"simple\" solution to PARTIAL handling.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/534457492","html_url":"https://github.com/elastic/elasticsearch/issues/46988#issuecomment-534457492","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46988","id":534457492,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDQ1NzQ5Mg==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-09-24T08:42:47Z","updated_at":"2019-09-24T08:42:47Z","author_association":"MEMBER","body":"I wonder if we really want to handle `PARTIAL` snapshots differently from `SUCCESS`.\r\nThink about this:\r\n\r\n* You run a large cluster (lots of shards/nodes -> non-trivial chance of running into a `PARTIAL` snapshot) and take snapshots every N minutes\r\n* In most cases, your `PARTIAL` snapshots are mostly just missing a single shard/index and are otherwise fine\r\n\r\n-> wouldn't you want your retention rules to be the same for `SUCCESS` and `PARTIAL` here?\r\nIt seems to me that for large clusters where `PARTIAL` simply is a reality (e.g. a primary will fail-over during snapshot every so often and fail its snapshot action) that care about the actual point in time snapshots and not just about having the latest snapshot the two statuses are pretty much the same?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/534662747","html_url":"https://github.com/elastic/elasticsearch/issues/46988#issuecomment-534662747","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46988","id":534662747,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDY2Mjc0Nw==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2019-09-24T17:27:09Z","updated_at":"2019-09-24T17:27:09Z","author_association":"MEMBER","body":"I think in that scenario a user *always* wants to have a valid `SUCCESS` snapshot, since that's the only one guaranteed to contain all of their data. We never want to expunge an old `SUCCESS` snapshot even if they have 10 other `PARTIAL` snapshots that are newer.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/534695724","html_url":"https://github.com/elastic/elasticsearch/issues/46988#issuecomment-534695724","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46988","id":534695724,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNDY5NTcyNA==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-09-24T18:45:39Z","updated_at":"2019-09-24T18:46:58Z","author_association":"MEMBER","body":"@dakrone True it's a fair point that users want snapshots that guarantee all data. I think I worded the above badly :) What I tried to get across is, that there could be valid scenarios where `PARTIAL` snapshots are highly likely and dropping a partial snapshot instead of an old fully `SUCCESSFUL` one might be very painful. Maybe just add some some option to simply not count partial snapshots towards the retention count limit (and then just expunge them as you expire successful ones ... i.e. whenever you expunge a successful one you also expunge all `PARTIAL` ones older than it)?\r\n\r\nOne thing to note:\r\nIn the end, you probably don't care much about `PARTIAL` snapshots in use cases where you just keep appending data to your cluster overall because snapshots will have a ton of overlap and you won't save much data by deleting `PARTIAL` snapshots that lie between `SUCCESSFUL` ones. \r\nOn the other hand, in use cases where `PARTIAL` snapshots matter because data in the cluster is updated/rotated in some form you'll see storage costs accruing from those `PARTIAL` snapshots.\r\n\r\n=> we should probably deal with https://github.com/elastic/elasticsearch/issues/42540 to up the value of `PARTIAL` snapshots :)\r\n\r\nEither way, I now realise that technically users can use a long expire time to get around this anyway. Just figured I'd raise the question of whether we want to help ease the pain of frequent `PARTIAL` snapshots somehow :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/535945866","html_url":"https://github.com/elastic/elasticsearch/issues/46988#issuecomment-535945866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46988","id":535945866,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTk0NTg2Ng==","user":{"login":"nachogiljaldo","id":998352,"node_id":"MDQ6VXNlcjk5ODM1Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/998352?v=4","gravatar_id":"","url":"https://api.github.com/users/nachogiljaldo","html_url":"https://github.com/nachogiljaldo","followers_url":"https://api.github.com/users/nachogiljaldo/followers","following_url":"https://api.github.com/users/nachogiljaldo/following{/other_user}","gists_url":"https://api.github.com/users/nachogiljaldo/gists{/gist_id}","starred_url":"https://api.github.com/users/nachogiljaldo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nachogiljaldo/subscriptions","organizations_url":"https://api.github.com/users/nachogiljaldo/orgs","repos_url":"https://api.github.com/users/nachogiljaldo/repos","events_url":"https://api.github.com/users/nachogiljaldo/events{/privacy}","received_events_url":"https://api.github.com/users/nachogiljaldo/received_events","type":"User","site_admin":false},"created_at":"2019-09-27T13:45:06Z","updated_at":"2019-09-27T13:45:06Z","author_association":"NONE","body":"Something that might be useful (an we do in ESS) is preserving the latest snapshot disregard its state. For example, if the latest is FAILED you don't want to delete it since you want to see that it failed and why it failed. So this might be another actor to consider.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/541216574","html_url":"https://github.com/elastic/elasticsearch/issues/46988#issuecomment-541216574","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46988","id":541216574,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTIxNjU3NA==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2019-10-11T20:40:57Z","updated_at":"2019-10-11T20:40:57Z","author_association":"CONTRIBUTOR","body":"We've implemented the `FAILED` handling in https://github.com/elastic/elasticsearch/pull/47617 and, hearing no objections, the simple version of `PARTIAL` handling in https://github.com/elastic/elasticsearch/pull/47833, so I'm going to close this issue.\r\n\r\nTo clarify matters related to the comments above, the most recent snapshot overall is kept, as well as the most recent `SUCCESS`ful snapshot - but if `expire_after` is not set, `PARTIAL` or `FAILED` snapshots will be deleted as soon as there is a more recent success.","performed_via_github_app":null}]