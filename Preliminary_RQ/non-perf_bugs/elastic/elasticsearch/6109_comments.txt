[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42819854","html_url":"https://github.com/elastic/elasticsearch/issues/6109#issuecomment-42819854","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6109","id":42819854,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODE5ODU0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2014-05-12T11:10:44Z","updated_at":"2014-05-12T11:10:44Z","author_association":"MEMBER","body":"I think the best way to achieve this is via executing subsequent requests after the main request with an aggregation definition. For each bucket you need the top documents for, you'll need to execute a search request for it (using the bucket as a filter). You can bundle the search requests in a multi search request in order to optimize this a bit.\n\nThere is a new `top_hits` aggregation (#6124) on its way, that can group the top hits under each bucket being returned.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42823417","html_url":"https://github.com/elastic/elasticsearch/issues/6109#issuecomment-42823417","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6109","id":42823417,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODIzNDE3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-05-12T12:00:43Z","updated_at":"2014-05-12T12:00:43Z","author_association":"CONTRIBUTOR","body":"Closed in favour of #6124 \n","performed_via_github_app":null}]