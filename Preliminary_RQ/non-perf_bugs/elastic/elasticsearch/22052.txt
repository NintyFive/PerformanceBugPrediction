{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22052","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22052/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22052/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22052/events","html_url":"https://github.com/elastic/elasticsearch/issues/22052","id":194388937,"node_id":"MDU6SXNzdWUxOTQzODg5Mzc=","number":22052,"title":"Simple term query gives strange scores","user":{"login":"Gnucki","id":1064697,"node_id":"MDQ6VXNlcjEwNjQ2OTc=","avatar_url":"https://avatars1.githubusercontent.com/u/1064697?v=4","gravatar_id":"","url":"https://api.github.com/users/Gnucki","html_url":"https://github.com/Gnucki","followers_url":"https://api.github.com/users/Gnucki/followers","following_url":"https://api.github.com/users/Gnucki/following{/other_user}","gists_url":"https://api.github.com/users/Gnucki/gists{/gist_id}","starred_url":"https://api.github.com/users/Gnucki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Gnucki/subscriptions","organizations_url":"https://api.github.com/users/Gnucki/orgs","repos_url":"https://api.github.com/users/Gnucki/repos","events_url":"https://api.github.com/users/Gnucki/events{/privacy}","received_events_url":"https://api.github.com/users/Gnucki/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-12-08T16:57:53Z","updated_at":"2016-12-09T10:34:54Z","closed_at":"2016-12-08T18:54:24Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.0.2\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: openjdk-8\r\n\r\n**OS version**: ubuntu 14.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI populate my index with a bulk request:\r\n```js\r\n{_id: 1, tags: ['plop', 'plip', 'plup']},\r\n{_id: 2, tags: ['plop', 'plup']},\r\n{_id: 3, tags: ['plop']},\r\n{_id: 4, tags: ['plap', 'plep']},\r\n{_id: 5, tags: ['plop', 'plip', 'plup']},\r\n{_id: 6, tags: ['plup', 'plip']},\r\n{_id: 7, tags: ['plop', 'plip']}\r\n```\r\n\r\nThen, I would like to retrieve the max relevant rows for tags `plop` and `plip`:\r\n```js    \r\nquery: {\r\n  bool: {\r\n    should: [\r\n      {term: {tags: {value:'plop', _name: 'plop'}}},\r\n      {term: {tags: {value:'plip', _name: 'plip'}}}\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nThen, I find really strange scores:\r\n```js\r\n[\r\n  { id: '2', score: 0.88002616, tags: [ 'plop', 'plup' ] },\r\n   { id: '6', score: 0.88002616, tags: [ 'plup', 'plip' ] },\r\n   { id: '5', score: 0.5063205, tags: [ 'plop', 'plip', 'plup' ] },\r\n   { id: '7', score: 0.3610978, tags: [ 'plop', 'plip' ] },\r\n   { id: '1', score: 0.29277915, tags: [ 'plop', 'plip', 'plup' ] },\r\n   { id: '3', score: 0.2876821, tags: [ 'plop' ] }\r\n]\r\n```\r\n\r\nHere is the detail of the response:\r\n```json\r\n{\r\n  \"took\": 1,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 6,\r\n    \"max_score\": 0.88002616,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"myindex\",\r\n        \"_type\": \"mytype\",\r\n        \"_id\": \"2\",\r\n        \"_score\": 0.88002616,\r\n        \"_source\": {\r\n          \"tags\": [\r\n            \"plop\",\r\n            \"plup\"\r\n          ]\r\n        },\r\n        \"matched_queries\": [\r\n          \"plop\"\r\n        ]\r\n      },\r\n      {\r\n        \"_index\": \"myindex\",\r\n        \"_type\": \"mytype\",\r\n        \"_id\": \"6\",\r\n        \"_score\": 0.88002616,\r\n        \"_source\": {\r\n          \"tags\": [\r\n            \"plup\",\r\n            \"plip\"\r\n          ]\r\n        },\r\n        \"matched_queries\": [\r\n          \"plip\"\r\n        ]\r\n      },\r\n      {\r\n        \"_index\": \"myindex\",\r\n        \"_type\": \"mytype\",\r\n        \"_id\": \"5\",\r\n        \"_score\": 0.5063205,\r\n        \"_source\": {\r\n          \"tags\": [\r\n            \"plop\",\r\n            \"plip\",\r\n            \"plup\"\r\n          ]\r\n        },\r\n        \"matched_queries\": [\r\n          \"plop\",\r\n          \"plip\"\r\n        ]\r\n      },\r\n      {\r\n        \"_index\": \"myindex\",\r\n        \"_type\": \"mytype\",\r\n        \"_id\": \"7\",\r\n        \"_score\": 0.3610978,\r\n        \"_source\": {\r\n          \"tags\": [\r\n            \"plop\",\r\n            \"plip\"\r\n          ]\r\n        },\r\n        \"matched_queries\": [\r\n          \"plop\",\r\n          \"plip\"\r\n        ]\r\n      },\r\n      {\r\n        \"_index\": \"myindex\",\r\n        \"_type\": \"mytype\",\r\n        \"_id\": \"1\",\r\n        \"_score\": 0.29277915,\r\n        \"_source\": {\r\n          \"tags\": [\r\n            \"plop\",\r\n            \"plip\",\r\n            \"plup\"\r\n          ]\r\n        },\r\n        \"matched_queries\": [\r\n          \"plop\",\r\n          \"plip\"\r\n        ]\r\n      },\r\n      {\r\n        \"_index\": \"myindex\",\r\n        \"_type\": \"mytype\",\r\n        \"_id\": \"3\",\r\n        \"_score\": 0.2876821,\r\n        \"_source\": {\r\n          \"tags\": [\r\n            \"plop\"\r\n          ]\r\n        },\r\n        \"matched_queries\": [\r\n          \"plop\"\r\n        ]\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nSo, two questions:\r\n\r\n1. Why a row maching only one query (id 2 and 6) have a better score than one matching two (id 1, 5 and 7)?\r\n2. Why two rows having the same tags can have different scores? (id 1 and 5)\r\n\r\nIs it a bug or did I miss something?\r\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}