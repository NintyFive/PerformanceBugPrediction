[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57007820","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57007820","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57007820,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MDA3ODIw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-09-26T19:17:11Z","updated_at":"2014-09-26T19:17:11Z","author_association":"CONTRIBUTOR","body":"@mikemccand any ideas about this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57194915","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57194915","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57194915,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTk0OTE1","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-09-29T17:15:09Z","updated_at":"2014-09-29T17:15:09Z","author_association":"CONTRIBUTOR","body":"Sorry @clintongormley I don't have any insights here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57202950","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57202950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57202950,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjAyOTUw","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-09-29T18:08:15Z","updated_at":"2014-09-29T18:08:15Z","author_association":"MEMBER","body":"I looked at it, and I suggest we wait and see how things progress on guava front to address it. I agree with the note that contention on a single AtomicLong can be tricky, though might not be that tricky for non write heavy cases. The global eviction queue suggested there is interesting....\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57203480","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57203480","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57203480,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjAzNDgw","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-09-29T18:12:04Z","updated_at":"2014-09-29T18:21:09Z","author_association":"MEMBER","body":"as a side note, we could try and use murmur hash (HPPC has a nice 32bit one) on the hashCode in `IndicesFieldDataCache#Key` class to try and have better hash distribution? @jpountz / @s1monw  what do you think? (if we do so, might make sense to do it on other guava cache entries)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57205557","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57205557","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57205557,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjA1NTU3","user":{"login":"plaflamme","id":484152,"node_id":"MDQ6VXNlcjQ4NDE1Mg==","avatar_url":"https://avatars0.githubusercontent.com/u/484152?v=4","gravatar_id":"","url":"https://api.github.com/users/plaflamme","html_url":"https://github.com/plaflamme","followers_url":"https://api.github.com/users/plaflamme/followers","following_url":"https://api.github.com/users/plaflamme/following{/other_user}","gists_url":"https://api.github.com/users/plaflamme/gists{/gist_id}","starred_url":"https://api.github.com/users/plaflamme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/plaflamme/subscriptions","organizations_url":"https://api.github.com/users/plaflamme/orgs","repos_url":"https://api.github.com/users/plaflamme/repos","events_url":"https://api.github.com/users/plaflamme/events{/privacy}","received_events_url":"https://api.github.com/users/plaflamme/received_events","type":"User","site_admin":false},"created_at":"2014-09-29T18:25:32Z","updated_at":"2014-09-29T18:25:32Z","author_association":"NONE","body":"Would it be possible to allow configuring the number of partitions ES uses? Reducing the number of partitions would be safer than increasing the maximum size of the cache to patch this until guava has an actual solution.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57205799","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57205799","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57205799,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjA1Nzk5","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-09-29T18:27:12Z","updated_at":"2014-09-29T18:27:12Z","author_association":"MEMBER","body":"@plaflamme yea, we can add it as an option to configure, though I don't like that its such an expert setting\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57264194","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57264194","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57264194,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjY0MTk0","user":{"login":"craigwi","id":6687101,"node_id":"MDQ6VXNlcjY2ODcxMDE=","avatar_url":"https://avatars2.githubusercontent.com/u/6687101?v=4","gravatar_id":"","url":"https://api.github.com/users/craigwi","html_url":"https://github.com/craigwi","followers_url":"https://api.github.com/users/craigwi/followers","following_url":"https://api.github.com/users/craigwi/following{/other_user}","gists_url":"https://api.github.com/users/craigwi/gists{/gist_id}","starred_url":"https://api.github.com/users/craigwi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigwi/subscriptions","organizations_url":"https://api.github.com/users/craigwi/orgs","repos_url":"https://api.github.com/users/craigwi/repos","events_url":"https://api.github.com/users/craigwi/events{/privacy}","received_events_url":"https://api.github.com/users/craigwi/received_events","type":"User","site_admin":false},"created_at":"2014-09-30T03:55:01Z","updated_at":"2014-09-30T04:01:04Z","author_association":"CONTRIBUTOR","body":"The issue arises because of the combination of the hash function distribution AND the distribution of the sizes of the elements -- I'm not sure this is solvable with just a new hash function (which might be valuable for other reasons ...).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57345822","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57345822","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57345822,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzQ1ODIy","user":{"login":"craigwi","id":6687101,"node_id":"MDQ6VXNlcjY2ODcxMDE=","avatar_url":"https://avatars2.githubusercontent.com/u/6687101?v=4","gravatar_id":"","url":"https://api.github.com/users/craigwi","html_url":"https://github.com/craigwi","followers_url":"https://api.github.com/users/craigwi/followers","following_url":"https://api.github.com/users/craigwi/following{/other_user}","gists_url":"https://api.github.com/users/craigwi/gists{/gist_id}","starred_url":"https://api.github.com/users/craigwi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigwi/subscriptions","organizations_url":"https://api.github.com/users/craigwi/orgs","repos_url":"https://api.github.com/users/craigwi/repos","events_url":"https://api.github.com/users/craigwi/events{/privacy}","received_events_url":"https://api.github.com/users/craigwi/received_events","type":"User","site_admin":false},"created_at":"2014-09-30T16:56:48Z","updated_at":"2014-09-30T16:56:48Z","author_association":"CONTRIBUTOR","body":"I thought of another potential mitigation in case guava doesn't take some kind of change like I'm proposing.  If the variation in the size of elements was reduced, the cache memory utilization should go up.  In the case I debugged, the item causing the problem was loaded in ValuesSource.load via the call to indexFieldData.load.  The items loaded in my case were in the 100mb range and the cache segments were only 134mb.  Due to the hash keys, two of these large items would wind up in one cache segment and given the sizes, only one could remain.\n\nIf there were some way to break up that structure into smaller pieces (and of course not slow other things down...), that should increase the cache memory utilization.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57346593","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-57346593","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":57346593,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MzQ2NTkz","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2014-09-30T17:01:59Z","updated_at":"2014-09-30T17:01:59Z","author_association":"CONTRIBUTOR","body":"> The items loaded in my case were in the 100mb range and the cache segments were only 134mb.\n\nI'm not close to the situation but does it make sense to cache things that take up so much of the cache?\n\nIt feels silly, but maybe a single segment cache for things over some size and the multi segment cache for smaller things?  It just feels like things so large can't have much contention on them because there just isn't enough heap.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59081950","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59081950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59081950,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MDgxOTUw","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-10-14T17:16:49Z","updated_at":"2014-10-14T17:16:49Z","author_association":"CONTRIBUTOR","body":"@kimchy Guava already applies a secondary hash to spread the `hashCode()` bits in [LocalCache.rehash](http://grepcode.com/file/repo1.maven.org/maven2/com.google.guava/guava/17.0/com/google/common/cache/LocalCache.java#LocalCache.rehash%28int%29) so I don't think we need to do anything more on our side.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59335511","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59335511","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59335511,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MzM1NTEx","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T09:23:21Z","updated_at":"2014-10-16T09:23:21Z","author_association":"CONTRIBUTOR","body":"@craigwi we can expose the concurrency level as a setting if that would help until we have a better cache impl that doesn't suffer from this problem?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59365084","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59365084","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59365084,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MzY1MDg0","user":{"login":"plaflamme","id":484152,"node_id":"MDQ6VXNlcjQ4NDE1Mg==","avatar_url":"https://avatars0.githubusercontent.com/u/484152?v=4","gravatar_id":"","url":"https://api.github.com/users/plaflamme","html_url":"https://github.com/plaflamme","followers_url":"https://api.github.com/users/plaflamme/followers","following_url":"https://api.github.com/users/plaflamme/following{/other_user}","gists_url":"https://api.github.com/users/plaflamme/gists{/gist_id}","starred_url":"https://api.github.com/users/plaflamme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/plaflamme/subscriptions","organizations_url":"https://api.github.com/users/plaflamme/orgs","repos_url":"https://api.github.com/users/plaflamme/repos","events_url":"https://api.github.com/users/plaflamme/events{/privacy}","received_events_url":"https://api.github.com/users/plaflamme/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T13:59:40Z","updated_at":"2014-10-16T13:59:40Z","author_association":"NONE","body":"@s1monw That would definitely help in the interim. Sadly, Guava doesn't expose write contention metrics, they would have been useful to measure the impact of changing this setting.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59372191","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59372191","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59372191,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MzcyMTkx","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T14:43:29Z","updated_at":"2014-10-16T14:43:29Z","author_association":"CONTRIBUTOR","body":"I opened a PR to add this setting to all caches we have \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59409353","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59409353","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59409353,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDA5MzUz","user":{"login":"craigwi","id":6687101,"node_id":"MDQ6VXNlcjY2ODcxMDE=","avatar_url":"https://avatars2.githubusercontent.com/u/6687101?v=4","gravatar_id":"","url":"https://api.github.com/users/craigwi","html_url":"https://github.com/craigwi","followers_url":"https://api.github.com/users/craigwi/followers","following_url":"https://api.github.com/users/craigwi/following{/other_user}","gists_url":"https://api.github.com/users/craigwi/gists{/gist_id}","starred_url":"https://api.github.com/users/craigwi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigwi/subscriptions","organizations_url":"https://api.github.com/users/craigwi/orgs","repos_url":"https://api.github.com/users/craigwi/repos","events_url":"https://api.github.com/users/craigwi/events{/privacy}","received_events_url":"https://api.github.com/users/craigwi/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T18:41:02Z","updated_at":"2014-10-16T18:41:02Z","author_association":"CONTRIBUTOR","body":"@plaflamme, I agree that the write contention on the field data cache be measured to determine any impact from reducing the concurrency level.\n\n@s1monw, regarding exposing a setting to control this, I do NOT recommend this.  I sent a note to @kimchy through ZenDesk to this effect.  I have suggested to Shay that, after verifying the actual write contention, you set the concurrency level to 1 automatically on the field data cache (either always or only when size-based eviction is used).\n\nRelated, I'd like to understand why the default in ES for field data cache is NO eviction policy.  It would seem that if sized-based eviction worked correctly, this would be a better default.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59413993","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59413993","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59413993,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDEzOTkz","user":{"login":"plaflamme","id":484152,"node_id":"MDQ6VXNlcjQ4NDE1Mg==","avatar_url":"https://avatars0.githubusercontent.com/u/484152?v=4","gravatar_id":"","url":"https://api.github.com/users/plaflamme","html_url":"https://github.com/plaflamme","followers_url":"https://api.github.com/users/plaflamme/followers","following_url":"https://api.github.com/users/plaflamme/following{/other_user}","gists_url":"https://api.github.com/users/plaflamme/gists{/gist_id}","starred_url":"https://api.github.com/users/plaflamme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/plaflamme/subscriptions","organizations_url":"https://api.github.com/users/plaflamme/orgs","repos_url":"https://api.github.com/users/plaflamme/repos","events_url":"https://api.github.com/users/plaflamme/events{/privacy}","received_events_url":"https://api.github.com/users/plaflamme/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T19:11:07Z","updated_at":"2014-10-16T19:11:07Z","author_association":"NONE","body":"I agree with the fact that there's no reason to change this value unless you're using sized-based eviction. In which case, you'll probably set this to 1 so that your cap setting is correctly used.\n\nAlso, I suspect that the gain of NOT eagerly evicting field data cache entries will outweigh any cost of additional write contention: doing disk IO will always be more expensive than doing more locking (unless the IO happens under the lock).\n\nSo setting this to 1 by default when size-based eviction is used would make sense.\n\nAlternatively, you could set it to 2 and overcommit each partition by a small factor. That would already cut write contention by half (assuming the keys are uniformly distributed).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59485172","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59485172","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59485172,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDg1MTcy","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T08:52:28Z","updated_at":"2014-10-17T08:52:28Z","author_association":"CONTRIBUTOR","body":"I think we have 2 distinct problems here or at least taht I try to solve. \n1. make it possible to work around potential issues of defaults by setting the concurrency level which can help fixing the problem until we have a good / better default\n2. finding a good default value or even default implementation for this cache\n\nthe latter will likely not make it into 1.4 GA so I think we should go with 1 as an undocumented option and fix it properly in upcoming releases and even think about an alternative cache impl that doesn't use segment based locking. To me the FieldData Cache is more or less single writer multiple reader or that is at least what we wanna optimize for. the cache we use us pretty much a default cache to be sufficient for write intensive application which we are not. We might be able to come up with something better than working around stuff here? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59680742","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59680742","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59680742,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NjgwNzQy","user":{"login":"craigwi","id":6687101,"node_id":"MDQ6VXNlcjY2ODcxMDE=","avatar_url":"https://avatars2.githubusercontent.com/u/6687101?v=4","gravatar_id":"","url":"https://api.github.com/users/craigwi","html_url":"https://github.com/craigwi","followers_url":"https://api.github.com/users/craigwi/followers","following_url":"https://api.github.com/users/craigwi/following{/other_user}","gists_url":"https://api.github.com/users/craigwi/gists{/gist_id}","starred_url":"https://api.github.com/users/craigwi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigwi/subscriptions","organizations_url":"https://api.github.com/users/craigwi/orgs","repos_url":"https://api.github.com/users/craigwi/repos","events_url":"https://api.github.com/users/craigwi/events{/privacy}","received_events_url":"https://api.github.com/users/craigwi/received_events","type":"User","site_admin":false},"created_at":"2014-10-20T03:47:36Z","updated_at":"2014-10-20T03:47:36Z","author_association":"CONTRIBUTOR","body":"Thanks @s1monw.  In the short term, I agree with the proposal to enable us to set the concurrency level.\n\nThe longer term question seems to be a choice of whether to go with a circuit breaker approach which necessitates taking proactive steps as soon as one notices the breaker tripped (since customers are likely impacted) OR to go with something else that exhibits a slow degradation in performance, that too has to be noticed, and would give one more time to react.  \n\nThe current defaults fit the first approach, of course, and a proper sized-based eviction fielddata cache would fit the later approach.  There must be other ideas...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59923609","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-59923609","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":59923609,"node_id":"MDEyOklzc3VlQ29tbWVudDU5OTIzNjA5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-21T13:04:08Z","updated_at":"2014-10-21T13:04:08Z","author_association":"CONTRIBUTOR","body":"> The longer term question seems to be a choice of whether to go with a circuit breaker approach which necessitates taking proactive steps as soon as one notices the breaker tripped (since customers are likely impacted) OR to go with something else that exhibits a slow degradation in performance, that too has to be noticed, and would give one more time to react.\n\nTo be honest size based evictions often result in cluster meltdown since if you hit the upper limit you keep on loaded and unloading field data which will cause large amount of memory to be allocated and freed etc. you run into GCs due to evictions which are async btw. \nIn order to react to situations where you are really close to the limits I think rejecting requests for health reasons is the way to go clients need to deal with this IMO the cluster health is way more important  at that point. \n\n> The current defaults fit the first approach, of course, and a proper sized-based eviction fielddata cache would fit the later approach. There must be other ideas..\n\nI think we need to fix this caveat here and maybe go with a default concurrency of `1` for field data if the `size` based eviction is used in the field data case. It think that is the right fix for now - to be honest I doubt there will be a big perf impact but we would need to verify - from looking at the code the read operations are most likely not under a lock such that contention is only likely to happen in the write case which I don't think will be very problematic here. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/60271024","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-60271024","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":60271024,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMjcxMDI0","user":{"login":"craigwi","id":6687101,"node_id":"MDQ6VXNlcjY2ODcxMDE=","avatar_url":"https://avatars2.githubusercontent.com/u/6687101?v=4","gravatar_id":"","url":"https://api.github.com/users/craigwi","html_url":"https://github.com/craigwi","followers_url":"https://api.github.com/users/craigwi/followers","following_url":"https://api.github.com/users/craigwi/following{/other_user}","gists_url":"https://api.github.com/users/craigwi/gists{/gist_id}","starred_url":"https://api.github.com/users/craigwi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigwi/subscriptions","organizations_url":"https://api.github.com/users/craigwi/orgs","repos_url":"https://api.github.com/users/craigwi/repos","events_url":"https://api.github.com/users/craigwi/events{/privacy}","received_events_url":"https://api.github.com/users/craigwi/received_events","type":"User","site_admin":false},"created_at":"2014-10-23T16:56:03Z","updated_at":"2014-10-23T16:56:03Z","author_association":"CONTRIBUTOR","body":"> To be honest size based evictions often result in cluster meltdown \n\nIf this is true, of course I would prefer orderly failures to meltdown.  We experienced all sorts of problems before we made OOM kill java.exe and before we switched to G1 GC.  Now we see the gradual slowdown when evictions start as I wrote.\n\nRegarding https://github.com/elasticsearch/elasticsearch/pull/8112, I would like to see at least the fielddata cache part of that in a 1.3.x release -- unless 1.4 is imminent.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/60365955","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-60365955","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":60365955,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMzY1OTU1","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-24T09:44:08Z","updated_at":"2014-10-24T09:44:08Z","author_association":"CONTRIBUTOR","body":"hey @craigwi I don't think this counts as a bugfix really and therefore I won't backport it to 1.3.x Given the fact that 1.4 is in beta and we moving towards GA soonish it is imminent\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/60389210","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-60389210","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":60389210,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMzg5MjEw","user":{"login":"craigwi","id":6687101,"node_id":"MDQ6VXNlcjY2ODcxMDE=","avatar_url":"https://avatars2.githubusercontent.com/u/6687101?v=4","gravatar_id":"","url":"https://api.github.com/users/craigwi","html_url":"https://github.com/craigwi","followers_url":"https://api.github.com/users/craigwi/followers","following_url":"https://api.github.com/users/craigwi/following{/other_user}","gists_url":"https://api.github.com/users/craigwi/gists{/gist_id}","starred_url":"https://api.github.com/users/craigwi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigwi/subscriptions","organizations_url":"https://api.github.com/users/craigwi/orgs","repos_url":"https://api.github.com/users/craigwi/repos","events_url":"https://api.github.com/users/craigwi/events{/privacy}","received_events_url":"https://api.github.com/users/craigwi/received_events","type":"User","site_admin":false},"created_at":"2014-10-24T13:51:20Z","updated_at":"2014-10-24T13:51:20Z","author_association":"CONTRIBUTOR","body":"Thanks @s1monw.  The fact that ES doesn't behave as documented would seem to me to be as a bug (cf. https://github.com/elasticsearch/elasticsearch/issues/7841), but I recognize back porting is not free or even cheap.  \n\nWill this show up in a 1.4 beta release?  Which one?  I really do want to verify the behavior of the new option ASAP.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64881861","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-64881861","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":64881861,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODgxODYx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-28T10:58:05Z","updated_at":"2014-11-28T10:58:05Z","author_association":"CONTRIBUTOR","body":"We need to investigate other cache options\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158672810","html_url":"https://github.com/elastic/elasticsearch/issues/7836#issuecomment-158672810","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7836","id":158672810,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODY3MjgxMA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-21T19:05:56Z","updated_at":"2015-11-21T19:05:56Z","author_association":"CONTRIBUTOR","body":"Guava has been removed. Closing\n","performed_via_github_app":null}]