{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52474","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52474/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52474/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52474/events","html_url":"https://github.com/elastic/elasticsearch/issues/52474","id":566896356,"node_id":"MDU6SXNzdWU1NjY4OTYzNTY=","number":52474,"title":"NPE when creating a set_security_user processor","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"labels":[{"id":912837951,"node_id":"MDU6TGFiZWw5MTI4Mzc5NTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authentication","name":":Security/Authentication","color":"0e8a16","default":false,"description":"Logging in, Usernames/passwords, Realms (Native/LDAP/AD/SAML/PKI/etc)"}],"state":"closed","locked":false,"assignee":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"assignees":[{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-02-18T13:34:13Z","updated_at":"2020-03-05T05:43:43Z","closed_at":"2020-03-05T05:43:43Z","author_association":"MEMBER","active_lock_reason":null,"body":"Elasticsearch version: 7.7.0-SNAPSHOT\r\nPossibly relates to: https://github.com/elastic/elasticsearch/pull/52032\r\n\r\nOur integration tests started failing when setting up the `set_security_user` ingest processor with the following NPE.\r\n\r\nWe use basic auth during these API calls.\r\n\r\n```json\r\nPUT: /_ingest/pipeline/pipeline-1?pretty=true&error_trace=true\r\n\r\n{\r\n\t\"description\": \"My test pipeline\",\r\n\t\"processors\": [ {\r\n\t\t\"set_security_user\": {\r\n\t\t\t\"field\": \"name\"\r\n\t\t}\r\n\t}]\r\n}\r\n```\r\n\r\n\r\n```json\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"exception\",\r\n        \"reason\" : \"java.lang.NullPointerException: security context must be provided\",\r\n        \"processor_type\" : \"set_security_user\",\r\n        \"stack_trace\" : \"ElasticsearchException[java.lang.NullPointerException: security context must be provided]; nested: NullPointerException[security context must be provided];\\n\\tat org.elasticsearch.ExceptionsHelper.convertToElastic(ExceptionsHelper.java:66)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.newConfigurationException(ConfigurationUtils.java:322)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:441)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:398)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessorConfigs(ConfigurationUtils.java:336)\\n\\tat org.elasticsearch.ingest.Pipeline.create(Pipeline.java:74)\\n\\tat org.elasticsearch.ingest.IngestService.validatePipeline(IngestService.java:320)\\n\\tat org.elasticsearch.ingest.IngestService.putPipeline(IngestService.java:226)\\n\\tat org.elasticsearch.action.ingest.PutPipelineTransportAction.lambda$masterOperation$0(PutPipelineTransportAction.java:83)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:70)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.finishHim(TransportNodesAction.java:236)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onOperation(TransportNodesAction.java:213)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$000(TransportNodesAction.java:142)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleResponse(TransportNodesAction.java:191)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleResponse(TransportNodesAction.java:183)\\n\\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1116)\\n\\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.processResponse(TransportService.java:1194)\\n\\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1174)\\n\\tat org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:54)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:244)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:240)\\n\\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63)\\n\\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:754)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.base/java.lang.Thread.run(Thread.java:830)\\nCaused by: java.lang.NullPointerException: security context must be provided\\n\\tat java.base/java.util.Objects.requireNonNull(Objects.java:247)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor.<init>(SetSecurityUserProcessor.java:44)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor$Factory.create(SetSecurityUserProcessor.java:183)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor$Factory.create(SetSecurityUserProcessor.java:161)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:428)\\n\\t... 27 more\\n\"\r\n      }\r\n    ],\r\n    \"type\" : \"exception\",\r\n    \"reason\" : \"java.lang.NullPointerException: security context must be provided\",\r\n    \"processor_type\" : \"set_security_user\",\r\n    \"caused_by\" : {\r\n      \"type\" : \"null_pointer_exception\",\r\n      \"reason\" : \"security context must be provided\",\r\n      \"stack_trace\" : \"java.lang.NullPointerException: security context must be provided\\n\\tat java.base/java.util.Objects.requireNonNull(Objects.java:247)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor.<init>(SetSecurityUserProcessor.java:44)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor$Factory.create(SetSecurityUserProcessor.java:183)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor$Factory.create(SetSecurityUserProcessor.java:161)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:428)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:398)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessorConfigs(ConfigurationUtils.java:336)\\n\\tat org.elasticsearch.ingest.Pipeline.create(Pipeline.java:74)\\n\\tat org.elasticsearch.ingest.IngestService.validatePipeline(IngestService.java:320)\\n\\tat org.elasticsearch.ingest.IngestService.putPipeline(IngestService.java:226)\\n\\tat org.elasticsearch.action.ingest.PutPipelineTransportAction.lambda$masterOperation$0(PutPipelineTransportAction.java:83)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:70)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.finishHim(TransportNodesAction.java:236)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onOperation(TransportNodesAction.java:213)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$000(TransportNodesAction.java:142)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleResponse(TransportNodesAction.java:191)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleResponse(TransportNodesAction.java:183)\\n\\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1116)\\n\\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.processResponse(TransportService.java:1194)\\n\\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1174)\\n\\tat org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:54)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:244)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:240)\\n\\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63)\\n\\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:754)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.base/java.lang.Thread.run(Thread.java:830)\\n\"\r\n    },\r\n    \"stack_trace\" : \"ElasticsearchException[java.lang.NullPointerException: security context must be provided]; nested: NullPointerException[security context must be provided];\\n\\tat org.elasticsearch.ExceptionsHelper.convertToElastic(ExceptionsHelper.java:66)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.newConfigurationException(ConfigurationUtils.java:322)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:441)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:398)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessorConfigs(ConfigurationUtils.java:336)\\n\\tat org.elasticsearch.ingest.Pipeline.create(Pipeline.java:74)\\n\\tat org.elasticsearch.ingest.IngestService.validatePipeline(IngestService.java:320)\\n\\tat org.elasticsearch.ingest.IngestService.putPipeline(IngestService.java:226)\\n\\tat org.elasticsearch.action.ingest.PutPipelineTransportAction.lambda$masterOperation$0(PutPipelineTransportAction.java:83)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:63)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:70)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.finishHim(TransportNodesAction.java:236)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.onOperation(TransportNodesAction.java:213)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.access$000(TransportNodesAction.java:142)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleResponse(TransportNodesAction.java:191)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleResponse(TransportNodesAction.java:183)\\n\\tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1116)\\n\\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.processResponse(TransportService.java:1194)\\n\\tat org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1174)\\n\\tat org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:54)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:244)\\n\\tat org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:240)\\n\\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63)\\n\\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:754)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:692)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.base/java.lang.Thread.run(Thread.java:830)\\nCaused by: java.lang.NullPointerException: security context must be provided\\n\\tat java.base/java.util.Objects.requireNonNull(Objects.java:247)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor.<init>(SetSecurityUserProcessor.java:44)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor$Factory.create(SetSecurityUserProcessor.java:183)\\n\\tat org.elasticsearch.xpack.security.ingest.SetSecurityUserProcessor$Factory.create(SetSecurityUserProcessor.java:161)\\n\\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:428)\\n\\t... 27 more\\n\"\r\n  },\r\n  \"status\" : 500\r\n}\r\n```\r\n","closed_by":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"performed_via_github_app":null}