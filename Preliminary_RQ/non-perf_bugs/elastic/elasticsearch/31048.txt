{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31048","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31048/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31048/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31048/events","html_url":"https://github.com/elastic/elasticsearch/issues/31048","id":328819466,"node_id":"MDU6SXNzdWUzMjg4MTk0NjY=","number":31048,"title":"geo_shape matches shapes outside polygon","user":{"login":"ptpt","id":87357,"node_id":"MDQ6VXNlcjg3MzU3","avatar_url":"https://avatars1.githubusercontent.com/u/87357?v=4","gravatar_id":"","url":"https://api.github.com/users/ptpt","html_url":"https://github.com/ptpt","followers_url":"https://api.github.com/users/ptpt/followers","following_url":"https://api.github.com/users/ptpt/following{/other_user}","gists_url":"https://api.github.com/users/ptpt/gists{/gist_id}","starred_url":"https://api.github.com/users/ptpt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptpt/subscriptions","organizations_url":"https://api.github.com/users/ptpt/orgs","repos_url":"https://api.github.com/users/ptpt/repos","events_url":"https://api.github.com/users/ptpt/events{/privacy}","received_events_url":"https://api.github.com/users/ptpt/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-06-03T11:07:57Z","updated_at":"2018-12-13T15:58:43Z","closed_at":"2018-12-13T15:58:43Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch Version** (`bin/elasticsearch --version`): 6.2.4\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): run in docker\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): run in docker\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. `docker run -p 9200:9200 -p 9300:9300 -e \"discovery.type=single-node\" docker.elastic.co/elasticsearch/elasticsearch:6.2.4`\r\n 2. create the mapping\r\n```\r\ncurl localhost:9200/tweets -d '\r\n{\r\n    \"mappings\": {\r\n        \"_doc\": {\r\n            \"properties\": {\r\n                \"location\": {\r\n                    \"type\": \"geo_shape\"\r\n                }\r\n            }\r\n        }\r\n    }\r\n}' -XPUT -H 'Content-Type:application/json'\r\n```\r\n 3. create the doc located in Sweden\r\n```\r\ncurl \"localhost:9200/tweets/_doc?refresh\" -d '\r\n{\r\n    \"name\": \"Wind & Wetter, Berlin, Germany\",\r\n    \"location\": {\r\n        \"type\": \"point\",\r\n        \"coordinates\": [15.120892, 63.431233]\r\n    }\r\n}' -H 'Content-Type:application/json'\r\n```\r\n\r\n4. query docs within Norway, the doc located in Sweden appears in the hits\r\n```\r\ncurl \"localhost:9200/tweets/_search\" -d@query.json -H 'content-type: application/json'\r\n```\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n[query.json.zip](https://github.com/elastic/elasticsearch/files/2065890/query.json.zip)\r\n\r\nShape of Norway: https://gist.github.com/ptpt/73d0ffe353226283ccd1c7768b932445","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}