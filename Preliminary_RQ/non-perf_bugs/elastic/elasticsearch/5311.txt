{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5311","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5311/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5311/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5311/events","html_url":"https://github.com/elastic/elasticsearch/issues/5311","id":28568444,"node_id":"MDU6SXNzdWUyODU2ODQ0NA==","number":5311,"title":"Marvel throws ConnectionException on stopping elasticsearch","user":{"login":"paweloque","id":1042717,"node_id":"MDQ6VXNlcjEwNDI3MTc=","avatar_url":"https://avatars1.githubusercontent.com/u/1042717?v=4","gravatar_id":"","url":"https://api.github.com/users/paweloque","html_url":"https://github.com/paweloque","followers_url":"https://api.github.com/users/paweloque/followers","following_url":"https://api.github.com/users/paweloque/following{/other_user}","gists_url":"https://api.github.com/users/paweloque/gists{/gist_id}","starred_url":"https://api.github.com/users/paweloque/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paweloque/subscriptions","organizations_url":"https://api.github.com/users/paweloque/orgs","repos_url":"https://api.github.com/users/paweloque/repos","events_url":"https://api.github.com/users/paweloque/events{/privacy}","received_events_url":"https://api.github.com/users/paweloque/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-03-01T23:20:56Z","updated_at":"2014-03-03T15:31:15Z","closed_at":"2014-03-03T15:31:15Z","author_association":"NONE","active_lock_reason":null,"body":"Marvel throws a ConnectionException when closing elasticsearch. It keeps sending data to elasticsearch event though elasticsearch is about to terminate. In this case I'm running elasticsearch in foreground mode and closing it with Ctrl-C in bash.\n\nProbably elasticsearch should inform its plugins about the termination, so that the plugins can finish operating. \n\nContext: elasticsearch 1.0.1\n              marvel 1.0.2\n\nStacktrace:\n^C[2014-03-02 00:15:26,288][INFO ][node                     ] [Puck] stopping ...\n[2014-03-02 00:15:26,317][ERROR][marvel.agent.exporter    ] error sending data\njava.net.ConnectException: Connection refused\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:579)\n    at sun.net.NetworkClient.doConnect(NetworkClient.java:175)\n    at sun.net.www.http.HttpClient.openServer(HttpClient.java:432)\n    at sun.net.www.http.HttpClient.openServer(HttpClient.java:527)\n    at sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:763)\n    at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:633)\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1323)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.sendCloseExportingConnection(ESExporter.java:232)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.exportXContent(ESExporter.java:252)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.exportEvents(ESExporter.java:166)\n    at org.elasticsearch.marvel.agent.AgentService$ExportingWorker.exportEvents(AgentService.java:230)\n    at org.elasticsearch.marvel.agent.AgentService$ExportingWorker.run(AgentService.java:192)\n    at java.lang.Thread.run(Thread.java:744)\n[2014-03-02 00:15:26,319][INFO ][node                     ] [Puck] stopped\n[2014-03-02 00:15:26,319][INFO ][node                     ] [Puck] closing ...\n[2014-03-02 00:15:26,325][INFO ][node                     ] [Puck] closed\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}