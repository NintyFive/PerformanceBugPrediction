{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/54759","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54759/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54759/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54759/events","html_url":"https://github.com/elastic/elasticsearch/issues/54759","id":593674415,"node_id":"MDU6SXNzdWU1OTM2NzQ0MTU=","number":54759,"title":"[CI] Failure in {p0=ml/data_frame_analytics_crud/Test put regression given negative lambda}","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-04-03T22:31:35Z","updated_at":"2020-04-05T17:04:10Z","closed_at":"2020-04-05T17:04:10Z","author_association":"MEMBER","active_lock_reason":null,"body":"Looks like the cleanup from clearing ILM policies:\r\n\r\n```\r\njava.lang.RuntimeException: failed to delete policy: ml-size-based-ilm-policy\r\n\tat __randomizedtesting.SeedInfo.seed([5903DB6DE4744D8C:D157E4B74A882074]:0)\r\n\tat org.elasticsearch.test.rest.ESRestTestCase.lambda$deleteAllILMPolicies$7(ESRestTestCase.java:759)\r\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\r\n\tat java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:177)\r\n\tat java.base/java.util.HashMap$KeySpliterator.forEachRemaining(HashMap.java:1603)\r\n\tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)\r\n\tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)\r\n\tat java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\r\n\tat java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\r\n\tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n\tat java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497)\r\n\tat org.elasticsearch.test.rest.ESRestTestCase.deleteAllILMPolicies(ESRestTestCase.java:755)\r\n\tat org.elasticsearch.test.rest.ESRestTestCase.wipeCluster(ESRestTestCase.java:576)\r\n\tat org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:295)\r\n...\r\nCaused by: org.elasticsearch.client.ResponseException: method [DELETE], host [http://127.0.0.1:34560], URI [/_ilm/policy/ml-size-based-ilm-policy], status line [HTTP/1.1 400 Bad Request]\r\n{\"error\":{\"root_cause\":[{\"type\":\"illegal_argument_exception\",\"reason\":\"Cannot delete policy [ml-size-based-ilm-policy]. It is in use by one or more indices: [.ml-stats-write]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"Cannot delete policy [ml-size-based-ilm-policy]. It is in use by one or more indices: [.ml-stats-write]\"},\"status\":400}\r\n\tat org.elasticsearch.client.RestClient.convertResponse(RestClient.java:283)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:261)\r\n\tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:235)\r\n\tat org.elasticsearch.test.rest.ESRestTestCase.lambda$deleteAllILMPolicies$7(ESRestTestCase.java:757)\r\n\t... 45 more\r\n```\r\n\r\nFailure is at: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+pull-request-2/20842/testReport/junit/org.elasticsearch.xpack.test.rest/XPackRestIT/test__p0_ml_data_frame_analytics_crud_Test_put_regression_given_negative_lambda_/\r\n\r\nI believe the ML-installed ILM policy needs to be added to this list:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/4eaf2cb9677dbc18cad7fd014d3d1edbbe70f8af/test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java#L463-L465\r\n\r\nSo that it doesn't need to be cleared between tests","closed_by":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}