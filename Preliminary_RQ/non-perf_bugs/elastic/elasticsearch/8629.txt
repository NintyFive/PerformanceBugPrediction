{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8629","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8629/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8629/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8629/events","html_url":"https://github.com/elastic/elasticsearch/issues/8629","id":49878326,"node_id":"MDU6SXNzdWU0OTg3ODMyNg==","number":8629,"title":"NullPointerException with empty string filter & Java Driver","user":{"login":"fabienrousseau","id":5645659,"node_id":"MDQ6VXNlcjU2NDU2NTk=","avatar_url":"https://avatars2.githubusercontent.com/u/5645659?v=4","gravatar_id":"","url":"https://api.github.com/users/fabienrousseau","html_url":"https://github.com/fabienrousseau","followers_url":"https://api.github.com/users/fabienrousseau/followers","following_url":"https://api.github.com/users/fabienrousseau/following{/other_user}","gists_url":"https://api.github.com/users/fabienrousseau/gists{/gist_id}","starred_url":"https://api.github.com/users/fabienrousseau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fabienrousseau/subscriptions","organizations_url":"https://api.github.com/users/fabienrousseau/orgs","repos_url":"https://api.github.com/users/fabienrousseau/repos","events_url":"https://api.github.com/users/fabienrousseau/events{/privacy}","received_events_url":"https://api.github.com/users/fabienrousseau/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"masaruh","id":572174,"node_id":"MDQ6VXNlcjU3MjE3NA==","avatar_url":"https://avatars3.githubusercontent.com/u/572174?v=4","gravatar_id":"","url":"https://api.github.com/users/masaruh","html_url":"https://github.com/masaruh","followers_url":"https://api.github.com/users/masaruh/followers","following_url":"https://api.github.com/users/masaruh/following{/other_user}","gists_url":"https://api.github.com/users/masaruh/gists{/gist_id}","starred_url":"https://api.github.com/users/masaruh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/masaruh/subscriptions","organizations_url":"https://api.github.com/users/masaruh/orgs","repos_url":"https://api.github.com/users/masaruh/repos","events_url":"https://api.github.com/users/masaruh/events{/privacy}","received_events_url":"https://api.github.com/users/masaruh/received_events","type":"User","site_admin":false},"assignees":[{"login":"masaruh","id":572174,"node_id":"MDQ6VXNlcjU3MjE3NA==","avatar_url":"https://avatars3.githubusercontent.com/u/572174?v=4","gravatar_id":"","url":"https://api.github.com/users/masaruh","html_url":"https://github.com/masaruh","followers_url":"https://api.github.com/users/masaruh/followers","following_url":"https://api.github.com/users/masaruh/following{/other_user}","gists_url":"https://api.github.com/users/masaruh/gists{/gist_id}","starred_url":"https://api.github.com/users/masaruh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/masaruh/subscriptions","organizations_url":"https://api.github.com/users/masaruh/orgs","repos_url":"https://api.github.com/users/masaruh/repos","events_url":"https://api.github.com/users/masaruh/events{/privacy}","received_events_url":"https://api.github.com/users/masaruh/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2014-11-24T11:11:17Z","updated_at":"2015-04-06T03:41:57Z","closed_at":"2015-04-06T03:41:57Z","author_association":"NONE","active_lock_reason":null,"body":"I currently have a NullPointerException when using the Java Driver (1.4.0).\nIt is displayed client side, but it happens on the server side.\n\n```\n2014-11-24 11:42:34,347 [elasticsearch[Zeus][transport_client_worker][T#8]{New I/O worker #8}] DEBUG type - [Zeus] [myindex][3], node[0tdeHG7LSMKLKyqn7g0ifw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@69a9f314] lastShard [true]\norg.elasticsearch.transport.RemoteTransportException: [Ancient One][inet[/192.168.200.103:9300]][indices:data/read/search[phase/query]]\nCaused by: org.elasticsearch.search.SearchParseException: [myindex][3]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\"query\":{\"filtered\":{\"filter\":{\"term\":{\"source\":\"\"}}}}}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:681) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:537) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:509) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:264) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:776) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:767) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.run(MessageChannelHandler.java:275) ~[elasticsearch-1.4.0.jar:na]\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_25]\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_25]\n    at java.lang.Thread.run(Thread.java:745) ~[na:1.7.0_25]\nCaused by: java.lang.NullPointerException: null\n    at java.nio.HeapCharBuffer.<init>(HeapCharBuffer.java:70) ~[na:1.7.0_25]\n    at java.nio.CharBuffer.wrap(CharBuffer.java:369) ~[na:1.7.0_25]\n    at org.elasticsearch.common.xcontent.json.JsonXContentParser.utf8Bytes(JsonXContentParser.java:91) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.common.xcontent.json.JsonXContentParser.objectBytes(JsonXContentParser.java:116) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.index.query.TermFilterParser.parse(TermFilterParser.java:97) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.index.query.QueryParseContext.executeFilterParser(QueryParseContext.java:315) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerFilter(QueryParseContext.java:296) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.index.query.FilteredQueryParser.parse(FilteredQueryParser.java:74) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:252) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.index.query.IndexQueryParserService.innerParse(IndexQueryParserService.java:382) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:281) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:276) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33) ~[elasticsearch-1.4.0.jar:na]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:665) ~[elasticsearch-1.4.0.jar:na]\n    ... 9 common frames omitted\n```\n\nNote that the query is successfully parsed the first time it is executed and no error is thrown, but always fail after...\nI was not able to reproduce it using curl + shell.\n\nBelow is an extract of the code to help reproduce this behaviour:\n\n```\n   org.elasticsearch.node.Node node = NodeBuilder.nodeBuilder().client(true).node();\n   Client client = node.client();\n\n   FilterBuilder emptyFilter = FilterBuilders.termFilter(\"source\", \"\");\n\n   SearchResponse response1 = client.prepareSearch(\"myindex\").setTypes(\"mytype\").setQuery(QueryBuilders.filteredQuery(null, emptyFilter)).execute().actionGet();\n   logger.info(\"First attempt\");\n\n   SearchResponse response2 = client.prepareSearch(\"myindex\").setTypes(\"mytype\").setQuery(QueryBuilders.filteredQuery(null, emptyFilter)).execute().actionGet();\n   logger.info(\"Done\");\n```\n","closed_by":{"login":"masaruh","id":572174,"node_id":"MDQ6VXNlcjU3MjE3NA==","avatar_url":"https://avatars3.githubusercontent.com/u/572174?v=4","gravatar_id":"","url":"https://api.github.com/users/masaruh","html_url":"https://github.com/masaruh","followers_url":"https://api.github.com/users/masaruh/followers","following_url":"https://api.github.com/users/masaruh/following{/other_user}","gists_url":"https://api.github.com/users/masaruh/gists{/gist_id}","starred_url":"https://api.github.com/users/masaruh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/masaruh/subscriptions","organizations_url":"https://api.github.com/users/masaruh/orgs","repos_url":"https://api.github.com/users/masaruh/repos","events_url":"https://api.github.com/users/masaruh/events{/privacy}","received_events_url":"https://api.github.com/users/masaruh/received_events","type":"User","site_admin":false},"performed_via_github_app":null}