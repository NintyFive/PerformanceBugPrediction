{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18738","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18738/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18738/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18738/events","html_url":"https://github.com/elastic/elasticsearch/issues/18738","id":158486081,"node_id":"MDU6SXNzdWUxNTg0ODYwODE=","number":18738,"title":"bg_count is always zero when doing a significant terms aggregation with a custom background set that does not overlap with the foreground set on any shard","user":{"login":"ryanrozich","id":3526287,"node_id":"MDQ6VXNlcjM1MjYyODc=","avatar_url":"https://avatars3.githubusercontent.com/u/3526287?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanrozich","html_url":"https://github.com/ryanrozich","followers_url":"https://api.github.com/users/ryanrozich/followers","following_url":"https://api.github.com/users/ryanrozich/following{/other_user}","gists_url":"https://api.github.com/users/ryanrozich/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanrozich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanrozich/subscriptions","organizations_url":"https://api.github.com/users/ryanrozich/orgs","repos_url":"https://api.github.com/users/ryanrozich/repos","events_url":"https://api.github.com/users/ryanrozich/events{/privacy}","received_events_url":"https://api.github.com/users/ryanrozich/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":176784422,"node_id":"MDU6TGFiZWwxNzY3ODQ0MjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/won't%20fix","name":"won't fix","color":"f7c6c7","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2016-06-04T04:03:15Z","updated_at":"2016-06-15T13:05:11Z","closed_at":"2016-06-13T13:33:00Z","author_association":"NONE","active_lock_reason":null,"body":"ES 2.3.2 server and java api\n\nWhenever I perform a significant terms aggregation with a custom background set (where the background set and foreground sets do not overlap) and iterate through the `SignificantTerms.Bucket` entry objects in the java object result, I always get a `subsetDF`, `subsetSize` and `supersetDF` but `supersetSize` is always zero. It doesn't matter which significance heuristic I use. Is this expected? Is there another way I should be getting the per-bucket counts from the background set?\n\nExample json request and response below, notice that the bg_count is zero for all of the results\n\n**Request**\n\n``` json\n{\n  \"size\" : 0,\n  \"query\" : {\n    \"bool\" : {\n      \"filter\" : {\n        \"range\" : {\n          \"createdAt\" : {\n            \"from\" : \"2016-05-19\",\n            \"to\" : \"2016-05-25\",\n            \"include_lower\" : true,\n            \"include_upper\" : true\n          }\n        }\n      }\n    }\n  },\n  \"aggregations\" : {\n    \"significant_categories\" : {\n      \"significant_terms\" : {\n        \"field\" : \"category\",\n        \"size\" : 5,\n        \"background_filter\" : {\n          \"range\" : {\n            \"createdAt\" : {\n              \"from\" : \"2016-05-12\",\n              \"to\" : \"2016-05-18\",\n              \"include_lower\" : true,\n              \"include_upper\" : true\n            }\n          }\n        },\n        \"mutual_information\" : {\n          \"include_negatives\" : true,\n          \"background_is_superset\" : false\n        }\n      }\n    }\n  }\n}\n```\n\n**Response**\n\n``` json\n{\n  \"took\" : 35,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 18,\n    \"successful\" : 18,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 543817,\n    \"max_score\" : 0.0,\n    \"hits\" : [ ]\n  },\n  \"aggregations\" : {\n    \"significant_categories\" : {\n      \"doc_count\" : 543817,\n      \"buckets\" : [ {\n        \"key\" : \"Condiments_And_Sweeteners.Hot_sauces\",\n        \"doc_count\" : 29754,\n        \"score\" : 0.028138457657103193,\n        \"bg_count\" : 0\n      }, {\n        \"key\" : \"Chemistry.Fatty_acids\",\n        \"doc_count\" : 11676,\n        \"score\" : 0.01090831954637533,\n        \"bg_count\" : 0\n      }, {\n        \"key\" : \"Beverages.Milk_substitutes\",\n        \"doc_count\" : 10549,\n        \"score\" : 0.009848021517760529,\n        \"bg_count\" : 0\n      }, {\n        \"key\" : \"Chemistry.Essential_oils\",\n        \"doc_count\" : 8521,\n        \"score\" : 0.007944061722549585,\n        \"bg_count\" : 0\n      }, {\n        \"key\" : \"Condiments_And_Sweeteners.Salad_dressings\",\n        \"doc_count\" : 6036,\n        \"score\" : 0.005618049544322981,\n        \"bg_count\" : 0\n      } ]\n    }\n  }\n}\n```\n","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}