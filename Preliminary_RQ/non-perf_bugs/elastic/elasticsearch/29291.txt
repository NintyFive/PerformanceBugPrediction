{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29291","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29291/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29291/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29291/events","html_url":"https://github.com/elastic/elasticsearch/issues/29291","id":309663746,"node_id":"MDU6SXNzdWUzMDk2NjM3NDY=","number":29291,"title":"sharding unssigned","user":{"login":"WanliTian","id":2391020,"node_id":"MDQ6VXNlcjIzOTEwMjA=","avatar_url":"https://avatars3.githubusercontent.com/u/2391020?v=4","gravatar_id":"","url":"https://api.github.com/users/WanliTian","html_url":"https://github.com/WanliTian","followers_url":"https://api.github.com/users/WanliTian/followers","following_url":"https://api.github.com/users/WanliTian/following{/other_user}","gists_url":"https://api.github.com/users/WanliTian/gists{/gist_id}","starred_url":"https://api.github.com/users/WanliTian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WanliTian/subscriptions","organizations_url":"https://api.github.com/users/WanliTian/orgs","repos_url":"https://api.github.com/users/WanliTian/repos","events_url":"https://api.github.com/users/WanliTian/events{/privacy}","received_events_url":"https://api.github.com/users/WanliTian/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-29T08:28:18Z","updated_at":"2018-03-29T08:32:28Z","closed_at":"2018-03-29T08:32:28Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\n5.5.2\r\n**Plugins installed**: [xpack]\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_71\"\r\n**OS version** (`uname -a` if on a Unix-like system):\r\ncentos 7.0\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\ntoo many sharding unsigned\r\n\r\n**Steps to reproduce**:\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n[2018-03-29T08:15:08,726][WARN ][o.e.c.a.s.ShardStateAction] [master-node-3] [100002555313-1510542891][14] received shard failed for shard id [[100002555313-1510542891][14]], allocation id [h1ICRYzCT5qmAmZYHPkhbg], primary term [1], message [failed to perform indices:data/write/bulk[s] on replica [100002555313-1510542891][14], node[rpMejoD5SeyNEbBgi7W8Fg], [R], s[STARTED], a[id=h1ICRYzCT5qmAmZYHPkhbg]], failure [RemoteTransportException[[data-node-9.3.172.202][9.3.172.202:9300][indices:data/write/bulk[s][r]]]; nested: IllegalStateException[active primary shard cannot be a replication target before  relocation hand off [100002555313-1510542891][14], node[rpMejoD5SeyNEbBgi7W8Fg], [P], s[STARTED], a[id=h1ICRYzCT5qmAmZYHPkhbg], state is [STARTED]]; ]\r\norg.elasticsearch.transport.RemoteTransportException: [data-node-9.3.172.202][9.3.172.202:9300][indices:data/write/bulk[s][r]]\r\nCaused by: java.lang.IllegalStateException: active primary shard cannot be a replication target before  relocation hand off [100002555313-1510542891][14], node[rpMejoD5SeyNEbBgi7W8Fg], [P], s[STARTED], a[id=h1ICRYzCT5qmAmZYHPkhbg], state is [STARTED]\r\n        at org.elasticsearch.index.shard.IndexShard.verifyReplicationTarget(IndexShard.java:1141) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationLock(IndexShard.java:1666) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncReplicaAction.doRun(TransportReplicationAction.java:566) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(TransportReplicationAction.java:451) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(TransportReplicationAction.java:441) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1544) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_71]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_71]\r\n        at java.lang.Thread.run(Thread.java:745) [?:1.8.0_71]\r\n[2018-03-29T08:15:12,491][WARN ][o.e.c.a.s.ShardStateAction] [master-node-3] [3321337994-1510635791][5] received shard failed for shard id [[3321337994-1510635791][5]], allocation id [yNE2mccdRkebRqiCuxuOuA], primary term [1], message [failed to perform indices:data/write/bulk[s] on replica [3321337994-1510635791][5], node[QN77YvHXRkCz_5R6eA2XCA], [R], s[STARTED], a[id=yNE2mccdRkebRqiCuxuOuA]], failure [RemoteTransportException[[data-node-100.105.49.73][100.105.49.73:9300][indices:data/write/bulk[s][r]]]; nested: IllegalStateException[active primary shard cannot be a replication target before  relocation hand off [3321337994-1510635791][5], node[QN77YvHXRkCz_5R6eA2XCA], [P], s[STARTED], a[id=yNE2mccdRkebRqiCuxuOuA], state is [STARTED]]; ]\r\norg.elasticsearch.transport.RemoteTransportException: [data-node-100.105.49.73][100.105.49.73:9300][indices:data/write/bulk[s][r]]\r\nCaused by: java.lang.IllegalStateException: active primary shard cannot be a replication target before  relocation hand off [3321337994-1510635791][5], node[QN77YvHXRkCz_5R6eA2XCA], [P], s[STARTED], a[id=yNE2mccdRkebRqiCuxuOuA], state is [STARTED]\r\n        at org.elasticsearch.index.shard.IndexShard.verifyReplicationTarget(IndexShard.java:1141) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.index.shard.IndexShard.acquireReplicaOperationLock(IndexShard.java:1666) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncReplicaAction.doRun(TransportReplicationAction.java:566) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(TransportReplicationAction.java:451) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(TransportReplicationAction.java:441) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1544) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.5.2.jar:5.5.2]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_71]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_71]\r\n        at java.lang.Thread.run(Thread.java:745) [?:1.8.0_71]\r\n[2018-03-29T08:15:16,519][INFO ][o.e.m.j.JvmGcMonitorService] [master-node-3] [gc][young][17984261][854401] duration [928ms], collections [1]/[1.1s], total [928ms]/[3.5d], memory [21.6gb]->[20.9gb]/[31.8gb], all_pools {[young] [1.3gb]->[6.5mb]/[1.4gb]}{[survivor] [39.2mb]->[191.3mb]/[191.3mb]}{[old] [20.2gb]->[20.7gb]/[30.1gb]}\r\n[2018-03-29T08:15:16,519][WARN ][o.e.m.j.JvmGcMonitorService] [master-node-3] [gc][17984261] overhead, spent [928ms] collecting in the last [1.1s]\r\n```\r\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}