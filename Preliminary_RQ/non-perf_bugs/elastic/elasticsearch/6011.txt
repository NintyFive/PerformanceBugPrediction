{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6011","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6011/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6011/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6011/events","html_url":"https://github.com/elastic/elasticsearch/issues/6011","id":32662059,"node_id":"MDU6SXNzdWUzMjY2MjA1OQ==","number":6011,"title":"[elasticsearch 1.1] Marvel preventing cluster restart.","user":{"login":"hjz","id":480549,"node_id":"MDQ6VXNlcjQ4MDU0OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/480549?v=4","gravatar_id":"","url":"https://api.github.com/users/hjz","html_url":"https://github.com/hjz","followers_url":"https://api.github.com/users/hjz/followers","following_url":"https://api.github.com/users/hjz/following{/other_user}","gists_url":"https://api.github.com/users/hjz/gists{/gist_id}","starred_url":"https://api.github.com/users/hjz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hjz/subscriptions","organizations_url":"https://api.github.com/users/hjz/orgs","repos_url":"https://api.github.com/users/hjz/repos","events_url":"https://api.github.com/users/hjz/events{/privacy}","received_events_url":"https://api.github.com/users/hjz/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-05-02T01:39:10Z","updated_at":"2014-08-02T07:18:48Z","closed_at":"2014-08-02T07:18:48Z","author_association":"NONE","active_lock_reason":null,"body":"We have a 3 node cluster running on i2.xlarge instances.\n\nTried to reindexing a 10Gb dataset, 30M docs using the scroll API, with scroll size to 1M. This was causing elasticsearch to be unresponsive. \n\nI then tried a rolling restart of elasticsearch nodes which failed. Shutting down all the nodes and restarting also failed. We saw a lof of the following exceptions, which went away after deleting marvel.\n\n[2014-05-01 12:11:44,329][WARN ][search.action            ] [elasticsearch-i2-1] Failed to send release search context\norg.elasticsearch.transport.SendRequestTransportException: [es3][inet[/10.0.0.150:9300]][search/freeContext]\n    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:202)\n    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:173)\n    at org.elasticsearch.search.action.SearchServiceTransportAction.sendFreeContext(SearchServiceTransportAction.java:103)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.releaseIrrelevantSearchContexts(TransportSearchTypeAction.java:381)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.finishHim(TransportSearchQueryThenFetchAction.java:188)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$3.onResult(TransportSearchQueryThenFetchAction.java:156)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$3.onResult(TransportSearchQueryThenFetchAction.java:150)\n    at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteFetch(SearchServiceTransportAction.java:407)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.executeFetch(TransportSearchQueryThenFetchAction.java:150)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$2.run(TransportSearchQueryThenFetchAction.java:134)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: org.elasticsearch.transport.NodeNotConnectedException: [es3][inet[/10.0.0.150:9300]] Node not connected\n    at org.elasticsearch.transport.netty.NettyTransport.nodeChannel(NettyTransport.java:859)\n    at org.elasticsearch.transport.netty.NettyTransport.sendRequest(NettyTransport.java:540)\n    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:189)\n    ... 12 more\n[2014-05-01 12:11:44,329][WARN ][search.action            ] [elasticsearch-i2-1] Failed to send release search context\norg.elasticsearch.transport.SendRequestTransportException: [es3][inet[/10.0.0.150:9300]][search/freeContext]\n    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:202)\n    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:173)\n    at org.elasticsearch.search.action.SearchServiceTransportAction.sendFreeContext(SearchServiceTransportAction.java:103)\n    at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.releaseIrrelevantSearchContexts(TransportSearchTypeAction.java:381)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.finishHim(TransportSearchQueryThenFetchAction.java:188)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$3.onResult(TransportSearchQueryThenFetchAction.java:156)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$3.onResult(TransportSearchQueryThenFetchAction.java:150)\n    at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteFetch(SearchServiceTransportAction.java:407)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.executeFetch(TransportSearchQueryThenFetchAction.java:150)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$2.run(TransportSearchQueryThenFetchAction.java:134)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: org.elasticsearch.transport.NodeNotConnectedException: [es3][inet[/10.0.0.150:9300]] Node not connected\n    at org.elasticsearch.transport.netty.NettyTransport.nodeChannel(NettyTransport.java:859)\n    at org.elasticsearch.transport.netty.NettyTransport.sendRequest(NettyTransport.java:540)\n    at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:189)\n    ... 12 more\n[2014-05-01 12:11:44,354][ERROR][marvel.agent.exporter    ] [elasticsearch-i2-1] error connecting to [localhost:9200]\njava.net.ConnectException: Connection refused\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:579)\n    at sun.net.NetworkClient.doConnect(NetworkClient.java:175)\n    at sun.net.www.http.HttpClient.openServer(HttpClient.java:432)\n    at sun.net.www.http.HttpClient.openServer(HttpClient.java:527)\n    at sun.net.www.http.HttpClient.<init>(HttpClient.java:211)\n    at sun.net.www.http.HttpClient.New(HttpClient.java:308)\n    at sun.net.www.http.HttpClient.New(HttpClient.java:326)\n    at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:996)\n    at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:932)\n    at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:850)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.openConnection(ESExporter.java:316)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.openExportingConnection(ESExporter.java:181)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.exportXContent(ESExporter.java:245)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.exportNodeStats(ESExporter.java:129)\n    at org.elasticsearch.marvel.agent.AgentService$ExportingWorker.exportNodeStats(AgentService.java:331)\n    at org.elasticsearch.marvel.agent.AgentService$ExportingWorker.run(AgentService.java:229)\n    at java.lang.Thread.run(Thread.java:744)\n[2014-05-01 12:11:44,378][ERROR][marvel.agent.exporter    ] [elasticsearch-i2-1] could not connect to any configured elasticsearch instances: [localhost:9200]\n[2014-05-01 12:11:44,379][ERROR][marvel.agent.exporter    ] [elasticsearch-i2-1] error connecting to [localhost:9200]\njava.net.ConnectException: Connection refused\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:579)\n    at sun.net.NetworkClient.doConnect(NetworkClient.java:175)\n    at sun.net.www.http.HttpClient.openServer(HttpClient.java:432)\n    at sun.net.www.http.HttpClient.openServer(HttpClient.java:527)\n    at sun.net.www.http.HttpClient.<init>(HttpClient.java:211)\n    at sun.net.www.http.HttpClient.New(HttpClient.java:308)\n    at sun.net.www.http.HttpClient.New(HttpClient.java:326)\n    at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:996)\n    at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:932)\n    at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:850)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.openConnection(ESExporter.java:316)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.openExportingConnection(ESExporter.java:181)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.exportXContent(ESExporter.java:245)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.exportEvents(ESExporter.java:160)\n    at org.elasticsearch.marvel.agent.AgentService$ExportingWorker.exportEvents(AgentService.java:287)\n    at org.elasticsearch.marvel.agent.AgentService$ExportingWorker.run(AgentService.java:233)\n    at java.lang.Thread.run(Thread.java:744)\n[2014-05-01 12:11:44,379][ERROR][marvel.agent.exporter    ] [elasticsearch-i2-1] could not connect to any configured elasticsearch instances: [localhost:9200]\n[2014-05-01 12:11:44,432][WARN ][action.bulk              ] [elasticsearch-i2-1] failed to update master on updated mapping for index [prod-project-9-5-1], type [emailSend]\norg.elasticsearch.indices.IndexMissingException: [prod-project-9-5-1] missing\n    at org.elasticsearch.indices.InternalIndicesService.indexServiceSafe(InternalIndicesService.java:254)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.updateMappingOnMaster(TransportShardBulkAction.java:605)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:188)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction.performOnPrimary(TransportShardReplicationOperationAction.java:556)\n    at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$1.run(TransportShardReplicationOperationAction.java:426)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n[2014-05-01 12:11:44,432][WARN ][monitor.jvm              ] [elasticsearch-i2-1] [gc][old][614438][125] duration [14.8m], collections [49]/[14.9m], total [14.8m]/[19m], memory [17.7gb]->[10.6gb]/[17.7gb], all_pools {[young] [254.8mb]->[162mb]/[266.2mb]}{[survivor] [0b]->[0b]/[33.2mb]}{[old] [17.5gb]->[10.5gb]/[17.5gb]}\n[2014-05-01 12:11:45,328][ERROR][marvel.agent.exporter    ] [elasticsearch-i2-1] error connecting to [localhost:9200]\njava.net.ConnectException: Connection refused\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:339)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:200)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:182)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:579)\n    at sun.net.NetworkClient.doConnect(NetworkClient.java:175)\n    at sun.net.www.http.HttpClient.openServer(HttpClient.java:432)\n    at sun.net.www.http.HttpClient.openServer(HttpClient.java:527)\n    at sun.net.www.http.HttpClient.<init>(HttpClient.java:211)\n    at sun.net.www.http.HttpClient.New(HttpClient.java:308)\n    at sun.net.www.http.HttpClient.New(HttpClient.java:326)\n    at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:996)\n    at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:932)\n    at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:850)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.openConnection(ESExporter.java:316)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.openConnection(ESExporter.java:292)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter.access$300(ESExporter.java:58)\n    at org.elasticsearch.marvel.agent.exporter.ESExporter$ConnectionKeepAliveWorker.run(ESExporter.java:696)\n    at java.lang.Thread.run(Thread.java:744)\n[2014-05-01 12:11:46,329][ERROR][marvel.agent.exporter    ] [elasticsearch-i2-1] error connecting to [localhost:9200]\njava.net.ConnectException: Connection refused\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}