[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346148222","html_url":"https://github.com/elastic/elasticsearch/issues/27481#issuecomment-346148222","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27481","id":346148222,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NjE0ODIyMg==","user":{"login":"aslamy","id":11768586,"node_id":"MDQ6VXNlcjExNzY4NTg2","avatar_url":"https://avatars3.githubusercontent.com/u/11768586?v=4","gravatar_id":"","url":"https://api.github.com/users/aslamy","html_url":"https://github.com/aslamy","followers_url":"https://api.github.com/users/aslamy/followers","following_url":"https://api.github.com/users/aslamy/following{/other_user}","gists_url":"https://api.github.com/users/aslamy/gists{/gist_id}","starred_url":"https://api.github.com/users/aslamy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aslamy/subscriptions","organizations_url":"https://api.github.com/users/aslamy/orgs","repos_url":"https://api.github.com/users/aslamy/repos","events_url":"https://api.github.com/users/aslamy/events{/privacy}","received_events_url":"https://api.github.com/users/aslamy/received_events","type":"User","site_admin":false},"created_at":"2017-11-21T20:17:43Z","updated_at":"2017-11-21T20:23:08Z","author_association":"NONE","body":"I also get this error. I use Synonym Graph. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346676877","html_url":"https://github.com/elastic/elasticsearch/issues/27481#issuecomment-346676877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27481","id":346676877,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NjY3Njg3Nw==","user":{"login":"stefando","id":6553751,"node_id":"MDQ6VXNlcjY1NTM3NTE=","avatar_url":"https://avatars1.githubusercontent.com/u/6553751?v=4","gravatar_id":"","url":"https://api.github.com/users/stefando","html_url":"https://github.com/stefando","followers_url":"https://api.github.com/users/stefando/followers","following_url":"https://api.github.com/users/stefando/following{/other_user}","gists_url":"https://api.github.com/users/stefando/gists{/gist_id}","starred_url":"https://api.github.com/users/stefando/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stefando/subscriptions","organizations_url":"https://api.github.com/users/stefando/orgs","repos_url":"https://api.github.com/users/stefando/repos","events_url":"https://api.github.com/users/stefando/events{/privacy}","received_events_url":"https://api.github.com/users/stefando/received_events","type":"User","site_admin":false},"created_at":"2017-11-23T18:06:13Z","updated_at":"2017-11-23T18:06:13Z","author_association":"NONE","body":"The same issue with synonym filter: \r\n\"curaçao,cw,cuw\" => term: curaçao analyzed to a token with posinc != 1","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346770024","html_url":"https://github.com/elastic/elasticsearch/issues/27481#issuecomment-346770024","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27481","id":346770024,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Njc3MDAyNA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-11-24T08:28:03Z","updated_at":"2017-11-24T08:28:03Z","author_association":"MEMBER","body":"@nacimgoura I am not able to reproduce your issue with the settings that you provided. Can you share the entire definition for your synonym, analyzer and field ?\r\nThe exception you're hitting is not new, the synonym filter analyzes the synonym rules with an analyzer and if multiple tokens are at the same position (stacked tokens) it fails. This can happen if you use an analyzer (tokenizer or filter) that creates multiple variations of the same token.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346792390","html_url":"https://github.com/elastic/elasticsearch/issues/27481#issuecomment-346792390","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27481","id":346792390,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Njc5MjM5MA==","user":{"login":"nacimgoura","id":9990521,"node_id":"MDQ6VXNlcjk5OTA1MjE=","avatar_url":"https://avatars3.githubusercontent.com/u/9990521?v=4","gravatar_id":"","url":"https://api.github.com/users/nacimgoura","html_url":"https://github.com/nacimgoura","followers_url":"https://api.github.com/users/nacimgoura/followers","following_url":"https://api.github.com/users/nacimgoura/following{/other_user}","gists_url":"https://api.github.com/users/nacimgoura/gists{/gist_id}","starred_url":"https://api.github.com/users/nacimgoura/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nacimgoura/subscriptions","organizations_url":"https://api.github.com/users/nacimgoura/orgs","repos_url":"https://api.github.com/users/nacimgoura/repos","events_url":"https://api.github.com/users/nacimgoura/events{/privacy}","received_events_url":"https://api.github.com/users/nacimgoura/received_events","type":"User","site_admin":false},"created_at":"2017-11-24T10:12:41Z","updated_at":"2017-11-24T10:14:15Z","author_association":"NONE","body":"Hi @jimczi, Here is my entire definition : \r\n```\r\n\r\n// analyser\r\nexports.settings = {\r\n    settings: {\r\n        analysis: {\r\n            filter: {\r\n                // suppression de ces mots pour diminuer le bruit\r\n                french_elision: {\r\n                    type: 'elision',\r\n                    articles: [\r\n                        'l', 'm', 't', 'qu', 'n', 's',\r\n                        'j', 'd', 'c', 'jusqu', 'quoiqu',\r\n                        'lorsqu', 'puisqu', 'ès', 'vers', 'a', 'à', 'afin',\r\n                        'ai', 'ainsi', 'après', 'attendu', 'au', 'aujourd',\r\n                        'auquel', 'aussi', 'autre', 'autres', 'aux', 'auxquelles',\r\n                        'auxquels', 'avait', 'avant', 'avec', 'avoir', 'c', 'ça',\r\n                        'car', 'ce', 'ceci', 'cela', 'celle', 'celles', 'celui',\r\n                        'cependant', 'certain', 'certaine', 'certaines', 'certains',\r\n                        'ces', 'cet', 'cette', 'ceux', 'chez', 'ci', 'combien', 'comme',\r\n                        'comment', 'concernant', 'contre', 'd', 'dans', 'de', 'debout',\r\n                        'dedans', 'dehors', 'delà', 'depuis', 'derrière', 'des', 'dès',\r\n                        'désormais', 'desquelles', 'desquels', 'dessous', 'dessus', 'devant',\r\n                        'devers', 'devra', 'divers', 'diverse', 'diverses', 'doit', 'donc',\r\n                        'dont', 'du', 'duquel', 'durant', 'elle', 'elles', 'en', 'entre', 'environ',\r\n                        'est', 'et', 'etc', 'été', 'etre', 'être', 'eu', 'eux', 'excepté', 'hélas',\r\n                        'hormis', 'hors', 'hui', 'il', 'ils', 'j', 'je', 'jusqu', 'l', 'la',\r\n                        'là', 'laquelle', 'le', 'lequel', 'les', 'lesquelles', 'lesquels', 'leur', 'leurs',\r\n                        'lorsqu', 'lui', 'ma', 'mais', 'malgré', 'me', 'même', 'mêmes', 'merci', 'mes', 'mien',\r\n                        'mienne', 'miennes', 'miens', 'moi', 'moins', 'mon', 'ne', 'néanmoins',\r\n                        'ni', 'non', 'nos', 'notre', 'nôtre', 'nôtres', 'nous', 'ô', 'on', 'ont', 'ou', 'où', 'outre',\r\n                        'par', 'parmi', 'partant', 'pas', 'passé', 'pendant', 'plein', 'plus', 'plusieurs', 'pour',\r\n                        'pourquoi', 'près', 'proche', 'puisque', 'qu', 'quand', 'que', 'quel', 'quelle', 'quelles',\r\n                        'quels', 'qui', 'quoi', 'quoique', 'revoici', 'revoilà', 'sa', 'sauf', 'se', 'selon',\r\n                        'seront', 'ses', 'si', 'sien', 'sienne', 'siennes', 'siens', 'sinon', 'soi', 'soit', 'son',\r\n                        'sont', 'sous', 'suivant', 'sur', 'ta', 'te', 'tes', 'tien', 'tienne', 'tiennes', 'tiens',\r\n                        'toi', 'ton', 'tous', 'tout', 'toute', 'toutes', 'tu', 'un', 'une', 'va', 'voici', 'voilà',\r\n                        'vos', 'votre', 'vôtre', 'vôtres', 'vous', 'vu', 'y',\r\n                    ],\r\n                },\r\n                snowball: {\r\n                    type: 'snowball',\r\n                    language: 'French',\r\n                },\r\n                // enleve le bruit (les, nous, pas...)\r\n                french_stop: {\r\n                    type: 'stop',\r\n                    stopwords: '_french_',\r\n                    ignore_case: true,\r\n                },\r\n                // synonyme\r\n                /**\r\n                 * Attention après ajout de synonyme, réindexer\r\n                 * https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-synonym-tokenfilter.html\r\n                 */\r\n                french_synonym: {\r\n                    type: 'synonym',\r\n                    synonyms: [\r\n                        'pmi, protection maternelle et infantile',\r\n                        'psycho, psychiatrie',\r\n                        'anap, Agence nationale d\\'appui à la performance des établissements de santé et médico-sociaux',\r\n                        'ars, agences régionales de santé',\r\n                        'c dans l\\'oxygene, c dans l\\'air',\r\n                        '+ => plus',\r\n                        '% => pour cent',\r\n                        '10% => 10 pour cent, 10 pourcent,dix pour cent, dix pourcent',\r\n                        '1 => un',\r\n                        '2 => deux',\r\n                        '3 => trois',\r\n                        '4 => quatre',\r\n                        '5 => cinq',\r\n                        '6 => six',\r\n                        '7 => sept',\r\n                        '8 => huit',\r\n                        '9 => neuf',\r\n                        '10 => dix',\r\n                        '11 => onze',\r\n                        '12 => douze',\r\n                        '13 => treize',\r\n                        '14 => quatorze',\r\n                        '15 => quinze',\r\n                        '16 => seize',\r\n                        '17 => dix-sept,dix sept',\r\n                        '18 => dix-huit,dix huit',\r\n                        '19 => dix-neuf,dix neuf',\r\n                        '20 => vingt',\r\n                        'min, minute, minimum',\r\n                        'boulevard, rue, avenue',\r\n                        'ville, village',\r\n                        'cosmos, galaxie,univers',\r\n                        'docteur, medecin, doctor',\r\n                        'foot2rue, foot de rue,foot 2 rue',\r\n                        'animaux, betes',\r\n                        'chine, asie, asiatique, chinois, cantonais, jaune',\r\n                        'accusé, coupable',\r\n                        'sdf, sans domilcile fixe',\r\n                        'Histoire, légende',\r\n                        'tgv, train, ter, sncf, train grande vitesse',\r\n                        'canada,canadienne',\r\n                        'terrien,terre',\r\n                    ],\r\n                },\r\n                // radical des mots\r\n                french_stemmer: {\r\n                    type: 'stemmer',\r\n                    language: 'light_french',\r\n                },\r\n                // phonetic (alternative a fuziness pour les erreurs d'orthographe)\r\n                phonetic_filter: {\r\n                    type: 'phonetic',\r\n                    encoder: 'beider_morse',\r\n                    languageset: 'french',\r\n                },\r\n            },\r\n            tokenizer: {\r\n                tokeniser_url_mail: {\r\n                    type: 'uax_url_email',\r\n                    max_token_length: 10,\r\n                },\r\n            },\r\n            analyzer: {\r\n                // français elevé\r\n                french_heavy: {\r\n                    type: 'custom',\r\n                    tokenizer: 'icu_tokenizer',\r\n                    filter: [\r\n                        'lowercase',\r\n                        'asciifolding',\r\n                        'icu_folding',\r\n                        'phonetic_filter',\r\n                        'french_elision',\r\n                        'french_synonym',\r\n                        'french_stemmer',\r\n                        'french_stop',\r\n                        'snowball',\r\n                    ],\r\n                },\r\n                // français léger\r\n                french_light: {\r\n                    type: 'custom',\r\n                    tokenizer: 'icu_tokenizer',\r\n                    filter: [\r\n                        'lowercase',\r\n                        'asciifolding',\r\n                        'icu_folding',\r\n                        'french_elision',\r\n                    ],\r\n                },\r\n                // analyzer for url\r\n                url_analyzer: {\r\n                    type: 'custom',\r\n                    tokenizer: 'tokeniser_url_mail',\r\n                },\r\n                french_html: {\r\n                    type: 'custom',\r\n                    tokenizer: 'icu_tokenizer',\r\n                    char_filter: ['html_strip'],\r\n                    filter: [\r\n                        'lowercase',\r\n                        'asciifolding',\r\n                        'icu_folding',\r\n                        'phonetic_filter',\r\n                        'french_elision',\r\n                    ],\r\n                },\r\n            },\r\n        },\r\n    },\r\n};\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/346806566","html_url":"https://github.com/elastic/elasticsearch/issues/27481#issuecomment-346806566","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27481","id":346806566,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NjgwNjU2Ng==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-11-24T11:21:25Z","updated_at":"2017-11-24T11:21:25Z","author_association":"MEMBER","body":"Sorry this is a new behavior in 6.0:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/breaking_60_analysis_changes.html\r\nIn 6.0 the `synonym` and the `synonym_graph` filters have changed. They now apply all the filters that appear before them in the chain to build their synonym rules. o\r\nFor the `french_heavy` field, the `french_synonym` filters appears after 5 filters:\r\n```\r\nfrench_heavy: {\r\n                    type: 'custom',\r\n                    tokenizer: 'icu_tokenizer',\r\n                    filter: [\r\n                        'lowercase',\r\n                        'asciifolding',\r\n                        'icu_folding',\r\n                        'phonetic_filter',\r\n                        'french_elision',\r\n                        'french_synonym',\r\n                        'french_stemmer',\r\n                        'french_stop',\r\n                        'snowball',\r\n                    ],\r\n                }\r\n```\r\n\r\nThis means that all your synonym rules are analyzed with an `icu_tokenizer` and the following filters:\r\n 'lowercase', 'asciifolding', 'icu_folding', 'phonetic_filter', 'french_elision'. \r\nFor each rule, we apply this chain and we verify that the produced synonyms are valid.\r\nWith this change in mind you'll have to modify your analyzers and synonym rules:\r\n * `'% => pour cent'` is not accepted because `%` is removed by the `icu_tokenizer` and therefore could never be found in a text that pass through this analyzer.\r\n * The `phonetic` filter should be put **after** the synonym filter. The synonyms should not be checked against the phonetic form and we disallow rules that have multiple rewriting (original form + phonetic form for instance).\r\n\r\nIt's important to note that some of your rules are not built correctly in 5.x with this configuration. For instance `'c dans l\\'oxygene, c dans l\\'air'` should never match since the ellision filter would always remove `l'` from the input even though the rule is defined with an elision. With the new behavior in 6.0 this rule has a chance to match.\r\n\r\nI hope you don't mind if I close this issue, we can continue to discuss the new behavior of the synonym filters in the forum if you want. Just open a new topic and we'll be happy to help:\r\nhttps://discuss.elastic.co/c/elasticsearch\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/392888233","html_url":"https://github.com/elastic/elasticsearch/issues/27481#issuecomment-392888233","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27481","id":392888233,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Mjg4ODIzMw==","user":{"login":"jtreher","id":1258179,"node_id":"MDQ6VXNlcjEyNTgxNzk=","avatar_url":"https://avatars1.githubusercontent.com/u/1258179?v=4","gravatar_id":"","url":"https://api.github.com/users/jtreher","html_url":"https://github.com/jtreher","followers_url":"https://api.github.com/users/jtreher/followers","following_url":"https://api.github.com/users/jtreher/following{/other_user}","gists_url":"https://api.github.com/users/jtreher/gists{/gist_id}","starred_url":"https://api.github.com/users/jtreher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtreher/subscriptions","organizations_url":"https://api.github.com/users/jtreher/orgs","repos_url":"https://api.github.com/users/jtreher/repos","events_url":"https://api.github.com/users/jtreher/events{/privacy}","received_events_url":"https://api.github.com/users/jtreher/received_events","type":"User","site_admin":false},"created_at":"2018-05-29T18:33:13Z","updated_at":"2018-05-29T18:38:51Z","author_association":"NONE","body":"@jimczi This is a huge breaking change. A single synonyms file that represents our vocabulary no longer is valid in all custom analyzers because it's tightly coupled to the specific filters and tokenizers on that analyzer. How will I know if we add an invalid synonym that breaks index creation? Our content editors are free to make up synonyms as they need to support user queries. For years this has worked out well and all the sudden it's completely broken. \r\n\r\nWhy does it have to fail index creation, why not just ignore the synonym? Or at least give us an option to ignore eliminated synonyms rather than failing creation.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/396225399","html_url":"https://github.com/elastic/elasticsearch/issues/27481#issuecomment-396225399","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27481","id":396225399,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NjIyNTM5OQ==","user":{"login":"JedatKinports","id":25081989,"node_id":"MDQ6VXNlcjI1MDgxOTg5","avatar_url":"https://avatars0.githubusercontent.com/u/25081989?v=4","gravatar_id":"","url":"https://api.github.com/users/JedatKinports","html_url":"https://github.com/JedatKinports","followers_url":"https://api.github.com/users/JedatKinports/followers","following_url":"https://api.github.com/users/JedatKinports/following{/other_user}","gists_url":"https://api.github.com/users/JedatKinports/gists{/gist_id}","starred_url":"https://api.github.com/users/JedatKinports/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JedatKinports/subscriptions","organizations_url":"https://api.github.com/users/JedatKinports/orgs","repos_url":"https://api.github.com/users/JedatKinports/repos","events_url":"https://api.github.com/users/JedatKinports/events{/privacy}","received_events_url":"https://api.github.com/users/JedatKinports/received_events","type":"User","site_admin":false},"created_at":"2018-06-11T12:24:54Z","updated_at":"2018-06-11T12:24:54Z","author_association":"NONE","body":"I got this error because I have applied the wrong TokenFilter to my custom analyzer (had similar tokenfilters for different languages). In case someone should have the same problem. This should be a quicker fix. It was a copy/paste mistake.","performed_via_github_app":null}]