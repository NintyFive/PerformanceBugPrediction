{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28735","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28735/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28735/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28735/events","html_url":"https://github.com/elastic/elasticsearch/issues/28735","id":298395019,"node_id":"MDU6SXNzdWUyOTgzOTUwMTk=","number":28735,"title":"ConfigSyncService] [node01] Failed to start ConfigFileUpdater. org.elasticsearch.ElasticsearchSecurityException: action [indices:admin/exists] is unauthorized for user [_system] with x-pack","user":{"login":"acossette1979","id":23176481,"node_id":"MDQ6VXNlcjIzMTc2NDgx","avatar_url":"https://avatars0.githubusercontent.com/u/23176481?v=4","gravatar_id":"","url":"https://api.github.com/users/acossette1979","html_url":"https://github.com/acossette1979","followers_url":"https://api.github.com/users/acossette1979/followers","following_url":"https://api.github.com/users/acossette1979/following{/other_user}","gists_url":"https://api.github.com/users/acossette1979/gists{/gist_id}","starred_url":"https://api.github.com/users/acossette1979/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/acossette1979/subscriptions","organizations_url":"https://api.github.com/users/acossette1979/orgs","repos_url":"https://api.github.com/users/acossette1979/repos","events_url":"https://api.github.com/users/acossette1979/events{/privacy}","received_events_url":"https://api.github.com/users/acossette1979/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-02-19T20:37:43Z","updated_at":"2018-02-19T20:42:00Z","closed_at":"2018-02-19T20:42:00Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n6.1.0\r\n**Plugins installed**: []\r\nnode01 analysis-fess     6.1.0\r\nnode01 analysis-ja       6.1.0\r\nnode01 analysis-synonym  6.1.0\r\nnode01 configsync        6.1.0\r\nnode01 dataformat        6.1.0\r\nnode01 ingest-geoip      6.1.0\r\nnode01 ingest-user-agent 6.1.0\r\nnode01 langfield         6.1.0\r\nnode01 minhash           6.1.0\r\nnode01 x-pack            6.1.0\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_151\"\r\nOpenJDK Runtime Environment (build 1.8.0_151-b12)\r\nOpenJDK 64-Bit Server VM (build 25.151-b12, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux 2be743d835de 3.10.0-693.5.2.el7.x86_64 #1 SMP Fri Oct 13 10:46:25 EDT 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhen loading x-pack, the configsync plugin failed action [indices:admin/exists] is unauthorized for user [_system]\r\n\r\n**Steps to reproduce**:\r\nFROM docker.elastic.co/elasticsearch/elasticsearch:6.1.0\r\nInstall plugin.\r\nStart ES.\r\n(same image work if removing x-pack)\r\n\r\n**Provide logs (if relevant)**:\r\n[2018-02-19T20:19:32,638][INFO ][o.e.p.PluginsService     ] [node01] loaded module [aggs-matrix-stats]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [analysis-common]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [ingest-common]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [lang-expression]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [lang-mustache]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [lang-painless]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [mapper-extras]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [parent-join]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [percolator]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [reindex]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [repository-url]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [transport-netty4]\r\n[2018-02-19T20:19:32,639][INFO ][o.e.p.PluginsService     ] [node01] loaded module [tribe]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [analysis-fess]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [analysis-ja]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [analysis-synonym]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [configsync]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [dataformat]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [ingest-geoip]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [ingest-user-agent]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [langfield]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [minhash]\r\n[2018-02-19T20:19:32,640][INFO ][o.e.p.PluginsService     ] [node01] loaded plugin [x-pack]\r\n[2018-02-19T20:19:35,081][INFO ][o.e.x.m.j.p.l.CppLogMessageHandler] [controller/120] [Main.cc@128] controller (64 bit): Version 6.1.0 (Build f3e883f11f2d23) Copyright (c) 2017 Elasticsearch BV\r\n[2018-02-19T20:19:35,417][INFO ][o.e.d.DiscoveryModule    ] [node01] using discovery type [zen]\r\n[2018-02-19T20:19:36,033][INFO ][o.e.n.Node               ] [node01] initialized\r\n[2018-02-19T20:19:36,034][INFO ][o.e.n.Node               ] [node01] starting ...\r\n[2018-02-19T20:19:36,217][INFO ][o.e.t.TransportService   ] [node01] publish_address {172.17.0.2:9300}, bound_addresses {[::]:9300}\r\n[2018-02-19T20:19:36,230][INFO ][o.e.b.BootstrapChecks    ] [node01] bound or publishing to a non-loopback or non-link-local address, enforcing bootstrap checks\r\n[2018-02-19T20:19:39,299][INFO ][o.e.c.s.MasterService    ] [node01] zen-disco-elected-as-master ([0] nodes joined), reason: new_master {node01}{in4BvtX7RyG3WFvmfwwjvQ}{nqe84wLnSkq8wFHIuL7sWQ}{172.17.0.2}{172.17.0.2:9300}{ml.machine_memory=67388583936, ml.max_open_jobs=20, ml.enabled=true}\r\n[2018-02-19T20:19:39,304][INFO ][o.e.c.s.ClusterApplierService] [node01] new_master {node01}{in4BvtX7RyG3WFvmfwwjvQ}{nqe84wLnSkq8wFHIuL7sWQ}{172.17.0.2}{172.17.0.2:9300}{ml.machine_memory=67388583936, ml.max_open_jobs=20, ml.enabled=true}, reason: apply cluster state (from master [master {node01}{in4BvtX7RyG3WFvmfwwjvQ}{nqe84wLnSkq8wFHIuL7sWQ}{172.17.0.2}{172.17.0.2:9300}{ml.machine_memory=67388583936, ml.max_open_jobs=20, ml.enabled=true} committed version [1] source [zen-disco-elected-as-master ([0] nodes joined)]])\r\n[2018-02-19T20:19:39,320][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [node01] publish_address {172.17.0.2:9200}, bound_addresses {[::]:9200}\r\n[2018-02-19T20:19:39,321][INFO ][o.e.n.Node               ] [node01] started\r\n[2018-02-19T20:19:39,374][\r\n\r\nERROR][o.c.e.c.s.ConfigSyncService] [node01] Failed to start ConfigFileUpdater.\r\n\r\norg.elasticsearch.ElasticsearchSecurityException: action [indices:admin/exists] is unauthorized for user [_system]\r\n\tat org.elasticsearch.xpack.security.support.Exceptions.authorizationError(Exceptions.java:42) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationService.denialException(AuthorizationService.java:589) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationService.denial(AuthorizationService.java:560) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationService.authorize(AuthorizationService.java:168) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$authorizeRequest$4(SecurityActionFilter.java:178) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:182) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:176) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:158) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.authorizeRequest(SecurityActionFilter.java:192) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$applyInternal$3(SecurityActionFilter.java:168) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$writeAuthToContext$23(AuthenticationService.java:453) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.writeAuthToContext(AuthenticationService.java:462) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$handleNullToken$16(AuthenticationService.java:355) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.handleNullToken(AuthenticationService.java:362) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.consumeToken(AuthenticationService.java:277) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$extractToken$7(AuthenticationService.java:249) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.extractToken(AuthenticationService.java:266) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$null$0(AuthenticationService.java:201) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.xpack.security.authc.TokenService.getAndValidateToken(TokenService.java:239) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:197) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:228) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:239) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:193) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:147) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:116) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.applyInternal(SecurityActionFilter.java:167) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.apply(SecurityActionFilter.java:126) ~[?:?]\r\n\tat org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:165) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:139) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:81) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.client.node.NodeClient.executeLocally(NodeClient.java:83) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:72) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:405) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.client.support.AbstractClient$IndicesAdmin.execute(AbstractClient.java:1253) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:71) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.codelibs.elasticsearch.configsync.service.ConfigSyncService.checkIfIndexExists(ConfigSyncService.java:226) ~[?:?]\r\n\tat org.codelibs.elasticsearch.configsync.service.ConfigSyncService.access$300(ConfigSyncService.java:79) ~[?:?]\r\n\tat org.codelibs.elasticsearch.configsync.service.ConfigSyncService$1.lambda$afterStart$2(ConfigSyncService.java:209) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:85) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:81) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$1.onResponse(TransportMasterNodeAction.java:150) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.support.master.TransportMasterNodeAction$AsyncSingleAction$1.onResponse(TransportMasterNodeAction.java:147) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.action.admin.cluster.health.TransportClusterHealthAction$3.onNewClusterState(TransportClusterHealthAction.java:175) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onNewClusterState(ClusterStateObserver.java:303) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.clusterChanged(ClusterStateObserver.java:191) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService.lambda$callClusterStateListeners$7(ClusterApplierService.java:506) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat java.util.concurrent.ConcurrentHashMap$KeySpliterator.forEachRemaining(ConcurrentHashMap.java:3527) [?:1.8.0_151]\r\n\tat java.util.stream.Streams$ConcatSpliterator.forEachRemaining(Streams.java:743) [?:1.8.0_151]\r\n\tat java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580) [?:1.8.0_151]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService.callClusterStateListeners(ClusterApplierService.java:503) [elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService.applyChanges(ClusterApplierService.java:486) [elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:429) [elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:158) [elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:568) [elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:247) [elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:210) [elasticsearch-6.1.0.jar:6.1.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_151]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_151]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\n[2018-02-19T20:19:39,388][INFO ][o.e.g.GatewayService     ] [node01] recovered [0] indices into cluster_state\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}