[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32645148","html_url":"https://github.com/elastic/elasticsearch/issues/4790#issuecomment-32645148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4790","id":32645148,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNjQ1MTQ4","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2014-01-17T20:51:46Z","updated_at":"2014-01-17T20:51:46Z","author_association":"MEMBER","body":"Hi @nik9000, are you using the Disk Threshold Decider or any custom shard allocation weights? If so, what are your settings?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32650410","html_url":"https://github.com/elastic/elasticsearch/issues/4790#issuecomment-32650410","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4790","id":32650410,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNjUwNDEw","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2014-01-17T21:32:44Z","updated_at":"2014-01-17T21:32:59Z","author_association":"CONTRIBUTOR","body":"Yeah,  Disk Threshold Decider:\n\n``` js\n{\n    \"transient\" : {\n        \"cluster.routing.allocation.disk.threshold_enabled\": true,\n        \"cluster.routing.allocation.disk.watermark.low\": \"0.85\",\n        \"cluster.routing.allocation.disk.watermark.high\": \"0.95\",\n        \"cluster.info.update.interval\": \"60s\"\n    }\n}\n```\n\nI'm not using any awareness attributes right now.\n\nBy \"fill up the disk\" I mean end up between the low and high watermark.  I get two nodes with maybe 150 big shards and the rest end up with twice that many shards which are mostly smaller.  The two nodes sit just above the low watermark while the other shards have plenty of space and start trading shards back and forth between each other.  By back and forth I mean they really send the same shard back and forth.\n\nI was able to dig my way out of the situation through a combination of manually moving large shards from the nodes with fewer shards to nodes with more shards.  That mostly worked.  Most of the time I could one large shard for a hand full of smaller ones.\n\nI think the allocation heuristics must break down when you get that unbalanced.  The cluster might be able to work itself out of the state if nodes above the low water mark that have some % fewer shards then the average decided moved away their largest shards.  Or something.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38186441","html_url":"https://github.com/elastic/elasticsearch/issues/4790#issuecomment-38186441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4790","id":38186441,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MTg2NDQx","user":{"login":"xstevens","id":69216,"node_id":"MDQ6VXNlcjY5MjE2","avatar_url":"https://avatars3.githubusercontent.com/u/69216?v=4","gravatar_id":"","url":"https://api.github.com/users/xstevens","html_url":"https://github.com/xstevens","followers_url":"https://api.github.com/users/xstevens/followers","following_url":"https://api.github.com/users/xstevens/following{/other_user}","gists_url":"https://api.github.com/users/xstevens/gists{/gist_id}","starred_url":"https://api.github.com/users/xstevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xstevens/subscriptions","organizations_url":"https://api.github.com/users/xstevens/orgs","repos_url":"https://api.github.com/users/xstevens/repos","events_url":"https://api.github.com/users/xstevens/events{/privacy}","received_events_url":"https://api.github.com/users/xstevens/received_events","type":"User","site_admin":false},"created_at":"2014-03-20T16:09:24Z","updated_at":"2014-03-20T16:09:24Z","author_association":"NONE","body":"For what it's worth I am seeing this same behavior without disk threshold enabled. We recently expanded our cluster and so now we have more nodes than shards on the older indices. On some of those indices we're seeing shards get bounced back and forth between a nodes that have no shards. For example: We have 14 data nodes and the old indices had 6 shards (w/ 1 replica).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68068697","html_url":"https://github.com/elastic/elasticsearch/issues/4790#issuecomment-68068697","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4790","id":68068697,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MDY4Njk3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-24T18:36:37Z","updated_at":"2014-12-24T18:36:37Z","author_association":"CONTRIBUTOR","body":"Hi @nik9000 \n\nAre you still seeing these same dynamics with the disk allocator in 1.4.2?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68069048","html_url":"https://github.com/elastic/elasticsearch/issues/4790#issuecomment-68069048","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4790","id":68069048,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MDY5MDQ4","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2014-12-24T18:45:16Z","updated_at":"2014-12-24T18:45:16Z","author_association":"CONTRIBUTOR","body":"We're no longer really a good candidate for reproducing this because we've doubled our capacity since I filed this.  We're much less likely to get to that point.  We also have yet to upgrade to 1.4.  That is probably coming early next year.\n\nI imagine you could reproduce this with simulations similar to what I was doing to test #7171.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76510892","html_url":"https://github.com/elastic/elasticsearch/issues/4790#issuecomment-76510892","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4790","id":76510892,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NTEwODky","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-02-28T05:01:23Z","updated_at":"2015-02-28T05:01:23Z","author_association":"CONTRIBUTOR","body":"This issue appears to be stale. Please feel free to open a new ticket if you see issues with the disk decider again.\n","performed_via_github_app":null}]