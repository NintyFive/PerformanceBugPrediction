[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384456404","html_url":"https://github.com/elastic/elasticsearch/issues/30148#issuecomment-384456404","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30148","id":384456404,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDQ1NjQwNA==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-04-25T22:40:47Z","updated_at":"2018-04-25T22:40:47Z","author_association":"CONTRIBUTOR","body":"This reproduces on master. Another way of looking at it is that a MLT document with an empty field will produce other documents with an empty field if it's a keyword type, but not if it's a text type.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384456735","html_url":"https://github.com/elastic/elasticsearch/issues/30148#issuecomment-384456735","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30148","id":384456735,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDQ1NjczNQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-25T22:42:28Z","updated_at":"2018-04-25T22:42:28Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384456890","html_url":"https://github.com/elastic/elasticsearch/issues/30148#issuecomment-384456890","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30148","id":384456890,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDQ1Njg5MA==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-04-25T22:43:15Z","updated_at":"2018-04-25T22:43:15Z","author_association":"CONTRIBUTOR","body":"I'm not sure if this would be considered a bug or just a difference in handling analyzed vs non analyzed fields, but either way it seems unintuitive","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384460641","html_url":"https://github.com/elastic/elasticsearch/issues/30148#issuecomment-384460641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30148","id":384460641,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDQ2MDY0MQ==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-04-25T23:03:06Z","updated_at":"2018-04-25T23:03:06Z","author_association":"CONTRIBUTOR","body":"It's probably also worth noting the MLT query produces an exception when the documents only have the empty field\r\n\r\n```\r\nPUT test\r\n{\r\n  \"settings\": {\r\n    \"number_of_shards\": 1,\r\n    \"number_of_replicas\": 0\r\n  }, \r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"nothing\": {\r\n          \"type\": \"text\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPOST /_bulk\r\n{ \"index\":  { \"_index\": \"test\", \"_type\": \"_doc\",\"_id\":1}}\r\n{\"nothing\": \"\"}\r\n{ \"index\":  { \"_index\": \"test\", \"_type\": \"_doc\",\"_id\":2}}\r\n{\"nothing\": \"\"}\r\n\r\nGET /_search\r\n{\r\n  \"query\": {\r\n    \"more_like_this\": {\r\n      \"fields\": [\r\n        \"nothing\"\r\n      ],\r\n      \"like\": [\r\n        {\r\n          \"_index\": \"test\",\r\n          \"_type\": \"_doc\",\r\n          \"_id\": \"1\"\r\n        }\r\n      ],\r\n      \"min_term_freq\": 1,\r\n      \"min_doc_freq\": 1\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n```\r\n[2018-04-25T15:57:19,682][DEBUG][o.e.a.t.TransportShardMultiTermsVectorAction] [DFW1LSW] [test][0] failed to execute multi term vectors for [_doc]/[1]\r\norg.elasticsearch.ElasticsearchException: failed to execute term vector request\r\n        at org.elasticsearch.index.termvectors.TermVectorsService.getTermVectors(TermVectorsService.java:150) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at org.elasticsearch.index.termvectors.TermVectorsService.getTermVectors(TermVectorsService.java:77) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at org.elasticsearch.action.termvectors.TransportShardMultiTermsVectorAction.shardOperation(TransportShardMultiTermsVectorAction.java:85) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at org.elasticsearch.action.termvectors.TransportShardMultiTermsVectorAction.shardOperation(TransportShardMultiTermsVectorAction.java:41) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at org.elasticsearch.action.support.single.shard.TransportSingleShardAction$1.doRun(TransportSingleShardAction.java:112) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:724) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) [?:?]\r\n        at java.lang.Thread.run(Thread.java:844) [?:?]\r\nCaused by: java.lang.NullPointerException\r\n        at org.elasticsearch.action.termvectors.TermVectorsWriter.setFields(TermVectorsWriter.java:82) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at org.elasticsearch.action.termvectors.TermVectorsResponse.setFields(TermVectorsResponse.java:361) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        at org.elasticsearch.index.termvectors.TermVectorsService.getTermVectors(TermVectorsService.java:146) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n        ... 9 more\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385964546","html_url":"https://github.com/elastic/elasticsearch/issues/30148#issuecomment-385964546","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30148","id":385964546,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTk2NDU0Ng==","user":{"login":"aditya-agrawal","id":8151605,"node_id":"MDQ6VXNlcjgxNTE2MDU=","avatar_url":"https://avatars3.githubusercontent.com/u/8151605?v=4","gravatar_id":"","url":"https://api.github.com/users/aditya-agrawal","html_url":"https://github.com/aditya-agrawal","followers_url":"https://api.github.com/users/aditya-agrawal/followers","following_url":"https://api.github.com/users/aditya-agrawal/following{/other_user}","gists_url":"https://api.github.com/users/aditya-agrawal/gists{/gist_id}","starred_url":"https://api.github.com/users/aditya-agrawal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aditya-agrawal/subscriptions","organizations_url":"https://api.github.com/users/aditya-agrawal/orgs","repos_url":"https://api.github.com/users/aditya-agrawal/repos","events_url":"https://api.github.com/users/aditya-agrawal/events{/privacy}","received_events_url":"https://api.github.com/users/aditya-agrawal/received_events","type":"User","site_admin":false},"created_at":"2018-05-02T12:43:19Z","updated_at":"2018-05-02T12:43:19Z","author_association":"CONTRIBUTOR","body":"Hello, Can I take up this bug? any pointers are much appreciated","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385994466","html_url":"https://github.com/elastic/elasticsearch/issues/30148#issuecomment-385994466","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30148","id":385994466,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTk5NDQ2Ng==","user":{"login":"aditya-agrawal","id":8151605,"node_id":"MDQ6VXNlcjgxNTE2MDU=","avatar_url":"https://avatars3.githubusercontent.com/u/8151605?v=4","gravatar_id":"","url":"https://api.github.com/users/aditya-agrawal","html_url":"https://github.com/aditya-agrawal","followers_url":"https://api.github.com/users/aditya-agrawal/followers","following_url":"https://api.github.com/users/aditya-agrawal/following{/other_user}","gists_url":"https://api.github.com/users/aditya-agrawal/gists{/gist_id}","starred_url":"https://api.github.com/users/aditya-agrawal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aditya-agrawal/subscriptions","organizations_url":"https://api.github.com/users/aditya-agrawal/orgs","repos_url":"https://api.github.com/users/aditya-agrawal/repos","events_url":"https://api.github.com/users/aditya-agrawal/events{/privacy}","received_events_url":"https://api.github.com/users/aditya-agrawal/received_events","type":"User","site_admin":false},"created_at":"2018-05-02T14:20:42Z","updated_at":"2018-05-02T14:20:42Z","author_association":"CONTRIBUTOR","body":"At this point -> \r\nhttps://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/action/termvectors/TermVectorsWriter.java#L69\r\n\r\nfieldTermVector is getting null. I initialized fieldTermVector with EMPTY_TERMS in case of null.\r\nThis solved both the above given issues. \r\nShould I go ahead and make PR for it?\r\n","performed_via_github_app":null}]