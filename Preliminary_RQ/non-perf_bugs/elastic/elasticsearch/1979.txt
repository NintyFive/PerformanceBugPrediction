{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1979","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1979/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1979/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1979/events","html_url":"https://github.com/elastic/elasticsearch/issues/1979","id":4753207,"node_id":"MDU6SXNzdWU0NzUzMjA3","number":1979,"title":"NumberFormatException when mixing string and integer fields in terms","user":{"login":"erikgrinaker","id":644420,"node_id":"MDQ6VXNlcjY0NDQyMA==","avatar_url":"https://avatars2.githubusercontent.com/u/644420?v=4","gravatar_id":"","url":"https://api.github.com/users/erikgrinaker","html_url":"https://github.com/erikgrinaker","followers_url":"https://api.github.com/users/erikgrinaker/followers","following_url":"https://api.github.com/users/erikgrinaker/following{/other_user}","gists_url":"https://api.github.com/users/erikgrinaker/gists{/gist_id}","starred_url":"https://api.github.com/users/erikgrinaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erikgrinaker/subscriptions","organizations_url":"https://api.github.com/users/erikgrinaker/orgs","repos_url":"https://api.github.com/users/erikgrinaker/repos","events_url":"https://api.github.com/users/erikgrinaker/events{/privacy}","received_events_url":"https://api.github.com/users/erikgrinaker/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2012-05-25T13:16:47Z","updated_at":"2012-05-30T14:51:38Z","closed_at":"2012-05-30T14:51:38Z","author_association":"NONE","active_lock_reason":null,"body":"The following works with 0.18.5, but gives a NumberFormatException with 0.19.4:\n\n`$ curl -XPOST localhost:9200/test -d '{\"mappings\": {\"test\": {\"propertes\": {\"text\": {\"type\": \"string\"}, \"number\": {\"type\": \"integer\"}}}}}'`\n\n`$ curl -XPUT localhost:9200/test/test/1'-d '{\"text\": \"a\", \"number\": 1}`\n\n`$ curl -XGET localhost:9200/test/test/_search?pretty=true -d '{\"query\":{\"query_string\":{\"query\":\"a\"}}, \"filter\":{\"terms\":{\"text\":[\"a\"], \"number\":[1]}}}'`\n\nError:\n\n{\n  \"error\" : \"SearchPhaseExecutionException[Failed to execute phase [query], total failure; shardFailures {[-3Fhl3bkQECOzrbQ1FuWvQ][test][1]: SearchParseException[[test][1]: query[],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"query_string\\\":{\\\"query\\\":\\\"a\\\"}}, \\\"filter\\\":{\\\"terms\\\":{\\\"text\\\":[\\\"a\\\"], \\\"number\\\":[1]}}}]]]; nested: NumberFormatException[For input string: \\\"a\\\"]; }{[-3Fhl3bkQECOzrbQ1FuWvQ][test][0]: SearchParseException[[test][0]: query[],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"query_string\\\":{\\\"query\\\":\\\"a\\\"}}, \\\"filter\\\":{\\\"terms\\\":{\\\"text\\\":[\\\"a\\\"], \\\"number\\\":[1]}}}]]]; nested: NumberFormatException[For input string: \\\"a\\\"]; }{[-3Fhl3bkQECOzrbQ1FuWvQ][test][4]: SearchParseException[[test][4]: query[],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"query_string\\\":{\\\"query\\\":\\\"a\\\"}}, \\\"filter\\\":{\\\"terms\\\":{\\\"text\\\":[\\\"a\\\"], \\\"number\\\":[1]}}}]]]; nested: NumberFormatException[For input string: \\\"a\\\"]; }{[-3Fhl3bkQECOzrbQ1FuWvQ][test][3]: SearchParseException[[test][3]: query[],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"query_string\\\":{\\\"query\\\":\\\"a\\\"}}, \\\"filter\\\":{\\\"terms\\\":{\\\"text\\\":[\\\"a\\\"], \\\"number\\\":[1]}}}]]]; nested: NumberFormatException[For input string: \\\"a\\\"]; }{[-3Fhl3bkQECOzrbQ1FuWvQ][test][2]: SearchParseException[[test][2]: query[],from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"query\\\":{\\\"query_string\\\":{\\\"query\\\":\\\"a\\\"}}, \\\"filter\\\":{\\\"terms\\\":{\\\"text\\\":[\\\"a\\\"], \\\"number\\\":[1]}}}]]]; nested: NumberFormatException[For input string: \\\"a\\\"]; }]\",\n  \"status\" : 500\n\nI don't see why this should cause a NumberFormatException, as the \"a\" string is explicitly used only with the \"text\" field. This breaks one of our applications (using the Tire gem), and prevents us from upgrading to 0.19. \n","closed_by":{"login":"erikgrinaker","id":644420,"node_id":"MDQ6VXNlcjY0NDQyMA==","avatar_url":"https://avatars2.githubusercontent.com/u/644420?v=4","gravatar_id":"","url":"https://api.github.com/users/erikgrinaker","html_url":"https://github.com/erikgrinaker","followers_url":"https://api.github.com/users/erikgrinaker/followers","following_url":"https://api.github.com/users/erikgrinaker/following{/other_user}","gists_url":"https://api.github.com/users/erikgrinaker/gists{/gist_id}","starred_url":"https://api.github.com/users/erikgrinaker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/erikgrinaker/subscriptions","organizations_url":"https://api.github.com/users/erikgrinaker/orgs","repos_url":"https://api.github.com/users/erikgrinaker/repos","events_url":"https://api.github.com/users/erikgrinaker/events{/privacy}","received_events_url":"https://api.github.com/users/erikgrinaker/received_events","type":"User","site_admin":false},"performed_via_github_app":null}