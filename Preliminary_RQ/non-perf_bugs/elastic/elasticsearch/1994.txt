{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1994","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1994/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1994/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1994/events","html_url":"https://github.com/elastic/elasticsearch/issues/1994","id":4843138,"node_id":"MDU6SXNzdWU0ODQzMTM4","number":1994,"title":"Highlight: field array concatenated when term_vector set to with_positions_offsets","user":{"login":"TwP","id":6323,"node_id":"MDQ6VXNlcjYzMjM=","avatar_url":"https://avatars0.githubusercontent.com/u/6323?v=4","gravatar_id":"","url":"https://api.github.com/users/TwP","html_url":"https://github.com/TwP","followers_url":"https://api.github.com/users/TwP/followers","following_url":"https://api.github.com/users/TwP/following{/other_user}","gists_url":"https://api.github.com/users/TwP/gists{/gist_id}","starred_url":"https://api.github.com/users/TwP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TwP/subscriptions","organizations_url":"https://api.github.com/users/TwP/orgs","repos_url":"https://api.github.com/users/TwP/repos","events_url":"https://api.github.com/users/TwP/events{/privacy}","received_events_url":"https://api.github.com/users/TwP/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2012-05-31T18:39:47Z","updated_at":"2012-12-07T18:54:55Z","closed_at":"2012-12-07T18:54:55Z","author_association":"NONE","active_lock_reason":null,"body":"Please take a look at issue #645 again. The erroneous behavior described there is still present in ElasticSearch v0.19.3\n\nI ran @lukas-vlcek script and the same erroneous behavior was observed. When `\"term_vector\" : \"with_positions_offsets\"` is used in the mapping, the highlighted fields are concatenated into a single string. This behavior differs from the case where term vectors are not used.\n\nI believe one bug was fixed. In the example from #645 the extra tag string `\"two wordish\"` was included in the highlight results. This bug is fixed in the case where term vectors are **not** being used for highlighting.\n\nHowever, when term vectors are enabled and the fast-vector-highlighter is used, all the highlight tags are concatenated together into a single string.\n\n```\n{\n  \"took\" : 3,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 0.16273327,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"one\",\n      \"_id\" : \"hx79P59ARRaOylM6yfYH2w\",\n      \"_score\" : 0.16273327, \"_source\" : { \"tags\" : [\"one word\",\"too wordish\",\"three words\"]},\n      \"highlight\" : {\n        \"tags\" : [ \"one <em>word</em> too wordish three <em>words</em>\" ]\n      }\n    } ]\n  }\n}\n```\n","closed_by":{"login":"TwP","id":6323,"node_id":"MDQ6VXNlcjYzMjM=","avatar_url":"https://avatars0.githubusercontent.com/u/6323?v=4","gravatar_id":"","url":"https://api.github.com/users/TwP","html_url":"https://github.com/TwP","followers_url":"https://api.github.com/users/TwP/followers","following_url":"https://api.github.com/users/TwP/following{/other_user}","gists_url":"https://api.github.com/users/TwP/gists{/gist_id}","starred_url":"https://api.github.com/users/TwP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TwP/subscriptions","organizations_url":"https://api.github.com/users/TwP/orgs","repos_url":"https://api.github.com/users/TwP/repos","events_url":"https://api.github.com/users/TwP/events{/privacy}","received_events_url":"https://api.github.com/users/TwP/received_events","type":"User","site_admin":false},"performed_via_github_app":null}