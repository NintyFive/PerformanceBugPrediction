[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50221948","html_url":"https://github.com/elastic/elasticsearch/issues/6939#issuecomment-50221948","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6939","id":50221948,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjIxOTQ4","user":{"login":"bobpaulin","id":1699558,"node_id":"MDQ6VXNlcjE2OTk1NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/1699558?v=4","gravatar_id":"","url":"https://api.github.com/users/bobpaulin","html_url":"https://github.com/bobpaulin","followers_url":"https://api.github.com/users/bobpaulin/followers","following_url":"https://api.github.com/users/bobpaulin/following{/other_user}","gists_url":"https://api.github.com/users/bobpaulin/gists{/gist_id}","starred_url":"https://api.github.com/users/bobpaulin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobpaulin/subscriptions","organizations_url":"https://api.github.com/users/bobpaulin/orgs","repos_url":"https://api.github.com/users/bobpaulin/repos","events_url":"https://api.github.com/users/bobpaulin/events{/privacy}","received_events_url":"https://api.github.com/users/bobpaulin/received_events","type":"User","site_admin":false},"created_at":"2014-07-26T03:25:27Z","updated_at":"2014-07-26T03:25:27Z","author_association":"NONE","body":"This also appears to be happening on the master branch.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/50247972","html_url":"https://github.com/elastic/elasticsearch/issues/6939#issuecomment-50247972","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6939","id":50247972,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjQ3OTcy","user":{"login":"bobpaulin","id":1699558,"node_id":"MDQ6VXNlcjE2OTk1NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/1699558?v=4","gravatar_id":"","url":"https://api.github.com/users/bobpaulin","html_url":"https://github.com/bobpaulin","followers_url":"https://api.github.com/users/bobpaulin/followers","following_url":"https://api.github.com/users/bobpaulin/following{/other_user}","gists_url":"https://api.github.com/users/bobpaulin/gists{/gist_id}","starred_url":"https://api.github.com/users/bobpaulin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobpaulin/subscriptions","organizations_url":"https://api.github.com/users/bobpaulin/orgs","repos_url":"https://api.github.com/users/bobpaulin/repos","events_url":"https://api.github.com/users/bobpaulin/events{/privacy}","received_events_url":"https://api.github.com/users/bobpaulin/received_events","type":"User","site_admin":false},"created_at":"2014-07-26T20:37:29Z","updated_at":"2014-07-26T20:37:29Z","author_association":"NONE","body":"Seems like it's blowing up since the geo_point is only parsing the first value instead of the 2 item array as a whole.  It works the second time through because the mapper object within org.elasticsearch.index.mapper.object.ObjectMapper.serializeArray caches location_array as a geo_point so the array logic properly pulls the mapper.  The first time through that entry is not there so the mapper comes up null and it tries to parse the array values individually. May I suggest adding some logic to the org.elasticsearch.index.mapper.object.ObjectMapper.serializeArray method to run the template builder logic to find the GeoMapper\n\n```\nprivate void serializeArray(ParseContext context, String lastFieldName) throws IOException {\n    String arrayFieldName = lastFieldName;\n    Mapper mapper = mappers.get(lastFieldName);\n    //Start Check TemplateBuilder for geo\n    if (mapper == null) {\n        BuilderContext builderContext = new BuilderContext(context.indexSettings(), context.path());\n        Mapper.Builder builder = context.root().findTemplateBuilder(context, arrayFieldName, \"geo_point\");\n        if (builder != null) {\n            mapper = builder.build(builderContext);\n            mappers.put(lastFieldName, mapper);\n        }\n    }\n    //End Check TemplateBuilder for geo\n    if (mapper != null && mapper instanceof ArrayValueMapperParser) {\n        mapper.parse(context);\n    } else {\n```\n","performed_via_github_app":null}]