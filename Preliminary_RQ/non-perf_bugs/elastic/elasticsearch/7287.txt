{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7287","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7287/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7287/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7287/events","html_url":"https://github.com/elastic/elasticsearch/issues/7287","id":40279274,"node_id":"MDU6SXNzdWU0MDI3OTI3NA==","number":7287,"title":"Add ability to log summary stats for search query with a request id","user":{"login":"srimaruti","id":8294065,"node_id":"MDQ6VXNlcjgyOTQwNjU=","avatar_url":"https://avatars3.githubusercontent.com/u/8294065?v=4","gravatar_id":"","url":"https://api.github.com/users/srimaruti","html_url":"https://github.com/srimaruti","followers_url":"https://api.github.com/users/srimaruti/followers","following_url":"https://api.github.com/users/srimaruti/following{/other_user}","gists_url":"https://api.github.com/users/srimaruti/gists{/gist_id}","starred_url":"https://api.github.com/users/srimaruti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/srimaruti/subscriptions","organizations_url":"https://api.github.com/users/srimaruti/orgs","repos_url":"https://api.github.com/users/srimaruti/repos","events_url":"https://api.github.com/users/srimaruti/events{/privacy}","received_events_url":"https://api.github.com/users/srimaruti/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-08-14T17:41:18Z","updated_at":"2014-12-30T20:31:03Z","closed_at":"2014-12-30T20:31:03Z","author_association":"NONE","active_lock_reason":null,"body":"In order to better maintain a elastic search cluster serving several multitenant clients and data load in petabytes scale and to improve search efficiency and indexing capabilities we need to have a historical timelapse view of the following\n\n1) What nodes and shards a particular query will span for gather phase or query phase or gather and query phase for a search query with a request id.\n\n2) The latency information at each shard for a search query with request id.\n\nThis information needs to be logged once in a precise and concise manner so that there wouldn't be too much logging overhead and it would also nicely group all the routing and latency information in one log message.\n\nExample logging for search request, for gather then fetch query call flow\n\n{\"requestId\":1,\"phaseOneTargetShards\":5,\"phaseOneLatencyMillis\":3,\"phaseOneStats\":[{\"shardId\":\"0\",\"nodeId\":\"37EAely-Tj2JUoShLvB45w\",\"latencyMillis\":2},{\"shardId\":\"2\",\"nodeId\":\"37EAely-Tj2JUoShLvB45w\",\"latencyMillis\":2},{\"shardId\":\"1\",\"nodeId\":\"37EAely-Tj2JUoShLvB45w\",\"latencyMillis\":3},{\"shardId\":\"3\",\"nodeId\":\"37EAely-Tj2JUoShLvB45w\",\"latencyMillis\":2},{\"shardId\":\"4\",\"nodeId\":\"37EAely-Tj2JUoShLvB45w\",\"latencyMillis\":3}],\"phaseTwoTargetShards\":1,\"phaseTwoLatencyMillis\":1407746692060,\"phaseTwoStats\":[{\"shardId\":\"1\",\"nodeId\":\"37EAely-Tj2JUoShLvB45w\",\"latencyMillis\":1}]}\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}