{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37909","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37909/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37909/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37909/events","html_url":"https://github.com/elastic/elasticsearch/issues/37909","id":403734424,"node_id":"MDU6SXNzdWU0MDM3MzQ0MjQ=","number":37909,"title":"GeoIP injected fields no longer referable by subsequent processors as of 6.5.0 ","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-01-28T10:06:09Z","updated_at":"2019-01-29T09:04:39Z","closed_at":"2019-01-29T09:04:38Z","author_association":"MEMBER","active_lock_reason":null,"body":"As of `6.5.0` the `rename` processor complains about fields injected by the `geoip` processor.\r\n\r\n> field [leadDeveloper.geoIp.city_name] doesn't exist\r\n\r\nPossibly relates to either:\r\n- https://github.com/elastic/elasticsearch/pull/33029/files\r\n- https://github.com/elastic/elasticsearch/pull/33840/files\r\n\r\nGiven the following pipeline:\r\n\r\n```\r\nPUT http://127.0.0.1:9200/_ingest/pipeline/pipeline-33a33a6c HTTP/1.1\r\nAccept: application/json\r\nContent-Type: application/json\r\nContent-Length: 942\r\nHost: 127.0.0.1:9200\r\n\r\n{\r\n  \"description\": \"Index pipeline test\",\r\n  \"processors\": [\r\n    {\r\n      \"rename\": {\r\n        \"field\": \"lastActivity\",\r\n        \"target_field\": \"lastSeen\"\r\n      }\r\n    },\r\n    {\r\n      \"geoip\": {\r\n        \"field\": \"leadDeveloper.ipAddress\",\r\n        \"target_field\": \"leadDeveloper.geoIp\"\r\n      }\r\n    },\r\n    {\r\n      \"rename\": {\r\n        \"field\": \"leadDeveloper.geoIp.continent_name\",\r\n        \"target_field\": \"leadDeveloper.geoIp.continentName\"\r\n      }\r\n    },\r\n    {\r\n      \"rename\": {\r\n        \"field\": \"leadDeveloper.geoIp.city_name\",\r\n        \"target_field\": \"leadDeveloper.geoIp.cityName\"\r\n      }\r\n    },\r\n    {\r\n      \"rename\": {\r\n        \"field\": \"leadDeveloper.geoIp.country_iso_code\",\r\n        \"target_field\": \"leadDeveloper.geoIp.countryIsoCode\"\r\n      }\r\n    },\r\n    {\r\n      \"rename\": {\r\n        \"field\": \"leadDeveloper.geoIp.region_name\",\r\n        \"target_field\": \"leadDeveloper.geoIp.regionName\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nSending the following on 6.4.0:\r\n\r\n```json\r\nPUT http://127.0.0.1:9200/project/doc/nest-fluent-42f26033?pretty=true&error_trace=true&routing=nest-fluent-42f26033&refresh=true&pipeline=pipeline-33a33a6c HTTP/1.1\r\nAccept: application/json\r\nContent-Type: application/json\r\nContent-Length: 451\r\nHost: 127.0.0.1:9200\r\n\r\n{\r\n  \"curatedTags\": [\r\n    {\r\n      \"added\": \"2015-06-06T12:01:02.123\",\r\n      \"name\": \"x\"\r\n    }\r\n  ],\r\n  \"join\": \"project\",\r\n  \"lastActivity\": \"2015-06-06T12:01:02.123\",\r\n  \"leadDeveloper\": {\r\n    \"ipAddress\": \"193.4.250.122\",\r\n    \"id\": 1\r\n  },\r\n  \"name\": \"nest-fluent-42f26033\",\r\n  \"numberOfContributors\": 0,\r\n  \"startedOn\": \"2015-06-06T12:01:02.123\",\r\n  \"state\": \"Stable\",\r\n  \"type\": \"project\",\r\n  \"visibility\": \"Public\"\r\n}\r\n```\r\n\r\nreturns:\r\n\r\n```json\r\nHTTP/1.1 201 Created\r\nLocation: /project/doc/nest-fluent-42f26033?routing=nest-fluent-42f26033\r\nWarning: 299 Elasticsearch-6.4.0-595516e \"the default number of shards will change from [5] to [1] in 7.0.0; if you wish to continue using the default of [5] shards, you must manage this on the create index request or with an index template\" \"Mon, 28 Jan 2019 09:53:27 GMT\"\r\ncontent-type: application/json; charset=UTF-8\r\ncontent-length: 266\r\n\r\n{\r\n  \"_index\" : \"project\",\r\n  \"_type\" : \"doc\",\r\n  \"_id\" : \"nest-fluent-42f26033\",\r\n  \"_version\" : 1,\r\n  \"result\" : \"created\",\r\n  \"forced_refresh\" : true,\r\n  \"_shards\" : {\r\n    \"total\" : 2,\r\n    \"successful\" : 1,\r\n    \"failed\" : 0\r\n  },\r\n  \"_seq_no\" : 0,\r\n  \"_primary_term\" : 1\r\n}\r\n```\r\n\r\nas of `6.5.0` this now returns:\r\n\r\n```json\r\nHTTP/1.1 500 Internal Server Error\r\nprocessor_type: rename\r\nWarning: 299 Elasticsearch-6.5.3-159a78a \"the default number of shards will change from [5] to [1] in 7.0.0; if you wish to continue using the default of [5] shards, you must manage this on the create index request or with an index template\" \"Mon, 28 Jan 2019 09:59:24 GMT\"\r\ncontent-type: application/json; charset=UTF-8\r\ncontent-length: 7036\r\n\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"exception\",\r\n        \"reason\" : \"java.lang.IllegalArgumentException: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\",\r\n        \"header\" : {\r\n          \"processor_type\" : \"rename\"\r\n        },\r\n        \"stack_trace\" : \"ElasticsearchException[java.lang.IllegalArgumentException: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist]; nested: IllegalArgumentException[java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist]; nested: IllegalArgumentException[field [leadDeveloper.geoIp.city_name] doesn't exist];\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.newCompoundProcessorException(CompoundProcessor.java:188)\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.execute(CompoundProcessor.java:134)\\r\\n\\tat org.elasticsearch.ingest.Pipeline.execute(Pipeline.java:97)\\r\\n\\tat org.elasticsearch.ingest.IngestService.innerExecute(IngestService.java:479)\\r\\n\\tat org.elasticsearch.ingest.IngestService.access$100(IngestService.java:68)\\r\\n\\tat org.elasticsearch.ingest.IngestService$4.doRun(IngestService.java:408)\\r\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723)\\r\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\r\\n\\tat java.base/java.lang.Thread.run(Thread.java:834)\\r\\nCaused by: java.lang.IllegalArgumentException: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\\r\\n\\t... 11 more\\r\\nCaused by: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\\r\\n\\tat org.elasticsearch.ingest.common.RenameProcessor.execute(RenameProcessor.java:68)\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.execute(CompoundProcessor.java:124)\\r\\n\\t... 9 more\\r\\n\"\r\n      }\r\n    ],\r\n    \"type\" : \"exception\",\r\n    \"reason\" : \"java.lang.IllegalArgumentException: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\",\r\n    \"caused_by\" : {\r\n      \"type\" : \"illegal_argument_exception\",\r\n      \"reason\" : \"java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\",\r\n      \"caused_by\" : {\r\n        \"type\" : \"illegal_argument_exception\",\r\n        \"reason\" : \"field [leadDeveloper.geoIp.city_name] doesn't exist\",\r\n        \"stack_trace\" : \"java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\\r\\n\\tat org.elasticsearch.ingest.common.RenameProcessor.execute(RenameProcessor.java:68)\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.execute(CompoundProcessor.java:124)\\r\\n\\tat org.elasticsearch.ingest.Pipeline.execute(Pipeline.java:97)\\r\\n\\tat org.elasticsearch.ingest.IngestService.innerExecute(IngestService.java:479)\\r\\n\\tat org.elasticsearch.ingest.IngestService.access$100(IngestService.java:68)\\r\\n\\tat org.elasticsearch.ingest.IngestService$4.doRun(IngestService.java:408)\\r\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723)\\r\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\r\\n\\tat java.base/java.lang.Thread.run(Thread.java:834)\\r\\n\"\r\n      },\r\n      \"stack_trace\" : \"java.lang.IllegalArgumentException: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.newCompoundProcessorException(CompoundProcessor.java:188)\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.execute(CompoundProcessor.java:134)\\r\\n\\tat org.elasticsearch.ingest.Pipeline.execute(Pipeline.java:97)\\r\\n\\tat org.elasticsearch.ingest.IngestService.innerExecute(IngestService.java:479)\\r\\n\\tat org.elasticsearch.ingest.IngestService.access$100(IngestService.java:68)\\r\\n\\tat org.elasticsearch.ingest.IngestService$4.doRun(IngestService.java:408)\\r\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723)\\r\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\r\\n\\tat java.base/java.lang.Thread.run(Thread.java:834)\\r\\nCaused by: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\\r\\n\\tat org.elasticsearch.ingest.common.RenameProcessor.execute(RenameProcessor.java:68)\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.execute(CompoundProcessor.java:124)\\r\\n\\t... 9 more\\r\\n\"\r\n    },\r\n    \"header\" : {\r\n      \"processor_type\" : \"rename\"\r\n    },\r\n    \"stack_trace\" : \"ElasticsearchException[java.lang.IllegalArgumentException: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist]; nested: IllegalArgumentException[java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist]; nested: IllegalArgumentException[field [leadDeveloper.geoIp.city_name] doesn't exist];\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.newCompoundProcessorException(CompoundProcessor.java:188)\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.execute(CompoundProcessor.java:134)\\r\\n\\tat org.elasticsearch.ingest.Pipeline.execute(Pipeline.java:97)\\r\\n\\tat org.elasticsearch.ingest.IngestService.innerExecute(IngestService.java:479)\\r\\n\\tat org.elasticsearch.ingest.IngestService.access$100(IngestService.java:68)\\r\\n\\tat org.elasticsearch.ingest.IngestService$4.doRun(IngestService.java:408)\\r\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723)\\r\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\r\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\r\\n\\tat java.base/java.lang.Thread.run(Thread.java:834)\\r\\nCaused by: java.lang.IllegalArgumentException: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\\r\\n\\t... 11 more\\r\\nCaused by: java.lang.IllegalArgumentException: field [leadDeveloper.geoIp.city_name] doesn't exist\\r\\n\\tat org.elasticsearch.ingest.common.RenameProcessor.execute(RenameProcessor.java:68)\\r\\n\\tat org.elasticsearch.ingest.CompoundProcessor.execute(CompoundProcessor.java:124)\\r\\n\\t... 9 more\\r\\n\"\r\n  },\r\n  \"status\" : 500\r\n}\r\n```\r\n\r\ngiven the following index operation:\r\n\r\n```json\r\nPUT http://127.0.0.1:9200/project/doc/nest-fluent-ef0c8aa6?pretty=true&error_trace=true&routing=nest-fluent-ef0c8aa6&refresh=true&pipeline=pipeline-8da9cd6e HTTP/1.1\r\nAccept: application/json\r\nContent-Type: application/json\r\nContent-Length: 451\r\nHost: 127.0.0.1:9200\r\n\r\n{\r\n  \"curatedTags\": [\r\n    {\r\n      \"added\": \"2015-06-06T12:01:02.123\",\r\n      \"name\": \"x\"\r\n    }\r\n  ],\r\n  \"join\": \"project\",\r\n  \"lastActivity\": \"2015-06-06T12:01:02.123\",\r\n  \"leadDeveloper\": {\r\n    \"ipAddress\": \"193.4.250.122\",\r\n    \"id\": 1\r\n  },\r\n  \"name\": \"nest-fluent-ef0c8aa6\",\r\n  \"numberOfContributors\": 0,\r\n  \"startedOn\": \"2015-06-06T12:01:02.123\",\r\n  \"state\": \"Stable\",\r\n  \"type\": \"project\",\r\n  \"visibility\": \"Public\"\r\n}\r\n```\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}