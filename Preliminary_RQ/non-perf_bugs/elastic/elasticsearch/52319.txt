{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52319","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52319/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52319/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52319/events","html_url":"https://github.com/elastic/elasticsearch/issues/52319","id":564681686,"node_id":"MDU6SXNzdWU1NjQ2ODE2ODY=","number":52319,"title":"GCS SDK does not resume downloads that fail part-way through","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-02-13T13:26:58Z","updated_at":"2020-02-19T15:11:52Z","closed_at":"2020-02-19T15:11:52Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"A connection dropped part-way through the download of a blob from GCS is not today considered retryable by the SDK, so a restore from GCS over a flaky connection may fail and need to be retried from the beginning.\r\n\r\nI've seen two different (but related) exceptions:\r\n\r\n<details><p>\r\n\r\n```\r\n[2020-02-13T12:10:57,150][WARN ][o.e.c.r.a.AllocationService] [elasticsearch-2] failing shard [failed shard, shard [elasticlogs-2018-05-13][0], node[d2sAR621RziQbILiZMBvfg], [P], recovery_source[snapshot recovery [iJoJDpgyR9GjOYO1enQmjQ] from small_logging_cluster:snapshot_80gb/fioJzVMyTcKPCRdfN5lZ7w], s[INITIALIZING], a[id=hi-CTSfzRliMbh3ajtzVVg], unassigned_info[[reason=NEW_INDEX_RESTORED], at[2020-02-13T11:22:30.460Z], delayed=false, details[restore_source[small_logging_cluster/snapshot_80gb]], allocation_status[deciders_throttled]], message [failed recovery], failure [RecoveryFailedException[[elasticlogs-2018-05-13][0]: Recovery failed on {elasticsearch-1}{d2sAR621RziQbILiZMBvfg}{cgzSxj1tSjawYThZfSEXpQ}{10.10.9.72}{10.10.9.72:9300}{dim}{xpack.installed=true}]; nested: IndexShardRecoveryException[failed recovery]; nested: IndexShardRestoreFailedException[restore failed]; nested: IndexShardRestoreFailedException[failed to restore snapshot [snapshot_80gb/fioJzVMyTcKPCRdfN5lZ7w]]; nested: NotSerializableExceptionWrapper[storage_exception: Connection reset]; nested: IOException[Connection reset]; nested: IOException[Connection reset]; ], markAsStale [true]]\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [elasticlogs-2018-05-13][0]: Recovery failed on {elasticsearch-1}{d2sAR621RziQbILiZMBvfg}{cgzSxj1tSjawYThZfSEXpQ}{10.10.9.72}{10.10.9.72:9300}{dim}{xpack.installed=true}\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2584) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:703) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:830) [?:?]\r\nCaused by: org.elasticsearch.index.shard.IndexShardRecoveryException: failed recovery\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:353) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\nCaused by: org.elasticsearch.index.snapshots.IndexShardRestoreFailedException: restore failed\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:480) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\nCaused by: org.elasticsearch.index.snapshots.IndexShardRestoreFailedException: failed to restore snapshot [snapshot_80gb/fioJzVMyTcKPCRdfN5lZ7w]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1255) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\nCaused by: org.elasticsearch.common.io.stream.NotSerializableExceptionWrapper: storage_exception: Connection reset\r\n\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.translate(HttpStorageRpc.java:227) ~[?:?]\r\n\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:690) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124) ~[?:?]\r\n\tat com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.run(RetryHelper.java:76) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.lambda$read$0(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:554) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.SocketAccess.doPrivilegedIOException(SocketAccess.java:44) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.read(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103) ~[?:?]\r\n\tat org.elasticsearch.index.snapshots.blobstore.SlicedInputStream.read(SlicedInputStream.java:92) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.io.InputStream.read(InputStream.java:213) ~[?:?]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFile(FileRestoreContext.java:240) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFiles(FileRestoreContext.java:217) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restore(FileRestoreContext.java:180) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1253) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\nCaused by: java.io.IOException: Connection reset\r\n\tat sun.security.ssl.Alert.createSSLException(Alert.java:127) ~[?:?]\r\n\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:324) ~[?:?]\r\n\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:267) ~[?:?]\r\n\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:262) ~[?:?]\r\n\tat sun.security.ssl.SSLTransport.decode(SSLTransport.java:137) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1463) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1431) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1022) ~[?:?]\r\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:245) ~[?:?]\r\n\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:285) ~[?:?]\r\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:344) ~[?:?]\r\n\tat sun.net.www.MeteredStream.read(MeteredStream.java:134) ~[?:?]\r\n\tat java.io.FilterInputStream.read(FilterInputStream.java:133) ~[?:?]\r\n\tat sun.net.www.protocol.http.HttpURLConnection$HttpInputStream.read(HttpURLConnection.java:3505) ~[?:?]\r\n\tat com.google.api.client.http.javanet.NetHttpResponse$SizeValidatingInputStream.read(NetHttpResponse.java:164) ~[?:?]\r\n\tat java.io.FilterInputStream.read(FilterInputStream.java:107) ~[?:?]\r\n\tat com.google.api.client.util.ByteStreams.copy(ByteStreams.java:49) ~[?:?]\r\n\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:87) ~[?:?]\r\n\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:59) ~[?:?]\r\n\tat com.google.api.client.http.HttpResponse.download(HttpResponse.java:386) ~[?:?]\r\n\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:684) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124) ~[?:?]\r\n\tat com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.run(RetryHelper.java:76) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.lambda$read$0(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:554) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.SocketAccess.doPrivilegedIOException(SocketAccess.java:44) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.read(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103) ~[?:?]\r\n\tat org.elasticsearch.index.snapshots.blobstore.SlicedInputStream.read(SlicedInputStream.java:92) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.io.InputStream.read(InputStream.java:213) ~[?:?]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFile(FileRestoreContext.java:240) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFiles(FileRestoreContext.java:217) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restore(FileRestoreContext.java:180) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1253) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\n\tSuppressed: java.io.IOException: Broken pipe\r\n\t\tat sun.nio.ch.NioSocketImpl.implWrite(NioSocketImpl.java:421) ~[?:?]\r\n\t\tat sun.nio.ch.NioSocketImpl.write(NioSocketImpl.java:441) ~[?:?]\r\n\t\tat sun.nio.ch.NioSocketImpl$2.write(NioSocketImpl.java:825) ~[?:?]\r\n\t\tat java.net.Socket$SocketOutputStream.write(Socket.java:1007) ~[?:?]\r\n\t\tat sun.security.ssl.SSLSocketOutputRecord.encodeAlert(SSLSocketOutputRecord.java:82) ~[?:?]\r\n\t\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:355) ~[?:?]\r\n\t\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:267) ~[?:?]\r\n\t\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:262) ~[?:?]\r\n\t\tat sun.security.ssl.SSLTransport.decode(SSLTransport.java:137) ~[?:?]\r\n\t\tat sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1463) ~[?:?]\r\n\t\tat sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1431) ~[?:?]\r\n\t\tat sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1022) ~[?:?]\r\n\t\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:245) ~[?:?]\r\n\t\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:285) ~[?:?]\r\n\t\tat java.io.BufferedInputStream.read(BufferedInputStream.java:344) ~[?:?]\r\n\t\tat sun.net.www.MeteredStream.read(MeteredStream.java:134) ~[?:?]\r\n\t\tat java.io.FilterInputStream.read(FilterInputStream.java:133) ~[?:?]\r\n\t\tat sun.net.www.protocol.http.HttpURLConnection$HttpInputStream.read(HttpURLConnection.java:3505) ~[?:?]\r\n\t\tat com.google.api.client.http.javanet.NetHttpResponse$SizeValidatingInputStream.read(NetHttpResponse.java:164) ~[?:?]\r\n\t\tat java.io.FilterInputStream.read(FilterInputStream.java:107) ~[?:?]\r\n\t\tat com.google.api.client.util.ByteStreams.copy(ByteStreams.java:49) ~[?:?]\r\n\t\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:87) ~[?:?]\r\n\t\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:59) ~[?:?]\r\n\t\tat com.google.api.client.http.HttpResponse.download(HttpResponse.java:386) ~[?:?]\r\n\t\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:684) ~[?:?]\r\n\t\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127) ~[?:?]\r\n\t\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124) ~[?:?]\r\n\t\tat com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105) ~[?:?]\r\n\t\tat com.google.cloud.RetryHelper.run(RetryHelper.java:76) ~[?:?]\r\n\t\tat com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50) ~[?:?]\r\n\t\tat com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123) ~[?:?]\r\n\t\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.lambda$read$0(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\t\tat java.security.AccessController.doPrivileged(AccessController.java:554) ~[?:?]\r\n\t\tat org.elasticsearch.repositories.gcs.SocketAccess.doPrivilegedIOException(SocketAccess.java:44) ~[?:?]\r\n\t\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.read(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\t\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65) ~[?:?]\r\n\t\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109) ~[?:?]\r\n\t\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103) ~[?:?]\r\n\t\tat org.elasticsearch.index.snapshots.blobstore.SlicedInputStream.read(SlicedInputStream.java:92) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat java.io.InputStream.read(InputStream.java:213) ~[?:?]\r\n\t\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFile(FileRestoreContext.java:240) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFiles(FileRestoreContext.java:217) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restore(FileRestoreContext.java:180) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1253) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:703) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\t\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\t\tat java.lang.Thread.run(Thread.java:830) [?:?]\r\nCaused by: java.io.IOException: Connection reset\r\n\tat sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:324) ~[?:?]\r\n\tat sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:351) ~[?:?]\r\n\tat sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:802) ~[?:?]\r\n\tat java.net.Socket$SocketInputStream.read(Socket.java:937) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:450) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketInputRecord.decodeInputRecord(SSLSocketInputRecord.java:237) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketInputRecord.decode(SSLSocketInputRecord.java:190) ~[?:?]\r\n\tat sun.security.ssl.SSLTransport.decode(SSLTransport.java:108) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1463) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1431) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1022) ~[?:?]\r\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:245) ~[?:?]\r\n\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:285) ~[?:?]\r\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:344) ~[?:?]\r\n\tat sun.net.www.MeteredStream.read(MeteredStream.java:134) ~[?:?]\r\n\tat java.io.FilterInputStream.read(FilterInputStream.java:133) ~[?:?]\r\n\tat sun.net.www.protocol.http.HttpURLConnection$HttpInputStream.read(HttpURLConnection.java:3505) ~[?:?]\r\n\tat com.google.api.client.http.javanet.NetHttpResponse$SizeValidatingInputStream.read(NetHttpResponse.java:164) ~[?:?]\r\n\tat java.io.FilterInputStream.read(FilterInputStream.java:107) ~[?:?]\r\n\tat com.google.api.client.util.ByteStreams.copy(ByteStreams.java:49) ~[?:?]\r\n\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:87) ~[?:?]\r\n\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:59) ~[?:?]\r\n\tat com.google.api.client.http.HttpResponse.download(HttpResponse.java:386) ~[?:?]\r\n\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:684) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124) ~[?:?]\r\n\tat com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.run(RetryHelper.java:76) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.lambda$read$0(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:554) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.SocketAccess.doPrivilegedIOException(SocketAccess.java:44) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.read(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103) ~[?:?]\r\n\tat org.elasticsearch.index.snapshots.blobstore.SlicedInputStream.read(SlicedInputStream.java:92) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.io.InputStream.read(InputStream.java:213) ~[?:?]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFile(FileRestoreContext.java:240) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFiles(FileRestoreContext.java:217) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restore(FileRestoreContext.java:180) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1253) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\n[2020-02-13T12:10:57,130][WARN ][o.e.i.c.IndicesClusterStateService] [elasticsearch-1] [elasticlogs-2018-05-13][0] marking and sending shard failed due to [failed recovery]\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [elasticlogs-2018-05-13][0]: Recovery failed on {elasticsearch-1}{d2sAR621RziQbILiZMBvfg}{cgzSxj1tSjawYThZfSEXpQ}{10.10.9.72}{10.10.9.72:9300}{dim}{xpack.installed=true}\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2584) [elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:703) [elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:830) [?:?]\r\nCaused by: org.elasticsearch.index.shard.IndexShardRecoveryException: failed recovery\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:353) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\nCaused by: org.elasticsearch.index.snapshots.IndexShardRestoreFailedException: restore failed\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:480) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\nCaused by: org.elasticsearch.index.snapshots.IndexShardRestoreFailedException: failed to restore snapshot [snapshot_80gb/fioJzVMyTcKPCRdfN5lZ7w]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1255) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\nCaused by: com.google.cloud.storage.StorageException: Connection reset\r\n\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.translate(HttpStorageRpc.java:227) ~[?:?]\r\n\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:690) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124) ~[?:?]\r\n\tat com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.run(RetryHelper.java:76) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.lambda$read$0(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:554) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.SocketAccess.doPrivilegedIOException(SocketAccess.java:44) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.read(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103) ~[?:?]\r\n\tat org.elasticsearch.index.snapshots.blobstore.SlicedInputStream.read(SlicedInputStream.java:92) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.io.InputStream.read(InputStream.java:213) ~[?:?]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFile(FileRestoreContext.java:240) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFiles(FileRestoreContext.java:217) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restore(FileRestoreContext.java:180) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1253) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\nCaused by: javax.net.ssl.SSLException: Connection reset\r\n\tat sun.security.ssl.Alert.createSSLException(Alert.java:127) ~[?:?]\r\n\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:324) ~[?:?]\r\n\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:267) ~[?:?]\r\n\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:262) ~[?:?]\r\n\tat sun.security.ssl.SSLTransport.decode(SSLTransport.java:137) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1463) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1431) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1022) ~[?:?]\r\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:245) ~[?:?]\r\n\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:285) ~[?:?]\r\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:344) ~[?:?]\r\n\tat sun.net.www.MeteredStream.read(MeteredStream.java:134) ~[?:?]\r\n\tat java.io.FilterInputStream.read(FilterInputStream.java:133) ~[?:?]\r\n\tat sun.net.www.protocol.http.HttpURLConnection$HttpInputStream.read(HttpURLConnection.java:3505) ~[?:?]\r\n\tat com.google.api.client.http.javanet.NetHttpResponse$SizeValidatingInputStream.read(NetHttpResponse.java:164) ~[?:?]\r\n\tat java.io.FilterInputStream.read(FilterInputStream.java:107) ~[?:?]\r\n\tat com.google.api.client.util.ByteStreams.copy(ByteStreams.java:49) ~[?:?]\r\n\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:87) ~[?:?]\r\n\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:59) ~[?:?]\r\n\tat com.google.api.client.http.HttpResponse.download(HttpResponse.java:386) ~[?:?]\r\n\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:684) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124) ~[?:?]\r\n\tat com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.run(RetryHelper.java:76) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.lambda$read$0(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:554) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.SocketAccess.doPrivilegedIOException(SocketAccess.java:44) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.read(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103) ~[?:?]\r\n\tat org.elasticsearch.index.snapshots.blobstore.SlicedInputStream.read(SlicedInputStream.java:92) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.io.InputStream.read(InputStream.java:213) ~[?:?]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFile(FileRestoreContext.java:240) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFiles(FileRestoreContext.java:217) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restore(FileRestoreContext.java:180) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1253) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\n\tSuppressed: java.net.SocketException: Broken pipe\r\n\t\tat sun.nio.ch.NioSocketImpl.implWrite(NioSocketImpl.java:421) ~[?:?]\r\n\t\tat sun.nio.ch.NioSocketImpl.write(NioSocketImpl.java:441) ~[?:?]\r\n\t\tat sun.nio.ch.NioSocketImpl$2.write(NioSocketImpl.java:825) ~[?:?]\r\n\t\tat java.net.Socket$SocketOutputStream.write(Socket.java:1007) ~[?:?]\r\n\t\tat sun.security.ssl.SSLSocketOutputRecord.encodeAlert(SSLSocketOutputRecord.java:82) ~[?:?]\r\n\t\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:355) ~[?:?]\r\n\t\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:267) ~[?:?]\r\n\t\tat sun.security.ssl.TransportContext.fatal(TransportContext.java:262) ~[?:?]\r\n\t\tat sun.security.ssl.SSLTransport.decode(SSLTransport.java:137) ~[?:?]\r\n\t\tat sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1463) ~[?:?]\r\n\t\tat sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1431) ~[?:?]\r\n\t\tat sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1022) ~[?:?]\r\n\t\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:245) ~[?:?]\r\n\t\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:285) ~[?:?]\r\n\t\tat java.io.BufferedInputStream.read(BufferedInputStream.java:344) ~[?:?]\r\n\t\tat sun.net.www.MeteredStream.read(MeteredStream.java:134) ~[?:?]\r\n\t\tat java.io.FilterInputStream.read(FilterInputStream.java:133) ~[?:?]\r\n\t\tat sun.net.www.protocol.http.HttpURLConnection$HttpInputStream.read(HttpURLConnection.java:3505) ~[?:?]\r\n\t\tat com.google.api.client.http.javanet.NetHttpResponse$SizeValidatingInputStream.read(NetHttpResponse.java:164) ~[?:?]\r\n\t\tat java.io.FilterInputStream.read(FilterInputStream.java:107) ~[?:?]\r\n\t\tat com.google.api.client.util.ByteStreams.copy(ByteStreams.java:49) ~[?:?]\r\n\t\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:87) ~[?:?]\r\n\t\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:59) ~[?:?]\r\n\t\tat com.google.api.client.http.HttpResponse.download(HttpResponse.java:386) ~[?:?]\r\n\t\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:684) ~[?:?]\r\n\t\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127) ~[?:?]\r\n\t\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124) ~[?:?]\r\n\t\tat com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105) ~[?:?]\r\n\t\tat com.google.cloud.RetryHelper.run(RetryHelper.java:76) ~[?:?]\r\n\t\tat com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50) ~[?:?]\r\n\t\tat com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123) ~[?:?]\r\n\t\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.lambda$read$0(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\t\tat java.security.AccessController.doPrivileged(AccessController.java:554) ~[?:?]\r\n\t\tat org.elasticsearch.repositories.gcs.SocketAccess.doPrivilegedIOException(SocketAccess.java:44) ~[?:?]\r\n\t\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.read(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\t\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65) ~[?:?]\r\n\t\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109) ~[?:?]\r\n\t\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103) ~[?:?]\r\n\t\tat org.elasticsearch.index.snapshots.blobstore.SlicedInputStream.read(SlicedInputStream.java:92) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat java.io.InputStream.read(InputStream.java:213) ~[?:?]\r\n\t\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFile(FileRestoreContext.java:240) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFiles(FileRestoreContext.java:217) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restore(FileRestoreContext.java:180) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1253) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) [elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:703) [elasticsearch-7.5.1.jar:7.5.1]\r\n\t\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\t\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\t\tat java.lang.Thread.run(Thread.java:830) [?:?]\r\nCaused by: java.net.SocketException: Connection reset\r\n\tat sun.nio.ch.NioSocketImpl.implRead(NioSocketImpl.java:324) ~[?:?]\r\n\tat sun.nio.ch.NioSocketImpl.read(NioSocketImpl.java:351) ~[?:?]\r\n\tat sun.nio.ch.NioSocketImpl$1.read(NioSocketImpl.java:802) ~[?:?]\r\n\tat java.net.Socket$SocketInputStream.read(Socket.java:937) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketInputRecord.read(SSLSocketInputRecord.java:450) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketInputRecord.decodeInputRecord(SSLSocketInputRecord.java:237) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketInputRecord.decode(SSLSocketInputRecord.java:190) ~[?:?]\r\n\tat sun.security.ssl.SSLTransport.decode(SSLTransport.java:108) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1463) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl.readApplicationRecord(SSLSocketImpl.java:1431) ~[?:?]\r\n\tat sun.security.ssl.SSLSocketImpl$AppInputStream.read(SSLSocketImpl.java:1022) ~[?:?]\r\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:245) ~[?:?]\r\n\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:285) ~[?:?]\r\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:344) ~[?:?]\r\n\tat sun.net.www.MeteredStream.read(MeteredStream.java:134) ~[?:?]\r\n\tat java.io.FilterInputStream.read(FilterInputStream.java:133) ~[?:?]\r\n\tat sun.net.www.protocol.http.HttpURLConnection$HttpInputStream.read(HttpURLConnection.java:3505) ~[?:?]\r\n\tat com.google.api.client.http.javanet.NetHttpResponse$SizeValidatingInputStream.read(NetHttpResponse.java:164) ~[?:?]\r\n\tat java.io.FilterInputStream.read(FilterInputStream.java:107) ~[?:?]\r\n\tat com.google.api.client.util.ByteStreams.copy(ByteStreams.java:49) ~[?:?]\r\n\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:87) ~[?:?]\r\n\tat com.google.api.client.util.IOUtils.copy(IOUtils.java:59) ~[?:?]\r\n\tat com.google.api.client.http.HttpResponse.download(HttpResponse.java:386) ~[?:?]\r\n\tat com.google.cloud.storage.spi.v1.HttpStorageRpc.read(HttpStorageRpc.java:684) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:127) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel$1.call(BlobReadChannel.java:124) ~[?:?]\r\n\tat com.google.api.gax.retrying.DirectRetryingExecutor.submit(DirectRetryingExecutor.java:105) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.run(RetryHelper.java:76) ~[?:?]\r\n\tat com.google.cloud.RetryHelper.runWithRetries(RetryHelper.java:50) ~[?:?]\r\n\tat com.google.cloud.storage.BlobReadChannel.read(BlobReadChannel.java:123) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.lambda$read$0(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat java.security.AccessController.doPrivileged(AccessController.java:554) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.SocketAccess.doPrivilegedIOException(SocketAccess.java:44) ~[?:?]\r\n\tat org.elasticsearch.repositories.gcs.GoogleCloudStorageBlobStore$1.read(GoogleCloudStorageBlobStore.java:189) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:65) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:109) ~[?:?]\r\n\tat sun.nio.ch.ChannelInputStream.read(ChannelInputStream.java:103) ~[?:?]\r\n\tat org.elasticsearch.index.snapshots.blobstore.SlicedInputStream.read(SlicedInputStream.java:92) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.io.InputStream.read(InputStream.java:213) ~[?:?]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFile(FileRestoreContext.java:240) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restoreFiles(FileRestoreContext.java:217) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.FileRestoreContext.restore(FileRestoreContext.java:180) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.restoreShard(BlobStoreRepository.java:1253) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.repositories.Repository.restoreShard(Repository.java:231) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.restore(StoreRecovery.java:469) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromRepository$5(StoreRecovery.java:285) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.StoreRecovery.recoverFromRepository(StoreRecovery.java:283) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.restoreFromRepository(IndexShard.java:1867) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$17(IndexShard.java:2580) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 4 more\r\n```\r\n</p>\r\n</details>\r\n\r\nl.e. I've seen `java.io.IOException: Connection reset` and `javax.net.ssl.SSLException: Connection reset`, [neither of which seem to be retryable](https://github.com/googleapis/java-core/blob/573d42d704413ee10dc2e600e8891575508ab7b7/google-cloud-core/src/main/java/com/google/cloud/BaseServiceException.java#L254-L264)\r\n\r\nRelates #46589, which works around the same issue in the AWS S3 SDK.\r\n\r\nQuoting https://github.com/googleapis/java-storage/issues/26#issuecomment-575144315:\r\n\r\n> network issues [...] are out of the scope of its responsibility\r\n\r\nThis seems to ignore the fact that connection drops are often transient and resuming the download is often the right way to proceed. Still, at least it's a clear statement of intent, and indicates that maybe we need to implement our own resume functionality to work around this for now.","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}