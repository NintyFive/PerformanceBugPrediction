{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18675","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18675/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18675/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18675/events","html_url":"https://github.com/elastic/elasticsearch/issues/18675","id":157828269,"node_id":"MDU6SXNzdWUxNTc4MjgyNjk=","number":18675,"title":"discrepancies between missing aggregation and terms aggregation with missing parameter","user":{"login":"asldevi","id":8813,"node_id":"MDQ6VXNlcjg4MTM=","avatar_url":"https://avatars2.githubusercontent.com/u/8813?v=4","gravatar_id":"","url":"https://api.github.com/users/asldevi","html_url":"https://github.com/asldevi","followers_url":"https://api.github.com/users/asldevi/followers","following_url":"https://api.github.com/users/asldevi/following{/other_user}","gists_url":"https://api.github.com/users/asldevi/gists{/gist_id}","starred_url":"https://api.github.com/users/asldevi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asldevi/subscriptions","organizations_url":"https://api.github.com/users/asldevi/orgs","repos_url":"https://api.github.com/users/asldevi/repos","events_url":"https://api.github.com/users/asldevi/events{/privacy}","received_events_url":"https://api.github.com/users/asldevi/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-06-01T05:47:20Z","updated_at":"2016-06-02T05:32:41Z","closed_at":"2016-06-02T05:32:41Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version**: 2.1.1\n\n**JVM version**: 1.8.0_25\n\n**OS version**: Mac OS X EI Capitan\n\n**Steps to reproduce**:\n\n_Missing aggregation_\n\n```\nGET /.../_search?size=0\n{\n    \"aggs\" : {\n        \"wo_exp_level\": {\"missing\": {\"field\": \"experience_level\"}},\n        \"exp_level\" : { \n            \"terms\" : { \"field\" : \"experience_level\"}}\n    }\n}\n```\n\nreturns \n\n```\n \"exp_level\": {\n         \"doc_count_error_upper_bound\": 0,\n         \"sum_other_doc_count\": 0,\n         \"buckets\": [\n            {\n               \"key\": \"Mid-Level\",\n               \"doc_count\": 1466\n            },\n            {\n               \"key\": \"Senior\",\n               \"doc_count\": 1164\n            },\n            {\n               \"key\": \"Lead\",\n               \"doc_count\": 854\n            },\n            {\n               \"key\": \"Junior\",\n               \"doc_count\": 824\n            }\n         ]\n      },\n      \"wo_exp_level\": {\n         \"doc_count\": 65692\n    }\n```\n\n_Terms aggregation with missing parameter_\n\n```\nGET /.../_search?size=0\n{\n    \"aggs\" : {\n        \"exp_level\" : { \n            \"terms\" : { \"field\" : \"experience_level\", \"missing\": \"notset\"}}\n    }\n}\n```\n\ngives \n\n```\n\"exp_level\": {\n         \"doc_count_error_upper_bound\": 0,\n         \"sum_other_doc_count\": 0,\n         \"buckets\": [\n            {\n               \"key\": \"notset\",\n               \"doc_count\": 65574\n            },\n            {\n               \"key\": \"Mid-Level\",\n               \"doc_count\": 1463\n            },\n            {\n               \"key\": \"Senior\",\n               \"doc_count\": 1274\n            },\n            {\n               \"key\": \"Lead\",\n               \"doc_count\": 863\n            },\n            {\n               \"key\": \"Junior\",\n               \"doc_count\": 826\n            }\n         ]\n      }\n```\n\nI expect the value in the bucket `notset` (65574) to be same as `doc_count` in the missing aggregation (65692), which is `wo_exp_level`. But they're not. Also the counts in other buckets also change with and without the `missing` parameter.\n","closed_by":{"login":"asldevi","id":8813,"node_id":"MDQ6VXNlcjg4MTM=","avatar_url":"https://avatars2.githubusercontent.com/u/8813?v=4","gravatar_id":"","url":"https://api.github.com/users/asldevi","html_url":"https://github.com/asldevi","followers_url":"https://api.github.com/users/asldevi/followers","following_url":"https://api.github.com/users/asldevi/following{/other_user}","gists_url":"https://api.github.com/users/asldevi/gists{/gist_id}","starred_url":"https://api.github.com/users/asldevi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asldevi/subscriptions","organizations_url":"https://api.github.com/users/asldevi/orgs","repos_url":"https://api.github.com/users/asldevi/repos","events_url":"https://api.github.com/users/asldevi/events{/privacy}","received_events_url":"https://api.github.com/users/asldevi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}