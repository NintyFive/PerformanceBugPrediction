{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17580","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17580/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17580/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17580/events","html_url":"https://github.com/elastic/elasticsearch/issues/17580","id":146513260,"node_id":"MDU6SXNzdWUxNDY1MTMyNjA=","number":17580,"title":"Issue after upgrading ES from 1.x to 2.x ","user":{"login":"dobariya","id":10497122,"node_id":"MDQ6VXNlcjEwNDk3MTIy","avatar_url":"https://avatars0.githubusercontent.com/u/10497122?v=4","gravatar_id":"","url":"https://api.github.com/users/dobariya","html_url":"https://github.com/dobariya","followers_url":"https://api.github.com/users/dobariya/followers","following_url":"https://api.github.com/users/dobariya/following{/other_user}","gists_url":"https://api.github.com/users/dobariya/gists{/gist_id}","starred_url":"https://api.github.com/users/dobariya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dobariya/subscriptions","organizations_url":"https://api.github.com/users/dobariya/orgs","repos_url":"https://api.github.com/users/dobariya/repos","events_url":"https://api.github.com/users/dobariya/events{/privacy}","received_events_url":"https://api.github.com/users/dobariya/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":22,"created_at":"2016-04-07T05:28:00Z","updated_at":"2020-11-11T21:58:45Z","closed_at":"2016-10-07T09:24:35Z","author_association":"NONE","active_lock_reason":null,"body":"After upgrading ES version from 1.7 to 2.2.0 we have start receiving errors.Please see below log for the same.\n\n`we use virtual environment with EMC storage`\n\nWe have three nodes all as master=true and data=true.\n\nHere is our configuration\n\n```\ncluster.name: cluster1\nnode.name: \"node01\nnode.master: true\nnode.data: true\nindex.query.bool.max_clause_count: 50100\nindices.fielddata.cache.size: 40%\naction.disable_delete_all_indices: true\nindices.cluster.send_refresh_mapping: false\nindex.cache.field.type: soft\nindices.breaker.fielddata.limit: 60%\npath.data: E:/Share/Elastic_Search/data\npath.logs: \\\\PC1\\Elasticsearch\\Logs\\node01\nbootstrap.mlockall: true\nnetwork.host: node01\nindices.recovery.max_bytes_per_sec: 100mb\nindices.recovery.concurrent_streams: 5\ndiscovery.zen.ping.multicast.enabled: false\ndiscovery.zen.ping.unicast.hosts: [node01,node02,node03]\n```\n\nAnd log messages\n\n```\n[2016-04-06 12:01:52,496][DEBUG][action.admin.indices.stats] [node01] [indices:monitor/stats] failed to execute operation for shard [[Products][3], node[L_mbnAHGRHiwIyi3of0GKw], [P], v[209], s[STARTED], a[id=FOWy8JKfRWeiFLmhvX05bQ]]\nElasticsearchException[failed to refresh store stats]; nested: AccessDeniedException[E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\Products\\3\\index\\_9zmi_Lucene54_0.dvd];\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1534)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1519)\n  at org.elasticsearch.common.util.SingleObjectCache.getOrRefresh(SingleObjectCache.java:55)\n  at org.elasticsearch.index.store.Store.stats(Store.java:293)\n  at org.elasticsearch.index.shard.IndexShard.storeStats(IndexShard.java:665)\n  at org.elasticsearch.action.admin.indices.stats.CommonStats.<init>(CommonStats.java:134)\n  at org.elasticsearch.action.admin.indices.stats.TransportIndicesStatsAction.shardOperation(TransportIndicesStatsAction.java:165)\n  at org.elasticsearch.action.admin.indices.stats.TransportIndicesStatsAction.shardOperation(TransportIndicesStatsAction.java:47)\n  at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction$BroadcastByNodeTransportRequestHandler.onShardOperation(TransportBroadcastByNodeAction.java:409)\n  at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction$BroadcastByNodeTransportRequestHandler.messageReceived(TransportBroadcastByNodeAction.java:388)\n  at org.elasticsearch.action.support.broadcast.node.TransportBroadcastByNodeAction$BroadcastByNodeTransportRequestHandler.messageReceived(TransportBroadcastByNodeAction.java:375)\n  at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:350)\n  at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n  at java.lang.Thread.run(Unknown Source)\nCaused by: java.nio.file.AccessDeniedException: E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\Products\\3\\index\\_9zmi_Lucene54_0.dvd\n  at sun.nio.fs.WindowsException.translateToIOException(Unknown Source)\n  at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)\n  at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)\n  at sun.nio.fs.WindowsFileAttributeViews$Basic.readAttributes(Unknown Source)\n  at sun.nio.fs.WindowsFileAttributeViews$Basic.readAttributes(Unknown Source)\n  at sun.nio.fs.WindowsFileSystemProvider.readAttributes(Unknown Source)\n  at java.nio.file.Files.readAttributes(Unknown Source)\n  at java.nio.file.Files.size(Unknown Source)\n  at org.apache.lucene.store.FSDirectory.fileLength(FSDirectory.java:209)\n  at org.apache.lucene.store.FilterDirectory.fileLength(FilterDirectory.java:67)\n  at org.apache.lucene.store.FilterDirectory.fileLength(FilterDirectory.java:67)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.estimateSize(Store.java:1543)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1532)\n  ... 15 more\n[2016-04-06 12:30:41,867][DEBUG][action.admin.cluster.node.stats] [node01] failed to execute on node [L_mbnAHGRHiwIyi3of0GKw]\nRemoteTransportException[[node01][node01/10.250.200.104:9300][cluster:monitor/nodes/stats[n]]]; nested: ElasticsearchException[failed to refresh store stats]; nested: AccessDeniedException[E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\Products\\1\\index\\_a0it.nvd];\nCaused by: ElasticsearchException[failed to refresh store stats]; nested: AccessDeniedException[E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\Products\\1\\index\\_a0it.nvd];\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1534)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1519)\n  at org.elasticsearch.common.util.SingleObjectCache.getOrRefresh(SingleObjectCache.java:55)\n  at org.elasticsearch.index.store.Store.stats(Store.java:293)\n  at org.elasticsearch.index.shard.IndexShard.storeStats(IndexShard.java:665)\n  at org.elasticsearch.action.admin.indices.stats.CommonStats.<init>(CommonStats.java:134)\n  at org.elasticsearch.indices.IndicesService.stats(IndicesService.java:253)\n  at org.elasticsearch.node.service.NodeService.stats(NodeService.java:157)\n  at org.elasticsearch.action.admin.cluster.node.stats.TransportNodesStatsAction.nodeOperation(TransportNodesStatsAction.java:82)\n  at org.elasticsearch.action.admin.cluster.node.stats.TransportNodesStatsAction.nodeOperation(TransportNodesStatsAction.java:44)\n  at org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:211)\n  at org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:207)\n  at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:350)\n  at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n  at java.lang.Thread.run(Unknown Source)\nCaused by: java.nio.file.AccessDeniedException: E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\Products\\1\\index\\_a0it.nvd\n  at sun.nio.fs.WindowsException.translateToIOException(Unknown Source)\n  at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)\n  at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)\n  at sun.nio.fs.WindowsFileAttributeViews$Basic.readAttributes(Unknown Source)\n  at sun.nio.fs.WindowsFileAttributeViews$Basic.readAttributes(Unknown Source)\n  at sun.nio.fs.WindowsFileSystemProvider.readAttributes(Unknown Source)\n  at java.nio.file.Files.readAttributes(Unknown Source)\n  at java.nio.file.Files.size(Unknown Source)\n  at org.apache.lucene.store.FSDirectory.fileLength(FSDirectory.java:209)\n  at org.apache.lucene.store.FilterDirectory.fileLength(FilterDirectory.java:67)\n  at org.apache.lucene.store.FilterDirectory.fileLength(FilterDirectory.java:67)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.estimateSize(Store.java:1543)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1532)\n  ... 16 more\n[2016-04-06 13:27:45,837][DEBUG][action.admin.cluster.node.stats] [node01] failed to execute on node [L_mbnAHGRHiwIyi3of0GKw]\nRemoteTransportException[[node01][node01/10.250.200.104:9300][cluster:monitor/nodes/stats[n]]]; nested: ElasticsearchException[failed to refresh store stats]; nested: AccessDeniedException[E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\anthem_review\\0\\index\\_t7.fnm];\nCaused by: ElasticsearchException[failed to refresh store stats]; nested: AccessDeniedException[E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\anthem_review\\0\\index\\_t7.fnm];\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1534)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1519)\n  at org.elasticsearch.common.util.SingleObjectCache.getOrRefresh(SingleObjectCache.java:55)\n  at org.elasticsearch.index.store.Store.stats(Store.java:293)\n  at org.elasticsearch.index.shard.IndexShard.storeStats(IndexShard.java:665)\n  at org.elasticsearch.action.admin.indices.stats.CommonStats.<init>(CommonStats.java:134)\n  at org.elasticsearch.indices.IndicesService.stats(IndicesService.java:253)\n  at org.elasticsearch.node.service.NodeService.stats(NodeService.java:157)\n  at org.elasticsearch.action.admin.cluster.node.stats.TransportNodesStatsAction.nodeOperation(TransportNodesStatsAction.java:82)\n  at org.elasticsearch.action.admin.cluster.node.stats.TransportNodesStatsAction.nodeOperation(TransportNodesStatsAction.java:44)\n  at org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:211)\n  at org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:207)\n  at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:350)\n  at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n  at java.lang.Thread.run(Unknown Source)\nCaused by: java.nio.file.AccessDeniedException: E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\anthem_review\\0\\index\\_t7.fnm\n  at sun.nio.fs.WindowsException.translateToIOException(Unknown Source)\n  at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)\n  at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)\n  at sun.nio.fs.WindowsFileAttributeViews$Basic.readAttributes(Unknown Source)\n  at sun.nio.fs.WindowsFileAttributeViews$Basic.readAttributes(Unknown Source)\n  at sun.nio.fs.WindowsFileSystemProvider.readAttributes(Unknown Source)\n  at java.nio.file.Files.readAttributes(Unknown Source)\n  at java.nio.file.Files.size(Unknown Source)\n  at org.apache.lucene.store.FSDirectory.fileLength(FSDirectory.java:209)\n  at org.apache.lucene.store.FilterDirectory.fileLength(FilterDirectory.java:67)\n  at org.apache.lucene.store.FilterDirectory.fileLength(FilterDirectory.java:67)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.estimateSize(Store.java:1543)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1532)\n  ... 16 more\n[2016-04-06 18:26:11,254][DEBUG][action.admin.cluster.node.stats] [node01] failed to execute on node [BR9PT4QVRuy7VqE5iTlJLQ]\nRemoteTransportException[[LDESMETA03][10.250.200.29:9300][cluster:monitor/nodes/stats[n]]]; nested: ElasticsearchException[failed to refresh store stats]; nested: NotSerializableExceptionWrapper[E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\mma_review\\0\\index\\_rbj.cfe];\nCaused by: ElasticsearchException[failed to refresh store stats]; nested: NotSerializableExceptionWrapper[E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\mma_review\\0\\index\\_rbj.cfe];\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1534)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1519)\n  at org.elasticsearch.common.util.SingleObjectCache.getOrRefresh(SingleObjectCache.java:55)\n  at org.elasticsearch.index.store.Store.stats(Store.java:293)\n  at org.elasticsearch.index.shard.IndexShard.storeStats(IndexShard.java:665)\n  at org.elasticsearch.action.admin.indices.stats.CommonStats.<init>(CommonStats.java:134)\n  at org.elasticsearch.indices.IndicesService.stats(IndicesService.java:253)\n  at org.elasticsearch.node.service.NodeService.stats(NodeService.java:157)\n  at org.elasticsearch.action.admin.cluster.node.stats.TransportNodesStatsAction.nodeOperation(TransportNodesStatsAction.java:82)\n  at org.elasticsearch.action.admin.cluster.node.stats.TransportNodesStatsAction.nodeOperation(TransportNodesStatsAction.java:44)\n  at org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:211)\n  at org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:207)\n  at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.doRun(MessageChannelHandler.java:299)\n  at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n  at java.lang.Thread.run(Unknown Source)\nCaused by: NotSerializableExceptionWrapper[E:\\Share\\Elastic_Search\\data\\cluster1\\nodes\\0\\indices\\mma_review\\0\\index\\_rbj.cfe]\n  at sun.nio.fs.WindowsException.translateToIOException(Unknown Source)\n  at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)\n  at sun.nio.fs.WindowsException.rethrowAsIOException(Unknown Source)\n  at sun.nio.fs.WindowsFileAttributeViews$Basic.readAttributes(Unknown Source)\n  at sun.nio.fs.WindowsFileAttributeViews$Basic.readAttributes(Unknown Source)\n  at sun.nio.fs.WindowsFileSystemProvider.readAttributes(Unknown Source)\n  at java.nio.file.Files.readAttributes(Unknown Source)\n  at java.nio.file.Files.size(Unknown Source)\n  at org.apache.lucene.store.FSDirectory.fileLength(FSDirectory.java:209)\n  at org.apache.lucene.store.FilterDirectory.fileLength(FilterDirectory.java:67)\n  at org.apache.lucene.store.FilterDirectory.fileLength(FilterDirectory.java:67)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.estimateSize(Store.java:1543)\n  at org.elasticsearch.index.store.Store$StoreStatsCache.refresh(Store.java:1532)\n  ... 16 more\n```\n","closed_by":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"performed_via_github_app":null}