{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52153","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52153/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52153/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52153/events","html_url":"https://github.com/elastic/elasticsearch/issues/52153","id":562658062,"node_id":"MDU6SXNzdWU1NjI2NTgwNjI=","number":52153,"title":"Regression  - ssl.trust no longer working - \"unable to find valid certification path to requested target\"","user":{"login":"AndyHunt66","id":5576500,"node_id":"MDQ6VXNlcjU1NzY1MDA=","avatar_url":"https://avatars0.githubusercontent.com/u/5576500?v=4","gravatar_id":"","url":"https://api.github.com/users/AndyHunt66","html_url":"https://github.com/AndyHunt66","followers_url":"https://api.github.com/users/AndyHunt66/followers","following_url":"https://api.github.com/users/AndyHunt66/following{/other_user}","gists_url":"https://api.github.com/users/AndyHunt66/gists{/gist_id}","starred_url":"https://api.github.com/users/AndyHunt66/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndyHunt66/subscriptions","organizations_url":"https://api.github.com/users/AndyHunt66/orgs","repos_url":"https://api.github.com/users/AndyHunt66/repos","events_url":"https://api.github.com/users/AndyHunt66/events{/privacy}","received_events_url":"https://api.github.com/users/AndyHunt66/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"}],"state":"closed","locked":false,"assignee":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"assignees":[{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2020-02-10T15:58:54Z","updated_at":"2020-05-28T05:29:47Z","closed_at":"2020-05-28T05:29:47Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 7.5.0 \r\n(also affects 7.4.0+)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n[This pr](https://github.com/elastic/elasticsearch/pull/45272) and it's [backport](https://github.com/elastic/elasticsearch/pull/45836) have caused `xpack.notification.email.account.<name>.smtp.ssl.trust` to not be recognised any more.\r\n\r\nThe following config works for versions 6.8.4, 7.0.0,7.1.0,7.2.0,7.3.2, but fails for versions 7.4.0+, 7.5.0 with the message: \r\n`unable to find valid certification path to requested target`\r\n\r\n```\r\nxpack.notification.email.account:\r\n   smtp1:\r\n       profile: standard\r\n       email_defaults:\r\n           from: Elasticsearch@example.email.com\r\n       smtp:\r\n           ssl.trust: example.email.com\r\n           auth: false\r\n           starttls.enable: true\r\n           host: example.email.com\r\n           port: 25\r\n```\r\n\r\nIt's unclear if this is the new intended behaviour, or if this is an unwanted side-effect of #45272\r\n\r\n**Steps to reproduce**\r\n1 - setup smtp configuration as above, then create a watcher that fires an email via smtp\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n\r\nWatch result:\r\n```\r\n   \"actions\": [\r\n      {\r\n        \"id\": \"email_administrator\",\r\n        \"type\": \"email\",\r\n        \"status\": \"failure\",\r\n        \"error\": {\r\n          \"root_cause\": [\r\n            {\r\n              \"type\": \"messaging_exception\",\r\n              \"reason\": \"failed to send email with subject [lwatch] via account [smtp1]\"\r\n            }\r\n          ],\r\n          \"type\": \"messaging_exception\",\r\n          \"reason\": \"failed to send email with subject [watch] via account [smtp1]\",\r\n          \"caused_by\": {\r\n            \"type\": \"messaging_exception\",\r\n            \"reason\": \"Could not convert socket to TLS\",\r\n            \"caused_by\": {\r\n              \"type\": \"s_s_l_handshake_exception\",\r\n              \"reason\": \"PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\",\r\n              \"caused_by\": {\r\n                \"type\": \"validator_exception\",\r\n                \"reason\": \"PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\",\r\n                \"caused_by\": {\r\n                  \"type\": \"sun_cert_path_builder_exception\",\r\n                  \"reason\": \"unable to find valid certification path to requested target\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    ]\r\n```\r\n","closed_by":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"performed_via_github_app":null}