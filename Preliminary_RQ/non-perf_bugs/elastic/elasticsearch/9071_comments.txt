[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68134219","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68134219","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68134219,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTM0MjE5","user":{"login":"wimvanleuven","id":1175501,"node_id":"MDQ6VXNlcjExNzU1MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1175501?v=4","gravatar_id":"","url":"https://api.github.com/users/wimvanleuven","html_url":"https://github.com/wimvanleuven","followers_url":"https://api.github.com/users/wimvanleuven/followers","following_url":"https://api.github.com/users/wimvanleuven/following{/other_user}","gists_url":"https://api.github.com/users/wimvanleuven/gists{/gist_id}","starred_url":"https://api.github.com/users/wimvanleuven/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wimvanleuven/subscriptions","organizations_url":"https://api.github.com/users/wimvanleuven/orgs","repos_url":"https://api.github.com/users/wimvanleuven/repos","events_url":"https://api.github.com/users/wimvanleuven/events{/privacy}","received_events_url":"https://api.github.com/users/wimvanleuven/received_events","type":"User","site_admin":false},"created_at":"2014-12-26T10:08:38Z","updated_at":"2014-12-26T10:08:45Z","author_association":"NONE","body":"**Stack trace**\norg.elasticsearch.index.mapper.MapperParsingException: failed to parse [coordinates]\n        at org.elasticsearch.index.mapper.geo.GeoShapeFieldMapper.parse(GeoShapeFieldMapper.java:249)\n        at org.elasticsearch.index.mapper.object.ObjectMapper.serializeObject(ObjectMapper.java:555)\n        at org.elasticsearch.index.mapper.object.ObjectMapper.parse(ObjectMapper.java:490)\n        at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:541)\n        at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:490)\n        at org.elasticsearch.index.shard.service.InternalIndexShard.prepareIndex(InternalIndexShard.java:413)\n        at org.elasticsearch.action.bulk.TransportShardBulkAction.shardIndexOperation(TransportShardBulkAction.java:435)\n        at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:150)\n        at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction.performOnPrimary(TransportShardReplicationOperationAction.java:511)\n        at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$1.run(TransportShardReplicationOperationAction.java:419)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.ArrayIndexOutOfBoundsException: -1\n        at org.elasticsearch.common.geo.builders.BasePolygonBuilder.assign(BasePolygonBuilder.java:366)\n        at org.elasticsearch.common.geo.builders.BasePolygonBuilder.compose(BasePolygonBuilder.java:342)\n        at org.elasticsearch.common.geo.builders.BasePolygonBuilder.coordinates(BasePolygonBuilder.java:141)\n        at org.elasticsearch.common.geo.builders.MultiPolygonBuilder.build(MultiPolygonBuilder.java:75)\n        at org.elasticsearch.index.mapper.geo.GeoShapeFieldMapper.parse(GeoShapeFieldMapper.java:234)\n        ... 12 more\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68153244","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68153244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68153244,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTUzMjQ0","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2014-12-26T18:54:24Z","updated_at":"2014-12-26T18:54:24Z","author_association":"CONTRIBUTOR","body":"Greetings @wimvanleuven!\n\nYour coordinate array is valid, but its defined as a single polygon with 4 \"holes\" (some, technically, invalid but geojson doesn't care).  Did you mean for this to be the case? I presume since you define the type as a `MultiPolygon` what you really want is 5 distinct polygons?  If my presumption is correct then update your coordinate array to be an array of multiple polygons instead of an array of a single polygon with 4 holes.  \n\nHere is a gist with the updated multipolygon:\nhttps://gist.github.com/nknize/9b34dbc991b1b0ed66e6\n\nIf you really did mean a single polygon with 4 holes then change the `type` from `multipolygon` to `polygon`\n\nYou can test this out on the command line to verify it works on your system.  (I'm omitting the geojson since its too big and you can copy it from the gist).\n\nHope this helps!  Certainly let us know if it doesn't.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68153337","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68153337","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68153337,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTUzMzM3","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2014-12-26T18:56:54Z","updated_at":"2014-12-26T18:56:54Z","author_association":"CONTRIBUTOR","body":"Oh, and thanks for pointing out the stack trace!  This does warrant the need for an exception message that's more useful than `ArrayIndexOutOfBoundsException`\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68172010","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68172010","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68172010,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTcyMDEw","user":{"login":"wimvanleuven","id":1175501,"node_id":"MDQ6VXNlcjExNzU1MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1175501?v=4","gravatar_id":"","url":"https://api.github.com/users/wimvanleuven","html_url":"https://github.com/wimvanleuven","followers_url":"https://api.github.com/users/wimvanleuven/followers","following_url":"https://api.github.com/users/wimvanleuven/following{/other_user}","gists_url":"https://api.github.com/users/wimvanleuven/gists{/gist_id}","starred_url":"https://api.github.com/users/wimvanleuven/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wimvanleuven/subscriptions","organizations_url":"https://api.github.com/users/wimvanleuven/orgs","repos_url":"https://api.github.com/users/wimvanleuven/repos","events_url":"https://api.github.com/users/wimvanleuven/events{/privacy}","received_events_url":"https://api.github.com/users/wimvanleuven/received_events","type":"User","site_admin":false},"created_at":"2014-12-27T08:02:41Z","updated_at":"2014-12-27T08:02:41Z","author_association":"NONE","body":"Hey Nick,\n\nThanks for looking into this issue!!!\n\nI just looked at the source data and what you say makes sense .... and not :-) \n\nThis city actually is defined in some other Geo lingo as a multigeometry (which I translated into a MultiPolygon) with polygons (translated into Polygon) inside. So, there we are correct. However, the source only holds a single Polygon inside. \n\nChanging my translation code I indeed came to a MultiPolygon [[[[...]]]], however with only 1 Polygon inside. \n\nhttps://gist.github.com/wimvanleuven/9ecc2a85d79f7e7f2a4d\n\nHowever, ElasticSearch still gives the same exception on this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68182189","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68182189","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68182189,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTgyMTg5","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2014-12-27T15:55:47Z","updated_at":"2014-12-27T15:55:47Z","author_association":"CONTRIBUTOR","body":"A MultiPolygon is defined as an array of Polygons each of which are defined as an array of LinearRings. First is the outer ring (shell) the rest are inner rings (holes). The inner rings must fall within the bounds of the outer ring (and no shared edges).  \n\nPseudo example\n\np: polygon\no: outer ring\ni:  inner ring\nc: coordinate\n\n[ [ [[p1o1c1], [p1o1c2],...] , \n    [[p1i1c1], [p1i1c2],...], \n    [[p1i2c1], [p1i2c2],...],...\n  ],\n  [ [[p2o1c1], [p2o1c2],...] , \n    [[p2i1c1], [p2i1c2],...], \n    [[p2i2c1], [p2i2c2],...],...\n  ],...\n]\n\nBased on this definition, your data (in the provided gist) consists of a single polygon with 4 inner rings. And the first inner ring falls outside the bounds of the outer ring which will cause a problem.  \n\nIf you want to use MultiPolygon the translation code will need to create an array of polygons containing a single linear ring (outer) with no holes. \n\nAlternatively, if you want to closer match the source data you can create a GeometryCollection containing multiple polygons instead of a single MultiPolygon geo_shape. \n\nIf I can hop on later I'll throw together an example.\n\n> On Dec 27, 2014, at 3:03 AM, Wim Van Leuven notifications@github.com wrote:\n> \n> Hey Nick,\n> \n> Thanks for looking into this issue!!!\n> \n> I just looked at the source data and what you say makes sense .... and not :-)\n> \n> This city actually is defined in some other Geo lingo as a multigeometry (which I translated into a MultiPolygon) with polygons (translated into Polygon) inside. So, there we are correct. However, the source only holds a single Polygon inside.\n> \n> Changing my translation code I indeed came to a MultiPolygon [[[[...]]]], however with only 1 Polygon inside.\n> \n> https://gist.github.com/wimvanleuven/9ecc2a85d79f7e7f2a4d\n> \n> However, ElasticSearch still gives the same exception on this.\n> \n> —\n> Reply to this email directly or view it on GitHub.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68183978","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68183978","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68183978,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTgzOTc4","user":{"login":"wimvanleuven","id":1175501,"node_id":"MDQ6VXNlcjExNzU1MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1175501?v=4","gravatar_id":"","url":"https://api.github.com/users/wimvanleuven","html_url":"https://github.com/wimvanleuven","followers_url":"https://api.github.com/users/wimvanleuven/followers","following_url":"https://api.github.com/users/wimvanleuven/following{/other_user}","gists_url":"https://api.github.com/users/wimvanleuven/gists{/gist_id}","starred_url":"https://api.github.com/users/wimvanleuven/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wimvanleuven/subscriptions","organizations_url":"https://api.github.com/users/wimvanleuven/orgs","repos_url":"https://api.github.com/users/wimvanleuven/repos","events_url":"https://api.github.com/users/wimvanleuven/events{/privacy}","received_events_url":"https://api.github.com/users/wimvanleuven/received_events","type":"User","site_admin":false},"created_at":"2014-12-27T17:08:00Z","updated_at":"2014-12-27T17:08:00Z","author_association":"NONE","body":"Capice! GeoCollection is closer to what comes in then. I'll give that a\nswing as soon as possible; let me try that first before you spend more time\nin this.\n-w\nOn 27 Dec 2014 16:56, \"Nick Knize\" notifications@github.com wrote:\n\n> A MultiPolygon is defined as an array of Polygons each of which are\n> defined as an array of LinearRings. First is the outer ring (shell) the\n> rest are inner rings (holes). The inner rings must fall within the bounds\n> of the outer ring (and no shared edges).\n> \n> Pseudo example\n> \n> p: polygon\n> o: outer ring\n> i: inner ring\n> c: coordinate\n> \n> [ [ [[p1o1c1], [p1o1c2],...] ,\n> [[p1i1c1], [p1i1c2],...],\n> [[p1i2c1], [p1i2c2],...],...\n> ],\n> [ [[p2o1c1], [p2o1c2],...] ,\n> [[p2i1c1], [p2i1c2],...],\n> [[p2i2c1], [p2i2c2],...],...\n> ],...\n> ]\n> \n> Based on this definition, your data (in the provided gist) consists of a\n> single polygon with 4 inner rings. And the first inner ring falls outside\n> the bounds of the outer ring which will cause a problem.\n> \n> If you want to use MultiPolygon the translation code will need to create\n> an array of polygons containing a single linear ring (outer) with no holes.\n> \n> Alternatively, if you want to closer match the source data you can create\n> a GeometryCollection containing multiple polygons instead of a single\n> MultiPolygon geo_shape.\n> \n> If I can hop on later I'll throw together an example.\n> \n> > On Dec 27, 2014, at 3:03 AM, Wim Van Leuven notifications@github.com\n> > wrote:\n> > \n> > Hey Nick,\n> > \n> > Thanks for looking into this issue!!!\n> > \n> > I just looked at the source data and what you say makes sense .... and\n> > not :-)\n> > \n> > This city actually is defined in some other Geo lingo as a multigeometry\n> > (which I translated into a MultiPolygon) with polygons (translated into\n> > Polygon) inside. So, there we are correct. However, the source only holds a\n> > single Polygon inside.\n> > \n> > Changing my translation code I indeed came to a MultiPolygon\n> > [[[[...]]]], however with only 1 Polygon inside.\n> > \n> > https://gist.github.com/wimvanleuven/9ecc2a85d79f7e7f2a4d\n> > \n> > However, ElasticSearch still gives the same exception on this.\n> > \n> > —\n> > Reply to this email directly or view it on GitHub.\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/elasticsearch/elasticsearch/issues/9071#issuecomment-68182189\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68344011","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68344011","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68344011,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MzQ0MDEx","user":{"login":"wimvanleuven","id":1175501,"node_id":"MDQ6VXNlcjExNzU1MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1175501?v=4","gravatar_id":"","url":"https://api.github.com/users/wimvanleuven","html_url":"https://github.com/wimvanleuven","followers_url":"https://api.github.com/users/wimvanleuven/followers","following_url":"https://api.github.com/users/wimvanleuven/following{/other_user}","gists_url":"https://api.github.com/users/wimvanleuven/gists{/gist_id}","starred_url":"https://api.github.com/users/wimvanleuven/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wimvanleuven/subscriptions","organizations_url":"https://api.github.com/users/wimvanleuven/orgs","repos_url":"https://api.github.com/users/wimvanleuven/repos","events_url":"https://api.github.com/users/wimvanleuven/events{/privacy}","received_events_url":"https://api.github.com/users/wimvanleuven/received_events","type":"User","site_admin":false},"created_at":"2014-12-30T10:09:14Z","updated_at":"2014-12-30T10:09:14Z","author_association":"NONE","body":"The easiest was to convert multigeometry into a MultiPolygon as Polygon[]. That worked! So ticket can be closed!\n\nApparently the data we use a simple XML to JSON conversion of KML. I'll also try to apply a KMLtoGeoJSON convertor on it to see if this isn't a better approach than this ad-hoc conversion I have been doing right now. \n\nThanks for the fabulous support! \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68344876","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68344876","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68344876,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MzQ0ODc2","user":{"login":"wimvanleuven","id":1175501,"node_id":"MDQ6VXNlcjExNzU1MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/1175501?v=4","gravatar_id":"","url":"https://api.github.com/users/wimvanleuven","html_url":"https://github.com/wimvanleuven","followers_url":"https://api.github.com/users/wimvanleuven/followers","following_url":"https://api.github.com/users/wimvanleuven/following{/other_user}","gists_url":"https://api.github.com/users/wimvanleuven/gists{/gist_id}","starred_url":"https://api.github.com/users/wimvanleuven/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wimvanleuven/subscriptions","organizations_url":"https://api.github.com/users/wimvanleuven/orgs","repos_url":"https://api.github.com/users/wimvanleuven/repos","events_url":"https://api.github.com/users/wimvanleuven/events{/privacy}","received_events_url":"https://api.github.com/users/wimvanleuven/received_events","type":"User","site_admin":false},"created_at":"2014-12-30T10:14:46Z","updated_at":"2014-12-30T10:14:46Z","author_association":"NONE","body":"For reference, I created another gist with the final converted MultiPolygon https://gist.github.com/wimvanleuven/cbe049504cbf0201005c\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68345364","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68345364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68345364,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MzQ1MzY0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-30T10:22:04Z","updated_at":"2014-12-30T10:22:04Z","author_association":"CONTRIBUTOR","body":"@wimvanleuven either way, we need  better exception and AOOB, so I'll reopen this issue\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68394003","html_url":"https://github.com/elastic/elasticsearch/issues/9071#issuecomment-68394003","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9071","id":68394003,"node_id":"MDEyOklzc3VlQ29tbWVudDY4Mzk0MDAz","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2014-12-30T20:20:20Z","updated_at":"2014-12-30T20:20:20Z","author_association":"CONTRIBUTOR","body":"@wimvanleuven Thanks for the update and we're glad to hear everything is working for you!\n","performed_via_github_app":null}]