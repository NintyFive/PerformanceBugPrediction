{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7470","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7470/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7470/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7470/events","html_url":"https://github.com/elastic/elasticsearch/issues/7470","id":41231243,"node_id":"MDU6SXNzdWU0MTIzMTI0Mw==","number":7470,"title":"min_doc_count when set to 0 returns incorrect aggregations","user":{"login":"bittusarkar","id":860447,"node_id":"MDQ6VXNlcjg2MDQ0Nw==","avatar_url":"https://avatars0.githubusercontent.com/u/860447?v=4","gravatar_id":"","url":"https://api.github.com/users/bittusarkar","html_url":"https://github.com/bittusarkar","followers_url":"https://api.github.com/users/bittusarkar/followers","following_url":"https://api.github.com/users/bittusarkar/following{/other_user}","gists_url":"https://api.github.com/users/bittusarkar/gists{/gist_id}","starred_url":"https://api.github.com/users/bittusarkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bittusarkar/subscriptions","organizations_url":"https://api.github.com/users/bittusarkar/orgs","repos_url":"https://api.github.com/users/bittusarkar/repos","events_url":"https://api.github.com/users/bittusarkar/events{/privacy}","received_events_url":"https://api.github.com/users/bittusarkar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-08-26T22:45:43Z","updated_at":"2014-09-02T14:54:53Z","closed_at":"2014-09-02T14:54:53Z","author_association":"NONE","active_lock_reason":null,"body":"I am using Elasticsearch 1.1.3.\n\nLet's say there is a field called \"key\" which can only take a value between \"v0\", \"v1\", \"v2\", \"v3\" and \"v4\".\n\nIf I execute the following query, as expected I get term bucket only for \"v0\" with a non-zero document count.\n{\n    \"query\": {\n        \"term\": { \"key\": \"v0\" }\n    },\n    \"aggs\" : {\n        \"keys\" : {\n            \"terms\" : { \"field\" : \"key\" }\n        }\n    }\n} \n\nBut if I add \"min_doc_count\" : 0, I get additional term buckets for \"v1\", \"v2\", \"v3\" and \"v4\" also. They have zero document count though.\n\nMy understanding is that aggregations in this case get computed over the documents that are returned by the query. In this case, all documents returned by the query have the \"key\" field set to \"v0\" only. But I get buckets for other values too. Isn't this a bug?\n\nMy actual requirements are a bit different than this stripped down example but the problem remains the same.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}