[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/452344241","html_url":"https://github.com/elastic/elasticsearch/issues/37231#issuecomment-452344241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37231","id":452344241,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MjM0NDI0MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-01-08T15:41:52Z","updated_at":"2019-01-08T15:41:52Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/452346389","html_url":"https://github.com/elastic/elasticsearch/issues/37231#issuecomment-452346389","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37231","id":452346389,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MjM0NjM4OQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2019-01-08T15:47:15Z","updated_at":"2019-01-08T15:47:15Z","author_association":"MEMBER","body":"Another instance: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/1127\r\n\r\nFull execution log [consoleTest.tar.gz](https://github.com/elastic/elasticsearch/files/2737453/consoleTest.tar.gz)\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/452349302","html_url":"https://github.com/elastic/elasticsearch/issues/37231#issuecomment-452349302","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37231","id":452349302,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MjM0OTMwMg==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-01-08T15:55:03Z","updated_at":"2019-01-08T15:55:03Z","author_association":"MEMBER","body":"I've muted the two tests in `CCRIT` test class. The seem to fail for the same reason.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453144196","html_url":"https://github.com/elastic/elasticsearch/issues/37231#issuecomment-453144196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37231","id":453144196,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzE0NDE5Ng==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-01-10T15:49:30Z","updated_at":"2019-01-10T15:49:30Z","author_association":"MEMBER","body":"I merged #37239, which fixes the underlying issue why this rolling upgrade test failed.\r\nI will unmute this test soon, when I've verified that this test doesn't fail locally. (I was able to reproduce locally).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/459521784","html_url":"https://github.com/elastic/elasticsearch/issues/37231#issuecomment-459521784","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37231","id":459521784,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1OTUyMTc4NA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-01-31T21:57:19Z","updated_at":"2019-01-31T21:57:19Z","author_association":"MEMBER","body":"This test is failing again. I am re-opening the issue.\r\n\r\nSome instances:\r\n- https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/1716/console\r\n- https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/1714/console\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/459657127","html_url":"https://github.com/elastic/elasticsearch/issues/37231#issuecomment-459657127","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37231","id":459657127,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1OTY1NzEyNw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-02-01T09:16:13Z","updated_at":"2019-02-01T09:16:13Z","author_association":"MEMBER","body":"This failure is expected. In a 3 node cluster, all on version 6.7.0-SNAPSHOT, one node gets upgraded to 7.0.0-SNAPSHOT. In this state a leader index gets created on the upgraded node. The auto follow coordinator auto-follows this index, and the restore is performed on a not upgraded node. The restore fails because a 6.7.0-SNAPSHOT node can't read the index files from a 7.0.0-SNAPSHOT node:\r\n\r\n```\r\n[2019-02-01T09:59:32,426][WARN ][o.e.s.RestoreService     ] [node-1] [_ccr_local:_latest_] failed to restore snapshot\r\norg.elasticsearch.snapshots.SnapshotRestoreException: [_ccr_local:_latest_/_latest_] the snapshot was created with Elasticsearch version [7.0.0] which is higher than the version of this node [6.7.0]\r\n        at org.elasticsearch.snapshots.RestoreService.validateSnapshotRestorable(RestoreService.java:855) ~[elasticsearch-6.7.0-SNAPSHOT.jar:6.7.0-SNAPSHOT]\r\n        at org.elasticsearch.snapshots.RestoreService.restoreSnapshot(RestoreService.java:197) [elasticsearch-6.7.0-SNAPSHOT.jar:6.7.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.ccr.action.TransportPutFollowAction$1.doRun(TransportPutFollowAction.java:174) [x-pack-ccr-6.7.0-SNAPSHOT.jar:6.7.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) [elasticsearch-6.7.0-SNAPSHOT.jar:6.7.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.7.0-SNAPSHOT.jar:6.7.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n        at java.lang.Thread.run(Thread.java:834) [?:?]\r\n```\r\n\r\nThis test is testing a rolling upgrade in a local cluster (which is another form of bi-directional index following, see #38037) and currently we can't support that. The reason that it didn't fail before is because the new follower index would do an ops based recovery and recently we switched to a file based recovery as initial recovery.\r\n\r\nI'm working an adding a qa module that does a rolling upgrading in two clusters that is setup to do unidirectional index following. In this case a rolling upgrade while new leader indices are auto followed should work without a problem. When that is ready we can then move this test, to this new qa module.","performed_via_github_app":null}]