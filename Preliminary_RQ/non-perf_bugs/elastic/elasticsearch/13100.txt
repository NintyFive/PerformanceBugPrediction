{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13100","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13100/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13100/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13100/events","html_url":"https://github.com/elastic/elasticsearch/issues/13100","id":102999143,"node_id":"MDU6SXNzdWUxMDI5OTkxNDM=","number":13100,"title":"using default_operator \"AND\" causes query_strings actually containing AND to return wrong results","user":{"login":"magdalene","id":5719469,"node_id":"MDQ6VXNlcjU3MTk0Njk=","avatar_url":"https://avatars3.githubusercontent.com/u/5719469?v=4","gravatar_id":"","url":"https://api.github.com/users/magdalene","html_url":"https://github.com/magdalene","followers_url":"https://api.github.com/users/magdalene/followers","following_url":"https://api.github.com/users/magdalene/following{/other_user}","gists_url":"https://api.github.com/users/magdalene/gists{/gist_id}","starred_url":"https://api.github.com/users/magdalene/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/magdalene/subscriptions","organizations_url":"https://api.github.com/users/magdalene/orgs","repos_url":"https://api.github.com/users/magdalene/repos","events_url":"https://api.github.com/users/magdalene/events{/privacy}","received_events_url":"https://api.github.com/users/magdalene/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2015-08-25T10:56:26Z","updated_at":"2015-08-25T12:31:07Z","closed_at":"2015-08-25T11:20:15Z","author_association":"NONE","active_lock_reason":null,"body":"If I have a query string like \"one AND two OR three\", I expect the results to be the same as one of \"(one AND two) OR three\" or \"one AND (two OR three)\" but it seems like they are actually the same as \"one OR two OR three\".\n\nAlso, if the default_operator is AND, actually I expect \"one two OR three\" to work either like \"(one AND two) OR three\" or \"one AND (two OR three)\" -- but instead it works like \"one OR two OR three\".\n\nHere's an example:\n\n```\n# create a test index\ncurl -XPUT 'localhost:9200/test'\n\n# index a doc with a field containing the text \"one\"\ncurl -XPUT 'localhost:9200/test/mytype/1' -d '\n{\n    \"text\": \"one\"\n}'\n\n# query the index with no default_operator, for \"one AND two OR three\" (0 results as expected)\ncurl -XGET 'localhost:9200/test/mytype/_search?pretty' -d '\n{\n    \"query\": {\n        \"query_string\": {\n            \"default_field\": \"_all\", \n            \"query\": \"text:(one AND two OR three)\"\n        }\n    }\n}'\n\n# query with default operator, \"(one AND two) OR three\" (0 results as expected)\n# \"one AND (two OR three)\" also gives the expected 0 results\ncurl -XGET 'localhost:9200/test/mytype/_search?pretty' -d '\n{\n    \"query\": {\n        \"query_string\": {\n            \"default_field\": \"_all\", \n            \"default_operator\": \"AND\", \n            \"query\": \"text:((one AND two) OR three)\"\n        }\n    }\n}'\n\n# query \"one AND two OR three\" now with default operator, returns one result but I expect 0\ncurl -XGET 'localhost:9200/test/mytype/_search?pretty' -d '\n{\n    \"query\": {\n        \"query_string\": {\n            \"default_field\": \"_all\", \n            \"default_operator\": \"AND\", \n            \"query\": \"text:(one AND two OR three)\"\n        }\n    }\n}'\n```\n\nUsing elasticsearch-1.7.1. \n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}