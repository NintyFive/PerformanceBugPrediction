{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39871","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39871/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39871/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39871/events","html_url":"https://github.com/elastic/elasticsearch/issues/39871","id":419026505,"node_id":"MDU6SXNzdWU0MTkwMjY1MDU=","number":39871,"title":"Could I apply multiple pipelines in 1 Elasticsearch index?","user":{"login":"godlockin","id":31117750,"node_id":"MDQ6VXNlcjMxMTE3NzUw","avatar_url":"https://avatars1.githubusercontent.com/u/31117750?v=4","gravatar_id":"","url":"https://api.github.com/users/godlockin","html_url":"https://github.com/godlockin","followers_url":"https://api.github.com/users/godlockin/followers","following_url":"https://api.github.com/users/godlockin/following{/other_user}","gists_url":"https://api.github.com/users/godlockin/gists{/gist_id}","starred_url":"https://api.github.com/users/godlockin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/godlockin/subscriptions","organizations_url":"https://api.github.com/users/godlockin/orgs","repos_url":"https://api.github.com/users/godlockin/repos","events_url":"https://api.github.com/users/godlockin/events{/privacy}","received_events_url":"https://api.github.com/users/godlockin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-03-09T03:04:39Z","updated_at":"2019-03-09T14:38:12Z","closed_at":"2019-03-09T14:38:12Z","author_association":"NONE","active_lock_reason":null,"body":"ES v6.5.2, 3 nodes ... (will append other useful info if necessary)\r\n\r\nI met a use case that when I insert data into my index, I need to do several things:\r\n1. check if 2 field exists, if not set the default for it\r\n2. auto add timestamp of insert time\r\n\r\nthe mapping I used:\r\n> {\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"id\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"ingest_timestamp\": {\r\n          \"type\": \"date\"\r\n        },\r\n        \"pDate\": {\r\n          \"format\": \"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis\",\r\n          \"type\": \"date\"\r\n        },\r\n        \"pDateTime\": {\r\n          \"format\": \"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis\",\r\n          \"type\": \"date\"\r\n        },\r\n        \"sentiment\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"appName\": {\r\n          \"type\": \"keyword\"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"settings\": {\r\n    \"number_of_replicas\": 0,\r\n    \"number_of_shards\": 1,\r\n    \"default_pipeline\": \"defaultSentimentConditionPipeline\"\r\n  }\r\n}\r\n\r\n\r\nsome functional fields ignore, the fields I need to check & set default is 'appName' and 'sentiment', fake code like:\r\n\r\n> if sentiment == '' || sentiment == null\r\n  sentiment = \"neutral\"\r\n\r\nif appName == '' || appName == null\r\n  appName = \"myApp\"\r\n\r\nand I also need to set the 'ingest_timestamp' as the doc's insert time, which I applied the pipeline as\r\n\r\n> \"timestamp_pipeline\": {\r\n\"description\": \"Add insert timestamp\",\r\n\"processors\": [\r\n{\r\n\"set\": {\r\n\"field\": \"ingest_timestamp\",\r\n\"value\": \"{{_ingest.timestamp}}\"\r\n}\r\n}\r\n]\r\n}\r\n\r\nnow this is a block in front of me that how can I add these 3 works into 1 pipeline as there are several data import jobs which I can't handle all of their logic. I've tried the pipeline config like this, but somehow it doesn't work :(\r\n\r\n> \"defaultSentimentConditionPipeline\": {\r\n\"description\": \"set default sentiment condition pipeline\",\r\n\"processors\": [\r\n{\r\n\"pipeline\": {\r\n\"if\": \"ctx.sentiment == '' || ctx.sentiment == null\",\r\n\"name\": \"defaultSentimentPipeline\"\r\n}\r\n}\r\n,\r\n{\r\n\"pipeline\": {\r\n\"if\": \"ctx. appName == '' || ctx. appName == null\",\r\n\"name\": \"defaultAppNamePipeline\"\r\n}\r\n}\r\n,\r\n{\r\n\"set\": {\r\n\"field\": \"ingest_timestamp\",\r\n\"value\": \"{{_ingest.timestamp}}\"\r\n}\r\n}\r\n]\r\n}\r\n\r\n> \"defaultSentimentPipeline\": {\r\n\"description\": \"set default sentiment\",\r\n\"processors\": [\r\n{\r\n\"set\": {\r\n\"field\": \"sentiment\",\r\n\"value\": \"neutral\"\r\n}\r\n}\r\n]\r\n}\r\n\r\n> \"defaultAppNamePipeline\": {\r\n\"description\": \"set default appname\",\r\n\"processors\": [\r\n{\r\n\"set\": {\r\n\"field\": \"appName\",\r\n\"value\": \"myApp\"\r\n}\r\n}\r\n]\r\n}\r\n\r\nany suggestions for this folks?\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}