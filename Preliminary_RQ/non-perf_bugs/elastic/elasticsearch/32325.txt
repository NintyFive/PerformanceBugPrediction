{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32325","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32325/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32325/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32325/events","html_url":"https://github.com/elastic/elasticsearch/issues/32325","id":344055696,"node_id":"MDU6SXNzdWUzNDQwNTU2OTY=","number":32325,"title":"Whitelisting / from Circuit Breaker Exception","user":{"login":"nssuresh2007","id":41610499,"node_id":"MDQ6VXNlcjQxNjEwNDk5","avatar_url":"https://avatars1.githubusercontent.com/u/41610499?v=4","gravatar_id":"","url":"https://api.github.com/users/nssuresh2007","html_url":"https://github.com/nssuresh2007","followers_url":"https://api.github.com/users/nssuresh2007/followers","following_url":"https://api.github.com/users/nssuresh2007/following{/other_user}","gists_url":"https://api.github.com/users/nssuresh2007/gists{/gist_id}","starred_url":"https://api.github.com/users/nssuresh2007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nssuresh2007/subscriptions","organizations_url":"https://api.github.com/users/nssuresh2007/orgs","repos_url":"https://api.github.com/users/nssuresh2007/repos","events_url":"https://api.github.com/users/nssuresh2007/events{/privacy}","received_events_url":"https://api.github.com/users/nssuresh2007/received_events","type":"User","site_admin":false},"labels":[{"id":166507771,"node_id":"MDU6TGFiZWwxNjY1MDc3NzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Circuit%20Breakers","name":":Core/Infra/Circuit Breakers","color":"0e8a16","default":false,"description":"Track estimates of memory consumption to prevent overload"}],"state":"closed","locked":false,"assignee":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"assignees":[{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2018-07-24T14:12:06Z","updated_at":"2018-08-08T14:33:28Z","closed_at":"2018-08-08T14:33:28Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 5.1.1 (This issue observed from v5.0.0 onwards)\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 1.7.0_181\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): 4.9.70-25.242.amzn1.x86_64 (Amazon EC2)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen Circuit Breaker has tripped, certain diagnostic requests like \"_cluster/health\" succeed where as request to / fails with 503 Service Unavailable.\r\nThis behavior is observed because of this commit: https://github.com/elastic/elasticsearch/commit/f32b70047241fe319cb37047cc2a47d1b56da6e1 where certain API paths are whitelisted from Circuit Breaking exception, but / is not whitelisted.\r\nCould you please let us know if you foresee any issues if we add / to the Circuit Breaking whitelist? If not, we can submit a pull-request with the above mentioned change.\r\n\r\n##### Actual Behavior\r\nWhen Circuit Breaker has tripped, request to / results in \"503 Service Unavailable\" even if the cluster is up and running.\r\n\r\n```\r\ncurl localhost:9200/\r\n{\"error\":{\"root_cause\":[{\"type\":\"circuit_breaking_exception\",\"reason\":\"[parent] Data too large, data for [<http_request>] would be [2293752404/2.1gb], which is larger than the limit of [1968537600/1.8gb]\",\"bytes_wanted\":2293752404,\"bytes_limit\":1968537600}],\"type\":\"circuit_breaking_exception\",\"reason\":\"[parent] Data too large, data for [<http_request>] would be [2293752404/2.1gb], which is larger than the limit of [1968537600/1.8gb]\",\"bytes_wanted\":2293752404,\"bytes_limit\":1968537600},\"status\":503}\r\n```\r\n\r\n#####  Expected behavior\r\nWhen circuit breaker has tripped, request to / should still pass with \"200 OK\" if the cluster is up and running.\r\n\r\n```\r\ncurl localhost:9200/\r\n{\r\n  \"name\" : \"ixU6uZF\",\r\n  \"cluster_name\" : \"my-cluster\",\r\n  \"cluster_uuid\" : \"ahqlzl0DQAWgE6TLOmlAvA\",\r\n  \"version\" : {\r\n    \"number\" : \"5.1.1\",\r\n    \"build_hash\" : \"a90c920\",\r\n    \"build_date\" : \"2017-10-18T07:05:07.994Z\",\r\n    \"build_snapshot\" : true,\r\n    \"lucene_version\" : \"6.3.0\"\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}\r\n```\r\n\r\n**Steps to reproduce**:\r\n- Stress test the ElasticSearch cluster to make it enter into the Circuit Breaker scenario and ensure that parent circuit breaker is tripped (If required, we can change the default parent circuit breaker limits to reproduce the issue quickly)\r\n- Try hitting `localhost:9200/` on the cluster and it should result in circuit breaker exception similar to the output mentioned in Actual behavior section\r\n\r\n**Provide logs (if relevant)**:\r\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}