{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10244","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10244/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10244/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10244/events","html_url":"https://github.com/elastic/elasticsearch/issues/10244","id":64108165,"node_id":"MDU6SXNzdWU2NDEwODE2NQ==","number":10244,"title":"Scroll broke after upgrade to ES 1.4.4","user":{"login":"ewr","id":204350,"node_id":"MDQ6VXNlcjIwNDM1MA==","avatar_url":"https://avatars2.githubusercontent.com/u/204350?v=4","gravatar_id":"","url":"https://api.github.com/users/ewr","html_url":"https://github.com/ewr","followers_url":"https://api.github.com/users/ewr/followers","following_url":"https://api.github.com/users/ewr/following{/other_user}","gists_url":"https://api.github.com/users/ewr/gists{/gist_id}","starred_url":"https://api.github.com/users/ewr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ewr/subscriptions","organizations_url":"https://api.github.com/users/ewr/orgs","repos_url":"https://api.github.com/users/ewr/repos","events_url":"https://api.github.com/users/ewr/events{/privacy}","received_events_url":"https://api.github.com/users/ewr/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2015-03-24T21:46:25Z","updated_at":"2015-12-05T20:54:51Z","closed_at":"2015-12-05T20:54:51Z","author_association":"NONE","active_lock_reason":null,"body":"We have a script that uses the elasticsearch JS lib to pull sorted results and write log files. It worked great against a cluster running ES 1.4.1 (I think? possibly 1.4.3), but after an upgrade to 1.4.4 it appears to be returning the same results over and over.\n\nInitial request and first result:\n\n```\nElasticsearch DEBUG: 2015-03-24T21:27:39Z\n  starting request { method: 'POST',\n    path: '/streammachine-hls-sessions-2015-03-22/session/_search',\n    body: \n     { query: { filtered: [Object] },\n       sort: [ [Object] ],\n       size: 1000,\n       from: 0 },\n    query: { scroll: '10s' } }\n...\nElasticsearch TRACE: 2015-03-24T21:27:39Z\n  -> POST http://es-scpr-logstash.service.consul:9200/streammachine-hls-sessions-2015-03-22/session/_search?scroll=10s\n...\n  <- 200\n  {\n    \"_scroll_id\": \"cXVlcnlUaGVuRmV0Y2g7MzsxNDEwNTgyMTp5dzVSLXFEUVNxbXRXMHAwMFFvZV9nOzE0MTA1ODIyOnl3NVItcURRU3FtdFcwcDAwUW9lX2c7MTg1MTU5MTg6TjVmR3BlcnhRaXF0VzZKQUVRTmNCdzswOw==\",\n    \"took\": 19,\n    \"timed_out\": false,\n    \"_shards\": {\n      \"total\": 3,\n      \"successful\": 3,\n      \"failed\": 0\n    },\n    \"hits\": {\n      \"total\": 26316,\n      \"max_score\": null,\n      \"hits\": [\n        {\n          \"_index\": \"streammachine-hls-sessions-2015-03-22\",\n          \"_type\": \"session\",\n          \"_id\": \"AUw-zBWy6JcMmvzTK2ST\",\n          \"_score\": null,\n          \"_source\": {\n            \"session_id\": \"7F888D3A-4196-4920-B60E-820AB75D729D\",\n            \"stream\": \"kpcclive\",\n            \"time\": \"2015-03-22T00:00:01.800Z\",\n            \"start_time\": \"2015-03-21T22:57:31.504Z\",\n            \"client\": {\n              \"output\": \"shoutcast\",\n              \"ip\": \"68.105.116.228\",\n              \"path\": \"/kpcclive?ua=SCPRIPAD\",\n              \"ua\": \"SCPRIPAD | AppleCoreMedia/1.0.0.11D257 (iPad; U; CPU OS 7_1_2 like Mac OS X; en_us)\",\n              \"user_id\": \"e55be008-82b1-4b44-a862-a4918aa690af\",\n              \"pass_session\": false,\n              \"session_id\": \"7F888D3A-4196-4920-B60E-820AB75D729D\",\n              \"offsetSecs\": -1,\n              \"meta_int\": 32768\n            },\n            \"kbytes\": 784,\n            \"duration\": 100.57142925262451,\n            \"connected\": 3750.296\n          },\n          \"sort\": [\n            1426982401800\n          ]\n        },\n...\n```\n\nFirst scroll and first result:\n\n```\nElasticsearch TRACE: 2015-03-24T21:27:39Z\n  -> POST http://es-scpr-logstash.service.consul:9200/_search/scroll?scroll=10s\n  cXVlcnlUaGVuRmV0Y2g7MzsxNDEwNTgyMTp5dzVSLXFEUVNxbXRXMHAwMFFvZV9nOzE0MTA1ODIyOnl3NVItcURRU3FtdFcwcDAwUW9lX2c7MTg1MTU5MTg6TjVmR3BlcnhRaXF0VzZKQUVRTmNCdzswOw==\n  <- 200\n  {\n    \"_scroll_id\": \"cXVlcnlUaGVuRmV0Y2g7MzsxNDEwNTgyMTp5dzVSLXFEUVNxbXRXMHAwMFFvZV9nOzE0MTA1ODIyOnl3NVItcURRU3FtdFcwcDAwUW9lX2c7MTg1MTU5MTg6TjVmR3BlcnhRaXF0VzZKQUVRTmNCdzswOw==\",\n    \"took\": 56,\n    \"timed_out\": false,\n    \"_shards\": {\n      \"total\": 3,\n      \"successful\": 3,\n      \"failed\": 0\n    },\n    \"hits\": {\n      \"total\": 26316,\n      \"max_score\": null,\n      \"hits\": [\n        {\n          \"_index\": \"streammachine-hls-sessions-2015-03-22\",\n          \"_type\": \"session\",\n          \"_id\": \"AUw-zBWy6JcMmvzTK2ST\",\n          \"_score\": null,\n          \"_source\": {\n            \"session_id\": \"7F888D3A-4196-4920-B60E-820AB75D729D\",\n            \"stream\": \"kpcclive\",\n            \"time\": \"2015-03-22T00:00:01.800Z\",\n            \"start_time\": \"2015-03-21T22:57:31.504Z\",\n            \"client\": {\n              \"output\": \"shoutcast\",\n              \"ip\": \"68.105.116.228\",\n              \"path\": \"/kpcclive?ua=SCPRIPAD\",\n              \"ua\": \"SCPRIPAD | AppleCoreMedia/1.0.0.11D257 (iPad; U; CPU OS 7_1_2 like Mac OS X; en_us)\",\n              \"user_id\": \"e55be008-82b1-4b44-a862-a4918aa690af\",\n              \"pass_session\": false,\n              \"session_id\": \"7F888D3A-4196-4920-B60E-820AB75D729D\",\n              \"offsetSecs\": -1,\n              \"meta_int\": 32768\n            },\n```\n\nImportantly, it's the same scroll id and the same result set. That repeats each time we try to scroll.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}