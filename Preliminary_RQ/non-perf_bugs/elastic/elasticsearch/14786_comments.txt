[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157733210","html_url":"https://github.com/elastic/elasticsearch/issues/14786#issuecomment-157733210","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14786","id":157733210,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NzczMzIxMA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-18T14:41:48Z","updated_at":"2015-11-18T14:41:48Z","author_association":"CONTRIBUTOR","body":"A few interesting things here:\n-  `_score * 1` is resulting in an integer, which can result in a score of 0 if the score is less than 1\n- `_score * 10000` STILL results in a score of 0\n- `_score * 1.0` works\n- In plain groovy, `_score = 0.94; _score * 1` returns a floating point\n\n@dakrone any ideas what is happening here?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157745401","html_url":"https://github.com/elastic/elasticsearch/issues/14786#issuecomment-157745401","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14786","id":157745401,"node_id":"MDEyOklzc3VlQ29tbWVudDE1Nzc0NTQwMQ==","user":{"login":"larschri","id":77080,"node_id":"MDQ6VXNlcjc3MDgw","avatar_url":"https://avatars3.githubusercontent.com/u/77080?v=4","gravatar_id":"","url":"https://api.github.com/users/larschri","html_url":"https://github.com/larschri","followers_url":"https://api.github.com/users/larschri/followers","following_url":"https://api.github.com/users/larschri/following{/other_user}","gists_url":"https://api.github.com/users/larschri/gists{/gist_id}","starred_url":"https://api.github.com/users/larschri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larschri/subscriptions","organizations_url":"https://api.github.com/users/larschri/orgs","repos_url":"https://api.github.com/users/larschri/repos","events_url":"https://api.github.com/users/larschri/events{/privacy}","received_events_url":"https://api.github.com/users/larschri/received_events","type":"User","site_admin":false},"created_at":"2015-11-18T15:18:01Z","updated_at":"2015-11-18T15:18:01Z","author_association":"NONE","body":"`_score * 10000` - My theory is that _score is casted to integer (zero) before the multiplication takes place.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/157866972","html_url":"https://github.com/elastic/elasticsearch/issues/14786#issuecomment-157866972","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14786","id":157866972,"node_id":"MDEyOklzc3VlQ29tbWVudDE1Nzg2Njk3Mg==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-11-18T21:20:41Z","updated_at":"2015-11-18T21:20:41Z","author_association":"MEMBER","body":"This is because `_score` is an implementation of `Number`, since it wraps around lucene's `Scorer`. Groovy assumes it is an int because it doesn't know otherwise (and so calls `intValue()`).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158031774","html_url":"https://github.com/elastic/elasticsearch/issues/14786#issuecomment-158031774","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14786","id":158031774,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODAzMTc3NA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-19T11:41:15Z","updated_at":"2015-11-19T11:41:15Z","author_association":"CONTRIBUTOR","body":"ah, thanks for the explanation @rjernst.   I don't think this is anything we can fix? So the solution here is to use `1.0` instead.  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158564244","html_url":"https://github.com/elastic/elasticsearch/issues/14786#issuecomment-158564244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14786","id":158564244,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODU2NDI0NA==","user":{"login":"larschri","id":77080,"node_id":"MDQ6VXNlcjc3MDgw","avatar_url":"https://avatars3.githubusercontent.com/u/77080?v=4","gravatar_id":"","url":"https://api.github.com/users/larschri","html_url":"https://github.com/larschri","followers_url":"https://api.github.com/users/larschri/followers","following_url":"https://api.github.com/users/larschri/following{/other_user}","gists_url":"https://api.github.com/users/larschri/gists{/gist_id}","starred_url":"https://api.github.com/users/larschri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larschri/subscriptions","organizations_url":"https://api.github.com/users/larschri/orgs","repos_url":"https://api.github.com/users/larschri/repos","events_url":"https://api.github.com/users/larschri/events{/privacy}","received_events_url":"https://api.github.com/users/larschri/received_events","type":"User","site_admin":false},"created_at":"2015-11-21T00:12:10Z","updated_at":"2015-11-21T00:12:10Z","author_association":"NONE","body":"> ah, thanks for the explanation @rjernst. I don't think this is anything we can fix? So the solution here is to use 1.0 instead.\n\nUsing `1.0` is fine when you are aware of the bug, but the bug is still there. Users expect `_score` to behave like a float, so why not use `float` instead of `ScoreAccessor`? If that's not possible, maybe it works to inherit from `java.math.BigDecimal` instead of `Number`? Elasticsearch could even start every groovy script with `_score = (float) _score;` to fix this.\n\nBTW. This looks like the same problem http://stackoverflow.com/questions/30048963/groovy-numbermath-defaults-to-integermath-for-unkown-number-types\n","performed_via_github_app":null}]