[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/237421387","html_url":"https://github.com/elastic/elasticsearch/issues/19739#issuecomment-237421387","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19739","id":237421387,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNzQyMTM4Nw==","user":{"login":"cheruvian","id":775841,"node_id":"MDQ6VXNlcjc3NTg0MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/775841?v=4","gravatar_id":"","url":"https://api.github.com/users/cheruvian","html_url":"https://github.com/cheruvian","followers_url":"https://api.github.com/users/cheruvian/followers","following_url":"https://api.github.com/users/cheruvian/following{/other_user}","gists_url":"https://api.github.com/users/cheruvian/gists{/gist_id}","starred_url":"https://api.github.com/users/cheruvian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cheruvian/subscriptions","organizations_url":"https://api.github.com/users/cheruvian/orgs","repos_url":"https://api.github.com/users/cheruvian/repos","events_url":"https://api.github.com/users/cheruvian/events{/privacy}","received_events_url":"https://api.github.com/users/cheruvian/received_events","type":"User","site_admin":false},"created_at":"2016-08-04T01:04:41Z","updated_at":"2016-08-04T01:04:41Z","author_association":"NONE","body":"Would also be useful to list (in the same area) the exception or response returned when a request to index to a primary shard for that host is attempted.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239125632","html_url":"https://github.com/elastic/elasticsearch/issues/19739#issuecomment-239125632","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19739","id":239125632,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTEyNTYzMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-08-11T10:32:15Z","updated_at":"2016-08-11T10:32:15Z","author_association":"CONTRIBUTOR","body":"Yes, I think we should probably change this advice.  In fact, it's not even a requirement to increase this timeout.  If the shard starts reallocating and then a node joins with the shard intact, the reallocation should be cancelled.  (not sure what happens with unsync'ed shards).\n\n@ywelsch what do you think?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239147439","html_url":"https://github.com/elastic/elasticsearch/issues/19739#issuecomment-239147439","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19739","id":239147439,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTE0NzQzOQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2016-08-11T12:31:54Z","updated_at":"2016-08-11T12:31:54Z","author_association":"CONTRIBUTOR","body":"@clintongormley The cancelling only works for synced shards. If there has been write activity on the primary while the node was restarted (or 5 minutes prior to the restart with no explicit synced flush), the existing replica allocation is not cancelled. There is certainly room for future improvements in this area.\n\nIf there are writes to be expected on the indices while the node is restarted and it is likely that the node will miss the default delayed timeout, increasing the timeout is a solution. The risk with temporarily increasing the value of `node_left.delayed_timeout` though is to make sure that the setting is properly reset on all indices (it's an index-level setting) once the node has come back. An alternative would be to temporarily deactivate allocation of replicas (`cluster.routing.allocation.enable = primaries`) which is a cluster-level setting. Also note that disabling shard rebalancing (`cluster.routing.rebalance.enable`) might still be useful, which is a different setting than the one recommended by the current documentation (`cluster.routing.allocation.enable`). By only disabling `rebalance`, new indices can still be created (and even go to green) but existing active shards will not be moved around (except for situations where node goes above high disk watermark or filter allocation rules changed in hot/warm setup).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/280745132","html_url":"https://github.com/elastic/elasticsearch/issues/19739#issuecomment-280745132","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19739","id":280745132,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MDc0NTEzMg==","user":{"login":"jmcarp","id":1633460,"node_id":"MDQ6VXNlcjE2MzM0NjA=","avatar_url":"https://avatars0.githubusercontent.com/u/1633460?v=4","gravatar_id":"","url":"https://api.github.com/users/jmcarp","html_url":"https://github.com/jmcarp","followers_url":"https://api.github.com/users/jmcarp/followers","following_url":"https://api.github.com/users/jmcarp/following{/other_user}","gists_url":"https://api.github.com/users/jmcarp/gists{/gist_id}","starred_url":"https://api.github.com/users/jmcarp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jmcarp/subscriptions","organizations_url":"https://api.github.com/users/jmcarp/orgs","repos_url":"https://api.github.com/users/jmcarp/repos","events_url":"https://api.github.com/users/jmcarp/events{/privacy}","received_events_url":"https://api.github.com/users/jmcarp/received_events","type":"User","site_admin":false},"created_at":"2017-02-17T19:33:44Z","updated_at":"2017-02-17T19:33:44Z","author_association":"NONE","body":"Am I understanding correctly that the current best practice for rolling restarts is to fiddle with delay allocation instead of setting `cluster.routing.allocation.enable`?\r\n\r\ncc @cnelson @LinuxBozo","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/334080530","html_url":"https://github.com/elastic/elasticsearch/issues/19739#issuecomment-334080530","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19739","id":334080530,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNDA4MDUzMA==","user":{"login":"tomsommer","id":149171,"node_id":"MDQ6VXNlcjE0OTE3MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/149171?v=4","gravatar_id":"","url":"https://api.github.com/users/tomsommer","html_url":"https://github.com/tomsommer","followers_url":"https://api.github.com/users/tomsommer/followers","following_url":"https://api.github.com/users/tomsommer/following{/other_user}","gists_url":"https://api.github.com/users/tomsommer/gists{/gist_id}","starred_url":"https://api.github.com/users/tomsommer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomsommer/subscriptions","organizations_url":"https://api.github.com/users/tomsommer/orgs","repos_url":"https://api.github.com/users/tomsommer/repos","events_url":"https://api.github.com/users/tomsommer/events{/privacy}","received_events_url":"https://api.github.com/users/tomsommer/received_events","type":"User","site_admin":false},"created_at":"2017-10-04T08:08:09Z","updated_at":"2017-10-04T08:08:09Z","author_association":"NONE","body":"The documentation still hasn't been changed on this, and no agreement has been found.\r\n\r\nTo me, it sounds like `index.unassigned.node_left.delayed_timeout` as a general best-practice should be raised to a enough-time-to-restart-a-server value.\r\n\r\nIs the suggestion per https://github.com/elastic/elasticsearch/issues/19739#issuecomment-239147439 to set `cluster.routing.allocation.enable = primaries` and raise `index.unassigned.node_left.delayed_timeout` when doing rolling updates?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383882532","html_url":"https://github.com/elastic/elasticsearch/issues/19739#issuecomment-383882532","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19739","id":383882532,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Mzg4MjUzMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-24T10:25:42Z","updated_at":"2018-04-24T10:25:42Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385336938","html_url":"https://github.com/elastic/elasticsearch/issues/19739#issuecomment-385336938","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19739","id":385336938,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTMzNjkzOA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T08:19:26Z","updated_at":"2018-04-30T08:19:26Z","author_association":"CONTRIBUTOR","body":"I think the docs are right: it seems appropriate to use `\"cluster.routing.allocation.enable\" : \"none\"` while a node is down for maintenance. I do not think it's a good idea to do maintenance while racing against the `node_left.delayed_timeout` as a matter of course. A rolling restart implies the active involvement of a cluster administrator, who is expected to re-enable allocation manually as appropriate if the maintenance takes longer than anticipated.\r\n\r\nNote that there are some alterations to this area of the docs in flight (#29670, #29671) which continue to recommend using `cluster.routing.allocation.enable`.\r\n\r\nIt could be problematic if rebalancing kicks in while the node is coming back into the cluster. By default rebalancing only has an effect once the cluster is green (`cluster.routing.allocation.allow_rebalance` is `indices_all_active`) but the effects of changing this setting are not very clear. I opened #30248 to fix this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436566141","html_url":"https://github.com/elastic/elasticsearch/issues/19739#issuecomment-436566141","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19739","id":436566141,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjU2NjE0MQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-11-07T09:47:55Z","updated_at":"2018-11-07T09:47:55Z","author_association":"CONTRIBUTOR","body":"I think there's no more action to take on this issue, closing.","performed_via_github_app":null}]