[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/167070060","html_url":"https://github.com/elastic/elasticsearch/issues/15655#issuecomment-167070060","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15655","id":167070060,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NzA3MDA2MA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-12-24T08:46:25Z","updated_at":"2015-12-24T08:46:25Z","author_association":"MEMBER","body":"Indeed the `TopHitsParser` does not seem able to parse query/filters via the `SubSearchContext`, but maybe I am misreading the source. Maybe @martijnvg can clarify here.\n\nThinking if you can try a filter aggregation and nest the top_hits inside of that one?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/167075586","html_url":"https://github.com/elastic/elasticsearch/issues/15655#issuecomment-167075586","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15655","id":167075586,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NzA3NTU4Ng==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-12-24T09:16:59Z","updated_at":"2015-12-24T09:16:59Z","author_association":"MEMBER","body":"@sumitjainn This is for filters and queries that have the `_name` option set in the main query. So hits returned by the `top_hits` agg can included reference to named queries/filters used in the main query.  It isn't possible to add a query/filter to the `top_hits` agg.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/167220364","html_url":"https://github.com/elastic/elasticsearch/issues/15655#issuecomment-167220364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15655","id":167220364,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NzIyMDM2NA==","user":{"login":"sumitjainn","id":657557,"node_id":"MDQ6VXNlcjY1NzU1Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/657557?v=4","gravatar_id":"","url":"https://api.github.com/users/sumitjainn","html_url":"https://github.com/sumitjainn","followers_url":"https://api.github.com/users/sumitjainn/followers","following_url":"https://api.github.com/users/sumitjainn/following{/other_user}","gists_url":"https://api.github.com/users/sumitjainn/gists{/gist_id}","starred_url":"https://api.github.com/users/sumitjainn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sumitjainn/subscriptions","organizations_url":"https://api.github.com/users/sumitjainn/orgs","repos_url":"https://api.github.com/users/sumitjainn/repos","events_url":"https://api.github.com/users/sumitjainn/events{/privacy}","received_events_url":"https://api.github.com/users/sumitjainn/received_events","type":"User","site_admin":false},"created_at":"2015-12-25T10:26:01Z","updated_at":"2015-12-25T10:26:24Z","author_association":"NONE","body":"Thanks for clearing it up @martijnvg. @spinscale Yes, indeed, filter aggregations does the trick, was just curious about the correctness of the documentation.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/167226120","html_url":"https://github.com/elastic/elasticsearch/issues/15655#issuecomment-167226120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15655","id":167226120,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NzIyNjEyMA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-12-25T12:19:31Z","updated_at":"2015-12-25T12:19:31Z","author_association":"MEMBER","body":"thx for responding. closing then!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/251913236","html_url":"https://github.com/elastic/elasticsearch/issues/15655#issuecomment-251913236","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15655","id":251913236,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTkxMzIzNg==","user":{"login":"digitalkaoz","id":293591,"node_id":"MDQ6VXNlcjI5MzU5MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/293591?v=4","gravatar_id":"","url":"https://api.github.com/users/digitalkaoz","html_url":"https://github.com/digitalkaoz","followers_url":"https://api.github.com/users/digitalkaoz/followers","following_url":"https://api.github.com/users/digitalkaoz/following{/other_user}","gists_url":"https://api.github.com/users/digitalkaoz/gists{/gist_id}","starred_url":"https://api.github.com/users/digitalkaoz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/digitalkaoz/subscriptions","organizations_url":"https://api.github.com/users/digitalkaoz/orgs","repos_url":"https://api.github.com/users/digitalkaoz/repos","events_url":"https://api.github.com/users/digitalkaoz/events{/privacy}","received_events_url":"https://api.github.com/users/digitalkaoz/received_events","type":"User","site_admin":false},"created_at":"2016-10-06T09:34:53Z","updated_at":"2016-10-06T09:34:53Z","author_association":"NONE","body":"@sumitjainn can you post an example here? trying to do some filtering on the docs of a top_hits aggregation, but didnt have any luck here... maybe @spinscale has an opinion too?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/288585778","html_url":"https://github.com/elastic/elasticsearch/issues/15655#issuecomment-288585778","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15655","id":288585778,"node_id":"MDEyOklzc3VlQ29tbWVudDI4ODU4NTc3OA==","user":{"login":"dukenguyen","id":4584127,"node_id":"MDQ6VXNlcjQ1ODQxMjc=","avatar_url":"https://avatars0.githubusercontent.com/u/4584127?v=4","gravatar_id":"","url":"https://api.github.com/users/dukenguyen","html_url":"https://github.com/dukenguyen","followers_url":"https://api.github.com/users/dukenguyen/followers","following_url":"https://api.github.com/users/dukenguyen/following{/other_user}","gists_url":"https://api.github.com/users/dukenguyen/gists{/gist_id}","starred_url":"https://api.github.com/users/dukenguyen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dukenguyen/subscriptions","organizations_url":"https://api.github.com/users/dukenguyen/orgs","repos_url":"https://api.github.com/users/dukenguyen/repos","events_url":"https://api.github.com/users/dukenguyen/events{/privacy}","received_events_url":"https://api.github.com/users/dukenguyen/received_events","type":"User","site_admin":false},"created_at":"2017-03-23T00:58:28Z","updated_at":"2017-03-23T00:58:28Z","author_association":"NONE","body":"I'm also unable to do this.  @sumitjainn or @spinscale , do you have an example please?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/318068338","html_url":"https://github.com/elastic/elasticsearch/issues/15655#issuecomment-318068338","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15655","id":318068338,"node_id":"MDEyOklzc3VlQ29tbWVudDMxODA2ODMzOA==","user":{"login":"itaydvir","id":10347224,"node_id":"MDQ6VXNlcjEwMzQ3MjI0","avatar_url":"https://avatars3.githubusercontent.com/u/10347224?v=4","gravatar_id":"","url":"https://api.github.com/users/itaydvir","html_url":"https://github.com/itaydvir","followers_url":"https://api.github.com/users/itaydvir/followers","following_url":"https://api.github.com/users/itaydvir/following{/other_user}","gists_url":"https://api.github.com/users/itaydvir/gists{/gist_id}","starred_url":"https://api.github.com/users/itaydvir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itaydvir/subscriptions","organizations_url":"https://api.github.com/users/itaydvir/orgs","repos_url":"https://api.github.com/users/itaydvir/repos","events_url":"https://api.github.com/users/itaydvir/events{/privacy}","received_events_url":"https://api.github.com/users/itaydvir/received_events","type":"User","site_admin":false},"created_at":"2017-07-26T14:22:31Z","updated_at":"2017-07-26T14:22:31Z","author_association":"NONE","body":"@digitalkaoz @dukenguyen - i think they meant to wrap it with filter aggregation.\r\nThis is what i did:\r\n```json\r\n\"aggregations\": {\r\n\t\"last_document_of_specific_doc_types\": {\r\n\t\t\"filter\": {\r\n\t\t\t\"terms\": {\r\n\t\t\t\t\"doc_types\": [161, 162]\r\n\t\t\t}\r\n\t\t},\r\n\t\t\"aggregations\": {\r\n\t\t\t\"latest\": {\r\n\t\t\t\t\"top_hits\": {\r\n\t\t\t\t\t\"size\": 1,\r\n\t\t\t\t\t\"_source\": [\r\n\t\t\t\t\t\t\"creationDate\"\r\n\t\t\t\t\t],\r\n\t\t\t\t\t\"sort\": {\r\n\t\t\t\t\t\t\"creationDate\": \"desc\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383379031","html_url":"https://github.com/elastic/elasticsearch/issues/15655#issuecomment-383379031","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15655","id":383379031,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MzM3OTAzMQ==","user":{"login":"nick250386","id":10647579,"node_id":"MDQ6VXNlcjEwNjQ3NTc5","avatar_url":"https://avatars3.githubusercontent.com/u/10647579?v=4","gravatar_id":"","url":"https://api.github.com/users/nick250386","html_url":"https://github.com/nick250386","followers_url":"https://api.github.com/users/nick250386/followers","following_url":"https://api.github.com/users/nick250386/following{/other_user}","gists_url":"https://api.github.com/users/nick250386/gists{/gist_id}","starred_url":"https://api.github.com/users/nick250386/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nick250386/subscriptions","organizations_url":"https://api.github.com/users/nick250386/orgs","repos_url":"https://api.github.com/users/nick250386/repos","events_url":"https://api.github.com/users/nick250386/events{/privacy}","received_events_url":"https://api.github.com/users/nick250386/received_events","type":"User","site_admin":false},"created_at":"2018-04-22T12:46:32Z","updated_at":"2018-04-22T12:48:02Z","author_association":"NONE","body":"@itaydvir \r\nIf I want to access a field from the result returned by top_hits:(example below)\r\n\r\n```\r\n\"aggregations\": {\r\n    \"last_document_of_specific_doc_types\": {\r\n        \"filter\": {\r\n            \"terms\": {\r\n                \"doc_types\": [\r\n                    161,\r\n                    162\r\n                ]\r\n            }\r\n        },\r\n        \"aggregations\": {\r\n            \"latest\": {\r\n                \"top_hits\": {\r\n                    \"size\": 1,\r\n                    \"_source\": [\r\n                        \"creationDate\",\r\n                        \"required\"\r\n                    ],\r\n                    \"sort\": {\r\n                        \"creationDate\": \"desc\"\r\n                    },\r\n                    \"script_fields\": {\r\n                        \"reqd_flag\": {\r\n                            \"script\": {\r\n                                \"lang\": \"painless\",\r\n                                \"inline\": \"params['_source']['required'] == 'Y' ? 0 : 1\"\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nHow can I access the source field \"required\" or the scripted field \"reqd_flag\" outside this aggregation ? If not, then can you suggest an alternative to this. Am I missing or doing something wrong ?","performed_via_github_app":null}]