{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34358","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34358/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34358/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34358/events","html_url":"https://github.com/elastic/elasticsearch/issues/34358","id":367778260,"node_id":"MDU6SXNzdWUzNjc3NzgyNjA=","number":34358,"title":"Fuzzy searching on shingles filter getting problem","user":{"login":"galichavishal","id":43958329,"node_id":"MDQ6VXNlcjQzOTU4MzI5","avatar_url":"https://avatars1.githubusercontent.com/u/43958329?v=4","gravatar_id":"","url":"https://api.github.com/users/galichavishal","html_url":"https://github.com/galichavishal","followers_url":"https://api.github.com/users/galichavishal/followers","following_url":"https://api.github.com/users/galichavishal/following{/other_user}","gists_url":"https://api.github.com/users/galichavishal/gists{/gist_id}","starred_url":"https://api.github.com/users/galichavishal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/galichavishal/subscriptions","organizations_url":"https://api.github.com/users/galichavishal/orgs","repos_url":"https://api.github.com/users/galichavishal/repos","events_url":"https://api.github.com/users/galichavishal/events{/privacy}","received_events_url":"https://api.github.com/users/galichavishal/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-10-08T12:58:54Z","updated_at":"2018-10-09T13:39:59Z","closed_at":"2018-10-09T13:39:59Z","author_association":"NONE","active_lock_reason":null,"body":"Query: How to apply fuzziness on every token produced by shingles filter?\r\n\r\nBelow is my created mapping:\r\n{\r\n\"settings\":{\r\n\"index\":{\r\n\"number_of_shards\" : 1,\r\n\"number_of_replicas\" : 0 ,\r\n\"analysis\":{\r\n\"filter\": {\r\n\"my_synonym_filter\": {\r\n\"type\": \"synonym\",\r\n\"tokenizer\" : \"standard\",\r\n\"synonyms\":[\r\n\"nwm,northwestern mutual wealth management=> northwestern mutual wealth management\"\r\n]\r\n},\r\n\"filter_shingle\":{\r\n\"type\":\"shingle\",\r\n\"tokenizer\" : \"standard\",\r\n\"max_shingle_size\":10,\r\n\"min_shingle_size\":2,\r\n\"output_unigrams\":\"true\"\r\n}\r\n},\r\n\"analyzer\":{\r\n\"analyzer_case_insensitive\":{\r\n\"tokenizer\": \"keyword\",\r\n\"filter\":[ \"lowercase\",\"my_synonym_filter\"]\r\n},\r\n\"analyzer_shingle\":{\r\n\"tokenizer\": \"standard\",\r\n\"filter\":[ \"lowercase\",\"my_synonym_filter\",\"filter_shingle\"]\r\n}\r\n}\r\n}\r\n},\r\n\"index.mapping.total_fields.limit\": 9000000000000000000\r\n},\r\n\"mappings\" : {\r\n\"docs\" : {\r\n\"properties\" : {\r\n\"aliases\" : {\r\n\"type\" : \"text\",\r\n\"analyzer\":\"analyzer_case_insensitive\",\r\n\"search_analyzer\":\"analyzer_shingle\",\r\n\"fields\" : {\r\n\"text\" : {\r\n\"type\" : \"keyword\",\r\n\"ignore_above\" : 256\r\n}\r\n}\r\n},\r\n{\r\n\"not_recognized\" : {\r\n\"type\" : \"text\",\r\n\"fields\" : {\r\n\"keyword\" : {\r\n\"type\" : \"keyword\",\r\n\"ignore_above\" : 256\r\n}\r\n}\r\n},\r\n\"tagName\" : {\r\n\"type\" : \"text\",\r\n\"fields\" : {\r\n\"keyword\" : {\r\n\"type\" : \"keyword\",\r\n\"ignore_above\" : 256\r\n}\r\n}\r\n}\r\n}\r\n}\r\n}\r\n}\r\n\r\nBelow is my query:\r\n{\r\n\"query\": {\r\n\"bool\": {\r\n\"should\": [\r\n{\r\n\"bool\": {\r\n\"should\": [\r\n{\r\n\"match\": {\r\n\"aliases\":\r\n{\r\n\"query\": \"nwm sals\",\r\n\"fuzziness\": 2\r\n}\r\n}\r\n}\r\n]\r\n}\r\n}\r\n]}\r\n}}\r\n\r\nso from above query shingles filter produces combination of words from the statement \"northwestern mutual wealth management sals\"\r\n\r\nso i am expecting to apply fuzziness on each token produced by shingles filter and display the results according.\r\nI am using elasticsearch 5.4.0 version\r\nhere from my query fuzziness is not getting applied on any token ..am i missing something?\r\n\r\nPlease let me know about this as i am stuck into it.","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}