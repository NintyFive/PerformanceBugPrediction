{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21041/events","html_url":"https://github.com/elastic/elasticsearch/issues/21041","id":184237958,"node_id":"MDU6SXNzdWUxODQyMzc5NTg=","number":21041,"title":"Can't use `~/.aws/credentials` file with discovery-ec2 plugin","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"labels":[{"id":160579278,"node_id":"MDU6TGFiZWwxNjA1NzkyNzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Discovery-Plugins","name":":Distributed/Discovery-Plugins","color":"0e8a16","default":false,"description":"Anything related to our integration plugins with EC2, GCP and Azure"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"assignees":[{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2016-10-20T14:00:48Z","updated_at":"2018-02-13T19:49:44Z","closed_at":"2017-01-16T09:31:38Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**: 5.0.0\n**Plugins installed**: `discovery-ec2`\n\nWhile I was working on #21039, I observed that loading key/secret from the default location `~/.aws/credentials` is not possible.\n\n```\n[2016-10-20T13:42:07,749][DEBUG][c.a.a.AWSCredentialsProviderChain] Unable to load credentials from com.amazonaws.auth.profile.ProfileCredentialsProvider@bcbbaf: access denied (\"java.io.FilePermission\" \"/home/ubuntu/.aws/credentials\" \"read\")\n```\n\nI tried to work around this and added the following lines in `plugin-security.policy` file but it still does not work:\n\n```\ngrant {\n  // AWS ProfileCredentialsProvider needs read access to this dir ~/.aws/credentials\n  permission java.io.FilePermission \"~/.aws/credentials\", \"read\";\n};\n```\n\nI also tried with the following (just for testing purpose) and it is also failing:\n\n```\ngrant {\n  // AWS ProfileCredentialsProvider needs read access to this dir ~/.aws/credentials\n  permission java.io.FilePermission \"/home/ubuntu/.aws/credentials\", \"read\";\n};\n```\n\nI wrap the code with:\n\n``` java\n            SecurityManager sm = System.getSecurityManager();\n            if (sm != null) {\n                // unprivileged code such as scripts do not have SpecialPermission\n                sm.checkPermission(new SpecialPermission());\n            }\n            descInstances = AccessController.doPrivileged(new PrivilegedAction<DescribeInstancesResult>() {\n                @Override\n                public DescribeInstancesResult run() {\n                    return client.describeInstances(buildDescribeInstancesRequest());\n                }\n            });\n```\n\nI'm unsure if this is supposed to work or if we simply can't support this authentification method anymore.\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}