{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15690","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15690/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15690/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15690/events","html_url":"https://github.com/elastic/elasticsearch/issues/15690","id":124163761,"node_id":"MDU6SXNzdWUxMjQxNjM3NjE=","number":15690,"title":"Snapshot not failing gracefully when disk quota exceeded","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-12-29T04:58:10Z","updated_at":"2016-01-19T08:22:27Z","closed_at":"2016-01-19T08:22:27Z","author_association":"MEMBER","active_lock_reason":null,"body":"Have a scenario (ES 1.7.1) in the field where the disk quota is exceeded (OpenVZ).  As a result, the snapshot failed shortly after initialization:\n\n```\n[2015-12-20 20:00:41,479][WARN ][snapshots                ] [node_name] failed to create snapshot [full_snap:2015_12_20_20_00_02]\norg.elasticsearch.snapshots.SnapshotCreationException: [full_snap:2015_12_20_20_00_02] failed to create snapshot\n    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.initializeSnapshot(BlobStoreRepository.java:260)\n    at org.elasticsearch.snapshots.SnapshotsService.beginSnapshot(SnapshotsService.java:290)\n    at org.elasticsearch.snapshots.SnapshotsService.access$600(SnapshotsService.java:92)\n    at org.elasticsearch.snapshots.SnapshotsService$1$1.run(SnapshotsService.java:211)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.io.FileNotFoundException: /es_snapshots/indices/index_name/snapshot-2015_12_20_20_00_02 (Disk quota exceeded)\n    at java.io.FileOutputStream.open(Native Method)\n    at java.io.FileOutputStream.<init>(FileOutputStream.java:221)\n    at java.io.FileOutputStream.<init>(FileOutputStream.java:171)\n    at org.elasticsearch.common.blobstore.fs.FsBlobContainer.createOutput(FsBlobContainer.java:93)\n    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.initializeSnapshot(BlobStoreRepository.java:247)\n    ... 6 more\n```\n\nHowever, it status remains in_progress status instead of gracefully recovering and reporting an error:\n\n```\n{\"snapshots\":[{\"snapshot\":\"2015_12_20_20_00_02\",\"version_id\":1070199,\"version\":\"1.7.1\",\"indices\":[\"list_of_indices],\"state\":\"IN_PROGRESS\",\"start_time\":\"2015-12-21T04:00:02.952Z\",\"start_time_in_millis\":1450670402952,\"failures\":[],\"shards\":{\"total\":0,\"failed\":0,\"successful\":0}}]}\n```\n\n1450670402952 = 12/20/2015, 8:00:02 PM (local time)\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}