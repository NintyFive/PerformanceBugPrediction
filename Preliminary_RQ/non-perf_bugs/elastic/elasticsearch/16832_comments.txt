[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/189574377","html_url":"https://github.com/elastic/elasticsearch/issues/16832#issuecomment-189574377","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832","id":189574377,"node_id":"MDEyOklzc3VlQ29tbWVudDE4OTU3NDM3Nw==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2016-02-27T04:18:22Z","updated_at":"2016-02-27T04:18:22Z","author_association":"CONTRIBUTOR","body":"Thanks for the report @amscotti. A couple follow up questions:\n1. did you reindex your data?\n2. can you post your `geo_point` mapping?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/189735033","html_url":"https://github.com/elastic/elasticsearch/issues/16832#issuecomment-189735033","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832","id":189735033,"node_id":"MDEyOklzc3VlQ29tbWVudDE4OTczNTAzMw==","user":{"login":"amscotti","id":598958,"node_id":"MDQ6VXNlcjU5ODk1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/598958?v=4","gravatar_id":"","url":"https://api.github.com/users/amscotti","html_url":"https://github.com/amscotti","followers_url":"https://api.github.com/users/amscotti/followers","following_url":"https://api.github.com/users/amscotti/following{/other_user}","gists_url":"https://api.github.com/users/amscotti/gists{/gist_id}","starred_url":"https://api.github.com/users/amscotti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amscotti/subscriptions","organizations_url":"https://api.github.com/users/amscotti/orgs","repos_url":"https://api.github.com/users/amscotti/repos","events_url":"https://api.github.com/users/amscotti/events{/privacy}","received_events_url":"https://api.github.com/users/amscotti/received_events","type":"User","site_admin":false},"created_at":"2016-02-27T21:47:24Z","updated_at":"2016-02-27T21:47:24Z","author_association":"NONE","body":"@nknize Thanks for the reply! This is a fully new Elasticsearch setup using Docker to isolate this issue. Following the steps to reproduce we'll create a new index and attempt to percolate a document. Using 2.1.2, the percolation will succeed where in version 2.2.0 you will get a NullPointerException error from the server. Also, the issue isn't just in the Docker image, it also happens on my MacBook running OS X 10.11.3. So I don't think the issue is related to the set up.\n\nThe mapping is included in the steps to reproduce as part of the curl command, but here it is pulled out.\n\n``` json\n{\n   \"mappings\":{\n      \".percolator\":{\n         \"dynamic\":true,\n         \"properties\":{\n            \"id\":{\n               \"type\":\"integer\"\n            }\n         }\n      },\n      \"test\":{\n         \"properties\":{\n            \"location\":{\n               \"type\":\"geo_point\",\n               \"lat_lon\":true\n            }\n         }\n      }\n   }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/189840471","html_url":"https://github.com/elastic/elasticsearch/issues/16832#issuecomment-189840471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832","id":189840471,"node_id":"MDEyOklzc3VlQ29tbWVudDE4OTg0MDQ3MQ==","user":{"login":"Schartoym","id":17512904,"node_id":"MDQ6VXNlcjE3NTEyOTA0","avatar_url":"https://avatars1.githubusercontent.com/u/17512904?v=4","gravatar_id":"","url":"https://api.github.com/users/Schartoym","html_url":"https://github.com/Schartoym","followers_url":"https://api.github.com/users/Schartoym/followers","following_url":"https://api.github.com/users/Schartoym/following{/other_user}","gists_url":"https://api.github.com/users/Schartoym/gists{/gist_id}","starred_url":"https://api.github.com/users/Schartoym/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Schartoym/subscriptions","organizations_url":"https://api.github.com/users/Schartoym/orgs","repos_url":"https://api.github.com/users/Schartoym/repos","events_url":"https://api.github.com/users/Schartoym/events{/privacy}","received_events_url":"https://api.github.com/users/Schartoym/received_events","type":"User","site_admin":false},"created_at":"2016-02-28T11:01:46Z","updated_at":"2016-02-28T11:01:46Z","author_association":"NONE","body":"Confirm same issue on Windows\n**Elasticsearch version**: 2.2.0\n**OS version**: Windows Server 2012\nMappings:\n\n``` javascript\n{\n   \"mappings\":{\n      \".percolator\":{\n         \"properties\": {\n          \"query\": {\n            \"type\": \"object\",\n            \"enabled\": false\n          }\n        }\n      },\n      \"test\":{\n         \"properties\":{\n            \"location\":{\n               \"type\":\"geo_point\",\n            }\n         }\n      }\n   }\n}\n```\n\nPercolation Query:\n\n``` javascript\n{\n  \"_index\": \"test\",\n  \"_type\": \".percolator\",\n  \"_id\": \"550858\",\n  \"_version\": 1,\n  \"found\": true,\n  \"_source\": {\n    \"query\": {\n      \"bool\": {\n        \"must\": [          \n          {\n            \"geo_polygon\": {\n              \"location\": {\n                \"points\": [\n                  {\n                    \"lat\": 55.8118391906254,\n                    \"lon\": 37.526867226289\n                  },\n                  {\n                    \"lat\": 55.8081657829831,\n                    \"lon\": 37.5251506260451\n                  },\n                  {\n                    \"lat\": 55.8081326519671,\n                    \"lon\": 37.5251464834297\n                  },\n                  {\n                    \"lat\": 55.8023318307023,\n                    \"lon\": 37.5263481363022\n                  },\n                  {\n                    \"lat\": 55.8022898138136,\n                    \"lon\": 37.5263769973219\n                  },\n                  {\n                    \"lat\": 55.7981320290787,\n                    \"lon\": 37.5316985066514\n                  },\n                  {\n                    \"lat\": 55.7981018643375,\n                    \"lon\": 37.5317651671351\n                  },\n                  {\n                    \"lat\": 55.7929765434144,\n                    \"lon\": 37.5530511410252\n                  },\n                  {\n                    \"lat\": 55.792969394719,\n                    \"lon\": 37.5531051836136\n                  },\n                  {\n                    \"lat\": 55.7924858389984,\n                    \"lon\": 37.568554672078\n                  },\n                  {\n                    \"lat\": 55.792516839275,\n                    \"lon\": 37.5686842702771\n                  },\n                  {\n                    \"lat\": 55.7982298947502,\n                    \"lon\": 37.5774733801441\n                  },\n                  {\n                    \"lat\": 55.7968776363261,\n                    \"lon\": 37.5790737397055\n                  },\n                  {\n                    \"lat\": 55.7969071958654,\n                    \"lon\": 37.5793619663257\n                  },\n                  {\n                    \"lat\": 55.7994213421139,\n                    \"lon\": 37.5803919440669\n                  },\n                  {\n                    \"lat\": 55.7994746916239,\n                    \"lon\": 37.580384677184\n                  },\n                  {\n                    \"lat\": 55.8009250884466,\n                    \"lon\": 37.5793547135494\n                  },\n                  {\n                    \"lat\": 55.8009637661386,\n                    \"lon\": 37.5793021078072\n                  },\n                  {\n                    \"lat\": 55.8080215965125,\n                    \"lon\": 37.5624792790697\n                  },\n                  {\n                    \"lat\": 55.8080344294469,\n                    \"lon\": 37.5624365225948\n                  },\n                  {\n                    \"lat\": 55.8138344258045,\n                    \"lon\": 37.5329107092988\n                  },\n                  {\n                    \"lat\": 55.8138269869868,\n                    \"lon\": 37.5327768801379\n                  },\n                  {\n                    \"lat\": 55.8118937516748,\n                    \"lon\": 37.5269403857461\n                  },\n                  {\n                    \"lat\": 55.8118391906254,\n                    \"lon\": 37.526867226289\n                  }\n                ]\n              }\n            }\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\nDocument percolation\n\n``` javascript\nGET test/test/_percolate\n{\n  \"doc\":{\n    \"location\":{\n      \"lon\": -71.0875,\n      \"lat\": 42.3575\n    }\n  }\n}\n```\n\nI've tested same query on Elastic 2.1.2 and it's works correctly\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/192352297","html_url":"https://github.com/elastic/elasticsearch/issues/16832#issuecomment-192352297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832","id":192352297,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MjM1MjI5Nw==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2016-03-04T16:46:40Z","updated_at":"2016-03-04T16:46:40Z","author_association":"CONTRIBUTOR","body":"So the problem is Lucene's `MemoryIndex` does not support DocValues, and the new GeoPointField requires DocValues for post filtering.  @martijnvg will open a separate issue to add DocValue support and we will reference it on this issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/196712971","html_url":"https://github.com/elastic/elasticsearch/issues/16832#issuecomment-196712971","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832","id":196712971,"node_id":"MDEyOklzc3VlQ29tbWVudDE5NjcxMjk3MQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-03-15T08:22:34Z","updated_at":"2016-03-15T08:22:34Z","author_association":"MEMBER","body":"This is the issue that adds doc values support to the MemoryIndex: https://issues.apache.org/jira/browse/LUCENE-7091\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/197329289","html_url":"https://github.com/elastic/elasticsearch/issues/16832#issuecomment-197329289","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832","id":197329289,"node_id":"MDEyOklzc3VlQ29tbWVudDE5NzMyOTI4OQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-03-16T13:29:00Z","updated_at":"2016-03-16T13:29:00Z","author_association":"MEMBER","body":"Doc values support to the MemoryIndex has been added and will be included in the Lucene 6.0 release (which hasn't been released yet). Elasticsearch 5.0 will depend on this, so from 5.0 this issue is fixed.\n\nI opened #17105 to backport / fork the fix in 2.x, but there are concerns with forking Memory index and we should not do that.\n\nLuckily there is a workaround for this issue which can help anyone running into this issue. This problems mentioned in this issue only happen if the new geo query implementing are used. We still use the old geo query implementations for indices created before 2.2.0. There is an index setting (`index.version.created`) that we can use to let ES think an index was created on a cluster that ran with an older ES version. If we set it to a version < 2.2.0 then ES uses the older geo query implementations (only for the index we set this created version for).\n\nNote1: You shouldn't set this setting on already created indices before the upgrade to > 2.2. Only for new percolator indices (after to upgrade to > 2.2).\nNote2: Only set this setting on indices that hold your percolator queries. Using this setting on all indices, would mean you can't benefit from geo improvements when running regular searches. If your percolator queries co-exist in the same index holding your data then you should move your percolator queries into a dedicated index.\n\nI this case we can set `index.version.created` to `2010299` (version id of version 2.1.2) and `geo_bounding_box`, `geo_polygon` and other geo queries will work as they did before ES 2.2 in the percolator. Example based on the initial post:\n\n```\ncurl -XPUT \"http://localhost:9200/test\" -d'\n{\n  \"settings\": {\n    \"index.version.created\" : 2010299\n  }, \n  \"mappings\": {\n    \".percolator\": {\n      \"dynamic\": true,\n      \"properties\": {\n        \"id\": {\n          \"type\": \"integer\"\n        }\n      }\n    },\n    \"test\": {\n      \"properties\": {\n        \"location\": {\n          \"type\": \"geo_point\",\n          \"lat_lon\": true\n        }\n      }\n    }\n  }\n}'\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311645919","html_url":"https://github.com/elastic/elasticsearch/issues/16832#issuecomment-311645919","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16832","id":311645919,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTY0NTkxOQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-28T12:32:28Z","updated_at":"2017-06-28T12:32:28Z","author_association":"MEMBER","body":"Closing this issue as it has been fixed from 5.0 and beyond.","performed_via_github_app":null}]