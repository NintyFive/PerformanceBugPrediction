[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376034872","html_url":"https://github.com/elastic/elasticsearch/issues/23329#issuecomment-376034872","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23329","id":376034872,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjAzNDg3Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T03:14:35Z","updated_at":"2018-03-26T03:14:35Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/394442437","html_url":"https://github.com/elastic/elasticsearch/issues/23329#issuecomment-394442437","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23329","id":394442437,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NDQ0MjQzNw==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-06-04T17:53:42Z","updated_at":"2018-06-04T17:53:42Z","author_association":"CONTRIBUTOR","body":"We discussed it, and decided to add another optional parameter to the `top_hits` aggregation - `query`.  And it will be for this `query` that the top hits in `top_hits` aggregation will be returned. This parameter will be compulsory in the nested context, but will be optional in no-nested context.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/395744407","html_url":"https://github.com/elastic/elasticsearch/issues/23329#issuecomment-395744407","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23329","id":395744407,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NTc0NDQwNw==","user":{"login":"volodymyrpavlenko","id":8375248,"node_id":"MDQ6VXNlcjgzNzUyNDg=","avatar_url":"https://avatars2.githubusercontent.com/u/8375248?v=4","gravatar_id":"","url":"https://api.github.com/users/volodymyrpavlenko","html_url":"https://github.com/volodymyrpavlenko","followers_url":"https://api.github.com/users/volodymyrpavlenko/followers","following_url":"https://api.github.com/users/volodymyrpavlenko/following{/other_user}","gists_url":"https://api.github.com/users/volodymyrpavlenko/gists{/gist_id}","starred_url":"https://api.github.com/users/volodymyrpavlenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/volodymyrpavlenko/subscriptions","organizations_url":"https://api.github.com/users/volodymyrpavlenko/orgs","repos_url":"https://api.github.com/users/volodymyrpavlenko/repos","events_url":"https://api.github.com/users/volodymyrpavlenko/events{/privacy}","received_events_url":"https://api.github.com/users/volodymyrpavlenko/received_events","type":"User","site_admin":false},"created_at":"2018-06-08T12:22:50Z","updated_at":"2018-06-08T12:22:50Z","author_association":"NONE","body":"Sounds really great! Could you give a guess how this will affect performance? Will the same query run multiple times, once during the query phase and once during the aggregation phase?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/396901227","html_url":"https://github.com/elastic/elasticsearch/issues/23329#issuecomment-396901227","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23329","id":396901227,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NjkwMTIyNw==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-06-13T11:12:21Z","updated_at":"2018-06-13T11:12:21Z","author_association":"CONTRIBUTOR","body":"@volodymyrpavlenko  I think your problem could be solved without even introducing any modifications to the code, but just using `rescore`. Can you add `rescore` to your query without any parameter, and see if it addresses your problem (it does for me), something like this:\r\n\r\n```json\r\n\"query\": {\r\n  \"query\": {\r\n    \"nested\": {\r\n      \"query\": {\r\n        \"match\": {\r\n          \"children.name\": {\r\n            \"query\": \"<free-text-search>\",\r\n            \"type\": \"boolean\",\r\n            \"operator\": \"AND\",\r\n            \"analyzer\": \"standard\",\r\n            \"boost\": 1.0\r\n          }\r\n        }\r\n      },\r\n      \"path\": \"children\"\r\n    }\r\n  }\r\n},\r\n\"rescore\" : {\r\n  \"query\" : {\r\n    \"rescore_query\" : {\r\n      \"match\": {\r\n          \"children.name\": {\r\n            \"query\": \"<free-text-search>\",\r\n            \"type\": \"boolean\",\r\n            \"operator\": \"AND\",\r\n            \"analyzer\": \"standard\",\r\n            \"boost\": 1.0\r\n          }\r\n        }\r\n    },\r\n    \"query_weight\" : 0,\r\n    \"rescore_query_weight\" : 1\r\n  }\r\n}\r\n```\r\n\r\nThen the nested docs in the `top_hits` agg should be rescored with only nested query.\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407286479","html_url":"https://github.com/elastic/elasticsearch/issues/23329#issuecomment-407286479","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23329","id":407286479,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzI4NjQ3OQ==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T05:34:16Z","updated_at":"2018-07-24T05:34:16Z","author_association":"CONTRIBUTOR","body":"Hi @volodymyrpavlenko did you have the chance to check this out? We would like to know whether the proposed solution works for you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414203375","html_url":"https://github.com/elastic/elasticsearch/issues/23329#issuecomment-414203375","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23329","id":414203375,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDIwMzM3NQ==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-08-20T05:46:17Z","updated_at":"2018-08-20T05:46:17Z","author_association":"CONTRIBUTOR","body":"No further feedback received. @volodymyrpavlenko let us know if you get to check this out and we can look at re-opening this issue.","performed_via_github_app":null}]