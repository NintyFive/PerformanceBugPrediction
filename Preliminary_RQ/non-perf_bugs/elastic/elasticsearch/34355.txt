{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34355","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34355/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34355/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34355/events","html_url":"https://github.com/elastic/elasticsearch/issues/34355","id":367744946,"node_id":"MDU6SXNzdWUzNjc3NDQ5NDY=","number":34355,"title":"Combinining proximity search and other operators for complex entities","user":{"login":"pauturvalles","id":39550076,"node_id":"MDQ6VXNlcjM5NTUwMDc2","avatar_url":"https://avatars2.githubusercontent.com/u/39550076?v=4","gravatar_id":"","url":"https://api.github.com/users/pauturvalles","html_url":"https://github.com/pauturvalles","followers_url":"https://api.github.com/users/pauturvalles/followers","following_url":"https://api.github.com/users/pauturvalles/following{/other_user}","gists_url":"https://api.github.com/users/pauturvalles/gists{/gist_id}","starred_url":"https://api.github.com/users/pauturvalles/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pauturvalles/subscriptions","organizations_url":"https://api.github.com/users/pauturvalles/orgs","repos_url":"https://api.github.com/users/pauturvalles/repos","events_url":"https://api.github.com/users/pauturvalles/events{/privacy}","received_events_url":"https://api.github.com/users/pauturvalles/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-10-08T11:23:15Z","updated_at":"2018-10-09T13:34:33Z","closed_at":"2018-10-09T13:34:33Z","author_association":"NONE","active_lock_reason":null,"body":"I need help with a query in ES. I'm doing a Google-type search engine with ES (so I'm using query_string queries with the queries directly extracted from the search text box that the user gets to write in), and it has to have a particular syntax for the queries:\r\n\r\n_((black or afro$ or African$) adj2 (kid or kids or infant$ or pediatric$ or paedriatic$ or child$ or neonatal$ or newborn$ or adolescen$ or girl$ or boy$)).ti,ab_\r\n\r\n$ is the wildcard * in ES\r\nor and the different parenthesis work as one should expect\r\n.ti,ab is a way to represent the fields to search (fi for \"field\" and ab for \"abstract\")\r\n\r\nThese 3 previous requirements are fulfilled with ES syntax in the query string queries. However, adj2 refers to proximity search, where the result of preceding and following clauses (both grouped with parentheses in this case) have to have a word distance of 2 maximum. In the query string queries, proximity uses the \"abc def\"~2 syntax, but it only works for quoted phrases. In my example, I do not have quoted phrases, but complex entities that can have AND/OR, wildcards and parentheses, which the ES syntax can't process.\r\n\r\nSo given that limitation, how can I achieve what I want? I also tried a bit with span_near (although I'd prefer using the string query syntax), but again the span clauses are not easy to combine with the different operators and I'm not sure that what I want is even possible.","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}