{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30281","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30281/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30281/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30281/events","html_url":"https://github.com/elastic/elasticsearch/issues/30281","id":319062165,"node_id":"MDU6SXNzdWUzMTkwNjIxNjU=","number":30281,"title":"Cannot allocate memory error, when I try to get the Elasticsearch version (v 5.6.8)","user":{"login":"josenrihernand","id":22355359,"node_id":"MDQ6VXNlcjIyMzU1MzU5","avatar_url":"https://avatars1.githubusercontent.com/u/22355359?v=4","gravatar_id":"","url":"https://api.github.com/users/josenrihernand","html_url":"https://github.com/josenrihernand","followers_url":"https://api.github.com/users/josenrihernand/followers","following_url":"https://api.github.com/users/josenrihernand/following{/other_user}","gists_url":"https://api.github.com/users/josenrihernand/gists{/gist_id}","starred_url":"https://api.github.com/users/josenrihernand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josenrihernand/subscriptions","organizations_url":"https://api.github.com/users/josenrihernand/orgs","repos_url":"https://api.github.com/users/josenrihernand/repos","events_url":"https://api.github.com/users/josenrihernand/events{/privacy}","received_events_url":"https://api.github.com/users/josenrihernand/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-04-30T22:50:35Z","updated_at":"2018-04-30T23:42:17Z","closed_at":"2018-04-30T23:34:12Z","author_association":"NONE","active_lock_reason":null,"body":"Hello everyone,\r\n\r\nI am in the process of configuring an Elasticsearch environment. After set up the parameters according to the documentation, I get an error message when I try to get the version, even though there is free memory at the OS level:\r\n\r\n\r\n[root@ip-xx-xxx-xx-xx ~]# free -m (total memory: 8G, free memory: 2.8 G)\r\n             total       used       free     shared    buffers     cached\r\nMem:          7979       5168       2810          0         66        384\r\n-/+ buffers/cache:       4717       3261\r\nSwap:            0          0          0\r\n\r\n\r\n--------------------------------------------------------------------------------\r\n[root@ip-xx-xxx-xx-xx ~]# /usr/share/elasticsearch/bin/elasticsearch --version\r\n\r\nOpenJDK 64-Bit Server VM warning: INFO: os::commit_memory(0x00000006ca660000, 4120510464, 0) failed; error='Cannot allocate memory' (errno=12)\r\n#\r\n# There is insufficient memory for the Java Runtime Environment to continue.\r\n# Native memory allocation (mmap) failed to map 4120510464 bytes for committing reserved memory.\r\n# An error report file with more information is saved as:\r\n# /root/hs_err_pid11983.log\r\n--------------------------------------------------------------------------------\r\n\r\nNext my configuration:\r\n\r\n[root@ip-xx-xxx-xx-xx ~]# uname -a (Amazon Linux):\r\nLinux ip-xx-xxx-xx-xxx 4.14.33-51.34.amzn1.x86_64 #1 SMP Fri Apr 13 18:18:26 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n\r\nElasticsearch version: Version: 5.6.8, Build: 688ecce/2018-02-16T16:46:30.010Z, JVM: 1.8.0_171\r\n\r\n\r\n[root@ip-xx-xxx-xx-xx ~]# cat /usr/lib/systemd/system/elasticsearch.service.d/elasticsearch.conf\r\n[Service]\r\nLimitMEMLOCK=infinity\r\n\r\n\r\n[root@ip-10-121-91-79 ~]# cat /etc/elasticsearch/jvm.options | grep Xm\r\n-Xms4g\r\n-Xmx4g\r\n\r\n\r\n[root@ip-xx-xxx-xx-xx ~]# cat /etc/security/limits.d/00-defaults.conf\r\n* soft nofile 100000\r\n* hard nofile 100000\r\nelasticsearch soft memlock unlimited\r\nelasticsearch hard memlock unlimited\r\n\r\n\r\n[root@ip-xx-xxx-xx-xx ~]# cat /etc/sysctl.d/00-defaults.conf\r\nvm.swappiness=1\r\nvm.max_map_count=262144\r\n..\r\n..\r\n\r\n\r\n[root@ip-xx-xxx-xx-xx ~]# cat /etc/elasticsearch/elasticsearch.yml | grep bootstrap.memory\r\nbootstrap.memory_lock: true\r\n\r\n\r\n[root@ip-xx-xxx-xx-xx ~]# ps -ef | grep -i java (the service starts OK \"/sbin/service elasticsearch start\", however I got the error shown at the begining)\r\n\r\n496       8328     1  2 21:56 ?        00:00:31 /usr/bin/java **-Xms4g -Xmx4g** -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX: +UseCMSInitiatingOccupancyOnly -XX:+AlwaysPreTouch -server -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -\r\nDjdk.io.permissionsUseCanonicalPath=true -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Dio.netty.recycler.maxCapacityPerThread=0 -\r\nDlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Dlog4j.skipJansi=true -XX:+HeapDumpOnOutOfMemoryError -Xms4g -Xmx4g -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch -p /var/run/elasticsearch/elasticsearch.pid -d -Edefault.path.logs=/var/log/elasticsearch -Edefault.path.data=/var/lib/elasticsearch -Edefault.path.conf=/etc/elasticsearch\r\n\r\n\r\nWhat could be the cause of the memory error?\r\nthanks in advance !","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}