{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12665","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12665/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12665/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12665/events","html_url":"https://github.com/elastic/elasticsearch/issues/12665","id":99159257,"node_id":"MDU6SXNzdWU5OTE1OTI1Nw==","number":12665,"title":"Configuring path.repo for a Windows network share","user":{"login":"rikkit","id":692840,"node_id":"MDQ6VXNlcjY5Mjg0MA==","avatar_url":"https://avatars3.githubusercontent.com/u/692840?v=4","gravatar_id":"","url":"https://api.github.com/users/rikkit","html_url":"https://github.com/rikkit","followers_url":"https://api.github.com/users/rikkit/followers","following_url":"https://api.github.com/users/rikkit/following{/other_user}","gists_url":"https://api.github.com/users/rikkit/gists{/gist_id}","starred_url":"https://api.github.com/users/rikkit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rikkit/subscriptions","organizations_url":"https://api.github.com/users/rikkit/orgs","repos_url":"https://api.github.com/users/rikkit/repos","events_url":"https://api.github.com/users/rikkit/events{/privacy}","received_events_url":"https://api.github.com/users/rikkit/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2015-08-05T09:11:38Z","updated_at":"2017-07-26T11:30:07Z","closed_at":"2015-08-12T16:38:10Z","author_association":"NONE","active_lock_reason":null,"body":"We run ES in three clusters on Windows. We have two uses for `fs` repositories\n1. restore snapshots directly to our development cluster from our developer machines\n2. physically transport snapshots to different clusters (sometimes faster than a roundtrip to S3, or reindexing).\n\nThese were both enabled by configuring the repository location to a Windows network share visible to all nodes: `\\\\MACHINENAME\\snapshotfolder`.\n\nThe change in 1.6 to whitelist available locations for fs repositories seems to have broken our workflow. The below scenarios have been tested on a single node cluster on my machine. \n\n```\nelasticsearch.json: \n\"path.repo\" : [\"/\", \"\\\\\\\\ERUSS001L\"],\n\nPOST http://localhost:9200/_snapshot/eruss HTTP/1.1\n{\"type\":\"fs\",\"settings\":{\"location\":\"\\\\\\\\ERUSS001L\\\\snapshots\"}}\n\n[2015-08-05 10:00:03] {\"error\":\"RemoteTransportException[[dev1_RTOOL001L_coordinator][inet[/192.168.10.77:9700]][cluster:admin/repository/put]]; nested: RepositoryException[[eruss] failed to create repository]; nested: CreationException[Guice creation errors:\\r\\n\\r\\n1) Error injecting constructor, org.elasticsearch.repositories.RepositoryException: [eruss] location [\\\\\\\\ERUSS001L\\\\snapshots] doesn't match any of the locations specified by path.repo\\r\\n at org.elasticsearch.repositories.fs.FsRepository.<init>()\\r\\n at org.elasticsearch.repositories.fs.FsRepository\\r\\n at Key[type=org.elasticsearch.repositories.Repository, annotation=[none]]\\r\\n\\r\\n1 error]; nested: RepositoryException[[eruss] location [\\\\\\\\ERUSS001L\\\\snapshots] doesn't match any of the locations specified by path.repo]; \",\"status\":500}\n```\n\n```\nelasticsearch.json: \n\"repositories.url.allowed_urls\": [\"file:////ERUSS001L/*\"],\n\nPOST http://localhost:9200/_snapshot/eruss HTTP/1.1\n{\"type\":\"url\",\"settings\":{\"location\":\"file:////ERUSS001L/snapshots\"}}\n\n[2015-08-04 17:57:22] {\"error\":\"RemoteTransportException[[dev1_RTOOL001L_coordinator][inet[/192.168.10.77:9700]][cluster:admin/repository/put]]; nested: RepositoryException[[eruss] failed to create repository]; nested: CreationException[Guice creation errors:\\r\\n\\r\\n1) Error injecting constructor, org.elasticsearch.repositories.RepositoryException: [eruss] file url [file:////ERUSS001L/snapshots] doesn't match any of the locations specified by path.repo or repositories.url.allowed_urls\\r\\n at org.elasticsearch.repositories.uri.URLRepository.<init>()\\r\\n at org.elasticsearch.repositories.uri.URLRepository\\r\\n at Key[type=org.elasticsearch.repositories.Repository, annotation=[none]]\\r\\n\\r\\n1 error]; nested: RepositoryException[[eruss] file url [file:////ERUSS001L/snapshots] doesn't match any of the locations specified by path.repo or repositories.url.allowed_urls]; \",\"status\":500} \n```\n\nBoth of the above seem like they should have worked. So:\n1. how do I configure a Windows network share?\n2. how do I disable this feature for our development cluster, so we can snapshot and restore directly to and from developer machines?\n3. does path.repo need to be configured on all nodes, or just the coordinator?\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}