{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16606","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16606/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16606/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16606/events","html_url":"https://github.com/elastic/elasticsearch/issues/16606","id":132973932,"node_id":"MDU6SXNzdWUxMzI5NzM5MzI=","number":16606,"title":"Similarity of field cannot be changed if index contains more than one type with same field","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-02-11T13:31:45Z","updated_at":"2017-08-01T08:53:42Z","closed_at":"2017-08-01T08:53:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The [guide](https://www.elastic.co/guide/en/elasticsearch/guide/current/changing-similarities.html) states that if you want to change the similarity of a field you can close the index, update the mapping and then open it again. This is useful for example if someone wants to update parameters of BM25.\n\nIt does not seem to work currently if an index has more than one type which contains the field. The error message is `\"Mapper for [text] conflicts with existing mapping in other types:\\n[mapper [text] has different [similarity]]\"`. Setting the `update_all_types` parameter does not help either.\n\nFull reproduction below.\n\nA workaround is to define a custom similarity for each field when the index is created and then later update the settings when the index is closed instead of the mapping. But I still think this is a bug?\n\n```\nPUT test\n{\n  \"mappings\": {\n    \"type1\": {\n      \"properties\": {\n        \"text\": {\n          \"type\": \"string\",\n          \"similarity\": \"BM25\"\n        }\n      }\n    },\n    \"type2\": {\n      \"properties\": {\n        \"text\": {\n          \"type\": \"string\",\n          \"similarity\": \"BM25\"\n        }\n      }\n    }\n  }\n} \n\nPOST test/_close\n\nPOST test/_mapping/type1?update_all_types\n{\n  \"properties\": {\n    \"text\": {\n      \"type\": \"string\",\n      \"similarity\": \"default\"\n    }\n  }\n}\n\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}