[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32369040","html_url":"https://github.com/elastic/elasticsearch/issues/4740#issuecomment-32369040","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4740","id":32369040,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzY5MDQw","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-01-15T15:06:06Z","updated_at":"2014-01-15T15:06:06Z","author_association":"CONTRIBUTOR","body":"Histogram aggregations, which are going to replace histogram facets in the long term, are going to support ordering in ascending order: http://www.elasticsearch.org/guide/en/elasticsearch/reference/master/search-aggregations-bucket-histogram-aggregation.html#_order_2\n\n> Taking this one step further, if those two facets would support a \"size\" parameter, one could specify size=1 and sort=reverse_total in order to find the one bucket with the highest total value.\n\nSelection problems are typically solved by terms aggregations instead of histograms. For example, I think you could use a script (`field_value / interval`) to find the bucket that has the largest number of buckets?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32370199","html_url":"https://github.com/elastic/elasticsearch/issues/4740#issuecomment-32370199","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4740","id":32370199,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzcwMTk5","user":{"login":"consulthys","id":1280019,"node_id":"MDQ6VXNlcjEyODAwMTk=","avatar_url":"https://avatars2.githubusercontent.com/u/1280019?v=4","gravatar_id":"","url":"https://api.github.com/users/consulthys","html_url":"https://github.com/consulthys","followers_url":"https://api.github.com/users/consulthys/followers","following_url":"https://api.github.com/users/consulthys/following{/other_user}","gists_url":"https://api.github.com/users/consulthys/gists{/gist_id}","starred_url":"https://api.github.com/users/consulthys/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/consulthys/subscriptions","organizations_url":"https://api.github.com/users/consulthys/orgs","repos_url":"https://api.github.com/users/consulthys/repos","events_url":"https://api.github.com/users/consulthys/events{/privacy}","received_events_url":"https://api.github.com/users/consulthys/received_events","type":"User","site_admin":false},"created_at":"2014-01-15T15:18:21Z","updated_at":"2014-01-15T15:18:21Z","author_association":"CONTRIBUTOR","body":"Adrien, thank you for your answer and suggestion.\n\nI'm eager to migrate to aggregations, indeed, yet for various reasons, I'll be more or less stuck with ES 0.90.\\* (more precisely the 0.90.7 release) for a couple more months. Apologies for not having mentioned that earlier.\n\nI'm not sure the terms facet supports the \"interval\" parameter. Could you point out what you mean in your last paragraph, please? Thanks much for your help and support.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32381118","html_url":"https://github.com/elastic/elasticsearch/issues/4740#issuecomment-32381118","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4740","id":32381118,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzgxMTE4","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-01-15T17:00:26Z","updated_at":"2014-01-15T17:02:46Z","author_association":"CONTRIBUTOR","body":"> I'll be more or less stuck with ES 0.90.*\n\nThat is perfectly fine. However, we don't plan to do any change in facets in the future and to stay focused on aggregations.\n\n> I'm not sure the terms facet supports the \"interval\" parameter.\n\nThey don't support it natively indeed, but it is possible to use the scripting support of terms facets to do that. See\nhttp://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-facets-terms-facet.html#_term_scripts\n\nFor example, if your field is `price` and you want to find the top bucket with an interval of 10, you could run a terms facet using `(int) (price / 10)` as a script.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32388018","html_url":"https://github.com/elastic/elasticsearch/issues/4740#issuecomment-32388018","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4740","id":32388018,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzg4MDE4","user":{"login":"consulthys","id":1280019,"node_id":"MDQ6VXNlcjEyODAwMTk=","avatar_url":"https://avatars2.githubusercontent.com/u/1280019?v=4","gravatar_id":"","url":"https://api.github.com/users/consulthys","html_url":"https://github.com/consulthys","followers_url":"https://api.github.com/users/consulthys/followers","following_url":"https://api.github.com/users/consulthys/following{/other_user}","gists_url":"https://api.github.com/users/consulthys/gists{/gist_id}","starred_url":"https://api.github.com/users/consulthys/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/consulthys/subscriptions","organizations_url":"https://api.github.com/users/consulthys/orgs","repos_url":"https://api.github.com/users/consulthys/repos","events_url":"https://api.github.com/users/consulthys/events{/privacy}","received_events_url":"https://api.github.com/users/consulthys/received_events","type":"User","site_admin":false},"created_at":"2014-01-15T17:27:20Z","updated_at":"2014-01-24T04:35:32Z","author_association":"CONTRIBUTOR","body":"Ok, I understand, then you might close this non-issue as I can get around it for now, yet in a non-performant way, but I still get the result I want.\n\nTo better illustrate what I'm after, below is the facet I'm using. If there's a better way of achieving the same result in a more performant manner, I'm all ears.\n\n```\n  \"facets\": {\n    \"best_day\": {\n      \"date_histogram\": {\n        \"interval\": \"day\",\n        \"order\": \"total\",\n        \"key_field\": \"paidDate\",\n        \"value_field\": \"paidAmount\"\n      }\n    }\n  }\n```\n\nBasically, I want to bucket the whole time spectrum into daily buckets and for each I want to know the total of the paidAmount field. I'm then ordering the result entries on the \"total\" and I know that the last bucket in the list will be the one I'm looking for. Hence why if I could reverse-order and specify size=1 I'd only get the bucket I'm interested in.\n\nThanks for your time.\n","performed_via_github_app":null}]