[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/585556418","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-585556418","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":585556418,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTU1NjQxOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2020-02-13T05:20:46Z","updated_at":"2020-02-13T05:20:46Z","author_association":"MEMBER","body":"I suspect this is related to #51456 which converted the ILM history index to a hidden index, from #50452. Hidden indices are not expanded, which means they shouldn't resolve in health/stats calls. When we can't get this information, we mark an index as `red*`, behavior that's been there since the beginning (092fd6fc7aa4f974027e1fc088eaac6b0c618830).\r\n\r\n@gwbrown @jaymode Can you think about the proper handling of this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/585616763","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-585616763","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":585616763,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NTYxNjc2Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-02-13T08:48:33Z","updated_at":"2020-02-13T08:48:33Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-ui (:ES-UI)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/586031059","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-586031059","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":586031059,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NjAzMTA1OQ==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2020-02-13T23:59:04Z","updated_at":"2020-02-13T23:59:04Z","author_association":"CONTRIBUTOR","body":"Still digging into this, but some notes:\r\n- This reproduces only with Security enabled, hidden indices do not show up in the list at all with Security disabled.\r\n- This reproduces only when the hidden index in question has an alias.\r\n- I believe this is due to how aliases are handled in `IndicesAndAliasResolver` when resolving \"all indices\".\r\n- This causes hidden indices with aliases show up in `GET */_settings` (which is also a bug), although I don't yet understand the logic as to why.\r\n- However, hidden indices do not show up in the `ClusterHealthResponse` retrieved to build the `_cat/indices` response, which is the proximate cause of the `red*` health value.\r\n\r\n@jaymode, this also caused me to realize that there's currently no way to view hidden indices in the `_cat` APIs (except for this bug), as the `IndicesOptions` used for them are hardcoded. We'll need to add a new request parameter specific to the `_cat` APIs, or always include hidden indices in the `_cat` APIs, or rework the `_cat` APIs to accept `IndicesOptions` (which I haven't thought through the consequences of but seems like a significant change). Do you have an opinion on which way would be better?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/586038538","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-586038538","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":586038538,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NjAzODUzOA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-02-14T00:27:04Z","updated_at":"2020-02-14T00:27:04Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Core)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/586048506","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-586048506","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":586048506,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NjA0ODUwNg==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-02-14T01:07:17Z","updated_at":"2020-02-14T01:07:17Z","author_association":"CONTRIBUTOR","body":"> This reproduces only when the hidden index in question has an alias.\r\n\r\nIt sounds like yet another consequence of https://github.com/elastic/elasticsearch/issues/32238 (and the connected issues). \r\nThe current behaviour around Security's expansion of wildcards doesn't work well with aliases.\r\n\r\n_My_ preference (but there's a variety of different views across the ES team) is actually to move wildcard resolution from being in a pre-action interceptor to being in a pluggable core component. \r\n\r\nRight now security tries to replace wildcards with fixed names before the action runs. That means we replace `a*` with every index and alias that you have access to that starts with `a`. By the time the core action runs it doesn't have wildcards, it has real names.\r\nBut many actions have different handling for what they should do if an alias is _explicitly_ included in the request, vs what they should do if it is covered by a wildcard. So when security is enabled you get the former behaviour, but without security you get the latter. (As I write this, I guess the same issue now applies to expanding wildcards to hidden index names).\r\n\r\nIf we move wildcard expansion into some pluggable component, then the actions _always_ deal with wildcards, but security would be able to take responsibility for filtering that expansion to only include indices that the user has access to.\r\n\r\n> This causes hidden indices with aliases show up in GET */_settings (which is also a bug), although I don't yet understand the logic as to why\r\n\r\nI think this is the same situation as above (per my \"I guess...\"). Good luck with that one @jaymode - I guess you'll never really get to escape this probem :)\r\n\r\n> This reproduces only when the hidden index in question has an alias\r\n\r\nWhat semantics do we intend to have when there is an alias to a hidden index? \r\nIs the alias also hidden? It sounds like that's what you're aiming for, but the whole sceario seems weird to me.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/586335564","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-586335564","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":586335564,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NjMzNTU2NA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2020-02-14T15:26:24Z","updated_at":"2020-02-14T15:48:08Z","author_association":"MEMBER","body":"> Do you have an opinion on which way would be better?\r\n\r\nI knew that the cat APIs had hardcoded their indices options from when I went through all of the REST APIs to see where we needed to update for hidden indices. My thought at the time was that hidden indices could be left out of the cat apis and I vaguely remember that this was discussed during the last EAH. Currently we have code like https://github.com/elastic/elasticsearch/blob/cecee07cb13acb4389c6619d18e4d7f28958e91d/server/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java#L93\r\n\r\nMy suggestion is to simply modify this to:\r\n\r\n```java\r\nfinal IndicesOptions indicesOptions = IndicesOptions.fromRequest(request, IndicesOptions.strictExpand());\r\n```\r\n\r\n>  The current behaviour around Security's expansion of wildcards doesn't work well with aliases.\r\n\r\nThis is true and has always been problematic with security. Ultimately part of the problem is the feature where actions can be authorized against an alias without the user having permissions against the underlying index.\r\n\r\n> This causes hidden indices with aliases show up in GET */_settings (which is also a bug), although I don't yet understand the logic as to why.\r\n\r\nIt is the same issue where security doesn't introspect anything about an alias when doing expansion https://github.com/elastic/elasticsearch/blob/a9afdd7611bc3c3efdb257546933de55d123fe07/x-pack/plugin/security/src/main/java/org/elasticsearch/xpack/security/authz/IndicesAndAliasesResolver.java#L419-L425","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/586351558","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-586351558","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":586351558,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NjM1MTU1OA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2020-02-14T16:01:21Z","updated_at":"2020-02-14T16:01:21Z","author_association":"MEMBER","body":"> What semantics do we intend to have when there is an alias to a hidden index?\r\nIs the alias also hidden? It sounds like that's what you're aiming for, but the whole sceario seems weird to me.\r\n\r\nIn some cases, the alias should also be hidden in my opinion. The reason why I think that should be the case is that we have ILM, which write aliases are a part of that and if we think about some of our hidden indices, I think ILM makes sense to be used for those. So if expanding wildcards and an alias points to only hidden indices, then the alias should also be hidden. When hidden and non-hidden are mixed in an alias, that's when we start getting into the cases where it gets muddy. My suggestion:\r\n\r\n1. By default an alias is visible\r\n2. If an alias only points to hidden indices, it is also hidden.\r\n3. If an alias points to a mix of hidden and non-hidden indices, it is visible.\r\n4. Allow setting a property on an alias to enable it to be hidden (`\"is_hidden\" : true`)\r\n\r\nItem 4 is the ugliest aspect especially when it comes to the API for managing aliases and I *think* we could get away with just doing items 1-3.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/586358927","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-586358927","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":586358927,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NjM1ODkyNw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2020-02-14T16:18:16Z","updated_at":"2020-02-14T16:18:59Z","author_association":"MEMBER","body":"Since aliases are supposed to act like indices on their own, why does what they point to matter? Could we decouple them so that they can point to any mix of hidden and non-hidden indices, and only the hidden property on the alias matters for visibility? This would match with the dot prefix behavior in linux filesystems we have modeled hidden indices on, where an alias is like a symlink.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/586384159","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-586384159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":586384159,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NjM4NDE1OQ==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2020-02-14T17:19:44Z","updated_at":"2020-02-14T17:19:44Z","author_association":"MEMBER","body":"> why does what they point to matter? \r\n\r\nI dropped a sentence in my reply while editing; I was using the write index support and attempting to align this with that. In that case, there is the implicit write index on an alias when the alias only points to a single index. Hidden and write indices are different so they aren't going to align exactly, so we can avoid that implicit support.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/587657507","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-587657507","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":587657507,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NzY1NzUwNw==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2020-02-18T18:55:37Z","updated_at":"2020-02-18T18:55:37Z","author_association":"CONTRIBUTOR","body":"@jaymode and I discussed this issue and the underlying issues today.  We concluded:\r\n- We're likely going to have to make some improvements to how Security handles aliases. @jaymode is going to look into this as he's very familiar with that code.\r\n- I'm going to start on implementing \"hidden aliases\" using a property on the alias. This is going to come with some challenges due to how aliases are implemented, but hopefully we should be able to do it relatively cleanly.\r\n\r\nWe're also going to hold off on recommending other teams transition to using hidden indices until we've made some progress on resolving the problems with aliases and hidden indices, as most of the use cases for hidden indices involve an alias.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/599797874","html_url":"https://github.com/elastic/elasticsearch/issues/52304#issuecomment-599797874","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52304","id":599797874,"node_id":"MDEyOklzc3VlQ29tbWVudDU5OTc5Nzg3NA==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2020-03-16T23:08:48Z","updated_at":"2020-03-16T23:08:48Z","author_association":"CONTRIBUTOR","body":"This should be fixed with https://github.com/elastic/elasticsearch/pull/53248. Closing this issue.","performed_via_github_app":null}]