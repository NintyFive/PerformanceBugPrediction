[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/381438368","html_url":"https://github.com/elastic/elasticsearch/issues/29517#issuecomment-381438368","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29517","id":381438368,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MTQzODM2OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-15T21:12:30Z","updated_at":"2018-04-15T21:12:30Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/381438696","html_url":"https://github.com/elastic/elasticsearch/issues/29517#issuecomment-381438696","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29517","id":381438696,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MTQzODY5Ng==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-04-15T21:17:02Z","updated_at":"2018-04-15T21:17:02Z","author_association":"CONTRIBUTOR","body":"Hi @joedj,\r\n\r\nI can't reproduce what you describe. I created a three-node cluster containing a sizeable index, started a relocation of the replica and then attempted to cancel it (i.e. cancelled the allocation at the target node) and the relocation was indeed cancelled. A transcript is below. Could you identify the difference between what I've done here and the effect you describe?\r\n\r\n```\r\n\r\n# ========================================\r\n# Request: \r\nGET /_cat/nodes\r\n# at 2018-04-15T21:11:26.843Z\r\n\r\n# ----------------------------------------\r\n# Response: \r\n# 200 OK\r\n# 127.0.0.1 44 99 9 2.48   mdi * XutRwHX\r\n# 127.0.0.1 43 99 9 2.48   mdi - cVv2Fyq\r\n# 127.0.0.1 29 99 9 2.48   mdi - z8FCp49\r\n# \r\n# at 2018-04-15T21:11:26.858Z\r\n# (0.014285s elapsed)\r\n\r\n# ========================================\r\n# Request: \r\nGET /_cat/shards\r\n# at 2018-04-15T21:11:26.858Z\r\n\r\n# ----------------------------------------\r\n# Response: \r\n# 200 OK\r\n# i 0 r STARTED 107780 717.7mb 127.0.0.1 z8FCp49\r\n# i 0 p STARTED 107780 717.7mb 127.0.0.1 cVv2Fyq\r\n# \r\n# at 2018-04-15T21:11:26.862Z\r\n# (0.004141s elapsed)\r\n\r\n# ========================================\r\n# Request: \r\nPOST /_cluster/reroute\r\n{\r\n  \"commands\": [\r\n    {\r\n      \"move\": {\r\n        \"shard\": 0,\r\n        \"to_node\": \"XutRwHX\",\r\n        \"from_node\": \"z8FCp49\",\r\n        \"index\": \"i\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n# at 2018-04-15T21:11:26.863Z\r\n\r\n# ----------------------------------------\r\n# Response: \r\n# 200 OK\r\n# {\r\n#   \"state\": {\r\n#     \"blocks\": {},\r\n#     \"state_uuid\": \"LROkpu8YSmmiLwBhY6SRYA\",\r\n#     \"routing_nodes\": {\r\n#       \"unassigned\": [],\r\n#       \"nodes\": {\r\n#         \"z8FCp49KQUCiIjZeD3qY_Q\": [\r\n#           {\r\n#             \"shard\": 0,\r\n#             \"state\": \"RELOCATING\",\r\n#             \"node\": \"z8FCp49KQUCiIjZeD3qY_Q\",\r\n#             \"expected_shard_size_in_bytes\": 752641394,\r\n#             \"primary\": false,\r\n#             \"allocation_id\": {\r\n#               \"relocation_id\": \"1YzjJARWTcC94Db6e6oxCw\",\r\n#               \"id\": \"ZlzCZBqYSiSxuYCIieu-hA\"\r\n#             },\r\n#             \"relocating_node\": \"XutRwHXVTvygFnkoS9t9bg\",\r\n#             \"index\": \"i\"\r\n#           }\r\n#         ],\r\n#         \"XutRwHXVTvygFnkoS9t9bg\": [\r\n#           {\r\n#             \"shard\": 0,\r\n#             \"state\": \"INITIALIZING\",\r\n#             \"node\": \"XutRwHXVTvygFnkoS9t9bg\",\r\n#             \"expected_shard_size_in_bytes\": 752641394,\r\n#             \"primary\": false,\r\n#             \"allocation_id\": {\r\n#               \"relocation_id\": \"ZlzCZBqYSiSxuYCIieu-hA\",\r\n#               \"id\": \"1YzjJARWTcC94Db6e6oxCw\"\r\n#             },\r\n#             \"relocating_node\": \"z8FCp49KQUCiIjZeD3qY_Q\",\r\n#             \"index\": \"i\",\r\n#             \"recovery_source\": {\r\n#               \"type\": \"PEER\"\r\n#             }\r\n#           }\r\n#         ],\r\n#         \"cVv2FyqAS7OLoxKIyW8CFA\": [\r\n#           {\r\n#             \"shard\": 0,\r\n#             \"state\": \"STARTED\",\r\n#             \"node\": \"cVv2FyqAS7OLoxKIyW8CFA\",\r\n#             \"primary\": true,\r\n#             \"allocation_id\": {\r\n#               \"id\": \"JE7bI4M-T6WaDOJNEcIm6A\"\r\n#             },\r\n#             \"relocating_node\": null,\r\n#             \"index\": \"i\"\r\n#           }\r\n#         ]\r\n#       }\r\n#     },\r\n#     \"restore\": {\r\n#       \"snapshots\": []\r\n#     },\r\n#     \"master_node\": \"XutRwHXVTvygFnkoS9t9bg\",\r\n#     \"snapshot_deletions\": {\r\n#       \"snapshot_deletions\": []\r\n#     },\r\n#     \"snapshots\": {\r\n#       \"snapshots\": []\r\n#     },\r\n#     \"version\": 14,\r\n#     \"routing_table\": {\r\n#       \"indices\": {\r\n#         \"i\": {\r\n#           \"shards\": {\r\n#             \"0\": [\r\n#               {\r\n#                 \"shard\": 0,\r\n#                 \"state\": \"RELOCATING\",\r\n#                 \"node\": \"z8FCp49KQUCiIjZeD3qY_Q\",\r\n#                 \"expected_shard_size_in_bytes\": 752641394,\r\n#                 \"primary\": false,\r\n#                 \"allocation_id\": {\r\n#                   \"relocation_id\": \"1YzjJARWTcC94Db6e6oxCw\",\r\n#                   \"id\": \"ZlzCZBqYSiSxuYCIieu-hA\"\r\n#                 },\r\n#                 \"relocating_node\": \"XutRwHXVTvygFnkoS9t9bg\",\r\n#                 \"index\": \"i\"\r\n#               },\r\n#               {\r\n#                 \"shard\": 0,\r\n#                 \"state\": \"STARTED\",\r\n#                 \"node\": \"cVv2FyqAS7OLoxKIyW8CFA\",\r\n#                 \"primary\": true,\r\n#                 \"allocation_id\": {\r\n#                   \"id\": \"JE7bI4M-T6WaDOJNEcIm6A\"\r\n#                 },\r\n#                 \"relocating_node\": null,\r\n#                 \"index\": \"i\"\r\n#               }\r\n#             ]\r\n#           }\r\n#         }\r\n#       }\r\n#     },\r\n#     \"nodes\": {\r\n#       \"z8FCp49KQUCiIjZeD3qY_Q\": {\r\n#         \"transport_address\": \"127.0.0.1:9302\",\r\n#         \"name\": \"z8FCp49\",\r\n#         \"attributes\": {},\r\n#         \"ephemeral_id\": \"-TjZLoWkQEGFArqbD_9qZA\"\r\n#       },\r\n#       \"XutRwHXVTvygFnkoS9t9bg\": {\r\n#         \"transport_address\": \"127.0.0.1:9300\",\r\n#         \"name\": \"XutRwHX\",\r\n#         \"attributes\": {},\r\n#         \"ephemeral_id\": \"JITh5jCnTw6-UcfB2dy_zw\"\r\n#       },\r\n#       \"cVv2FyqAS7OLoxKIyW8CFA\": {\r\n#         \"transport_address\": \"127.0.0.1:9301\",\r\n#         \"name\": \"cVv2Fyq\",\r\n#         \"attributes\": {},\r\n#         \"ephemeral_id\": \"GCanxYKmQHeyt9K2W3efvA\"\r\n#       }\r\n#     }\r\n#   },\r\n#   \"acknowledged\": true\r\n# }\r\n# at 2018-04-15T21:11:26.921Z\r\n# (0.058129s elapsed)\r\n\r\n# ========================================\r\n# Request: \r\nGET /_cat/shards\r\n# at 2018-04-15T21:11:26.924Z\r\n\r\n# ----------------------------------------\r\n# Response: \r\n# 200 OK\r\n# i 0 r RELOCATING 107780 717.7mb 127.0.0.1 z8FCp49 -> 127.0.0.1 XutRwHXVTvygFnkoS9t9bg XutRwHX\r\n# i 0 p STARTED    107780 717.7mb 127.0.0.1 cVv2Fyq\r\n# \r\n# at 2018-04-15T21:11:26.931Z\r\n# (0.007914s elapsed)\r\n\r\n# ========================================\r\n# Request: \r\nPOST /_cluster/reroute\r\n{\r\n  \"commands\": [\r\n    {\r\n      \"cancel\": {\r\n        \"shard\": 0,\r\n        \"node\": \"XutRwHX\",\r\n        \"index\": \"i\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n# at 2018-04-15T21:11:33.760Z\r\n\r\n# ----------------------------------------\r\n# Response: \r\n# 200 OK\r\n# {\r\n#   \"state\": {\r\n#     \"blocks\": {},\r\n#     \"state_uuid\": \"vzSMv5bVR3SArwSLoOqufw\",\r\n#     \"routing_nodes\": {\r\n#       \"unassigned\": [],\r\n#       \"nodes\": {\r\n#         \"z8FCp49KQUCiIjZeD3qY_Q\": [\r\n#           {\r\n#             \"shard\": 0,\r\n#             \"state\": \"STARTED\",\r\n#             \"node\": \"z8FCp49KQUCiIjZeD3qY_Q\",\r\n#             \"primary\": false,\r\n#             \"allocation_id\": {\r\n#               \"id\": \"ZlzCZBqYSiSxuYCIieu-hA\"\r\n#             },\r\n#             \"relocating_node\": null,\r\n#             \"index\": \"i\"\r\n#           }\r\n#         ],\r\n#         \"XutRwHXVTvygFnkoS9t9bg\": [],\r\n#         \"cVv2FyqAS7OLoxKIyW8CFA\": [\r\n#           {\r\n#             \"shard\": 0,\r\n#             \"state\": \"STARTED\",\r\n#             \"node\": \"cVv2FyqAS7OLoxKIyW8CFA\",\r\n#             \"primary\": true,\r\n#             \"allocation_id\": {\r\n#               \"id\": \"JE7bI4M-T6WaDOJNEcIm6A\"\r\n#             },\r\n#             \"relocating_node\": null,\r\n#             \"index\": \"i\"\r\n#           }\r\n#         ]\r\n#       }\r\n#     },\r\n#     \"restore\": {\r\n#       \"snapshots\": []\r\n#     },\r\n#     \"master_node\": \"XutRwHXVTvygFnkoS9t9bg\",\r\n#     \"snapshot_deletions\": {\r\n#       \"snapshot_deletions\": []\r\n#     },\r\n#     \"snapshots\": {\r\n#       \"snapshots\": []\r\n#     },\r\n#     \"version\": 15,\r\n#     \"routing_table\": {\r\n#       \"indices\": {\r\n#         \"i\": {\r\n#           \"shards\": {\r\n#             \"0\": [\r\n#               {\r\n#                 \"shard\": 0,\r\n#                 \"state\": \"STARTED\",\r\n#                 \"node\": \"z8FCp49KQUCiIjZeD3qY_Q\",\r\n#                 \"primary\": false,\r\n#                 \"allocation_id\": {\r\n#                   \"id\": \"ZlzCZBqYSiSxuYCIieu-hA\"\r\n#                 },\r\n#                 \"relocating_node\": null,\r\n#                 \"index\": \"i\"\r\n#               },\r\n#               {\r\n#                 \"shard\": 0,\r\n#                 \"state\": \"STARTED\",\r\n#                 \"node\": \"cVv2FyqAS7OLoxKIyW8CFA\",\r\n#                 \"primary\": true,\r\n#                 \"allocation_id\": {\r\n#                   \"id\": \"JE7bI4M-T6WaDOJNEcIm6A\"\r\n#                 },\r\n#                 \"relocating_node\": null,\r\n#                 \"index\": \"i\"\r\n#               }\r\n#             ]\r\n#           }\r\n#         }\r\n#       }\r\n#     },\r\n#     \"nodes\": {\r\n#       \"z8FCp49KQUCiIjZeD3qY_Q\": {\r\n#         \"transport_address\": \"127.0.0.1:9302\",\r\n#         \"name\": \"z8FCp49\",\r\n#         \"attributes\": {},\r\n#         \"ephemeral_id\": \"-TjZLoWkQEGFArqbD_9qZA\"\r\n#       },\r\n#       \"XutRwHXVTvygFnkoS9t9bg\": {\r\n#         \"transport_address\": \"127.0.0.1:9300\",\r\n#         \"name\": \"XutRwHX\",\r\n#         \"attributes\": {},\r\n#         \"ephemeral_id\": \"JITh5jCnTw6-UcfB2dy_zw\"\r\n#       },\r\n#       \"cVv2FyqAS7OLoxKIyW8CFA\": {\r\n#         \"transport_address\": \"127.0.0.1:9301\",\r\n#         \"name\": \"cVv2Fyq\",\r\n#         \"attributes\": {},\r\n#         \"ephemeral_id\": \"GCanxYKmQHeyt9K2W3efvA\"\r\n#       }\r\n#     }\r\n#   },\r\n#   \"acknowledged\": true\r\n# }\r\n# at 2018-04-15T21:11:33.836Z\r\n# (0.075239s elapsed)\r\n\r\n# ========================================\r\n# Request: \r\nGET /_cat/shards\r\n# at 2018-04-15T21:11:33.839Z\r\n\r\n# ----------------------------------------\r\n# Response: \r\n# 200 OK\r\n# i 0 r STARTED 107780 717.7mb 127.0.0.1 z8FCp49\r\n# i 0 p STARTED 107780 717.7mb 127.0.0.1 cVv2Fyq\r\n# \r\n# at 2018-04-15T21:11:33.848Z\r\n# (0.009147s elapsed)\r\n\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/381526188","html_url":"https://github.com/elastic/elasticsearch/issues/29517#issuecomment-381526188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29517","id":381526188,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MTUyNjE4OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-04-16T08:48:48Z","updated_at":"2018-04-16T08:48:48Z","author_association":"CONTRIBUTOR","body":"@joedj is rebalancing/allocation disabled when you run that command? If not, the cluster will rebalance the shard in the same cluster update, i.e, cancel the relocation, notice that the cluster is unbalanced, and relocate the shard again to the same node (so it might appear as if nothing happened).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/385337909","html_url":"https://github.com/elastic/elasticsearch/issues/29517#issuecomment-385337909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29517","id":385337909,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NTMzNzkwOQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-04-30T08:24:57Z","updated_at":"2018-04-30T08:24:57Z","author_association":"CONTRIBUTOR","body":"Closing due to lack of a response. If you can help us reproduce this then please comment and we'll re-open it.","performed_via_github_app":null}]