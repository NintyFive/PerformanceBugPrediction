{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9578","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9578/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9578/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9578/events","html_url":"https://github.com/elastic/elasticsearch/issues/9578","id":56649626,"node_id":"MDU6SXNzdWU1NjY0OTYyNg==","number":9578,"title":"\"supersetFreq > supersetSize\" exception while running the significant terms aggregation, when sizes are equal","user":{"login":"radu-gheorghe","id":1482088,"node_id":"MDQ6VXNlcjE0ODIwODg=","avatar_url":"https://avatars0.githubusercontent.com/u/1482088?v=4","gravatar_id":"","url":"https://api.github.com/users/radu-gheorghe","html_url":"https://github.com/radu-gheorghe","followers_url":"https://api.github.com/users/radu-gheorghe/followers","following_url":"https://api.github.com/users/radu-gheorghe/following{/other_user}","gists_url":"https://api.github.com/users/radu-gheorghe/gists{/gist_id}","starred_url":"https://api.github.com/users/radu-gheorghe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/radu-gheorghe/subscriptions","organizations_url":"https://api.github.com/users/radu-gheorghe/orgs","repos_url":"https://api.github.com/users/radu-gheorghe/repos","events_url":"https://api.github.com/users/radu-gheorghe/events{/privacy}","received_events_url":"https://api.github.com/users/radu-gheorghe/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"assignees":[{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false}],"milestone":null,"comments":13,"created_at":"2015-02-05T10:01:55Z","updated_at":"2016-03-11T17:58:22Z","closed_at":"2015-04-26T20:07:09Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I can't quite understand why this is happening, but on occasions I'm getting errors like these while using background_filter, even though the query itself contains all the filters from the background filter:\n\n```\nElasticsearchIllegalArgumentException[supersetFreq > supersetSize, in JLHScore.score(..)]\n```\n\nor\n\n```\nElasticsearchIllegalArgumentException[subsetSize > supersetSize, does your background filter not include all documents in the bucket? If so and it is intentional, set \"background_is_superset\": false]\n```\n\nI can reproduce the first one everytime by using the match_all filter: https://gist.github.com/radu-gheorghe/0f9e1a04b11dc4e1f32b\n\nIt looks like this is happening only when the foreground and background set happen to be identical on a shard, but I'm not able to confirm if this is actually true yet. Another thing that's unclear is whether this affects other aggregations (e.g. if I'm nesting this significant terms aggregation under a terms aggregation, or just there's a different aggregation running on the same shard). I tend to think that they're affected, because the response says N shards failed (so I assume they fail completely?).\n\nI'll try to dig deeper, right now things are quite fuzzy. Please tell me if you have any insights and/or workarounds. So far it looks like \"background_is_superset\": false helps, but that skews results.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}