[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143571158","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143571158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":143571158,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzU3MTE1OA==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-09-27T16:01:54Z","updated_at":"2015-09-27T16:01:54Z","author_association":"CONTRIBUTOR","body":"> I think this is fair: the user asked for the index to merge down to 1 (default) segment so it should happen as quickly as possible.\n\n+1, they asked to do this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143575520","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143575520","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":143575520,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzU3NTUyMA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-27T16:34:04Z","updated_at":"2015-09-27T16:34:04Z","author_association":"CONTRIBUTOR","body":"I'm fine with the default being no throttle but an option to throttle might\nstill be useful for folks serving queries from one index while force\nmerging another. Or maybe they are force merging on  yesterday's index but\nthey still want to keep their index rate high for today's data.\n\nNik\nOn Sep 27, 2015 6:01 PM, \"Robert Muir\" notifications@github.com wrote:\n\n> I think this is fair: the user asked for the index to merge down to 1\n> (default) segment so it should happen as quickly as possible.\n> \n> +1, they asked to do this.\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143571158\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143596956","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143596956","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":143596956,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzU5Njk1Ng==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-09-27T21:44:30Z","updated_at":"2015-09-27T21:44:30Z","author_association":"CONTRIBUTOR","body":"+1 to not throttle explicit merges. Like Mike said, we are already drowning under settings so I think it's important not to introduce a new one.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143657140","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143657140","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":143657140,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzY1NzE0MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-09-28T07:09:54Z","updated_at":"2015-09-28T07:09:54Z","author_association":"MEMBER","body":"I understand the concerns about not adding a settings. I also agree that in some cases one might want to get the force merge done as soon as possible, as there is a human waiting on it. I think the most common one here is when people actually run the upgrade api. On the other hand in many other cases, operator do a maintenance job in the background while users of the cluster keep on searching. For example - and I believe that's practically the single case where we _recommend_ running a force merge - when ones moves yesterday's data to cold nodes in the time based data scenario. I think it will be a great shame if this stress nodes for their IO/CPU\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143703209","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143703209","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":143703209,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzcwMzIwOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-28T10:31:12Z","updated_at":"2015-09-28T10:31:12Z","author_association":"CONTRIBUTOR","body":"A merge (forced or otherwise) should never kill your search application. Ideally, a forced merge run on a quiet box should be able to use all available resources, but when run on a busy box, it should know how to play nice with the other resource consumers.\n\nThat'd be ideal but, if i understand correctly, then the auto-IO throttling only works with indexing, not with search?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143707806","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143707806","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":143707806,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzcwNzgwNg==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2015-09-28T10:50:02Z","updated_at":"2015-09-28T10:50:02Z","author_association":"CONTRIBUTOR","body":"> That'd be ideal but, if i understand correctly, then the auto-IO throttling only works with indexing, not with search?\n\nCorrect: it watches for natural merge \"backlog\" (more than one merge of nearly the size wants to run).  It doesn't look at any search metrics.\n\nIn the ideal world, `ionice` would be available from Java on all OS's per-thread, so we'd be able to just set low priority for natural merges, slightly higher priority for forced ones, and top priority for search IO ... but we are not there yet :)\n\nMaybe we could add a boolean setting, `throttle_force_merges` or something, default to `false`, or maybe a dynamic default based on `IOUtils.spins`, and if you change that to `true`, all forced merges will be throttled at the same rate as natural merges?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143712386","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143712386","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":143712386,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzcxMjM4Ng==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-28T10:59:57Z","updated_at":"2015-09-28T10:59:57Z","author_association":"CONTRIBUTOR","body":"I'd be happy with a parameter that defaulted to not throttling. That is a\nbreaking change from 1.0 and needs docs and stuff but its cool.\nOn Sep 28, 2015 12:50 PM, \"Michael McCandless\" notifications@github.com\nwrote:\n\n> That'd be ideal but, if i understand correctly, then the auto-IO\n> throttling only works with indexing, not with search?\n> \n> Correct: it watches for natural merge \"backlog\" (more than one merge of\n> nearly the size wants to run). It doesn't look at any search metrics.\n> \n> In the ideal world, ionice would be available from Java on all OS's\n> per-thread, so we'd be able to just set low priority for natural merges,\n> slightly higher priority for forced ones, and top priority for search IO\n> ... but we are not there yet :)\n> \n> Maybe we could add a boolean setting, throttle_force_merges or something,\n> default to false, or maybe a dynamic default based on IOUtils.spins, and\n> if you change that to true, all forced merges will be throttled at the\n> same rate as natural merges?\n> \n> —\n> Reply to this email directly or view it on GitHub\n> https://github.com/elastic/elasticsearch/issues/13819#issuecomment-143707806\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/144044305","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-144044305","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":144044305,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NDA0NDMwNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-29T12:27:27Z","updated_at":"2015-09-29T12:27:27Z","author_association":"CONTRIBUTOR","body":"We do tell people not to do forced merges on hot boxes (and I wasn't aware that they were throttled in current versions). I'd be tempted to leave the setting for now.  It can always be added if users ask for it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/144156536","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-144156536","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":144156536,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NDE1NjUzNg==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2015-09-29T18:58:28Z","updated_at":"2015-09-29T18:58:28Z","author_association":"CONTRIBUTOR","body":"> I'd be tempted to leave the setting for now. It can always be added if users ask for it.\n\nOK let's just leave it as is for now (forced merges not throttled) and revisit this if it proves to be a problem\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/231934044","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-231934044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":231934044,"node_id":"MDEyOklzc3VlQ29tbWVudDIzMTkzNDA0NA==","user":{"login":"joedj","id":250501,"node_id":"MDQ6VXNlcjI1MDUwMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/250501?v=4","gravatar_id":"","url":"https://api.github.com/users/joedj","html_url":"https://github.com/joedj","followers_url":"https://api.github.com/users/joedj/followers","following_url":"https://api.github.com/users/joedj/following{/other_user}","gists_url":"https://api.github.com/users/joedj/gists{/gist_id}","starred_url":"https://api.github.com/users/joedj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joedj/subscriptions","organizations_url":"https://api.github.com/users/joedj/orgs","repos_url":"https://api.github.com/users/joedj/repos","events_url":"https://api.github.com/users/joedj/events{/privacy}","received_events_url":"https://api.github.com/users/joedj/received_events","type":"User","site_admin":false},"created_at":"2016-07-12T04:24:51Z","updated_at":"2016-07-12T04:24:51Z","author_association":"NONE","body":"I would very much like the ability to throttle forced merges.\n\nI just want to merge indices that aren't going to receive any more writes down to 1 segment - I don't care how long that takes.  It is lower priority than natural merges, even.\n\nMoving shards around is a hassle, and has significant costs associated with it (extra nodes, storage, data transfer).\n\nAt the moment, we pick a quiet(er) time of day, disable all alerting for half an hour (!), hit optimize and hope for the best, which is obviously a terrible solution.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/247262378","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-247262378","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":247262378,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NzI2MjM3OA==","user":{"login":"arpanshah29","id":1763956,"node_id":"MDQ6VXNlcjE3NjM5NTY=","avatar_url":"https://avatars3.githubusercontent.com/u/1763956?v=4","gravatar_id":"","url":"https://api.github.com/users/arpanshah29","html_url":"https://github.com/arpanshah29","followers_url":"https://api.github.com/users/arpanshah29/followers","following_url":"https://api.github.com/users/arpanshah29/following{/other_user}","gists_url":"https://api.github.com/users/arpanshah29/gists{/gist_id}","starred_url":"https://api.github.com/users/arpanshah29/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arpanshah29/subscriptions","organizations_url":"https://api.github.com/users/arpanshah29/orgs","repos_url":"https://api.github.com/users/arpanshah29/repos","events_url":"https://api.github.com/users/arpanshah29/events{/privacy}","received_events_url":"https://api.github.com/users/arpanshah29/received_events","type":"User","site_admin":false},"created_at":"2016-09-15T07:59:21Z","updated_at":"2016-09-15T07:59:21Z","author_association":"NONE","body":"^ + 1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/275068084","html_url":"https://github.com/elastic/elasticsearch/issues/13819#issuecomment-275068084","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13819","id":275068084,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NTA2ODA4NA==","user":{"login":"centic9","id":548322,"node_id":"MDQ6VXNlcjU0ODMyMg==","avatar_url":"https://avatars0.githubusercontent.com/u/548322?v=4","gravatar_id":"","url":"https://api.github.com/users/centic9","html_url":"https://github.com/centic9","followers_url":"https://api.github.com/users/centic9/followers","following_url":"https://api.github.com/users/centic9/following{/other_user}","gists_url":"https://api.github.com/users/centic9/gists{/gist_id}","starred_url":"https://api.github.com/users/centic9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/centic9/subscriptions","organizations_url":"https://api.github.com/users/centic9/orgs","repos_url":"https://api.github.com/users/centic9/repos","events_url":"https://api.github.com/users/centic9/events{/privacy}","received_events_url":"https://api.github.com/users/centic9/received_events","type":"User","site_admin":false},"created_at":"2017-01-25T10:07:47Z","updated_at":"2017-01-25T10:07:47Z","author_association":"CONTRIBUTOR","body":"I also would love to be able to throttle this, we have a number of small clusters, so we do not have separate nodes for old data. As there is also no way to see/cancel ongoing merges, we are pretty blind here. Start off an optimize and hope it will not kill search/index operations... \r\n\r\nI know it is documented this way, but it still is not ideal as we also have older indices that we would like to force-merge to one segment but we do not care how long this takes, for us this is also even lower prio than natural merges.","performed_via_github_app":null}]