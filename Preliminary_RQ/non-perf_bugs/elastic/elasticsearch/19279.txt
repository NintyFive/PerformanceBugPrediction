{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19279","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19279/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19279/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19279/events","html_url":"https://github.com/elastic/elasticsearch/issues/19279","id":164044235,"node_id":"MDU6SXNzdWUxNjQwNDQyMzU=","number":19279,"title":"NLP will throw when no source for search result with compression","user":{"login":"XZhi","id":4264938,"node_id":"MDQ6VXNlcjQyNjQ5Mzg=","avatar_url":"https://avatars0.githubusercontent.com/u/4264938?v=4","gravatar_id":"","url":"https://api.github.com/users/XZhi","html_url":"https://github.com/XZhi","followers_url":"https://api.github.com/users/XZhi/followers","following_url":"https://api.github.com/users/XZhi/following{/other_user}","gists_url":"https://api.github.com/users/XZhi/gists{/gist_id}","starred_url":"https://api.github.com/users/XZhi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XZhi/subscriptions","organizations_url":"https://api.github.com/users/XZhi/orgs","repos_url":"https://api.github.com/users/XZhi/repos","events_url":"https://api.github.com/users/XZhi/events{/privacy}","received_events_url":"https://api.github.com/users/XZhi/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-07-06T10:19:58Z","updated_at":"2016-11-10T09:54:43Z","closed_at":"2016-11-10T09:54:43Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.1.1(2.x)\n\n**JVM version**:  1.8.0_66-b17 \n\n**OS version**: Mac OS X 10.10.5 \n\n**Description of the problem including expected versus actual behavior**:\njava.lang.NullPointerException will be thrown when converting search response to json if search hits without no source returned(just specify search field) and compress is enable, because  the **isCompressed** method of **LZFCompressor** and **DeflateCompressor**  will check the parameter 'bytes' is null or not before do uncompress operation.\n Stacktrace can be referenced at log section.\n\n**Steps to reproduce**:\n1. Use SearchRequestBuilder.addField()  to add search result field before execute search operation and it will not return source of document for search response hits.\n2. Execute search operation.\n3. Get the reference SearchResponse and use  com.alibaba.fastjson.JSON.toJSONString() to convert it into json string, you will got NPE\n\n**Provide logs (if relevant)**:\n\njava.lang.NullPointerException: null\n    at org.elasticsearch.common.compress.lzf.LZFCompressor.isCompressed(LZFCompressor.java:54) ~[elasticsearch-2.1.1.jar:2.1.1]\n    at org.elasticsearch.common.compress.CompressorFactory.compressor(CompressorFactory.java:74) ~[elasticsearch-2.1.1.jar:2.1.1]\n    at org.elasticsearch.common.compress.CompressorFactory.uncompressIfNeeded(CompressorFactory.java:118) ~[elasticsearch-2.1.1.jar:2.1.1]\n    at org.elasticsearch.search.internal.InternalSearchHit.sourceRef(InternalSearchHit.java:200) ~[elasticsearch-2.1.1.jar:2.1.1]\n    at org.elasticsearch.search.internal.InternalSearchHit.getSourceRef(InternalSearchHit.java:219) ~[elasticsearch-2.1.1.jar:2.1.1]\n    at Serializer_17.write1(Unknown Source) ~[na:na]\n    at Serializer_17.write(Unknown Source) ~[na:na]\n    at com.alibaba.fastjson.serializer.ArraySerializer.write(ArraySerializer.java:64) ~[fastjson-1.2.8.jar:na]\n    at com.alibaba.fastjson.serializer.JSONSerializer.writeWithFieldName(JSONSerializer.java:403) ~[fastjson-1.2.8.jar:na]\n    at Serializer_16.write1(Unknown Source) ~[na:na]\n    at Serializer_16.write(Unknown Source) ~[na:na]\n    at com.alibaba.fastjson.serializer.JSONSerializer.writeWithFieldName(JSONSerializer.java:403) ~[fastjson-1.2.8.jar:na]\n    at Serializer_14.write1(Unknown Source) ~[na:na]\n    at Serializer_14.write(Unknown Source) ~[na:na]\n    at com.alibaba.fastjson.serializer.JSONSerializer.writeWithFieldName(JSONSerializer.java:403) ~[fastjson-1.2.8.jar:na]\n    at Serializer_12.write1(Unknown Source) ~[na:na]\n    at Serializer_12.write(Unknown Source) ~[na:na]\n    at com.alibaba.fastjson.serializer.JSONSerializer.write(JSONSerializer.java:374) ~[fastjson-1.2.8.jar:na]\n    at com.alibaba.fastjson.JSON.toJSONString(JSON.java:394) ~[fastjson-1.2.8.jar:na]\n    at com.alibaba.fastjson.JSON.toJSONString(JSON.java:382) ~[fastjson-1.2.8.jar:na]\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}