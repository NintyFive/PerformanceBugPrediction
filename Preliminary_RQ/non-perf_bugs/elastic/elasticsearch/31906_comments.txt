[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403758696","html_url":"https://github.com/elastic/elasticsearch/issues/31906#issuecomment-403758696","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31906","id":403758696,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzc1ODY5Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-10T09:23:24Z","updated_at":"2018-07-10T09:23:24Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403774763","html_url":"https://github.com/elastic/elasticsearch/issues/31906#issuecomment-403774763","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31906","id":403774763,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzc3NDc2Mw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-07-10T10:22:08Z","updated_at":"2018-07-10T10:22:08Z","author_association":"MEMBER","body":"> it does not create the index correctly it seems\r\n\r\nHi @lockwobr, what seems to be the problem with the created index? I just tried it and it works fine. What version of Elasticsearch are you using?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403908105","html_url":"https://github.com/elastic/elasticsearch/issues/31906#issuecomment-403908105","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31906","id":403908105,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzkwODEwNQ==","user":{"login":"lockwobr","id":1550334,"node_id":"MDQ6VXNlcjE1NTAzMzQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1550334?v=4","gravatar_id":"","url":"https://api.github.com/users/lockwobr","html_url":"https://github.com/lockwobr","followers_url":"https://api.github.com/users/lockwobr/followers","following_url":"https://api.github.com/users/lockwobr/following{/other_user}","gists_url":"https://api.github.com/users/lockwobr/gists{/gist_id}","starred_url":"https://api.github.com/users/lockwobr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lockwobr/subscriptions","organizations_url":"https://api.github.com/users/lockwobr/orgs","repos_url":"https://api.github.com/users/lockwobr/repos","events_url":"https://api.github.com/users/lockwobr/events{/privacy}","received_events_url":"https://api.github.com/users/lockwobr/received_events","type":"User","site_admin":false},"created_at":"2018-07-10T17:44:21Z","updated_at":"2018-07-10T17:44:21Z","author_association":"NONE","body":"The problem is with the mapping it creates, does not seem right and if you try a more complicated example it will error out.\r\n\r\nExample from the docs creates this mapping:\r\n```\r\ncurl -X GET \"localhost:9200/twitter/_mapping/\"\r\n{\r\n  \"twitter\": {\r\n    \"mappings\": {\r\n      \"\\\"tweet\\\": {\\n  \\\"properties\\\": {\\n    \\\"message\\\": {\\n      \\\"type\\\": \\\"text\\\"\\n    }\\n  }\\n}\": {}\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThe I think how the function should be called produces this:\r\n```\r\ncurl -X GET \"localhost:9200/twitter/_mapping/\"\r\n{\r\n  \"twitter\": {\r\n    \"mappings\": {\r\n      \"tweet\": {\r\n        \"properties\": {\r\n          \"message\": {\r\n            \"type\": \"text\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nWhat lead me down this path is if you try this it errors out all together, so I started to read the code an noticed that you need to call the function way differently.\r\n\r\n```\r\nclient.admin().indices().prepareCreate(\"twitter\").addMapping(\r\n      \"\\\"tweet\\\": {\\n\" +\r\n        \"  \\\"properties\\\": {\\n\" +\r\n        \"    \\\"location\\\": {\\n\" +\r\n        \"      \\\"type\\\": \\\"geo_shape\\\", \\n\" +\r\n        \"      \\\"tree\\\": \\\"quadtree\\\", \\n\" +\r\n        \"      \\\"precision\\\": \\\"10m\\\"\\n\" +\r\n        \"    }\\n\" +\r\n        \"  }\\n\" +\r\n        \"}\").get();\r\n```\r\n\r\nErrors:\r\n```\r\norg.elasticsearch.indices.InvalidTypeNameException: mapping type name [\"tweet\": {\r\n  \"properties\": {\r\n    \"location\": {\r\n      \"type\": \"geo_shape\",\r\n      \"tree\": \"quadtree\",\r\n      \"precision\": \"10m\"\r\n    }\r\n  }\r\n}] should not include ',' in it\r\n  at org.elasticsearch.index.mapper.MapperService.validateTypeName(MapperService.java:370)\r\n  at org.elasticsearch.index.mapper.MapperService.internalMerge(MapperService.java:401)\r\n  at org.elasticsearch.index.mapper.MapperService.internalMerge(MapperService.java:353)\r\n  at org.elasticsearch.index.mapper.MapperService.merge(MapperService.java:277)\r\n  at org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$IndexCreationTask.execute(MetaDataCreateIndexService.java:444)\r\n  at org.elasticsearch.cluster.ClusterStateUpdateTask.execute(ClusterStateUpdateTask.java:45)\r\n  at org.elasticsearch.cluster.service.MasterService.executeTasks(MasterService.java:643)\r\n  at org.elasticsearch.cluster.service.MasterService.calculateTaskOutputs(MasterService.java:273)\r\n  at org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:198)\r\n  at org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:133)\r\n  at org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150)\r\n  at org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188)\r\n  at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:573)\r\n  at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244)\r\n  at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207)\r\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n  at java.lang.Thread.run(Thread.java:748)\r\n\r\n```\r\n\r\nAfter looking at the code figured out if you change the above to it works.\r\n```\r\nclient.admin.indices().prepareCreate(\"twitter\").addMapping(\"tweet\", \"location\", \"type=geo_shape,tree=quadtree,precision=10m\").get()\r\n```\r\n\r\n\r\nVersion\r\n\r\n```\r\n\"version\": {\r\n\"number\": \"6.2.2\",\r\n\"build_hash\": \"10b1edd\",\r\n\"build_date\": \"2018-02-16T19:01:30.685723Z\",\r\n\"build_snapshot\": false,\r\n\"lucene_version\": \"7.2.1\",\r\n\"minimum_wire_compatibility_version\": \"5.6.0\",\r\n\"minimum_index_compatibility_version\": \"5.0.0\"\r\n}\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403919634","html_url":"https://github.com/elastic/elasticsearch/issues/31906#issuecomment-403919634","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31906","id":403919634,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzkxOTYzNA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-07-10T18:22:08Z","updated_at":"2018-07-10T18:22:08Z","author_association":"MEMBER","body":"@lockwobr wow, great catch. I stand corrected. Thanks for letting us know, this is certainly an error in the documentation in this case and should be corrected.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403927198","html_url":"https://github.com/elastic/elasticsearch/issues/31906#issuecomment-403927198","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31906","id":403927198,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzkyNzE5OA==","user":{"login":"lockwobr","id":1550334,"node_id":"MDQ6VXNlcjE1NTAzMzQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1550334?v=4","gravatar_id":"","url":"https://api.github.com/users/lockwobr","html_url":"https://github.com/lockwobr","followers_url":"https://api.github.com/users/lockwobr/followers","following_url":"https://api.github.com/users/lockwobr/following{/other_user}","gists_url":"https://api.github.com/users/lockwobr/gists{/gist_id}","starred_url":"https://api.github.com/users/lockwobr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lockwobr/subscriptions","organizations_url":"https://api.github.com/users/lockwobr/orgs","repos_url":"https://api.github.com/users/lockwobr/repos","events_url":"https://api.github.com/users/lockwobr/events{/privacy}","received_events_url":"https://api.github.com/users/lockwobr/received_events","type":"User","site_admin":false},"created_at":"2018-07-10T18:46:51Z","updated_at":"2018-07-10T22:33:17Z","author_association":"NONE","body":"Your welcome. I kind of think it should be a bug in the client code too, because I feel it shouldn't really let you call it the way it is in the document. There is a check for it in the code, but its not working it seems. It wants pairs of params, and some how it is if you have one it seems to let pass the check.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404154862","html_url":"https://github.com/elastic/elasticsearch/issues/31906#issuecomment-404154862","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31906","id":404154862,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDE1NDg2Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-07-11T12:41:50Z","updated_at":"2018-07-11T12:41:50Z","author_association":"MEMBER","body":"> client code too, because I feel it shouldn't really let you call it the way it is in the document\r\n\r\nI was very much in favour of restricting the client call and make `addMapping(\"someString\")` without further arguments illegal. However when trying to do so several of our internal tests failed. Also the current Rest API allowes you to put a type without any mappings, sth. like\r\n```\r\nPUT test\r\n{\r\n    \"mappings\" : {\r\n        \"type1\" : {\r\n        }\r\n    }\r\n}\r\n```\r\nwhich is about the same as doing the problematic \"addMapping()\" call. Since we allow this in REST, we should not really prevent it in the Java API either, although it might not make much sense. I will probably open an issue to discuss whether there is any real reason for having empty mappings. Maybe we want to dissallow this in Rest, but that would have to happen first and needs to be in a mayor version since it would be a breaking change.\r\n","performed_via_github_app":null}]