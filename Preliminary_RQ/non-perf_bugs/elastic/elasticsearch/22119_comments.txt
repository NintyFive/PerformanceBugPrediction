[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266473287","html_url":"https://github.com/elastic/elasticsearch/issues/22119#issuecomment-266473287","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22119","id":266473287,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NjQ3MzI4Nw==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-12-12T16:15:13Z","updated_at":"2016-12-12T16:15:13Z","author_association":"MEMBER","body":"When running a 5.1 Transport client on a 5.0 node, changing the code with:\r\n\r\n```java\r\nSearchTemplateResponse str = new SearchTemplateRequestBuilder(client)\r\n        .setScript(\"template_gender\")\r\n        .setScriptType(ScriptType.STORED)\r\n        .setRequest(new SearchRequest())\r\n        .setScriptParams(template_params)\r\n        .get();\r\n```\r\n\r\nyou get:\r\n\r\n```\r\nNotSerializableExceptionWrapper[class_cast_exception: java.lang.Integer cannot be cast to java.util.Map\r\n]\r\n\tat org.elasticsearch.common.io.stream.StreamInput.readMap(StreamInput.java:460)\r\n\tat org.elasticsearch.script.mustache.SearchTemplateRequest.readFrom(SearchTemplateRequest.java:129)\r\n\tat org.elasticsearch.transport.TcpTransport.handleRequest(TcpTransport.java:1303)\r\n\tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:1205)\r\n\tat org.elasticsearch.transport.netty4.Netty4MessageChannelHandler.channelRead(Netty4MessageChannelHandler.java:74)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:372)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:358)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:350)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:293)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:280)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:396)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:248)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:372)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:358)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:350)\r\n\tat io.netty.channel.ChannelInboundHandlerAdapter.channelRead(ChannelInboundHandlerAdapter.java:86)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:372)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:358)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:350)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1334)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:372)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:358)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:926)\r\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:129)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:610)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:513)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:467)\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:437)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:873)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266480506","html_url":"https://github.com/elastic/elasticsearch/issues/22119#issuecomment-266480506","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22119","id":266480506,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NjQ4MDUwNg==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-12-12T16:39:27Z","updated_at":"2016-12-12T16:39:27Z","author_association":"MEMBER","body":"I created a mixed cluster running one 5.0 and one 5.1 nodes.\r\nUsing the REST interface, I can't reproduce the problem. So it's only when using the TransportClient apparently.\r\n\r\nScript used:\r\n\r\n```sh\r\ncurl -XDELETE localhost:9200/test?pretty\r\ncurl -XPUT localhost:9200/test/person/1?pretty -d '\r\n{\r\n\t\"gender\": \"male\"\r\n}\r\n'\r\ncurl -XPOST localhost:9200/_search/template/template_gender\r\n{\r\n    \"template\": {\r\n        \"query\": {\r\n            \"match\": {\r\n                \"gender\": \"{{param_gender}}\"\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThen\r\n\r\n```sh\r\n# Trying node 1 (running 5.0.1)\r\ncurl localhost:9200/_search/template?pretty -d '\r\n{\r\n    \"id\" : \"template_gender\",\r\n    \"params\": {\r\n    \t\"param_gender\": \"male\"\r\n    }\r\n}\r\n'\r\n# Trying node 2 (running 5.1.1)\r\ncurl localhost:9201/_search/template?pretty -d '\r\n{\r\n    \"id\" : \"template_gender\",\r\n    \"params\": {\r\n    \t\"param_gender\": \"male\"\r\n    }\r\n}\r\n'\r\n```\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/301428038","html_url":"https://github.com/elastic/elasticsearch/issues/22119#issuecomment-301428038","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22119","id":301428038,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTQyODAzOA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-05-15T09:45:55Z","updated_at":"2017-05-15T09:46:09Z","author_association":"MEMBER","body":"This seems to be an unwanted breaking change in the java api between 5.0 and 5.1. It wasn't picked up though and at this point we don't release 5.0.x nor 5.1.x anymore, hence I don't think there's anything we can do about it, it is too late to fix it. Closing.","performed_via_github_app":null}]