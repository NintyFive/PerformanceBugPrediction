[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290257364","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290257364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290257364,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDI1NzM2NA==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-03-29T23:30:23Z","updated_at":"2017-03-29T23:30:23Z","author_association":"CONTRIBUTOR","body":"This is a known behavior.  Once you connect a 5.x cluster to a repository location, any 2.x clusters connected to the same repository should be setup to be `readonly`.  In fact, that's a general rule with snapshot repositories - only one cluster should be connected to a repository with write permissions, all other clusters connected to that same repository should be in read-only fashion.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290258759","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290258759","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290258759,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDI1ODc1OQ==","user":{"login":"cheruvian","id":775841,"node_id":"MDQ6VXNlcjc3NTg0MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/775841?v=4","gravatar_id":"","url":"https://api.github.com/users/cheruvian","html_url":"https://github.com/cheruvian","followers_url":"https://api.github.com/users/cheruvian/followers","following_url":"https://api.github.com/users/cheruvian/following{/other_user}","gists_url":"https://api.github.com/users/cheruvian/gists{/gist_id}","starred_url":"https://api.github.com/users/cheruvian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cheruvian/subscriptions","organizations_url":"https://api.github.com/users/cheruvian/orgs","repos_url":"https://api.github.com/users/cheruvian/repos","events_url":"https://api.github.com/users/cheruvian/events{/privacy}","received_events_url":"https://api.github.com/users/cheruvian/received_events","type":"User","site_admin":false},"created_at":"2017-03-29T23:38:44Z","updated_at":"2017-03-29T23:40:24Z","author_association":"NONE","body":"Agreed, however the use case presented here is a setup where the repo **is** readonly for the ES5 cluster. \r\n\r\nInterestingly, the command to list snapshots does a write to the repo. Most likely in an effort to cache the index metadata.  This is what causes the problems since the index metadata file is then permanently stored on disk/in the cloud and does not get updated when the write cluster creates a new snapshot.\r\n\r\ni.e. `GET /_snapshot/repo_name` on ES5 creates the `index-x` files in the repo.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290259047","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290259047","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290259047,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDI1OTA0Nw==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-03-29T23:40:45Z","updated_at":"2017-03-29T23:40:45Z","author_association":"CONTRIBUTOR","body":"Actually, the issue here is that when a 5.x cluster connects to the repository, it has to update the snapshot files so it is in a format understood by 5.x (which is a bit different than 2.x) - that's the initial write that you're seeing.  That's why, once a 5.x cluster connects to a repository, the 2.x one should be set to read-only.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290260342","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290260342","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290260342,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDI2MDM0Mg==","user":{"login":"cheruvian","id":775841,"node_id":"MDQ6VXNlcjc3NTg0MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/775841?v=4","gravatar_id":"","url":"https://api.github.com/users/cheruvian","html_url":"https://github.com/cheruvian","followers_url":"https://api.github.com/users/cheruvian/followers","following_url":"https://api.github.com/users/cheruvian/following{/other_user}","gists_url":"https://api.github.com/users/cheruvian/gists{/gist_id}","starred_url":"https://api.github.com/users/cheruvian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cheruvian/subscriptions","organizations_url":"https://api.github.com/users/cheruvian/orgs","repos_url":"https://api.github.com/users/cheruvian/repos","events_url":"https://api.github.com/users/cheruvian/events{/privacy}","received_events_url":"https://api.github.com/users/cheruvian/received_events","type":"User","site_admin":false},"created_at":"2017-03-29T23:48:57Z","updated_at":"2017-03-29T23:48:57Z","author_association":"NONE","body":"This makes ES5 migrations a little tricky then for users who want to test out ES5 while maintaining their ES2 infrastructure and ingestion until they are able to make a complete cutover. This sounds (to me) like a pretty common/reasonable use case.\r\n\r\nI guess I'm ok with marking this as by design if we update [the docs](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-snapshots.html) since it doesn't seem to mention anywhere about readonly uses.  I would also just like to have this use case kept in mind for the next MV bump.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290274897","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290274897","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290274897,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDI3NDg5Nw==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-03-30T01:27:34Z","updated_at":"2017-03-30T01:27:34Z","author_association":"CONTRIBUTOR","body":"> This makes ES5 migrations a little tricky then for users who want to test out ES5 while maintaining their ES2 infrastructure and ingestion until they are able to make a complete cutover. This sounds (to me) like a pretty common/reasonable use case.\r\n\r\nIts a fair point.  One suggestion is to use your 2.x cluster to take a single snapshot to a different S3 bucket (different repository), then connect your new 5.x cluster to this different S3 bucket so you can experiment with 5.x.  Not sure if this is feasible in your case.\r\n\r\n> I guess I'm ok with marking this as by design if we update the docs since it doesn't seem to mention anywhere about readonly uses.\r\n\r\nI thought I had updated the docs on this but looks like I forgot to issue a PR for my branch.  Here is the PR to update the docs on this matter: https://github.com/elastic/elasticsearch/pull/23807\r\n\r\n> I would also just like to have this use case kept in mind for the next MV bump.\r\n\r\nWe are aiming for it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290300760","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290300760","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290300760,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDMwMDc2MA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-03-30T04:41:49Z","updated_at":"2017-03-30T04:41:49Z","author_association":"MEMBER","body":"Interesting. Actually even if someone marks the 5.x repository as readonly the 5.x cluster will write files on the repository to upgrade it? If so I feel it like a bug. WDYT?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290464756","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290464756","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290464756,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDQ2NDc1Ng==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-03-30T16:25:25Z","updated_at":"2017-03-30T16:25:25Z","author_association":"CONTRIBUTOR","body":"> Actually even if someone marks the 5.x repository as readonly the 5.x cluster will write files on the repository to upgrade it? If so I feel it like a bug. WDYT?\r\n\r\n@dadoonet No, if the 5.x repository is `readonly`, then the repository data will *not* be upgraded.  \r\n\r\n@russellday @cheruvian you *should* be able to set the 5.x repository to `readonly` and not have the data upgraded.  It was my understanding though that the 5.x repository was not set to `readonly`, causing the issue.  If you are setting the 5.x repository to `readonly` and its still upgrading the repository data to have `index-{N}` blobs, then its a bug.  ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290465062","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290465062","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290465062,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDQ2NTA2Mg==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-03-30T16:26:24Z","updated_at":"2017-03-30T16:26:24Z","author_association":"CONTRIBUTOR","body":"However, I'd still like to point out that while it should work, its not a setup we support.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290473136","html_url":"https://github.com/elastic/elasticsearch/issues/23806#issuecomment-290473136","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23806","id":290473136,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDQ3MzEzNg==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-03-30T16:54:33Z","updated_at":"2017-03-30T16:54:33Z","author_association":"CONTRIBUTOR","body":"I confirmed that if you connect the 5.x cluster to the repository in `readonly` mode from the very start, it will *not* upgrade the repository data.","performed_via_github_app":null}]