{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2546","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2546/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2546/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2546/events","html_url":"https://github.com/elastic/elasticsearch/issues/2546","id":9947594,"node_id":"MDU6SXNzdWU5OTQ3NTk0","number":2546,"title":"null pointer exception in 19.8. same code path exists in master branch","user":{"login":"joshbronson","id":1559509,"node_id":"MDQ6VXNlcjE1NTk1MDk=","avatar_url":"https://avatars1.githubusercontent.com/u/1559509?v=4","gravatar_id":"","url":"https://api.github.com/users/joshbronson","html_url":"https://github.com/joshbronson","followers_url":"https://api.github.com/users/joshbronson/followers","following_url":"https://api.github.com/users/joshbronson/following{/other_user}","gists_url":"https://api.github.com/users/joshbronson/gists{/gist_id}","starred_url":"https://api.github.com/users/joshbronson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshbronson/subscriptions","organizations_url":"https://api.github.com/users/joshbronson/orgs","repos_url":"https://api.github.com/users/joshbronson/repos","events_url":"https://api.github.com/users/joshbronson/events{/privacy}","received_events_url":"https://api.github.com/users/joshbronson/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":28458722,"node_id":"MDU6TGFiZWwyODQ1ODcyMg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.20.6","name":"v0.20.6","color":"DDDDDD","default":false,"description":null},{"id":29805870,"node_id":"MDU6TGFiZWwyOTgwNTg3MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.0.RC1","name":"v0.90.0.RC1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"assignees":[{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2013-01-14T16:24:12Z","updated_at":"2013-03-03T18:49:36Z","closed_at":"2013-01-14T20:39:45Z","author_association":"NONE","active_lock_reason":null,"body":"Upon restarting an elasticsearch server, I received a \"failed to recover commit_point\" message from Elasticsearch. The cause was a null pointer being passed into a concurrent hashmap. The null comes from PercolatorExecutor.parseQuery, which seems to always parse a query or raise an exception. If there is no \"query\" token, however, the parseQuery method appears to return null.\n\nI patched code in PercolatorService.QueryiesLoaderCollector.collect to check the return value of parseQuery for null before inserting it into the map, and that seemed to fix it. Here's the pull request: \n\nhttps://github.com/elasticsearch/elasticsearch/pull/2547\n\nI'm not familiar enough with ES to know if that's actually the fix. Maybe parseQuery should raise an exception, or maybe the _percolator index needs better sanitization. But in 19.8, at least, it seems possible to get the _percolator index into a state that makes the data unrecoverable without edits to the ES source.\n\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [_percolator][0] failed to recover commit_point [commit-19]/[45]\n        at org.elasticsearch.index.gateway.blobstore.BlobStoreIndexShardGateway.recover(BlobStoreIndexShardGateway.java:424)\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:177)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n        at java.lang.Thread.run(Thread.java:662)\nCaused by: java.lang.NullPointerException\n        at java.util.concurrent.ConcurrentHashMap.put(ConcurrentHashMap.java:881)\n        at java.util.concurrent.ConcurrentHashMap.putAll(ConcurrentHashMap.java:909)\n        at org.elasticsearch.index.percolator.PercolatorExecutor.addQueries(PercolatorExecutor.java:259)\n        at org.elasticsearch.index.percolator.PercolatorService.loadQueries(PercolatorService.java:128)\n        at org.elasticsearch.index.percolator.PercolatorService.access$700(PercolatorService.java:52)\n        at org.elasticsearch.index.percolator.PercolatorService$ShardLifecycleListener.afterIndexShardStarted(PercolatorService.java:220)\n        at org.elasticsearch.indices.InternalIndicesLifecycle.afterIndexShardStarted(InternalIndicesLifecycle.java:86)\n        at org.elasticsearch.index.shard.service.InternalIndexShard.start(InternalIndexShard.java:277)\n        at org.elasticsearch.index.gateway.blobstore.BlobStoreIndexShardGateway.recoverTranslog(BlobStoreIndexShardGateway.java:435)\n        at org.elasticsearch.index.gateway.blobstore.BlobStoreIndexShardGateway.recover(BlobStoreIndexShardGateway.java:421)\n","closed_by":{"login":"joshbronson","id":1559509,"node_id":"MDQ6VXNlcjE1NTk1MDk=","avatar_url":"https://avatars1.githubusercontent.com/u/1559509?v=4","gravatar_id":"","url":"https://api.github.com/users/joshbronson","html_url":"https://github.com/joshbronson","followers_url":"https://api.github.com/users/joshbronson/followers","following_url":"https://api.github.com/users/joshbronson/following{/other_user}","gists_url":"https://api.github.com/users/joshbronson/gists{/gist_id}","starred_url":"https://api.github.com/users/joshbronson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshbronson/subscriptions","organizations_url":"https://api.github.com/users/joshbronson/orgs","repos_url":"https://api.github.com/users/joshbronson/repos","events_url":"https://api.github.com/users/joshbronson/events{/privacy}","received_events_url":"https://api.github.com/users/joshbronson/received_events","type":"User","site_admin":false},"performed_via_github_app":null}