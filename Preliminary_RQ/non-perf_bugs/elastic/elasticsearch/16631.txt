{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16631","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16631/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16631/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16631/events","html_url":"https://github.com/elastic/elasticsearch/issues/16631","id":133203140,"node_id":"MDU6SXNzdWUxMzMyMDMxNDA=","number":16631,"title":"Evaluate the replacement of the scroll API with search_after","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-02-12T10:23:46Z","updated_at":"2018-02-14T13:31:24Z","closed_at":"2016-02-12T15:17:03Z","author_association":"MEMBER","active_lock_reason":null,"body":"The scroll API is widely used for a lot of use cases (Map/Reduce, reindex, delete by query, ...). \nThe performance is great but there are some limitations that IMO are difficult to handle: \n- The scroll API is using a `snapshot` of the index, if the scroll takes a long time a lot of resources are consumed (and kept) just for the scroll.\n- The scroll is always bounded to one replica per shard, this means that there is no way to spread the load among the available replicas for one shard. \n\nNow that we added the support for `search_after` (https://github.com/elastic/elasticsearch/issues/8192) we could evaluate the cost of using this feature instead of the scroll. \nThere is no context attached to a `search_after` request, this means that we can use the newest searcher on each sub-query but also that each sub-query could run on any available replicas. \nThe downside of this approach is the need to use a tiebreaker for the sort (the scroll API is using the internal Lucene docid for this). The best tiebreaker we could think of is the _uid because we are sure that it has a unique value per document. Though the cost of sorting on _uid is big (see https://github.com/elastic/elasticsearch/issues/11887).\nIMO I don't think that we should use docvalues but  rather rely on the fielddata because it can be used lazily (we pay the cost of having the _uid in fieldata but only when there is a scroll request running and we can easily remove it when we are done).   \n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}