[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/605930711","html_url":"https://github.com/elastic/elasticsearch/issues/54403#issuecomment-605930711","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54403","id":605930711,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNTkzMDcxMQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-03-30T10:56:14Z","updated_at":"2020-03-30T10:56:14Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo (:Analytics/Aggregations)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606860465","html_url":"https://github.com/elastic/elasticsearch/issues/54403#issuecomment-606860465","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54403","id":606860465,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjg2MDQ2NQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2020-03-31T20:36:08Z","updated_at":"2020-04-01T12:12:25Z","author_association":"CONTRIBUTOR","body":"I spent some time playing with this today. Good news:\r\n1. `java.time` exposes everything we need.\r\n2. We absolutely can make this faster by building a shard-local `lookup` that do a single binary search per date on an array as big as all of the transitions that are in the shard - usually 1 or 2. We wouldn't even need to allocate any objects.\r\n3. We have a ton of lovely test cases in `RoundingTests` for \"funny\" cases.\r\n4. We can always drop back to the `java.time` implementation if we don't like ours.\r\n5. We could probably remove `shardRounding` entirely. Not in the first PR, but eventually.\r\n6. I have some performance tests that reproduce exactly how slow this is.\r\n\r\nThe bad news:\r\n1. Daylight savings time is hard.\r\n2. Rounding around it is even harder\r\n3. We'd need to plumb our `lookup` into the aggregator.\r\n4. I'm not 100% sure my `lookup` isn't slower if you have to round a single date. It might be. It might not be.\r\n\r\nAnyway, just an update while I'm thinking about it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/612145895","html_url":"https://github.com/elastic/elasticsearch/issues/54403#issuecomment-612145895","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54403","id":612145895,"node_id":"MDEyOklzc3VlQ29tbWVudDYxMjE0NTg5NQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2020-04-10T17:58:07Z","updated_at":"2020-04-10T17:58:07Z","author_association":"CONTRIBUTOR","body":"This has been on my list for a while and I even have a little of a prototype but I keep getting distracted.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/615916006","html_url":"https://github.com/elastic/elasticsearch/issues/54403#issuecomment-615916006","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54403","id":615916006,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTkxNjAwNg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2020-04-18T18:07:14Z","updated_at":"2020-04-18T18:07:14Z","author_association":"CONTRIBUTOR","body":"I think I have it! PR coming soon!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/615916434","html_url":"https://github.com/elastic/elasticsearch/issues/54403#issuecomment-615916434","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54403","id":615916434,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNTkxNjQzNA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2020-04-18T18:08:50Z","updated_at":"2020-04-18T18:08:50Z","author_association":"CONTRIBUTOR","body":"> I think I have it! PR coming soon!\r\n\r\nEr, now that I think about it, in a few days! I'm sure I can make a faster rounder. Plugging it in will take some time. But I think the rounding tests pass with my rounder now!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/616804635","html_url":"https://github.com/elastic/elasticsearch/issues/54403#issuecomment-616804635","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54403","id":616804635,"node_id":"MDEyOklzc3VlQ29tbWVudDYxNjgwNDYzNQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2020-04-20T20:56:44Z","updated_at":"2020-04-20T20:56:44Z","author_association":"CONTRIBUTOR","body":"Update:\r\n\r\nRounding dates on a shard that contained a daylight savings time transition is currently something like 500% o 1000% slower than when a shard contains dates only on one side of the DST transition. And it makes a ton of short lived garbage. I have an implementation that benchmarks around 60% to 25% slower. And doesn't generate any garbage per search hit.\r\n\r\nThis comes up about twice a year and bothers folks for the same amount of time as their dashboards are long. So a week long dashboard will be slow for a week after the daylight savings time transition.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/681178112","html_url":"https://github.com/elastic/elasticsearch/issues/54403#issuecomment-681178112","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/54403","id":681178112,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MTE3ODExMg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2020-08-26T23:38:03Z","updated_at":"2020-08-26T23:38:03Z","author_association":"CONTRIBUTOR","body":"Closed by #55559.","performed_via_github_app":null}]