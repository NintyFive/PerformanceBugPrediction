{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43228","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43228/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43228/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43228/events","html_url":"https://github.com/elastic/elasticsearch/issues/43228","id":456169751,"node_id":"MDU6SXNzdWU0NTYxNjk3NTE=","number":43228,"title":"The node reports an error during the recovery process","user":{"login":"medivn","id":3378791,"node_id":"MDQ6VXNlcjMzNzg3OTE=","avatar_url":"https://avatars3.githubusercontent.com/u/3378791?v=4","gravatar_id":"","url":"https://api.github.com/users/medivn","html_url":"https://github.com/medivn","followers_url":"https://api.github.com/users/medivn/followers","following_url":"https://api.github.com/users/medivn/following{/other_user}","gists_url":"https://api.github.com/users/medivn/gists{/gist_id}","starred_url":"https://api.github.com/users/medivn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/medivn/subscriptions","organizations_url":"https://api.github.com/users/medivn/orgs","repos_url":"https://api.github.com/users/medivn/repos","events_url":"https://api.github.com/users/medivn/events{/privacy}","received_events_url":"https://api.github.com/users/medivn/received_events","type":"User","site_admin":false},"labels":[{"id":152510590,"node_id":"MDU6TGFiZWwxNTI1MTA1OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Recovery","name":":Distributed/Recovery","color":"0e8a16","default":false,"description":"Anything around constructing a new shard, either from a local or a remote source."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-06-14T10:12:22Z","updated_at":"2019-07-10T02:28:27Z","closed_at":"2019-07-10T02:28:27Z","author_association":"NONE","active_lock_reason":null,"body":"elasticsearch version:6.2.4\r\nThe node reports an error during the recovery process. From the code point of view, it is because there is no judgment whether the string is empty, but why does the Translog have such abnormal data that causes the error?\r\n The log is as follows\r\n\r\n```\r\n[2019-06-14T13:54:10,636][WARN ][o.e.i.c.IndicesClusterStateService] [node-2] [[indexName][1]] marking and sending shard failed due to [failed recovery]\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [indexName][1]: Recovery failed from {node-1}{NYI9biLCQ2W3uJ3mOu5W3A}{bu-VpLxTQvO1AvYwmTNc4g}{192.168.60.78}{192.168.60.78:9300}{ml.machine_memory=16726286336, ml.max_open_jobs=20, ml.enabled=true} into {node-2}{PCcLeyjkREeZ08kEuR0GdQ}{bSKzgm0iRIKLHEgVTeXuMA}{192.168.60.94}{192.168.60.94:9300}{ml.machine_memory=16726286336, ml.max_open_jobs=20, ml.enabled=true}\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:288) [elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:81) [elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:635) [elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:672) [elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.2.4.jar:6.2.4]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_161]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\nCaused by: org.elasticsearch.transport.RemoteTransportException: [node-1][192.168.60.78:9300][internal:index/shard/recovery/start_recovery]\r\nCaused by: org.elasticsearch.index.engine.RecoveryEngineException: Phase[2] phase2 failed\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:211) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1555) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\t... 5 more\r\nCaused by: org.elasticsearch.transport.RemoteTransportException: [node-2][192.168.60.94:9300][internal:index/shard/recovery/translog_ops]\r\nCaused by: org.elasticsearch.index.translog.TranslogException: Failed to write operation [NoOp{seqNo=452743, primaryTerm=18, reason='null'}]\r\n\tat org.elasticsearch.index.translog.Translog.add(Translog.java:500) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:890) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.shard.IndexShard.index(IndexShard.java:738) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.shard.IndexShard.applyIndexOperation(IndexShard.java:707) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.shard.IndexShard.applyTranslogOperation(IndexShard.java:1245) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.RecoveryTarget.indexTranslogOperations(RecoveryTarget.java:403) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$TranslogOperationsRequestHandler.messageReceived(PeerRecoveryTargetService.java:460) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$TranslogOperationsRequestHandler.messageReceived(PeerRecoveryTargetService.java:451) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1555) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\t... 5 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.writeString(StreamOutput.java:320) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.translog.Translog$NoOp.write(Translog.java:1333) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.translog.Translog$NoOp.access$500(Translog.java:1295) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.translog.Translog$Operation.writeOperation(Translog.java:908) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.translog.Translog.writeOperationNoSize(Translog.java:1475) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.translog.Translog.add(Translog.java:476) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:890) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.shard.IndexShard.index(IndexShard.java:738) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.shard.IndexShard.applyIndexOperation(IndexShard.java:707) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.index.shard.IndexShard.applyTranslogOperation(IndexShard.java:1245) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.RecoveryTarget.indexTranslogOperations(RecoveryTarget.java:403) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$TranslogOperationsRequestHandler.messageReceived(PeerRecoveryTargetService.java:460) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$TranslogOperationsRequestHandler.messageReceived(PeerRecoveryTargetService.java:451) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1555) ~[elasticsearch-6.2.4.jar:6.2.4]\r\n\t... 5 more\r\n```","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}