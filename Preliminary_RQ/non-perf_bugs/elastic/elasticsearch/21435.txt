{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21435","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21435/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21435/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21435/events","html_url":"https://github.com/elastic/elasticsearch/issues/21435","id":188308076,"node_id":"MDU6SXNzdWUxODgzMDgwNzY=","number":21435,"title":"java.lang.NoClassDefFoundError: org/elasticsearch/xpack/XPackPlugin","user":{"login":"shivangshah","id":2624839,"node_id":"MDQ6VXNlcjI2MjQ4Mzk=","avatar_url":"https://avatars1.githubusercontent.com/u/2624839?v=4","gravatar_id":"","url":"https://api.github.com/users/shivangshah","html_url":"https://github.com/shivangshah","followers_url":"https://api.github.com/users/shivangshah/followers","following_url":"https://api.github.com/users/shivangshah/following{/other_user}","gists_url":"https://api.github.com/users/shivangshah/gists{/gist_id}","starred_url":"https://api.github.com/users/shivangshah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shivangshah/subscriptions","organizations_url":"https://api.github.com/users/shivangshah/orgs","repos_url":"https://api.github.com/users/shivangshah/repos","events_url":"https://api.github.com/users/shivangshah/events{/privacy}","received_events_url":"https://api.github.com/users/shivangshah/received_events","type":"User","site_admin":false},"labels":[{"id":146829143,"node_id":"MDU6TGFiZWwxNDY4MjkxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Transport%20API","name":":Core/Infra/Transport API","color":"0e8a16","default":false,"description":"Transport client API"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-11-09T17:40:29Z","updated_at":"2017-01-13T05:04:14Z","closed_at":"2016-11-10T19:08:16Z","author_association":"NONE","active_lock_reason":null,"body":"I followed the guide mentioned here https://www.elastic.co/guide/en/x-pack/current/api-java.html and all in all everything worked within the IDE. \r\n\r\nOur application is spring boot based, so we end up creating fat jars for deployment using prebuild maven plugins. The problem is, when we run the jar file we get the following error\r\n\r\n```\r\nCaused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.elasticsearch.client.Client]: Factory method 'esClient' threw exception; nested exception is java.lang.NoClassDefFoundError: org/elasticsearch/xpack/XPackPlugin\r\n\tat org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:189)\r\n\tat org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:588)\r\n\t... 41 common frames omitted\r\nCaused by: java.lang.NoClassDefFoundError: org/elasticsearch/xpack/XPackPlugin\r\n\tat org.elasticsearch.xpack.client.PreBuiltXPackTransportClient.<init>(PreBuiltXPackTransportClient.java:50)\r\n\tat org.elasticsearch.xpack.client.PreBuiltXPackTransportClient.<init>(PreBuiltXPackTransportClient.java:46)\r\n```\r\nHere's the dependencies we added:\r\n```\r\n <dependency>\r\n            <groupId>org.elasticsearch.client</groupId>\r\n            <artifactId>x-pack-transport</artifactId>\r\n            <version>5.0.0</version>\r\n        </dependency>\r\n```\r\n\r\nand here's the code we use to initialize the client (based on the discussion https://github.com/elastic/elasticsearch/issues/19903)\r\n```\r\nNode node = new PluginNode(settings);\r\n        node.start();\r\n        return node.client();\r\n    }\r\n\r\n    static class PluginNode extends Node {\r\n        public PluginNode(Settings settings) {\r\n            super(InternalSettingsPreparer.prepareEnvironment(settings, null), Collections.singletonList(Netty4Plugin.class));\r\n        }\r\n    }\r\n```\r\nalso, once in a while we get this in our CI builds as well\r\n```\r\n[35,35] cannot find symbol\r\n[ERROR] symbol:   class Netty4Plugin\r\n[ERROR] location: package org.elasticsearch.transport\r\n[ERROR] -> [Help 1]\r\n[ERROR] \r\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\r\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\r\n[ERROR] \r\n```\r\nwhich doesn't make sense because x-pack-transport by default includes the `transport` dependency as well \r\n```\r\n[INFO] +- org.elasticsearch.client:x-pack-transport:jar:5.0.0:compile\r\n[INFO] |  |  +- org.elasticsearch.client:rest:jar:5.0.0:compile\r\n[INFO] |  |  \\- org.elasticsearch.client:sniffer:jar:5.0.0:compile\r\n[INFO] |  \\- org.elasticsearch.client:transport:jar:5.0.0:compile\r\n```\r\n\r\nI see others are getting some compile time issues as well (on that thread). Is it possible that at runtime xpack transport client doesn't load the right classes?","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}