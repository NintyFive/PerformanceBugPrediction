[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384132422","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-384132422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":384132422,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMjQyMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T14:51:46Z","updated_at":"2018-04-25T01:31:16Z","author_association":"COLLABORATOR","body":"*Original comment by @abeyad:*\n\nI don't follow - this is expected behavior.  If you set `cluster.routing.allocation.same_shard.host` to `true`, that means even if there are two different nodes on the same host, and a shard copy exists on one of those nodes, then a replica copy won't be allocated to the other node, because they are on the same physical host.  By default, the value for this setting is `false`, so if two nodes are run on the same host, they can each be allocated a copy of the same shard.\r\n\r\nDoes that make sense?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384132423","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-384132423","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":384132423,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMjQyMw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T15:10:55Z","updated_at":"2018-04-25T01:31:16Z","author_association":"COLLABORATOR","body":"*Original comment by @tvernum:*\n\nI think the issue (which we might not consider to be a _problem_) is that the security template sets\r\n```\r\n    \"auto_expand_replicas\" : \"0-all\",\r\n```\r\nSo (I assume, without having actually verified it myself) there's an inherent incompatibility between x-pack security and `cluster.routing.allocation.same_shard.host`\r\n\r\nIf you are running multiple nodes on the same host, and want to set `cluster.routing.allocation.same_shard.host` to `true` in order to ensure your replicas are physically distributed, then your security index will _always_ be yellow.\r\n\r\nI think the _issue_ if there is one, is that `cluster.routing.allocation.same_shard.host` is a blunt instrument - it applies to all indices, even those that are set to auto expand to all nodes.\r\nIn this particularly case it looks like the desired effect would be to have it apply to the user's own indices, but be ignored by the security index.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384132426","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-384132426","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":384132426,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMjQyNg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T15:12:44Z","updated_at":"2018-04-25T01:31:16Z","author_association":"COLLABORATOR","body":"*Original comment by @jaymode:*\n\nI think this ties into whether or not we should use auto expand replicas for the security index (another issue open about that).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384132428","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-384132428","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":384132428,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMjQyOA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-04-28T15:13:49Z","updated_at":"2018-04-25T01:31:16Z","author_association":"COLLABORATOR","body":"*Original comment by @abeyad:*\n\n@tvernum thanks for the explanation, I follow what you're saying.  Yes, I think then given auto_expand_replicas is used in this manner, then setting `cluster.routing.allocation.same_shard.host` to true will always guarantee yellow health for the .security index","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384132429","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-384132429","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":384132429,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMjQyOQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-05-03T06:46:21Z","updated_at":"2018-04-25T01:31:16Z","author_association":"COLLABORATOR","body":"*Original comment by @robin13:*\n\nThere's a lot of people having multiple nodes on one machine: all of them should be using allocation awareness to avoid primary/replica on the same machine (`cluster.routing.allocation.same_shard.host`) so for all of them it seems that using security will be a problem...","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/397629913","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-397629913","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":397629913,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzYyOTkxMw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-15T13:59:12Z","updated_at":"2018-06-15T13:59:12Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/401354450","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-401354450","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":401354450,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTM1NDQ1MA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-06-29T13:29:40Z","updated_at":"2018-06-29T13:29:40Z","author_association":"CONTRIBUTOR","body":"The root cause for this is a well-known issue: auto-expand-replicas and shard allocation settings such as filtering, awareness and `same_shard.host` do not play well together:  https://github.com/elastic/elasticsearch/issues/2869\r\n\r\n@jaymode We discussed this during FixitFriday and wondered if we need to solve the larger issue (linked above) or whether we could just not auto-expand the `.security` index to all nodes. IIRC you mentioned performance concerns a year ago or so. Is this still a current concern or could we change `\"auto_expand_replicas\" : \"0-all\"` for example to `\"auto_expand_replicas\" : \"0-1\"`? I've marked it as team-discuss for the security team (and would be happy to attend the security meeting when this is discussed)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/401356221","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-401356221","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":401356221,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTM1NjIyMQ==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-06-29T13:36:01Z","updated_at":"2018-06-29T13:36:01Z","author_association":"MEMBER","body":"@ywelsch I think we should just go ahead with 0-1, especially since it can be updated by the user if necessary.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/401357304","html_url":"https://github.com/elastic/elasticsearch/issues/29933#issuecomment-401357304","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29933","id":401357304,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMTM1NzMwNA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-06-29T13:40:04Z","updated_at":"2018-06-29T13:40:04Z","author_association":"CONTRIBUTOR","body":"OK, thanks @jaymode ","performed_via_github_app":null}]