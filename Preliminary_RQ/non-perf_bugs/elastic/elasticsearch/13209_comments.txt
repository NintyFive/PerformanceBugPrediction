[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136414740","html_url":"https://github.com/elastic/elasticsearch/issues/13209#issuecomment-136414740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13209","id":136414740,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjQxNDc0MA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-08-31T15:58:44Z","updated_at":"2015-08-31T16:12:21Z","author_association":"MEMBER","body":"Took a first look at `deb-s3`. Like it so far. All you need is an unsigned debian package, specify this debian package on the command line, which upload its automatically, and then asks for the passphrase to sign the `Release` file. No need for complex syncing like done in our scripts right now.\n\nUploading works like this\n\n```\ndeb-s3 upload --preserve-versions elasticsearch-2.0.0-beta1.deb -b $BUCKET --prefix alexr-repo-test/elasticsearch/deb --sign $GPG_KEY_ID --arch amd64\n```\n\nThere are a couple of commands for verifying:\n\n```\n# deb-s3 show elasticsearch 1.7.1 amd64 -b $BUCKET --prefix alexr-repo-test/elasticsearch/deb\n...\n[lists packages contents]\n...\n\n# deb-s3 list -b $BUCKET --prefix alexr-repo-test/elasticsearch/deb\nelasticsearch  1.7.1  all\n\n# deb-s3 verify -b $BUCKET --prefix alexr-repo-test/elasticsearch/deb\n>> Retrieving existing manifests\n>> Checking for missing packages in: stable/main amd64\n>> Checking for missing packages in: stable/main i386\n```\n\nCouple of things I tested\n- replacing existing debian packages\n- keeping the old packages in place, so people can do `apt-get install elasticsearch=X.Y.Z`\n- upgrading debian packages after reinstalling\n\nInstallation works like this, as it is a gem. You need `libz-dev` installed for the `nokogiri` package\n\n```\n# install\nGEM_PATH=/path/deb-s3 GEM_HOME=/path/deb-s3/ gem install deb-s3\n# run, no need to specify paths it seems on run\n/path/deb-s3/bin/deb-s3\n```\n\nNext stop: `rpm-s3`\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136443242","html_url":"https://github.com/elastic/elasticsearch/issues/13209#issuecomment-136443242","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13209","id":136443242,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjQ0MzI0Mg==","user":{"login":"electrical","id":271677,"node_id":"MDQ6VXNlcjI3MTY3Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/271677?v=4","gravatar_id":"","url":"https://api.github.com/users/electrical","html_url":"https://github.com/electrical","followers_url":"https://api.github.com/users/electrical/followers","following_url":"https://api.github.com/users/electrical/following{/other_user}","gists_url":"https://api.github.com/users/electrical/gists{/gist_id}","starred_url":"https://api.github.com/users/electrical/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/electrical/subscriptions","organizations_url":"https://api.github.com/users/electrical/orgs","repos_url":"https://api.github.com/users/electrical/repos","events_url":"https://api.github.com/users/electrical/events{/privacy}","received_events_url":"https://api.github.com/users/electrical/received_events","type":"User","site_admin":false},"created_at":"2015-08-31T17:52:42Z","updated_at":"2015-08-31T17:52:42Z","author_association":"CONTRIBUTOR","body":"Important thing is that both the repo it self and the packages are signed and that we also are able to have multiple versions of ES in the repo and available ( most tools don't allow for that )\n\nAs a side note; we will have the need soon for 2 different signed rpm's. one with the V3 signature ( centos5 / SLES ) and one with V4 signature ( Centos6+, opensuse, etc )\nThis will also need to be a separate repo ( centos5 ipv centos; for example )\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136448990","html_url":"https://github.com/elastic/elasticsearch/issues/13209#issuecomment-136448990","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13209","id":136448990,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjQ0ODk5MA==","user":{"login":"jordansissel","id":131818,"node_id":"MDQ6VXNlcjEzMTgxOA==","avatar_url":"https://avatars1.githubusercontent.com/u/131818?v=4","gravatar_id":"","url":"https://api.github.com/users/jordansissel","html_url":"https://github.com/jordansissel","followers_url":"https://api.github.com/users/jordansissel/followers","following_url":"https://api.github.com/users/jordansissel/following{/other_user}","gists_url":"https://api.github.com/users/jordansissel/gists{/gist_id}","starred_url":"https://api.github.com/users/jordansissel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jordansissel/subscriptions","organizations_url":"https://api.github.com/users/jordansissel/orgs","repos_url":"https://api.github.com/users/jordansissel/repos","events_url":"https://api.github.com/users/jordansissel/events{/privacy}","received_events_url":"https://api.github.com/users/jordansissel/received_events","type":"User","site_admin":false},"created_at":"2015-08-31T18:07:08Z","updated_at":"2015-08-31T18:07:08Z","author_association":"CONTRIBUTOR","body":"@spinscale regarding apt/yum facilities, @drewr and I have been looking (as time permits) at some hosted repository options that may meet our needs (packagecloud, etc). I'd be cool if we used the same solution for all our hosting, but I would consider \"where are the rpm/debs posted?\" a separate problem from how the packages are constructed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136774443","html_url":"https://github.com/elastic/elasticsearch/issues/13209#issuecomment-136774443","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13209","id":136774443,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjc3NDQ0Mw==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-09-01T16:06:55Z","updated_at":"2015-09-01T16:06:55Z","author_association":"MEMBER","body":"@jordansissel absolutely, I think package construction will be hard to unify across projects, and at best switching the underlying repository should only replace a single call to a tool for each package. We can still go with the above tools and switch whenever needed to push things to packagecloud or whatever we opt for\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/136780307","html_url":"https://github.com/elastic/elasticsearch/issues/13209#issuecomment-136780307","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13209","id":136780307,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNjc4MDMwNw==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-09-01T16:20:59Z","updated_at":"2015-09-01T16:22:43Z","author_association":"MEMBER","body":"Spent some time testing [rpm-s3](https://github.com/crohr/rpm-s3) today\n\n## Installation\n- Prerequisites: `yum`, `deltarpm` and `boto`: `apt-get install yum python-deltarpm python-boto`\n- Clone the github repo: `git clone https://github.com/crohr/rpm-s3 --recurse-submodules`\n- Set env vars: `export AWS_ACCESS_KEY=\"key\"` and `export AWS_SECRET_KEY=\"secret\"`\n- Change your `.boto` file (see issues with buckets with dots https://github.com/boto/boto/issues/2836) to this:\n\n```\n[s3]\ncalling_format = boto.s3.connection.OrdinaryCallingFormat\n```\n- Set your `~/.rpmmacros` file to be accordingly with your GPG key\n\n```\n%_signature gpg\n%_gpg_name Test Example\n```\n\nDont forget to import your key on the redhat test system before proceeding\n\n```\nrpm --import http://$BUCKET.s3.amazonaws.com/YOUR-KEY.gpg\n```\n\n```\nrpm-s3/bin/rpm-s3 -v -b $BUCKET -p $PREFIX --sign elasticsearch-1.7.1.noarch.rpm --visibility public-read -k 0\nrpm-s3/bin/rpm-s3 -v -b $BUCKET -p $PREFIX --sign elasticsearch-2.0.0-beta1.rpm --visibility public-read -k 0\n```\n\nShort explanation: Bucket and prefix define the path of the rpm, `visibility` must be `public-read` to make the uploads readable by anyone, `-k 0` instructs `rpm-s3` to not delete old packages, but just incrementally add them. Default is to remove packages older than two releases.\n\n## Signing\n\nVerifying the signature can be done via `rpm --checksig -v elasticsearch-1.7.1.noarch.rpm`\n\nManual signing can be done via `rpm --addsign elasticsearch-1.7.1.noarch.rpm`. Needs to be done currently as the built-in signing seems not to work\n\n## Testing\n\nCreate a repo file in `/etc/yum.repos.d/elasticsearch.repo` \n\n```\n[elasticsearch]\nname=Elasticsearch repository for RPM packages\nbaseurl=http://s3.amazonaws.com/$BUCKET/$PREFIX\ngpgcheck=1\ngpgkey=http://$BUCKET.s3.amazonaws.com/$PREFIX/PUBKEY.gpg\nenabled=1\nmetadata_expire=30\n```\n\nThe expiration of metadata is just needed for testing as otherwise `yum update` will cache and reuse the local version for six hours.\n\nWe could create the above repo file as part of the deployment process, so automated tools can test the repository.\n\n## Summary\n- Pro: You only need the signed RPM and thats it, the tool handles the rest\n- Pro: Adding new RPMs means just uploading them, thats it. No manual download and reconstruction of the repo structure like we do in the current shell script\n- Contra: `rpm --addsign elasticsearch-1.7.1.noarch.rpm` needs to be called manually right now, looks like a bug, filed an issue\n\nNext step: verify completeness of maven staging repo\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137010448","html_url":"https://github.com/elastic/elasticsearch/issues/13209#issuecomment-137010448","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13209","id":137010448,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzAxMDQ0OA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T10:01:18Z","updated_at":"2015-09-02T10:01:18Z","author_association":"MEMBER","body":"Worked on a python script, that is using the local mvn repository and compares its contents to a remote destination (like a staging repo)\n\nScript is doing the following steps\n- Scans the local maven repo for all files in /org/elasticsearch\n- Opens a HTTP connection to the staging repo\n- Executes a HEAD request for each file found in step one\n- Compares the content-length response header with the real file size\n- Return an error if those two numbers differ\n\nOutput looks like this:\n\n![Script while running](https://s3.amazonaws.com/uploads.hipchat.com/29251/250169/ZfCor5NQ00atVzF/output.gif)\n\nThis should fix the problem of incomplete deployments\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137079674","html_url":"https://github.com/elastic/elasticsearch/issues/13209#issuecomment-137079674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13209","id":137079674,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzA3OTY3NA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T13:31:14Z","updated_at":"2015-09-02T13:31:14Z","author_association":"CONTRIBUTOR","body":"I'm about to pick up #13182 and this looks related. At least the signing part. I haven't read all of your notes yet but maybe we should talk some?\n","performed_via_github_app":null}]