{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/63877","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63877/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63877/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63877/events","html_url":"https://github.com/elastic/elasticsearch/issues/63877","id":724571363,"node_id":"MDU6SXNzdWU3MjQ1NzEzNjM=","number":63877,"title":"Index Lifecycle Allocation Routed Step failing with NullPtrException","user":{"login":"DisasteR","id":443279,"node_id":"MDQ6VXNlcjQ0MzI3OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/443279?v=4","gravatar_id":"","url":"https://api.github.com/users/DisasteR","html_url":"https://github.com/DisasteR","followers_url":"https://api.github.com/users/DisasteR/followers","following_url":"https://api.github.com/users/DisasteR/following{/other_user}","gists_url":"https://api.github.com/users/DisasteR/gists{/gist_id}","starred_url":"https://api.github.com/users/DisasteR/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DisasteR/subscriptions","organizations_url":"https://api.github.com/users/DisasteR/orgs","repos_url":"https://api.github.com/users/DisasteR/repos","events_url":"https://api.github.com/users/DisasteR/events{/privacy}","received_events_url":"https://api.github.com/users/DisasteR/received_events","type":"User","site_admin":false},"labels":[{"id":912828538,"node_id":"MDU6TGFiZWw5MTI4Mjg1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/ILM+SLM","name":":Core/Features/ILM+SLM","color":"0e8a16","default":false,"description":"Index and Snapshot lifecycle management"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2020-10-19T12:37:39Z","updated_at":"2020-11-12T08:41:08Z","closed_at":"2020-11-09T22:19:24Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n\r\n```\r\nVersion: 6.8.12, Build: default/deb/7a15d2a/2020-08-12T07:27:20.804867Z, JVM: 1.8.0_252\r\n```\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\n\r\n```\r\nopenjdk version \"1.8.0_252\"\r\nOpenJDK Runtime Environment (build 1.8.0_252-8u252-b09-1~18.04-b09)\r\nOpenJDK 64-Bit Server VM (build 25.252-b09, mixed mode)\r\n```\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\n```\r\nLinux esl-master-01 4.15.0-55-generic #60-Ubuntu SMP Tue Jul 2 18:22:20 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nFollowing https://discuss.elastic.co/t/index-lifecycle-allocation-routed-step-failing-with-nullptrexception/252331 i open a issue here\r\n\r\nWe are running an ElasticSearch 6.8.12 cluster.\r\n\r\nWe just implemented ILM for our indexes.\r\n\r\nHere is our ILM Policy :\r\n\r\n```\r\n  {\r\n      \"policy\": {\r\n          \"phases\": {\r\n              /* Hot phase - Resync Priority 100 */\r\n              \"hot\": {\r\n                  \"min_age\": \"0ms\",\r\n                  \"actions\": {\r\n                      \"set_priority\": {\r\n                          \"priority\": 100\r\n                      }\r\n                  }\r\n              },\r\n              /* Warm phase - Resync Priority 50 */\r\n              \"warm\": {\r\n                  \"min_age\": \"30d\",\r\n                  \"actions\": {\r\n                      \"set_priority\": {\r\n                          \"priority\": 50\r\n                      }\r\n                  }\r\n              },\r\n              /* Cold phase - Resync Priority 0 - Apply storageclass = mass */\r\n              \"cold\": {\r\n                  \"min_age\": \"90d\",\r\n                  \"actions\": {\r\n                      \"allocate\": {\r\n                          \"require\": {\r\n                              \"storageclass\": \"mass\"\r\n                          }\r\n                      },\r\n                      \"set_priority\": {\r\n                          \"priority\": 0\r\n                      }\r\n                  }\r\n              }\r\n          }\r\n      }\r\n  }\r\n```\r\n\r\nSteps Hot and Warm run successfully but we are facing a NullPointer Exception on Cold phase during AllocationRoutedStep\r\n\r\nHere is the stacktrace from an index/_ilm/explain :\r\n\r\n```\r\njava.lang.NullPointerException\r\n\tat org.elasticsearch.xpack.core.indexlifecycle.AllocationRoutedStep.isConditionMet(AllocationRoutedStep.java:70)\r\n\tat org.elasticsearch.xpack.indexlifecycle.ExecuteStepsUpdateTask.execute(ExecuteStepsUpdateTask.java:123)\r\n\tat org.elasticsearch.cluster.ClusterStateUpdateTask.execute(ClusterStateUpdateTask.java:47)\r\n\tat org.elasticsearch.cluster.service.MasterService.executeTasks(MasterService.java:643)\r\n\tat org.elasticsearch.cluster.service.MasterService.calculateTaskOutputs(MasterService.java:270)\r\n\tat org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:200)\r\n\tat org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:135)\r\n\tat org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150)\r\n\tat org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188)\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681)\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:252)\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:215)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n\r\n","closed_by":{"login":"joegallo","id":187034,"node_id":"MDQ6VXNlcjE4NzAzNA==","avatar_url":"https://avatars2.githubusercontent.com/u/187034?v=4","gravatar_id":"","url":"https://api.github.com/users/joegallo","html_url":"https://github.com/joegallo","followers_url":"https://api.github.com/users/joegallo/followers","following_url":"https://api.github.com/users/joegallo/following{/other_user}","gists_url":"https://api.github.com/users/joegallo/gists{/gist_id}","starred_url":"https://api.github.com/users/joegallo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joegallo/subscriptions","organizations_url":"https://api.github.com/users/joegallo/orgs","repos_url":"https://api.github.com/users/joegallo/repos","events_url":"https://api.github.com/users/joegallo/events{/privacy}","received_events_url":"https://api.github.com/users/joegallo/received_events","type":"User","site_admin":false},"performed_via_github_app":null}