{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15288","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15288/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15288/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15288/events","html_url":"https://github.com/elastic/elasticsearch/issues/15288","id":120833416,"node_id":"MDU6SXNzdWUxMjA4MzM0MTY=","number":15288,"title":"NumberFormatException with ip type","user":{"login":"timmgrant","id":16194815,"node_id":"MDQ6VXNlcjE2MTk0ODE1","avatar_url":"https://avatars1.githubusercontent.com/u/16194815?v=4","gravatar_id":"","url":"https://api.github.com/users/timmgrant","html_url":"https://github.com/timmgrant","followers_url":"https://api.github.com/users/timmgrant/followers","following_url":"https://api.github.com/users/timmgrant/following{/other_user}","gists_url":"https://api.github.com/users/timmgrant/gists{/gist_id}","starred_url":"https://api.github.com/users/timmgrant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmgrant/subscriptions","organizations_url":"https://api.github.com/users/timmgrant/orgs","repos_url":"https://api.github.com/users/timmgrant/repos","events_url":"https://api.github.com/users/timmgrant/events{/privacy}","received_events_url":"https://api.github.com/users/timmgrant/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-12-07T18:06:09Z","updated_at":"2015-12-07T19:12:27Z","closed_at":"2015-12-07T19:12:27Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nI am using:\n\n elasticsearch: 2.0.0\n logstash: 2.0.0\n\nWhen using the 'ip' type in elasticsearch I get a NumberFormatException.\n\ntemplate is:\n\n``` javascript\n{\n    \"template\" : \"frameaccess-*\",\n    \"aliases\" : { },\n    \"mappings\" : {\n        \"frameaccess\" : {\n            \"properties\" : {\n                \"@timestamp\" : {\"type\" : \"date\",\"format\" : \"dateOptionalTime\"},\n                \"@version\" : {\"type\" : \"string\", \"index\" : \"not_analyzed\"},\n                \"host\" : {\"type\" : \"string\", \"index\" : \"not_analyzed\"},\n                \"message\" : {\"type\" : \"string\"},\n                \"clientip\" : {\"type\" : \"ip\", \"store\": \"true\", \"index\" : \"not_analyzed\"},\n                \"username\" : {\"type\" : \"string\", \"index\" : \"not_analyzed\"},\n                \"method\" : {\"type\" : \"string\", \"index\" : \"not_analyzed\"},\n                \"request\" : {\"type\" : \"string\"},\n                \"http_version\" : {\"type\" : \"float\"},\n                \"http_status_code\" : {\"type\" : \"integer\"},\n                \"size\" : {\"type\" : \"long\"},\n                                \"responsetime\" : {\"type\" : \"double\"},\n                \"source\" : {\"type\" : \"string\", \"index\" : \"not_analyzed\"}\n            }\n        }\n    },\n    \"settings\" : {\n        \"index\" : {\n            \"number_of_shards\" : \"3\",\n            \"number_of_replicas\" : \"1\"\n        }\n    }\n}\n```\n\nlogstash config is:\n\n``` javascript\ninput { \n   stdin { codec => plain }\n}\noutput { \n   elasticsearch {\n      hosts => \"elasticsearchurl.company.com:80\"\n      index => \"frameaccess-%{+YYYY.MM.dd}\"\n   }\n}\nfilter {\n  grok {\n    match => [\n      \"message\",\n      '(-|%{IPORHOST:clientip}) \\- (-|%{HTTPDUSER:username}) \\[%{HTTPDATE:timestamp}\\] \"%{WORD:method} %{URIPATHPARAM:request} HTTP/%{NUMBER:http_version}\" (-|%{INT:http_status_code}) (-|%{INT:size}) (-|%{NUMBER:responsetime})'\n    ]\n  }\n\n  date {\n    locale => \"en\"\n    timezone => \"Europe/London\"\n    match => [ \"timestamp\", \"dd/MMM/yyyy:HH:mm:ss Z\" ]\n  }\n\n  mutate {\n    add_field => { \"source\" => \"appname\" }\n    replace => { \"host\" => \"mynodehostname.company.com\" }\n    remove_field => [ \"timestamp\" ]\n  }\n}\n```\n\nTest input is:\n\n`192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \"POST /ctx/minimumEntry.jsp HTTP/1.1\" 200 48005 0.285`\n\nResult is:\n\n```\nio/console not supported; tty will not be manipulated\nDefault settings used: Filter workers: 4\nLogstash startup completed\n?[33mFailed action.  {:status=>400, :action=>[\"index\", {:_id=>nil, :_index=>\"frameaccess-2015.09.28\", :_type=>\"logs\", :_routing=>nil}, #<LogStash::Event:0x48d26c4b @metadata={\"retry_count\"=>0}, @accessors=#<LogStash::Util::Accessors:0x7ae71f79 @store={\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, @lut={\"host\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"host\"], \"message\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\",\"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"message\"], \"clientip\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"clientip\"], \"username\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\",\"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"username\"], \"timestamp\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"timestamp\"], \"method\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"method\"], \"request\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"request\"], \"http_version\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\",\"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"http_version\"], \"http_status_code\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"http_status_code\"], \"size\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"size\"], \"responsetime\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"responsetime\"], \"@timestamp\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"@timestamp\"], \"source\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\",\"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"source\"], \"type\"=>[{\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, \"type\"]}>, @data={\"message\"=>\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\", \"@version\"=>\"1\", \"@timestamp\"=>\"2015-09-28T23:00:00.000Z\", \"host\"=>\"mynodehostname.company.com\", \"clientip\"=>\"192.168.0.1\", \"username\"=>\"fbloggs\", \"method\"=>\"POST\", \"request\"=>\"/ctx/minimumEntry.jsp\", \"http_version\"=>\"1.1\", \"http_status_code\"=>\"200\", \"size\"=>\"48005\", \"responsetime\"=>\"0.285\", \"source\"=>\"appname\"}, @metadata_accessors=#<LogStash::Util::Accessors:0x124e57b @store={\"retry_count\"=>0}, @lut={}>, @cancelled=false>], :response=>{\"create\"=>{\"_index\"=>\"frameaccess-2015.09.28\", \"_type\"=>\"logs\", \"_id\"=>\"AVF9g1sPPii72JEyi-z_\", \"status\"=>400, \"error\"=>{\"type\"=>\"mapper_parsing_exception\", \"reason\"=>\"failed to parse [clientip]\", \"caused_by\"=>{\"type\"=>\"number_format_exception\", \"reason\"=>\"For input string: \\\"192.168.0.1\\\"\"}}}}, :level=>:warn}?[0m\nLogstash shutdown completed\n```\n\nLog says:\n\n```\n[2015-12-07 16:58:23,968][DEBUG][action.bulk              ] [MACHINENAME] [frameaccess-2015.09.28][2] failed to execute bulk item (index) index {[frameaccess-2015.09.28][logs][AVF9YT5FPii72JEyi-z9], source[{\"message\":\"192.168.0.1 - fbloggs [29/Sep/2015:00:00:00 +0100] \\\"POST /ctx/minimumEntry.jsp HTTP/1.1\\\" 200 48005 0.285\\r\",\"@version\":\"1\",\"@timestamp\":\"2015-09-28T23:00:00.000Z\",\"host\":\"mynodehostname.company.com\",\"clientip\":\"192.168.0.1\",\"username\":\"fbloggs\",\"method\":\"POST\",\"request\":\"/ctx/minimumEntry.jsp\",\"http_version\":\"1.1\",\"http_status_code\":\"200\",\"size\":\"48005\",\"responsetime\":\"0.285\",\"source\":\"appname\"}]}\nMapperParsingException[failed to parse [clientip]]; nested: NumberFormatException[For input string: \"192.168.0.1\"];\n    at org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:339)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:314)\n    at org.elasticsearch.index.mapper.DocumentParser.parseAndMergeUpdate(DocumentParser.java:762)\n    at org.elasticsearch.index.mapper.DocumentParser.parseDynamicValue(DocumentParser.java:676)\n    at org.elasticsearch.index.mapper.DocumentParser.parseValue(DocumentParser.java:447)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:267)\n    at org.elasticsearch.index.mapper.DocumentParser.innerParseDocument(DocumentParser.java:128)\n    at org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:79)\n    at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:318)\n    at org.elasticsearch.index.shard.IndexShard.prepareCreate(IndexShard.java:503)\n    at org.elasticsearch.index.shard.IndexShard.prepareCreate(IndexShard.java:494)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction.prepareIndexOperationOnPrimary(TransportReplicationAction.java:1052)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction.executeIndexRequestOnPrimary(TransportReplicationAction.java:1060)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardIndexOperation(TransportShardBulkAction.java:338)\n    at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:131)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.performOnPrimary(TransportReplicationAction.java:579)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase$1.doRun(TransportReplicationAction.java:452)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NumberFormatException: For input string: \"192.168.0.1\"\n    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\n    at java.lang.Long.parseLong(Long.java:589)\n    at java.lang.Long.parseLong(Long.java:631)\n    at org.elasticsearch.common.xcontent.support.AbstractXContentParser.longValue(AbstractXContentParser.java:145)\n    at org.elasticsearch.index.mapper.core.LongFieldMapper.innerParseCreateField(LongFieldMapper.java:276)\n    at org.elasticsearch.index.mapper.core.NumberFieldMapper.parseCreateField(NumberFieldMapper.java:213)\n    at org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:331)\n    ... 20 more\n```\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}