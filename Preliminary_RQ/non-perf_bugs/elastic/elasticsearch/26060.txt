{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26060","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26060/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26060/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26060/events","html_url":"https://github.com/elastic/elasticsearch/issues/26060","id":248008634,"node_id":"MDU6SXNzdWUyNDgwMDg2MzQ=","number":26060,"title":"Upsert using index aliases","user":{"login":"jhberthemet","id":8289170,"node_id":"MDQ6VXNlcjgyODkxNzA=","avatar_url":"https://avatars0.githubusercontent.com/u/8289170?v=4","gravatar_id":"","url":"https://api.github.com/users/jhberthemet","html_url":"https://github.com/jhberthemet","followers_url":"https://api.github.com/users/jhberthemet/followers","following_url":"https://api.github.com/users/jhberthemet/following{/other_user}","gists_url":"https://api.github.com/users/jhberthemet/gists{/gist_id}","starred_url":"https://api.github.com/users/jhberthemet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhberthemet/subscriptions","organizations_url":"https://api.github.com/users/jhberthemet/orgs","repos_url":"https://api.github.com/users/jhberthemet/repos","events_url":"https://api.github.com/users/jhberthemet/events{/privacy}","received_events_url":"https://api.github.com/users/jhberthemet/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2017-08-04T13:36:47Z","updated_at":"2017-09-06T09:21:12Z","closed_at":"2017-08-04T14:09:49Z","author_association":"NONE","active_lock_reason":null,"body":"We're using 1.7.5 for now but we are migrating to 5.5 soon. We use index aliases to update our mapping, usually to add a new field, it does not happen often and data is to be kept between 1 and 5 years depending on the deployment.\r\n\r\nA document is large (emails/chats) so we use partial upserts to update status, add comments or metadata. When a new mapping is applied using a new index on the alias, and using upsert on an existing document in the previous index, the delta is created to the new index, the old version of the document still exists in the old alias and only the new data is in the new index. If we count the data, using _id:* for example we have extra results too.\r\n\r\nWhen searching we can still find the doc using old data, such as status=processing as well as status=done.\r\nDeletes works fine, but upserts don't work as we'd expect.\r\n\r\nWhen using upsert, I obviously don't know if the document already exist and in which index it may exist. Is there a solution so that upserting a document would move the data to the newest index?","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}