{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21106","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21106/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21106/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21106/events","html_url":"https://github.com/elastic/elasticsearch/issues/21106","id":185047202,"node_id":"MDU6SXNzdWUxODUwNDcyMDI=","number":21106,"title":"Build a histogram based on the doc_count field of a Terms Aggregation","user":{"login":"MarcAragones","id":4242939,"node_id":"MDQ6VXNlcjQyNDI5Mzk=","avatar_url":"https://avatars1.githubusercontent.com/u/4242939?v=4","gravatar_id":"","url":"https://api.github.com/users/MarcAragones","html_url":"https://github.com/MarcAragones","followers_url":"https://api.github.com/users/MarcAragones/followers","following_url":"https://api.github.com/users/MarcAragones/following{/other_user}","gists_url":"https://api.github.com/users/MarcAragones/gists{/gist_id}","starred_url":"https://api.github.com/users/MarcAragones/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MarcAragones/subscriptions","organizations_url":"https://api.github.com/users/MarcAragones/orgs","repos_url":"https://api.github.com/users/MarcAragones/repos","events_url":"https://api.github.com/users/MarcAragones/events{/privacy}","received_events_url":"https://api.github.com/users/MarcAragones/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-10-25T08:12:12Z","updated_at":"2018-03-22T19:24:55Z","closed_at":"2018-03-22T19:24:55Z","author_association":"NONE","active_lock_reason":null,"body":"## Describe the feature\n\nBuild a histogram based on the `doc_count` field of a Terms Aggregation.\n## Example\n\nImagine we have the names of some cities and their streets:\n\n``` json\n{ \"city\":\"New York\",      \"street\":\"Atlantic Avenue\" }\n{ \"city\":\"New York\",      \"street\":\"Hudson Street\" }\n{ \"city\":\"New York\",      \"street\":\"Fawn Court\" }\n{ \"city\":\"Boston\",        \"street\":\"Atlantic Avenue\" }\n{ \"city\":\"Boston\",        \"street\":\"Hudson Street\" }\n{ \"city\":\"Boston\",        \"street\":\"7th Avenue\" }\n{ \"city\":\"Washington DC\", \"street\":\"Atlantic Avenue\" }\n{ \"city\":\"Washington DC\", \"street\":\"Dogwood Drive\" }\n{ \"city\":\"Washington DC\", \"street\":\"7th Avenue\" }\n```\n\nIf we count each time that a street appears (this would be the **Terms Aggregation**), we will get the following:\n\n```\n| Street name     | Number of times |\n|-----------------|-----------------|\n| Atlantic Avenue |               3 |\n| Hudson Street   |               2 |\n| 7th Avenue      |               2 |\n| Hudson Street   |               1 |\n| Dogwood Drive   |               1 |\n```\n\nNow, the feature would have to build a histogram that says how many street names are unique, how many are seen in two cities, and so on...\n\nTo do so, we should get the result of a **Terms Aggregation** and send it to a **Histogram Aggregation**.\n\nHere is the result for the example above:\n\n```\n| Street name count | Number of times |\n|-------------------|-----------------|\n|                 1 |               2 |\n|                 2 |               2 |\n|                 3 |               1 |\n```\n### What could be done\n\nThe first table is build with the results of the following aggregation:\n\n``` bash\ncurl -XGET 'http://localhost:9200/index1/type1/_search?pretty' -d '\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"group_by_street\": {\n      \"terms\": {\n        \"field\": \"street\"\n      }\n    }\n  }\n}'\n```\n\nThen, if we add the histogram, it could be something like this:\n\n``` bash\ncurl -XGET 'http://localhost:9200/index1/type1/_search?pretty' -d '\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"histogram_streets\": {\n      \"histogram\": {\n        \"field\": \"group_by_street>_count\",\n        \"interval\": 1\n      },\n      \"aggs\": {\n        \"group_by_street\": {\n          \"terms\": {\n            \"field\": \"street\"\n          }\n        }\n      }\n    }\n  }\n}'\n```\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}