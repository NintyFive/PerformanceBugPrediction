{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31988","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31988/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31988/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31988/events","html_url":"https://github.com/elastic/elasticsearch/issues/31988","id":340536280,"node_id":"MDU6SXNzdWUzNDA1MzYyODA=","number":31988,"title":"response 503, reason: org.elasticsearch.search.aggregations.pipeline.InternalSimpleValue cannot be cast to org.elasticsearch.search.aggregations.InternalMultiBucketAggregation.","user":{"login":"hzjiangjian","id":17780195,"node_id":"MDQ6VXNlcjE3NzgwMTk1","avatar_url":"https://avatars1.githubusercontent.com/u/17780195?v=4","gravatar_id":"","url":"https://api.github.com/users/hzjiangjian","html_url":"https://github.com/hzjiangjian","followers_url":"https://api.github.com/users/hzjiangjian/followers","following_url":"https://api.github.com/users/hzjiangjian/following{/other_user}","gists_url":"https://api.github.com/users/hzjiangjian/gists{/gist_id}","starred_url":"https://api.github.com/users/hzjiangjian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hzjiangjian/subscriptions","organizations_url":"https://api.github.com/users/hzjiangjian/orgs","repos_url":"https://api.github.com/users/hzjiangjian/repos","events_url":"https://api.github.com/users/hzjiangjian/events{/privacy}","received_events_url":"https://api.github.com/users/hzjiangjian/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"}],"state":"closed","locked":false,"assignee":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"assignees":[{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2018-07-12T08:23:34Z","updated_at":"2018-09-04T13:23:37Z","closed_at":"2018-09-04T13:23:37Z","author_association":"NONE","active_lock_reason":null,"body":"hi, there is an error occured when i try to use \"sum_bucket\" aggregation. Query body is like:\r\n\r\n```\r\nget /index/type/_search\r\n{\r\n   \"query\":{\r\n      \"bool\":{\r\n         \"filter\":[\r\n            {\r\n               \"range\":{\r\n                  \"time\":{\r\n                     \"gte\":1531365921000,\r\n                     \"lte\":1531365931000\r\n                  }\r\n               }\r\n            }\r\n         ],\r\n         \"must\":[\r\n            {\r\n               \"match\":{\r\n                  \"key\":\"value\"\r\n               }\r\n            }\r\n         ]\r\n      }\r\n   },\r\n   \"aggs\":{\r\n      \"vals\":{\r\n         \"terms\":{\r\n            \"field\":\"field1\",\r\n            \"size\":1000\r\n         },\r\n         \"aggs\":{\r\n            \"field2\":{\r\n               \"sum_bucket\":{\r\n                  \"buckets_path\":\"vals>field2\"\r\n               }\r\n            },\r\n            \"vals\":{\r\n               \"aggs\":{\r\n                  \"field2\":{\r\n                     \"avg\":{\r\n                        \"field\":\"field2\"\r\n                     }\r\n                  }\r\n               },\r\n               \"terms\":{\r\n                  \"field\":\"field3\"\r\n               }\r\n            }\r\n         }\r\n      }\r\n   },\r\n   \"size\":0\r\n}\r\n```\r\nbut i get an error response:\r\n>'{\"error\":{\"root_cause\":[],\"type\":\"search_phase_execution_exception\",\"reason\":\"\",\"phase\":\"fetch\",\"grouped\":true,\"failed_shards\":[],\"caused_by\":{\"type\":\"class_cast_exception\",\"reason\":\"org.elasticsearch.search.aggregations.pipeline.InternalSimpleValue cannot be cast to org.elasticsearch.search.aggregations.InternalMultiBucketAggregation\"}},\"status\":503}\r\n\r\nThe version of es is 6.1.3,  platform centos6.5.\r\n\r\nCan Someone tell me what happened? Thanks!","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}