[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/140047268","html_url":"https://github.com/elastic/elasticsearch/issues/13553#issuecomment-140047268","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13553","id":140047268,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MDA0NzI2OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-14T11:47:24Z","updated_at":"2015-09-14T11:47:24Z","author_association":"CONTRIBUTOR","body":"This isn't a bug: if the node name is not specified in the settings, then the settings shouldn't be updated to reflect the resolved node name.  Currently you would need to get the ClusterService and retrieve the local node name.\n\nPerhaps there is a way of making this easier/lighter for use in unit tests?  The alternative would be to just specify node names explicitly.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/140052956","html_url":"https://github.com/elastic/elasticsearch/issues/13553#issuecomment-140052956","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13553","id":140052956,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MDA1Mjk1Ng==","user":{"login":"beiske","id":98256,"node_id":"MDQ6VXNlcjk4MjU2","avatar_url":"https://avatars2.githubusercontent.com/u/98256?v=4","gravatar_id":"","url":"https://api.github.com/users/beiske","html_url":"https://github.com/beiske","followers_url":"https://api.github.com/users/beiske/followers","following_url":"https://api.github.com/users/beiske/following{/other_user}","gists_url":"https://api.github.com/users/beiske/gists{/gist_id}","starred_url":"https://api.github.com/users/beiske/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/beiske/subscriptions","organizations_url":"https://api.github.com/users/beiske/orgs","repos_url":"https://api.github.com/users/beiske/repos","events_url":"https://api.github.com/users/beiske/events{/privacy}","received_events_url":"https://api.github.com/users/beiske/received_events","type":"User","site_admin":false},"created_at":"2015-09-14T12:16:59Z","updated_at":"2015-09-14T12:16:59Z","author_association":"MEMBER","body":"The current way to retrieve the autogenerated node name (the one used if no node name is given in the settings) is to depend on `ClusterService` and then do `clusterService.localNode().getName()`. The problem with this is that the ClusterService is relatively high in the dependency hierarchy. This results in unnecessary complexity for tests and can cause challenges with circular dependencies. \n\nMy suggestion is to extract the instance name property into it's own class so that it may be depended on directly, like ClusterName. \n\nMaybe it is also be possible to do something generic? Are there more properties like this? I guess the distinctive feature in this regard is that it is a property of the running instance that is not necessarily defined in the settings and, unlike most settings, the default value is not static. Had it been a dynamic property that could change at runtime I would consider it justified to depend on the ClusterService.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/140052967","html_url":"https://github.com/elastic/elasticsearch/issues/13553#issuecomment-140052967","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13553","id":140052967,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MDA1Mjk2Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-09-14T12:17:02Z","updated_at":"2015-09-14T12:22:33Z","author_association":"MEMBER","body":"The property to get when you are relying on randomly generated names is `name`, not `node.name`. You can see this if you inspect what happens in [`InternalSettingsPreparer#finalizeSettings`](https://github.com/elastic/elasticsearch/blob/bd025080c4feb4b0cd941d007bb5d2113ef0d411/core/src/main/java/org/elasticsearch/node/internal/InternalSettingsPreparer.java#L165), especially [lines 179-185](https://github.com/elastic/elasticsearch/blob/bd025080c4feb4b0cd941d007bb5d2113ef0d411/core/src/main/java/org/elasticsearch/node/internal/InternalSettingsPreparer.java#L179-L185) and [lines 198--205](https://github.com/elastic/elasticsearch/blob/bd025080c4feb4b0cd941d007bb5d2113ef0d411/core/src/main/java/org/elasticsearch/node/internal/InternalSettingsPreparer.java#L198-L205).\n\nThis is the relevant property because that's what the [node ultimately uses when it starts up](https://github.com/elastic/elasticsearch/blob/bd025080c4feb4b0cd941d007bb5d2113ef0d411/core/src/main/java/org/elasticsearch/node/Node.java#L239). \n","performed_via_github_app":null}]