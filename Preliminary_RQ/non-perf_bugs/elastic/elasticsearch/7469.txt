{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7469","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7469/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7469/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7469/events","html_url":"https://github.com/elastic/elasticsearch/issues/7469","id":41229410,"node_id":"MDU6SXNzdWU0MTIyOTQxMA==","number":7469,"title":"Getting different results while using bool query vs bool query with function score query","user":{"login":"akshaysh","id":8562091,"node_id":"MDQ6VXNlcjg1NjIwOTE=","avatar_url":"https://avatars1.githubusercontent.com/u/8562091?v=4","gravatar_id":"","url":"https://api.github.com/users/akshaysh","html_url":"https://github.com/akshaysh","followers_url":"https://api.github.com/users/akshaysh/followers","following_url":"https://api.github.com/users/akshaysh/following{/other_user}","gists_url":"https://api.github.com/users/akshaysh/gists{/gist_id}","starred_url":"https://api.github.com/users/akshaysh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/akshaysh/subscriptions","organizations_url":"https://api.github.com/users/akshaysh/orgs","repos_url":"https://api.github.com/users/akshaysh/repos","events_url":"https://api.github.com/users/akshaysh/events{/privacy}","received_events_url":"https://api.github.com/users/akshaysh/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"assignees":[{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2014-08-26T22:23:02Z","updated_at":"2014-10-22T15:07:56Z","closed_at":"2014-10-22T15:07:56Z","author_association":"NONE","active_lock_reason":null,"body":"I am trying to add a custom boost to the different should clauses in the bool query, but I am getting different number of results when I use the bool query with 2 should clauses containing 2 simple query string query vs a bool query with 2 should clauses with 2 function score query encapsulating the same simple query string queries. \nThe following query returns me 2 results for my data set:\n{\n  \"query\" : {\n    \"filtered\" : {\n          \"query\" : {\n            \"bool\" : {\n              \"should\" : [ {\n                    \"simple_query_string\" : {\n                      \"query\" : \"128\",\n                      \"fields\" : [ \"content.name_enu.simple\" ]\n                    }\n                  }, {\n                    \"simple_query_string\" : {\n                      \"query\" : \"128\",\n                      \"fields\" : [ \"content.name_enu.simple_with_numeric\" ]\n                    }\n                  } ]\n            }\n      },\n      \"filter\" : {\n        \"bool\" : {\n          \"must\" : [ {\n            \"term\" : {\n              \"securityInfo.securityType\" : \"open\"\n            }\n          }, {\n            \"bool\" : {\n              \"must\" : [ {\n                \"term\" : {\n                  \"sourceId.sourceSystem\" : \"jmeter_007971_numeric\"\n                }\n              }, {\n                \"term\" : {\n                  \"sourceId.type\" : \"file\"\n                }\n              } ]\n            }\n          } ],\n          \"_cache\" : true\n        }\n      }\n    }\n  },\n  \"fields\" : [ \"elementId\", \"sourceId.id\", \"sourceId.type\", \"sourceId.sourceSystem\", \"sourceVersion\", \"content.name_enu\" ]\n}\n\nWhere as if I use the following query I get 5 results, same simple query strings but with function scores:\n{\n  \"query\" : {\n    \"filtered\" : {\n          \"query\" : {\n            \"bool\" : {\n              \"should\" : [ {\n                \"function_score\" : {\n                  \"query\" : {\n                    \"simple_query_string\" : {\n                      \"query\" : \"128\",\n                      \"fields\" : [ \"content.name_enu.simple\" ]\n                    }\n                  },\n                  \"boost_factor\" : 1.5\n                }\n              }, {\n                \"function_score\" : {\n                  \"query\" : {\n                    \"simple_query_string\" : {\n                      \"query\" : \"128\",\n                      \"fields\" : [ \"content.name_enu.simple_with_numeric\" ]\n                    }\n                  },\n                  \"boost_factor\" : 2.5\n                }\n              } ]\n            }\n      },\n      \"filter\" : {\n        \"bool\" : {\n          \"must\" : [ {\n            \"term\" : {\n              \"securityInfo.securityType\" : \"open\"\n            }\n          }, {\n            \"bool\" : {\n              \"must\" : [ {\n                \"term\" : {\n                  \"sourceId.sourceSystem\" : \"jmeter_007971_numeric\"\n                }\n              }, {\n                \"term\" : {\n                  \"sourceId.type\" : \"file\"\n                }\n              } ]\n            }\n          } ],\n          \"_cache\" : true\n        }\n      }\n    }\n  },\n  \"fields\" : [ \"elementId\", \"sourceId.id\", \"sourceId.type\", \"sourceId.sourceSystem\", \"sourceVersion\", \"content.name_enu\" ]\n}\n\nFrom my understanding of how the should clause works I was expecting both the queries to return 5 results but I am not able to understand why the 1st query returns me 2 results for my data set. The \"content.name_enu.simple\" uses a simple analyzer, whereas simple_with_numeric uses whitespace tokenizer and lowercase filter\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}