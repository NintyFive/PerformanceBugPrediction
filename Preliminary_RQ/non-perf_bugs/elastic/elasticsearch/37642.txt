{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37642","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37642/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37642/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37642/events","html_url":"https://github.com/elastic/elasticsearch/issues/37642","id":401191800,"node_id":"MDU6SXNzdWU0MDExOTE4MDA=","number":37642,"title":"[Feature Request] Aggregate values proportionally across buckets","user":{"login":"j-white","id":1379749,"node_id":"MDQ6VXNlcjEzNzk3NDk=","avatar_url":"https://avatars3.githubusercontent.com/u/1379749?v=4","gravatar_id":"","url":"https://api.github.com/users/j-white","html_url":"https://github.com/j-white","followers_url":"https://api.github.com/users/j-white/followers","following_url":"https://api.github.com/users/j-white/following{/other_user}","gists_url":"https://api.github.com/users/j-white/gists{/gist_id}","starred_url":"https://api.github.com/users/j-white/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/j-white/subscriptions","organizations_url":"https://api.github.com/users/j-white/orgs","repos_url":"https://api.github.com/users/j-white/repos","events_url":"https://api.github.com/users/j-white/events{/privacy}","received_events_url":"https://api.github.com/users/j-white/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-01-21T04:45:31Z","updated_at":"2019-01-29T15:45:38Z","closed_at":"2019-01-29T15:45:24Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:\r\nWe have a use case to generate high precision time series from Netflow records stored as documents in Elasticsearch.\r\n\r\nGiven a Netflow record with the following fields:\r\n```json\r\n{\r\n  \"timestamp\": 460,\r\n  \"netflow.first_switched\": 100,\r\n  \"netflow.last_switched\": 450,\r\n  \"netflow.bytes\": 350\r\n}\r\n```\r\n\r\nWe would like to be able to generate time series with start=0, end=500, step=100, and have the following data points:\r\n```\r\nt=0, bytes=0\r\nt=100, bytes=100\r\nt=200, bytes=100\r\nt=300, bytes=100\r\nt=400, bytes=50\r\nt=500, bytes=0\r\n```\r\n\r\nThe flow record indicates that a total of 350 bytes were transferred between t=[100,450], and the resulting series splits these values proportionally across the different buckets based on the overlap.\r\n\r\nIn the case were many documents were being aggregated, the resulting buckets would contain the sum.\r\n\r\nDuring some previous research, we could not find a way to achieve this with existing facilities, so we developed a custom aggregation plugin - see https://github.com/OpenNMS/elasticsearch-drift-plugin. \r\n\r\nSome example queries for the plugin in practice look like: https://gist.github.com/j-white/5c188e5c56fea3f14ea99ab6c1280ceb#time-series-for-top-n-applications\r\n\r\nWe're ready to work on cleaning up the code and working on making the changes necessary to help get this upstream, but before we do this we'd would like to confirm:\r\n* Are these any existing facilities for achieving this already? Maybe something existing we missed, or something new since we last checked in 6.2.x.\r\n* Is there interest in having this functionality as part of the core?\r\n","closed_by":{"login":"not-napoleon","id":979663,"node_id":"MDQ6VXNlcjk3OTY2Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/979663?v=4","gravatar_id":"","url":"https://api.github.com/users/not-napoleon","html_url":"https://github.com/not-napoleon","followers_url":"https://api.github.com/users/not-napoleon/followers","following_url":"https://api.github.com/users/not-napoleon/following{/other_user}","gists_url":"https://api.github.com/users/not-napoleon/gists{/gist_id}","starred_url":"https://api.github.com/users/not-napoleon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-napoleon/subscriptions","organizations_url":"https://api.github.com/users/not-napoleon/orgs","repos_url":"https://api.github.com/users/not-napoleon/repos","events_url":"https://api.github.com/users/not-napoleon/events{/privacy}","received_events_url":"https://api.github.com/users/not-napoleon/received_events","type":"User","site_admin":false},"performed_via_github_app":null}