{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9386","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9386/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9386/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9386/events","html_url":"https://github.com/elastic/elasticsearch/issues/9386","id":55183133,"node_id":"MDU6SXNzdWU1NTE4MzEzMw==","number":9386,"title":"Percolator is ignoring position_offset_gap","user":{"login":"prog8","id":6692291,"node_id":"MDQ6VXNlcjY2OTIyOTE=","avatar_url":"https://avatars0.githubusercontent.com/u/6692291?v=4","gravatar_id":"","url":"https://api.github.com/users/prog8","html_url":"https://github.com/prog8","followers_url":"https://api.github.com/users/prog8/followers","following_url":"https://api.github.com/users/prog8/following{/other_user}","gists_url":"https://api.github.com/users/prog8/gists{/gist_id}","starred_url":"https://api.github.com/users/prog8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/prog8/subscriptions","organizations_url":"https://api.github.com/users/prog8/orgs","repos_url":"https://api.github.com/users/prog8/repos","events_url":"https://api.github.com/users/prog8/events{/privacy}","received_events_url":"https://api.github.com/users/prog8/received_events","type":"User","site_admin":false},"labels":[{"id":156502592,"node_id":"MDU6TGFiZWwxNTY1MDI1OTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Percolator","name":":Search/Percolator","color":"0e8a16","default":false,"description":"Reverse search: find queries that match a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-01-22T17:29:03Z","updated_at":"2016-04-12T08:51:15Z","closed_at":"2016-04-12T08:51:15Z","author_association":"NONE","active_lock_reason":null,"body":"I'm testing span queries on percolator and encountered a problem. It seems that percolator is ignoring position_offset_gap. Below there is an example.\n\n```\n$ curl \"localhost:9200/test1/_mapping/type?pretty\" -XPUT -d '{\"type\" : {\"properties\" : {\"field1\" : {\"type\" : \"string\", \"position_offset_gap\" : 100}}}}'\n$ curl \"localhost:9200/test1/.percolator\" -d '{\"type\" : \"type\", \"query\" : {\"span_near\" : {\"slop\" : 90, \"clauses\" : [{\"span_term\" : {\"field1\" : \"foo\"}}, {\"span_term\" : {\"field1\":\"bar\"}}]}}}'\n{\"_index\":\"test1\",\"_type\":\".percolator\",\"_id\":\"sK3bC-XYQ9SQ4qC3SpyXfg\",\"_version\":1,\"created\":true}\n$ curl \"localhost:9200/test1/type/_percolate?pretty\" -XGET -d '{\"doc\" : {\"field1\" : [\"foo\", \"bar\"]}}'{\n  \"took\" : 3,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"total\" : 1,\n  \"matches\" : [ {\n    \"_index\" : \"test1\",\n    \"_id\" : \"sK3bC-XYQ9SQ4qC3SpyXfg\"\n  } ]\n}\n```\n\nTo verify the mapping I also run queries on ES index\n\n```\n$ curl \"localhost:9200/test1/type\" -d '{\"field1\" : [\"foo\", \"bar\"]}'\n{\"_index\":\"test1\",\"_type\":\"type\",\"_id\":\"HPMTUjVtS0utxr2USt6UGA\",\"_version\":1,\"created\":true}\n$     curl \"localhost:9200/test1/type/_search?pretty\" -d '{\"query\" : {\"span_near\" : {\"slop\" : 90, \"clauses\" : [{\"span_term\" : {\"field1\" : \"foo\"}}, {\"span_term\" : {\"field1\":\"bar\"}}]}}}'\n{\n  \"took\" : 6,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 0,\n    \"max_score\" : null,\n    \"hits\" : [ ]\n  }\n}\n```\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}