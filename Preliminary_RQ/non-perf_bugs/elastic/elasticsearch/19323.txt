{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19323","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19323/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19323/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19323/events","html_url":"https://github.com/elastic/elasticsearch/issues/19323","id":164453247,"node_id":"MDU6SXNzdWUxNjQ0NTMyNDc=","number":19323,"title":"unassigned shards with cluster in docker","user":{"login":"nathan-zhu","id":1650457,"node_id":"MDQ6VXNlcjE2NTA0NTc=","avatar_url":"https://avatars3.githubusercontent.com/u/1650457?v=4","gravatar_id":"","url":"https://api.github.com/users/nathan-zhu","html_url":"https://github.com/nathan-zhu","followers_url":"https://api.github.com/users/nathan-zhu/followers","following_url":"https://api.github.com/users/nathan-zhu/following{/other_user}","gists_url":"https://api.github.com/users/nathan-zhu/gists{/gist_id}","starred_url":"https://api.github.com/users/nathan-zhu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nathan-zhu/subscriptions","organizations_url":"https://api.github.com/users/nathan-zhu/orgs","repos_url":"https://api.github.com/users/nathan-zhu/repos","events_url":"https://api.github.com/users/nathan-zhu/events{/privacy}","received_events_url":"https://api.github.com/users/nathan-zhu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-07-08T03:37:19Z","updated_at":"2016-07-08T07:13:37Z","closed_at":"2016-07-08T06:43:45Z","author_association":"NONE","active_lock_reason":null,"body":"here is my compose file,escp is my docker images files\n\n```\nelasticsearch_master:\n    #image: elasticsearch:latest\n    image: escp\n    command: \"elasticsearch \\\n      -Des.cluster.name=dcluster \\\n      -Des.node.name=esmaster \\\n      -Des.node.master=true \\\n      -Des.node.data=true \\    \n      -Des.node.client=false \\\n      -Des.discovery.zen.minimum_master_nodes=1\"\n\n    volumes:\n      - \"${PWD}/es/config:/usr/share/elasticsearch/config\"\n      - \"${PWD}/esdata/node:/usr/share/elasticsearch/data\"\n      - \"${PWD}/es/plugins:/usr/share/elasticsearch/plugins\"      \n    environment:\n       - ES_HEAP_SIZE=512m\n    ports:\n      - \"9200:9200\"\n      - \"9300:9300\"\n\nelasticsearch1:\n    #image: elasticsearch:latest\n    image: escp\n    command: \"elasticsearch \\ \n      -Des.cluster.name=dcluster \\\n      -Des.node.name=esnode1 \\\n      -Des.node.data=true \\\n      -Des.node.client=false \\\n      -Des.node.master=false \\\n      -Des.discovery.zen.minimum_master_nodes=1 \\\n      -Des.discovery.zen.ping.unicast.hosts=elasticsearch_master\"\n    links:\n      - elasticsearch_master\n    volumes:\n      - \"${PWD}/es/config:/usr/share/elasticsearch/config\"\n      - \"${PWD}/esdata/node1:/usr/share/elasticsearch/data\"\n      - \"${PWD}/es/plugins:/usr/share/elasticsearch/plugins\"\n    environment:\n       - ES_HEAP_SIZE=512m\n\nelasticsearch2:\n    #image: elasticsearch:latest\n    image: escp\n    command: \"elasticsearch \\\n      -Des.cluster.name=dcluster \\\n      -Des.node.name=esnode2 \\\n      -Des.node.data=true \\\n      -Des.node.client=false \\\n      -Des.node.master=false \\\n      -Des.discovery.zen.minimum_master_nodes=1 \\\n      -Des.discovery.zen.ping.unicast.hosts=elasticsearch_master\"\n    links:\n      - elasticsearch_master\n    volumes:\n      - \"${PWD}/es/config:/usr/share/elasticsearch/config\"\n      - \"${PWD}/esdata/node2:/usr/share/elasticsearch/data\"\n      - \"${PWD}/es/plugins:/usr/share/elasticsearch/plugins\"\n    environment:\n       - ES_HEAP_SIZE=512m\n```\n\nthis is config file\n\n```\n\nindex.number_of_shards: 1\nindex.number_of_replicas: 0\nnetwork.host: 0.0.0.0\n```\n\nafter running\n\n```\n\n           Name                         Command               State                       Ports\n--------------------------------------------------------------------------------------------------------------------\nest_elasticsearch1_1         /docker-entrypoint.sh elas ...   Up      9200/tcp, 9300/tcp\nest_elasticsearch2_1         /docker-entrypoint.sh elas ...   Up      9200/tcp, 9300/tcp\nest_elasticsearch_master_1   /docker-entrypoint.sh elas ...   Up      0.0.0.0:9200->9200/tcp, 0.0.0.0:9300->9300/tcp\n```\n\nbut when i create new index there will show UNASSIGNED...\n\n```\n\ncurl -s '192.168.99.100:9200/_cluster/health?pretty'\n{\n  \"cluster_name\" : \"dcluster\",\n  \"status\" : \"red\",\n  \"timed_out\" : false,\n  \"number_of_nodes\" : 3,\n  \"number_of_data_nodes\" : 3,\n  \"active_primary_shards\" : 0,\n  \"active_shards\" : 0,\n  \"relocating_shards\" : 0,\n  \"initializing_shards\" : 0,\n  \"unassigned_shards\" : 1,\n  \"delayed_unassigned_shards\" : 0,\n  \"number_of_pending_tasks\" : 0,\n  \"number_of_in_flight_fetch\" : 0,\n  \"task_max_waiting_in_queue_millis\" : 0,\n  \"active_shards_percent_as_number\" : 0.0\n}\n```\n\ncheck nodes\n\n```\n\ncurl -s '192.168.99.100:9200/_cat/nodes?v'\nhost       ip         heap.percent ram.percent load node.role master name\n172.17.0.2 172.17.0.2           13          33 0.00 d         *      esmaster\n172.17.0.3 172.17.0.3           16          33 0.00 d         -      esnode1\n172.17.0.4 172.17.0.4           13          33 0.00 d         -      esnode2\n```\n\ncheck shards\n\n```\n\ncurl -s '192.168.99.100:9200/_cat/shards'\nabcq 0 p UNASSIGNED\n```\n\ncheck allocation\n\n```\n\ncurl -s '192.168.99.100:9200/_cat/allocation?v'\nshards disk.indices disk.used disk.avail disk.total disk.percent host       ip         node\n     0           0b   223.4gb      9.5gb    232.9gb           95 172.17.0.4 172.17.0.4 esnode2\n     0           0b   223.4gb      9.5gb    232.9gb           95 172.17.0.2 172.17.0.2 esmaster\n     0           0b   223.4gb      9.5gb    232.9gb           95 172.17.0.3 172.17.0.3 esnode1\n     1                                                                                 UNASSIGNED\n```\n\ncheck setting\n\n```\n\ncurl 'http://192.168.99.100:9200/_cluster/settings?pretty'\n{\n  \"persistent\" : { },\n  \"transient\" : { }\n}\n```\n\nenabled reroute\n\n```\n\ncurl 'http://192.168.99.100:9200/_cluster/settings?pretty'\n{\n  \"persistent\" : { },\n  \"transient\" : {\n    \"cluster\" : {\n      \"routing\" : {\n        \"allocation\" : {\n          \"enable\" : \"true\"\n        }\n      }\n    }\n  }\n}\n```\n\nreroute index abcq\n\n```\n\n    curl -XPOST http://192.168.99.100:9200/_cluster/reroute?pretty -d '{ \n    \"commands\" : [ \n        { \n            \"allocate\" : {\n                \"index\" : \"abcq\",\n                \"shard\" : 0, \n                \"node\" : \"esnode2\", \n                \"allow_primary\" : true \n            } \n        } \n    ] \n}'\n```\n\nget error bellow\n\n```\n\n{\n  \"error\" : {\n    \"root_cause\" : [ {\n      \"type\" : \"illegal_argument_exception\",\n      \"reason\" : \"[allocate] allocation of [abcq][0] on node {esnode2}{Pisl95VUSPmZa3Ga_e3sDA}{172.17.0.4}{172.17.0.4:9300}{master=false} is not allowed, reason: [YES(shard is primary)][YES(no allocation awareness enabled)][NO(more than allowed [90.0%] used disk on node, free: [4.078553722498398%])][YES(allocation disabling is ignored)][YES(primary shard can be allocated anywhere)][YES(node passes include/exclude/require filters)][YES(shard is not allocated to same node or host)][YES(total shard limit disabled: [index: -1, cluster: -1] <= 0)][YES(allocation disabling is ignored)][YES(no snapshots are currently running)][YES(below primary recovery limit of [4])]\"\n    } ],\n    \"type\" : \"illegal_argument_exception\",\n    \"reason\" : \"[allocate] allocation of [abcq][0] on node {esnode2}{Pisl95VUSPmZa3Ga_e3sDA}{172.17.0.4}{172.17.0.4:9300}{master=false} is not allowed, reason: [YES(shard is primary)][YES(no allocation awareness enabled)][NO(more than allowed [90.0%] used disk on node, free: [4.078553722498398%])][YES(allocation disabling is ignored)][YES(primary shard can be allocated anywhere)][YES(node passes include/exclude/require filters)][YES(shard is not allocated to same node or host)][YES(total shard limit disabled: [index: -1, cluster: -1] <= 0)][YES(allocation disabling is ignored)][YES(no snapshots are currently running)][YES(below primary recovery limit of [4])]\"\n  },\n  \"status\" : 400\n}\n```\n\nwhy i create new index get unassigned, can any one help? thanks.\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}