{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13214","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13214/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13214/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13214/events","html_url":"https://github.com/elastic/elasticsearch/issues/13214","id":104047171,"node_id":"MDU6SXNzdWUxMDQwNDcxNzE=","number":13214,"title":"Behaviour different with custom _all","user":{"login":"jimmyjones2","id":2991805,"node_id":"MDQ6VXNlcjI5OTE4MDU=","avatar_url":"https://avatars2.githubusercontent.com/u/2991805?v=4","gravatar_id":"","url":"https://api.github.com/users/jimmyjones2","html_url":"https://github.com/jimmyjones2","followers_url":"https://api.github.com/users/jimmyjones2/followers","following_url":"https://api.github.com/users/jimmyjones2/following{/other_user}","gists_url":"https://api.github.com/users/jimmyjones2/gists{/gist_id}","starred_url":"https://api.github.com/users/jimmyjones2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimmyjones2/subscriptions","organizations_url":"https://api.github.com/users/jimmyjones2/orgs","repos_url":"https://api.github.com/users/jimmyjones2/repos","events_url":"https://api.github.com/users/jimmyjones2/events{/privacy}","received_events_url":"https://api.github.com/users/jimmyjones2/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-08-31T12:46:44Z","updated_at":"2018-02-14T13:30:59Z","closed_at":"2017-09-11T22:31:31Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"With the following simple query, I get different results with a custom_all to the other cases:\n\n``` json\nGET /test*/_search\n{\n  \"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"query_string\": {\n          \"query\": \"*\"\n        }\n      }\n    }\n  }\n}\n```\n\n| test | description | result count |\n| --- | --- | --- |\n| test1 | custom _all | 1 |\n| test2 | disabled_all | 2 |\n| test3 | include_in_all | 2 |\n| test4 | normal | 2 |\n\nI thought this might be because one of the documents doesn't add anything to the custom _all field, but neither does one of the documents in the include_in_all example, yet that still returns both documents. I assume when _all is disabled the query is effectively converted to match_all. \n## test1: custom _all\n\n``` bash\ncurl -XDELETE localhost:9200/test1\ncurl -XPUT localhost:9200/test1/ -d '\n{\n  \"settings\" : {\n    \"index\" : {\n      \"query.default_field\" : \"_myall\"\n    }\n  },\n  \"mappings\" : {\n    \"test\" : {\n      \"_all\" : {\n        \"enabled\" : false\n      },\n      \"properties\" : {\n        \"_myall\" : {\n          \"type\" : \"string\",\n          \"index\" : \"not_analyzed\"\n        },\n        \"test\" : {\n          \"type\" : \"long\",\n          \"copy_to\" : \"_myall\"\n        }\n      }\n    }\n  }\n}'\ncurl -XPOST localhost:9200/test1/test -d '{ \"myid\" : 4 }'\ncurl -XPOST localhost:9200/test1/test -d '{ \"test\" : 4 }'\n```\n## test2: disabled _all\n\n``` bash\ncurl -XDELETE localhost:9200/test2\ncurl -XPUT localhost:9200/test2/ -d '\n{\n  \"mappings\" : {\n    \"test\" : {\n      \"_all\" : {\n        \"enabled\" : false\n      }\n    }\n  }\n}'\ncurl -XPOST localhost:9200/test2/test -d '{ \"myid\" : 4 }'\ncurl -XPOST localhost:9200/test2/test -d '{ \"test\" : 4 }'\n```\n## test3: include_in_all\n\n``` bash\ncurl -XDELETE localhost:9200/test3\ncurl -XPUT localhost:9200/test3/ -d '\n{\n  \"mappings\" : {\n    \"test\" : {\n      \"properties\" : {\n        \"myid\" : {\n          \"type\" : \"long\",\n          \"include_in_all\" : true\n        },\n        \"test\" : {\n          \"type\" : \"long\",\n          \"include_in_all\" : false\n        }\n      }\n    }\n  }\n}'\ncurl -XPOST localhost:9200/test3/test -d '{ \"myid\" : 4 }'\ncurl -XPOST localhost:9200/test3/test -d '{ \"test\" : 4 }'\n```\n## test4: default\n\n``` bash\ncurl -XDELETE localhost:9200/test4\ncurl -XPUT localhost:9200/test4/ -d '\n{\n  \"mappings\" : {\n    \"test\" : {\n      \"properties\" : {\n        \"myid\" : {\n          \"type\" : \"long\"\n        },\n        \"test\" : {\n          \"type\" : \"long\"\n        }\n      }\n    }\n  }\n}'\ncurl -XPOST localhost:9200/test4/test -d '{ \"myid\" : 4 }'\ncurl -XPOST localhost:9200/test4/test -d '{ \"test\" : 4 }'\n```\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}