[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313063347","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313063347","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313063347,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzA2MzM0Nw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-05T10:19:50Z","updated_at":"2017-07-05T10:20:22Z","author_association":"MEMBER","body":"We discussed this some time ago in #13928 and we went for making `_count` a shortcut to `_search`, but we removed the api from the transport client and all of its code that made it a different API compared to search. It was proposed to remove the `_count` endpoint too, but an objection we got was that removing `_count` from the REST layer wouldn't buy us much, while users tend to like and use such endpoint.\r\n\r\nSee also #11198, #14166 and #14165 for the changes made.\r\n\r\nThe only difference I see between `_count` and `_search` is that the former parses only the `query` part of the request body, which seems to make sense as all the other sections would require executing the search api rather than the count api.\r\n\r\nRegarding post_filter, I do not understand why it would be useful with the `_count` api: doesn't it concern aggregations which are not part of the `_count` api either?\r\n\r\nIn conclusion: I am not against removing `_count`, but I don't think it's a big burden to maintain its REST endpoint if users find it useful. I think it does the right thing today compared to what it used to do a long time ago when it was a separate API.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313095575","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313095575","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313095575,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzA5NTU3NQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-07-05T12:59:16Z","updated_at":"2017-07-05T12:59:16Z","author_association":"CONTRIBUTOR","body":"One thing that makes me lean towards removing it is that when there are two ways to do the same thing, users tend to wonder which one is better. So it makes the API a bit confusing. By being a bit leaner, `_count` might actually look like it is more efficient than a `_search` with size `0`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313647962","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313647962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313647962,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY0Nzk2Mg==","user":{"login":"talabu","id":5627665,"node_id":"MDQ6VXNlcjU2Mjc2NjU=","avatar_url":"https://avatars2.githubusercontent.com/u/5627665?v=4","gravatar_id":"","url":"https://api.github.com/users/talabu","html_url":"https://github.com/talabu","followers_url":"https://api.github.com/users/talabu/followers","following_url":"https://api.github.com/users/talabu/following{/other_user}","gists_url":"https://api.github.com/users/talabu/gists{/gist_id}","starred_url":"https://api.github.com/users/talabu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talabu/subscriptions","organizations_url":"https://api.github.com/users/talabu/orgs","repos_url":"https://api.github.com/users/talabu/repos","events_url":"https://api.github.com/users/talabu/events{/privacy}","received_events_url":"https://api.github.com/users/talabu/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T10:37:27Z","updated_at":"2017-07-07T10:37:27Z","author_association":"NONE","body":"Having both api that tend to do same thing and sometimes return different result could be confusing. \r\nI used the _count api as part of my deployment workflow and was getting disparate result compared with _search api. Later realized it was due to attachment types defined in the mapping. \r\nI never saw that in the documentation.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313653762","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313653762","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313653762,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY1Mzc2Mg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T11:10:54Z","updated_at":"2017-07-07T11:10:54Z","author_association":"MEMBER","body":"hi @talabu they may have returned different results in the past but they should not since 2.0 as they are effectively the same code. Do you have an example of different results from 2.0 on?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313676969","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313676969","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313676969,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY3Njk2OQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T13:12:49Z","updated_at":"2017-07-07T13:12:49Z","author_association":"CONTRIBUTOR","body":"we discussed this in fixit-friday and we concluded that we are in general should try to reduce the number of APIs we have. Also there should be only one way to do things but for the `_count` endpoint we think we should keep it since it's such a basic API that a significant amount of people would search for _count_ functionality that it's a low overhead to keep this syntactic sugar.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313678669","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313678669","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313678669,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY3ODY2OQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T13:20:07Z","updated_at":"2017-07-07T13:20:07Z","author_association":"MEMBER","body":"Fair enough. Should we add support for `post_filter` then? As it creates confusion.\r\n\r\nWhen someone uses `post_filter` with `_search` endpoint, he can get X results but the exact same body with `_count` might give more hits.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313680623","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313680623","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313680623,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY4MDYyMw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T13:28:24Z","updated_at":"2017-07-07T13:28:24Z","author_association":"MEMBER","body":"I don't get why one would use post_filter with the `_count` api. I think we are good as long as `_count` throws error whenever `post_filter` is specified. The count endpoint only supports the query section of search request body, nothing else.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313684871","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313684871","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313684871,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY4NDg3MQ==","user":{"login":"talabu","id":5627665,"node_id":"MDQ6VXNlcjU2Mjc2NjU=","avatar_url":"https://avatars2.githubusercontent.com/u/5627665?v=4","gravatar_id":"","url":"https://api.github.com/users/talabu","html_url":"https://github.com/talabu","followers_url":"https://api.github.com/users/talabu/followers","following_url":"https://api.github.com/users/talabu/following{/other_user}","gists_url":"https://api.github.com/users/talabu/gists{/gist_id}","starred_url":"https://api.github.com/users/talabu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talabu/subscriptions","organizations_url":"https://api.github.com/users/talabu/orgs","repos_url":"https://api.github.com/users/talabu/repos","events_url":"https://api.github.com/users/talabu/events{/privacy}","received_events_url":"https://api.github.com/users/talabu/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T13:45:55Z","updated_at":"2017-07-07T13:45:55Z","author_association":"NONE","body":"Hi @javanna. I am on version 2.3.1. _search returns the correct count. We still see much higher values returned for doc.count in _cat/indices and _stats endpoints.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313686878","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313686878","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313686878,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY4Njg3OA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T13:54:08Z","updated_at":"2017-07-07T13:54:08Z","author_association":"CONTRIBUTOR","body":"> We still see much higher values returned for doc.count in _cat/indices and _stats endpoints.\r\n\r\nthese APIs take deleted documents into account.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313694761","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313694761","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313694761,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY5NDc2MQ==","user":{"login":"talabu","id":5627665,"node_id":"MDQ6VXNlcjU2Mjc2NjU=","avatar_url":"https://avatars2.githubusercontent.com/u/5627665?v=4","gravatar_id":"","url":"https://api.github.com/users/talabu","html_url":"https://github.com/talabu","followers_url":"https://api.github.com/users/talabu/followers","following_url":"https://api.github.com/users/talabu/following{/other_user}","gists_url":"https://api.github.com/users/talabu/gists{/gist_id}","starred_url":"https://api.github.com/users/talabu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talabu/subscriptions","organizations_url":"https://api.github.com/users/talabu/orgs","repos_url":"https://api.github.com/users/talabu/repos","events_url":"https://api.github.com/users/talabu/events{/privacy}","received_events_url":"https://api.github.com/users/talabu/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T14:16:47Z","updated_at":"2017-07-07T14:16:47Z","author_association":"NONE","body":"I have a number of **nested** field type defined in the mapping. I guess this is affecting the doc.count value returned.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313702707","html_url":"https://github.com/elastic/elasticsearch/issues/25548#issuecomment-313702707","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25548","id":313702707,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzcwMjcwNw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-07T14:46:10Z","updated_at":"2017-07-07T14:46:10Z","author_association":"MEMBER","body":"yes @talabu if you use nested, every nested document is a separate lucene document, so lucene counts them in its stats, but the Elasticsearch APIs filter them e.g. search, count.","performed_via_github_app":null}]