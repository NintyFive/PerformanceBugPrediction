{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33074","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33074/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33074/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33074/events","html_url":"https://github.com/elastic/elasticsearch/issues/33074","id":353179635,"node_id":"MDU6SXNzdWUzNTMxNzk2MzU=","number":33074,"title":"ILM: IndexLifecycleRunner should not spam logs with warnings when policy is misconfigured","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"labels":[{"id":912828538,"node_id":"MDU6TGFiZWw5MTI4Mjg1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/ILM+SLM","name":":Core/Features/ILM+SLM","color":"0e8a16","default":false,"description":"Index and Snapshot lifecycle management"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"assignees":[{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2018-08-23T01:04:08Z","updated_at":"2018-10-04T14:40:28Z","closed_at":"2018-10-04T14:40:28Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When an index sets its `index.lifecycle.name` to an invalid one\r\n\r\n* The system will make it look like things are being managed correctly... when really there is no real policy of that name\r\n* the IndexLifecycleRunner will spam the logs looking for the first step with messages of this nature:\r\n\r\n```\r\n[WARN ][o.e.x.i.IndexLifecycleRunner] [node-0] current step [null] for index [thingy-000002] with policy [thingy] is not recognized\r\n```\r\n\r\n**reproduce with**\r\n\r\n```\r\nPUT _template/thingy\r\n{\r\n   \"index_patterns\": [\"thingy*\"],\r\n   \"settings\": {\r\n     \"index\": {\r\n       \"lifecycle\": {\r\n         \"name\": \"thingy\",\r\n         \"rollover_alias\": \"thingy-alias\"\r\n       },\r\n       \"number_of_shards\": \"1\",\r\n       \"number_of_replicas\": \"1\"\r\n     }\r\n   }\r\n}\r\n\r\nPUT /_ilm/policy1\r\n{\r\n  \"policy\": {\r\n    \"phases\": {\r\n      \"hot\": {\r\n        \"after\": \"0s\",\r\n        \"actions\": {\r\n          \"rollover\": {\r\n            \"max_docs\": 1\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPUT /thingy-000001\r\n{\r\n  \"aliases\": {\r\n    \"thingy-alias\": {\r\n      \"is_write_index\": true\r\n    }\r\n  }\r\n}\r\n\r\nPOST thingy-000001/_doc\r\n{\r\n  \"foo\": \"bar\"\r\n}\r\n\r\nGET thingy*\r\n```\r\n\r\nIt is a very simple thing to happen, and the logs are not useful in helping figure out what is going on\r\n\r\nTo add to the confusion, here is the output of some APIs we have to help explain what is happening to users when things aren't working properly\r\n\r\n```\r\nGET thingy-000002/_ilm/explain\r\n\r\n{\r\n  \"indices\": {\r\n    \"thingy-000002\": {\r\n      \"index\": \"thingy-000002\",\r\n      \"managed\": true,\r\n      \"policy\": \"thingy\",\r\n      \"skip\": false,\r\n      \"lifecycle_date\": -1,\r\n      \"phase\": \"\",\r\n      \"phase_time\": -1,\r\n      \"action\": \"\",\r\n      \"action_time\": -1,\r\n      \"step\": \"\",\r\n      \"step_time\": -1\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nWe should provide better feedback when invalid policies are set on indices.","closed_by":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"performed_via_github_app":null}