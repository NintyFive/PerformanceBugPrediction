{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9644","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9644/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9644/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9644/events","html_url":"https://github.com/elastic/elasticsearch/issues/9644","id":57275125,"node_id":"MDU6SXNzdWU1NzI3NTEyNQ==","number":9644,"title":"Elasticsearch search result problem","user":{"login":"tefon","id":10952674,"node_id":"MDQ6VXNlcjEwOTUyNjc0","avatar_url":"https://avatars1.githubusercontent.com/u/10952674?v=4","gravatar_id":"","url":"https://api.github.com/users/tefon","html_url":"https://github.com/tefon","followers_url":"https://api.github.com/users/tefon/followers","following_url":"https://api.github.com/users/tefon/following{/other_user}","gists_url":"https://api.github.com/users/tefon/gists{/gist_id}","starred_url":"https://api.github.com/users/tefon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tefon/subscriptions","organizations_url":"https://api.github.com/users/tefon/orgs","repos_url":"https://api.github.com/users/tefon/repos","events_url":"https://api.github.com/users/tefon/events{/privacy}","received_events_url":"https://api.github.com/users/tefon/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-02-11T04:21:13Z","updated_at":"2015-02-12T11:19:19Z","closed_at":"2015-02-12T11:19:19Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\n\nI add data add Elasticsearch this code :\n\n```\n$data = array(\"name\"=>HelperMC::strToUtf8(trim($name)),\n        \"urlname\"=>HelperURL::strToURL(trim($name)),\n        \"price\"=>number_format(HelperParser::clearTextFromPrice($price), 2, ',', '.'),\n        \"price_for_filter\"=>HelperParser::clearTextFromPrice($price),\n        \"image\"=>$imgname,\n        \"description\"=>HelperMC::strToUtf8($description),\n        \"keywords\"=>HelperMC::strToUtf8($keywords),\n        \"url\"=>$k['url'],\n        \"sitemap_id\"=>intval($sitemapId),\n        \"shop_id\"=>$shop['shop_id'],\n        \"logo\"=>$shop['logo'],\n        \"key\"=>$hashKey,\n        \"type\"=>intval(1),\n        \"shop_rating_count\"=>intval($shop['rating_count']),\n        \"shop_rating_point\"=>intval($shop['rating_point']),\n        \"created_at\"=>date(\"Y-m-d H:i:s\"),\n        \"updated_at\"=>date(\"Y-m-d H:i:s\"));\n\n//create elasticsearch index\nHelperES::insertEntry(json_encode($data),$hashKey);    \n```\n\nMy insertEntry Function:\n\n```\nprivate static $elasticBase = \"http://localhost:9200/shopping/items\";\n\npublic static function insertEntry($data_string,$id = false){\n    if($id)\n        $url = self::$elasticBase.\"/\".$id;\n    else\n        $url = self::$elasticBase;\n\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL , $url);\n    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, \"POST\");  \n    curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string); \n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);\n    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);\n    @$result = curl_exec($ch);\n    curl_close($ch);\n\n    return $result;\n}\n```\n\nand my search Function :\n\n```\npublic static function search($keyword, $defaultOperator = \"OR\" ,$start = 0, $size = 25, $from = 0, $to = 10000, $shopsArr = array(),$orderBy = \"price\", $order = \"asc\"){\n    $searchUrl = self::$elasticBase.\"/_search\";\n\n    if(count($shopsArr) > 0){\n        $query = '{\n                        \"from\" : '.$start.', \"size\" : '.$size.',\n                        \"query\" : {\n                            \"filtered\" : {\n                             \"query\": {\n                                \"query_string\": { \"query\": \"'.$keyword.'\",\n                                \"fields\": [\"name\",\"urlname\"],\n                                \"default_operator\": \"'.$defaultOperator.'\"\n                                }\n                              },\n                                \"filter\" : {\n                                     \"bool\" : {\n                                        \"must\" : {\n                                            \"terms\" : { \"sitemap_id\" : '.json_encode($shopsArr).' }\n                                        },\n                                        \"must\" : {\n                                            \"range\" : {\n                                                        \"price_for_filter\" : {\n                                                            \"from\" : \"'.$from.'\",\n                                                            \"to\"  : \"'.$to.'\"\n                                                        }\n                                                      }\n                                        }\n                                }\n                            }\n                        }\n                    },\n                    \"sort\" : [\n                                 {\"'.$orderBy.'\" : {\"order\" : \"'.$order.'\", \"mode\" : \"avg\"}}\n                             ]\n                }';\n    }else{\n        $query = '{\n                \"from\" : '.$start.', \"size\" : '.$size.',\n                \"query\" : {\n                    \"filtered\" : {\n                     \"query\": {\n                            \"query_string\": { \n                                \"query\": \"'.$keyword.'\",\n                                \"fields\": [\"name\",\"urlname\"],\n                                \"default_operator\": \"'.$defaultOperator.'\"\n                            }\n                          },\n                        \"filter\" : {\n                            \"range\" : {\n                                \"price_for_filter\" : {\n                                    \"from\" : \"'.$from.'\",\n                                    \"to\"  : \"'.$to.'\"\n                                }\n                            }\n                        }\n                    }\n                },\n                \"sort\" : [\n                             {\"'.$orderBy.'\" : {\"order\" : \"'.$order.'\", \"mode\" : \"avg\"}}\n                         ]\n            }';\n    }\n\n\n    echo $query;    \n\n\n    $ch = curl_init();\n    curl_setopt($ch, CURLOPT_URL , $searchUrl);\n    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, \"POST\");  \n    curl_setopt($ch, CURLOPT_POSTFIELDS, $query); \n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);\n    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);\n    @$result = curl_exec($ch);\n    curl_close($ch);\n    return $result;\n}\n```\n\nBut my search results not working.\n\nExample : http://goo.gl/KHO1Ia\n\nworking but, \n\nhttp://goo.gl/GB8uUV\n\nnot working.\n\nPls help me? Thank you\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}