{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32303","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32303/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32303/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32303/events","html_url":"https://github.com/elastic/elasticsearch/issues/32303","id":343820458,"node_id":"MDU6SXNzdWUzNDM4MjA0NTg=","number":32303,"title":"[ci] UpgradeClusterClientYamlTestSuiteIT - master fails when writing DocStats","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-07-23T22:36:52Z","updated_at":"2018-07-24T16:13:55Z","closed_at":"2018-07-24T16:13:55Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Doesn't reproduce locally\r\n\r\nFailing tests are\r\n\r\n```\r\nold_cluster/40_ml_datafeed_crud/Put job and datafeed in old cluster\r\nold_cluster/50_ml_jobs_crud/Put job with empty strings in the configuration\r\n```\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack-elasticsearch:qa:rolling-upgrade:without-ssl-with-system-key:v5.0.2#oldClusterTestRunner \\\r\n  -Dtests.seed=90BB3616D77785F0 \\\r\n  -Dtests.class=org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {p0=old_cluster/40_ml_datafeed_crud/Put job and datafeed in old cluster}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=hr \\\r\n  -Dtests.timezone=EST5EDT \\\r\n  -Dtests.rest.suite=old_cluster \\\r\n  -Dtests.rest.blacklist=old_cluster/40_ml_datafeed_crud/*,old_cluster/50_ml_jobs_crud/*\r\n```\r\n\r\nhttps://internal-ci.elastic.co/job/elastic+x-pack-elasticsearch+5.6+bwc-tests/911/console\r\n\r\nci logs\r\n[build-911.txt](https://github.com/elastic/elasticsearch/files/2221314/build-911.txt)\r\n\r\ninteg test cluster node 0 log\r\n[run.log](https://github.com/elastic/elasticsearch/files/2221316/run.log)\r\n\r\ninteg test cluster node 1 log\r\n[run.log](https://github.com/elastic/elasticsearch/files/2221317/run.log)\r\n\r\nFrom the cluster logs for node0\r\n\r\n```\r\n[2018-07-23T03:55:15,185][INFO ][o.e.x.m.e.Exporters      ] [j7cI6y5] skipping exporter [default_local] as it isn't ready yet\r\n[2018-07-23T03:55:15,186][ERROR][o.e.x.m.AgentService     ] [j7cI6y5] exception when exporting documents\r\norg.elasticsearch.xpack.monitoring.exporter.ExportException: exporters are either not ready or faulty\r\n        at org.elasticsearch.xpack.monitoring.exporter.Exporters.export(Exporters.java:188) ~[x-pack-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.xpack.monitoring.AgentService$ExportingWorker.run(AgentService.java:208) [x-pack-5.0.2.jar:5.0.2]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n[2018-07-23T03:55:17,901][INFO ][o.e.c.s.ClusterService   ] [j7cI6y5] detected_master {Ko7SxWG}{Ko7SxWGzRbqJYL-GcmG_8A}{lEEDF8DcT_eFtVh3m0Z72w}{127.0.0.1}{127.0.0.1:46645}{testattr=test}, added {{Ko7SxWG}{Ko7SxWGzRbqJYL-GcmG_8A}{lEEDF8DcT_eFtVh3m0Z72w}{127.0.0.1}{127.0.0.1:46645}{testattr=test},}, reason: zen-disco-receive(from master [master {Ko7SxWG}{Ko7SxWGzRbqJYL-GcmG_8A}{lEEDF8DcT_eFtVh3m0Z72w}{127.0.0.1}{127.0.0.1:46645}{testattr=test} committed version [1]])\r\n[2018-07-23T03:55:26,727][ERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [] fatal error in thread [elasticsearch[j7cI6y5][management][T#1]], exiting\r\njava.lang.AssertionError\r\n        at org.elasticsearch.common.io.stream.StreamOutput.writeVLong(StreamOutput.java:218) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.index.shard.DocsStats.writeTo(DocsStats.java:77) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.action.admin.indices.stats.CommonStats.writeTo(CommonStats.java:278) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.indices.NodeIndicesStats.writeTo(NodeIndicesStats.java:175) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.action.admin.cluster.node.stats.NodeStats.writeTo(NodeStats.java:235) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.transport.TcpTransport.buildMessage(TcpTransport.java:1056) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.transport.TcpTransport.sendResponse(TcpTransport.java:1005) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.transport.TcpTransportChannel.sendResponse(TcpTransportChannel.java:67) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.transport.TcpTransportChannel.sendResponse(TcpTransportChannel.java:61) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.transport.DelegatingTransportChannel.sendResponse(DelegatingTransportChannel.java:58) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry$TransportChannelWrapper.sendResponse(RequestHandlerRegistry.java:111) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:270) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.action.support.nodes.TransportNodesAction$NodeTransportHandler.messageReceived(TransportNodesAction.java:266) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:206) ~[?:?]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1348) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:527) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-5.0.2.jar:5.0.2]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_181]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_181]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}