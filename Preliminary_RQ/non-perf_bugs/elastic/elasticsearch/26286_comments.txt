[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323664046","html_url":"https://github.com/elastic/elasticsearch/issues/26286#issuecomment-323664046","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26286","id":323664046,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzY2NDA0Ng==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-08-21T07:09:51Z","updated_at":"2017-08-21T07:09:51Z","author_association":"MEMBER","body":"@nknize can you take a look ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446612790","html_url":"https://github.com/elastic/elasticsearch/issues/26286#issuecomment-446612790","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26286","id":446612790,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjYxMjc5MA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-12-12T14:47:15Z","updated_at":"2018-12-12T14:47:15Z","author_association":"MEMBER","body":"The error message is generated inside JTS validation that fails on `LINEARRING (-179.92242898523259 -72.61473946396302, -179.70509673080812 -72.48077664056396, -179.49092755066465 -72.34661931944633, -179.27982991402556 -72.21221766344048, -179.0801618967584 -72.08294232094963, -179.91362724448533 -72.07734011503726, 179.99999999999 -72.59588562644308, 179.98777151047784 -72.66930030813533, 179.99999999999 -72.66187045964608, -179.92242898523259 -72.61473946396302)` that we pass to it, which is indeed self-intersecting if you treat it clockwise. Since this code path is going away as a result of #32039, it makes sense to wait for it. \r\n\r\nSaying that I tried this shape in #35320 and got the error:\r\n\r\n```\r\n[elasticsearch] Caused by: java.lang.IllegalArgumentException: Unable to Tessellate shape [[-72.61473946396302, -179.92242898523259] [-72.48077664056396, -179.70509673080812] [-72.34661931944633, -179.49092755066465] [-72.21221766344048, -179.27982991402556] [-72.08294232094963, -179.0801618967584] [-72.07734011503726, -179.91362724448533] [-72.59588562644308, 179.99999999999] [-72.66930030813533, 179.98777151047784] [-72.66187045964608, 179.99999999999] [-72.61473946396302, -179.92242898523259] ]. Possible malformed shape detected.\r\n[elasticsearch]         at org.apache.lucene.geo.Tessellator.tessellate(Tessellator.java:115) ~[lucene-sandbox-8.0.0-snapshot-61e448666d.jar:8.0.0-snapshot-61e448666d 61e448666d56c20c37dfb825ec14ffe697d000ff - nhat - 2018-12-11 18:10:56]\r\n[elasticsearch]         at org.apache.lucene.document.LatLonShape.createIndexableFields(LatLonShape.java:72) ~[lucene-sandbox-8.0.0-snapshot-61e448666d.jar:8.0.0-snapshot-61e448666d 61e448666d56c20c37dfb825ec14ffe697d000ff - nhat - 2018-12-11 18:10:56]\r\n[elasticsearch]         at org.elasticsearch.index.mapper.GeoShapeFieldMapper.indexShape(GeoShapeFieldMapper.java:134) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n[elasticsearch]         at org.elasticsearch.index.mapper.GeoShapeFieldMapper.parse(GeoShapeFieldMapper.java:117) ~[elasticsearch-7.0.0-SNAPSHOT.jar:7.0.0-SNAPSHOT]\r\n```\r\nSo, it looks like the issue migrated to the new system as well somehow. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447001521","html_url":"https://github.com/elastic/elasticsearch/issues/26286#issuecomment-447001521","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26286","id":447001521,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzAwMTUyMQ==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-12-13T15:07:28Z","updated_at":"2018-12-13T15:07:28Z","author_association":"MEMBER","body":"I've done some more digging here. Basically, it fails if a non self-intersecting counterclockwise polygon that is crossing the dateline self-intersects if you treat is as clockwise. The simples reproduction I could come up with is:\r\n\r\n```\r\nDELETE test-index\r\n\r\nPUT /test-index\r\n{\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"shape\": {\r\n          \"type\": \"geo_shape\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPUT /test-index/_doc/1\r\n{\r\n  \"shape\": {\r\n    \"coordinates\": [[[180, -10], [-170, -5], [-170, 15], [170, -15], [180, -10]]],\r\n    \"type\": \"polygon\"\r\n  }\r\n}\r\n```\r\nInterestingly enough, if I specify ` \"orientation\": \"clockwise\",` it actually indices fine.\r\n```\r\nPUT /test-index/_doc/1\r\n{\r\n  \"shape\": {\r\n    \"coordinates\": [[[180, -10], [-170, -5], [-170, 15], [170, -15], [180, -10]]],\r\n    \"orientation\": \"clockwise\",\r\n    \"type\": \"polygon\"\r\n  }\r\n}\r\n```\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/449131720","html_url":"https://github.com/elastic/elasticsearch/issues/26286#issuecomment-449131720","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26286","id":449131720,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTEzMTcyMA==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T20:52:18Z","updated_at":"2018-12-20T20:52:18Z","author_association":"MEMBER","body":"This is still an issue with #35320, only the error message changed:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"mapper_parsing_exception\",\r\n        \"reason\": \"failed to parse field [shape] of type [geo_shape]\"\r\n      }\r\n    ],\r\n    \"type\": \"mapper_parsing_exception\",\r\n    \"reason\": \"failed to parse field [shape] of type [geo_shape]\",\r\n    \"caused_by\": {\r\n      \"type\": \"illegal_argument_exception\",\r\n      \"reason\": \"Unable to Tessellate shape [[-10.0, 180.0] [-5.0, -170.0] [15.0, -170.0] [-15.0, 170.0] [-10.0, 180.0] ]. Possible malformed shape detected.\"\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\n@iverase what do you think?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/714565755","html_url":"https://github.com/elastic/elasticsearch/issues/26286#issuecomment-714565755","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26286","id":714565755,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNDU2NTc1NQ==","user":{"login":"dwilson1988","id":10068972,"node_id":"MDQ6VXNlcjEwMDY4OTcy","avatar_url":"https://avatars3.githubusercontent.com/u/10068972?v=4","gravatar_id":"","url":"https://api.github.com/users/dwilson1988","html_url":"https://github.com/dwilson1988","followers_url":"https://api.github.com/users/dwilson1988/followers","following_url":"https://api.github.com/users/dwilson1988/following{/other_user}","gists_url":"https://api.github.com/users/dwilson1988/gists{/gist_id}","starred_url":"https://api.github.com/users/dwilson1988/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dwilson1988/subscriptions","organizations_url":"https://api.github.com/users/dwilson1988/orgs","repos_url":"https://api.github.com/users/dwilson1988/repos","events_url":"https://api.github.com/users/dwilson1988/events{/privacy}","received_events_url":"https://api.github.com/users/dwilson1988/received_events","type":"User","site_admin":false},"created_at":"2020-10-22T15:16:32Z","updated_at":"2020-10-22T15:16:32Z","author_association":"NONE","body":"Running into this currently on version 7.9.2, is the best workaround to fix the geometry by changing the orientation before indexing?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/715282324","html_url":"https://github.com/elastic/elasticsearch/issues/26286#issuecomment-715282324","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26286","id":715282324,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTI4MjMyNA==","user":{"login":"iverase","id":29038686,"node_id":"MDQ6VXNlcjI5MDM4Njg2","avatar_url":"https://avatars1.githubusercontent.com/u/29038686?v=4","gravatar_id":"","url":"https://api.github.com/users/iverase","html_url":"https://github.com/iverase","followers_url":"https://api.github.com/users/iverase/followers","following_url":"https://api.github.com/users/iverase/following{/other_user}","gists_url":"https://api.github.com/users/iverase/gists{/gist_id}","starred_url":"https://api.github.com/users/iverase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iverase/subscriptions","organizations_url":"https://api.github.com/users/iverase/orgs","repos_url":"https://api.github.com/users/iverase/repos","events_url":"https://api.github.com/users/iverase/events{/privacy}","received_events_url":"https://api.github.com/users/iverase/received_events","type":"User","site_admin":false},"created_at":"2020-10-23T11:24:01Z","updated_at":"2020-10-23T11:24:01Z","author_association":"CONTRIBUTOR","body":"Hi @dwilson1988,\r\n\r\nthanks to bringing back this issue to our attention. I had a deeper look into the issue and I found out the problem. Currently for some polygons we seem to compute wrongly the orientation. I have just open a PR to fix the issue. \r\n\r\nChanging the orientation can solve your issue now but it will fail once the fix is in place so you need to be careful.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/715465602","html_url":"https://github.com/elastic/elasticsearch/issues/26286#issuecomment-715465602","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26286","id":715465602,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNTQ2NTYwMg==","user":{"login":"dwilson1988","id":10068972,"node_id":"MDQ6VXNlcjEwMDY4OTcy","avatar_url":"https://avatars3.githubusercontent.com/u/10068972?v=4","gravatar_id":"","url":"https://api.github.com/users/dwilson1988","html_url":"https://github.com/dwilson1988","followers_url":"https://api.github.com/users/dwilson1988/followers","following_url":"https://api.github.com/users/dwilson1988/following{/other_user}","gists_url":"https://api.github.com/users/dwilson1988/gists{/gist_id}","starred_url":"https://api.github.com/users/dwilson1988/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dwilson1988/subscriptions","organizations_url":"https://api.github.com/users/dwilson1988/orgs","repos_url":"https://api.github.com/users/dwilson1988/repos","events_url":"https://api.github.com/users/dwilson1988/events{/privacy}","received_events_url":"https://api.github.com/users/dwilson1988/received_events","type":"User","site_admin":false},"created_at":"2020-10-23T17:09:16Z","updated_at":"2020-10-23T17:09:16Z","author_association":"NONE","body":"Just to confirm, if my geometries are RFC7946 compliant, I should be okay, right?","performed_via_github_app":null}]