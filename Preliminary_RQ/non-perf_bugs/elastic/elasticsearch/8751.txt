{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8751","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8751/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8751/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8751/events","html_url":"https://github.com/elastic/elasticsearch/issues/8751","id":50729591,"node_id":"MDU6SXNzdWU1MDcyOTU5MQ==","number":8751,"title":"WrapperQueryBuilder invalid JSON","user":{"login":"pete-hodgman","id":5776613,"node_id":"MDQ6VXNlcjU3NzY2MTM=","avatar_url":"https://avatars1.githubusercontent.com/u/5776613?v=4","gravatar_id":"","url":"https://api.github.com/users/pete-hodgman","html_url":"https://github.com/pete-hodgman","followers_url":"https://api.github.com/users/pete-hodgman/followers","following_url":"https://api.github.com/users/pete-hodgman/following{/other_user}","gists_url":"https://api.github.com/users/pete-hodgman/gists{/gist_id}","starred_url":"https://api.github.com/users/pete-hodgman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pete-hodgman/subscriptions","organizations_url":"https://api.github.com/users/pete-hodgman/orgs","repos_url":"https://api.github.com/users/pete-hodgman/repos","events_url":"https://api.github.com/users/pete-hodgman/events{/privacy}","received_events_url":"https://api.github.com/users/pete-hodgman/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-12-02T21:50:32Z","updated_at":"2014-12-03T18:20:10Z","closed_at":"2014-12-03T14:56:06Z","author_association":"NONE","active_lock_reason":null,"body":"When I wrap the simple json query below I get the following error...\n\nParse Failure [Failed to parse source [{\\n  \\\"query\\\" : {\\n    \\\"wrapper\\\"......\n\nJSON QUERY PRIOR TO WRAPPING...\n{\n  \"query\" : {\n    \"range\" : {\n      \"num\" : {\n        \"from\" : 102,\n        \"to\" : 106,\n        \"include_lower\" : true,\n        \"include_upper\" : true\n      }\n    }\n  }\n}\n\nJSON QUERY AFTER WRAPPING W/Filter added...THIS RESULTS IN PARSE ERROR when sent to server...\n\n{\n  \"query\" : {\n    \"filtered\" : {\n      \"query\" : {\n        \"wrapper\" : {\n          \"query\" : \"ewogICJxdWVyeSIgOiB7CiAgICAicmFuZ2UiIDogewogICAgICAibnVtIiA6IHsKICAgICAgICAiZnJvbSIgOiAxMDIsCiAgICAgICAgInRvIiA6IDEwNiwKICAgICAgICAiaW5jbHVkZV9sb3dlciIgOiB0cnVlLAogICAgICAgICJpbmNsdWRlX3VwcGVyIiA6IHRydWUKICAgICAgfQogICAgfQogIH0KfQ==\"\n        }\n      },\n      \"filter\" : {\n        \"term\" : {\n          \"num\" : \"104\"\n        }\n      }\n    }\n  }\n}\n\nThe original query is valid, the filter is valid. Is this a bug or incorrect usage?\n","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}