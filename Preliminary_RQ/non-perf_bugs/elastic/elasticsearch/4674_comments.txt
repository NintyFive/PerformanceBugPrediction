[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32391666","html_url":"https://github.com/elastic/elasticsearch/issues/4674#issuecomment-32391666","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4674","id":32391666,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzkxNjY2","user":{"login":"sbarton","id":631732,"node_id":"MDQ6VXNlcjYzMTczMg==","avatar_url":"https://avatars3.githubusercontent.com/u/631732?v=4","gravatar_id":"","url":"https://api.github.com/users/sbarton","html_url":"https://github.com/sbarton","followers_url":"https://api.github.com/users/sbarton/followers","following_url":"https://api.github.com/users/sbarton/following{/other_user}","gists_url":"https://api.github.com/users/sbarton/gists{/gist_id}","starred_url":"https://api.github.com/users/sbarton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sbarton/subscriptions","organizations_url":"https://api.github.com/users/sbarton/orgs","repos_url":"https://api.github.com/users/sbarton/repos","events_url":"https://api.github.com/users/sbarton/events{/privacy}","received_events_url":"https://api.github.com/users/sbarton/received_events","type":"User","site_admin":false},"created_at":"2014-01-15T18:05:41Z","updated_at":"2014-01-15T18:06:57Z","author_association":"NONE","body":"Hi,\n\nI was using ES 0.90.7 and my shards were after restart of the cluster going missing. Physically, I can see the files (in 6 cases out of 8) still on the disk, but the shards won't come up with the indication of a segments_X file missing. I have followed your advice of removing the segments.gen file in order to recover, but the shards are not coming up. Even after restart of the cluster, the shards are not coming up, the error is now:\n\n[2014-01-15 18:46:00,504][DEBUG][cluster.service          ] [Synch] processing [shard-failed ([1millionnewv2][4], node[fWigetX5QNar2zIpvkEK_Q], [P], s[INITIALIZING]), reas\non [Failed to start shard, message [IndexShardGatewayRecoveryException[[1millionnewv2][4] failed to fetch index version after copying it over]; nested: IndexShardGatewayRe\ncoveryException[[1millionnewv2][4] shard allocated for local recovery (post api), should exist, but doesn't, current files: [_s41.nvd, _twd_es090_0.tip, _um4.nvm,... ]]; nested: IndexNotF\noundException[no segments\\* file found in store(least_used[rate_limited(niofs(/0/elasticsearch/elasticsearch/nodes/0/indices/1millionnewv2/4/index), type=MERGE, rate=20.0),\n rate_limited(niofs(/1/elasticsearch/elasticsearch/nodes/0/indices/1millionnewv2/4/index), type=MERGE, rate=20.0), rate_limited(niofs(/2/elasticsearch/elasticsearch/nodes/\n0/indices/1millionnewv2/4/index), type=MERGE, rate=20.0), rate_limited(niofs(/3/elasticsearch/elasticsearch/nodes/0/indices/1millionnewv2/4/index), type=MERGE, rate=20.0)]\n): files: [ .... ] ]]]: no change in cluster_state\n\nWhat can I do if the usual strategy of the segments.gen file removal doesn't work? I have even updated the ES to the latest 0.90.10 version but the restart problems are still the same and the shards are not coming up. I have lost a considerable amount of data, in those 2 shards that were wiped out, but I could still save a lot of data in the 6 shards I am could recover.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/32771392","html_url":"https://github.com/elastic/elasticsearch/issues/4674#issuecomment-32771392","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4674","id":32771392,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzcxMzky","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-01-20T15:57:20Z","updated_at":"2014-01-20T15:57:20Z","author_association":"MEMBER","body":"@sbarton are you sure you deleted the segments.gen from all data directories for the relevant shard ([1millionnewv2][4]) (or, better yet, just delete it recursively across all data locations)? the failure suggests you potentially didn't.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34306121","html_url":"https://github.com/elastic/elasticsearch/issues/4674#issuecomment-34306121","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4674","id":34306121,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzA2MTIx","user":{"login":"sbarton","id":631732,"node_id":"MDQ6VXNlcjYzMTczMg==","avatar_url":"https://avatars3.githubusercontent.com/u/631732?v=4","gravatar_id":"","url":"https://api.github.com/users/sbarton","html_url":"https://github.com/sbarton","followers_url":"https://api.github.com/users/sbarton/followers","following_url":"https://api.github.com/users/sbarton/following{/other_user}","gists_url":"https://api.github.com/users/sbarton/gists{/gist_id}","starred_url":"https://api.github.com/users/sbarton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sbarton/subscriptions","organizations_url":"https://api.github.com/users/sbarton/orgs","repos_url":"https://api.github.com/users/sbarton/repos","events_url":"https://api.github.com/users/sbarton/events{/privacy}","received_events_url":"https://api.github.com/users/sbarton/received_events","type":"User","site_admin":false},"created_at":"2014-02-06T09:35:48Z","updated_at":"2014-02-06T09:35:48Z","author_association":"NONE","body":"@kimchy I have made sure I removed the segments.gen from all data directories (using find command) but still no luck. I at the end gave up (I had more shards in the same situation on other machines - tried the same approach but none of them came back) and re-indexed the whole thing once again. But I can say, that the 0.90.10 version is not loosing shards even after several harsh restarts.\n","performed_via_github_app":null}]