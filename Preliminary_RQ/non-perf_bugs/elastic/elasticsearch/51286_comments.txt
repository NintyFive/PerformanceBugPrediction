[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577094238","html_url":"https://github.com/elastic/elasticsearch/issues/51286#issuecomment-577094238","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51286","id":577094238,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzA5NDIzOA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T09:37:58Z","updated_at":"2020-01-22T09:37:58Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Mapping)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577101254","html_url":"https://github.com/elastic/elasticsearch/issues/51286#issuecomment-577101254","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51286","id":577101254,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzEwMTI1NA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T09:54:20Z","updated_at":"2020-01-22T09:54:20Z","author_association":"MEMBER","body":"@Fylhtq42 thanks for raising this, I also see this behaviour on 7.5.1 and it seems odd to be. It doesn't only happen with the \"term_vector\" property, I also tried `index_phrases` and that doesn't get set to the `attachment.content` field in your example. Not, however, that everything works fine when you set the property when you define the subfield in the first place, eg.\r\n```\r\n...\r\n\"attachment\": {\r\n            \"properties\": {\r\n                [...]\r\n                \"content\": {\r\n                    \"fields\": {\r\n                        \"keyword\": {\r\n                            \"ignore_above\": 256,\r\n                            \"type\": \"keyword\"\r\n                        }\r\n                    },\r\n                    \"term_vector\": \"with_positions_offsets\",\r\n                    \"type\": \"text\"\r\n                },     \r\n...\r\n```\r\nI'm curious to learn why you don't set up the whole subfield entirely from the begining. I'm also puzzled why deleting a field (btw. I tried fields other than the `test6` you mentioned) prevents the merging of the parameter into the `content` field inside the `attachment` object, although I must say I don't know if this is something officially supported. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577121357","html_url":"https://github.com/elastic/elasticsearch/issues/51286#issuecomment-577121357","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51286","id":577121357,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzEyMTM1Nw==","user":{"login":"Fylhtq42","id":34159267,"node_id":"MDQ6VXNlcjM0MTU5MjY3","avatar_url":"https://avatars0.githubusercontent.com/u/34159267?v=4","gravatar_id":"","url":"https://api.github.com/users/Fylhtq42","html_url":"https://github.com/Fylhtq42","followers_url":"https://api.github.com/users/Fylhtq42/followers","following_url":"https://api.github.com/users/Fylhtq42/following{/other_user}","gists_url":"https://api.github.com/users/Fylhtq42/gists{/gist_id}","starred_url":"https://api.github.com/users/Fylhtq42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fylhtq42/subscriptions","organizations_url":"https://api.github.com/users/Fylhtq42/orgs","repos_url":"https://api.github.com/users/Fylhtq42/repos","events_url":"https://api.github.com/users/Fylhtq42/events{/privacy}","received_events_url":"https://api.github.com/users/Fylhtq42/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T10:43:05Z","updated_at":"2020-01-22T10:43:05Z","author_association":"NONE","body":"Thanks a lot for the answer! \r\nYeap, that's correct about `setting the property when you define the subfield in the first place`. But in my case we have to create index and mapping through the c# code. And I dont have access to `attachment.content` without this trick. Maybe I will find another way to set `term_vector` to `content`, but unfortunately I didn't find beauty way to do that. But I found something interesting, if you try change last part to\r\n```\r\n\"attachment.content\": {\r\n      \"position_increment_gap\": 20,\r\n      \"term_vector\": \"with_positions_offsets\",\r\n      \"type\": \"text\"\r\n    }\r\n```\r\nelastic adds `position_increment_gap` but doesn't add `term_vector` to the content. \r\nAlso what about chances that it will be fixed in close future? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578181661","html_url":"https://github.com/elastic/elasticsearch/issues/51286#issuecomment-578181661","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51286","id":578181661,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODE4MTY2MQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-01-24T15:38:43Z","updated_at":"2020-01-24T15:38:43Z","author_association":"MEMBER","body":"I looked into the parsing code for the mappings a bit further and can now say the following:\r\n* it's pure luck that this \"trick\" of adding the `term_vector` to a subfield previously defined in the request appears to work in the second case described. It \"appears\" to work because the `attachment.content` mapping parameters are never really merged, but the later one overwrite the former one.\r\n* the order in which we merge field definitions isn't really determined by the order they appear in the request body, since the request is parsed into internal map representations several times when passing the REST layer. We do not and cannot guarantee the order in which fields get merged. In the case where the \"test6\" field is still there, somehow the definition of \"attachement.content\" is parsed before the larger \"attachement\" object when creating the mapping, so the later overwrites the former and the `term_vectors` definition gets lost\r\n\r\nThe fact that this works in some cases is based on a rather lenient behaviour in that we don't detect this kind of overwriting conflicts. I think we should prevent this from happening at all, disallowing this kind of usage when creating the mapping in the first place and I will open a PR to discuss some changes that might help doing so.\r\nIn the meantime I'd ask you to not rely on this behaviour since its buggy and instead try to create the whole \"content\" mapping in one place through other means through the c# code or however you construct the request somehow. If you need further assistance helping with that, the support forums over at https://discuss.elastic.co are a good place to start.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578611084","html_url":"https://github.com/elastic/elasticsearch/issues/51286#issuecomment-578611084","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51286","id":578611084,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODYxMTA4NA==","user":{"login":"Fylhtq42","id":34159267,"node_id":"MDQ6VXNlcjM0MTU5MjY3","avatar_url":"https://avatars0.githubusercontent.com/u/34159267?v=4","gravatar_id":"","url":"https://api.github.com/users/Fylhtq42","html_url":"https://github.com/Fylhtq42","followers_url":"https://api.github.com/users/Fylhtq42/followers","following_url":"https://api.github.com/users/Fylhtq42/following{/other_user}","gists_url":"https://api.github.com/users/Fylhtq42/gists{/gist_id}","starred_url":"https://api.github.com/users/Fylhtq42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fylhtq42/subscriptions","organizations_url":"https://api.github.com/users/Fylhtq42/orgs","repos_url":"https://api.github.com/users/Fylhtq42/repos","events_url":"https://api.github.com/users/Fylhtq42/events{/privacy}","received_events_url":"https://api.github.com/users/Fylhtq42/received_events","type":"User","site_admin":false},"created_at":"2020-01-27T06:36:35Z","updated_at":"2020-01-27T06:36:35Z","author_association":"NONE","body":"Thank you for the answer and explanation! I set the property when I define the subfield in the first place and I solved this problem. I found а good way to do it. And Code seems Ok now. \r\n\r\nHowever, I am happy that it is real buggy and I send enough information for reproduce it","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578660568","html_url":"https://github.com/elastic/elasticsearch/issues/51286#issuecomment-578660568","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51286","id":578660568,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODY2MDU2OA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-01-27T09:25:24Z","updated_at":"2020-01-27T09:25:24Z","author_association":"MEMBER","body":"@Fylhtq42 thanks, will close this issue then and keep #51436 to discuss if an how we can make this clearer to begin with, e.g. by failing a request like the first one you mentioned.","performed_via_github_app":null}]