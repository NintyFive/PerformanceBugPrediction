{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39170","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39170/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39170/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39170/events","html_url":"https://github.com/elastic/elasticsearch/issues/39170","id":412308137,"node_id":"MDU6SXNzdWU0MTIzMDgxMzc=","number":39170,"title":"Aggregation Serialization Issue for getKeyAsNumber() method in aggregation bucket","user":{"login":"parkhekishor1988","id":23350376,"node_id":"MDQ6VXNlcjIzMzUwMzc2","avatar_url":"https://avatars3.githubusercontent.com/u/23350376?v=4","gravatar_id":"","url":"https://api.github.com/users/parkhekishor1988","html_url":"https://github.com/parkhekishor1988","followers_url":"https://api.github.com/users/parkhekishor1988/followers","following_url":"https://api.github.com/users/parkhekishor1988/following{/other_user}","gists_url":"https://api.github.com/users/parkhekishor1988/gists{/gist_id}","starred_url":"https://api.github.com/users/parkhekishor1988/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/parkhekishor1988/subscriptions","organizations_url":"https://api.github.com/users/parkhekishor1988/orgs","repos_url":"https://api.github.com/users/parkhekishor1988/repos","events_url":"https://api.github.com/users/parkhekishor1988/events{/privacy}","received_events_url":"https://api.github.com/users/parkhekishor1988/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-02-20T08:44:31Z","updated_at":"2019-02-21T21:16:13Z","closed_at":"2019-02-21T21:16:13Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** :6.3.2\r\n\r\n**JVM version** : 1.8\r\n\r\n**OS version**: windows 10\r\n\r\n**Description of the problem including expected versus actual behavior**: I am using a term aggregation for the field. I got an expected result. I was trying to convert as JSON(Jackson Mapper). \r\nI am getting a number format exception. After the debugging,  I found the method, getKeyAsNumber() which being call for String data type too. if The key data type is not number it should not try or handled with a valid exception.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. execute a Term aggregation on a string or text field.\r\n 2. Convert to a JSON by using Jackson lib or any JSON conversion lib.\r\n 3.After executing an aggregation on any string data type field. Try to convert as JSON using a Jackson JSON library or any JSON conversion lib. It will through an exception. \r\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}