[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/224784320","html_url":"https://github.com/elastic/elasticsearch/issues/18792#issuecomment-224784320","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18792","id":224784320,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNDc4NDMyMA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-06-09T02:17:47Z","updated_at":"2016-06-09T02:17:47Z","author_association":"MEMBER","body":"Deletes and versions are tricky. If a delete operation is version 1024 of a document, you don't want a versioned update with version 1023 to bring the document back to life. Thus, Elasticsearch needs to keep the delete around so that it can resolve a version conflict like this. Alas, keeping deletes around forever would eventually lead to an exhaustion of resources. So, Elasticsearch strikes a balance and does garbage collection as you correctly surmised.\n\nSo, where are we? Elasticsearch has to keep versions on deletes, or it can't resolve updates, but it has to eventually garbage collect those deletes. Thus, your proposal of always returning -1 for the version of a deleted document is untenable.\n\nYet, there is an out. The time that Elasticsearch will hold on to a delete before garbage collecting it is an index-level setting: `index.gc_deletes`. The default is sixty seconds, as your experimentation discovered, but if you set this to zero, then a deleted document will be immediately garbage collected and it's as if the version is -1, non-existent.\n","performed_via_github_app":null}]