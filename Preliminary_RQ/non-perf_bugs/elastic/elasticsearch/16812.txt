{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16812","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16812/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16812/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16812/events","html_url":"https://github.com/elastic/elasticsearch/issues/16812","id":136474519,"node_id":"MDU6SXNzdWUxMzY0NzQ1MTk=","number":16812,"title":"Unexpected `array_index_out_of_bounds_exception`","user":{"login":"klahnakoski","id":2334429,"node_id":"MDQ6VXNlcjIzMzQ0Mjk=","avatar_url":"https://avatars3.githubusercontent.com/u/2334429?v=4","gravatar_id":"","url":"https://api.github.com/users/klahnakoski","html_url":"https://github.com/klahnakoski","followers_url":"https://api.github.com/users/klahnakoski/followers","following_url":"https://api.github.com/users/klahnakoski/following{/other_user}","gists_url":"https://api.github.com/users/klahnakoski/gists{/gist_id}","starred_url":"https://api.github.com/users/klahnakoski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klahnakoski/subscriptions","organizations_url":"https://api.github.com/users/klahnakoski/orgs","repos_url":"https://api.github.com/users/klahnakoski/repos","events_url":"https://api.github.com/users/klahnakoski/events{/privacy}","received_events_url":"https://api.github.com/users/klahnakoski/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-02-25T18:44:35Z","updated_at":"2016-03-09T10:38:11Z","closed_at":"2016-03-07T09:44:20Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.2.0\n\n**JVM version**: 8.0.???\n\n**OS version**: CentOs\n\n**Description of the problem including expected versus actual behavior**:\n\n**Steps to reproduce**:\n\n```\nPUT t/t/_bulk\n{\"index\":{}}\n{\"a\":\"x\",\"b\":\"m\",\"v\":2}\n{\"index\":{}}\n{\"a\":\"x\",\"b\":\"n\",\"v\":3}\n{\"index\":{}}\n{\"a\":\"x\",\"b\":null,\"v\":5}\n{\"index\":{}}\n{\"a\":\"y\",\"b\":\"m\",\"v\":7}\n{\"index\":{}}\n{\"a\":\"y\",\"b\":\"n\",\"v\":11}\n{\"index\":{}}\n{\"a\":\"y\",\"b\":null,\"v\":13}\n{\"index\":{}}\n{\"a\":null,\"b\":\"m\",\"v\":17}\n{\"index\":{}}\n{\"a\":null,\"b\":\"n\",\"v\":19}\n{\"index\":{}}\n{\"a\":\"x\",\"b\":\"m\",\"v\":27}\n{\"index\":{}}\n{\"a\":\"y\",\"b\":\"n\",\"v\":39}\n\nGET t/t/_search\n{\n  \"aggs\": {\n    \"_match\": {\n      \"aggs\": {\n        \"_missing\": {\n          \"aggs\": {\n            \"v\": {\n              \"extended_stats\": {\n                \"field\": \"v\"\n              }\n            }\n          },\n          \"missing\": {\n            \"field\": \"a\"\n          }\n        }\n      },\n      \"terms\": {\n        \"field\": \"b\",\n        \"size\": 10\n      }\n    }\n  },\n  \"size\": 0\n}\n```\n\nGet an error (and some results)\n\n```\n{\n    \"took\":1,\n    \"timed_out\":false,\n    \"_shards\":{\n        \"total\":3,\n        \"successful\":1,\n        \"failed\":2,\n        \"failures\":[{\n            \"shard\":0,\n            \"index\":\"testing_e18cf562b420160225_183510\",\n            \"node\":\"QlVbQTlvT5O_fe9x4LxvWQ\",\n            \"reason\":{\n                \"type\":\"array_index_out_of_bounds_exception\",\n                \"reason\":null\n            }\n        }]\n    },  \n    // results clipped\n```\n\nThe `stats` aggregate does not have this problem.\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}