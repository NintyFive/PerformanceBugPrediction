{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20113","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20113/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20113/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20113/events","html_url":"https://github.com/elastic/elasticsearch/issues/20113","id":172593617,"node_id":"MDU6SXNzdWUxNzI1OTM2MTc=","number":20113,"title":"ES 2.3.3 geo_polygon query touching the equator cannot find the points on the equator","user":{"login":"laoyaosniper","id":3031664,"node_id":"MDQ6VXNlcjMwMzE2NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/3031664?v=4","gravatar_id":"","url":"https://api.github.com/users/laoyaosniper","html_url":"https://github.com/laoyaosniper","followers_url":"https://api.github.com/users/laoyaosniper/followers","following_url":"https://api.github.com/users/laoyaosniper/following{/other_user}","gists_url":"https://api.github.com/users/laoyaosniper/gists{/gist_id}","starred_url":"https://api.github.com/users/laoyaosniper/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/laoyaosniper/subscriptions","organizations_url":"https://api.github.com/users/laoyaosniper/orgs","repos_url":"https://api.github.com/users/laoyaosniper/repos","events_url":"https://api.github.com/users/laoyaosniper/events{/privacy}","received_events_url":"https://api.github.com/users/laoyaosniper/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-08-23T01:40:22Z","updated_at":"2016-08-29T12:57:48Z","closed_at":"2016-08-23T12:57:38Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3.3, 1.4.4\n\n**Plugins installed**: not related\n\n**JVM version**: 1.8.0_77\n\n**OS version**: OS X El Capitan\n\n**Description of the problem including expected versus actual behavior**:\nIn ES 2.3.3, if you do a geo polygon query whose one side lies on the equator in the south hemisphere, then you cannot find the indexed point on the equator. The query will work fine if the polygon is across the equator. Interestingly, this bug also exists in ES 1.4.4 but only happens when your polygon is in the north hemisphere.\n\nI searched ES docs but there is no clear definition whether a geo point on the boundary of the geo polygon should be considered searchable or not. Is it considered as undefined behavior or is there any special rules about geo points on edges? It will be really helpful if you can edit ES docs to clarify this case.\n\n**Steps to reproduce**:\n1. Create an index with mapping:\n   \n   ```\n   PUT /geo_polygon\n   {\n       \"settings\" : {\n           \"index\" : {\n               \"number_of_shards\" : 1, \n               \"number_of_replicas\" : 0\n           }\n       },\n   \n     \"mappings\": {\n       \"my_type\": {\n         \"properties\": {\n           \"location\": {\n             \"type\": \"geo_point\"\n           }\n         }\n       }\n     }\n   }\n   ```\n2. Put a list of points on the map.\n   \n   ```\n   PUT /geo_polygon/my_type/1\n   {\n     \"text\": \"Point on the equator\",\n     \"location\": { \n       \"lat\": 0.0,\n       \"lon\": 30.0\n     }\n   }\n   \n   PUT /geo_polygon/my_type/2\n   {\n     \"text\": \"Point in the southern hemisphere\",\n     \"location\": { \n       \"lat\": -0.1,\n       \"lon\": 30.0\n     }\n   }\n   \n   PUT /geo_polygon/my_type/3\n   {\n     \"text\": \"Point in the northern hemisphere\",\n     \"location\": { \n       \"lat\": 0.1,\n       \"lon\": 30.0\n     }\n   }\n   ```\n3. Search with a square polygon whose one side is on the equator in the southern hemisphere.\n   \n   ```\n   GET /geo_polygon\n   {\n       \"query\": {\n           \"bool\" : {\n               \"filter\" : {\n                   \"geo_polygon\" : {\n                       \"location\" : {\n                           \"points\" : [\n                               {\"lat\" : 0.0, \"lon\" : 10},\n                               {\"lat\" : 0.0, \"lon\" : 50},\n                               {\"lat\" : -1, \"lon\" : 50},\n                               {\"lat\" : -1, \"lon\" : 10}\n                           ]\n                       }\n                   }\n               }\n           }\n       }\n   }\n   ```\n   \n   Result:\n   - ES 2.3.3: only point 2 is returned.\n   - ES 1.4.4: both point 1 and 2 are returned.\n4. Search with a square polygon whose one side is on the equator in the northern hemisphere.\n   \n   ```\n   GET /geo_polygon\n   {\n       \"query\": {\n           \"bool\" : {\n               \"filter\" : {\n                   \"geo_polygon\" : {\n                       \"location\" : {\n                           \"points\" : [\n                               {\"lat\" : 0.0, \"lon\" : 10},\n                               {\"lat\" : 0.0, \"lon\" : 50},\n                               {\"lat\" : 1, \"lon\" : 50},\n                               {\"lat\" : 1, \"lon\" : 10}\n                           ]\n                       }\n                   }\n               }\n           }\n       }\n   }\n   ```\n   \n   Result:\n   - ES 2.3.3: both point 1 and 2 are returned.\n   - ES 1.4.4: only point 2 is returned.\n5. Search with a square polygon which is across the equator.\n   \n   ```\n   GET /geo_polygon\n   {\n       \"query\": {\n           \"bool\" : {\n               \"filter\" : {\n                   \"geo_polygon\" : {\n                       \"location\" : {\n                           \"points\" : [\n                               {\"lat\" : -1, \"lon\" : 10},\n                               {\"lat\" : -1, \"lon\" : 50},\n                               {\"lat\" : 1, \"lon\" : 50},\n                               {\"lat\" : 1, \"lon\" : 10}\n                           ]\n                       }\n                   }\n               }\n           }\n       }\n   }\n   ```\n   \n   Result:\n   - ES 2.3.3: all points 1, 2 and 3 are returned.\n   - ES 1.4.4: all points 1, 2 and 3 are returned.\n\n**Provide logs (if relevant)**:\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n\n**Describe the feature**:\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}