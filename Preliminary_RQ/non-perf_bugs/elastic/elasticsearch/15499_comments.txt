[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/165420911","html_url":"https://github.com/elastic/elasticsearch/issues/15499#issuecomment-165420911","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15499","id":165420911,"node_id":"MDEyOklzc3VlQ29tbWVudDE2NTQyMDkxMQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-12-17T10:52:10Z","updated_at":"2015-12-17T10:52:10Z","author_association":"MEMBER","body":"The trick is indeed finding out why the nodes are falling of the cluster. Here is a bit of help answering your questions (I'm going to close this for now - feel free to reopen or continue discussing on discuss.elastic.co ).\n\n1) When we create a shard on a folder we acquire a lock to make sure the folder is not used by a background process (like a recovery). This is to protect against overriding folders in the case of quick index deletion and creation (among others). We give this a best effort of 5s which is more then enough for things to unravel things. The assumption is that if this fails we better try another node (and if that fails come back to this node). This is indeed not configurable. \n2) The BroadcastShardOperation is too verbose. These errors are correct and expected. This was fixed with #14950 . You can ignore those.\n3) OK :)\n4) This indicate that a recovery doesn't have any activity for more then 15 minutes and therefore the recovery is cancelled. This is probably the source of your problems. The question is why does it time out. I would check the logs for network issues or engine related things.\n","performed_via_github_app":null}]