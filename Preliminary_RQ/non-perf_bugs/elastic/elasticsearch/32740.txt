{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32740","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32740/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32740/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32740/events","html_url":"https://github.com/elastic/elasticsearch/issues/32740","id":349064401,"node_id":"MDU6SXNzdWUzNDkwNjQ0MDE=","number":32740,"title":"Questions about sequence number","user":{"login":"yiguolei","id":9208457,"node_id":"MDQ6VXNlcjkyMDg0NTc=","avatar_url":"https://avatars2.githubusercontent.com/u/9208457?v=4","gravatar_id":"","url":"https://api.github.com/users/yiguolei","html_url":"https://github.com/yiguolei","followers_url":"https://api.github.com/users/yiguolei/followers","following_url":"https://api.github.com/users/yiguolei/following{/other_user}","gists_url":"https://api.github.com/users/yiguolei/gists{/gist_id}","starred_url":"https://api.github.com/users/yiguolei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yiguolei/subscriptions","organizations_url":"https://api.github.com/users/yiguolei/orgs","repos_url":"https://api.github.com/users/yiguolei/repos","events_url":"https://api.github.com/users/yiguolei/events{/privacy}","received_events_url":"https://api.github.com/users/yiguolei/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-08-09T10:13:21Z","updated_at":"2018-08-09T10:38:28Z","closed_at":"2018-08-09T10:38:16Z","author_association":"NONE","active_lock_reason":null,"body":"\r\nwhen primary changes, I only find the primary shard will send resyc request to replicas. And the replica only trim translogs but not trim the state in lucene.   There will be some errors in race conditions. For example:\r\n3 replicas, A,B,C. \r\nA is primary.\r\nA send record (seq=10) to B, C    but B not receive the record , C received the record and A crashed.\r\nMaster selects B as the new primary, the primary term changes.\r\nBut B not trim the record with seq=10 on C. so that C has an extra record. The 2 replica are not in consistency state.\r\n\r\nI think B should send a trim request to C but I could not find it in source code.\r\n\r\nDo I miss anything?\r\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}