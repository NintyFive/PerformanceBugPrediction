{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21931","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21931/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21931/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21931/events","html_url":"https://github.com/elastic/elasticsearch/issues/21931","id":193091502,"node_id":"MDU6SXNzdWUxOTMwOTE1MDI=","number":21931,"title":"How to avoid NOOP while partically updating elastic search document.","user":{"login":"renukaradhya","id":22371220,"node_id":"MDQ6VXNlcjIyMzcxMjIw","avatar_url":"https://avatars0.githubusercontent.com/u/22371220?v=4","gravatar_id":"","url":"https://api.github.com/users/renukaradhya","html_url":"https://github.com/renukaradhya","followers_url":"https://api.github.com/users/renukaradhya/followers","following_url":"https://api.github.com/users/renukaradhya/following{/other_user}","gists_url":"https://api.github.com/users/renukaradhya/gists{/gist_id}","starred_url":"https://api.github.com/users/renukaradhya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renukaradhya/subscriptions","organizations_url":"https://api.github.com/users/renukaradhya/orgs","repos_url":"https://api.github.com/users/renukaradhya/repos","events_url":"https://api.github.com/users/renukaradhya/events{/privacy}","received_events_url":"https://api.github.com/users/renukaradhya/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-12-02T11:12:12Z","updated_at":"2016-12-12T14:28:35Z","closed_at":"2016-12-12T14:28:35Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n\r\n**Elasticsearch version**: 5.0.0\r\n\r\n**Plugins installed**: Head\r\n\r\n**JVM version**:1.8\r\n\r\n**OS version**:Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n I have a requirement to update a flag based on some criteria. But the flag updates are not working consistently, it updates some times and will not some times.  Getting lot of NOOP update status while updating. Number of messages I am processing/pushing is huge ~ 1-2 lakhs per minute. Every document insertion will result in update of older version of the document.\r\n\r\nBelow is my code for updation.\r\n\r\nQueryBuilder queryBuilder = QueryBuilders.boolQuery().must(QueryBuilders.termQuery(\"clientId\", clientId))\r\n        .must(QueryBuilders.termQuery(\"applicable\", \"true\"));\r\n    SearchResponse searchResponse = client.prepareSearch(indexName).setTypes(\"messages\").setQuery(queryBuilder)\r\n        .addStoredField(\"id\").setSize(100).execute().actionGet();\r\n    for (SearchHit hit : searchResponse.getHits()) {\r\n      String id = hit.getId();\r\n      if (id != null) {\r\n        UpdateRequest updateRequest = new UpdateRequest();\r\n        updateRequest.index(indexName);\r\n        updateRequest.type(\"messages\");\r\n        updateRequest.id(id);\r\n        updateRequest.doc(XContentFactory.jsonBuilder().startObject().field(\"applicable\", \"false\").endObject());\r\n        try {\r\n          UpdateResponse response = client.update(updateRequest).actionGet();\r\n        } catch (Exception e) {\r\n          e.printStackTrace();\r\n        }\r\n      }\r\n    }\r\nHere i want to update applicable flag to false for old messages for a client and insert a new message with applicable=true, So at query time the application will use this applicable flag. I am calling this above code before every insert of new message for a clientId.\r\n\r\n\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}