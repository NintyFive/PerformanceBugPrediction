{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55110/events","html_url":"https://github.com/elastic/elasticsearch/issues/55110","id":598873673,"node_id":"MDU6SXNzdWU1OTg4NzM2NzM=","number":55110,"title":"Painless ElasticSearch: Deletion of object from array of objects not working as expected.","user":{"login":"HighOnWater","id":30986640,"node_id":"MDQ6VXNlcjMwOTg2NjQw","avatar_url":"https://avatars1.githubusercontent.com/u/30986640?v=4","gravatar_id":"","url":"https://api.github.com/users/HighOnWater","html_url":"https://github.com/HighOnWater","followers_url":"https://api.github.com/users/HighOnWater/followers","following_url":"https://api.github.com/users/HighOnWater/following{/other_user}","gists_url":"https://api.github.com/users/HighOnWater/gists{/gist_id}","starred_url":"https://api.github.com/users/HighOnWater/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HighOnWater/subscriptions","organizations_url":"https://api.github.com/users/HighOnWater/orgs","repos_url":"https://api.github.com/users/HighOnWater/repos","events_url":"https://api.github.com/users/HighOnWater/events{/privacy}","received_events_url":"https://api.github.com/users/HighOnWater/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-04-13T12:55:20Z","updated_at":"2020-04-14T02:45:23Z","closed_at":"2020-04-13T19:25:55Z","author_association":"NONE","active_lock_reason":null,"body":"Java version: 1.8.0_151\r\nES Version: 7.4\r\n\r\nI have this document in ElasticSearch index:\r\n```\r\n{\r\n    \"field1\":\"value1\",\r\n    \"field2\":\"value2\",\r\n    \"array1\": [{\r\n        ..some fields,\r\n        \"arrayObjectId\": \"12346\",\r\n      \r\n    },{\r\n       ... some fields,\r\n        \"arrayObjectId\": \"12346\",\r\n    },{\r\n       ... some fields,\r\n        \"arrayObjectId\": \"12346\",\r\n    }]\r\n}\r\n```\r\nI want to delete the objects from ```array1``` based on the ```arrayObjectId```. \r\nI use the following painless script to achieve it:\r\n```\r\n{\r\n  \"script\": {\r\n    \"lang\": \"painless\",\r\n    \"source\": \"\"\"\r\n\r\n    for(int i = 0;i < ctx._source['array1'].length; i++) {\r\n      if (ctx._source['array1'][i].arrayObjectId == \"12346\"){\r\n        ctx._source['array1'].remove(i);\r\n      }\r\n    }\r\n       \"\"\"\r\n  }\r\n}\r\n```\r\nThe above script removes 2 out of the three arrayObjectIds, instead of all of them. This same behavior is seen with Iterators. However it works fine (removing the objects from array that match the arrayObjectId field) with ```removeIf``` method of ArrayList as specified [here](https://www.elastic.co/guide/en/elasticsearch/painless/master/painless-lambdas.html). \r\n\r\nAccording to the [documentation](https://www.elastic.co/guide/en/elasticsearch/painless/master/painless-lang-spec.html), painless shares basic constructs with Java. Ideally it should delete all objects from the array that match the arrayObjectId. Is the above behavior a bug? Can this be looked into.\r\nThanks \r\n \r\n\r\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}