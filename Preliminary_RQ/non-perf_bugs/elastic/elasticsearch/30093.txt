{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30093","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30093/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30093/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30093/events","html_url":"https://github.com/elastic/elasticsearch/issues/30093","id":317454928,"node_id":"MDU6SXNzdWUzMTc0NTQ5Mjg=","number":30093,"title":"[CI] FullClusterRestartIT#testSingleDoc","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"labels":[{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"assignees":[{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2017-09-18T10:01:51Z","updated_at":"2018-06-15T11:26:31Z","closed_at":"2018-06-15T11:26:30Z","author_association":"COLLABORATOR","active_lock_reason":null,"body":"*Original comment by @martijnvg:*\n\nBuild failed with: \r\n\r\n```\r\n REPRODUCE WITH: gradle :x-pack-elasticsearch:qa:full-cluster-restart:with-system-key:v5.6.1-SNAPSHOT#upgradedClusterTestRunner -Dtests.seed=9291115319E8B4B1 -Dtests.class=org.elasticsearch.xpack.restart.FullClusterRestartIT -Dtests.method=\"testSingleDoc\" -Dtests.security.manager=true -Dtests.locale=ar-AE -Dtests.timezone=Etc/GMT+11\r\nFAILURE 10.8s | FullClusterRestartIT.testSingleDoc <<< FAILURES!\r\n   > Throwable LINK REDACTED: java.lang.AssertionError: there are still running tasks:\r\n   > {time_in_queue=526ms, time_in_queue_millis=526, source=shard-started shard id [[testhistoryuuidisadded][0]], allocation id [KPDcVc_WS4GxInwInutzRw], primary term [0], message [after peer recovery], executing=true, priority=URGENT, insert_order=165}\r\n   > {time_in_queue=476ms, time_in_queue_millis=476, source=shard-started shard id [[testhistoryuuidisadded][0]], allocation id [KPDcVc_WS4GxInwInutzRw], primary term [0], message [master {node-1}{GSM8x_jKQ1mRxd4oFhUf9w}{lEp9LirBSUKycBM3wdSTCA}{127.0.0.1}{127.0.0.1:41194}{testattr=test, ml.max_open_jobs=10, ml.enabled=true} marked shard as initializing, but shard state is [POST_RECOVERY], mark shard as started], executing=false, priority=URGENT, insert_order=166}\r\n   > {time_in_queue=467ms, time_in_queue_millis=467, source=shard-started shard id [[testsingledoc][1]], allocation id [wpXuLZ7jRGGZY-VPKEw35g], primary term [0], message [after peer recovery], executing=false, priority=URGENT, insert_order=167}\r\n   >     at __randomizedtesting.SeedInfo.seed([9291115319E8B4B1:F8E46144F5EAEF9B]:0)\r\n   >     at org.elasticsearch.test.rest.ESRestTestCase.lambda$waitForClusterStateUpdatesToFinish$0(ESRestTestCase.java:285)\r\n   >     at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:727)\r\n   >     at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:701)\r\n   >     at org.elasticsearch.test.rest.ESRestTestCase.waitForClusterStateUpdatesToFinish(ESRestTestCase.java:276)\r\n   >     at org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:132)\r\n   >     at java.lang.Thread.run(Thread.java:748)\r\n   >     Suppressed: java.lang.AssertionError: there are still running tasks:\r\n```\r\n\r\nThe failure doesn't reproduce.\r\n\r\nMore likely cause seems to be:\r\n\r\n```\r\n[2017-09-18T08:09:30,081][ERROR][o.e.x.m.e.l.LocalExporter] failed to set monitoring watch [G9WWmiB0RrKFEfZGYcBlWA_kibana_version_mismatch]\r\norg.elasticsearch.indices.TypeMissingException: type[doc] missing\r\n\tat org.elasticsearch.index.mapper.MapperService.documentMapperWithAutoCreate(MapperService.java:753) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.docMapper(IndexShard.java:2078) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.applyIndexOperation(IndexShard.java:655) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.applyIndexOperationOnPrimary(IndexShard.java:636) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.executeIndexRequestOnPrimary(TransportShardBulkAction.java:548) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.executeIndexRequest(TransportShardBulkAction.java:140) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.executeBulkItemRequest(TransportShardBulkAction.java:236) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.performOnPrimary(TransportShardBulkAction.java:123) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:110) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:72) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:998) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryShardReference.perform(TransportReplicationAction.java:976) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.ReplicationOperation.execute(ReplicationOperation.java:103) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.onResponse(TransportReplicationAction.java:340) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.onResponse(TransportReplicationAction.java:280) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$1.onResponse(TransportReplicationAction.java:939) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$1.onResponse(TransportReplicationAction.java:936) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:238) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationPermit(IndexShard.java:2101) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.acquirePrimaryShardReference(TransportReplicationAction.java:948) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction.access$500(TransportReplicationAction.java:95) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncPrimaryAction.doRun(TransportReplicationAction.java:301) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:276) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:263) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler$1.doRun(SecurityServerTransportInterceptor.java:263) ~[?:?]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$1.execute(EsExecutors.java:135) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.lambda$messageReceived$0(SecurityServerTransportInterceptor.java:312) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:59) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$null$2(ServerTransportFilter.java:158) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:124) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:118) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:106) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.lambda$inbound$3(ServerTransportFilter.java:160) ~[?:?]\r\n\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:59) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:195) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:228) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:239) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:193) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:147) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:116) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.transport.ServerTransportFilter$NodeProfile.inbound(ServerTransportFilter.java:139) ~[?:?]\r\n\tat org.elasticsearch.xpack.security.transport.SecurityServerTransportInterceptor$ProfileSecuredRequestHandler.messageReceived(SecurityServerTransportInterceptor.java:319) ~[?:?]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:642) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.1.0-SNAPSHOT.jar:6.1.0-SNAPSHOT]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_144]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_144]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_144]\r\nCaused by: java.lang.IllegalStateException: trying to auto create mapping, but dynamic mapping is disabled\r\n```\r\n\r\nLooks like some upgrade monitor issue.\r\n\r\nBuild url: LINK REDACTED\r\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}