{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45316","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45316/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45316/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45316/events","html_url":"https://github.com/elastic/elasticsearch/issues/45316","id":478269870,"node_id":"MDU6SXNzdWU0NzgyNjk4NzA=","number":45316,"title":"ES_7.3.0 JDBC driver does not work properly in the JDK 8 version.","user":{"login":"lendo","id":82283,"node_id":"MDQ6VXNlcjgyMjgz","avatar_url":"https://avatars3.githubusercontent.com/u/82283?v=4","gravatar_id":"","url":"https://api.github.com/users/lendo","html_url":"https://github.com/lendo","followers_url":"https://api.github.com/users/lendo/followers","following_url":"https://api.github.com/users/lendo/following{/other_user}","gists_url":"https://api.github.com/users/lendo/gists{/gist_id}","starred_url":"https://api.github.com/users/lendo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lendo/subscriptions","organizations_url":"https://api.github.com/users/lendo/orgs","repos_url":"https://api.github.com/users/lendo/repos","events_url":"https://api.github.com/users/lendo/events{/privacy}","received_events_url":"https://api.github.com/users/lendo/received_events","type":"User","site_admin":false},"labels":[{"id":912794284,"node_id":"MDU6TGFiZWw5MTI3OTQyODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/SQL","name":":Query Languages/SQL","color":"0e8a16","default":false,"description":"SQL querying"},{"id":1967501040,"node_id":"MDU6TGFiZWwxOTY3NTAxMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:QL","name":"Team:QL","color":"fef2c0","default":false,"description":"Meta label for query languages team"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-08-08T06:09:39Z","updated_at":"2020-05-19T18:53:57Z","closed_at":"2020-05-19T18:53:57Z","author_association":"NONE","active_lock_reason":null,"body":"JDK version: 1.8.0_211\r\nwhen i used xpack 7.3.0 jdbc driver to access my data in es cluster.\r\nI got a stack error:\r\n`java.lang.IllegalStateException: Unsupported Content-Type: text/plain; charset=UTF-8\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.readFrom(HttpClient.java:161)\r\n\tat org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.request(JreHttpUrlConnection.java:155)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$4(HttpClient.java:131)\r\n\tat org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.http(JreHttpUrlConnection.java:65)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.lambda$get$5(HttpClient.java:130)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.get(HttpClient.java:129)\r\n\tat org.elasticsearch.xpack.sql.client.HttpClient.serverInfo(HttpClient.java:60)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcHttpClient.fetchServerInfo(JdbcHttpClient.java:95)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcHttpClient.<init>(JdbcHttpClient.java:47)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcConnection.<init>(JdbcConnection.java:53)\r\n\tat org.elasticsearch.xpack.sql.jdbc.JdbcConnection.<init>(JdbcConnection.java:48)\r\n\tat org.elasticsearch.xpack.sql.jdbc.EsDriver.connect(EsDriver.java:76)`\r\n\r\nI debug my code and get a snapshot:\r\n<img width=\"979\" alt=\"1\" src=\"https://user-images.githubusercontent.com/82283/62678968-89ad5c00-b9e5-11e9-8c33-129d4b0953a6.png\">\r\nthe header \"Content-Type\" is missing. finally i found a problem in xpack 7.3.0 jdbc driver.\r\n\r\nes 7.3.0 jdbc driver use java.net.HttpURLConnection to perform requestsï¼ŒThe following two figures show the difference between jdk8 and jdk7 in sun/net/www/protocol/http/HttpURLConnection.java:\r\njdk8:\r\n<img width=\"386\" alt=\"7CB86FA6-2522-4770-BBB7-218D777F6FC9\" src=\"https://user-images.githubusercontent.com/82283/62678702-c7f64b80-b9e4-11e9-849d-da1232a9b076.png\">\r\njdk7:\r\n<img width=\"415\" alt=\"BC6A31A6-5D96-4c9b-84B6-39062867FCDB\" src=\"https://user-images.githubusercontent.com/82283/62678713-cdec2c80-b9e4-11e9-9947-755d33eb1ad0.png\">\r\n\r\nPropose: use **Apache HttpClient** instead of java.net.HttpURLConnection in org.elasticsearch.xpack.sql.client.JreHttpUrlConnection.java","closed_by":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"performed_via_github_app":null}