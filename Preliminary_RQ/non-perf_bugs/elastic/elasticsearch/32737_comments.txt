[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411686327","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-411686327","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":411686327,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTY4NjMyNw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T08:53:10Z","updated_at":"2018-08-09T08:53:10Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411690242","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-411690242","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":411690242,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTY5MDI0Mg==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T09:06:23Z","updated_at":"2018-08-09T09:06:23Z","author_association":"CONTRIBUTOR","body":"Actually it seems that in CI the problem surfaced when calling `elasticsearch-keystore create`\r\nWhen I tried to reproduce this locally, it failed in the same way when adding a file\r\n\r\n```\r\nelasticsearch-keystore add-file xpack.watcher.encryption_key /home/alpar/work/elastic/elasticsearch/x-pack/qa/full-cluster-restart/src/test/resources/system_key\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411832239","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-411832239","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":411832239,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTgzMjIzOQ==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T17:17:30Z","updated_at":"2018-08-09T17:17:30Z","author_association":"CONTRIBUTOR","body":"@atorok It is not clear to me how this fails. Can you please detail your reproduction?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411848809","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-411848809","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":411848809,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTg0ODgwOQ==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T18:14:07Z","updated_at":"2018-08-09T18:14:07Z","author_association":"CONTRIBUTOR","body":"https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.4+matrix-java-periodic/ES_BUILD_JAVA=java10,ES_RUNTIME_JAVA=java8fips,nodes=virtual&&linux/26/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411851122","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-411851122","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":411851122,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTg1MTEyMg==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T18:21:48Z","updated_at":"2018-08-09T18:21:48Z","author_association":"CONTRIBUTOR","body":"@albertzaharovits sorry for that. \r\nI can reproduce locally with:\r\n`RUNTIME_JAVA_HOME=$JAVA8FIPS_HOME ./gradlew :x-pack:qa:full-cluster-restart:check`\r\nthe test runs `elasticsearch-keystore` as part of the upgrade the relevant log is\r\n```\r\n10:02:54 Starting process 'command '/var/lib/jenkins/workspace/elastic+elasticsearch+6.4+matrix-java-periodic/ES_BUILD_JAVA/java10/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT#oldClusterTestCluster node0/elasticsearch-6.3.3-SNAPSHOT/bin/elasticsearch-keystore''. Working directory: /var/lib/jenkins/workspace/elastic+elasticsearch+6.4+matrix-java-periodic/ES_BUILD_JAVA/java10/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT#oldClusterTestCluster node0/cwd Command: /var/lib/jenkins/workspace/elastic+elasticsearch+6.4+matrix-java-periodic/ES_BUILD_JAVA/java10/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/with-system-key/build/cluster/v6.3.3-SNAPSHOT#oldClusterTestCluster node0/elasticsearch-6.3.3-SNAPSHOT/bin/elasticsearch-keystore add-file xpack.watcher.encryption_key /var/lib/jenkins/workspace/elastic+elasticsearch+6.4+matrix-java-periodic/ES_BUILD_JAVA/java10/ES_RUNTIME_JAVA/java8fips/nodes/virtual&&linux/x-pack/qa/full-cluster-restart/src/test/resources/system_key```\r\nThis is the call that fails with the exception from the description. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411856332","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-411856332","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":411856332,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTg1NjMzMg==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-08-09T18:39:56Z","updated_at":"2018-08-09T18:40:06Z","author_association":"CONTRIBUTOR","body":"It actually takes this to reproduce it : \r\n```[:~/work/elastic/elasticsearch/x-pack/qa/full-cluster-restart] master+ 130 Â± RUNTIME_JAVA_HOME=$JAVA8FIPS_HOME ../../../gradlew check```\r\n\r\nThe previous command looks to be equivalent but it just runs an empty check due to the sub-projects. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412523189","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-412523189","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":412523189,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjUyMzE4OQ==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-08-13T13:45:50Z","updated_at":"2018-08-13T13:45:50Z","author_association":"CONTRIBUTOR","body":"The `java.io.IOException: Invalid keystore format` and associated stack trace is a red herring: It fails while trying to verify the signature of the BouncyCastle FIPS Security Provider JAR and more specifically when trying to check if the certificate that contains the public key with which the JAR is signed is one of the trusted root certificates that ship with the JDK : \r\n\r\n```\r\n/**\r\n * The purpose of this class is to determine the trust anchor certificates is in\r\n * the cacerts file.  This is used for PKIX CertPath checking.\r\n */\r\npublic class AnchorCertificates {\r\n\r\n    private static final Debug debug = Debug.getInstance(\"certpath\");\r\n    private static final String HASH = \"SHA-256\";\r\n    private static Set<String> certs = Collections.emptySet();\r\n\r\n    static  {\r\n        AccessController.doPrivileged(new PrivilegedAction<Void>() {\r\n            @Override\r\n            public Void run() {\r\n                File f = new File(System.getProperty(\"java.home\"),\r\n                        \"lib/security/cacerts\");\r\n                KeyStore cacerts;\r\n                try {\r\n                    cacerts = KeyStore.getInstance(\"JKS\");\r\n                    try (FileInputStream fis = new FileInputStream(f)) {\r\n                        cacerts.load(fis, null);\r\n                     .....\r\n                     ......\r\n```\r\n\r\nThe code above makes the assumption that the `cacerts` keystore is a `JKS` one, but we're running in a FIPS 140 JVM where the keystore has been modified to be of `BCFKS` type, and this predictably fails with \r\n```\r\njava.io.IOException: Invalid keystore format\r\n```\r\nThere is an issue ( unresolved ) upstream for Java 8 : https://bugs.openjdk.java.net/browse/JDK-8202893.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412524544","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-412524544","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":412524544,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjUyNDU0NA==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-08-13T13:49:59Z","updated_at":"2018-08-13T13:49:59Z","author_association":"CONTRIBUTOR","body":"Nice catch @jkakavas ! ðŸ’¯ ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412525805","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-412525805","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":412525805,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjUyNTgwNQ==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-08-13T13:53:49Z","updated_at":"2018-08-13T13:53:49Z","author_association":"CONTRIBUTOR","body":"The actual issue causing the failure is discussed in https://github.com/elastic/elasticsearch/pull/28515#issuecomment-364066728. This was identified as part of the effort for FIPS 140-2 compliance and the relevant change was introduced in https://github.com/elastic/elasticsearch/pull/28515. It was not backported to 6.3 as it wasn't deemed necessary at the time. \r\nThe two options I see are: \r\n- Attempting to run the 6.3 keystore commands with a different JAVA RUNTIME (@atorok any thoughts on how feasible that is ? )\r\n- Mute the bwc tests for anything older than 6.4 in FIPS JVMs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412753688","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-412753688","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":412753688,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjc1MzY4OA==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T04:49:01Z","updated_at":"2018-08-14T04:49:01Z","author_association":"CONTRIBUTOR","body":"@jkakavas What would a user do ? do we expect upgrades from non-fips to fips ? AFAIK we don't have any other tests swap out the JDK during an upgrade, but FIPS is indeed a bit different. We should probably test what we would tell our users to do, either remove 6.3 from bwc tests when running on fips - if we tell users you would need to do something like  upgrade to 6.4 then enable fips, or extend the cluster formation tests to  know about FIPS and be able to go from a FIPS  run-time java version to a non  fips one and run with that.  @nik9000 any thoughts ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412768905","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-412768905","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":412768905,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjc2ODkwNQ==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T06:32:37Z","updated_at":"2018-08-14T06:33:07Z","author_association":"CONTRIBUTOR","body":"> @jkakavas What would a user do ? do we expect upgrades from non-fips to fips ? \r\n\r\nfips and non-fips in this context applies to the JVM only, not Elasticsearch. This, in addition to the fact that we do not support FIPS 140 JVMs for anything < 6.4 , means that one **cannot** first switch to a FIPS 140 JVM and _then_ upgrade. \r\n\r\nSince this is the only upgrade path, I will be muting 6.3 bwc tests when running on fips. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412776874","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-412776874","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":412776874,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjc3Njg3NA==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T07:12:47Z","updated_at":"2018-08-14T07:12:47Z","author_association":"CONTRIBUTOR","body":"@jkakavas I don't disagree, but I'd like us to be crystal clear on what we do support.\r\n\r\nIf someone is on 6.3 (or earlier) they will need to do a rolling upgrade to 6.4 on a non-FIPS JVM.\r\nCan they then do a rolling \"upgrade\" to a FIPS JVM while staying on 6.4?\r\n\r\nDo we have a documented upgrade to a FIPS JVM process, or are we currently targeting new installs?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412791021","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-412791021","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":412791021,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjc5MTAyMQ==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T08:12:11Z","updated_at":"2018-08-14T08:12:11Z","author_association":"CONTRIBUTOR","body":"You are right that \r\n\r\n> we do not support FIPS 140 JVMs for anything < 6.4 , means that one cannot first switch to a FIPS 140 JVM and then upgrade.\r\n\r\nwas not very clear. This is probably not the right venue for the detailed discussion about what is supported, but I haven't completed the docs to point to yet so: \r\n\r\n> If someone is on 6.3 (or earlier) they will need to do a rolling upgrade to 6.4 on a non-FIPS JVM.\r\n\r\nIf they are not on a trial license (that is they're already on platinum) they could do a rolling upgrade where each node starts after upgrade in a FIPS 140 JVM ( provided the necessary configuration changes are performed on the node before starting it, elasticsearch keystore manually recreated, jks keystrores replaced, etc ) .\r\n\r\n> Can they then do a rolling \"upgrade\" to a FIPS JVM while staying on 6.4?\r\n\r\nYes. \r\n\r\n> Do we have a documented upgrade to a FIPS JVM process, or are we currently targeting new installs?\r\n\r\nI'm in the process of writing it.\r\n\r\nTBC, the problem we're seeing in these CI failures is because a 6.3.3 node is running in a FIPS 140 JVM","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412829029","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-412829029","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":412829029,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjgyOTAyOQ==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T10:36:48Z","updated_at":"2018-08-14T10:36:48Z","author_association":"CONTRIBUTOR","body":"If my understanding is correct, removing 6.3 from bwc testing solves the problem of the failing test, but we will support users to do the rolling upgrade and enable FIPS at the same time, which would not be covered by any tests.\r\n\r\nI think we wouldn't want to mix things too much, so removing 6.3 from bwc tests when running on FIPS jvm seems like the right thing to do, this will test rolling upgrade between fips enabled versions, i.e 6.4 -> 6.5 but it also sounds to me that we would need a new FIPS specific rolling upgrade test that does include 6.3 and older to assert that any version running on non fips can be rolling upgraded to a fips enabled JVM. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413069203","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-413069203","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":413069203,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzA2OTIwMw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-08-15T01:46:19Z","updated_at":"2018-08-15T01:46:19Z","author_association":"CONTRIBUTOR","body":"> any version running on non fips can be rolling upgraded to a fips enabled JVM.\r\n\r\nIf we do this (and we should), I'd like it to include testing moving in either direction to/from FIPS on the  same ES version. I suspect those will be the most likely scenario for customers.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413069819","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-413069819","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":413069819,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzA2OTgxOQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-08-15T01:50:37Z","updated_at":"2018-08-15T01:50:47Z","author_association":"CONTRIBUTOR","body":"Conceptually this seems very similar to new JDK versions, and the BWC tests must handle that already.\r\nHow do we handle the rolling upgrade tests on Java 10? 6.2 and earlier aren't supported on Java 10. Do the rolling upgrade tests detect that and run the old nodes on Java8?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413071358","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-413071358","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":413071358,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzA3MTM1OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-08-15T02:01:11Z","updated_at":"2018-08-15T02:01:11Z","author_association":"MEMBER","body":"> How do we handle the rolling upgrade tests on Java 10? 6.2 and earlier aren't supported on Java 10. Do the rolling upgrade tests detect that and run the old nodes on Java8?\r\n\r\nYes, this is exactly what we [do](https://github.com/elastic/elasticsearch/blob/cf2295b4084e0197df73bd0b0c4bcb012e92f31c/distribution/bwc/build.gradle#L155-L164).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413143497","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-413143497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":413143497,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzE0MzQ5Nw==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-08-15T09:26:30Z","updated_at":"2018-08-15T09:26:30Z","author_association":"CONTRIBUTOR","body":"> Yes, this is exactly what we do.\r\n\r\nIIUC this sets the JAVA_VERSION so that building the distribution won't fail. What we want here is that `xxx-oldClusterTestCluster` ( since we're trying to set a keystore value when configuring it ) and `oldClusterTestRunner` Task ( which runs the version we built ) run with a non-fips JVM if the version is < 6.4. \r\n\r\nI'll give `environment('JAVA_RUNTIME_HOME', 'appropriate-non-fips-version')` for these tasks a try, unless there is another preferred way to do this (Couldn't see any existing examples)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/413188228","html_url":"https://github.com/elastic/elasticsearch/issues/32737#issuecomment-413188228","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32737","id":413188228,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMzE4ODIyOA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-08-15T12:53:01Z","updated_at":"2018-08-15T12:53:01Z","author_association":"MEMBER","body":"Sorry @jkakavas, I pointed you to the wrong place. Take a look at\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/7c0fc209bf78e4824ca1f232b84a1dab22bc2dfa/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/NodeInfo.groovy#L244-L247\r\n\r\nand\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/7c0fc209bf78e4824ca1f232b84a1dab22bc2dfa/buildSrc/src/main/groovy/org/elasticsearch/gradle/test/NodeInfo.groovy#L176-L180\r\n\r\nThis is how we ensure the right versions for Java home for the BWC nodes. We will need slightly different logic to pick up that the older nodes should run with a non-FIPS JVM.","performed_via_github_app":null}]