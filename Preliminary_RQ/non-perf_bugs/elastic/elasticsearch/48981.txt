{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48981","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48981/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48981/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48981/events","html_url":"https://github.com/elastic/elasticsearch/issues/48981","id":521487919,"node_id":"MDU6SXNzdWU1MjE0ODc5MTk=","number":48981,"title":"[Monitoring] Watches not guarding against all null values","user":{"login":"cachedout","id":111616,"node_id":"MDQ6VXNlcjExMTYxNg==","avatar_url":"https://avatars3.githubusercontent.com/u/111616?v=4","gravatar_id":"","url":"https://api.github.com/users/cachedout","html_url":"https://github.com/cachedout","followers_url":"https://api.github.com/users/cachedout/followers","following_url":"https://api.github.com/users/cachedout/following{/other_user}","gists_url":"https://api.github.com/users/cachedout/gists{/gist_id}","starred_url":"https://api.github.com/users/cachedout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cachedout/subscriptions","organizations_url":"https://api.github.com/users/cachedout/orgs","repos_url":"https://api.github.com/users/cachedout/repos","events_url":"https://api.github.com/users/cachedout/events{/privacy}","received_events_url":"https://api.github.com/users/cachedout/received_events","type":"User","site_admin":false},"labels":[{"id":912834056,"node_id":"MDU6TGFiZWw5MTI4MzQwNTY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Monitoring","name":":Core/Features/Monitoring","color":"0e8a16","default":false,"description":""},{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"cachedout","id":111616,"node_id":"MDQ6VXNlcjExMTYxNg==","avatar_url":"https://avatars3.githubusercontent.com/u/111616?v=4","gravatar_id":"","url":"https://api.github.com/users/cachedout","html_url":"https://github.com/cachedout","followers_url":"https://api.github.com/users/cachedout/followers","following_url":"https://api.github.com/users/cachedout/following{/other_user}","gists_url":"https://api.github.com/users/cachedout/gists{/gist_id}","starred_url":"https://api.github.com/users/cachedout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cachedout/subscriptions","organizations_url":"https://api.github.com/users/cachedout/orgs","repos_url":"https://api.github.com/users/cachedout/repos","events_url":"https://api.github.com/users/cachedout/events{/privacy}","received_events_url":"https://api.github.com/users/cachedout/received_events","type":"User","site_admin":false},"assignees":[{"login":"cachedout","id":111616,"node_id":"MDQ6VXNlcjExMTYxNg==","avatar_url":"https://avatars3.githubusercontent.com/u/111616?v=4","gravatar_id":"","url":"https://api.github.com/users/cachedout","html_url":"https://github.com/cachedout","followers_url":"https://api.github.com/users/cachedout/followers","following_url":"https://api.github.com/users/cachedout/following{/other_user}","gists_url":"https://api.github.com/users/cachedout/gists{/gist_id}","starred_url":"https://api.github.com/users/cachedout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cachedout/subscriptions","organizations_url":"https://api.github.com/users/cachedout/orgs","repos_url":"https://api.github.com/users/cachedout/repos","events_url":"https://api.github.com/users/cachedout/events{/privacy}","received_events_url":"https://api.github.com/users/cachedout/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-11-12T11:17:12Z","updated_at":"2019-11-12T22:01:29Z","closed_at":"2019-11-12T19:06:11Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Using the default monitoring watches, users report that occasionally an error similar to the following is logged:\r\n\r\n```\r\n[es/i-1/es.log] [2019-10-15T00:00:20,089][ERROR][org.elasticsearch.xpack.watcher.transform.script.ExecutableScriptTransform] [instance-0000000001] failed to execute [script] transform for [YUbZjlbDSl-JSV1-XZpICQ_elasticsearch_cluster_status_eabb3c24-1fca-46e8-92ea-04ffe926e15c-2019-10-15T00:00:19.596289Z]\r\norg.elasticsearch.script.ScriptException: runtime error\r\n        at org.elasticsearch.painless.PainlessScript.convertToScriptException(PainlessScript.java:94) ~[?:?]\r\n        at org.elasticsearch.painless.PainlessScript$Script.execute(ctx.vars.email_recipient = (ctx.payload.kibana_settings.hits.total > 0 && ctx.payload.kibana_settings.hits.hits[0]._source.kibana_settings.xpack != null) ? ctx.payload.kibana_settings.hits.hits[0]._source.kibana_settings.xpack.default_admin_email : null;ct ...:1152) ~[?:?]\r\n        at org.elasticsearch.xpack.watcher.transform.script.ExecutableScriptTransform.doExecute(ExecutableScriptTransform.java:49) ~[x-pack-watcher-7.2.0.jar:7.2.0]\r\n        at org.elasticsearch.xpack.watcher.transform.script.ExecutableScriptTransform.execute(ExecutableScriptTransform.java:38) [x-pack-watcher-7.2.0.jar:7.2.0]\r\n        at org.elasticsearch.xpack.watcher.transform.script.ExecutableScriptTransform.execute(ExecutableScriptTransform.java:23) [x-pack-watcher-7.2.0.jar:7.2.0]\r\n        at org.elasticsearch.xpack.watcher.execution.ExecutionService.executeInner(ExecutionService.java:505) [x-pack-watcher-7.2.0.jar:7.2.0]\r\n        at org.elasticsearch.xpack.watcher.execution.ExecutionService.execute(ExecutionService.java:309) [x-pack-watcher-7.2.0.jar:7.2.0]\r\n        at org.elasticsearch.xpack.watcher.execution.ExecutionService.lambda$executeAsync$5(ExecutionService.java:410) [x-pack-watcher-7.2.0.jar:7.2.0]\r\n        at org.elasticsearch.xpack.watcher.execution.ExecutionService$WatchExecutionTask.run(ExecutionService.java:605) [x-pack-watcher-7.2.0.jar:7.2.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:688) [elasticsearch-7.2.0.jar:7.2.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n        at java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: java.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0\r\n        at jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64) ~[?:?]\r\n        at jdk.internal.util.Preconditions.outOfBoundsCheckIndex(Preconditions.java:70) ~[?:?]\r\n        at jdk.internal.util.Preconditions.checkIndex(Preconditions.java:248) ~[?:?]\r\n        at java.util.Objects.checkIndex(Objects.java:372) ~[?:?]\r\n        at java.util.ArrayList.get(ArrayList.java:458) ~[?:?]\r\n        at org.elasticsearch.painless.PainlessScript$Script.execute(ctx.vars.email_recipient = (ctx.payload.kibana_settings.hits.total > 0 && ctx.payload.kibana_settings.hits.hits[0]._source.kibana_settings.xpack != null) ? ctx.payload.kibana_settings.hits.hits[0]._source.kibana_settings.xpack.default_admin_email : null;ct ...:429) ~[?:?]\r\n        ... 11 more\r\n```\r\n\r\nIt appears as though there is a bug in the painless script somewhere wherein we are not properly checking for empty lists. Investigation has not yet surfaced an exact location in the script for this problem, however. This issue is being filed to track further investigation of this bug and to add better safety checks to the script for empty values.","closed_by":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}