{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17578","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17578/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17578/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17578/events","html_url":"https://github.com/elastic/elasticsearch/issues/17578","id":146475965,"node_id":"MDU6SXNzdWUxNDY0NzU5NjU=","number":17578,"title":"Incomplete results when using geo_distance for large distances","user":{"login":"jweber","id":61980,"node_id":"MDQ6VXNlcjYxOTgw","avatar_url":"https://avatars0.githubusercontent.com/u/61980?v=4","gravatar_id":"","url":"https://api.github.com/users/jweber","html_url":"https://github.com/jweber","followers_url":"https://api.github.com/users/jweber/followers","following_url":"https://api.github.com/users/jweber/following{/other_user}","gists_url":"https://api.github.com/users/jweber/gists{/gist_id}","starred_url":"https://api.github.com/users/jweber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jweber/subscriptions","organizations_url":"https://api.github.com/users/jweber/orgs","repos_url":"https://api.github.com/users/jweber/repos","events_url":"https://api.github.com/users/jweber/events{/privacy}","received_events_url":"https://api.github.com/users/jweber/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":396750536,"node_id":"MDU6TGFiZWwzOTY3NTA1MzY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.0.0-alpha5","name":"v5.0.0-alpha5","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"assignees":[{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false}],"milestone":null,"comments":10,"created_at":"2016-04-07T00:43:41Z","updated_at":"2017-05-09T08:16:12Z","closed_at":"2016-07-08T17:15:10Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.2.2, 2.3.1, 5.0.0-alpha1\n\n**JVM version**: 1.7.0_95 (Ubuntu 14.04), 1.8.0_77 (Windows 8.1)\n\n**Description of the problem including expected versus actual behavior**:\nStarting with version 2.2.2, using the _geo_distance_ query does not appear to be accurate when using large distance values. In the included reproduction, documents are added that are placed from 1 to 10,000 miles away from the point at _47.60621, -122.33207_. Executing a query for matches up to 10,000 miles away only returns the documents from 1 to 5,000 miles away.\n\nIf I profile the query, it appears that somewhere around a 6,000mi distance, the bounding box generated by the GeoPointDistanceQueryImpl query maxes out at Lower Left: [-180.0,-37.181370025500655] Upper Right: [180.0,90.0]. It also appears that the max distance in the _geo_distance_ query becomes less the closer to a pole that you get.\n\nRunning the same test with 2.1.2 returns all expected results up to 10,000 miles away.\n\n``` bash\ncurl -XDELETE localhost:9200/distance-test\n\ncurl -XPUT localhost:9200/distance-test -d '{\n    \"settings\": {\n        \"number_of_shards\": 1,\n        \"number_of_replicas\": 0,\n        \"index.queries.cache.type\": \"none\"\n    }\n}'\n\ncurl -XPUT localhost:9200/distance-test/document/_mapping -d '{\n    \"properties\": {\n        \"name\": {\n            \"type\": \"string\"\n        },\n        \"location\": {\n            \"type\": \"geo_point\",\n            \"lat_lon\": true\n        }\n    }\n}'\n\ncurl -XPUT localhost:9200/distance-test/document/_bulk -d '{ \"index\": { \"_id\": 1 } }\n{ \"name\": \"1 mile\", \"location\": \"47.606208, -122.310628\" }\n{ \"index\": { \"_id\": 2 } }\n{ \"name\": \"10 miles\", \"location\": \"47.60601, -122.117647\" }\n{ \"index\": { \"_id\": 3 } }\n{ \"name\": \"100 miles\", \"location\": \"47.586236, -120.188375\" }\n{ \"index\": { \"_id\": 4 } }\n{ \"name\": \"1000 miles\", \"location\": \"45.654944, -101.405702\" }\n{ \"index\": { \"_id\": 5 } }\n{ \"name\": \"2000 miles\", \"location\": \"40.275895, -83.006558\" }\n{ \"index\": { \"_id\": 6 } }\n{ \"name\": \"3000 miles\", \"location\": \"32.469747, -67.847419\" }\n{ \"index\": { \"_id\": 7 } }\n{ \"name\": \"4000 miles\", \"location\": \"23.156323, -55.315033\" }\n{ \"index\": { \"_id\": 8 } }\n{ \"name\": \"5000 miles\", \"location\": \"12.986677, -44.486196\" }\n{ \"index\": { \"_id\": 9 } }\n{ \"name\": \"6000 miles\", \"location\": \"2.40577, -34.530192\" }\n{ \"index\": { \"_id\": 10 } }\n{ \"name\": \"7000 miles\", \"location\": \"-8.24639, -24.729009\" }\n{ \"index\": { \"_id\": 11 } }\n{ \"name\": \"8000 miles\", \"location\": \"-18.648019, -14.38816\" }\n{ \"index\": { \"_id\": 12 } }\n{ \"name\": \"9000 miles\", \"location\": \"-28.413215, -2.7355\" }\n{ \"index\": { \"_id\": 13 } }\n{ \"name\": \"10000 miles\", \"location\": \"-36.996556, 11.128372\" }\n'\n```\n\nSearch query:\n\n``` http\nGET localhost:9200/distance-test/document/_search \n{\n    \"size\": 0,\n    \"from\": 0,\n    \"profile\": true,\n    \"_source\": [\"name\"],\n    \"query\": {\n        \"geo_distance\": {\n            \"distance\": \"10000mi\",\n            \"location\": \"47.60621, -122.33207\"\n        }\n    },\n    \"sort\": [{\n        \"_geo_distance\": {\n            \"location\": \"47.60621, -122.33207\",\n            \"order\": \"desc\",\n            \"unit\": \"mi\"\n        }\n    }]\n}\n```\n","closed_by":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"performed_via_github_app":null}