{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32395","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32395/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32395/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32395/events","html_url":"https://github.com/elastic/elasticsearch/issues/32395","id":344816938,"node_id":"MDU6SXNzdWUzNDQ4MTY5Mzg=","number":32395,"title":"Exception when using source filtering on a large integer field","user":{"login":"ohadravid","id":2358365,"node_id":"MDQ6VXNlcjIzNTgzNjU=","avatar_url":"https://avatars3.githubusercontent.com/u/2358365?v=4","gravatar_id":"","url":"https://api.github.com/users/ohadravid","html_url":"https://github.com/ohadravid","followers_url":"https://api.github.com/users/ohadravid/followers","following_url":"https://api.github.com/users/ohadravid/following{/other_user}","gists_url":"https://api.github.com/users/ohadravid/gists{/gist_id}","starred_url":"https://api.github.com/users/ohadravid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ohadravid/subscriptions","organizations_url":"https://api.github.com/users/ohadravid/orgs","repos_url":"https://api.github.com/users/ohadravid/repos","events_url":"https://api.github.com/users/ohadravid/events{/privacy}","received_events_url":"https://api.github.com/users/ohadravid/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"assignees":[{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2018-07-26T12:09:18Z","updated_at":"2018-09-26T18:24:32Z","closed_at":"2018-09-26T18:24:32Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.3.1 using the official docker image\r\n\r\n**Plugins installed**: []\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen indexing a document with a large integer field as (with `keyword` mappings`, querying fails with an error when using source filtering.\r\nThis seems a bit similar to #31853, but different enough that I thought I should open an issue.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Using the official Elasticsearch package in python:\r\n```python\r\nes.indices.create('test-index')\r\nes.indices.put_mapping(doc_type='doc', index='test-index', body={\r\n    'properties': {\r\n        'offset': {\r\n            'type': 'keyword'\r\n        }\r\n    }\r\n})\r\nes.index('test-index', 'doc', {'offset': 2 ** 2500})\r\n```\r\n\r\n 2. While a regular query works as expected:\r\n```python\r\n>>> es.search(index='test-index', body={\r\n    'query': {'match_all': {}}, \r\n    'size': 10\r\n})\r\n\r\n{ 'hits': { 'hits': [ '_source': {'offset': 37....} ...}\r\n```\r\n\r\nUsing source-filtering will result in an exception:\r\n\r\n```python\r\n>>> es.search(index='test-index', body={\r\n    '_source': ['offset'], \r\n    'query': {'match_all': {}}, \r\n    'size': 10\r\n})\r\n\r\n{'_shards': {'failed': 1,\r\n  'failures': [{'index': 'test-index',\r\n    'node': 'G2YpLXsGTNGrEphsO5SASQ',\r\n    'reason': {'reason': 'cannot write xcontent for unknown value of type class java.math.BigInteger',\r\n     'type': 'illegal_argument_exception'},\r\n    'shard': 1}],\r\n  'skipped': 0,\r\n  'successful': 4,\r\n  'total': 5},\r\n 'hits': {'hits': [], 'max_score': 1.0, 'total': 1},\r\n 'timed_out': False,\r\n 'took': 8}\r\n```\r\n\r\n(Using `'_source': ['*']` will result in the same error)\r\n\r\n**Provide logs (if relevant)**:\r\nWhen using a **scroll** query, the server log shows the following error:\r\n```bash\r\n[2018-07-26T07:05:35,682][DEBUG][o.e.a.s.TransportSearchScrollAction] [server-name] [157387] Failed to execute fetch phase\r\norg.elasticsearch.transport.RemoteTransportException: [server-name][10.0.0.7:9300][indices:data/read/search[phase/fetch/id/scroll]]\r\nCaused by: java.lang.IllegalArgumentException: cannot write xcontent for unknown value of type class java.math.BigInteger\r\n       at org.elasticsearch.common.xcontent.XContentBuilder.unknownValue(XContentBuilder.java:755) ~[elasticsearch-x-content-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.xcontent.XContentBuilder.map(XContentBuilder.java:810) ~[elasticsearch-x-content-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.xcontent.XContentBuilder.unknownValue(XContentBuilder.java:744) ~[elasticsearch-x-content-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.xcontent.XContentBuilder.value(XContentBuilder.java:837) ~[elasticsearch-x-content-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.xcontent.XContentBuilder.unknownValue(XContentBuilder.java:746) ~[elasticsearch-x-content-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.xcontent.XContentBuilder.map(XContentBuilder.java:810) ~[elasticsearch-x-content-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.xcontent.XContentBuilder.unknownValue(XContentBuilder.java:744) ~[elasticsearch-x-content-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.xcontent.XContentBuilder.value(XContentBuilder.java:726) ~[elasticsearch-x-content-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.search.fetch.subphase.FetchSourceSubPhase.hitExecute(FetchSourceSubPhase.java:65) ~[elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:162) ~[elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.search.SearchService.executeFetchPhase(SearchService.java:516) ~[elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.action.search.SearchTransportService$10.messageReceived(SearchTransportService.java:430) ~[elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.action.search.SearchTransportService$10.messageReceived(SearchTransportService.java:427) ~[elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.transport.TransportService$7.doRun(TransportService.java:664) [elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:725) [elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) [elasticsearch-6.3.1.jar:6.3.1]\r\n       at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.3.1.jar:6.3.1]\r\n       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) [?:?]\r\n       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) [?:?]\r\n       at java.lang.Thread.run(Thread.java:844) [?:?]\r\n```\r\n","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}