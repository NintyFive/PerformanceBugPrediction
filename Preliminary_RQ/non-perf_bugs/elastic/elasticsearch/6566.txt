{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6566","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6566/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6566/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6566/events","html_url":"https://github.com/elastic/elasticsearch/issues/6566","id":36084111,"node_id":"MDU6SXNzdWUzNjA4NDExMQ==","number":6566,"title":"Mappings: Add transform to document before index","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2014-06-19T14:37:40Z","updated_at":"2014-07-16T09:46:42Z","closed_at":"2014-07-15T16:50:58Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Edit for posterity**: this is being implemented as source transforms rather than conditional copy_to in #6599.  See comments below for why.\n\nIt'd be useful to be able to condition whether or not something is copied to another field based on some field in the document.  Something like:\n\n``` js\n{\n  \"foo\": {\n    \"type\": \"string\",\n    \"copy_to\": {\n      \"script\": \"\nif _source['bar'] in [0, 100, 132]\n  return 'suggest';\nend\n\"\n    }\n  },\n  \"suggest\": {\n    \"type\": \"string\",\n    \"analyzer\": \"suggest\"\n  },\n  \"bar\": {\n    \"type\": \"integer\"\n  }\n}\n```\n\nI could do this when I build the document but that is inconvenient because for me building the document about two orders of magnitude slower then rebuilding the index by copying data from Elasticsearch to itself.  It'd also end up adding text to the _source twice which is less then ideal. \n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}