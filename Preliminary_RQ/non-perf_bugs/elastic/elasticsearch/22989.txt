{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22989/events","html_url":"https://github.com/elastic/elasticsearch/issues/22989","id":205504699,"node_id":"MDU6SXNzdWUyMDU1MDQ2OTk=","number":22989,"title":"Wildcard search with special characters: Differences between ES 2.x and 5.x","user":{"login":"mweibel","id":307427,"node_id":"MDQ6VXNlcjMwNzQyNw==","avatar_url":"https://avatars1.githubusercontent.com/u/307427?v=4","gravatar_id":"","url":"https://api.github.com/users/mweibel","html_url":"https://github.com/mweibel","followers_url":"https://api.github.com/users/mweibel/followers","following_url":"https://api.github.com/users/mweibel/following{/other_user}","gists_url":"https://api.github.com/users/mweibel/gists{/gist_id}","starred_url":"https://api.github.com/users/mweibel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mweibel/subscriptions","organizations_url":"https://api.github.com/users/mweibel/orgs","repos_url":"https://api.github.com/users/mweibel/repos","events_url":"https://api.github.com/users/mweibel/events{/privacy}","received_events_url":"https://api.github.com/users/mweibel/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2017-02-06T07:20:53Z","updated_at":"2019-05-27T11:39:21Z","closed_at":"2019-05-27T11:39:20Z","author_association":"NONE","active_lock_reason":null,"body":"I'm in the process of upgrading a project from ES 1.7 to ES 5.1 and noticed an integration test failing. After testing I made sure that the actual change happens between 2.x and 5.x. \r\nBelow is a minimal repro case.\r\n\r\nWhen searching using a wildcard search for \"brö\" I get in both versions the same result. When searching using \"brö{\\\"/)?\" which gets escaped as \"brö\\{\\\\\\\\\"\\/\\)\", I get 2 results in ES 2.x and no results in ES 5.x.\r\n\r\nI searched breaking changes of ES 2.x and ES 5.x but could not find anything related to that. Also searched for new query string search settings which could help in that regard but couldn't find it either.\r\nAlso I opened first a forum post with the same details: https://discuss.elastic.co/t/wildcard-search-with-special-characters-differences-between-es-1-7-and-es-5-1/73720/1\r\n\r\n## How to reproduce\r\n\r\n### ES 5 index creation\r\n\r\n```\r\ncurl -X PUT 'http://localhost:9200/testwildcard' -d '{\r\n  \"mappings\": {\r\n    \"testwildcard\": {\r\n      \"properties\": {\r\n        \"name\": {\r\n          \"type\": \"keyword\",\r\n          \"fields\": {\r\n            \"search\": {\r\n              \"type\": \"text\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n```\r\n\r\n### ES 2.x index creation\r\n\r\n```\r\ncurl -XPUT 'http://localhost:9200/testwildcard' -d '{\r\n  \"mappings\": {\r\n    \"testwildcard\": {\r\n      \"properties\": {\r\n        \"name\": {\r\n          \"type\": \"string\",\r\n          \"index\": \"not_analyzed\",\r\n          \"fields\": {\r\n            \"search\": {\r\n              \"type\": \"string\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n```\r\n\r\n### Insert data\r\n\r\n```\r\ncurl -XPUT 'http://localhost:9200/testwildcard/testwildcard/1' -d '{\r\n \"name\": \"Brötchen\"\r\n}'\r\n\r\ncurl -XPUT 'http://localhost:9200/testwildcard/testwildcard/2' -d '{\r\n \"name\": \"Frischbackbrötchen\"\r\n}'\r\n\r\ncurl -XPUT 'http://localhost:9200/testwildcard/testwildcard/3' -d '{\r\n \"name\": \"Brot\"\r\n}'\r\n```\r\n\r\n### works in both ES 2.x and ES 5.1:\r\n\r\n```\r\ncurl -XPOST 'http://localhost:9200/testwildcard/_search' -d '{\r\n  \"explain\": true,\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"query\": \"name.search:*brö*\",\r\n      \"analyze_wildcard\": true,\r\n      \"default_operator\": \"AND\"\r\n    }\r\n  }\r\n}'\r\n```\r\n\r\n### doesn't work in ES 5.1 but works in ES 2.x:\r\n\r\n```\r\ncurl -XPOST 'http://localhost:9200/testwildcard/_search' -d '{\r\n  \"explain\": true,\r\n  \"query\": {\r\n    \"query_string\": {\r\n      \"query\": \"name.search:*brö\\\\{\\\\\\\\\\\\\\\"\\\\/\\\\)*\",\r\n      \"analyze_wildcard\": true,\r\n      \"default_operator\": \"AND\"\r\n    }\r\n  }\r\n}'\r\n```","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}