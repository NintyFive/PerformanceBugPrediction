[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87807286","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-87807286","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":87807286,"node_id":"MDEyOklzc3VlQ29tbWVudDg3ODA3Mjg2","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-03-30T19:53:17Z","updated_at":"2015-03-30T19:53:17Z","author_association":"MEMBER","body":"@EikeDehling can you enable debug logging for `indices.cluster` and grep the logs for the output of this line? I want to see what the difference is between the two sources . A gist will be great.\n\n```\nlogger.debug(\"[{}] parsed mapping [{}], and got different sources\\noriginal:\\n{}\\nparsed:\\n{}\", index, mappingType, mappingSource, mapperService.documentMapper(mappingType).mappingSource());\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87997308","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-87997308","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":87997308,"node_id":"MDEyOklzc3VlQ29tbWVudDg3OTk3MzA4","user":{"login":"EikeDehling","id":11720247,"node_id":"MDQ6VXNlcjExNzIwMjQ3","avatar_url":"https://avatars3.githubusercontent.com/u/11720247?v=4","gravatar_id":"","url":"https://api.github.com/users/EikeDehling","html_url":"https://github.com/EikeDehling","followers_url":"https://api.github.com/users/EikeDehling/followers","following_url":"https://api.github.com/users/EikeDehling/following{/other_user}","gists_url":"https://api.github.com/users/EikeDehling/gists{/gist_id}","starred_url":"https://api.github.com/users/EikeDehling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EikeDehling/subscriptions","organizations_url":"https://api.github.com/users/EikeDehling/orgs","repos_url":"https://api.github.com/users/EikeDehling/repos","events_url":"https://api.github.com/users/EikeDehling/events{/privacy}","received_events_url":"https://api.github.com/users/EikeDehling/received_events","type":"User","site_admin":false},"created_at":"2015-03-31T08:43:42Z","updated_at":"2015-03-31T08:43:42Z","author_association":"CONTRIBUTOR","body":"@bleskes Thanks for the quick reponse!\n\nGist here: https://gist.github.com/EikeDehling/129aa3f8213ad8552f49\n\nThe difference in mapping appears to be in nested elements, apparently they are not ordered alphbetically? The difference in serialisation is under posting.properties.body.fields._text_.fielddata , there entries there are ordered differently in the original/parsed version.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88187224","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88187224","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88187224,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MTg3MjI0","user":{"login":"EikeDehling","id":11720247,"node_id":"MDQ6VXNlcjExNzIwMjQ3","avatar_url":"https://avatars3.githubusercontent.com/u/11720247?v=4","gravatar_id":"","url":"https://api.github.com/users/EikeDehling","html_url":"https://github.com/EikeDehling","followers_url":"https://api.github.com/users/EikeDehling/followers","following_url":"https://api.github.com/users/EikeDehling/following{/other_user}","gists_url":"https://api.github.com/users/EikeDehling/gists{/gist_id}","starred_url":"https://api.github.com/users/EikeDehling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EikeDehling/subscriptions","organizations_url":"https://api.github.com/users/EikeDehling/orgs","repos_url":"https://api.github.com/users/EikeDehling/repos","events_url":"https://api.github.com/users/EikeDehling/events{/privacy}","received_events_url":"https://api.github.com/users/EikeDehling/received_events","type":"User","site_admin":false},"created_at":"2015-03-31T17:52:13Z","updated_at":"2015-03-31T17:52:13Z","author_association":"CONTRIBUTOR","body":"This gist is a bit easier to read:\n\nhttps://gist.github.com/EikeDehling/fc1289cc443b7acdc3f4\n\nThe issue is under the key `posting.properties.body.fields._text_.fielddata` : Ordering is different for the original/parsed mapping.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88218410","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88218410","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88218410,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MjE4NDEw","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-03-31T19:27:29Z","updated_at":"2015-03-31T19:27:29Z","author_association":"MEMBER","body":"@EikeDehling thx for that. It's accurate. The problem lies in the way the field data settings are rendered:\n\nhttps://github.com/elastic/elasticsearch/blob/master/src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java#L756\n\n```\nbuilder.field(\"fielddata\", (Map) fieldDataType.getSettings().getAsMap());\n```\n\nThe order of the keys in that map is arbitrary (practically). It may be different between master and nodes causing this endless loop.\n\nTo work around this, you can set `indices.cluster.send_refresh_mapping` to false (requires node restart). This will disable the sending of mapping refresh instructions. You must remember to remove this settings before you upgrade to the next ES version, which will have a fix for this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88220290","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88220290","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88220290,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MjIwMjkw","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-03-31T19:36:04Z","updated_at":"2015-03-31T19:36:04Z","author_association":"MEMBER","body":"@EikeDehling do you run on Java8 by any chance? (wondering to better understand how frequently this can happen)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88391557","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88391557","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88391557,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MzkxNTU3","user":{"login":"EikeDehling","id":11720247,"node_id":"MDQ6VXNlcjExNzIwMjQ3","avatar_url":"https://avatars3.githubusercontent.com/u/11720247?v=4","gravatar_id":"","url":"https://api.github.com/users/EikeDehling","html_url":"https://github.com/EikeDehling","followers_url":"https://api.github.com/users/EikeDehling/followers","following_url":"https://api.github.com/users/EikeDehling/following{/other_user}","gists_url":"https://api.github.com/users/EikeDehling/gists{/gist_id}","starred_url":"https://api.github.com/users/EikeDehling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EikeDehling/subscriptions","organizations_url":"https://api.github.com/users/EikeDehling/orgs","repos_url":"https://api.github.com/users/EikeDehling/repos","events_url":"https://api.github.com/users/EikeDehling/events{/privacy}","received_events_url":"https://api.github.com/users/EikeDehling/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T08:25:01Z","updated_at":"2015-04-01T08:25:01Z","author_association":"CONTRIBUTOR","body":"We're running Java7, 1.7.0_45\n\nThanks for the tip about settings.\n\nI also found that line of code indeed, i'll try and make a patch/test.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88393428","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88393428","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88393428,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MzkzNDI4","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T08:32:54Z","updated_at":"2015-04-01T08:32:54Z","author_association":"MEMBER","body":"Cool. If you wait an hour or two, I’ll probably make a PR with a fix.\n\n> On 01 Apr 2015, at 10:25, EikeDehling notifications@github.com wrote:\n> \n> We're running Java7, 1.7.0_45\n> \n> Thanks for the tip about settings.\n> \n> I also found that line of code indeed, i'll try and make a patch/test.\n> \n> —\n> Reply to this email directly or view it on GitHub.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88397289","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88397289","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88397289,"node_id":"MDEyOklzc3VlQ29tbWVudDg4Mzk3Mjg5","user":{"login":"EikeDehling","id":11720247,"node_id":"MDQ6VXNlcjExNzIwMjQ3","avatar_url":"https://avatars3.githubusercontent.com/u/11720247?v=4","gravatar_id":"","url":"https://api.github.com/users/EikeDehling","html_url":"https://github.com/EikeDehling","followers_url":"https://api.github.com/users/EikeDehling/followers","following_url":"https://api.github.com/users/EikeDehling/following{/other_user}","gists_url":"https://api.github.com/users/EikeDehling/gists{/gist_id}","starred_url":"https://api.github.com/users/EikeDehling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EikeDehling/subscriptions","organizations_url":"https://api.github.com/users/EikeDehling/orgs","repos_url":"https://api.github.com/users/EikeDehling/repos","events_url":"https://api.github.com/users/EikeDehling/events{/privacy}","received_events_url":"https://api.github.com/users/EikeDehling/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T08:45:12Z","updated_at":"2015-04-01T09:31:54Z","author_association":"CONTRIBUTOR","body":"This is my initial patch+unit test, happy to compare to what you're producing. Sorry, i'm not that handy with github/PR's yet.\n\nhttps://gist.github.com/EikeDehling/2e34a78a54de646b71ca\n\nAny chance there will also be a 1.4 release with a fix?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88410704","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88410704","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88410704,"node_id":"MDEyOklzc3VlQ29tbWVudDg4NDEwNzA0","user":{"login":"wkoot","id":3715211,"node_id":"MDQ6VXNlcjM3MTUyMTE=","avatar_url":"https://avatars0.githubusercontent.com/u/3715211?v=4","gravatar_id":"","url":"https://api.github.com/users/wkoot","html_url":"https://github.com/wkoot","followers_url":"https://api.github.com/users/wkoot/followers","following_url":"https://api.github.com/users/wkoot/following{/other_user}","gists_url":"https://api.github.com/users/wkoot/gists{/gist_id}","starred_url":"https://api.github.com/users/wkoot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wkoot/subscriptions","organizations_url":"https://api.github.com/users/wkoot/orgs","repos_url":"https://api.github.com/users/wkoot/repos","events_url":"https://api.github.com/users/wkoot/events{/privacy}","received_events_url":"https://api.github.com/users/wkoot/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T09:24:24Z","updated_at":"2015-04-01T09:24:24Z","author_association":"NONE","body":"@bleskes You said that the `indices.cluster.send_refresh_mapping` requires node restart, what would the effect be if you only have a few (say half of) the nodes which have this setting set to false?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88412352","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88412352","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88412352,"node_id":"MDEyOklzc3VlQ29tbWVudDg4NDEyMzUy","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T09:28:23Z","updated_at":"2015-04-01T09:28:23Z","author_association":"MEMBER","body":"Then the other half might still send refresh mapping to the master. You need it on all data nodes. But you can do a rolling restart, one by one.\n\n> On 01 Apr 2015, at 11:24, wkoot notifications@github.com wrote:\n> \n> @bleskes You said that the indices.cluster.send_refresh_mapping requires node restart, what would the effect be if you only have a few (say half of) the nodes which have this setting set to false?\n> \n> —\n> Reply to this email directly or view it on GitHub.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88418239","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88418239","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88418239,"node_id":"MDEyOklzc3VlQ29tbWVudDg4NDE4MjM5","user":{"login":"EikeDehling","id":11720247,"node_id":"MDQ6VXNlcjExNzIwMjQ3","avatar_url":"https://avatars3.githubusercontent.com/u/11720247?v=4","gravatar_id":"","url":"https://api.github.com/users/EikeDehling","html_url":"https://github.com/EikeDehling","followers_url":"https://api.github.com/users/EikeDehling/followers","following_url":"https://api.github.com/users/EikeDehling/following{/other_user}","gists_url":"https://api.github.com/users/EikeDehling/gists{/gist_id}","starred_url":"https://api.github.com/users/EikeDehling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EikeDehling/subscriptions","organizations_url":"https://api.github.com/users/EikeDehling/orgs","repos_url":"https://api.github.com/users/EikeDehling/repos","events_url":"https://api.github.com/users/EikeDehling/events{/privacy}","received_events_url":"https://api.github.com/users/EikeDehling/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T09:47:52Z","updated_at":"2015-04-01T09:47:52Z","author_association":"CONTRIBUTOR","body":"I am trying this fix in our staging environment, i'll let you know if that fixes the issue.\n\nhttps://github.com/EikeDehling/elasticsearch/commit/cc79d71bbc4d55cb12a50df2acc67ca6ba4ac5dc\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88448217","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88448217","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88448217,"node_id":"MDEyOklzc3VlQ29tbWVudDg4NDQ4MjE3","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T11:43:51Z","updated_at":"2015-04-01T11:43:51Z","author_association":"MEMBER","body":"@EikeDehling looks good can you make a PR ? see https://www.elastic.co/contributing-to-elasticsearch . Also it would be great if you simplify the test and add random keys (but we can iterate on the PR). \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/88512526","html_url":"https://github.com/elastic/elasticsearch/issues/10318#issuecomment-88512526","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10318","id":88512526,"node_id":"MDEyOklzc3VlQ29tbWVudDg4NTEyNTI2","user":{"login":"EikeDehling","id":11720247,"node_id":"MDQ6VXNlcjExNzIwMjQ3","avatar_url":"https://avatars3.githubusercontent.com/u/11720247?v=4","gravatar_id":"","url":"https://api.github.com/users/EikeDehling","html_url":"https://github.com/EikeDehling","followers_url":"https://api.github.com/users/EikeDehling/followers","following_url":"https://api.github.com/users/EikeDehling/following{/other_user}","gists_url":"https://api.github.com/users/EikeDehling/gists{/gist_id}","starred_url":"https://api.github.com/users/EikeDehling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EikeDehling/subscriptions","organizations_url":"https://api.github.com/users/EikeDehling/orgs","repos_url":"https://api.github.com/users/EikeDehling/repos","events_url":"https://api.github.com/users/EikeDehling/events{/privacy}","received_events_url":"https://api.github.com/users/EikeDehling/received_events","type":"User","site_admin":false},"created_at":"2015-04-01T14:52:53Z","updated_at":"2015-04-01T14:52:53Z","author_association":"CONTRIBUTOR","body":"I made a PR, and afterwards signed the contributor license, i hope that's ok.\n\nI randomized the test and simplified a bit, happy to hear suggestions for improvements.\n","performed_via_github_app":null}]