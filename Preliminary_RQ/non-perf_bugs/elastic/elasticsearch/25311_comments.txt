[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311275270","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-311275270","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":311275270,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTI3NTI3MA==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2017-06-27T07:23:18Z","updated_at":"2017-06-27T07:23:18Z","author_association":"MEMBER","body":"We have another test failure in [build 1172](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=fedora/1172/console):\r\n\r\n```\r\nERROR   0.77s | FullClusterRestartIT.testSearch <<< FAILURES!\r\n   > Throwable #1: java.lang.NullPointerException\r\n   > \tat __randomizedtesting.SeedInfo.seed([EC77F0A9E127324E:7ECE65FCA53E6AE1]:0)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:482)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:696)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.assertUpgradeWorks(FullClusterRestartIT.java:479)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.testSearch(FullClusterRestartIT.java:156)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nIt is not reproducible locally so I conclude it is timing-related and the API endpoint does not always return data for the index that is checked in the predicate.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311295294","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-311295294","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":311295294,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTI5NTI5NA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-27T08:51:01Z","updated_at":"2017-06-27T08:51:01Z","author_association":"MEMBER","body":"That upgrade status should always return data for the index in that test, regardles whether an upgrade did actually run. I'll add some more logging. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311301608","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-311301608","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":311301608,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTMwMTYwOA==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2017-06-27T09:16:38Z","updated_at":"2017-06-27T10:32:37Z","author_association":"MEMBER","body":"We've just had more failures in \r\n\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-intake/1491/consoleFull\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+aggressive-opts/309/console\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=debian/1173/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311336678","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-311336678","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":311336678,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTMzNjY3OA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-27T11:58:33Z","updated_at":"2017-06-27T11:58:33Z","author_association":"MEMBER","body":"These failures didn't yet have the extra logging I added.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311776003","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-311776003","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":311776003,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTc3NjAwMw==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2017-06-28T20:15:38Z","updated_at":"2017-06-28T20:15:38Z","author_association":"MEMBER","body":"Another failure https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=debian/1181/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311919471","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-311919471","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":311919471,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTkxOTQ3MQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-29T09:54:37Z","updated_at":"2017-06-29T09:54:37Z","author_association":"MEMBER","body":"Another failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+bwc-tests/107/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312573629","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-312573629","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":312573629,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjU3MzYyOQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-07-03T07:47:10Z","updated_at":"2017-07-03T07:47:10Z","author_association":"MEMBER","body":"Failures occurred over the weekend:\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-intake/1525/console\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+bwc-tests/113/console\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/3385/console\r\n\r\nI think the upgrade status api was reporting incorrect stats because a refresh may not have occurred yet. I'll make sure a refresh is ran after the upgrade. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312812973","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-312812973","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":312812973,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjgxMjk3Mw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-04T08:19:37Z","updated_at":"2017-07-04T08:19:37Z","author_association":"MEMBER","body":"Another failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+bwc-tests/122 .\r\nSeems like the additional refresh call didn't help. \r\n\r\n```\r\n2> REPRODUCE WITH: gradle :qa:full-cluster-restart:v5.1.1#upgradedClusterTestRunner -Dtests.seed=51FA4D6D953D9A54 -Dtests.class=org.elasticsearch.upgrades.FullClusterRestartIT -Dtests.method=\"testSearch\" -Dtests.security.manager=true -Dtests.locale=zh-HK -Dtests.timezone=Indian/Mayotte\r\nFAILURE 10.9s | FullClusterRestartIT.testSearch <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \tat __randomizedtesting.SeedInfo.seed([51FA4D6D953D9A54:C343D838D124C2FB]:0)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n   > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:696)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.assertUpgradeWorks(FullClusterRestartIT.java:485)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.testSearch(FullClusterRestartIT.java:156)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n   > \tSuppressed: java.lang.AssertionError: expected:<0> but was:<489468>\r\n   > \t\tat org.elasticsearch.upgrades.FullClusterRestartIT.lambda$assertUpgradeWorks$3(FullClusterRestartIT.java:493)\r\n   > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:710)\r\n   > \t\t... 40 more\r\n  1> [2017-07-04T03:47:54,954][INFO ][o.e.u.FullClusterRestartIT] [testClusterState]: before test\r\n  1> [2017-07-04T03:47:54,983][INFO ][o.e.u.FullClusterRestartIT] [testClusterState]: after test\r\n  2> NOTE: leaving temporary files on disk at: /var/lib/jenkins/workspace/elastic+elasticsearch+master+bwc-tests/qa/full-cluster-restart/build/testrun/v5.1.1#upgradedClusterTestRunner/J0/temp/org.elasticsearch.upgrades.FullClusterRestartIT_51FA4D6D953D9A54-001\r\n  2> NOTE: test params are: codec=Asserting(Lucene70): {}, docValues:{}, maxPointsInLeafNode=1982, maxMBSortInHeap=5.75625762753509, sim=RandomSimilarity(queryNorm=false): {}, locale=zh-HK, timezone=Indian/Mayotte\r\n  2> NOTE: Linux 4.4.62-18.6-default amd64/Oracle Corporation 1.8.0_131 (64-bit)/cpus=4,threads=1,free=460630976,total=514850816\r\n  2> NOTE: All tests run in this JVM: [FullClusterRestartIT]\r\nCompleted [1/1] in 15.81s, 7 tests, 1 failure, 1 skipped <<< FAILURES!\r\n\r\n[ant:junit4] JVM J0: stderr was not empty, see: /var/lib/jenkins/workspace/elastic+elasticsearch+master+bwc-tests/qa/full-cluster-restart/build/testrun/v5.1.1#upgradedClusterTestRunner/temp/junit4-J0-20170704_004738_1841494010593132791203.syserr\r\nTests with failures:\r\n  - org.elasticsearch.upgrades.FullClusterRestartIT.testSearch\r\n\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312813340","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-312813340","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":312813340,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjgxMzM0MA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-04T08:21:22Z","updated_at":"2017-07-04T08:21:22Z","author_association":"MEMBER","body":"And another one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+g1gc/3411 .","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312834287","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-312834287","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":312834287,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjgzNDI4Nw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-07-04T09:44:52Z","updated_at":"2017-07-04T09:44:52Z","author_association":"MEMBER","body":"This is just weird. I pushed another commit that checks the upgrade api response to check whether the index really was upgraded.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312862062","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-312862062","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":312862062,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjg2MjA2Mg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-07-04T12:10:50Z","updated_at":"2017-07-04T12:10:50Z","author_association":"MEMBER","body":"last failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=centos/1202 .","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312922797","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-312922797","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":312922797,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkyMjc5Nw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-07-04T17:22:22Z","updated_at":"2017-07-04T17:22:22Z","author_association":"MEMBER","body":"> last failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=centos/1202 .\r\n\r\nThat failure didn't yet have the commit that verifies the upgrade response. I'm interested in seeing if that fails too.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/312939730","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-312939730","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":312939730,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkzOTczMA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-07-04T19:42:07Z","updated_at":"2017-07-04T19:42:07Z","author_association":"MEMBER","body":"Another two failures:\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=ubuntu/1203/console\r\n* https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=sles/1203\r\n\r\nThe upgrade api returns:\r\n\r\n```\r\n{_shards={total=1, failed=0, successful=0}, upgraded_indices={}}\r\n```\r\n\r\nIndicating to the upgrade has not been performed. So I ssh-ed into the build slave used for the last build and the upgrade seem to be invoked:\r\n\r\n```\r\n[2017-07-04T17:41:09,589][INFO ][o.e.i.e.Engine           ] [node-0] [testsearch][0] starting segment upgrade upgradeOnlyAncientSegments=false\r\n```\r\n\r\nHowever the `finished segment upgrade` log line is missing here, indicating that something went wrong during upgrading.  There is no trace of any error in the log. I'll increase the log level the `TransportUpgradeAction` to see what actually goes wrong here.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313137616","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-313137616","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":313137616,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzEzNzYxNg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-07-05T15:27:04Z","updated_at":"2017-07-05T15:27:04Z","author_association":"CONTRIBUTOR","body":"Another one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=sles/1206/console\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/313382439","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-313382439","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":313382439,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzM4MjQzOQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-07-06T12:31:12Z","updated_at":"2017-07-06T12:31:12Z","author_association":"MEMBER","body":"This one failed in the same way: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+bwc-tests/129\r\n\r\nHowever the log file does contain the `finished segment upgrade` log line:\r\n\r\n```\r\n[2017-07-06T09:00:27,778][INFO ][o.e.i.e.Engine           ] [node-0] [testsearch][0] starting segment upgrade upgradeOnlyAncientSegments=false\r\n[2017-07-06T09:00:28,188][INFO ][o.e.i.e.Engine           ] [node-0] [testsearch][0] finished segment upgrade\r\n```\r\n\r\nThis is weird, because the upgrade api returned:\r\n\r\n```\r\n{_shards={total=1, failed=0, successful=0}, upgraded_indices={}}\r\n```\r\n\r\nIndicating no upgrade ran. (which then failed the test)\r\n\r\nThe log file also contained many restore failures (which the previous failures didn't have) (not sure if it is related):\r\n\r\n```\r\n[2017-07-06T09:00:26,304][WARN ][o.e.i.c.IndicesClusterStateService] [node-0] [[restored_testsnapshotrestore][2]] marking and sending shard failed due to [failed recovery]\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [restored_testsnapshotrestore][2]: Recovery failed from {node-1}{bz86vogHQX2P5MZCat7_Kw}{H1NJ5aCmQMqsneFDSR1OMw}{127.0.0.1}{127.0.0.1:41051}{testattr=test} into {node-0}{B_toSUhESeOkFQbbAZqE3g}{9DTa331OTBe8sF7tcDNIMQ}{127.0.0.1}{127.0.0.1:34998}{testattr=test}\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:282) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:75) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:617) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\nCaused by: org.elasticsearch.transport.RemoteTransportException: [node-1][127.0.0.1:41051][internal:index/shard/recovery/start_recovery]\r\nCaused by: org.elasticsearch.index.engine.RecoveryEngineException: Phase[1] prepare target for translog failed\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:177) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:126) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:54) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:135) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:132) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1545) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t... 5 more\r\nCaused by: org.elasticsearch.common.util.CancellableThreads$ExecutionCancelledException: recovery was canceled reason [shard is closed]\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler$1.onCancel(RecoverySourceHandler.java:106) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.CancellableThreads.executeIO(CancellableThreads.java:129) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.prepareTargetForTranslog(RecoverySourceHandler.java:411) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:175) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:126) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:54) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:135) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:132) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1545) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t... 5 more\r\n\tSuppressed: java.lang.IllegalStateException: Future got interrupted\r\n\t\tat org.elasticsearch.transport.PlainTransportFuture.txGet(PlainTransportFuture.java:45) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.PlainTransportFuture.txGet(PlainTransportFuture.java:30) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.RemoteRecoveryTargetHandler.prepareForTranslogOperations(RemoteRecoveryTargetHandler.java:83) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.lambda$prepareTargetForTranslog$6(RecoverySourceHandler.java:411) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.common.util.CancellableThreads.executeIO(CancellableThreads.java:105) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.prepareTargetForTranslog(RecoverySourceHandler.java:411) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:175) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:126) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:54) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:135) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:132) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1545) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]\r\n\t\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]\r\n\t\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n\tCaused by: java.lang.InterruptedException\r\n\t\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:998) ~[?:1.8.0_131]\r\n\t\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304) ~[?:1.8.0_131]\r\n\t\tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:251) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.PlainTransportFuture.txGet(PlainTransportFuture.java:42) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\t... 18 more\r\n[2017-07-06T09:00:26,311][WARN ][o.e.c.a.s.ShardStateAction] [node-0] [restored_testsnapshotrestore][2] received shard failed for shard id [[restored_testsnapshotrestore][2]], allocation id [047LokEjR7uqcnxlWWhagw], primary term [0], message [failed recovery], failure [RecoveryFailedException[[restored_testsnapshotrestore][2]: Recovery failed from {node-1}{bz86vogHQX2P5MZCat7_Kw}{H1NJ5aCmQMqsneFDSR1OMw}{127.0.0.1}{127.0.0.1:41051}{testattr=test} into {node-0}{B_toSUhESeOkFQbbAZqE3g}{9DTa331OTBe8sF7tcDNIMQ}{127.0.0.1}{127.0.0.1:34998}{testattr=test}]; nested: RemoteTransportException[[node-1][127.0.0.1:41051][internal:index/shard/recovery/start_recovery]]; nested: RecoveryEngineException[Phase[1] prepare target for translog failed]; nested: ExecutionCancelledException[recovery was canceled reason [shard is closed]]; ]\r\norg.elasticsearch.indices.recovery.RecoveryFailedException: [restored_testsnapshotrestore][2]: Recovery failed from {node-1}{bz86vogHQX2P5MZCat7_Kw}{H1NJ5aCmQMqsneFDSR1OMw}{127.0.0.1}{127.0.0.1:41051}{testattr=test} into {node-0}{B_toSUhESeOkFQbbAZqE3g}{9DTa331OTBe8sF7tcDNIMQ}{127.0.0.1}{127.0.0.1:34998}{testattr=test}\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:282) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:75) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:617) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\nCaused by: org.elasticsearch.transport.RemoteTransportException: [node-1][127.0.0.1:41051][internal:index/shard/recovery/start_recovery]\r\nCaused by: org.elasticsearch.index.engine.RecoveryEngineException: Phase[1] prepare target for translog failed\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:177) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:126) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:54) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:135) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:132) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1545) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t... 5 more\r\nCaused by: org.elasticsearch.common.util.CancellableThreads$ExecutionCancelledException: recovery was canceled reason [shard is closed]\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler$1.onCancel(RecoverySourceHandler.java:106) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.common.util.CancellableThreads.executeIO(CancellableThreads.java:129) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.prepareTargetForTranslog(RecoverySourceHandler.java:411) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:175) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:126) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:54) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:135) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:132) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1545) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t... 5 more\r\n\tSuppressed: java.lang.IllegalStateException: Future got interrupted\r\n\t\tat org.elasticsearch.transport.PlainTransportFuture.txGet(PlainTransportFuture.java:45) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.PlainTransportFuture.txGet(PlainTransportFuture.java:30) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.RemoteRecoveryTargetHandler.prepareForTranslogOperations(RemoteRecoveryTargetHandler.java:83) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.lambda$prepareTargetForTranslog$6(RecoverySourceHandler.java:411) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.common.util.CancellableThreads.executeIO(CancellableThreads.java:105) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.prepareTargetForTranslog(RecoverySourceHandler.java:411) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:175) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:126) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:54) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:135) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:132) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1545) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]\r\n\t\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]\r\n\t\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n\tCaused by: java.lang.InterruptedException\r\n\t\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:998) ~[?:1.8.0_131]\r\n\t\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304) ~[?:1.8.0_131]\r\n\t\tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:251) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\tat org.elasticsearch.transport.PlainTransportFuture.txGet(PlainTransportFuture.java:42) ~[elasticsearch-6.0.0-alpha3-SNAPSHOT.jar:6.0.0-alpha3-SNAPSHOT]\r\n\t\t... 18 more\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/314820208","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-314820208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":314820208,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNDgyMDIwOA==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2017-07-12T16:16:18Z","updated_at":"2017-07-12T16:18:48Z","author_association":"CONTRIBUTOR","body":"another one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+aggressive-opts/370/console\r\nanother one: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=fedora/1229/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/315390719","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-315390719","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":315390719,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNTM5MDcxOQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-07-14T15:33:52Z","updated_at":"2017-07-14T15:33:52Z","author_association":"MEMBER","body":"This test hasn't after: 9040f4498eb62dbe58faeb1e9156fe476889d324 got pushed. This commit changes to test to wait for green state before running upgrade. I noticed that in one of these build failures that shard header reported that the upgrade command was send to 0 shards. (total was 1 and successful was 1). If this test doesn't fail over the weekend then I will close this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321413271","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-321413271","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":321413271,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTQxMzI3MQ==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2017-08-09T23:59:11Z","updated_at":"2017-08-09T23:59:11Z","author_association":"CONTRIBUTOR","body":"happened again: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.0+bwc-tests/42/console\r\n\r\n```\r\ngradle :qa:full-cluster-restart:v5.4.3#upgradedClusterTestRunner -Dtests.seed=C9DE4FDD8C148B00 -Dtests.class=org.elasticsearch.upgrades.FullClusterRestartIT -Dtests.method=\"testSearch\" -Dtests.security.manager=true -Dtests.locale=sr-Latn-BA -Dtests.timezone=BST\r\n  1> [2017-08-09T16:47:20,196][INFO ][o.e.u.FullClusterRestartIT] [testSearch]: before test\r\n  1> [2017-08-09T16:47:20,222][INFO ][o.e.u.FullClusterRestartIT] health api response: {number_of_pending_tasks=1, cluster_name=full-cluster-restart, active_shards=1, active_primary_shards=1, unassigned_shards=0, delayed_unassigned_shards=0, timed_out=false, relocating_shards=0, initializing_shards=0, task_max_waiting_in_queue_millis=0, number_of_data_nodes=2, number_of_in_flight_fetch=0, active_shards_percent_as_number=100.0, status=green, number_of_nodes=2}\r\n  1> [2017-08-09T16:47:20,223][INFO ][o.e.u.FullClusterRestartIT] --> testing basic search\r\n  1> [2017-08-09T16:47:20,258][INFO ][o.e.u.FullClusterRestartIT] Found 2491 in old index\r\n  1> [2017-08-09T16:47:20,258][INFO ][o.e.u.FullClusterRestartIT] --> testing basic search with sort\r\n  1> [2017-08-09T16:47:20,291][INFO ][o.e.u.FullClusterRestartIT] --> testing exists filter\r\n  1> [2017-08-09T16:47:20,321][INFO ][o.e.u.FullClusterRestartIT] --> testing _all search\r\n  1> [2017-08-09T16:47:21,035][INFO ][o.e.u.FullClusterRestartIT] upgrade api response: {_shards={total=1, failed=0, successful=0}, upgraded_indices={}}\r\n  1> [2017-08-09T16:47:21,090][INFO ][o.e.u.FullClusterRestartIT] [testSearch]: after test\r\nFAILURE 0.91s | FullClusterRestartIT.testSearch <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError\r\n   > \tat __randomizedtesting.SeedInfo.seed([C9DE4FDD8C148B00:5B67DA88C80DD3AF]:0)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.assertUpgradeWorks(FullClusterRestartIT.java:559)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.testSearch(FullClusterRestartIT.java:167)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n  1> [2017-08-09T16:47:21,106][INFO ][o.e.u.FullClusterRestartIT] [testAliasWithBadName]: before test\r\n  1> [2017-08-09T16:47:21,124][INFO ][o.e.u.FullClusterRestartIT] [testAliasWithBadName]: after test\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321536951","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-321536951","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":321536951,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTUzNjk1MQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2017-08-10T12:28:28Z","updated_at":"2017-08-10T12:28:28Z","author_association":"MEMBER","body":"And again in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+bwc-tests/45/console\r\n\r\n```\r\nFAILURE 1.00s | FullClusterRestartIT.testSearch <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError\r\n   > \tat __randomizedtesting.SeedInfo.seed([F32820552B31394A:6191B5006F2861E5]:0)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.assertUpgradeWorks(FullClusterRestartIT.java:559)\r\n   > \tat org.elasticsearch.upgrades.FullClusterRestartIT.testSearch(FullClusterRestartIT.java:167)\r\n   > \tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\nThe failing assertion checks whether versions of upgraded indices are present (i.e. not null). Attached are the cluster logs from the 5.3.3 on which the test has failed.\r\n\r\n[cluster-logs.zip](https://github.com/elastic/elasticsearch/files/1214859/cluster-logs.zip)\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/321814039","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-321814039","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":321814039,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMTgxNDAzOQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-08-11T13:37:50Z","updated_at":"2017-08-11T13:37:50Z","author_association":"MEMBER","body":"I see two things in the cluster logs:\r\n* A lot of restore snaphot errors in node0\r\n* In node1 I see: `[2017-08-10T11:48:56,881][INFO ][o.e.i.e.Engine           ] [node-1] [testsearch][0] starting segment upgrade upgradeOnlyAncientSegments=false` but not `finished segment upgrade`, which should be there if I read the code in `InternalEngine#forceMerge(...)` (line 1459) correctly.\r\n\r\nI think both observations can be the reason why this test fails.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322177909","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-322177909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":322177909,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjE3NzkwOQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2017-08-14T12:32:38Z","updated_at":"2017-08-14T12:32:38Z","author_association":"MEMBER","body":"This one looks similar: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+bwc-tests/57","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322561235","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-322561235","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":322561235,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjU2MTIzNQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-08-15T19:14:52Z","updated_at":"2017-08-15T19:14:52Z","author_association":"CONTRIBUTOR","body":"So these tests are against the `_upgrade` API which document as not being useful any more. I think these were just ported from the old tests. I don't think we need to keep these tests because we don't advise folks to use the API anymore anyway.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322562468","html_url":"https://github.com/elastic/elasticsearch/issues/25311#issuecomment-322562468","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25311","id":322562468,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjU2MjQ2OA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2017-08-15T19:20:00Z","updated_at":"2017-08-15T19:20:00Z","author_association":"CONTRIBUTOR","body":"I'll open a PR to remove the failing test in a bit. If we end up with some other mystery error in the bwc tests we should keep this issue in mind, but I don't think it is worth spending a ton of time hunting this issue given that the API should go anyway.","performed_via_github_app":null}]