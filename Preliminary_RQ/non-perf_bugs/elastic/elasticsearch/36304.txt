{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36304","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36304/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36304/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36304/events","html_url":"https://github.com/elastic/elasticsearch/issues/36304","id":388183615,"node_id":"MDU6SXNzdWUzODgxODM2MTU=","number":36304,"title":"\"index_already_exists_exception\" - kafka to ES sink connector","user":{"login":"jay999123","id":7712148,"node_id":"MDQ6VXNlcjc3MTIxNDg=","avatar_url":"https://avatars0.githubusercontent.com/u/7712148?v=4","gravatar_id":"","url":"https://api.github.com/users/jay999123","html_url":"https://github.com/jay999123","followers_url":"https://api.github.com/users/jay999123/followers","following_url":"https://api.github.com/users/jay999123/following{/other_user}","gists_url":"https://api.github.com/users/jay999123/gists{/gist_id}","starred_url":"https://api.github.com/users/jay999123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jay999123/subscriptions","organizations_url":"https://api.github.com/users/jay999123/orgs","repos_url":"https://api.github.com/users/jay999123/repos","events_url":"https://api.github.com/users/jay999123/events{/privacy}","received_events_url":"https://api.github.com/users/jay999123/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-12-06T12:02:49Z","updated_at":"2018-12-06T12:27:12Z","closed_at":"2018-12-06T12:27:11Z","author_association":"NONE","active_lock_reason":null,"body":"We've kafka elastic search sink connector transporting data to Elastic search(v**5.6.3**). The connector configuration is as follows :\r\n\r\n`{\r\n\"name\":\"elasticsearch_topic\",\r\n\"config\":\r\n{       \r\n    \"connector.class\":\"io.confluent.connect.elasticsearch.ElasticsearchSinkConnector\",\r\n    \"tasks.max\":\"3\",\r\n    \"topics\":\"sample_topic\",\r\n    \"connection.url\":\"https://127.0.0.1:9200,https://127.0.0.2:9200\",               \r\n    \"connection.username\":\"elsatic_user\",\r\n    \"connection.password\":\"elastic_user\",\r\n    \"type.name\":\"log\",\r\n    \"flush.timeout.ms\":\"60000\",\r\n    \"connection.timeout.ms\":\"60000\",\r\n    \"read.timeout.ms\":\"60000\",\r\n    \"batch.size\":\"20\",\r\n    \"topic.index.map\":\"sample_topic:elastic_search_index_test\",\r\n    \"transforms\":\"extract,insertenv,inserttimestamp,convert_current_ts,routeTS\",\r\n    \"schema.ignore\": \"true\",\r\n    \"transforms.extract.type\":\"org.apache.kafka.connect.transforms.ExtractField$Key\",\r\n    \"transforms.extract.field\":\"RE_NUM\",\r\n    \"transforms.insertenv.type\": \"org.apache.kafka.connect.transforms.InsertField$Value\",\r\n        \"transforms.insertenv.static.field\": \"_env\",\r\n        \"transforms.insertenv.static.value\": \"dev\",\r\n        \"transforms.inserttimestamp.type\": \"org.apache.kafka.connect.transforms.InsertField$Value\",\r\n        \"transforms.inserttimestamp.timestamp.field\": \"date_time\",      \r\n            \"transforms.convert_current_ts.type\": \"org.apache.kafka.connect.transforms.TimestampConverter$Value\",\r\n        \"transforms.convert_current_ts.target.type\": \"Timestamp\",\r\n        \"transforms.convert_current_ts.field\": \"date_time\",\r\n        \"transforms.convert_current_ts.format\": \"yyyy-MM-dd HH:mm:ss.SSSSSS\",\r\n        \"transforms.routeTS.type\":\"org.apache.kafka.connect.transforms.TimestampRouter\",  \r\n    \"transforms.routeTS.topic.format\":\"elastic_search_index_test-${timestamp}\",  \r\n    \"transforms.routeTS.timestamp.format\":\"yyyyMMdd\"\r\n }\r\n}`\r\n\r\nSo far so good. No issues.\r\n\r\nRecently we've enabled SSL on elastic search and for this I've added \"username\" and \"password\" and \"https\" to the above configurations.Then restarted the connector and worker. Since then I can see \"**index_already_exists_exception**\" with error as below :\r\n\r\n`\r\n[2018-12-06 03:36:21,487] ERROR WorkerSinkTask{id=elasticsearch_topic-1} \r\n Task threw an uncaught and unrecoverable exception \r\n (org.apache.kafka.connect.runtime.WorkerTask:177)\r\n org.apache.kafka.connect.errors.ConnectException: Could not create index \r\n 'elastic_search_index_test': {\"root_cause\": \r\n [{\"type\":\"index_already_exists_exception\",\"reason\":\"index \r\n[elastic_search_index_test/QVgWV8E7RmuSArtIJt3m3g] already exists\",\"index_uuid\":\"QVgWV8E7RmuSArtIJt3m3g\",\"index\":\"elastic_search_index_test\"}],\"type\":\"index_already_exists_exception\",\"reason\":\"index [elastic_search_index_test/QVgWV8E7RmuSArtIJt3m3g] already exists\",\"index_uuid\":\"QVgWV8E7RmuSArtIJt3m3g\",\"index\":\"elastic_search_index_test\"}\r\n    at io.confluent.connect.elasticsearch.jest.JestElasticsearchClient.createIndices(JestElasticsearchClient.java:238)\r\n    at io.confluent.connect.elasticsearch.ElasticsearchWriter.createIndicesForTopics(ElasticsearchWriter.java:330)\r\n    at io.confluent.connect.elasticsearch.ElasticsearchSinkTask.open(ElasticsearchSinkTask.java:157)\r\n    at org.apache.kafka.connect.runtime.WorkerSinkTask.openPartitions(WorkerSinkTask.java:612)\r\n    at org.apache.kafka.connect.runtime.WorkerSinkTask.access$1100(WorkerSinkTask.java:69)\r\n    at org.apache.kafka.connect.runtime.WorkerSinkTask$HandleRebalance.onPartitionsAssigned(WorkerSinkTask.java:672)\r\n    at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.onJoinComplete(ConsumerCoordinator.java:283)\r\n    at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.joinGroupIfNeeded(AbstractCoordinator.java:422)\r\n    at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.ensureActiveGroup(AbstractCoordinator.java:352)\r\n    at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.ensureActiveGroup(AbstractCoordinator.java:337)\r\n    at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.poll(ConsumerCoordinator.java:343)\r\n    at org.apache.kafka.clients.consumer.KafkaConsumer.updateAssignmentMetadataIfNeeded(KafkaConsumer.java:1218)\r\n    at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1181)\r\n    at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1115)\r\n    at org.apache.kafka.connect.runtime.WorkerSinkTask.pollConsumer(WorkerSinkTask.java:444)\r\n    at org.apache.kafka.connect.runtime.WorkerSinkTask.poll(WorkerSinkTask.java:317)\r\n    at org.apache.kafka.connect.runtime.WorkerSinkTask.iteration(WorkerSinkTask.java:225)\r\n    at org.apache.kafka.connect.runtime.WorkerSinkTask.execute(WorkerSinkTask.java:193)\r\n    at org.apache.kafka.connect.runtime.WorkerTask.doRun(WorkerTask.java:175)\r\n    at org.apache.kafka.connect.runtime.WorkerTask.run(WorkerTask.java:219)\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n    at java.lang.Thread.run(Thread.java:748)\r\n [2018-12-06 03:36:21,487] ERROR WorkerSinkTask{id=elasticsearch_topic-1} Task is being killed and will not recover until manually restarted (org.apache.kafka.connect.runtime.WorkerTask:178)\r\n`\r\n\r\n**Steps that I've tried so far :**\r\n\r\nStopped the elastic search sink connector and worker\r\nDeleted the index \"elastic_search_index_test\" from elastic search (through Kibana)\r\nRestarted the worker and elastic search connector\r\nBut still getting the same error (as described above)\r\n\r\nCould any one suggest what's wrong going on?\r\n\r\nThanks in advance!!","closed_by":{"login":"andrershov","id":600624,"node_id":"MDQ6VXNlcjYwMDYyNA==","avatar_url":"https://avatars1.githubusercontent.com/u/600624?v=4","gravatar_id":"","url":"https://api.github.com/users/andrershov","html_url":"https://github.com/andrershov","followers_url":"https://api.github.com/users/andrershov/followers","following_url":"https://api.github.com/users/andrershov/following{/other_user}","gists_url":"https://api.github.com/users/andrershov/gists{/gist_id}","starred_url":"https://api.github.com/users/andrershov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrershov/subscriptions","organizations_url":"https://api.github.com/users/andrershov/orgs","repos_url":"https://api.github.com/users/andrershov/repos","events_url":"https://api.github.com/users/andrershov/events{/privacy}","received_events_url":"https://api.github.com/users/andrershov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}