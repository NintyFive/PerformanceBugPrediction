[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21023978","html_url":"https://github.com/elastic/elasticsearch/issues/3336#issuecomment-21023978","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","id":21023978,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDIzOTc4","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2013-07-16T06:38:13Z","updated_at":"2013-07-16T06:38:13Z","author_association":"MEMBER","body":"Hi,\n\nCan you please also post the requests you are issuing as cURL commands? \n\nCheers,\nBoaz\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21033133","html_url":"https://github.com/elastic/elasticsearch/issues/3336#issuecomment-21033133","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","id":21033133,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDMzMTMz","user":{"login":"schmir","id":40620,"node_id":"MDQ6VXNlcjQwNjIw","avatar_url":"https://avatars3.githubusercontent.com/u/40620?v=4","gravatar_id":"","url":"https://api.github.com/users/schmir","html_url":"https://github.com/schmir","followers_url":"https://api.github.com/users/schmir/followers","following_url":"https://api.github.com/users/schmir/following{/other_user}","gists_url":"https://api.github.com/users/schmir/gists{/gist_id}","starred_url":"https://api.github.com/users/schmir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmir/subscriptions","organizations_url":"https://api.github.com/users/schmir/orgs","repos_url":"https://api.github.com/users/schmir/repos","events_url":"https://api.github.com/users/schmir/events{/privacy}","received_events_url":"https://api.github.com/users/schmir/received_events","type":"User","site_admin":false},"created_at":"2013-07-16T10:20:48Z","updated_at":"2013-07-16T10:20:48Z","author_association":"NONE","body":"sure. the requests look like\n\n<pre>\ncurl -XGET 'http://localhost:9250/src_idx/_search?search_type=scan&scroll=30s&size=10' -d '{\"fields\": \"*\", \"query\": {\"match_all\": {}}}'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\ncurl -XGET 'http://localhost:9250/_search/scroll?scroll_id=c2NhbjsyOzMyOjBCVmFVNDVaUjg2YlBRc19DM29FeXc7MzE6MEJWYVU0NVpSODZiUFFzX0Mzb0V5dzsxO3RvdGFsX2hpdHM6OTQyNzIzMDs%3D&scroll=10m' -d '\"\"'\n...\n</pre>\n\nwhich just made me double check my code, because the scroll_id doesn't\nchange contrary to what I had assumed.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21033174","html_url":"https://github.com/elastic/elasticsearch/issues/3336#issuecomment-21033174","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","id":21033174,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDMzMTc0","user":{"login":"schmir","id":40620,"node_id":"MDQ6VXNlcjQwNjIw","avatar_url":"https://avatars3.githubusercontent.com/u/40620?v=4","gravatar_id":"","url":"https://api.github.com/users/schmir","html_url":"https://github.com/schmir","followers_url":"https://api.github.com/users/schmir/followers","following_url":"https://api.github.com/users/schmir/following{/other_user}","gists_url":"https://api.github.com/users/schmir/gists{/gist_id}","starred_url":"https://api.github.com/users/schmir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmir/subscriptions","organizations_url":"https://api.github.com/users/schmir/orgs","repos_url":"https://api.github.com/users/schmir/repos","events_url":"https://api.github.com/users/schmir/events{/privacy}","received_events_url":"https://api.github.com/users/schmir/received_events","type":"User","site_admin":false},"created_at":"2013-07-16T10:21:48Z","updated_at":"2013-07-16T10:21:48Z","author_association":"NONE","body":"I can also put the heap dump file online if you like to look at it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21034959","html_url":"https://github.com/elastic/elasticsearch/issues/3336#issuecomment-21034959","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","id":21034959,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDM0OTU5","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2013-07-16T11:02:31Z","updated_at":"2013-07-16T11:02:31Z","author_association":"MEMBER","body":"The heap dump would be great. Thx.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21035566","html_url":"https://github.com/elastic/elasticsearch/issues/3336#issuecomment-21035566","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","id":21035566,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDM1NTY2","user":{"login":"schmir","id":40620,"node_id":"MDQ6VXNlcjQwNjIw","avatar_url":"https://avatars3.githubusercontent.com/u/40620?v=4","gravatar_id":"","url":"https://api.github.com/users/schmir","html_url":"https://github.com/schmir","followers_url":"https://api.github.com/users/schmir/followers","following_url":"https://api.github.com/users/schmir/following{/other_user}","gists_url":"https://api.github.com/users/schmir/gists{/gist_id}","starred_url":"https://api.github.com/users/schmir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmir/subscriptions","organizations_url":"https://api.github.com/users/schmir/orgs","repos_url":"https://api.github.com/users/schmir/repos","events_url":"https://api.github.com/users/schmir/events{/privacy}","received_events_url":"https://api.github.com/users/schmir/received_events","type":"User","site_admin":false},"created_at":"2013-07-16T11:17:08Z","updated_at":"2013-07-16T11:17:08Z","author_association":"NONE","body":"here's the heap dump: http://graph.brainbot.com/java_pid8908.hprof.gz\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21041281","html_url":"https://github.com/elastic/elasticsearch/issues/3336#issuecomment-21041281","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","id":21041281,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDQxMjgx","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2013-07-16T13:23:12Z","updated_at":"2013-07-16T13:23:12Z","author_association":"MEMBER","body":"Thx. A short update - I wrote a little to reproduce locally but couldn't. I'm downloading the heap dump and will have a go at it later..\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21113384","html_url":"https://github.com/elastic/elasticsearch/issues/3336#issuecomment-21113384","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","id":21113384,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMTEzMzg0","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2013-07-17T13:43:17Z","updated_at":"2013-07-17T13:43:17Z","author_association":"MEMBER","body":"Hi,\n\nThanks for the memory dump, it really helped.\n\nHere is what's going on - stored fields in Lucene are persisted to disk, in a compressed form, per Lucene segment (those are the building block of a lucene index, which in ES terminology maps to a single shard). When you retrieve a doc, lucene goes to disk and decompresses the data you need and sends it back. When it does so, it re-uses memory buffers to temporarily store the decompressed data so ES can send them back to the user. Those memory buffers are cached per segment per thread.\n\nIn your case, each document has around 9MB of stored content (does this make sense to you?), I guess most of it is the binary content. At the moment of the dump, your index contained 264 segments (total of the two shards the node has). Those cached memory buffers add up to 8GB (remember, they are per segment per thread).\n\nThe good news are that in the next version of Lucene (4.4) does not cache the memory buffers if they too big, which will solve the problem at the expense of some performance degradation. It will probably ship with the next minor version of ES  (0.90.3).\n\nUntil that time, you can try and reduce the memory signature by\n- only allocating one shard to a node (will roughly half the number of segments)\n- frequently run optimize (which will reduce the number of segments). How often depends on how frequently you index new document\n\nHowever, if you continuously index/delete data, it will be very hard to guaranty the number of segments do not go beyond a certain level.\n\nI'm closing this issue now because there is no real action for me to take now. Feel free to comment on it if you have any questions or if something is not clear.\n\nCheers,\nBoaz\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21114962","html_url":"https://github.com/elastic/elasticsearch/issues/3336#issuecomment-21114962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3336","id":21114962,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMTE0OTYy","user":{"login":"schmir","id":40620,"node_id":"MDQ6VXNlcjQwNjIw","avatar_url":"https://avatars3.githubusercontent.com/u/40620?v=4","gravatar_id":"","url":"https://api.github.com/users/schmir","html_url":"https://github.com/schmir","followers_url":"https://api.github.com/users/schmir/followers","following_url":"https://api.github.com/users/schmir/following{/other_user}","gists_url":"https://api.github.com/users/schmir/gists{/gist_id}","starred_url":"https://api.github.com/users/schmir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schmir/subscriptions","organizations_url":"https://api.github.com/users/schmir/orgs","repos_url":"https://api.github.com/users/schmir/repos","events_url":"https://api.github.com/users/schmir/events{/privacy}","received_events_url":"https://api.github.com/users/schmir/received_events","type":"User","site_admin":false},"created_at":"2013-07-17T14:05:37Z","updated_at":"2013-07-17T14:05:37Z","author_association":"NONE","body":"Many thanks for looking into this and the detailed explanation!\n","performed_via_github_app":null}]