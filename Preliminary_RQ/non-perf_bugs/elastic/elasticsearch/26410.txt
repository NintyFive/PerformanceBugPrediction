{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26410","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26410/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26410/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26410/events","html_url":"https://github.com/elastic/elasticsearch/issues/26410","id":253435835,"node_id":"MDU6SXNzdWUyNTM0MzU4MzU=","number":26410,"title":"elasticsearch can't read keystore file (.deb package install)","user":{"login":"LeeDr","id":13542669,"node_id":"MDQ6VXNlcjEzNTQyNjY5","avatar_url":"https://avatars1.githubusercontent.com/u/13542669?v=4","gravatar_id":"","url":"https://api.github.com/users/LeeDr","html_url":"https://github.com/LeeDr","followers_url":"https://api.github.com/users/LeeDr/followers","following_url":"https://api.github.com/users/LeeDr/following{/other_user}","gists_url":"https://api.github.com/users/LeeDr/gists{/gist_id}","starred_url":"https://api.github.com/users/LeeDr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LeeDr/subscriptions","organizations_url":"https://api.github.com/users/LeeDr/orgs","repos_url":"https://api.github.com/users/LeeDr/repos","events_url":"https://api.github.com/users/LeeDr/events{/privacy}","received_events_url":"https://api.github.com/users/LeeDr/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2017-08-28T19:49:11Z","updated_at":"2017-08-29T00:47:43Z","closed_at":"2017-08-29T00:47:43Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Related to; https://github.com/elastic/elasticsearch/pull/26329\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):  Version: 6.0.0-beta2-SNAPSHOT, Build: d6a7e25/2017-08-28T13:34:58.542Z, JVM: 1.8.0_141\r\n\r\n**Plugins installed**: [x-pack]\r\n\r\n**JVM version** (`java -version`): openjdk version \"1.8.0_141\"\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux packer-virtualbox-iso-1501424719 4.4.0-87-generic #110~14.04.1-Ubuntu SMP Tue Jul 18 14:51:32 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nAfter upgrading from 5.6.0-SNAPSHOT (with x-pack) to 6.0.0-beta2-SNAPSHOT (both from this morning's unified release builds) elasticsearch won't start because it can't read the /etc/elasticsearch/elasticsearch.keystore file\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Install 5.6.0 elasticsearch and x-pack (links below)\r\n 1. I'm running in production mode (network.host: 0.0.0.0) and have changed the default password\r\n 1. `service elasticsearch stop`\r\n 1. `/usr/share/elasticsearch/bin/elasticsearch-plugin remove x-pack`\r\n 1. I backup my elasticsearch.yml before upgrading, taking the new config, then merge my changes back afterwards\r\n 1. `dpkg -i --force-confnew ./elasticsearch-6.0.0-beta2-SNAPSHOT.deb`\r\n 1. `/usr/share/elasticsearch/bin/elasticsearch-plugin install -b file:///vagrant/qa/x-pack-6.0.0-beta2-SNAPSHOT.zip`\r\n 1. `service elasticsearch start`   see log below\r\n 1. `-rw------- 1 root root           416 Aug 28 19:09 elasticsearch.keystore`\r\n\r\nI \"fixed\" it with;\r\n`chown root:elasticsearch /etc/elasticsearch/elasticsearch.keystore`\r\n`chmod 660 /etc/elasticsearch/elasticsearch.keystore`\r\nNow Elasticsearch starts\r\n\r\nhttps://snapshots.elastic.co/downloads/elasticsearch/elasticsearch-5.6.0-SNAPSHOT.deb\r\nhttps://snapshots.elastic.co/downloads/packs/x-pack/x-pack-5.6.0-SNAPSHOT.zip\r\nhttps://snapshots.elastic.co/downloads/elasticsearch/elasticsearch-6.0.0-beta2-SNAPSHOT.deb\r\nhttps://snapshots.elastic.co/downloads/packs/x-pack/x-pack-6.0.0-beta2-SNAPSHOT.zip\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n+ service elasticsearch start\r\n * Starting Elasticsearch Server\r\nException in thread \"main\" org.elasticsearch.bootstrap.BootstrapException: java.nio.file.AccessDeniedException: /etc/elasticsearch/elasticsearch.keystore\r\nLikely root cause: java.nio.file.AccessDeniedException: /etc/elasticsearch/elasticsearch.keystore\r\n        at sun.nio.fs.UnixException.translateToIOException(UnixException.java:84)\r\n        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\r\n        at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\r\n        at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)\r\n        at java.nio.file.Files.newByteChannel(Files.java:361)\r\n        at java.nio.file.Files.newByteChannel(Files.java:407)\r\n        at org.apache.lucene.store.SimpleFSDirectory.openInput(SimpleFSDirectory.java:77)\r\n        at org.elasticsearch.common.settings.KeyStoreWrapper.load(KeyStoreWrapper.java:199)\r\n        at org.elasticsearch.bootstrap.Bootstrap.loadSecureSettings(Bootstrap.java:225)\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:287)\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:130)\r\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:121)\r\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:69)\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:134)\r\n        at org.elasticsearch.cli.Command.main(Command.java:90)\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92)\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:85)\r\nRefer to the log for complete error details.\r\n   ...fail!\r\n```\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}