[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399215509","html_url":"https://github.com/elastic/elasticsearch/issues/31516#issuecomment-399215509","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31516","id":399215509,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTIxNTUwOQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-21T19:24:31Z","updated_at":"2018-06-21T19:24:31Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399228032","html_url":"https://github.com/elastic/elasticsearch/issues/31516#issuecomment-399228032","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31516","id":399228032,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTIyODAzMg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-06-21T20:13:12Z","updated_at":"2018-06-21T20:13:12Z","author_association":"MEMBER","body":"@dakrone are you sure that you get the same behaviour with get mappings?  I wouldn't expect that. \r\n\r\nThere are limitations when security is enabled, that are documented in our [docs](https://www.elastic.co/guide/en/elastic-stack-overview/current/security-limitations.html): \"While creating or retrieving aliases by providing wildcard expressions for alias names, if there are no existing authorized aliases that match the wildcard expression provided an IndexNotFoundException is returned.\".  The get aliases API is subject to this.\r\n\r\nBefore #31308 the get alias API didn't require `indices:admin/aliases/get` privileges when called without specifying indices and aliases, as it would internally be converted to an `indices:admin/get` (get index API) action. I find this a bug, as any alias was returned, while going through the get alias API we would also look at which aliases the user is authorized for and we replace them in the request. Whenever replacing aliases (not specifying aliases gets converted to _all which with security enabled means \"all of the aliases that the user has access to\"), the problem described above comes up, that when there are no aliases in the cluster the security plugin will throw a 404 instead of returning an empty response.\r\n\r\nIn hindsight, this is the behaviour that we should have always seen from the get alias API, in fact before removing `RestGetAllAliasesAction` there used to be a difference between doing `GET /_alias/_all` compared to `GET /_alias` which makes the behaviour inconsistent. Users would expect the same behaviour as they refer to the `_alias` endpoint as the get alias API. \r\n\r\nThis could be seen as a regression, but my personal opinion is that it was a bugfix and this behaviour, although not desirable, is known and documented, it was a mistake that the API didn't behave consistently depending on the provided parameters.\r\n\r\nWe can look as a follow-up at possibly improving this overall behaviour of the get alias API, similar to what we did in 5.0 for indices (we used to have the same limitation around indices but that was fixed), I think we have a way now to remove this limitation for the get alias API in 7.0.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399243436","html_url":"https://github.com/elastic/elasticsearch/issues/31516#issuecomment-399243436","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31516","id":399243436,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTI0MzQzNg==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2018-06-21T21:05:55Z","updated_at":"2018-06-21T21:05:55Z","author_association":"MEMBER","body":"> @dakrone are you sure that you get the same behaviour with get mappings? I wouldn't expect that.\r\n\r\nJust tested this and it does appear to only affect aliases, I'll change the title/body\r\n\r\n> This could be seen as a regression, but my personal opinion is that it was a bugfix and this behaviour, although not desirable, is known and documented, it was a mistake that the API didn't behave consistently depending on the provided parameters.\r\n\r\nI think this needs to go into the [migration documentation](https://github.com/elastic/elasticsearch/blob/6.x/docs/reference/migration/migrate_6_4.asciidoc) and be marked as a breaking change then, since it did break something (Kibana). I can see how it can be considered a bugfix, but at the same time I think we should strive to be as consistent as possible for a non-security versus security installation\r\n\r\n> We can look as a follow-up at possibly improving this overall behaviour of the get alias API, similar to what we did in 5.0 for indices, I think we have a way now to remove this limitation for the get alias API in 7.0.\r\n\r\n:+1:\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399355654","html_url":"https://github.com/elastic/elasticsearch/issues/31516#issuecomment-399355654","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31516","id":399355654,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTM1NTY1NA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-06-22T07:54:04Z","updated_at":"2018-06-22T07:54:04Z","author_association":"MEMBER","body":"@jaymode what's your take on this?\r\n\r\nI am open to reverting the change on 6.x and working on master to possibly remove the limitation completely. Otherwise we can keep the change in 6.x and document the different behaviour starting from 6.4 as Lee suggested, it's more consistent but breaking and undesired.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399360015","html_url":"https://github.com/elastic/elasticsearch/issues/31516#issuecomment-399360015","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31516","id":399360015,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTM2MDAxNQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-06-22T08:10:52Z","updated_at":"2018-06-22T08:11:44Z","author_association":"MEMBER","body":"I looked at removing the get alias limitations with security installed on master, and it is not as easy as it was with indices, the reason being that we don't support alias exclusions, hence there is no safe way to send a request through making sure that no aliases will be returned. In fact if there are no matching authorized aliases, we can't replace the aliases with an empty list of aliases as that would mean all aliases once the request is executed by Elasticsearch, which would lead to returning unauthorized aliases. With indices we replace them with an exclusion expression that always resolves to no indices, but given that we don't support aliases exclusions, it is not possible to do the same with aliases.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399553333","html_url":"https://github.com/elastic/elasticsearch/issues/31516#issuecomment-399553333","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31516","id":399553333,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTU1MzMzMw==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-06-22T19:18:03Z","updated_at":"2018-06-22T19:18:03Z","author_association":"MEMBER","body":"I'm personally in favor of reverting so we don't having a breaking API change in a minor. I don't have an idea right now on how we could fix this; I'll need to look at it some more.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/400961001","html_url":"https://github.com/elastic/elasticsearch/issues/31516#issuecomment-400961001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31516","id":400961001,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDk2MTAwMQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-06-28T08:47:52Z","updated_at":"2018-06-28T08:47:52Z","author_association":"MEMBER","body":"#31308 was reverted on master to prevent any breakage in a minor version. We are looking at removing the get aliases limitations on master.","performed_via_github_app":null}]