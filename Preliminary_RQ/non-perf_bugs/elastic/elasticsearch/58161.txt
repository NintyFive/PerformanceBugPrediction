{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/58161","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58161/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58161/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58161/events","html_url":"https://github.com/elastic/elasticsearch/issues/58161","id":639530416,"node_id":"MDU6SXNzdWU2Mzk1MzA0MTY=","number":58161,"title":"Proximity boosting on array fields.","user":{"login":"aksel","id":6985716,"node_id":"MDQ6VXNlcjY5ODU3MTY=","avatar_url":"https://avatars1.githubusercontent.com/u/6985716?v=4","gravatar_id":"","url":"https://api.github.com/users/aksel","html_url":"https://github.com/aksel","followers_url":"https://api.github.com/users/aksel/followers","following_url":"https://api.github.com/users/aksel/following{/other_user}","gists_url":"https://api.github.com/users/aksel/gists{/gist_id}","starred_url":"https://api.github.com/users/aksel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aksel/subscriptions","organizations_url":"https://api.github.com/users/aksel/orgs","repos_url":"https://api.github.com/users/aksel/repos","events_url":"https://api.github.com/users/aksel/events{/privacy}","received_events_url":"https://api.github.com/users/aksel/received_events","type":"User","site_admin":false},"labels":[{"id":418189364,"node_id":"MDU6TGFiZWw0MTgxODkzNjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Ranking","name":":Search/Ranking","color":"0e8a16","default":false,"description":"Scoring, rescoring, rank evaluation."},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967498216,"node_id":"MDU6TGFiZWwxOTY3NDk4MjE2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Search","name":"Team:Search","color":"fef2c0","default":false,"description":"Meta label for search team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-06-16T09:52:03Z","updated_at":"2020-06-17T10:02:48Z","closed_at":"2020-06-16T13:34:51Z","author_association":"NONE","active_lock_reason":null,"body":"We are building a forum, in which we have posts and replies.\r\n\r\nWe want to sort posts by popularity. Whenever there is a reply to a post, it should boost that post's popularity in some manner. This could be extended with number of reactions, likes, etc., but as a starting point, it's a pretty simple popularity ranking system.\r\n\r\nI was trying to use distance_feature as a boost, and added a field reply_timestamps to the post document. However, it seems that only the latest timestamp is acted upon by distance_feature.\r\n\r\nHere's an example\r\n<pre>\r\n<b>Request</b>\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"should\": [\r\n        {\r\n          \"distance_feature\": {\r\n            \"field\": \"reply_timestamps\", <b>// date[]</b>\r\n            \"pivot\": \"1d\",\r\n            \"origin\": \"now\"\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  \"explain\": true\r\n}\r\n\r\n<b>A snippet from one of the resulting hits</b>\r\n{\r\n  ...\r\n  \"_source\": {\r\n    ...\r\n    \"reply_timestamps\": [\r\n      \"2020-06-16T08:34:35.798Z\", <b>// Has a distance score of 0.9566114</b>\r\n      \"2020-06-16T08:58:33.284Z\", <b>// Has a distance score of 0.9720828</b>\r\n      \"2020-06-16T09:27:53.656Z\"  <b>// Has a distance score of 0.9917248</b>\r\n    ]\r\n  },\r\n  \"_explanation\": {\r\n    \"value\": 0.9917248, <b>// Matches the distance score of the last reply timestamp</b>\r\n    \"description\": \"Distance score, computed as weight * pivotDistance / (pivotDistance + abs(value - origin)) from:\",\r\n    \"details\": [\r\n      {\r\n        \"value\": 1.0,\r\n        \"description\": \"weight\",\r\n        \"details\": []\r\n      },\r\n      {\r\n        \"value\": 86400000,\r\n        \"description\": \"pivotDistance\",\r\n        \"details\": []\r\n      },\r\n      {\r\n        \"value\": 1592300394602, <b>// Current time in ms</b>\r\n        \"description\": \"origin\",\r\n        \"details\": []\r\n      },\r\n      {\r\n        \"value\": 1592299673656, <b>// \"2020-06-16T09:27:53.656Z\" as ms, the last timestamp in the array</b>\r\n        \"description\": \"current value\",\r\n        \"details\": []\r\n      }\r\n    ]\r\n  }\r\n}\r\n</pre>\r\n\r\nI would have expected all three timestamps to affect the score, resulting in the score being â‰ˆ2.92.\r\n\r\nIf this is already a an inherent feature, to have all items in an array affect the score, please let me know. I am relatively new to this :sweat_smile: \r\n\r\nThanks!","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}