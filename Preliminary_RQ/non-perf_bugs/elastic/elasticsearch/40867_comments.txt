[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/479981668","html_url":"https://github.com/elastic/elasticsearch/issues/40867#issuecomment-479981668","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40867","id":479981668,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3OTk4MTY2OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-04-04T17:03:13Z","updated_at":"2019-04-04T17:03:13Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/479986759","html_url":"https://github.com/elastic/elasticsearch/issues/40867#issuecomment-479986759","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40867","id":479986759,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3OTk4Njc1OQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2019-04-04T17:17:50Z","updated_at":"2019-04-04T17:17:50Z","author_association":"MEMBER","body":"Muted on master in https://github.com/elastic/elasticsearch/commit/cd8dd04103ec0bb8fcbbc6e39e9c8a679175b29a","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/480075866","html_url":"https://github.com/elastic/elasticsearch/issues/40867#issuecomment-480075866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40867","id":480075866,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MDA3NTg2Ng==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-04-04T21:47:31Z","updated_at":"2019-04-04T21:47:31Z","author_association":"MEMBER","body":"This test failure relates to #40423 where we don't build analyzers when opening the IndexService for a closed index. However, the actual cause is shards of the closed index are not flushed before closing because the verification step does not go through when primaries are unassigned.\r\n\r\n> What if the primaries are not all allocated? The verification step cannot go through or shards might not be properly flushed. Should we close the close index API? Should we allocate an empty routing table that cannot be allocated at all?\r\n\r\nThis is already tracked in the meta-issue of replicate closed indices (#33888). I linked this test failure to the bullet and leave this muted.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/481049431","html_url":"https://github.com/elastic/elasticsearch/issues/40867#issuecomment-481049431","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40867","id":481049431,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MTA0OTQzMQ==","user":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"created_at":"2019-04-08T23:54:37Z","updated_at":"2019-04-08T23:54:37Z","author_association":"CONTRIBUTOR","body":"One of my PR builds failed but for a different test: `testRecoverMissingAnalyzer`\r\n\r\nReproducible locally with command:\r\n```\r\n./gradlew :server:integTest \\\r\n-Dtests.seed=F3F656161D025A0 \\\r\n-Dtests.class=org.elasticsearch.gateway.GatewayIndexStateIT \\\r\n-Dtests.method=\"testRecoverMissingAnalyzer\" \\\r\n-Dtests.security.manager=true \\\r\n-Dtests.locale=id-ID \\\r\n-Dtests.timezone=Pacific/Galapagos \\\r\n-Dcompiler.java=12 \\\r\n-Druntime.java=11\r\n```\r\n\r\n```\r\n   > Throwable #1: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=83, name=elasticsearch[node_t1][generic][T#2], state=RUNNABLE, group=TGRP-GatewayIndexStateIT]\r\n   >    at __randomizedtesting.SeedInfo.seed([F3F656161D025A0:E796CB546B33FF52]:0)\r\n   > Caused by: java.lang.AssertionError: max seq. no. [-1] does not match [0]\r\n   >    at __randomizedtesting.SeedInfo.seed([F3F656161D025A0]:0)\r\n   >    at org.elasticsearch.index.engine.ReadOnlyEngine.assertMaxSeqNoEqualsToGlobalCheckpoint(ReadOnlyEngine.java:143)\r\n   >    at org.elasticsearch.index.engine.ReadOnlyEngine.<init>(ReadOnlyEngine.java:117)\r\n   >    at org.elasticsearch.index.engine.NoOpEngine.<init>(NoOpEngine.java:46)\r\n   >    at org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:1447)\r\n   >    at org.elasticsearch.index.shard.IndexShard.openEngineAndRecoverFromTranslog(IndexShard.java:1397)\r\n   >    at org.elasticsearch.index.shard.StoreRecovery.internalRecoverFromStore(StoreRecovery.java:433)\r\n   >    at org.elasticsearch.index.shard.StoreRecovery.lambda$recoverFromStore$0(StoreRecovery.java:95)\r\n   >    at org.elasticsearch.index.shard.StoreRecovery.executeRecovery(StoreRecovery.java:308)\r\n   >    at org.elasticsearch.index.shard.StoreRecovery.recoverFromStore(StoreRecovery.java:93)\r\n   >    at org.elasticsearch.index.shard.IndexShard.recoverFromStore(IndexShard.java:1686)\r\n   >    at org.elasticsearch.index.shard.IndexShard.lambda$startRecovery$9(IndexShard.java:2339)\r\n   >    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:677)\r\n   >    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n   >    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/481072450","html_url":"https://github.com/elastic/elasticsearch/issues/40867#issuecomment-481072450","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40867","id":481072450,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MTA3MjQ1MA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-04-09T02:03:00Z","updated_at":"2019-04-09T02:03:00Z","author_association":"MEMBER","body":"I muted `testRecoverMissingAnalyzer`  in https://github.com/elastic/elasticsearch/commit/aaec11f6a6921326da2bcceae5600f33082427f4.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/499863737","html_url":"https://github.com/elastic/elasticsearch/issues/40867#issuecomment-499863737","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40867","id":499863737,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTg2MzczNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-06-07T12:20:58Z","updated_at":"2019-06-07T12:20:58Z","author_association":"CONTRIBUTOR","body":"@dnhatn is this test fixed now by flushing at the end of peer recovery? If that's not sufficient, should we just explicitly flush in the test before we restart the node?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/500216361","html_url":"https://github.com/elastic/elasticsearch/issues/40867#issuecomment-500216361","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40867","id":500216361,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDIxNjM2MQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-06-09T14:30:29Z","updated_at":"2019-06-09T14:30:29Z","author_association":"MEMBER","body":"@ywelsch I fixed the [assertion](https://github.com/elastic/elasticsearch/pull/43010) in ReadOnlyEngine and verified these tests. We are good here.","performed_via_github_app":null}]