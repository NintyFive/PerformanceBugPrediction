[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69312800","html_url":"https://github.com/elastic/elasticsearch/issues/9081#issuecomment-69312800","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9081","id":69312800,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzEyODAw","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-01-09T09:41:50Z","updated_at":"2015-01-09T09:41:50Z","author_association":"MEMBER","body":"Looks like we have a similar behavior for _recovery endpoint:\n\n```\nDELETE /_all\n\nPOST /movies/dvd/1\n{\n\"title\": \"Elasticsearch: the movie\"\n}\n\nPOST /library/book/1\n{\n\"title\": \"Elasticsearch: the definitve guide\"\n}\n\nGET /v*/_mapping\n\nreturns empty object\n\nGET /v*/_recovery\n\nreturns full list\n\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69312919","html_url":"https://github.com/elastic/elasticsearch/issues/9081#issuecomment-69312919","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9081","id":69312919,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzEyOTE5","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-01-09T09:43:13Z","updated_at":"2015-01-09T09:43:13Z","author_association":"CONTRIBUTOR","body":"I just made it an adoptme.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69320030","html_url":"https://github.com/elastic/elasticsearch/issues/9081#issuecomment-69320030","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9081","id":69320030,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzIwMDMw","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-01-09T10:53:50Z","updated_at":"2015-01-09T10:53:50Z","author_association":"MEMBER","body":"I did some research here. The problem seems to lie in a collision between APIs of lower components. The  `MetaData#concreteIndices()` method takes a list of wildcards/aliases/index names and resolves it to a concrete list of indices to operate on where an empty return means nothing is to be done.  The _status API (which is deprecated btw) and the _recovery API both pass this list to `RoutingTable#allAssignedShardsGrouped` which interprets an empty list to mean all of the indices. Gut feeling says the latter should change and return no shards (because it was _probably_ not updated when the `IndexOptions` mechanics were introduced) but it's a deep component - we need research the implications.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/71192688","html_url":"https://github.com/elastic/elasticsearch/issues/9081#issuecomment-71192688","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9081","id":71192688,"node_id":"MDEyOklzc3VlQ29tbWVudDcxMTkyNjg4","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-01-23T13:27:31Z","updated_at":"2015-01-23T13:27:31Z","author_association":"MEMBER","body":"Starting to look into this one. Since I'm not familiar with the _recovery api so far I started there and just saw that from the example about also\n\nGET /vfoobar/_recovery?ignore_unavailable=true\nreturns the full list of indices.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75787343","html_url":"https://github.com/elastic/elasticsearch/issues/9081#issuecomment-75787343","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9081","id":75787343,"node_id":"MDEyOklzc3VlQ29tbWVudDc1Nzg3MzQz","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-02-24T16:16:35Z","updated_at":"2015-02-24T16:16:35Z","author_association":"MEMBER","body":"Removing the expansion of empty list of indices in RoutingTable#allAssignedShardsGrouped solves the problem for the `_recovery` endpoint, but I'm not sure what the implications are for other operations using that method. From what I see so far these are\n- TransportRefreshAction\n- TransportIndicesStatsAction\n\nNot sure if the semantics of \"empty indices\" can mean \"all indices\" in these cases.\n\nAn alternative on changing the RoutingTable implementaion would be to set always set the RecoveryRequest \"allowNoIndices\" option to false. In that case when after expanding wildcards no index is matched we throw an IndexMissingException in MetaData#convertFromWildcards.\n\nThere are also at least four other places in RoutingTable where empty index lists are expanded like:\n\n```\nif (indices == null || indices.length == 0) {\n            indices = indicesRouting.keySet().toArray(new String[indicesRouting.keySet().size()]);\n}\n```\n\nNot sure if all of these should be looked at. I experimentally tried removing all of them but got some test failures after that, so it seems to depend on context when empty index list as input should be treated as \"all\" or \"none\".\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76417436","html_url":"https://github.com/elastic/elasticsearch/issues/9081#issuecomment-76417436","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9081","id":76417436,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDE3NDM2","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-02-27T15:58:18Z","updated_at":"2015-02-27T15:58:18Z","author_association":"MEMBER","body":"I had a closer look at how the index wildcard pattern get resolved to concrete indices in `MetaData#concreteIndices()`. \nIf it would be 100% sure that any input that could means \"all indices\" (that is: null or empty String[] or \"_all\") resolves to concrete list of names, then any empty list that is returned from that method would actually mean that there actually really is no indices or aliases for that input. Then in Routingtable we could get rid of handling the cases where indices=null / empty are treated like \"all\". \nI think that is almost the case already. If wildcard-expansion is on (for open or closed) then the \"_all\" case is sure to be resolved in `MetaData#concreteIndices()`. I think there are some edge cases where `MetaData#concreteIndices()` with empty input index names can lead to NPEs (when both expand_open, expand_closed) are false. Not sure if those cases should be allowed at all?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76418223","html_url":"https://github.com/elastic/elasticsearch/issues/9081#issuecomment-76418223","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9081","id":76418223,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDE4MjIz","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2015-02-27T16:02:24Z","updated_at":"2015-02-27T16:02:24Z","author_association":"MEMBER","body":"I pushed a version where I removed the empty list expansion from the RoutingTable to https://github.com/cbuescher/elasticsearch/commit/5f52f9bc57094bc8703f522738ec562ae0313f57\nFixed all tests to pass there, not sure if I should open a PR for discussion?\n","performed_via_github_app":null}]