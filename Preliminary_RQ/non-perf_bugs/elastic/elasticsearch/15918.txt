{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15918","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15918/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15918/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15918/events","html_url":"https://github.com/elastic/elasticsearch/issues/15918","id":126099048,"node_id":"MDU6SXNzdWUxMjYwOTkwNDg=","number":15918,"title":"AccessControlException in JarHell#checkJarHell when running embedded for testing purposes","user":{"login":"trejkaz","id":43236,"node_id":"MDQ6VXNlcjQzMjM2","avatar_url":"https://avatars2.githubusercontent.com/u/43236?v=4","gravatar_id":"","url":"https://api.github.com/users/trejkaz","html_url":"https://github.com/trejkaz","followers_url":"https://api.github.com/users/trejkaz/followers","following_url":"https://api.github.com/users/trejkaz/following{/other_user}","gists_url":"https://api.github.com/users/trejkaz/gists{/gist_id}","starred_url":"https://api.github.com/users/trejkaz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trejkaz/subscriptions","organizations_url":"https://api.github.com/users/trejkaz/orgs","repos_url":"https://api.github.com/users/trejkaz/repos","events_url":"https://api.github.com/users/trejkaz/events{/privacy}","received_events_url":"https://api.github.com/users/trejkaz/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2016-01-12T05:07:27Z","updated_at":"2020-11-11T21:59:01Z","closed_at":"2016-02-03T08:53:31Z","author_association":"NONE","active_lock_reason":null,"body":"Our tests are run with a security manager enabled.\n\nAnother developer (who apparently disabled the security manager instead of reporting this) added a test which tries to start an elasticsearch node, which then tries to load plugins. Turns out that this calls `JarHell#checkJarHell`, which then pokes around the classpath in some fashion. The resulting `AccessControlException` is then presumably caught, but the code appears to then assume that there is \"jar hell\", rather than assuming that there isn't, which could possibly be the source of the issue.\n\nThis is occurring in v2.0.1.\n\nStack trace:\n\n```\njava.lang.IllegalStateException: failed to load bundle [] due to jar hell\n    at org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:342)\n    at org.elasticsearch.plugins.PluginsService.<init>(PluginsService.java:113)\n    at org.elasticsearch.node.Node.<init>(Node.java:144)\n    at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:145)\n    at org.elasticsearch.node.NodeBuilder.node(NodeBuilder.java:152)\n    at ElasticSearchTestUtils.createNode(ElasticSearchTestUtils.java:62)\n    at ElasticSearchTestUtils$1.<init>(ElasticSearchTestUtils.java:75)\n    at ElasticSearchTestUtils.createClient(ElasticSearchTestUtils.java:73)\n    at TestElasticSearchTextAnalysisService.setUp(TestElasticSearchTextAnalysisService.java:337)\n    (omitting JUnit frames)\nCaused by: java.security.AccessControlException: access denied (\"java.io.FilePermission\" \"/Applications/IntelliJ IDEA 15 CE.app/Contents/lib/idea_rt.jar\" \"read\")\n    at java.security.AccessControlContext.checkPermission(AccessControlContext.java:457)\n    at java.security.AccessController.checkPermission(AccessController.java:884)\n    at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)\n    at java.lang.SecurityManager.checkRead(SecurityManager.java:888)\n    at java.util.zip.ZipFile.<init>(ZipFile.java:211)\n    at java.util.zip.ZipFile.<init>(ZipFile.java:150)\n    at java.util.jar.JarFile.<init>(JarFile.java:166)\n    at java.util.jar.JarFile.<init>(JarFile.java:103)\n    at org.elasticsearch.bootstrap.JarHell.checkJarHell(JarHell.java:173)\n    at org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:340)\n    ... 18 more\n```\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}