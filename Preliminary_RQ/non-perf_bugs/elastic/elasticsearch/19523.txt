{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19523","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19523/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19523/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19523/events","html_url":"https://github.com/elastic/elasticsearch/issues/19523","id":166646396,"node_id":"MDU6SXNzdWUxNjY2NDYzOTY=","number":19523,"title":"wait_for_status param on /_cluster/health endpoint seems to return early, ignoring timeout parameter","user":{"login":"orangejulius","id":111716,"node_id":"MDQ6VXNlcjExMTcxNg==","avatar_url":"https://avatars3.githubusercontent.com/u/111716?v=4","gravatar_id":"","url":"https://api.github.com/users/orangejulius","html_url":"https://github.com/orangejulius","followers_url":"https://api.github.com/users/orangejulius/followers","following_url":"https://api.github.com/users/orangejulius/following{/other_user}","gists_url":"https://api.github.com/users/orangejulius/gists{/gist_id}","starred_url":"https://api.github.com/users/orangejulius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orangejulius/subscriptions","organizations_url":"https://api.github.com/users/orangejulius/orgs","repos_url":"https://api.github.com/users/orangejulius/repos","events_url":"https://api.github.com/users/orangejulius/events{/privacy}","received_events_url":"https://api.github.com/users/orangejulius/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-07-20T18:13:05Z","updated_at":"2016-07-20T21:38:53Z","closed_at":"2016-07-20T21:38:53Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3.3\n\n**JVM version**: 1.8.0_92\n\n**OS version**: Ubuntu 14.04 running 3.13.0-86-generic kernel\n\n**Description of the problem including expected versus actual behavior**:\n\nI'm using the `wait_for_status` option on the cluster health API to automate a script that needs to wait for a snapshot to be loaded. The snapshots I'm working with take about 45 minutes to load, so my initial plan was to issue a request like this, which would wait for up to an hour for the snapshot to load successfully:\n\n`curl 'http://myelasticsearchMachine:9200/_cluster/health/myNewIndexLoadedFromSnapshot?wait_for_status=green&timeout=3600s'`\n\nHowever, no matter what I do, the above request returns after exactly 60 seconds, regardless of whether or not the snapshot is loaded and the index in question is in the green state. I've worked around this for now by looping 100 times: the requests take a minute each until the state is green, after which time they return immediately. However it would be nice to be able to do just one request. \n\nHere's an example excerpt of the output of said loop which prints out a timestamp, then issues a wait_for_status request like the one above.\n\nAll the while this script was running, the overall cluster state was red, as was the state of the index in question. There is another index in the same cluster that is green, if that's somehow relevant.\n\n```\n+ curl 'http://pelias-es-dev2.iad.internal.mapzen.com:9200/_cluster/health/pelias-2016.07.06-214540?wait_for_status=green&timeout=300s'\n+ for i in '$(seq 100)'\n+ date -u\nWed Jul 20 18:06:57 UTC 2016\n+ curl 'http://pelias-es-dev2.iad.internal.mapzen.com:9200/_cluster/health/pelias-2016.07.06-214540?wait_for_status=green&timeout=300s'\n+ for i in '$(seq 100)'\n+ date -u\nWed Jul 20 18:07:57 UTC 2016\n+ curl 'http://pelias-es-dev2.iad.internal.mapzen.com:9200/_cluster/health/pelias-2016.07.06-214540?wait_for_status=green&timeout=300s'\n+ for i in '$(seq 100)'\n+ date -u\nWed Jul 20 18:08:57 UTC 2016\n+ curl 'http://pelias-es-dev2.iad.internal.mapzen.com:9200/_cluster/health/pelias-2016.07.06-214540?wait_for_status=green&timeout=300s'\n+ for i in '$(seq 100)'\n+ date -u\n```\n\nThis very well could be an issue on my part (I hope it is), but my read of the [cluster health](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-health.html#request-params) docs makes it seem like this should work.\n\n**Steps to reproduce**:\n1. Load a snapshot that takes a decent amount of time to restore\n2. Issue a cluster health API request with `wait_for_status=green` and `timeout=3600s` parameters\n3. API request should only return a response when the snapshot is done loading, but it returns after 1 minute regardless of the index status.\n\n**Provide logs (if relevant)**:\n","closed_by":{"login":"orangejulius","id":111716,"node_id":"MDQ6VXNlcjExMTcxNg==","avatar_url":"https://avatars3.githubusercontent.com/u/111716?v=4","gravatar_id":"","url":"https://api.github.com/users/orangejulius","html_url":"https://github.com/orangejulius","followers_url":"https://api.github.com/users/orangejulius/followers","following_url":"https://api.github.com/users/orangejulius/following{/other_user}","gists_url":"https://api.github.com/users/orangejulius/gists{/gist_id}","starred_url":"https://api.github.com/users/orangejulius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orangejulius/subscriptions","organizations_url":"https://api.github.com/users/orangejulius/orgs","repos_url":"https://api.github.com/users/orangejulius/repos","events_url":"https://api.github.com/users/orangejulius/events{/privacy}","received_events_url":"https://api.github.com/users/orangejulius/received_events","type":"User","site_admin":false},"performed_via_github_app":null}