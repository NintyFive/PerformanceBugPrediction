{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19852/events","html_url":"https://github.com/elastic/elasticsearch/issues/19852","id":169815874,"node_id":"MDU6SXNzdWUxNjk4MTU4NzQ=","number":19852,"title":"Old Gen Never Cleared","user":{"login":"djtecha","id":3084627,"node_id":"MDQ6VXNlcjMwODQ2Mjc=","avatar_url":"https://avatars1.githubusercontent.com/u/3084627?v=4","gravatar_id":"","url":"https://api.github.com/users/djtecha","html_url":"https://github.com/djtecha","followers_url":"https://api.github.com/users/djtecha/followers","following_url":"https://api.github.com/users/djtecha/following{/other_user}","gists_url":"https://api.github.com/users/djtecha/gists{/gist_id}","starred_url":"https://api.github.com/users/djtecha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djtecha/subscriptions","organizations_url":"https://api.github.com/users/djtecha/orgs","repos_url":"https://api.github.com/users/djtecha/repos","events_url":"https://api.github.com/users/djtecha/events{/privacy}","received_events_url":"https://api.github.com/users/djtecha/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-08-07T20:57:35Z","updated_at":"2016-08-08T16:30:54Z","closed_at":"2016-08-08T16:30:35Z","author_association":"NONE","active_lock_reason":null,"body":"java version \"1.8.0_92\"\nES 2.3.4\n\nSo, I have 4 nodes, each with 32GB dedicated to the heap space. After about 2 days the heap makes it's way up to over 90% and I start to get rolling outage. Checking the stats I notice that ALL of the heap stays in the old generation pool and never seems to clear out. I've tried switching to G1GC which seemed to help a little bit, I've tried messing with the NewGen Ratio and all sorts of other things, but in the end the old generation never clears and the cluster is unstable until I start restarting nodes. \n\nCurrent Run Options:\n\n/platform/jdk/bin/java -Xms32g -Xmx32g -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintClassHistogram -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/log/elasticsearch/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-UseParNewGC -XX:-UseConcMarkSweepGC -XX:+UseG1GC -XX:+PrintGCDetails -XX:NewRatio=4 -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/elasticsearch-2.3.4.jar:/usr/share/elasticsearch/lib/\\* org.elasticsearch.bootstrap.Elasticsearch start -Des.pidfile=/var/run/elasticsearch/elasticsearch.pid -Des.default.path.home=/usr/share/elasticsearch -Des.default.path.logs=/var/log/elasticsearch -Des.default.path.data=/var/lib/elasticsearch -Des.default.path.conf=/etc/elasticsearch\n\nelasticsearch.yaml\n# Cluster Settings\n\ncluster.name: elasticsearch \n\nnode.rack: \"East\"\nnode.name: \"es-1\"\nnode.max_local_storage_nodes: 1\n# Path Settings\n\npath.conf: /etc/elasticsearch\npath.data: /storage/elasticsearch \n# Lock memory for ES\n\nbootstrap.mlockall: true\n# Networking\n\nnetwork.host: [ _local_, _bond0_ ]\ndiscovery.zen.minimum_master_nodes: 3\ndiscovery.zen.ping.unicast.hosts: [\"es-1\", \"es-2\", \"es-3\", \"es-4\"]\n# CLUSTER\n\ncluster.routing.allocation.disk.watermark.high: \"95%\"\ncluster.routing.allocation.node_concurrent_recoveries: 30\ncluster.routing.allocation.cluster_concurrent_rebalance: 6\n# INDICES\n\nindices.store.throttle.max_bytes_per_sec: 400mb\n# Recovery\n\nindices.recovery.max_bytes_per_sec: 1000mb\nindices.recovery.concurrent_streams: 10\ngateway.recover_after_data_nodes: 2\ngateway.recover_after_time: 1m\ngateway.expected_data_nodes: 2\n# Field Data tweaks\n# indices.fielddata.cache.size:  20% #Evictions a large amount of garbage in memory, which must be garbage collected later on\n# Circuit Breaker\n\nindices.breaker.fielddata.limit: 25%\nindices.breaker.request.limit: 25%\nindices.breaker.total.limit: 50%\n# SLOW LOG\n\nindex.search.slowlog.threshold.query.warn: 10s\nindex.search.slowlog.threshold.fetch.warn: 1s\nindex.indexing.slowlog.threshold.index.warn: 10s\n# GC LOGGING\n\nmonitor.jvm.gc.young.warn: 1000ms\nmonitor.jvm.gc.young.info: 700ms\nmonitor.jvm.gc.young.debug: 400ms\nmonitor.jvm.gc.old.warn: 10s\nmonitor.jvm.gc.old.info: 5s\nmonitor.jvm.gc.old.debug: 2s\n","closed_by":{"login":"djtecha","id":3084627,"node_id":"MDQ6VXNlcjMwODQ2Mjc=","avatar_url":"https://avatars1.githubusercontent.com/u/3084627?v=4","gravatar_id":"","url":"https://api.github.com/users/djtecha","html_url":"https://github.com/djtecha","followers_url":"https://api.github.com/users/djtecha/followers","following_url":"https://api.github.com/users/djtecha/following{/other_user}","gists_url":"https://api.github.com/users/djtecha/gists{/gist_id}","starred_url":"https://api.github.com/users/djtecha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djtecha/subscriptions","organizations_url":"https://api.github.com/users/djtecha/orgs","repos_url":"https://api.github.com/users/djtecha/repos","events_url":"https://api.github.com/users/djtecha/events{/privacy}","received_events_url":"https://api.github.com/users/djtecha/received_events","type":"User","site_admin":false},"performed_via_github_app":null}