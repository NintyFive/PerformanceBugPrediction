[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52527190","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52527190","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52527190,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTI3MTkw","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T17:39:38Z","updated_at":"2014-08-18T17:39:38Z","author_association":"CONTRIBUTOR","body":"+1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52536171","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52536171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52536171,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTM2MTcx","user":{"login":"kevinkluge","id":468073,"node_id":"MDQ6VXNlcjQ2ODA3Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/468073?v=4","gravatar_id":"","url":"https://api.github.com/users/kevinkluge","html_url":"https://github.com/kevinkluge","followers_url":"https://api.github.com/users/kevinkluge/followers","following_url":"https://api.github.com/users/kevinkluge/following{/other_user}","gists_url":"https://api.github.com/users/kevinkluge/gists{/gist_id}","starred_url":"https://api.github.com/users/kevinkluge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kevinkluge/subscriptions","organizations_url":"https://api.github.com/users/kevinkluge/orgs","repos_url":"https://api.github.com/users/kevinkluge/repos","events_url":"https://api.github.com/users/kevinkluge/events{/privacy}","received_events_url":"https://api.github.com/users/kevinkluge/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T18:42:19Z","updated_at":"2014-08-18T18:42:19Z","author_association":"MEMBER","body":"I assume we'd add a configurable queue size and reject when the queue is full.  I like the idea; it would help debugging cases where management tools are loading the server.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52536461","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52536461","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52536461,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTM2NDYx","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T18:44:16Z","updated_at":"2014-08-18T18:44:16Z","author_association":"MEMBER","body":"the scaling thread pool today doesn't support rejection based on queue size (just an FYI). We can try and add this support, can be a bit tricky since it relies on rejection to add a thread or not. I think potentially the simplest solution is to make it fixed with a bounded queue size?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52537803","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52537803","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52537803,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTM3ODAz","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T18:54:24Z","updated_at":"2014-08-18T18:54:24Z","author_association":"CONTRIBUTOR","body":"Fixed with bounded queue size sounds like a good compromise; I'll try to take a stab at this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52541126","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52541126","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52541126,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTQxMTI2","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T19:20:13Z","updated_at":"2014-08-18T19:20:13Z","author_association":"CONTRIBUTOR","body":"OK all I changed was this:\n\n```\ndiff --git a/src/main/java/org/elasticsearch/threadpool/ThreadPool.java b/src/main/java/org/elasticsearch/threadpool/ThreadPool.java\nindex 0152c0e..19692e6 100644\n--- a/src/main/java/org/elasticsearch/threadpool/ThreadPool.java\n+++ b/src/main/java/org/elasticsearch/threadpool/ThreadPool.java\n@@ -119,7 +119,7 @@ public class ThreadPool extends AbstractComponent {\n                 .put(Names.SEARCH, settingsBuilder().put(\"type\", \"fixed\").put(\"size\", availableProcessors * 3).put(\"queue_size\", 1000).build())\n                 .put(Names.SUGGEST, settingsBuilder().put(\"type\", \"fixed\").put(\"size\", availableProcessors).put(\"queue_size\", 1000).build())\n                 .put(Names.PERCOLATE, settingsBuilder().put(\"type\", \"fixed\").put(\"size\", availableProcessors).put(\"queue_size\", 1000).build())\n-                .put(Names.MANAGEMENT, settingsBuilder().put(\"type\", \"scaling\").put(\"keep_alive\", \"5m\").put(\"size\", 5).build())\n+                .put(Names.MANAGEMENT, settingsBuilder().put(\"type\", \"fixed\").put(\"size\", availableProcessors).put(\"queue_size\", 100).build())\n                 .put(Names.FLUSH, settingsBuilder().put(\"type\", \"scaling\").put(\"keep_alive\", \"5m\").put(\"size\", halfProcMaxAt5).build())\n                 .put(Names.MERGE, settingsBuilder().put(\"type\", \"scaling\").put(\"keep_alive\", \"5m\").put(\"size\", halfProcMaxAt5).build())\n                 .put(Names.REFRESH, settingsBuilder().put(\"type\", \"scaling\").put(\"keep_alive\", \"5m\").put(\"size\", halfProcMaxAt10).build())\n```\n\nBut just to confirm: if the backlog tries to exceed 100 then ES will throw EsRejectedExecutionExc back to the client?  Looks like it will, because EsExecutors.newFixed passes new EsAbortPolicy()...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52541400","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52541400","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52541400,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTQxNDAw","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T19:22:15Z","updated_at":"2014-08-18T19:22:15Z","author_association":"MEMBER","body":"@mikemccand correct, changing to fix with bounded queue will cause rejections to be thrown. I think that availableProcessors as the value for the thread pool is too big, specifically for beefy machines, I would put there `Math.min(5, avaiableProcessors)`?, I think 5 threads should be enough, otherwise the operation is just too heavy and its a bug, a stats call should not be heavy (like using the usable space on file length issue).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52543145","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52543145","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52543145,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTQzMTQ1","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T19:35:49Z","updated_at":"2014-08-18T19:35:49Z","author_association":"CONTRIBUTOR","body":"OK, thanks @kimchy I'll switch to min(5, availableProcessors).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52543727","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52543727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52543727,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTQzNzI3","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T19:40:15Z","updated_at":"2014-08-18T19:40:15Z","author_association":"MEMBER","body":"ahh, we already have `halfProcMaxAt5`, maybe just use that one?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52543798","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-52543798","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":52543798,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTQzNzk4","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-08-18T19:40:53Z","updated_at":"2014-08-18T19:40:53Z","author_association":"CONTRIBUTOR","body":"Ahh super.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57285677","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-57285677","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":57285677,"node_id":"MDEyOklzc3VlQ29tbWVudDU3Mjg1Njc3","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-09-30T09:02:58Z","updated_at":"2014-09-30T09:02:58Z","author_association":"CONTRIBUTOR","body":"I've reverted this change, since it causes https://github.com/elasticsearch/elasticsearch/issues/7916 ...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153703820","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-153703820","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":153703820,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzcwMzgyMA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-04T12:23:44Z","updated_at":"2015-11-04T12:23:44Z","author_association":"MEMBER","body":"we should probably revisit this now that we have a different execution model for indices stats etc (#7990) . Reopening ....\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263008776","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-263008776","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":263008776,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzAwODc3Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-11-25T18:32:00Z","updated_at":"2016-11-25T18:32:00Z","author_association":"CONTRIBUTOR","body":"@jasontedor may be of interest to you?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372887641","html_url":"https://github.com/elastic/elasticsearch/issues/7318#issuecomment-372887641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7318","id":372887641,"node_id":"MDEyOklzc3VlQ29tbWVudDM3Mjg4NzY0MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-14T02:52:13Z","updated_at":"2018-03-14T02:52:13Z","author_association":"MEMBER","body":"Superseded by #18613","performed_via_github_app":null}]