{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17165","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17165/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17165/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17165/events","html_url":"https://github.com/elastic/elasticsearch/issues/17165","id":141557630,"node_id":"MDU6SXNzdWUxNDE1NTc2MzA=","number":17165,"title":"version_conflict_engine_exception with bulk update","user":{"login":"atm028","id":1595485,"node_id":"MDQ6VXNlcjE1OTU0ODU=","avatar_url":"https://avatars2.githubusercontent.com/u/1595485?v=4","gravatar_id":"","url":"https://api.github.com/users/atm028","html_url":"https://github.com/atm028","followers_url":"https://api.github.com/users/atm028/followers","following_url":"https://api.github.com/users/atm028/following{/other_user}","gists_url":"https://api.github.com/users/atm028/gists{/gist_id}","starred_url":"https://api.github.com/users/atm028/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atm028/subscriptions","organizations_url":"https://api.github.com/users/atm028/orgs","repos_url":"https://api.github.com/users/atm028/repos","events_url":"https://api.github.com/users/atm028/events{/privacy}","received_events_url":"https://api.github.com/users/atm028/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2016-03-17T11:36:15Z","updated_at":"2016-03-18T13:10:48Z","closed_at":"2016-03-17T13:38:01Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: \n\n```\n\"version\" : {\n    \"number\" : \"2.1.1\",\n    \"build_hash\" : \"40e2c53a6b6c2972b3d13846e450e66f4375bd71\",\n    \"build_timestamp\" : \"2015-12-15T13:05:55Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"5.3.1\"\n  }\n```\n\n**JVM version**:  \n\n```\n\"jvm\":{\"pid\":15324,\"version\":\"1.7.0_07\",\"vm_name\":\"Java HotSpot(TM) Client VM\",\"vm_version\":\"23.3-b01\",\"vm_vendor\":\"Oracle Corporation\",\"start_time_in_millis\":1458163388025,\"mem\":{\"heap_init_in_bytes\":268435456,\"heap_max_in_bytes\":1037959168,\"non_heap_init_in_bytes\":12746752,\"non_heap_max_in_bytes\":100663296,\"direct_max_in_bytes\":1037959168}\n```\n\n**OS version**: \n\n```\n\"os\":{\"refresh_interval_in_millis\":1000,\"name\":\"Windows Server 2008 R2\",\"arch\":\"x86\",\"version\":\"6.1\",\"available_processors\":4,\"allocated_processors\":4},\"process\":{\"refresh_interval_in_millis\":1000,\"id\":15324,\"mlockall\":false},\n```\n\n**Description of the problem including expected versus actual behavior**:\nI'm doing the document update with two bulk requests. The first request contains three updates and the second bulk request contains just one.\nFor the first bulk request the response is completely success but response for the second one said about version conflict.\nThe first request contains three updates of the document:\n\n```\n16:27:34.325 {ElasticSearch} \nHTTP Path: /_bulk \nHTTP POST Request: {\n....\n{\"update\": {\"_index\": \"session-2016.03.14\", \"_type\": \"session\", \"_id\": \"3\"}}\n{\"doc\":{\"states\":{\"state1\":{\"info\": \"some state info\"}}}}\n\n{\"update\": {\"_index\": \"session-2016.03.14\", \"_type\": \"session\", \"_id\": \"3\"}}\n{\"doc\":{\"states\":{\"state2\":{\"info\": \"some state info\"}}}}\n\n\n{\"update\": {\"_index\": \"session-2016.03.14\", \"_type\": \"session\", \"_id\": \"3\"}}\n{\"doc\":{\"states\":{\"state3\":{\"info\": \"some state info\"}}}}\n....\n```\n\nThen the second one which contains just one update:\n\n```\n16:27:34.334 {ElasticSearch} \nHTTP Path: /_bulk \nHTTP POST Request: \n{\"update\": {\"_index\": \"session-2016.03.14\", \"_type\": \"session\", \"_id\": \"3\"}}\n{\"doc\":{\"states\":{\"state4\":{\"info\": \"some state info\"}}}}\n```\n\nAnd then the response for first request where all statuses are 200:\n\n```\n16:27:34.391 {ElasticSearch} Response from ElasticSearch localhost:9200: \n(\"took\"=63,\"errors\"=\"false\",\"items\"=(\n\n\"JSON_ARRAY_ELEM\"=(\"update\"=(\"_index\"=\"session-2016.03.14\",\"_type\"=\"session\",\"_id\"=\"3\",\"_version\"=6,\"_shards\"=(\"total\"=2,\"successful\"=1,\"failed\"=0),\"status\"=200)),\n\n\"JSON_ARRAY_ELEM\"=(\"update\"=(\"_index\"=\"session-2016.03.14\",\"_type\"=\"session\",\"_id\"=\"3\",\"_version\"=7,\"_shards\"=(\"total\"=2,\"successful\"=1,\"failed\"=0),\"status\"=200)),\n\n\"JSON_ARRAY_ELEM\"=(\"update\"=(\"_index\"=\"session-2016.03.14\",\"_type\"=\"session\",\"_id\"=\"3\",\"_version\"=8,\"_shards\"=(\"total\"=2,\"successful\"=1,\"failed\"=0),\"status\"=200))))\n```\n\nAnd response for the second request with status 409:\n\n```\n16:27:34.391 {ElasticSearch} Response from ElasticSearch localhost:9200: \n(\"took\"=25,\"errors\"=\"true\",\"items\"=(\n...\n\"JSON_ARRAY_ELEM\"=(\"update\"=(\"_index\"=\"session-2016.03.14\",\"_type\"=\"session\",\"_id\"=\"3\",\"status\"=409,\"error\"=(\"type\"=\"version_conflict_engine_exception\",\"reason\"=\"[session][3]: version conflict, current [6], provided [5]\",\"index\"=\"session-2016.03.14\",\"shard\"=\"1\"))),\n....\n```\n\n**Steps to reproduce**:\n There is no some especial steps for reproduce, and I've observed it just once.\n\nAdditional info:\n\n```\n\"gc_collectors\":[\"Copy\",\"MarkSweepCompact\"],\"memory_pools\":[\"Code Cache\",\"Eden Space\",\"Survivor Space\",\"Tenured Gen\",\"Perm Gen\"]},\"thread_pool\":{\"generic\":{\"type\":\"cached\",\"keep_alive\":\"30s\",\"queue_size\":-1},\"index\":{\"type\":\"fixed\",\"min\":4,\"max\":4,\"queue_size\":200},\"fetch_shard_store\":{\"type\":\"scaling\",\"min\":1,\"max\":8,\"keep_alive\":\"5m\",\"queue_size\":-1},\"get\":{\"type\":\"fixed\",\"min\":4,\"max\":4,\"queue_size\":1000},\"snapshot\":{\"type\":\"scaling\",\"min\":1,\"max\":2,\"keep_alive\":\"5m\",\"queue_size\":-1},\"force_merge\":{\"type\":\"fixed\",\"min\":1,\"max\":1,\"queue_size\":-1},\"suggest\":{\"type\":\"fixed\",\"min\":4,\"max\":4,\"queue_size\":1000},\"bulk\":{\"type\":\"fixed\",\"min\":4,\"max\":4,\"queue_size\":50},\"warmer\":{\"type\":\"scaling\",\"min\":1,\"max\":2,\"keep_alive\":\"5m\",\"queue_size\":-1},\"flush\":{\"type\":\"scaling\",\"min\":1,\"max\":2,\"keep_alive\":\"5m\",\"queue_size\":-1},\"search\":{\"type\":\"fixed\",\"min\":7,\"max\":7,\"queue_size\":1000},\"fetch_shard_started\":{\"type\":\"scaling\",\"min\":1,\"max\":8,\"keep_alive\":\"5m\",\"queue_size\":-1},\"listener\":{\"type\":\"fixed\",\"min\":2,\"max\":2,\"queue_size\":-1},\"percolate\":{\"type\":\"fixed\",\"min\":4,\"max\":4,\"queue_size\":1000},\"refresh\":{\"type\":\"scaling\",\"min\":1,\"max\":2,\"keep_alive\":\"5m\",\"queue_size\":-1},\"management\":{\"type\":\"scaling\",\"min\":1,\"max\":5,\"keep_alive\":\"5m\",\"queue_size\":-1}},...\"max_content_length_in_bytes\":104857600},\"plugins\":[]}}}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}