{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21928","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21928/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21928/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21928/events","html_url":"https://github.com/elastic/elasticsearch/issues/21928","id":193054471,"node_id":"MDU6SXNzdWUxOTMwNTQ0NzE=","number":21928,"title":"/_termvectors sometimes throws NPE","user":{"login":"shaie","id":3469932,"node_id":"MDQ6VXNlcjM0Njk5MzI=","avatar_url":"https://avatars0.githubusercontent.com/u/3469932?v=4","gravatar_id":"","url":"https://api.github.com/users/shaie","html_url":"https://github.com/shaie","followers_url":"https://api.github.com/users/shaie/followers","following_url":"https://api.github.com/users/shaie/following{/other_user}","gists_url":"https://api.github.com/users/shaie/gists{/gist_id}","starred_url":"https://api.github.com/users/shaie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shaie/subscriptions","organizations_url":"https://api.github.com/users/shaie/orgs","repos_url":"https://api.github.com/users/shaie/repos","events_url":"https://api.github.com/users/shaie/events{/privacy}","received_events_url":"https://api.github.com/users/shaie/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-12-02T07:50:09Z","updated_at":"2016-12-06T16:29:27Z","closed_at":"2016-12-06T16:29:27Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Spinoff from #21906. I still hope to find the root cause of the NPE, and hopefully this isn't a Guice thing. For reference, here's the stacktrace:\r\n\r\n```\r\n[2016-12-01T11:59:13,208][WARN ][r.suppressed             ] path: /tv_bug/doc/_termvectors, params: {pretty=true, preference=_shards:1, index=tv_bug, type=doc}\r\norg.elasticsearch.transport.RemoteTransportException: [C-N1Zbn][127.0.0.1:9300][indices:data/read/tv[s]]\r\nCaused by: java.lang.NullPointerException\r\n        at org.elasticsearch.action.termvectors.TransportTermVectorsAction.shardOperation(TransportTermVectorsAction.java:79) ~[elasticsearch-5.0.1.jar:5.0.1]\r\n        at org.elasticsearch.action.termvectors.TransportTermVectorsAction.shardOperation(TransportTermVectorsAction.java:42) ~[elasticsearch-5.0.1.jar:5.0.1]\r\n        at org.elasticsearch.action.support.single.shard.TransportSingleShardAction$ShardTransportHandler.messageReceived(TransportSingleShardAction.java:293) ~[elasticsearch-5.0.1.jar:5.0.1]\r\n        at org.elasticsearch.action.support.single.shard.TransportSingleShardAction$ShardTransportHandler.messageReceived(TransportSingleShardAction.java:286) ~[elasticsearch-5.0.1.jar:5.0.1]\r\n        at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33) ~[elasticsearch-5.0.1.jar:5.0.1]\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:69) ~[elasticsearch-5.0.1.jar:5.0.1]\r\n        at org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:548) [elasticsearch-5.0.1.jar:5.0.1]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:520) [elasticsearch-5.0.1.jar:5.0.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.0.1.jar:5.0.1]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_92]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_92]\r\n        at java.lang.Thread.run(Thread.java:745) [?:1.8.0_92]\r\n```\r\n\r\nAnd here's the REST response\r\n\r\n```\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"remote_transport_exception\",\r\n        \"reason\" : \"[C-N1Zbn][127.0.0.1:9300][indices:data/read/tv[s]]\"\r\n      }\r\n    ],\r\n    \"type\" : \"null_pointer_exception\",\r\n    \"reason\" : null\r\n  },\r\n  \"status\" : 500\r\n}\r\n```","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}