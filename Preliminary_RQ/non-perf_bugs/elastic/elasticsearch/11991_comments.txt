[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/118010699","html_url":"https://github.com/elastic/elasticsearch/issues/11991#issuecomment-118010699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11991","id":118010699,"node_id":"MDEyOklzc3VlQ29tbWVudDExODAxMDY5OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-07-02T12:07:11Z","updated_at":"2015-07-02T12:07:11Z","author_association":"CONTRIBUTOR","body":"Hi @lenniboy \n\nGreat reproduction.  I think this is just a matter of timing.  The following demonstrates the same issue via the REST api:\n\n```\nDELETE t\nPUT /t\n{\n  \"mappings\": {\n    \"t\": {\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"suggestions\": {\n          \"type\": \"completion\",\n          \"payloads\": true\n        }\n      }\n    }\n  }\n}\n\nPOST /t/t/_bulk\n{\"index\":{\"_id\":1}}\n{\"name\":\"Queen\",\"suggestions\":{\"input\":[\"Queen\"],\"output\":\"Queen\",\"payload\":{\"country\":\"old\"}}}\n{\"update\":{\"_id\":1}}\n{\"doc\":{\"suggestions\":{\"payload\":{\"country\":\"new\"}}}}\n\nGET /t/_suggest\n{\n  \"s1\": {\n    \"text\": \"Queen\",\n    \"completion\": {\n      \"field\": \"suggestions\"\n    }\n  }\n}\n```\n\nIn the current suggester, deleted documents are not taken into account, which I think is what you're seeing. The output is deduplicated, leaving the older version to take precedence.\n\nUnfortunately, this is not something we can fix in the current suggester. 2.0 is going to have a completely new implementation (see #11740) which will take deletions into account.\n","performed_via_github_app":null}]