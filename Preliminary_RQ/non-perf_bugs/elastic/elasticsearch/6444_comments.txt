[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/45593527","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-45593527","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":45593527,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTkzNTI3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-06-10T09:42:43Z","updated_at":"2014-06-10T09:42:43Z","author_association":"CONTRIBUTOR","body":"This code https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/search/suggest/context/ContextMapping.java#L300 expects to receive a query for each context, but doesn't have a default value if a context is missing, or doesn't throw an error if a context is missing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/45593597","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-45593597","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":45593597,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTkzNTk3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-06-10T09:43:35Z","updated_at":"2014-06-10T09:43:35Z","author_association":"CONTRIBUTOR","body":"I assume that contexts are required? No way to handle the \"all\" case for a particular context? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/45631939","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-45631939","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":45631939,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NjMxOTM5","user":{"login":"bigerock","id":4642901,"node_id":"MDQ6VXNlcjQ2NDI5MDE=","avatar_url":"https://avatars0.githubusercontent.com/u/4642901?v=4","gravatar_id":"","url":"https://api.github.com/users/bigerock","html_url":"https://github.com/bigerock","followers_url":"https://api.github.com/users/bigerock/followers","following_url":"https://api.github.com/users/bigerock/following{/other_user}","gists_url":"https://api.github.com/users/bigerock/gists{/gist_id}","starred_url":"https://api.github.com/users/bigerock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bigerock/subscriptions","organizations_url":"https://api.github.com/users/bigerock/orgs","repos_url":"https://api.github.com/users/bigerock/repos","events_url":"https://api.github.com/users/bigerock/events{/privacy}","received_events_url":"https://api.github.com/users/bigerock/received_events","type":"User","site_admin":false},"created_at":"2014-06-10T15:46:54Z","updated_at":"2014-06-10T15:46:54Z","author_association":"NONE","body":"are you saying it needs a query? i'm not following.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/46144506","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-46144506","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":46144506,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MTQ0NTA2","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2014-06-16T06:23:20Z","updated_at":"2014-06-16T06:23:20Z","author_association":"MEMBER","body":"This looks like a bug indeed, as the mapping allows you to specify defaults, you should be able to so specify something like `\"location\": {}` in your query to make sure it uses the default location in the mapping. Alternatively an empty context in a query should fallback to the defaults and not raise NPEs\n\n```\nPOST services/_suggest?pretty'\n{\n\"suggest\" : {\n\"text\" : \"m\",\n\"completion\" : {\n\"field\" : \"suggest_field\",\n\"size\": 10,\n\"context\": {\n}\n}\n}\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/46373139","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-46373139","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":46373139,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzczMTM5","user":{"login":"benjamin-smith","id":1483102,"node_id":"MDQ6VXNlcjE0ODMxMDI=","avatar_url":"https://avatars2.githubusercontent.com/u/1483102?v=4","gravatar_id":"","url":"https://api.github.com/users/benjamin-smith","html_url":"https://github.com/benjamin-smith","followers_url":"https://api.github.com/users/benjamin-smith/followers","following_url":"https://api.github.com/users/benjamin-smith/following{/other_user}","gists_url":"https://api.github.com/users/benjamin-smith/gists{/gist_id}","starred_url":"https://api.github.com/users/benjamin-smith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benjamin-smith/subscriptions","organizations_url":"https://api.github.com/users/benjamin-smith/orgs","repos_url":"https://api.github.com/users/benjamin-smith/repos","events_url":"https://api.github.com/users/benjamin-smith/events{/privacy}","received_events_url":"https://api.github.com/users/benjamin-smith/received_events","type":"User","site_admin":false},"created_at":"2014-06-17T22:18:17Z","updated_at":"2014-06-17T22:18:17Z","author_association":"NONE","body":"I had a very similar issue, and passing in an empty object for any context items that I did not want to specify got rid of the NPE error.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/51307147","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-51307147","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":51307147,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMzA3MTQ3","user":{"login":"shoteff","id":8372129,"node_id":"MDQ6VXNlcjgzNzIxMjk=","avatar_url":"https://avatars3.githubusercontent.com/u/8372129?v=4","gravatar_id":"","url":"https://api.github.com/users/shoteff","html_url":"https://github.com/shoteff","followers_url":"https://api.github.com/users/shoteff/followers","following_url":"https://api.github.com/users/shoteff/following{/other_user}","gists_url":"https://api.github.com/users/shoteff/gists{/gist_id}","starred_url":"https://api.github.com/users/shoteff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoteff/subscriptions","organizations_url":"https://api.github.com/users/shoteff/orgs","repos_url":"https://api.github.com/users/shoteff/repos","events_url":"https://api.github.com/users/shoteff/events{/privacy}","received_events_url":"https://api.github.com/users/shoteff/received_events","type":"User","site_admin":false},"created_at":"2014-08-06T08:31:19Z","updated_at":"2014-08-06T08:31:19Z","author_association":"NONE","body":"I also think this should be considered a bug.\nAccording to the ES documentation for the category query:\nhttp://www.elasticsearch.org/guide/en/elasticsearch/reference/current/suggester-context.html#_category_query\n\n> A query within a category works similar to the configuration. If the value is null the mappings default categories will be used. Otherwise the suggestion takes place for all documents that have at least one category in common with the query.\n\nIt works if the context value is explicitly set to _null_, but it doesn't work if the context value is not provided at all (even if there is default value in the mapping)\n\nThis works:\n\n```\n{\n  \"suggest\": {\n    \"text\": \"a\",\n    \"completion\": {\n      \"field\": \"my_autocomplete\",\n      \"size\": 10,\n      \"context\": {\n        \"_type\" : \"tweet\",\n        \"additional_name\": null\n      }\n    }\n  }\n}\n```\n\nAnd this doesn't:\n\n```\n{\n  \"suggest\": {\n    \"text\": \"a\",\n    \"completion\": {\n      \"field\": \"my_autocomplete\",\n      \"size\": 10,\n      \"context\": {\n        \"_type\" : \"tweet\"\n      }\n    }\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64408912","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64408912","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64408912,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NDA4OTEy","user":{"login":"missinglink","id":738069,"node_id":"MDQ6VXNlcjczODA2OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/738069?v=4","gravatar_id":"","url":"https://api.github.com/users/missinglink","html_url":"https://github.com/missinglink","followers_url":"https://api.github.com/users/missinglink/followers","following_url":"https://api.github.com/users/missinglink/following{/other_user}","gists_url":"https://api.github.com/users/missinglink/gists{/gist_id}","starred_url":"https://api.github.com/users/missinglink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/missinglink/subscriptions","organizations_url":"https://api.github.com/users/missinglink/orgs","repos_url":"https://api.github.com/users/missinglink/repos","events_url":"https://api.github.com/users/missinglink/events{/privacy}","received_events_url":"https://api.github.com/users/missinglink/received_events","type":"User","site_admin":false},"created_at":"2014-11-25T14:43:06Z","updated_at":"2014-11-26T07:59:32Z","author_association":"CONTRIBUTOR","body":"FWIW I agree that this functionality should be changed / fixed.\n\n### background\n\nES allows you to define [completion suggesters](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-suggesters-completion.html), defined by `\"type\": \"completion\"` in your mapping, which contain [context suggesters](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/suggester-context.html) which can be either 'category' or 'geo'. These provide a means of reducing the documents returned by the suggester for the given input text.\n\nYou can optionally provide a `default` value for each context suggester, which is only used; at index time; when the document you send to be indexed is missing a value for that context.\n\n### the problem\n\n**All** of the defined contexts **must** be specified when sending a query to `/_suggest`. Failing to do so will result in the cryptic error `ElasticsearchException[failed to execute suggest]; nested: NullPointerException;`. ..as per @spinscale comment\n\nSome people above commented about the `default` value, which has nothing to do with the query, don't confuse this with **omitting the context in the query** which is what I believe everyone really wants.\n\n@shoteff if you read that passage again it refers to index time, not to query time.\n\n### use-cases\n\nI'll give you my use-case to give some context about how I would like to use it.\n\nWe are indexing 50M places of interest around the globe, and for each I would like to have 1x 'category' context for its 'class' (think restaurant/bar/cafe) in addition to the 1x 'geo' context used to target geo-relevant documents.\n\nWho doesn't want autocomplete for all the bars near their house? am I right?\n\nProblem is.. once I introduce the 'class' context I can no longer query for 'all' documents in the UK.\nI am now forced to specify a 'class' on every single request, or worse, send a list of _every_ class with every query. Sending 'key:null' as per previous comments does not remedy this issue.\n\nFWIW: The problem defined above also applies to using the 'geo' context on it's own and not specifying a lat/lon at query time, which means you can never query at `precision:0`, and can never have autocomplete for the whole globe.\n\n## test-case / game\n\nI put together a testcase for you to explain what's going on, it's the game 'Guess Who?' which you should all remember from your youth. I hope you enjoy @clintongormley, @markharwood  ;)\n\n``` bash\n#!/bin/bash\n\n################################################\n# Let's play Guess Who? in Elasticsearch!!\n################################################\n\nES='localhost:9200';\n\n# drop index\ncurl -XDELETE \"$ES/guesswho?pretty=true\" 2>/dev/null;\n\n# create index\ncurl -XPUT \"$ES/guesswho?pretty=true\" -d'\n{ \n  \"settings\": {\n    \"index\": {\n      \"number_of_shards\": 1,\n      \"number_of_replicas\": 0\n    }\n  },\n  \"mappings\": {\n    \"character\": {\n      \"properties\": {\n        \"name\": { \"type\": \"string\" },\n        \"sex\": { \"type\": \"string\" },\n        \"hair\": { \"type\": \"string\" },\n        \"eyes\": { \"type\": \"string\" },\n        \"wears\": { \"type\": \"string\" },\n        \"guess\": {\n          \"type\": \"completion\",\n          \"payloads\": \"false\",\n          \"preserve_separators\": \"false\",\n          \"preserve_position_increments\": \"false\",\n          \"max_input_length\": \"50\",\n          \"context\": {\n            \"sex\": {\n              \"type\": \"category\",\n              \"path\": \"sex\",\n              \"default\": \"unknown\"\n            },\n            \"hair\": {\n              \"type\": \"category\",\n              \"path\": \"hair\",\n              \"default\": \"unknown\"\n            },\n            \"eyes\": {\n              \"type\": \"category\",\n              \"path\": \"eyes\",\n              \"default\": \"unknown\"\n            },\n            \"wears\": {\n              \"type\": \"category\",\n              \"path\": \"wears\",\n              \"default\": \"unknown\"\n            }\n          }\n        }\n      }\n    }\n  }\n}';\n\n# Index some characters\nindex_character() {\n  curl -XPOST \"$ES/guesswho/character/$1?pretty=true\" -d'\n  {\n    \"name\":\"'\"$1\"'\",\n    \"sex\":\"'\"$2\"'\",\n    \"hair\":\"'\"$3\"'\",\n    \"eyes\":\"'\"$4\"'\",\n    \"wears\":\"'\"$5\"'\",\n    \"guess\": {\n      \"input\": [ \"'\"$1\"'\" ],\n      \"output\": \"'\"$1 is $2 with $3 hair, $4 eyes and wears $5\"'\"\n    }\n  }';\n}\n\n# src: http://www.buzzfeed.com/kenblom/the-game-of-guess-who-and-their-celebrity-dopplgangers\nindex_character \"bernard\" \"male\" \"red\" \"red\" \"a fedora\";\nindex_character \"anne\" \"female\" \"black\" \"red\" \"earrings\";\nindex_character \"eric\" \"male\" \"blond\" \"yellow\" \"a sailor hat\";\nindex_character \"george\" \"male\" \"grey\" \"red\" \"a detective hat\";\nindex_character \"herman\" \"male\" \"blond\" \"red\" \"nothing\";\nindex_character \"alfred\" \"male\" \"blond\" \"blue\" \"frown\";\nindex_character \"mystery\" \"unknown\" \"unknown\" \"unknown\" \"unknown\";\n\n# Refresh index\ncurl -XPOST \"$ES/guesswho/_refresh\";\n\n# The fun is trying to guess when you play Guess Who?\nguess_character_without_context() {\n  curl -XPOST \"$ES/guesswho/_suggest?pretty=true\" -d'\n  {\n    \"guesswho\": {\n      \"text\":\"'\"$1\"'\",\n      \"completion\": {\n        \"size\": \"10\",\n        \"field\": \"guess\"\n      }\n    }\n  }';\n}\n\nguess_character_by_sex() {\n  curl -XPOST \"$ES/guesswho/_suggest?pretty=true\" -d'\n  {\n    \"guesswho\": {\n      \"text\":\"'\"$1\"'\",\n      \"completion\": {\n        \"size\": \"10\",\n        \"field\": \"guess\",\n        \"context\": {\n          \"sex\":\"'\"$2\"'\"\n        }\n      }\n    }\n  }';\n}\n\nguess_character_by_specifying_everything() {\n  curl -XPOST \"$ES/guesswho/_suggest?pretty=true\" -d'\n  {\n    \"guesswho\": {\n      \"text\":\"'\"$1\"'\",\n      \"completion\": {\n        \"size\": \"10\",\n        \"field\": \"guess\",\n        \"context\": {\n          \"sex\":\"'\"$2\"'\",\n          \"hair\":\"'\"$3\"'\",\n          \"eyes\":\"'\"$4\"'\",\n          \"wears\":\"'\"$5\"'\"\n        }\n      }\n    }\n  }';\n}\n\nguess_character_without_context \"a\";\n# ElasticsearchIllegalArgumentException[suggester [completion] requires context to be setup]\n\nguess_character_by_sex \"a\" \"male\";\n# ElasticsearchException[failed to execute suggest]; nested: NullPointerException;\n\nguess_character_by_specifying_everything \"a\" \"male\" \"blond\" \"blue\" \"frown\";\n# I win, play again?\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64413957","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64413957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64413957,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NDEzOTU3","user":{"login":"shoteff","id":8372129,"node_id":"MDQ6VXNlcjgzNzIxMjk=","avatar_url":"https://avatars3.githubusercontent.com/u/8372129?v=4","gravatar_id":"","url":"https://api.github.com/users/shoteff","html_url":"https://github.com/shoteff","followers_url":"https://api.github.com/users/shoteff/followers","following_url":"https://api.github.com/users/shoteff/following{/other_user}","gists_url":"https://api.github.com/users/shoteff/gists{/gist_id}","starred_url":"https://api.github.com/users/shoteff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoteff/subscriptions","organizations_url":"https://api.github.com/users/shoteff/orgs","repos_url":"https://api.github.com/users/shoteff/repos","events_url":"https://api.github.com/users/shoteff/events{/privacy}","received_events_url":"https://api.github.com/users/shoteff/received_events","type":"User","site_admin":false},"created_at":"2014-11-25T15:13:04Z","updated_at":"2014-11-25T15:13:04Z","author_association":"NONE","body":"@missinglink thank you, I think I messed up the index and query time stuff, but fortunately you got the idea :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64529567","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64529567","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64529567,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NTI5NTY3","user":{"login":"missinglink","id":738069,"node_id":"MDQ6VXNlcjczODA2OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/738069?v=4","gravatar_id":"","url":"https://api.github.com/users/missinglink","html_url":"https://github.com/missinglink","followers_url":"https://api.github.com/users/missinglink/followers","following_url":"https://api.github.com/users/missinglink/following{/other_user}","gists_url":"https://api.github.com/users/missinglink/gists{/gist_id}","starred_url":"https://api.github.com/users/missinglink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/missinglink/subscriptions","organizations_url":"https://api.github.com/users/missinglink/orgs","repos_url":"https://api.github.com/users/missinglink/repos","events_url":"https://api.github.com/users/missinglink/events{/privacy}","received_events_url":"https://api.github.com/users/missinglink/received_events","type":"User","site_admin":false},"created_at":"2014-11-26T08:28:57Z","updated_at":"2014-11-26T08:28:57Z","author_association":"CONTRIBUTOR","body":"cc/ @chilling @areek\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64799312","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64799312","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64799312,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Nzk5MzEy","user":{"login":"sschuerz","id":9714324,"node_id":"MDQ6VXNlcjk3MTQzMjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/9714324?v=4","gravatar_id":"","url":"https://api.github.com/users/sschuerz","html_url":"https://github.com/sschuerz","followers_url":"https://api.github.com/users/sschuerz/followers","following_url":"https://api.github.com/users/sschuerz/following{/other_user}","gists_url":"https://api.github.com/users/sschuerz/gists{/gist_id}","starred_url":"https://api.github.com/users/sschuerz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sschuerz/subscriptions","organizations_url":"https://api.github.com/users/sschuerz/orgs","repos_url":"https://api.github.com/users/sschuerz/repos","events_url":"https://api.github.com/users/sschuerz/events{/privacy}","received_events_url":"https://api.github.com/users/sschuerz/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T14:54:46Z","updated_at":"2014-11-27T14:54:46Z","author_association":"NONE","body":"So what is the value that I have to set if I _don't_ want restrict the context for a particular field in \"context\"? Using null only gives me the documents that really have null for this field. Using an empty object results in a NullPointerException. Does anyone have a solution for this problem?\nI use elasticsearch 1.4.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64802783","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64802783","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64802783,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODAyNzgz","user":{"login":"missinglink","id":738069,"node_id":"MDQ6VXNlcjczODA2OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/738069?v=4","gravatar_id":"","url":"https://api.github.com/users/missinglink","html_url":"https://github.com/missinglink","followers_url":"https://api.github.com/users/missinglink/followers","following_url":"https://api.github.com/users/missinglink/following{/other_user}","gists_url":"https://api.github.com/users/missinglink/gists{/gist_id}","starred_url":"https://api.github.com/users/missinglink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/missinglink/subscriptions","organizations_url":"https://api.github.com/users/missinglink/orgs","repos_url":"https://api.github.com/users/missinglink/repos","events_url":"https://api.github.com/users/missinglink/events{/privacy}","received_events_url":"https://api.github.com/users/missinglink/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T15:24:26Z","updated_at":"2014-11-27T15:28:01Z","author_association":"CONTRIBUTOR","body":"Hey @sschuerz there are currently no 'solutions' for this issue, it will require a change to the codebase to fix.\n\nTwo absolute hacks come to mind; which I feel dirty for mentioning, but I will anyway.\n1. add `'*'` (or any other token) to _every_ 'category' context for _every_ record and then use that as your catchall.\n2. somehow collect a list of _all_ possible values of a context and send the entire list with _every_ request to `/_suggest`.\n\nThey are both awful hacks but should work, I am currently considering whether to consider consideration of them myself.\n\nIf you are using the 'geo' context then you're unfortunately out of luck, I don't think there is a hack to allow you to query the whole planet.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64803682","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64803682","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64803682,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODAzNjgy","user":{"login":"shoteff","id":8372129,"node_id":"MDQ6VXNlcjgzNzIxMjk=","avatar_url":"https://avatars3.githubusercontent.com/u/8372129?v=4","gravatar_id":"","url":"https://api.github.com/users/shoteff","html_url":"https://github.com/shoteff","followers_url":"https://api.github.com/users/shoteff/followers","following_url":"https://api.github.com/users/shoteff/following{/other_user}","gists_url":"https://api.github.com/users/shoteff/gists{/gist_id}","starred_url":"https://api.github.com/users/shoteff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoteff/subscriptions","organizations_url":"https://api.github.com/users/shoteff/orgs","repos_url":"https://api.github.com/users/shoteff/repos","events_url":"https://api.github.com/users/shoteff/events{/privacy}","received_events_url":"https://api.github.com/users/shoteff/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T15:30:23Z","updated_at":"2014-11-27T15:30:23Z","author_association":"NONE","body":"Actually I'm using the 1-st scenario, using a script I'm adding '*' to the list of the categories, so I can always have it as catchall\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64804121","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64804121","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64804121,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODA0MTIx","user":{"login":"missinglink","id":738069,"node_id":"MDQ6VXNlcjczODA2OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/738069?v=4","gravatar_id":"","url":"https://api.github.com/users/missinglink","html_url":"https://github.com/missinglink","followers_url":"https://api.github.com/users/missinglink/followers","following_url":"https://api.github.com/users/missinglink/following{/other_user}","gists_url":"https://api.github.com/users/missinglink/gists{/gist_id}","starred_url":"https://api.github.com/users/missinglink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/missinglink/subscriptions","organizations_url":"https://api.github.com/users/missinglink/orgs","repos_url":"https://api.github.com/users/missinglink/repos","events_url":"https://api.github.com/users/missinglink/events{/privacy}","received_events_url":"https://api.github.com/users/missinglink/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T15:34:26Z","updated_at":"2014-11-27T15:34:26Z","author_association":"CONTRIBUTOR","body":"This is not an acceptable solution to this issue, but I appreciate that we both came up with the same hacky workaround :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64805533","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64805533","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64805533,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODA1NTMz","user":{"login":"sschuerz","id":9714324,"node_id":"MDQ6VXNlcjk3MTQzMjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/9714324?v=4","gravatar_id":"","url":"https://api.github.com/users/sschuerz","html_url":"https://github.com/sschuerz","followers_url":"https://api.github.com/users/sschuerz/followers","following_url":"https://api.github.com/users/sschuerz/following{/other_user}","gists_url":"https://api.github.com/users/sschuerz/gists{/gist_id}","starred_url":"https://api.github.com/users/sschuerz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sschuerz/subscriptions","organizations_url":"https://api.github.com/users/sschuerz/orgs","repos_url":"https://api.github.com/users/sschuerz/repos","events_url":"https://api.github.com/users/sschuerz/events{/privacy}","received_events_url":"https://api.github.com/users/sschuerz/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T15:46:38Z","updated_at":"2014-11-27T15:46:38Z","author_association":"NONE","body":"Thank you for the responses, @missinglink and @shoteff. I think I'll use the first scenario because collecting a list is very unhandy in my context.\n@shoteff: Could you please provide an example for such a script?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64808177","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64808177","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64808177,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODA4MTc3","user":{"login":"missinglink","id":738069,"node_id":"MDQ6VXNlcjczODA2OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/738069?v=4","gravatar_id":"","url":"https://api.github.com/users/missinglink","html_url":"https://github.com/missinglink","followers_url":"https://api.github.com/users/missinglink/followers","following_url":"https://api.github.com/users/missinglink/following{/other_user}","gists_url":"https://api.github.com/users/missinglink/gists{/gist_id}","starred_url":"https://api.github.com/users/missinglink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/missinglink/subscriptions","organizations_url":"https://api.github.com/users/missinglink/orgs","repos_url":"https://api.github.com/users/missinglink/repos","events_url":"https://api.github.com/users/missinglink/events{/privacy}","received_events_url":"https://api.github.com/users/missinglink/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T16:11:31Z","updated_at":"2014-11-27T16:17:04Z","author_association":"CONTRIBUTOR","body":"I think what @shoteff is referring to is below, which I would like to re-iterate is a hack for the following 3 reasons:\n- still requires you to know and specify all contexts in every query, plus know the magic token.\n- extra overhead at index time, prone to error\n- potentially fills the FST with bloat (may be negligible due to the data-structure)\n\n``` bash\nindex_character() {\n  curl -XPOST \"$ES/guesswho/character/$1?pretty=true\" -d'\n  {\n    \"name\":[\"*\",\"'\"$1\"'\"],\n    \"sex\":[\"*\",\"'\"$2\"'\"],\n    \"hair\":[\"*\",\"'\"$3\"'\"],\n    \"eyes\":[\"*\",\"'\"$4\"'\"],\n    \"wears\":[\"*\",\"'\"$5\"'\"],\n    \"guess\": {\n      \"input\": [ \"'\"$1\"'\" ],\n      \"output\": \"'\"$1 is $2 with $3 hair, $4 eyes and wears $5\"'\"\n    }\n  }';\n}\n```\n\n``` bash\nguess_character_by_hack() {\n  curl -XPOST \"$ES/guesswho/_suggest?pretty=true\" -d'\n  {\n    \"guesswho\": {\n      \"text\":\"'\"$1\"'\",\n      \"completion\": {\n        \"size\": \"10\",\n        \"field\": \"guess\",\n        \"context\": {\n          \"sex\":\"'\"$2\"'\",\n          \"hair\":\"*\",\n          \"eyes\":\"*\",\n          \"wears\":\"*\"\n        }\n      }\n    }\n  }';\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64811836","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64811836","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64811836,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODExODM2","user":{"login":"missinglink","id":738069,"node_id":"MDQ6VXNlcjczODA2OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/738069?v=4","gravatar_id":"","url":"https://api.github.com/users/missinglink","html_url":"https://github.com/missinglink","followers_url":"https://api.github.com/users/missinglink/followers","following_url":"https://api.github.com/users/missinglink/following{/other_user}","gists_url":"https://api.github.com/users/missinglink/gists{/gist_id}","starred_url":"https://api.github.com/users/missinglink/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/missinglink/subscriptions","organizations_url":"https://api.github.com/users/missinglink/orgs","repos_url":"https://api.github.com/users/missinglink/repos","events_url":"https://api.github.com/users/missinglink/events{/privacy}","received_events_url":"https://api.github.com/users/missinglink/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T16:46:02Z","updated_at":"2014-11-27T17:23:16Z","author_association":"CONTRIBUTOR","body":"My java is terrible, the `java.lang.NullPointerException` seems to be caused here: https://github.com/elasticsearch/elasticsearch/blob/8aebb9656b63148190076bd8cdc5be0e87a9923d/src/main/java/org/elasticsearch/search/suggest/context/ContextMapping.java#L286\n\nmore specifically..\nhttps://github.com/elasticsearch/elasticsearch/blob/8aebb9656b63148190076bd8cdc5be0e87a9923d/src/main/java/org/elasticsearch/search/suggest/context/ContextMapping.java#L303-L306\n\nmore input from someone who knows more would be very welcome, it seems like an easy fix @spinscale?\n\n``` bash\n[2014-11-27 17:42:57,161][DEBUG][action.suggest           ] [Nobilus] [guesswho][0], node[pPxp4aPKSyW9GDmX39YF3Q], [P], s[STARTED]: failed to executed [[[guesswho]], suggestSource[\n  {\n    \"guesswho\": {\n      \"text\":\"a\",\n      \"completion\": {\n        \"size\": \"10\",\n        \"field\": \"guess\",\n        \"context\": {\n          \"sex\":\"male\"\n        }\n      }\n    }\n  }]]\norg.elasticsearch.ElasticsearchException: failed to execute suggest\n    at org.elasticsearch.action.suggest.TransportSuggestAction.shardOperation(TransportSuggestAction.java:166)\n    at org.elasticsearch.action.suggest.TransportSuggestAction.shardOperation(TransportSuggestAction.java:61)\n    at org.elasticsearch.action.support.broadcast.TransportBroadcastOperationAction$AsyncBroadcastAction$1.run(TransportBroadcastOperationAction.java:170)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.search.suggest.context.ContextMapping$ContextQuery.toAutomaton(ContextMapping.java:260)\n    at org.elasticsearch.search.suggest.completion.AnalyzingCompletionLookupProvider$2.getLookup(AnalyzingCompletionLookupProvider.java:270)\n    at org.elasticsearch.search.suggest.completion.Completion090PostingsFormat$CompletionTerms.getLookup(Completion090PostingsFormat.java:297)\n    at org.elasticsearch.search.suggest.completion.CompletionSuggester.innerExecute(CompletionSuggester.java:70)\n    at org.elasticsearch.search.suggest.completion.CompletionSuggester.innerExecute(CompletionSuggester.java:45)\n    at org.elasticsearch.search.suggest.Suggester.execute(Suggester.java:42)\n    at org.elasticsearch.search.suggest.SuggestPhase.execute(SuggestPhase.java:85)\n    at org.elasticsearch.action.suggest.TransportSuggestAction.shardOperation(TransportSuggestAction.java:161)\n    ... 5 more\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64813600","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64813600","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64813600,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODEzNjAw","user":{"login":"shoteff","id":8372129,"node_id":"MDQ6VXNlcjgzNzIxMjk=","avatar_url":"https://avatars3.githubusercontent.com/u/8372129?v=4","gravatar_id":"","url":"https://api.github.com/users/shoteff","html_url":"https://github.com/shoteff","followers_url":"https://api.github.com/users/shoteff/followers","following_url":"https://api.github.com/users/shoteff/following{/other_user}","gists_url":"https://api.github.com/users/shoteff/gists{/gist_id}","starred_url":"https://api.github.com/users/shoteff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shoteff/subscriptions","organizations_url":"https://api.github.com/users/shoteff/orgs","repos_url":"https://api.github.com/users/shoteff/repos","events_url":"https://api.github.com/users/shoteff/events{/privacy}","received_events_url":"https://api.github.com/users/shoteff/received_events","type":"User","site_admin":false},"created_at":"2014-11-27T17:03:43Z","updated_at":"2014-11-28T05:34:57Z","author_association":"NONE","body":"I'm using the following groovy script to add \"*\" to all the fields that are contexts:\n\n``` javascript\nif (![ctx._source.contextFieldName].contains('*')) ctx._source.contextFieldName = \n[ctx._source.contextFieldName] + '*'\n```\n\nReplace _contextFieldName_ with your context field\nAs an additional hack I'm also storing all the context field names in the __meta_ special field, so I can easily read them programatically (in my case the end user should be able to define them when creating the mapping)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64867846","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-64867846","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":64867846,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODY3ODQ2","user":{"login":"sschuerz","id":9714324,"node_id":"MDQ6VXNlcjk3MTQzMjQ=","avatar_url":"https://avatars0.githubusercontent.com/u/9714324?v=4","gravatar_id":"","url":"https://api.github.com/users/sschuerz","html_url":"https://github.com/sschuerz","followers_url":"https://api.github.com/users/sschuerz/followers","following_url":"https://api.github.com/users/sschuerz/following{/other_user}","gists_url":"https://api.github.com/users/sschuerz/gists{/gist_id}","starred_url":"https://api.github.com/users/sschuerz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sschuerz/subscriptions","organizations_url":"https://api.github.com/users/sschuerz/orgs","repos_url":"https://api.github.com/users/sschuerz/repos","events_url":"https://api.github.com/users/sschuerz/events{/privacy}","received_events_url":"https://api.github.com/users/sschuerz/received_events","type":"User","site_admin":false},"created_at":"2014-11-28T08:32:12Z","updated_at":"2014-11-28T08:32:12Z","author_association":"NONE","body":"Thank you very much @shoteff, the script works for me. However, this is a hacky solution and fixing the underlying problem in elasticsearch would be highly appreciated.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66684203","html_url":"https://github.com/elastic/elasticsearch/issues/6444#issuecomment-66684203","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6444","id":66684203,"node_id":"MDEyOklzc3VlQ29tbWVudDY2Njg0MjAz","user":{"login":"areek","id":753679,"node_id":"MDQ6VXNlcjc1MzY3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/753679?v=4","gravatar_id":"","url":"https://api.github.com/users/areek","html_url":"https://github.com/areek","followers_url":"https://api.github.com/users/areek/followers","following_url":"https://api.github.com/users/areek/following{/other_user}","gists_url":"https://api.github.com/users/areek/gists{/gist_id}","starred_url":"https://api.github.com/users/areek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/areek/subscriptions","organizations_url":"https://api.github.com/users/areek/orgs","repos_url":"https://api.github.com/users/areek/repos","events_url":"https://api.github.com/users/areek/events{/privacy}","received_events_url":"https://api.github.com/users/areek/received_events","type":"User","site_admin":false},"created_at":"2014-12-11T20:36:03Z","updated_at":"2014-12-11T20:36:03Z","author_association":"CONTRIBUTOR","body":"closing in favour of https://github.com/elasticsearch/elasticsearch/issues/8909\n","performed_via_github_app":null}]