{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37970","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37970/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37970/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37970/events","html_url":"https://github.com/elastic/elasticsearch/issues/37970","id":404313649,"node_id":"MDU6SXNzdWU0MDQzMTM2NDk=","number":37970,"title":"Not sufficient permissions to access license information on remote monitoring cluster","user":{"login":"radoondas","id":8320348,"node_id":"MDQ6VXNlcjgzMjAzNDg=","avatar_url":"https://avatars1.githubusercontent.com/u/8320348?v=4","gravatar_id":"","url":"https://api.github.com/users/radoondas","html_url":"https://github.com/radoondas","followers_url":"https://api.github.com/users/radoondas/followers","following_url":"https://api.github.com/users/radoondas/following{/other_user}","gists_url":"https://api.github.com/users/radoondas/gists{/gist_id}","starred_url":"https://api.github.com/users/radoondas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/radoondas/subscriptions","organizations_url":"https://api.github.com/users/radoondas/orgs","repos_url":"https://api.github.com/users/radoondas/repos","events_url":"https://api.github.com/users/radoondas/events{/privacy}","received_events_url":"https://api.github.com/users/radoondas/received_events","type":"User","site_admin":false},"labels":[{"id":912834056,"node_id":"MDU6TGFiZWw5MTI4MzQwNTY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Monitoring","name":":Core/Features/Monitoring","color":"0e8a16","default":false,"description":""},{"id":912838209,"node_id":"MDU6TGFiZWw5MTI4MzgyMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Authorization","name":":Security/Authorization","color":"0e8a16","default":false,"description":"Roles, Privileges, DLS/FLS, RBAC/ABAC"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"ycombinator","id":51061,"node_id":"MDQ6VXNlcjUxMDYx","avatar_url":"https://avatars2.githubusercontent.com/u/51061?v=4","gravatar_id":"","url":"https://api.github.com/users/ycombinator","html_url":"https://github.com/ycombinator","followers_url":"https://api.github.com/users/ycombinator/followers","following_url":"https://api.github.com/users/ycombinator/following{/other_user}","gists_url":"https://api.github.com/users/ycombinator/gists{/gist_id}","starred_url":"https://api.github.com/users/ycombinator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ycombinator/subscriptions","organizations_url":"https://api.github.com/users/ycombinator/orgs","repos_url":"https://api.github.com/users/ycombinator/repos","events_url":"https://api.github.com/users/ycombinator/events{/privacy}","received_events_url":"https://api.github.com/users/ycombinator/received_events","type":"User","site_admin":false},"assignees":[{"login":"ycombinator","id":51061,"node_id":"MDQ6VXNlcjUxMDYx","avatar_url":"https://avatars2.githubusercontent.com/u/51061?v=4","gravatar_id":"","url":"https://api.github.com/users/ycombinator","html_url":"https://github.com/ycombinator","followers_url":"https://api.github.com/users/ycombinator/followers","following_url":"https://api.github.com/users/ycombinator/following{/other_user}","gists_url":"https://api.github.com/users/ycombinator/gists{/gist_id}","starred_url":"https://api.github.com/users/ycombinator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ycombinator/subscriptions","organizations_url":"https://api.github.com/users/ycombinator/orgs","repos_url":"https://api.github.com/users/ycombinator/repos","events_url":"https://api.github.com/users/ycombinator/events{/privacy}","received_events_url":"https://api.github.com/users/ycombinator/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2019-01-29T14:20:30Z","updated_at":"2019-02-01T16:56:35Z","closed_at":"2019-02-01T16:56:35Z","author_association":"MEMBER","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.5.4\r\n\r\n**Plugins installed**: [none]\r\n\r\n**JVM version** (`java -version`): OpenJDK 64-Bit Server VM  11.0.1\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): not relevant\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen using least privileges for user defined to read monitoring data in remote monitoring cluster, this user is missing some of the permissions to show all information in Monitoring application.\r\n\r\n**Steps to reproduce**:\r\nProduction cluster and Monitoring cluster.\r\nBoth have valid Gold/Platinum license.\r\nProduction cluster is sending data to Remote monitoring cluster. \r\n\r\nTo allow ~Production cluster~ Kibana with Monitoring UI to read monitoring data from remote Monitoring cluster, configuration for least privileges is suggested in the documentation (point 3.)\r\nhttps://www.elastic.co/guide/en/kibana/current/monitoring-data.html\r\n\r\nCorrect user is defined in Monitoring cluster and This user is also configured in Production Kibana configuration file according to documentation above.\r\n\r\nUser definition\r\n```\r\n\"monitor_viewer\" : {\r\n    \"username\" : \"monitor_viewer\",\r\n    \"roles\" : [\r\n      \"monitoring_user\"\r\n    ],\r\n    \"full_name\" : \"Monitor viewer for Kibana\",\r\n    \"email\" : \"\",\r\n    \"metadata\" : { },\r\n    \"enabled\" : true\r\n  }\r\n```\r\n\r\nIn Production, we are missing Cluster status due to license issue.\r\n![issue](https://user-images.githubusercontent.com/8320348/51914374-fd3c3400-23d8-11e9-9c1b-25905d04d66b.png)\r\n\r\nAccessing `_xpack` endpoint which is required for license check provides following permission error.\r\n```\r\ncurl -k -u monitor_viewer https://<monitoring_hostname>:9200/_xpack/?pretty \r\nEnter host password for user 'monitor_viewer': \r\n{ \r\n \"error\" : { \r\n   \"root_cause\" : [ \r\n     { \r\n       \"type\" : \"security_exception\", \r\n       \"reason\" : \"action [cluster:monitor/xpack/info] is unauthorized for user [monitor_viewer]\" \r\n     } \r\n   ], \r\n   \"type\" : \"security_exception\", \r\n   \"reason\" : \"action [cluster:monitor/xpack/info] is unauthorized for user [monitor_viewer]\" \r\n }, \r\n \"status\" : 403 \r\n}\r\n```\r\n\r\nThis means that in Production Kibana Monitoring tab, some of the informations are missing due to limited privileges for the role `monitoring_user`\r\n\r\nI would expect that role `monitoring_user` have all required permissions.\r\n\r\n","closed_by":{"login":"ycombinator","id":51061,"node_id":"MDQ6VXNlcjUxMDYx","avatar_url":"https://avatars2.githubusercontent.com/u/51061?v=4","gravatar_id":"","url":"https://api.github.com/users/ycombinator","html_url":"https://github.com/ycombinator","followers_url":"https://api.github.com/users/ycombinator/followers","following_url":"https://api.github.com/users/ycombinator/following{/other_user}","gists_url":"https://api.github.com/users/ycombinator/gists{/gist_id}","starred_url":"https://api.github.com/users/ycombinator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ycombinator/subscriptions","organizations_url":"https://api.github.com/users/ycombinator/orgs","repos_url":"https://api.github.com/users/ycombinator/repos","events_url":"https://api.github.com/users/ycombinator/events{/privacy}","received_events_url":"https://api.github.com/users/ycombinator/received_events","type":"User","site_admin":false},"performed_via_github_app":null}