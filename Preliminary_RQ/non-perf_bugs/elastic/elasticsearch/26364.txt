{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26364","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26364/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26364/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26364/events","html_url":"https://github.com/elastic/elasticsearch/issues/26364","id":252648492,"node_id":"MDU6SXNzdWUyNTI2NDg0OTI=","number":26364,"title":"can not write type [class java.math.BigDecimal] on Script usage","user":{"login":"mosinnik","id":3997045,"node_id":"MDQ6VXNlcjM5OTcwNDU=","avatar_url":"https://avatars0.githubusercontent.com/u/3997045?v=4","gravatar_id":"","url":"https://api.github.com/users/mosinnik","html_url":"https://github.com/mosinnik","followers_url":"https://api.github.com/users/mosinnik/followers","following_url":"https://api.github.com/users/mosinnik/following{/other_user}","gists_url":"https://api.github.com/users/mosinnik/gists{/gist_id}","starred_url":"https://api.github.com/users/mosinnik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mosinnik/subscriptions","organizations_url":"https://api.github.com/users/mosinnik/orgs","repos_url":"https://api.github.com/users/mosinnik/repos","events_url":"https://api.github.com/users/mosinnik/events{/privacy}","received_events_url":"https://api.github.com/users/mosinnik/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":624853144,"node_id":"MDU6TGFiZWw2MjQ4NTMxNDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.5.1","name":"v5.5.1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"assignees":[{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2017-08-24T15:55:16Z","updated_at":"2017-08-25T14:06:56Z","closed_at":"2017-08-25T14:06:56Z","author_association":"NONE","active_lock_reason":null,"body":"When i try use Script in update to emulate upsert on condition i found error:\r\n```\r\nCaused by: java.io.IOException: can not write type [class java.math.BigDecimal]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.writeGenericValue(StreamOutput.java:655) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.lambda$static$11(StreamOutput.java:570) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.writeGenericValue(StreamOutput.java:653) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.lambda$static$11(StreamOutput.java:570) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.writeGenericValue(StreamOutput.java:653) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.lambda$static$11(StreamOutput.java:570) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.writeGenericValue(StreamOutput.java:653) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.lambda$static$11(StreamOutput.java:570) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.writeGenericValue(StreamOutput.java:653) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.common.io.stream.StreamOutput.writeMap(StreamOutput.java:443) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.script.Script.writeTo(Script.java:566) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.action.update.UpdateRequest.writeTo(UpdateRequest.java:886) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.action.DocWriteRequest.writeDocumentRequest(DocWriteRequest.java:198) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.action.bulk.BulkRequest.writeTo(BulkRequest.java:638) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.transport.TcpTransport.buildMessage(TcpTransport.java:1235) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.transport.TcpTransport.sendRequestToChannel(TcpTransport.java:1094) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.transport.TcpTransport.access$1200(TcpTransport.java:116) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.transport.TcpTransport$NodeChannels.sendRequest(TcpTransport.java:445) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.transport.TransportService.sendRequestInternal(TransportService.java:586) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:519) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:507) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.action.TransportActionNodeProxy.execute(TransportActionNodeProxy.java:51) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.client.transport.TransportProxyClient.lambda$execute$0(TransportProxyClient.java:59) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.client.transport.TransportClientNodesService.execute(TransportClientNodesService.java:250) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.client.transport.TransportProxyClient.execute(TransportProxyClient.java:59) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.client.transport.TransportClient.doExecute(TransportClient.java:363) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:408) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:80) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\tat org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:54) ~[elasticsearch-5.5.1.jar:5.5.1]\r\n\t... 4 more\r\n```\r\nCreating update request with simple script code:\r\n```\r\nMap<String, Object> params = new HashMap<>();\r\nparams.put(\"receiveTimeMs\", prepared.receiveTimeMs);\r\nparams.put(\"newSource\", prepared.source);\r\n\r\nScript script = new Script(\r\n\tScriptType.INLINE,\r\n\t\"painless\",\r\n\t\"if(ctx._source.meta.receiveTimeMs >= params.receiveTimeMs) {\" +\r\n\t\t\" ctx.op = 'noop' \" +\r\n\t\t\"} else {\" +\r\n\t\t\" ctx._source.meta = params.newSource.meta;\" +\r\n\t\t\" ctx._source.responsemessage = params.newSource.responsemessage;\" +\r\n\t\t\"}\",\r\n\tparams\r\n);\r\nreturn new UpdateRequest()\r\n\t.index(prepared.index)\r\n\t.type(prepared.type)\r\n\t.id(prepared.id)\r\n\t.routing(prepared.routing)\r\n\t.upsert(toInsertRequest(prepared))\r\n\t.script(script);\r\n```\r\n`params` - HashMap, \r\n`newSource` contains objects and on of then is BigDecimal.\r\nIf i make only IndexRequest it's all right.\r\nOn update with script - fail.\r\n\r\nES transport client 5.5.1\r\n\r\nIs it painless restrictions or may be fixed?","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}