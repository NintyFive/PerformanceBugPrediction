{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15563","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15563/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15563/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15563/events","html_url":"https://github.com/elastic/elasticsearch/issues/15563","id":123221563,"node_id":"MDU6SXNzdWUxMjMyMjE1NjM=","number":15563,"title":"mvel  Thread Safe question","user":{"login":"zhangrong4","id":16379292,"node_id":"MDQ6VXNlcjE2Mzc5Mjky","avatar_url":"https://avatars0.githubusercontent.com/u/16379292?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangrong4","html_url":"https://github.com/zhangrong4","followers_url":"https://api.github.com/users/zhangrong4/followers","following_url":"https://api.github.com/users/zhangrong4/following{/other_user}","gists_url":"https://api.github.com/users/zhangrong4/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangrong4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangrong4/subscriptions","organizations_url":"https://api.github.com/users/zhangrong4/orgs","repos_url":"https://api.github.com/users/zhangrong4/repos","events_url":"https://api.github.com/users/zhangrong4/events{/privacy}","received_events_url":"https://api.github.com/users/zhangrong4/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-12-21T07:01:26Z","updated_at":"2015-12-21T09:21:55Z","closed_at":"2015-12-21T09:21:54Z","author_association":"NONE","active_lock_reason":null,"body":"We encounter a problem.When concurrent is large，it occurs stack  as follow：\n\n\"rateplanDateExecutor-499\" - Thread t@38815\n   java.lang.Thread.State: RUNNABLE\n    at java.util.WeakHashMap.get(WeakHashMap.java:403)\n    at org.mvel2.util.ParseTools.getBestCandidate(ParseTools.java:243)\n    at org.mvel2.util.ParseTools.getBestCandidate(ParseTools.java:224)\n    at org.mvel2.PropertyAccessor.getMethod(PropertyAccessor.java:864)\n    at org.mvel2.PropertyAccessor.get(PropertyAccessor.java:164)\n    at org.mvel2.PropertyAccessor.get(PropertyAccessor.java:135)\n    at org.mvel2.ast.ASTNode.getReducedValue(ASTNode.java:167)\n    at org.mvel2.MVELInterpretedRuntime.parseAndExecuteInterpreted(MVELInterpretedRuntime.java:93)\n    at org.mvel2.MVELInterpretedRuntime.parse(MVELInterpretedRuntime.java:44)\n    at org.mvel2.MVEL.eval(MVEL.java:155)\n    at org.mvel2.PropertyAccessor.getMethod(PropertyAccessor.java:802)\n    at org.mvel2.PropertyAccessor.get(PropertyAccessor.java:164)\n    at org.mvel2.PropertyAccessor.get(PropertyAccessor.java:135)\n    at org.mvel2.ast.Union.getReducedValue(Union.java:50)\n    at org.mvel2.MVELInterpretedRuntime.parseAndExecuteInterpreted(MVELInterpretedRuntime.java:93)\n    at org.mvel2.MVELInterpretedRuntime.parse(MVELInterpretedRuntime.java:44)\n    at org.mvel2.MVEL.eval(MVEL.java:262)\n    at org.mvel2.MVEL.evalToBoolean(MVEL.java:691)\n    at cobar.client.router.rules.ibatis.IBatisNamespaceShardingRule.isDefinedAt(IBatisNamespaceShardingRule.java:54)\n    at cobar.client.router.rules.ibatis.IBatisNamespaceShardingRule.isDefinedAt(IBatisNamespaceShardingRule.java:33)\n    at cobar.client.router.DefaultCobarClientInternalRouter.searchMatchedRuleAgainst(DefaultCobarClientInternalRouter.java:109)\n    at cobar.client.router.DefaultCobarClientInternalRouter.doRoute(DefaultCobarClientInternalRouter.java:72)\n    at cobar.client.router.DefaultCobarClientInternalRouter.doRoute(DefaultCobarClientInternalRouter.java:52)\n    at cobar.client.CobarSqlSessionTemplate.lookupDataSourcesByRouter(CobarSqlSessionTemplate.java:849)\n    at cobar.client.CobarSqlSessionTemplate.selectList(CobarSqlSessionTemplate.java:258)\n    at cobar.client.CobarSqlSessionTemplate.selectList(CobarSqlSessionTemplate.java:249)\n    at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:119)\n    at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:63)\n    at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:52)\n    at com.sun.proxy.$Proxy33.queryListByParams(Unknown Source)\n    at wolverine.ris.index.rateplan.service.RatePlanService.sendRatePlanDate(RatePlanService.java:192)\n    at wolverine.ris.index.rateplan.service.RatePlanService.queryRatePlanDate(RatePlanService.java:159)\n    at wolverine.ris.index.rateplan.service.RatePlanService$$FastClassByCGLIB$$2e73933b.invoke(<generated>)\n    at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204)\n    at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:701)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:150)\n    at org.springframework.aop.interceptor.AsyncExecutionInterceptor$1.call(AsyncExecutionInterceptor.java:95)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n\n   Locked ownable synchronizers:\n    - locked <26c6fd14> (a java.util.concurrent.ThreadPoolExecutor$Worker)\n\ncode：\nif(bestCandidate != null){\n    if(methCathe == null){\n           RESOLVED_METH_CATHE.put(method,methCathe=new WeakHashMap<Integer,WeakReference<Method>>());\n    }\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}