{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20506","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20506/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20506/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20506/events","html_url":"https://github.com/elastic/elasticsearch/issues/20506","id":177207296,"node_id":"MDU6SXNzdWUxNzcyMDcyOTY=","number":20506,"title":"API Search gives me a wrong bucket count","user":{"login":"xoxys","id":3391958,"node_id":"MDQ6VXNlcjMzOTE5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/3391958?v=4","gravatar_id":"","url":"https://api.github.com/users/xoxys","html_url":"https://github.com/xoxys","followers_url":"https://api.github.com/users/xoxys/followers","following_url":"https://api.github.com/users/xoxys/following{/other_user}","gists_url":"https://api.github.com/users/xoxys/gists{/gist_id}","starred_url":"https://api.github.com/users/xoxys/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xoxys/subscriptions","organizations_url":"https://api.github.com/users/xoxys/orgs","repos_url":"https://api.github.com/users/xoxys/repos","events_url":"https://api.github.com/users/xoxys/events{/privacy}","received_events_url":"https://api.github.com/users/xoxys/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-09-15T15:22:47Z","updated_at":"2016-09-15T16:33:59Z","closed_at":"2016-09-15T16:33:59Z","author_association":"NONE","active_lock_reason":null,"body":"*_Elasticsearch version_1.4.4*:\n\n*_OS version_RHEL7.2*:\n\n**Description of the problem including expected versus actual behavior**:\nHi,\ni use elasticsearch to collect logmessages. I try to get a overview of all hosts and the sum of logfiles in the last hour. To get the result i use the python client from elasticsearch and these query:\n{\n    \"aggs\": {\n        \"hosts\" : {\n            \"filter\" : {\n                \"range\" : {\n                    \"@timestamp\" : { \"gt\" : \"now-1h\" }\n                }\n            },\n            \"aggs\" : {\n                \"logs_per_host\" : {\n                    \"terms\" : {\n                        \"field\" : \"logsource\",\n                        \"size\" : 5000\n                    }\n                }\n            }\n        }\n    }, \"size\" : 0\n})\n\nThe field \"logsource\" contains the unique hostname of each server. The query runs well and i got buckets with the doc_count of each host. The problem is the count of some hosts seems to be wrong. The query counts ~ 8000 logs in the last hour. If i verify the value of these hosts with kibana the count for this host is ~4500 logs. I also verify the count of this host with this es query:\n{\n        \"aggs\" : {\n            \"host\" : { \"filter\" : { \"term\" : { \"logsource\" : hostname } },\n                \"aggs\" : {\n                     \"logs_per_hour\" : {\n                        \"date_histogram\" : {\n                            \"field\" : \"@timestamp\",\n                            \"interval\" : \"1h\",\n                            \"order\" : { \"_count\" : \"asc\" }\n                        }\n                    }\n                }\n            }\n }\nThis shows me that the host has ~ 4000 Logs per our, so the first query seems to be wrong. I dont know if this is a bug or the query is wrong... Some counts from the first query seems to be okay because the values matches with kibana and the secound query.\nThank you very much for your work.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}