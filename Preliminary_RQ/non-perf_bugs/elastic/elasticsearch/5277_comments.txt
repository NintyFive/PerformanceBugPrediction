[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/36363865","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-36363865","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":36363865,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzYzODY1","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2014-02-28T15:51:52Z","updated_at":"2014-02-28T15:51:52Z","author_association":"MEMBER","body":"How many concurrent requests are you sending with JMeter? Do you see the same behavior with a SearchType of QUERY_AND_FETCH? The default value is equal to QUERY_THEN_FETCH. I think what may be happening when you shut down the node is the query phase has executed and gets the information about the document. However, since the node has gone down the document does not get retrieved during the fetch phase.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/36366788","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-36366788","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":36366788,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzY2Nzg4","user":{"login":"dariodariodario","id":1387689,"node_id":"MDQ6VXNlcjEzODc2ODk=","avatar_url":"https://avatars3.githubusercontent.com/u/1387689?v=4","gravatar_id":"","url":"https://api.github.com/users/dariodariodario","html_url":"https://github.com/dariodariodario","followers_url":"https://api.github.com/users/dariodariodario/followers","following_url":"https://api.github.com/users/dariodariodario/following{/other_user}","gists_url":"https://api.github.com/users/dariodariodario/gists{/gist_id}","starred_url":"https://api.github.com/users/dariodariodario/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dariodariodario/subscriptions","organizations_url":"https://api.github.com/users/dariodariodario/orgs","repos_url":"https://api.github.com/users/dariodariodario/repos","events_url":"https://api.github.com/users/dariodariodario/events{/privacy}","received_events_url":"https://api.github.com/users/dariodariodario/received_events","type":"User","site_admin":false},"created_at":"2014-02-28T16:19:19Z","updated_at":"2014-02-28T16:19:19Z","author_association":"NONE","body":"By using QUERY_AND_FETCH I have been able to get rid of the errors when I stop a non master node. But if I throw down a master node (albeit it recovers soon), I still get ShardFailures.\n\nWhen a node goes down I also see a couple of warnings like:\n\n```\n[2014-02-28 16:13:52,426][WARN ][org.elasticsearch.transport.netty] [d-eslocalnode] Message not fully read (response) for [1074736] handler org.elasticsearch.search.action.SearchServiceTransportAction$7@3f3b511e, error [true], resetting\n```\n\nRegarding your question about JMeter, I test my app with about 200 threads (the app runs locally, but not the ES data and master nodes).\n\nIs there a way to get rid of those shards failures? Or do I have to implement some retry strategy on my own?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68255093","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-68255093","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":68255093,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MjU1MDkz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-29T12:55:53Z","updated_at":"2014-12-29T12:55:53Z","author_association":"CONTRIBUTOR","body":"Hi @dariodariodario \n\nSorry it has taken a long time to get to this issue.  Is this something that you are still seeing in more recent versions on Elasticsearch?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68255380","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-68255380","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":68255380,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MjU1Mzgw","user":{"login":"dariodariodario","id":1387689,"node_id":"MDQ6VXNlcjEzODc2ODk=","avatar_url":"https://avatars3.githubusercontent.com/u/1387689?v=4","gravatar_id":"","url":"https://api.github.com/users/dariodariodario","html_url":"https://github.com/dariodariodario","followers_url":"https://api.github.com/users/dariodariodario/followers","following_url":"https://api.github.com/users/dariodariodario/following{/other_user}","gists_url":"https://api.github.com/users/dariodariodario/gists{/gist_id}","starred_url":"https://api.github.com/users/dariodariodario/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dariodariodario/subscriptions","organizations_url":"https://api.github.com/users/dariodariodario/orgs","repos_url":"https://api.github.com/users/dariodariodario/repos","events_url":"https://api.github.com/users/dariodariodario/events{/privacy}","received_events_url":"https://api.github.com/users/dariodariodario/received_events","type":"User","site_admin":false},"created_at":"2014-12-29T13:00:27Z","updated_at":"2014-12-29T13:00:27Z","author_association":"NONE","body":"I don't know, I've changed job in the meanwhile. So I've not been working\non that anymore. Thanks anyway.\nOn 29 Dec 2014 13:56, \"Clinton Gormley\" notifications@github.com wrote:\n\n> Hi @dariodariodario https://github.com/dariodariodario\n> \n> Sorry it has taken a long time to get to this issue. Is this something\n> that you are still seeing in more recent versions on Elasticsearch?\n> \n> â€”\n> Reply to this email directly or view it on GitHub\n> https://github.com/elasticsearch/elasticsearch/issues/5277#issuecomment-68255093\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68262440","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-68262440","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":68262440,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MjYyNDQw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-29T14:40:53Z","updated_at":"2014-12-29T14:40:53Z","author_association":"CONTRIBUTOR","body":"thanks for letting me know @dariodariodario \n\nI'll close this for now\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106304781","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-106304781","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":106304781,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjMwNDc4MQ==","user":{"login":"kristoffer-dyrkorn","id":2276260,"node_id":"MDQ6VXNlcjIyNzYyNjA=","avatar_url":"https://avatars1.githubusercontent.com/u/2276260?v=4","gravatar_id":"","url":"https://api.github.com/users/kristoffer-dyrkorn","html_url":"https://github.com/kristoffer-dyrkorn","followers_url":"https://api.github.com/users/kristoffer-dyrkorn/followers","following_url":"https://api.github.com/users/kristoffer-dyrkorn/following{/other_user}","gists_url":"https://api.github.com/users/kristoffer-dyrkorn/gists{/gist_id}","starred_url":"https://api.github.com/users/kristoffer-dyrkorn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kristoffer-dyrkorn/subscriptions","organizations_url":"https://api.github.com/users/kristoffer-dyrkorn/orgs","repos_url":"https://api.github.com/users/kristoffer-dyrkorn/repos","events_url":"https://api.github.com/users/kristoffer-dyrkorn/events{/privacy}","received_events_url":"https://api.github.com/users/kristoffer-dyrkorn/received_events","type":"User","site_admin":false},"created_at":"2015-05-28T13:08:29Z","updated_at":"2015-05-28T13:08:29Z","author_association":"NONE","body":"Please reopen @clintongormley - we see this on 1.5.2.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106305311","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-106305311","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":106305311,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjMwNTMxMQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-05-28T13:11:27Z","updated_at":"2015-05-28T13:11:27Z","author_association":"CONTRIBUTOR","body":"@kristoffer-dyrkorn please open a new ticket with all of the relevant details instead\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106586131","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-106586131","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":106586131,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjU4NjEzMQ==","user":{"login":"kimjoar","id":5259,"node_id":"MDQ6VXNlcjUyNTk=","avatar_url":"https://avatars2.githubusercontent.com/u/5259?v=4","gravatar_id":"","url":"https://api.github.com/users/kimjoar","html_url":"https://github.com/kimjoar","followers_url":"https://api.github.com/users/kimjoar/followers","following_url":"https://api.github.com/users/kimjoar/following{/other_user}","gists_url":"https://api.github.com/users/kimjoar/gists{/gist_id}","starred_url":"https://api.github.com/users/kimjoar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimjoar/subscriptions","organizations_url":"https://api.github.com/users/kimjoar/orgs","repos_url":"https://api.github.com/users/kimjoar/repos","events_url":"https://api.github.com/users/kimjoar/events{/privacy}","received_events_url":"https://api.github.com/users/kimjoar/received_events","type":"User","site_admin":false},"created_at":"2015-05-28T20:26:20Z","updated_at":"2015-05-28T20:26:20Z","author_association":"NONE","body":"@clintongormley I can fill in with some more info. This is the exception we get:\n\n```\njava.lang.ArrayIndexOutOfBoundsException: 0\n    at org.elasticsearch.search.internal.InternalSearchHits.getAt(InternalSearchHits.java:147) ~[elasticsearch-1.5.2.jar:na]\n    at com.svv.datainn.dataimport.elasticsearch.DataQualityRepository.extractProgress(DataQualityRepository.java:102) ~[dataimport-2.0.1-35.jar:na]\n```\n\nAnd this is the relevant code:\n\n```\nprivate Maybe<Progress> extractProgress(SearchHits hits) {\n    if(hits.getTotalHits() == 0) {\n        return Maybe.empty();\n    }\n    else {\n        SearchHit hit = hits.getAt(0);\n        // ...\n    }\n}\n```\n\nThis is the search:\n\n```\nSearchResponse response = esClient.prepareSearch(\"some_index\")\n        .setTypes(\"some_type\")\n        .setFrom(0)\n        .setSize(1)\n        .setQuery(filteredQuery(matchAllQuery(), termFilter(\"some_field\", someValue)))\n        .execute()\n        .actionGet();\n\nreturn extractProgress(response.getHits());\n```\n\nSo what's mentioned in this issue definitely appears to still occur on 1.5.2. Should we still open a new ticket even if it appears to be the same problem?\n\nWe haven't had time to debug this thoroughly yet, so I'll try to get back with more info early next week.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106595758","html_url":"https://github.com/elastic/elasticsearch/issues/5277#issuecomment-106595758","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5277","id":106595758,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjU5NTc1OA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-05-28T20:57:22Z","updated_at":"2015-05-28T20:57:22Z","author_association":"MEMBER","body":"I gave a quick look at your code and I think you need to be aware that totalHits is different than the size of the hits array.\n\nThis test:\n\n> if(hits.getTotalHits() == 0)\n> Looks wrong to me if you want to make sure you can do:\n> hits.getAt(0);\n\nMy 2 cents.\n\nPlease discuss that on discuss.elastic.co so we can help you there.\n\n> Le 28 mai 2015 Ã  22:26, Kim Joar Bekkelund notifications@github.com a Ã©crit :\n> \n> @clintongormley I can fill in with some more info. This is the exception we get:\n> \n> java.lang.ArrayIndexOutOfBoundsException: 0\n>     at org.elasticsearch.search.internal.InternalSearchHits.getAt(InternalSearchHits.java:147) ~[elasticsearch-1.5.2.jar:na]\n>     at com.svv.datainn.dataimport.elasticsearch.DataQualityRepository.extractProgress(DataQualityRepository.java:102) ~[dataimport-2.0.1-35.jar:na]\n> And this is the relevant code:\n> \n> private Maybe<Progress> extractProgress(SearchHits hits) {\n>     if(hits.getTotalHits() == 0) {\n>         return Maybe.empty();\n>     }\n>     else {\n>         SearchHit hit = hits.getAt(0);\n>         // ...\n>     }\n> }\n> This is the search:\n> \n> SearchResponse response = esClient.prepareSearch(\"some_index\")\n>         .setTypes(\"some_type\")\n>         .setFrom(0)\n>         .setSize(1)\n>         .setQuery(filteredQuery(matchAllQuery(), termFilter(\"some_field\", someValue)))\n>         .execute()\n>         .actionGet();\n> \n> return extractProgress(response.getHits());\n> So what's mentioned in this issue definitely appears to still occur on 1.5.2. Should we still open a new ticket even if it appears to be the same problem?\n> \n> We haven't had time to debug this thoroughly yet, so I'll try to get back with more info early next week.\n> \n> â€”\n> Reply to this email directly or view it on GitHub.\n","performed_via_github_app":null}]