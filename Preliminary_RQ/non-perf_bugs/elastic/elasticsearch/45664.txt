{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/45664","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45664/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45664/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45664/events","html_url":"https://github.com/elastic/elasticsearch/issues/45664","id":481700698,"node_id":"MDU6SXNzdWU0ODE3MDA2OTg=","number":45664,"title":"testForceStartFailedTransform fails with STARTED expected FAILED","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"assignees":[{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-08-16T17:04:04Z","updated_at":"2019-08-19T11:43:37Z","closed_at":"2019-08-19T11:43:37Z","author_association":"MEMBER","active_lock_reason":null,"body":"Failure: https://gradle-enterprise.elastic.co/s/cnsrqikafhkm4/\r\n\r\nLooking at the logs, it appears as if a second trigger fired quickly after the first one started and BEFORE it had the chance to transition the indexer state? This should not really be possible, but the two calls may be on the same thread???\r\n\r\nInvestigating.\r\n\r\n```\r\n[2019-08-16T15:23:02,003][TRACE][o.e.x.d.t.p.SchemaUtil   ] [integTest-0] Extracted type for [reviewer] : [long] from index [failure_pivot_reviews]\r\n[2019-08-16T15:23:02,097][TRACE][o.e.x.d.t.DataFrameTransformPersistentTasksExecutor] [integTest-0] [test-force-start-failed-transform] No stats found(new transform), starting the task\r\n[2019-08-16T15:23:02,128][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [test-force-start-failed-transform] start called with force [false] and state [{\"task_state\":\"stopped\",\"indexer_state\":\"stopped\",\"checkpoint\":0}]\r\n[2019-08-16T15:23:02,129][INFO ][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Updating state for data frame transform [test-force-start-failed-transform] to [{\"task_state\":\"started\",\"indexer_state\":\"stopped\",\"checkpoint\":0}]\r\n[2019-08-16T15:23:02,214][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Successfully updated state for data frame transform [test-force-start-failed-transform] to [{\"task_state\":\"started\",\"indexer_state\":\"stopped\",\"checkpoint\":0}]\r\n[2019-08-16T15:23:02,262][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Data frame indexer [data_frame/transforms/schedule_test-force-start-failed-transform] schedule has triggered, state: [STARTED]\r\n[2019-08-16T15:23:02,263][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Trigger initial run\r\n[2019-08-16T15:23:02,281][INFO ][o.e.x.d.t.DataFrameTransformPersistentTasksExecutor] [integTest-0] Successfully completed and scheduled task in node operation\r\n[2019-08-16T15:23:02,323][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] [test-force-start-failed-transform] successfully refreshed data frame transform config from index.\r\n...\r\n[2019-08-16T15:23:02,926][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Updating persistent state of transform [test-force-start-failed-transform] to [{\"task_state\":\"started\",\"indexer_state\":\"started\",\"checkpoint\":0,\"progress\":{\"docs_remaining\":0,\"total_docs\":10,\"percent_complete\":100.0,\"docs_indexed\":7,\"docs_processed\":10}}]\r\n[2019-08-16T15:23:03,267][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Data frame indexer [data_frame/transforms/schedule_test-force-start-failed-transform] schedule has triggered, state: [STARTED]\r\n[2019-08-16T15:23:03,271][DEBUG][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Trigger initial run\r\n[2019-08-16T15:23:03,166][WARN ][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Data frame transform [test-force-start-failed-transform] encountered an exception: \r\n...\r\n[2019-08-16T15:23:03,319][ERROR][o.e.x.d.t.DataFrameTransformTask] [integTest-0] Data frame transform [test-force-start-failed-transform]: task encountered more than 0 failures; latest failure: Bulk index experienced failures. See the logs of the node running the transform for details.\r\n[2019-08-16T15:26:33,852][DEBUG][o.e.x.d.a.TransportStopDataFrameTransformAction] [integTest-0] failed to execute on node [M_XX4Nr4Tc-fh-NbzFbOqQ]\r\n```\r\n[integTest.log](https://github.com/elastic/elasticsearch/files/3510488/integTest.log)\r\n","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}