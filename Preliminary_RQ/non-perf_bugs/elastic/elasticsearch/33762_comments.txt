[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/421987443","html_url":"https://github.com/elastic/elasticsearch/issues/33762#issuecomment-421987443","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33762","id":421987443,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTk4NzQ0Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-17T12:05:44Z","updated_at":"2018-09-17T12:05:44Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427396046","html_url":"https://github.com/elastic/elasticsearch/issues/33762#issuecomment-427396046","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33762","id":427396046,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzM5NjA0Ng==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2018-10-05T15:01:27Z","updated_at":"2018-10-05T15:01:27Z","author_association":"MEMBER","body":"Another one:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+packaging-tests/63/console\r\n\r\n```\r\nExecution failed for task ':qa:vagrant:vagrantUbuntu1604#javaPackagingTest'.\r\n\r\nREPRODUCE WITH: ./gradlew :qa:vagrant:vagrantUbuntu1604#javaPackagingTest \\\r\n  -Dtests.seed=4FE89E07FDDE167E \r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436607308","html_url":"https://github.com/elastic/elasticsearch/issues/33762#issuecomment-436607308","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33762","id":436607308,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjYwNzMwOA==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-11-07T12:28:28Z","updated_at":"2018-11-07T12:28:28Z","author_association":"MEMBER","body":"Another one:\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+packaging-tests/70/console","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/442865188","html_url":"https://github.com/elastic/elasticsearch/issues/33762#issuecomment-442865188","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33762","id":442865188,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mjg2NTE4OA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-11-29T15:02:32Z","updated_at":"2018-11-29T15:02:32Z","author_association":"CONTRIBUTOR","body":"https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+packaging-tests/154/consoleFull got us more debugging information:\r\n\r\n```\r\n01:01:05 not ok 132 [DEB PLUGINS] install a sample plugin with different logging modes and check output\r\n01:01:05 # (from function `install_package' in file /project/build/packaging/bats/utils/packages.bash, line 86,\r\n01:01:05 # (from function `install_package' in file /project/build/packaging/bats/utils/packages.bash, line 86,\r\n01:01:05 #  from function `install' in file /project/build/packaging/bats/tests/50_modules_and_plugins.bats, line 88,\r\n01:01:05 #  from function `install' in file /project/build/packaging/bats/tests/50_modules_and_plugins.bats, line 88,\r\n01:01:05 #  from function `setup' in test file /project/build/packaging/bats/tests/50_modules_and_plugins.bats, line 63)\r\n01:01:05 #  from function `setup' in test file /project/build/packaging/bats/tests/50_modules_and_plugins.bats, line 63)\r\n01:01:05 #   `install' failed\r\n01:01:05 #   `install' failed\r\n01:01:05 # dpkg failed:\r\n01:01:05 # dpkg: error: dpkg frontend is locked by another process\r\n01:01:05 # lsof /var/lib/dpkg/lock:\r\n01:01:05 # COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\r\n01:01:05 # apt-get 24459 root    5uW  REG    8,3        0  938 /var/lib/dpkg/lock\r\n```\r\n\r\nI'll do a little more digging.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/442871759","html_url":"https://github.com/elastic/elasticsearch/issues/33762#issuecomment-442871759","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33762","id":442871759,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mjg3MTc1OQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-11-29T15:19:49Z","updated_at":"2018-11-29T15:19:49Z","author_association":"CONTRIBUTOR","body":"I just checked on our ubuntu 1604 image. There is a file in `/etc/cron.daily/apt-compat` that execs `/usr/lib/apt/apt.systemd.daily`. `cron.daily` looks like it runs at 6:25am local time:\r\n\r\n```\r\ngrep daily /etc/crontab \r\n25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )\r\n```\r\n\r\nWhen I shift Jenkins into the server's local time zone it looks like the failure occurs right after 6am:\r\n```\r\n06:01:05 not ok 132 [DEB PLUGINS] install a sample plugin with different logging modes and check output\r\n```\r\n\r\nThat doesn't quite line up! More digging!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/442898488","html_url":"https://github.com/elastic/elasticsearch/issues/33762#issuecomment-442898488","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33762","id":442898488,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mjg5ODQ4OA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-11-29T16:26:58Z","updated_at":"2018-11-29T16:26:58Z","author_association":"CONTRIBUTOR","body":"> That doesn't quite line up! More digging!\r\n\r\nI think I figured it out! Ubuntu 16.04 uses systemd and `/etc/cron.daily/apt-compat` bails if systemd is around. Why the file is on disk at all when the whole distro is sytemd, I dunno. But whatever.\r\n\r\nIn systemd Ubuntu 16.04 has a timer at `/etc/systemd/system/timers.target.wants/apt-daily-upgrade.timer` which looks like:\r\n```\r\n[Timer]\r\nOnCalendar=*-*-* 6:00\r\nRandomizedDelaySec=60m\r\nPersistent=true\r\n```\r\n\r\nWhich lines up well with the error. The unit file that is tied to the timer kicks off an apt-get update. That script runs `unattended-upgrade` which looks like it at least runs `dpkg`. I expect `apt-get` is in there too.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/453823603","html_url":"https://github.com/elastic/elasticsearch/issues/33762#issuecomment-453823603","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33762","id":453823603,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzgyMzYwMw==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2019-01-13T11:57:28Z","updated_at":"2019-01-13T11:57:28Z","author_association":"CONTRIBUTOR","body":"New vagrant boxes have been pushed that have various upgrade services disabled.\r\n\r\nDetails in: https://github.com/elastic/elasticsearch/issues/37181#issuecomment-453823210\r\n\r\nLast failure occurred on Thursday, i.e. 1 day before the updated packages were pushed:\r\n\r\n![image](https://user-images.githubusercontent.com/1754575/51084946-f952b580-173a-11e9-9abb-6631097ccf8e.png)\r\n\r\nI am closing this issue now, will monitor build stats for any new occurrences of:\r\n\r\n- \"dpkg failed and the lockfile still exists\"\r\n\r\nor\r\n\r\n- \"dpkg frontend is locked by another process\"\r\n\r\nand reopen this issue if it happens again.\r\n\r\n","performed_via_github_app":null}]