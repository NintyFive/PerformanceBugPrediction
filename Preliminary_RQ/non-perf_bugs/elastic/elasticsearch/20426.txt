{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20426","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20426/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20426/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20426/events","html_url":"https://github.com/elastic/elasticsearch/issues/20426","id":176417489,"node_id":"MDU6SXNzdWUxNzY0MTc0ODk=","number":20426,"title":"Custom Call Signature Per Script Context","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":21,"created_at":"2016-09-12T16:12:36Z","updated_at":"2018-02-14T13:23:08Z","closed_at":"2017-11-29T16:04:14Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"We should make each context execute scripts based on exactly what gets passed in and returned.  This eliminates a huge number of potential boxes for something like scoring that returns a double value out of a script.  This may also eliminate a large number of hash look ups as certain parameters will be passed directly into the method instead of accessed from a map.  Over millions of documents these performance gains really add up.  Another benefit will be prevention of accessing null variables that may not belong in a context.  **For this to work the context will have to be passed in at compile-time.**\n\nI need to run through all the script cases and figure out what the contexts should be as I'm not sure if the current ones cover all the situations.\n\nFor file based scripts, I would propose for Painless and Expressions that the script be named something like script.score.painless now to embed the context in the name.  For something like Groovy and other languages we can have an \"unknown\" context so these remain backwards compatible.  The \"unknown\" context would revert to the old call signatures.  Once the older languages are fully removed then we can remove the \"unknown\" context.\n","closed_by":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"performed_via_github_app":null}