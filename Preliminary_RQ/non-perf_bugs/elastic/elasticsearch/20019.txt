{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20019","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20019/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20019/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20019/events","html_url":"https://github.com/elastic/elasticsearch/issues/20019","id":171600850,"node_id":"MDU6SXNzdWUxNzE2MDA4NTA=","number":20019,"title":"Phrase Suggester returns different results with aliases","user":{"login":"shyamaryan","id":20437221,"node_id":"MDQ6VXNlcjIwNDM3MjIx","avatar_url":"https://avatars3.githubusercontent.com/u/20437221?v=4","gravatar_id":"","url":"https://api.github.com/users/shyamaryan","html_url":"https://github.com/shyamaryan","followers_url":"https://api.github.com/users/shyamaryan/followers","following_url":"https://api.github.com/users/shyamaryan/following{/other_user}","gists_url":"https://api.github.com/users/shyamaryan/gists{/gist_id}","starred_url":"https://api.github.com/users/shyamaryan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shyamaryan/subscriptions","organizations_url":"https://api.github.com/users/shyamaryan/orgs","repos_url":"https://api.github.com/users/shyamaryan/repos","events_url":"https://api.github.com/users/shyamaryan/events{/privacy}","received_events_url":"https://api.github.com/users/shyamaryan/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2016-08-17T08:22:24Z","updated_at":"2018-07-05T20:21:48Z","closed_at":"2018-07-05T20:19:42Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.2\n\n**JVM version**: 1.8.0_65\n\n**OS version**: Oracle Linux Server release 6.5\n\nWe use a field SearchAllText in Phrase Suggester which is populated across multiple indices. We have 2 aliases:\n1) `search_all` which covers 34 indices.\n2) `index_load` which covers 30 indices. \n\nindex_load excludes 4 indices that search_all includes but rest all are same. When we run the Phrase Suggester against both we are seeing different results. Here index_load generates more suggestions than search_all alias. I would expect at least same suggestions on search_all alias as well. Any idea why the behavior is different? My expected result is `walgreen`\n\n```\nGET index_load/_search?search_type=count\n{\n  \"suggest\" : {\n    \"text\" : \"wagreen\",\n    \"phrase_suggest\" : {\n      \"phrase\" : {\n        \"field\" : \"SearchAllText.suggest\",\n        \"size\" : 10,\n        \"direct_generator\" : [ {\n          \"field\" : \"SearchAllText.suggest\",\n          \"suggest_mode\" : \"popular\",\n          \"min_word_length\" : 0,\n          \"prefix_length\" : 0,\n          \"size\" : 10\n        } ],\n         \"collate\": {\n            \"query\": {\n              \"query_string\" : {\n                \"query\" : \"{{suggestion}}\",\n                \"fields\" : [ \"SearchAllText\" ],\n                \"default_operator\" : \"and\",\n                \"analyze_wildcard\" : true\n              }\n              },\n           \"prune\": false \n         }\n      }\n    }\n  }\n}\n```\n\nReturns\n\n```\n{\n   \"took\": 82,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 60,\n      \"successful\": 60,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 82791251,\n      \"max_score\": 0,\n      \"hits\": []\n   },\n   \"suggest\": {\n      \"phrase_suggest\": [\n         {\n            \"text\": \"wagreen\",\n            \"offset\": 0,\n            \"length\": 7,\n            \"options\": [\n               {\n                  \"text\": \"warren\",\n                  \"score\": 0.008121356\n               },\n               {\n                  \"text\": \"walgreens\",\n                  \"score\": 0.0037804323\n               },\n               {\n                  \"text\": \"walgreen\",\n                  \"score\": 0.0032029075\n               },\n               {\n                  \"text\": \"wareena\",\n                  \"score\": 0.0025363953\n               },\n               {\n                  \"text\": \"waren\",\n                  \"score\": 0.0025306016\n               }\n            ]\n         }\n      ]\n   }\n}\n```\n\nand the same phrase query run against search_all alias returns this:\n\n```\n{\n   \"took\": 89,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 64,\n      \"successful\": 64,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 83151341,\n      \"max_score\": 0,\n      \"hits\": []\n   },\n   \"suggest\": {\n      \"phrase_suggest\": [\n         {\n            \"text\": \"wagreen\",\n            \"offset\": 0,\n            \"length\": 7,\n            \"options\": [\n               {\n                  \"text\": \"warren\",\n                  \"score\": 0.008121356\n               }\n            ]\n         }\n      ]\n   }\n}\n```\n","closed_by":{"login":"tomcallahan","id":15988488,"node_id":"MDQ6VXNlcjE1OTg4NDg4","avatar_url":"https://avatars1.githubusercontent.com/u/15988488?v=4","gravatar_id":"","url":"https://api.github.com/users/tomcallahan","html_url":"https://github.com/tomcallahan","followers_url":"https://api.github.com/users/tomcallahan/followers","following_url":"https://api.github.com/users/tomcallahan/following{/other_user}","gists_url":"https://api.github.com/users/tomcallahan/gists{/gist_id}","starred_url":"https://api.github.com/users/tomcallahan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomcallahan/subscriptions","organizations_url":"https://api.github.com/users/tomcallahan/orgs","repos_url":"https://api.github.com/users/tomcallahan/repos","events_url":"https://api.github.com/users/tomcallahan/events{/privacy}","received_events_url":"https://api.github.com/users/tomcallahan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}