{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28474","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28474/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28474/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28474/events","html_url":"https://github.com/elastic/elasticsearch/issues/28474","id":293425993,"node_id":"MDU6SXNzdWUyOTM0MjU5OTM=","number":28474,"title":"Elasticsearch: custom word-splitting  index setting which works in 5.X fails with error in 6.X \"illegal_argument_exception\"","user":{"login":"MorrieAtElastic","id":28967808,"node_id":"MDQ6VXNlcjI4OTY3ODA4","avatar_url":"https://avatars1.githubusercontent.com/u/28967808?v=4","gravatar_id":"","url":"https://api.github.com/users/MorrieAtElastic","html_url":"https://github.com/MorrieAtElastic","followers_url":"https://api.github.com/users/MorrieAtElastic/followers","following_url":"https://api.github.com/users/MorrieAtElastic/following{/other_user}","gists_url":"https://api.github.com/users/MorrieAtElastic/gists{/gist_id}","starred_url":"https://api.github.com/users/MorrieAtElastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MorrieAtElastic/subscriptions","organizations_url":"https://api.github.com/users/MorrieAtElastic/orgs","repos_url":"https://api.github.com/users/MorrieAtElastic/repos","events_url":"https://api.github.com/users/MorrieAtElastic/events{/privacy}","received_events_url":"https://api.github.com/users/MorrieAtElastic/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":654494999,"node_id":"MDU6TGFiZWw2NTQ0OTQ5OTk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.1.0","name":"v6.1.0","color":"dddddd","default":false,"description":null},{"id":782894594,"node_id":"MDU6TGFiZWw3ODI4OTQ1OTQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.1.2","name":"v6.1.2","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"assignees":[{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2018-02-01T07:12:30Z","updated_at":"2018-03-14T13:49:16Z","closed_at":"2018-03-14T13:49:16Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):6.1, 6.2 \r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):1.08\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): ubuntu14\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nThe following  index-setting and mapping script works in versions 5.3.X  and 5.6.X but fails when run against V 6.1 and V6.2: \r\n\r\n```\r\nDELETE test\r\nPUT test\r\n{\r\n\t\"settings\": {\r\n\t\t\"index\": {\r\n\t\t\t\"number_of_shards\": 1,\r\n\t\t\t\"number_of_replicas\": 0,\r\n\t\t\t\"analysis\": {\r\n\t\t\t\t\"filter\": {\r\n\t\t\t\t\t\"split_words\": {\r\n\t\t\t\t\t\t\"split_on_numerics\": false,\r\n\t\t\t\t\t\t\"generate_word_parts\": true,\r\n\t\t\t\t\t\t\"type\": \"word_delimiter\",\r\n\t\t\t\t\t\t\"preserve_original\": true,\r\n\t\t\t\t\t\t\"stem_english_possessive\": false\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"analyzer\": {\r\n\t\t\t\t\t\"path\": {\r\n\t\t\t\t\t\t\"filter\": [\r\n\t\t\t\t\t\t\t\"split_words\"\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t\t\"tokenizer\": \"file_path_tokenizer\"\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\"tokenizer\": {\r\n\t\t\t\t\t\"file_path_tokenizer\": {\r\n\t\t\t\t\t\t\"reverse\": \"true\",\r\n\t\t\t\t\t\t\"type\": \"path_hierarchy\"\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t\"mappings\": {\r\n\t\t\"doc\": {\r\n\t\t\t\"dynamic\": \"false\",\r\n\t\t\t\"properties\": {\r\n\t\t\t\t\"name\": {\r\n\t\t\t\t\t\"type\": \"text\",\r\n\t\t\t\t\t\"analyzer\": \"path\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nPOST test/doc/1\r\n{\"name\": \"HKLM/SOFTWARE/soft\"}\r\n\r\nGET /test/_analyze\r\n{\r\n  \"field\": \"name\",\r\n  \"text\": [\r\n    \"HKLM/SOFTWARE/soft\"\r\n  ]\r\n}\r\n\r\n```  \r\n\r\n**Comments**\r\n\r\n- the above script is actually a simplified version of the original script which reproduces the problem. \r\n\r\n- when run against V5 elasticsearch the POST command given in the above script will index the document; when run against V6.1 or V6.2 the same command returns the following error: \r\n\r\n```\r\n> {\"name\": \"HKLM\\\\SOFTWARE\\\\soft\"}'\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"illegal_argument_exception\",\r\n        \"reason\" : \"startOffset must be non-negative, and endOffset must be >= startOffset, and offsets must not go backwards startOffset=5,endOffset=18,lastStartOffset=14 for field 'name'\"\r\n      }\r\n    ],\r\n    \"type\" : \"illegal_argument_exception\",\r\n    \"reason\" : \"startOffset must be non-negative, and endOffset must be >= startOffset, and offsets must not go backwards startOffset=5,endOffset=18,lastStartOffset=14 for field 'name'\"\r\n  },\r\n  \"status\" : 400\r\n}\r\n\r\n```\r\n\r\n- error  does not reproduce if the \"split_words\" filter is removed from the setting clause.  \r\n","closed_by":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}