[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193804696","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193804696","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193804696,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgwNDY5Ng==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T14:32:11Z","updated_at":"2016-03-08T14:32:11Z","author_association":"CONTRIBUTOR","body":"> The only problem I can see is that users might expect to get an IPv4 address back (eg 192.168.1.5) and instead it'd be returned as 0:0:0:0:0:ffff:c0a8:105. Perhaps we should have an ipv4 field as well that handles only IPv4 addresses, or add some option to render as IPv4 when possible?\n\nThat is not true. This is only something that happens internally in a BKD tree. Users do not see it. You do not \"get things back\" from that API. \n\nAlso note: if you follow the RFC correctly, then calling https://docs.oracle.com/javase/7/docs/api/java/net/InetAddress.html#getByAddress%28byte[]%29 with a 128-bit mapped IPv4 address returns back a 32-bit Inet4Address: it does this round tripping for you. That is why all Query.toString()'s and so on work intuitively with the lucene support.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193805266","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193805266","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193805266,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgwNTI2Ng==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T14:34:34Z","updated_at":"2016-03-08T14:34:34Z","author_association":"CONTRIBUTOR","body":"While we don't have this issue with the bkd tree, I think it's something we will have to think about for doc values, eg. for computing the top ip addresses that hit a web server.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193806101","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193806101","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193806101,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgwNjEwMQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T14:36:42Z","updated_at":"2016-03-08T14:36:42Z","author_association":"CONTRIBUTOR","body":"its really not at all. just encode the same way, and use InetAddress to decode for any presentation form.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193806742","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193806742","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193806742,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgwNjc0Mg==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T14:38:04Z","updated_at":"2016-03-08T14:38:04Z","author_association":"CONTRIBUTOR","body":"Its this part that is super-important: calling https://docs.oracle.com/javase/7/docs/api/java/net/InetAddress.html#getByAddress%28byte[]%29 with a 128-bit mapped IPv4 address returns back a 32-bit Inet4Address: it does this round tripping for you\n\nso if you want to display to the user in any way, make an InetAddress from the bytes. it does the right thing. \n\nPlease don't make ipv4 vs ipv6 types or any other craziness when this all works exactly as the user expects using basic java apis!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193814104","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193814104","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193814104,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgxNDEwNA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T14:57:33Z","updated_at":"2016-03-08T14:57:33Z","author_association":"CONTRIBUTOR","body":"I agree there should not be two types and I'm not concerned about the Java API. The question was more about what we do on the rest layer eg. is it ok for aggs to render ip addresses differently from the way they were formatted at index time. I think it is, but it did not happen with the v4-only field so I think it's also important that we raise the question and document the behaviour.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193814657","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193814657","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193814657,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgxNDY1Nw==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T14:59:25Z","updated_at":"2016-03-08T14:59:25Z","author_association":"CONTRIBUTOR","body":"I don't think you guys get how the transition mechanism works inside the java InetAddress class. I encourage you to play with it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193816265","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193816265","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193816265,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgxNjI2NQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T15:05:11Z","updated_at":"2016-03-08T15:05:11Z","author_association":"CONTRIBUTOR","body":"> Please don't make ipv4 vs ipv6 types or any other craziness when this all works exactly as the user expects using basic java apis!\n\nRelax, Rob.  The only reason I suggested it was because I was unaware of the information that you have provided. Thanks for the link.\n\nIsn't it true though that if a user indexes an IPv4 address in IPv6 format, doc values will return the address in IPv4 format? (ie not what they indexed?). \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193817660","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193817660","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193817660,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgxNzY2MA==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T15:09:45Z","updated_at":"2016-03-08T15:09:45Z","author_association":"CONTRIBUTOR","body":"If someone supplies an ipv4 address (mapped or not), its an ipv4 address. thats what that reserved space in the ipv4 region is for. If someone supplies an ipv6 address, its an ipv6 address.\n\nnote that ipv6 addresses can be represented in many ways. i recommend emitting canonical representations. So if someone supplies `0:0:0:0:0:0:0:1` they can expect to get it back as `::1`.\n\nIts always \"what they indexed\". its the same address. Its like returning `16.0` vs returning `16`. \n\nPlease, lets not try to overcomplicate this. Its not complicated.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193818171","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193818171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193818171,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgxODE3MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T15:11:25Z","updated_at":"2016-03-08T15:11:25Z","author_association":"CONTRIBUTOR","body":"> Please, lets not try to overcomplicate this. Its not complicated.\n\nI wasn't trying to overcomplicate it, I was trying to understand it.  Thank you for explaining.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193819173","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193819173","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193819173,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgxOTE3Mw==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T15:14:51Z","updated_at":"2016-03-08T15:14:51Z","author_association":"CONTRIBUTOR","body":"as far as docvalues, i would just use SortedSetDocValues class for internet addresses. This is critical for ipv6 data because (like the BKD tree) it will provide prefix compression. \n\nFor network addresses, \"range\" operations are a common operation (e.g. cidr/prefix operations), so having ordinal indirection is not useless, and can speed things up.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193822059","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193822059","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193822059,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgyMjA1OQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T15:21:36Z","updated_at":"2016-03-08T15:21:36Z","author_association":"CONTRIBUTOR","body":"And for that to work, docvalues needs a little tweak before the compression will happen: we currently always 'bail' on prefix-compression for fixed-length data: https://github.com/apache/lucene-solr/blob/master/lucene/core/src/java/org/apache/lucene/codecs/lucene54/Lucene54DocValuesConsumer.java#L423-L425\n\nthat is not always the best tradeoff...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193824917","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193824917","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193824917,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgyNDkxNw==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T15:31:12Z","updated_at":"2016-03-08T15:31:12Z","author_association":"CONTRIBUTOR","body":"We may even want to turn that logic off completely. basically that logic was originally added to \"save space\" (= save on addresses) before we had prefix compression at all...\n\nUnfortunately, we really need to solve this to avoid \"my ip address field quadrupled in size!\"\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/193829306","html_url":"https://github.com/elastic/elasticsearch/issues/17007#issuecomment-193829306","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17007","id":193829306,"node_id":"MDEyOklzc3VlQ29tbWVudDE5MzgyOTMwNg==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-03-08T15:44:00Z","updated_at":"2016-03-08T15:44:00Z","author_association":"CONTRIBUTOR","body":"I opened https://issues.apache.org/jira/browse/LUCENE-7081\n","performed_via_github_app":null}]