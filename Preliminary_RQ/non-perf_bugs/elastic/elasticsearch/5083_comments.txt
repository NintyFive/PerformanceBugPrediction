[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34756754","html_url":"https://github.com/elastic/elasticsearch/issues/5083#issuecomment-34756754","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5083","id":34756754,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzU2NzU0","user":{"login":"ssanghavi","id":5438020,"node_id":"MDQ6VXNlcjU0MzgwMjA=","avatar_url":"https://avatars0.githubusercontent.com/u/5438020?v=4","gravatar_id":"","url":"https://api.github.com/users/ssanghavi","html_url":"https://github.com/ssanghavi","followers_url":"https://api.github.com/users/ssanghavi/followers","following_url":"https://api.github.com/users/ssanghavi/following{/other_user}","gists_url":"https://api.github.com/users/ssanghavi/gists{/gist_id}","starred_url":"https://api.github.com/users/ssanghavi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssanghavi/subscriptions","organizations_url":"https://api.github.com/users/ssanghavi/orgs","repos_url":"https://api.github.com/users/ssanghavi/repos","events_url":"https://api.github.com/users/ssanghavi/events{/privacy}","received_events_url":"https://api.github.com/users/ssanghavi/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T14:05:09Z","updated_at":"2014-02-11T14:05:09Z","author_association":"NONE","body":"Forgot to mention the elasticsearch versions\n\nversion              test passes/failed?\n0.90.11                 FAIL\n0.90.9                   FAIL\n0.20.2                   PASS\n\nSo this seems to be broken in 0.90.*\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34763919","html_url":"https://github.com/elastic/elasticsearch/issues/5083#issuecomment-34763919","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5083","id":34763919,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzYzOTE5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T15:19:42Z","updated_at":"2014-02-11T15:19:42Z","author_association":"CONTRIBUTOR","body":"I think since 0.90 you need to run a refresh after the delete by query. Can you try if that fixes the problem?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34787584","html_url":"https://github.com/elastic/elasticsearch/issues/5083#issuecomment-34787584","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5083","id":34787584,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzg3NTg0","user":{"login":"ssanghavi","id":5438020,"node_id":"MDQ6VXNlcjU0MzgwMjA=","avatar_url":"https://avatars0.githubusercontent.com/u/5438020?v=4","gravatar_id":"","url":"https://api.github.com/users/ssanghavi","html_url":"https://github.com/ssanghavi","followers_url":"https://api.github.com/users/ssanghavi/followers","following_url":"https://api.github.com/users/ssanghavi/following{/other_user}","gists_url":"https://api.github.com/users/ssanghavi/gists{/gist_id}","starred_url":"https://api.github.com/users/ssanghavi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssanghavi/subscriptions","organizations_url":"https://api.github.com/users/ssanghavi/orgs","repos_url":"https://api.github.com/users/ssanghavi/repos","events_url":"https://api.github.com/users/ssanghavi/events{/privacy}","received_events_url":"https://api.github.com/users/ssanghavi/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T18:27:04Z","updated_at":"2014-02-11T18:27:04Z","author_association":"NONE","body":"thanks for quick reply, refresh did not help ...\ncurl -s -XPOST 'http://localhost:9200/_all/_refresh'\n\nDelete by query produces below output where it failed to delete. However I do not see anything in logs\n\"twitter-24\":{\"_shards\":{\"total\":5,\"successful\":1,\"failed\":4}}\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34787996","html_url":"https://github.com/elastic/elasticsearch/issues/5083#issuecomment-34787996","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5083","id":34787996,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzg3OTk2","user":{"login":"ssanghavi","id":5438020,"node_id":"MDQ6VXNlcjU0MzgwMjA=","avatar_url":"https://avatars0.githubusercontent.com/u/5438020?v=4","gravatar_id":"","url":"https://api.github.com/users/ssanghavi","html_url":"https://github.com/ssanghavi","followers_url":"https://api.github.com/users/ssanghavi/followers","following_url":"https://api.github.com/users/ssanghavi/following{/other_user}","gists_url":"https://api.github.com/users/ssanghavi/gists{/gist_id}","starred_url":"https://api.github.com/users/ssanghavi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ssanghavi/subscriptions","organizations_url":"https://api.github.com/users/ssanghavi/orgs","repos_url":"https://api.github.com/users/ssanghavi/repos","events_url":"https://api.github.com/users/ssanghavi/events{/privacy}","received_events_url":"https://api.github.com/users/ssanghavi/received_events","type":"User","site_admin":false},"created_at":"2014-02-11T18:30:46Z","updated_at":"2014-02-11T18:30:46Z","author_association":"NONE","body":"URL in previous comment got corrupted its actually\ncurl -s -XPOST 'http://localhost:9200/_all/_refresh'\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34838068","html_url":"https://github.com/elastic/elasticsearch/issues/5083#issuecomment-34838068","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5083","id":34838068,"node_id":"MDEyOklzc3VlQ29tbWVudDM0ODM4MDY4","user":{"login":"kzwang","id":2177991,"node_id":"MDQ6VXNlcjIxNzc5OTE=","avatar_url":"https://avatars3.githubusercontent.com/u/2177991?v=4","gravatar_id":"","url":"https://api.github.com/users/kzwang","html_url":"https://github.com/kzwang","followers_url":"https://api.github.com/users/kzwang/followers","following_url":"https://api.github.com/users/kzwang/following{/other_user}","gists_url":"https://api.github.com/users/kzwang/gists{/gist_id}","starred_url":"https://api.github.com/users/kzwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzwang/subscriptions","organizations_url":"https://api.github.com/users/kzwang/orgs","repos_url":"https://api.github.com/users/kzwang/repos","events_url":"https://api.github.com/users/kzwang/events{/privacy}","received_events_url":"https://api.github.com/users/kzwang/received_events","type":"User","site_admin":false},"created_at":"2014-02-12T04:34:00Z","updated_at":"2014-02-12T04:34:28Z","author_association":"CONTRIBUTOR","body":"@ssanghavi \nCan you try add a config `threadpool.index.queue_size` to something larger than 200 e.g. `threadpool.index.queue_size: 1000` or set to -1 and try again\n\nI think the queue size for index thread pool is default to 200 and that delete by query will add more than 200 jobs, so it will fail\n\nThe IndexDeleteByQueryResponse contains failures information but not returned to client, I found this error there\n\n```\nEsRejectedExecutionException[rejected execution (queue capacity 200) on org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$1@63808bcc]\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/34860968","html_url":"https://github.com/elastic/elasticsearch/issues/5083#issuecomment-34860968","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5083","id":34860968,"node_id":"MDEyOklzc3VlQ29tbWVudDM0ODYwOTY4","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2014-02-12T11:41:20Z","updated_at":"2014-02-12T11:41:20Z","author_association":"MEMBER","body":"Hi @ssanghavi, the `_shards` section in the response is very important. You got failures back, thus it makes sense that not all documents got deleted.\n\nThe reason why that happened seems to be indeed the number of concurrent tasks that need to be executed, which relates to how many shards your request hits on a single node. 50 indices \\* 5 shards = 250 which is higher than the queue size (200). I wouldn't recommend to increase the threadpool size, but rather to scale out to more nodes, or try and split your request into more requests that hit less shards each.\n\nIn 0.20 we had an unbounded queue size, which is why you didn't see this happen. but you do see it in 0.90.x.\n\nClosing this as it is the expected behaviour, I'll follow up on getting back the actual shard failures though (#5093).\n","performed_via_github_app":null}]