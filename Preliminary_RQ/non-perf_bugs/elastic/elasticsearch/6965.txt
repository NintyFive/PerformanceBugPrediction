{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6965","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6965/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6965/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6965/events","html_url":"https://github.com/elastic/elasticsearch/issues/6965","id":38422140,"node_id":"MDU6SXNzdWUzODQyMjE0MA==","number":6965,"title":"[date_histogram aggregation] OutOfMemoryError when using \"time_zone\" attribute","user":{"login":"boillodmanuel","id":621455,"node_id":"MDQ6VXNlcjYyMTQ1NQ==","avatar_url":"https://avatars0.githubusercontent.com/u/621455?v=4","gravatar_id":"","url":"https://api.github.com/users/boillodmanuel","html_url":"https://github.com/boillodmanuel","followers_url":"https://api.github.com/users/boillodmanuel/followers","following_url":"https://api.github.com/users/boillodmanuel/following{/other_user}","gists_url":"https://api.github.com/users/boillodmanuel/gists{/gist_id}","starred_url":"https://api.github.com/users/boillodmanuel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/boillodmanuel/subscriptions","organizations_url":"https://api.github.com/users/boillodmanuel/orgs","repos_url":"https://api.github.com/users/boillodmanuel/repos","events_url":"https://api.github.com/users/boillodmanuel/events{/privacy}","received_events_url":"https://api.github.com/users/boillodmanuel/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2014-07-22T17:16:24Z","updated_at":"2014-08-07T22:55:29Z","closed_at":"2014-08-01T07:08:33Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch version : 1.2.2\nOperation : date_histogram aggregation\n\nIn date_histogram aggregation [(documentation)](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-datehistogram-aggregation.html#search-aggregations-bucket-datehistogram-aggregation), when I use the \"time_zone\" attribute, I have an OutOfMemoryError (see response below).\n\n```\n{\n   \"error\": \"ReduceSearchPhaseException[Failed to execute phase [fetch], [reduce] ]; nested: OutOfMemoryError[Java heap space]; \",\n   \"status\": 503\n}\n```\n\nThe complete stacktrace is: \n\n```\n[2014-07-22 19:01:15,800][DEBUG][action.search.type       ] [Briquette] failed to reduce search\norg.elasticsearch.action.search.ReduceSearchPhaseException: Failed to execute phase [fetch], [reduce] \n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.finishHim(TransportSearchQueryThenFetchAction.java:140)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$1.onResult(TransportSearchQueryThenFetchAction.java:112)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction$1.onResult(TransportSearchQueryThenFetchAction.java:106)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:526)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:724)\nCaused by: java.lang.OutOfMemoryError: Java heap space\n    at org.elasticsearch.search.aggregations.bucket.histogram.InternalDateHistogram.createBucket(InternalDateHistogram.java:146)\n    at org.elasticsearch.search.aggregations.bucket.histogram.InternalDateHistogram.createBucket(InternalDateHistogram.java:36)\n    at org.elasticsearch.search.aggregations.bucket.histogram.InternalHistogram.reduce(InternalHistogram.java:324)\n    at org.elasticsearch.search.aggregations.InternalAggregations.reduce(InternalAggregations.java:140)\n    at org.elasticsearch.search.controller.SearchPhaseController.merge(SearchPhaseController.java:545)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.innerFinishHim(TransportSearchQueryThenFetchAction.java:151)\n    at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.finishHim(TransportSearchQueryThenFetchAction.java:138)\n    ... 6 more\n```\n\nQuery detail : \n\n```\nPOST index/type/_search\n{\n  \"query\": {\n    \"filtered\": {\n      \"query\": {\n        \"match_all\": {}\n      }\n    }\n  },\n  \"aggregations\": {\n    \"tendance\": {\n      \"date_histogram\": {\n        \"field\": \"date_creation\",\n        \"interval\": \"month\",\n        \"min_doc_count\": 0,\n        \"time_zone\": 1,\n        \"extended_bounds\": {\n          \"min\": \"2013-01-01T00:00:00.000+01:00\",\n          \"max\": \"2013-01-31T23:59:59.999+01:00\"\n        }\n      }\n    }\n  }\n}\n```\n\nWith `\"time_zone\": \"Europe/Paris\"`, I have the same error.\nWith `\"time_zone\": 0`, everything is good and the query tooks 19ms.\n\nThe document mapping is:\n\n```\n\"mappings\":{  \n      \"marche_prive\":{  \n         \"properties\":{  \n            \"date_creation\":{  \n               \"include_in_all\":false,\n               \"store\":true,\n               \"format\":\"dateOptionalTime\",\n               \"type\":\"date\"\n            }\n         }\n      }\n   }\n```\n\nI haven't any ideas of what happens! \n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}