[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490410689","html_url":"https://github.com/elastic/elasticsearch/issues/41936#issuecomment-490410689","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41936","id":490410689,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDQxMDY4OQ==","user":{"login":"Hohol","id":2988117,"node_id":"MDQ6VXNlcjI5ODgxMTc=","avatar_url":"https://avatars0.githubusercontent.com/u/2988117?v=4","gravatar_id":"","url":"https://api.github.com/users/Hohol","html_url":"https://github.com/Hohol","followers_url":"https://api.github.com/users/Hohol/followers","following_url":"https://api.github.com/users/Hohol/following{/other_user}","gists_url":"https://api.github.com/users/Hohol/gists{/gist_id}","starred_url":"https://api.github.com/users/Hohol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hohol/subscriptions","organizations_url":"https://api.github.com/users/Hohol/orgs","repos_url":"https://api.github.com/users/Hohol/repos","events_url":"https://api.github.com/users/Hohol/events{/privacy}","received_events_url":"https://api.github.com/users/Hohol/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T09:09:10Z","updated_at":"2019-05-08T09:09:10Z","author_association":"CONTRIBUTOR","body":"If someone from Elastic team confirms that it should be done, I can work on this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490456120","html_url":"https://github.com/elastic/elasticsearch/issues/41936#issuecomment-490456120","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41936","id":490456120,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDQ1NjEyMA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T11:52:49Z","updated_at":"2019-05-08T11:52:49Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490535197","html_url":"https://github.com/elastic/elasticsearch/issues/41936#issuecomment-490535197","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41936","id":490535197,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDUzNTE5Nw==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T15:32:57Z","updated_at":"2019-05-08T15:45:54Z","author_association":"CONTRIBUTOR","body":"@Hohol This isn't currently possible due to possible different date formats available that would make any single value ambiguous.  As an example _source could have a long to represent a date, but that value alone wouldn't tell us whether that is milliseconds since epoch or nanoseconds since epoch so more user information would be necessary.  If _source contains a String, the user would need to provide information about the date's format.  And in the case of using doc['some_date_field'], at this time JodaCompatibleZonedDateTime is always returned as the value, so a utility method wouldn't be necessary at the type is known.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490649704","html_url":"https://github.com/elastic/elasticsearch/issues/41936#issuecomment-490649704","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41936","id":490649704,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDY0OTcwNA==","user":{"login":"Hohol","id":2988117,"node_id":"MDQ6VXNlcjI5ODgxMTc=","avatar_url":"https://avatars0.githubusercontent.com/u/2988117?v=4","gravatar_id":"","url":"https://api.github.com/users/Hohol","html_url":"https://github.com/Hohol","followers_url":"https://api.github.com/users/Hohol/followers","following_url":"https://api.github.com/users/Hohol/following{/other_user}","gists_url":"https://api.github.com/users/Hohol/gists{/gist_id}","starred_url":"https://api.github.com/users/Hohol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hohol/subscriptions","organizations_url":"https://api.github.com/users/Hohol/orgs","repos_url":"https://api.github.com/users/Hohol/repos","events_url":"https://api.github.com/users/Hohol/events{/privacy}","received_events_url":"https://api.github.com/users/Hohol/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T21:02:15Z","updated_at":"2019-05-08T21:02:15Z","author_association":"CONTRIBUTOR","body":"@jdconrad I totally forgot to mention that date field in question is a scripted field (probably you already figured it out from linked PR).\r\n\r\n>  And in the case of using doc['some_date_field'], at this time JodaCompatibleZonedDateTime is always returned as the value, so a utility method wouldn't be necessary at the type is known.\r\n\r\nAre you talking about scripted fields here? If so, I disagree. It's exactly where the problem comes from.\r\nIf you perform steps specified in https://github.com/elastic/kibana/issues/24891, type of `doc['some_date_field']` will be `Long`, not `JodaCompatibleZonedDateTime`. Although field type is `date` and Kibana perceives it correctly as date.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490652548","html_url":"https://github.com/elastic/elasticsearch/issues/41936#issuecomment-490652548","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41936","id":490652548,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDY1MjU0OA==","user":{"login":"Hohol","id":2988117,"node_id":"MDQ6VXNlcjI5ODgxMTc=","avatar_url":"https://avatars0.githubusercontent.com/u/2988117?v=4","gravatar_id":"","url":"https://api.github.com/users/Hohol","html_url":"https://github.com/Hohol","followers_url":"https://api.github.com/users/Hohol/followers","following_url":"https://api.github.com/users/Hohol/following{/other_user}","gists_url":"https://api.github.com/users/Hohol/gists{/gist_id}","starred_url":"https://api.github.com/users/Hohol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hohol/subscriptions","organizations_url":"https://api.github.com/users/Hohol/orgs","repos_url":"https://api.github.com/users/Hohol/repos","events_url":"https://api.github.com/users/Hohol/events{/privacy}","received_events_url":"https://api.github.com/users/Hohol/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T21:11:59Z","updated_at":"2019-05-08T21:13:23Z","author_association":"CONTRIBUTOR","body":"Wait, I'm wrong. In https://github.com/elastic/kibana/issues/24891 I used `doc['some_date_field'].value`, not `doc['some_date_field']`.\r\nWill the type always be `JodaCompatibleZonedDateTime` if I use `doc['some_date_field']`?\r\n(Can't check it myself right now)\r\nAnyway, I think we need to support field definitions of type `doc['some_date_field'].value` as well.\r\nFor example, if there was some date math in a field script and the result is of `Long` type.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490659124","html_url":"https://github.com/elastic/elasticsearch/issues/41936#issuecomment-490659124","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41936","id":490659124,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDY1OTEyNA==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T21:33:36Z","updated_at":"2019-05-08T21:34:43Z","author_association":"CONTRIBUTOR","body":"@Hohol I didn't check the version that the issue was related to in Kibana.  I believe as of 7.0 ```doc['some_date_field'].value``` will return a JodaCompatibleDateTime.  You are correct that in 6.4 it depends on the field type.  If the field is a date field then ReadableDateTime is returned.  If it's a long field ```doc['some_date_field'].value`` will return a long, but ```doc['some_date_field'].date``` will return a ReadableDateTime.  Either way, given the user should be aware of the field type coming from doc, there shouldn't be a need for a utility method on the Painless side for this specific case unless I'm misunderstanding something.\r\n\r\nI agree with your second point that date math is relatively difficult through the exposed Java APIs, and it's possible there may be a way to make it easier.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/490661740","html_url":"https://github.com/elastic/elasticsearch/issues/41936#issuecomment-490661740","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41936","id":490661740,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDY2MTc0MA==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2019-05-08T21:42:49Z","updated_at":"2019-05-08T21:42:49Z","author_association":"CONTRIBUTOR","body":"Field mappings determine the type of field available as part of the doc variable.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/491095712","html_url":"https://github.com/elastic/elasticsearch/issues/41936#issuecomment-491095712","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41936","id":491095712,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MTA5NTcxMg==","user":{"login":"Hohol","id":2988117,"node_id":"MDQ6VXNlcjI5ODgxMTc=","avatar_url":"https://avatars0.githubusercontent.com/u/2988117?v=4","gravatar_id":"","url":"https://api.github.com/users/Hohol","html_url":"https://github.com/Hohol","followers_url":"https://api.github.com/users/Hohol/followers","following_url":"https://api.github.com/users/Hohol/following{/other_user}","gists_url":"https://api.github.com/users/Hohol/gists{/gist_id}","starred_url":"https://api.github.com/users/Hohol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Hohol/subscriptions","organizations_url":"https://api.github.com/users/Hohol/orgs","repos_url":"https://api.github.com/users/Hohol/repos","events_url":"https://api.github.com/users/Hohol/events{/privacy}","received_events_url":"https://api.github.com/users/Hohol/received_events","type":"User","site_admin":false},"created_at":"2019-05-09T22:53:44Z","updated_at":"2019-05-09T22:53:44Z","author_association":"CONTRIBUTOR","body":"Thank you, @jdconrad. We discussed it in PR thread and decided we can always assume the type to be `JodaCompatibleDateTime`.","performed_via_github_app":null}]