[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/20257374","html_url":"https://github.com/elastic/elasticsearch/issues/3190#issuecomment-20257374","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3190","id":20257374,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjU3Mzc0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-06-30T23:07:13Z","updated_at":"2013-07-04T11:11:41Z","author_association":"MEMBER","body":"I added a benchmark (ChildSearchShortCircutBenchmark) to test the short circuit mechanisms @mattweber came up with and the results look promising. The benchmark inserts 10M parent docs and a bunch of child docs. Child docs are inserted in groups from a group containing 1 doc to 1M docs (each group has double amount of child docs as previous group), this allows to show the performance impact between short circuits in place and no short circuits in place.\n\nTest results without the short circuits:\n\n```\n--> has_child filter with 1 parent hits, query Avg: 139ms\n--> has_child filter with 2 parent hits, query Avg: 287ms\n--> has_child filter with 4 parent hits, query Avg: 448ms\n--> has_child filter with 8 parent hits, query Avg: 641ms\n--> has_child filter with 16 parent hits, query Avg: 849ms\n--> has_child filter with 32  parent hits, query Avg: 1063ms\n--> has_child filter with 64 parent hits, query Avg: 1268ms\n--> has_child filter with 128 parent hits, query Avg: 1469ms\n--> has_child filter with 256 parent hits, query Avg: 1660ms\n--> has_child filter with 512 parent hits, query Avg: 1851ms\n--> has_child filter with 1024 parent hits, query Avg: 2048ms\n--> has_child filter with 2048 parent hits, query Avg: 2236ms\n--> has_child filter with 4096 parent hits, query Avg: 2428ms\n--> has_child filter with 8192 parent hits, query Avg: 2612ms\n--> has_child filter with 16384 parent hits, query Avg: 2803ms\n--> has_child filter with 32768 parent hits, query Avg: 3007ms\n--> has_child filter with 65536 parent hits, query Avg: 3230ms\n```\n\nTest results with the short circuit:\n\n```\n--> has_child filter with 1 parent hits, query Avg: 3ms\n--> has_child filter with 2 parent hits, query Avg: 6ms\n--> has_child filter with 4 parent hits query Avg: 9ms\n--> has_child filter with 8 parent hits query Avg: 13ms\n--> has_child filter with 16 parent hits query Avg: 17ms\n--> has_child filter with 32 parent hits query Avg: 20ms\n--> has_child filter with 64 parent hits query Avg: 24ms\n--> has_child filter with 128 parent hits query Avg: 28ms\n--> has_child filter with 256 parent hits query  Avg: 33ms\n--> has_child filter with 512 parent hits query  Avg: 37ms\n--> has_child filter with 1024 parent hits query  Avg: 49ms\n--> has_child filter with 2048 parent hits query  Avg: 62ms\n--> has_child filter with 4096 parent hits query  Avg: 80ms\n--> has_child filter with 8192 parent hits query  Avg: 111ms\n--> has_child filter with 16384 parent hits query  Avg: 172ms\n--> has_child filter with 32768 parent hits query  Avg: 275ms\n--> has_child filter with 65536 parent hits query  Avg: 453ms\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/20312493","html_url":"https://github.com/elastic/elasticsearch/issues/3190#issuecomment-20312493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3190","id":20312493,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzEyNDkz","user":{"login":"mattweber","id":173955,"node_id":"MDQ6VXNlcjE3Mzk1NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mattweber","html_url":"https://github.com/mattweber","followers_url":"https://api.github.com/users/mattweber/followers","following_url":"https://api.github.com/users/mattweber/following{/other_user}","gists_url":"https://api.github.com/users/mattweber/gists{/gist_id}","starred_url":"https://api.github.com/users/mattweber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattweber/subscriptions","organizations_url":"https://api.github.com/users/mattweber/orgs","repos_url":"https://api.github.com/users/mattweber/repos","events_url":"https://api.github.com/users/mattweber/events{/privacy}","received_events_url":"https://api.github.com/users/mattweber/received_events","type":"User","site_admin":false},"created_at":"2013-07-01T21:40:31Z","updated_at":"2013-07-01T21:40:31Z","author_association":"CONTRIBUTOR","body":"Wow this is even better than what I observed in my tests.  Very cool.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21195953","html_url":"https://github.com/elastic/elasticsearch/issues/3190#issuecomment-21195953","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3190","id":21195953,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMTk1OTUz","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-07-18T16:28:10Z","updated_at":"2013-07-18T16:28:10Z","author_association":"MEMBER","body":"Thanks @mattweber for bringing this optimisations up!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/108278711","html_url":"https://github.com/elastic/elasticsearch/issues/3190#issuecomment-108278711","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3190","id":108278711,"node_id":"MDEyOklzc3VlQ29tbWVudDEwODI3ODcxMQ==","user":{"login":"kaliseo","id":1506320,"node_id":"MDQ6VXNlcjE1MDYzMjA=","avatar_url":"https://avatars2.githubusercontent.com/u/1506320?v=4","gravatar_id":"","url":"https://api.github.com/users/kaliseo","html_url":"https://github.com/kaliseo","followers_url":"https://api.github.com/users/kaliseo/followers","following_url":"https://api.github.com/users/kaliseo/following{/other_user}","gists_url":"https://api.github.com/users/kaliseo/gists{/gist_id}","starred_url":"https://api.github.com/users/kaliseo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaliseo/subscriptions","organizations_url":"https://api.github.com/users/kaliseo/orgs","repos_url":"https://api.github.com/users/kaliseo/repos","events_url":"https://api.github.com/users/kaliseo/events{/privacy}","received_events_url":"https://api.github.com/users/kaliseo/received_events","type":"User","site_admin":false},"created_at":"2015-06-03T09:50:41Z","updated_at":"2015-06-03T09:50:41Z","author_association":"NONE","body":"i there,\n\nVery interesting.\n\nDo you have and example of your has_child request ?\n\nThanks a lot !\n","performed_via_github_app":null}]