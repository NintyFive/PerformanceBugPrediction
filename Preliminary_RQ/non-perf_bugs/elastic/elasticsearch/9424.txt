{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9424","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9424/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9424/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9424/events","html_url":"https://github.com/elastic/elasticsearch/issues/9424","id":55513177,"node_id":"MDU6SXNzdWU1NTUxMzE3Nw==","number":9424,"title":"Unable to disable shard allocation prior to restart nodes when there is an index in memory","user":{"login":"bplsilva","id":472739,"node_id":"MDQ6VXNlcjQ3MjczOQ==","avatar_url":"https://avatars0.githubusercontent.com/u/472739?v=4","gravatar_id":"","url":"https://api.github.com/users/bplsilva","html_url":"https://github.com/bplsilva","followers_url":"https://api.github.com/users/bplsilva/followers","following_url":"https://api.github.com/users/bplsilva/following{/other_user}","gists_url":"https://api.github.com/users/bplsilva/gists{/gist_id}","starred_url":"https://api.github.com/users/bplsilva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bplsilva/subscriptions","organizations_url":"https://api.github.com/users/bplsilva/orgs","repos_url":"https://api.github.com/users/bplsilva/repos","events_url":"https://api.github.com/users/bplsilva/events{/privacy}","received_events_url":"https://api.github.com/users/bplsilva/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-01-26T17:42:31Z","updated_at":"2015-02-06T10:53:22Z","closed_at":"2015-01-30T10:17:07Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\nI have been writing a script that for properly restarting all the nodes of an ES cluster and I have noticed a few particular things in the process.\n\nThe process is quite simple, it is the same described in the official ES documentation\nhttp://www.elasticsearch.org/guide/en/elasticsearch/reference/current/cluster-nodes-shutdown.html#_rolling_restart_of_nodes_full_cluster_restart\nFor each node in the cluster:\n- disable shard allocation\n- shut down the node\n- restart the service via SSH\n- enable back shard allocation once the node rejoins the cluster\n- wait for the cluster to be OK before proceeding to the next node\n\nHowever, one of the indices of the cluster is stored in memory.\nWhen trying to disable shard allocation, we get an IllegalStateException (\"Free bytes [X] cannot be less than 0 or greater than total bytes [Y]\").\n\nSuch behaviour does not happens in a cluster when all the indices are stored on disk.\n\nWhen using 3 replicas for every shard, shutting down a node with an index in memory should not be a problem, since even if the content is lost during the shutdown, it should be able to retrieve the information from the replicas when the node rejoins the cluster.\n\nI do believe this is an issue from elasticsearch.\n\nThanks,\nBruno\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}