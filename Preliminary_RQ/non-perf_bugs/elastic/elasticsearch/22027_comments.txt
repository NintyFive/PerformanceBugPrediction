[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265443349","html_url":"https://github.com/elastic/elasticsearch/issues/22027#issuecomment-265443349","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22027","id":265443349,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQ0MzM0OQ==","user":{"login":"celesteking","id":748075,"node_id":"MDQ6VXNlcjc0ODA3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/748075?v=4","gravatar_id":"","url":"https://api.github.com/users/celesteking","html_url":"https://github.com/celesteking","followers_url":"https://api.github.com/users/celesteking/followers","following_url":"https://api.github.com/users/celesteking/following{/other_user}","gists_url":"https://api.github.com/users/celesteking/gists{/gist_id}","starred_url":"https://api.github.com/users/celesteking/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/celesteking/subscriptions","organizations_url":"https://api.github.com/users/celesteking/orgs","repos_url":"https://api.github.com/users/celesteking/repos","events_url":"https://api.github.com/users/celesteking/events{/privacy}","received_events_url":"https://api.github.com/users/celesteking/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T13:11:00Z","updated_at":"2016-12-07T13:28:08Z","author_association":"NONE","body":"Also, docs are way far from usable:\r\n```json\r\n  \"source\": {\r\n    \"index\": \"metricbeat-*\"\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"metricbeat\"\r\n  },\r\n  \"script\": {\r\n    \"lang\": \"painless\",\r\n    \"inline\": \"ctx._index = 'metricbeat-' + (ctx._index.substring('metricbeat-'.length(), ctx._index.length())) + '-1'\"\r\n  }\r\n```\r\n\r\nYou're assigning index to itself, basically. this wont' work. maybe you meant `ctx._source._index` ? This is really hard for a newbie guys.\r\n\r\n*update*: `ctx._index = ctx._source._index` didn't work. Nothing works. This is bullshit.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265495496","html_url":"https://github.com/elastic/elasticsearch/issues/22027#issuecomment-265495496","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22027","id":265495496,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQ5NTQ5Ng==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T16:28:22Z","updated_at":"2016-12-07T16:28:22Z","author_association":"MEMBER","body":"> You're assigning index to itself, basically. this wont' work. maybe you meant ctx._source._index ? This is really hard for a newbie guys.\r\n\r\nDid you try it ? I just did and it works like a charm. It basically does what you're asking below:\r\n> It looks like it's impossible to not specify destination index\r\n\r\nYes it's possible with what you call \"dirty scripting\". Sorry if you don't like scripts but that's the way it works.\r\n\r\n> update: ctx._index = ctx._source._index didn't work. Nothing works. This is bullshit.\r\n\r\nYes it doesn't work if you invent new syntax, what works is what's documented. I'll ignore the last part of your comment since I understand your frustration but please note that being aggressive doesn't solve anything ;)\r\n\r\nRegarding the hang, I can reproduce if the source node is not responding. I tested with the source node down and in that case the reindex blocks and there is no way to access the hanging task in the destination node. \r\nFor this reason I'll leave this issue open but I am sure that @nik9000 has a solution for this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265497796","html_url":"https://github.com/elastic/elasticsearch/issues/22027#issuecomment-265497796","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22027","id":265497796,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTQ5Nzc5Ng==","user":{"login":"celesteking","id":748075,"node_id":"MDQ6VXNlcjc0ODA3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/748075?v=4","gravatar_id":"","url":"https://api.github.com/users/celesteking","html_url":"https://github.com/celesteking","followers_url":"https://api.github.com/users/celesteking/followers","following_url":"https://api.github.com/users/celesteking/following{/other_user}","gists_url":"https://api.github.com/users/celesteking/gists{/gist_id}","starred_url":"https://api.github.com/users/celesteking/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/celesteking/subscriptions","organizations_url":"https://api.github.com/users/celesteking/orgs","repos_url":"https://api.github.com/users/celesteking/repos","events_url":"https://api.github.com/users/celesteking/events{/privacy}","received_events_url":"https://api.github.com/users/celesteking/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T16:36:16Z","updated_at":"2016-12-07T16:36:16Z","author_association":"NONE","body":".tasks / _tasks (why 2 of them?) API is unusable, reread my comment -- it just doesn't work, even for tasks that completed fine. \r\n\r\nAs regarding the main problem, yes, I tried specifying the script exactly as per doc. It doesn't work, it's trying to log to \"metricbeat\" , not to \"metricbeat-2016-12-07\".  I can provide access to our cluster so that you can try it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265504317","html_url":"https://github.com/elastic/elasticsearch/issues/22027#issuecomment-265504317","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22027","id":265504317,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTUwNDMxNw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T16:57:02Z","updated_at":"2016-12-07T16:57:02Z","author_association":"CONTRIBUTOR","body":"@celesteking to echo @jimczi's comment - this isn't your first issue where you get really aggressive.  Seriously, instead of telling us how shit it all is, just point out the problems you're having and we'll try  to help you.  The aggression just makes us want to look at the other 1,000 open issue instead of yours.\r\n\r\n> .tasks / _tasks (why 2 of them?) \r\n\r\n`.tasks` is the index where the info is stored, and the docs are trying to point out that you'll need to delete data from this index at some stage in the future so that it doesn't use too much space. Nowhere does it tell you to do `GET .tasks/task/ID`\r\n\r\n`_tasks` is the API and it should be `GET _tasks/Af0W-dC3QQSlJ28uRru0fQ:8488` as you used in the first example, not `GET /_tasks/taskId:8488`.  I can see how these docs could be confusing and will improve that.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265505935","html_url":"https://github.com/elastic/elasticsearch/issues/22027#issuecomment-265505935","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22027","id":265505935,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTUwNTkzNQ==","user":{"login":"celesteking","id":748075,"node_id":"MDQ6VXNlcjc0ODA3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/748075?v=4","gravatar_id":"","url":"https://api.github.com/users/celesteking","html_url":"https://github.com/celesteking","followers_url":"https://api.github.com/users/celesteking/followers","following_url":"https://api.github.com/users/celesteking/following{/other_user}","gists_url":"https://api.github.com/users/celesteking/gists{/gist_id}","starred_url":"https://api.github.com/users/celesteking/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/celesteking/subscriptions","organizations_url":"https://api.github.com/users/celesteking/orgs","repos_url":"https://api.github.com/users/celesteking/repos","events_url":"https://api.github.com/users/celesteking/events{/privacy}","received_events_url":"https://api.github.com/users/celesteking/received_events","type":"User","site_admin":false},"created_at":"2016-12-07T17:02:25Z","updated_at":"2016-12-07T17:02:25Z","author_association":"NONE","body":"According to REST guidelines, you should've used `DELETE _tasks/task/$id` and problem solved. This is not the first time I see inconsistencies in API. \r\n\r\nI will stop logging issues from now on (or helping in any way) and will probably switch over another tool for log storage. This thing is not production ready. Period.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265767719","html_url":"https://github.com/elastic/elasticsearch/issues/22027#issuecomment-265767719","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22027","id":265767719,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTc2NzcxOQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-12-08T15:27:38Z","updated_at":"2016-12-08T15:27:38Z","author_association":"CONTRIBUTOR","body":"> Regarding the hang, I can reproduce if the source node is not responding. I tested with the source node down and in that case the reindex blocks and there is no way to access the hanging task in the destination node.\r\n> For this reason I'll leave this issue open but I am sure that @nik9000 has a solution for this.\r\n\r\n@jimczi, do you know if the reindex was running on the source node? I can imagine a situation where you start a reindex, and then shoot the node that the reindex was running on before it finishes. The task get action notices that the node is no longer running and looks in the tasks index. If it doesn't find the task it then it reports that error message. And it won't find it because the reindex didn't complete before the node left. I think I need to add a better error message to that.\r\n\r\nAs to the question of multi-source, multi-destination: this comes a fair bit but I think the script solution is fine. The reason you might not want to do this at all is that you *probably* want to manage the process of creating each of the sub-indexes so you have progress and an easy way to pick up where you left off and things like that. If you do want to do it you can use the script. It tested on every build so it is going to work.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/265807419","html_url":"https://github.com/elastic/elasticsearch/issues/22027#issuecomment-265807419","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22027","id":265807419,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NTgwNzQxOQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-12-08T17:54:15Z","updated_at":"2016-12-08T17:54:15Z","author_association":"CONTRIBUTOR","body":"@jimczi and I talked - trying to reindex from remote from a node that refuses the connection indeed hangs. The reindex process is still in the tasks API and can be found with `curl 'localhost:9200/_tasks?pretty&detailed&actions=*reindex'`. I'll have a look at that this afternoon.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266123668","html_url":"https://github.com/elastic/elasticsearch/issues/22027#issuecomment-266123668","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22027","id":266123668,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NjEyMzY2OA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-12-09T21:08:02Z","updated_at":"2016-12-09T21:08:02Z","author_association":"CONTRIBUTOR","body":"> @jimczi, do you know if the reindex was running on the source node? I can imagine a situation where you start a reindex, and then shoot the node that the reindex was running on before it finishes. The task get action notices that the node is no longer running and looks in the tasks index. If it doesn't find the task it then it reports that error message. And it won't find it because the reindex didn't complete before the node left. I think I need to add a better error message to that.\r\n\r\nI merged #22062 just now to improve the error message when the node isn't part of the cluster any more.\r\n\r\n> @jimczi and I talked - trying to reindex from remote from a node that refuses the connection indeed hangs. The reindex process is still in the tasks API and can be found with curl 'localhost:9200/_tasks?pretty&detailed&actions=*reindex'. I'll have a look at that this afternoon.\r\n\r\nI merged #22061 this morning to fix the hang.\r\n\r\n","performed_via_github_app":null}]