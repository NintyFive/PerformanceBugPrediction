{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51183","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51183/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51183/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51183/events","html_url":"https://github.com/elastic/elasticsearch/issues/51183","id":551624727,"node_id":"MDU6SXNzdWU1NTE2MjQ3Mjc=","number":51183,"title":"RecoveryIT and IndexingIT fail due to tripped mapping assertion","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"assignees":[{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2020-01-17T20:48:05Z","updated_at":"2020-02-28T15:10:56Z","closed_at":"2020-02-28T15:10:55Z","author_association":"MEMBER","active_lock_reason":null,"body":"I've recently had a build fail due to test failures in RecoveryIT and IndexingIT. Looking into these test failures, the cluster and indices being tested fail to reach the green state within the timeout period. Ultimately the issue is caused by a tripped assertion, which causes a node to stop:\r\n\r\n```\r\nERROR][o.e.b.ElasticsearchUncaughtExceptionHandler] [v7.6.0-2] fatal error in thread [elasticsearch[v7.6.0-2][clusterApplierService#updateTask][T#1]], exiting | Â \r\njava.lang.AssertionError: {task=DocumentMapper{mapperService=org.elasticsearch.index.mapper.MapperService@77c1e129, type='task', typeText=task, mappingSource={\"task\":{\"dynamic\":\"strict\",\"_meta\":{\"version\":3},\"properties\":{\"completed\":{\"type\":\"boolean\"},\"error\":{\"type\":\"object\",\"enabled\":false},\"response\":{\"type\":\"object\",\"enabled\":false},\"task\":{\"properties\":{\"action\":{\"type\":\"keyword\"},\"cancellable\":{\"type\":\"boolean\"},\"description\":{\"type\":\"text\"},\"headers\":{\"type\":\"object\",\"enabled\":false},\"id\":{\"type\":\"long\"},\"node\":{\"type\":\"keyword\"},\"parent_task_id\":{\"type\":\"keyword\"},\"running_time_in_nanos\":{\"type\":\"long\"},\"start_time_in_millis\":{\"type\":\"long\"},\"status\":{\"type\":\"object\",\"enabled\":false},\"type\":{\"type\":\"keyword\"}}}}}}, mapping={\"task\":{\"dynamic\":\"strict\",\"_meta\":{\"version\":3},\"properties\":{\"completed\":{\"type\":\"boolean\"},\"error\":{\"type\":\"object\",\"enabled\":false},\"response\":{\"type\":\"object\",\"enabled\":false},\"task\":{\"properties\":{\"action\":{\"type\":\"keyword\"},\"cancellable\":{\"type\":\"boolean\"},\"description\":{\"type\":\"text\"},\"headers\":{\"type\":\"object\",\"enabled\":false},\"id\":{\"type\":\"long\"},\"node\":{\"type\":\"keyword\"},\"parent_task_id\":{\"type\":\"keyword\"},\"running_time_in_nanos\":{\"type\":\"long\"},\"start_time_in_millis\":{\"type\":\"long\"},\"status\":{\"type\":\"object\",\"enabled\":false},\"type\":{\"type\":\"keyword\"}}}}}}, documentParser=org.elasticsearch.index.mapper.DocumentParser@35774e22, fieldMappers=org.elasticsearch.index.mapper.DocumentFieldMappers@3a085607, objectMappers={task.headers=org.elasticsearch.index.mapper.ObjectMapper@6b3be457, task=org.elasticsearch.index.mapper.ObjectMapper@130b88b0, response=org.elasticsearch.index.mapper.ObjectMapper@1c82c2ad, task.status=org.elasticsearch.index.mapper.ObjectMapper@64421754, error=org.elasticsearch.index.mapper.ObjectMapper@50ef5ed7}, hasNestedObjects=false, deleteTombstoneMetadataFieldMappers=[org.elasticsearch.index.mapper.IdFieldMapper@1f6e0272, org.elasticsearch.index.mapper.SeqNoFieldMapper@15f33c98, org.elasticsearch.index.mapper.TypeFieldMapper@617f71c5, org.elasticsearch.index.mapper.VersionFieldMapper@4bcc82db], noopTombstoneMetadataFieldMappers=[org.elasticsearch.index.mapper.SeqNoFieldMapper@15f33c98, org.elasticsearch.index.mapper.VersionFieldMapper@4bcc82db]}}\r\nat org.elasticsearch.index.mapper.MapperService.assertMappingVersion(MapperService.java:280) ~[elasticsearch-7.7.0-SNAPSHOT.jar:7.7.0-SNAPSHOT]\r\n```\r\n\r\nBuild scans: https://gradle-enterprise.elastic.co/s/j5iirqv2bcpi6\r\nhttps://gradle-enterprise.elastic.co/s/t76crudkugcq4\r\nhttps://gradle-enterprise.elastic.co/s/5534denm6kbek\r\nhttps://gradle-enterprise.elastic.co/s/slb4rr2btp626\r\nhttps://gradle-enterprise.elastic.co/s/jcscjs7jtiegq\r\n\r\nIf I looked at emails of build failures correctly, it appears that this started on Jan 14th. I am not sure if this is related or not but there was a change, https://github.com/elastic/elasticsearch/pull/50960, that changed the DocumentMapper that day and this change was in the first failure I saw that manifested that way. @romseygeek do you think that change could be the cause of the tripped assertion?","closed_by":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}