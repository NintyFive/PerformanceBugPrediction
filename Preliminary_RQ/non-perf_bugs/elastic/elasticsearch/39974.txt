{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/39974","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39974/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39974/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39974/events","html_url":"https://github.com/elastic/elasticsearch/issues/39974","id":420150753,"node_id":"MDU6SXNzdWU0MjAxNTA3NTM=","number":39974,"title":"[ML] Data frame transform silently fails if using min(timestamp)","user":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1222918656,"node_id":"MDU6TGFiZWwxMjIyOTE4NjU2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.0","name":"v7.2.0","color":"DDDDDD","default":false,"description":""},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"assignees":[{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2019-03-12T18:49:46Z","updated_at":"2019-03-22T20:19:03Z","closed_at":"2019-03-22T20:19:03Z","author_association":"NONE","active_lock_reason":null,"body":"Found in master `  \"version\" : {\r\n    \"number\" : \"8.0.0-SNAPSHOT\",\r\n    \"build_flavor\" : \"default\",\r\n    \"build_type\" : \"tar\",\r\n    \"build_hash\" : \"4957cad\",\r\n    \"build_date\" : \"2019-03-11T15:48:39.514013Z\",\r\n    \"build_snapshot\" : true,`\r\n\r\nWhen creating a data frame using min and max against a date field, the data frame is not populated, however the response from `_stats` implies it has worked. From a user perspective, the data frame silently fails to populate (although does log an error on the server).\r\n\r\n```\r\n#DELETE _data_frame/transforms/farequote-a\r\n#DELETE df-farequote-a\r\nPUT _data_frame/transforms/farequote-a\r\n{\r\n  \"source\": \"farequote-*\",\r\n  \"dest\": \"df-farequote-a\",\r\n  \"pivot\": {\r\n\t  \"group_by\": { \r\n\t    \"airline\": { \"terms\": { \"field\": \"airline\" }}\r\n\t  },\r\n    \"aggregations\": {\r\n\t    \"max_responsetime\": { \"max\": { \"field\": \"responsetime\" }},\r\n\t    \"mean_responsetime\": { \"avg\": { \"field\": \"responsetime\" }},\r\n\t    \"min_time\": { \"min\": { \"field\": \"@timestamp\"}},\r\n\t    \"max_time\": { \"max\": { \"field\": \"@timestamp\"}}\r\n    }\r\n  }\r\n}\r\n\r\nPOST _data_frame/transforms/farequote-a/_start\r\nGET _data_frame/transforms/farequote-a/_stats\r\nPOST _data_frame/transforms/farequote-a/_stop\r\nGET df-farequote-a/_search\r\n```\r\n\r\n`_stats` returns the following, which is the same as a successful data frame, i.e. one without `min_time` and `max_time`:\r\n```\r\n{\r\n  \"count\" : 1,\r\n  \"transforms\" : [\r\n    {\r\n      \"id\" : \"farequote-a\",\r\n      \"state\" : {\r\n        \"transform_state\" : \"stopped\",\r\n        \"current_position\" : {\r\n          \"airline\" : \"VRD\"\r\n        },\r\n        \"generation\" : 1\r\n      },\r\n      \"stats\" : {\r\n        \"pages_processed\" : 2,\r\n        \"documents_processed\" : 86274,\r\n        \"documents_indexed\" : 19,\r\n        \"trigger_count\" : 1,\r\n        \"index_time_in_ms\" : 281,\r\n        \"index_total\" : 1,\r\n        \"index_failures\" : 0,\r\n        \"search_time_in_ms\" : 6,\r\n        \"search_total\" : 2,\r\n        \"search_failures\" : 0\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nError in log:\r\n```\r\n[2019-03-12T18:39:33,771][WARN ][o.e.x.c.i.AsyncTwoPhaseIndexer] [node1] Error while attempting to bulk index documents: failure in bulk execution:\r\n```\r\n ","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}