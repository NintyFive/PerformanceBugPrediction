{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/47423","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47423/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47423/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47423/events","html_url":"https://github.com/elastic/elasticsearch/issues/47423","id":501349863,"node_id":"MDU6SXNzdWU1MDEzNDk4NjM=","number":47423,"title":"Date values are not correctly parsed in queries","user":{"login":"weberhofer","id":793251,"node_id":"MDQ6VXNlcjc5MzI1MQ==","avatar_url":"https://avatars0.githubusercontent.com/u/793251?v=4","gravatar_id":"","url":"https://api.github.com/users/weberhofer","html_url":"https://github.com/weberhofer","followers_url":"https://api.github.com/users/weberhofer/followers","following_url":"https://api.github.com/users/weberhofer/following{/other_user}","gists_url":"https://api.github.com/users/weberhofer/gists{/gist_id}","starred_url":"https://api.github.com/users/weberhofer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weberhofer/subscriptions","organizations_url":"https://api.github.com/users/weberhofer/orgs","repos_url":"https://api.github.com/users/weberhofer/repos","events_url":"https://api.github.com/users/weberhofer/events{/privacy}","received_events_url":"https://api.github.com/users/weberhofer/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"assignees":[{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2019-10-02T08:30:33Z","updated_at":"2019-10-03T08:59:52Z","closed_at":"2019-10-03T08:59:52Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**\r\nVersion: 7.4.0, Build: default/rpm/22e1767283e61a198cb4db791ea66e3f11ab9910/2019-09-27T08:36:48.569419Z, JVM: 1.8.0_222\r\n\r\n**Java version**\r\nopenjdk version \"1.8.0_222\"\r\nOpenJDK Runtime Environment (IcedTea 3.13.0) (build 1.8.0_222-b10 suse-lp151.2.3.1-x86_64)\r\nOpenJDK 64-Bit Server VM (build 25.222-b10, mixed mode)\r\n\r\n**OS version**\r\nLinux herkules 4.12.14-lp151.28.13-default\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI have defined the following field:\r\n```json\r\n\"alertDate\": {\r\n  \"type\": \"date\",\r\n  \"format\": \"epoch_second||basic_date_time_no_millis||yyyy-MM-dd HH:mm:ss||strict_date||strict_date_hour_minute_second\",\r\n  \"store\": false\r\n}\r\n```\r\nI can search in this field by epoch-values but by none of the other date formats like:\r\n```json\r\n{\r\n  \"from\":0,\r\n  \"size\":10,\r\n  \"query\":\r\n    {\"bool\":\r\n      {\"must\": [\r\n        { \"range\": {\"alertDate\": {\"from\":\"2019-09-01\"}}}\r\n      ]}\r\n    }\r\n}\r\n```\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n[2019-10-02T10:14:51,370][DEBUG][o.e.a.s.TransportSearchAction] [node-1] All shards failed for phase: [query]\r\norg.elasticsearch.ElasticsearchParseException: failed to parse date field [2019-01-01] with format [epoch_second||basic_date_time_no_millis||yyyy-MM-dd HH:mm:ss||strict_date||strict_date_hour_minute_second]: [Text '2019-01-01' could not be parsed, unparsed text found at index 4]\r\n        at org.elasticsearch.common.time.JavaDateMathParser.parseDateTime(JavaDateMathParser.java:235) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.common.time.JavaDateMathParser.parse(JavaDateMathParser.java:76) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.mapper.DateFieldMapper$DateFieldType.parseToLong(DateFieldMapper.java:401) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.mapper.DateFieldMapper$DateFieldType.isFieldWithinQuery(DateFieldMapper.java:415) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.RangeQueryBuilder.getRelation(RangeQueryBuilder.java:447) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.RangeQueryBuilder.doRewrite(RangeQueryBuilder.java:464) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.rewrite(AbstractQueryBuilder.java:265) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.rewriteClauses(BoolQueryBuilder.java:458) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.doRewrite(BoolQueryBuilder.java:423) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.rewrite(AbstractQueryBuilder.java:265) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.builder.SearchSourceBuilder.rewrite(SearchSourceBuilder.java:962) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.builder.SearchSourceBuilder.rewrite(SearchSourceBuilder.java:82) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.Rewriteable.rewrite(Rewriteable.java:68) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.Rewriteable.rewrite(Rewriteable.java:51) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.internal.ShardSearchLocalRequest$RequestRewritable.rewrite(ShardSearchLocalRequest.java:271) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.internal.ShardSearchLocalRequest$RequestRewritable.rewrite(ShardSearchLocalRequest.java:261) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.index.query.Rewriteable.rewrite(Rewriteable.java:68) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.SearchService.createSearchContext(SearchService.java:638) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.SearchService.createSearchContext(SearchService.java:617) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:580) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:545) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:348) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.SearchService.lambda$executeQueryPhase$1(SearchService.java:340) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.action.ActionListener.lambda$map$2(ActionListener.java:145) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62) [elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.search.SearchService.lambda$rewriteShardRequest$7(SearchService.java:1043) [elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.action.ActionRunnable$1.doRun(ActionRunnable.java:45) [elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44) [elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773) [elasticsearch-7.4.0.jar:7.4.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.4.0.jar:7.4.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n        at java.lang.Thread.run(Thread.java:830) [?:?]\r\nCaused by: java.time.format.DateTimeParseException: Text '2019-01-01' could not be parsed, unparsed text found at index 4\r\n        at java.time.format.DateTimeFormatter.parseResolved0(DateTimeFormatter.java:2052) ~[?:?]\r\n        at java.time.format.DateTimeFormatter.parse(DateTimeFormatter.java:1877) ~[?:?]\r\n        at org.elasticsearch.common.time.JavaDateMathParser.parseDateTime(JavaDateMathParser.java:223) ~[elasticsearch-7.4.0.jar:7.4.0]\r\n        ... 33 more\r\n\r\n","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}