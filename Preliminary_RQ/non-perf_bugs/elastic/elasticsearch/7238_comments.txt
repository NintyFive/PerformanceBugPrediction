[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/51932108","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-51932108","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":51932108,"node_id":"MDEyOklzc3VlQ29tbWVudDUxOTMyMTA4","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-08-12T15:39:02Z","updated_at":"2014-08-12T15:39:02Z","author_association":"CONTRIBUTOR","body":"This looks like either index corruption or a Lucene issue.  What ES version are you using?  Are you able to reproduce this issue from a clean slate / minimal configuration?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52170538","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-52170538","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":52170538,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMTcwNTM4","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2014-08-14T11:05:48Z","updated_at":"2014-08-14T11:05:48Z","author_association":"NONE","body":"We are using ES version 1.3.1 (upgraded from 1.2.1 running before). I have investigated it further and indeed it seems two of our indices were corrupted somehow. I have the corrupted data still so I could analyze it further to see what caused this. The disks containing the indices were not too large (about 8x larger than the data itself and filled for about 60 - 80%) I am hypothesizing that too little disk space when synchronizing shards across the machine could have been the cause, but I am not sure if that's a realistic assessment. If you have other suggestions that I could look into, those would be welcome. I want to rule out that this is an ES (or Lucene) issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/52180669","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-52180669","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":52180669,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMTgwNjY5","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-08-14T13:10:22Z","updated_at":"2014-08-14T13:10:22Z","author_association":"CONTRIBUTOR","body":"A disk full should not cause index corruption...\n\nAre you able to reproduce the creation of the corrupted index?  Did you run CheckIndex on it (can you post the output if so)?\n\nAlso, I'd recommend upgrading to 1.3.2: there was a rare bug in the compression library that ES uses when moving shards around, that can introduce corruption.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54072443","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54072443","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54072443,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MDcyNDQz","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2014-09-01T15:33:29Z","updated_at":"2014-09-01T15:33:29Z","author_association":"NONE","body":"Mike, we:\n1) Upgraded our machines to 1.3.2\n2) Put our indices on separate large volumes\n\nStill we are getting regular index corruption, particularly on indices which have a lot of write operations, see the examples below.\n\nDo you have a suggestions as to what the best approach is to debugging this? We'd be happy to do this, but are having some trouble figuring out the best place to start.\n\n# Some examples:\n\n[2014-09-01 15:09:44,799][WARN ][cluster.action.shard     ] [Jennifer Lawrence] [fuelup-accounts-revisions][2] received shard failed for [fuelup-accounts-revisions][2], node[eFW-40fxQiye18qoDPiJ_Q], [P], s[INITIALIZING], indexUUID [pEYC0ucUSIGun5KgVOoC0A], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[fuelup-accounts-revisions][2] failed to fetch index version after copying it over]; nested: CorruptIndexException[[fuelup-accounts-revisions][2] Corrupted index [corrupted_U1FKXejPRfGBoSRivrDxHQ] caused by: CorruptIndexException[codec footer mismatch: actual footer=1952805376 vs expected footer=-1071082520 (resource: NIOFSIndexInput(path=\"/esdata/fuelup-testing/nodes/0/indices/fuelup-accounts-revisions/2/index/_a_XBloomFilter_0.smy\"))]]; ]]\n\n[2014-09-01 15:04:19,366][WARN ][indices.cluster          ] [Jennifer Lawrence] [fuelup-manifests][4] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [fuelup-manifests][4] failed to fetch index version after copying it over\n    at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:152)\n    at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:132)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.lucene.index.CorruptIndexException: [fuelup-manifests][4] Corrupted index [corrupted_jh_x1y9MS1SWKZefSFlVfQ] caused by: CorruptIndexException[codec footer mismatch: actual footer=1852273495 vs expected footer=-1071082520 (resource: NIOFSIndexInput(path=\"/esdata/fuelup-testing/nodes/0/indices/fuelup-manifests/4/index/_mi_XBloomFilter_0.smy\"))]\n    at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:343)\n    at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:328)\n    at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:119)\n\n#     ... 4 more\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54080808","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54080808","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54080808,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MDgwODA4","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-09-01T17:31:24Z","updated_at":"2014-09-01T17:31:24Z","author_association":"CONTRIBUTOR","body":"> Do you have a suggestions as to what the best approach is to debugging this? \n\nIt's important to get to the bottom of this, in case you're hitting a new bug here ...\n\nDoes this corruption reproduce on a brand new index created with 1.3.2?  I can't tell from your responses so far whether you are carrying forward an index from before...\n\nCan you attach the server logs from all nodes that led up to the above exception?  It looks like a shard was migrated to another node, but then when that node tried to start the shard, it detected corruption.  We need to isolate where that corruption happened, either during indexing or during replication.\n\nCan you zip up the data directory from the node that this shard was replicated from and post somewhere, if you allowed to share?  I can have a look and see if the corruption is present there.\n\nAre you running any plugins, any external processes, etc.?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54081972","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54081972","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54081972,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MDgxOTcy","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-09-01T17:51:01Z","updated_at":"2014-09-01T17:51:01Z","author_association":"CONTRIBUTOR","body":"Also, which CPU, OS, JVM version are you using?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54082978","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54082978","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54082978,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MDgyOTc4","user":{"login":"almer-t","id":5081329,"node_id":"MDQ6VXNlcjUwODEzMjk=","avatar_url":"https://avatars0.githubusercontent.com/u/5081329?v=4","gravatar_id":"","url":"https://api.github.com/users/almer-t","html_url":"https://github.com/almer-t","followers_url":"https://api.github.com/users/almer-t/followers","following_url":"https://api.github.com/users/almer-t/following{/other_user}","gists_url":"https://api.github.com/users/almer-t/gists{/gist_id}","starred_url":"https://api.github.com/users/almer-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/almer-t/subscriptions","organizations_url":"https://api.github.com/users/almer-t/orgs","repos_url":"https://api.github.com/users/almer-t/repos","events_url":"https://api.github.com/users/almer-t/events{/privacy}","received_events_url":"https://api.github.com/users/almer-t/received_events","type":"User","site_admin":false},"created_at":"2014-09-01T18:09:49Z","updated_at":"2014-09-01T18:09:49Z","author_association":"NONE","body":"Mike, thanks for your response, as for your questions:\nA) It's on a brand new index (actually multiple indices) on 1.3.2, the index has custom mappings.\nB) We're running on AWS (Ubuntu 14.04LTS). A shared Intel Xeon CPU E5-2650.\nC) Java reports (Oracle Java 7):\njava version \"1.7.0_65\"\nJava(TM) SE Runtime Environment (build 1.7.0_65-b17)\nJava HotSpot(TM) 64-Bit Server VM (build 24.65-b04, mixed mode)\nD) Plugins are \"cloud-aws\" (2.3.0) and \"head\"\n\nAs for your other questions: I will look into what logs and index data I can share with you tomorrow. We will likely set-up a separate environment for replicating the problem. Naturally I'll share with you any \"recipe\" I can make for reproducing the problem.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54091605","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54091605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54091605,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MDkxNjA1","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-09-01T21:04:12Z","updated_at":"2014-09-01T21:04:12Z","author_association":"CONTRIBUTOR","body":"Thanks @almer-t that's great you can reproduce from a clean start; hopefully this means we can iterate until we find the root cause.  If you can narrow it down to a dedicated environment / particular set of documents / recipe that would be very helpful.\n\nAs far as I know that JVM version is safe.\n\nHave you changed any settings from defaults (e.g. via settings API or in config/elasticsearch.yml)?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54140744","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54140744","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54140744,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTQwNzQ0","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2014-09-02T11:53:15Z","updated_at":"2014-09-02T11:53:15Z","author_association":"NONE","body":"mike: I've haven't changed the defaults (apart from the number of master nodes, from 1->2, but the problem existed before this, so it's probably not the root cause).\n\n## Here's some log information that shows the first signs of trouble:\n\n[2014-09-02 09:07:51,137][WARN ][index.engine.internal    ] [Natalie Portman] [fuelup-manifests][3] failed engine [corrupt \nfile detected source: [recovery phase 1]]\n[2014-09-02 09:07:51,154][WARN ][cluster.action.shard     ] [Natalie Portman] [fuelup-manifests][3] sending failed shard fo\nr [fuelup-manifests][3], node[3R-3HR1jQzOWsct8tIlO8w], [P], s[STARTED], indexUUID [xlRTKIXsSq6HO_BHWIA4Fg], reason [engine \nfailure, message [corrupt file detected source: [recovery phase 1]][RecoverFilesRecoveryException[[fuelup-manifests][3] Fai\nled to transfer [0] files with total size of [0b]]; nested: CorruptIndexException[[fuelup-manifests][3] Corrupted index [corrupted_dXHcg1AkQtGuplAHa87jqw] caused by: CorruptIndexException[codec footer mismatch: actual footer=1852273495 vs expected footer=-1071082520 (resource: NIOFSIndexInput(path=\"/esdata/fuelup-testing/nodes/0/indices/fuelup-manifests/3/index/_b_XBloomFilter_0.smy\"))]]; ]]\n...\n[2014-09-02 09:07:51,201][WARN ][indices.cluster          ] [Natalie Portman] [fuelup-manifests][3] master [[Natalie Portman][3R-3HR1jQzOWsct8tIlO8w][ip-10-0-1-20][inet[/10.0.1.20:9300]]] marked shard as started, but shard has not been created, mark shard as failed\n...\n[2014-09-02 09:07:51,352][WARN ][indices.cluster          ] [Natalie Portman] [fuelup-manifests][3] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [fuelup-manifests][3] failed to fetch index version after copying it over\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:152)\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:132)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.apache.lucene.index.CorruptIndexException: [fuelup-manifests][3] Corrupted index [corrupted_dXHcg1AkQtGuplAHa87jqw] caused by: CorruptIndexException[codec footer mismatch: actual footer=1852273495 vs expected footer=-1071082520 (resource: NIOFSIndexInput(path=\"/esdata/fuelup-testing/nodes/0/indices/fuelup-manifests/3/index/_b_XBloomFilter_0.smy\"))]\n        at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:343)\n        at org.elasticsearch.index.store.Store.failIfCorrupted(Store.java:328)\n        at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:119)\n\n##         ... 4 more\n\nAll except the first message then repeats (particularly the 2nd and the last)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54148487","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54148487","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54148487,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTQ4NDg3","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2014-09-02T13:10:43Z","updated_at":"2014-09-02T13:10:43Z","author_association":"NONE","body":"We are currently using three machines. I split this into a 1/2 situation (by renaming the cluster and moving around some files). So I ended up with a cluster A with 1 machine and a cluster B with 2 machines. I have tried our read/write operations on both A and B and can not trivially reproduce the errors above. I have to say though that usually they occur \"after a while\", so we'll have to wait a bit.\n\nI have found that when corruption does occur its detection can be triggered by:\n1) creating a backup snapshot.\n2) restarting a machine in the cluster.\n3) changing the replication settings of a corrupted index.\n\nExaming log files when corruption did occur (from yesterday when it was still a 3-machine cluster), it seems that this message repeats often, with the exact _same_ values:\n\"CorruptIndexException[codec footer mismatch: actual footer=1852273495 vs expected footer=-1071082520\"\n\nAlso this is a bit awkward:\n\"[RecoverFilesRecoveryException[[fuelup-manifests][3] Failed to transfer [0] files with total size of [0b]]\"\n\nA wild guess: can it be that the volume where the elasticsearch data is stored is (for a brief instant) disconnected and then reconnected, which may cause this to occur?\n\nMike: I am also sending you the complete log files (privately).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54155973","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54155973","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54155973,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTU1OTcz","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-09-02T14:05:17Z","updated_at":"2014-09-02T14:05:17Z","author_association":"CONTRIBUTOR","body":"Thanks @almer-fuel \n\nCan you enable CheckIndex on startup, by adding \"index.shard.check_on_startup: true\" to your config/elasticsearch.yml?  Then restart a node and it should run CheckIndex on all its shards; it runs for a while and then suddenly prints out lots of output (from Lucene's CheckIndex tool)... I'm hoping we can isolate when the corruption happens.\n\nAre you able to get the corruption to happen if you use 1 shard 0 replicas?  Just trying to simplify the recipe as much as possible.\n\nI would definitely not expect this kind of corruption if a volume disconnects/reconnects; only if the volume is buggy (flips/loses/adds bits) should you see this kind of corruption.\n\nDoes the corruption always happen in a *.smy file?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54158342","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54158342","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54158342,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTU4MzQy","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2014-09-02T14:21:17Z","updated_at":"2014-09-02T14:21:17Z","author_association":"CONTRIBUTOR","body":"This is the .smy file from pulsing codec. it doesnt have a checksum... its basically incompatible with elasticsearch (and was just an experiment). Pulsing codec is actually removed from lucene since this optimization has been in the default codec for years. I recommend turning it off.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54161500","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54161500","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54161500,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTYxNTAw","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2014-09-02T14:41:34Z","updated_at":"2014-09-02T14:41:34Z","author_association":"NONE","body":"Mike: checkindex set, restarting any of the machines does not yield a corrupted index (yet) as of now.\n\nMike & muir:\nHmmm, yes the corruption always happens in an smy file. All the corrupted indexes have at least a mapping where \"postings_format\" : \"bloom_pulsing\" is used. I hypothesized this could have been the problem in a mail to Mike.\n\nrmuir:\nWould you recommend in general leaving postings_format alone? (I can't seem to find it anymore in the current elasticsearch documentation). Also: if this can cause index corruption it should be disabled.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54164434","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54164434","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54164434,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTY0NDM0","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-09-02T14:59:14Z","updated_at":"2014-09-02T14:59:14Z","author_association":"CONTRIBUTOR","body":"Hi @almer-fuel hmm I can't find your private email to me ...\n\nThe pulsing postings format is being removed from Lucene; what it does (folding terms with just one doc into the terms dict) is already being done by the default postings format.  I would recommend just using the default ...\n\nBut, I don't think this can explain the original AIOOBE you hit; are you able to reproduce that exception?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54166299","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54166299","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54166299,"node_id":"MDEyOklzc3VlQ29tbWVudDU0MTY2Mjk5","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2014-09-02T15:11:11Z","updated_at":"2014-09-02T15:11:11Z","author_association":"NONE","body":"Check your spam :) (if you can't find it, i'll resend).\n\nNo, it can't explain the AIOOBE, but we have not yet seen that problem recur (perhaps we should split this bug into two, one concerning the AIOOBE still unexplained, the other about the postings_format, I am changing our index definitions, so I should be able to confirm within several days that the problem does not re-occur).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54432987","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54432987","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54432987,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NDMyOTg3","user":{"login":"budnik","id":1160699,"node_id":"MDQ6VXNlcjExNjA2OTk=","avatar_url":"https://avatars0.githubusercontent.com/u/1160699?v=4","gravatar_id":"","url":"https://api.github.com/users/budnik","html_url":"https://github.com/budnik","followers_url":"https://api.github.com/users/budnik/followers","following_url":"https://api.github.com/users/budnik/following{/other_user}","gists_url":"https://api.github.com/users/budnik/gists{/gist_id}","starred_url":"https://api.github.com/users/budnik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/budnik/subscriptions","organizations_url":"https://api.github.com/users/budnik/orgs","repos_url":"https://api.github.com/users/budnik/repos","events_url":"https://api.github.com/users/budnik/events{/privacy}","received_events_url":"https://api.github.com/users/budnik/received_events","type":"User","site_admin":false},"created_at":"2014-09-04T08:43:41Z","updated_at":"2014-09-04T08:43:41Z","author_association":"NONE","body":"We ecountered same issue multiple times. We were using 'postings_format\" : \"bloom_pulsing\" for one of the fields. I hope switching back to default would help and thanks for helping me figuring it out. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54496263","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54496263","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54496263,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NDk2MjYz","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2014-09-04T15:37:17Z","updated_at":"2014-09-04T15:37:17Z","author_association":"CONTRIBUTOR","body":"Thanks @almer-fuel I found the email ...\n\nLet's leave this issue open to dig into the AIOOBE?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/54515281","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-54515281","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":54515281,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NTE1Mjgx","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"created_at":"2014-09-04T17:38:10Z","updated_at":"2014-09-04T17:38:23Z","author_association":"NONE","body":"@budnik @mikemccand Removing the bloom_pulsing helped restore our cluster to a stable state. So, it's confirmed to have been the cause of our (non-AIOOBE) problems.\n\n@mikemccand Yes, we will keep an eye on whether the AIOOBE occurs again (and/or if we can reproduce it in a separate testing environment). If so, we will post our updates here. It could also be that the issues are somehow linked (the AIOOBE being a side effect of the bloom-pulsing issues), but I can't say that for sure. I'll keep an eye on it.\n\nThanks for the help! :pray: \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57414697","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-57414697","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":57414697,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NDE0Njk3","user":{"login":"deverton","id":287143,"node_id":"MDQ6VXNlcjI4NzE0Mw==","avatar_url":"https://avatars1.githubusercontent.com/u/287143?v=4","gravatar_id":"","url":"https://api.github.com/users/deverton","html_url":"https://github.com/deverton","followers_url":"https://api.github.com/users/deverton/followers","following_url":"https://api.github.com/users/deverton/following{/other_user}","gists_url":"https://api.github.com/users/deverton/gists{/gist_id}","starred_url":"https://api.github.com/users/deverton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deverton/subscriptions","organizations_url":"https://api.github.com/users/deverton/orgs","repos_url":"https://api.github.com/users/deverton/repos","events_url":"https://api.github.com/users/deverton/events{/privacy}","received_events_url":"https://api.github.com/users/deverton/received_events","type":"User","site_admin":false},"created_at":"2014-10-01T03:30:09Z","updated_at":"2014-10-01T03:31:04Z","author_association":"CONTRIBUTOR","body":"We just rolled out a new cluster on 1.3.2 and got this after a restart.\n\n```\n[2014-10-01 11:24:19,381][WARN ][cluster.action.shard     ] [node1.example.com] [index-20130125][1] sending failed shard for [index-20130125][1], node[2LBNSJCMQByFpj0LgKZjJw], relocating [JT1xYUsPQkyEgLzDmBAvhA], [P], s[INITIALIZING], indexUUID [uNfol8JNQ_GZCMEzT07uvQ], reason [engine failure, message [corrupted preexisting index][CorruptIndexException[[reviews-20130125][1] Corrupted index [corrupted_yHFUTG8eQMWqLbRwRHtPaA] caused by: CorruptIndexException[codec footer mismatch: actual footer=1230204780 vs expected footer=-1071082520 (resource: MMapIndexInput(path=\"/opt/elasticsearch/data/elasticsearch_1_3/nodes/0/indices/index-20130125/1/index/_am.fdt\"))]]]]\n```\n\nThis was on a two node cluster and the index was created from scratch. There are no other indices in this cluster either. The index mapping is fairly simple and doesn't involve any changes to codecs or anything so I don't think this is bloom related.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57428762","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-57428762","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":57428762,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NDI4NzYy","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-01T07:34:13Z","updated_at":"2014-10-01T07:34:13Z","author_association":"CONTRIBUTOR","body":"hmm the index name says `reviews-20130125` so it seems like it's a pretty old index? You said it was newly created so I am a bit confused. Can you check if there is a file called `corrupted_yHFUTG8eQMWqLbRwRHtPaA` inside the index/shard directory and gist it's content?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57437834","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-57437834","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":57437834,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NDM3ODM0","user":{"login":"deverton","id":287143,"node_id":"MDQ6VXNlcjI4NzE0Mw==","avatar_url":"https://avatars1.githubusercontent.com/u/287143?v=4","gravatar_id":"","url":"https://api.github.com/users/deverton","html_url":"https://github.com/deverton","followers_url":"https://api.github.com/users/deverton/followers","following_url":"https://api.github.com/users/deverton/following{/other_user}","gists_url":"https://api.github.com/users/deverton/gists{/gist_id}","starred_url":"https://api.github.com/users/deverton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deverton/subscriptions","organizations_url":"https://api.github.com/users/deverton/orgs","repos_url":"https://api.github.com/users/deverton/repos","events_url":"https://api.github.com/users/deverton/events{/privacy}","received_events_url":"https://api.github.com/users/deverton/received_events","type":"User","site_admin":false},"created_at":"2014-10-01T09:12:32Z","updated_at":"2014-10-01T09:12:32Z","author_association":"CONTRIBUTOR","body":"Hah, sorry, my attempt at masking data didn't quite work out. While the index name indicates it's old, it's actually just the version of the mapping. It was replicated from a CouchDB instance as part of the deployment of 1.3.2.\n\nI'll see if we still have `corrupted_yHFUTG8eQMWqLbRwRHtPaA` in the data directory. It might have been destroyed as we recreated the ES 1.3.2 instances just to be sure.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/57458223","html_url":"https://github.com/elastic/elasticsearch/issues/7238#issuecomment-57458223","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7238","id":57458223,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NDU4MjIz","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-01T12:52:39Z","updated_at":"2014-10-01T12:52:39Z","author_association":"CONTRIBUTOR","body":"I am closing this issue for now...\n","performed_via_github_app":null}]