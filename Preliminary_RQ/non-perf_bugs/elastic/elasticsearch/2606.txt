{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2606","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2606/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2606/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2606/events","html_url":"https://github.com/elastic/elasticsearch/issues/2606","id":10501240,"node_id":"MDU6SXNzdWUxMDUwMTI0MA==","number":2606,"title":"Remove scope support in query and facet dsl.","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"labels":[{"id":33660,"node_id":"MDU6TGFiZWwzMzY2MA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebreaking","name":">breaking","color":"d93f0b","default":false,"description":null},{"id":17100279,"node_id":"MDU6TGFiZWwxNzEwMDI3OQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.0.Beta1","name":"v0.90.0.Beta1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2013-01-31T14:08:01Z","updated_at":"2013-12-26T14:42:47Z","closed_at":"2013-01-31T14:10:04Z","author_association":"MEMBER","active_lock_reason":null,"body":"Remove support for the `scope` field in facets and `_scope` field in the nested and parent/child queries. The scope support for nested queries will be replaced by the `nested` facet option and a facet filter with a nested filter. The nested filters will now support the a `join` option. Which controls whether to perform the block join. By default this enabled, but when disabled it returns the nested documents as hits instead of the joined root document.\n\nSearch request with the current scope support.\n\n```\ncurl -s -XPOST 'localhost:9200/products/_search' -d '{\n    \"query\" : {\n        \"nested\" : {\n            \"path\" : \"offers\",\n            \"query\" : {\n                \"match\" : {\n                    \"offers.color\" : \"blue\"     \n                }\n            },\n            \"_scope\" : \"my_scope\"\n        }\n    },\n    \"facets\" : {\n        \"size\" : {\n            \"terms\" : {\n                \"field\" : \"offers.size\"\n            },\n            \"scope\" : \"my_scope\"\n        }\n    }\n}'\n```\n\nThe following will be functional equivalent of using the scope support: \n\n```\ncurl -s -XPOST 'localhost:9200/products/_search?search_type=count' -d '{\n    \"query\" : {\n        \"nested\" : {\n            \"path\" : \"offers\",\n            \"query\" : {\n                \"match\" : {\n                    \"offers.color\" : \"blue\"     \n                }\n            }\n        }\n    },\n    \"facets\" : {\n        \"size\" : {\n            \"terms\" : {\n                \"field\" : \"offers.size\"\n            },\n            \"facet_filter\" : {\n                \"nested\" : {\n                    \"path\" : \"offers\",\n                    \"query\" : {\n                        \"match\" : {\n                            \"offers.color\" : \"blue\"     \n                        }\n                    },\n                    \"join\" : false\n                }   \n            },\n            \"nested\" : \"offers\"\n        }\n    }\n}'\n```\n\nThe scope support for parent/child queries will be replaced by running the child query as filter in a global facet.\n\nSearch request with the current scope support:\n\n```\ncurl -s -XPOST 'localhost:9200/products/_search' -d '{\n    \"query\" : {\n        \"has_child\" : {\n            \"type\" : \"offer\",\n            \"query\" : {\n                \"match\" : {\n                    \"color\" : \"blue\"        \n                }\n            },\n            \"_scope\" : \"my_scope\"\n        }\n    },\n    \"facets\" : {\n        \"size\" : {\n            \"terms\" : {\n                \"field\" : \"size\"\n            },\n            \"scope\" : \"my_scope\"\n        }\n    }\n}'\n```\n\nThe following is the functional equivalent of using the scope support with parent/child queries:\n\n```\ncurl -s -XPOST 'localhost:9200/products/_search' -d '{\n    \"query\" : {\n        \"has_child\" : {\n            \"type\" : \"offer\",\n            \"query\" : {\n                \"match\" : {\n                    \"color\" : \"blue\"        \n                }\n            }\n        }\n    },\n    \"facets\" : {\n        \"size\" : {\n            \"terms\" : {\n                \"field\" : \"size\"\n            },\n            \"global\" : true,\n            \"facet_filter\" : {\n                \"term\" : {\n                    \"color\" : \"blue\"    \n                }\n            }\n        }\n    }\n}'\n```\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}