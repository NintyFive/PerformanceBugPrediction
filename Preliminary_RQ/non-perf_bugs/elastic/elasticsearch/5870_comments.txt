[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40800686","html_url":"https://github.com/elastic/elasticsearch/issues/5870#issuecomment-40800686","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5870","id":40800686,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODAwNjg2","user":{"login":"uboness","id":211019,"node_id":"MDQ6VXNlcjIxMTAxOQ==","avatar_url":"https://avatars3.githubusercontent.com/u/211019?v=4","gravatar_id":"","url":"https://api.github.com/users/uboness","html_url":"https://github.com/uboness","followers_url":"https://api.github.com/users/uboness/followers","following_url":"https://api.github.com/users/uboness/following{/other_user}","gists_url":"https://api.github.com/users/uboness/gists{/gist_id}","starred_url":"https://api.github.com/users/uboness/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uboness/subscriptions","organizations_url":"https://api.github.com/users/uboness/orgs","repos_url":"https://api.github.com/users/uboness/repos","events_url":"https://api.github.com/users/uboness/events{/privacy}","received_events_url":"https://api.github.com/users/uboness/received_events","type":"User","site_admin":false},"created_at":"2014-04-18T10:32:04Z","updated_at":"2014-04-18T10:32:04Z","author_association":"CONTRIBUTOR","body":"@Mpdreamz `percentiles` are not a bucketing agg. It's a metrics agg, and like all other metrics aggs, it's not keyed (see `min`/`stats`/etc...)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40801554","html_url":"https://github.com/elastic/elasticsearch/issues/5870#issuecomment-40801554","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5870","id":40801554,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODAxNTU0","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2014-04-18T10:54:45Z","updated_at":"2014-04-18T11:00:24Z","author_association":"MEMBER","body":"I realise its not a bucketing agg :)\n\nThe code path for the percentiles agg always hits the [if (keyed)` code path](https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentiles.java#L119). Making the else routine dead code.\n\nThe else routine introduces an array at a position all the other aggregations introduce an object which would make parsing the aggregations generically much much harder. \n\ni.e `\"name_of_agg\" : [` vs `\"name_of_agg : {`\n\nIf we can remove the dead code and thus the chance to introduce an array at that position that would be great too.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40801939","html_url":"https://github.com/elastic/elasticsearch/issues/5870#issuecomment-40801939","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5870","id":40801939,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODAxOTM5","user":{"login":"uboness","id":211019,"node_id":"MDQ6VXNlcjIxMTAxOQ==","avatar_url":"https://avatars3.githubusercontent.com/u/211019?v=4","gravatar_id":"","url":"https://api.github.com/users/uboness","html_url":"https://github.com/uboness","followers_url":"https://api.github.com/users/uboness/followers","following_url":"https://api.github.com/users/uboness/following{/other_user}","gists_url":"https://api.github.com/users/uboness/gists{/gist_id}","starred_url":"https://api.github.com/users/uboness/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uboness/subscriptions","organizations_url":"https://api.github.com/users/uboness/orgs","repos_url":"https://api.github.com/users/uboness/repos","events_url":"https://api.github.com/users/uboness/events{/privacy}","received_events_url":"https://api.github.com/users/uboness/received_events","type":"User","site_admin":false},"created_at":"2014-04-18T11:06:05Z","updated_at":"2014-04-18T11:06:05Z","author_association":"CONTRIBUTOR","body":"@Mpdreamz Not sure I'm following you tbh... maybe I'm missing something...\n\nif you send `\"keyed\" : false`, the else path is executed, so it's not really a dead code. We decided to make the object form the default (ie. `\"keyed\" : true`) as we believe it's probably the form most ppl would like to get back. Like with other aggs, we did leave an option to get the percentiles as an array of values\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40805965","html_url":"https://github.com/elastic/elasticsearch/issues/5870#issuecomment-40805965","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5870","id":40805965,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODA1OTY1","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2014-04-18T12:44:55Z","updated_at":"2014-04-18T12:46:12Z","author_association":"MEMBER","body":"Ok my bad since keyed usually defaults to false (i.e range aggregation).\n\n`keyed` also usually specifies the behaviour of an inner property (i.e `buckets` property inside a range aggregation) where as with percentiles it controls how the entire aggregation is returned.\n\nMore specifically:\n\n```\n\"aggregations\": {\n      \"myagg\": [\n         {\n            \"key\": 1,\n            \"value\": 60.4\n         },\n         {\n            \"key\": 5,\n            \"value\": 62\n         },\n         {\n            \"key\": 25,\n            \"value\": 70\n         },\n```\n\nFor `keyed:false` responses I would much rather see it return \n\n```\n\"aggregations\": {\n      \"myagg\": {\n         values: [\n         {\n            \"key\": 1,\n            \"value\": 60.4\n         },\n         {\n            \"key\": 5,\n            \"value\": 62\n         },\n         {\n            \"key\": 25,\n            \"value\": 70\n         }\n         ]\n     }\n}\n```\n\nAll other aggregations follow the pattern `\"name_of_agg\": <start_of_object>` even simple metrics such as `min/max`\n\n```\n\"max\" : {\n    value: 10\n}\n```\n\nThe way nonkeyed percentiles are implemented right now feels like this:\n\n```\n\"max\" : 10\n```\n\nAnd (as far as I could tell) non keyed percentiles are the only ones breaking the pattern here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/40812251","html_url":"https://github.com/elastic/elasticsearch/issues/5870#issuecomment-40812251","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5870","id":40812251,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODEyMjUx","user":{"login":"uboness","id":211019,"node_id":"MDQ6VXNlcjIxMTAxOQ==","avatar_url":"https://avatars3.githubusercontent.com/u/211019?v=4","gravatar_id":"","url":"https://api.github.com/users/uboness","html_url":"https://github.com/uboness","followers_url":"https://api.github.com/users/uboness/followers","following_url":"https://api.github.com/users/uboness/following{/other_user}","gists_url":"https://api.github.com/users/uboness/gists{/gist_id}","starred_url":"https://api.github.com/users/uboness/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uboness/subscriptions","organizations_url":"https://api.github.com/users/uboness/orgs","repos_url":"https://api.github.com/users/uboness/repos","events_url":"https://api.github.com/users/uboness/events{/privacy}","received_events_url":"https://api.github.com/users/uboness/received_events","type":"User","site_admin":false},"created_at":"2014-04-18T14:25:23Z","updated_at":"2014-04-18T14:25:23Z","author_association":"CONTRIBUTOR","body":"yeah.. agree, I think `\"values\" : []` is more consistent and also makes more sense (as it's future proof)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42446455","html_url":"https://github.com/elastic/elasticsearch/issues/5870#issuecomment-42446455","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5870","id":42446455,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNDQ2NDU1","user":{"login":"uboness","id":211019,"node_id":"MDQ6VXNlcjIxMTAxOQ==","avatar_url":"https://avatars3.githubusercontent.com/u/211019?v=4","gravatar_id":"","url":"https://api.github.com/users/uboness","html_url":"https://github.com/uboness","followers_url":"https://api.github.com/users/uboness/followers","following_url":"https://api.github.com/users/uboness/following{/other_user}","gists_url":"https://api.github.com/users/uboness/gists{/gist_id}","starred_url":"https://api.github.com/users/uboness/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uboness/subscriptions","organizations_url":"https://api.github.com/users/uboness/orgs","repos_url":"https://api.github.com/users/uboness/repos","events_url":"https://api.github.com/users/uboness/events{/privacy}","received_events_url":"https://api.github.com/users/uboness/received_events","type":"User","site_admin":false},"created_at":"2014-05-07T16:02:16Z","updated_at":"2014-05-07T16:02:16Z","author_association":"CONTRIBUTOR","body":"We decided to change the response structure and instead of nesting all the percentiles directly under the aggregation name, nest it under an intermediate `values` object (or when the `keyed` flag is set `false` under a `values` array).\n\nThis is a breaking change but we feel it's important to make it while percentiles are still considered experimental. The new format is more future proof as it'll allow us to potentially add additional info under the aggregation in a later phase if there'll be a need for it. The new format is also somewhat more consistent with the other metrics aggs.\n","performed_via_github_app":null}]