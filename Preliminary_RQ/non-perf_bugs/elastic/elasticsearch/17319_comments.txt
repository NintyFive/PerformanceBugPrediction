[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/200808549","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-200808549","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":200808549,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMDgwODU0OQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-03-24T12:21:39Z","updated_at":"2016-03-24T12:21:39Z","author_association":"CONTRIBUTOR","body":"If I had to guess that is the total number of documents across all shards. IIRC _cat/indices has done this for a long time, presumably because it is an index metadata level thing. I agree this is confusing though.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/200823722","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-200823722","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":200823722,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMDgyMzcyMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-24T13:08:47Z","updated_at":"2016-03-24T13:12:45Z","author_association":"MEMBER","body":"> If I had to guess that is the total number of documents across all shards.\n\nI don't think that that is what it does, we only sum up the documents over the primary shards; see [RestIndicesAction](https://github.com/elastic/elasticsearch/blob/bb364cc793feb57f46dea33fcf4112277da1055a/core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java#L322).\n\nThis does not replicate for me. On a fresh two-node cluster (to ensure that replicas are allocated):\n\n``` bash\n$ curl -XPOST localhost:9200/i/t/1?pretty=1 -d '{ \"f\":\"v\" }'\n{\n  \"_index\" : \"i\",\n  \"_type\" : \"t\",\n  \"_id\" : \"1\",\n  \"_version\" : 1,\n  \"_shards\" : {\n    \"total\" : 2,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"created\" : true\n}\n$ curl -XGET localhost:9200/_cat/indices?v\nhealth status index pri rep docs.count docs.deleted store.size pri.store.size\ngreen  open   i       5   1          1            0      6.7kb          3.3kb\n$ for i in `seq 1 8192`; do curl -sS -XPOST localhost:9200/i2/t2/$i -d '{ \"f\":\"v\" }' > /dev/null; done\n$ curl -XGET localhost:9200/_cat/indices?v\nhealth status index pri rep docs.count docs.deleted store.size pri.store.size\ngreen  open   i2      5   1       8192            0    394.3kb        190.4kb\ngreen  open   i       5   1          1            0      6.7kb          3.3kb\n```\n\nIf you are able to provide a reproduction script that reproduces the issue on a _fresh_ install of Elasticsearch, could you provide it here?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/200852816","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-200852816","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":200852816,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMDg1MjgxNg==","user":{"login":"hgfischer","id":120860,"node_id":"MDQ6VXNlcjEyMDg2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/120860?v=4","gravatar_id":"","url":"https://api.github.com/users/hgfischer","html_url":"https://github.com/hgfischer","followers_url":"https://api.github.com/users/hgfischer/followers","following_url":"https://api.github.com/users/hgfischer/following{/other_user}","gists_url":"https://api.github.com/users/hgfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/hgfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hgfischer/subscriptions","organizations_url":"https://api.github.com/users/hgfischer/orgs","repos_url":"https://api.github.com/users/hgfischer/repos","events_url":"https://api.github.com/users/hgfischer/events{/privacy}","received_events_url":"https://api.github.com/users/hgfischer/received_events","type":"User","site_admin":false},"created_at":"2016-03-24T14:07:26Z","updated_at":"2016-03-24T14:07:26Z","author_association":"CONTRIBUTOR","body":"It's not the index shard/replication settings for sure, because from all 3 indexes I showed previously, they all have the problem and they have different shard/replication settings, but the docs.count is always twice the total:\n\n```\ngreen  open   index-1doc              2   1          2            0     39.9kb         19.9kb\ngreen  open   index-1doc-1s0r         1   0          2            0     19.8kb         19.8kb\ngreen  open   index-10000doc-7s3r     7   3      20000            0     76.3mb           19mb\n```\n\n**Index** `index-1doc` = 1 document, 2 shards, 1 replica = docs.count = 2\n**Index** `index-1doc-1s0r` = 1 document, 1 shard, 0 replicas = docs.count = 2\n**Index** `index-10000doc-7s3r` = 10000 documents, 7 shards, 3 replicas = docs.count = 20000\n\nThe 10-node cluster I'm testing on it's a fresh one. This is the global settings I changed in each node:\n\n```\ncluster.name: ****************\nnode.name: ****************\nindex.number_of_shards: 2\nindex.number_of_replicas: 1\npath.data: ****************\npath.logs: ****************\nbootstrap.mlockall: true\nnetwork.host: ****************\ndiscovery.zen.ping.multicast.enabled: false\ndiscovery.zen.ping.unicast.hosts: [ **************** 10 IPs **************** ]\ndiscovery.zen.minimum_master_nodes: 3\ngateway.expected_nodes: 10\ngateway.expected_master_nodes: 3\ngateway.expected_data_nodes: 10\ngateway.recover_after_time: 30m\ngateway.recover_after_nodes: 5\ngateway.recover_after_master_nodes: 2\ngateway.recover_after_data_nodes: 5\nnode.max_local_storage_nodes: 1\naction.destructive_requires_name: true\nthreadpool.bulk.queue_size: 1000\nindex.merge.scheduler.max_thread_count: 1\nindex.translog.flush_threshold_size: 1gb\nindex.search.slowlog.threshold.query.warn  : 10s\nindex.search.slowlog.threshold.query.info  : 5s\nindex.search.slowlog.threshold.query.debug : 2s\nindex.search.slowlog.threshold.query.trace : 500ms\nindex.search.slowlog.threshold.fetch.warn  : 1s\nindex.search.slowlog.threshold.fetch.info  : 800ms\nindex.search.slowlog.threshold.fetch.debug : 500ms\nindex.search.slowlog.threshold.fetch.trace : 200ms\n```\n\nI tested in another 2 3-node cluster with similar settings and in another 1-node server, also with similar settings and they all presented the same count.\n\nI inserted the document(s) using bulk request, even with a single document.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/200853293","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-200853293","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":200853293,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMDg1MzI5Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-24T14:09:13Z","updated_at":"2016-03-24T14:09:13Z","author_association":"MEMBER","body":"> I inserted the document(s) using bulk request, even with a single document.\n\nThis is what we need to see, because I suspect that this is where the issue is.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202781323","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-202781323","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":202781323,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjc4MTMyMw==","user":{"login":"hgfischer","id":120860,"node_id":"MDQ6VXNlcjEyMDg2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/120860?v=4","gravatar_id":"","url":"https://api.github.com/users/hgfischer","html_url":"https://github.com/hgfischer","followers_url":"https://api.github.com/users/hgfischer/followers","following_url":"https://api.github.com/users/hgfischer/following{/other_user}","gists_url":"https://api.github.com/users/hgfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/hgfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hgfischer/subscriptions","organizations_url":"https://api.github.com/users/hgfischer/orgs","repos_url":"https://api.github.com/users/hgfischer/repos","events_url":"https://api.github.com/users/hgfischer/events{/privacy}","received_events_url":"https://api.github.com/users/hgfischer/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T08:46:49Z","updated_at":"2016-03-29T08:46:49Z","author_association":"CONTRIBUTOR","body":"@jasontedor Why is this issue closed?!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202782421","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-202782421","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":202782421,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjc4MjQyMQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T08:49:56Z","updated_at":"2016-03-29T08:49:56Z","author_association":"MEMBER","body":"Reopening, I think it was closed by mistake, sorry @hgfischer \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202785232","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-202785232","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":202785232,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjc4NTIzMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T08:58:28Z","updated_at":"2016-03-29T08:58:28Z","author_association":"CONTRIBUTOR","body":"@hgfischer we're still waiting for the info that @jasontedor asked for, as we are unable to replicate this issue with the info provided thus far.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202791685","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-202791685","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":202791685,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjc5MTY4NQ==","user":{"login":"hgfischer","id":120860,"node_id":"MDQ6VXNlcjEyMDg2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/120860?v=4","gravatar_id":"","url":"https://api.github.com/users/hgfischer","html_url":"https://github.com/hgfischer","followers_url":"https://api.github.com/users/hgfischer/followers","following_url":"https://api.github.com/users/hgfischer/following{/other_user}","gists_url":"https://api.github.com/users/hgfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/hgfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hgfischer/subscriptions","organizations_url":"https://api.github.com/users/hgfischer/orgs","repos_url":"https://api.github.com/users/hgfischer/repos","events_url":"https://api.github.com/users/hgfischer/events{/privacy}","received_events_url":"https://api.github.com/users/hgfischer/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T09:09:17Z","updated_at":"2016-03-29T09:09:17Z","author_association":"CONTRIBUTOR","body":"> This is what we need to see, because I suspect that this is where the issue is\n\nSince you suspect where the issue is, do I still need to build something to reproduce this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202838892","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-202838892","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":202838892,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjgzODg5Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T11:25:01Z","updated_at":"2016-03-29T11:25:01Z","author_association":"MEMBER","body":"> Why is this issue closed?!\n\nBecause it does not replicate with the information provided. We are happy to reopen when there is a verified bug.\n\n> Since you suspect where the issue is, do I still need to build something to reproduce this?\n\nYes, and I'm sorry it was not clear, but the issue does not replicate for me so we need to see what you are doing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203050407","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203050407","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203050407,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzA1MDQwNw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T18:57:15Z","updated_at":"2016-03-29T18:57:50Z","author_association":"MEMBER","body":"To be clear, I also attempted to replicate via bulk requests and the issue does not replicate. Again, starting from a fresh two-node cluster.\n\n``` bash\n$ cat > request\n{ \"index\": { \"_index\": \"i\", \"_type\": \"t\" } }\n{ \"f\": \"v\" }\n$ for i in `seq 1 8192`; do echo '{ \"index\": { \"_index\": \"i2\", \"_type\": \"t2\" } }' >> request; echo '{ \"f\": \"v\" }' >> request; done\n$ curl -sS -XPOST locahost:9200/_bulk --data-binary \"@request\" > /dev/null\n$ curl -XGET localhost:9200/_cat/indices?v\nhealth status index pri rep docs.count docs.deleted store.size pri.store.size\ngreen  open   i2      5   1       8192            0    267.4kb        132.2kb\ngreen  open   i       5   1          1            0      6.9kb          3.4kb\n```\n\nNote that I did not pre-assign document IDs because I suspect that whatever is going on involves requests _without_ document IDs being sent to Elasticsearch twice.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203056874","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203056874","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203056874,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzA1Njg3NA==","user":{"login":"hgfischer","id":120860,"node_id":"MDQ6VXNlcjEyMDg2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/120860?v=4","gravatar_id":"","url":"https://api.github.com/users/hgfischer","html_url":"https://github.com/hgfischer","followers_url":"https://api.github.com/users/hgfischer/followers","following_url":"https://api.github.com/users/hgfischer/following{/other_user}","gists_url":"https://api.github.com/users/hgfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/hgfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hgfischer/subscriptions","organizations_url":"https://api.github.com/users/hgfischer/orgs","repos_url":"https://api.github.com/users/hgfischer/repos","events_url":"https://api.github.com/users/hgfischer/events{/privacy}","received_events_url":"https://api.github.com/users/hgfischer/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T19:11:28Z","updated_at":"2016-03-29T19:11:28Z","author_association":"CONTRIBUTOR","body":"I'm preparing a script to replicate the problem. \n\nBTW I'm setting document IDs with UUIDv4.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203058337","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203058337","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203058337,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzA1ODMzNw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T19:14:15Z","updated_at":"2016-03-29T19:14:15Z","author_association":"MEMBER","body":"> I'm preparing a script to replicate the problem.\n\nThank you! It will receive my full attention as soon as it is in hand.\n\n> BTW I'm setting document IDs with UUIDv4.\n\nWell, there goes that theory; we'll get to the bottom of it either way. :smile: \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203108350","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203108350","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203108350,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzEwODM1MA==","user":{"login":"hgfischer","id":120860,"node_id":"MDQ6VXNlcjEyMDg2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/120860?v=4","gravatar_id":"","url":"https://api.github.com/users/hgfischer","html_url":"https://github.com/hgfischer","followers_url":"https://api.github.com/users/hgfischer/followers","following_url":"https://api.github.com/users/hgfischer/following{/other_user}","gists_url":"https://api.github.com/users/hgfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/hgfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hgfischer/subscriptions","organizations_url":"https://api.github.com/users/hgfischer/orgs","repos_url":"https://api.github.com/users/hgfischer/repos","events_url":"https://api.github.com/users/hgfischer/events{/privacy}","received_events_url":"https://api.github.com/users/hgfischer/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T21:14:31Z","updated_at":"2016-03-29T21:14:31Z","author_association":"CONTRIBUTOR","body":"Here it goes: https://github.com/hgfischer/es-17319\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203109224","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203109224","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203109224,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzEwOTIyNA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T21:17:52Z","updated_at":"2016-03-29T21:17:52Z","author_association":"MEMBER","body":"@hgfischer Thank you. I will take a very close look at this later tonight.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203185410","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203185410","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203185410,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzE4NTQxMA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-30T01:40:50Z","updated_at":"2016-03-30T16:46:06Z","author_association":"MEMBER","body":"@hgfischer Thanks for the very thorough and careful reproduction, it should be considered a model for future reproductions. What you're experiencing can be boiled down the following reproduction, starting from a fresh single-node cluster:\n\n``` bash\n$ curl -sS -XPUT localhost:9200/i -d '\n> {\n>   \"mappings\": {\n>     \"t\": {\n>       \"properties\": {\n>         \"f\": {\n>           \"type\": \"nested\"\n>         }\n>       }\n>     }\n>   }\n> }' > /dev/null\n$ curl -sS -XPOST localhost:9200/i/t/1 -d '\n> {\n>   \"f\": { \"v\": 1 }\n> }' > /dev/null\n$ curl -XGET localhost:9200/_cat/indices?v\nhealth status index pri rep docs.count docs.deleted store.size pri.store.size\nyellow open   i       5   1          2            0      3.5kb          3.5kb\n```\n\nWhat you're observing here is due to [your use](https://github.com/hgfischer/es-17319/blob/f8bf9fae2f40fa368819d14a0ecbfa1b8a6752d5/template.json#L86) of the [nested type](https://www.elastic.co/guide/en/elasticsearch/reference/2.2/nested.html). From your mapping:\n\n``` json\n    \"mappings\": {\n      \"customer\": {\n        .\n        .\n        .\n        \"additionalData\": {\n          \"type\": \"nested\"\n```\n\nWhen a document with a field mapped as a nested type is indexed into Elasticsearch, Elasticsearch creates a hidden document for each value of the field that is mapped as a nested type. To be clear about what I mean here, with the same mapping above:\n\n``` bash\n$ curl -sS -XDELETE localhost:9200/i/t/1 > /dev/null\n$ curl -sS -XPOST localhost:9200/i/t/1 -d '\n> {\n>   \"f\": [ { \"v\": 1 }, { \"v\": 2 } ]\n> }' > /dev/null\n$ curl -XGET localhost:9200/_cat/indices\nhealth status index pri rep docs.count docs.deleted store.size pri.store.size\nyellow open   i       5   1          3            0       650b           650b\n```\n\nNote that there are three documents here: the actual document, and the two hidden documents, one for each of the values of the nested field `f`.\n\nThese hidden documents are returned in the counts because Elasticsearch retrieves the store count directly from Lucene (which of course counts these hidden documents as actual documents).\n\nThis is operating as intended.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203300144","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203300144","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203300144,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzMwMDE0NA==","user":{"login":"hgfischer","id":120860,"node_id":"MDQ6VXNlcjEyMDg2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/120860?v=4","gravatar_id":"","url":"https://api.github.com/users/hgfischer","html_url":"https://github.com/hgfischer","followers_url":"https://api.github.com/users/hgfischer/followers","following_url":"https://api.github.com/users/hgfischer/following{/other_user}","gists_url":"https://api.github.com/users/hgfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/hgfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hgfischer/subscriptions","organizations_url":"https://api.github.com/users/hgfischer/orgs","repos_url":"https://api.github.com/users/hgfischer/repos","events_url":"https://api.github.com/users/hgfischer/events{/privacy}","received_events_url":"https://api.github.com/users/hgfischer/received_events","type":"User","site_admin":false},"created_at":"2016-03-30T07:49:06Z","updated_at":"2016-03-30T07:49:06Z","author_association":"CONTRIBUTOR","body":"@jasontedor Thanks for the detailed explanation! Would you please consider adding this info on the `_cat/indices` `docs.count` documentation, please? \n\nWhat about adding a new column to `_cat/indices` with the _root_ `docs.count` and rename `docs.count` to `lucene.docs.count` maybe?\n\nThanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203411427","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203411427","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203411427,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzQxMTQyNw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-03-30T12:37:22Z","updated_at":"2016-03-30T12:37:22Z","author_association":"CONTRIBUTOR","body":"> What about adding a new column to _cat/indices with the root docs.count and rename docs.count to lucene.docs.count maybe?\n\nThat probably isn't going to happen. Those APIs don't need to execute queries to do their thing, instead relying on Lucene APIs that get to read meta. I suspect root count would need a query.\n\n> Would you please consider adding this info on the _cat/indices docs.count documentation, please?\n\nReopening this issue to do just that. Since you've been so good to us I have to offer you first dibs on it - the documentation is in `docs/reference/cat/indices.asciidoc` if you want to edit it. If not, one of us will do it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203463887","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203463887","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203463887,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzQ2Mzg4Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-30T14:40:03Z","updated_at":"2016-03-30T14:40:03Z","author_association":"MEMBER","body":"> Would you please consider adding this info on the `_cat/indices` `docs.count` documentation, please? \n\nSure, unless you want to take @nik9000's invitation to submit a PR yourself, I am happy to take it. Let us know either way?\n\n> What about adding a new column to `_cat/indices` with the _root_ `docs.count` and rename `docs.count` to `lucene.docs.count` maybe?\n\nI'm hesitant to change this, I think that for the cat indices API, this is doing the right thing: counting the number of documents that are in the index. That is, this API is working at the physical index level and should return the physical count.\n\nNote that you can get the number of root documents (non-hidden) via the cat count API:\n\n```\n$ curl -XGET localhost:9200/_cat/count/i?v\nepoch      timestamp count\n1459348721 10:38:41  1\n$ curl -XGET localhost:9200/_cat/indices?v\nhealth status index pri rep docs.count docs.deleted store.size pri.store.size\nyellow open   i       5   1          3            0      3.7kb          3.7kb\n```\n\nThis is on the same data as above, with my example of a document have two values for the field mapped as a nested type. This does exactly as @nik9000 [suggested](https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203411427): it executes a query to get the count.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203510312","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203510312","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203510312,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzUxMDMxMg==","user":{"login":"hgfischer","id":120860,"node_id":"MDQ6VXNlcjEyMDg2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/120860?v=4","gravatar_id":"","url":"https://api.github.com/users/hgfischer","html_url":"https://github.com/hgfischer","followers_url":"https://api.github.com/users/hgfischer/followers","following_url":"https://api.github.com/users/hgfischer/following{/other_user}","gists_url":"https://api.github.com/users/hgfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/hgfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hgfischer/subscriptions","organizations_url":"https://api.github.com/users/hgfischer/orgs","repos_url":"https://api.github.com/users/hgfischer/repos","events_url":"https://api.github.com/users/hgfischer/events{/privacy}","received_events_url":"https://api.github.com/users/hgfischer/received_events","type":"User","site_admin":false},"created_at":"2016-03-30T16:18:22Z","updated_at":"2016-03-30T16:18:22Z","author_association":"CONTRIBUTOR","body":"Yes, I'll do the PR. I would like to see a CONTRIBUTORS file (like http://golang.org/CONTRIBUTORS) in the project too, can I add it? :)\n\nRegarding the changes on _cat/indices, ok then. I guess the documentation is enough.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/203513125","html_url":"https://github.com/elastic/elasticsearch/issues/17319#issuecomment-203513125","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17319","id":203513125,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMzUxMzEyNQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-03-30T16:26:53Z","updated_at":"2016-03-30T16:27:28Z","author_association":"MEMBER","body":"> Yes, I'll do the PR.\n\nAwesome. :heart:\n\n> I would like to see a CONTRIBUTORS file (like http://golang.org/CONTRIBUTORS) in the project too, can I add it? :)\n\nWe have a [contributing guidelines](https://github.com/elastic/elasticsearch/blob/97eaf6c04b49ec295f9b371ebcd58f2761204e80/CONTRIBUTING.md) in the main GitHub repo. I think that we should add a pull request template to draw attention to it though.\n\n> Regarding the changes on _cat/indices, ok then. I guess the documentation is enough.\n\nCool, thanks again!\n","performed_via_github_app":null}]