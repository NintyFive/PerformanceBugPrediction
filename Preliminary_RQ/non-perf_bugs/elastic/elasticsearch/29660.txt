{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29660","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29660/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29660/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29660/events","html_url":"https://github.com/elastic/elasticsearch/issues/29660","id":316872470,"node_id":"MDU6SXNzdWUzMTY4NzI0NzA=","number":29660,"title":"[CI] RecoveryWhileUnderLoadIT.testRecoverWhileUnderLoadAllocateReplicasTest fails","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-04-23T15:48:43Z","updated_at":"2018-04-23T16:43:16Z","closed_at":"2018-04-23T16:43:16Z","author_association":"MEMBER","active_lock_reason":null,"body":"The test `RecoveryWhileUnderLoadIT.testRecoverWhileUnderLoadAllocateReplicasTest` failed on CI: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.2+multijob-unix-compatibility/os=opensuse/410\r\n\r\nWhen cleaning up the indices after the test succeed, the following error occurs:\r\n\r\n```\r\n> Throwable #1: java.lang.AssertionError: expected index shard counter on shard [test][1] on node node_s0 to be 0 but was 1. Current replication tasks on node:\r\n> {\r\n>   \"tasks\" : { }\r\n> }\r\n> \tat __randomizedtesting.SeedInfo.seed([FAAE0D542576702B:BDD92864606318DB]:0)\r\n> \tat org.elasticsearch.test.InternalTestCluster.lambda$assertShardIndexCounter$5(InternalTestCluster.java:1159)\r\n> \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:731)\r\n> \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:705)\r\n> \tat org.elasticsearch.test.InternalTestCluster.assertShardIndexCounter(InternalTestCluster.java:1140)\r\n> \tat org.elasticsearch.test.InternalTestCluster.beforeIndexDeletion(InternalTestCluster.java:1109)\r\n> \tat org.elasticsearch.test.ESIntegTestCase.beforeIndexDeletion(ESIntegTestCase.java:607)\r\n> \tat org.elasticsearch.test.ESIntegTestCase.afterInternal(ESIntegTestCase.java:577)\r\n> \tat org.elasticsearch.test.ESIntegTestCase.cleanUpCluster(ESIntegTestCase.java:2085)\r\n> \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nIt does not reproduce locally with:\r\n```\r\n./gradlew :server:integTest -Dtests.seed=FAAE0D542576702B -Dtests.class=org.elasticsearch.recovery.RecoveryWhileUnderLoadIT -Dtests.method=\"testRecoverWhileUnderLoadAllocateReplicasTest\" -Dtests.security.manager=true -Dtests.locale=de-AT -Dtests.timezone=America/Argentina/Catamarca\r\n```\r\n\r\nThe complete test execution log is \r\n[consoleText.txt](https://github.com/elastic/elasticsearch/files/1939029/consoleText.txt)\r\n","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}