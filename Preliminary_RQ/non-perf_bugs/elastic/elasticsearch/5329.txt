{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5329","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5329/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5329/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5329/events","html_url":"https://github.com/elastic/elasticsearch/issues/5329","id":28693215,"node_id":"MDU6SXNzdWUyODY5MzIxNQ==","number":5329,"title":"CONF_FILE in /etc/sysconfig not used by startup script on RedHat","user":{"login":"lehcim","id":4738271,"node_id":"MDQ6VXNlcjQ3MzgyNzE=","avatar_url":"https://avatars1.githubusercontent.com/u/4738271?v=4","gravatar_id":"","url":"https://api.github.com/users/lehcim","html_url":"https://github.com/lehcim","followers_url":"https://api.github.com/users/lehcim/followers","following_url":"https://api.github.com/users/lehcim/following{/other_user}","gists_url":"https://api.github.com/users/lehcim/gists{/gist_id}","starred_url":"https://api.github.com/users/lehcim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lehcim/subscriptions","organizations_url":"https://api.github.com/users/lehcim/orgs","repos_url":"https://api.github.com/users/lehcim/repos","events_url":"https://api.github.com/users/lehcim/events{/privacy}","received_events_url":"https://api.github.com/users/lehcim/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"assignees":[{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2014-03-04T10:07:40Z","updated_at":"2020-11-11T22:00:57Z","closed_at":"2015-10-07T08:34:15Z","author_association":"NONE","active_lock_reason":null,"body":"I'm facing a issue with node default parameters in the system configuration file (/etc/sysconfig/elasticsearch) on a RedHat Linux installation : the \ndefinition of the node configuration file is ignored by the standard startup script.\n\nEnvironment:\n- Redhat Linux RHEL 6.2\n- Elasticsearch 1.0.1 (elasticsearch-1.0.1-1.noarch.rpm)\n### Problems:\n\n1) custom config file defined in /etc/sysconfig is ignored\n\nThe file /etc/sysconfig/elasticsearch contains default parameters used by the startup script /etc/init.d/elasticsearch to intialize the node. The parameter CONF_FILE, as its name suggests, contains the name of the configuration file. By default, it is defined like this:\n\n```\n    # Elasticsearch configuration file (elasticsearch.yml)\n    CONF_FILE=/etc/elasticsearch/elasticsearch.yml \n```\n\nIf this value is changed to another location, the node will start but the new configuration will be ignored.\n\n2) relative config file in /etc/sysconfig prevents node startup\n\nIn file /etc/sysconfig/elasticsearch, another parameter named CONF_DIR defines the Elasticsearch configuration directory, where other config files like logging.yml will be found:\n\n```\n    # Elasticsearch conf directory\n    CONF_DIR=/etc/elasticsearch\n```\n\nAccording to the CONF_FILE comment, it should be possible to give a relative file name (elasticsearch.yml), but it does not work, the node will not start using standard service command.\n### How to reproduce:\n\n0) prerequisites\n- install elasticsearch-1.0.1-1.noarch.rpm on a RedHat/Centos system\n- create a new configuration file called foobar.yml in /etc/elasticsearch with specific parameters, for example the cluster name:\n  \n  ```\n  cluster.name: foobar\n  ```\n\n1) custom config file\n- edit file /etc/sysconfig/elasticsearch and change the CONF_FILE value to the new configuration file:\n  \n  ```\n  CONF_FILE=/etc/elasticsearch/foobar.yml\n  ```\n- start the server using the service command:\n  \n  ```\n  service elasticsearch start\n  ```\n- check the cluster name using the REST API:\n  \n  ```\n  curl http://localhost:9200/_nodes?pretty=true\n  ```\n- the cluster name is still the default \"elasticsearch\", new configuration file was not used.    \n\n2) relative standard config file\n- edit file /etc/sysconfig/elasticsearch and change the CONF_FILE value to a relative name of an existing file in the CONF_DIR directory:\n  \n  ```\n  CONF_FILE=elasticsearch.yml\n  ```\n- start the server using the service command:\n  \n  ```\n  service elasticsearch start\n  ```\n- the startup fails with exit code 6 (configuration file not found), however the file $CONF_DIR/$CONF_FILE exits !      \n### Workaround:\n\nIn file /etc/sysconfig/elasticsearch, pass the config file in the Java options : \n\n```\n    ES_JAVA_OPTS=\"-Des.config=/etc/elasticsearch/foobar.yml\"\n```\n\nIf the config argument is not absolute (foobar.yml), the file will be searched in the $CONF_DIR directory during Elasticsearch startup (Java code). But it's not very clean, because :\n- you can't use CONF_FILE in JAVA_OPTS, because it's defined later in the sysconfig file\n- you still need an absolute CONF_FILE, because it's existence is directly checked in the init.d script  \n- you'll have to remember that CONF_FILE is not really used by the node...\n### How to solve:\n\n1) in /etc/init.d/elasticsearch, line 88, in the daemon launch command line, define the es.config property using the $CONF_FILE variable :\n\n```\n    daemon --user $ES_USER --pidfile $pidfile $exec -p $pidfile -d \\\n        -Des.default.path.home=$ES_HOME \\\n        -Des.default.path.logs=$LOG_DIR -Des.default.path.data=$DATA_DIR \\\n        -Des.default.path.work=$WORK_DIR -Des.default.path.conf=$CONF_DIR \\\n        -Des.config=$CONF_FILE\n```\n\n(maybe es.default.config would be better than es.config ?)\n\nThis way, the configuration specified in the sysconfig file is really used by the node (solves problem n°1).  \n\n2) in /etc/init.d/elasticsearch, line 68, replace the current configuration file existence test :\n\n```\n    [ -f $CONF_FILE ] || exit 6        # line 68\n```\n\nby this one:\n\n```\n    [ -f $CONF_FILE ] || [ -f $CONF_DIR/$CONF_FILE ] || exit 6\n```\n\nThis test reproduce better the one made in the Java code (first check for an absolute configuration file, then for a relative one in the configuration directory, then in the classpath, else fail). Now, the configuration file can be absolute or relative, it works without surprise (solves problem n°2).\n\nWhat do you think ?\n","closed_by":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"performed_via_github_app":null}