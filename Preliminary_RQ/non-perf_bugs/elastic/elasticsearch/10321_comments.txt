[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89766771","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-89766771","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":89766771,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NzY2Nzcx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T12:54:42Z","updated_at":"2015-04-05T12:54:42Z","author_association":"CONTRIBUTOR","body":"Hi @dhaworth \n\nAre you sure that your shards have somewhere to go?  Try using the cluster reroute API with explain to understand why your shards are not being moved.  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96429334","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-96429334","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":96429334,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDI5MzM0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T20:04:47Z","updated_at":"2015-04-26T20:04:47Z","author_association":"CONTRIBUTOR","body":"Any more info?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96770580","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-96770580","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":96770580,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NzcwNTgw","user":{"login":"dhaworth","id":476206,"node_id":"MDQ6VXNlcjQ3NjIwNg==","avatar_url":"https://avatars2.githubusercontent.com/u/476206?v=4","gravatar_id":"","url":"https://api.github.com/users/dhaworth","html_url":"https://github.com/dhaworth","followers_url":"https://api.github.com/users/dhaworth/followers","following_url":"https://api.github.com/users/dhaworth/following{/other_user}","gists_url":"https://api.github.com/users/dhaworth/gists{/gist_id}","starred_url":"https://api.github.com/users/dhaworth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dhaworth/subscriptions","organizations_url":"https://api.github.com/users/dhaworth/orgs","repos_url":"https://api.github.com/users/dhaworth/repos","events_url":"https://api.github.com/users/dhaworth/events{/privacy}","received_events_url":"https://api.github.com/users/dhaworth/received_events","type":"User","site_admin":false},"created_at":"2015-04-27T18:26:05Z","updated_at":"2015-04-27T18:26:05Z","author_association":"NONE","body":"Apologies for the delay. I currently have a 3 node cluster in our staging environment where all nodes are both master and data nodes. If I exclude one of the nodes, the shards on that node should get pushed to the other two, but they aren't.\n\nThis is the explanation I get from the cluster reroute API, which seems like it may be suspect, but I'm not exactly sure how to interpret it.\n\n``` json\n\"explanations\" : [ {\n  \"command\" : \"move\",\n  \"parameters\" : {\n    \"index\" : \"decide\",\n    \"shard\" : 0,\n    \"from_node\" : \"i-xxxxxxxx\",\n    \"to_node\" : \"i-yyyyyyyy\"\n  },\n  \"decisions\" : [ {\n    \"decider\" : \"move_allocation_command\",\n    \"decision\" : \"NO\",\n    \"explanation\" : \"shard [decide][0] not found\"\n  } ]\n} ]\n```\n\nLet me know if you need additional info. Thanks.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96980290","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-96980290","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":96980290,"node_id":"MDEyOklzc3VlQ29tbWVudDk2OTgwMjkw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T08:49:38Z","updated_at":"2015-04-28T08:49:38Z","author_association":"CONTRIBUTOR","body":"It seems it is not finding shard zero of index `decide` on the `from_node`.  Check the location of your shards with:\n\n```\nGET _cluster/state/routing_table/decide\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/97054180","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-97054180","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":97054180,"node_id":"MDEyOklzc3VlQ29tbWVudDk3MDU0MTgw","user":{"login":"dhaworth","id":476206,"node_id":"MDQ6VXNlcjQ3NjIwNg==","avatar_url":"https://avatars2.githubusercontent.com/u/476206?v=4","gravatar_id":"","url":"https://api.github.com/users/dhaworth","html_url":"https://github.com/dhaworth","followers_url":"https://api.github.com/users/dhaworth/followers","following_url":"https://api.github.com/users/dhaworth/following{/other_user}","gists_url":"https://api.github.com/users/dhaworth/gists{/gist_id}","starred_url":"https://api.github.com/users/dhaworth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dhaworth/subscriptions","organizations_url":"https://api.github.com/users/dhaworth/orgs","repos_url":"https://api.github.com/users/dhaworth/repos","events_url":"https://api.github.com/users/dhaworth/events{/privacy}","received_events_url":"https://api.github.com/users/dhaworth/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T13:06:04Z","updated_at":"2015-04-28T13:06:04Z","author_association":"NONE","body":"That's interesting because I don't have an index named `decide` on this cluster, or any other cluster I've had this problem on. That routing table api call returns this:\n\n``` json\n{\n    cluster_name: \"Analytics15\",\n    routing_table: {\n        indices: { }\n    },\n    routing_nodes: {\n        unassigned: [ ],\n        nodes: { }\n    },\n    allocations: [ ]\n}\n```\n\nI don't see the word `decide` anywhere in my elasticsearch.yml or in `GET _cluster/state`. I do have the following plugins installed in case they may somehow be at fault:\n- kopf\n- HQ\n- bigdesk\n- kibana (which isn't technically a plugin anymore, but I do have installed on the same instance)\n\nAny thoughts on where this may be coming from?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/97145861","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-97145861","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":97145861,"node_id":"MDEyOklzc3VlQ29tbWVudDk3MTQ1ODYx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T17:36:35Z","updated_at":"2015-04-28T17:36:35Z","author_association":"CONTRIBUTOR","body":"Could you paste the output of the cluster-reroute command that you issue? (assuming that the output is still the same?)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/97154212","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-97154212","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":97154212,"node_id":"MDEyOklzc3VlQ29tbWVudDk3MTU0MjEy","user":{"login":"dhaworth","id":476206,"node_id":"MDQ6VXNlcjQ3NjIwNg==","avatar_url":"https://avatars2.githubusercontent.com/u/476206?v=4","gravatar_id":"","url":"https://api.github.com/users/dhaworth","html_url":"https://github.com/dhaworth","followers_url":"https://api.github.com/users/dhaworth/followers","following_url":"https://api.github.com/users/dhaworth/following{/other_user}","gists_url":"https://api.github.com/users/dhaworth/gists{/gist_id}","starred_url":"https://api.github.com/users/dhaworth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dhaworth/subscriptions","organizations_url":"https://api.github.com/users/dhaworth/orgs","repos_url":"https://api.github.com/users/dhaworth/repos","events_url":"https://api.github.com/users/dhaworth/events{/privacy}","received_events_url":"https://api.github.com/users/dhaworth/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T18:00:36Z","updated_at":"2015-04-28T18:00:36Z","author_association":"NONE","body":"Ugh, sorry. That `decide` index thing was my fault. I tried it with an actual index and node and got the following:\n\n``` json\n\"explanations\" : [ {\n  \"command\" : \"move\",\n  \"parameters\" : {\n    \"index\" : \"analytics-2014-01\",\n    \"shard\" : 4,\n    \"from_node\" : \"i-xxxxxxxx\",\n    \"to_node\" : \"i-yyyyyyyy\"\n  },\n  \"decisions\" : [ {\n    \"decider\" : \"same_shard\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"shard is not allocated to same node or host\"\n  }, {\n    \"decider\" : \"filter\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"node passes include/exclude/require filters\"\n  }, {\n    \"decider\" : \"replica_after_primary_active\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"shard is primary\"\n  }, {\n    \"decider\" : \"throttling\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"below shard recovery limit of [2]\"\n  }, {\n    \"decider\" : \"enable\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"allocation disabling is ignored\"\n  }, {\n    \"decider\" : \"disable\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"allocation disabling is ignored\"\n  }, {\n    \"decider\" : \"awareness\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"no allocation awareness enabled\"\n  }, {\n    \"decider\" : \"shards_limit\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"total shard limit disabled: [-1] <= 0\"\n  }, {\n    \"decider\" : \"node_version\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"target node version [1.5.0] is same or newer than source node version [1.5.0]\"\n  }, {\n    \"decider\" : \"disk_threshold\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"enough disk for shard on node, free: [138.7gb]\"\n  }, {\n    \"decider\" : \"snapshot_in_progress\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"no snapshots are currently running\"\n  } ]\n```\n\nThe ip address of the `to_node` in this case is excluded:\n\n``` json\n{\n    persistent: { },\n    transient: {\n        cluster: {\n            routing: {\n                allocation: {\n                    exclude: {\n                        _ip: \"y.y.y.y\"\n                    }\n                }\n            }\n        }\n    }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/97160874","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-97160874","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":97160874,"node_id":"MDEyOklzc3VlQ29tbWVudDk3MTYwODc0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T18:18:23Z","updated_at":"2015-04-28T18:18:23Z","author_association":"CONTRIBUTOR","body":"It says:\n\n```\n{\n    \"decider\" : \"filter\",\n    \"decision\" : \"YES\",\n    \"explanation\" : \"node passes include/exclude/require filters\"\n  }, \n```\n\nwhich makes me think that the IP you're using is not the same as the IP returned by `getHostAddress()` (see https://github.com/elastic/elasticsearch/blob/master/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeFilters.java#L73). This may not be the same as the bind or publish address.  Could you check for this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/97187069","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-97187069","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":97187069,"node_id":"MDEyOklzc3VlQ29tbWVudDk3MTg3MDY5","user":{"login":"dhaworth","id":476206,"node_id":"MDQ6VXNlcjQ3NjIwNg==","avatar_url":"https://avatars2.githubusercontent.com/u/476206?v=4","gravatar_id":"","url":"https://api.github.com/users/dhaworth","html_url":"https://github.com/dhaworth","followers_url":"https://api.github.com/users/dhaworth/followers","following_url":"https://api.github.com/users/dhaworth/following{/other_user}","gists_url":"https://api.github.com/users/dhaworth/gists{/gist_id}","starred_url":"https://api.github.com/users/dhaworth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dhaworth/subscriptions","organizations_url":"https://api.github.com/users/dhaworth/orgs","repos_url":"https://api.github.com/users/dhaworth/repos","events_url":"https://api.github.com/users/dhaworth/events{/privacy}","received_events_url":"https://api.github.com/users/dhaworth/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T19:55:24Z","updated_at":"2015-04-28T19:55:24Z","author_association":"NONE","body":"It looks like you're right. We recently switched from Amazon Linux (CentOS) to Ubuntu and it looks like the ip address of every node according to ES is now 127.0.1.1. This certainly explains the exclude not working. It looks like I have a configuration issue, either in `/etc/hosts` or with ES itself.\n\nIf you know a quick fix for this I'd appreciate any advice, otherwise I'll figure it out on my own. Thanks for helping me track this down.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/97351280","html_url":"https://github.com/elastic/elasticsearch/issues/10321#issuecomment-97351280","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10321","id":97351280,"node_id":"MDEyOklzc3VlQ29tbWVudDk3MzUxMjgw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-29T08:27:23Z","updated_at":"2015-04-29T08:27:23Z","author_association":"CONTRIBUTOR","body":"I don't know of a quick trick, but glad we could get to the bottom of this.  thanks for reporting back\n","performed_via_github_app":null}]