{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/31908","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31908/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31908/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31908/events","html_url":"https://github.com/elastic/elasticsearch/issues/31908","id":339624745,"node_id":"MDU6SXNzdWUzMzk2MjQ3NDU=","number":31908,"title":"Reindex-from-remote fails for external versions","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"labels":[{"id":1315850572,"node_id":"MDU6TGFiZWwxMzE1ODUwNTcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Reindex","name":":Distributed/Reindex","color":"0e8a16","default":false,"description":"Issues relating to reindex that are not caused by issues further down"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"assignees":[{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2018-07-09T22:10:25Z","updated_at":"2019-06-06T21:46:05Z","closed_at":"2019-06-06T21:46:05Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"It looks to me like `reindex-from-remote` fails for `version_type=external`:\r\n```\r\ncurl -XDELETE localhost:9200/test1\r\ncurl -XDELETE localhost:9200/test2\r\n\r\ncurl -HContent-Type:application/json -XPUT localhost:9200/test1 -d'{\r\n  \"mappings\": {\r\n    \"document\": {\r\n      \"properties\": {\r\n        \"id\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"field_str\": {\r\n          \"type\": \"text\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n\r\ncurl -HContent-Type:application/json -XPOST 'localhost:9200/test1/document/1?version=526&version_type=external&refresh=true' -d'{\r\n  \"id\": 1,\r\n  \"field_str\": \"val1\"\r\n}'\r\ncurl -HContent-Type:application/json -XPOST 'localhost:9200/test1/document/2?version=527&version_type=external&refresh=true' -d'{\r\n  \"id\": 2,\r\n  \"field_str\": \"val2\"\r\n}'\r\n\r\ncurl -HContent-Type:application/json -XPUT localhost:9200/test2 -d'{\r\n  \"mappings\": {\r\n    \"document\": {\r\n      \"properties\": {\r\n        \"id\": {\r\n          \"type\": \"keyword\"\r\n        },\r\n        \"field_str\": {\r\n          \"type\": \"text\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n\r\n#Reindex using version_type external\r\ncurl -HContent-Type:application/json -XPOST localhost:9200/_reindex?pretty -d'{\r\n  \"conflicts\": \"proceed\",\r\n  \"source\": {\r\n    \"size\": 1,\r\n    \"remote\": {\r\n      \"host\": \"http://127.0.0.1:9200\"\r\n    },\r\n    \"index\": \"test1\"\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"test2\",\r\n    \"version_type\": \"external\"\r\n  }\r\n}'\r\n```\r\n\r\nIt looks like we don't have any tests for reindex-from-remote and version_type=external which seems like a big whole.\r\n\r\nIt is also worth looking in to combining `version_type=external` with `op_type`. I don't *recall* that being a valid thing to do but I don't see anything stopping it. I'm not sure that it'll work properly though.","closed_by":{"login":"tbrooks8","id":862472,"node_id":"MDQ6VXNlcjg2MjQ3Mg==","avatar_url":"https://avatars3.githubusercontent.com/u/862472?v=4","gravatar_id":"","url":"https://api.github.com/users/tbrooks8","html_url":"https://github.com/tbrooks8","followers_url":"https://api.github.com/users/tbrooks8/followers","following_url":"https://api.github.com/users/tbrooks8/following{/other_user}","gists_url":"https://api.github.com/users/tbrooks8/gists{/gist_id}","starred_url":"https://api.github.com/users/tbrooks8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tbrooks8/subscriptions","organizations_url":"https://api.github.com/users/tbrooks8/orgs","repos_url":"https://api.github.com/users/tbrooks8/repos","events_url":"https://api.github.com/users/tbrooks8/events{/privacy}","received_events_url":"https://api.github.com/users/tbrooks8/received_events","type":"User","site_admin":false},"performed_via_github_app":null}