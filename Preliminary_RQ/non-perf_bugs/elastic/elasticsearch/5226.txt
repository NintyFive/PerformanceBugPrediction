{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5226","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5226/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5226/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5226/events","html_url":"https://github.com/elastic/elasticsearch/issues/5226","id":28090937,"node_id":"MDU6SXNzdWUyODA5MDkzNw==","number":5226,"title":"Query under nested query do not have the right scope","user":{"login":"lordaugustus","id":3888487,"node_id":"MDQ6VXNlcjM4ODg0ODc=","avatar_url":"https://avatars1.githubusercontent.com/u/3888487?v=4","gravatar_id":"","url":"https://api.github.com/users/lordaugustus","html_url":"https://github.com/lordaugustus","followers_url":"https://api.github.com/users/lordaugustus/followers","following_url":"https://api.github.com/users/lordaugustus/following{/other_user}","gists_url":"https://api.github.com/users/lordaugustus/gists{/gist_id}","starred_url":"https://api.github.com/users/lordaugustus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lordaugustus/subscriptions","organizations_url":"https://api.github.com/users/lordaugustus/orgs","repos_url":"https://api.github.com/users/lordaugustus/repos","events_url":"https://api.github.com/users/lordaugustus/events{/privacy}","received_events_url":"https://api.github.com/users/lordaugustus/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2014-02-22T06:51:34Z","updated_at":"2014-02-22T07:21:21Z","closed_at":"2014-02-22T07:21:21Z","author_association":"NONE","active_lock_reason":null,"body":"The following is the example query\n\nput /test2/type1/_mapping\n{\n    \"type1\" : {\n        \"properties\" : {\n            \"obj1\" : {\n                \"type\" : \"nested\"\n            }\n        }\n    }\n}\nput /test2/type1/1\n{\n    \"obj1\":[\n        {\n            \"name\":\"blue\",\n            \"message\":\"Hello World\"  \n        },\n         {\n            \"name\":\"red\",\n            \"message\":\"go elsewhere\"  \n        }\n    ]\n}\n\nget /test2/type1/_search\n{\n    \"nested\" : {\n        \"path\" : \"obj1\",\n        \"query\" : {\n            \"bool\" : {\n                \"must\" : [\n                    {\n                        \"match\" : {\"obj1.name\" : \"red\"}\n                    },\n                    {\n                        \"query\" : {\n                            \"query_string\": {\n                                \"fields\" : \"obj1.message\"\n                                \"query\" : \"Hello\"\n\n```\n                    }\n                }\n\n            ]\n        }\n    }\n}\n```\n\n}\n\nThis should not return a result as \"red\" and \"Hello Word\" is within different nested document. \nI think the problem is due to query act on a global path like \"obj1.message\", which points to multiple nested document, instead of the documents that the nested document the sibling query(in this case, match name:red) is currently acting on.\n","closed_by":{"login":"lordaugustus","id":3888487,"node_id":"MDQ6VXNlcjM4ODg0ODc=","avatar_url":"https://avatars1.githubusercontent.com/u/3888487?v=4","gravatar_id":"","url":"https://api.github.com/users/lordaugustus","html_url":"https://github.com/lordaugustus","followers_url":"https://api.github.com/users/lordaugustus/followers","following_url":"https://api.github.com/users/lordaugustus/following{/other_user}","gists_url":"https://api.github.com/users/lordaugustus/gists{/gist_id}","starred_url":"https://api.github.com/users/lordaugustus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lordaugustus/subscriptions","organizations_url":"https://api.github.com/users/lordaugustus/orgs","repos_url":"https://api.github.com/users/lordaugustus/repos","events_url":"https://api.github.com/users/lordaugustus/events{/privacy}","received_events_url":"https://api.github.com/users/lordaugustus/received_events","type":"User","site_admin":false},"performed_via_github_app":null}