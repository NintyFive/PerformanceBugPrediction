[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/20482438","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-20482438","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":20482438,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNDgyNDM4","user":{"login":"chilling","id":2590333,"node_id":"MDQ6VXNlcjI1OTAzMzM=","avatar_url":"https://avatars2.githubusercontent.com/u/2590333?v=4","gravatar_id":"","url":"https://api.github.com/users/chilling","html_url":"https://github.com/chilling","followers_url":"https://api.github.com/users/chilling/followers","following_url":"https://api.github.com/users/chilling/following{/other_user}","gists_url":"https://api.github.com/users/chilling/gists{/gist_id}","starred_url":"https://api.github.com/users/chilling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chilling/subscriptions","organizations_url":"https://api.github.com/users/chilling/orgs","repos_url":"https://api.github.com/users/chilling/repos","events_url":"https://api.github.com/users/chilling/events{/privacy}","received_events_url":"https://api.github.com/users/chilling/received_events","type":"User","site_admin":false},"created_at":"2013-07-04T15:20:58Z","updated_at":"2013-07-04T15:20:58Z","author_association":"CONTRIBUTOR","body":"hi @christianbader, by default the distribution of primary shards is not an important factor of allocation balance. Have you tried to change the  `cluster.routing.allocation.balance.primary` setting?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/20610015","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-20610015","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":20610015,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjEwMDE1","user":{"login":"christianbader","id":96615,"node_id":"MDQ6VXNlcjk2NjE1","avatar_url":"https://avatars1.githubusercontent.com/u/96615?v=4","gravatar_id":"","url":"https://api.github.com/users/christianbader","html_url":"https://github.com/christianbader","followers_url":"https://api.github.com/users/christianbader/followers","following_url":"https://api.github.com/users/christianbader/following{/other_user}","gists_url":"https://api.github.com/users/christianbader/gists{/gist_id}","starred_url":"https://api.github.com/users/christianbader/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/christianbader/subscriptions","organizations_url":"https://api.github.com/users/christianbader/orgs","repos_url":"https://api.github.com/users/christianbader/repos","events_url":"https://api.github.com/users/christianbader/events{/privacy}","received_events_url":"https://api.github.com/users/christianbader/received_events","type":"User","site_admin":false},"created_at":"2013-07-08T14:42:22Z","updated_at":"2013-07-08T14:42:22Z","author_association":"NONE","body":"It seems that the <code>cluster.routing.allocation.balance.primary</code> setting is not what i'm looking for because it just affects the distribution of primary shards between indexes per node.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21068088","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-21068088","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":21068088,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMDY4MDg4","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2013-07-16T19:44:20Z","updated_at":"2013-07-16T19:44:20Z","author_association":"CONTRIBUTOR","body":"hey @christianbader  we introduced `cluster.routing.allocation.balance.primary` mainly for tie-breaking reasons and by default it only has a `minor-vote` in the balance function (low weight 0.05 by default) We did this since for most users primary distribution is not a big deal since operations are executed on all replicas anyway and the primary is just the `leader` on indexing etc. Yet you can certainly give the primary balance a higher weight but this might trigger unnecessary rebalance operations. if you can deal with this then it might be ok.\n\ni'd still be interested what you are trying to do ie. can you give us more info about your usecase?\n\nI am closing this since it's not really an issue. feel free further comment here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/30433545","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-30433545","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":30433545,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNDMzNTQ1","user":{"login":"iksnalybok","id":3304227,"node_id":"MDQ6VXNlcjMzMDQyMjc=","avatar_url":"https://avatars1.githubusercontent.com/u/3304227?v=4","gravatar_id":"","url":"https://api.github.com/users/iksnalybok","html_url":"https://github.com/iksnalybok","followers_url":"https://api.github.com/users/iksnalybok/followers","following_url":"https://api.github.com/users/iksnalybok/following{/other_user}","gists_url":"https://api.github.com/users/iksnalybok/gists{/gist_id}","starred_url":"https://api.github.com/users/iksnalybok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iksnalybok/subscriptions","organizations_url":"https://api.github.com/users/iksnalybok/orgs","repos_url":"https://api.github.com/users/iksnalybok/repos","events_url":"https://api.github.com/users/iksnalybok/events{/privacy}","received_events_url":"https://api.github.com/users/iksnalybok/received_events","type":"User","site_admin":false},"created_at":"2013-12-12T15:46:58Z","updated_at":"2013-12-12T16:03:46Z","author_association":"CONTRIBUTOR","body":"Hi,\n\nWe are also facing the need to have balanced primary shards.\n\nOur use case is the following:\n- one index, with index.number_of_shards=10 and index.number_of_replicas=1\n- many incoming documents to index (or update) AND **percolate**\n- not that many searches\n\nWe don't have (yet) many percolators, but some of them are huge queries involving fuzziness and consume a lot of cpu. In our two nodes cluster, all primary shards finally end up to be on one node. In this case, we observe a very high load (cpu) on the node owning the primary shards, while the second node is really quiet.\n\nThe reason is that indexing + percolation happen on the node owning primary shard. Reading around about this issue, I've seen that indexing and synchronization of replicas cost more or less the same; in our case percolation makes the difference. Being able to balance primary shards would allow to balance the cpu load.\n\nNB: with two nodes, playing with cluster.routing.allocation.balance.primary has no effect.\n\nThanks.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37657779","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-37657779","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":37657779,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjU3Nzc5","user":{"login":"SoAG","id":1097048,"node_id":"MDQ6VXNlcjEwOTcwNDg=","avatar_url":"https://avatars2.githubusercontent.com/u/1097048?v=4","gravatar_id":"","url":"https://api.github.com/users/SoAG","html_url":"https://github.com/SoAG","followers_url":"https://api.github.com/users/SoAG/followers","following_url":"https://api.github.com/users/SoAG/following{/other_user}","gists_url":"https://api.github.com/users/SoAG/gists{/gist_id}","starred_url":"https://api.github.com/users/SoAG/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SoAG/subscriptions","organizations_url":"https://api.github.com/users/SoAG/orgs","repos_url":"https://api.github.com/users/SoAG/repos","events_url":"https://api.github.com/users/SoAG/events{/privacy}","received_events_url":"https://api.github.com/users/SoAG/received_events","type":"User","site_admin":false},"created_at":"2014-03-14T15:13:25Z","updated_at":"2014-03-14T15:13:34Z","author_association":"NONE","body":"Hi,\n\n@iksnalybok we are facing a similar problem. Just wondering if you have found a solution yet?\n\nThanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42595985","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-42595985","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":42595985,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTk1OTg1","user":{"login":"iksnalybok","id":3304227,"node_id":"MDQ6VXNlcjMzMDQyMjc=","avatar_url":"https://avatars1.githubusercontent.com/u/3304227?v=4","gravatar_id":"","url":"https://api.github.com/users/iksnalybok","html_url":"https://github.com/iksnalybok","followers_url":"https://api.github.com/users/iksnalybok/followers","following_url":"https://api.github.com/users/iksnalybok/following{/other_user}","gists_url":"https://api.github.com/users/iksnalybok/gists{/gist_id}","starred_url":"https://api.github.com/users/iksnalybok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iksnalybok/subscriptions","organizations_url":"https://api.github.com/users/iksnalybok/orgs","repos_url":"https://api.github.com/users/iksnalybok/repos","events_url":"https://api.github.com/users/iksnalybok/events{/privacy}","received_events_url":"https://api.github.com/users/iksnalybok/received_events","type":"User","site_admin":false},"created_at":"2014-05-08T19:37:42Z","updated_at":"2014-05-08T19:37:42Z","author_association":"CONTRIBUTOR","body":"Hi,\n\nSorry, I don't monitor this mailbox very often!\n\nThe short answer is not really.\n\nOur real issue is about percolation: in pre 1.x releases, it occurs on the\nprimary shards, which, when gathered on the same machine, put all the\npercolator-related load on this machine.\n\nIt seems that the new percolator design introduced in 1.0 solves this issue.\n\nHowever, we have not migrated yet. Our quick win is to add a third machine.\nWhen we have such a case, switching the guilty machine off (well, kindly\nremoving it temporarily from the cluster) rebalances the primaries on the\ntwo other nodes. It pretty ugly and not optimal, but it helps.\n\nRgds\nik\n\nOn Fri, Mar 14, 2014 at 4:13 PM, Roland Jungnickel <notifications@github.com\n\n> wrote:\n> \n> Hi,\n> \n> @iksnalybok https://github.com/iksnalybok we are facing a similar\n> problem. Just wondering if you have found a solution yet?\n> \n> —\n> Reply to this email directly or view it on GitHubhttps://github.com/elasticsearch/elasticsearch/issues/3293#issuecomment-37657779\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42615026","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-42615026","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":42615026,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjE1MDI2","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-05-08T22:37:47Z","updated_at":"2014-05-08T22:37:47Z","author_association":"MEMBER","body":"I am confused by the statement that indexing and percolation happen on the primary shard? Indexing happens on both the primary and the replica, and percolation happens on both as well, so there really isn't a difference between the 2 in that regard...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/43380537","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-43380537","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":43380537,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMzgwNTM3","user":{"login":"iksnalybok","id":3304227,"node_id":"MDQ6VXNlcjMzMDQyMjc=","avatar_url":"https://avatars1.githubusercontent.com/u/3304227?v=4","gravatar_id":"","url":"https://api.github.com/users/iksnalybok","html_url":"https://github.com/iksnalybok","followers_url":"https://api.github.com/users/iksnalybok/followers","following_url":"https://api.github.com/users/iksnalybok/following{/other_user}","gists_url":"https://api.github.com/users/iksnalybok/gists{/gist_id}","starred_url":"https://api.github.com/users/iksnalybok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iksnalybok/subscriptions","organizations_url":"https://api.github.com/users/iksnalybok/orgs","repos_url":"https://api.github.com/users/iksnalybok/repos","events_url":"https://api.github.com/users/iksnalybok/events{/privacy}","received_events_url":"https://api.github.com/users/iksnalybok/received_events","type":"User","site_admin":false},"created_at":"2014-05-16T21:17:05Z","updated_at":"2014-05-19T07:02:20Z","author_association":"CONTRIBUTOR","body":"Hi Shay,\n\nI'll try to clarify.\n\nIn our case, we are using the index-and-percolate-at-the-same-time api\npresent in 0.90.\n\nSo\nhttp://www.elasticsearch.org/guide/en/elasticsearch/reference/0.90/docs-index_.html applies:\n\n> The index operation is directed to the primary shard based on its route (see the Routing section above) and performed on the actual node containing this shard. After the primary shard completes the operation, if needed, the update is distributed to applicable replicas.\n\nRephrasing it, the index operation (in our case, the index+percolation operation) is performed on the actual node containing the primary shard. So when all primary shards are on the same node, all index+percolation operations happen on this single node.\n\nNote: percolation is not distributed in 0.90.x.\nNote: while indexing will also happen on the replica, percolation will not.\n\nIn our case, percolation is a costly operation (much heavier than indexing), and is the cause of the high cpu usage.\n\nRegards,\nIk\n\nOn Fri, May 9, 2014 at 12:38 AM, Shay Banon notifications@github.comwrote:\n\n> I am confused by the statement that indexing and percolation happen on the\n> primary shard? Indexing happens on both the primary and the replica, and\n> percolation happens on both as well, so there really isn't a difference\n> between the 2 in that regard...\n> \n> —\n> Reply to this email directly or view it on GitHubhttps://github.com/elasticsearch/elasticsearch/issues/3293#issuecomment-42615026\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/43447679","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-43447679","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":43447679,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNDQ3Njc5","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-05-18T18:42:43Z","updated_at":"2014-05-18T18:42:43Z","author_association":"MEMBER","body":"@iksnalybok I see. This is no longer relevant in 1.x version, since percolation works completely differently, I don't think there is anything to do here?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/43471687","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-43471687","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":43471687,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNDcxNjg3","user":{"login":"iksnalybok","id":3304227,"node_id":"MDQ6VXNlcjMzMDQyMjc=","avatar_url":"https://avatars1.githubusercontent.com/u/3304227?v=4","gravatar_id":"","url":"https://api.github.com/users/iksnalybok","html_url":"https://github.com/iksnalybok","followers_url":"https://api.github.com/users/iksnalybok/followers","following_url":"https://api.github.com/users/iksnalybok/following{/other_user}","gists_url":"https://api.github.com/users/iksnalybok/gists{/gist_id}","starred_url":"https://api.github.com/users/iksnalybok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iksnalybok/subscriptions","organizations_url":"https://api.github.com/users/iksnalybok/orgs","repos_url":"https://api.github.com/users/iksnalybok/repos","events_url":"https://api.github.com/users/iksnalybok/events{/privacy}","received_events_url":"https://api.github.com/users/iksnalybok/received_events","type":"User","site_admin":false},"created_at":"2014-05-19T07:08:37Z","updated_at":"2014-05-19T07:08:37Z","author_association":"CONTRIBUTOR","body":"Indeed, it's a 0.90.x issue. We don't expect a fix. We'd rather migrate to\n1.x.\n\nOn Sun, May 18, 2014 at 8:43 PM, Shay Banon notifications@github.comwrote:\n\n> @iksnalybok https://github.com/iksnalybok I see. This is no longer\n> relevant in 1.x version, since percolation works completely differently, I\n> don't think there is anything to do here?\n> \n> —\n> Reply to this email directly or view it on GitHubhttps://github.com/elasticsearch/elasticsearch/issues/3293#issuecomment-43447679\n> .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/343653838","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-343653838","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":343653838,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzY1MzgzOA==","user":{"login":"sepich","id":1803804,"node_id":"MDQ6VXNlcjE4MDM4MDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1803804?v=4","gravatar_id":"","url":"https://api.github.com/users/sepich","html_url":"https://github.com/sepich","followers_url":"https://api.github.com/users/sepich/followers","following_url":"https://api.github.com/users/sepich/following{/other_user}","gists_url":"https://api.github.com/users/sepich/gists{/gist_id}","starred_url":"https://api.github.com/users/sepich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sepich/subscriptions","organizations_url":"https://api.github.com/users/sepich/orgs","repos_url":"https://api.github.com/users/sepich/repos","events_url":"https://api.github.com/users/sepich/events{/privacy}","received_events_url":"https://api.github.com/users/sepich/received_events","type":"User","site_admin":false},"created_at":"2017-11-11T10:02:34Z","updated_at":"2017-11-11T10:02:34Z","author_association":"NONE","body":"ES v5:\r\nNov 11 02:00:43 elasticsearch[40290]: org.elasticsearch.bootstrap.StartupException: java.lang.IllegalArgumentException: unknown setting [cluster.routing.allocation.balance.primary] did you mean any of [cluster.routing.allocation.balance.shard, cluster.routing.allocation.balance.index, cluster.routing.allocation.balance.threshold]","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/343655457","html_url":"https://github.com/elastic/elasticsearch/issues/3293#issuecomment-343655457","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3293","id":343655457,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzY1NTQ1Nw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2017-11-11T10:34:15Z","updated_at":"2017-11-11T10:34:15Z","author_association":"CONTRIBUTOR","body":"@sepich You are unlikely to find a resolution to your problem by posting error messages to 3+ year old issues about very old versions of the Elasticsearch.\r\nPlease ask a question on [discuss.elastic.co](https://discuss.elastic.co/) if you need assistance.","performed_via_github_app":null}]