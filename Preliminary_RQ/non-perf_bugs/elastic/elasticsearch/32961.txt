{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32961","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32961/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32961/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32961/events","html_url":"https://github.com/elastic/elasticsearch/issues/32961","id":351678439,"node_id":"MDU6SXNzdWUzNTE2Nzg0Mzk=","number":32961,"title":"Elasticsearch installed with RPM fails to restart after yum update","user":{"login":"bpri","id":14222514,"node_id":"MDQ6VXNlcjE0MjIyNTE0","avatar_url":"https://avatars1.githubusercontent.com/u/14222514?v=4","gravatar_id":"","url":"https://api.github.com/users/bpri","html_url":"https://github.com/bpri","followers_url":"https://api.github.com/users/bpri/followers","following_url":"https://api.github.com/users/bpri/following{/other_user}","gists_url":"https://api.github.com/users/bpri/gists{/gist_id}","starred_url":"https://api.github.com/users/bpri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bpri/subscriptions","organizations_url":"https://api.github.com/users/bpri/orgs","repos_url":"https://api.github.com/users/bpri/repos","events_url":"https://api.github.com/users/bpri/events{/privacy}","received_events_url":"https://api.github.com/users/bpri/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-08-17T17:36:01Z","updated_at":"2018-08-17T18:13:49Z","closed_at":"2018-08-17T18:13:48Z","author_association":"NONE","active_lock_reason":null,"body":"Bug report\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): \r\nVersion: 6.3.2, Build: default/rpm/053779d/2018-07-20T05:20:23.451332Z, JVM: 1.8.0_181\r\n\r\n**Plugins installed**: [ingest-user-agent, ingest-geoip]\r\n\r\n**JVM version** (`java -version`):\r\n1.8.0_181\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nRHEL 7.5\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nelasticsearch fails to restart after yum update due to incompatible plugins.    Please include a rpm postinstall script to update plugins to same version as rpm installed Elasticsearch version, so that if a separate operations team yum updates the VMs, elasticsearch will come back after reboot.\r\n\r\n\r\n**Steps to reproduce**:\r\n 1. install elasticsearch repo in /etc/yum.repos.d\r\n 2. install Elasticsearch via RPM package (in this case latest was 6.2.4 when installed): yum install elasticsearch\r\n 3. install plugins required for filebeat-apache2: sudo bin/elasticsearch-plugin install  ingest-user-agent\r\n 4. after update to Elasticsearch (in this case 6.3.2) :  'yum update' VM to get latest RPM package\r\n 5. when elasticsearch tries to restart it fails with incompatible plugins\r\n\r\n**Provide logs (if relevant)**:\r\n[2018-08-17T13:09:02,941][ERROR][o.e.b.Bootstrap          ] Exception\r\njava.lang.IllegalArgumentException: Plugin [ingest-user-agent] was built for Elasticsearch version 6.2.4 but version 6.3.2 is running\r\n        at org.elasticsearch.plugins.PluginsService.verifyCompatibility(PluginsService.java:421) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.plugins.PluginsService.loadBundle(PluginsService.java:618) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.plugins.PluginsService.loadBundles(PluginsService.java:557) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.plugins.PluginsService.<init>(PluginsService.java:162) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:311) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:252) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:213) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:213) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:326) [elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136) [elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127) [elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) [elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) [elasticsearch-cli-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.cli.Command.main(Command.java:90) [elasticsearch-cli-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) [elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86) [elasticsearch-6.3.2.jar:6.3.2]\r\n\r\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}