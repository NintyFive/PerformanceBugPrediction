{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6525","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6525/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6525/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6525/events","html_url":"https://github.com/elastic/elasticsearch/issues/6525","id":35861221,"node_id":"MDU6SXNzdWUzNTg2MTIyMQ==","number":6525,"title":"es 1.2.1 in has_child query can not use custom_score and function_score","user":{"login":"fiefdx","id":3204360,"node_id":"MDQ6VXNlcjMyMDQzNjA=","avatar_url":"https://avatars1.githubusercontent.com/u/3204360?v=4","gravatar_id":"","url":"https://api.github.com/users/fiefdx","html_url":"https://github.com/fiefdx","followers_url":"https://api.github.com/users/fiefdx/followers","following_url":"https://api.github.com/users/fiefdx/following{/other_user}","gists_url":"https://api.github.com/users/fiefdx/gists{/gist_id}","starred_url":"https://api.github.com/users/fiefdx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fiefdx/subscriptions","organizations_url":"https://api.github.com/users/fiefdx/orgs","repos_url":"https://api.github.com/users/fiefdx/repos","events_url":"https://api.github.com/users/fiefdx/events{/privacy}","received_events_url":"https://api.github.com/users/fiefdx/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-06-17T06:23:19Z","updated_at":"2014-08-20T00:47:27Z","closed_at":"2014-06-17T06:27:20Z","author_association":"NONE","active_lock_reason":null,"body":"use as:\n\n``` sh\n#!/bin/sh\n\n# assume the index products doesn't exist\n# otherwise uncomment the following line\n# curl -XDELETE localhost:9200/products\n\ncurl -XPUT localhost:9200/products/product/1 -d'{\n  \"property1\": \"value1\"\n}'\n\ncurl -XPUT localhost:9200/products/product/2 -d'{\n  \"property1\": \"value2\"\n}'\n\ncurl -XPOST localhost:9200/products/offer/_mapping -d '{\n  \"book\":{\n    \"_parent\": {\"type\": \"product\"}\n  }\n}'\n\ncurl -XPOST localhost:9200/products/offer/1?parent=1 -d '{\n   \"color\": \"blue\",\n   \"size\": 1,\n   \"price\": 99.4\n}'\n\ncurl -XPOST localhost:9200/products/offer/2?parent=1 -d '{\n   \"color\": \"red\",\n   \"size\": 2,\n   \"price\": 100.5\n}'\n\ncurl -XPOST localhost:9200/products/offer/3?parent=2 -d '{\n   \"color\": \"blue\",\n   \"size\": 3,\n   \"price\": 100.7\n}'\necho \"\"\n\nuse custom_score query as:\ncurl -s -XPOST 'localhost:9200/products/product/_search?pretty=true' -d '{\n  \"query\" : {\n    \"has_child\" : {\n      \"type\" : \"offer\",\n      \"score_mode\" : \"max\",\n      \"query\" : {\n        \"custom_score\" : {\n          \"script\" : \"-doc[\\\"offer.price\\\"].value\",\n          \"query\": {\n            \"term\" : {\n              \"color\" : \"blue\"        \n            }\n          }\n        }\n      }\n    }\n  },\n  \"facets\" : {\n      \"size\" : {\n          \"terms\" : {\n              \"field\" : \"size\"\n          },\n          \"global\" : true,\n          \"facet_filter\" : {\n            \"bool\" : {\n              \"must\" : [\n                { \"term\" : { \"color\" : \"blue\" } }\n              ]\n            }\n          }\n      }\n  }\n}'\n```\n\nget exception in version 1.2.1:\nnested: QueryParsingException[[products] No query registered for [custom_score]]; \nin version 0.90.9 runs fine.\n\nuse function_score as:\n\n```\ncurl -s -XPOST 'localhost:9200/products/product/_search?pretty=true' -d '{\n  \"query\" : {\n    \"has_child\" : {\n      \"type\" : \"offer\",\n      \"score_mode\" : \"max\",\n      \"query\" : {\n        \"function_score\" : {\n          \"boost_mode\" : \"replace\",\n          \"query\" : {\n            \"term\" : {\n              \"color\" : \"blue\"        \n            }\n          },\n          \"script_score\" : {\n            \"script\" : \"doc['offer.price'].value\"\n          }\n        }\n      }\n    }\n  }\n}'\n```\n\nget exception:\nnested: QueryParsingException[[products] script_score the script could not be loaded]; nested: ScriptException[dynamic scripting disabled];\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}