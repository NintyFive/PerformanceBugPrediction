[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426242855","html_url":"https://github.com/elastic/elasticsearch/issues/34209#issuecomment-426242855","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34209","id":426242855,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjI0Mjg1NQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T11:43:13Z","updated_at":"2018-10-02T11:43:13Z","author_association":"MEMBER","body":"hi @dharada , \r\nthere is a note in the page that you linked that says:\r\n\r\n>The maximum number of buckets allowed in a single response is limited by a dynamic cluster setting named search.max_buckets. It is disabled by default (-1) but requests that try to return more than 10,000 buckets (the default value for future versions) will log a deprecation warning.\r\n\r\nDo you think that the above note explains the behaviour clearly enough?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/426242883","html_url":"https://github.com/elastic/elasticsearch/issues/34209#issuecomment-426242883","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34209","id":426242883,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjI0Mjg4Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-02T11:43:22Z","updated_at":"2018-10-02T11:43:22Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/437282155","html_url":"https://github.com/elastic/elasticsearch/issues/34209#issuecomment-437282155","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34209","id":437282155,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNzI4MjE1NQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2018-11-09T08:09:35Z","updated_at":"2018-11-09T08:09:35Z","author_association":"MEMBER","body":"No further feedback received. @dharada if you have the requested \r\ninformation please add it in a comment and we can look at re-opening \r\nthis issue.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478214237","html_url":"https://github.com/elastic/elasticsearch/issues/34209#issuecomment-478214237","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34209","id":478214237,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODIxNDIzNw==","user":{"login":"zorze","id":13689410,"node_id":"MDQ6VXNlcjEzNjg5NDEw","avatar_url":"https://avatars0.githubusercontent.com/u/13689410?v=4","gravatar_id":"","url":"https://api.github.com/users/zorze","html_url":"https://github.com/zorze","followers_url":"https://api.github.com/users/zorze/followers","following_url":"https://api.github.com/users/zorze/following{/other_user}","gists_url":"https://api.github.com/users/zorze/gists{/gist_id}","starred_url":"https://api.github.com/users/zorze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zorze/subscriptions","organizations_url":"https://api.github.com/users/zorze/orgs","repos_url":"https://api.github.com/users/zorze/repos","events_url":"https://api.github.com/users/zorze/events{/privacy}","received_events_url":"https://api.github.com/users/zorze/received_events","type":"User","site_admin":false},"created_at":"2019-03-30T06:51:17Z","updated_at":"2019-03-30T06:51:17Z","author_association":"NONE","body":"The note does explain the warning. Is there some other place showing how to set the search.max_buckets?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/478336164","html_url":"https://github.com/elastic/elasticsearch/issues/34209#issuecomment-478336164","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34209","id":478336164,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODMzNjE2NA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2019-03-31T12:10:49Z","updated_at":"2019-03-31T12:10:49Z","author_association":"CONTRIBUTOR","body":"@zorze `search.max_buckets` is a cluster setting, and is set [in the same way as all other cluster settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-update-settings.html). ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/574062812","html_url":"https://github.com/elastic/elasticsearch/issues/34209#issuecomment-574062812","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34209","id":574062812,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NDA2MjgxMg==","user":{"login":"saiergong","id":4198386,"node_id":"MDQ6VXNlcjQxOTgzODY=","avatar_url":"https://avatars1.githubusercontent.com/u/4198386?v=4","gravatar_id":"","url":"https://api.github.com/users/saiergong","html_url":"https://github.com/saiergong","followers_url":"https://api.github.com/users/saiergong/followers","following_url":"https://api.github.com/users/saiergong/following{/other_user}","gists_url":"https://api.github.com/users/saiergong/gists{/gist_id}","starred_url":"https://api.github.com/users/saiergong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saiergong/subscriptions","organizations_url":"https://api.github.com/users/saiergong/orgs","repos_url":"https://api.github.com/users/saiergong/repos","events_url":"https://api.github.com/users/saiergong/events{/privacy}","received_events_url":"https://api.github.com/users/saiergong/received_events","type":"User","site_admin":false},"created_at":"2020-01-14T08:33:57Z","updated_at":"2020-01-14T08:33:57Z","author_association":"NONE","body":"> No further feedback received. @dharada if you have the requested\r\n> information please add it in a comment and we can look at re-opening\r\n> this issue.\r\n\r\nhi, @javanna , does this parameter limit the number of buckets returned or created during aggregation? for example，if one shard create 20000 term buckets during aggregation, but the user limit the return size to 10, will this parameter trigger？ \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/579362100","html_url":"https://github.com/elastic/elasticsearch/issues/34209#issuecomment-579362100","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34209","id":579362100,"node_id":"MDEyOklzc3VlQ29tbWVudDU3OTM2MjEwMA==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2020-01-28T17:23:56Z","updated_at":"2020-01-28T17:23:56Z","author_association":"MEMBER","body":"@saiergong the `max_buckets` parameter limits the maximum number of buckets at both a shard-level and a coordinatator-level.  E.g. assuming `max_buckets` is set to 10,000:\r\n\r\n- If a shard generates more than 10,000 buckets during the course of processing the shard, the limit is triggered and an exception is thrown\r\n- If five shards all generate 9,999 buckets, they each individually are under the threshold.  The per-shard results are sent to the coordinator.  Assuming each shard had unique buckets which didn't exist on other shards, as soon as the coordinator starts merging the results the threshold will be breached and an exception is thrown\r\n- If five shards all generate 9,999 buckets and send those to the coordinator, but all 9,999 buckets are identical across all shards (meaning the total number of buckets generated globally is still 9,999), the threshold isn't breached and no exception is thrown.\r\n\r\nBasically, if at any point Elasticsearch finds that there are more than `max_buckets` number of buckets sitting around, the exception is thrown.\r\n\r\nEach agg handles bucketing a little differently.  E.g. `terms` agg has a `size` parameter, but also a `shard_size` parameter.  Those will affect how many buckets a shard tries to collect.  `histo`/`date_histo` will collect all the buckets in a range, etc.  Some aggs like `rare_terms` can generate many shard-level buckets but once merged on the coordinator it drops down to a small handful, etc.","performed_via_github_app":null}]