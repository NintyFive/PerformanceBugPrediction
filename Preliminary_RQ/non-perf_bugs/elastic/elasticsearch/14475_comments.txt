[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153310701","html_url":"https://github.com/elastic/elasticsearch/issues/14475#issuecomment-153310701","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14475","id":153310701,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzMxMDcwMQ==","user":{"login":"albanm","id":164958,"node_id":"MDQ6VXNlcjE2NDk1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/164958?v=4","gravatar_id":"","url":"https://api.github.com/users/albanm","html_url":"https://github.com/albanm","followers_url":"https://api.github.com/users/albanm/followers","following_url":"https://api.github.com/users/albanm/following{/other_user}","gists_url":"https://api.github.com/users/albanm/gists{/gist_id}","starred_url":"https://api.github.com/users/albanm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albanm/subscriptions","organizations_url":"https://api.github.com/users/albanm/orgs","repos_url":"https://api.github.com/users/albanm/repos","events_url":"https://api.github.com/users/albanm/events{/privacy}","received_events_url":"https://api.github.com/users/albanm/received_events","type":"User","site_admin":false},"created_at":"2015-11-03T10:35:39Z","updated_at":"2015-11-03T10:35:39Z","author_association":"NONE","body":"FYI storing the individual field doesn't seem to change anything.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/154859345","html_url":"https://github.com/elastic/elasticsearch/issues/14475#issuecomment-154859345","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14475","id":154859345,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NDg1OTM0NQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-08T19:21:38Z","updated_at":"2015-11-08T19:21:38Z","author_association":"CONTRIBUTOR","body":"There is a discrepancy between how paths are specified for `fields` and `_source`:\n\n`fields` can only return stored fields as inner hits:\n\n```\nPUT /test\n{\n  \"mappings\": {\n    \"article\": {\n      \"properties\": {\n        \"comments\": {\n          \"type\": \"nested\",\n          \"properties\": {\n            \"content\": {\n              \"type\": \"string\",\n              \"store\": true\n            },\n            \"user\": {\n              \"properties\": {\n                \"id\": {\n                  \"type\": \"string\",\n                  \"store\": true\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\n\nPUT /test/article/1\n{\n  \"title\": \"Inner hits fields bug\",\n  \"comments\": [\n    {\n      \"user\": {\n        \"id\": \"albanm\"\n      },\n      \"content\": \"What is going on ?\"\n    }\n  ]\n}\n```\n\nThe full path must be specified for stored fields:\n\n```\nPOST /test/article/_search\n{\n  \"query\": {\n    \"nested\": {\n      \"path\": \"comments\",\n      \"query\": {\n        \"match_all\": {}\n      },\n      \"inner_hits\": {\n        \"fields\": [\n          \"comments.user.id\",\n          \"comments.content\"\n        ]\n      }\n    }\n  }\n}\n```\n\nBut `_source` prepends the path of the nested field:\n\n```\nPOST /test/article/_search\n{\n  \"query\": {\n    \"nested\": {\n      \"path\": \"comments\",\n      \"query\": {\n        \"match_all\": {}\n      },\n      \"inner_hits\": {\n        \"_source\": [\n          \"user.id\",\n          \"content\"\n        ]\n      }\n    }\n  }\n}\n```\n\n@martijnvg looks like a bug to me?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/155004777","html_url":"https://github.com/elastic/elasticsearch/issues/14475#issuecomment-155004777","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14475","id":155004777,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NTAwNDc3Nw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-11-09T09:21:38Z","updated_at":"2015-11-09T09:21:38Z","author_association":"MEMBER","body":"@clintongormley @albanm The reason why there is a discrepancy between `fields` and `_source` is just because the two are differently implemented. The `fields` requires the field to exist in the mapping and therefor the full path needs to be provided, whereas `_source` doesn't require that and just retrieves the relevant bits from the _source (map of maps).\n\nThis discrepancy is noticeable when using inner hits, because the actual source of an inner hit is different than the source of a top level hit. (the _source of the inner hit is a subset of the _source of a top level hit)\nSo I'm not sure if this is a bug, because the _source is actually just different in the cases.\n\nAnother thing is that the `_source` allows to include/exclude also properties that are unmapped. (in cases where object field is configured to be disabled), so that is also a reason that this feature is differently implemented.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/155021240","html_url":"https://github.com/elastic/elasticsearch/issues/14475#issuecomment-155021240","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14475","id":155021240,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NTAyMTI0MA==","user":{"login":"albanm","id":164958,"node_id":"MDQ6VXNlcjE2NDk1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/164958?v=4","gravatar_id":"","url":"https://api.github.com/users/albanm","html_url":"https://github.com/albanm","followers_url":"https://api.github.com/users/albanm/followers","following_url":"https://api.github.com/users/albanm/following{/other_user}","gists_url":"https://api.github.com/users/albanm/gists{/gist_id}","starred_url":"https://api.github.com/users/albanm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albanm/subscriptions","organizations_url":"https://api.github.com/users/albanm/orgs","repos_url":"https://api.github.com/users/albanm/repos","events_url":"https://api.github.com/users/albanm/events{/privacy}","received_events_url":"https://api.github.com/users/albanm/received_events","type":"User","site_admin":false},"created_at":"2015-11-09T10:19:56Z","updated_at":"2015-11-09T10:19:56Z","author_association":"NONE","body":"The behavior that I noticed is still a bug I think. Let's forget _source, and just look at my initial example. The field \"content\" was successfully extracted from _source and returned without being stored nor prefixed by \"comments.\", while \"user.id\" was not.\n\nBy the way I switched to using _source filtering as I now see that my problem is with a deprecated functionality:\n\n[\"This functionality has been replaced by the source filtering parameter.\"](https://www.elastic.co/guide/en/elasticsearch/reference/1.7/search-request-fields.html).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/155057486","html_url":"https://github.com/elastic/elasticsearch/issues/14475#issuecomment-155057486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14475","id":155057486,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NTA1NzQ4Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-09T13:10:31Z","updated_at":"2015-11-09T13:10:31Z","author_association":"CONTRIBUTOR","body":"> The behavior that I noticed is still a bug I think. Let's forget _source, and just look at my initial example. The field \"content\" was successfully extracted from _source and returned without being stored nor prefixed by \"comments.\", while \"user.id\" was not.\n\nIt's a bit more complicated than that :)  Before 2.0, you could reference fields either with just the name, or with the full path.  `content` was actually being retrieved from the source field, and could be found because you used the short name.  `user.id` however is neither the short name nor the full path.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/155070586","html_url":"https://github.com/elastic/elasticsearch/issues/14475#issuecomment-155070586","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14475","id":155070586,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NTA3MDU4Ng==","user":{"login":"albanm","id":164958,"node_id":"MDQ6VXNlcjE2NDk1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/164958?v=4","gravatar_id":"","url":"https://api.github.com/users/albanm","html_url":"https://github.com/albanm","followers_url":"https://api.github.com/users/albanm/followers","following_url":"https://api.github.com/users/albanm/following{/other_user}","gists_url":"https://api.github.com/users/albanm/gists{/gist_id}","starred_url":"https://api.github.com/users/albanm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albanm/subscriptions","organizations_url":"https://api.github.com/users/albanm/orgs","repos_url":"https://api.github.com/users/albanm/repos","events_url":"https://api.github.com/users/albanm/events{/privacy}","received_events_url":"https://api.github.com/users/albanm/received_events","type":"User","site_admin":false},"created_at":"2015-11-09T14:05:13Z","updated_at":"2015-11-09T14:05:13Z","author_association":"NONE","body":"Ok, thanks for the explanations !\n","performed_via_github_app":null}]