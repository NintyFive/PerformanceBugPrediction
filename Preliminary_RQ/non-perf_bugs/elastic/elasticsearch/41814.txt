{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41814","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41814/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41814/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41814/events","html_url":"https://github.com/elastic/elasticsearch/issues/41814","id":440267516,"node_id":"MDU6SXNzdWU0NDAyNjc1MTY=","number":41814,"title":"Snapshot error with minio trailing / in the base_path of the repository gives FileAlreadyExistsException for recursive snapshots of the same index","user":{"login":"thasija","id":33990350,"node_id":"MDQ6VXNlcjMzOTkwMzUw","avatar_url":"https://avatars2.githubusercontent.com/u/33990350?v=4","gravatar_id":"","url":"https://api.github.com/users/thasija","html_url":"https://github.com/thasija","followers_url":"https://api.github.com/users/thasija/followers","following_url":"https://api.github.com/users/thasija/following{/other_user}","gists_url":"https://api.github.com/users/thasija/gists{/gist_id}","starred_url":"https://api.github.com/users/thasija/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thasija/subscriptions","organizations_url":"https://api.github.com/users/thasija/orgs","repos_url":"https://api.github.com/users/thasija/repos","events_url":"https://api.github.com/users/thasija/events{/privacy}","received_events_url":"https://api.github.com/users/thasija/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":18,"created_at":"2019-05-04T00:48:08Z","updated_at":"2019-09-20T14:40:49Z","closed_at":"2019-09-20T14:40:49Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`5.6.11`):\r\n\r\n**Plugins installed**: [repository-s3]\r\n\r\n**JVM version** (`jdk1.8.0_77`):\r\n\r\n**OS version** (`uname -a` 3.10.0-862.el7.x86_64 #1 SMP Fri Apr 20 16:44:24 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux):\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nAm taking snapshots of indices on Minio server which are taken in a bucket , The successive snapshots of the same indices complete successfully when taken at the bucket root level , but if  I register a new repository with a base_path to take snapshots under sub directory the first snapshot gets created successfully but the successive snapshots fail with the FileAlreadyExistsException.\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n# Parent root level bucket snapshot repository\r\ncurl -XGET \"esi1rvmm03-inc.tw-test.net:9200/_snapshot/intc_minio_repository/_all?pretty\"\r\n{\r\n  \"snapshots\" : [\r\n    {\r\n      \"snapshot\" : \"usg_report_month_2018_09_snapshot\",\r\n      \"uuid\" : \"b1cXPStzSA245j6rNABL8g\",\r\n      \"version_id\" : 5061199,\r\n      \"version\" : \"5.6.11\",\r\n      \"indices\" : [\r\n        \"usg_report_month_2018_09\"\r\n      ],\r\n      \"state\" : \"SUCCESS\",\r\n      \"start_time\" : \"2019-04-15T01:57:54.293Z\",\r\n      \"start_time_in_millis\" : 1555293474293,\r\n      \"end_time\" : \"2019-04-15T01:57:57.365Z\",\r\n      \"end_time_in_millis\" : 1555293477365,\r\n      \"duration_in_millis\" : 3072,\r\n      \"failures\" : [ ],\r\n      \"shards\" : {\r\n        \"total\" : 1,\r\n        \"failed\" : 0,\r\n        \"successful\" : 1\r\n      }\r\n    },\r\n    {\r\n      \"snapshot\" : \"snapshot_1\",\r\n      \"uuid\" : \"EsSYscL_REK7KVORsYrWuQ\",\r\n      \"version_id\" : 5061199,\r\n      \"version\" : \"5.6.11\",\r\n      \"indices\" : [\r\n        \"doclocker\"\r\n      ],\r\n      \"state\" : \"SUCCESS\",\r\n      \"start_time\" : \"2019-05-02T22:35:02.206Z\",\r\n      \"start_time_in_millis\" : 1556836502206,\r\n      \"end_time\" : \"2019-05-02T22:35:13.609Z\",\r\n      \"end_time_in_millis\" : 1556836513609,\r\n      \"duration_in_millis\" : 11403,\r\n      \"failures\" : [ ],\r\n      \"shards\" : {\r\n        \"total\" : 5,\r\n        \"failed\" : 0,\r\n        \"successful\" : 5\r\n      }\r\n    },\r\n    {\r\n      \"snapshot\" : \"snapshot_2\",\r\n      \"uuid\" : \"vWpuP64ET5KBGuWJ4PmP2w\",\r\n      \"version_id\" : 5061199,\r\n      \"version\" : \"5.6.11\",\r\n      \"indices\" : [\r\n        \"doclocker\"\r\n      ],\r\n      \"state\" : \"SUCCESS\",\r\n      \"start_time\" : \"2019-05-02T22:39:10.484Z\",\r\n      \"start_time_in_millis\" : 1556836750484,\r\n      \"end_time\" : \"2019-05-02T22:39:11.230Z\",\r\n      \"end_time_in_millis\" : 1556836751230,\r\n      \"duration_in_millis\" : 746,\r\n      \"failures\" : [ ],\r\n      \"shards\" : {\r\n        \"total\" : 5,\r\n        \"failed\" : 0,\r\n        \"successful\" : 5\r\n      }\r\n\r\n# Nested directory snapshot repository\r\ncurl -XGET \"esi1rvmm03-inc.tw-test.net:9200/_snapshot/intc_minio_repository_doclocker/_all?pretty\"\r\n{\r\n  \"snapshots\" : [\r\n    {\r\n      \"snapshot\" : \"snapshot_1\",\r\n      \"uuid\" : \"c_VRGCCdSSKLr-i0PTXLZg\",\r\n      \"version_id\" : 5061199,\r\n      \"version\" : \"5.6.11\",\r\n      \"indices\" : [\r\n        \"doclocker\"\r\n      ],\r\n      \"state\" : \"SUCCESS\",\r\n      \"start_time\" : \"2019-05-03T19:33:20.166Z\",\r\n      \"start_time_in_millis\" : 1556912000166,\r\n      \"end_time\" : \"2019-05-03T19:33:28.478Z\",\r\n      \"end_time_in_millis\" : 1556912008478,\r\n      \"duration_in_millis\" : 8312,\r\n      \"failures\" : [ ],\r\n      \"shards\" : {\r\n        \"total\" : 5,\r\n        \"failed\" : 0,\r\n        \"successful\" : 5\r\n      }\r\n    },\r\n    {\r\n      \"snapshot\" : \"snapshot_2\",\r\n      \"uuid\" : \"wQD5j389QK2nHMoNKDCIwA\",\r\n      \"version_id\" : 5061199,\r\n      \"version\" : \"5.6.11\",\r\n      \"indices\" : [\r\n        \"doclocker\"\r\n      ],\r\n      \"state\" : \"PARTIAL\",\r\n      \"start_time\" : \"2019-05-03T19:35:59.364Z\",\r\n      \"start_time_in_millis\" : 1556912159364,\r\n      \"end_time\" : \"2019-05-03T19:35:59.627Z\",\r\n      \"end_time_in_millis\" : 1556912159627,\r\n      \"duration_in_millis\" : 263,\r\n      \"failures\" : [\r\n        {\r\n          \"index\" : \"doclocker\",\r\n          \"index_uuid\" : \"doclocker\",\r\n          \"shard_id\" : 0,\r\n          \"reason\" : \"IndexShardSnapshotFailedException[Failed to perform snapshot (index files)]; nested: FileAlreadyExistsException[blob [__0] already exists, cannot overwrite]; \",\r\n          \"node_id\" : \"9XnkBOa5Q3mUiHp1WvY5hQ\",\r\n          \"status\" : \"INTERNAL_SERVER_ERROR\"\r\n        },\r\n        {\r\n          \"index\" : \"doclocker\",\r\n          \"index_uuid\" : \"doclocker\",\r\n          \"shard_id\" : 2,\r\n          \"reason\" : \"IndexShardSnapshotFailedException[Failed to perform snapshot (index files)]; nested: FileAlreadyExistsException[blob [__0] already exists, cannot overwrite]; \",\r\n          \"node_id\" : \"cw3A2lK5SAOw1qQ2CY3sTw\",\r\n          \"status\" : \"INTERNAL_SERVER_ERROR\"\r\n        },\r\n        {\r\n          \"index\" : \"doclocker\",\r\n          \"index_uuid\" : \"doclocker\",\r\n          \"shard_id\" : 4,\r\n          \"reason\" : \"IndexShardSnapshotFailedException[Failed to perform snapshot (index files)]; nested: FileAlreadyExistsException[blob [__0] already exists, cannot overwrite]; \",\r\n          \"node_id\" : \"cw3A2lK5SAOw1qQ2CY3sTw\",\r\n          \"status\" : \"INTERNAL_SERVER_ERROR\"\r\n        },\r\n        {\r\n          \"index\" : \"doclocker\",\r\n          \"index_uuid\" : \"doclocker\",\r\n          \"shard_id\" : 1,\r\n          \"reason\" : \"IndexShardSnapshotFailedException[Failed to perform snapshot (index files)]; nested: FileAlreadyExistsException[blob [__0] already exists, cannot overwrite]; \",\r\n          \"node_id\" : \"9XnkBOa5Q3mUiHp1WvY5hQ\",\r\n          \"status\" : \"INTERNAL_SERVER_ERROR\"\r\n        },\r\n        {\r\n          \"index\" : \"doclocker\",\r\n          \"index_uuid\" : \"doclocker\",\r\n          \"shard_id\" : 3,\r\n          \"reason\" : \"IndexShardSnapshotFailedException[Failed to perform snapshot (index files)]; nested: FileAlreadyExistsException[blob [__0] already exists, cannot overwrite]; \",\r\n          \"node_id\" : \"9XnkBOa5Q3mUiHp1WvY5hQ\",\r\n          \"status\" : \"INTERNAL_SERVER_ERROR\"\r\n        }\r\n      ],\r\n      \"shards\" : {\r\n        \"total\" : 5,\r\n        \"failed\" : 5,\r\n        \"successful\" : 0\r\n      }\r\n    }","closed_by":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"performed_via_github_app":null}