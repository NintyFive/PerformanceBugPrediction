[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169342010","html_url":"https://github.com/elastic/elasticsearch/issues/15768#issuecomment-169342010","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15768","id":169342010,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTM0MjAxMA==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T14:46:27Z","updated_at":"2016-01-06T14:46:27Z","author_association":"CONTRIBUTOR","body":"I'll try to tackle this ... it doesn't look too hard, given the changes in #14121 which already begins separate \"write indexing buffer to disk\" from \"refresh\".\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169419465","html_url":"https://github.com/elastic/elasticsearch/issues/15768#issuecomment-169419465","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15768","id":169419465,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTQxOTQ2NQ==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T18:56:38Z","updated_at":"2016-01-06T18:56:38Z","author_association":"CONTRIBUTOR","body":"Note that with this change, a refresh only happens when the user expects it to: on the periodic (default: every 1 second) interval, or when refresh API is explicitly invoked.\n\nBut this is a biggish change to ES's behavior vs today, e.g. `flush`, `forceMerge`, moving indexing buffers to disk because they are too big, etc. does NOT refresh, and a good number of tests are angry because of this ... so I'm slowly inserting `refresh()` for such tests.\n\nIt also has implications for transient disk usage, since ES will \"secretly\" refresh less often, meaning we hold segments, which may now be merged or deleted, open for longer.  Users who disable `refresh_interval` (set to -1) need to be careful to invoke refresh API at important times (after `flush` or `forceMerge`).\n\nStill I think it is important we make ES's semantics/behavior crisp and well defined: `refresh`, and `refresh` alone, makes recent index changes visible to searches.  No other operation should do this as an \"accidental\" side effect.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169423766","html_url":"https://github.com/elastic/elasticsearch/issues/15768#issuecomment-169423766","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15768","id":169423766,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTQyMzc2Ng==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T19:11:02Z","updated_at":"2016-01-06T19:11:02Z","author_association":"MEMBER","body":"Just a note - since ES moves shard around on it’s own will, if we want to support this, we’ll have to make sure shard relocation (i.e., copy all the files) maintains this semantics. This will be tricky for many reasons - for example, the user may issue a refresh command when the target shard is not yet ready to receive it (engine closed). Today we refresh the target at the end of every recovery for this reason.  Have a “refresh when I say and only when I say” is much more complicated then the current “refresh at least when I say” (but whenever you want as well) semantics. I’m not sure it’s worth the complexity imho.\n\n> On 06 Jan 2016, at 19:56, Michael McCandless notifications@github.com wrote:\n> \n> Note that with this change, a refresh only happens when the user expects it to: on the periodic (default: every 1 second) interval, or when refresh API is explicitly invoked.\n> \n> But this is a biggish change to ES's behavior vs today, e.g. flush, forceMerge, moving indexing buffers to disk because they are too big, etc. does NOT refresh, and a good number of tests are angry because of this ... so I'm slowly inserting refresh() for such tests.\n> \n> It also has implications for transient disk usage, since ES will \"secretly\" refresh less often, meaning we hold segments, which may now be merged or deleted, open for longer. Users who disable refresh_interval (set to -1) need to be careful to invoke refresh API at important times (after flush or forceMerge).\n> \n> Still I think it is important we make ES's semantics/behavior crisp and well defined: refresh, and refresh alone, makes recent index changes visible to searches. No other operation should do this as an \"accidental\" side effect.\n> \n> —\n> Reply to this email directly or view it on GitHub.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169485486","html_url":"https://github.com/elastic/elasticsearch/issues/15768#issuecomment-169485486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15768","id":169485486,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTQ4NTQ4Ng==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T22:40:34Z","updated_at":"2016-01-06T22:40:34Z","author_association":"CONTRIBUTOR","body":"Thanks @bleskes, I agree this is too difficult to achieve \"perfectly\", and I think recovery should be unchanged here (refresh when the shard is done recovering).\n\nSimilarly, primary and each replica are in general searching slightly different of a shard today, i.e. when each refreshes every 1s by default, it's a different set of indexed docs that become visible, in general.\n\nFile-based replication would make this easier ;)\n\nSo I think those should remain out of scope, here, and we should still state that ES is a \"refresh at least when I say\", but with this issue \"less often when I don't say\" than today.\n\nOr are you saying we shouldn't even try to make any change here, i.e. leave the engine doing a normal search-visible refresh when e.g. it wants to free up heap used by version map?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/170678499","html_url":"https://github.com/elastic/elasticsearch/issues/15768#issuecomment-170678499","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15768","id":170678499,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MDY3ODQ5OQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-01-11T20:22:12Z","updated_at":"2016-01-11T20:22:12Z","author_association":"CONTRIBUTOR","body":"> So I think those should remain out of scope, here, and we should still state that ES is a \"refresh at least when I say\", but with this issue \"less often when I don't say\" than today.\n\n+1 to this - I think for the replication case we should refresh since we have to but for stuff like clearing version maps etc. we can improve the situation.\n","performed_via_github_app":null}]