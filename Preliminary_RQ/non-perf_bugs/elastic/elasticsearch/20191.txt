{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20191","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20191/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20191/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20191/events","html_url":"https://github.com/elastic/elasticsearch/issues/20191","id":173581461,"node_id":"MDU6SXNzdWUxNzM1ODE0NjE=","number":20191,"title":"The slash char in the document that may lead to unexpected result","user":{"login":"leftstar","id":6150360,"node_id":"MDQ6VXNlcjYxNTAzNjA=","avatar_url":"https://avatars1.githubusercontent.com/u/6150360?v=4","gravatar_id":"","url":"https://api.github.com/users/leftstar","html_url":"https://github.com/leftstar","followers_url":"https://api.github.com/users/leftstar/followers","following_url":"https://api.github.com/users/leftstar/following{/other_user}","gists_url":"https://api.github.com/users/leftstar/gists{/gist_id}","starred_url":"https://api.github.com/users/leftstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leftstar/subscriptions","organizations_url":"https://api.github.com/users/leftstar/orgs","repos_url":"https://api.github.com/users/leftstar/repos","events_url":"https://api.github.com/users/leftstar/events{/privacy}","received_events_url":"https://api.github.com/users/leftstar/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-08-27T06:37:26Z","updated_at":"2016-08-29T12:36:26Z","closed_at":"2016-08-29T12:36:26Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**:\nNewest\n\n**Plugins installed**: []\nNone\n\n**JVM version**:\n\n**OS version**:\nRedhat Linux\n\n**Description of the problem including expected versus actual behavior**:\nI want to got the sum for each type of downloads field. That totally likes \"select sum(num) from Table group by downloads\" in mysql db.\n\nFor now, My document in Index likes the following:\n{\n    \"_index\": \"sino-564dbf686a67a515-87ae118af4eb61b8-day\",\n    \"_type\": \"downloads\",\n    \"_id\": \"AVbKDizkMS2EvdplxWkF\",\n    \"_score\": 4.1279697,\n    \"_source\": {\n       \"downloads\": \"/data/attachment/file/20130820/Sinogrid1.pdf\",\n       \"date\": 20160826,\n       \"num\": 1\n    }\n },\n {\n    \"_index\": \"sino-564dbf686a67a515-87ae118af4eb61b8-day\",\n    \"_type\": \"downloads\",\n    \"_id\": \"AVbKkkYaMS2EvdplxpFh\",\n    \"_score\": 4.1279697,\n    \"_source\": {\n       \"downloads\": \"/data/attachment/file/20130820/Sinogrid2.pdf\",\n       \"date\": 20160826,\n       \"num\": 1\n    }\n },\n {\n    \"_index\": \"sino-564dbf686a67a515-87ae118af4eb61b8-day\",\n    \"_type\": \"downloads\",\n    \"_id\": \"AVbKkhA3MS2EvdplxpFg\",\n    \"_score\": 3.8407266,\n    \"_source\": {\n       \"downloads\": \"/data/attachment/file/20130820/Sinogrid2.pdf\",\n       \"date\": 20160826,\n       \"num\": 3\n    }\n },\n\nThen, I'd like to search the sum count for each type of downloads filed. my expected return should be like this:\n/data/attachment/file/20130820/Sinogrid1.pdf       1\n/data/attachment/file/20130820/Sinogrid2.pdf       4\n\nMy search:\nGET /day/downloads/_search\n{\n    \"aggs\": {\n        \"res\": {\n            \"terms\": {\n                \"field\": \"downloads\"\n            },\n            \"aggs\": {\n                \"sum\": {\n                    \"sum\": {\n                        \"field\": \"num\"\n                    }\n                }\n            }\n        }\n    }\n}\n\nBut the return data is : \n\"aggregations\": {\n      \"res\": {\n         \"doc_count_error_upper_bound\": 0,\n         \"sum_other_doc_count\": 64,\n         \"buckets\": [\n            {\n               \"key\": \"attachment\",\n               \"doc_count\": 75,\n               \"sum\": {\n                  \"value\": 109\n               }\n            },\n            {\n               \"key\": \"data\",\n               \"doc_count\": 75,\n               \"sum\": {\n                  \"value\": 109\n               }\n            },\n            {\n               \"key\": \"file\",\n               \"doc_count\": 75,\n               \"sum\": {\n                  \"value\": 109\n               }\n            },\n            {\n               \"key\": \"pdf\",\n               \"doc_count\": 72,\n               \"sum\": {\n                  \"value\": 106\n               }\n            },\n            {\n               \"key\": \"20130820\",\n               \"doc_count\": 46,\n               \"sum\": {\n                  \"value\": 58\n               }\n            },\n            {\n               \"key\": \"sinogrid2\",\n               \"doc_count\": 12,\n               \"sum\": {\n                  \"value\": 35\n               }\n            },\n            {\n               \"key\": \"20131212\",\n               \"doc_count\": 11,\n               \"sum\": {\n                  \"value\": 34\n               }\n            },\n            {\n               \"key\": \"sinogrid10\",\n               \"doc_count\": 9,\n               \"sum\": {\n                  \"value\": 18\n               }\n            },\n            {\n               \"key\": \"20131119\",\n               \"doc_count\": 5,\n               \"sum\": {\n                  \"value\": 5\n               }\n            },\n            {\n               \"key\": \"sinogrid1\",\n               \"doc_count\": 5,\n               \"sum\": {\n                  \"value\": 5\n               }\n            }\n         ]\n      }\n\nYou can see that my downloads fields was separated by default.\nis it a issue? or any help on it?\n\n**Steps to reproduce**:\n 1.\n 2.\n 3.\n\n**Provide logs (if relevant)**:\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n\n**Describe the feature**:\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}