{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10340","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10340/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10340/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10340/events","html_url":"https://github.com/elastic/elasticsearch/issues/10340","id":65430254,"node_id":"MDU6SXNzdWU2NTQzMDI1NA==","number":10340,"title":"Possible bug with recovery and gateway.expected_nodes after process restart on ES 1.4.4","user":{"login":"mbarrin","id":1845655,"node_id":"MDQ6VXNlcjE4NDU2NTU=","avatar_url":"https://avatars2.githubusercontent.com/u/1845655?v=4","gravatar_id":"","url":"https://api.github.com/users/mbarrin","html_url":"https://github.com/mbarrin","followers_url":"https://api.github.com/users/mbarrin/followers","following_url":"https://api.github.com/users/mbarrin/following{/other_user}","gists_url":"https://api.github.com/users/mbarrin/gists{/gist_id}","starred_url":"https://api.github.com/users/mbarrin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbarrin/subscriptions","organizations_url":"https://api.github.com/users/mbarrin/orgs","repos_url":"https://api.github.com/users/mbarrin/repos","events_url":"https://api.github.com/users/mbarrin/events{/privacy}","received_events_url":"https://api.github.com/users/mbarrin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-03-31T11:25:01Z","updated_at":"2015-04-01T15:03:30Z","closed_at":"2015-04-01T15:03:30Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nWe are running `Elasticsearch` `1.4.4` on `Java(TM) SE Runtime Environment (build 1.7.0_60-b19)`\n\nWe have a cluster with 15 nodes: 3 master, 3 client, 9 data.\n\nAll the config files have:\n\n``` yaml\ngateway.expected_nodes: 15\n```\n\nBased on the reading of my documentation this should actually be 12, as expected nodes only counts `master` and `data` nodes. So in our case it should never be hitting expected nodes. As we would only have 12 total for the sake of this setting.\n\nSo when we restart a `data` node process, the cluster should be at 11 or 14 of the expected nodes. Either way less than 15.\n\nThe documentation states that: `Setting gateway.expected_nodes also defaults gateway.recovery_after_time to 5m`. And we don't define a value for this in our config file\n\nSo if I am not mistaken when we reboot a node it should never hit the 15 expected nodes and it should wait 5 minutes for recovery. However what we are noticing is that reallocation of the shards is happening immediately.\n\neg. the moment data1 stops, its shards are being being assigned to other nodes in the cluster, it is not waiting for 5 minutes, or for the expected number of nodes.\n\nI believe this is a bug and thought I should submit.\n","closed_by":{"login":"mbarrin","id":1845655,"node_id":"MDQ6VXNlcjE4NDU2NTU=","avatar_url":"https://avatars2.githubusercontent.com/u/1845655?v=4","gravatar_id":"","url":"https://api.github.com/users/mbarrin","html_url":"https://github.com/mbarrin","followers_url":"https://api.github.com/users/mbarrin/followers","following_url":"https://api.github.com/users/mbarrin/following{/other_user}","gists_url":"https://api.github.com/users/mbarrin/gists{/gist_id}","starred_url":"https://api.github.com/users/mbarrin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbarrin/subscriptions","organizations_url":"https://api.github.com/users/mbarrin/orgs","repos_url":"https://api.github.com/users/mbarrin/repos","events_url":"https://api.github.com/users/mbarrin/events{/privacy}","received_events_url":"https://api.github.com/users/mbarrin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}