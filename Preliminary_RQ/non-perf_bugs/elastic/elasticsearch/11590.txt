{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11590","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11590/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11590/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11590/events","html_url":"https://github.com/elastic/elasticsearch/issues/11590","id":87113631,"node_id":"MDU6SXNzdWU4NzExMzYzMQ==","number":11590,"title":"Recovering from \"Could not find a state file to recover\" automatically","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":152510590,"node_id":"MDU6TGFiZWwxNTI1MTA1OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Recovery","name":":Distributed/Recovery","color":"0e8a16","default":false,"description":"Anything around constructing a new shard, either from a local or a remote source."},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-06-10T21:28:48Z","updated_at":"2016-01-18T20:18:55Z","closed_at":"2016-01-18T20:18:55Z","author_association":"MEMBER","active_lock_reason":null,"body":"Have a scenario where the user upgraded (to 1.5.2) and downgraded and re-upgraded multiple times, and shards are showing the following exceptions:\n\n```\nCaused by: org.elasticsearch.ElasticsearchIllegalStateException: Could not find a state file to recover from among [[id:21, legacy:false, file:/opt/something/data/elasticsearch/data/cluster_name/nodes/0/indices/index_name/1/_state/state-21.st], [id:29, legacy:true, file:/opt/something/data/elasticsearch/data/cluster_name/nodes/0/indices/index_name/1/_state/state-29]]\n```\n\nWhile they can workaround this by moving the state file without the .st out of the shard directories, this can cause other issues if the user is not careful (eg. if they have a large number of shards affected and script it to move the files without .st out of the directory and end up moving the only state file out in some cases). \n\nIt will be nice for the product to handle this workaround automatically without manual intervention and gracefully recover.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}