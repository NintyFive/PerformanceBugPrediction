{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3137","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3137/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3137/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3137/events","html_url":"https://github.com/elastic/elasticsearch/issues/3137","id":15152398,"node_id":"MDU6SXNzdWUxNTE1MjM5OA==","number":3137,"title":"elasticsearch highlights entire word instead of just the query when ngram filter is used","user":{"login":"ike-bloomfire","id":1649685,"node_id":"MDQ6VXNlcjE2NDk2ODU=","avatar_url":"https://avatars0.githubusercontent.com/u/1649685?v=4","gravatar_id":"","url":"https://api.github.com/users/ike-bloomfire","html_url":"https://github.com/ike-bloomfire","followers_url":"https://api.github.com/users/ike-bloomfire/followers","following_url":"https://api.github.com/users/ike-bloomfire/following{/other_user}","gists_url":"https://api.github.com/users/ike-bloomfire/gists{/gist_id}","starred_url":"https://api.github.com/users/ike-bloomfire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ike-bloomfire/subscriptions","organizations_url":"https://api.github.com/users/ike-bloomfire/orgs","repos_url":"https://api.github.com/users/ike-bloomfire/repos","events_url":"https://api.github.com/users/ike-bloomfire/events{/privacy}","received_events_url":"https://api.github.com/users/ike-bloomfire/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":18,"created_at":"2013-06-05T03:32:08Z","updated_at":"2016-03-08T17:58:34Z","closed_at":"2013-06-06T06:52:59Z","author_association":"NONE","active_lock_reason":null,"body":"when using an nGram filter on a field or index, if you try to highlight said field (or a field in an index that has an nGram filter defined on it, in search results, elasticsearch highlights the entire word instead of just the query.\n\nso if I have the text \"American\" and I search for \"rican\"\nhighlighting should look like this ----> Ame **rican**\nbut instead it does this ---> **American**\n\nTo see this in action just follow the instructions here http://stackoverflow.com/a/15005321/141822\nyou get this output, which is clearly wrong\n\n```\n{\n  \"took\" : 11,\n  \"timed_out\" : false,\n    \"_shards\" : {\n      \"total\" : 1,\n      \"successful\" : 1,\n      \"failed\" : 0\n    },\n    \"hits\" : {\n      \"total\" : 3,\n      \"max_score\" : 0.71231794,\n      \"hits\" : [ {\n        \"_index\" : \"myindex\",\n        \"_type\" : \"product\",\n        \"_id\" : \"0KyaIB8xRmqE-g0hl0ky6g\",\n        \"_score\" : 0.71231794,\n        \"fields\" : {\n         \"code\" : \"Samsung Galaxy i7500\"\n        },\n        \"highlight\" : {\n          \"code.ngram\" : [ \"<em>Samsung Galaxy i7500</em>\" ],\n          \"code\" : [ \"<em>Samsung Galaxy i7500</em>\" ]\n        }\n      }, {\n        \"_index\" : \"myindex\",\n        \"_type\" : \"product\",\n       \"_id\" : \"vZwpcBu0QAyGmP9LHz1hUA\",\n       \"_score\" : 0.71231794,\n        \"fields\" : {\n          \"code\" : \"Samsung Galaxy 5 Europa\"\n        },\n        \"highlight\" : {\n          \"code.ngram\" : [ \"<em>Samsung Galaxy 5 Europa</em>\" ],\n          \"code\" : [ \"<em>Samsung Galaxy 5 Europa</em>\" ]\n        }\n      }, {\n        \"_index\" : \"myindex\",\n        \"_type\" : \"product\",\n        \"_id\" : \"7sNkZAlxSlmuLZA9S68bvg\",\n        \"_score\" : 0.71231794,\n        \"fields\" : {\n          \"code\" : \"Samsung Galaxy Mini\"\n        },\n        \"highlight\" : {\n          \"code.ngram\" : [ \"<em>Samsung Galaxy Mini</em>\" ],\n          \"code\" : [ \"<em>Samsung Galaxy Mini</em>\" ]\n        }\n      } ]\n    }\n  }\n```\n\nWith the whitespace tokenizer (vs keyword tokenizer in this case), it highlights just the word with the match in it, which is still not expected behavior\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}