[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518757256","html_url":"https://github.com/elastic/elasticsearch/issues/45250#issuecomment-518757256","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45250","id":518757256,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc1NzI1Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:02:10Z","updated_at":"2019-08-06T17:02:10Z","author_association":"MEMBER","body":"It looks like it's the security index that is unavailable. Are you waiting until the cluster is green before you start firing requests after it bootstraps for the first time?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518760696","html_url":"https://github.com/elastic/elasticsearch/issues/45250#issuecomment-518760696","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45250","id":518760696,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc2MDY5Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:11:27Z","updated_at":"2019-08-06T17:11:27Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518773477","html_url":"https://github.com/elastic/elasticsearch/issues/45250#issuecomment-518773477","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45250","id":518773477,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3MzQ3Nw==","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:46:52Z","updated_at":"2019-08-06T17:46:52Z","author_association":"MEMBER","body":"All integration tests wait for yellow but this particular request was issued after the node had been running for a while:\r\n\r\n```\r\n[2019-08-06T16:05:11,694][INFO ][o.e.n.Node               ] [xpack-node-6a4cb29200] started\r\n[2019-08-06T04:05:11,704][INFO ][Managed Elasticsearch    ]  {ValidateRunningVersion} validating the cluster is running the requested version: 7.0.0\r\n[2019-08-06T04:05:11,706][INFO ][Managed Elasticsearch    ]  {Call} [https://localhost:9200/_cat/nodes?h=version&pretty=true] SSL: True Security: True\r\n[2019-08-06T16:05:12,466][INFO ][o.e.c.m.MetaDataIndexTemplateService] [xpack-node-6a4cb29200] adding template [.watches] for index patterns [.watches*]\r\n[2019-08-06T16:05:12,653][INFO ][o.e.c.m.MetaDataIndexTemplateService] [xpack-node-6a4cb29200] adding template [.watch-history-9] for index patterns [.watcher-history-9*]\r\n[2019-08-06T16:05:12,919][INFO ][o.e.c.m.MetaDataIndexTemplateService] [xpack-node-6a4cb29200] adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-7-*]\r\n[2019-08-06T04:05:13,079][INFO ][Managed Elasticsearch    ]  {ValidateClusterStateTask} waiting cluster to go into yellow health state\r\n[2019-08-06T04:05:13,080][INFO ][Managed Elasticsearch    ]  {Call} [https://localhost:9200/_cluster/health?wait_for_status=yellow&timeout=20s&pretty=true] SSL: True Security: True\r\n[2019-08-06T16:05:13,184][INFO ][o.e.c.m.MetaDataIndexTemplateService] [xpack-node-6a4cb29200] adding template [.monitoring-es] for index patterns [.monitoring-es-7-*]\r\n[2019-08-06T04:05:13,226][INFO ][Managed Elasticsearch    ]  {PostLicenseTask} no license file available to post\r\n[2019-08-06T04:05:13,227][INFO ][Managed Elasticsearch    ]  {PostLicenseTask} attempt to start trial license\r\n[2019-08-06T04:05:13,228][INFO ][Managed Elasticsearch    ]  {Call} [https://localhost:9200/_xpack/license/start_trial?acknowledge=true&pretty=true] SSL: True Security: True\r\n[2019-08-06T16:05:13,344][INFO ][o.e.c.m.MetaDataIndexTemplateService] [xpack-node-6a4cb29200] adding template [.monitoring-beats] for index patterns [.monitoring-beats-7-*]\r\n[2019-08-06T16:05:13,437][INFO ][o.e.c.m.MetaDataIndexTemplateService] [xpack-node-6a4cb29200] adding template [.monitoring-alerts-7] for index patterns [.monitoring-alerts-7]\r\n[2019-08-06T16:05:13,516][INFO ][o.e.c.m.MetaDataIndexTemplateService] [xpack-node-6a4cb29200] adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-7-*]\r\n[2019-08-06T16:05:13,984][INFO ][o.e.l.LicenseService     ] [xpack-node-6a4cb29200] license [c65e72c4-243d-4175-8ef9-bcc37f58d384] mode [basic] - valid\r\n[2019-08-06T16:05:13,984][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [xpack-node-6a4cb29200] adding index lifecycle policy [watch-history-ilm-policy]\r\n[2019-08-06T16:05:14,361][INFO ][o.e.l.LicenseService     ] [xpack-node-6a4cb29200] license [38365b5a-8320-4c61-8c0d-4517b7dd62eb] mode [trial] - valid\r\n[2019-08-06T04:05:14,372][INFO ][Managed Elasticsearch    ]  {ValidateLicenseTask} validating the x-pack license is active\r\n[2019-08-06T04:05:14,374][INFO ][Managed Elasticsearch    ]  {Call} [https://localhost:9200/_xpack/license?filter_path=license.type&pretty=true] SSL: True Security: True\r\n[2019-08-06T04:05:14,507][INFO ][Managed Elasticsearch    ]  {Call} [https://localhost:9200/_xpack/license?filter_path=license.status&pretty=true] SSL: True Security: True\r\n[2019-08-06T04:05:14,564][INFO ][Managed Elasticsearch    ]  All good! kicking off [XPackCluster] tests now\r\n```\r\n\r\nMessages with `section` `[Managed Elasticsearch    ]` originate from our test bootstrap.\r\n\r\n\r\nAfter a bunch of tests have already run I see the following:\r\n\r\n```\r\n[2019-08-06T16:05:22,245][INFO ][o.e.x.s.s.SecurityIndexManager] [xpack-node-6a4cb29200] security index does not exist. Creating [.security-7] with alias [.security]\r\n[2019-08-06T16:05:22,339][INFO ][o.e.c.m.MetaDataCreateIndexService] [xpack-node-6a4cb29200] [.watches] creating index, cause [auto(bulk api)], templates [.watches, nest_tests], shards [1]/[0], mappings [_doc]\r\n[xUnit.net 00:10:47.3430471]     Tests.XPack.CrossClusterReplication.CrossClusterReplicationAutoFollowTests.GlobalStatsResponse [SKIP]\r\n[xUnit.net 00:10:47.3441663]     Tests.XPack.CrossClusterReplication.CrossClusterReplicationAutoFollowTests.GetReturnsAndIsMapped [SKIP]\r\nSkipped  Tests.XPack.CrossClusterReplication.CrossClusterReplicationAutoFollowTests.GlobalStatsResponse\r\nSkipped  Tests.XPack.CrossClusterReplication.CrossClusterReplicationAutoFollowTests.GetReturnsAndIsMapped\r\n[xUnit.net 00:10:47.3460528]     Tests.XPack.CrossClusterReplication.CrossClusterReplicationAutoFollowTests.DeleteIsAcked [SKIP]\r\n[xUnit.net 00:10:47.3471173]     Tests.XPack.CrossClusterReplication.CrossClusterReplicationAutoFollowTests.CreateIsAcked [SKIP]\r\nSkipped  Tests.XPack.CrossClusterReplication.CrossClusterReplicationAutoFollowTests.DeleteIsAcked\r\nSkipped  Tests.XPack.CrossClusterReplication.CrossClusterReplicationAutoFollowTests.CreateIsAcked\r\n[2019-08-06T16:05:23,679][INFO ][o.e.c.m.MetaDataMappingService] [xpack-node-6a4cb29200] [.security-7/h2cIl6qtR1qYPi-mU4976Q] update_mapping [_doc]\r\n[2019-08-06T16:05:23,992][INFO ][o.e.c.r.a.AllocationService] [xpack-node-6a4cb29200] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[.watches][0]] ...]).\r\n[2019-08-06T16:05:24,382][INFO ][o.e.x.w.WatcherService   ] [xpack-node-6a4cb29200] reloading watcher, reason [new local watcher shard allocation ids], cancelled [0] queued tasks\r\n[2019-08-06T16:05:24,395][INFO ][o.e.c.m.MetaDataMappingService] [xpack-node-6a4cb29200] [.security-7/h2cIl6qtR1qYPi-mU4976Q] update_mapping [_doc]\r\n[2019-08-06T16:05:24,411][INFO ][o.e.c.m.MetaDataMappingService] [xpack-node-6a4cb29200] [.security-7/h2cIl6qtR1qYPi-mU4976Q] update_mapping [_doc]\r\n[2019-08-06T16:05:24,770][INFO ][o.e.x.s.a.u.TransportPutUserAction] [xpack-node-6a4cb29200] added user [nest-fluentasync-43e6e58d]\r\n[2019-08-06T16:05:24,889][INFO ][o.e.c.m.MetaDataMappingService] [xpack-node-6a4cb29200] [.watches/tu3M-9Y4SlKJnA6Xoual2w] update_mapping [_doc]\r\n[2019-08-06T16:05:25,537][INFO ][o.e.x.s.a.u.TransportPutUserAction] [xpack-node-6a4cb29200] added user [nest-initializer-ec7fe32f]\r\n[2019-08-06T16:05:26,521][INFO ][o.e.x.s.a.u.TransportPutUserAction] [xpack-node-6a4cb29200] added user [nest-initializerasync-0c722209]\r\n[2019-08-06T16:05:26,974][INFO ][o.e.c.m.MetaDataMappingService] [xpack-node-6a4cb29200] [.security-7/h2cIl6qtR1qYPi-mU4976Q] update_mapping [_doc]\r\n[2019-08-06T16:05:27,161][INFO ][o.e.x.s.a.r.TransportPutRoleAction] [xpack-node-6a4cb29200] added role [role-f-ee1d0ee8]\r\n[2019-08-06T16:05:27,193][INFO ][o.e.c.m.MetaDataCreateIndexService] [xpack-node-6a4cb29200] [test] creating index, cause [auto(bulk api)], templates [nest_tests], shards [2]/[0], mappings []\r\n[2019-08-06T16:05:27,333][INFO ][o.e.x.s.a.u.TransportPutUserAction] [xpack-node-6a4cb29200] added user [nest-fluent-1ca3f063]\r\n[xUnit.net 00:10:51.8810514]     Tests.XPack.Info.XPackInfoApiTests.XPackUsageResponse [FAIL]\r\n```\r\n\r\nThe first line indicate a new `.secuity` index being created but the tests does not fail till a a couple of seconds later.\r\n\r\n\r\nThis is a single node on 7.0.0, hardware unknown (azure devops worker node).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518773815","html_url":"https://github.com/elastic/elasticsearch/issues/45250#issuecomment-518773815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45250","id":518773815,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODc3MzgxNQ==","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T17:47:49Z","updated_at":"2019-08-06T17:47:49Z","author_association":"MEMBER","body":"Should mention we wait for yellow once at the start of the test run after the node has started. We do not wait for yellow before every single test.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518839425","html_url":"https://github.com/elastic/elasticsearch/issues/45250#issuecomment-518839425","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45250","id":518839425,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODgzOTQyNQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-08-06T20:52:27Z","updated_at":"2019-08-06T20:52:27Z","author_association":"MEMBER","body":"I think that Elasticsearch is doing the right thing here. You are trying to collect usage stats. Collecting usage stats involves collecting usage from stats from the realms, including the native realm. That involves collecting user counts from the native users store. If the security index isn't available, then we can't return the native user count. I don't think we should return partial results, I think we should fail the request, as is being done here. I think that you need to adapt your CI appropriately.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/518991992","html_url":"https://github.com/elastic/elasticsearch/issues/45250#issuecomment-518991992","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45250","id":518991992,"node_id":"MDEyOklzc3VlQ29tbWVudDUxODk5MTk5Mg==","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2019-08-07T08:14:34Z","updated_at":"2019-08-07T08:14:34Z","author_association":"MEMBER","body":"I am happy to change my CI to deal with potential failures due to the security index not being available. \r\n\r\nI do want to report this happens reasonably often and affects other API's too such as the [`Create API key API`](https://www.elastic.co/guide/en/elasticsearch/reference/current/security-api-create-api-key.html) which internally does a `_search` first as well. \r\n\r\nWould it be helpful for these to internally to wait for yellow? ","performed_via_github_app":null}]