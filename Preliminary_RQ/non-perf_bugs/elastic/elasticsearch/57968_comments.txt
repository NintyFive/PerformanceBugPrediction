[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/642396697","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-642396697","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":642396697,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjM5NjY5Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T04:20:06Z","updated_at":"2020-06-11T04:20:06Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features (:Core/Features/Ingest)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/642396767","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-642396767","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":642396767,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjM5Njc2Nw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T04:20:25Z","updated_at":"2020-06-11T04:20:25Z","author_association":"CONTRIBUTOR","body":"CC: @ruflin ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/642592300","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-642592300","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":642592300,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjU5MjMwMA==","user":{"login":"ruflin","id":244900,"node_id":"MDQ6VXNlcjI0NDkwMA==","avatar_url":"https://avatars3.githubusercontent.com/u/244900?v=4","gravatar_id":"","url":"https://api.github.com/users/ruflin","html_url":"https://github.com/ruflin","followers_url":"https://api.github.com/users/ruflin/followers","following_url":"https://api.github.com/users/ruflin/following{/other_user}","gists_url":"https://api.github.com/users/ruflin/gists{/gist_id}","starred_url":"https://api.github.com/users/ruflin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruflin/subscriptions","organizations_url":"https://api.github.com/users/ruflin/orgs","repos_url":"https://api.github.com/users/ruflin/repos","events_url":"https://api.github.com/users/ruflin/events{/privacy}","received_events_url":"https://api.github.com/users/ruflin/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T11:48:55Z","updated_at":"2020-06-11T11:48:55Z","author_association":"CONTRIBUTOR","body":"@exekias @andresrc This is relevant for our discussion to potentially use a \"routing\" ingest pipeline.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/653581230","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-653581230","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":653581230,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzU4MTIzMA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-07-03T14:46:57Z","updated_at":"2020-07-03T14:46:57Z","author_association":"MEMBER","body":"I think we should aim to keep logic of executing pipelines after the _index has been changed simple.\r\n\r\nPrior to performing ingest, a list of pipelines is determined. These pipelines are executed. If\r\nat the end the `_index` has been changed then only the final pipeline of this index (if exists) should\r\nbe executed.\r\n\r\n> if the default_pipeline redirects to a new index, should we still execute the final_pipeline of the original index?\r\n\r\nGiven with the above logic, yes.\r\n\r\n> should we execute the default_pipeline of the new destination, or just the final_pipeline?\r\n\r\nI think only the final pipeline should be executed.\r\n\r\n> how do we prevent the document from being infinitely redirected between indices (could we set a rule that the pipeline of the destination index may not change the destination a second time?)\r\n\r\nI think it is fine if request or default pipelines change the index. However I think that final pipelines shouldn't be changing the index. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/654966965","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-654966965","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":654966965,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDk2Njk2NQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-07-07T16:08:18Z","updated_at":"2020-07-07T16:08:18Z","author_association":"MEMBER","body":"We discussed this issue with a broader audience and think that the re-execution logic of pipeline should be limited:\r\n\r\n* When a final pipeline is executed, it always should be the last pipeline being executed. Also the fact that a final pipeline can change the `_index` key during ingest is a bug, which needs to be addressed.\r\n* If the request pipeline changes the `_index` then this changes the default pipeline and final pipeline to be executed based on whether the new index has a default or final pipeline. If the original index was configured with a default or final pipeline, then these pipelines aren't executed.\r\n* If the default pipeline changes the `_index` then it changes the final pipeline. If there is a final pipeline for the original index then that pipeline isn't executed and if there is a final for the new index then that pipeline is executed. \r\n\r\nThe above restrictions would avoid infinitely redirections between pipelines.\r\n\r\n@ruflin @tvernum What do you think about this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/655246159","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-655246159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":655246159,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTI0NjE1OQ==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2020-07-08T02:38:31Z","updated_at":"2020-07-08T02:38:31Z","author_association":"CONTRIBUTOR","body":"Just to check: In the current proposal, if a default pipeline redirects to another index then the default pipeline on that new destination index would not be executed. Is that correct?\r\n\r\nI do wonder whether that works for Ingest Manager - My understanding is that they use both default and final pipelines, and would want to rely on both being executed after routing to a new index.\r\nPerhaps they could use the `pipeline` processor to work around that, but that assumes that the routing process knows which  pipelines it needs to execute.\r\nMay be could introduce an option on the pipeline processor to lookup the default pipeline for an index and execute that... as long as there's some way for Ingest Manager/Fleet to say \"please execute the default pipeline on the new destination index\", even if it needs to be explicit.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/655364095","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-655364095","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":655364095,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NTM2NDA5NQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-07-08T08:13:19Z","updated_at":"2020-07-08T08:13:19Z","author_association":"MEMBER","body":"> In the current proposal, if a default pipeline redirects to another index then the default pipeline on that new destination index would not be executed. Is that correct?\r\n\r\nYes, that is the idea.\r\n\r\n> I do wonder whether that works for Ingest Manager\r\n\r\n@ruflin Can you comment on whether the proposal works for ingest manager?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/656086527","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-656086527","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":656086527,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NjA4NjUyNw==","user":{"login":"ph","id":640,"node_id":"MDQ6VXNlcjY0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/640?v=4","gravatar_id":"","url":"https://api.github.com/users/ph","html_url":"https://github.com/ph","followers_url":"https://api.github.com/users/ph/followers","following_url":"https://api.github.com/users/ph/following{/other_user}","gists_url":"https://api.github.com/users/ph/gists{/gist_id}","starred_url":"https://api.github.com/users/ph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ph/subscriptions","organizations_url":"https://api.github.com/users/ph/orgs","repos_url":"https://api.github.com/users/ph/repos","events_url":"https://api.github.com/users/ph/events{/privacy}","received_events_url":"https://api.github.com/users/ph/received_events","type":"User","site_admin":false},"created_at":"2020-07-09T12:02:17Z","updated_at":"2020-07-09T12:02:17Z","author_association":"MEMBER","body":"@martijnvg Looking at your proposal I think this makes sense. @andresrc and @exekias do this still work in the routing idea? I think so.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/658218099","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-658218099","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":658218099,"node_id":"MDEyOklzc3VlQ29tbWVudDY1ODIxODA5OQ==","user":{"login":"roncohen","id":744,"node_id":"MDQ6VXNlcjc0NA==","avatar_url":"https://avatars0.githubusercontent.com/u/744?v=4","gravatar_id":"","url":"https://api.github.com/users/roncohen","html_url":"https://github.com/roncohen","followers_url":"https://api.github.com/users/roncohen/followers","following_url":"https://api.github.com/users/roncohen/following{/other_user}","gists_url":"https://api.github.com/users/roncohen/gists{/gist_id}","starred_url":"https://api.github.com/users/roncohen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roncohen/subscriptions","organizations_url":"https://api.github.com/users/roncohen/orgs","repos_url":"https://api.github.com/users/roncohen/repos","events_url":"https://api.github.com/users/roncohen/events{/privacy}","received_events_url":"https://api.github.com/users/roncohen/received_events","type":"User","site_admin":false},"created_at":"2020-07-14T14:37:09Z","updated_at":"2020-07-14T14:37:09Z","author_association":"NONE","body":"for ingest manager, since we control the pipelines, we could reasonably make the necessary adjustments to the final destination \"final\" pipelines to make this work. Sketching the solution out:\r\n- we have a \"generic\" data stream with a default/required pipeline that knows about the packages installed.\r\n- we send all data there, and the pipeline will redirect to other data streams by checking specific fields in the document that indicate which input/package they came from and changing `_index` accordingly\r\n- we have added the necessary parsing logic to the final pipelines of the data streams that they get directed to\r\n\r\nOne downside that comes to mind is that if a user wants to bypass the \"final\" pipeline for some reason, they can't. As an example, as far as I understand, reindexing will apply the \"final\" pipeline again, which could be problematic.\r\n\r\nI don't want to derail the conversation too much, but I think it's worth considering if we need to take a step back and think about building the right abstractions into Elasticsearch for a routing/parsing pipeline like this instead of making do with what we have - similar to what we did with data streams - which I think will end up being incredibly valuable for our users over the long term because we now have an abstraction that fits much better with what our users are trying to achieve and it paves the way for us to deliver new features on this abstraction that would have been otherwise very difficult. \r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/659305552","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-659305552","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":659305552,"node_id":"MDEyOklzc3VlQ29tbWVudDY1OTMwNTU1Mg==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-07-16T09:53:12Z","updated_at":"2020-07-16T09:53:12Z","author_association":"MEMBER","body":"> One downside that comes to mind is that if a user wants to bypass the \"final\" pipeline for some reason, they can't. As an example, as far as I understand, reindexing will apply the \"final\" pipeline again, which could be problematic.\r\n\r\nThe idea of final pipelines is that it can't be bypassed, so maybe in that case a default pipeline should be used? \r\n\r\n> I don't want to derail the conversation too much, but I think it's worth considering if we need to take a step back and think about building the right abstractions into Elasticsearch for a routing/parsing pipeline like this instead of making do with what we have - similar to what we did with data streams - which I think will end up being incredibly valuable for our users over the long term because we now have an abstraction that fits much better with what our users are trying to achieve and it paves the way for us to deliver new features on this abstraction that would have been otherwise very difficult.\r\n\r\n👍 I think it is a good idea to take a good look at the current implementation and consider alternatives for it. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/674700233","html_url":"https://github.com/elastic/elasticsearch/issues/57968#issuecomment-674700233","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57968","id":674700233,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NDcwMDIzMw==","user":{"login":"ruflin","id":244900,"node_id":"MDQ6VXNlcjI0NDkwMA==","avatar_url":"https://avatars3.githubusercontent.com/u/244900?v=4","gravatar_id":"","url":"https://api.github.com/users/ruflin","html_url":"https://github.com/ruflin","followers_url":"https://api.github.com/users/ruflin/followers","following_url":"https://api.github.com/users/ruflin/following{/other_user}","gists_url":"https://api.github.com/users/ruflin/gists{/gist_id}","starred_url":"https://api.github.com/users/ruflin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruflin/subscriptions","organizations_url":"https://api.github.com/users/ruflin/orgs","repos_url":"https://api.github.com/users/ruflin/repos","events_url":"https://api.github.com/users/ruflin/events{/privacy}","received_events_url":"https://api.github.com/users/ruflin/received_events","type":"User","site_admin":false},"created_at":"2020-08-17T07:01:43Z","updated_at":"2020-08-17T07:01:43Z","author_association":"CONTRIBUTOR","body":"@tvernum I file an issue around being able to specify multiple ingest pipelines in a data stream and perhaps this could also help with the problem here: https://github.com/elastic/elasticsearch/issues/61185","performed_via_github_app":null}]