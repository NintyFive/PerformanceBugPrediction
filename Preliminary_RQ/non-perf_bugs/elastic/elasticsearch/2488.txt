{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2488","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2488/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2488/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2488/events","html_url":"https://github.com/elastic/elasticsearch/issues/2488","id":9326377,"node_id":"MDU6SXNzdWU5MzI2Mzc3","number":2488,"title":"minimum_master_nodes does not prevent split-brain if splits are intersecting","user":{"login":"saj","id":194389,"node_id":"MDQ6VXNlcjE5NDM4OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/194389?v=4","gravatar_id":"","url":"https://api.github.com/users/saj","html_url":"https://github.com/saj","followers_url":"https://api.github.com/users/saj/followers","following_url":"https://api.github.com/users/saj/following{/other_user}","gists_url":"https://api.github.com/users/saj/gists{/gist_id}","starred_url":"https://api.github.com/users/saj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saj/subscriptions","organizations_url":"https://api.github.com/users/saj/orgs","repos_url":"https://api.github.com/users/saj/repos","events_url":"https://api.github.com/users/saj/events{/privacy}","received_events_url":"https://api.github.com/users/saj/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":111540092,"node_id":"MDU6TGFiZWwxMTE1NDAwOTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.4.0.Beta1","name":"v1.4.0.Beta1","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"assignees":[{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":103,"created_at":"2012-12-17T08:15:54Z","updated_at":"2016-02-26T16:31:11Z","closed_at":"2014-09-01T14:58:42Z","author_association":"NONE","active_lock_reason":null,"body":"G'day,\n\nI'm using ElasticSearch 0.19.11 with the unicast Zen discovery protocol.\n\nWith this setup, I can easily split a 3-node cluster into two 'hemispheres' (continuing with the brain metaphor) with one node acting as a participant in both hemispheres.  I believe this to be a significant problem, because now `minimum_master_nodes` is incapable of preventing certain split-brain scenarios.\n\nHere's what my 3-node test cluster looked like before I broke it:\n\n![](https://saj.beta.anchortrove.com/es-splitbrain-1.png)\n\nHere's what the cluster looked like after simulating a communications failure between nodes (2) and (3):\n\n![](https://saj.beta.anchortrove.com/es-splitbrain-2.png)\n\nHere's what seems to have happened immediately after the split:\n1. Node (2) and (3) lose contact with one another.  (`zen-disco-node_failed` ... `reason failed to ping`)\n2. Node (2), still master of the left hemisphere, notes the disappearance of node (3) and broadcasts an advisory message to all of its followers.  Node (1) takes note of the advisory.\n3. Node (3) has now lost contact with its old master and decides to hold an election.  It declares itself winner of the election.  On declaring itself, it assumes master role of the right hemisphere, then broadcasts an advisory message to all of its followers.  Node (1) takes note of this advisory, too.\n\nAt this point, I can't say I know what to expect to find on node (1).  If I query both masters for a list of nodes, I see node (1) in both clusters.\n\nLet's look at `minimum_master_nodes` as it applies to this test cluster.  Assume I had set `minimum_master_nodes` to 2.  Had node (3) been completely isolated from nodes (1) and (2), I would not have run into this problem.  The left hemisphere would have enough nodes to satisfy the constraint; the right hemisphere would not.  This would continue to work for larger clusters (with an appropriately larger value for `minimum_master_nodes`).\n\nThe problem with `minimum_master_nodes` is that it does not work when the split brains are intersecting, as in my example above.  Even on a larger cluster of, say, 7 nodes with `minimum_master_nodes` set to 4, all that needs to happen is for the 'right' two nodes to lose contact with one another (a master election has to take place) for the cluster to split.\n\nIs there anything that can be done to detect the intersecting split on node (1)?\n\nWould #1057 help?\n\nAm I missing something obvious? :)\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}