{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12192","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12192/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12192/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12192/events","html_url":"https://github.com/elastic/elasticsearch/issues/12192","id":94469551,"node_id":"MDU6SXNzdWU5NDQ2OTU1MQ==","number":12192,"title":"Percolator NPE","user":{"login":"olivere","id":134848,"node_id":"MDQ6VXNlcjEzNDg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/134848?v=4","gravatar_id":"","url":"https://api.github.com/users/olivere","html_url":"https://github.com/olivere","followers_url":"https://api.github.com/users/olivere/followers","following_url":"https://api.github.com/users/olivere/following{/other_user}","gists_url":"https://api.github.com/users/olivere/gists{/gist_id}","starred_url":"https://api.github.com/users/olivere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/olivere/subscriptions","organizations_url":"https://api.github.com/users/olivere/orgs","repos_url":"https://api.github.com/users/olivere/repos","events_url":"https://api.github.com/users/olivere/events{/privacy}","received_events_url":"https://api.github.com/users/olivere/received_events","type":"User","site_admin":false},"labels":[{"id":156502592,"node_id":"MDU6TGFiZWwxNTY1MDI1OTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Percolator","name":":Search/Percolator","color":"0e8a16","default":false,"description":"Reverse search: find queries that match a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2015-07-11T12:32:44Z","updated_at":"2015-07-14T08:31:26Z","closed_at":"2015-07-14T08:31:25Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hi there!\n\nI'm testing the percolator API with the current master. I'm getting a (gracefully handled) null-pointer exception. Here's what I'm trying to do:\n\n``` sh\n#!/bin/sh\ncurl -s -XPUT 'localhost:9200/test-es20' -d '{\n  \"mappings\": {\n    \"tweet\": {\n      \"properties\": {\n        \"user\": { \"type\": \"string\" },\n        \"message\": { \"type\": \"string\" },\n        \"created\": { \"type\": \"date\" }\n      }\n    },\n    \"comment\": {\n      \"_parent\": { \"type\": \"tweet\" },\n      \"properties\": {\n        \"user\": { \"type\": \"string\" },\n        \"message\": { \"type\": \"string\" }\n      }\n    }\n  }\n}'\n\n# Register query in percolator\ncurl -s -XPUT 'localhost:9200/test-es20/.percolator/1' -d '{\n  \"query\": {\n    \"match\": {\n      \"message\" : \"Elasticsearch\"\n    }\n  }\n}'\n\n# Match document with percolator\ncurl -s -XGET 'localhost:9200/test-es20/tweet/_percolate?pretty' -d '{\n  \"doc\": {\n    \"user\": \"olivere\",\n    \"message\": \"Welcome to Elasticsearch\"\n  }\n}'\n```\n\nWhich yields:\n\n```\n{\n  \"took\" : 6,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 0,\n    \"failed\" : 5,\n    \"failures\" : [ {\n      \"shard\" : 0,\n      \"index\" : \"test-es20\",\n      \"status\" : \"BAD_REQUEST\",\n      \"reason\" : {\n        \"type\" : \"parse_exception\",\n        \"reason\" : \"failed to parse request\",\n        \"caused_by\" : {\n          \"type\" : \"mapper_parsing_exception\",\n          \"reason\" : \"failed to parse [_parent]\",\n          \"caused_by\" : {\n            \"type\" : \"null_pointer_exception\",\n            \"reason\" : null\n          }\n        }\n      }\n    } ]\n  },\n  \"total\" : 0,\n  \"matches\" : [ ]\n}\n```\n\nIf you remove the `_parent` from the comment mapping, everything is fine.\n\nIs this supposed to work, or is it the same issue mentioned in #2960?\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}