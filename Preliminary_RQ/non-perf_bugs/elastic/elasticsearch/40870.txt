{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/40870","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40870/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40870/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40870/events","html_url":"https://github.com/elastic/elasticsearch/issues/40870","id":429398932,"node_id":"MDU6SXNzdWU0MjkzOTg5MzI=","number":40870,"title":"`cluster_block_exception` should contain the read-only index name","user":{"login":"jpcarey","id":5118470,"node_id":"MDQ6VXNlcjUxMTg0NzA=","avatar_url":"https://avatars2.githubusercontent.com/u/5118470?v=4","gravatar_id":"","url":"https://api.github.com/users/jpcarey","html_url":"https://github.com/jpcarey","followers_url":"https://api.github.com/users/jpcarey/followers","following_url":"https://api.github.com/users/jpcarey/following{/other_user}","gists_url":"https://api.github.com/users/jpcarey/gists{/gist_id}","starred_url":"https://api.github.com/users/jpcarey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpcarey/subscriptions","organizations_url":"https://api.github.com/users/jpcarey/orgs","repos_url":"https://api.github.com/users/jpcarey/repos","events_url":"https://api.github.com/users/jpcarey/events{/privacy}","received_events_url":"https://api.github.com/users/jpcarey/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-04-04T17:31:37Z","updated_at":"2019-08-30T10:58:55Z","closed_at":"2019-05-04T23:10:30Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**: `Version: 7.0.0-rc2, Build: default/tar/7e5c520/2019-04-01T00:56:38.137034Z, JVM: 12`\r\n\r\n**JVM version**: \r\n``` text\r\nopenjdk version \"12\" 2019-03-19\r\nOpenJDK Runtime Environment (build 12+33)\r\nOpenJDK 64-Bit Server VM (build 12+33, mixed mode, sharing)\r\n```\r\n\r\n**OS version**: `Darwin MacBook-Pro.localdomain 18.2.0 Darwin Kernel Version 18.2.0: Thu Dec 20 20:46:53 PST 2018; root:xnu-4903.241.1~1/RELEASE_X86_64 x86_64`\r\n\r\n**Description of the problem including expected versus actual behavior**: If the `.security` index is read-only, the application privileges API response does not identify the problematic index name in the response.\r\n\r\n**Request**\r\n``` json\r\nPUT /_security/privilege/\r\n{\r\n  \"myapp\": {\r\n    \"read\": {\r\n      \"actions\": [\r\n        \"data:read/*\",\r\n        \"action:login\"\r\n      ],\r\n      \"metadata\": {\r\n        \"description\": \"Read access to myapp\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n**Response**\r\n``` json\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"cluster_block_exception\",\r\n        \"reason\": \"blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];\"\r\n      }\r\n    ],\r\n    \"type\": \"cluster_block_exception\",\r\n    \"reason\": \"blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];\"\r\n  },\r\n  \"status\": 403\r\n}\r\n```\r\nThis can be especially confusing for things like kibana logs:\r\n\r\n`{\"type\":\"log\",\"@timestamp\":\"2019-03-23T02:01:15Z\",\"tags\":[\"security\",\"error\"],\"pid\":28144,\"message\":\"Error registering Kibana Privileges with Elasticsearch for kibana-.kibana: [cluster_block_exception] blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];, with { suppressed={ 0={ type=\\\"cluster_block_exception\\\" & reason=\\\"blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];\\\" } & 1={ type=\\\"cluster_block_exception\\\" & reason=\\\"blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];\\\" } & 2={ type=\\\"cluster_block_exception\\\" & reason=\\\"blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];\\\" } } }\"}`\r\n\r\n**Steps to reproduce**:\r\n 1. Set `.security` index to read only\r\n    ``` json\r\n    PUT .security/_settings\r\n    {\r\n        \"index\": {\r\n        \"blocks\": {\r\n            \"read_only_allow_delete\": \"true\"\r\n            }\r\n        }\r\n    }\r\n    ```\r\n 2. Issue the `_security/privilege/` Request from above, and observe the response\r\n\r\n","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}