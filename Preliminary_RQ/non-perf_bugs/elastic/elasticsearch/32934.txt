{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32934","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32934/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32934/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32934/events","html_url":"https://github.com/elastic/elasticsearch/issues/32934","id":351515256,"node_id":"MDU6SXNzdWUzNTE1MTUyNTY=","number":32934,"title":"Failing to create create-index-template/put-mapping within 30's","user":{"login":"DarrenV79","id":19473339,"node_id":"MDQ6VXNlcjE5NDczMzM5","avatar_url":"https://avatars0.githubusercontent.com/u/19473339?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenV79","html_url":"https://github.com/DarrenV79","followers_url":"https://api.github.com/users/DarrenV79/followers","following_url":"https://api.github.com/users/DarrenV79/following{/other_user}","gists_url":"https://api.github.com/users/DarrenV79/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenV79/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenV79/subscriptions","organizations_url":"https://api.github.com/users/DarrenV79/orgs","repos_url":"https://api.github.com/users/DarrenV79/repos","events_url":"https://api.github.com/users/DarrenV79/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenV79/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-08-17T09:05:28Z","updated_at":"2019-09-06T18:21:28Z","closed_at":"2019-09-06T17:37:47Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\n\r\nAppologies for this bug but I can't find any information anywhere on how to fix this that either works or relates.\r\n\r\nUpdated the cluster from 6.3.0 to 6.3.2 and started seeing my number_of_pending_tasks never go to 0.\r\n\r\nCluster is 2 clients, 1 master and 2 data, running on AWS.  Up until this update it had been fine.  After I then setup a fresh cluster and changed the endpoint and even a fresh cluster has these issues.  The only logs are either from the log4net appender or Elastic Beats (winevents, packet, metrics).  Errors occur for both types.  All Ubuntu 16.04, runs as systemd where I increase the file limits only.  We only change the swapiness in the sysctl.conf to 1.\r\n\r\n\"status\" : \"green\",\r\n  \"timed_out\" : false,\r\n  \"number_of_nodes\" : 5,\r\n  \"number_of_data_nodes\" : 2,\r\n  \"active_primary_shards\" : 200,\r\n  \"active_shards\" : 400,\r\n  \"relocating_shards\" : 0,\r\n  \"initializing_shards\" : 0,\r\n  \"unassigned_shards\" : 0,\r\n  \"delayed_unassigned_shards\" : 0,\r\n  \"number_of_pending_tasks\" : 105,\r\n  \"number_of_in_flight_fetch\" : 0,\r\n  \"task_max_waiting_in_queue_millis\" : 1931025,\r\n  \"active_shards_percent_as_number\" : 100.0\r\n\r\nMaster state\r\n  \"compressed_size_in_bytes\" : 1096280,\r\n  \"master_node\" : \"-gcmmML3RHu-3XyAWupLBw\"\r\n\r\nThen pending tasks are all either create-index-template or put-mapping\r\n\r\n{\"insert_order\":5812,\"priority\":\"URGENT\",\"source\":\"create-index-template [<redacted>], cause [api]\",\"executing\":false,\"time_in_queue_millis\":17977,\"time_in_queue\":\"17.9s\"},{\"insert_order\":5775,\"priority\":\"HIGH\",\"source\":\"put-mapping\",\"executing\":false,\"time_in_queue_millis\":28602,\"time_in_queue\":\"28.6s\"},\r\n\r\nThese are failing for 95% of the indices.\r\n\r\norg.elasticsearch.cluster.metadata.ProcessClusterEventTimeoutException: failed to process cluster event (create-index-template [windeventlog], cause [api]) within 30s\r\n        at org.elasticsearch.cluster.service.MasterService$Batcher.lambda$onTimeout$0(MasterService.java:124) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at java.util.ArrayList.forEach(ArrayList.java:1249) ~[?:1.8.0_131]\r\n        at org.elasticsearch.cluster.service.MasterService$Batcher.lambda$onTimeout$1(MasterService.java:123) ~[elasticsearch-6.3.2.jar:6.3.2]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:626) [elasticsearch-6.3.2.jar:6.3.2]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_131]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_131]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n\r\nCluster settings:\r\n\r\ncluster.name: <redacted>\r\nplugin.mandatory: discovery-ec2,repository-s3\r\ndiscovery.zen.hosts_provider: ec2\r\ndiscovery.ec2.groups: elasticsearch-6\r\ndiscovery.ec2.endpoint: ec2.eu-central-1.amazonaws.com\r\ncloud.node.auto_attributes: true\r\ndiscovery.ec2.availability_zones: [\"eu-central-1a\", \"eu-central-1b\"]\r\nnetwork.host: _ec2:privateIp_\r\nxpack.security.enabled: false\r\nthread_pool.bulk.queue_size: 5000\r\npath.data: /var/lib/elasticsearch\r\npath.logs: /var/log/elasticsearch\r\nnode.master: true  <depends on node type>\r\nnode.data: false  <depends on node type>\r\nhttp.enabled: false  <depends on node type>\r\n\r\nThe only thing changed in the jvm options is the heap sizes (which are half the server size or 32GB for the data nodes).\r\n\r\nI have tried putmapping myself and that also fails.\r\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}