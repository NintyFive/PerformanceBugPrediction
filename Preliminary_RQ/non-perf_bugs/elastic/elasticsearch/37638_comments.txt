[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/455937531","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-455937531","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":455937531,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTkzNzUzMQ==","user":{"login":"jgq2008303393","id":657140,"node_id":"MDQ6VXNlcjY1NzE0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/657140?v=4","gravatar_id":"","url":"https://api.github.com/users/jgq2008303393","html_url":"https://github.com/jgq2008303393","followers_url":"https://api.github.com/users/jgq2008303393/followers","following_url":"https://api.github.com/users/jgq2008303393/following{/other_user}","gists_url":"https://api.github.com/users/jgq2008303393/gists{/gist_id}","starred_url":"https://api.github.com/users/jgq2008303393/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgq2008303393/subscriptions","organizations_url":"https://api.github.com/users/jgq2008303393/orgs","repos_url":"https://api.github.com/users/jgq2008303393/repos","events_url":"https://api.github.com/users/jgq2008303393/events{/privacy}","received_events_url":"https://api.github.com/users/jgq2008303393/received_events","type":"User","site_admin":false},"created_at":"2019-01-21T03:27:51Z","updated_at":"2019-01-21T03:30:24Z","author_association":"NONE","body":"We wonder if somebody is already working on it? If not, we would like to contribute our code.\r\n\r\nLooking forward to your reply.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/455967463","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-455967463","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":455967463,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTk2NzQ2Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-01-21T07:00:46Z","updated_at":"2019-01-21T07:00:46Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/455991399","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-455991399","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":455991399,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NTk5MTM5OQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-01-21T08:44:33Z","updated_at":"2019-01-21T08:44:33Z","author_association":"CONTRIBUTOR","body":"This duplicates #17213, and the solution we would like to implement is described in \r\nhttps://github.com/elastic/elasticsearch/issues/17213#issuecomment-383974707.\r\n\r\nI do not think that treating new shards differently from existing ones is a good idea. Elasticsearch's behaviour today is desirable in some cases, and the proposed change could cause many unnecessary and expensive relocations. Additionally, rebalancing the already-assigned shards may simply immediately undo the effects of the change proposed here.\r\n\r\nWe would like to add more control as described in the linked issue, but for now I think the solution is to set `total_shards_per_node`. Can you explain why this is \"troublesome to operate\"? It seems straightforward enough to set this value in the index templates as nodes are added to the cluster. An alternative is to use [allocation filtering](https://www.elastic.co/guide/en/elasticsearch/reference/current/shard-allocation-filtering.html) to give finer control over the nodes to which shards are assigned, again using index templates.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/456421406","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-456421406","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":456421406,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NjQyMTQwNg==","user":{"login":"jgq2008303393","id":657140,"node_id":"MDQ6VXNlcjY1NzE0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/657140?v=4","gravatar_id":"","url":"https://api.github.com/users/jgq2008303393","html_url":"https://github.com/jgq2008303393","followers_url":"https://api.github.com/users/jgq2008303393/followers","following_url":"https://api.github.com/users/jgq2008303393/following{/other_user}","gists_url":"https://api.github.com/users/jgq2008303393/gists{/gist_id}","starred_url":"https://api.github.com/users/jgq2008303393/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgq2008303393/subscriptions","organizations_url":"https://api.github.com/users/jgq2008303393/orgs","repos_url":"https://api.github.com/users/jgq2008303393/repos","events_url":"https://api.github.com/users/jgq2008303393/events{/privacy}","received_events_url":"https://api.github.com/users/jgq2008303393/received_events","type":"User","site_admin":false},"created_at":"2019-01-22T14:35:56Z","updated_at":"2019-01-22T14:37:10Z","author_association":"NONE","body":"@DaveCTurner Thanks for your reply.\r\n\r\n> Can you explain why this is \"troublesome to operate\"?\r\n\r\ntotal_shards_per_node is a mandatory rule. As we have many clusters and many users, it's easy to lead cluster yellow or even red.\r\n\r\n> the proposed change could cause many unnecessary and expensive relocations. Additionally, rebalancing the already-assigned shards may simply immediately undo the effects of the change proposed here.\r\n\r\nAs relocation will consider both node-level and index-level balance, we think that ES will tend to move some old shards to the new nodes instead of moving the new shards to the old nodes. The proposed change should not cause too much useless relocations.\r\n\r\nIs there any problem with my understanding, or what is missing?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/456637470","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-456637470","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":456637470,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NjYzNzQ3MA==","user":{"login":"jgq2008303393","id":657140,"node_id":"MDQ6VXNlcjY1NzE0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/657140?v=4","gravatar_id":"","url":"https://api.github.com/users/jgq2008303393","html_url":"https://github.com/jgq2008303393","followers_url":"https://api.github.com/users/jgq2008303393/followers","following_url":"https://api.github.com/users/jgq2008303393/following{/other_user}","gists_url":"https://api.github.com/users/jgq2008303393/gists{/gist_id}","starred_url":"https://api.github.com/users/jgq2008303393/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgq2008303393/subscriptions","organizations_url":"https://api.github.com/users/jgq2008303393/orgs","repos_url":"https://api.github.com/users/jgq2008303393/repos","events_url":"https://api.github.com/users/jgq2008303393/events{/privacy}","received_events_url":"https://api.github.com/users/jgq2008303393/received_events","type":"User","site_admin":false},"created_at":"2019-01-23T01:52:52Z","updated_at":"2019-01-23T01:52:52Z","author_association":"NONE","body":"The solution described in #17213 (comment) is good too, is there any plan about it recently?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/456804209","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-456804209","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":456804209,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NjgwNDIwOQ==","user":{"login":"jgq2008303393","id":657140,"node_id":"MDQ6VXNlcjY1NzE0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/657140?v=4","gravatar_id":"","url":"https://api.github.com/users/jgq2008303393","html_url":"https://github.com/jgq2008303393","followers_url":"https://api.github.com/users/jgq2008303393/followers","following_url":"https://api.github.com/users/jgq2008303393/following{/other_user}","gists_url":"https://api.github.com/users/jgq2008303393/gists{/gist_id}","starred_url":"https://api.github.com/users/jgq2008303393/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgq2008303393/subscriptions","organizations_url":"https://api.github.com/users/jgq2008303393/orgs","repos_url":"https://api.github.com/users/jgq2008303393/repos","events_url":"https://api.github.com/users/jgq2008303393/events{/privacy}","received_events_url":"https://api.github.com/users/jgq2008303393/received_events","type":"User","site_admin":false},"created_at":"2019-01-23T13:38:51Z","updated_at":"2019-01-29T09:23:23Z","author_association":"NONE","body":"ping @DaveCTurner ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/456896891","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-456896891","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":456896891,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1Njg5Njg5MQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-01-23T17:40:26Z","updated_at":"2019-01-29T09:23:29Z","author_association":"CONTRIBUTOR","body":"Responding here is on my list of tasks, and I will get to it. There is no need to ping me for a response a few hours after your last message.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/457074293","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-457074293","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":457074293,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NzA3NDI5Mw==","user":{"login":"jgq2008303393","id":657140,"node_id":"MDQ6VXNlcjY1NzE0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/657140?v=4","gravatar_id":"","url":"https://api.github.com/users/jgq2008303393","html_url":"https://github.com/jgq2008303393","followers_url":"https://api.github.com/users/jgq2008303393/followers","following_url":"https://api.github.com/users/jgq2008303393/following{/other_user}","gists_url":"https://api.github.com/users/jgq2008303393/gists{/gist_id}","starred_url":"https://api.github.com/users/jgq2008303393/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgq2008303393/subscriptions","organizations_url":"https://api.github.com/users/jgq2008303393/orgs","repos_url":"https://api.github.com/users/jgq2008303393/repos","events_url":"https://api.github.com/users/jgq2008303393/events{/privacy}","received_events_url":"https://api.github.com/users/jgq2008303393/received_events","type":"User","site_admin":false},"created_at":"2019-01-24T05:43:54Z","updated_at":"2019-01-29T09:23:35Z","author_association":"NONE","body":"Ok, I'm very much looking forward to your reply.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458468677","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-458468677","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":458468677,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODQ2ODY3Nw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-01-29T09:28:05Z","updated_at":"2019-01-29T09:28:05Z","author_association":"CONTRIBUTOR","body":"> total_shards_per_node is a mandatory rule. As we have many clusters and many users, it's easy to lead cluster yellow or even red.\r\n\r\nI still don't really understand. Are you having trouble automatically deciding how to set this value? Can you describe a situation in which it is difficult to do so? I am asking because I want to understand if we can make with this constraint better, and for that we need to see some specifics.\r\n\r\n> The solution described in #17213 is good too, is there any plan about it recently?\r\n\r\nImprovements such as the suggestion in #17213 are on our roadmap, but we have not set a timescale for this work.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458827535","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-458827535","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":458827535,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODgyNzUzNQ==","user":{"login":"jgq2008303393","id":657140,"node_id":"MDQ6VXNlcjY1NzE0MA==","avatar_url":"https://avatars0.githubusercontent.com/u/657140?v=4","gravatar_id":"","url":"https://api.github.com/users/jgq2008303393","html_url":"https://github.com/jgq2008303393","followers_url":"https://api.github.com/users/jgq2008303393/followers","following_url":"https://api.github.com/users/jgq2008303393/following{/other_user}","gists_url":"https://api.github.com/users/jgq2008303393/gists{/gist_id}","starred_url":"https://api.github.com/users/jgq2008303393/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgq2008303393/subscriptions","organizations_url":"https://api.github.com/users/jgq2008303393/orgs","repos_url":"https://api.github.com/users/jgq2008303393/repos","events_url":"https://api.github.com/users/jgq2008303393/events{/privacy}","received_events_url":"https://api.github.com/users/jgq2008303393/received_events","type":"User","site_admin":false},"created_at":"2019-01-30T06:26:07Z","updated_at":"2019-01-30T06:26:07Z","author_association":"NONE","body":"> Are you having trouble automatically deciding how to set this value? Can you describe a situation in which it is difficult to do so?\r\n\r\nMainly in the following two scenarios：\r\n1. If we set total_shards_per_node to 2, and one new big index create more shards than total_shards_per_node * node_num, then the cluster become yellow.\r\n2. As most index has 5 shards, so most new shards are assigned to the 5 new nodes. Setting total_shards_per_node  has no effect.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/458866029","html_url":"https://github.com/elastic/elasticsearch/issues/37638#issuecomment-458866029","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37638","id":458866029,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1ODg2NjAyOQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-01-30T09:04:33Z","updated_at":"2019-01-30T09:04:33Z","author_association":"CONTRIBUTOR","body":"Ok, yes, I think the long-term solution for these issues is what we're discussing in #17213. As an interim measure you can prevent new indices from being allocated to the mostly-empty new nodes by adding a [shard allocation filter](https://www.elastic.co/guide/en/elasticsearch/reference/current/shard-allocation-filtering.html) to the relevant index template while the cluster is rebalancing. I'm closing this as a duplicate of the other issue, but would like to say thanks for raising this idea and the subsequent discussion.","performed_via_github_app":null}]