[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327755747","html_url":"https://github.com/elastic/elasticsearch/issues/26519#issuecomment-327755747","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26519","id":327755747,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzc1NTc0Nw==","user":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"created_at":"2017-09-07T10:07:49Z","updated_at":"2017-09-07T10:07:49Z","author_association":"MEMBER","body":"I can confirm the bug (reproduced it wit ES 5.5.2 on Windows 8.1).\r\nLooking at the [code](https://github.com/elastic/elasticsearch/blob/47ffa17efbc444c3d6c74a8020ee95eb4518c597/plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiAnalyzerProvider.java#L38) is seems that potentially the default stopwords file is not loaded (maybe due to the modules classloader which might trip of the Lucene code).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327833243","html_url":"https://github.com/elastic/elasticsearch/issues/26519#issuecomment-327833243","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26519","id":327833243,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzgzMzI0Mw==","user":{"login":"avdv","id":3471749,"node_id":"MDQ6VXNlcjM0NzE3NDk=","avatar_url":"https://avatars2.githubusercontent.com/u/3471749?v=4","gravatar_id":"","url":"https://api.github.com/users/avdv","html_url":"https://github.com/avdv","followers_url":"https://api.github.com/users/avdv/followers","following_url":"https://api.github.com/users/avdv/following{/other_user}","gists_url":"https://api.github.com/users/avdv/gists{/gist_id}","starred_url":"https://api.github.com/users/avdv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avdv/subscriptions","organizations_url":"https://api.github.com/users/avdv/orgs","repos_url":"https://api.github.com/users/avdv/repos","events_url":"https://api.github.com/users/avdv/events{/privacy}","received_events_url":"https://api.github.com/users/avdv/received_events","type":"User","site_admin":false},"created_at":"2017-09-07T15:21:43Z","updated_at":"2017-09-07T15:22:40Z","author_association":"CONTRIBUTOR","body":"> I can confirm the bug (reproduced it wit ES 5.5.2 on Windows 8.1).\r\n> Looking at the code is seems that potentially the default stopwords file is not loaded (maybe due to the modules classloader which might trip of the Lucene code).\r\n\r\nThanks for having a look at it, @costin! But I think the problem may be different.\r\n\r\nI do not know how or why this changed, but it seems the part-of-speech is only initialized with the default stoptags list if using the default \"kuromoji\" analyzer (which calls [`JapaneseAnalyzer.getDefaultStopTags()`](https://github.com/elastic/elasticsearch/blob/47ffa17efbc444c3d6c74a8020ee95eb4518c597/plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiAnalyzerProvider.java#L41)). When defining a custom analyzer, the stoptags list is only ever set from the `stoptags` list in the settings [here](https://github.com/elastic/elasticsearch/blob/47ffa17efbc444c3d6c74a8020ee95eb4518c597/plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiPartOfSpeechFilterFactory.java#L38).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/328409232","html_url":"https://github.com/elastic/elasticsearch/issues/26519#issuecomment-328409232","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26519","id":328409232,"node_id":"MDEyOklzc3VlQ29tbWVudDMyODQwOTIzMg==","user":{"login":"johtani","id":1142449,"node_id":"MDQ6VXNlcjExNDI0NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/1142449?v=4","gravatar_id":"","url":"https://api.github.com/users/johtani","html_url":"https://github.com/johtani","followers_url":"https://api.github.com/users/johtani/followers","following_url":"https://api.github.com/users/johtani/following{/other_user}","gists_url":"https://api.github.com/users/johtani/gists{/gist_id}","starred_url":"https://api.github.com/users/johtani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johtani/subscriptions","organizations_url":"https://api.github.com/users/johtani/orgs","repos_url":"https://api.github.com/users/johtani/repos","events_url":"https://api.github.com/users/johtani/events{/privacy}","received_events_url":"https://api.github.com/users/johtani/received_events","type":"User","site_admin":false},"created_at":"2017-09-11T03:57:14Z","updated_at":"2017-09-11T03:57:14Z","author_association":"CONTRIBUTOR","body":"We have changed analysis registration in 5.0. \r\nWe had different registration logic between prebuild and factory.\r\n\r\nI think this bug is related removing [\"KuromojiIndicesAnalysis\" ](https://github.com/elastic/elasticsearch/blob/2.4/plugins/analysis-kuromoji/src/main/java/org/elasticsearch/indices/analysis/KuromojiIndicesAnalysis.java) . \r\n\r\nIn KuromojiIndicesAnalysis, we called getDefaultStopTags() in [line 100](https://github.com/elastic/elasticsearch/blob/2.4/plugins/analysis-kuromoji/src/main/java/org/elasticsearch/indices/analysis/KuromojiIndicesAnalysis.java#L100)...\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/328433305","html_url":"https://github.com/elastic/elasticsearch/issues/26519#issuecomment-328433305","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26519","id":328433305,"node_id":"MDEyOklzc3VlQ29tbWVudDMyODQzMzMwNQ==","user":{"login":"avdv","id":3471749,"node_id":"MDQ6VXNlcjM0NzE3NDk=","avatar_url":"https://avatars2.githubusercontent.com/u/3471749?v=4","gravatar_id":"","url":"https://api.github.com/users/avdv","html_url":"https://github.com/avdv","followers_url":"https://api.github.com/users/avdv/followers","following_url":"https://api.github.com/users/avdv/following{/other_user}","gists_url":"https://api.github.com/users/avdv/gists{/gist_id}","starred_url":"https://api.github.com/users/avdv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avdv/subscriptions","organizations_url":"https://api.github.com/users/avdv/orgs","repos_url":"https://api.github.com/users/avdv/repos","events_url":"https://api.github.com/users/avdv/events{/privacy}","received_events_url":"https://api.github.com/users/avdv/received_events","type":"User","site_admin":false},"created_at":"2017-09-11T06:50:22Z","updated_at":"2017-09-11T06:50:22Z","author_association":"CONTRIBUTOR","body":"Yes, I think you hit the nail on the head! @johtani \r\n\r\nBut, how could this be fixed? Move the initialization of the part-of-speech anlyzer into the factory and call getDefaultStopTags if the `stoptags` setting is `null`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/328436995","html_url":"https://github.com/elastic/elasticsearch/issues/26519#issuecomment-328436995","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26519","id":328436995,"node_id":"MDEyOklzc3VlQ29tbWVudDMyODQzNjk5NQ==","user":{"login":"johtani","id":1142449,"node_id":"MDQ6VXNlcjExNDI0NDk=","avatar_url":"https://avatars0.githubusercontent.com/u/1142449?v=4","gravatar_id":"","url":"https://api.github.com/users/johtani","html_url":"https://github.com/johtani","followers_url":"https://api.github.com/users/johtani/followers","following_url":"https://api.github.com/users/johtani/following{/other_user}","gists_url":"https://api.github.com/users/johtani/gists{/gist_id}","starred_url":"https://api.github.com/users/johtani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johtani/subscriptions","organizations_url":"https://api.github.com/users/johtani/orgs","repos_url":"https://api.github.com/users/johtani/repos","events_url":"https://api.github.com/users/johtani/events{/privacy}","received_events_url":"https://api.github.com/users/johtani/received_events","type":"User","site_admin":false},"created_at":"2017-09-11T07:07:40Z","updated_at":"2017-09-11T07:07:40Z","author_association":"CONTRIBUTOR","body":"I think if the `stoptags` setting is null or not exists, call getDefaultStopTags in KuromojiPartOfSpeechFilterFactory constructer.","performed_via_github_app":null}]