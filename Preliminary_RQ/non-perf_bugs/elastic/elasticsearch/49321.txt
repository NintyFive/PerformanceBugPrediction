{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/49321","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49321/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49321/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49321/events","html_url":"https://github.com/elastic/elasticsearch/issues/49321","id":525089906,"node_id":"MDU6SXNzdWU1MjUwODk5MDY=","number":49321,"title":"Shard request cache and script queries/aggregations","user":{"login":"AlexP-Elastic","id":19776583,"node_id":"MDQ6VXNlcjE5Nzc2NTgz","avatar_url":"https://avatars3.githubusercontent.com/u/19776583?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexP-Elastic","html_url":"https://github.com/AlexP-Elastic","followers_url":"https://api.github.com/users/AlexP-Elastic/followers","following_url":"https://api.github.com/users/AlexP-Elastic/following{/other_user}","gists_url":"https://api.github.com/users/AlexP-Elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexP-Elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexP-Elastic/subscriptions","organizations_url":"https://api.github.com/users/AlexP-Elastic/orgs","repos_url":"https://api.github.com/users/AlexP-Elastic/repos","events_url":"https://api.github.com/users/AlexP-Elastic/events{/privacy}","received_events_url":"https://api.github.com/users/AlexP-Elastic/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2019-11-19T15:40:41Z","updated_at":"2019-12-19T23:31:09Z","closed_at":"2019-12-19T23:31:08Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Support for caching queries including scripts**:\r\n\r\nAlthough the documentation for the [shard request query](https://www.elastic.co/guide/en/elasticsearch/reference/current/shard-request-cache.html) currently says:\r\n\r\n> If your query uses a script whose result is not deterministic (e.g. it uses a random function or references the current time) you should set the request_cache flag to false to disable caching for that request\r\n\r\nIn practice the cache is skipped whenever `ScriptService` is used\r\n\r\nThis is intentional, per @jimczi:\r\n\r\n> this is intentional ... we cannot ensure that the result is deterministic.\r\n\r\nAn alternative (which per the docs seems consistent with how some other scenarios are handled) would be to default to skipping the cache in such cases but allow use of the existing `request_cache=true` param for clients to declare their script is deterministic and can be cached\r\n\r\nNote that scripted aggregations are often very expensive and therefore great candidates to be cached!\r\n\r\n\r\n\r\n","closed_by":{"login":"stu-elastic","id":24232742,"node_id":"MDQ6VXNlcjI0MjMyNzQy","avatar_url":"https://avatars0.githubusercontent.com/u/24232742?v=4","gravatar_id":"","url":"https://api.github.com/users/stu-elastic","html_url":"https://github.com/stu-elastic","followers_url":"https://api.github.com/users/stu-elastic/followers","following_url":"https://api.github.com/users/stu-elastic/following{/other_user}","gists_url":"https://api.github.com/users/stu-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/stu-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stu-elastic/subscriptions","organizations_url":"https://api.github.com/users/stu-elastic/orgs","repos_url":"https://api.github.com/users/stu-elastic/repos","events_url":"https://api.github.com/users/stu-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/stu-elastic/received_events","type":"User","site_admin":false},"performed_via_github_app":null}