{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26419","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26419/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26419/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26419/events","html_url":"https://github.com/elastic/elasticsearch/issues/26419","id":253640651,"node_id":"MDU6SXNzdWUyNTM2NDA2NTE=","number":26419,"title":"Deprecation headers are not returned when deleting a non existing setting","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":189346177,"node_id":"MDU6TGFiZWwxODkzNDYxNzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edeprecation","name":">deprecation","color":"ce18a7","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2017-08-29T12:32:08Z","updated_at":"2017-10-26T16:36:03Z","closed_at":"2017-10-26T02:15:39Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 5.5 (tested on 5.5.1)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): osx\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen you have a deprecated setting configured, then the cluster update settings API is returning all of those settings on every request, regardless if the setting you specified as part of the request is affected.\r\n\r\nHowever when trying to unset an already unset setting, the header suddenly vanishes.\r\n\r\n**Steps to reproduce**:\r\n\r\n```\r\nbin/elasticsearch -Eingest.new_date_format=false\r\n```\r\n\r\nSet another setting, see the correct header returned for the setting specified on startup\r\n\r\n```\r\n# curl -v -X PUT localhost:9200/_cluster/settings -d '{ \"transient\" : { \"script.max_compilations_per_minute\" : 15 } }' --header \"Content-Type: application/json\"\r\n*   Trying 127.0.0.1...\r\n* TCP_NODELAY set\r\n* Connected to localhost (127.0.0.1) port 9200 (#0)\r\n> PUT /_cluster/settings HTTP/1.1\r\n> Host: localhost:9200\r\n> User-Agent: curl/7.54.0\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> Content-Length: 63\r\n>\r\n* upload completely sent off: 63 out of 63 bytes\r\n< HTTP/1.1 200 OK\r\n< Warning: 299 Elasticsearch-5.5.1-19c13d0 \"[ingest.new_date_format] setting was deprecated in Elasticsearch and will be removed in a future release! See the breaking changes documentation for the next major version.\" \"Tue, 29 Aug 2017 12:29:56 GMT\"\r\n< content-type: application/json; charset=UTF-8\r\n< content-length: 97\r\n<\r\n* Connection #0 to host localhost left intact\r\n{\"acknowledged\":true,\"persistent\":{},\"transient\":{\"script\":{\"max_compilations_per_minute\":\"15\"}}}%\r\n```\r\n\r\nRemove the script compilation setting by setting it to `null`, see the header for the startup setting being returned\r\n\r\n```\r\n# curl -v -X PUT localhost:9200/_cluster/settings -d '{ \"transient\" : { \"script.max_compilations_per_minute\" : null } }' --header \"Content-Type: application/json\"\r\n*   Trying 127.0.0.1...\r\n* TCP_NODELAY set\r\n* Connected to localhost (127.0.0.1) port 9200 (#0)\r\n> PUT /_cluster/settings HTTP/1.1\r\n> Host: localhost:9200\r\n> User-Agent: curl/7.54.0\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> Content-Length: 65\r\n>\r\n* upload completely sent off: 65 out of 65 bytes\r\n< HTTP/1.1 200 OK\r\n< Warning: 299 Elasticsearch-5.5.1-19c13d0 \"[ingest.new_date_format] setting was deprecated in Elasticsearch and will be removed in a future release! See the breaking changes documentation for the next major version.\" \"Tue, 29 Aug 2017 12:31:06 GMT\"\r\n< content-type: application/json; charset=UTF-8\r\n< content-length: 52\r\n<\r\n* Connection #0 to host localhost left intact\r\n{\"acknowledged\":true,\"persistent\":{},\"transient\":{}}%\r\n```\r\n\r\nDo the above call for a second time, see no headers\r\n\r\n```\r\ncurl -v -X PUT localhost:9200/_cluster/settings -d '{ \"transient\" : { \"script.max_compilations_per_minute\" : null } }' --header \"Content-Type: application/json\"\r\n*   Trying 127.0.0.1...\r\n* TCP_NODELAY set\r\n* Connected to localhost (127.0.0.1) port 9200 (#0)\r\n> PUT /_cluster/settings HTTP/1.1\r\n> Host: localhost:9200\r\n> User-Agent: curl/7.54.0\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> Content-Length: 65\r\n>\r\n* upload completely sent off: 65 out of 65 bytes\r\n< HTTP/1.1 200 OK\r\n< content-type: application/json; charset=UTF-8\r\n< content-length: 52\r\n<\r\n* Connection #0 to host localhost left intact\r\n{\"acknowledged\":true,\"persistent\":{},\"transient\":{}}%\r\n```","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}