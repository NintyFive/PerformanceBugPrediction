{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3481","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3481/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3481/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3481/events","html_url":"https://github.com/elastic/elasticsearch/issues/3481","id":17906889,"node_id":"MDU6SXNzdWUxNzkwNjg4OQ==","number":3481,"title":"Java API BulkDelete returning isNotFound when run against index with multiple shards","user":{"login":"bartakj","id":1827700,"node_id":"MDQ6VXNlcjE4Mjc3MDA=","avatar_url":"https://avatars2.githubusercontent.com/u/1827700?v=4","gravatar_id":"","url":"https://api.github.com/users/bartakj","html_url":"https://github.com/bartakj","followers_url":"https://api.github.com/users/bartakj/followers","following_url":"https://api.github.com/users/bartakj/following{/other_user}","gists_url":"https://api.github.com/users/bartakj/gists{/gist_id}","starred_url":"https://api.github.com/users/bartakj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bartakj/subscriptions","organizations_url":"https://api.github.com/users/bartakj/orgs","repos_url":"https://api.github.com/users/bartakj/repos","events_url":"https://api.github.com/users/bartakj/events{/privacy}","received_events_url":"https://api.github.com/users/bartakj/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"assignees":[{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2013-08-11T01:53:19Z","updated_at":"2013-08-13T06:25:09Z","closed_at":"2013-08-12T17:19:05Z","author_association":"NONE","active_lock_reason":null,"body":"I've reproduced this problem with both v 0.90.2 and 0.90.3.\n\nWhen I run some of my integration tests against an index that has multiple shards (running on multiple ES instances), some bulkDelete commands return isNotFound for documents that are in the index.  It works properly when I run against an index with a single shard.\n\nI've not been able to reproduce this using the ElasticSearch REST API.  \n\nI've attached images showing the BulkRequest in the debugger, the data in the index before the request runs, and how the shards are allocated.\n\nAll four DeleteResponses that come back have notFound set to true.  Notice that I'm attempting to delete the documents from multiple indices and they only exist in one.  This doesn't cause a problem when I run with just one shard and even if I only try to delete it from the index that it actually resides in, I still get notFound.\n\nAlso note that the actual bulkRequest uses aliases to the actual indices.  Again, I've tried it without aliases and I get the same behavior.\n\nIf I had to guess at what the problem is, I'd say it's related to the fact that the documents I'm attempting to delete are child documents of other documents in the index.  The parent of both these documents is the itemtype document with id \"jmeter_000000_overwrite|@|file|@|id2|@|2\"\n\n![bulkrequestbuilder](https://f.cloud.github.com/assets/1827700/943527/372d9d36-0227-11e3-8c65-9bbe7585d327.png)\n![eshead data](https://f.cloud.github.com/assets/1827700/943528/4668af84-0227-11e3-8796-67b705ef6917.png)\n![eshead indices](https://f.cloud.github.com/assets/1827700/943530/529e0e70-0227-11e3-8633-02fa6869c916.png)\n","closed_by":{"login":"bartakj","id":1827700,"node_id":"MDQ6VXNlcjE4Mjc3MDA=","avatar_url":"https://avatars2.githubusercontent.com/u/1827700?v=4","gravatar_id":"","url":"https://api.github.com/users/bartakj","html_url":"https://github.com/bartakj","followers_url":"https://api.github.com/users/bartakj/followers","following_url":"https://api.github.com/users/bartakj/following{/other_user}","gists_url":"https://api.github.com/users/bartakj/gists{/gist_id}","starred_url":"https://api.github.com/users/bartakj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bartakj/subscriptions","organizations_url":"https://api.github.com/users/bartakj/orgs","repos_url":"https://api.github.com/users/bartakj/repos","events_url":"https://api.github.com/users/bartakj/events{/privacy}","received_events_url":"https://api.github.com/users/bartakj/received_events","type":"User","site_admin":false},"performed_via_github_app":null}