[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262259472","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262259472","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262259472,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjI1OTQ3Mg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-11-22T14:47:12Z","updated_at":"2016-11-22T14:47:12Z","author_association":"CONTRIBUTOR","body":"This looks useful and involves knocking ANTLR parsers around which is one of my favorite things to do! I used to do it for fun! No joke!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262259695","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262259695","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262259695,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjI1OTY5NQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-11-22T14:48:01Z","updated_at":"2016-11-22T14:48:01Z","author_association":"CONTRIBUTOR","body":"Or maybe it is \"just\" making sure the script stack we generate is properly rendered in this context. I dunno! I find out in a bit.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262287439","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262287439","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262287439,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjI4NzQzOQ==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2016-11-22T16:21:19Z","updated_at":"2016-11-22T16:21:19Z","author_association":"CONTRIBUTOR","body":"Since this is an actual ANTLR syntax error, I think the place to work on this would be ParserErrorStratery under painless.input.  There is a ton of work than can be done here to specialize on our errors and make them better based on the context.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262429967","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262429967","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262429967,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjQyOTk2Nw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-11-23T03:53:40Z","updated_at":"2016-11-23T03:53:40Z","author_association":"CONTRIBUTOR","body":"Most of the right data is already there. Here is a snippet of what we return if you try to search with a broken script:\r\n```\r\n          \"caused_by\" : {\r\n            \"type\" : \"script_exception\",\r\n            \"reason\" : \"compile error\",\r\n            \"caused_by\" : {\r\n              \"type\" : \"illegal_argument_exception\",\r\n              \"reason\" : \"invalid sequence of tokens near ['String'].\",\r\n              \"caused_by\" : {\r\n                \"type\" : \"no_viable_alt_exception\",\r\n                \"reason\" : null\r\n              }\r\n            },\r\n            \"script_stack\" : [\r\n              \"boolean String errr; doc['num1']. ...\",\r\n              \"        ^---- HERE\"\r\n            ],\r\n            \"script\" : \"boolean String errr; doc['num1'].value > 1;\",\r\n            \"lang\" : \"painless\"\r\n          }\r\n```\r\n\r\nThe two important bits are \"`invalid sequence of tokens near ['String'].`\" and \r\n```\r\n            \"script_stack\" : [\r\n              \"boolean String errr; doc['num1']. ...\",\r\n              \"        ^---- HERE\"\r\n            ],\r\n```\r\n\r\nIt'd be nice if we returns less stuff though. I'm not 100% sure how much stuff it is safe to remove though.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262573388","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262573388","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262573388,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjU3MzM4OA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-11-23T17:03:04Z","updated_at":"2016-11-23T17:03:04Z","author_association":"CONTRIBUTOR","body":"I've been digging into `script_stack` a bit this morning. I think I'll open a few PRs around it and the error reporting in general related to this issue. I don't know that they'll close the issue, just make things better. I'm not sure what we should do to close the issue, actually. But here are some things I'm going to work on:\r\n\r\n1. Add tests for the script_stack and its rendering in REST responses.\r\n2. Remove some code duplication around generating it.\r\n3. Have a look at what gets included. Right now it stops the first time it sees your script which feels like it is missing some useful information when there are function calls and lambdas.\r\n4. Some error messages to in addition to `compile error` and `runtime error` so that the `root_cause` field is more useable.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262622868","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262622868","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262622868,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjYyMjg2OA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-11-23T20:30:10Z","updated_at":"2016-11-23T20:30:10Z","author_association":"MEMBER","body":"@robin13 Did you see that error in your logs, because this script is a file script? I think we could improve the log message for compile errors from file scripts so it is more like what we see from inline scripts in requests.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262626828","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262626828","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262626828,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjYyNjgyOA==","user":{"login":"robin13","id":174291,"node_id":"MDQ6VXNlcjE3NDI5MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/174291?v=4","gravatar_id":"","url":"https://api.github.com/users/robin13","html_url":"https://github.com/robin13","followers_url":"https://api.github.com/users/robin13/followers","following_url":"https://api.github.com/users/robin13/following{/other_user}","gists_url":"https://api.github.com/users/robin13/gists{/gist_id}","starred_url":"https://api.github.com/users/robin13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robin13/subscriptions","organizations_url":"https://api.github.com/users/robin13/orgs","repos_url":"https://api.github.com/users/robin13/repos","events_url":"https://api.github.com/users/robin13/events{/privacy}","received_events_url":"https://api.github.com/users/robin13/received_events","type":"User","site_admin":false},"created_at":"2016-11-23T20:50:25Z","updated_at":"2016-11-23T20:50:25Z","author_association":"MEMBER","body":"@rjernst Yes - it was in the elasticsearch logs after updating a file script.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262633705","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262633705","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262633705,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjYzMzcwNQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-11-23T21:25:59Z","updated_at":"2016-11-23T21:25:59Z","author_association":"CONTRIBUTOR","body":"> @rjernst Yes - it was in the elasticsearch logs after updating a file script.\r\n\r\nAh! I hasn't thought about file scripts. Making the log on file script compilation nice is a much simpler thing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262633817","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-262633817","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":262633817,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjYzMzgxNw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-11-23T21:26:33Z","updated_at":"2016-11-23T21:26:33Z","author_association":"CONTRIBUTOR","body":"I mean, I should have known from the log line in the issue description....","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263373516","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-263373516","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":263373516,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzM3MzUxNg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-11-28T19:45:32Z","updated_at":"2016-11-28T19:45:32Z","author_association":"CONTRIBUTOR","body":"On later reflection, I think #21767 is enough to close this so I'm gonna close it. @robin13, please reopen if you disagree. Here is an example of script compilation failure on startup now:\r\n```\r\n[2016-11-28T11:45:10,803][WARN ][o.e.s.ScriptService      ] [0XjgN0T] failed to load/compile script [foo]: {\r\n  \"type\" : \"script_exception\",\r\n  \"reason\" : \"compile error\",\r\n  \"caused_by\" : {\r\n    \"type\" : \"illegal_argument_exception\",\r\n    \"reason\" : \"unexpected token ['adsf'] was expecting one of [{<EOF>, ';'}].\"\r\n  },\r\n  \"script_stack\" : [\r\n    \"asdf adsf adsf \\n\",\r\n    \"     ^---- HERE\"\r\n  ],\r\n  \"script\" : \"asdf adsf adsf \\n\",\r\n  \"lang\" : \"painless\"\r\n}\r\n```\r\n\r\nElasticsearch still starts but you get the warning. It isn't perfect, but I think it is much better than it was before.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263590426","html_url":"https://github.com/elastic/elasticsearch/issues/21733#issuecomment-263590426","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21733","id":263590426,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzU5MDQyNg==","user":{"login":"robin13","id":174291,"node_id":"MDQ6VXNlcjE3NDI5MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/174291?v=4","gravatar_id":"","url":"https://api.github.com/users/robin13","html_url":"https://github.com/robin13","followers_url":"https://api.github.com/users/robin13/followers","following_url":"https://api.github.com/users/robin13/following{/other_user}","gists_url":"https://api.github.com/users/robin13/gists{/gist_id}","starred_url":"https://api.github.com/users/robin13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robin13/subscriptions","organizations_url":"https://api.github.com/users/robin13/orgs","repos_url":"https://api.github.com/users/robin13/repos","events_url":"https://api.github.com/users/robin13/events{/privacy}","received_events_url":"https://api.github.com/users/robin13/received_events","type":"User","site_admin":false},"created_at":"2016-11-29T14:51:13Z","updated_at":"2016-11-29T14:51:13Z","author_association":"MEMBER","body":"Thank you @nik9000 - that looks much better! :)","performed_via_github_app":null}]