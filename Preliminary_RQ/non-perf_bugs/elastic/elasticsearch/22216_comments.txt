[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267538497","html_url":"https://github.com/elastic/elasticsearch/issues/22216#issuecomment-267538497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22216","id":267538497,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzUzODQ5Nw==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T08:00:26Z","updated_at":"2016-12-16T08:00:26Z","author_association":"CONTRIBUTOR","body":"@tedivm can you provide a reproduction or an example of what doesn't work. It's nearly impossible to do anything here with a \"X doesn't work anymore after upgrade\" description. :(","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267541142","html_url":"https://github.com/elastic/elasticsearch/issues/22216#issuecomment-267541142","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22216","id":267541142,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzU0MTE0Mg==","user":{"login":"tedivm","id":121709,"node_id":"MDQ6VXNlcjEyMTcwOQ==","avatar_url":"https://avatars2.githubusercontent.com/u/121709?v=4","gravatar_id":"","url":"https://api.github.com/users/tedivm","html_url":"https://github.com/tedivm","followers_url":"https://api.github.com/users/tedivm/followers","following_url":"https://api.github.com/users/tedivm/following{/other_user}","gists_url":"https://api.github.com/users/tedivm/gists{/gist_id}","starred_url":"https://api.github.com/users/tedivm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tedivm/subscriptions","organizations_url":"https://api.github.com/users/tedivm/orgs","repos_url":"https://api.github.com/users/tedivm/repos","events_url":"https://api.github.com/users/tedivm/events{/privacy}","received_events_url":"https://api.github.com/users/tedivm/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T08:18:40Z","updated_at":"2016-12-16T08:18:40Z","author_association":"NONE","body":"What exactly do you want? I'm restoring a backup now (it's easier than reindexing) so I can pull data from both the backup and the upgraded node pretty trivially once that's done. This is also data for a video game so there's literally nothing sensitive in it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267541954","html_url":"https://github.com/elastic/elasticsearch/issues/22216#issuecomment-267541954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22216","id":267541954,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzU0MTk1NA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T08:24:07Z","updated_at":"2016-12-16T08:24:07Z","author_association":"CONTRIBUTOR","body":"for instance, is the index you are trying to search created with 2.x or 5.x. What is the field mapping in 2.x vs. 5.x. An example query that worked in 2.x but doesn't in 5.x, a sample of your data that you are indexing, are you using dynamic mapping or you do you predefine mappings. I am really working on my yedi skills but it seems like the force is not with me today ;)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267544623","html_url":"https://github.com/elastic/elasticsearch/issues/22216#issuecomment-267544623","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22216","id":267544623,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzU0NDYyMw==","user":{"login":"tedivm","id":121709,"node_id":"MDQ6VXNlcjEyMTcwOQ==","avatar_url":"https://avatars2.githubusercontent.com/u/121709?v=4","gravatar_id":"","url":"https://api.github.com/users/tedivm","html_url":"https://github.com/tedivm","followers_url":"https://api.github.com/users/tedivm/followers","following_url":"https://api.github.com/users/tedivm/following{/other_user}","gists_url":"https://api.github.com/users/tedivm/gists{/gist_id}","starred_url":"https://api.github.com/users/tedivm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tedivm/subscriptions","organizations_url":"https://api.github.com/users/tedivm/orgs","repos_url":"https://api.github.com/users/tedivm/repos","events_url":"https://api.github.com/users/tedivm/events{/privacy}","received_events_url":"https://api.github.com/users/tedivm/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T08:40:26Z","updated_at":"2016-12-16T08:40:26Z","author_association":"NONE","body":"Index was created with 2.x. using dynamic mapping. The field in question is the `price` field, which is no longer aggregatable. Any query that tries to aggregate off of it fails, and the kibana index page (on the version 5 server) says the field is not aggregatable or searchable.\r\n\r\nData-\r\n\r\n```json\r\n{\r\n  \"_index\": \"screeps-orders-2016_12\",\r\n  \"_type\": \"orders\",\r\n  \"_id\": \"AVkGxCpiFgRTfYeuvk60\",\r\n  \"_score\": null,\r\n  \"_source\": {\r\n    \"type\": \"sell\",\r\n    \"amount\": 5000,\r\n    \"remainingAmount\": 5000,\r\n    \"price\": 1.8,\r\n    \"roomName\": \"E58N38\",\r\n    \"date\": \"2016-12-16T08:33:43.000Z\",\r\n    \"resourceType\": \"Z\",\r\n    \"tick\": 16049217,\r\n    \"orderId\": \"58102d265ec178d32e7a37d9\",\r\n    \"npc\": false,\r\n    \"username\": \"Bogden\",\r\n    \"room_x_dir\": \"E\",\r\n    \"room_x\": 58,\r\n    \"room_y_dir\": \"N\",\r\n    \"room_y\": 38\r\n  },\r\n  \"fields\": {\r\n    \"date\": [\r\n      1481877223000\r\n    ]\r\n  },\r\n  \"sort\": [\r\n    1481877223000\r\n  ]\r\n}\r\n```\r\n\r\n\r\nMapping from 2.x\r\n\r\n```json\r\n{\r\n  \"screeps-orders-2016_12\" : {\r\n    \"mappings\" : {\r\n      \"orders\" : {\r\n        \"properties\" : {\r\n          \"alliance\" : {\r\n            \"type\" : \"string\"\r\n          },\r\n          \"amount\" : {\r\n            \"type\" : \"long\"\r\n          },\r\n          \"date\" : {\r\n            \"type\" : \"date\",\r\n            \"format\" : \"strict_date_optional_time||epoch_millis\"\r\n          },\r\n          \"npc\" : {\r\n            \"type\" : \"boolean\"\r\n          },\r\n          \"orderId\" : {\r\n            \"type\" : \"string\"\r\n          },\r\n          \"price\" : {\r\n            \"type\" : \"double\"\r\n          },\r\n          \"remainingAmount\" : {\r\n            \"type\" : \"long\"\r\n          },\r\n          \"resourceType\" : {\r\n            \"type\" : \"string\"\r\n          },\r\n          \"roomName\" : {\r\n            \"type\" : \"string\"\r\n          },\r\n          \"room_x\" : {\r\n            \"type\" : \"long\"\r\n          },\r\n          \"room_x_dir\" : {\r\n            \"type\" : \"string\"\r\n          },\r\n          \"room_y\" : {\r\n            \"type\" : \"long\"\r\n          },\r\n          \"room_y_dir\" : {\r\n            \"type\" : \"string\"\r\n          },\r\n          \"tick\" : {\r\n            \"type\" : \"long\"\r\n          },\r\n          \"type\" : {\r\n            \"type\" : \"string\"\r\n          },\r\n          \"username\" : {\r\n            \"type\" : \"string\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nMapping from 5.1-\r\n\r\n```json\r\n{\r\n  \"screeps-orders-2016_12\": {\r\n    \"mappings\": {\r\n      \"orders\": {\r\n        \"properties\": {\r\n          \"alliance\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"amount\": {\r\n            \"type\": \"long\"\r\n          },\r\n          \"date\": {\r\n            \"type\": \"date\",\r\n            \"format\": \"strict_date_optional_time||epoch_millis\"\r\n          },\r\n          \"npc\": {\r\n            \"type\": \"boolean\"\r\n          },\r\n          \"orderId\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"price\": {\r\n            \"type\": \"double\"\r\n          },\r\n          \"remainingAmount\": {\r\n            \"type\": \"long\"\r\n          },\r\n          \"resourceType\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"roomName\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"room_x\": {\r\n            \"type\": \"long\"\r\n          },\r\n          \"room_x_dir\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"room_y\": {\r\n            \"type\": \"long\"\r\n          },\r\n          \"room_y_dir\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"tick\": {\r\n            \"type\": \"long\"\r\n          },\r\n          \"type\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"username\": {\r\n            \"type\": \"string\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267545271","html_url":"https://github.com/elastic/elasticsearch/issues/22216#issuecomment-267545271","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22216","id":267545271,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzU0NTI3MQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T08:44:39Z","updated_at":"2016-12-16T08:44:39Z","author_association":"CONTRIBUTOR","body":"> Any query that tries to aggregate off of it fails, and the kibana index page (on the version 5 server) says the field is not aggregatable or searchable.\r\n\r\ncan you provide the query json and the rest response of the failure please.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267545447","html_url":"https://github.com/elastic/elasticsearch/issues/22216#issuecomment-267545447","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22216","id":267545447,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzU0NTQ0Nw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T08:45:46Z","updated_at":"2016-12-16T08:45:46Z","author_association":"MEMBER","body":"Can you also share the mappings of all your indices that match your index pattern in Kibana ? \r\nAre you using `screeps-orders-2016_12` only or do you have an index pattern like `screeps-orders-*` ? I am saying this because fields with conflicting mapping will no longer appear as searchable/aggregatable in Kibana. So for instance if the field `price` is defined as a `double` in one index and as a `long` in another one then it won't work with Kibana 5 if they are part of the same index pattern.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267547762","html_url":"https://github.com/elastic/elasticsearch/issues/22216#issuecomment-267547762","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22216","id":267547762,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzU0Nzc2Mg==","user":{"login":"tedivm","id":121709,"node_id":"MDQ6VXNlcjEyMTcwOQ==","avatar_url":"https://avatars2.githubusercontent.com/u/121709?v=4","gravatar_id":"","url":"https://api.github.com/users/tedivm","html_url":"https://github.com/tedivm","followers_url":"https://api.github.com/users/tedivm/followers","following_url":"https://api.github.com/users/tedivm/following{/other_user}","gists_url":"https://api.github.com/users/tedivm/gists{/gist_id}","starred_url":"https://api.github.com/users/tedivm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tedivm/subscriptions","organizations_url":"https://api.github.com/users/tedivm/orgs","repos_url":"https://api.github.com/users/tedivm/repos","events_url":"https://api.github.com/users/tedivm/events{/privacy}","received_events_url":"https://api.github.com/users/tedivm/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T08:59:29Z","updated_at":"2016-12-16T08:59:29Z","author_association":"NONE","body":"@jimczi is the winner- it looks like in some places it was `long` and in other places it was `double`. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/267549542","html_url":"https://github.com/elastic/elasticsearch/issues/22216#issuecomment-267549542","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22216","id":267549542,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NzU0OTU0Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-12-16T09:09:58Z","updated_at":"2016-12-16T09:09:58Z","author_association":"MEMBER","body":"This check has been added in Kibana to avoid problems when running aggregations or search on this conflicting field. I also understand how it can be confusing when upgrading from 2.4.\r\nYou'll need to fix your mapping to make it work so I am closing the ticket. \r\nThank you for reporting @tedivm ","performed_via_github_app":null}]