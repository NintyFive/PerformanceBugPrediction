{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11916","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11916/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11916/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11916/events","html_url":"https://github.com/elastic/elasticsearch/issues/11916","id":91827502,"node_id":"MDU6SXNzdWU5MTgyNzUwMg==","number":11916,"title":"The \"size\" and \"from\" of root of search JSON do not work with aggregation","user":{"login":"rusboy","id":3583960,"node_id":"MDQ6VXNlcjM1ODM5NjA=","avatar_url":"https://avatars3.githubusercontent.com/u/3583960?v=4","gravatar_id":"","url":"https://api.github.com/users/rusboy","html_url":"https://github.com/rusboy","followers_url":"https://api.github.com/users/rusboy/followers","following_url":"https://api.github.com/users/rusboy/following{/other_user}","gists_url":"https://api.github.com/users/rusboy/gists{/gist_id}","starred_url":"https://api.github.com/users/rusboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rusboy/subscriptions","organizations_url":"https://api.github.com/users/rusboy/orgs","repos_url":"https://api.github.com/users/rusboy/repos","events_url":"https://api.github.com/users/rusboy/events{/privacy}","received_events_url":"https://api.github.com/users/rusboy/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-06-29T14:53:21Z","updated_at":"2015-06-30T09:40:28Z","closed_at":"2015-06-30T09:40:27Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Hey,\n\nI'm observing some strange behavior with aggregation. I'm using ES 1.6.\n\n```\n{\n  \"status\" : 200,\n  \"name\" : \"Honey Lemon\",\n  \"cluster_name\" : \"elasticsearch\",\n  \"version\" : {\n    \"number\" : \"1.6.0\",\n    \"build_hash\" : \"cdd3ac4dde4f69524ec0a14de3828cb95bbb86d0\",\n    \"build_timestamp\" : \"2015-06-09T13:36:34Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.10.4\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n\nI've built search JSON where I used \"from\", \"size\" and aggregation. So, it looks like following code:\n\n```\n{\n  \"from\": 0,\n  \"size\": 5,\n  \"sort\" : [\n       { \"profile\" : {\"order\" : \"asc\"}}\n  ],\n  \"aggs\": {\n    \"genders\": {\n      \"terms\": {\n        \"field\": \"custom_field\",\n        \"order\" : { \"_term\" : \"asc\" }\n      },\n      \"aggs\": {\n                \"my_top_hits\": {\n                    \"top_hits\": {\n                       \"from\" : 0,\n                        \"sort\": [\n                            {\n                                \"count\": {\n                                    \"order\": \"asc\"\n                                }\n                            }\n                        ],\n                      \"size\" : 4  // I know, I can increase the value. But it's not solves issue anyway\n                    }\n                }\n            }\n    }\n  }\n}\n```\n\nMy expectations are, only 5 first documents of index are used for aggregation... However, I was surprised.. Aggregation results include all documents from index.\n\nI tried to add query tag in search JSON.. And I see, aggregation works only with part of documents that are \"provided\"/\"filtered\" by query..\nI think, \"from\" and \"size\" of root search JSON should cut list of documents for aggregations, similar with \n\nTask that I'm trying to solve is grouping documents by some field. Something like GROUP BY of MySQL. Some example from extjs could be find here http://docs.sencha.com/extjs/4.2.3/extjs-build/examples/build/KitchenSink/ext-theme-neptune/#grouped-grid\n\nMy idea was, to use \"from\"/\"size\", for paging via aggregated data. In other words, I would be \"ask\" aggregation process only required for myself part of data. \nFor example, now I could be use \"size\" of terms aggregation.. but it means, I'll have N buckets with length <= the \"size\". But it's worse way..Because to show table I 'll use only number required for site documents. But, also.. site will received a lot of data that are not required. It can impact customer's PC (I mean memory) and enforce to wait data foo long time if I use big data\n\nSome questions are opened for myself:\n1. Is it feature or bug? ( If it's bug I can take a look.. would be great if you recommend where in code I should start)\n2. Possible, u know other way to group data by field.\n3. Could be results of several metric aggregation are joined to one array ?\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}