{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50161","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50161/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50161/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50161/events","html_url":"https://github.com/elastic/elasticsearch/issues/50161","id":537312261,"node_id":"MDU6SXNzdWU1MzczMTIyNjE=","number":50161,"title":"Multiple fields are returned after aggregation","user":{"login":"ZhiHao1","id":34149640,"node_id":"MDQ6VXNlcjM0MTQ5NjQw","avatar_url":"https://avatars3.githubusercontent.com/u/34149640?v=4","gravatar_id":"","url":"https://api.github.com/users/ZhiHao1","html_url":"https://github.com/ZhiHao1","followers_url":"https://api.github.com/users/ZhiHao1/followers","following_url":"https://api.github.com/users/ZhiHao1/following{/other_user}","gists_url":"https://api.github.com/users/ZhiHao1/gists{/gist_id}","starred_url":"https://api.github.com/users/ZhiHao1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZhiHao1/subscriptions","organizations_url":"https://api.github.com/users/ZhiHao1/orgs","repos_url":"https://api.github.com/users/ZhiHao1/repos","events_url":"https://api.github.com/users/ZhiHao1/events{/privacy}","received_events_url":"https://api.github.com/users/ZhiHao1/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-12-13T02:20:38Z","updated_at":"2019-12-13T09:06:14Z","closed_at":"2019-12-13T09:06:14Z","author_association":"NONE","active_lock_reason":null,"body":"``\r\n\"source_data_school_achievements_of_the_paper\" : {\r\n            \"properties\" : {\r\n              \"school_achievements_of_the_paper\" : {\r\n                \"type\" : \"nested\",\r\n                \"properties\" : {\r\n                  \"abstract\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"account\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"achievements_of_the_paper_url\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"author\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"co_author\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"first_author\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"first_author_handle\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"included_publications\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"issn\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"issue_number\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"keyword\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"page_range\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"publication_time\" : {\r\n                    \"type\" : \"date\"\r\n                  },\r\n                  \"publications\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"title\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"type_of_papers\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"user_id\" : {\r\n                    \"type\" : \"keyword\"\r\n                  },\r\n                  \"volume_number\" : {\r\n                    \"type\" : \"keyword\"\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n``\r\n\r\nerror\r\n\r\n``\r\nGET es_userinfo_ip3/userinfo/_search\r\n{\r\n  \"size\": 0,\r\n  \"aggs\": {\r\n    \"path\": {\r\n      \"nested\": {\r\n        \"path\": \"source_data_school_achievements_of_the_paper.school_achievements_of_the_paper\"\r\n      },\r\n      \"aggs\": {\r\n        \"journalGroup\": {\r\n          \"terms\": {\r\n            \"field\": \"source_data_school_achievements_of_the_paper.school_achievements_of_the_paper.publications\",\r\n            \"order\": {\r\n              \"count\": \"asc\"\r\n            }\r\n          },\r\n          \"aggs\": {\r\n            \"count\": {\r\n              \"cardinality\": {\r\n                \"field\": \"source_data_school_achievements_of_the_paper.school_achievements_of_the_paper.title\"\r\n              }\r\n            }\r\n          }\r\n        },\r\n        \"cfsfsdgv\": {\r\n          \"top_hits\": {\r\n            \"_source\": [\"source_data_school_achievements_of_the_paper.school_achievements_of_the_paper.issn\"]\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n``\r\n\r\n\r\n``\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"Cannot execute inner hits. One or more parent object fields of nested field [source_data_school_achievements_of_the_paper.school_achievements_of_the_paper] are not nested. All parent fields need to be nested fields too\"\r\n      }\r\n    ],\r\n    \"type\": \"search_phase_execution_exception\",\r\n    \"reason\": \"all shards failed\",\r\n    \"phase\": \"query\",\r\n    \"grouped\": true,\r\n    \"failed_shards\": [\r\n      {\r\n        \"shard\": 0,\r\n        \"index\": \"es_userinfo_ip3\",\r\n        \"node\": \"c1up1y1GSZuClRbX3X1qmQ\",\r\n        \"reason\": {\r\n          \"type\": \"illegal_argument_exception\",\r\n          \"reason\": \"Cannot execute inner hits. One or more parent object fields of nested field [source_data_school_achievements_of_the_paper.school_achievements_of_the_paper] are not nested. All parent fields need to be nested fields too\"\r\n        }\r\n      }\r\n    ],\r\n    \"caused_by\": {\r\n      \"type\": \"illegal_argument_exception\",\r\n      \"reason\": \"Cannot execute inner hits. One or more parent object fields of nested field [source_data_school_achievements_of_the_paper.school_achievements_of_the_paper] are not nested. All parent fields need to be nested fields too\",\r\n      \"caused_by\": {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"Cannot execute inner hits. One or more parent object fields of nested field [source_data_school_achievements_of_the_paper.school_achievements_of_the_paper] are not nested. All parent fields need to be nested fields too\"\r\n      }\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n``","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}