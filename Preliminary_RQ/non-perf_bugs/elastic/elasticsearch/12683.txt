{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12683","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12683/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12683/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12683/events","html_url":"https://github.com/elastic/elasticsearch/issues/12683","id":99330702,"node_id":"MDU6SXNzdWU5OTMzMDcwMg==","number":12683,"title":"common terms query containing only stopwords with a _name causes a null pointer exception","user":{"login":"brettrp","id":6935280,"node_id":"MDQ6VXNlcjY5MzUyODA=","avatar_url":"https://avatars3.githubusercontent.com/u/6935280?v=4","gravatar_id":"","url":"https://api.github.com/users/brettrp","html_url":"https://github.com/brettrp","followers_url":"https://api.github.com/users/brettrp/followers","following_url":"https://api.github.com/users/brettrp/following{/other_user}","gists_url":"https://api.github.com/users/brettrp/gists{/gist_id}","starred_url":"https://api.github.com/users/brettrp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brettrp/subscriptions","organizations_url":"https://api.github.com/users/brettrp/orgs","repos_url":"https://api.github.com/users/brettrp/repos","events_url":"https://api.github.com/users/brettrp/events{/privacy}","received_events_url":"https://api.github.com/users/brettrp/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2015-08-06T01:04:36Z","updated_at":"2018-02-14T13:39:00Z","closed_at":"2015-08-06T13:33:29Z","author_association":"NONE","active_lock_reason":null,"body":"A common query containing only stopwords causes a NullPointerException if the query has a _name property.  This doesn't happen without the _name property, and doesn't happen with other types of queries.\n\n```\n# create index \ncurl -XPOST localhost:9200/test -d '{\n \"settings\" : {\n        \"number_of_shards\" : 1\n    },\n    \"mappings\" : {\n        \"type1\" : {\n            \"properties\" : {\n                \"name\" : { \"type\" : \"string\", \"analyzer\" : \"stop\" }\n            }\n        }\n    }\n}'\n```\n\n```\n# common query with a stop word correctly returns no results\ncurl -XGET localhost:9200/test/type1/_search -d '{\n    \"query\": {\n        \"common\": {\n            \"name\": {\n                \"query\": \"the\"\n            }\n        }\n    }\n}'\n\n{\"took\":35,\"timed_out\":false,\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\n\"hits\":{\"total\":0,\"max_score\":null,\"hits\":[]}}\n```\n\n```\n# common query with a _name causes a null pointer exception\ncurl -XGET localhost:9200/test/type1/_search -d '{\n    \"query\": {\n        \"common\": {\n            \"name\": {\n                \"query\": \"the\",\n                \"_name\": \"queryname\"\n            }\n        }\n    }\n}'\n\n{\"error\":\"SearchPhaseExecutionException[Failed to execute phase [query_fetch], all shards failed; shardFailures {[vFIFOFczQTSxJJO-kobPBQ][test][0]: SearchParseException[[test][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\n    \\\"query\\\": {\n        \\\"common\\\": {\n            \\\"name\\\": {\n                \\\"query\\\": \\\"the\\\",\n                \\\"_name\\\": \\\"queryname\\\"\n            }\n        }\n    }\n}]]]; nested: NullPointerException[Query may not be null]; }]\",\"status\":400}muzio:~ brett$\n\n```\n\n```\n# a regular match query doesn't have this problem\ncurl -XGET 10.4.4.118:9200/test/type1/_search -d '{\n    \"query\": {\n        \"match\": {\n            \"name\": {\n                \"query\": \"the\",\n                \"_name\": \"queryname\"\n            }\n        }\n    }\n}'\n```\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}