{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26118","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26118/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26118/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26118/events","html_url":"https://github.com/elastic/elasticsearch/issues/26118","id":249027423,"node_id":"MDU6SXNzdWUyNDkwMjc0MjM=","number":26118,"title":"cross cluster search - entire response failure although only one cluster down","user":{"login":"kopnok","id":26321346,"node_id":"MDQ6VXNlcjI2MzIxMzQ2","avatar_url":"https://avatars0.githubusercontent.com/u/26321346?v=4","gravatar_id":"","url":"https://api.github.com/users/kopnok","html_url":"https://github.com/kopnok","followers_url":"https://api.github.com/users/kopnok/followers","following_url":"https://api.github.com/users/kopnok/following{/other_user}","gists_url":"https://api.github.com/users/kopnok/gists{/gist_id}","starred_url":"https://api.github.com/users/kopnok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopnok/subscriptions","organizations_url":"https://api.github.com/users/kopnok/orgs","repos_url":"https://api.github.com/users/kopnok/repos","events_url":"https://api.github.com/users/kopnok/events{/privacy}","received_events_url":"https://api.github.com/users/kopnok/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"assignees":[{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2017-08-09T13:17:13Z","updated_at":"2017-11-21T10:41:47Z","closed_at":"2017-11-21T10:41:47Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\nVersion: 5.5.1, Build: 19c13d0/2017-07-18T20:44:24.823Z, JVM: 1.8.0_131\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_131\"\r\nOpenJDK Runtime Environment (build 1.8.0_131-8u131-b11-2ubuntu1.16.04.3-b11)\r\nOpenJDK 64-Bit Server VM (build 25.131-b11, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux zbook-15-G3 4.4.0-53-generic #74-Ubuntu SMP Fri Dec 2 15:59:10 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nThere are 3 elastic clusters and cluster_1 is configured to be able to search across clusters: cluster_2 and cluster_3.\r\nWhen cluster_3 is down (cluster_1, cluster_2 are up) wildcard cluster search returns failure:\r\n```\r\n{\r\n  \"error\" : {\r\n    \"root_cause\" : [\r\n      {\r\n        \"type\" : \"connect_transport_exception\",\r\n        \"reason\" : \"[][127.0.0.1:9303] connect_timeout[30s]\"\r\n      }\r\n    ],\r\n    \"type\" : \"transport_exception\",\r\n    \"reason\" : \"unable to communicate with remote cluster [cluster_3]\",\r\n    \"caused_by\" : {\r\n      \"type\" : \"connect_transport_exception\",\r\n      \"reason\" : \"[][127.0.0.1:9303] connect_timeout[30s]\",\r\n      \"caused_by\" : {\r\n        \"type\" : \"annotated_connect_exception\",\r\n        \"reason\" : \"Connection refused: /127.0.0.1:9303\",\r\n        \"caused_by\" : {\r\n          \"type\" : \"connect_exception\",\r\n          \"reason\" : \"Connection refused\"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"status\" : 500\r\n}\r\n```\r\n\r\nI would expect that result of all up clusters is returned.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Add data to cluster_2\r\n```\r\ncurl -XPUT 'localhost:9202/test-2/data/1?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n    \"user\" : \"user2\",\r\n    \"message\" : \"test2\"\r\n}\r\n'\r\n```\r\n 2. Add data to cluster_3\r\n```\r\ncurl -XPUT 'localhost:9203/test-3/data/1?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n    \"user\" : \"user3\",\r\n    \"message\" : \"test3\"\r\n}\r\n'\r\n```\r\n 3. Set cross cluster search on cluster_1\r\n```\r\ncurl -XPUT 'localhost:9200/_cluster/settings?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"persistent\": {\r\n    \"search\": {\r\n      \"remote\": {\r\n        \"cluster_2\": {\r\n          \"seeds\": [\r\n            \"127.0.0.1:9302\"\r\n          ]\r\n        },\r\n        \"cluster_3\": {\r\n          \"seeds\": [\r\n            \"127.0.0.1:9303\"\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n'\r\n```\r\n4. Down cluster_3\r\n5. Get all test-* indexes from cluster_2 and cluster_3\r\n```\r\ncurl -XPOST 'localhost:9200/*:test-*/data/_search?pretty' -H 'Content-Type: application/json' -d'\r\n{\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  }\r\n}\r\n'\r\n```\r\nPlease also see console output from the test case:\r\n[test.console.txt](https://github.com/elastic/elasticsearch/files/1211490/test.console.txt)","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}