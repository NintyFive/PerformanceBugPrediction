{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29631/events","html_url":"https://github.com/elastic/elasticsearch/issues/29631","id":316211321,"node_id":"MDU6SXNzdWUzMTYyMTEzMjE=","number":29631,"title":"Expose the lucene Matches API to searches","user":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2018-04-20T10:18:10Z","updated_at":"2020-04-01T21:45:09Z","closed_at":"2018-08-21T13:42:24Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The ability to tell exactly where a query has matched in a document is something that's been requested many times (see for example #5736).  The solution has normally been to try and parse something out of a highlighter or query explanation, but in lucene 7.4 we will be able to get this information directly from the new Matches API.\r\n\r\nThis can be implemented similarly to the existing Explain API:\r\n* by adding `matches=true` to the body of a search request\r\n* via a REST endpoint `[index]/[doc]/_explain`\r\n\r\nThe response in both cases would be an array of match objects, looking something like this:\r\n```\r\n\"matches\" : [\r\n    \"field1\" : [ { \"startPosition\" : 1, \"endPosition\" : 1, \r\n                      \"startUTF16Offset\" : 34, \"endUTF16Offset\" : 43,\r\n                      \"terms\" : [ \"badgering\" ] }, ... ],\r\n    \"field2\" : [ ... ],\r\n    ...\r\n]\r\n```\r\n\r\nWe need to make it clear that the offsets are using UTF-16 encoding.  If offsets are not stored in the index, they will need to be derived by re-analyzing the source somehow (either using a MemoryIndex or just extracting offsets from a TokenStream), and limits will need to be put on this, similar to the limits on highlighting.  This process may be expensive, so it should also be possible to return only the positions.","closed_by":{"login":"romseygeek","id":1347065,"node_id":"MDQ6VXNlcjEzNDcwNjU=","avatar_url":"https://avatars0.githubusercontent.com/u/1347065?v=4","gravatar_id":"","url":"https://api.github.com/users/romseygeek","html_url":"https://github.com/romseygeek","followers_url":"https://api.github.com/users/romseygeek/followers","following_url":"https://api.github.com/users/romseygeek/following{/other_user}","gists_url":"https://api.github.com/users/romseygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/romseygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romseygeek/subscriptions","organizations_url":"https://api.github.com/users/romseygeek/orgs","repos_url":"https://api.github.com/users/romseygeek/repos","events_url":"https://api.github.com/users/romseygeek/events{/privacy}","received_events_url":"https://api.github.com/users/romseygeek/received_events","type":"User","site_admin":false},"performed_via_github_app":null}