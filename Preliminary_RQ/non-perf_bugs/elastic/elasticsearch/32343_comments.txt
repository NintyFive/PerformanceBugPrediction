[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407517995","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407517995","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407517995,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzUxNzk5NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T19:05:48Z","updated_at":"2018-07-24T19:05:48Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407518231","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407518231","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407518231,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzUxODIzMQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T19:06:43Z","updated_at":"2018-07-24T19:06:43Z","author_association":"MEMBER","body":"This is where the deprecation warning gets logged: https://github.com/elastic/elasticsearch/blob/6.x/server/src/main/java/org/elasticsearch/script/ScriptModule.java#L96","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407532752","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407532752","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407532752,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzUzMjc1Mg==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T19:59:56Z","updated_at":"2018-07-24T19:59:56Z","author_association":"MEMBER","body":"I think there are two separate issues here -- the first is a bug I introduced in `RangeQueryBuilderTests` while backporting field aliases. This looks to be the cause of the CI failure, and I'm investigating it now.\r\n\r\nI've only seen the script deprecation warning cause failures when running from an IDE, not on CI (or running locally using gradle). I think @mayya-sharipova has been looking into fixing the IDE-related failures.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407535114","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407535114","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407535114,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzUzNTExNA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T20:08:04Z","updated_at":"2018-07-24T20:08:04Z","author_association":"MEMBER","body":"@jtibshirani thanks, do you have any idea why the reproduction information in the CI failure itself does not work if the problem indeed was introduced by backporting field aliases? I'm curious why this doesn't work.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407536171","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407536171","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407536171,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzUzNjE3MQ==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T20:11:41Z","updated_at":"2018-07-24T20:11:41Z","author_association":"MEMBER","body":"I'm sorry, I missed that in your above description. I will take a closer look, maybe it's not as simple an issue as I was thinking.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407541429","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407541429","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407541429,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzU0MTQyOQ==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T20:29:39Z","updated_at":"2018-07-24T20:29:39Z","author_association":"CONTRIBUTOR","body":"@cbuescher @jtibshirani  Tests failing on running from IDE  on 6.x is indeed the problem I introduced. As @cbuescher noted, it is indeed because of the deprecation warning in ScriptModule.  We have a tentative solution for it, and I will try to implement it tomorrow.  Sorry for this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407570559","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407570559","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407570559,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzU3MDU1OQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T22:18:58Z","updated_at":"2018-07-24T22:18:58Z","author_association":"MEMBER","body":"Another failure (if it helps): https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+intake/2142/consoleFull","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407579623","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407579623","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407579623,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzU3OTYyMw==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2018-07-24T23:03:55Z","updated_at":"2018-07-24T23:13:21Z","author_association":"MEMBER","body":"I can reproduce the failure through both jenkins reproduce lines, if I pretend in the test that the current version is something in `5.x`, like `5.6.0`. The error that was causing the test failure was\r\n\r\n```\r\nERROR   0.95s | RangeQueryBuilderTests.testToQuery <<< FAILURES!\r\n   > Throwable #1: java.lang.UnsupportedOperationException\r\n   >    at __randomizedtesting.SeedInfo.seed([9B44659863E52D55:6CBF67A61266E8BF]:0)\r\n   >    at org.elasticsearch.index.query.RangeQueryBuilderTests.doAssertLuceneQuery(RangeQueryBuilderTests.java:236)\r\n```\r\n\r\nThis allowed me to narrow in on some faulty logic I introduced in the field-aliases backport, and I pushed a fix in https://github.com/elastic/elasticsearch/commit/2d7c614. With the fix, I was able to successfully run the test many times locally, and also run the reproduce commands (with the older version number set). The problem @mayya-sharipova is looking into should not be causing CI failures, so I think we're good to close out the issue.\r\n\r\nOne thing that would still be good to dig into (as @cbuescher pointed out above): I'm not sure why the reproduce lines from jenkins only worked when the current version was set to `5.x`, instead of the latest `6.x` release. Is it possible that as part of the build, we're running this suite using an older version?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407673508","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407673508","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407673508,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzY3MzUwOA==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-07-25T08:18:32Z","updated_at":"2018-07-25T08:18:32Z","author_association":"MEMBER","body":"> One thing that would still be good to dig into (as @cbuescher pointed out above): I'm not sure why the reproduce lines from jenkins only worked when the current version was set to 5.x, instead of the latest 6.x release. Is it possible that as part of the build, we're running this suite using an older version?\r\n\r\n@jtibshirani thanks for pushing the fix, the test failures seem to be gone on 6.x for now. I'll try dig into the weird reproduction behaviour a bit today and will close this issue afterwards (even if I don't find anything for now...)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407753401","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-407753401","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":407753401,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzc1MzQwMQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-07-25T13:26:16Z","updated_at":"2018-07-25T13:26:16Z","author_association":"MEMBER","body":"About the (non)-reproducability of the above error. I tested this by checking out the commit the above CI failure was run on (afddef2b8fb).\r\nThen: \r\n\r\n```\r\n./gradlew :server:test \\\r\n  -Dtests.seed=D173DFCE4EA25D4A \\\r\n  -Dtests.class=org.elasticsearch.index.query.RangeQueryBuilderTests \\\r\n  -Dtests.method=\"testToQuery\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=he \\\r\n  -Dtests.timezone=IST\r\n```\r\npasses (it should have failed, since its the reproduction line that is logged)\r\n\r\nAfter removing specifying the method this fails:\r\n```\r\n./gradlew :server:test \\\r\n  -Dtests.seed=D173DFCE4EA25D4A \\\r\n  -Dtests.class=org.elasticsearch.index.query.RangeQueryBuilderTests \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=he \\\r\n  -Dtests.timezone=IST\r\n```\r\n\r\nThe full seed this fails for is reported as `D173DFCE4EA25D4A:2688DDF03F2198A0` so I went ahead and tried running both the above versions with that fixed seed:\r\n\r\nThis unfortunately succeeds:\r\n```\r\n./gradlew :server:test \\\r\n  -Dtests.seed=D173DFCE4EA25D4A:2688DDF03F2198A0 \\\r\n  -Dtests.class=org.elasticsearch.index.query.RangeQueryBuilderTests \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=he \\\r\n  -Dtests.timezone=IST\r\n```\r\n\r\nAlso just running the single method doesn't help. This passes successfully:\r\n```\r\n./gradlew :server:test \\\r\n  -Dtests.seed=D173DFCE4EA25D4A:2688DDF03F2198A0 \\\r\n  -Dtests.class=org.elasticsearch.index.query.RangeQueryBuilderTests \\\r\n  -Dtests.method=\"testToQuery\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=he \\\r\n  -Dtests.timezone=IST\r\n```\r\n\r\nI would have expected that specifying the full seed would lead to a deterministic behaviour of running the test, be it the whole suite or just one method.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/408101842","html_url":"https://github.com/elastic/elasticsearch/issues/32343#issuecomment-408101842","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32343","id":408101842,"node_id":"MDEyOklzc3VlQ29tbWVudDQwODEwMTg0Mg==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2018-07-26T13:42:55Z","updated_at":"2018-07-26T13:42:55Z","author_association":"MEMBER","body":"I opened #32400 for the reproducibility issue and will close this issue since the failure causing this is fixed.","performed_via_github_app":null}]