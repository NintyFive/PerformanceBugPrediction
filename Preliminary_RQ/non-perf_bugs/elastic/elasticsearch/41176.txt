{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41176","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41176/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41176/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41176/events","html_url":"https://github.com/elastic/elasticsearch/issues/41176","id":432830177,"node_id":"MDU6SXNzdWU0MzI4MzAxNzc=","number":41176,"title":"create elasticsearch client throws netty illegalstateexception in server enviroment","user":{"login":"dodolzg","id":3617756,"node_id":"MDQ6VXNlcjM2MTc3NTY=","avatar_url":"https://avatars2.githubusercontent.com/u/3617756?v=4","gravatar_id":"","url":"https://api.github.com/users/dodolzg","html_url":"https://github.com/dodolzg","followers_url":"https://api.github.com/users/dodolzg/followers","following_url":"https://api.github.com/users/dodolzg/following{/other_user}","gists_url":"https://api.github.com/users/dodolzg/gists{/gist_id}","starred_url":"https://api.github.com/users/dodolzg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dodolzg/subscriptions","organizations_url":"https://api.github.com/users/dodolzg/orgs","repos_url":"https://api.github.com/users/dodolzg/repos","events_url":"https://api.github.com/users/dodolzg/events{/privacy}","received_events_url":"https://api.github.com/users/dodolzg/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-04-13T09:53:33Z","updated_at":"2019-12-15T03:09:53Z","closed_at":"2019-04-13T16:37:56Z","author_association":"NONE","active_lock_reason":null,"body":"The error info\r\n\r\n> Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.elasticsearch.client.transport.TransportClient]: Factory method 'elasticsearchClient' threw exception; nested exception is java.lang.IllegalStateException: availableProcessors is already set to [4], rejecting [4]\r\n        at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:185)\r\n        at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:583)\r\n        ... 112 more\r\nCaused by: java.lang.IllegalStateException: availableProcessors is already set to [4], rejecting [4]\r\n        at io.netty.util.NettyRuntime$AvailableProcessorsHolder.setAvailableProcessors(NettyRuntime.java:51)\r\n        at io.netty.util.NettyRuntime.setAvailableProcessors(NettyRuntime.java:87)\r\n        at org.elasticsearch.transport.netty4.Netty4Utils.setAvailableProcessors(Netty4Utils.java:85)\r\n        at org.elasticsearch.transport.netty4.Netty4Transport.<init>(Netty4Transport.java:140)\r\n        at org.elasticsearch.transport.Netty4Plugin.lambda$getTransports$0(Netty4Plugin.java:93)\r\n        at org.elasticsearch.client.transport.TransportClient.buildTemplate(TransportClient.java:177)\r\n        at org.elasticsearch.client.transport.TransportClient.<init>(TransportClient.java:257)\r\n\r\nAnd I add \"System.setProperty(\"es.set.netty.runtime.available.processors\", \"false\");\"\r\n`public static void main(final String[] args) {`\r\n`System.setProperty(\"es.set.netty.runtime.available.processors\", \"false\");`\r\n`SpringApplication springApplication = new SpringApplication(Application.class);`\r\n`springApplication.addListeners(new ApplicationPidFileWriter(\"sns.pid\"));`\r\n`springApplication.run(args);`\r\n`}`\r\n\r\nIt works in my local enviroment(oracle jdk1.8), but does not work in server \r\nenviroment(openjdk1.8).\r\nI am not sure whether the jdk version matters? If not, how to solve the error?Thanks.\r\n\r\nOS: Centos\r\nSpringboot: 2.0.6\r\nElasticsearch: 6.3.1\r\n\r\n\r\n\r\nMaven dependency\r\n\r\n> <dependency>\r\n            <groupId>org.springframework.data</groupId>\r\n            <artifactId>spring-data-elasticsearch</artifactId>\r\n            <version>3.1.3.RELEASE</version>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.springframework.boot</groupId>\r\n            <artifactId>spring-boot-starter-data-elasticsearch</artifactId>\r\n            <version>2.0.6.RELEASE</version>\r\n        </dependency>\r\n\r\nApplication.properties\r\n> spring.data.elasticsearch.cluster-nodes=127.0.0.1:9300\r\nspring.data.elasticsearch.cluster-name=elasticsearch\r\nspring.data.elasticsearch.repositories.enabled=true","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}