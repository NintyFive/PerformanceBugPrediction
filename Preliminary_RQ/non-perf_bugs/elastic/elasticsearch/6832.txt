{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6832","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6832/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6832/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6832/events","html_url":"https://github.com/elastic/elasticsearch/issues/6832","id":37652984,"node_id":"MDU6SXNzdWUzNzY1Mjk4NA==","number":6832,"title":"ElasticSearch should start after NTP","user":{"login":"tiran","id":444071,"node_id":"MDQ6VXNlcjQ0NDA3MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/444071?v=4","gravatar_id":"","url":"https://api.github.com/users/tiran","html_url":"https://github.com/tiran","followers_url":"https://api.github.com/users/tiran/followers","following_url":"https://api.github.com/users/tiran/following{/other_user}","gists_url":"https://api.github.com/users/tiran/gists{/gist_id}","starred_url":"https://api.github.com/users/tiran/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tiran/subscriptions","organizations_url":"https://api.github.com/users/tiran/orgs","repos_url":"https://api.github.com/users/tiran/repos","events_url":"https://api.github.com/users/tiran/events{/privacy}","received_events_url":"https://api.github.com/users/tiran/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-07-11T11:39:14Z","updated_at":"2014-07-11T13:17:12Z","closed_at":"2014-07-11T13:14:22Z","author_association":"NONE","active_lock_reason":null,"body":"The elasticsearch init script requires $network $remote_fs $named as dependencies but not NTP. This causes an issue on virtual machines with a bad clock source. For example this just happened after a reboot of one of our ES nodes:\n\n```\n[2014-07-11 13:08:32,413][INFO ][node                     ] [Elixir] closing ...\n[2014-07-11 13:08:32,678][INFO ][node                     ] [Elixir] closed\n```\n\n**reboot**\n\n```\n[2014-07-11 13:07:26,993][WARN ][common.jna               ] Unable to lock JVM memory (ENOMEM). This can result in part of the JVM being swapped out. Increase RLIMIT_MEMLOCK or run elasticsearch as root.\n[2014-07-11 13:07:27,261][INFO ][node                     ] [Equilibrius] version[1.2.1], pid[1867], build[ffc086b/2014-06-23T13:26:38Z]\n[2014-07-11 13:07:27,261][INFO ][node                     ] [Equilibrius] initializing ...\n[2014-07-11 13:07:27,368][INFO ][plugins                  ] [Equilibrius] loaded [river-rabbitmq, analysis-phonetic], sites [paramedic, head, bigdesk]\n[2014-07-11 13:07:31,769][INFO ][node                     ] [Equilibrius] initialized\n[2014-07-11 13:07:31,769][INFO ][node                     ] [Equilibrius] starting ...\n[2014-07-11 13:07:32,096][INFO ][transport                ] [Equilibrius] bound_address {inet[/0.0.0.0:9300]}, publish_address {inet[/10.107.60.184:9300]}\n```\n\n**NTP kicked in and corrects clock**\n\n```\n[2014-07-11 13:09:30,957][INFO ][cluster.service          ] [Equilibrius] new_master [Equilibrius][knWq6pPaQByj4cgULAqczg][shop-api-search4][inet[/10.107.60.184:9300]], reason: zen-disco-join (elected_as_master)\n[2014-07-11 13:09:30,972][INFO ][discovery                ] [Equilibrius] ant-core-search/knWq6pPaQByj4cgULAqczg\n[2014-07-11 13:09:31,065][INFO ][http                     ] [Equilibrius] bound_address {inet[/0.0.0.0:9200]}, publish_address {inet[/10.107.60.184:9200]}\n[2014-07-11 13:09:31,148][DEBUG][action.search.type       ] [Equilibrius] All shards failed for phase: [query_fetch]\n```\n\nThe clock skew caused the ES node to announce itself as master although it should have joined a cluster with five nodes.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}