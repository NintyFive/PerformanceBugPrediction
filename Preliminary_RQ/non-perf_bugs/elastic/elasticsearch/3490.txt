{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3490","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3490/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3490/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3490/events","html_url":"https://github.com/elastic/elasticsearch/issues/3490","id":17949133,"node_id":"MDU6SXNzdWUxNzk0OTEzMw==","number":3490,"title":"Different json response for arrays between get and search using fields","user":{"login":"arosenheinrich","id":5214937,"node_id":"MDQ6VXNlcjUyMTQ5Mzc=","avatar_url":"https://avatars0.githubusercontent.com/u/5214937?v=4","gravatar_id":"","url":"https://api.github.com/users/arosenheinrich","html_url":"https://github.com/arosenheinrich","followers_url":"https://api.github.com/users/arosenheinrich/followers","following_url":"https://api.github.com/users/arosenheinrich/following{/other_user}","gists_url":"https://api.github.com/users/arosenheinrich/gists{/gist_id}","starred_url":"https://api.github.com/users/arosenheinrich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arosenheinrich/subscriptions","organizations_url":"https://api.github.com/users/arosenheinrich/orgs","repos_url":"https://api.github.com/users/arosenheinrich/repos","events_url":"https://api.github.com/users/arosenheinrich/events{/privacy}","received_events_url":"https://api.github.com/users/arosenheinrich/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"assignees":[{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2013-08-12T16:06:25Z","updated_at":"2014-01-13T11:39:10Z","closed_at":"2014-01-10T15:57:44Z","author_association":"NONE","active_lock_reason":null,"body":"I noticed a problem returning values for an array when specifying fields to return. I indexed a document containing an empty array and an array containing just one element. Getting the whole document works fine:\n\ncurl -XGET http://localhost:9300/picture/picture_object/16084571\n{\"_index\":\"picture\",\"_type\":\"picture_object\",\"_id\":\"16084571\",\"_version\":1,\"exists\":true, \"_source\" : {\"URI\":\"16084571\",\"CATEGORY\":[],\"MAINCOLORS\":[\"#c0c0c0\"]}}\n\nThis is the result as expected. Next thing I tried was reading just certain fields:\n\ncurl -XGET http://localhost:9300/picture/picture_object/16084571?fields=MAINCOLORS,CATEGORY\n{\"_index\":\"picture\",\"_type\":\"picture_object\",\"_id\":\"16084571\",\"_version\":1,\"exists\":true,\"fields\":{\"MAINCOLORS\":\"#c0c0c0\"}}\n\nCategory is not returned, I would have expected an empty array here. Maincolors became a single element, not an array anymore. Finally, I tried searching and returning fields:\n\ncurl -XGET http://localhost:9300/picture/picture_object/_search -d '{\"query\":{\"term\":{\"_id\":16084571}},\"fields\":[\"CATEGORY\",\"MAINCOLORS\"]}'\n{\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":8,\"successful\":8,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":1.0,\"hits\":[{\"_index\":\"picture\",\"_type\":\"picture_object\",\"_id\":\"16084571\",\"_score\":1.0,\"fields\":{\"MAINCOLORS\":[\"#c0c0c0\"],\"CATEGORY\":[]}}]}}\n\nThis test was done on elasticsearch 0.90.2 and 0.90.3. I compared it with 0.20.2, there was the result the expected one:\n\ncurl -XGET http://localhost:9300/picture/picture_object/16084571?fields=CATEGORY,PSCORE,MAINCOLORS\n{\"_index\":\"picture\",\"_type\":\"picture_object\",\"_id\":\"16084571\",\"_version\":1,\"exists\":true,\"fields\":{\"MAINCOLORS\":[\"#c0c0c0\"],\"CATEGORY\":[],\"PSCORE\":1515}}\n\nSo first there is a difference between search and get, second I would think that changing returned field from array to single element or not returning empty arrays is not right, the user probably had a reason for indexing an empty array or an array instead of just a single element.\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}