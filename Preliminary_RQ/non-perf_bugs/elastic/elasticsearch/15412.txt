{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15412","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15412/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15412/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15412/events","html_url":"https://github.com/elastic/elasticsearch/issues/15412","id":121956608,"node_id":"MDU6SXNzdWUxMjE5NTY2MDg=","number":15412,"title":"Provide per-node query latency percentiles, or the ability for a plugin to collect them.","user":{"login":"ebernhardson","id":558434,"node_id":"MDQ6VXNlcjU1ODQzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/558434?v=4","gravatar_id":"","url":"https://api.github.com/users/ebernhardson","html_url":"https://github.com/ebernhardson","followers_url":"https://api.github.com/users/ebernhardson/followers","following_url":"https://api.github.com/users/ebernhardson/following{/other_user}","gists_url":"https://api.github.com/users/ebernhardson/gists{/gist_id}","starred_url":"https://api.github.com/users/ebernhardson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebernhardson/subscriptions","organizations_url":"https://api.github.com/users/ebernhardson/orgs","repos_url":"https://api.github.com/users/ebernhardson/repos","events_url":"https://api.github.com/users/ebernhardson/events{/privacy}","received_events_url":"https://api.github.com/users/ebernhardson/received_events","type":"User","site_admin":false},"labels":[{"id":146836529,"node_id":"MDU6TGFiZWwxNDY4MzY1Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Stats","name":":Core/Features/Stats","color":"0e8a16","default":false,"description":"Statistics tracking and retrieval APIs"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-12-14T00:53:19Z","updated_at":"2016-06-24T11:02:32Z","closed_at":"2016-06-24T11:02:32Z","author_association":"NONE","active_lock_reason":null,"body":"From the existing stats i can derive per node average query latency, but the average isn't quite as interesting. Recording the 'took' time from queries I find that our percentiles come out to, roughly: 50th: 25ms, 75th: 70ms, 95th: 180ms, 99th: 8000ms. We run a non-homogeneous cluster so i'm really interested what the impact of some of the less performant hardware is on these percentiles. It would be quite interesting to learn that 99th percentile for one set of hardware is 3s, while the older hardware is up near 8s (completely guessing).\n\nI've looked over the existing code base and it does not look like a plugin can currently collect these things, I would probably need a way to access the timing information that currently flows through org.elasticsearch.index.search.stats.ShardSearchStats.\n\nCollecting percentiles within ES proper, providing a configuration mechanism for a plugin to replace the ShardSearchStats, or some kind of listener on ShardSearchStats would all be acceptable solutions to the problem.\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}