[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/41287267","html_url":"https://github.com/elastic/elasticsearch/issues/5930#issuecomment-41287267","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5930","id":41287267,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjg3MjY3","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-04-24T14:35:27Z","updated_at":"2014-04-24T14:35:27Z","author_association":"CONTRIBUTOR","body":"well I don't think it shoudl throw a NPE but on the other hand why whould you want to aggregate on a suggest field. you should use multi field for this IMO. @jpountz can you take a look at this NPE and provide a better error message?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/41664638","html_url":"https://github.com/elastic/elasticsearch/issues/5930#issuecomment-41664638","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5930","id":41664638,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjY0NjM4","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2014-04-29T11:22:18Z","updated_at":"2014-04-29T11:22:18Z","author_association":"CONTRIBUTOR","body":"If I understand correctly, currently the completion suggester creates a field (called \"domain\") in the above example which contains the content of \"input\" and is searchable but one cannot aggregate, because of the special format of this type ( @jpountz please correct if I am wrong). A better error message would be useful.\n\n> you should use multi field for this IMO.\n\nIt is unclear to me how `multi_field` can be used with the suggester here. The [documentation](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-suggesters-completion.html) is not too explicit: \n\n> Even though you are losing most of the features of the completion suggest, you can opt in for the shortest form, which even allows you to use inside of multi fields. But keep in mind, that you will not be able to use several inputs, an output, payloads or weights.\n\nI would have expected `multi_field` to work like this:\n\n```\n{\n   \"domain\": {\n      \"type\": \"multi_field\",\n      \"fields\": {\n         \"domain\": {\n            \"max_input_length\": 50,\n            \"preserve_separators\": true,\n            \"payloads\": false,\n            \"analyzer\": \"simple\",\n            \"preserve_position_increments\": true,\n            \"type\": \"completion\"\n         },\n         \"input\": {\n            \"type\": \"string\"\n         }\n      }\n   }\n}\n```\n\nand then expected that aggregation would work on \"domain.input\". Is that supposed to work so so? If so, I think it is broken.\n\nIn any case, it might be nice to have an option to make all parameter fields searchable and and also allow aggregations on them. Currently, the only way to do this seems to be to add the parameters to a field with a different name than the suggestion field. Instead, suggester could create these fields automatically if the user wants to. We could have something like:\n\n```\n{\n   \"domain\": {\n      \"max_input_length\": 50,\n      \"preserve_separators\": true,\n      \"payloads\": false,\n      \"analyzer\": \"simple\",\n      \"preserve_position_increments\": true,\n      \"type\": \"completion\",\n      \"input\": {\n              # Here be whatever the user likes to configure for indexing\n      },\n      \"output\": {\n             ...\n      },\n      ...\n   }\n}\n```\n\nwhich would cause creation of fields `\"domain.input\"`, `\"domain.output\"` and so on with user defined indexing options.\n\nDoes that make sense?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/41666712","html_url":"https://github.com/elastic/elasticsearch/issues/5930#issuecomment-41666712","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5930","id":41666712,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjY2NzEy","user":{"login":"moqichenle","id":3297592,"node_id":"MDQ6VXNlcjMyOTc1OTI=","avatar_url":"https://avatars2.githubusercontent.com/u/3297592?v=4","gravatar_id":"","url":"https://api.github.com/users/moqichenle","html_url":"https://github.com/moqichenle","followers_url":"https://api.github.com/users/moqichenle/followers","following_url":"https://api.github.com/users/moqichenle/following{/other_user}","gists_url":"https://api.github.com/users/moqichenle/gists{/gist_id}","starred_url":"https://api.github.com/users/moqichenle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/moqichenle/subscriptions","organizations_url":"https://api.github.com/users/moqichenle/orgs","repos_url":"https://api.github.com/users/moqichenle/repos","events_url":"https://api.github.com/users/moqichenle/events{/privacy}","received_events_url":"https://api.github.com/users/moqichenle/received_events","type":"User","site_admin":false},"created_at":"2014-04-29T11:52:32Z","updated_at":"2014-04-29T11:52:32Z","author_association":"NONE","body":"I tried multi_fiield and it works as what I wanted. \nThe mapping I use is similar to what @brwe mentioned.\n\n``` JSON\n{\n   \"domain\": {\n      \"type\": \"multi_field\",\n      \"fields\": {\n         \"domain\": {\n            \"max_input_length\": 50,\n            \"preserve_separators\": true,\n            \"payloads\": false,\n            \"analyzer\": \"simple\",\n            \"preserve_position_increments\": true,\n            \"type\": \"completion\"\n         },\n         \"input\": {\n            \"type\": \"string\"\n         }\n      }\n   }\n}\n```\n\nThank you for the hint @s1monw .\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/41666789","html_url":"https://github.com/elastic/elasticsearch/issues/5930#issuecomment-41666789","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5930","id":41666789,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjY2Nzg5","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-04-29T11:53:27Z","updated_at":"2014-04-29T11:53:27Z","author_association":"CONTRIBUTOR","body":"@brwe I just tried a multi-field setup, and this seems to work fine:\n\n``` json\nDELETE /test\n\nPUT /test\n{\n    \"mappings\": {\n        \"test\": {\n            \"properties\": {\n                \"my_field\": {\n                    \"type\": \"completion\",\n                    \"analyzer\": \"simple\",\n                    \"fields\": {\n                        \"raw\": {\n                            \"type\": \"string\",\n                            \"index\": \"not_analyzed\"\n                        }\n                    }\n                }\n            }\n        }\n    }\n}\n\nPUT /test/test/1\n{\n    \"my_field\": \"foo bar\"\n}\n\nPUT /test/test/2\n{\n    \"my_field\": \"foo bar baz\"\n}\n\nPOST /test/_refresh\n\nGET /test/_suggest\n{\n    \"my-suggest\" : {\n        \"text\" : \"foo b\",\n        \"completion\" : {\n            \"field\" : \"my_field\"\n        }\n    }\n}\n\nGET /test/_search\n{\n    \"aggs\": {\n        \"my_field_values\": {\n            \"terms\": {\n                \"field\": \"my_field.raw\"\n            }\n        }\n    }\n}\n```\n\nAdding capabilities to store `domain.input` and `domain.output` as you describe feels to me like reinventing multi-fields. I think we should rather fix the error message when trying to aggregate on a completion field and recommend on either indexing the field twice (eg. if you need to specify input and output separately) or using a multi-field as above for the simple cases.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/41669479","html_url":"https://github.com/elastic/elasticsearch/issues/5930#issuecomment-41669479","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5930","id":41669479,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjY5NDc5","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2014-04-29T12:29:25Z","updated_at":"2014-04-29T12:29:25Z","author_association":"CONTRIBUTOR","body":"Ah! Now I get it. I was trying out how this works when you explicitly provide \"input\" and \"output\" when indexing. I guess this is meant by \"opt in for the shortest form\".\nThanks for clarifying that this is not what was meant!\n\n> I think we should rather fix the error message\n\nOk, I'l just add the more descriptive error message.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/43435980","html_url":"https://github.com/elastic/elasticsearch/issues/5930#issuecomment-43435980","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5930","id":43435980,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNDM1OTgw","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-05-18T10:06:42Z","updated_at":"2014-05-18T10:06:42Z","author_association":"CONTRIBUTOR","body":"@brwe can you port this to `1.1.2`?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/43470259","html_url":"https://github.com/elastic/elasticsearch/issues/5930#issuecomment-43470259","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5930","id":43470259,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNDcwMjU5","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2014-05-19T06:41:27Z","updated_at":"2014-05-19T06:41:27Z","author_association":"CONTRIBUTOR","body":"done\n","performed_via_github_app":null}]