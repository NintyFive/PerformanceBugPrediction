[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384128993","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-384128993","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":384128993,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEyODk5Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-02-10T17:17:40Z","updated_at":"2018-04-25T01:13:51Z","author_association":"COLLABORATOR","body":"*Original comment by @jaymode:*\n\n+1 the documentation is very sparse about this feature in comparison to the rest.\n\n> How does this integrate into SSL/TLS secured clusters?\n\nFor remote indexing, you need to configure the client with the appropriate truststore and keystore. See below\n\n> Are we using transport protocol? It seems implied that we do but it'd be nice to be explicit (I checked the code but wasn't 100% sure).\n\nYes we startup a transport client to the remote cluster\n\n> Pending ^; Can HTTP be used instead?\n\nNo\n\n> What are these \"other settings\" that are mentioned below;\n\nThese other settings are any additional settings that need to be passed to the transport client such as shield.user or SSL config...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384128994","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-384128994","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":384128994,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEyODk5NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-02-24T20:44:46Z","updated_at":"2018-04-25T01:13:51Z","author_association":"COLLABORATOR","body":"*Original comment by @ppf2:*\n\nWe still don't have instructions on setting up remote auditing with SSL today in Xpack on 5.x.\r\n(And the settings are also missing from the X-pack Settings settings page).  So I am trying to figure out what the settings look like on 5.x.\r\n\r\nSo far, I am not able to get this working on 5.2.  I am using certgen to create certs for both clusters so they should be signed by the same ca.\r\n\r\nOn live cluster:\r\n\r\n```\r\nxpack.ssl.key: /Users/pius/Elastic/ElasticStack_5_2/5.2.0/elasticsearch-5.2.0_ssl/config/x-pack/certificate-bundle/127.0.0.1_live/127.0.0.1_live.key\r\nxpack.ssl.certificate: /Users/pius/Elastic/ElasticStack_5_2/5.2.0/elasticsearch-5.2.0_ssl/config/x-pack/certificate-bundle/127.0.0.1_live/127.0.0.1_live.crt\r\n\r\nxpack.security.audit.index.client.hosts: 127.0.0.1:9333\r\nxpack.security.audit.index.client.cluster.name: es_5_0_2_ssl_marvel\r\nxpack.security.audit.index.client.xpack.security.user: elastic:changeme\r\nxpack.security.audit.index.client.xpack.ssl.certificate_authorities: [\"/Users/pius/Elastic/ElasticStack_5_2/5.2.0/elasticsearch-5.2.0_ssl/config/x-pack/certificate-bundle/ca/ca.crt\"]\r\nxpack.security.audit.index.client.xpack.security.transport.ssl.enabled: true\r\n```\r\n\r\nRemote cluster has the same reference to the ca:\r\n\r\n```\r\nxpack.ssl.certificate_authorities: [\"/Users/pius/Elastic/ElasticStack_5_2/5.2.0/elasticsearch-5.2.0_marvel_ssl/config/x-pack/certificate-bundle/ca/ca.crt\"]\r\n```\r\n\r\nIt throws an error as if the cert is bad.\r\n\r\n```\r\n[2017-02-24T12:38:24,687][WARN ][o.e.x.s.t.n.SecurityNetty4Transport] [security-audit-client-ssl_node] exception caught on transport layer [[id: 0x09d82287, L:0.0.0.0/0.0.0.0:55203 ! R:/127.0.0.1:9333]], closing connection\r\nio.netty.handler.codec.DecoderException: javax.net.ssl.SSLException: Received fatal alert: bad_certificate\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:442) ~[netty-codec-4.1.7.Final.jar:4.1.7.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:248) ~[netty-codec-4.1.7.Final.jar:4.1.7.Final]\r\n```\r\n\r\nSo I then tested the SSL connection using a standalone java transport client using the same cert, key, and ca files, and it works fine:\r\n\r\n```\r\n                .put(\"cluster.name\", \"es_5_0_2_ssl_marvel\")\r\n                .put(\"xpack.security.user\", \"elastic:changeme\")\r\n                .put(\"xpack.ssl.key\", \"/Users/pius/Elastic/ElasticStack_5_2/5.2.0/elasticsearch-5.2.0_ssl/config/x-pack/certificate-bundle/127.0.0.1_live/127.0.0.1_live.key\")\r\n                .put(\"xpack.ssl.certificate\", \"/Users/pius/Elastic/ElasticStack_5_2/5.2.0/elasticsearch-5.2.0_ssl/config/x-pack/certificate-bundle/127.0.0.1_live/127.0.0.1_live.crt\")\r\n                .put(\"xpack.ssl.certificate_authorities\", \"/Users/pius/Elastic/ElasticStack_5_2/5.2.0/elasticsearch-5.2.0_ssl/config/x-pack/certificate-bundle/ca/ca.crt\")\r\n                .put(\"xpack.security.transport.ssl.enabled\", \"true\")\r\n        .build())\r\n        .addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"127.0.0.1\"), 9333));\r\n```\r\n\r\nWhat am I missing here ? :) @jaymode ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384128995","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-384128995","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":384128995,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEyODk5NQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-02-27T12:39:47Z","updated_at":"2018-04-25T01:13:51Z","author_association":"COLLABORATOR","body":"*Original comment by @jaymode:*\n\n@ppf2 you're missing the `xpack.security.audit.index.client.xpack.ssl.certificate` and `xpack.security.audit.index.client.xpack.ssl.key` setting for the auditing transport client.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384128996","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-384128996","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":384128996,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEyODk5Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-02-27T19:12:27Z","updated_at":"2018-04-25T01:13:51Z","author_association":"COLLABORATOR","body":"*Original comment by @ppf2:*\n\nThanks @jaymode.  Ah, works now, thx!\r\n\r\n@debadair \r\nWe now have multiple customers running into this.  While I could write a KB article on this, this information really belongs in documentation for they are required for proper set up of remote auditing for SSL enabled clusters.\r\n\r\nSpecifically, please update the documentation with the following:\r\n\r\n1.  Update the [forwarding audit logs section](https://www.elastic.co/guide/en/x-pack/current/auditing.html#_forwarding_audit_logs_to_a_remote_cluster) to provide information on all the other options that are required when the remote cluster is SSL-enabled.\r\n\r\nThe additional options are:\r\n\r\n```\r\nxpack.security.audit.index.client.xpack.ssl.certificate\r\nxpack.security.audit.index.client.xpack.ssl.key\r\nxpack.security.audit.index.client.xpack.ssl.certificate_authorities\r\nxpack.security.audit.index.client.xpack.security.transport.ssl.enabled (set to true)\r\n```\r\n\r\n2.  Then for completeness, also add all `xpack.security.audit.index.client.*` settings (and any other ones that are not covered below - @jaymode anything else?) to the [list of available security settings](https://www.elastic.co/guide/en/x-pack/current/security-settings.html#security-settings).\r\n\r\n```\r\nxpack.security.audit.index.client.hosts\r\nxpack.security.audit.index.client.cluster.name\r\nxpack.security.audit.index.client.xpack.security.user\r\nxpack.security.audit.index.client.xpack.ssl.certificate\r\nxpack.security.audit.index.client.xpack.ssl.key\r\nxpack.security.audit.index.client.xpack.ssl.certificate_authorities\r\nxpack.security.audit.index.client.xpack.security.transport.ssl.enabled\r\nxpack.security.audit.index.client.transport.sniff\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384128997","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-384128997","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":384128997,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEyODk5Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-02-27T19:18:25Z","updated_at":"2018-04-25T01:13:52Z","author_association":"COLLABORATOR","body":"*Original comment by @debadair:*\n\nWill do!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384128999","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-384128999","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":384128999,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEyODk5OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2017-09-06T20:51:43Z","updated_at":"2018-04-25T01:13:52Z","author_association":"COLLABORATOR","body":"*Original comment by @inqueue:*\n\nSupport is still seeing multiple reports of users struggling to setup remote audit logging just on these two points alone:\r\n>>* Are we using transport protocol? It seems implied that we do but it'd be nice to be explicit (I checked the code but wasn't 100% sure).\r\n\r\n>Yes we startup a transport client to the remote cluster\r\n>>* Pending ^; Can HTTP be used instead?\r\n\r\n>No\r\n\r\nCovering these items in the docs would be extremely helpful @debadair.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384129001","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-384129001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":384129001,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEyOTAwMQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T16:35:50Z","updated_at":"2018-04-25T01:13:52Z","author_association":"COLLABORATOR","body":"*Original comment by @fxdgear:*\n\nbump @debadair @ppf2 I'm on site with a customer and having issues getting this to work. \r\n\r\nhas there been any progress on getting the docs up to date?\r\n\r\n ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/389365633","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-389365633","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":389365633,"node_id":"MDEyOklzc3VlQ29tbWVudDM4OTM2NTYzMw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2018-05-16T01:29:13Z","updated_at":"2018-05-16T01:29:13Z","author_association":"CONTRIBUTOR","body":"@lcawl Bump - it would be good to at least update the docs to clarify that `hosts` should point to the transport port rather than the http port (actully, the port can just be left blank if the remote cluster is using the default port of `9300`).\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/389616105","html_url":"https://github.com/elastic/elasticsearch/issues/29692#issuecomment-389616105","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29692","id":389616105,"node_id":"MDEyOklzc3VlQ29tbWVudDM4OTYxNjEwNQ==","user":{"login":"sgelastic","id":28350872,"node_id":"MDQ6VXNlcjI4MzUwODcy","avatar_url":"https://avatars1.githubusercontent.com/u/28350872?v=4","gravatar_id":"","url":"https://api.github.com/users/sgelastic","html_url":"https://github.com/sgelastic","followers_url":"https://api.github.com/users/sgelastic/followers","following_url":"https://api.github.com/users/sgelastic/following{/other_user}","gists_url":"https://api.github.com/users/sgelastic/gists{/gist_id}","starred_url":"https://api.github.com/users/sgelastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgelastic/subscriptions","organizations_url":"https://api.github.com/users/sgelastic/orgs","repos_url":"https://api.github.com/users/sgelastic/repos","events_url":"https://api.github.com/users/sgelastic/events{/privacy}","received_events_url":"https://api.github.com/users/sgelastic/received_events","type":"User","site_admin":false},"created_at":"2018-05-16T18:16:58Z","updated_at":"2018-05-16T18:16:58Z","author_association":"NONE","body":"We should also point out that user account on the elasticsearch user on the monitoring cluster must have permissions to create .security-audit.\r\n\r\nMany users have more conservative role based permissions, so it's helpful to provide this info for them.","performed_via_github_app":null}]