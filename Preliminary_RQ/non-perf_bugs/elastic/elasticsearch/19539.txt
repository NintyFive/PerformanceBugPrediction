{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19539","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19539/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19539/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19539/events","html_url":"https://github.com/elastic/elasticsearch/issues/19539","id":166844988,"node_id":"MDU6SXNzdWUxNjY4NDQ5ODg=","number":19539,"title":"Bucket aggregation for names in named queries","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-07-21T15:14:50Z","updated_at":"2016-07-27T14:03:18Z","closed_at":"2016-07-27T14:03:18Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"If naming query clauses is useful for adding context to individual top hits it is arguably also useful context for reviewing larger collections of results in aggregations.\n\nMy assumption is that the names of the clauses that matched each doc accompany it as it is collected so that they can be displayed in top hits. If correct, this means a new bucket agg could route docs into buckets based on these query names. I don't think this would require any special parameters in the DSL so would look something like this:\n\n```\nGET ofac/_search\n{\n   \"query\": {\n      \"bool\": {\n         \"should\": [\n            {\n               \"match\": {\n                  \"_all\": {\n                     \"query\": \"chicken turkey\",\n                     \"_name\": \"poultry\"\n                  }\n               }\n            },\n            {\n               \"match\": {\n                  \"_all\": {\n                     \"query\": \"pork beef\",\n                     \"_name\": \"meat\"\n                  }\n               }\n            },\n            {\n               \"match\": {\n                  \"_all\": {\n                     \"query\": \"spaghetti penne linguine\",\n                     \"_name\": \"pasta\"\n                  }\n               }\n            }\n\n         ]\n      }\n   },\n   \"size\": 0,\n   \"aggs\": {\n      \"clauses\": {\n         \"named_queries\": {\n         },\n         \"aggs\": {\n             ....\n         }\n      }\n   }\n}\n```\n\nThe results would show buckets keyed with the names `poultry` and `meat` etc.\nAn interesting twist is that a named_queries agg could be nested under another named_queries agg and the results effectively represent a weighted graph showing if poultry or meat was a more common ingredient with pasta dishes.\n","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}