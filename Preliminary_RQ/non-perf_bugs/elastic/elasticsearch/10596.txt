{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10596","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10596/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10596/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10596/events","html_url":"https://github.com/elastic/elasticsearch/issues/10596","id":68464391,"node_id":"MDU6SXNzdWU2ODQ2NDM5MQ==","number":10596,"title":"Crash Error: \"NoClassDefFoundError\"","user":{"login":"daveharmon","id":5307512,"node_id":"MDQ6VXNlcjUzMDc1MTI=","avatar_url":"https://avatars1.githubusercontent.com/u/5307512?v=4","gravatar_id":"","url":"https://api.github.com/users/daveharmon","html_url":"https://github.com/daveharmon","followers_url":"https://api.github.com/users/daveharmon/followers","following_url":"https://api.github.com/users/daveharmon/following{/other_user}","gists_url":"https://api.github.com/users/daveharmon/gists{/gist_id}","starred_url":"https://api.github.com/users/daveharmon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daveharmon/subscriptions","organizations_url":"https://api.github.com/users/daveharmon/orgs","repos_url":"https://api.github.com/users/daveharmon/repos","events_url":"https://api.github.com/users/daveharmon/events{/privacy}","received_events_url":"https://api.github.com/users/daveharmon/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-04-14T18:37:30Z","updated_at":"2015-04-15T16:39:57Z","closed_at":"2015-04-15T16:39:56Z","author_association":"NONE","active_lock_reason":null,"body":"Hi all, \nI'm working on getting started with elastic search (latest version).  All of my simple tests work great and the guide (which I have read several times and definitely completed every necessary step) is really helpful for general things.  However I plan on using elastic search as a dependency in a storm project so I need to deploy it to a single jar.  I've researched my error a lot and it seems like an issue with maven's shading that you guys use and I'm wondering if someone has some experience and can point me in the right direction.  I'm thinking that there is something wrong with my POM file that doesn't allow me to use certain functions I'm just not sure what to do at all.\n\nThe storm node successfully creates a node and client that connect to elastic search and this error comes when I attempt a client.prepareIndex().actionGet() call (specifics omitted).  The index and type that it tries to put into are already created on the elastic side (using curl).\n\nMy stack trace is something like this:\n{ there are a bunch of storm errors here emanating from my elasticsearch storage bolt}\n Caused by: java.lang.NoClassDefFoundError: Could not initialize class org.elasticsearch.index.codec.postingsformat.PostingFormats\n     at org.elasticsearch.index.codec.CodecModule.configurePostingsFormats(CodecModule.java:126) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.index.codec.CodecModule.configure(CodecModule.java:178) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.inject.AbstractModule.configure(AbstractModule.java:60) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.inject.spi.Elements$RecordingBinder.install(Elements.java:204) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.inject.spi.Elements.getElements(Elements.java:85) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.inject.InjectorShell$Builder.build(InjectorShell.java:130) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:99) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.inject.InjectorImpl.createChildInjector(InjectorImpl.java:131) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.inject.ModulesBuilder.createChildInjector(ModulesBuilder.java:69) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.indices.IndicesService.createIndex(IndicesService.java:328) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.cluster.metadata.MetaDataCreateIndexService$2.execute(MetaDataCreateIndexService.java:372) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:365) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:188) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:158) ~[mdec-storm-1.0-SNAPSHOT-jar-with-dependencies.jar:na]\n     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) ~[na:1.7.0_75]\n     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) ~[na:1.7.0_75]\n\nand my pom file looks like this:\n<project\n\n```\n...\n <parent>\n     ...\n </parent>\n ...\n <properties>\n     <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n     <skipTests>true</skipTests>\n </properties>\n\n <repositories>\n     ...\n </repositories>\n\n <dependencies>\n```\n\n ...\n         <!-- elastic search dependencies start -->\n         <dependency>\n             <groupId>org.elasticsearch</groupId>\n             <artifactId>elasticsearch</artifactId>\n         </dependency>\n         <!-- elastic search dependencies end -->  \n         ...\n     </dependencies>\n\n```\n <build>\n     <sourceDirectory>src/main/java</sourceDirectory>\n     <testSourceDirectory>src/test</testSourceDirectory>\n     <resources>\n         <resource>\n             <directory>src/main/resources</directory>\n         </resource>\n     </resources>\n     <plugins>\n         <!--\n        bind the maven-assembly-plugin to the package phase\n         this will create a jar file without the storm dependencies\n         suitable for deployment to a cluster.\n          -->\n         <plugin>\n             <artifactId>maven-assembly-plugin</artifactId>\n             <configuration>\n                 <descriptorRefs>\n                     <descriptorRef>jar-with-dependencies</descriptorRef>\n                 </descriptorRefs>\n                 <archive>\n                     <manifest>\n                         <mainClass></mainClass>\n                     </manifest>\n                 </archive>\n             </configuration>\n             <executions>\n                 <execution>\n                     <id>make-assembly</id>\n                     <phase>package</phase>\n                     <goals>\n                         <goal>single</goal>\n                     </goals>\n                 </execution>\n             </executions>\n         </plugin>\n         <!-- added to try and fix elasticsearch  -->\n         <plugin>\n             <groupId>org.apache.maven.plugins</groupId>\n             <artifactId>maven-shade-plugin</artifactId>\n             <version>2.3</version>\n             <executions>\n                 <execution>\n                     <phase>package</phase>\n                     <goals>\n                         <goal>shade</goal>\n                     </goals>\n                 </execution>\n             </executions>\n         </plugin>\n         ...\n     </plugins>\n </build>\n```\n\n </project>\n\nThanks so much in advance\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}