[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322109848","html_url":"https://github.com/elastic/elasticsearch/issues/26152#issuecomment-322109848","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26152","id":322109848,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjEwOTg0OA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-08-14T06:29:28Z","updated_at":"2017-08-14T06:29:28Z","author_association":"CONTRIBUTOR","body":"We need more information here, in particular the full configuration of the nodes and master logs. Can you try to run the same scenario with logging level of `cluster.service` set to DEBUG? The log output you have shown here is not related to running `/_cat/shards`, the stack trace shows that this is an internal operation that is periodically run (by default every 10 seconds) to check network connections.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322278444","html_url":"https://github.com/elastic/elasticsearch/issues/26152#issuecomment-322278444","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26152","id":322278444,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjI3ODQ0NA==","user":{"login":"buildlackey","id":1577925,"node_id":"MDQ6VXNlcjE1Nzc5MjU=","avatar_url":"https://avatars3.githubusercontent.com/u/1577925?v=4","gravatar_id":"","url":"https://api.github.com/users/buildlackey","html_url":"https://github.com/buildlackey","followers_url":"https://api.github.com/users/buildlackey/followers","following_url":"https://api.github.com/users/buildlackey/following{/other_user}","gists_url":"https://api.github.com/users/buildlackey/gists{/gist_id}","starred_url":"https://api.github.com/users/buildlackey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/buildlackey/subscriptions","organizations_url":"https://api.github.com/users/buildlackey/orgs","repos_url":"https://api.github.com/users/buildlackey/repos","events_url":"https://api.github.com/users/buildlackey/events{/privacy}","received_events_url":"https://api.github.com/users/buildlackey/received_events","type":"User","site_admin":false},"created_at":"2017-08-14T18:59:26Z","updated_at":"2017-08-14T18:59:26Z","author_association":"NONE","body":"Hi there. We believe we have found the source of the bug.  We had max number of file descriptors set to 300K, and in our performance monitoring dashboards a colleague noticed that we were hitting that threshold very close to the same time we were seeing the problem that I reported in our logs (\"handshake failed, channel already closed...etc.\").     \r\n\r\nOur work-around was to increase the max number of open file descriptors (we picked 700K), and the problem no longer occurs for us. \r\n\r\nYou might want to chalk this up to a configuration problem, but it might also be valuable to see if there is some low level exception about 'max number of file descriptors reached' that is being swallowed in the code. You may also wish to update your release notes about this behavior, as 2.x didn't seem to hit this file descriptor limit as quickly as 5.x does. \r\n\r\n\r\nThank you for your help on this.  For now, we are able to proceed with large clusters.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/322589130","html_url":"https://github.com/elastic/elasticsearch/issues/26152#issuecomment-322589130","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26152","id":322589130,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMjU4OTEzMA==","user":{"login":"buildlackey","id":1577925,"node_id":"MDQ6VXNlcjE1Nzc5MjU=","avatar_url":"https://avatars3.githubusercontent.com/u/1577925?v=4","gravatar_id":"","url":"https://api.github.com/users/buildlackey","html_url":"https://github.com/buildlackey","followers_url":"https://api.github.com/users/buildlackey/followers","following_url":"https://api.github.com/users/buildlackey/following{/other_user}","gists_url":"https://api.github.com/users/buildlackey/gists{/gist_id}","starred_url":"https://api.github.com/users/buildlackey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/buildlackey/subscriptions","organizations_url":"https://api.github.com/users/buildlackey/orgs","repos_url":"https://api.github.com/users/buildlackey/repos","events_url":"https://api.github.com/users/buildlackey/events{/privacy}","received_events_url":"https://api.github.com/users/buildlackey/received_events","type":"User","site_admin":false},"created_at":"2017-08-15T21:06:16Z","updated_at":"2017-08-15T21:06:16Z","author_association":"NONE","body":"Hi, @ywelsch !  - unfortunately, the fix we thought would work did not quite do it. Still get stuck in initializing shards.   my colleague and i will work on getting the information you requested (hopefully by tomorrow).  /thnx","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323246346","html_url":"https://github.com/elastic/elasticsearch/issues/26152#issuecomment-323246346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26152","id":323246346,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzI0NjM0Ng==","user":{"login":"buildlackey","id":1577925,"node_id":"MDQ6VXNlcjE1Nzc5MjU=","avatar_url":"https://avatars3.githubusercontent.com/u/1577925?v=4","gravatar_id":"","url":"https://api.github.com/users/buildlackey","html_url":"https://github.com/buildlackey","followers_url":"https://api.github.com/users/buildlackey/followers","following_url":"https://api.github.com/users/buildlackey/following{/other_user}","gists_url":"https://api.github.com/users/buildlackey/gists{/gist_id}","starred_url":"https://api.github.com/users/buildlackey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/buildlackey/subscriptions","organizations_url":"https://api.github.com/users/buildlackey/orgs","repos_url":"https://api.github.com/users/buildlackey/repos","events_url":"https://api.github.com/users/buildlackey/events{/privacy}","received_events_url":"https://api.github.com/users/buildlackey/received_events","type":"User","site_admin":false},"created_at":"2017-08-18T02:55:39Z","updated_at":"2017-08-18T02:55:39Z","author_association":"NONE","body":"Hi.  This is not yet the info you requested.(working on that) . but other observations that might be helpful.\r\n\r\n\r\n**Not stuck forever:**\r\n\r\n * the cluster will go green if you wait long enough (an hour or so, sometimes just 10 minutes)\r\n      * but this seems very unreasonable for an index that consists of only one small document.\r\n\r\n**Not related to handhake exception:**\r\n\r\n * i cannot correlate this bug with the stack trace that includes IllegalstateException...handshake.\r\n    * that 'handshake' exception occurs on startup of our cluster... but does not occur when we \r\n      create the index and while the shards begin initializing.\r\n\r\n**Usually the same nodes are slow, but terminating them causes a new group to be slow:**\r\n\r\n* the nodes that are slow in initializing their shards are almost always the same ones.\r\n      * dmesg log looks clean for these nodes.\r\n      * even though two nodes continually show up as \"the slow ones\", when we terminate these \r\n        nodes (the Amazon AMI isntances)  we still have the slow shards issue when new \r\n        nodes are allocated to take the  place  of the terminated nodes in the auto scaling group.\r\n            * the next round of occurrences of 'shards stuck in initalizing state' (after termination) \r\n               again seems to involve at least one node over and over: with each run of the test\r\n               this   node (not one of the original set that was stuck) will always be one of the stuck ones.\r\n\r\n\r\n ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323442817","html_url":"https://github.com/elastic/elasticsearch/issues/26152#issuecomment-323442817","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26152","id":323442817,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzQ0MjgxNw==","user":{"login":"buildlackey","id":1577925,"node_id":"MDQ6VXNlcjE1Nzc5MjU=","avatar_url":"https://avatars3.githubusercontent.com/u/1577925?v=4","gravatar_id":"","url":"https://api.github.com/users/buildlackey","html_url":"https://github.com/buildlackey","followers_url":"https://api.github.com/users/buildlackey/followers","following_url":"https://api.github.com/users/buildlackey/following{/other_user}","gists_url":"https://api.github.com/users/buildlackey/gists{/gist_id}","starred_url":"https://api.github.com/users/buildlackey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/buildlackey/subscriptions","organizations_url":"https://api.github.com/users/buildlackey/orgs","repos_url":"https://api.github.com/users/buildlackey/repos","events_url":"https://api.github.com/users/buildlackey/events{/privacy}","received_events_url":"https://api.github.com/users/buildlackey/received_events","type":"User","site_admin":false},"created_at":"2017-08-18T19:36:09Z","updated_at":"2017-08-18T19:36:09Z","author_association":"NONE","body":"Hi. one of my colleagues filed a bug on this same issue, so we would like to close this bug as a duplicate of this one -> https://github.com/elastic/elasticsearch/issues/26293","performed_via_github_app":null}]