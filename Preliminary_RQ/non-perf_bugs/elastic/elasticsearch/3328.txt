{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3328","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3328/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3328/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3328/events","html_url":"https://github.com/elastic/elasticsearch/issues/3328","id":16734372,"node_id":"MDU6SXNzdWUxNjczNDM3Mg==","number":3328,"title":"Unexpected results with shingle tokenfilter and match with \"and\" operator","user":{"login":"ankane","id":220358,"node_id":"MDQ6VXNlcjIyMDM1OA==","avatar_url":"https://avatars3.githubusercontent.com/u/220358?v=4","gravatar_id":"","url":"https://api.github.com/users/ankane","html_url":"https://github.com/ankane","followers_url":"https://api.github.com/users/ankane/followers","following_url":"https://api.github.com/users/ankane/following{/other_user}","gists_url":"https://api.github.com/users/ankane/gists{/gist_id}","starred_url":"https://api.github.com/users/ankane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ankane/subscriptions","organizations_url":"https://api.github.com/users/ankane/orgs","repos_url":"https://api.github.com/users/ankane/repos","events_url":"https://api.github.com/users/ankane/events{/privacy}","received_events_url":"https://api.github.com/users/ankane/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2013-07-14T22:26:38Z","updated_at":"2013-07-17T12:14:07Z","closed_at":"2013-07-17T12:14:07Z","author_association":"NONE","active_lock_reason":null,"body":"``` sh\n#2013-07-14 15:19:38:885 [CREATE] (\"products\")\n#\ncurl -X POST http://localhost:9200/products -d '{\"settings\":{\"number_of_shards\":1,\"analysis\":{\"analyzer\":{\"searchkick\":{\"type\":\"custom\",\"tokenizer\":\"standard\",\"filter\":[\"standard\",\"lowercase\",\"despacer\"]}},\"filter\":{\"despacer\":{\"type\":\"shingle\",\"token_separator\":\"\"}}}},\"mappings\":{\"document\":{\"properties\":{\"name\":{\"type\":\"string\",\"analyzer\":\"searchkick\"}}}}}'\n\n#2013-07-14 15:19:38:885 [200]\n#\n# {\"ok\":true,\"acknowledged\":true}\n\n#2013-07-14 15:19:38:890 [document/] (\"products\")\n#\ncurl -X POST \"http://localhost:9200/products/document/\" -d '{\"name\":\"dish washer soap\"}'\n\n#2013-07-14 15:19:38:891 [201]\n#\n# {\"ok\":true,\"_index\":\"products\",\"_type\":\"document\",\"_id\":\"WHiXL30XSe2FrHAASzIfZw\",\"_version\":1}\n\n#2013-07-14 15:19:38:898 [_refresh] (\"products\")\n#\ncurl -X POST \"http://localhost:9200/products/_refresh\"\n\n#2013-07-14 15:19:38:898 [200]\n#\n# {\"ok\":true,\"_shards\":{\"total\":2,\"successful\":1,\"failed\":0}}\n\n#2013-07-14 15:19:38:902 [_search] ([\"products\"])\n#\ncurl -X GET 'http://localhost:9200/products/document/_search?pretty' -d '{\"query\":{\"match\":{\"name\":{\"query\":\"dish soap\",\"operator\":\"and\"}}}}'\n\n#2013-07-14 15:19:38:902 [200] (1 msec)\n#\n# {\"took\":1,\"timed_out\":false,\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"hits\":{\"total\":0,\"max_score\":null,\"hits\":[]}}\n```\n\nI expect the query to match \"dish washer soap\", but it returns no results.  It works with the \"or\" operator.\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}