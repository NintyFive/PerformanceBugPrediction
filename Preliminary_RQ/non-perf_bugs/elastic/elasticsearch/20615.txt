{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20615","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20615/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20615/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20615/events","html_url":"https://github.com/elastic/elasticsearch/issues/20615","id":178387656,"node_id":"MDU6SXNzdWUxNzgzODc2NTY=","number":20615,"title":"Template Validation can prevent chained Templates","user":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"labels":[{"id":163824881,"node_id":"MDU6TGFiZWwxNjM4MjQ4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Indices%20APIs","name":":Core/Features/Indices APIs","color":"0e8a16","default":false,"description":"APIs to create and manage indices"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-09-21T15:49:30Z","updated_at":"2018-02-13T20:39:41Z","closed_at":"2016-09-21T15:55:11Z","author_association":"MEMBER","active_lock_reason":null,"body":"``` http\nPUT _template/test\n{\n  \"template\": \"i*\",\n  \"settings\": {\n    \"analysis\": {\n      \"analyzer\": {\n        \"custom\": {\n          \"type\": \"custom\",\n          \"tokenizer\": \"keyword\"\n        }\n      }\n    }\n  }\n}\n\nPUT /_template/test1\n{\n  \"template\": \"index*\",\n  \"mappings\": {\n    \"type\": {\n      \"properties\": {\n        \"message\": {\n          \"type\": \"text\",\n          \"analyzer\": \"custom\"\n        }\n      }\n    }\n  }\n}\n```\n\nThe first template, which can be thought of as the parent template, defines something that is used by the second template: a custom analyzer. The template validator appears to only consider the template as a standalone one, which means that the analyzer does not exist, thus returning:\n\n``` json\n{\n  \"error\": {\n    \"root_cause\": [\n      {\n        \"type\": \"mapper_parsing_exception\",\n        \"reason\": \"analyzer [custom] not found for field [message]\"\n      }\n    ],\n    \"type\": \"mapper_parsing_exception\",\n    \"reason\": \"Failed to parse mapping [type]: analyzer [custom] not found for field [message]\",\n    \"caused_by\": {\n      \"type\": \"mapper_parsing_exception\",\n      \"reason\": \"analyzer [custom] not found for field [message]\"\n    }\n  },\n  \"status\": 400\n}\n```\n\nThe template validation should combine matching templates like normal index creation works, which would to ensure that the _entire_ chain is valid or invalid.\n\n**Workaround**\n\nThere is a workaround, which is to manually apply necessary pieces to the sub-template (e.g., duplicating the analyzer in it, which will be only appear once in the resulting index).\n","closed_by":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}