{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/61330","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61330/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61330/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61330/events","html_url":"https://github.com/elastic/elasticsearch/issues/61330","id":681867155,"node_id":"MDU6SXNzdWU2ODE4NjcxNTU=","number":61330,"title":"ElasticSearch on Kubernetes, one master nod not discovered among three","user":{"login":"shuhaibibrahim","id":52924174,"node_id":"MDQ6VXNlcjUyOTI0MTc0","avatar_url":"https://avatars3.githubusercontent.com/u/52924174?v=4","gravatar_id":"","url":"https://api.github.com/users/shuhaibibrahim","html_url":"https://github.com/shuhaibibrahim","followers_url":"https://api.github.com/users/shuhaibibrahim/followers","following_url":"https://api.github.com/users/shuhaibibrahim/following{/other_user}","gists_url":"https://api.github.com/users/shuhaibibrahim/gists{/gist_id}","starred_url":"https://api.github.com/users/shuhaibibrahim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shuhaibibrahim/subscriptions","organizations_url":"https://api.github.com/users/shuhaibibrahim/orgs","repos_url":"https://api.github.com/users/shuhaibibrahim/repos","events_url":"https://api.github.com/users/shuhaibibrahim/events{/privacy}","received_events_url":"https://api.github.com/users/shuhaibibrahim/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-08-19T14:03:23Z","updated_at":"2020-08-20T13:31:15Z","closed_at":"2020-08-20T13:31:15Z","author_association":"NONE","active_lock_reason":null,"body":"I have deployed an elasticsearch in Kubernetes with 3 masters and 3 data nodes. All the pods are running.\r\n\r\n```\r\nNAME                        READY   STATUS    RESTARTS   AGE\r\nelasticsearch-master-v1-0   1/1     Running   0          29m\r\nelasticsearch-master-v1-1   1/1     Running   0          29m\r\nelasticsearch-master-v1-2   1/1     Running   0          29m\r\n```\r\nNote: Now the replicaset for data-node deployment is set to 0.\r\n\r\n`Elasticsearch Version: 6.4.0`\r\n\r\nBut when I had checked the the node status through elasticsearch API, only two nodes are showing up.\r\n\r\nAPI CALL: /_cat/nodes?v\r\n\r\n```\r\nip              heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name\r\n192.188.158.230            2          38  27    0.35    0.21     0.15 m         *      elasticsearch-master-v1-1\r\n192.188.119.232            2          38  19    0.55    0.26     0.17 m         -      elasticsearch-master-v1-0\r\n```\r\nIt should show all the three master nodes above\r\n\r\nWhy the third node is not showing up here? The following are the relevant configuration in elasticsearch.yml file.\r\n\r\n```\r\ncluster:\r\n  name: ${CLUSTER_NAME}\r\n\r\nnode:\r\n  master: true\r\n  data: false\r\n  name: ${NODE_NAME}\r\n  ingest: false\r\n\r\nprocessors: ${PROCESSORS}\r\n\r\nnetwork.host: 0.0.0.0\r\n\r\npath:\r\n  data: ${DATA_PATH}\r\n  logs: ${LOG_PATH}\r\n\r\nbootstrap:\r\n  memory_lock: ${MEMORY_LOCK}\r\n\r\nhttp:\r\n  compression: true\r\n  cors:\r\n    enabled: true\r\n    allow-origin: \"*\"\r\n    \r\ndiscovery:\r\n  zen:\r\n    ping.unicast.hosts: elasticsearch-discovery-master\r\n    minimum_master_nodes: 2\r\n\r\nxpack.ml.enabled: false\r\nxpack.security.transport.ssl.enabled: true\r\nxpack.security.transport.ssl.verification_mode: certificate\r\nxpack.security.transport.ssl.keystore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\r\nxpack.security.transport.ssl.truststore.path: /usr/share/elasticsearch/config/certs/elastic-certificates.p12\r\n```\r\nI noticed that when in the above configuration `xpack.security.transport.ssl.enabled: false` on the same API call it showed all the three master nodes\r\n\r\nK8s Service yaml for inter node communication.\r\n\r\n```\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  labels:\r\n    app: elasticsearch-master\r\n  name: elasticsearch-discovery-master\r\nspec:\r\n  ports:\r\n  - name: transport\r\n    port: 9300\r\n    protocol: TCP\r\n    targetPort: 9300\r\n  selector:\r\n    app: elasticsearch-master\r\n  type: ClusterIP\r\n```\r\nThis is what the logs says from the third master node which is not discovered,\r\n```\r\n[2020-08-12T12:38:41,342][WARN ][o.e.d.z.ZenDiscovery     ] [elasticsearch-master-v1-2] not enough master nodes discovered during pinging (found [[Candidate{node={elasticsearch-master-v1-2}{F8L_VgGuRKWxxjKcQzhfzg}{ZPk-SAFESX2UFsEcH6Q7Hw}{192.188.193.101}{192.188.193.101:9300}{xpack.installed=true}, clusterStateVersion=-1}]], but needed [2]), pinging again\r\n[2020-08-12T12:38:50,616][WARN ][o.e.d.z.ZenDiscovery     ] [elasticsearch-master-v1-2] not enough master nodes discovered during pinging (found [[Candidate{node={elasticsearch-master-v1-2}{F8L_VgGuRKWxxjKcQzhfzg}{ZPk-SAFESX2UFsEcH6Q7Hw}{192.188.193.101}{192.188.193.101:9300}{xpack.installed=true}, clusterStateVersion=-1}]], but needed [2]), pinging again\r\n[2020-08-12T12:39:15,424][WARN ][o.e.d.z.ZenDiscovery     ] [elasticsearch-master-v1-2] not enough master nodes discovered during pinging (found [[Candidate{node={elasticsearch-master-v1-2}{F8L_VgGuRKWxxjKcQzhfzg}{ZPk-SAFESX2UFsEcH6Q7Hw}{192.188.193.101}{192.188.193.101:9300}{xpack.installed=true}, clusterStateVersion=-1}]], but needed [2]), pinging again\r\n[2020-08-12T12:39:18,425][WARN ][o.e.d.z.ZenDiscovery     ] [elasticsearch-master-v1-2] not enough master nodes discovered during pinging (found [[Candidate{node={elasticsearch-master-v1-2}{F8L_VgGuRKWxxjKcQzhfzg}{ZPk-SAFESX2UFsEcH6Q7Hw}{192.188.193.101}{192.188.193.101:9300}{xpack.installed=true}, clusterStateVersion=-1}]], but needed [2]), pinging again\r\n```","closed_by":{"login":"costin","id":76245,"node_id":"MDQ6VXNlcjc2MjQ1","avatar_url":"https://avatars3.githubusercontent.com/u/76245?v=4","gravatar_id":"","url":"https://api.github.com/users/costin","html_url":"https://github.com/costin","followers_url":"https://api.github.com/users/costin/followers","following_url":"https://api.github.com/users/costin/following{/other_user}","gists_url":"https://api.github.com/users/costin/gists{/gist_id}","starred_url":"https://api.github.com/users/costin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/costin/subscriptions","organizations_url":"https://api.github.com/users/costin/orgs","repos_url":"https://api.github.com/users/costin/repos","events_url":"https://api.github.com/users/costin/events{/privacy}","received_events_url":"https://api.github.com/users/costin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}