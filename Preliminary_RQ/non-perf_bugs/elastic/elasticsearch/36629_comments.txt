[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447236002","html_url":"https://github.com/elastic/elasticsearch/issues/36629#issuecomment-447236002","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36629","id":447236002,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzIzNjAwMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-12-14T07:09:44Z","updated_at":"2018-12-14T07:09:44Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447301630","html_url":"https://github.com/elastic/elasticsearch/issues/36629#issuecomment-447301630","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36629","id":447301630,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzMwMTYzMA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-12-14T11:45:54Z","updated_at":"2018-12-14T11:45:54Z","author_association":"CONTRIBUTOR","body":"Note that warnings for this would require a full scan of the data in the index, loading every source document to figure out whether it has duplicate fields.\r\n\r\n```\r\nOnce upgraded to 6.x, there are limited options to repair the problem documents due to the inability to use reindex without hitting the duplicate field error (even with the escape hatch enabled to disable validation: es.json.strict_duplicate_detection=false as it doesn't disable validatin for reindex operations).\r\n```\r\n\r\nWhy is the escape hatch not working? What kind of errors are you getting from the reindex API?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447369035","html_url":"https://github.com/elastic/elasticsearch/issues/36629#issuecomment-447369035","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36629","id":447369035,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzM2OTAzNQ==","user":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"created_at":"2018-12-14T16:02:21Z","updated_at":"2018-12-14T16:02:35Z","author_association":"CONTRIBUTOR","body":"To add to what @ywelsch said, checking for this condition would require a significant rework of how the Migration APIs operate, as they currently use index metadata only.  Even if the migration APIs were set up to run queries against indices, I'm not sure there's a way to detect this generically in a query, even a scripted one.\r\n\r\nWhile I agree that we should do something to handle this case better, I'm not sure the migration API is the place to do it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/447491536","html_url":"https://github.com/elastic/elasticsearch/issues/36629#issuecomment-447491536","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36629","id":447491536,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzQ5MTUzNg==","user":{"login":"geekpete","id":2070843,"node_id":"MDQ6VXNlcjIwNzA4NDM=","avatar_url":"https://avatars2.githubusercontent.com/u/2070843?v=4","gravatar_id":"","url":"https://api.github.com/users/geekpete","html_url":"https://github.com/geekpete","followers_url":"https://api.github.com/users/geekpete/followers","following_url":"https://api.github.com/users/geekpete/following{/other_user}","gists_url":"https://api.github.com/users/geekpete/gists{/gist_id}","starred_url":"https://api.github.com/users/geekpete/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geekpete/subscriptions","organizations_url":"https://api.github.com/users/geekpete/orgs","repos_url":"https://api.github.com/users/geekpete/repos","events_url":"https://api.github.com/users/geekpete/events{/privacy}","received_events_url":"https://api.github.com/users/geekpete/received_events","type":"User","site_admin":false},"created_at":"2018-12-14T21:59:17Z","updated_at":"2018-12-14T21:59:17Z","author_association":"MEMBER","body":"The escape hatch config setting had changed name from version 6.3 so the previous setting name was taking no effect. One setting name for 60. to 6.2+ and a different name setting for 6.3+\r\n\r\nThis info has been added in the PR:\r\nhttps://github.com/elastic/elasticsearch/pull/22073\r\n\r\nI understand the reason we only use metadata to keep checks lightweight and the expense at scale of doing a search across every doc with a script or something that looks for dupe fields.\r\nOne way to minimise this cost might be to use a random function score query across the data, it won't be perfect to ensure all docs are checked but in the cases where all or a sufficient majority of the docs are broken it will at least alert the user. In the cases where the dupe fields are rare then missing them at an upgrade check step might be much less impact.\r\n\r\nThe fact that the escape hatch is workng as expected means the impact of this scenario is easy to deal with if a user upgrades and finds docs are affected, so this check might be added to an upgrade checklist in docs perhaps.\r\n\r\nIt's probably also a rare edge case as it takes a custom indexing app to make the error of duplicating fields and I think many of the mainstream indexing tools will generally avoid this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/450943328","html_url":"https://github.com/elastic/elasticsearch/issues/36629#issuecomment-450943328","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36629","id":450943328,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk0MzMyOA==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2019-01-02T18:29:16Z","updated_at":"2019-01-02T18:29:16Z","author_association":"CONTRIBUTOR","body":"@geekpete -  Happy to discuss further, but based on the conversation so far, it seems this is a low impact edge case with a valid workaround. Do you mind if we close this request ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/451018734","html_url":"https://github.com/elastic/elasticsearch/issues/36629#issuecomment-451018734","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36629","id":451018734,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTAxODczNA==","user":{"login":"geekpete","id":2070843,"node_id":"MDQ6VXNlcjIwNzA4NDM=","avatar_url":"https://avatars2.githubusercontent.com/u/2070843?v=4","gravatar_id":"","url":"https://api.github.com/users/geekpete","html_url":"https://github.com/geekpete","followers_url":"https://api.github.com/users/geekpete/followers","following_url":"https://api.github.com/users/geekpete/following{/other_user}","gists_url":"https://api.github.com/users/geekpete/gists{/gist_id}","starred_url":"https://api.github.com/users/geekpete/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geekpete/subscriptions","organizations_url":"https://api.github.com/users/geekpete/orgs","repos_url":"https://api.github.com/users/geekpete/repos","events_url":"https://api.github.com/users/geekpete/events{/privacy}","received_events_url":"https://api.github.com/users/geekpete/received_events","type":"User","site_admin":false},"created_at":"2019-01-02T23:36:54Z","updated_at":"2019-01-02T23:36:54Z","author_association":"MEMBER","body":"Agreed, closing.\r\n\r\n\r\n","performed_via_github_app":null}]