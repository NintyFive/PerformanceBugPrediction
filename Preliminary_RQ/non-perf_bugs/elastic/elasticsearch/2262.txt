{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2262","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2262/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2262/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2262/events","html_url":"https://github.com/elastic/elasticsearch/issues/2262","id":6961117,"node_id":"MDU6SXNzdWU2OTYxMTE3","number":2262,"title":"query boost skipped for text/match query with queries of more than one word","user":{"login":"willkg","id":820826,"node_id":"MDQ6VXNlcjgyMDgyNg==","avatar_url":"https://avatars1.githubusercontent.com/u/820826?v=4","gravatar_id":"","url":"https://api.github.com/users/willkg","html_url":"https://github.com/willkg","followers_url":"https://api.github.com/users/willkg/followers","following_url":"https://api.github.com/users/willkg/following{/other_user}","gists_url":"https://api.github.com/users/willkg/gists{/gist_id}","starred_url":"https://api.github.com/users/willkg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willkg/subscriptions","organizations_url":"https://api.github.com/users/willkg/orgs","repos_url":"https://api.github.com/users/willkg/repos","events_url":"https://api.github.com/users/willkg/events{/privacy}","received_events_url":"https://api.github.com/users/willkg/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2012-09-18T18:38:04Z","updated_at":"2012-12-12T16:32:13Z","closed_at":"2012-12-12T16:32:13Z","author_association":"NONE","active_lock_reason":null,"body":"When doing a text/match query where the string has one word, the boosts get applied and show up in the explains text. However, when doing a text/match query where the string has more than one word, the bosts don't appear to get applied and definitely don't show up in the explains text.\n\nWe found the problem with 0.17.0, but I've verified that it's also a problem in 0.19.8 and 0.19.9, too.\n\nThis bash script can reproduce the problem. Sure seems like it's a bug. Any ideas?\n\n```\n#!/bin/bash\n\n# Create the index and mapping.\ncurl -XPUT 'http://localhost:9200/status_index/?pretty=1'  -d '\n{\n   \"mappings\" : {\n      \"status\" : {\n         \"properties\" : {\n            \"id\" : {\n               \"type\" : \"integer\"\n            },\n            \"summary\": {\n               \"type\": \"string\",\n               \"analyzer\" : \"snowball\"\n            },\n            \"msg\" : {\n               \"type\" : \"string\",\n               \"analyzer\" : \"snowball\"\n            }\n         }\n      }\n   }\n}\n'\necho \"\"\n\n# Response.\n# {\n#   \"ok\" : true,\n#   \"acknowledged\" : true\n# }\n\n\nsleep 1s\n\n\n# Add some things to the index.\ncurl -XPOST 'http://localhost:9200/status_index/status?pretty=1'  -d '\n{\n   \"id\" : 1,\n   \"summary\": \"first post\",\n   \"msg\" : \"first status message posted.\"\n}\n'\necho \"\"\n\n# Response.\n# {\n#   \"ok\" : true,\n#   \"_index\" : \"status_index\",\n#   \"_type\" : \"status\",\n#   \"_id\" : \"7tvZFNjzSPuN1ULbewp-cA\",\n#   \"_version\" : 1\n# }\n\n\ncurl -XPOST 'http://localhost:9200/status_index/status?pretty=1'  -d '\n{\n   \"id\" : 2,\n   \"summary\": \"second post\",\n   \"msg\" : \"second status message posted.\"\n}\n'\necho \"\"\n\n# Response.\n# {\n#   \"ok\" : true,\n#   \"_index\" : \"status_index\",\n#   \"_type\" : \"status\",\n#   \"_id\" : \"bpDLEMHzRGO61OIXBsV3Rg\",\n#   \"_version\" : 1\n# }\n\n\ncurl -XPOST 'http://localhost:9200/status_index/_refresh?pretty=1'\necho \"\"\n\n# Response.\n# {\n#   \"ok\" : true,\n#   \"_shards\" : {\n#     \"total\" : 10,\n#     \"successful\" : 5,\n#     \"failed\" : 0\n#   }\n# }\n\n\n# Text query with a boost and a single word. This works fine.\ncurl -XGET 'http://localhost:9200/status_index/_search?pretty=1'  -d '\n{\n   \"fields\" : [],\n   \"query\" : {\n      \"bool\" : {\n         \"should\" : [\n            {\"text\": {\n               \"summary\": {\n                  \"query\": \"posted\",\n                  \"boost\": 4.0\n               }\n            }},\n            {\"text\": {\n               \"msg\": {\n                  \"query\": \"posted\",\n                  \"boost\": 2.0\n               }\n            }}\n         ]\n      }\n   },\n   \"explain\": true\n}\n'\necho \"\"\n\n# Response.\n# {\n#   \"took\" : 173,\n#   \"timed_out\" : false,\n#   \"_shards\" : {\n#     \"total\" : 5,\n#     \"successful\" : 5,\n#     \"failed\" : 0\n#   },\n#   \"hits\" : {\n#     \"total\" : 2,\n#     \"max_score\" : 0.24015032,\n#     \"hits\" : [ {\n#       \"_shard\" : 0,\n#       \"_node\" : \"dRqpy_aITq-Qg7GTu3PRag\",\n#       \"_index\" : \"status_index\",\n#       \"_type\" : \"status\",\n#       \"_id\" : \"bpDLEMHzRGO61OIXBsV3Rg\",\n#       \"_score\" : 0.24015032,\n#       \"_explanation\" : {\n#         \"value\" : 0.24015033,\n#         \"description\" : \"sum of:\",\n#         \"details\" : [ {\n#           \"value\" : 0.17153595,\n#           \"description\" : \"weight(summary:post^4.0 in 0), product of:\",\n#           \"details\" : [ {\n#             \"value\" : 0.89442724,\n#             \"description\" : \"queryWeight(summary:post^4.0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 4.0,\n#               \"description\" : \"boost\"\n#             }, {\n#               \"value\" : 0.30685282,\n#               \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#             }, {\n#               \"value\" : 0.7287103,\n#               \"description\" : \"queryNorm\"\n#             } ]\n#           }, {\n#             \"value\" : 0.19178301,\n#             \"description\" : \"fieldWeight(summary:post in 0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 1.0,\n#               \"description\" : \"tf(termFreq(summary:post)=1)\"\n#             }, {\n#               \"value\" : 0.30685282,\n#               \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#             }, {\n#               \"value\" : 0.625,\n#               \"description\" : \"fieldNorm(field=summary, doc=0)\"\n#             } ]\n#           } ]\n#         }, {\n#           \"value\" : 0.06861438,\n#           \"description\" : \"weight(msg:post^2.0 in 0), product of:\",\n#           \"details\" : [ {\n#             \"value\" : 0.44721362,\n#             \"description\" : \"queryWeight(msg:post^2.0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 2.0,\n#               \"description\" : \"boost\"\n#             }, {\n#               \"value\" : 0.30685282,\n#               \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#             }, {\n#               \"value\" : 0.7287103,\n#               \"description\" : \"queryNorm\"\n#             } ]\n#           }, {\n#             \"value\" : 0.15342641,\n#             \"description\" : \"fieldWeight(msg:post in 0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 1.0,\n#               \"description\" : \"tf(termFreq(msg:post)=1)\"\n#             }, {\n#               \"value\" : 0.30685282,\n#               \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#             }, {\n#               \"value\" : 0.5,\n#               \"description\" : \"fieldNorm(field=msg, doc=0)\"\n#             } ]\n#           } ]\n#         } ]\n#       }\n#     }, {\n#       \"_shard\" : 4,\n#       \"_node\" : \"dRqpy_aITq-Qg7GTu3PRag\",\n#       \"_index\" : \"status_index\",\n#       \"_type\" : \"status\",\n#       \"_id\" : \"7tvZFNjzSPuN1ULbewp-cA\",\n#       \"_score\" : 0.24015032,\n#       \"_explanation\" : {\n#         \"value\" : 0.24015033,\n#         \"description\" : \"sum of:\",\n#         \"details\" : [ {\n#           \"value\" : 0.17153595,\n#           \"description\" : \"weight(summary:post^4.0 in 0), product of:\",\n#           \"details\" : [ {\n#             \"value\" : 0.89442724,\n#             \"description\" : \"queryWeight(summary:post^4.0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 4.0,\n#               \"description\" : \"boost\"\n#             }, {\n#               \"value\" : 0.30685282,\n#               \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#             }, {\n#               \"value\" : 0.7287103,\n#               \"description\" : \"queryNorm\"\n#             } ]\n#           }, {\n#             \"value\" : 0.19178301,\n#             \"description\" : \"fieldWeight(summary:post in 0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 1.0,\n#               \"description\" : \"tf(termFreq(summary:post)=1)\"\n#             }, {\n#               \"value\" : 0.30685282,\n#               \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#             }, {\n#               \"value\" : 0.625,\n#               \"description\" : \"fieldNorm(field=summary, doc=0)\"\n#             } ]\n#           } ]\n#         }, {\n#           \"value\" : 0.06861438,\n#           \"description\" : \"weight(msg:post^2.0 in 0), product of:\",\n#           \"details\" : [ {\n#             \"value\" : 0.44721362,\n#             \"description\" : \"queryWeight(msg:post^2.0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 2.0,\n#               \"description\" : \"boost\"\n#             }, {\n#               \"value\" : 0.30685282,\n#               \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#             }, {\n#               \"value\" : 0.7287103,\n#               \"description\" : \"queryNorm\"\n#             } ]\n#           }, {\n#             \"value\" : 0.15342641,\n#             \"description\" : \"fieldWeight(msg:post in 0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 1.0,\n#               \"description\" : \"tf(termFreq(msg:post)=1)\"\n#             }, {\n#               \"value\" : 0.30685282,\n#               \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#             }, {\n#               \"value\" : 0.5,\n#               \"description\" : \"fieldNorm(field=msg, doc=0)\"\n#             } ]\n#           } ]\n#         } ]\n#       }\n#     } ]\n#   }\n# }\n\n\n# Text query with a boost and two words word. This doesn't work\n# The boosts don't seem to be applied.\ncurl -XGET 'http://localhost:9200/status_index/_search?pretty=1'  -d '\n{\n   \"fields\" : [],\n   \"query\" : {\n      \"bool\" : {\n         \"should\" : [\n            {\"text\": {\n               \"summary\": {\n                  \"query\": \"message posted\",\n                  \"boost\": 4.0\n               }\n            }},\n            {\"text\": {\n               \"msg\": {\n                  \"query\": \"message posted\",\n                  \"boost\": 2.0\n               }\n            }}\n         ]\n      }\n   },\n   \"explain\": true\n}\n'\necho \"\"\n\n# Response.\n# {\n#   \"took\" : 14,\n#   \"timed_out\" : false,\n#   \"_shards\" : {\n#     \"total\" : 5,\n#     \"successful\" : 5,\n#     \"failed\" : 0\n#   },\n#   \"hits\" : {\n#     \"total\" : 2,\n#     \"max_score\" : 0.0716136,\n#     \"hits\" : [ {\n#       \"_shard\" : 0,\n#       \"_node\" : \"dRqpy_aITq-Qg7GTu3PRag\",\n#       \"_index\" : \"status_index\",\n#       \"_type\" : \"status\",\n#       \"_id\" : \"bpDLEMHzRGO61OIXBsV3Rg\",\n#       \"_score\" : 0.0716136,\n#       \"_explanation\" : {\n#         \"value\" : 0.0716136,\n#         \"description\" : \"sum of:\",\n#         \"details\" : [ {\n#           \"value\" : 0.027543694,\n#           \"description\" : \"product of:\",\n#           \"details\" : [ {\n#             \"value\" : 0.055087388,\n#             \"description\" : \"sum of:\",\n#             \"details\" : [ {\n#               \"value\" : 0.055087388,\n#               \"description\" : \"weight(summary:post in 0), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 0.2872381,\n#                 \"description\" : \"queryWeight(summary:post), product of:\",\n#                 \"details\" : [ {\n#                   \"value\" : 0.30685282,\n#                   \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#                 }, {\n#                   \"value\" : 0.9360777,\n#                   \"description\" : \"queryNorm\"\n#                 } ]\n#               }, {\n#                 \"value\" : 0.19178301,\n#                 \"description\" : \"fieldWeight(summary:post in 0), product of:\",\n#                 \"details\" : [ {\n#                   \"value\" : 1.0,\n#                   \"description\" : \"tf(termFreq(summary:post)=1)\"\n#                 }, {\n#                   \"value\" : 0.30685282,\n#                   \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#                 }, {\n#                   \"value\" : 0.625,\n#                   \"description\" : \"fieldNorm(field=summary, doc=0)\"\n#                 } ]\n#               } ]\n#             } ]\n#           }, {\n#             \"value\" : 0.5,\n#             \"description\" : \"coord(1/2)\"\n#           } ]\n#         }, {\n#           \"value\" : 0.04406991,\n#           \"description\" : \"sum of:\",\n#           \"details\" : [ {\n#             \"value\" : 0.022034954,\n#             \"description\" : \"weight(msg:messag in 0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 0.14361905,\n#               \"description\" : \"queryWeight(msg:messag), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 0.30685282,\n#                 \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#               }, {\n#                 \"value\" : 0.46803886,\n#                 \"description\" : \"queryNorm\"\n#               } ]\n#             }, {\n#               \"value\" : 0.15342641,\n#               \"description\" : \"fieldWeight(msg:messag in 0), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 1.0,\n#                 \"description\" : \"tf(termFreq(msg:messag)=1)\"\n#               }, {\n#                 \"value\" : 0.30685282,\n#                 \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#               }, {\n#                 \"value\" : 0.5,\n#                 \"description\" : \"fieldNorm(field=msg, doc=0)\"\n#               } ]\n#             } ]\n#           }, {\n#             \"value\" : 0.022034954,\n#             \"description\" : \"weight(msg:post in 0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 0.14361905,\n#               \"description\" : \"queryWeight(msg:post), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 0.30685282,\n#                 \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#               }, {\n#                 \"value\" : 0.46803886,\n#                 \"description\" : \"queryNorm\"\n#               } ]\n#             }, {\n#               \"value\" : 0.15342641,\n#               \"description\" : \"fieldWeight(msg:post in 0), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 1.0,\n#                 \"description\" : \"tf(termFreq(msg:post)=1)\"\n#               }, {\n#                 \"value\" : 0.30685282,\n#                 \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#               }, {\n#                 \"value\" : 0.5,\n#                 \"description\" : \"fieldNorm(field=msg, doc=0)\"\n#               } ]\n#             } ]\n#           } ]\n#         } ]\n#       }\n#     }, {\n#       \"_shard\" : 4,\n#       \"_node\" : \"dRqpy_aITq-Qg7GTu3PRag\",\n#       \"_index\" : \"status_index\",\n#       \"_type\" : \"status\",\n#       \"_id\" : \"7tvZFNjzSPuN1ULbewp-cA\",\n#       \"_score\" : 0.0716136,\n#       \"_explanation\" : {\n#         \"value\" : 0.0716136,\n#         \"description\" : \"sum of:\",\n#         \"details\" : [ {\n#           \"value\" : 0.027543694,\n#           \"description\" : \"product of:\",\n#           \"details\" : [ {\n#             \"value\" : 0.055087388,\n#             \"description\" : \"sum of:\",\n#             \"details\" : [ {\n#               \"value\" : 0.055087388,\n#               \"description\" : \"weight(summary:post in 0), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 0.2872381,\n#                 \"description\" : \"queryWeight(summary:post), product of:\",\n#                 \"details\" : [ {\n#                   \"value\" : 0.30685282,\n#                   \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#                 }, {\n#                   \"value\" : 0.9360777,\n#                   \"description\" : \"queryNorm\"\n#                 } ]\n#               }, {\n#                 \"value\" : 0.19178301,\n#                 \"description\" : \"fieldWeight(summary:post in 0), product of:\",\n#                 \"details\" : [ {\n#                   \"value\" : 1.0,\n#                   \"description\" : \"tf(termFreq(summary:post)=1)\"\n#                 }, {\n#                   \"value\" : 0.30685282,\n#                   \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#                 }, {\n#                   \"value\" : 0.625,\n#                   \"description\" : \"fieldNorm(field=summary, doc=0)\"\n#                 } ]\n#               } ]\n#             } ]\n#           }, {\n#             \"value\" : 0.5,\n#             \"description\" : \"coord(1/2)\"\n#           } ]\n#         }, {\n#           \"value\" : 0.04406991,\n#           \"description\" : \"sum of:\",\n#             \"description\" : \"weight(msg:messag in 0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 0.14361905,\n#               \"description\" : \"queryWeight(msg:messag), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 0.30685282,\n#                 \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#               }, {\n#                 \"value\" : 0.46803886,\n#                 \"description\" : \"queryNorm\"\n#               } ]\n#             }, {\n#               \"value\" : 0.15342641,\n#               \"description\" : \"fieldWeight(msg:messag in 0), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 1.0,\n#                 \"description\" : \"tf(termFreq(msg:messag)=1)\"\n#               }, {\n#                 \"value\" : 0.30685282,\n#                 \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#               }, {\n#                 \"value\" : 0.5,\n#                 \"description\" : \"fieldNorm(field=msg, doc=0)\"\n#               } ]\n#             } ]\n#           }, {\n#             \"value\" : 0.022034954,\n#             \"description\" : \"weight(msg:post in 0), product of:\",\n#             \"details\" : [ {\n#               \"value\" : 0.14361905,\n#               \"description\" : \"queryWeight(msg:post), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 0.30685282,\n#                 \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#               }, {\n#                 \"value\" : 0.46803886,\n#                 \"description\" : \"queryNorm\"\n#               } ]\n#             }, {\n#               \"value\" : 0.15342641,\n#               \"description\" : \"fieldWeight(msg:post in 0), product of:\",\n#               \"details\" : [ {\n#                 \"value\" : 1.0,\n#                 \"description\" : \"tf(termFreq(msg:post)=1)\"\n#               }, {\n#                 \"value\" : 0.30685282,\n#                 \"description\" : \"idf(docFreq=1, maxDocs=1)\"\n#               }, {\n#                 \"value\" : 0.5,\n#                 \"description\" : \"fieldNorm(field=msg, doc=0)\"\n#               } ]\n#             } ]\n#           } ]\n#         } ]\n#       }\n#     } ]\n#   }\n# }\n\n\n# Cleanup.\ncurl -XDELETE 'http://localhost:9200/status_index/?pretty=1'\n\n# Response.\n# {\n#   \"ok\" : true,\n#   \"acknowledged\" : true\n# }\n```\n","closed_by":{"login":"willkg","id":820826,"node_id":"MDQ6VXNlcjgyMDgyNg==","avatar_url":"https://avatars1.githubusercontent.com/u/820826?v=4","gravatar_id":"","url":"https://api.github.com/users/willkg","html_url":"https://github.com/willkg","followers_url":"https://api.github.com/users/willkg/followers","following_url":"https://api.github.com/users/willkg/following{/other_user}","gists_url":"https://api.github.com/users/willkg/gists{/gist_id}","starred_url":"https://api.github.com/users/willkg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willkg/subscriptions","organizations_url":"https://api.github.com/users/willkg/orgs","repos_url":"https://api.github.com/users/willkg/repos","events_url":"https://api.github.com/users/willkg/events{/privacy}","received_events_url":"https://api.github.com/users/willkg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}