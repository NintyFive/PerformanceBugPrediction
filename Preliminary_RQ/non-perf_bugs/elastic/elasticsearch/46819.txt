{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/46819","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46819/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46819/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46819/events","html_url":"https://github.com/elastic/elasticsearch/issues/46819","id":495206436,"node_id":"MDU6SXNzdWU0OTUyMDY0MzY=","number":46819,"title":"[telemetry] _xpack/usage endpoint missing `dataframe`","user":{"login":"Bamieh","id":6191849,"node_id":"MDQ6VXNlcjYxOTE4NDk=","avatar_url":"https://avatars3.githubusercontent.com/u/6191849?v=4","gravatar_id":"","url":"https://api.github.com/users/Bamieh","html_url":"https://github.com/Bamieh","followers_url":"https://api.github.com/users/Bamieh/followers","following_url":"https://api.github.com/users/Bamieh/following{/other_user}","gists_url":"https://api.github.com/users/Bamieh/gists{/gist_id}","starred_url":"https://api.github.com/users/Bamieh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bamieh/subscriptions","organizations_url":"https://api.github.com/users/Bamieh/orgs","repos_url":"https://api.github.com/users/Bamieh/repos","events_url":"https://api.github.com/users/Bamieh/events{/privacy}","received_events_url":"https://api.github.com/users/Bamieh/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-09-18T12:52:19Z","updated_at":"2019-11-19T13:00:54Z","closed_at":"2019-09-23T09:45:04Z","author_association":"MEMBER","active_lock_reason":null,"body":"Hello :wave:\r\n\r\nWe have a test in kibana that checks that we are sending all the telemetry fields. Currently it is [failing on master](https://github.com/elastic/kibana/blob/master/x-pack/test/api_integration/apis/telemetry/telemetry_local.js#L44) because `xpack.data_frame` is missing from the payload.\r\n\r\nAll the `stack_stats.xpack.*` telemetry data is passed directly from elasticsearch `_xpack/usage` endpoint.\r\n\r\nIdeally it would be great to have the same tests we have on kibana checking for those fields in elasticsearch as well, this way we'll have increased confidence that those fields will return what we expect when swapping between snapshots.\r\n\r\nWe do check for the following fields returned from elasticsearch:\r\n\r\n```\r\nexpect(stats.stack_stats.xpack.graph).to.be.an('object');\r\nexpect(stats.stack_stats.xpack.data_frame).to.be.an('object');\r\nexpect(stats.stack_stats.xpack.data_frame.available).to.be.an('boolean');\r\nexpect(stats.stack_stats.xpack.data_frame.enabled).to.be.an('boolean');\r\nexpect(stats.stack_stats.xpack.ilm).to.be.an('object');\r\nexpect(stats.stack_stats..xpack.logstash).to.be.an('object');\r\nexpect(stats.stack_stats.xpack.ml).to.be.an('object');\r\nexpect(stats.stack_stats.xpack.monitoring).to.be.an('object');\r\nexpect(stats.stack_stats.xpack.rollup).to.be.an('object');\r\n```\r\n\r\ncurrently we get the following keys in the payload (`data_frame` is missing)\r\n\r\n```\r\ncurl -XGET localhost:9200/_xpack/usage -u elastic:changeme -k | jq 'keys'                                                 \r\n[\r\n  \"analytics\",\r\n  \"ccr\",\r\n  \"flattened\",\r\n  \"frozen_indices\",\r\n  \"graph\",\r\n  \"ilm\",\r\n  \"logstash\",\r\n  \"ml\",\r\n  \"monitoring\",\r\n  \"rollup\",\r\n  \"security\",\r\n  \"spatial\",\r\n  \"sql\",\r\n  \"transform\",\r\n  \"vectors\",\r\n  \"voting_only\",\r\n  \"watcher\"\r\n]\r\n```\r\n\r\n\r\nRelated: https://github.com/elastic/kibana/issues/45983\r\nRelated: https://github.com/elastic/kibana/issues/45884\r\n\r\n","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}