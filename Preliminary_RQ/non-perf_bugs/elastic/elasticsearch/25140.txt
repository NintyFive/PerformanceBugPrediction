{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25140","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25140/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25140/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25140/events","html_url":"https://github.com/elastic/elasticsearch/issues/25140","id":234670311,"node_id":"MDU6SXNzdWUyMzQ2NzAzMTE=","number":25140,"title":"Error with range query inside \"not or\"","user":{"login":"kevinder","id":140760,"node_id":"MDQ6VXNlcjE0MDc2MA==","avatar_url":"https://avatars2.githubusercontent.com/u/140760?v=4","gravatar_id":"","url":"https://api.github.com/users/kevinder","html_url":"https://github.com/kevinder","followers_url":"https://api.github.com/users/kevinder/followers","following_url":"https://api.github.com/users/kevinder/following{/other_user}","gists_url":"https://api.github.com/users/kevinder/gists{/gist_id}","starred_url":"https://api.github.com/users/kevinder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kevinder/subscriptions","organizations_url":"https://api.github.com/users/kevinder/orgs","repos_url":"https://api.github.com/users/kevinder/repos","events_url":"https://api.github.com/users/kevinder/events{/privacy}","received_events_url":"https://api.github.com/users/kevinder/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-06-08T22:10:13Z","updated_at":"2017-06-08T22:22:34Z","closed_at":"2017-06-08T22:22:34Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 2.4.5\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 1.8.0_111\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): \r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nUsing a range query inside an `or` inside a `not` causes an error on 2.4.5, but not on 1.7.1.\r\n\r\n**Steps to reproduce**:\r\n\r\nThis query works fine:\r\n\r\n```\r\n{\r\n  \"filter\": {\r\n    \"or\": [\r\n      { \"range\": { \"value\": { \"gte\": 1, \"lt\": 3 } } },\r\n      { \"range\": { \"value\": { \"gte\": 5, \"lt\": 7 } } }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\nbut wrapping the `or` in a `not` will cause an error:\r\n\r\n```\r\n{\r\n  \"filter\": {\r\n    \"not\": {\r\n      \"or\": [\r\n        { \"range\": { \"value\": { \"gte\": 1, \"lt\": 3 } } },\r\n        { \"range\": { \"value\": { \"gte\": 5, \"lt\": 7 } } }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nwhere the error is a `query_parsing_exception` with message `[or] query does not support [gte]`.\r\n\r\nThat doesn't seem accurate because it works fine without the `not`.\r\n\r\nWe are trying to upgrade to 2.x and getting this error there. Our existing version is 1.7.1 where there is no error.   (The error occurs on both 2.4.5 and 2.0.0.) Converting our code to use `should`/`must` syntax is a huge amount of work for various reasons, so we'd prefer any other workarounds or suggestions. Thanks!\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}