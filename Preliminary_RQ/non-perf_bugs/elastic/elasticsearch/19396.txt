{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19396","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19396/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19396/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19396/events","html_url":"https://github.com/elastic/elasticsearch/issues/19396","id":165155136,"node_id":"MDU6SXNzdWUxNjUxNTUxMzY=","number":19396,"title":"Groovy scripting - possible memory leak ES 2.3.3","user":{"login":"bogdanovich","id":5257258,"node_id":"MDQ6VXNlcjUyNTcyNTg=","avatar_url":"https://avatars1.githubusercontent.com/u/5257258?v=4","gravatar_id":"","url":"https://api.github.com/users/bogdanovich","html_url":"https://github.com/bogdanovich","followers_url":"https://api.github.com/users/bogdanovich/followers","following_url":"https://api.github.com/users/bogdanovich/following{/other_user}","gists_url":"https://api.github.com/users/bogdanovich/gists{/gist_id}","starred_url":"https://api.github.com/users/bogdanovich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bogdanovich/subscriptions","organizations_url":"https://api.github.com/users/bogdanovich/orgs","repos_url":"https://api.github.com/users/bogdanovich/repos","events_url":"https://api.github.com/users/bogdanovich/events{/privacy}","received_events_url":"https://api.github.com/users/bogdanovich/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"}],"state":"closed","locked":false,"assignee":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"assignees":[{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false}],"milestone":null,"comments":25,"created_at":"2016-07-12T19:03:28Z","updated_at":"2016-08-15T14:08:30Z","closed_at":"2016-08-15T14:08:30Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 2.3.3\n\n**JVM version**:  java version \"1.8.0_40\"\nJava(TM) SE Runtime Environment (build 1.8.0_40-b25)\nJava HotSpot(TM) 64-Bit Server VM (build 25.40-b25, mixed mode)\n\n**OS version**: centos 6.3 (x86_64) :: linux 2.6.32-279.el6.x86_64\n\n**Description of the problem including expected versus actual behavior**:\n\nWe upgraded our cluster from  1.4.4 to 2.3.3 and now experiencing an issue where nodes become unresponsive and get heavily garbage collected. A Node restart helps for about 24 hours until 24Gb of RAM get fully utilized again.\n\n**Provide logs (if relevant)**:\n\n`jmap -histo:live` on the node with 91.1% heap used shows that 4.5Gb is taken by org.codehaus.groovy.runtime.metaclass.MetaMethodIndex\n\n```\nnum     #instances         #bytes  class name\n----------------------------------------------\n  1:      86241328     4829514368  org.codehaus.groovy.runtime.metaclass.MetaMethodIndex$Entry\n  2:      66209193     1922638888  [Ljava.lang.Object;\n  3:      34089692     1636305216  java.lang.invoke.MethodHandleImpl$CountingWrapper\n  4:      62450344     1498808256  org.codehaus.groovy.util.FastArray\n  5:      33948832     1086362624  java.util.HashMap$Node\n  6:        223427     1063930664  [B\n  7:       6938969      999212432  [Lorg.codehaus.groovy.util.ComplexKeyHashMap$Entry;\n  8:      27089896      866876672  java.lang.invoke.BoundMethodHandle$Species_LL\n  9:      17686899      707475960  java.lang.invoke.BoundMethodHandle$Species_L3\n 10:       5818726      612509464  [C\n 11:         23980      604964856  [I\n 12:      16356260      523400320  org.codehaus.groovy.util.SingleKeyHashMap$Entry\n 13:        495640      515466624  [Lorg.codehaus.groovy.runtime.metaclass.MetaMethodIndex$Entry;\n 14:       7202607      460966848  java.lang.invoke.BoundMethodHandle$Species_L4IL4\n 15:       2020760      383997512  [Ljava.util.HashMap$Node;\n 16:       7202607      345725136  java.lang.invoke.BoundMethodHandle$Species_L5\n 17:       3003762      264331056  java.lang.reflect.Method\n 18:       7884148      252292736  java.lang.invoke.BoundMethodHandle$Species_L\n 19:       7434592      237906944  groovy.lang.MetaBeanProperty\n 20:       4553471      218566608  java.util.HashMap\n 21:       2508224      200657920  java.lang.reflect.Constructor\n```\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}