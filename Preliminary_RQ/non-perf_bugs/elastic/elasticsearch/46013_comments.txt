[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/525198334","html_url":"https://github.com/elastic/elasticsearch/issues/46013#issuecomment-525198334","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46013","id":525198334,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNTE5ODMzNA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-27T08:29:32Z","updated_at":"2019-08-27T08:29:32Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/528293486","html_url":"https://github.com/elastic/elasticsearch/issues/46013#issuecomment-528293486","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46013","id":528293486,"node_id":"MDEyOklzc3VlQ29tbWVudDUyODI5MzQ4Ng==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-09-05T10:02:18Z","updated_at":"2019-09-05T10:02:18Z","author_association":"CONTRIBUTOR","body":"The relevant exception here is:\r\n\r\n```\r\nWARNING: Uncaught exception in thread: Thread[elasticsearch[leader0][transport_worker][T#2],5,TGRP-CcrRetentionLeaseIT]\r\n  2> java.lang.AssertionError: retention lease renewal for [follower_cluster/follower/en7SNpoTT12EfjfFahBWSQ-following-leader_cluster/leader/OPV3TxZpSWqrHuI420coIQ] from [ccr] renewed a lower retaining sequence number [37] than the current lease retaining sequence number [38]\r\n  2> \tat __randomizedtesting.SeedInfo.seed([A1FDBF8207D8F4B8]:0)\r\n  2> \tat org.elasticsearch.index.seqno.ReplicationTracker.renewRetentionLease(ReplicationTracker.java:401)\r\n  2> \tat org.elasticsearch.index.shard.IndexShard.renewRetentionLease(IndexShard.java:2148)\r\n  2> \tat org.elasticsearch.index.seqno.RetentionLeaseActions$Renew$TransportAction.doRetentionLeaseAction(RetentionLeaseActions.java:206)\r\n  2> \tat org.elasticsearch.index.seqno.RetentionLeaseActions$Renew$TransportAction.doRetentionLeaseAction(RetentionLeaseActions.java:182)\r\n  2> \tat org.elasticsearch.index.seqno.RetentionLeaseActions$TransportRetentionLeaseAction.lambda$asyncShardOperation$0(RetentionLeaseActions.java:100)\r\n  2> \tat org.elasticsearch.action.ActionListener$3.onResponse(ActionListener.java:112)\r\n  2> \tat org.elasticsearch.index.shard.IndexShard.lambda$wrapPrimaryOperationPermitListener$21(IndexShard.java:2753)\r\n  2> \tat org.elasticsearch.action.ActionListener$3.onResponse(ActionListener.java:112)\r\n  2> \tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:285)\r\n  2> \tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:237)\r\n  2> \tat org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationPermit(IndexShard.java:2727)\r\n  2> \tat org.elasticsearch.index.seqno.RetentionLeaseActions$TransportRetentionLeaseAction.asyncShardOperation(RetentionLeaseActions.java:97)\r\n  2> \tat org.elasticsearch.index.seqno.RetentionLeaseActions$TransportRetentionLeaseAction.asyncShardOperation(RetentionLeaseActions.java:59)\r\n  2> \tat org.elasticsearch.action.support.single.shard.TransportSingleShardAction$ShardTransportHandler.messageReceived(TransportSingleShardAction.java:289)\r\n  2> \tat org.elasticsearch.action.support.single.shard.TransportSingleShardAction$ShardTransportHandler.messageReceived(TransportSingleShardAction.java:282)\r\n  2> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63)\r\n  2> \tat org.elasticsearch.transport.InboundHandler$RequestHandler.doRun(InboundHandler.java:262)\r\n  2> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n  2> \tat org.elasticsearch.common.util.concurrent.EsExecutors$DirectExecutorService.execute(EsExecutors.java:196)\r\n  2> \tat org.elasticsearch.transport.InboundHandler.handleRequest(InboundHandler.java:183)\r\n  2> \tat org.elasticsearch.transport.InboundHandler.messageReceived(InboundHandler.java:117)\r\n  2> \tat org.elasticsearch.transport.InboundHandler.inboundMessage(InboundHandler.java:101)\r\n  2> \tat org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:663)\r\n  2> \tat org.elasticsearch.transport.TcpTransport.consumeNetworkReads(TcpTransport.java:687)\r\n  2> \tat org.elasticsearch.transport.nio.MockNioTransport$MockTcpReadWriteHandler.consumeReads(MockNioTransport.java:279)\r\n  2> \tat org.elasticsearch.nio.SocketChannelContext.handleReadBytes(SocketChannelContext.java:228)\r\n  2> \tat org.elasticsearch.nio.BytesChannelContext.read(BytesChannelContext.java:40)\r\n  2> \tat org.elasticsearch.nio.EventHandler.handleRead(EventHandler.java:139)\r\n  2> \tat org.elasticsearch.transport.nio.TestEventHandler.handleRead(TestEventHandler.java:151)\r\n  2> \tat org.elasticsearch.nio.NioSelector.handleRead(NioSelector.java:420)\r\n  2> \tat org.elasticsearch.nio.NioSelector.processKey(NioSelector.java:246)\r\n  2> \tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:174)\r\n  2> \tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:131)\r\n  2> \tat java.base/java.lang.Thread.run(Thread.java:834)\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/528353411","html_url":"https://github.com/elastic/elasticsearch/issues/46013#issuecomment-528353411","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46013","id":528353411,"node_id":"MDEyOklzc3VlQ29tbWVudDUyODM1MzQxMQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-09-05T13:04:25Z","updated_at":"2019-09-05T13:04:25Z","author_association":"MEMBER","body":"We renew the CCR retention lease at [a fixed interval](https://github.com/elastic/elasticsearch/blob/a5c60fb59a93d25d3534abd63a03057e514f186f/x-pack/plugin/ccr/src/main/java/org/elasticsearch/xpack/ccr/action/ShardFollowTasksExecutor.java#L448), therefore it's possible to have more than one in-flight renewal requests at the same time. If requests arrive out of order, then the assertion is violated. \r\n\r\n@original-brownbear I can take care of this issue if you don't mind.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/528355143","html_url":"https://github.com/elastic/elasticsearch/issues/46013#issuecomment-528355143","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46013","id":528355143,"node_id":"MDEyOklzc3VlQ29tbWVudDUyODM1NTE0Mw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-09-05T13:08:54Z","updated_at":"2019-09-05T13:09:15Z","author_association":"MEMBER","body":"@dnhatn go for it :) Thanks!","performed_via_github_app":null}]