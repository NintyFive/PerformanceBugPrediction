[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158982117","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-158982117","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":158982117,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODk4MjExNw==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T16:10:55Z","updated_at":"2015-11-23T16:10:55Z","author_association":"MEMBER","body":"_From @gpaul on November 23, 2015 13:37_\n\nPing. Should I open this issue against the main elasticsearch repository now that this plugin is moving there?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158982118","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-158982118","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":158982118,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODk4MjExOA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T16:10:55Z","updated_at":"2015-11-23T16:10:55Z","author_association":"MEMBER","body":"Did you try the same script with elasticsearch 1.7? I'd like to know if it's a regression or if it has always been there.\n\nI know that copy_to feature is supposed to work for the extracted text but I don't think it worked for metadata.\n\nIf I'm right (so it's not an issue but more a feature request), then you can open it in elasticsearch repo.\nIf I'm wrong (so it's a regression), then keep it here.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158982122","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-158982122","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":158982122,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODk4MjEyMg==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T16:10:55Z","updated_at":"2015-11-23T16:10:55Z","author_association":"MEMBER","body":"_From @gpaul on November 23, 2015 14:58_\n\nIt seems like a regression:\nelasticsearch 1.7.0 with mapper-attachments 2.7.1\nyields\n\n```\ncurl -XPOST 'http://localhost:9200/test_copyto/person/_search' -d '\n {\n   \"query\": {\n     \"query_string\": {\n       \"default_field\": \"copy_dst\",\n       \"fields\": [\"copy_dst\"],\n       \"query\": \"my-test.doc\"\n     }\n   }\n }\n '\n#{\"took\":3,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":0.02250402,\"hits\":[{\"_index\":\"test_copyto\",\"_type\":\"person\",\"_id\":\"1\",\"_score\":0.02250402,\"_source\":{\n#  \"doc\": {\n#    \"_content\": \"e1xydGYxXGFuc2kNCkxvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0DQpccGFyIH0=\",\n#    \"_name\": \"my-test.doc\"\n#  }\n#}}]}}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158982123","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-158982123","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":158982123,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODk4MjEyMw==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T16:10:56Z","updated_at":"2015-11-23T16:10:56Z","author_association":"MEMBER","body":"Thank you @gpaul \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158982127","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-158982127","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":158982127,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODk4MjEyNw==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T16:10:56Z","updated_at":"2015-11-23T16:10:56Z","author_association":"MEMBER","body":"_From @hhoechtl on November 23, 2015 15:2_\n\nIt's also not working with the .content field\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158986462","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-158986462","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":158986462,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODk4NjQ2Mg==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T16:25:24Z","updated_at":"2015-11-23T16:25:24Z","author_association":"MEMBER","body":"I created a test for elasticsearch 1.7 and it is working well in 1.x series:\n\n``` java\n@Test\npublic void testCopyToMetaData() throws Exception {\n    String mapping = copyToStringFromClasspath(\"/org/elasticsearch/index/mapper/attachment/test/integration/simple/copy-to-metadata.json\");\n    byte[] txt = copyToBytesFromClasspath(\"/org/elasticsearch/index/mapper/attachment/test/sample-files/text-in-english.txt\");\n\n    client().admin().indices().putMapping(putMappingRequest(\"test\").type(\"person\").source(mapping)).actionGet();\n\n    index(\"test\", \"person\", jsonBuilder().startObject()\n            .startObject(\"file\")\n            .field(\"_content\", txt)\n            .field(\"_name\", \"name\")\n            .endObject()\n            .endObject());\n    refresh();\n\n    CountResponse countResponse = client().prepareCount(\"test\").setQuery(queryStringQuery(\"name\").defaultField(\"file.name\")).execute().get();\n    assertThatWithError(countResponse.getCount(), equalTo(1l));\n\n    countResponse = client().prepareCount(\"test\").setQuery(queryStringQuery(\"name\").defaultField(\"copy\")).execute().get();\n    assertThatWithError(countResponse.getCount(), equalTo(1l));\n}\n```\n\nI created a test for 2.\\* branches which demonstrates the regression from 2.0.\nIt can be reused to fix this issue: https://github.com/elastic/elasticsearch-mapper-attachments/commit/30aeda668a9090f28929a74d59b9bf81e1738161:\n\n``` yml\n\"Copy To Feature\":\n\n    - do:\n        indices.create:\n            index: test\n            body:\n              mappings:\n                doc:\n                  properties:\n                    copy_dst:\n                      type: string\n                    doc:\n                      type: attachment\n                      fields:\n                        name:\n                          copy_to: copy_dst\n    - do:\n        cluster.health:\n          wait_for_status: yellow\n\n    - do:\n        index:\n            index: test\n            type: doc\n            id: 1\n            body:\n              doc:\n                _content: \"e1xydGYxXGFuc2kNCkxvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0DQpccGFyIH0=\"\n                _name: \"name\"\n\n    - do:\n        indices.refresh: {}\n\n    - do:\n        search:\n            index: test\n            body:\n                query:\n                    match:\n                        doc.content: \"ipsum\"\n\n    - match: { hits.total: 1 }\n\n    - do:\n        search:\n            index: test\n            body:\n                query:\n                    match:\n                        doc.name: \"name\"\n\n    - match: { hits.total: 1 }\n\n    - do:\n        search:\n            index: test\n            body:\n                query:\n                    match:\n                        copy_dst: \"name\"\n\n    - match: { hits.total: 1 }\n```\n\n@rjernst Could you give a look please?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160780665","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-160780665","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":160780665,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDc4MDY2NQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-11-30T22:22:23Z","updated_at":"2015-11-30T22:22:23Z","author_association":"MEMBER","body":"@dadoonet One odd thing I see is using a copy_to from within a multi field.  Seems like we should disallow that? We removed support here:\nhttps://github.com/elastic/elasticsearch/pull/10802/files#diff-ab54166cc098ea6f03350e68a8689a5bL432\n\n The copy's are now handled outside of the mappers, while before there was a lot of spaghetti sharing between object mappers and field mappers that made document parsing complex.  If we want to add it back, we will probably need a good refactoring in the way multi fields and copy_tos are handled. The problem is `copy_to` inside a multi field is essentially a nested `copy_to` since multi fields are conceptually just a copy to (see my notes in #10802).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160889068","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-160889068","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":160889068,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDg4OTA2OA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T08:05:34Z","updated_at":"2015-12-01T08:05:34Z","author_association":"MEMBER","body":"@clintongormley WDYT? \n\nLet me sum up the discussion.\n\nBefore 2.0, we were able to support:\n\n``` js\nPUT /test/person/_mapping\n{\n  \"person\": {\n    \"properties\": {\n      \"file\": {\n        \"type\": \"attachment\",\n        \"fields\": {\n          \"content\": {\n            \"type\": \"string\",\n            \"copy_to\": \"copy\"\n          },\n          \"name\": {\n            \"type\": \"string\",\n            \"copy_to\": \"copy\"\n          },\n          \"author\": {\n            \"type\": \"string\",\n            \"copy_to\": \"copy\"\n          },\n          \"title\": {\n            \"type\": \"string\",\n            \"copy_to\": \"copy\"\n          }\n        }\n      },\n      \"copy\": {\n        \"type\": \"string\"\n      }\n    }\n  }\n}\n```\n\nIt means that extracted `content`, `title`, `name` (for filename) and `author` can be indexed in another field `copy` where the user can run a \"fulltext\" search.\n\nFrom 2.0, this is not supported anymore for the reasons @rjernst described.\n\nShould we document that mapper attachments does not support anymore `copy_to` feature on extracted/provided nested fields?\nNote that we don't support [a global `copy_to` on the `BASE64` content](https://github.com/elastic/elasticsearch-mapper-attachments/issues/100) itself.\n\nOr should we try to implement such a thing _only_ for mapper attachments plugin. I can't see another use case today. May be some other community plugins would like to have it but really unsure here.\n\nIMO, users can always run search on multiple fields at the same time so instead of searching in `copy` in the above example, they could search on `file.content`, `file.title`, `file.name` and `file.author`. So not supporting this feature anymore does not sound as a big deal to me.\n\nThoughts?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160935938","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-160935938","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":160935938,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDkzNTkzOA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T11:03:18Z","updated_at":"2015-12-01T11:03:18Z","author_association":"CONTRIBUTOR","body":"My feeling is that, long term, we should remove the `attachment` field type.  Instead, we should move Tika to being a processor in the node ingest API which  will read the binary attachment and add the contents and any meta fields to the `_source` field itself.  The result is that attachments stop being magical and become just like any other field which can be configured in standard ways.\n\nWith this goal in mind, it doesn't make sense to add complicated (and likely buggy) hacks to fix this regression in 2.x.  But, we should let the user know that copy-to on multi-fields is not supported: we should throw an exception at mapping time instead of silently ignoring the problem.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161020907","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161020907","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161020907,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTAyMDkwNw==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T16:24:25Z","updated_at":"2015-12-01T16:24:25Z","author_association":"CONTRIBUTOR","body":"So...I took a look at the copy_to and multi_fields and tried to throw an exception when we encounter copy_to in multi_fields - we could do that I guess. But I have the suspicion that re-adding the copy_to to multi_fields is just a matter of shifting three lines. I made a pr here so you can see what I mean: #15152 Tests pass but I might be missing something.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161022420","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161022420","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161022420,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTAyMjQyMA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2015-12-01T16:29:27Z","updated_at":"2015-12-01T16:29:27Z","author_association":"MEMBER","body":"That would be an awesome news @brwe. Was not expecting that. Are the tests I wrote for mapper attachments plugin work as well? Is that what you mean by `Tests pass`?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161263824","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161263824","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161263824,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI2MzgyNA==","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T11:13:08Z","updated_at":"2015-12-02T11:13:08Z","author_association":"CONTRIBUTOR","body":"@dadoonet I mean the tests that were there already and the tests I added in the pr. I suspect that your test would pass as well but did not check.\n\nHowever, we ( @rjernst @clintongormley and I ) had a chat yesterday about this in here is the outcome:\nDoing this fix is not a good idea for several reasons:\n1. it would introduce a dependency between DocumentParser and FieldMapper again which was removed with much effort in #10802\n2. long term we want to replace the implementation of multi fields with `copy_to` mechanism anyway\n3. chains of `copy_to` ala\n\n```\n\"a\" : {\n\"type\": \"string\",\n\"copy_to\": \"b\"\n},\n\"b\": {\n\"type\": \"string\",\n\"copy_to\": \"a\"\n}\n```\n\nshould not be possible because they add complexity in code and usage.\n\nThis reduces flexibility of mappings and how they can transform data. However, the consensus is that elasticsearch is not the right place to perform these kind of transformations anyway and these kind of operations should move to external tools such as the planned node ingest plugin https://github.com/elastic/elasticsearch/issues/14049\n\nApplying the fix I proposed would just delay the removal of the feature and therefore we think we should not do it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161269697","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161269697","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161269697,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI2OTY5Nw==","user":{"login":"gpaul","id":442,"node_id":"MDQ6VXNlcjQ0Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/442?v=4","gravatar_id":"","url":"https://api.github.com/users/gpaul","html_url":"https://github.com/gpaul","followers_url":"https://api.github.com/users/gpaul/followers","following_url":"https://api.github.com/users/gpaul/following{/other_user}","gists_url":"https://api.github.com/users/gpaul/gists{/gist_id}","starred_url":"https://api.github.com/users/gpaul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpaul/subscriptions","organizations_url":"https://api.github.com/users/gpaul/orgs","repos_url":"https://api.github.com/users/gpaul/repos","events_url":"https://api.github.com/users/gpaul/events{/privacy}","received_events_url":"https://api.github.com/users/gpaul/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T11:47:32Z","updated_at":"2015-12-02T11:47:32Z","author_association":"NONE","body":"It seems like you have removed a feature without providing a better alternative. The use of copy_to for custom '_all' fields is well-documented and very useful.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161271726","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161271726","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161271726,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI3MTcyNg==","user":{"login":"gpaul","id":442,"node_id":"MDQ6VXNlcjQ0Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/442?v=4","gravatar_id":"","url":"https://api.github.com/users/gpaul","html_url":"https://github.com/gpaul","followers_url":"https://api.github.com/users/gpaul/followers","following_url":"https://api.github.com/users/gpaul/following{/other_user}","gists_url":"https://api.github.com/users/gpaul/gists{/gist_id}","starred_url":"https://api.github.com/users/gpaul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpaul/subscriptions","organizations_url":"https://api.github.com/users/gpaul/orgs","repos_url":"https://api.github.com/users/gpaul/repos","events_url":"https://api.github.com/users/gpaul/events{/privacy}","received_events_url":"https://api.github.com/users/gpaul/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T11:59:25Z","updated_at":"2015-12-02T11:59:25Z","author_association":"NONE","body":"@brwe My 2c on your  discussion \n1. it would introduce a dependency between DocumentParser and FieldMapper again which was removed with much effort in #10802\n   -> if such cleanup code broke something - then perhaps it was merged too soon. A temporary patch to fix a broken feature until such time as it can be properly reengineered is not unreasonable.\n2. long term we want to replace the implementation of multi fields with copy_to mechanism anyway\n   -> perfect - the process I would like to see in that case is: a deprecation note in 2.1 followed by a better alternative and migration path users can follow in preparation for 2.2 - keeping in mind that mappings from older versions of elasticsearch need to be upgraded. There are people who used ES as their primary data store - I'm not one of those, but having to rebuilding indexes when new ES versions are released is unfortunate.  \n3. chains of copy_to ... should not be possible because they add complexity in code and usage.\n   -> by all means prohibit them. I didn't know this was possible in earlier versions as it seems too easy to define cycles.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161285213","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161285213","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161285213,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI4NTIxMw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T13:04:42Z","updated_at":"2015-12-02T13:04:42Z","author_association":"CONTRIBUTOR","body":"@gpaul If our resources were unlimited, then I would agree with you. However, in an effort to clean up a massive code base and to remove complexity, we have to do it incrementally and sometimes we have to remove things that worked before.  The mapping cleanup was 5 long months of work, and there is still a good deal more to be done.  It brought some huge improvements (just see how many issues were linked to https://github.com/elastic/elasticsearch/issues/8870) but meant that we couldn't support everything that we supported before.\n\nEvery hack that we add into the code adds technical debt and increases the likelihood of introducing new bugs.  We'd much rather focus our limited resources on making the system clean, stable, reliable, and maintainable.\n\nThis is why I don't want to make this change.  The workaround for your case is to search across multiple fields.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161325276","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161325276","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161325276,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTMyNTI3Ng==","user":{"login":"gpaul","id":442,"node_id":"MDQ6VXNlcjQ0Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/442?v=4","gravatar_id":"","url":"https://api.github.com/users/gpaul","html_url":"https://github.com/gpaul","followers_url":"https://api.github.com/users/gpaul/followers","following_url":"https://api.github.com/users/gpaul/following{/other_user}","gists_url":"https://api.github.com/users/gpaul/gists{/gist_id}","starred_url":"https://api.github.com/users/gpaul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpaul/subscriptions","organizations_url":"https://api.github.com/users/gpaul/orgs","repos_url":"https://api.github.com/users/gpaul/repos","events_url":"https://api.github.com/users/gpaul/events{/privacy}","received_events_url":"https://api.github.com/users/gpaul/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T15:02:50Z","updated_at":"2015-12-02T15:02:50Z","author_association":"NONE","body":"[woops, I was logged in as a friend of mine when I posted this comment a minute ago. I've removed it and this is a repost as myself ><]\n\nThat's fair. Thanks for all the hard work.\n\nAs I'll have to redesign my mappings anyway, should I avoid copy_to in its entirety going forward or is it just the multi-field case that was causing pain? I'd like to avoid features that are on their way out.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161325986","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161325986","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161325986,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTMyNTk4Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T15:05:47Z","updated_at":"2015-12-02T15:05:47Z","author_association":"MEMBER","body":"@gpaul It is just copy_to in a multi field. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161327666","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-161327666","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":161327666,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTMyNzY2Ng==","user":{"login":"gpaul","id":442,"node_id":"MDQ6VXNlcjQ0Mg==","avatar_url":"https://avatars1.githubusercontent.com/u/442?v=4","gravatar_id":"","url":"https://api.github.com/users/gpaul","html_url":"https://github.com/gpaul","followers_url":"https://api.github.com/users/gpaul/followers","following_url":"https://api.github.com/users/gpaul/following{/other_user}","gists_url":"https://api.github.com/users/gpaul/gists{/gist_id}","starred_url":"https://api.github.com/users/gpaul/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpaul/subscriptions","organizations_url":"https://api.github.com/users/gpaul/orgs","repos_url":"https://api.github.com/users/gpaul/repos","events_url":"https://api.github.com/users/gpaul/events{/privacy}","received_events_url":"https://api.github.com/users/gpaul/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T15:11:26Z","updated_at":"2015-12-02T15:11:26Z","author_association":"NONE","body":"Got it, thanks.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/200981361","html_url":"https://github.com/elastic/elasticsearch/issues/14946#issuecomment-200981361","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14946","id":200981361,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMDk4MTM2MQ==","user":{"login":"spiderpug","id":2295856,"node_id":"MDQ6VXNlcjIyOTU4NTY=","avatar_url":"https://avatars0.githubusercontent.com/u/2295856?v=4","gravatar_id":"","url":"https://api.github.com/users/spiderpug","html_url":"https://github.com/spiderpug","followers_url":"https://api.github.com/users/spiderpug/followers","following_url":"https://api.github.com/users/spiderpug/following{/other_user}","gists_url":"https://api.github.com/users/spiderpug/gists{/gist_id}","starred_url":"https://api.github.com/users/spiderpug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spiderpug/subscriptions","organizations_url":"https://api.github.com/users/spiderpug/orgs","repos_url":"https://api.github.com/users/spiderpug/repos","events_url":"https://api.github.com/users/spiderpug/events{/privacy}","received_events_url":"https://api.github.com/users/spiderpug/received_events","type":"User","site_admin":false},"created_at":"2016-03-24T19:19:03Z","updated_at":"2016-03-24T20:03:27Z","author_association":"NONE","body":"Hi, I think I've this problem as well.\n\nFollowing the documentation (?) here:  https://github.com/elastic/elasticsearch-mapper-attachments#copy-to-feature  the `copyTo` on the `content` should work, but I cannot manage to. Isn't that the correct documentation?\n\nI want to make use of this feature to copy the extracted content into a custom `_all` field. Any hints how to solve this?\n\nIs there a content extraction service/endpoint I could make use of to index prepared content, so that I don't have to rely on copyTo?\n\n_Edit_: These docs mention the `copyTo` feature as well:  https://www.elastic.co/guide/en/elasticsearch/plugins/current/mapper-attachments-copy-to.html\n\nThanks!\n","performed_via_github_app":null}]