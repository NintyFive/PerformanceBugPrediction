[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446284673","html_url":"https://github.com/elastic/elasticsearch/issues/22786#issuecomment-446284673","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22786","id":446284673,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjI4NDY3Mw==","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2018-12-11T17:16:12Z","updated_at":"2018-12-11T17:16:12Z","author_association":"MEMBER","body":"@peterneubauer sorry for the delay, I was finally able to reproduce the issue. It turned out that the shape that is getting indexed here is not the same shape as in https://github.com/whosonfirst-data/whosonfirst-data/blob/master/data/101/752/293/101752293.geojson It seems like the outer polygon is missing some parts and as a result, the holes are located south of the polygon. You can see the polygon that is indexed on the first line of the error message that you posted.\r\n\r\nIn other words this is the same issue as #25933 and the reproduction behaves differently on 5.3 and 6.x. On 5.3 I am getting AOOB and in master I am getting a more meaningful error message:\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"mapper_parsing_exception\",\r\n        \"reason\": \"failed to parse [location]\"\r\n      }\r\n    ],\r\n    \"type\": \"mapper_parsing_exception\",\r\n    \"reason\": \"failed to parse [location]\",\r\n    \"caused_by\": {\r\n      \"type\": \"invalid_shape_exception\",\r\n      \"reason\": \"Hole lies outside shell at or near point (12.933235, 57.7034185000003, NaN)\"\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\nSo, I am going to close this issue. \r\n\r\nJust in case this is the repro that I created based on the logs.\r\n\r\n```\r\nDELETE my_index\r\n\r\nPUT my_index\r\n{\r\n  \"mappings\": {\r\n    \"my_type\": {\r\n      \"properties\": {\r\n        \"location\": {\r\n            \"type\": \"geo_shape\"\r\n          }\r\n      }\r\n    }\r\n  }\r\n}\r\n \r\n \r\nPUT my_index/my_type/3\r\n{\r\n  \"location\": {\r\n    \"coordinates\":[[[12.963473575017, 57.7585129628043], [13.031739, 57.742897], [12.9871550000001, 57.7005880000002], [12.9028672807968, 57.7139576091713], [12.8090686339677, 57.6934760408931], [12.963473575017, 57.7585129628043]], [[12.964461350251, 57.7290883376522], [12.966587, 57.7275275000002], [12.9690665000001, 57.7280350000001], [12.9689436965079, 57.7295970703855], [12.964461350251, 57.7290883376522]], [[12.8774193910486, 57.711810646514], [12.8775431599072, 57.7118079756228], [12.8775484087353, 57.7118751937708], [12.8774193910486, 57.711810646514]], [[12.9235696760266, 57.7000907618065], [12.925358, 57.696953],[12.9384103968474, 57.69698174145], [12.933235, 57.7034185000003], [12.9235696760266, 57.7000907618065]], [[12.9201909999998, 57.6986315], [12.9201067946445, 57.6987030511618], [12.9200025559888, 57.6973868455737], [12.9202904162546, 57.6973805287324], [12.9201909999998, 57.6986315]]],\r\n    \"type\":\"Polygon\"}\r\n}\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446294069","html_url":"https://github.com/elastic/elasticsearch/issues/22786#issuecomment-446294069","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22786","id":446294069,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjI5NDA2OQ==","user":{"login":"peterneubauer","id":11977,"node_id":"MDQ6VXNlcjExOTc3","avatar_url":"https://avatars0.githubusercontent.com/u/11977?v=4","gravatar_id":"","url":"https://api.github.com/users/peterneubauer","html_url":"https://github.com/peterneubauer","followers_url":"https://api.github.com/users/peterneubauer/followers","following_url":"https://api.github.com/users/peterneubauer/following{/other_user}","gists_url":"https://api.github.com/users/peterneubauer/gists{/gist_id}","starred_url":"https://api.github.com/users/peterneubauer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterneubauer/subscriptions","organizations_url":"https://api.github.com/users/peterneubauer/orgs","repos_url":"https://api.github.com/users/peterneubauer/repos","events_url":"https://api.github.com/users/peterneubauer/events{/privacy}","received_events_url":"https://api.github.com/users/peterneubauer/received_events","type":"User","site_admin":false},"created_at":"2018-12-11T17:43:41Z","updated_at":"2018-12-11T17:43:41Z","author_association":"NONE","body":"Thanks a lot for picking this up, much appreciated!\n\nOn Tue, Dec 11, 2018, 6:18 PM Igor Motov <notifications@github.com wrote:\n\n> Closed #22786 <https://github.com/elastic/elasticsearch/issues/22786>.\n>\n> â€”\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/22786#event-2019331241>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAAuyVfadK8WN7WysKFq1X2p4orXfV4tks5u3-jNgaJpZM4Ltgjl>\n> .\n>\n","performed_via_github_app":null}]