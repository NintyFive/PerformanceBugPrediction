{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/46224","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46224/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46224/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46224/events","html_url":"https://github.com/elastic/elasticsearch/issues/46224","id":488098000,"node_id":"MDU6SXNzdWU0ODgwOTgwMDA=","number":46224,"title":"[CI] SearchIT.testExplainWithFetchSource failed","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"assignees":[{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-09-02T09:39:36Z","updated_at":"2019-09-10T08:07:03Z","closed_at":"2019-09-10T08:07:03Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Failed during a master intake build here:\r\nhttps://gradle-enterprise.elastic.co/s/rhl5wvyx4q3gk/console-log?task=:client:rest-high-level:integTestRunner\r\n\r\n```\r\norg.elasticsearch.client.SearchIT > testExplainWithFetchSource FAILED\r\n--\r\norg.elasticsearch.client.ResponseException: method [PUT], host [http://127.0.0.1:34715], URI [/index2], status line [HTTP/1.1 400 Bad Request]\r\n{\"error\":{\"root_cause\":[{\"type\":\"resource_already_exists_exception\",\"reason\":\"index [index2/6n_jf67PR-mE8K9GDmOL0w] already exists\",\"index_uuid\":\"6n_jf67PR-mE8K9GDmOL0w\",\"index\":\"index2\"}],\"type\":\"resource_already_exists_exception\",\"reason\":\"index [index2/6n_jf67PR-mE8K9GDmOL0w] already exists\",\"index_uuid\":\"6n_jf67PR-mE8K9GDmOL0w\",\"index\":\"index2\"},\"status\":400}\r\nat __randomizedtesting.SeedInfo.seed([59C5F5AAFE436E4E:4AC620DD1EBE9B5]:0)\r\nat org.elasticsearch.client.RestClient.convertResponse(RestClient.java:253)\r\nat org.elasticsearch.client.RestClient.performRequest(RestClient.java:231)\r\nat org.elasticsearch.client.RestClient.performRequest(RestClient.java:221)\r\nat org.elasticsearch.client.RestClient.performRequest(RestClient.java:205)\r\nat org.elasticsearch.client.SearchIT.indexDocuments(SearchIT.java:159)\r\n```\r\n\r\nIt looks like this could affect all rest integration tests, since the wipe and recreate pattern is used everywhere. The relevant server log snippet is here:\r\n\r\n```\r\n(start of previous test: testNonExistentSearchTemplate)\r\n[2019-09-02T08:47:32,674][INFO ][o.e.c.m.TemplateUpgradeService] [integTest-0] Starting template upgrade to version 8.0.0, 1 templates will be updated and 0 will be removed\r\n[2019-09-02T08:47:32,678][INFO ][o.e.c.m.MetaDataIndexTemplateService] [integTest-0] adding template [.logstash-management] for index patterns [.logstash]\r\n[2019-09-02T08:47:32,699][INFO ][o.e.c.m.TemplateUpgradeService] [integTest-0] Templates were upgraded successfully to version 8.0.0\r\n[2019-09-02T08:47:32,723][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [integTest-0] adding index lifecycle policy [watch-history-ilm-policy]\r\n[2019-09-02T08:47:32,763][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [integTest-0] adding index lifecycle policy [slm-history-ilm-policy]\r\n[2019-09-02T08:47:32,841][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [index] creating index, cause [auto(bulk api)], templates [], shards [1]/[1], mappings []\r\n[2019-09-02T08:47:32,934][INFO ][o.e.c.m.MetaDataMappingService] [integTest-0] [index/SdzF_EaURTK8LNWKxinhtQ] create_mapping [type]\r\n[2019-09-02T08:47:32,989][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [index1] creating index, cause [auto(bulk api)], templates [], shards [1]/[1], mappings []\r\n[2019-09-02T08:47:33,094][INFO ][o.e.c.m.MetaDataMappingService] [integTest-0] [index1/oAEk53QpRdiC0k0e6tSDFw] create_mapping [_doc]\r\n[2019-09-02T08:47:33,131][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [index2] creating index, cause [api], templates [], shards [1]/[1], mappings [_doc]\r\n[2019-09-02T08:47:33,241][INFO ][o.e.c.m.MetaDataMappingService] [integTest-0] [index2/Qh4tbqJKQh6C8GJxSMe1tQ] update_mapping [_doc]\r\n[2019-09-02T08:47:33,274][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [index3] creating index, cause [auto(bulk api)], templates [], shards [1]/[1], mappings []\r\n[2019-09-02T08:47:33,382][INFO ][o.e.c.m.MetaDataMappingService] [integTest-0] [index3/v6r9wYQlR6aHXDnZFQNLsA] create_mapping [_doc]\r\n[2019-09-02T08:47:33,428][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [index4] creating index, cause [api], templates [], shards [1]/[1], mappings [_doc]\r\n[2019-09-02T08:47:33,623][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [index1/oAEk53QpRdiC0k0e6tSDFw] deleting index\r\n[2019-09-02T08:47:33,623][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [index4/nTGvrPFRQ92RCNvssR8KyQ] deleting index\r\n[2019-09-02T08:47:33,623][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [index3/v6r9wYQlR6aHXDnZFQNLsA] deleting index\r\n[2019-09-02T08:47:33,624][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [index2/Qh4tbqJKQh6C8GJxSMe1tQ] deleting index\r\n[2019-09-02T08:47:33,624][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [index/SdzF_EaURTK8LNWKxinhtQ] deleting index\r\n[2019-09-02T08:47:33,698][INFO ][o.e.c.m.MetaDataIndexTemplateService] [integTest-0] removing template [.logstash-management]\r\n(start of failing test testExplainWithFetchSource)\r\n[2019-09-02T08:47:33,720][INFO ][o.e.c.m.TemplateUpgradeService] [integTest-0] Starting template upgrade to version 8.0.0, 1 templates will be updated and 0 will be removed\r\n[2019-09-02T08:47:33,725][INFO ][o.e.c.m.MetaDataIndexTemplateService] [integTest-0] adding template [.logstash-management] for index patterns [.logstash]\r\n[2019-09-02T08:47:33,746][INFO ][o.e.c.m.TemplateUpgradeService] [integTest-0] Templates were upgraded successfully to version 8.0.0\r\n[2019-09-02T08:47:33,769][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [integTest-0] adding index lifecycle policy [watch-history-ilm-policy]\r\n[2019-09-02T08:47:33,810][INFO ][o.e.x.i.a.TransportPutLifecycleAction] [integTest-0] adding index lifecycle policy [slm-history-ilm-policy]\r\n[2019-09-02T08:47:33,859][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [index] creating index, cause [auto(bulk api)], templates [], shards [1]/[1], mappings []\r\n[2019-09-02T08:47:33,957][INFO ][o.e.c.m.MetaDataMappingService] [integTest-0] [index/mTMwD3oDTK6Gtmf3lUaBjw] create_mapping [type]\r\n[2019-09-02T08:47:34,012][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [index1] creating index, cause [auto(bulk api)], templates [], shards [1]/[1], mappings []\r\n[2019-09-02T08:47:34,156][INFO ][o.e.c.m.MetaDataMappingService] [integTest-0] [index1/-28NAAelR_a_FFaj5-5A1A] create_mapping [_doc]\r\n[2019-09-02T08:47:35,724][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [index2] creating index, cause [api], templates [], shards [1]/[1], mappings [_doc]\r\n[2019-09-02T08:48:05,767][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [index/mTMwD3oDTK6Gtmf3lUaBjw] deleting index\r\n[2019-09-02T08:48:05,768][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [index1/-28NAAelR_a_FFaj5-5A1A] deleting index\r\n[2019-09-02T08:48:05,768][INFO ][o.e.c.m.MetaDataDeleteIndexService] [integTest-0] [index2/6n_jf67PR-mE8K9GDmOL0w] deleting index\r\n[2019-09-02T08:48:11,116][INFO ][o.e.c.m.MetaDataIndexTemplateService] [integTest-0] removing template [.logstash-management]\r\n```\r\n\r\nIt looks like there may be some kind of retry involved based on the pause between the create index log message and the deletion messages. Also, notice that the delete index2 request from the previous test has a different UUID, so from the looks of it, that test did clean up OK.\r\n\r\nUnable to reproduce using either of:\r\n\r\n```\r\n./gradlew :client:rest-high-level:integTestRunner --tests \"org.elasticsearch.client.SearchIT.testExplainWithFetchSource\" -Dtests.seed=59C5F5AAFE436E4E -Dtests.security.manager=true -Dtests.locale=ln-CG -Dtests.timezone=Europe/Ulyanovsk -Dcompiler.java=12 -Druntime.java=11\r\n./gradlew :client:rest-high-level:integTestRunner -Dtests.seed=59C5F5AAFE436E4E -Dtests.security.manager=true -Dtests.locale=ln-CG -Dtests.timezone=Europe/Ulyanovsk -Dcompiler.java=12 -Druntime.java=11\r\n```\r\n\r\nThough this is a search test, the problem seems to fit within the distributed area, since it is the delete and create index part that fails.\r\n\r\nDid not mute this test, since it seems like this could hit any rest test and this test was just unlucky.\r\n","closed_by":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"performed_via_github_app":null}