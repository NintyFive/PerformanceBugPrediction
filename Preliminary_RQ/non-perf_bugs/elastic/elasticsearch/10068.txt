{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10068","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10068/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10068/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10068/events","html_url":"https://github.com/elastic/elasticsearch/issues/10068","id":60768583,"node_id":"MDU6SXNzdWU2MDc2ODU4Mw==","number":10068,"title":"Red indexes with nullpointer exception","user":{"login":"anjanpathak","id":1118827,"node_id":"MDQ6VXNlcjExMTg4Mjc=","avatar_url":"https://avatars3.githubusercontent.com/u/1118827?v=4","gravatar_id":"","url":"https://api.github.com/users/anjanpathak","html_url":"https://github.com/anjanpathak","followers_url":"https://api.github.com/users/anjanpathak/followers","following_url":"https://api.github.com/users/anjanpathak/following{/other_user}","gists_url":"https://api.github.com/users/anjanpathak/gists{/gist_id}","starred_url":"https://api.github.com/users/anjanpathak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anjanpathak/subscriptions","organizations_url":"https://api.github.com/users/anjanpathak/orgs","repos_url":"https://api.github.com/users/anjanpathak/repos","events_url":"https://api.github.com/users/anjanpathak/events{/privacy}","received_events_url":"https://api.github.com/users/anjanpathak/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-03-12T04:10:02Z","updated_at":"2015-10-30T21:03:24Z","closed_at":"2015-10-30T21:03:24Z","author_association":"NONE","active_lock_reason":null,"body":"We are having problem while serving query. We were running ES 1.2.1 on Cent OS installed as RPM package and suddenly started getting errors while querying. The log showed this:\n\n```\n[2015-03-09 18:35:25,102][INFO ][cluster.metadata         ] [Morpheus] [thedealspoint] update_mapping [publicDeals] (dynamic)\n[2015-03-09 18:35:25,131][WARN ][index.engine.internal    ] [Morpheus] [thedealspoint][0] failed engine [refresh failed]\n[2015-03-09 18:35:25,162][WARN ][cluster.action.shard     ] [Morpheus] [thedealspoint][0] sending failed shard for [thedealspoint][0], node[Sa7pUWi2SNmVSL22U4eITw], [P], s[STARTED], indexUUID [v-u_MHhfQMyTbZ6-_XqH0w], reason [engine failure, message [refresh failed][NullPointerException[null]]]\n[2015-03-09 18:35:25,163][WARN ][cluster.action.shard     ] [Morpheus] [thedealspoint][0] received shard failed for [thedealspoint][0], node[Sa7pUWi2SNmVSL22U4eITw], [P], s[STARTED], indexUUID [v-u_MHhfQMyTbZ6-_XqH0w], reason [engine failure, message [refresh failed][NullPointerException[null]]]\n[2015-03-09 18:35:26,842][DEBUG][action.search.type       ] [Morpheus] All shards failed for phase: [query_fetch]\n[2015-03-09 18:35:34,371][DEBUG][action.search.type       ] [Morpheus] All shards failed for phase: [query_fetch]\n[2015-03-09 18:35:34,395][DEBUG][action.search.type       ] [Morpheus] All shards failed for phase: [query_fetch]\n[20\n```\n\nOur setup was default one node installation with memory increased and ES was running without any maintenance for almost a year now. We felt marvel was taking too much space and hence cleared up the marvel indexes. We also deleted our own index and did a fresh indexing. But there was no luck. Things work for few queries and then fails with the same message above. Ultimately unzipped latest ES version (elasticsearch-1.4.4) on a new directory. Started with default settings and did again fresh indexing (Our content is in MySQL and ES is used as search engine). Things work for few queries and then the shard gets unassigned after a while. The error message is shown below:\n\n[vantage@vc-prod elasticsearch-1.4.4]$ bin/elasticsearch\n\n```\n[2015-03-11 18:46:17,904][INFO ][node                     ] [Doctor Strange] version[1.4.4], pid[13798], build[c88f77f/2015-02-19T13:05:36Z]\n[2015-03-11 18:46:17,905][INFO ][node                     ] [Doctor Strange] initializing ...\n[2015-03-11 18:46:17,911][INFO ][plugins                  ] [Doctor Strange] loaded [], sites []\n[2015-03-11 18:46:21,450][INFO ][node                     ] [Doctor Strange] initialized\n[2015-03-11 18:46:21,450][INFO ][node                     ] [Doctor Strange] starting ...\n[2015-03-11 18:46:21,626][INFO ][transport                ] [Doctor Strange] bound_address {inet[/0:0:0:0:0:0:0:0:9300]}, publish_address {inet[/128.199.143.152:9300]}\n[2015-03-11 18:46:21,700][INFO ][discovery                ] [Doctor Strange] elasticsearch/2bQbRn93SOeDdmDLHijwBg\n[2015-03-11 18:46:25,482][INFO ][cluster.service          ] [Doctor Strange] new_master [Doctor Strange][2bQbRn93SOeDdmDLHijwBg][vc-prod][inet[/128.199.143.152:9300]], reason: zen-disco-join (elected_as_master)\n[2015-03-11 18:46:25,519][INFO ][http                     ] [Doctor Strange] bound_address {inet[/0:0:0:0:0:0:0:0:9200]}, publish_address {inet[/128.199.143.152:9200]}\n[2015-03-11 18:46:25,520][INFO ][node                     ] [Doctor Strange] started\n[2015-03-11 18:46:26,459][INFO ][gateway                  ] [Doctor Strange] recovered [2] indices into cluster_state\n[2015-03-11 18:46:26,639][DEBUG][action.search.type       ] [Doctor Strange] All shards failed for phase: [query_fetch]\n[2015-03-11 18:46:26,639][DEBUG][action.search.type       ] [Doctor Strange] All shards failed for phase: [query_fetch]\n[2015-03-11 18:46:26,862][WARN ][indices.cluster          ] [Doctor Strange] [thedealspoint][0] failed to start shard\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [thedealspoint][0] failed recovery\n    at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:185)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.index.engine.FlushFailedEngineException: [thedealspoint][0] Flush failed\n    at org.elasticsearch.index.engine.internal.InternalEngine.flush(InternalEngine.java:926)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.performRecoveryFinalization(InternalIndexShard.java:749)\n    at org.elasticsearch.index.gateway.local.LocalIndexShardGateway.recover(LocalIndexShardGateway.java:291)\n    at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:132)\n    ... 3 more\nCaused by: java.lang.NullPointerException\n    at org.elasticsearch.search.suggest.completion.Completion090PostingsFormat$CompletionLookupProvider.parsePayload(Completion090PostingsFormat.java:337)\n    at org.elasticsearch.search.suggest.completion.AnalyzingCompletionLookupProvider$CompletionPostingsConsumer.addPosition(AnalyzingCompletionLookupProvider.java:189)\n    at org.elasticsearch.search.suggest.completion.Completion090PostingsFormat$GroupedPostingsConsumer.addPosition(Completion090PostingsFormat.java:188)\n    at org.apache.lucene.index.FreqProxTermsWriterPerField.flush(FreqProxTermsWriterPerField.java:488)\n    at org.apache.lucene.index.FreqProxTermsWriter.flush(FreqProxTermsWriter.java:80)\n    at org.apache.lucene.index.DefaultIndexingChain.flush(DefaultIndexingChain.java:114)\n    at org.apache.lucene.index.DocumentsWriterPerThread.flush(DocumentsWriterPerThread.java:439)\n    at org.apache.lucene.index.DocumentsWriter.doFlush(DocumentsWriter.java:513)\n    at org.apache.lucene.index.DocumentsWriter.flushAllThreads(DocumentsWriter.java:624)\n    at org.apache.lucene.index.IndexWriter.prepareCommitInternal(IndexWriter.java:2949)\n    at org.apache.lucene.index.IndexWriter.commitInternal(IndexWriter.java:3104)\n    at org.apache.lucene.index.IndexWriter.commit(IndexWriter.java:3071)\n    at org.elasticsearch.index.engine.internal.InternalEngine.flush(InternalEngine.java:916)\n    ... 6 more\n[2015-03-11 18:46:26,890][WARN ][cluster.action.shard     ] [Doctor Strange] [thedealspoint][0] sending failed shard for [thedealspoint][0], node[2bQbRn93SOeDdmDLHijwBg], [P], s[INITIALIZING], indexUUID [vjORGaDpSsKPcGddR2ELdg], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[thedealspoint][0] failed recovery]; nested: FlushFailedEngineException[[thedealspoint][0] Flush failed]; nested: NullPointerException; ]]\n[2015-03-11 18:46:26,890][WARN ][cluster.action.shard     ] [Doctor Strange] [thedealspoint][0] received shard failed for [thedealspoint][0], node[2bQbRn93SOeDdmDLHijwBg], [P], s[INITIALIZING], indexUUID [vjORGaDpSsKPcGddR2ELdg], reason [Failed to start shard, message [IndexShardGatewayRecoveryException[[thedealspoint][0] failed recovery]; nested: FlushFailedEngineException[[thedealspoint][0] Flush failed]; nested: NullPointerException; ]]\n[2015-03-11 18:46:28,818][DEBUG][action.search.type       ] [Doctor Strange] All shards failed for phase: [query_fetch]\n[2015-03-11 18:46:30,173][DEBUG][action.search.type       ] [Doctor Strange] All shards failed for phase: [query_fetch]\n[2015-03-11 18:46:33,339][DEBUG][action.search.type       ] [Doctor Strange] All shards failed for phase: [query_fetch]\n```\n\n---\n\nUltimately we created a completely new CentOS instance, installed ES and did a fresh installation and indexing. Things are working so far but we would like to get to the bottom of the null pointer issue and also move to the old installation if possible. \n\nThanks, \nAnjan\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}