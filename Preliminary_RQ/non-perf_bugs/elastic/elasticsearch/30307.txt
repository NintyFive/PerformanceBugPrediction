{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30307","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30307/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30307/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30307/events","html_url":"https://github.com/elastic/elasticsearch/issues/30307","id":319245997,"node_id":"MDU6SXNzdWUzMTkyNDU5OTc=","number":30307,"title":"Watcher: support adding CA for SMTP","user":{"login":"jguay","id":19236038,"node_id":"MDQ6VXNlcjE5MjM2MDM4","avatar_url":"https://avatars2.githubusercontent.com/u/19236038?v=4","gravatar_id":"","url":"https://api.github.com/users/jguay","html_url":"https://github.com/jguay","followers_url":"https://api.github.com/users/jguay/followers","following_url":"https://api.github.com/users/jguay/following{/other_user}","gists_url":"https://api.github.com/users/jguay/gists{/gist_id}","starred_url":"https://api.github.com/users/jguay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jguay/subscriptions","organizations_url":"https://api.github.com/users/jguay/orgs","repos_url":"https://api.github.com/users/jguay/repos","events_url":"https://api.github.com/users/jguay/events{/privacy}","received_events_url":"https://api.github.com/users/jguay/received_events","type":"User","site_admin":false},"labels":[{"id":912845062,"node_id":"MDU6TGFiZWw5MTI4NDUwNjI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Watcher","name":":Core/Features/Watcher","color":"0e8a16","default":false,"description":""},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"assignees":[{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-05-01T16:17:29Z","updated_at":"2019-08-13T04:15:19Z","closed_at":"2019-08-13T04:15:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\nAbility to pass an additional Certificate Authority for SMTP server. At the moment there is no setting which will enable to provide an additional CA for SMTP server connection\r\n\r\n**Elasticsearch version** 6.2.4\r\n\r\n**Steps to reproduce**:\r\n\r\nPrerequisite : docker-compose in a recent version\r\n\r\n 1. Download/unzip \r\n[watcher-smtpOnSSLWithUntrustedCA.zip](https://github.com/elastic/elasticsearch/files/1964371/watcher-smtpOnSSLWithUntrustedCA.zip)\r\n\r\n 2. From that folder, execute \"./runAll.sh\", this will use certgen to generate certificates for ES/Kibana and for SMTP server (using SSL/TLS), set up all users with password \"changeme\" and add a watcher which sends an email every minute\r\n 3. View watcher history in [https://localhost:5601](https://localhost:5601)\r\n\r\n**Provide logs (if relevant)**:\r\n\r\nNote you can find in docker-compose.yml the various settings around watcher which do not work\r\n\r\n```\r\n{\r\n  \"watch_id\": \"email-watch\",\r\n  \"node\": \"3ENbp97oRlW0nSLgBjSpmw\",\r\n  \"state\": \"executed\",\r\n  \"status\": {\r\n    \"state\": {\r\n      \"active\": true,\r\n      \"timestamp\": \"2018-05-01T15:57:19.083Z\"\r\n    },\r\n    \"last_checked\": \"2018-05-01T15:58:19.605Z\",\r\n    \"last_met_condition\": \"2018-05-01T15:58:19.605Z\",\r\n    \"actions\": {\r\n      \"email_admin\": {\r\n        \"ack\": {\r\n          \"timestamp\": \"2018-05-01T15:57:19.083Z\",\r\n          \"state\": \"awaits_successful_execution\"\r\n        },\r\n        \"last_execution\": {\r\n          \"timestamp\": \"2018-05-01T15:58:19.605Z\",\r\n          \"successful\": false,\r\n          \"reason\": \"\"\r\n        }\r\n      }\r\n    },\r\n    \"execution_state\": \"executed\",\r\n    \"version\": -1\r\n  },\r\n  \"trigger_event\": {\r\n    \"type\": \"schedule\",\r\n    \"triggered_time\": \"2018-05-01T15:58:19.601Z\",\r\n    \"schedule\": {\r\n      \"scheduled_time\": \"2018-05-01T15:58:19.370Z\"\r\n    }\r\n  },\r\n  \"input\": {\r\n    \"none\": {}\r\n  },\r\n  \"condition\": {\r\n    \"always\": {}\r\n  },\r\n  \"result\": {\r\n    \"execution_time\": \"2018-05-01T15:58:19.605Z\",\r\n    \"execution_duration\": 186,\r\n    \"input\": {\r\n      \"type\": \"none\",\r\n      \"status\": \"success\",\r\n      \"payload\": {}\r\n    },\r\n    \"condition\": {\r\n      \"type\": \"always\",\r\n      \"status\": \"success\",\r\n      \"met\": true\r\n    },\r\n    \"actions\": [\r\n      {\r\n        \"id\": \"email_admin\",\r\n        \"type\": \"email\",\r\n        \"status\": \"failure\",\r\n        \"error\": {\r\n          \"root_cause\": [\r\n            {\r\n              \"type\": \"messaging_exception\",\r\n              \"reason\": \"failed to send email with subject [testing email with ssl] via account [test_account]\"\r\n            }\r\n          ],\r\n          \"type\": \"messaging_exception\",\r\n          \"reason\": \"failed to send email with subject [testing email with ssl] via account [test_account]\",\r\n          \"caused_by\": {\r\n            \"type\": \"messaging_exception\",\r\n            \"reason\": \"Could not convert socket to TLS\",\r\n            \"caused_by\": {\r\n              \"type\": \"s_s_l_handshake_exception\",\r\n              \"reason\": \"sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\",\r\n              \"caused_by\": {\r\n                \"type\": \"validator_exception\",\r\n                \"reason\": \"PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target\",\r\n                \"caused_by\": {\r\n                  \"type\": \"sun_cert_path_builder_exception\",\r\n                  \"reason\": \"unable to find valid certification path to requested target\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    ]\r\n  },\r\n  \"messages\": []\r\n}\r\n```\r\n\r\nWorkaround solution should be to add the CA to the JVM CA trust certificate store","closed_by":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"performed_via_github_app":null}