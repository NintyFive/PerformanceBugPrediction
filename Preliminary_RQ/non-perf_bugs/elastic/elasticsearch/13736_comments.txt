[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142599616","html_url":"https://github.com/elastic/elasticsearch/issues/13736#issuecomment-142599616","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13736","id":142599616,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjU5OTYxNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-23T13:28:10Z","updated_at":"2015-09-23T13:28:10Z","author_association":"CONTRIBUTOR","body":"Hi @mbechler \n\nWhich version are you referring to?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142599757","html_url":"https://github.com/elastic/elasticsearch/issues/13736#issuecomment-142599757","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13736","id":142599757,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjU5OTc1Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-09-23T13:28:39Z","updated_at":"2015-09-23T13:28:39Z","author_association":"CONTRIBUTOR","body":"@rmuir this sounds like your territory?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142606866","html_url":"https://github.com/elastic/elasticsearch/issues/13736#issuecomment-142606866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13736","id":142606866,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjYwNjg2Ng==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-09-23T13:48:42Z","updated_at":"2015-09-23T13:48:42Z","author_association":"CONTRIBUTOR","body":"there is no plan to allow permissions to setContextClassLoader anywhere in elasticsearch at the moment, it is denied, given that createClassLoader is also allowed. Maybe it changes in the future, but the combination of the two is too much.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142617217","html_url":"https://github.com/elastic/elasticsearch/issues/13736#issuecomment-142617217","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13736","id":142617217,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjYxNzIxNw==","user":{"login":"mbechler","id":4471061,"node_id":"MDQ6VXNlcjQ0NzEwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/4471061?v=4","gravatar_id":"","url":"https://api.github.com/users/mbechler","html_url":"https://github.com/mbechler","followers_url":"https://api.github.com/users/mbechler/followers","following_url":"https://api.github.com/users/mbechler/following{/other_user}","gists_url":"https://api.github.com/users/mbechler/gists{/gist_id}","starred_url":"https://api.github.com/users/mbechler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbechler/subscriptions","organizations_url":"https://api.github.com/users/mbechler/orgs","repos_url":"https://api.github.com/users/mbechler/repos","events_url":"https://api.github.com/users/mbechler/events{/privacy}","received_events_url":"https://api.github.com/users/mbechler/received_events","type":"User","site_admin":false},"created_at":"2015-09-23T14:23:13Z","updated_at":"2015-09-23T14:23:13Z","author_association":"NONE","body":"I'm not really sure I understand what you mean. This is not about the standalone server (where the described issue most certainly does not matter at all) but an embedded instance. Also it's not about having the ability to set a context classloader for some piece of code but about not leaking one from calling code. Also it's not only the context classloader that is a problem.\n\nAs I said, I was not really aware of the side-effects, if standalone is running with a SecurityManager (as I understand your comment) doing so generally is certainly out of the question.\n\nBut, right now I do have to wrap all my calls into the node client with a construct that drops TCCL, ACC and InheritableThreadLocals or otherwise I end up with massive classloader leaks. Scenario is OSGI where I'm running an elasticsearch node and a webapp container side-by-side - admittedly exotic - but the current code is conceptually wrong (one might very well argue this is a design flaw in the standard library - but fixing that will probably take years). \n\nIf one was able to override the ThreadFactory this could be fixed for environments where it matters in just a few lines of code (one might even ship an alternative ThreadFactory implementation).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142625199","html_url":"https://github.com/elastic/elasticsearch/issues/13736#issuecomment-142625199","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13736","id":142625199,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjYyNTE5OQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-09-23T14:47:41Z","updated_at":"2015-09-23T14:47:41Z","author_association":"CONTRIBUTOR","body":"Standalone is running with security manager and that is certainly the case we are trying to improve.\n\nHonestly we don't test running any other way (container or anything) and I do not even know if it is possible or works anymore at all. \n\nI don't think the code is \"wrong\" because I don't think elasticsearch should be this wonder-do-it-all-jar-file, that is a standalone server to some people, a java client to other people, and then N exotic cases (like embedded servers) to others. It is too many pressures tugging at too many directions and it causes the server to be too flaky, too lenient, and too complicated. This is just my opinion.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/142827800","html_url":"https://github.com/elastic/elasticsearch/issues/13736#issuecomment-142827800","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13736","id":142827800,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MjgyNzgwMA==","user":{"login":"mbechler","id":4471061,"node_id":"MDQ6VXNlcjQ0NzEwNjE=","avatar_url":"https://avatars1.githubusercontent.com/u/4471061?v=4","gravatar_id":"","url":"https://api.github.com/users/mbechler","html_url":"https://github.com/mbechler","followers_url":"https://api.github.com/users/mbechler/followers","following_url":"https://api.github.com/users/mbechler/following{/other_user}","gists_url":"https://api.github.com/users/mbechler/gists{/gist_id}","starred_url":"https://api.github.com/users/mbechler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbechler/subscriptions","organizations_url":"https://api.github.com/users/mbechler/orgs","repos_url":"https://api.github.com/users/mbechler/repos","events_url":"https://api.github.com/users/mbechler/events{/privacy}","received_events_url":"https://api.github.com/users/mbechler/received_events","type":"User","site_admin":false},"created_at":"2015-09-24T06:38:54Z","updated_at":"2015-09-24T06:38:54Z","author_association":"NONE","body":"Well, embedded node is the mode of operation suggested by the docs for java clients, so that cannot be too exotic. Everything else it takes to get hit by this is client code that is more short-lived (e.g. get redeployed) than the node.\n\nI'd still argue that the code is wrong, it is only correct by accident if there is a single calling context. Processing one callers requests with the AccessControlContext, TCCL, ... of another caller most certainly sounds not correct to me.\n\nAgain, I would already be very happy if I'm able to fix this for myself more easily which can be achieved by making the ThreadFactory configurable. I would even be willing to provide a patch, given it generally would be considered for merging.\n","performed_via_github_app":null}]