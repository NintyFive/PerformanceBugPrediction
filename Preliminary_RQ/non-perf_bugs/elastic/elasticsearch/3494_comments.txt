[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22744179","html_url":"https://github.com/elastic/elasticsearch/issues/3494#issuecomment-22744179","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3494","id":22744179,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzQ0MTc5","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"created_at":"2013-08-16T02:24:46Z","updated_at":"2013-08-16T02:24:46Z","author_association":"MEMBER","body":"@jcassee query In order to find operators, the query string parser is using spaces to split query string first and only then it passes each part through analyzer to produce token. Your query is basically equivalent to the query \"den OR haag\":\n\n```\n$ curl -XGET \"http://localhost:9200/geocoder/_validate/query?q=den+haag&analyzer=goabout&pretty=true&explain=true\"\n{\n  \"valid\" : true,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"explanations\" : [ {\n    \"index\" : \"test-idx\",\n    \"valid\" : true,\n    \"explanation\" : \"_all:den _all:haag\"\n  } ]\n}\n```\n\nHowever, if you provide \"den haag\" as a phrase, query string query passes it to analyzer as is:\n\n```\ncurl -XGET \"http://localhost:9200/geocoder/_validate/query?q=%22den+haag%22&analyzer=goabout&pretty=true&explain=true\"\n{\n  \"valid\" : true,\n  \"_shards\" : {\n    \"total\" : 1,\n    \"successful\" : 1,\n    \"failed\" : 0\n  },\n  \"explanations\" : [ {\n    \"index\" : \"test-idx\",\n    \"valid\" : true,\n    \"explanation\" : \"(_all:\\\"s gravenhage\\\")\"\n  } ]\n}\n```\n\nIf you are not going to use any query string query operators, I would suggest using [match query](http://www.elasticsearch.org/guide/reference/query-dsl/match-query/) instead of query string query. The match query is using actual analyzer to split query string into tokens instead of using spaces:\n\n```\ncurl -XGET \"http://localhost:9200/geocoder/_search/?pretty=true\" -d '{\n    \"query\": {\n        \"match\": {\n            \"_all\": {\n                \"query\": \"den haag\"\n            }\n        }\n    }\n}'\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22822251","html_url":"https://github.com/elastic/elasticsearch/issues/3494#issuecomment-22822251","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3494","id":22822251,"node_id":"MDEyOklzc3VlQ29tbWVudDIyODIyMjUx","user":{"login":"jcassee","id":20749,"node_id":"MDQ6VXNlcjIwNzQ5","avatar_url":"https://avatars1.githubusercontent.com/u/20749?v=4","gravatar_id":"","url":"https://api.github.com/users/jcassee","html_url":"https://github.com/jcassee","followers_url":"https://api.github.com/users/jcassee/followers","following_url":"https://api.github.com/users/jcassee/following{/other_user}","gists_url":"https://api.github.com/users/jcassee/gists{/gist_id}","starred_url":"https://api.github.com/users/jcassee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcassee/subscriptions","organizations_url":"https://api.github.com/users/jcassee/orgs","repos_url":"https://api.github.com/users/jcassee/repos","events_url":"https://api.github.com/users/jcassee/events{/privacy}","received_events_url":"https://api.github.com/users/jcassee/received_events","type":"User","site_admin":false},"created_at":"2013-08-18T00:13:53Z","updated_at":"2013-08-18T00:13:53Z","author_association":"NONE","body":"Thanks for the explanation, Igor. I'm closing this issue as it is not a problem with elasticsearch.\n","performed_via_github_app":null}]