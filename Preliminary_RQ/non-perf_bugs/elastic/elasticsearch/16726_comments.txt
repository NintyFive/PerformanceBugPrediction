[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185980657","html_url":"https://github.com/elastic/elasticsearch/issues/16726#issuecomment-185980657","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16726","id":185980657,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTk4MDY1Nw==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2016-02-18T23:36:33Z","updated_at":"2016-02-18T23:36:33Z","author_association":"CONTRIBUTOR","body":"There isn't a way to check an arbitrary classloader. If its a URLClassLoader, then you can, but this is not the case anymore since jigsaw. That's why `java.class.path` is used: it works everywhere when elasticsearch is run the way we run it (which is not OSGI).\n\nAdding a special hook for running in an OSGI container, e.g. an `instanceof URLClassLoader` might seem like a good idea, but then we lose important checks for everyone on java 8 that happen in the parsing itself (these detect e.g. stale shell scripts that add empty classpath elements, which convert to surprising locations).\n\ntrying to be even smarter and conditionally do something \"only when its a URLClassLoader and we are in a container\" is fairly sneaky, but might work. But we have to add this \"container detection\" logic (which likely needs special privileges for CL.getSystemClassLoader call) during bootstrap and expose it in BootStrapInfo... and somehow know that all this is working properly when we don't test running inside any containers. And there is really no guarantee containers are using URLClassLoaders.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185984719","html_url":"https://github.com/elastic/elasticsearch/issues/16726#issuecomment-185984719","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16726","id":185984719,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTk4NDcxOQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-02-18T23:55:18Z","updated_at":"2016-02-18T23:55:18Z","author_association":"CONTRIBUTOR","body":"there is also a setting in 2.2 that allows you to disable jarhell checks for testing `\ntests.jarhell.check=false` this might be the better solution for testing?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185989254","html_url":"https://github.com/elastic/elasticsearch/issues/16726#issuecomment-185989254","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16726","id":185989254,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTk4OTI1NA==","user":{"login":"pickypg","id":1501235,"node_id":"MDQ6VXNlcjE1MDEyMzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1501235?v=4","gravatar_id":"","url":"https://api.github.com/users/pickypg","html_url":"https://github.com/pickypg","followers_url":"https://api.github.com/users/pickypg/followers","following_url":"https://api.github.com/users/pickypg/following{/other_user}","gists_url":"https://api.github.com/users/pickypg/gists{/gist_id}","starred_url":"https://api.github.com/users/pickypg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pickypg/subscriptions","organizations_url":"https://api.github.com/users/pickypg/orgs","repos_url":"https://api.github.com/users/pickypg/repos","events_url":"https://api.github.com/users/pickypg/events{/privacy}","received_events_url":"https://api.github.com/users/pickypg/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T00:15:50Z","updated_at":"2016-02-19T00:15:50Z","author_association":"MEMBER","body":"@s1monw It ends up being bypassed when testing with plugins because the plugin manager bypasses the check.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186244297","html_url":"https://github.com/elastic/elasticsearch/issues/16726#issuecomment-186244297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16726","id":186244297,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjI0NDI5Nw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T14:54:08Z","updated_at":"2016-02-19T14:54:08Z","author_association":"MEMBER","body":"@pickypg Not if you construct a Node the new way. In master that would be using the Node constructor directly which takes plugin classes, or on 2.x using MockNode (as our tests do).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186881880","html_url":"https://github.com/elastic/elasticsearch/issues/16726#issuecomment-186881880","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16726","id":186881880,"node_id":"MDEyOklzc3VlQ29tbWVudDE4Njg4MTg4MA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-02-21T18:32:22Z","updated_at":"2016-02-21T18:32:22Z","author_association":"CONTRIBUTOR","body":"@pickypg is this solving you issue, can we close?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/243596168","html_url":"https://github.com/elastic/elasticsearch/issues/16726#issuecomment-243596168","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16726","id":243596168,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MzU5NjE2OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-08-30T22:03:58Z","updated_at":"2016-08-30T22:04:06Z","author_association":"MEMBER","body":"We [do not support](https://www.elastic.co/blog/elasticsearch-the-server) embedded Elasticsearch nodes.\n","performed_via_github_app":null}]