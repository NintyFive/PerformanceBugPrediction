{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/55102","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55102/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55102/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55102/events","html_url":"https://github.com/elastic/elasticsearch/issues/55102","id":598529854,"node_id":"MDU6SXNzdWU1OTg1Mjk4NTQ=","number":55102,"title":"_transform API does not support missing_bucket ","user":{"login":"gatling822","id":5474228,"node_id":"MDQ6VXNlcjU0NzQyMjg=","avatar_url":"https://avatars3.githubusercontent.com/u/5474228?v=4","gravatar_id":"","url":"https://api.github.com/users/gatling822","html_url":"https://github.com/gatling822","followers_url":"https://api.github.com/users/gatling822/followers","following_url":"https://api.github.com/users/gatling822/following{/other_user}","gists_url":"https://api.github.com/users/gatling822/gists{/gist_id}","starred_url":"https://api.github.com/users/gatling822/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gatling822/subscriptions","organizations_url":"https://api.github.com/users/gatling822/orgs","repos_url":"https://api.github.com/users/gatling822/repos","events_url":"https://api.github.com/users/gatling822/events{/privacy}","received_events_url":"https://api.github.com/users/gatling822/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"}],"state":"closed","locked":false,"assignee":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"assignees":[{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2020-04-12T17:12:57Z","updated_at":"2020-07-29T12:00:19Z","closed_at":"2020-07-29T12:00:19Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch/Kibana Version** 7.5.2 running in on-prem ECE\r\n\r\nWhile working with the _transaform API I noticed that documents were only getting grouped if all fields in the group by section had a value. Some reading in the composite aggregation documentation I see that this can be fixed by setting `missing_bucket` to true. The terms aggregation also has a `missing` parameter that can be set but that appears to no be supported either #48243\r\n\r\n[Composite Aggregation](https://www.elastic.co/guide/en/elasticsearch/reference/7.6/search-aggregations-bucket-composite-aggregation.html#_missing_bucket)\r\n\r\nAny idea how we can get around this?\r\n\r\n```json\r\nPOST _transform/_preview\r\n{\r\n  \"source\": {\r\n    \"index\": [\r\n      \"visanet-transaction*\"\r\n    ],\r\n    \"query\": {\r\n      \"match_all\": {}\r\n    }\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"dest\"\r\n  },\r\n  \"pivot\": {\r\n    \"group_by\": {\r\n      \"transactionTime\": {\r\n        \"date_histogram\": {\r\n          \"field\": \"transactionTime\",\r\n          \"fixed_interval\": \"1h\"\r\n        }\r\n      },\r\n      \"vipID\": {\r\n        \"terms\": {\r\n          \"field\": \"vipID\",\r\n          \"missing_bucket\": true\r\n        }\r\n      }\r\n    },\r\n    \"aggregations\": {\r\n      \"transactionID.value_count\": {\r\n        \"value_count\": {\r\n          \"field\": \"transactionID\"\r\n        }\r\n      },\r\n      \"usdAmount.sum\": {\r\n        \"sum\": {\r\n          \"field\": \"usdAmount\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nError:\r\n\r\n```json\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"x_content_parse_exception\",\r\n        \"reason\": \"[1:20] [data_frame_terms_group] unknown field [missing_bucket], parser not found\"\r\n      }\r\n    ],\r\n    \"type\": \"x_content_parse_exception\",\r\n    \"reason\": \"[1:167] [data_frame_transform_config] failed to parse field [pivot]\",\r\n    \"caused_by\": {\r\n      \"type\": \"x_content_parse_exception\",\r\n      \"reason\": \"[1:167] [data_frame_transform_pivot] failed to parse field [group_by]\",\r\n      \"caused_by\": {\r\n        \"type\": \"x_content_parse_exception\",\r\n        \"reason\": \"[1:20] [data_frame_terms_group] unknown field [missing_bucket], parser not found\"\r\n      }\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}