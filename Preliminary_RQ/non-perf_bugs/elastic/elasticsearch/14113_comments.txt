[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169179377","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-169179377","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":169179377,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTE3OTM3Nw==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T00:40:07Z","updated_at":"2016-01-06T00:40:07Z","author_association":"CONTRIBUTOR","body":"This is to track the removal of fielddata support for those fields that can use doc_values, not all fields. So, analyzed string fields will still use in-memory fielddata. The title of the issue kind of suggests the removal of in-memory fielddata overall.\n\nAlso, I'm wondering why we don't keep the option of having in-memory fielddata. For those use-cases where fielddata memory pressure is not a problem and the response time should be the fastest possible (considering that doc_values are slower than in-memory fielddata).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169263852","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-169263852","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":169263852,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTI2Mzg1Mg==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T08:15:43Z","updated_at":"2016-01-06T08:15:43Z","author_association":"CONTRIBUTOR","body":"> (considering that doc_values are slower than in-memory fielddata).\n\nour benchmarks show that this is not true. The perf tests are in the noise range and that is in an isolated env. ie. if you have pressure it might even be faster?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169297228","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-169297228","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":169297228,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTI5NzIyOA==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T10:58:08Z","updated_at":"2016-01-06T10:58:08Z","author_association":"CONTRIBUTOR","body":"@s1monw did anything change related to the doc_values implementation, so that we can start saying that doc_values are as fast as in-memory fielddata? Or we just performed different tests that show the same speed, and the tests themselves are now targeting different scenarios?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169323630","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-169323630","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":169323630,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTMyMzYzMA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T13:34:40Z","updated_at":"2016-01-06T13:34:40Z","author_association":"CONTRIBUTOR","body":"There have been significant improvements in versions 1.3 and 1.4 that made doc values perform within 15% of in-memory fielddata for fielddata-heavy use-cases (meaning it's likely less if the query is not trivial). But doc values have numerous benefits over in-memory fielddata:\n- more NRT-friendly\n- off-heap\n- keep working if the data are larger than the size of the main memory\n- don't remove duplicates for numeric fields so that eg sums or averages are correct\n\nIn my opinion, the fact that doc values are off-heap alone is worth the move to doc values. Eventually I'd love to see all users move to heaps below 4GB which would mean you would almost not have to worry about garbage collection anymore. This is why eg we also moved norms to disk in 2.1 with no way to go back to memory and reduced the memory usage of multi-valued doc values fields in the upcoming 2.2 release.  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/169325338","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-169325338","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":169325338,"node_id":"MDEyOklzc3VlQ29tbWVudDE2OTMyNTMzOA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-01-06T13:40:47Z","updated_at":"2016-01-06T13:40:47Z","author_association":"CONTRIBUTOR","body":"what @jpountz said... ;)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/178072457","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-178072457","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":178072457,"node_id":"MDEyOklzc3VlQ29tbWVudDE3ODA3MjQ1Nw==","user":{"login":"mkobrosli","id":9646923,"node_id":"MDQ6VXNlcjk2NDY5MjM=","avatar_url":"https://avatars2.githubusercontent.com/u/9646923?v=4","gravatar_id":"","url":"https://api.github.com/users/mkobrosli","html_url":"https://github.com/mkobrosli","followers_url":"https://api.github.com/users/mkobrosli/followers","following_url":"https://api.github.com/users/mkobrosli/following{/other_user}","gists_url":"https://api.github.com/users/mkobrosli/gists{/gist_id}","starred_url":"https://api.github.com/users/mkobrosli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkobrosli/subscriptions","organizations_url":"https://api.github.com/users/mkobrosli/orgs","repos_url":"https://api.github.com/users/mkobrosli/repos","events_url":"https://api.github.com/users/mkobrosli/events{/privacy}","received_events_url":"https://api.github.com/users/mkobrosli/received_events","type":"User","site_admin":false},"created_at":"2016-02-01T17:09:23Z","updated_at":"2016-02-01T17:09:23Z","author_association":"NONE","body":"I feel like this is too much of an opinionated choice for a system to enforce.  Why force something on people if people can get top speed and scalability that matches their needs, indexing strategy and field design.  It just seems like a strange choice to make.  doc values serve a purpose clearly, but not for everything.  There are iops considerations that come into play in quota enforced environments, as well as more OS context switching which becomes very relevant under high load public facing sites.  \n\nThe only way I could see this not angering a lot of people is to complement this in 3.0 by changing aggregation strategies to utilize the filter cache to implement aggregations.  Otherwise you are basically conceding the battle of speed and Solr becomes the only alternative to real scalable faceting.  I really hope we can at least get aggs cached properly if you do decide on killing fielddata.\n\nI really think this shows to much direction starting to move to big data / ELK usage and core search gets burned :( :-1: \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/178604579","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-178604579","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":178604579,"node_id":"MDEyOklzc3VlQ29tbWVudDE3ODYwNDU3OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-02-02T14:42:31Z","updated_at":"2016-02-02T14:42:31Z","author_association":"CONTRIBUTOR","body":"@mkobrosli see https://github.com/elastic/elasticsearch/issues/16108#issuecomment-173171419\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/215482846","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-215482846","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":215482846,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNTQ4Mjg0Ng==","user":{"login":"lusid","id":203284,"node_id":"MDQ6VXNlcjIwMzI4NA==","avatar_url":"https://avatars1.githubusercontent.com/u/203284?v=4","gravatar_id":"","url":"https://api.github.com/users/lusid","html_url":"https://github.com/lusid","followers_url":"https://api.github.com/users/lusid/followers","following_url":"https://api.github.com/users/lusid/following{/other_user}","gists_url":"https://api.github.com/users/lusid/gists{/gist_id}","starred_url":"https://api.github.com/users/lusid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lusid/subscriptions","organizations_url":"https://api.github.com/users/lusid/orgs","repos_url":"https://api.github.com/users/lusid/repos","events_url":"https://api.github.com/users/lusid/events{/privacy}","received_events_url":"https://api.github.com/users/lusid/received_events","type":"User","site_admin":false},"created_at":"2016-04-28T16:20:26Z","updated_at":"2016-04-28T16:20:26Z","author_association":"NONE","body":"I second what @mkobrosli is saying. We have manually disabled doc_values on all 1000+ fields in our ElasticSearch index because the performance loss for our application once doc_values is enabled is completely unacceptable. I haven't had a chance to do extensive testing using Google Cloud local SSDs to determine if doc_values could work in our scenario, but the few tests I have done after some short conversations with Peter Kim on the topic haven't given me much hope that this is going to improve our particular situation where aggregation and sorting performance is imperative across nearly any field in our index. The 10-15% loss of performance on some of our queries seems to take us back to the performance issues we were having with facets back in the v0.90 days.\n\nWe hate the fact that we are memory bound and want to be able to use doc_values exclusively, but at the end of the day, we are not yet confident that we can trade memory for disk IO. We also have concerns surrounding the fact we wouldn't have persistent disk to rely on in the case of a server failure since local SSDs would be wiped.\n\nI'm going to continue my testing first chance I get with v5 alpha, but I wanted to be sure I publicly stated our concern before it is too late.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/215488940","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-215488940","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":215488940,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNTQ4ODk0MA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-04-28T16:39:49Z","updated_at":"2016-04-28T16:39:49Z","author_association":"CONTRIBUTOR","body":"In-memory fielddata will not come back. It only existed because elasticsearch was created at a time when Lucene did not support columnar storage, but now it is part of the index format, just like the inverted index, norms, term vectors or stored fields, which cannot be loaded in memory.\n\nWe think enforcing doc values is good because even though it results in slow-downs for requests whose runtime is dominated by sorting or aggregations, the fact that we are not loading gigabytes in RAM anymore improved cluster stability and tail latencies since you are now less likely to have issues because of long garbage collections. Realtimeness also got better since you can now expect to see your indexed data after 1 second rather than 1 second + the time it takes to load fielddata from the inverted index.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/215490833","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-215490833","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":215490833,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNTQ5MDgzMw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-28T16:46:28Z","updated_at":"2016-04-28T16:46:28Z","author_association":"CONTRIBUTOR","body":">  the fact that we are not loading gigabytes in RAM \n\nThis should really say: \"loading gigabytes into the heap\".  Doc values still end up in RAM in the file system cache.  This makes them fast - they are not disk bound.  And you can fit a whole lot more doc values into the file system cache than you could into the limited java heap.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/227504920","html_url":"https://github.com/elastic/elasticsearch/issues/14113#issuecomment-227504920","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14113","id":227504920,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNzUwNDkyMA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-06-21T17:03:11Z","updated_at":"2016-06-21T17:03:11Z","author_association":"CONTRIBUTOR","body":"Done.\n","performed_via_github_app":null}]