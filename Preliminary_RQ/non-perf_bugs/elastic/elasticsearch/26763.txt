{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26763","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26763/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26763/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26763/events","html_url":"https://github.com/elastic/elasticsearch/issues/26763","id":260000512,"node_id":"MDU6SXNzdWUyNjAwMDA1MTI=","number":26763,"title":"Illegal combination of [copy_to] and [nested] mappings in elasticsearch-6.0.0-beta2","user":{"login":"osthus-co","id":4667239,"node_id":"MDQ6VXNlcjQ2NjcyMzk=","avatar_url":"https://avatars3.githubusercontent.com/u/4667239?v=4","gravatar_id":"","url":"https://api.github.com/users/osthus-co","html_url":"https://github.com/osthus-co","followers_url":"https://api.github.com/users/osthus-co/followers","following_url":"https://api.github.com/users/osthus-co/following{/other_user}","gists_url":"https://api.github.com/users/osthus-co/gists{/gist_id}","starred_url":"https://api.github.com/users/osthus-co/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/osthus-co/subscriptions","organizations_url":"https://api.github.com/users/osthus-co/orgs","repos_url":"https://api.github.com/users/osthus-co/repos","events_url":"https://api.github.com/users/osthus-co/events{/privacy}","received_events_url":"https://api.github.com/users/osthus-co/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":30486044,"node_id":"MDU6TGFiZWwzMDQ4NjA0NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eregression","name":">regression","color":"d7e102","default":false,"description":null},{"id":356863226,"node_id":"MDU6TGFiZWwzNTY4NjMyMjY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Pioneer%20Program","name":"Pioneer Program","color":"b60205","default":false,"description":null},{"id":675650443,"node_id":"MDU6TGFiZWw2NzU2NTA0NDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.0.0-beta2","name":"v6.0.0-beta2","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2017-09-23T11:05:32Z","updated_at":"2018-07-19T08:29:03Z","closed_at":"2017-09-25T13:07:28Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:  6.0.0-beta2, Build: 23ffa4f/2017-08-29T01:53:03.739Z, JVM: 1.8.0_131\r\n\r\n**Plugins installed**: none\r\n\r\n**JVM version**: 1.8.0_131-b11\r\n\r\n**OS version**: Windows 7 64 bit\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nVersion six no longer supports [copy_to] and [nested], see mapping below. This worked in version 5.\r\n\r\n**Steps to reproduce**:\r\n\r\n{\r\n\t\"mappings\": { \r\n\t\t\"types\": {\r\n\t\t\t\"properties\": {\r\n\t\t\t\t\"prop1\": {\r\n\t\t\t\t\t\"type\": \"nested\",\r\n\t\t\t\t\t\"properties\": {\r\n\t\t\t\t\t\t\"prop2\": {\r\n\t\t\t\t\t\t\t\"type\": \"keyword\", \"copy_to\": \"prop1.prop2.completion\",\r\n\t\t\t\t\t\t\t\"fields\": {\r\n\t\t\t\t\t\t\t\t\"completion\": { \"type\": \"completion\" }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n**Response**:\r\n\r\n{\r\n    \"error\": {\r\n        \"root_cause\": [\r\n            {\r\n                \"type\": \"illegal_argument_exception\",\r\n                \"reason\": \"Illegal combination of [copy_to] and [nested] mappings: [copy_to] may only copy data to the current nested document or any of its parents, however one [copy_to] directive is trying to copy data from nested object [**prop1**] to [**prop1**]\"\r\n            }\r\n        ],\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"Illegal combination of [copy_to] and [nested] mappings: [copy_to] may only copy data to the current nested document or any of its parents, however one [copy_to] directive is trying to copy data from nested object [prop1] to [prop1]\"\r\n    },\r\n    \"status\": 400\r\n}","closed_by":{"login":"osthus-co","id":4667239,"node_id":"MDQ6VXNlcjQ2NjcyMzk=","avatar_url":"https://avatars3.githubusercontent.com/u/4667239?v=4","gravatar_id":"","url":"https://api.github.com/users/osthus-co","html_url":"https://github.com/osthus-co","followers_url":"https://api.github.com/users/osthus-co/followers","following_url":"https://api.github.com/users/osthus-co/following{/other_user}","gists_url":"https://api.github.com/users/osthus-co/gists{/gist_id}","starred_url":"https://api.github.com/users/osthus-co/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/osthus-co/subscriptions","organizations_url":"https://api.github.com/users/osthus-co/orgs","repos_url":"https://api.github.com/users/osthus-co/repos","events_url":"https://api.github.com/users/osthus-co/events{/privacy}","received_events_url":"https://api.github.com/users/osthus-co/received_events","type":"User","site_admin":false},"performed_via_github_app":null}