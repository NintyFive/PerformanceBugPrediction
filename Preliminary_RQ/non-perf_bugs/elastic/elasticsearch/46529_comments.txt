[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/529859966","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-529859966","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":529859966,"node_id":"MDEyOklzc3VlQ29tbWVudDUyOTg1OTk2Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-09-10T09:46:37Z","updated_at":"2019-09-10T09:46:37Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/535537244","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-535537244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":535537244,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTUzNzI0NA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2019-09-26T14:44:11Z","updated_at":"2019-09-26T14:44:11Z","author_association":"CONTRIBUTOR","body":"I took a look at this and couldn't get it to reproduce reliably.\r\n\r\nIt may be a timeout issue if the test machine is running very slow. \r\nThe test logic tries to[ pick up a scroll id](https://github.com/elastic/elasticsearch/blob/master/x-pack/qa/rolling-upgrade/src/test/resources/rest-api-spec/test/upgraded_cluster/10_basic.yml#L7) that was [left by a previous test](https://github.com/elastic/elasticsearch/blob/master/x-pack/qa/rolling-upgrade/src/test/resources/rest-api-spec/test/mixed_cluster/10_basic.yml#L42). The timeout for the scroll is [5 minutes](https://github.com/elastic/elasticsearch/blob/master/x-pack/qa/rolling-upgrade/src/test/resources/rest-api-spec/test/mixed_cluster/10_basic.yml#L37) so if things are running especially slow then this may be insufficient and we see the errors relating to a loss of search context. We could look at increasing the timeout setting for this scroll?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/562782803","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-562782803","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":562782803,"node_id":"MDEyOklzc3VlQ29tbWVudDU2Mjc4MjgwMw==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2019-12-06T23:36:21Z","updated_at":"2019-12-06T23:36:21Z","author_association":"MEMBER","body":"It looks like @ywelsch recently merged a change to prevent shard relocations from happening during the upgrade (#48525). Could a shard reallocation have caused the 'search context missing' error? This seems plausible to me, but I am not a scroll expert -- perhaps @markharwood or @jimczi would be able to weigh in?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565097497","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-565097497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":565097497,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTA5NzQ5Nw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-12-12T17:09:06Z","updated_at":"2019-12-12T17:09:18Z","author_association":"CONTRIBUTOR","body":"I think this was fixed by #48525. No more failures of this test after that fix was merged. Closing this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565135279","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-565135279","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":565135279,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTEzNTI3OQ==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2019-12-12T18:50:51Z","updated_at":"2019-12-12T18:52:20Z","author_association":"MEMBER","body":"@ywelsch the test was immediately disabled, so unfortunately we don't have good information about the failure rate. I will try reenabling it, and we can reopen this issue if it fails again.\r\n\r\nAs a note, I looked through the full build log more carefully and saw that before the scroll failure, a bunch of tasks have piled up:\r\n\r\n```\r\njava.lang.AssertionError: there are still running tasks:\r\n    {time_in_queue=2.3s, time_in_queue_millis=2339, source=shard-failed, executing=true, priority=HIGH, insert_order=444}\r\n    {time_in_queue=1m, time_in_queue_millis=62781, source=finish persistent task (success), executing=false, priority=NORMAL, insert_order=357}\r\n    {time_in_queue=1m, time_in_queue_millis=61210, source=update task state, executing=false, priority=NORMAL, insert_order=359}\r\n    {time_in_queue=1m, time_in_queue_millis=62211, source=update task state, executing=false, priority=NORMAL, insert_order=358}\r\n    {time_in_queue=57.8s, time_in_queue_millis=57827, source=cluster_reroute(reroute after starting shards), executing=false, priority=NORMAL, insert_order=366}\r\n    {time_in_queue=1m, time_in_queue_millis=60212, source=update task state, executing=false, priority=NORMAL, insert_order=360}\r\n    {time_in_queue=59.2s, time_in_queue_millis=59212, source=update task state, executing=false, priority=NORMAL, insert_order=361}\r\n    {time_in_queue=58.2s, time_in_queue_millis=58211, source=update task state, executing=false, priority=NORMAL, insert_order=362}\r\n    {time_in_queue=50.2s, time_in_queue_millis=50211, source=update task state, executing=false, priority=NORMAL, insert_order=378}\r\n    {time_in_queue=53.2s, time_in_queue_millis=53210, source=update task state, executing=false, priority=NORMAL, insert_order=372}\r\n    {time_in_queue=57.2s, time_in_queue_millis=57212, source=update task state, executing=false, priority=NORMAL, insert_order=368}\r\n    {time_in_queue=56.2s, time_in_queue_millis=56211, source=update task state, executing=false, priority=NORMAL, insert_order=369}\r\n    {time_in_queue=55.2s, time_in_queue_millis=55210, source=update task state, executing=false, priority=NORMAL, insert_order=370}\r\n...\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565154791","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-565154791","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":565154791,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTE1NDc5MQ==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2019-12-12T19:40:55Z","updated_at":"2019-12-12T20:39:10Z","author_association":"MEMBER","body":"The test was reenabled:\r\n* d4ad75e57c0825e7c4b539aa5e9f806d8baf94eb (master)\r\n* 73c412063b74178bb895a9d01fd6996be011511b (7.x)\r\n* ba2dc49b845c641c523b93082dd0d2ec046d3435 (7.5)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565172444","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-565172444","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":565172444,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTE3MjQ0NA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-12-12T20:26:47Z","updated_at":"2019-12-12T20:26:47Z","author_association":"CONTRIBUTOR","body":"@jtibshirani good catch. I had missed that the test was still disabled. Let's reenable this both on master and 7.x and see if it is reoccurring (and reopen this issue then if necessary).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565394713","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-565394713","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":565394713,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTM5NDcxMw==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2019-12-13T10:46:57Z","updated_at":"2019-12-13T10:46:57Z","author_association":"CONTRIBUTOR","body":"@ywelsch this seems to be failing again, e.g. on master in https://gradle-enterprise.elastic.co/s/xxmcg4qhvabtw","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565542533","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-565542533","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":565542533,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTU0MjUzMw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-12-13T17:57:52Z","updated_at":"2019-12-13T17:57:52Z","author_association":"CONTRIBUTOR","body":"It looks like [Mark's theory here is correct](https://github.com/elastic/elasticsearch/issues/46529#issuecomment-535537244). I've looked through the node logs to find the events where the scroll was approximately started and the one where it was continued. Both are 5:30 apart, i.e.  just above the 5 minute scroll timeout:\r\n\r\n```\r\n[2019-12-13T09:17:30,289][INFO ][o.e.c.m.MetaDataCreateIndexService] [v8.0.0-2] [upgraded_scroll] creating index, cause [api], templates [], shards [1]/[0], mappings []\r\n...\r\n[2019-12-13T09:23:03,402][DEBUG][o.e.a.s.TransportSearchScrollAction] [v8.0.0-0] [126] Failed to execute query phase\r\norg.elasticsearch.transport.RemoteTransportException: [v8.0.0-0][127.0.0.1:41727][indices:data/read/search[phase/query+fetch/scroll]]\r\nCaused by: org.elasticsearch.search.SearchContextMissingException: No search context found for id [126]\r\n```\r\n\r\n@jtibshirani can you adjust the scroll timeout in the test?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565557050","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-565557050","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":565557050,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTU1NzA1MA==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2019-12-13T18:35:52Z","updated_at":"2019-12-13T18:35:52Z","author_association":"MEMBER","body":"Will do, thanks to you both for the debugging help.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/566234178","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-566234178","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":566234178,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjIzNDE3OA==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2019-12-16T20:41:47Z","updated_at":"2019-12-16T20:41:47Z","author_association":"MEMBER","body":"I've now bumped the keep-alive time from 5 to 10 minutes. I'll leave this open for a couple weeks, then close it out if we don't see more failures pop up.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/571249358","html_url":"https://github.com/elastic/elasticsearch/issues/46529#issuecomment-571249358","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46529","id":571249358,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTI0OTM1OA==","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"created_at":"2020-01-06T18:17:28Z","updated_at":"2020-01-06T18:17:28Z","author_association":"MEMBER","body":"I haven't seen new failures since we bumped the keep-alive time, so I will close this out.","performed_via_github_app":null}]