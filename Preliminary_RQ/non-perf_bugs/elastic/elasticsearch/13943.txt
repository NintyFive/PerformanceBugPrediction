{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13943","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13943/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13943/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13943/events","html_url":"https://github.com/elastic/elasticsearch/issues/13943","id":109806463,"node_id":"MDU6SXNzdWUxMDk4MDY0NjM=","number":13943,"title":"shard failed on field indexing failure (elasticsearch 1.7.2)","user":{"login":"thomasquatorze","id":13577078,"node_id":"MDQ6VXNlcjEzNTc3MDc4","avatar_url":"https://avatars3.githubusercontent.com/u/13577078?v=4","gravatar_id":"","url":"https://api.github.com/users/thomasquatorze","html_url":"https://github.com/thomasquatorze","followers_url":"https://api.github.com/users/thomasquatorze/followers","following_url":"https://api.github.com/users/thomasquatorze/following{/other_user}","gists_url":"https://api.github.com/users/thomasquatorze/gists{/gist_id}","starred_url":"https://api.github.com/users/thomasquatorze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thomasquatorze/subscriptions","organizations_url":"https://api.github.com/users/thomasquatorze/orgs","repos_url":"https://api.github.com/users/thomasquatorze/repos","events_url":"https://api.github.com/users/thomasquatorze/events{/privacy}","received_events_url":"https://api.github.com/users/thomasquatorze/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-10-05T14:19:53Z","updated_at":"2015-10-06T17:51:11Z","closed_at":"2015-10-06T13:50:54Z","author_association":"NONE","active_lock_reason":null,"body":"Upgrading from elastiscearch 1.7.1 to 1.7.2 shards started failing/initializing on field data index failure instead of just failing to index. This results in constant ongoing shard failures and initialization.\n\nElasticsearch 1.7.2 on Ubuntu Trusty with Oracle JDK 1.8u40\n\n[error] field containing bad data:\n\n```\n[2015-10-02 21:24:18,761][WARN ][cluster.action.shard     ] [elk-master003] [logstash-main-index-3-2015.10.02][3] received shard failed for [logstash-main-index-3-2015.10.02][3], node[85YLlAjAQT-q1dg1m3__aQ], relocating [RnkZoiSXTSiEhiKc4i3pZA], [P], s[INITIALIZING], indexUUID [WGwZFLMDSRaQEU69td2mFA], reason [shard failure [failed recovery][RecoveryFailedException[[logstash-main-index-3-2015.10.02][3]: Recovery failed from [elk-data009][RnkZoiSXTSiEhiKc4i3pZA][elk-data009.acme.com][inet[/10.143.15.236:9300]]{tag_type=prod, max_local_storage_nodes=1, tag_dc=dal09, master=false, tag_tier=elk-data} into [elk-data010][85YLlAjAQT-q1dg1m3__aQ][elk-data010.acme.com][inet[/10.143.15.242:9300]]{tag_type=prod, max_local_storage_nodes=1, tag_dc=dal09, master=false, tag_tier=elk-data}]; nested: RemoteTransportException[[elk-data009][inet[/10.143.15.236:9300]][internal:index/shard/recovery/start_recovery]]; nested: RecoveryEngineException[[logstash-main-index-3-2015.10.02][3] Phase[2] Execution failed]; nested: RemoteTransportException[[elk-data010][inet[/10.143.15.242:9300]][internal:index/shard/recovery/translog_ops]]; nested: MapperParsingException[object mapping for [app86] tried to parse field [error] as object, but got EOF, has a concrete value been provided to it?]; ]]\n```\n\n[activity_id] field was automatically set as \"date\" by first doc ingested when that field is usually a string resulting in subsequent field data failing to parse as date. This should Not fail shards and never did before upgrading to 1.7.2\n\n```\n[2015-10-05 12:31:03,699][WARN ][cluster.action.shard     ] [elk-master003] [logstash-main-index-2015.10.05][29] received shard failed for [logstash-main-index-2015.10.05][29], node[-B4M-bYsTiuxeGsyoCJ13A], [R], s[INITIALIZING], unassigned_info[[reason=ALLOCATION_FAILED], at[2015-10-05T12:30:53.962Z], details[shard failure [failed recovery][RecoveryFailedException[[logstash-main-index-2015.10.05][29]: Recovery failed from [elk-data006][tN1yZkfQTE-NeYp9SpwZtw][elk-data006.acme.com][inet[/10.143.15.166:9300]]{tag_type=prod, max_local_storage_nodes=1, tag_dc=dal09, master=false, tag_tier=elk-data} into [elk-data008][I6ikDzyoQZC2SJmQeKg5Jw][elk-data008.acme.com][inet[/10.143.15.181:9300]]{tag_type=prod, max_local_storage_nodes=1, tag_dc=dal09, master=false, tag_tier=elk-data}]; nested: RemoteTransportException[[elk-data006][inet[/10.143.15.166:9300]][internal:index/shard/recovery/start_recovery]]; nested: RecoveryEngineException[[logstash-main-index-2015.10.05][29] Phase[2] Execution failed]; nested: RemoteTransportException[[elk-data008][inet[/10.143.15.181:9300]][internal:index/shard/recovery/translog_ops]]; nested: MapperParsingException[failed to parse [activity_id]]; nested: MapperParsingException[failed to parse date field [01B56E68-901E-4256-ABB5-0537FB51AE99], tried both date format [dateOptionalTime], and timestamp number with locale []]; nested: IllegalArgumentException[Invalid format: \"01B58E68-921E-4256-ACB5-0537FB21AE99\" is malformed at \"B58E68-921E-4256-ACB5-0537FB21AE99\"]; ]]], indexUUID [5vHsvD-aSk2cLw_IzTO3XA], reason [shard failure [failed recovery][RecoveryFailedException[[logstash-main-index-2015.10.05][29]: Recovery failed from [elk-data006][tN1yZkfQTE-NeYp9SpwZtw][elk-data006.acme.com][inet[/10.143.15.166:9300]]{tag_type=prod, max_local_storage_nodes=1, tag_dc=dal09, master=false, tag_tier=elk-data} into [elk-data001][-B4M-bYsTiuxeGsyoCJ13A][elk-data001.acme.com][inet[/10.143.15.244:9300]]{tag_type=prod, max_local_storage_nodes=1, tag_dc=dal09, master=false, tag_tier=elk-data}]; nested: RemoteTransportException[[elk-data006][inet[/10.143.15.166:9300]][internal:index/shard/recovery/start_recovery]]; nested: RecoveryEngineException[[logstash-main-index-2015.10.05][29] Phase[2] Execution failed]; nested: RemoteTransportException[[elk-data001][inet[/10.143.15.244:9300]][internal:index/shard/recovery/translog_ops]]; nested: MapperParsingException[failed to parse [activity_id]]; nested: MapperParsingException[failed to parse date field [01B58E68-921E-4256-ACB5-0537FB21AE99], tried both date format [dateOptionalTime], and timestamp number with locale []]; nested: IllegalArgumentException[Invalid format: \"01B58E68-921E-4256-ACB5-0537FB21AE99\" is malformed at \"B58E68-921E-4256-ACB5-0537FB21AE99\"]; ]]\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}