{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2256","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2256/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2256/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2256/events","html_url":"https://github.com/elastic/elasticsearch/issues/2256","id":6898191,"node_id":"MDU6SXNzdWU2ODk4MTkx","number":2256,"title":"Cluster Reroute API: Allow to specify allocation commands","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"labels":[{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":12291478,"node_id":"MDU6TGFiZWwxMjI5MTQ3OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.19.10","name":"v0.19.10","color":"DDDDDD","default":false,"description":null},{"id":232920,"node_id":"MDU6TGFiZWwyMzI5MjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.20.0.RC1","name":"v0.20.0.RC1","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2012-09-15T20:55:48Z","updated_at":"2012-09-17T19:12:12Z","closed_at":"2012-09-15T20:56:18Z","author_association":"MEMBER","active_lock_reason":null,"body":"The reroute command allows to explcitiyly execute a cluster reroute allocation command including specific commands. For example, a shard can be moved from one node to another explicitly, an allocation can be canceled, or an unassigned shard can be explicitly allocated on a specific node.\n\nHere is a short example of how a simple reroute API call:\n\n```\ncurl -XPOST 'localhost:9200/_cluster/reroute' -d '{\n    \"commands\" : [\n        {\"move\" : {\"index\" : \"test\", \"shard\" : 0, \"from_node\" : \"node1\", \"to_node\" : \"node2\"}},\n        {\"allocate\" : {\"index\" : \"test\", \"shard\" : 1, \"node\" : \"node3\"}}\n    ]\n}'\n```\n\nAn importnat aspect to remember is the fact that once when an allocation occurs, the cluster will aim at rebalancing its state back to an even state. For example, if the allocation includes moving a shard from `node1` to `node2`, in an \"even\" state, then another shard will be moved from `node2` to `node1` to even things out.\n\nThe cluster can be set to disable allocations, which means that only the explicitl allocations will be performed. Obviously, only once all commands has been applied, the cluster will aim to be rebalance its state.\n\nAnohter option is to run the commands in \"dry_run\" (as a URI flag, or in the request body). This will cause the commands to apply to the current cluster state, and reutrn the resulting cluster after the comamnds (and rebalancing) has been applied.\n\nThe commands supporterd are:\n- `move`: Move a started shard from one node to anotehr node. Accepts `index` and `shard` for index name and shard number, `from_node` for the node to move the shard \"from\", and `to_node` for the node to move the shard to.\n- `cancel`: Cancel allocation of a shard (or recovery). Accepts `index` and `shard` for index name and shar number, and `node` for the node to cancel the shard allocation on. It also accepts `allow_primary` flag to explciitly specify that it is allowed to cancel allocation for a primary shard.\n- `allocate`: Allocate an unassigned shard to a node. Accepts the `index` and `shard` for index name and shard number, and `node` to allocate the shard to. It also accepts `allow_primary` flag to explciitly specify that it is allowed to explciitly allocate a primary shard (might result in data loss).\n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}