{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/35397","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35397/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35397/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35397/events","html_url":"https://github.com/elastic/elasticsearch/issues/35397","id":378950133,"node_id":"MDU6SXNzdWUzNzg5NTAxMzM=","number":35397,"title":"Retrying an ILM action that is an AsyncActionStep does not work due to execution model changes","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"labels":[{"id":912828538,"node_id":"MDU6TGFiZWw5MTI4Mjg1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/ILM+SLM","name":":Core/Features/ILM+SLM","color":"0e8a16","default":false,"description":"Index and Snapshot lifecycle management"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913658,"node_id":"MDU6TGFiZWw5MjkxMzY1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/blocker","name":"blocker","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"assignees":[{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-11-08T22:49:35Z","updated_at":"2018-11-12T19:33:00Z","closed_at":"2018-11-12T19:33:00Z","author_association":"MEMBER","active_lock_reason":null,"body":"When an index is stuck in the error state of a step which is an `AsyncActionStep`, like so:\r\n\r\n```json\r\nPUT _ilm/policy/bad\r\n{\r\n  \"policy\": {\r\n    \"phases\": {\r\n      \"warm\": {\r\n        \"min_age\": \"5s\",\r\n        \"actions\": {\r\n          \"shrink\": {\r\n            \"number_of_shards\": 13\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPUT /foo\r\n{\r\n  \"settings\": {\r\n    \"index.number_of_shards\": 2,\r\n    \"index.lifecycle.name\": \"bad\"\r\n  }\r\n}\r\n```\r\n\r\nWith error:\r\n\r\n```json\r\n{\r\n  \"indices\" : {\r\n    \"foo\" : {\r\n      \"index\" : \"foo\",\r\n      \"managed\" : true,\r\n      \"policy\" : \"bad\",\r\n      \"lifecycle_date\" : \"2018-11-08T22:47:45.865Z\",\r\n      \"lifecycle_date_millis\" : 1541717265865,\r\n      \"phase\" : \"warm\",\r\n      \"phase_time\" : \"2018-11-08T22:47:52.601Z\",\r\n      \"phase_time_millis\" : 1541717272601,\r\n      \"action\" : \"shrink\",\r\n      \"action_time\" : \"2018-11-08T22:47:52.601Z\",\r\n      \"action_time_millis\" : 1541717272601,\r\n      \"step\" : \"ERROR\",\r\n      \"step_time\" : \"2018-11-08T22:47:52.688Z\",\r\n      \"step_time_millis\" : 1541717272688,\r\n      \"failed_step\" : \"shrink\",\r\n      \"step_info\" : {\r\n        \"type\" : \"illegal_argument_exception\",\r\n        \"reason\" : \"the number of target shards [13] must be less that the number of source shards [2]\"\r\n      },\r\n      \"phase_execution\" : {\r\n        \"policy\" : \"bad\",\r\n        \"phase_definition\" : {\r\n          \"min_age\" : \"5s\",\r\n          \"actions\" : {\r\n            \"shrink\" : {\r\n              \"number_of_shards\" : 13\r\n            }\r\n          }\r\n        },\r\n        \"version\" : 5,\r\n        \"modified_date\" : \"2018-11-08T22:47:44.230Z\",\r\n        \"modified_date_in_millis\" : 1541717264230\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nWhen I correct the policy and issue a `POST /foo/_ilm/retry`...\r\n\r\nThe now `warm/shrink/shrink` step never executes, because we only execute `AsyncActionStep`s *when they are transitioned into*.\r\n\r\nThe 'retry' API should perform the correct steps to retry any type of operation.","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}