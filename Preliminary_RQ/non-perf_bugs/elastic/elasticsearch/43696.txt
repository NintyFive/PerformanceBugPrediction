{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43696","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43696/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43696/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43696/events","html_url":"https://github.com/elastic/elasticsearch/issues/43696","id":461543367,"node_id":"MDU6SXNzdWU0NjE1NDMzNjc=","number":43696,"title":"Elasticsearch docker image no longer ships unzip from 7.2.0 -> need new doc for certificate generation","user":{"login":"jguay","id":19236038,"node_id":"MDQ6VXNlcjE5MjM2MDM4","avatar_url":"https://avatars2.githubusercontent.com/u/19236038?v=4","gravatar_id":"","url":"https://api.github.com/users/jguay","html_url":"https://github.com/jguay","followers_url":"https://api.github.com/users/jguay/followers","following_url":"https://api.github.com/users/jguay/following{/other_user}","gists_url":"https://api.github.com/users/jguay/gists{/gist_id}","starred_url":"https://api.github.com/users/jguay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jguay/subscriptions","organizations_url":"https://api.github.com/users/jguay/orgs","repos_url":"https://api.github.com/users/jguay/repos","events_url":"https://api.github.com/users/jguay/events{/privacy}","received_events_url":"https://api.github.com/users/jguay/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"assignees":[{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-06-27T13:53:41Z","updated_at":"2020-11-11T21:55:40Z","closed_at":"2019-06-28T13:40:53Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\n7.2.0 docker (docker.elastic.co/elasticsearch/elasticsearch:7.2.0)\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWe document generating certificates using docker [here](https://www.elastic.co/guide/en/elasticsearch/reference/7.2/configuring-tls-docker.html) which makes use of [certutil](https://www.elastic.co/guide/en/elasticsearch/reference/7.2/certutil.html) outputing a zip file, which we then unzip\r\n\r\nPrevious to 7.2.0 elasticsearch image had unzip which was removed, but it's assumed it was wrong to include unzip in elasticsearch image and to use this.\r\n```\r\n$ docker run --rm -it docker.elastic.co/elasticsearch/elasticsearch:7.2.0 /bin/bash\r\n[root@01e46fafd1e4 elasticsearch]# unzip\r\nbash: unzip: command not found\r\n```\r\n\r\nWe should probably use tar.gz instead since tar is still part of the image, but then [certutil](https://www.elastic.co/guide/en/elasticsearch/reference/current/certutil.html) \"--out\" option generates only zip file regardlesss if extension would be tar.gz\r\n\r\n```\r\n$ file bundle.tar.gz\r\nbundle.tar.gz: Zip archive data, at least v2.0 to extract\r\n```\r\n\r\n**Steps to reproduce**:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/7.2/configuring-tls-docker.html\r\n\r\nThis will fail on unzip command\r\n\r\nThere may be several workarounds : \r\n1- Most simple, use elasticsearch 7.1.1 for the certificates generation\r\n2- Dockerfile to install unzip for the container used to run same script as documented\r\n3- Generate the zip file with that container, use another container for the unzipping of the certificates bundle.zip\r\n4- More complicated run several commands without using those from the context help from certutil, losing the ability to utilize silent mode of certutil\r\n```\r\nIf you specify any of the following options:\r\n    * -pem (PEM formatted output)\r\n    * -keep-ca-key (retain generated CA key)\r\n    * -multiple (generate multiple certificates)\r\n    * -in (generate certificates from an input file)\r\nthen the output will be be a zip file containing individual certificate/key files\r\n```\r\n\r\n\r\n","closed_by":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}