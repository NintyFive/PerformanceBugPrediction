{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24153","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24153/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24153/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24153/events","html_url":"https://github.com/elastic/elasticsearch/issues/24153","id":222364013,"node_id":"MDU6SXNzdWUyMjIzNjQwMTM=","number":24153,"title":"update script error","user":{"login":"orange-jacky","id":461594,"node_id":"MDQ6VXNlcjQ2MTU5NA==","avatar_url":"https://avatars2.githubusercontent.com/u/461594?v=4","gravatar_id":"","url":"https://api.github.com/users/orange-jacky","html_url":"https://github.com/orange-jacky","followers_url":"https://api.github.com/users/orange-jacky/followers","following_url":"https://api.github.com/users/orange-jacky/following{/other_user}","gists_url":"https://api.github.com/users/orange-jacky/gists{/gist_id}","starred_url":"https://api.github.com/users/orange-jacky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orange-jacky/subscriptions","organizations_url":"https://api.github.com/users/orange-jacky/orgs","repos_url":"https://api.github.com/users/orange-jacky/repos","events_url":"https://api.github.com/users/orange-jacky/events{/privacy}","received_events_url":"https://api.github.com/users/orange-jacky/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-04-18T10:02:06Z","updated_at":"2017-04-19T01:08:55Z","closed_at":"2017-04-18T10:29:44Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**:\r\nelasticsearch-2.3.5.tar.gz\r\n\r\n**Plugins installed**: []\r\nmodules [reindex, lang-expression, lang-groovy], plugins [license, delete-by-query], sites []\r\n\r\n**JVM version**:\r\njava version \"1.8.0_65\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_65-b17)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)\r\n\r\n**OS version**:\r\n[search@search-02 es1]$ lsb_release  -a\r\nLSB Version:\t:base-4.0-amd64:base-4.0-noarch:core-4.0-amd64:core-4.0-noarch:graphics-4.0-amd64:graphics-4.0-noarch:printing-4.0-amd64:printing-4.0-noarch\r\nDistributor ID:\tCentOS\r\nDescription:\tCentOS release 6.5 (Final)\r\nRelease:\t6.5\r\nCodename:\tFinal\r\n\r\n[search@search-02 es1]$ uname -a\r\nLinux search-02.cloud.mos 2.6.32-431.1.2.0.1.el6.x86_64 #1 SMP Fri Dec 13 13:06:13 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nPUT test/type1/1\r\n{\r\n    \"counter\" : 1,\r\n    \"tags\" : [\"red\"]\r\n}\r\nit ok\r\n\r\nPOST test/type1/1/_update\r\n{\r\n    \"script\" : {\r\n        \"inline\": \"ctx._source.counter += count\",\r\n        \"params\" : {\r\n            \"count\" : 4\r\n        }\r\n    }\r\n}\r\n\r\nit fail.\r\n\r\nerror info:\r\n\r\n   \"error\": {\r\n      \"root_cause\": [\r\n         {\r\n            \"type\": \"remote_transport_exception\",\r\n            \"reason\": \"[node-3][172.16.8.145:9300][indices:data/write/update[s]]\"\r\n         }\r\n      ],\r\n      \"type\": \"illegal_argument_exception\",\r\n      \"reason\": \"failed to execute script\",\r\n      \"caused_by\": {\r\n         \"type\": \"script_exception\",\r\n         \"reason\": \"failed to run inline script [ctx._source.counter += count] using lang [groovy]\",\r\n         \"caused_by\": {\r\n            \"type\": \"no_class_def_found_error\",\r\n            \"reason\": \"Could not initialize class org.codehaus.groovy.vmplugin.v7.IndyGuardsFiltersAndSignatures\"\r\n         }\r\n      }\r\n   },\r\n   \"status\": 400\r\n}\r\nï¿¼\r\n<img width=\"928\" alt=\"ok\" src=\"https://cloud.githubusercontent.com/assets/461594/25125844/da127d4e-2462-11e7-9def-5c13789f42d2.png\">\r\n\r\n\r\n<img width=\"936\" alt=\"fail\" src=\"https://cloud.githubusercontent.com/assets/461594/25125857/e507736c-2462-11e7-8a58-4de0f4372ae0.png\">\r\n\r\n\r\n\r\n**Steps to reproduce**:\r\n 1. create a cluster, has 3 nodes\r\n 2.start the cluster\r\n 3.the flowwing is configure file\r\n[elasticsearch.yml.zip](https://github.com/elastic/elasticsearch/files/928483/elasticsearch.yml.zip)\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n[cheackflight_dev.log.zip](https://github.com/elastic/elasticsearch/files/928507/cheackflight_dev.log.zip)\r\n\r\n\r\n<!--\r\nIf you are filing a feature request, please remove the above bug\r\nreport block and provide responses for all of the below items.\r\n-->\r\n\r\n**Describe the feature**:\r\n\r\n\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}