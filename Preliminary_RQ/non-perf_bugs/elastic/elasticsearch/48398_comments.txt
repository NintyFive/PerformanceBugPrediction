[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/545454040","html_url":"https://github.com/elastic/elasticsearch/issues/48398#issuecomment-545454040","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48398","id":545454040,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NTQ1NDA0MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-10-23T13:51:16Z","updated_at":"2019-10-23T13:51:16Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/Snapshot/Restore)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/545456401","html_url":"https://github.com/elastic/elasticsearch/issues/48398#issuecomment-545456401","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48398","id":545456401,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NTQ1NjQwMQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-10-23T13:56:24Z","updated_at":"2019-10-23T13:56:24Z","author_association":"CONTRIBUTOR","body":"Note that this is not what I would call a half-deleted snapshot (i.e. a deletion that was executed by the system and failed mid-way through), but your step 3 deliberately corrupts the repository.\r\n\r\nCan you check if you can query the list of snapshots with `ignore_unavailable`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/545473445","html_url":"https://github.com/elastic/elasticsearch/issues/48398#issuecomment-545473445","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48398","id":545473445,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NTQ3MzQ0NQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-10-23T14:33:18Z","updated_at":"2019-10-23T14:33:18Z","author_association":"MEMBER","body":"This is a known possible corruption unfortunately. It was eventually fixed and won't happen again on its own in `6.8.1` and must have broken in an earlier version. I don't think we can do much or anything here. We shouldn't do any repairs on the repo to filter out the snapshot with missing metadata as a corrupted repo could miss other files quietly as well and would give the potentially impression of being a valid backup.\r\n-> I'd close here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/545755909","html_url":"https://github.com/elastic/elasticsearch/issues/48398#issuecomment-545755909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48398","id":545755909,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NTc1NTkwOQ==","user":{"login":"centic9","id":548322,"node_id":"MDQ6VXNlcjU0ODMyMg==","avatar_url":"https://avatars0.githubusercontent.com/u/548322?v=4","gravatar_id":"","url":"https://api.github.com/users/centic9","html_url":"https://github.com/centic9","followers_url":"https://api.github.com/users/centic9/followers","following_url":"https://api.github.com/users/centic9/following{/other_user}","gists_url":"https://api.github.com/users/centic9/gists{/gist_id}","starred_url":"https://api.github.com/users/centic9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/centic9/subscriptions","organizations_url":"https://api.github.com/users/centic9/orgs","repos_url":"https://api.github.com/users/centic9/repos","events_url":"https://api.github.com/users/centic9/events{/privacy}","received_events_url":"https://api.github.com/users/centic9/received_events","type":"User","site_admin":false},"created_at":"2019-10-24T05:49:32Z","updated_at":"2019-10-24T05:49:32Z","author_association":"CONTRIBUTOR","body":"Sorry for being unclear, we experienced the broken repository without those reproducing-steps. However hey allow to produce a repository which shows that a single broken snapshot renders the complete repository unusable. \r\n\r\nNice that there were some fixes to the deletion-functionality, we upgraded recently, so it might actually be the case. \r\n\r\nOverall a way to cleanly recover the repository from such a state would be good to have in the future for improved resilience.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/545780593","html_url":"https://github.com/elastic/elasticsearch/issues/48398#issuecomment-545780593","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48398","id":545780593,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NTc4MDU5Mw==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-10-24T07:15:31Z","updated_at":"2019-10-24T07:15:31Z","author_association":"MEMBER","body":"> However hey allow to produce a repository which shows that a single broken snapshot renders the complete repository unusable.\r\n\r\nI would argue that this is by design. Due to the incremental nature of snapshotting one broken snapshot from a missing file may not be an isolated problem. If it's a `snap-` blob, then yes it's isolated and the way we got here was an unfortunate bug. If it were a `__fgd..`  data blob then it wouldn't be an isolated thing at all. In the end, a repository simply should never ever lose a file, if it does something is wrong.\r\n\r\n> Overall a way to cleanly recover the repository from such a state would be good to have in the future for improved resilience.\r\n\r\nRegardless of the above, I fully agree and it's something we're exploring at the moment.\r\n\r\n> Nice that there were some fixes to the deletion-functionality, we upgraded recently, so it might actually be the case.\r\n\r\nThanks for confirming the upgrade part. I think with that we can safely close here. It's unfortunate that a past bug got us here, but nothing can be done about it here at this point I'm afraid.","performed_via_github_app":null}]