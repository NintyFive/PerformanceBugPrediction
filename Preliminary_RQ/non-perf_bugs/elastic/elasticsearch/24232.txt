{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24232","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24232/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24232/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24232/events","html_url":"https://github.com/elastic/elasticsearch/issues/24232","id":223296722,"node_id":"MDU6SXNzdWUyMjMyOTY3MjI=","number":24232,"title":"Score in Different Shards are not Compatible ","user":{"login":"nbqyqx","id":14268143,"node_id":"MDQ6VXNlcjE0MjY4MTQz","avatar_url":"https://avatars1.githubusercontent.com/u/14268143?v=4","gravatar_id":"","url":"https://api.github.com/users/nbqyqx","html_url":"https://github.com/nbqyqx","followers_url":"https://api.github.com/users/nbqyqx/followers","following_url":"https://api.github.com/users/nbqyqx/following{/other_user}","gists_url":"https://api.github.com/users/nbqyqx/gists{/gist_id}","starred_url":"https://api.github.com/users/nbqyqx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nbqyqx/subscriptions","organizations_url":"https://api.github.com/users/nbqyqx/orgs","repos_url":"https://api.github.com/users/nbqyqx/repos","events_url":"https://api.github.com/users/nbqyqx/events{/privacy}","received_events_url":"https://api.github.com/users/nbqyqx/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-04-21T07:07:05Z","updated_at":"2017-04-24T11:16:10Z","closed_at":"2017-04-24T11:16:10Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**:\r\n2.3.3 BM25 Similarity\r\n**Plugins installed**: []\r\n\r\n**JVM version**:\r\nopen jdk 1.8\r\n**OS version**:\r\nmac os\r\n**Description of the problem including expected versus actual behavior**:\r\nScore in different shards are not Compatible. For the same query ```\"match\" : {  \"building_house_type_name\" : \"test\" }``` we may need get the same IDF for the different shards. So that the doc score in different shards are compatible.\r\nThe cause of irrelevant IDFs is the docFreqs are different.\r\n\r\n**Steps to reproduce**:\r\n 1.Query==> \"match\" : {  \"building_house_type_name\" : \"test\" }\r\n 2.\r\n 3.\r\n\r\n**Provide logs (if relevant)**:\r\n```json\r\n  {\r\n\"_shard\": 0,\r\n...\r\n\"_explanation\": {\r\n\"value\": 0.41010404,\r\n...\r\n\"description\": \"weight(building_house_type_name:test in 12130) [PerFieldSimilarity], result of:\",\r\n...\r\n\"value\": 4.553907,\r\n\"description\": \"idf(docFreq=175, maxDocs=16672)\",\r\n\r\n```\r\n```json\r\n{\r\n\"_shard\": 2,\r\n...\r\n\"_explanation\": {\r\n...\r\n\"description\": \"weight(building_house_type_name:test in 1) [PerFieldSimilarity], result of:\",\r\n...\r\n\"value\": 4.454347,\r\n\"description\": \"idf(docFreq=199, maxDocs=17156)\",\r\n\r\n  {...}\r\n\r\n```\r\n<!--\r\nIf you are filing a feature request, please remove the above bug\r\nreport block and provide responses for all of the below items.\r\n-->\r\n\r\n**Describe the feature**:\r\nIf it is possible to collect all metadata of document in the master node and compute the score then sort the doc? So that the docs in different shards are compatible.\r\n\r\nNeal","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}