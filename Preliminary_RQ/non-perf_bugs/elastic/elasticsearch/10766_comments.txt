[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/95834064","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-95834064","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":95834064,"node_id":"MDEyOklzc3VlQ29tbWVudDk1ODM0MDY0","user":{"login":"nilsga","id":42919,"node_id":"MDQ6VXNlcjQyOTE5","avatar_url":"https://avatars0.githubusercontent.com/u/42919?v=4","gravatar_id":"","url":"https://api.github.com/users/nilsga","html_url":"https://github.com/nilsga","followers_url":"https://api.github.com/users/nilsga/followers","following_url":"https://api.github.com/users/nilsga/following{/other_user}","gists_url":"https://api.github.com/users/nilsga/gists{/gist_id}","starred_url":"https://api.github.com/users/nilsga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilsga/subscriptions","organizations_url":"https://api.github.com/users/nilsga/orgs","repos_url":"https://api.github.com/users/nilsga/repos","events_url":"https://api.github.com/users/nilsga/events{/privacy}","received_events_url":"https://api.github.com/users/nilsga/received_events","type":"User","site_admin":false},"created_at":"2015-04-24T07:28:08Z","updated_at":"2015-04-24T07:28:08Z","author_association":"NONE","body":"Here's a gist with output from the stats/health endpoints: https://gist.github.com/nilsga/cd1f0f037b43340f7ad0\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/95881054","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-95881054","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":95881054,"node_id":"MDEyOklzc3VlQ29tbWVudDk1ODgxMDU0","user":{"login":"kimjoar","id":5259,"node_id":"MDQ6VXNlcjUyNTk=","avatar_url":"https://avatars2.githubusercontent.com/u/5259?v=4","gravatar_id":"","url":"https://api.github.com/users/kimjoar","html_url":"https://github.com/kimjoar","followers_url":"https://api.github.com/users/kimjoar/followers","following_url":"https://api.github.com/users/kimjoar/following{/other_user}","gists_url":"https://api.github.com/users/kimjoar/gists{/gist_id}","starred_url":"https://api.github.com/users/kimjoar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimjoar/subscriptions","organizations_url":"https://api.github.com/users/kimjoar/orgs","repos_url":"https://api.github.com/users/kimjoar/repos","events_url":"https://api.github.com/users/kimjoar/events{/privacy}","received_events_url":"https://api.github.com/users/kimjoar/received_events","type":"User","site_admin":false},"created_at":"2015-04-24T10:08:25Z","updated_at":"2015-04-24T10:08:25Z","author_association":"NONE","body":"This just occured again, but now with:\n\n```\n{\"version\":\"1.8.0_31\",\"vm_name\":\"Java HotSpot(TM) 64-Bit Server VM\",\"vm_version\":\"25.31-b07\",\"vm_vendor\":\"Oracle Corporation\",\"count\":1}\n```\n\nThis time it ran on localhost with one server connecting to one Elasticsearch node (compared to above with our cluster of 5 nodes connecting to 7 elasticsearch nodes).\n\nI've included a thread dump at https://gist.github.com/kjbekkelund/405580860216d1d69b8f\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96406220","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96406220","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96406220,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDA2MjIw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T16:41:18Z","updated_at":"2015-04-26T16:41:18Z","author_association":"CONTRIBUTOR","body":"Wondering if this is related to https://github.com/elastic/elasticsearch/issues/10704\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96406228","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96406228","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96406228,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDA2MjI4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T16:41:29Z","updated_at":"2015-04-26T16:41:29Z","author_association":"CONTRIBUTOR","body":"@spinscale any thoughts here?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96418350","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96418350","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96418350,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDE4MzUw","user":{"login":"nilsga","id":42919,"node_id":"MDQ6VXNlcjQyOTE5","avatar_url":"https://avatars0.githubusercontent.com/u/42919?v=4","gravatar_id":"","url":"https://api.github.com/users/nilsga","html_url":"https://github.com/nilsga","followers_url":"https://api.github.com/users/nilsga/followers","following_url":"https://api.github.com/users/nilsga/following{/other_user}","gists_url":"https://api.github.com/users/nilsga/gists{/gist_id}","starred_url":"https://api.github.com/users/nilsga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilsga/subscriptions","organizations_url":"https://api.github.com/users/nilsga/orgs","repos_url":"https://api.github.com/users/nilsga/repos","events_url":"https://api.github.com/users/nilsga/events{/privacy}","received_events_url":"https://api.github.com/users/nilsga/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T18:29:06Z","updated_at":"2015-04-26T18:29:06Z","author_association":"NONE","body":"I think we have located the trigger of the problem. The thread dump for the `transport_client` thread was missing some interesting information. This is a more complete stack:\n\n```\n elasticsearch[Magneto][transport_client_worker][T#4]{New I/O worker #4} [WAITING] [DAEMON]\n*** java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(int) AbstractQueuedSynchronizer.java:1304\n*** org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get() BaseFuture.java:279\n*** org.elasticsearch.common.util.concurrent.BaseFuture.get() BaseFuture.java:118\n*** org.elasticsearch.action.support.AdapterActionFuture.actionGet() AdapterActionFuture.java:45\n\n<some company specific classes>\n\n*** org.elasticsearch.action.support.AbstractListenableActionFuture.executeListener(ActionListener) AbstractListenableActionFuture.java:120\n*** org.elasticsearch.action.support.AbstractListenableActionFuture.done() AbstractListenableActionFuture.java:97\n*** org.elasticsearch.common.util.concurrent.BaseFuture.set(Object) BaseFuture.java:167\norg.elasticsearch.action.support.AdapterActionFuture.onResponse(Object) AdapterActionFuture.java:96\norg.elasticsearch.client.transport.TransportClientNodesService$RetryListener.onResponse(Object) TransportClientNodesService.java:227\norg.elasticsearch.action.TransportActionNodeProxy$1.handleResponse(ActionResponse) TransportActionNodeProxy.java:73\norg.elasticsearch.action.TransportActionNodeProxy$1.handleResponse(TransportResponse) TransportActionNodeProxy.java:57\norg.elasticsearch.transport.netty.MessageChannelHandler.handleResponse(Channel, StreamInput, TransportResponseHandler) MessageChannelHandler.java:163\norg.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(ChannelHandlerContext, MessageEvent) MessageChannelHandler.java:132\norg.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(ChannelHandlerContext, ChannelEvent) SimpleChannelUpstreamHandler.java:70\norg.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline$DefaultChannelHandlerContext, ChannelEvent) DefaultChannelPipeline.java:564\norg.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(ChannelEvent) DefaultChannelPipeline.java:791\norg.elasticsearch.common.netty.channel.Channels.fireMessageReceived(ChannelHandlerContext, Object, SocketAddress) Channels.java:296\norg.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(ChannelHandlerContext, SocketAddress, Object) FrameDecoder.java:462\norg.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.callDecode(ChannelHandlerContext, Channel, ChannelBuffer, SocketAddress) FrameDecoder.java:443\norg.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.messageReceived(ChannelHandlerContext, MessageEvent) FrameDecoder.java:303\norg.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(ChannelHandlerContext, ChannelEvent) SimpleChannelUpstreamHandler.java:70\norg.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline$DefaultChannelHandlerContext, ChannelEvent) DefaultChannelPipeline.java:564\norg.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(ChannelEvent) DefaultChannelPipeline.java:559\norg.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channel, Object, SocketAddress) Channels.java:268\norg.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channel, Object) Channels.java:255\norg.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(SelectionKey) NioWorker.java:88\norg.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(Selector) AbstractNioWorker.java:108\norg.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run() AbstractNioSelector.java:337\norg.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run() AbstractNioWorker.java:89\norg.elasticsearch.common.netty.channel.socket.nio.NioWorker.run() NioWorker.java:178\norg.elasticsearch.common.netty.util.ThreadRenamingRunnable.run() ThreadRenamingRunnable.java:108\norg.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run() DeadLockProofWorker.java:42\njava.lang.Thread.run() Thread.java:745\n```\n\nSo what has happened is that our application code executed a new call to ES within the completion handler of the previous ES call, which in turn is executed on the `transport_client` thread. This is obviously not a good idea, so we have to change this. But still, it would be interesting to know why this would cause (what looks like) a deadlock, and why it impacts other ES requests as well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96418697","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96418697","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96418697,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDE4Njk3","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T18:35:48Z","updated_at":"2015-04-26T18:35:48Z","author_association":"CONTRIBUTOR","body":"I think we this is the same issue https://github.com/elastic/elasticsearch/pull/10644 ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96420088","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96420088","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96420088,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDIwMDg4","user":{"login":"kimjoar","id":5259,"node_id":"MDQ6VXNlcjUyNTk=","avatar_url":"https://avatars2.githubusercontent.com/u/5259?v=4","gravatar_id":"","url":"https://api.github.com/users/kimjoar","html_url":"https://github.com/kimjoar","followers_url":"https://api.github.com/users/kimjoar/followers","following_url":"https://api.github.com/users/kimjoar/following{/other_user}","gists_url":"https://api.github.com/users/kimjoar/gists{/gist_id}","starred_url":"https://api.github.com/users/kimjoar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimjoar/subscriptions","organizations_url":"https://api.github.com/users/kimjoar/orgs","repos_url":"https://api.github.com/users/kimjoar/repos","events_url":"https://api.github.com/users/kimjoar/events{/privacy}","received_events_url":"https://api.github.com/users/kimjoar/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T18:52:51Z","updated_at":"2015-04-26T18:52:51Z","author_association":"NONE","body":"@s1monw Not sure I've understood that issue correctly, but is this only when there is a connection error? Will we see these connection error in the Elasticsearch logs? I can't seem to find anything in the logs that indicate any issues. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96420283","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96420283","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96420283,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDIwMjgz","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T18:53:41Z","updated_at":"2015-04-26T18:53:41Z","author_association":"CONTRIBUTOR","body":"@kjbekkelund I think this is can happen on all retries of some sort?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96420811","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96420811","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96420811,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDIwODEx","user":{"login":"kimjoar","id":5259,"node_id":"MDQ6VXNlcjUyNTk=","avatar_url":"https://avatars2.githubusercontent.com/u/5259?v=4","gravatar_id":"","url":"https://api.github.com/users/kimjoar","html_url":"https://github.com/kimjoar","followers_url":"https://api.github.com/users/kimjoar/followers","following_url":"https://api.github.com/users/kimjoar/following{/other_user}","gists_url":"https://api.github.com/users/kimjoar/gists{/gist_id}","starred_url":"https://api.github.com/users/kimjoar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimjoar/subscriptions","organizations_url":"https://api.github.com/users/kimjoar/orgs","repos_url":"https://api.github.com/users/kimjoar/repos","events_url":"https://api.github.com/users/kimjoar/events{/privacy}","received_events_url":"https://api.github.com/users/kimjoar/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T18:58:27Z","updated_at":"2015-04-26T19:04:57Z","author_association":"NONE","body":"@s1monw Ah, of course, `RetryListener`. Btw, this also happenend on `localhost`, so there shouldn't be any connection errors at least. I'm not sure when Elasticsearch retries — we have some update calls, but I can't seem to be able to correlate this error with those calls.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96421393","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96421393","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96421393,"node_id":"MDEyOklzc3VlQ29tbWVudDk2NDIxMzkz","user":{"login":"nilsga","id":42919,"node_id":"MDQ6VXNlcjQyOTE5","avatar_url":"https://avatars0.githubusercontent.com/u/42919?v=4","gravatar_id":"","url":"https://api.github.com/users/nilsga","html_url":"https://github.com/nilsga","followers_url":"https://api.github.com/users/nilsga/followers","following_url":"https://api.github.com/users/nilsga/following{/other_user}","gists_url":"https://api.github.com/users/nilsga/gists{/gist_id}","starred_url":"https://api.github.com/users/nilsga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilsga/subscriptions","organizations_url":"https://api.github.com/users/nilsga/orgs","repos_url":"https://api.github.com/users/nilsga/repos","events_url":"https://api.github.com/users/nilsga/events{/privacy}","received_events_url":"https://api.github.com/users/nilsga/received_events","type":"User","site_admin":false},"created_at":"2015-04-26T19:08:13Z","updated_at":"2015-04-26T19:10:17Z","author_association":"NONE","body":"It looks related, but I'm not sure its the same issue. In our case, it is the success handler that has been invoked on the `transport_client` thread.\n\nEdit: Didn't see the responses in between. Yeah, I guess if there have been some retries in between, it could be the same issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96694080","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96694080","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96694080,"node_id":"MDEyOklzc3VlQ29tbWVudDk2Njk0MDgw","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-04-27T15:05:20Z","updated_at":"2015-04-27T15:05:20Z","author_association":"CONTRIBUTOR","body":"> It looks related, but I'm not sure its the same issue. In our case, it is the success handler that has been invoked on the transport_client thread.\n\nso IMO what happens here and as well as in #10644 is that we are executing stuff on the transport clients thread which is actually the default behavior. if you want this you can set `#listenerThreaded(true)` on your request then this shouldn't happen anymore. We need to find a better solution for this in the future...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96811772","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96811772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96811772,"node_id":"MDEyOklzc3VlQ29tbWVudDk2ODExNzcy","user":{"login":"nilsga","id":42919,"node_id":"MDQ6VXNlcjQyOTE5","avatar_url":"https://avatars0.githubusercontent.com/u/42919?v=4","gravatar_id":"","url":"https://api.github.com/users/nilsga","html_url":"https://github.com/nilsga","followers_url":"https://api.github.com/users/nilsga/followers","following_url":"https://api.github.com/users/nilsga/following{/other_user}","gists_url":"https://api.github.com/users/nilsga/gists{/gist_id}","starred_url":"https://api.github.com/users/nilsga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilsga/subscriptions","organizations_url":"https://api.github.com/users/nilsga/orgs","repos_url":"https://api.github.com/users/nilsga/repos","events_url":"https://api.github.com/users/nilsga/events{/privacy}","received_events_url":"https://api.github.com/users/nilsga/received_events","type":"User","site_admin":false},"created_at":"2015-04-27T20:35:04Z","updated_at":"2015-04-27T20:35:04Z","author_association":"NONE","body":"But why the apparent deadlock? \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96981246","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-96981246","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":96981246,"node_id":"MDEyOklzc3VlQ29tbWVudDk2OTgxMjQ2","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T08:54:13Z","updated_at":"2015-04-28T08:54:13Z","author_association":"CONTRIBUTOR","body":"> But why the apparent deadlock?\n\nI don't know your code but if you execute a blocking network operation on a thread that is supposed to execute this operation as well as handling it's response your are running into a deadlock since you are blocking for the call to come back but there is no thread to handle the response. Does this make sense?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/99356039","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-99356039","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":99356039,"node_id":"MDEyOklzc3VlQ29tbWVudDk5MzU2MDM5","user":{"login":"nilsga","id":42919,"node_id":"MDQ6VXNlcjQyOTE5","avatar_url":"https://avatars0.githubusercontent.com/u/42919?v=4","gravatar_id":"","url":"https://api.github.com/users/nilsga","html_url":"https://github.com/nilsga","followers_url":"https://api.github.com/users/nilsga/followers","following_url":"https://api.github.com/users/nilsga/following{/other_user}","gists_url":"https://api.github.com/users/nilsga/gists{/gist_id}","starred_url":"https://api.github.com/users/nilsga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nilsga/subscriptions","organizations_url":"https://api.github.com/users/nilsga/orgs","repos_url":"https://api.github.com/users/nilsga/repos","events_url":"https://api.github.com/users/nilsga/events{/privacy}","received_events_url":"https://api.github.com/users/nilsga/received_events","type":"User","site_admin":false},"created_at":"2015-05-06T07:38:10Z","updated_at":"2015-05-06T07:38:10Z","author_association":"NONE","body":"I can see that it is a \"typical\" deadlock scenario, but I still don't quite get why it only happens some times, and why it seems to block many other (seemingly) unrelated requests while there are many free transport threads available. Anyway, we refactored the problematic code, so it is no longer a problem for us, so if this is \"by design\", then you can go ahead and close the issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/108871374","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-108871374","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":108871374,"node_id":"MDEyOklzc3VlQ29tbWVudDEwODg3MTM3NA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-04T12:24:36Z","updated_at":"2015-06-04T12:24:36Z","author_association":"CONTRIBUTOR","body":"Closed by https://github.com/elastic/elasticsearch/pull/10940\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/236508693","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-236508693","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":236508693,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNjUwODY5Mw==","user":{"login":"makeyang","id":13898618,"node_id":"MDQ6VXNlcjEzODk4NjE4","avatar_url":"https://avatars2.githubusercontent.com/u/13898618?v=4","gravatar_id":"","url":"https://api.github.com/users/makeyang","html_url":"https://github.com/makeyang","followers_url":"https://api.github.com/users/makeyang/followers","following_url":"https://api.github.com/users/makeyang/following{/other_user}","gists_url":"https://api.github.com/users/makeyang/gists{/gist_id}","starred_url":"https://api.github.com/users/makeyang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/makeyang/subscriptions","organizations_url":"https://api.github.com/users/makeyang/orgs","repos_url":"https://api.github.com/users/makeyang/repos","events_url":"https://api.github.com/users/makeyang/events{/privacy}","received_events_url":"https://api.github.com/users/makeyang/received_events","type":"User","site_admin":false},"created_at":"2016-08-01T07:30:03Z","updated_at":"2016-08-01T07:30:03Z","author_association":"CONTRIBUTOR","body":"@clintongormley \nI have checked the code and it turns out the pull: https://github.com/elastic/elasticsearch/pull/10644/commits/91e2bb193ce0655ed4e80fede321abcba281caac\n hasn't merged into any code base below:\nhttps://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java\nhttps://github.com/elastic/elasticsearch/blob/v2.0.2/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java\nhttps://github.com/elastic/elasticsearch/blob/v2.1.2/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java\ndo I miss something or what?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/236888715","html_url":"https://github.com/elastic/elasticsearch/issues/10766#issuecomment-236888715","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10766","id":236888715,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNjg4ODcxNQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2016-08-02T12:26:56Z","updated_at":"2016-08-02T12:28:17Z","author_association":"MEMBER","body":"Not sure how you determined that this has not been merged. I can see this commit in some of the lines of the master branch and other branches links you listed above by doing looking at the blame view: https://github.com/elastic/elasticsearch/blame/master/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java#L272\nhttps://github.com/elastic/elasticsearch/blame/v2.0.2/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java#L238\nhttps://github.com/elastic/elasticsearch/blame/v2.1.2/core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java#L248\n\nMaybe it would solve your problem quicker if you explained clearly on the discuss forums what issue you are seeing which is leading you to believe this?\n","performed_via_github_app":null}]