[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384137607","html_url":"https://github.com/elastic/elasticsearch/issues/30065#issuecomment-384137607","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30065","id":384137607,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzNzYwNw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-02-14T14:24:16Z","updated_at":"2018-04-25T02:02:38Z","author_association":"COLLABORATOR","body":"*Original comment by @spinscale:*\n\nthe culprit is here\r\n\r\n```\r\n  1> [2018-02-10T23:23:24,306][DEBUG][o.e.x.w.t.ScheduleTriggerEngineMock] [node_s0] adding watch [_name]\r\n  1> [2018-02-10T23:23:24,310][INFO ][o.e.x.w.WatcherService   ] [node_s0] stopping watch service, reason [watcher manually marked to shutdown by cluster state update]\r\n```\r\n\r\nImmediately after adding the watch, something shuts down watcher with a cluster state update - and not just some cluster state update, but an explicit shutdown by marking it such in the cluster state. No idea yet where this is coming from. Running currently on a linux system and see if I can repro by running more often.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384137608","html_url":"https://github.com/elastic/elasticsearch/issues/30065#issuecomment-384137608","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30065","id":384137608,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzNzYwOA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-02-14T21:51:35Z","updated_at":"2018-04-25T02:02:39Z","author_association":"COLLABORATOR","body":"*Original comment by @spinscale:*\n\nI found another which resembles a similar error LINK REDACTED","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384137609","html_url":"https://github.com/elastic/elasticsearch/issues/30065#issuecomment-384137609","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30065","id":384137609,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzNzYwOQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-03-21T14:08:41Z","updated_at":"2018-04-25T02:02:39Z","author_association":"COLLABORATOR","body":"*Original comment by @droberts195:*\n\nLINK REDACTED is another occurrence of this.\r\n\r\nThe log also shows:\r\n\r\n```\r\n01:23:35   1> [2018-03-21T04:53:21,698][DEBUG][o.e.x.w.t.ScheduleTriggerEngineMock] [node_s0] adding watch [_name]\r\n01:23:35   1> [2018-03-21T04:53:21,699][INFO ][o.e.x.w.WatcherService   ] [node_s0] stopping watch service, reason [watcher manually marked to shutdown by cluster state update]\r\n01:23:35   1> [2018-03-21T04:53:21,699][DEBUG][o.e.x.w.e.ExecutionService] [node_s0] stopping execution service\r\n```\r\n\r\nThe failure exception is:\r\n\r\n```\r\n01:23:35 FAILURE 10.3s J1 | BasicWatcherTests.testIndexWatchRegisterWatchBeforeTargetIndex <<< FAILURES!\r\n01:23:35    > Throwable LINK REDACTED: java.lang.AssertionError: \r\n01:23:35    > Expected: a value equal to or greater than <1L>\r\n01:23:35    >      but: <0L> was less than <1L>\r\n01:23:35    > \tat __randomizedtesting.SeedInfo.seed([BE7A9155F0327441:257F64E71957E72F]:0)\r\n01:23:35    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n01:23:35    > \tat org.elasticsearch.xpack.watcher.test.AbstractWatcherIntegrationTestCase.lambda$assertWatchWithNoActionNeeded$1(AbstractWatcherIntegrationTestCase.java:410)\r\n01:23:35    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:734)\r\n01:23:35    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:708)\r\n01:23:35    > \tat org.elasticsearch.xpack.watcher.test.AbstractWatcherIntegrationTestCase.assertWatchWithNoActionNeeded(AbstractWatcherIntegrationTestCase.java:391)\r\n01:23:35    > \tat org.elasticsearch.xpack.watcher.test.integration.BasicWatcherTests.testIndexWatchRegisterWatchBeforeTargetIndex(BasicWatcherTests.java:114)\r\n01:23:35    > \tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nThis did not reproduce on my laptop using:\r\n\r\n```\r\n./gradlew :x-pack-elasticsearch:plugin:watcher:test   -Dtests.seed=BE7A9155F0327441   -Dtests.class=org.elasticsearch.xpack.watcher.test.integration.BasicWatcherTests   -Dtests.method=\"testIndexWatchRegisterWatchBeforeTargetIndex\"   -Dtests.security.manager=true   -Dtests.locale=zh   -Dtests.timezone=Iran\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414688978","html_url":"https://github.com/elastic/elasticsearch/issues/30065#issuecomment-414688978","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30065","id":414688978,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDY4ODk3OA==","user":{"login":"tomcallahan","id":15988488,"node_id":"MDQ6VXNlcjE1OTg4NDg4","avatar_url":"https://avatars1.githubusercontent.com/u/15988488?v=4","gravatar_id":"","url":"https://api.github.com/users/tomcallahan","html_url":"https://github.com/tomcallahan","followers_url":"https://api.github.com/users/tomcallahan/followers","following_url":"https://api.github.com/users/tomcallahan/following{/other_user}","gists_url":"https://api.github.com/users/tomcallahan/gists{/gist_id}","starred_url":"https://api.github.com/users/tomcallahan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tomcallahan/subscriptions","organizations_url":"https://api.github.com/users/tomcallahan/orgs","repos_url":"https://api.github.com/users/tomcallahan/repos","events_url":"https://api.github.com/users/tomcallahan/events{/privacy}","received_events_url":"https://api.github.com/users/tomcallahan/received_events","type":"User","site_admin":false},"created_at":"2018-08-21T14:14:03Z","updated_at":"2018-08-21T14:14:03Z","author_association":"CONTRIBUTOR","body":"This may have been addressed in the watcher refactoring, closing until we see it again","performed_via_github_app":null}]