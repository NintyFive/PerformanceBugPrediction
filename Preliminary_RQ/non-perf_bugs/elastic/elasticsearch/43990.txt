{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43990","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43990/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43990/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43990/events","html_url":"https://github.com/elastic/elasticsearch/issues/43990","id":464346739,"node_id":"MDU6SXNzdWU0NjQzNDY3Mzk=","number":43990,"title":"[docker] GC and fatal error logs saved in container - enhancement to doc or default to  stdout","user":{"login":"jguay","id":19236038,"node_id":"MDQ6VXNlcjE5MjM2MDM4","avatar_url":"https://avatars2.githubusercontent.com/u/19236038?v=4","gravatar_id":"","url":"https://api.github.com/users/jguay","html_url":"https://github.com/jguay","followers_url":"https://api.github.com/users/jguay/followers","following_url":"https://api.github.com/users/jguay/following{/other_user}","gists_url":"https://api.github.com/users/jguay/gists{/gist_id}","starred_url":"https://api.github.com/users/jguay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jguay/subscriptions","organizations_url":"https://api.github.com/users/jguay/orgs","repos_url":"https://api.github.com/users/jguay/repos","events_url":"https://api.github.com/users/jguay/events{/privacy}","received_events_url":"https://api.github.com/users/jguay/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"assignees":[{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false}],"milestone":null,"comments":15,"created_at":"2019-07-04T16:52:54Z","updated_at":"2020-11-11T21:55:39Z","closed_at":"2020-02-28T21:26:54Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`):\r\n7.2.0 (official docker images)\r\n**Description of the problem including expected versus actual behavior**:\r\nGC and fatal error logs in elasticsearch docker outputs inside the container by default /usr/share/elasticsearch/logs\r\nI can see the value to keep this separated from elasticsearch logs (including deprecation and access logs) so if this is by design, this \r\nenhancement issue would be to document the way to overwrite this behaviour with environment variable.\r\n\r\n**Steps to reproduce**:\r\n\r\nRun elasticsearch container, see gc logs in /usr/share/elasticsearch/logs folder as per Jvm options\r\n```\r\ndocker run -d --name es720 -e \"discovery.type=single-node\" docker.elastic.co/elasticsearch/elasticsearch:7.2.0\r\ndocker exec -it es720 /bin/bash\r\n[root@7485ae364541 elasticsearch]# ls logs\r\ngc.log  gc.log.00\r\n[root@7485ae364541 elasticsearch]# ps aux | more\r\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\r\nelastic+     1 42.3 12.6 3700084 1294116 ?     Ssl  16:13   0:31 /usr/share/elasticsearch/jdk/bin/java -Xms1g -Xmx1g -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -Des.networkaddress.cach\r\ne.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UTF-8 -Djna.nosys=true -XX:-OmitStackTraceInFastThrow -Dio.netty.noUnsafe=true -Dio.netty.noKeySetOptimization=true -Di\r\no.netty.recycler.maxCapacityPerThread=0 -Dlog4j.shutdownHookEnabled=false -Dlog4j2.disable.jmx=true -Djava.io.tmpdir=/tmp/elasticsearch-4624909543270639519 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=data -XX:ErrorFile=logs/hs_err_pi\r\nd%p.log -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m -Djava.locale.providers=COMPAT -Des.cgroups.hierarchy.override=/ -Dio.netty.allocator.type=unpooled -XX:MaxDirectMemorySize=536870912 -De\r\ns.path.home=/usr/share/elasticsearch -Des.path.conf=/usr/share/elasticsearch/config -Des.distribution.flavor=default -Des.distribution.type=docker -Des.bundled_jdk=true -cp /usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasti\r\ncsearch -Ediscovery.type=single-node\r\n```\r\n\r\n**How to use stdout**\r\n\r\nI did not find a way to nullify \"-Xlog:gc*,gc+age=\" via environment variable though I can overwrite -XX:ErrorFile=/dev/stdout in JVM_OPTIONS env variable.\r\nThe solution is therefore to overwrite jvm.options (volume at container or custom Dockerfile), for example taking out the lines which are not active from default this is how the file looks like in 7.2.0 (GC outputs to stdout by default for the JVM hence not specifying location should work)\r\n```\r\n-Xms1g\r\n-Xmx1g\r\n-XX:+UseConcMarkSweepGC\r\n-XX:CMSInitiatingOccupancyFraction=75\r\n-XX:+UseCMSInitiatingOccupancyOnly\r\n-Des.networkaddress.cache.ttl=60\r\n-Des.networkaddress.cache.negative.ttl=10\r\n-XX:+AlwaysPreTouch\r\n-Xss1m\r\n-Djava.awt.headless=true\r\n-Dfile.encoding=UTF-8\r\n-Djna.nosys=true\r\n-XX:-OmitStackTraceInFastThrow\r\n-Dio.netty.noUnsafe=true\r\n-Dio.netty.noKeySetOptimization=true\r\n-Dio.netty.recycler.maxCapacityPerThread=0\r\n-Dlog4j.shutdownHookEnabled=false\r\n-Dlog4j2.disable.jmx=true\r\n-Djava.io.tmpdir=${ES_TMPDIR}\r\n-XX:+HeapDumpOnOutOfMemoryError\r\n-XX:HeapDumpPath=data\r\n## -XX:ErrorFile=logs/hs_err_pid%p.log\r\n-XX:ErrorFile=/dev/stdout\r\n8:-XX:+PrintGCDetails\r\n8:-XX:+PrintGCDateStamps\r\n8:-XX:+PrintTenuringDistribution\r\n8:-XX:+PrintGCApplicationStoppedTime\r\n## 8:-Xloggc:logs/gc.log\r\n##Â 8:-XX:+UseGCLogFileRotation\r\n## 8:-XX:NumberOfGCLogFiles=32\r\n## 8:-XX:GCLogFileSize=64m\r\n## 9-:-Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m\r\n9-:-Djava.locale.providers=COMPAT\r\n```","closed_by":{"login":"pugnascotia","id":8696382,"node_id":"MDQ6VXNlcjg2OTYzODI=","avatar_url":"https://avatars1.githubusercontent.com/u/8696382?v=4","gravatar_id":"","url":"https://api.github.com/users/pugnascotia","html_url":"https://github.com/pugnascotia","followers_url":"https://api.github.com/users/pugnascotia/followers","following_url":"https://api.github.com/users/pugnascotia/following{/other_user}","gists_url":"https://api.github.com/users/pugnascotia/gists{/gist_id}","starred_url":"https://api.github.com/users/pugnascotia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pugnascotia/subscriptions","organizations_url":"https://api.github.com/users/pugnascotia/orgs","repos_url":"https://api.github.com/users/pugnascotia/repos","events_url":"https://api.github.com/users/pugnascotia/events{/privacy}","received_events_url":"https://api.github.com/users/pugnascotia/received_events","type":"User","site_admin":false},"performed_via_github_app":null}