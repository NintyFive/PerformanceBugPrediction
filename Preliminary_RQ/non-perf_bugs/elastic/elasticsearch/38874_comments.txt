[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463416593","html_url":"https://github.com/elastic/elasticsearch/issues/38874#issuecomment-463416593","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38874","id":463416593,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzQxNjU5Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-02-13T23:21:39Z","updated_at":"2019-02-13T23:21:39Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463417309","html_url":"https://github.com/elastic/elasticsearch/issues/38874#issuecomment-463417309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38874","id":463417309,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzQxNzMwOQ==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2019-02-13T23:24:07Z","updated_at":"2019-02-13T23:24:18Z","author_association":"CONTRIBUTOR","body":"```\r\nThread.sleep(300); // wait for cache time to change TODO: this needs to be solved better. To be discussed.\r\n```\r\n\r\nThe timing issue has a TODO, so it may be worth discussion instead of simply increasing the timeout?\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463825846","html_url":"https://github.com/elastic/elasticsearch/issues/38874#issuecomment-463825846","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38874","id":463825846,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzgyNTg0Ng==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2019-02-14T22:23:12Z","updated_at":"2019-02-14T22:23:12Z","author_association":"CONTRIBUTOR","body":"@matriv thought about this one, this diff should resolve the problem\r\n\r\n```diff\r\n--- a/server/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java\r\n+++ b/server/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java\r\n@@ -435,7 +435,7 @@ public class UpdateSettingsIT extends ESIntegTestCase {\r\n         assertThat(getSettingsResponse.getSetting(\"test\", \"index.final\"), nullValue());\r\n     }\r\n \r\n-    public void testEngineGCDeletesSetting() throws InterruptedException {\r\n+    public void testEngineGCDeletesSetting() throws Exception {\r\n         createIndex(\"test\");\r\n         client().prepareIndex(\"test\", \"type\", \"1\").setSource(\"f\", 1).get();\r\n         DeleteResponse response = client().prepareDelete(\"test\", \"type\", \"1\").get();\r\n@@ -445,12 +445,10 @@ public class UpdateSettingsIT extends ESIntegTestCase {\r\n         client().prepareIndex(\"test\", \"type\", \"1\").setSource(\"f\", 2).setIfSeqNo(seqNo).setIfPrimaryTerm(primaryTerm).get();\r\n         client().admin().indices().prepareUpdateSettings(\"test\").setSettings(Settings.builder().put(\"index.gc_deletes\", 0)).get();\r\n \r\n-        response = client().prepareDelete(\"test\", \"type\", \"1\").get();\r\n-        seqNo = response.getSeqNo();\r\n-        Thread.sleep(300); // wait for cache time to change TODO: this needs to be solved better. To be discussed.\r\n+        DeleteResponse secondDeleteResponse = client().prepareDelete(\"test\", \"type\", \"1\").get();\r\n         // delete is should not be in cache\r\n-        assertThrows(client().prepareIndex(\"test\", \"type\", \"1\").setSource(\"f\", 3).setIfSeqNo(seqNo).setIfPrimaryTerm(primaryTerm),\r\n-            VersionConflictEngineException.class);\r\n+        assertBusy(() -> assertThrows(client().prepareIndex(\"test\", \"type\", \"1\").setSource(\"f\", 3)\r\n+                .setIfSeqNo(secondDeleteResponse.getSeqNo()).setIfPrimaryTerm(primaryTerm), VersionConflictEngineException.class));\r\n \r\n     }\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/464012257","html_url":"https://github.com/elastic/elasticsearch/issues/38874#issuecomment-464012257","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38874","id":464012257,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NDAxMjI1Nw==","user":{"login":"matriv","id":5058131,"node_id":"MDQ6VXNlcjUwNTgxMzE=","avatar_url":"https://avatars1.githubusercontent.com/u/5058131?v=4","gravatar_id":"","url":"https://api.github.com/users/matriv","html_url":"https://github.com/matriv","followers_url":"https://api.github.com/users/matriv/followers","following_url":"https://api.github.com/users/matriv/following{/other_user}","gists_url":"https://api.github.com/users/matriv/gists{/gist_id}","starred_url":"https://api.github.com/users/matriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/matriv/subscriptions","organizations_url":"https://api.github.com/users/matriv/orgs","repos_url":"https://api.github.com/users/matriv/repos","events_url":"https://api.github.com/users/matriv/events{/privacy}","received_events_url":"https://api.github.com/users/matriv/received_events","type":"User","site_admin":false},"created_at":"2019-02-15T11:31:13Z","updated_at":"2019-02-15T11:31:13Z","author_association":"CONTRIBUTOR","body":"@talevy Thanks for that.\r\nWe had a discussion with @bleskes who helped me here (thank you!) and we came up with:  #38942 .","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/599992059","html_url":"https://github.com/elastic/elasticsearch/issues/38874#issuecomment-599992059","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38874","id":599992059,"node_id":"MDEyOklzc3VlQ29tbWVudDU5OTk5MjA1OQ==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2020-03-17T10:23:15Z","updated_at":"2020-03-17T10:23:51Z","author_association":"CONTRIBUTOR","body":"I am reopening this, because we are seeing failures in the 6.8 branch (all in Darwin) e.g.:\r\n\r\n- https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.8+multijob-darwin-compatibility/575/console / https://gradle-enterprise.elastic.co/s/cdbg6fnglpc4w\r\n- https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.8+multijob-darwin-compatibility/540/console / https://gradle-enterprise.elastic.co/s/ot3kawqxjjavw\r\n- https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.8+multijob-darwin-compatibility/457/console / https://gradle-enterprise.elastic.co/s/x2vqd2cwbixm2\r\n\r\nI think we need to backport https://github.com/elastic/elasticsearch/pull/38942 to 6.8.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/600708467","html_url":"https://github.com/elastic/elasticsearch/issues/38874#issuecomment-600708467","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38874","id":600708467,"node_id":"MDEyOklzc3VlQ29tbWVudDYwMDcwODQ2Nw==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2020-03-18T15:50:57Z","updated_at":"2020-03-18T15:50:57Z","author_association":"MEMBER","body":"Backported to 6.8 in https://github.com/elastic/elasticsearch/commit/3f3033b74c5c14f90b7d9468452e11110243e501","performed_via_github_app":null}]