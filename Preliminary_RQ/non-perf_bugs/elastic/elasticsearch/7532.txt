{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7532","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7532/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7532/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7532/events","html_url":"https://github.com/elastic/elasticsearch/issues/7532","id":41670539,"node_id":"MDU6SXNzdWU0MTY3MDUzOQ==","number":7532,"title":"Script parse fail","user":{"login":"letrungtrung","id":7106318,"node_id":"MDQ6VXNlcjcxMDYzMTg=","avatar_url":"https://avatars0.githubusercontent.com/u/7106318?v=4","gravatar_id":"","url":"https://api.github.com/users/letrungtrung","html_url":"https://github.com/letrungtrung","followers_url":"https://api.github.com/users/letrungtrung/followers","following_url":"https://api.github.com/users/letrungtrung/following{/other_user}","gists_url":"https://api.github.com/users/letrungtrung/gists{/gist_id}","starred_url":"https://api.github.com/users/letrungtrung/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/letrungtrung/subscriptions","organizations_url":"https://api.github.com/users/letrungtrung/orgs","repos_url":"https://api.github.com/users/letrungtrung/repos","events_url":"https://api.github.com/users/letrungtrung/events{/privacy}","received_events_url":"https://api.github.com/users/letrungtrung/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-09-02T02:25:47Z","updated_at":"2014-09-02T05:54:44Z","closed_at":"2014-09-02T05:54:44Z","author_association":"NONE","active_lock_reason":null,"body":"I always use \"functions\":[{\"filter\":{\"exists\":{\"field\":\"pd\"}},\"script_score\":{\"script\":\"(0.08 / ((3.16*pow(10,-11)) \\* abs(now - doc[bf].date.getMillis()) + 0.05)) + 1.0\",\"params\":{\"now\":1409495389420,\"bf\":\"pd\"}}}]}},\"fields\":\"id\"}]]  in all queries. But sometime, my ES parse fail. \nI using ES 1.2.x\n\n[2014-08-31 21:29:49,350][DEBUG][action.search.type       ] [conf2] [news][4], node[l_6mZUHVRp6Vke1izjz9OQ], [R], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@5e3ea4f7] lastShard [true]\norg.elasticsearch.transport.RemoteTransportException: [conf1][inet[/172.16.10.35:9300]][search/phase/dfs]\nCaused by: org.elasticsearch.search.SearchParseException: [news][4]: from[0],size[30]: Parse Failure [Failed to parse source [{\"from\":0,\"size\":30,\"query\":{\"function_score\":{\"query\":{\"wrapper\":{\"query\":\"eyB0ZW1wbGF0ZSA6IHsgcGFyYW1zIDogeyAidGVybSI6IFsiYsOpIiwiYsOqIiwiYuG6o24iLCJi4bqndSIsImLhu6VuZyIsImNoaeG6v24iLCJjaMOibiIsImNow7MiLCJnw6FpIiwiaGFpIiwibOG7mSIsIm1hbmciLCJuaOG6pXQiLCJwaOG7pSIsInNhbyIsInZp4buHdCIsIsSDbiIsIsSRxrDhu51uZyIsIlx1MDAxQnBtZGZiaGFhbnRldmEiLCJhbmgiLCJiYSIsImJpZWJlciIsImJpw6puIiwiYmnhu4d0IiwiYsOsbmgiLCJiw60iLCJiw7pwIiwiYsSDbmciLCJi4bqhaSIsImLhuqV0IiwiYuG7h25oIiwiYuG7jyIsImLhu5FjIiwiYuG7kWkiLCJi4buXbmciLCJi4bubaSIsImMiLCJjYW5hZGEiLCJjYXN0aW5nIiwiY2jDoG5nIiwic2luaCIsIm7hu68iLCJnw6FpIiwidmnhu4d0IiwiYsOpIiwiYuG6p3UiLCJjw7QiLCJ0deG7lWkiLCJsw6BtIiwibeG6t3QiLCJt4bu5IiwiaMOsbmgiLCJnaeG7m2kiLCJ0aOG6qW0iLCJ04buxIiwi4bqjbmgiXSB9LCBxdWVyeTogeyBmaWx0ZXJlZDogeyBmaWx0ZXIgOiB7IGJvb2w6IHsgbXVzdCA6IFt7IHJhbmdlIDogeyAicGQiIDogeyBndCA6ICJub3ctMjVoL2QiIH0gfSB9LCB7IHJhbmdlIDogeyAicGQiIDogeyBndCA6ICJub3ctMjRoIiB9IH0gfV0gfSB9LCBxdWVyeTogeyB0ZXJtcyA6IHsgInQiIDogWyJ7eyN0ZXJtfX0iLCJ7ey59fSIsInt7L3Rlcm19fSJdICwgICJtaW5pbXVtX3Nob3VsZF9tYXRjaCI6IDIgIH0gfSB9IH0gfSB9\"}},\"functions\":[{\"filter\":{\"exists\":{\"field\":\"pd\"}},\"script_score\":{\"script\":\"(0.08 / ((3.16*pow(10,-11)) \\* abs(now - doc[bf].date.getMillis()) + 0.05)) + 1.0\",\"params\":{\"now\":1409495389420,\"bf\":\"pd\"}}}]}},\"fields\":\"id\"}]]\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:649)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:511)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:483)\n        at org.elasticsearch.search.SearchService.executeDfsPhase(SearchService.java:186)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchDfsTransportHandler.messageReceived(SearchServiceTransportAction.java:667)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchDfsTransportHandler.messageReceived(SearchServiceTransportAction.java:656)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.run(MessageChannelHandler.java:270)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.index.query.QueryParsingException: [news] Failed to parse\n        at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:262)\n        at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:633)\n        ... 9 more\nCaused by: org.elasticsearch.common.jackson.core.JsonParseException: Illegal unquoted character ((CTRL-CHAR, code 27)): has to be escaped using backslash to be included in string value\n at [Source: UNKNOWN; line: 1, column: 334]\n        at org.elasticsearch.common.jackson.core.JsonParser._constructError(JsonParser.java:1524)\n        at org.elasticsearch.common.jackson.core.base.ParserMinimalBase._reportError(ParserMinimalBase.java:557)\n        at org.elasticsearch.common.jackson.core.base.ParserMinimalBase._throwUnquotedSpace(ParserMinimalBase.java:518)\n        at org.elasticsearch.common.jackson.core.json.UTF8StreamJsonParser._finishString2(UTF8StreamJsonParser.java:2219)\n        at org.elasticsearch.common.jackson.core.json.UTF8StreamJsonParser._finishString(UTF8StreamJsonParser.java:2149)\n        at org.elasticsearch.common.jackson.core.json.UTF8StreamJsonParser.getTextCharacters(UTF8StreamJsonParser.java:361)\n        at org.elasticsearch.common.xcontent.json.JsonXContentParser.bytes(JsonXContentParser.java:91)\n        at org.elasticsearch.common.xcontent.json.JsonXContentParser.objectBytes(JsonXContentParser.java:117)\n        at org.elasticsearch.index.query.TermsQueryParser.parse(TermsQueryParser.java:81)\n        at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n        at org.elasticsearch.index.query.FilteredQueryParser.parse(FilteredQueryParser.java:71)\n        at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n        at org.elasticsearch.index.query.TemplateQueryParser.parse(TemplateQueryParser.java:76)\n        at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n        at org.elasticsearch.index.query.WrapperQueryParser.parse(WrapperQueryParser.java:63)\n        at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n        at org.elasticsearch.index.query.functionscore.FunctionScoreQueryParser.parse(FunctionScoreQueryParser.java:100)\n        at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:227)\n        at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:334)\n        at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:260)\n        ... 11 more\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}