{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23696","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23696/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23696/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23696/events","html_url":"https://github.com/elastic/elasticsearch/issues/23696","id":216060188,"node_id":"MDU6SXNzdWUyMTYwNjAxODg=","number":23696,"title":"CI: SmokeTestReindexWithPainlessClientYamlTestSuiteIT reindex/10_script/Modify a document based on id failure","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2017-03-22T13:23:04Z","updated_at":"2018-02-14T13:21:26Z","closed_at":"2017-04-05T20:00:11Z","author_association":"MEMBER","active_lock_reason":null,"body":"This failed two times today so far:\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=fedora/738\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.2+multijob-unix-compatibility/os=fedora/125\r\n\r\nError looks like this in the logs:\r\n```\r\n1> [2017-03-22T08:11:56,595][INFO ][o.e.s.SmokeTestReindexWithPainlessClientYamlTestSuiteIT] [test {yaml=reindex/10_script/Modify a document based on id}]: after test\r\n  1> [2017-03-22T08:11:56,613][INFO ][o.e.s.SmokeTestReindexWithPainlessClientYamlTestSuiteIT] Stash dump on failure [{\r\n  1>   \"stash\" : {\r\n  1>     \"body\" : {\r\n  1>       \"took\" : 397,\r\n  1>       \"timed_out\" : false,\r\n  1>       \"total\" : 1,\r\n  1>       \"updated\" : 0,\r\n  1>       \"created\" : 1,\r\n  1>       \"deleted\" : 0,\r\n  1>       \"batches\" : 1,\r\n  1>       \"version_conflicts\" : 0,\r\n  1>       \"noops\" : 0,\r\n  1>       \"retries\" : {\r\n  1>         \"bulk\" : 0,\r\n  1>         \"search\" : 0\r\n  1>       },\r\n  1>       \"throttled_millis\" : 0,\r\n  1>       \"requests_per_second\" : -1.0,\r\n  1>       \"throttled_until_millis\" : 0,\r\n  1>       \"failures\" : [ ]\r\n  1>     }\r\n  1>   }\r\n  1> }]\r\nFAILURE 1.89s | SmokeTestReindexWithPainlessClientYamlTestSuiteIT.test {yaml=reindex/10_script/Modify a document based on id} <<< FAILURES!\r\n   > Throwable #1: java.lang.AssertionError: Failure at [reindex/10_script:63]: created didn't match the expected value:\r\n   >                        created: expected [2] but was [1]\r\n   > \tat __randomizedtesting.SeedInfo.seed([B20684A64E72811C:3A52BB7CE08EECE4]:0)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:374)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:354)\r\n   > \tat java.lang.Thread.run(Thread.java:745)\r\n   > Caused by: java.lang.AssertionError: created didn't match the expected value:\r\n   >                        created: expected [2] but was [1]\r\n   > \tat org.elasticsearch.test.rest.yaml.section.MatchAssertion.doAssert(MatchAssertion.java:92)\r\n   > \tat org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:76)\r\n   > \tat org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:370)\r\n   > \t... 38 more\r\n```\r\n\r\n\r\nUnfortunately the reproduction doesn't work so far locally, here it is anyway:\r\n```\r\ngradle :qa:smoke-test-reindex-with-painless:integTestRunner -Dtests.seed=7230AEED34CAE77D -Dtests.class=org.elasticsearch.smoketest.SmokeTestReindexWithPainlessClientYamlTestSuiteIT -Dtests.method=\"test {yaml=reindex/10_script/Modify a document based on id}\" -Dtests.security.manager=true -Dtests.locale=sv-SE -Dtests.timezone=Asia/Singapore\r\n```\r\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}