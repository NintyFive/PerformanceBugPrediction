[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/362190454","html_url":"https://github.com/elastic/elasticsearch/issues/26673#issuecomment-362190454","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26673","id":362190454,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjE5MDQ1NA==","user":{"login":"admlko","id":9267675,"node_id":"MDQ6VXNlcjkyNjc2NzU=","avatar_url":"https://avatars2.githubusercontent.com/u/9267675?v=4","gravatar_id":"","url":"https://api.github.com/users/admlko","html_url":"https://github.com/admlko","followers_url":"https://api.github.com/users/admlko/followers","following_url":"https://api.github.com/users/admlko/following{/other_user}","gists_url":"https://api.github.com/users/admlko/gists{/gist_id}","starred_url":"https://api.github.com/users/admlko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/admlko/subscriptions","organizations_url":"https://api.github.com/users/admlko/orgs","repos_url":"https://api.github.com/users/admlko/repos","events_url":"https://api.github.com/users/admlko/events{/privacy}","received_events_url":"https://api.github.com/users/admlko/received_events","type":"User","site_admin":false},"created_at":"2018-02-01T08:14:54Z","updated_at":"2018-02-01T08:14:54Z","author_association":"NONE","body":"I'm still getting this with 6.2.1:\r\n```\r\n[2018-02-01T10:09:09,146][INFO ][o.e.c.m.TemplateUpgradeService] [analyzer01] Starting template upgrade to version 6.1.2, 1 templates will be updated and 0 will be removed\r\n[2018-02-01T10:09:09,260][INFO ][o.e.c.m.TemplateUpgradeService] [analyzer01] Finished upgrading templates to version 6.1.2\r\n[2018-02-01T10:09:18,168][INFO ][o.e.c.m.TemplateUpgradeService] [analyzer01] Starting template upgrade to version 6.1.2, 1 templates will be updated and 0 will be removed\r\n[2018-02-01T10:09:18,277][INFO ][o.e.c.m.TemplateUpgradeService] [analyzer01] Finished upgrading templates to version 6.1.2\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463263542","html_url":"https://github.com/elastic/elasticsearch/issues/26673#issuecomment-463263542","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26673","id":463263542,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzI2MzU0Mg==","user":{"login":"estolfo","id":699369,"node_id":"MDQ6VXNlcjY5OTM2OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/699369?v=4","gravatar_id":"","url":"https://api.github.com/users/estolfo","html_url":"https://github.com/estolfo","followers_url":"https://api.github.com/users/estolfo/followers","following_url":"https://api.github.com/users/estolfo/following{/other_user}","gists_url":"https://api.github.com/users/estolfo/gists{/gist_id}","starred_url":"https://api.github.com/users/estolfo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/estolfo/subscriptions","organizations_url":"https://api.github.com/users/estolfo/orgs","repos_url":"https://api.github.com/users/estolfo/repos","events_url":"https://api.github.com/users/estolfo/events{/privacy}","received_events_url":"https://api.github.com/users/estolfo/received_events","type":"User","site_admin":false},"created_at":"2019-02-13T16:20:28Z","updated_at":"2019-02-13T16:21:16Z","author_association":"CONTRIBUTOR","body":"I am encountering this issue when running the [rest-api YAML tests](https://github.com/elastic/elasticsearch/tree/master/rest-api-spec/src/main/resources/rest-api-spec/test) with the Ruby client in Docker. \r\n\r\nThe behavior observed: The rest api tests were passing when I ran elasticsearch and the tests outside docker. But when I ran both elasticsearch and the tests in docker, ES stopped responding halfway through the tests. I thought maybe Docker/ES were running out of memory. [Here](https://clients-ci.elastic.co/job/elastic+elasticsearch-ruby+pull-request/28/ELASTICSEARCH_VERSION=6.5.0,RUBY_TEST_VERSION=2.6.1,TEST_SUITE=rest_api,label=linux/console) is an example of the error on Jenkins. I've put the error in [this gist](https://gist.github.com/estolfo/e9a2bd7daa1ddb40a74e60d910a5a9b0) as well, in case the Jenkins job is no longer available when this issue is investigated.\r\n\r\nAfter inspecting the `pending_tasks` queue and correlating the tasks with parts of the Elasticsearch codebase, I found that the `TemplateUpgradeService` was running in between each test when we were deleting all index templates. The code run between each test was: ` $client.indices.delete_template(name: '*')`\r\n\r\nIâ€™m guessing the cause of the issue is that the `TemplateUpgradeService` can get itself into a deadlock if called too often. The only way I was able to resolve this was to not call `delete_template `with `name: '*'` and instead delete specific templates in between tests.\r\n\r\nPlease let me know if there's any other information you need to investigate or if I can help reproduce the issue.","performed_via_github_app":null}]