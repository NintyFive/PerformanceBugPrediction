{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18182","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18182/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18182/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18182/events","html_url":"https://github.com/elastic/elasticsearch/issues/18182","id":153429857,"node_id":"MDU6SXNzdWUxNTM0Mjk4NTc=","number":18182,"title":"Exception on shutting down the embedded node when any of the services is closed before the node","user":{"login":"bikeholik","id":11091433,"node_id":"MDQ6VXNlcjExMDkxNDMz","avatar_url":"https://avatars3.githubusercontent.com/u/11091433?v=4","gravatar_id":"","url":"https://api.github.com/users/bikeholik","html_url":"https://github.com/bikeholik","followers_url":"https://api.github.com/users/bikeholik/followers","following_url":"https://api.github.com/users/bikeholik/following{/other_user}","gists_url":"https://api.github.com/users/bikeholik/gists{/gist_id}","starred_url":"https://api.github.com/users/bikeholik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bikeholik/subscriptions","organizations_url":"https://api.github.com/users/bikeholik/orgs","repos_url":"https://api.github.com/users/bikeholik/repos","events_url":"https://api.github.com/users/bikeholik/events{/privacy}","received_events_url":"https://api.github.com/users/bikeholik/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-05-06T11:10:48Z","updated_at":"2016-05-07T15:26:42Z","closed_at":"2016-05-07T15:26:41Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch version: 2.3.1\n\nBackground: I'm running an embedded elasticsearch node in a spring boot application and have a scheduled job using ClusterService. \n\nOn application shutdown when ClusterService is closed independently, before node is closed, then I get a following exception on closing a node:\n\n```\njava.lang.IllegalStateException: Can't move to started state when closed\n    at org.elasticsearch.common.component.Lifecycle.canMoveToStopped(Lifecycle.java:144)\n    at org.elasticsearch.common.component.AbstractLifecycleComponent.stop(AbstractLifecycleComponent.java:81)\n    at org.elasticsearch.node.Node.stop(Node.java:326)\n    at org.elasticsearch.node.Node.close(Node.java:351)\n    at com.example.NodeManager.destroy(NodeManager.java:87)\n    at org.springframework.beans.factory.support.DisposableBeanAdapter.destroy(DisposableBeanAdapter.java:262)\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroyBean(DefaultSingletonBeanRegistry.java:578)\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingleton(DefaultSingletonBeanRegistry.java:554)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingleton(DefaultListableBeanFactory.java:972)\n    at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.destroySingletons(DefaultSingletonBeanRegistry.java:523)\n    at org.springframework.beans.factory.support.DefaultListableBeanFactory.destroySingletons(DefaultListableBeanFactory.java:979)\n    at org.springframework.context.support.AbstractApplicationContext.destroyBeans(AbstractApplicationContext.java:1006)\n    at org.springframework.context.support.AbstractApplicationContext.doClose(AbstractApplicationContext.java:982)\n    at org.springframework.context.support.AbstractApplicationContext$1.run(AbstractApplicationContext.java:901)\n```\n1. Message seems to be wrong. It tries to move to STOPPED state.\n2. Shouldn't closed services be ignored when node closes?\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}