{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30370/events","html_url":"https://github.com/elastic/elasticsearch/issues/30370","id":320047323,"node_id":"MDU6SXNzdWUzMjAwNDczMjM=","number":30370,"title":"Feature request: set timeout for update_mapping + define the cluster_task priority in the REST API","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-05-03T19:21:01Z","updated_at":"2018-05-05T23:49:26Z","closed_at":"2018-05-04T12:56:33Z","author_association":"NONE","active_lock_reason":null,"body":"Hi\r\n\r\nWe're experiencing #30244 on our 6.2.3 cluster on an almost daily basis, which has some severe consequences on cluster maintenance, indices disk size and rollover to warm / cold nodes. We've noticed that the chance of timing out an update_mapping operation greatly increases when during some of our maintenance operations on a cluster (e.g. opening new indices and deleting old ones).\r\n\r\nBriefly, when opening a new index, tasks for initializing its primary shards are immediately pushed to the head of the cluster_tasks queue with priority 'urgent'. Meanwhile, live indexed data which requires an update_mapping operation is pushed to the middle of the queue with priority 'high'. As the initialization of the new primary shards can take some time, update_mapping tasks can stack up in the queue - eventually reaching the 30 seconds timeout. Even when not reaching 30 seconds, the fact that the update_mapping task is blocking causes our indexing operations to greatly slow down, creating some backlogs. Below you can see the high correlation between creating indices and update_mapping timeouts:\r\n![image](https://user-images.githubusercontent.com/7827282/39597917-999d0f34-4f1f-11e8-89f8-e0f28625a208.png)\r\n\r\nEventually, we'd propose the following:\r\n1. As the create index operations are specifically spread out through the day during low-activity of the system and not to immediately index to them, we'd like to prevent these operations from interfering with live indexing data by setting their priority to low.\r\n\r\n2. We'd like to be able to set a higher value than 30 seconds for update_mapping operations to reduce the chance of them timing out.\r\n\r\nThanks!","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}