{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15589","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15589/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15589/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15589/events","html_url":"https://github.com/elastic/elasticsearch/issues/15589","id":123429461,"node_id":"MDU6SXNzdWUxMjM0Mjk0NjE=","number":15589,"title":"BulkRequest estimated size in bytes does not include script param size","user":{"login":"rrphotosoft","id":4465221,"node_id":"MDQ6VXNlcjQ0NjUyMjE=","avatar_url":"https://avatars3.githubusercontent.com/u/4465221?v=4","gravatar_id":"","url":"https://api.github.com/users/rrphotosoft","html_url":"https://github.com/rrphotosoft","followers_url":"https://api.github.com/users/rrphotosoft/followers","following_url":"https://api.github.com/users/rrphotosoft/following{/other_user}","gists_url":"https://api.github.com/users/rrphotosoft/gists{/gist_id}","starred_url":"https://api.github.com/users/rrphotosoft/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rrphotosoft/subscriptions","organizations_url":"https://api.github.com/users/rrphotosoft/orgs","repos_url":"https://api.github.com/users/rrphotosoft/repos","events_url":"https://api.github.com/users/rrphotosoft/events{/privacy}","received_events_url":"https://api.github.com/users/rrphotosoft/received_events","type":"User","site_admin":false},"labels":[{"id":146829143,"node_id":"MDU6TGFiZWwxNDY4MjkxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Transport%20API","name":":Core/Infra/Transport API","color":"0e8a16","default":false,"description":"Transport client API"},{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-12-22T07:17:07Z","updated_at":"2018-03-14T11:14:31Z","closed_at":"2018-03-14T11:14:31Z","author_association":"NONE","active_lock_reason":null,"body":"HI,\nWhen executing an update as follows:\n\n```\n            final ArrayList<Integer> test_list = new ArrayList<Integer>();\n    Random r = new Random();\n    for(int i=0; i < 50000; i++){\n        test_list.add(r.nextInt(3000));\n    }\n    Collections.sort(test_list);\n            //ElasticClientHolder is a singleton that holds the transport client.\n    BulkRequestBuilder brb = new BulkRequestBuilder(ElaticClientHolder.getInstance());\n\n    UpdateRequest ureq = new UpdateRequest(\"test_index\", \"test_type\", \"test\");\n    ureq.script(\"update_test_script\", ScriptType.FILE,new HashMap<String,Object>(){{\n        put(\"test_list\",test_list);\n    }});\n    ureq.scriptedUpsert(true);\n            ureq.upsert(new HashMap<String,Object>());\n\n    brb.add(ureq);\n\n           System.out.println(brb.request().estimatedSizeInBytes());\n```\n\n=> this returns 34\n\nIf instead we simply add the  following:\n\n```\n          ureq.upsert(new HashMap<String,Object>(){{\n            put(\"test_list\",test_list);\n         }});\n\n        System.out.println(brb.request().estimatedSizeInBytes());\n```\n\n=> this returns something like 231511\n\nThe script params aren't being included in the size calculation, Is this intentional and if yes, how do we determine the size of the bulk request while using script_params.\n\nThanks, \nBux\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}