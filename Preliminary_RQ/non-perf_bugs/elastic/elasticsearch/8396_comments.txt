[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62323991","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-62323991","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":62323991,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMzIzOTkx","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-11-09T22:54:46Z","updated_at":"2014-11-09T22:54:46Z","author_association":"CONTRIBUTOR","body":"This looks to me like field data for the _parent field data is buggy and returns an invalid BytesRef that has an `offset+end` that is greater than the length of the wrapped array. I will look into it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62377284","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-62377284","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":62377284,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMzc3Mjg0","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-11-10T12:24:56Z","updated_at":"2014-11-10T12:24:56Z","author_association":"CONTRIBUTOR","body":"I wrote a basic test hoping it could reproduce the issue, but got no luck. Here it is in case someone would like to iterate on it:\n\n``` java\npublic class PCTests extends ElasticsearchIntegrationTest {\n\n    private static final int NUM_PARENTS = 50000;\n    private static final int NUM_CHILDREN = 500000;\n\n    public void addOrUpdate() {\n        final boolean parent = randomBoolean();\n        if (parent) {\n            final String parentId = Integer.toString(randomInt(NUM_PARENTS));\n            client().prepareIndex(\"test\", \"parent\", parentId).setSource(Collections.<String, Object>emptyMap()).get();\n        } else {\n            final int id = randomInt(NUM_CHILDREN);\n            final int parentId = MathUtils.mod(MurmurHash3.hash(id), NUM_PARENTS);\n            client().prepareIndex(\"test\", \"child\", Integer.toString(id)).setParent(Integer.toString(parentId)).setSource(\"i\", randomInt(1000)).get();\n        }\n    }\n\n    public void query() {\n        SearchResponse resp = client().prepareSearch(\"test\").setSize(1).setQuery(QueryBuilders.hasChildQuery(\"child\", QueryBuilders.rangeQuery(\"i\").to(randomInt(1000)))).get();\n        System.out.println(resp);\n    }\n\n    public void test() throws Exception {\n        createIndex(\"test\");\n        client().admin().indices().preparePutMapping(\"test\").setType(\"parent\").setSource(JsonXContent.contentBuilder().startObject().startObject(\"parent\").endObject().endObject()).get();\n        client().admin().indices().preparePutMapping(\"test\").setType(\"child\").setSource(JsonXContent.contentBuilder().startObject().startObject(\"child\")\n                .startObject(\"_parent\")\n                .field(\"type\", \"parent\")\n            .endObject().endObject().endObject()).get();\n        for (int i = 0; i <= NUM_PARENTS; ++i) {\n            client().prepareIndex(\"test\", \"parent\", Integer.toString(i)).setSource(Collections.<String, Object>emptyMap()).get();\n        }\n\n        final Thread[] indexingThreads = new Thread[3];\n        final AtomicInteger running = new AtomicInteger(indexingThreads.length);\n        for (int i = 0; i < indexingThreads.length; ++i) {\n            indexingThreads[i] = new Thread() {\n                public void run() {\n                    for (int i = 0; i < 5 * (NUM_CHILDREN + NUM_PARENTS); ++i) {\n                        addOrUpdate();\n                    }\n                    running.decrementAndGet();\n                }\n            };\n        }\n        for (Thread t : indexingThreads) {\n            t.start();\n        }\n        while (running.get() > 0) {\n            query();\n            Thread.sleep(200);\n        }\n    }\n\n}\n```\n\nCan you share more information about the setup that reproduces the issue:\n- how many parent/child relations are configured in the mappings, are there some types that are both parent and child?\n- how many parents and children in the index?\n- what does the query look like? Given the stack trace, I guess it uses the has_child query?\n- are there custom plugins installed?\n- is the issue still reproducible after restarting elasticsearch?\n- can you try to reproduce the failure with assertions enabled? (the `-ea` JVM option)\n\nIf sharing the index that triggers this behaviour is possible and the issue is easy to reproduce, that would be great.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62430561","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-62430561","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":62430561,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNDMwNTYx","user":{"login":"aleph-zero","id":452273,"node_id":"MDQ6VXNlcjQ1MjI3Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/452273?v=4","gravatar_id":"","url":"https://api.github.com/users/aleph-zero","html_url":"https://github.com/aleph-zero","followers_url":"https://api.github.com/users/aleph-zero/followers","following_url":"https://api.github.com/users/aleph-zero/following{/other_user}","gists_url":"https://api.github.com/users/aleph-zero/gists{/gist_id}","starred_url":"https://api.github.com/users/aleph-zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aleph-zero/subscriptions","organizations_url":"https://api.github.com/users/aleph-zero/orgs","repos_url":"https://api.github.com/users/aleph-zero/repos","events_url":"https://api.github.com/users/aleph-zero/events{/privacy}","received_events_url":"https://api.github.com/users/aleph-zero/received_events","type":"User","site_admin":false},"created_at":"2014-11-10T18:31:31Z","updated_at":"2014-11-10T18:31:31Z","author_association":"CONTRIBUTOR","body":"I'm working with the reporter to get working code to reproduce.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63082638","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-63082638","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":63082638,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDgyNjM4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T15:45:30Z","updated_at":"2014-11-14T15:45:30Z","author_association":"CONTRIBUTOR","body":"@aleph-zero any news on this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64116980","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-64116980","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":64116980,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTE2OTgw","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-11-23T12:55:12Z","updated_at":"2014-11-23T12:55:12Z","author_association":"CONTRIBUTOR","body":"@aleph-zero ping?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64119127","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-64119127","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":64119127,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTE5MTI3","user":{"login":"aleph-zero","id":452273,"node_id":"MDQ6VXNlcjQ1MjI3Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/452273?v=4","gravatar_id":"","url":"https://api.github.com/users/aleph-zero","html_url":"https://github.com/aleph-zero","followers_url":"https://api.github.com/users/aleph-zero/followers","following_url":"https://api.github.com/users/aleph-zero/following{/other_user}","gists_url":"https://api.github.com/users/aleph-zero/gists{/gist_id}","starred_url":"https://api.github.com/users/aleph-zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aleph-zero/subscriptions","organizations_url":"https://api.github.com/users/aleph-zero/orgs","repos_url":"https://api.github.com/users/aleph-zero/repos","events_url":"https://api.github.com/users/aleph-zero/events{/privacy}","received_events_url":"https://api.github.com/users/aleph-zero/received_events","type":"User","site_admin":false},"created_at":"2014-11-23T14:10:07Z","updated_at":"2014-11-23T14:10:07Z","author_association":"CONTRIBUTOR","body":"@clintongormley @s1monw I never got a working example from the reporter. I'll ping him back and see if I can at least get the general steps to reproduce.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65455344","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-65455344","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":65455344,"node_id":"MDEyOklzc3VlQ29tbWVudDY1NDU1MzQ0","user":{"login":"aleph-zero","id":452273,"node_id":"MDQ6VXNlcjQ1MjI3Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/452273?v=4","gravatar_id":"","url":"https://api.github.com/users/aleph-zero","html_url":"https://github.com/aleph-zero","followers_url":"https://api.github.com/users/aleph-zero/followers","following_url":"https://api.github.com/users/aleph-zero/following{/other_user}","gists_url":"https://api.github.com/users/aleph-zero/gists{/gist_id}","starred_url":"https://api.github.com/users/aleph-zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aleph-zero/subscriptions","organizations_url":"https://api.github.com/users/aleph-zero/orgs","repos_url":"https://api.github.com/users/aleph-zero/repos","events_url":"https://api.github.com/users/aleph-zero/events{/privacy}","received_events_url":"https://api.github.com/users/aleph-zero/received_events","type":"User","site_admin":false},"created_at":"2014-12-03T17:53:51Z","updated_at":"2014-12-03T17:53:51Z","author_association":"CONTRIBUTOR","body":"@clintongormley @s1monw Still trying to get a proof-of-concept working\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67520993","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-67520993","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":67520993,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NTIwOTkz","user":{"login":"eeeebbbbrrrr","id":5117238,"node_id":"MDQ6VXNlcjUxMTcyMzg=","avatar_url":"https://avatars3.githubusercontent.com/u/5117238?v=4","gravatar_id":"","url":"https://api.github.com/users/eeeebbbbrrrr","html_url":"https://github.com/eeeebbbbrrrr","followers_url":"https://api.github.com/users/eeeebbbbrrrr/followers","following_url":"https://api.github.com/users/eeeebbbbrrrr/following{/other_user}","gists_url":"https://api.github.com/users/eeeebbbbrrrr/gists{/gist_id}","starred_url":"https://api.github.com/users/eeeebbbbrrrr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eeeebbbbrrrr/subscriptions","organizations_url":"https://api.github.com/users/eeeebbbbrrrr/orgs","repos_url":"https://api.github.com/users/eeeebbbbrrrr/repos","events_url":"https://api.github.com/users/eeeebbbbrrrr/events{/privacy}","received_events_url":"https://api.github.com/users/eeeebbbbrrrr/received_events","type":"User","site_admin":false},"created_at":"2014-12-18T17:19:02Z","updated_at":"2014-12-18T17:19:02Z","author_association":"NONE","body":"Original reporter here...\n\n@jpountz if you can provide some instruction how to actually run your test above (I have the ES repo cloned locally) I can fix it for you.  It looks like you're on the right track.\n\nI've provided Chris Earle @ ES a set of shell scripts that recreates the problem (internal support number 6313) by poking at ES with libcurl.\n\nLooking at your code above, you want 1 thread doing updates and two (or more) threads querying (the reverse of what you have now), and you'll want to run the query threads for a few minutes before the exceptions start to appear.\n\nTo answer your questions from above:\n- two types in the index, only one is configured to be a child\n- The query is quite complex (https://gist.github.com/eeeebbbbrrrr/d0491882248160e9afeb)\n- We have custom plugins, but they don't need to be installed to re-create this\n- Restarting ES \"fixes\" things until the test is run again\n- With asserts enabled:  https://gist.github.com/eeeebbbbrrrr/708305a968acb13b32c3\n\nThe shell scripts I've provided to Chris Earle know how to create the exact index involved, with proper mappings, settings, and data.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67522943","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-67522943","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":67522943,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NTIyOTQz","user":{"login":"eeeebbbbrrrr","id":5117238,"node_id":"MDQ6VXNlcjUxMTcyMzg=","avatar_url":"https://avatars3.githubusercontent.com/u/5117238?v=4","gravatar_id":"","url":"https://api.github.com/users/eeeebbbbrrrr","html_url":"https://github.com/eeeebbbbrrrr","followers_url":"https://api.github.com/users/eeeebbbbrrrr/followers","following_url":"https://api.github.com/users/eeeebbbbrrrr/following{/other_user}","gists_url":"https://api.github.com/users/eeeebbbbrrrr/gists{/gist_id}","starred_url":"https://api.github.com/users/eeeebbbbrrrr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eeeebbbbrrrr/subscriptions","organizations_url":"https://api.github.com/users/eeeebbbbrrrr/orgs","repos_url":"https://api.github.com/users/eeeebbbbrrrr/repos","events_url":"https://api.github.com/users/eeeebbbbrrrr/events{/privacy}","received_events_url":"https://api.github.com/users/eeeebbbbrrrr/received_events","type":"User","site_admin":false},"created_at":"2014-12-18T17:31:28Z","updated_at":"2014-12-18T17:31:28Z","author_association":"NONE","body":"So I figured out how to run the test.  :)  Looks like this re-creates it:\n\n``` java\nimport com.carrotsearch.hppc.hash.MurmurHash3;\nimport org.elasticsearch.action.search.SearchResponse;\nimport org.elasticsearch.common.math.MathUtils;\nimport org.elasticsearch.common.xcontent.json.JsonXContent;\nimport org.elasticsearch.index.query.QueryBuilders;\nimport org.elasticsearch.test.ElasticsearchIntegrationTest;\nimport org.junit.Test;\n\nimport java.util.Collections;\nimport java.util.concurrent.atomic.AtomicInteger;\n\npublic class PCTests extends ElasticsearchIntegrationTest {\n\n    private static final int NUM_PARENTS = 50000;\n    private static final int NUM_CHILDREN = 500000;\n    private static final int MAX_QUERIES = 32768;\n\n    public void addOrUpdate() {\n        final boolean parent = randomBoolean();\n        if (parent) {\n            final String parentId = Integer.toString(randomInt(NUM_PARENTS));\n            client().prepareIndex(\"test\", \"parent\", parentId).setSource(Collections.<String, Object>emptyMap()).get();\n        } else {\n            final int id = randomInt(NUM_CHILDREN);\n            final int parentId = MathUtils.mod(MurmurHash3.hash(id), NUM_PARENTS);\n            client().prepareIndex(\"test\", \"child\", Integer.toString(id)).setParent(Integer.toString(parentId)).setSource(\"i\", randomInt(1000)).get();\n        }\n    }\n\n    public void query() {\n        SearchResponse resp = client().prepareSearch(\"test\").setSize(1).setQuery(QueryBuilders.hasChildQuery(\"child\", QueryBuilders.rangeQuery(\"i\").to(randomInt(1000)))).get();\n        System.out.println(resp);\n    }\n\n    @Test\n    public void test() throws Exception {\n        createIndex(\"test\");\n        client().admin().indices().preparePutMapping(\"test\").setType(\"parent\").setSource(JsonXContent.contentBuilder().startObject().startObject(\"parent\").endObject().endObject()).get();\n        client().admin().indices().preparePutMapping(\"test\").setType(\"child\").setSource(JsonXContent.contentBuilder().startObject().startObject(\"child\")\n                .startObject(\"_parent\")\n                .field(\"type\", \"parent\")\n                .endObject().endObject().endObject()).get();\n        for (int i = 0; i <= NUM_PARENTS; ++i) {\n            client().prepareIndex(\"test\", \"parent\", Integer.toString(i)).setSource(Collections.<String, Object>emptyMap()).get();\n        }\n\n        logger.info(\"Bootstrapping index...\");\n        // bootstrap index with some data\n        for (int i = 0; i <NUM_PARENTS; ++i) {\n            addOrUpdate();\n        }\n\n        final Thread[] indexingThreads = new Thread[3];\n        final AtomicInteger running = new AtomicInteger(indexingThreads.length);\n        for (int i = 0; i < indexingThreads.length; ++i) {\n            indexingThreads[i] = new Thread() {\n                public void run() {\n                    for (int i = 0; i < MAX_QUERIES; ++i) {\n                        query();\n                    }\n                    running.decrementAndGet();\n                }\n            };\n        }\n\n        logger.info(\"Starting test\");\n        for (Thread t : indexingThreads) {\n            t.start();\n        }\n        while (running.get() > 0) {\n            addOrUpdate();\n            Thread.sleep(200);\n        }\n    }\n\n}\n```\n\nI think IDEA's output window truncated the exception, but you can see that it's there:\n\n``` json\n{\n  \"took\" : 15,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 10,\n    \"successful\" : 9,\n    \"failed\" : 1,\n    \"failures\" : [ {\n      \"index\" : \"test\",\n      \"shard\" : 9,\n      \"status\" : 500,\n      \"reason\" : \"RemoteTransportException[[node_2][local[3]][indices:data/read/search[phase/query/id]]]; nested: QueryPhaseExecutionException[[test][9]: query[child_filter[child/parent](filtered(i:[* TO 204])->_type:child)],from[0],size[1]: Query Failed [Failed to execute main query]]; nested: RuntimeException[java.lang.AssertionError]; nested: AssertionError; \"\n    } ]\n  },\n  \"hits\" : {\n    \"total\" : 4254,\n    \"max_score\" : 1.0,\n    \"hits\" : [ {\n      \"_index\" : \"test\",\n      \"_type\" : \"parent\",\n      \"_id\" : \"9280\",\n      \"_score\" : 1.0,\n      \"_source\" : { }\n    } ]\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67533205","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-67533205","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":67533205,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NTMzMjA1","user":{"login":"eeeebbbbrrrr","id":5117238,"node_id":"MDQ6VXNlcjUxMTcyMzg=","avatar_url":"https://avatars3.githubusercontent.com/u/5117238?v=4","gravatar_id":"","url":"https://api.github.com/users/eeeebbbbrrrr","html_url":"https://github.com/eeeebbbbrrrr","followers_url":"https://api.github.com/users/eeeebbbbrrrr/followers","following_url":"https://api.github.com/users/eeeebbbbrrrr/following{/other_user}","gists_url":"https://api.github.com/users/eeeebbbbrrrr/gists{/gist_id}","starred_url":"https://api.github.com/users/eeeebbbbrrrr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eeeebbbbrrrr/subscriptions","organizations_url":"https://api.github.com/users/eeeebbbbrrrr/orgs","repos_url":"https://api.github.com/users/eeeebbbbrrrr/repos","events_url":"https://api.github.com/users/eeeebbbbrrrr/events{/privacy}","received_events_url":"https://api.github.com/users/eeeebbbbrrrr/received_events","type":"User","site_admin":false},"created_at":"2014-12-18T18:40:14Z","updated_at":"2014-12-18T18:40:14Z","author_association":"NONE","body":"Oh, it's worth mentioning that ES does _not_ hang.  My original report to @aleph-zero said it did, but further diagnosis on my end found that it was my code that was looping indefinitely when it encountered the side effects of this exception (scan+scroll not returning the expected # of results, for example).\n\nThe AIOOB is very real, however.  :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67842816","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-67842816","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":67842816,"node_id":"MDEyOklzc3VlQ29tbWVudDY3ODQyODE2","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-12-22T14:32:32Z","updated_at":"2014-12-22T14:32:40Z","author_association":"CONTRIBUTOR","body":"Thanks for making the bug reproducible, it helped a lot!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67853477","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-67853477","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":67853477,"node_id":"MDEyOklzc3VlQ29tbWVudDY3ODUzNDc3","user":{"login":"eeeebbbbrrrr","id":5117238,"node_id":"MDQ6VXNlcjUxMTcyMzg=","avatar_url":"https://avatars3.githubusercontent.com/u/5117238?v=4","gravatar_id":"","url":"https://api.github.com/users/eeeebbbbrrrr","html_url":"https://github.com/eeeebbbbrrrr","followers_url":"https://api.github.com/users/eeeebbbbrrrr/followers","following_url":"https://api.github.com/users/eeeebbbbrrrr/following{/other_user}","gists_url":"https://api.github.com/users/eeeebbbbrrrr/gists{/gist_id}","starred_url":"https://api.github.com/users/eeeebbbbrrrr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eeeebbbbrrrr/subscriptions","organizations_url":"https://api.github.com/users/eeeebbbbrrrr/orgs","repos_url":"https://api.github.com/users/eeeebbbbrrrr/repos","events_url":"https://api.github.com/users/eeeebbbbrrrr/events{/privacy}","received_events_url":"https://api.github.com/users/eeeebbbbrrrr/received_events","type":"User","site_admin":false},"created_at":"2014-12-22T16:01:03Z","updated_at":"2014-12-22T16:01:03Z","author_association":"NONE","body":"I built your fix/ branch and can confirm this indeed fixes up my standalone test cases.\n\nI'm glad you wrapped ParentChildIndexFieldData.java in a threaded test as it definitely missed the concurrency boat.  Makes me wonder how it ever worked?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67857050","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-67857050","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":67857050,"node_id":"MDEyOklzc3VlQ29tbWVudDY3ODU3MDUw","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-12-22T16:27:58Z","updated_at":"2014-12-22T16:27:58Z","author_association":"CONTRIBUTOR","body":"This is a bug that I introduced in elasticsearch 1.4 since we almost completely rewrote fielddata to be more in-line with Lucene (this removed a lot of useless wrapping when using doc values, and helped improve the performance of doc values when used from elasticsearch).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/67999864","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-67999864","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":67999864,"node_id":"MDEyOklzc3VlQ29tbWVudDY3OTk5ODY0","user":{"login":"eeeebbbbrrrr","id":5117238,"node_id":"MDQ6VXNlcjUxMTcyMzg=","avatar_url":"https://avatars3.githubusercontent.com/u/5117238?v=4","gravatar_id":"","url":"https://api.github.com/users/eeeebbbbrrrr","html_url":"https://github.com/eeeebbbbrrrr","followers_url":"https://api.github.com/users/eeeebbbbrrrr/followers","following_url":"https://api.github.com/users/eeeebbbbrrrr/following{/other_user}","gists_url":"https://api.github.com/users/eeeebbbbrrrr/gists{/gist_id}","starred_url":"https://api.github.com/users/eeeebbbbrrrr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eeeebbbbrrrr/subscriptions","organizations_url":"https://api.github.com/users/eeeebbbbrrrr/orgs","repos_url":"https://api.github.com/users/eeeebbbbrrrr/repos","events_url":"https://api.github.com/users/eeeebbbbrrrr/events{/privacy}","received_events_url":"https://api.github.com/users/eeeebbbbrrrr/received_events","type":"User","site_admin":false},"created_at":"2014-12-23T21:21:42Z","updated_at":"2014-12-23T21:21:42Z","author_association":"NONE","body":"That makes sense.  I didn't dig through the commit history but I was thinking that the concurrency responsibly had to be happening elsewhere at some point in the past.\n\nThanks for taking care of this so quickly.  Happy Holidays!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/68038648","html_url":"https://github.com/elastic/elasticsearch/issues/8396#issuecomment-68038648","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8396","id":68038648,"node_id":"MDEyOklzc3VlQ29tbWVudDY4MDM4NjQ4","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-12-24T09:11:21Z","updated_at":"2014-12-24T09:11:21Z","author_association":"CONTRIBUTOR","body":"You're welcome, happy holidays to you too!\n","performed_via_github_app":null}]