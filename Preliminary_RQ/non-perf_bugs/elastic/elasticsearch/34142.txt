{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34142","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34142/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34142/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34142/events","html_url":"https://github.com/elastic/elasticsearch/issues/34142","id":364889812,"node_id":"MDU6SXNzdWUzNjQ4ODk4MTI=","number":34142,"title":"minimum_should_match is not working for query_string query while searching on attachment field","user":{"login":"ropal","id":17475928,"node_id":"MDQ6VXNlcjE3NDc1OTI4","avatar_url":"https://avatars2.githubusercontent.com/u/17475928?v=4","gravatar_id":"","url":"https://api.github.com/users/ropal","html_url":"https://github.com/ropal","followers_url":"https://api.github.com/users/ropal/followers","following_url":"https://api.github.com/users/ropal/following{/other_user}","gists_url":"https://api.github.com/users/ropal/gists{/gist_id}","starred_url":"https://api.github.com/users/ropal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ropal/subscriptions","organizations_url":"https://api.github.com/users/ropal/orgs","repos_url":"https://api.github.com/users/ropal/repos","events_url":"https://api.github.com/users/ropal/events{/privacy}","received_events_url":"https://api.github.com/users/ropal/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2018-09-28T13:30:10Z","updated_at":"2018-11-30T15:11:09Z","closed_at":"2018-11-30T15:11:09Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.1.2\r\n\r\n**Plugins installed**: [ingest-attachemnt, analysis-phonetic]\r\n\r\n**JVM version** (`java -version`): 1.8.181\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Windows 2012R2\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nWhile using query_string query with multiple fields provided in  fields attribute, if one of the field is attachment content field, minimum_should_match is not giving expected behavior. For example, if the search text is \"foo bar\" and minimum_should_match as 100%, it returns documents with either foo or bar which is not expected. If I specify operator in the search text like \"foo OR bar\" with minimum_should_match as 100% it looks for both foo and bar in the document. \r\n\r\n**Steps to reproduce**:\r\n\r\nQuery used:\r\n `{ \r\n\"query\":{ \r\n  \"bool\":{ \r\n    \"must\":[ { \r\n       \"match\":{ \r\n\t  \"title\":\"English\" \r\n\t} \r\n      }, \r\n      { \"query_string\":\r\n\t{ \"fields\":[ \"address\", \"message\", \"attachment*.content\" ],\r\n\t  \"query\":\"foo bar\", \r\n          \"minimum_should_match\":\"100%\" \r\n\t} \r\n      } \r\n    ] \r\n  } \r\n } \r\n}`\r\n\r\nall the properties are mapped with custom analyzer shown below. \r\n\r\n`\"my_custom_analyzer\": {\r\n     \"type\":      \"custom\", \r\n     \"tokenizer\": \"standard\",          \r\n     \"filter\": [\r\n            \"lowercase\",\r\n            \"standard\"\r\n          ]\r\n    }`\r\n\r\nThis works as expected if I remove the field  \"attachment*.content\" from the list of fields. ","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}