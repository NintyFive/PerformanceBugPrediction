[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76461877","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-76461877","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":76461877,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDYxODc3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-02-27T20:01:47Z","updated_at":"2015-02-27T20:01:47Z","author_association":"CONTRIBUTOR","body":"I think this is similar to https://github.com/elasticsearch/elasticsearch/issues/7240\n\nRather than requiring the empty `{}`, we should just make `and` and `or` with an empty array just return match all.  Actually, this is probably a non-issue because of https://github.com/elasticsearch/elasticsearch/issues/8960\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76493685","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-76493685","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":76493685,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDkzNjg1","user":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"created_at":"2015-02-27T23:42:12Z","updated_at":"2015-02-27T23:42:12Z","author_association":"CONTRIBUTOR","body":"@clintongormley I have been thinking more about this in the mean time and I found better solution on my end to this problem. I am also not sure if I explained the issue well (or may be it is that ppl did not start using complex search templates yet? as I still see #8308 not fixed). So I think it is ok to close this ticket for now (may be we can get back to it later if needed).\n\nAs far as discussion about meaning of empty `{}` in specific cases goes I would personally prefer if it is reported as an error. It seems that this situation happens because various client tools (or Mustache templating) have its limits but this should not be taken as an excuse to make ES query grammar more relaxed. Quite contrary IMO. Just my 2 cents.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245705664","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245705664","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245705664,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTcwNTY2NA==","user":{"login":"marshall007","id":877936,"node_id":"MDQ6VXNlcjg3NzkzNg==","avatar_url":"https://avatars2.githubusercontent.com/u/877936?v=4","gravatar_id":"","url":"https://api.github.com/users/marshall007","html_url":"https://github.com/marshall007","followers_url":"https://api.github.com/users/marshall007/followers","following_url":"https://api.github.com/users/marshall007/following{/other_user}","gists_url":"https://api.github.com/users/marshall007/gists{/gist_id}","starred_url":"https://api.github.com/users/marshall007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marshall007/subscriptions","organizations_url":"https://api.github.com/users/marshall007/orgs","repos_url":"https://api.github.com/users/marshall007/repos","events_url":"https://api.github.com/users/marshall007/events{/privacy}","received_events_url":"https://api.github.com/users/marshall007/received_events","type":"User","site_admin":false},"created_at":"2016-09-08T19:05:48Z","updated_at":"2016-09-08T19:05:48Z","author_association":"NONE","body":"@clintongormley @lukas-vlcek I couldn't find any currently open issues still related to this problem, but it definitely exists. There's no straight-forward solution to the trailing comma problem that arises in situations like these:\n\n``` js\n{\n  \"aggs\": {\n    {{#aggregations}}\n    \"{{.}}\": {\n      \"terms\": {\n        \"field\": \"{{.}}.raw\"\n      },\n      \"aggs\": {\n        \"parent\": {\n          \"cardinality\": { \"field\": \"_parent\" }\n        }\n      }\n    },\n    {{/aggregations}}\n  },\n  \"query\": { /* ... */ }\n}\n```\n\n``` js\n{\n    \"id\": \"template_test\",\n    \"params\": {\n        \"aggregations\": [\"first_name\", \"last_name\"]\n    }\n}\n```\n\nI think one of two things needs to happen for this to be solved across the board:\n1. Have the JSON parser ignore trailing commas (at least in the context of rendering templates).\n2. Provide a mustache extension or some other special notation for \"first/last element of an array\" conditionals.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245713402","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245713402","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245713402,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTcxMzQwMg==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-09-08T19:32:28Z","updated_at":"2016-09-08T19:32:28Z","author_association":"CONTRIBUTOR","body":"I'm totally in favor of us being as standard as possible but, man, I'd love the json parser to ignore trailing commas! I'd like it but I don't know if it is the right thing for Elasticsearch. I like all kinds of silly stuff.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245857829","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245857829","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245857829,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTg1NzgyOQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T08:55:56Z","updated_at":"2016-09-09T08:55:56Z","author_association":"CONTRIBUTOR","body":"@marshall007 as of 2.4.0, there is now a `toJson` template helper which should do the right thing.  See https://www.elastic.co/guide/en/elasticsearch/reference/2.4/search-template.html#_converting_parameters_to_json\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245879879","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245879879","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245879879,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTg3OTg3OQ==","user":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T10:40:50Z","updated_at":"2016-09-09T10:40:50Z","author_association":"CONTRIBUTOR","body":"@clintongormley Clint, how does it handle case when the input \"clauses\" array is empty? Would it render empty \"must\" array in final JSON? I.e. `{\"query\":{\"bool\":{\"must\": []}}}`.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245880892","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245880892","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245880892,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTg4MDg5Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T10:46:44Z","updated_at":"2016-09-09T10:46:44Z","author_association":"CONTRIBUTOR","body":"@lukas-vlcek yes:\n\n```\nGET _render/template\n{\n  \"inline\": \"{\\\"query\\\": { \\\"bool\\\": { \\\"must\\\": [ {{#toJson}} clause {{/toJson}} ]}}}\",\n  \"params\": {\n    \"clauses\": []\n  }\n}\n```\n\nreturns:\n\n```\n{\n  \"template_output\": {\n    \"query\": {\n      \"bool\": {\n        \"must\": []\n      }\n    }\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245883519","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245883519","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245883519,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTg4MzUxOQ==","user":{"login":"lukas-vlcek","id":205174,"node_id":"MDQ6VXNlcjIwNTE3NA==","avatar_url":"https://avatars2.githubusercontent.com/u/205174?v=4","gravatar_id":"","url":"https://api.github.com/users/lukas-vlcek","html_url":"https://github.com/lukas-vlcek","followers_url":"https://api.github.com/users/lukas-vlcek/followers","following_url":"https://api.github.com/users/lukas-vlcek/following{/other_user}","gists_url":"https://api.github.com/users/lukas-vlcek/gists{/gist_id}","starred_url":"https://api.github.com/users/lukas-vlcek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukas-vlcek/subscriptions","organizations_url":"https://api.github.com/users/lukas-vlcek/orgs","repos_url":"https://api.github.com/users/lukas-vlcek/repos","events_url":"https://api.github.com/users/lukas-vlcek/events{/privacy}","received_events_url":"https://api.github.com/users/lukas-vlcek/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T11:01:18Z","updated_at":"2016-09-09T11:01:18Z","author_association":"CONTRIBUTOR","body":"@clintongormley ok, so the `{{#toJson}} my_id {/toJson}}` in `inline` value needs to match `my_id` found in `\"params\": { \"my_id\": [ ... ] }`.\n\nBTW, the doc contains typo: `{{toJson}}` should be `{{#toJson}}`, see the beginning of the paragraph.\n\nThanks.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245884514","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245884514","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245884514,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTg4NDUxNA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T11:07:18Z","updated_at":"2016-09-09T11:07:18Z","author_association":"CONTRIBUTOR","body":"thanks @lukas-vlcek - fixed\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245957077","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245957077","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245957077,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTk1NzA3Nw==","user":{"login":"marshall007","id":877936,"node_id":"MDQ6VXNlcjg3NzkzNg==","avatar_url":"https://avatars2.githubusercontent.com/u/877936?v=4","gravatar_id":"","url":"https://api.github.com/users/marshall007","html_url":"https://github.com/marshall007","followers_url":"https://api.github.com/users/marshall007/followers","following_url":"https://api.github.com/users/marshall007/following{/other_user}","gists_url":"https://api.github.com/users/marshall007/gists{/gist_id}","starred_url":"https://api.github.com/users/marshall007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marshall007/subscriptions","organizations_url":"https://api.github.com/users/marshall007/orgs","repos_url":"https://api.github.com/users/marshall007/repos","events_url":"https://api.github.com/users/marshall007/events{/privacy}","received_events_url":"https://api.github.com/users/marshall007/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T15:59:57Z","updated_at":"2016-09-09T15:59:57Z","author_association":"NONE","body":"@clintongormley are you suggesting that I move the full `aggs` clauses into the `params`? Sort of defeats the purpose of using search templates in the first place, doesn't it?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245967094","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245967094","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245967094,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTk2NzA5NA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T16:35:00Z","updated_at":"2016-09-09T16:35:00Z","author_association":"CONTRIBUTOR","body":"No I'm not - I'm suggesting that you use `toJson` to render your array, instead of using mustache loops.  the docs have an example\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245968532","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245968532","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245968532,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTk2ODUzMg==","user":{"login":"marshall007","id":877936,"node_id":"MDQ6VXNlcjg3NzkzNg==","avatar_url":"https://avatars2.githubusercontent.com/u/877936?v=4","gravatar_id":"","url":"https://api.github.com/users/marshall007","html_url":"https://github.com/marshall007","followers_url":"https://api.github.com/users/marshall007/followers","following_url":"https://api.github.com/users/marshall007/following{/other_user}","gists_url":"https://api.github.com/users/marshall007/gists{/gist_id}","starred_url":"https://api.github.com/users/marshall007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marshall007/subscriptions","organizations_url":"https://api.github.com/users/marshall007/orgs","repos_url":"https://api.github.com/users/marshall007/repos","events_url":"https://api.github.com/users/marshall007/events{/privacy}","received_events_url":"https://api.github.com/users/marshall007/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T16:40:19Z","updated_at":"2016-09-09T16:40:19Z","author_association":"NONE","body":"@clintongormley in my example, I'm building an object body. Do `aggs` support some sort of array notation that I'm unaware of?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245987106","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245987106","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245987106,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTk4NzEwNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T17:46:50Z","updated_at":"2016-09-09T17:46:50Z","author_association":"CONTRIBUTOR","body":"@marshall007 oh i see what you're doing now.  you're stuck with crappy mustache loops i'm afraid.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/245991199","html_url":"https://github.com/elastic/elasticsearch/issues/9711#issuecomment-245991199","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9711","id":245991199,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NTk5MTE5OQ==","user":{"login":"marshall007","id":877936,"node_id":"MDQ6VXNlcjg3NzkzNg==","avatar_url":"https://avatars2.githubusercontent.com/u/877936?v=4","gravatar_id":"","url":"https://api.github.com/users/marshall007","html_url":"https://github.com/marshall007","followers_url":"https://api.github.com/users/marshall007/followers","following_url":"https://api.github.com/users/marshall007/following{/other_user}","gists_url":"https://api.github.com/users/marshall007/gists{/gist_id}","starred_url":"https://api.github.com/users/marshall007/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marshall007/subscriptions","organizations_url":"https://api.github.com/users/marshall007/orgs","repos_url":"https://api.github.com/users/marshall007/repos","events_url":"https://api.github.com/users/marshall007/events{/privacy}","received_events_url":"https://api.github.com/users/marshall007/received_events","type":"User","site_admin":false},"created_at":"2016-09-09T18:01:07Z","updated_at":"2016-09-09T18:01:07Z","author_association":"NONE","body":"@clintongormley yea and there is literally no solution to removing the trailing comma from the last element in the loop without doing insane things in your `params`. It would be really trivial for you guys to hack it together on the backend by doing something like this on any array `field`s specified in `params`:\n\n``` js\nparams[field][0].$first = true\nparams[field][params[field].length - 1].$last = true\n```\n\nThen you could do this in the template:\n\n``` js\n{\n  {{#aggregations}}\n  \"{{.}}\": {\n    \"terms\": {\n      \"field\": \"{{.}}.raw\"\n    },\n    \"aggs\": {\n      \"parent\": {\n        \"cardinality\": { \"field\": \"_parent\" }\n      }\n    }\n  }{{^.$last}},{{/.$last}}\n  {{/aggregations}}\n}\n```\n","performed_via_github_app":null}]