[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63783132","html_url":"https://github.com/elastic/elasticsearch/issues/8560#issuecomment-63783132","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8560","id":63783132,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNzgzMTMy","user":{"login":"bittusarkar","id":860447,"node_id":"MDQ6VXNlcjg2MDQ0Nw==","avatar_url":"https://avatars0.githubusercontent.com/u/860447?v=4","gravatar_id":"","url":"https://api.github.com/users/bittusarkar","html_url":"https://github.com/bittusarkar","followers_url":"https://api.github.com/users/bittusarkar/followers","following_url":"https://api.github.com/users/bittusarkar/following{/other_user}","gists_url":"https://api.github.com/users/bittusarkar/gists{/gist_id}","starred_url":"https://api.github.com/users/bittusarkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bittusarkar/subscriptions","organizations_url":"https://api.github.com/users/bittusarkar/orgs","repos_url":"https://api.github.com/users/bittusarkar/repos","events_url":"https://api.github.com/users/bittusarkar/events{/privacy}","received_events_url":"https://api.github.com/users/bittusarkar/received_events","type":"User","site_admin":false},"created_at":"2014-11-20T09:42:34Z","updated_at":"2014-11-21T08:53:25Z","author_association":"NONE","body":"For further clarity, I'll mention the code structure of my custom aggregation below:\n\n```\npublic class CustomPlugin extends AbstractPlugin {\n    ...\n    public static void onModule(AggregationModule aggregationModule) {\n        aggregationModule.addAggregatorParser(CustomAggregationParser.class);\n    }\n    ...\n}\n\nclass InternalCustomAggregation extends InternalNumericMetricsAggregation.MultiValue implements CustomAggregation {\n    ...\n    public static final AggregationStreams.Stream STREAM = new AggregationStreams.Stream() {\n        @Override\n        public InternalCustomAggregation readResult(StreamInput in) throws IOException {\n            InternalCustomAggregation result = new InternalCustomAggregation();\n            result.readFrom(in);\n            return result;\n        }\n    };\n\n    public static void registerStreams() {\n        AggregationStreams.registerStream(STREAM, TYPE.stream());\n    }\n    ...\n}\n\ninterface CustomAggregation extends Aggregation {\n    ...\n}\n\nclass CustomAggregator extends NumericMetricsAggregator.MultiValue {\n    ...\n}\n\nclass CustomAggregationBuilder extends ValuesSourceMetricsAggregationBuilder<CustomAggregationBuilder> {\n    ...\n}\n\nclass CustomAggregationParser implements Aggregator.Parser {\n    ...\n}\n```\n\nI could not find a way to get the method `InternalPayloads.registerStreams()` called by ES for registering streams for my custom aggregation. Is there something that I am missing here? Let me know if you need more information.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64978231","html_url":"https://github.com/elastic/elasticsearch/issues/8560#issuecomment-64978231","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8560","id":64978231,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTc4MjMx","user":{"login":"bittusarkar","id":860447,"node_id":"MDQ6VXNlcjg2MDQ0Nw==","avatar_url":"https://avatars0.githubusercontent.com/u/860447?v=4","gravatar_id":"","url":"https://api.github.com/users/bittusarkar","html_url":"https://github.com/bittusarkar","followers_url":"https://api.github.com/users/bittusarkar/followers","following_url":"https://api.github.com/users/bittusarkar/following{/other_user}","gists_url":"https://api.github.com/users/bittusarkar/gists{/gist_id}","starred_url":"https://api.github.com/users/bittusarkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bittusarkar/subscriptions","organizations_url":"https://api.github.com/users/bittusarkar/orgs","repos_url":"https://api.github.com/users/bittusarkar/repos","events_url":"https://api.github.com/users/bittusarkar/events{/privacy}","received_events_url":"https://api.github.com/users/bittusarkar/received_events","type":"User","site_admin":false},"created_at":"2014-11-30T07:35:35Z","updated_at":"2014-11-30T07:35:35Z","author_association":"NONE","body":"I finally figured it out. The solution was rather very simple. I updated the `onModule()` method as below:\n\n```\npublic static void onModule(AggregationModule aggregationModule) {\n    aggregationModule.addAggregatorParser(CustomAggregationParser.class);\n    InternalCustomAggregation.registerStreams();\n}\n```\n\nI came to this solution by reading the `Elasticsearch Cardinality Plugin` code at https://github.com/algolia/elasticsearch-cardinality-plugin/tree/1.0.X (see branch `1.0.X` and not `master`)\n","performed_via_github_app":null}]