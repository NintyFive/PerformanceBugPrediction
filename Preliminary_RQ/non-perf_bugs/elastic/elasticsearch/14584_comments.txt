[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/154410663","html_url":"https://github.com/elastic/elasticsearch/issues/14584#issuecomment-154410663","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14584","id":154410663,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NDQxMDY2Mw==","user":{"login":"bangert","id":73190,"node_id":"MDQ6VXNlcjczMTkw","avatar_url":"https://avatars0.githubusercontent.com/u/73190?v=4","gravatar_id":"","url":"https://api.github.com/users/bangert","html_url":"https://github.com/bangert","followers_url":"https://api.github.com/users/bangert/followers","following_url":"https://api.github.com/users/bangert/following{/other_user}","gists_url":"https://api.github.com/users/bangert/gists{/gist_id}","starred_url":"https://api.github.com/users/bangert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bangert/subscriptions","organizations_url":"https://api.github.com/users/bangert/orgs","repos_url":"https://api.github.com/users/bangert/repos","events_url":"https://api.github.com/users/bangert/events{/privacy}","received_events_url":"https://api.github.com/users/bangert/received_events","type":"User","site_admin":false},"created_at":"2015-11-06T13:33:30Z","updated_at":"2015-11-06T13:33:30Z","author_association":"NONE","body":"hm, we were actually able to reproduce this.\nThis time, all remaining nodes showed the same NPE, while the new master node (Det RÃ¸de Lyn) actually showed it twice (approx. 10 seconds between the two)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/154413748","html_url":"https://github.com/elastic/elasticsearch/issues/14584#issuecomment-154413748","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14584","id":154413748,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NDQxMzc0OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-11-06T13:46:28Z","updated_at":"2015-11-06T14:56:53Z","author_association":"MEMBER","body":"This is happening because in between the master leaving the cluster and a new one getting assigned, the routing table won't get updated. As such, when the master leaves the cluster, the shards assigned to that node will not be reassigned. However, for any node that has detected the master as failed, it will update its local cluster state to no longer include the master in the list of nodes in the cluster. As such, the shards that were on the master will be in the cluster state but not associated with a node that is in the cluster state. When `sendNodeRequest` tries to look up the node to send the request to for such a shard there ends up being no such node. This leads to one NPE, which gets caught and cascades into a second NPE in the `onNodeFailure` handler. The correct course of action is to treat such shards as if it they are not available so that we never even attempt to send requests for them.\n\nThank you for the bug report. I'll be opening a pull request later to address this issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/154996222","html_url":"https://github.com/elastic/elasticsearch/issues/14584#issuecomment-154996222","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14584","id":154996222,"node_id":"MDEyOklzc3VlQ29tbWVudDE1NDk5NjIyMg==","user":{"login":"bangert","id":73190,"node_id":"MDQ6VXNlcjczMTkw","avatar_url":"https://avatars0.githubusercontent.com/u/73190?v=4","gravatar_id":"","url":"https://api.github.com/users/bangert","html_url":"https://github.com/bangert","followers_url":"https://api.github.com/users/bangert/followers","following_url":"https://api.github.com/users/bangert/following{/other_user}","gists_url":"https://api.github.com/users/bangert/gists{/gist_id}","starred_url":"https://api.github.com/users/bangert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bangert/subscriptions","organizations_url":"https://api.github.com/users/bangert/orgs","repos_url":"https://api.github.com/users/bangert/repos","events_url":"https://api.github.com/users/bangert/events{/privacy}","received_events_url":"https://api.github.com/users/bangert/received_events","type":"User","site_admin":false},"created_at":"2015-11-09T08:31:00Z","updated_at":"2015-11-09T08:31:00Z","author_association":"NONE","body":"Awesome work! Thanks.\n","performed_via_github_app":null}]