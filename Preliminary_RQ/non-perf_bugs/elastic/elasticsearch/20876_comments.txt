[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/253183587","html_url":"https://github.com/elastic/elasticsearch/issues/20876#issuecomment-253183587","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20876","id":253183587,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzE4MzU4Nw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-10-12T11:03:06Z","updated_at":"2016-10-12T11:03:06Z","author_association":"MEMBER","body":"this happens when same background process is still ongoing (or just failed to finish properly) and still holds the shard lock. An example of this is a recovery process which needs access to the shard folder to copy files. \n\nDo you have `index.shard.check_on_startup` set by any chance?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/253402314","html_url":"https://github.com/elastic/elasticsearch/issues/20876#issuecomment-253402314","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20876","id":253402314,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzQwMjMxNA==","user":{"login":"makeyang","id":13898618,"node_id":"MDQ6VXNlcjEzODk4NjE4","avatar_url":"https://avatars2.githubusercontent.com/u/13898618?v=4","gravatar_id":"","url":"https://api.github.com/users/makeyang","html_url":"https://github.com/makeyang","followers_url":"https://api.github.com/users/makeyang/followers","following_url":"https://api.github.com/users/makeyang/following{/other_user}","gists_url":"https://api.github.com/users/makeyang/gists{/gist_id}","starred_url":"https://api.github.com/users/makeyang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/makeyang/subscriptions","organizations_url":"https://api.github.com/users/makeyang/orgs","repos_url":"https://api.github.com/users/makeyang/repos","events_url":"https://api.github.com/users/makeyang/events{/privacy}","received_events_url":"https://api.github.com/users/makeyang/received_events","type":"User","site_admin":false},"created_at":"2016-10-13T03:13:30Z","updated_at":"2016-10-13T03:13:30Z","author_association":"CONTRIBUTOR","body":"@bleskes  no, we don't set that. should it better to set it?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/253427962","html_url":"https://github.com/elastic/elasticsearch/issues/20876#issuecomment-253427962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20876","id":253427962,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzQyNzk2Mg==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-10-13T06:44:05Z","updated_at":"2016-10-13T06:44:05Z","author_association":"MEMBER","body":"> @bleskes no, we don't set that. should it better to set it?\n\nOh no - this is one of those things that I know that can take long in the background. Since 2.1 is quite old - do you have the chance to upgrade to 2.4 and try to reproduce?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/253432320","html_url":"https://github.com/elastic/elasticsearch/issues/20876#issuecomment-253432320","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20876","id":253432320,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzQzMjMyMA==","user":{"login":"makeyang","id":13898618,"node_id":"MDQ6VXNlcjEzODk4NjE4","avatar_url":"https://avatars2.githubusercontent.com/u/13898618?v=4","gravatar_id":"","url":"https://api.github.com/users/makeyang","html_url":"https://github.com/makeyang","followers_url":"https://api.github.com/users/makeyang/followers","following_url":"https://api.github.com/users/makeyang/following{/other_user}","gists_url":"https://api.github.com/users/makeyang/gists{/gist_id}","starred_url":"https://api.github.com/users/makeyang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/makeyang/subscriptions","organizations_url":"https://api.github.com/users/makeyang/orgs","repos_url":"https://api.github.com/users/makeyang/repos","events_url":"https://api.github.com/users/makeyang/events{/privacy}","received_events_url":"https://api.github.com/users/makeyang/received_events","type":"User","site_admin":false},"created_at":"2016-10-13T07:09:21Z","updated_at":"2016-10-13T07:09:21Z","author_association":"CONTRIBUTOR","body":"I'll try to reproduce in 2.4 in test env.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254160424","html_url":"https://github.com/elastic/elasticsearch/issues/20876#issuecomment-254160424","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20876","id":254160424,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDE2MDQyNA==","user":{"login":"setaou","id":524358,"node_id":"MDQ6VXNlcjUyNDM1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/524358?v=4","gravatar_id":"","url":"https://api.github.com/users/setaou","html_url":"https://github.com/setaou","followers_url":"https://api.github.com/users/setaou/followers","following_url":"https://api.github.com/users/setaou/following{/other_user}","gists_url":"https://api.github.com/users/setaou/gists{/gist_id}","starred_url":"https://api.github.com/users/setaou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/setaou/subscriptions","organizations_url":"https://api.github.com/users/setaou/orgs","repos_url":"https://api.github.com/users/setaou/repos","events_url":"https://api.github.com/users/setaou/events{/privacy}","received_events_url":"https://api.github.com/users/setaou/received_events","type":"User","site_admin":false},"created_at":"2016-10-17T09:39:24Z","updated_at":"2016-10-17T09:39:24Z","author_association":"NONE","body":"We are experiencing the same problem with ES 2.4.1, java 8u101, Ubuntu 14.04.\n\nIt has happened two times, and each time was triggered by starting a full snapshot while one index was under heavy indexing load (3-4k docs/s). About 10 minutes after the beginning of the snapshot, some shards of this index begin to throw lots of LockObtainFailedException, and the situation finally gets back to normal about one hour later. Meanwhile, about 2-3k LockObtainFailedException have been thrown.\n\nI hope a solution will be found because currently our only option is to disable our daily snapshot while we are doing heavy indexations.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254650743","html_url":"https://github.com/elastic/elasticsearch/issues/20876#issuecomment-254650743","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20876","id":254650743,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDY1MDc0Mw==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2016-10-18T21:53:46Z","updated_at":"2016-10-18T21:53:46Z","author_association":"CONTRIBUTOR","body":"The likely reason why the `LockObtainFailedException` keeps occurring is if we have a scenario where the node holding the primary is under heavy load so is slow to respond and leaves the cluster, while a snapshot is taking place.  The snapshot holds a lock on the primary shard on the over-loaded node.  When the master node realizes that over-loaded node is not responding, it removes it from the cluster, promotes a replica copy of the shard to primary, and cancels the snapshot.  When the over-loaded node rejoins the cluster, the master node assigns it to hold a replica copy of the shard.  When the node attempts to initialize the shard and recover from the primary, it encounters a `LockObtainFailedException` because the canceled snapshot process still holds a lock on the shard.  The shard lock isn't released until the snapshot actually completes.  We are looking into an appropriate fix for this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/254695016","html_url":"https://github.com/elastic/elasticsearch/issues/20876#issuecomment-254695016","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20876","id":254695016,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NDY5NTAxNg==","user":{"login":"makeyang","id":13898618,"node_id":"MDQ6VXNlcjEzODk4NjE4","avatar_url":"https://avatars2.githubusercontent.com/u/13898618?v=4","gravatar_id":"","url":"https://api.github.com/users/makeyang","html_url":"https://github.com/makeyang","followers_url":"https://api.github.com/users/makeyang/followers","following_url":"https://api.github.com/users/makeyang/following{/other_user}","gists_url":"https://api.github.com/users/makeyang/gists{/gist_id}","starred_url":"https://api.github.com/users/makeyang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/makeyang/subscriptions","organizations_url":"https://api.github.com/users/makeyang/orgs","repos_url":"https://api.github.com/users/makeyang/repos","events_url":"https://api.github.com/users/makeyang/events{/privacy}","received_events_url":"https://api.github.com/users/makeyang/received_events","type":"User","site_admin":false},"created_at":"2016-10-19T02:38:44Z","updated_at":"2016-10-19T02:38:44Z","author_association":"CONTRIBUTOR","body":"@abeyad  thanks for u guys' hard work\n","performed_via_github_app":null}]