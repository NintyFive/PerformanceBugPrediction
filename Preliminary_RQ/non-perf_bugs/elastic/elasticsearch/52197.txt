{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52197","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52197/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52197/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52197/events","html_url":"https://github.com/elastic/elasticsearch/issues/52197","id":563179841,"node_id":"MDU6SXNzdWU1NjMxNzk4NDE=","number":52197,"title":"[CI] ExternalTestCluster ensureEstimatedStats errors","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"labels":[{"id":912834056,"node_id":"MDU6TGFiZWw5MTI4MzQwNTY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Monitoring","name":":Core/Features/Monitoring","color":"0e8a16","default":false,"description":""},{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1789304462,"node_id":"MDU6TGFiZWwxNzg5MzA0NDYy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.7.0","name":"v7.7.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-02-11T12:39:26Z","updated_at":"2020-02-14T18:40:49Z","closed_at":"2020-02-14T18:40:49Z","author_association":"MEMBER","active_lock_reason":null,"body":"The ironically named test `PreventFailingBuildIT.testSoThatTestsDoNotFail` has failed a number of times on 7.x with assertions errors in `ExternalTestCluster.ensureEstimatedStats`:.\r\n\r\n```\r\njava.lang.AssertionError: FixedBitSet cache size must be 0 on node: {integTest-0}{O4j40ofnS9SbW0kAauW13w}{OhAeH9E0TY-wR40Ea2GxrA}{127.0.0.1}{127.0.0.1:46333}{dim}{testattr=test, xpack.installed=true}\r\nExpected: <0L>\r\n     but: was <96L>\r\n\tat __randomizedtesting.SeedInfo.seed([30D5C8618BAB7026:9CAB15B4DF51DA0A]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.elasticsearch.test.ExternalTestCluster.ensureEstimatedStats(ExternalTestCluster.java:178)\r\n```\r\n\r\n```\r\njava.lang.AssertionError: Accounting breaker not reset to 0 on node: {integTest-0}{EOlEBokdTma0nmvNBUtjOw}{MlncAB9eQwGC5vViVFQgaA}{127.0.0.1}{127.0.0.1:45753}{dim}{testattr=test, xpack.installed=true}\r\nExpected: <0L>\r\n     but: was <4525L>\r\n\tat __randomizedtesting.SeedInfo.seed([E1B5690AD8D0B0EF:4DCBB4DF8C2A1AC3]:0)\r\n\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\r\n\tat org.junit.Assert.assertThat(Assert.java:956)\r\n\tat org.elasticsearch.test.ExternalTestCluster.ensureEstimatedStats(ExternalTestCluster.java:166)\r\n```\r\n\r\nThe test is completely [empty](https://github.com/elastic/elasticsearch/blob/c77b80f01e142ee7aff6440163c791729d50866a/x-pack/qa/smoke-test-monitoring-with-watcher/src/test/java/org/elasticsearch/smoketest/PreventFailingBuildIT.java#L12) which I imagine is the cause of the problem. \r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+multijob-unix-compatibility/os=ubuntu-18.04&&immutable/563/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+multijob-unix-compatibility/os=oraclelinux-6&&immutable/563/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+multijob-unix-compatibility/os=centos-6&&immutable/563/console\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+multijob-unix-compatibility/os=fedora-29&&immutable/563/console\r\n\r\nReproduces occasionally\r\n```\r\n./gradlew ':x-pack:qa:smoke-test-monitoring-with-watcher:integTestRunner' --tests \"org.elasticsearch.smoketest.PreventFailingBuildIT.testSoThatTestsDoNotFail\" \\\r\n  -Dtests.seed=38B89CB5D04F8F11 \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-LB \\\r\n  -Dtests.timezone=Africa/Djibouti \\\r\n  -Dcompiler.java=13\r\n```\r\n\r\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}