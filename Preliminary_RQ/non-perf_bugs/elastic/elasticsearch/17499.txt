{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17499","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17499/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17499/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17499/events","html_url":"https://github.com/elastic/elasticsearch/issues/17499","id":145594502,"node_id":"MDU6SXNzdWUxNDU1OTQ1MDI=","number":17499,"title":"Extended Stats Bucket Aggregation returns parse exception when sigma is an Integer","user":{"login":"russcam","id":208231,"node_id":"MDQ6VXNlcjIwODIzMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/208231?v=4","gravatar_id":"","url":"https://api.github.com/users/russcam","html_url":"https://github.com/russcam","followers_url":"https://api.github.com/users/russcam/followers","following_url":"https://api.github.com/users/russcam/following{/other_user}","gists_url":"https://api.github.com/users/russcam/gists{/gist_id}","starred_url":"https://api.github.com/users/russcam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russcam/subscriptions","organizations_url":"https://api.github.com/users/russcam/orgs","repos_url":"https://api.github.com/users/russcam/repos","events_url":"https://api.github.com/users/russcam/events{/privacy}","received_events_url":"https://api.github.com/users/russcam/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2016-04-04T06:20:19Z","updated_at":"2016-06-07T09:14:50Z","closed_at":"2016-06-07T09:14:49Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: \n\n2.3.0\n\n**JVM version**:\n\njava version \"1.8.0_77\"\nJava(TM) SE Runtime Environment (build 1.8.0_77-b03)\nJava HotSpot(TM) 64-Bit Server VM (build 25.77-b03, mixed mode)\n\n**OS version**: \n\nWindows 10\n\n**Description of the problem including expected versus actual behavior**:\n\n[The documentation for _Extended Stats Aggregation_ specifies that `sigma` can be any non-negative double](https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-metrics-extendedstats-aggregation.html#CO49-1). In the example in the docs, `3` is passed as the value for sigma.\n\n[_Extended Stats Bucket Aggregation_ also has a `sigma` parameter](https://www.elastic.co/guide/en/elasticsearch/reference/2.3/search-aggregations-pipeline-extended-stats-bucket-aggregation.html) but the documentation does not specify what type `sigma` is. I assumed it is also a `double` and [confirmed this with a (failing) integration test for NEST](https://github.com/elastic/elasticsearch-net/blob/2.x/src/Tests/Aggregations/Pipeline/ExtendedStatsBucket/ExtendedStatsBucketAggregationUsageTests.cs); **a parse exception** is returned when passing an `integer` (i.e. no decimal places) as the value for `sigma`. **I would expect an integer to be valid value as an input for a `double`**, based on the example provided for _Extended Stats Aggregation_.\n\n**Steps to reproduce**:\n1. Failing request (from NEST integration test). Notice the value of `2` for `sigma`\n\n``` javascript\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"projects_started_per_month\": {\n      \"date_histogram\": {\n        \"field\": \"startedOn\",\n        \"interval\": \"month\"\n      },\n      \"aggs\": {\n        \"commits\": {\n          \"sum\": {\n            \"field\": \"numberOfCommits\"\n          }\n        }\n      }\n    },\n    \"extended_stats_commits_per_month\": {\n      \"extended_stats_bucket\": {\n        \"buckets_path\": \"projects_started_per_month>commits\",\n        \"sigma\": 2\n      }\n    }\n  }\n}\n```\n\nreturns:\n\n``` javascript\n{\n  \"error\" : {\n    \"root_cause\" : [ {\n      \"type\" : \"parse_exception\",\n      \"reason\" : \"Parameter [sigma] must be a Double, type `Integer` provided instead\"\n    } ],\n    \"type\" : \"search_phase_execution_exception\",\n    \"reason\" : \"all shards failed\",\n    \"phase\" : \"query\",\n    \"grouped\" : true,\n    \"failed_shards\" : [ {\n      \"shard\" : 0,\n      \"index\" : \"project\",\n      \"node\" : \"afZfSF7hQoqmZQip5n3-LQ\",\n      \"reason\" : {\n        \"type\" : \"parse_exception\",\n        \"reason\" : \"Parameter [sigma] must be a Double, type `Integer` provided instead\"\n      }\n    } ]\n  },\n  \"status\" : 500\n}\n```\n1. Change the request from step 1, to change value of `sigma` from `2` to `2.0`:\n\n``` javascript\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"projects_started_per_month\": {\n      \"date_histogram\": {\n        \"field\": \"startedOn\",\n        \"interval\": \"month\"\n      },\n      \"aggs\": {\n        \"commits\": {\n          \"sum\": {\n            \"field\": \"numberOfCommits\"\n          }\n        }\n      }\n    },\n    \"extended_stats_commits_per_month\": {\n      \"extended_stats_bucket\": {\n        \"buckets_path\": \"projects_started_per_month>commits\",\n        \"sigma\": 2.0\n      }\n    }\n  }\n}\n```\n\nsuccessfully returns results:\n\n``` javascript\n{\n  \"took\" : 4,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 2,\n    \"successful\" : 2,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 100,\n    \"max_score\" : 0.0,\n    \"hits\" : [ ]\n  },\n  \"aggregations\" : {\n    \"projects_started_per_month\" : {\n      \"buckets\" : [ {\n        \"key_as_string\" : \"2015-04-01T00:00:00.000Z\",\n        \"key\" : 1427846400000,\n        \"doc_count\" : 2,\n        \"commits\" : {\n          \"value\" : 796.0\n        }\n      }, {\n        \"key_as_string\" : \"2015-05-01T00:00:00.000Z\",\n        \"key\" : 1430438400000,\n        \"doc_count\" : 12,\n        \"commits\" : {\n          \"value\" : 4982.0\n        }\n      }, {\n        \"key_as_string\" : \"2015-06-01T00:00:00.000Z\",\n        \"key\" : 1433116800000,\n        \"doc_count\" : 13,\n        \"commits\" : {\n          \"value\" : 5847.0\n        }\n      }, {\n        \"key_as_string\" : \"2015-07-01T00:00:00.000Z\",\n        \"key\" : 1435708800000,\n        \"doc_count\" : 7,\n        \"commits\" : {\n          \"value\" : 3693.0\n        }\n      }, {\n        \"key_as_string\" : \"2015-08-01T00:00:00.000Z\",\n        \"key\" : 1438387200000,\n        \"doc_count\" : 7,\n        \"commits\" : {\n          \"value\" : 3848.0\n        }\n      }, {\n        \"key_as_string\" : \"2015-09-01T00:00:00.000Z\",\n        \"key\" : 1441065600000,\n        \"doc_count\" : 8,\n        \"commits\" : {\n          \"value\" : 4421.0\n        }\n      }, {\n        \"key_as_string\" : \"2015-10-01T00:00:00.000Z\",\n        \"key\" : 1443657600000,\n        \"doc_count\" : 9,\n        \"commits\" : {\n          \"value\" : 5119.0\n        }\n      }, {\n        \"key_as_string\" : \"2015-11-01T00:00:00.000Z\",\n        \"key\" : 1446336000000,\n        \"doc_count\" : 1,\n        \"commits\" : {\n          \"value\" : 339.0\n        }\n      }, {\n        \"key_as_string\" : \"2015-12-01T00:00:00.000Z\",\n        \"key\" : 1448928000000,\n        \"doc_count\" : 12,\n        \"commits\" : {\n          \"value\" : 4218.0\n        }\n      }, {\n        \"key_as_string\" : \"2016-01-01T00:00:00.000Z\",\n        \"key\" : 1451606400000,\n        \"doc_count\" : 10,\n        \"commits\" : {\n          \"value\" : 4804.0\n        }\n      }, {\n        \"key_as_string\" : \"2016-02-01T00:00:00.000Z\",\n        \"key\" : 1454284800000,\n        \"doc_count\" : 7,\n        \"commits\" : {\n          \"value\" : 4316.0\n        }\n      }, {\n        \"key_as_string\" : \"2016-03-01T00:00:00.000Z\",\n        \"key\" : 1456790400000,\n        \"doc_count\" : 10,\n        \"commits\" : {\n          \"value\" : 5009.0\n        }\n      }, {\n        \"key_as_string\" : \"2016-04-01T00:00:00.000Z\",\n        \"key\" : 1459468800000,\n        \"doc_count\" : 2,\n        \"commits\" : {\n          \"value\" : 1664.0\n        }\n      } ]\n    },\n    \"extended_stats_commits_per_month\" : {\n      \"count\" : 13,\n      \"min\" : 339.0,\n      \"max\" : 5847.0,\n      \"avg\" : 3773.5384615384614,\n      \"sum\" : 49056.0,\n      \"sum_of_squares\" : 2.21307799E8,\n      \"variance\" : 2784084.325443786,\n      \"std_deviation\" : 1668.55755832509,\n      \"std_deviation_bounds\" : {\n        \"upper\" : 7110.653578188641,\n        \"lower\" : 436.42334488828146\n      }\n    }\n  }\n}\n```\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}