[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28886153","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-28886153","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":28886153,"node_id":"MDEyOklzc3VlQ29tbWVudDI4ODg2MTUz","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-11-20T12:44:36Z","updated_at":"2013-11-20T12:45:25Z","author_association":"MEMBER","body":"@npilon Just focusing in your last two queries. If the first query (has_child wrapped in bool query) returned 498 hits and then if you add your \"all\" filter to it should produce the same amount of hits. Assuming that the \"all\" filter really returns all document then this is strange. Are you able to reproduce this issue on a small scale? If so can you share it here, so we can further investigate?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28909702","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-28909702","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":28909702,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTA5NzAy","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-20T17:26:35Z","updated_at":"2013-11-20T17:26:35Z","author_association":"NONE","body":"> Assuming that the \"all\" filter really returns all document then this is strange\n\nDo you have reason to believe it doesn't, given my first two tests?\n\n> Are you able to reproduce this issue on a small scale? If so can you share it here, so we can further investigate?\n\nWorking on this now.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/28947667","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-28947667","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":28947667,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTQ3NjY3","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-21T00:33:21Z","updated_at":"2013-11-21T00:33:21Z","author_association":"NONE","body":"So, I've got an index containing only the documents from this query running on a single-node cluster.\n\nAdding the filter causes three returned results to drop off, but does not create the drastic swings in score or returned results observed in our production environment. (Where, I should add, we build a new index every six hours and swap)\n\nDo you have suggestions for other things I should add or incorporate to investigate this issue further? IE, should I try adding more nodes (we have three in our production environment), or more (unrelated) documents? What else should I do?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29005456","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29005456","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29005456,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDA1NDU2","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-21T17:39:38Z","updated_at":"2013-11-21T17:39:38Z","author_association":"NONE","body":"Some further information: we recently migrated from ElasticSearch 0.90.1 to 0.90.5. I don't believe this problem occurred in 0.90.1; if we decide to revert, I will provide information about the result.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29040143","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29040143","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29040143,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDQwMTQz","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-22T00:53:03Z","updated_at":"2013-11-22T00:53:03Z","author_association":"NONE","body":"While further testing will have to wait until I'm able to switch our web application over to the new cluster, I can confirm that, at first glance, this bug does not exist in ElasticSearch 0.90.2.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29093803","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29093803","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29093803,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDkzODAz","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-11-22T17:49:22Z","updated_at":"2013-11-22T17:49:22Z","author_association":"MEMBER","body":"Can you try to run the has_child query out of the filtered query and move it a layer up? Something like this?:\n\n``` json\n{\n    \"query\": {\n        \"bool\": {\n            \"must\": [\n               {\n                   \"has_child\": {\n                        \"type\": \"docket-entry\",\n                        \"query\": {\n                          \"query_string\": {\n                            \"default_operator\": \"AND\",\n                            \"query\": \"apple samsung\"\n                          }\n                        },\n                        \"score_type\": \"sum\"\n                    }\n               },\n               {\n                  \"filtered\": {\n                     \"filter\": {\n                         \"or\": [\n                              {\n                                \"range\": {\n                                  \"last_docket_id\": {\n                                    \"gte\": \"1\"\n                                  }\n                                }\n                              },\n                              {\n                                \"missing\": {\n                                  \"field\": \"last_docket_id\"\n                                }\n                              }\n                            ]\n                     }\n                  }\n               }\n            ]\n        }\n    }\n}\n```\n\nI'm wondering if the issue then still occurs.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29353585","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29353585","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29353585,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MzUzNTg1","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-27T01:36:33Z","updated_at":"2013-11-27T01:36:33Z","author_association":"NONE","body":"So, on a newly-rebuilt index:\n\nYour query: 497 results, 421.73798 max_score\n\nFiltered has_child query with noop filter: 149 results, 421.63016 max_score\n\nFiltered has_child query with no filter: 497 results, 421.63016 max_score\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29353834","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29353834","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29353834,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MzUzODM0","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-27T01:43:25Z","updated_at":"2013-11-27T01:43:31Z","author_association":"NONE","body":"As I noted in https://github.com/elasticsearch/elasticsearch/issues/4210#issuecomment-28947667 we rebuild our index every six hours. This has made diagnosing this problem extremely frustrating, as the results of \"has_child query with filter\" searches are very variable. They always return too few results, but the overall quality of the first page of results varies hugely. Further, sometimes the number of returned results varies between identical searches on the same index, which was how we first noticed the problem. For example, sometimes the \"filtered has_child query with noop filter\" on 0.90.5 returns only 146 results. Both your query and the \"filtered has_child query with no filter\" return stable total results.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29419484","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29419484","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29419484,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDE5NDg0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-11-27T20:56:21Z","updated_at":"2013-11-27T20:56:32Z","author_association":"MEMBER","body":"@npilon This really smells like a bug. I'm unsure what is causing this bug. You can confirm that `filtered has_child query with noop filter` produces expected results in ES version `0.90.2` (beyond the first glance)?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29419772","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29419772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29419772,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDE5Nzcy","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-27T21:01:19Z","updated_at":"2013-11-27T21:01:19Z","author_association":"NONE","body":"Yes, 0.90.2 produces expected results for all test cases in this issue. I haven't tested other versions beyond those two but can do so; are there any you'd be especially interested in seeing results for?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29421465","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29421465","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29421465,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDIxNDY1","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-11-27T21:26:32Z","updated_at":"2013-11-27T21:26:32Z","author_association":"MEMBER","body":"Can you try with version `0.90.3`? I suspect that #3190 maybe causing this issue.\nAlso when you're importing data, do you also execute delete or update requests?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29421845","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29421845","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29421845,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDIxODQ1","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-27T21:31:45Z","updated_at":"2013-11-27T21:31:45Z","author_association":"NONE","body":"Not on the index we're creating. Our process - which is, I'm aware, possibly pretty weird, is:\n1. Create a new index and use _bulk calls to populate it.\n2. Swap the live alias over and close the old index.\n3. Delete all but the most recent closed index.\n4. Execute live updates - again using _bulk - against the new live index.\n\nI don't believe we ever use delete to drop documents from an index. We're mostly a data warehousing-style application, and delete from our source database so rarely that we never bother to try to \"propagate\" the deletes to our ES cluster. The 0.90.5 cluster I'm testing against in https://github.com/elasticsearch/elasticsearch/issues/4210#issuecomment-29353585 has never had steps 2 through 4 used on it.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29422957","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29422957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29422957,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDIyOTU3","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-27T21:48:04Z","updated_at":"2013-11-27T21:48:04Z","author_association":"NONE","body":"I'll test against 0.90.3.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29430390","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29430390","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29430390,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDMwMzkw","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-11-28T00:01:55Z","updated_at":"2013-11-28T00:01:55Z","author_association":"NONE","body":"On 0.90.3, the filtered has_child query with noop filter returns either 206 or 211 results.\n\nThe filterless has_child query returns 499 and seems stable.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29464285","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29464285","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29464285,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDY0Mjg1","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-11-28T13:43:37Z","updated_at":"2013-11-28T13:43:37Z","author_association":"MEMBER","body":"Ok, that is good to know. Can you try setting `short_circuit_cutoff` to `0` on the `has_child` query, run the `filtered has_child query with noop filter` again and see if the issue still occurs on 0.90.5? Something like this:\n\n```\n\"has_child\": {\n    \"type\": \"docket-entry\",\n    \"short_circuit_cutoff\" : 0,\n    \"query\": {\n      \"query_string\": {\n        \"default_operator\": \"AND\",\n        \"query\": \"apple samsung\"\n      }\n    },\n    \"score_type\": \"sum\"\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29603513","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29603513","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29603513,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjAzNTEz","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-12-02T09:18:16Z","updated_at":"2013-12-02T09:18:16Z","author_association":"MEMBER","body":"@npilon I've added a fix via #4210 that fixes inconsistent results if the has_child query is used in the filtered query as a query.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29633900","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29633900","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29633900,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjMzOTAw","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-12-02T16:43:19Z","updated_at":"2013-12-02T16:43:19Z","author_association":"MEMBER","body":"@npilon The fix I mentioned in my previous comment has been included in the just released 1.0 beta2, if you can it would be great if you can verify if your issue has been resolved with the latest release.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29669687","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29669687","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29669687,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjY5Njg3","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-12-02T23:34:28Z","updated_at":"2013-12-02T23:34:28Z","author_association":"NONE","body":"I'm afraid 1.0 beta2 doesn't resolve the problem; in fact, it seems to make it worse. All results below are on 1.0 beta2 with a freshly-rebuilt index.\n\nThe \"filtered has_child query with no filter\" returns 408 results; with short circuit cutoff, I get 498.\n\nThe \"filtered has_child query with noop filter\" returns 59 results; with short circuit cutoff I get 499.\n\nAfter the cluster updates to include one replica, the results change as follows:\n\nThe \"filtered has_child query with no filter\" returns 418 or 422 results; with short circuit cutoff, I get 498.\n\nThe \"filtered has_child query with noop filter\" returns 59 results; with short circuit cutoff I get 499.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29694601","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29694601","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29694601,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Njk0NjAx","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-12-03T09:27:35Z","updated_at":"2013-12-03T09:27:35Z","author_association":"MEMBER","body":"Too bad that this didn't fixed the inconsistent results. Just to be sure, the correct results should be: 498? Also when you say \"with short circuit cutoff\", you have added `\"short_circuit_cutoff\" : 0` to the query?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/29731324","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-29731324","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":29731324,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzMxMzI0","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-12-03T17:27:35Z","updated_at":"2013-12-03T17:27:35Z","author_association":"NONE","body":"Yes.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/30891826","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-30891826","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":30891826,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODkxODI2","user":{"login":"npilon","id":382517,"node_id":"MDQ6VXNlcjM4MjUxNw==","avatar_url":"https://avatars3.githubusercontent.com/u/382517?v=4","gravatar_id":"","url":"https://api.github.com/users/npilon","html_url":"https://github.com/npilon","followers_url":"https://api.github.com/users/npilon/followers","following_url":"https://api.github.com/users/npilon/following{/other_user}","gists_url":"https://api.github.com/users/npilon/gists{/gist_id}","starred_url":"https://api.github.com/users/npilon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/npilon/subscriptions","organizations_url":"https://api.github.com/users/npilon/orgs","repos_url":"https://api.github.com/users/npilon/repos","events_url":"https://api.github.com/users/npilon/events{/privacy}","received_events_url":"https://api.github.com/users/npilon/received_events","type":"User","site_admin":false},"created_at":"2013-12-18T23:27:28Z","updated_at":"2013-12-18T23:27:28Z","author_association":"NONE","body":"I can confirm this has been fixed by 0.90.8. Thank you very much! :+1: \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/30896594","html_url":"https://github.com/elastic/elasticsearch/issues/4210#issuecomment-30896594","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4210","id":30896594,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODk2NTk0","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-12-19T00:53:38Z","updated_at":"2013-12-19T00:53:38Z","author_association":"MEMBER","body":"@npilon Thanks for providing the pointers that lead to finding this sneaky bug!\n","performed_via_github_app":null}]