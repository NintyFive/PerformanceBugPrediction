[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/336292288","html_url":"https://github.com/elastic/elasticsearch/issues/26989#issuecomment-336292288","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26989","id":336292288,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNjI5MjI4OA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-10-12T22:19:06Z","updated_at":"2017-10-12T22:19:06Z","author_association":"MEMBER","body":"heya @buinauskas aren't you using `my_analyzer_keyword` instead of `my_analyzer_shingle` for the field that you are querying. From the mappings that you posted, `my_analyzer_shingle` is unused. That would be why the query doesn't work as you expect. I would expect this same mapping with string instead or text not to work on 2.x either. I am closing this as I don't think this is a bug, but feel free to provide more info if I am missing something in which case I will certainly reopen this issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/336358690","html_url":"https://github.com/elastic/elasticsearch/issues/26989#issuecomment-336358690","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26989","id":336358690,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNjM1ODY5MA==","user":{"login":"buinauskas","id":7301441,"node_id":"MDQ6VXNlcjczMDE0NDE=","avatar_url":"https://avatars0.githubusercontent.com/u/7301441?v=4","gravatar_id":"","url":"https://api.github.com/users/buinauskas","html_url":"https://github.com/buinauskas","followers_url":"https://api.github.com/users/buinauskas/followers","following_url":"https://api.github.com/users/buinauskas/following{/other_user}","gists_url":"https://api.github.com/users/buinauskas/gists{/gist_id}","starred_url":"https://api.github.com/users/buinauskas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/buinauskas/subscriptions","organizations_url":"https://api.github.com/users/buinauskas/orgs","repos_url":"https://api.github.com/users/buinauskas/repos","events_url":"https://api.github.com/users/buinauskas/events{/privacy}","received_events_url":"https://api.github.com/users/buinauskas/received_events","type":"User","site_admin":false},"created_at":"2017-10-13T06:03:06Z","updated_at":"2017-10-13T06:03:06Z","author_association":"NONE","body":"@javanna of course, let me add some extra information! I've also tried to add `my_analyzer_shingle` as a `search_analyzer`.\r\n```\r\n{\r\n  \"settings\": {\r\n    \"analysis\": {\r\n      \"analyzer\": {\r\n        \"my_analyzer_keyword\": {\r\n          \"type\": \"custom\",\r\n          \"tokenizer\": \"keyword\",\r\n          \"filter\": [\r\n            \"asciifolding\",\r\n            \"lowercase\"\r\n          ]\r\n        },\r\n        \"my_analyzer_shingle\": {\r\n          \"type\": \"custom\",\r\n          \"tokenizer\": \"standard\",\r\n          \"filter\": [\r\n            \"asciifolding\",\r\n            \"lowercase\",\r\n            \"shingle\"\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"mappings\": {\r\n    \"your_type\": {\r\n      \"properties\": {\r\n        \"keyword\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"my_analyzer_keyword\",\r\n          \"search_analyzer\": \"my_analyzer_shingle\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nAnd then explicitly specified `my_analyzer_shingle` to be analyzer during search. Like that:\r\n```\r\nGET /test/your_type/_search\r\n{\r\n  \"query\": {\r\n    \"match\": {\r\n      \"keyword\": {\r\n        \"query\": \"I saw the news of lending club on facebook, your story and quora\",\r\n        \"analyzer\": \"my_analyzer_shingle\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nHowever search still does not return expected results.\r\n\r\nHow that's more clear now. Thank you!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/336383766","html_url":"https://github.com/elastic/elasticsearch/issues/26989#issuecomment-336383766","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26989","id":336383766,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNjM4Mzc2Ng==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-10-13T08:18:05Z","updated_at":"2017-10-13T08:18:05Z","author_association":"MEMBER","body":"@buinauskas although you apply shingles at query time, you still have a keyword field that you are querying, hence that will not match unless you search exactly for what you have in the field. I don't think this would work with 2.x either. You should take what you had working with 2.x, use text instead of string in the mappings and all the rest should stay the same. I would suggest to move this discussion to our [forum](https://discuss.elastic.co/) as we reserve github issues for feature requests and verified bugs.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/336385320","html_url":"https://github.com/elastic/elasticsearch/issues/26989#issuecomment-336385320","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26989","id":336385320,"node_id":"MDEyOklzc3VlQ29tbWVudDMzNjM4NTMyMA==","user":{"login":"buinauskas","id":7301441,"node_id":"MDQ6VXNlcjczMDE0NDE=","avatar_url":"https://avatars0.githubusercontent.com/u/7301441?v=4","gravatar_id":"","url":"https://api.github.com/users/buinauskas","html_url":"https://github.com/buinauskas","followers_url":"https://api.github.com/users/buinauskas/followers","following_url":"https://api.github.com/users/buinauskas/following{/other_user}","gists_url":"https://api.github.com/users/buinauskas/gists{/gist_id}","starred_url":"https://api.github.com/users/buinauskas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/buinauskas/subscriptions","organizations_url":"https://api.github.com/users/buinauskas/orgs","repos_url":"https://api.github.com/users/buinauskas/repos","events_url":"https://api.github.com/users/buinauskas/events{/privacy}","received_events_url":"https://api.github.com/users/buinauskas/received_events","type":"User","site_admin":false},"created_at":"2017-10-13T08:24:29Z","updated_at":"2017-10-13T08:24:29Z","author_association":"NONE","body":"I'll do as suggested @javanna Thank you!","performed_via_github_app":null}]