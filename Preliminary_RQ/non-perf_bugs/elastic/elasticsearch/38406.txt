{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38406","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38406/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38406/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38406/events","html_url":"https://github.com/elastic/elasticsearch/issues/38406","id":406723244,"node_id":"MDU6SXNzdWU0MDY3MjMyNDQ=","number":38406,"title":"Issue with EC2 Discovery Plugin - colon (:) doesn't work in discovery.ec2.tag setting","user":{"login":"DenisMartyanov","id":2631731,"node_id":"MDQ6VXNlcjI2MzE3MzE=","avatar_url":"https://avatars2.githubusercontent.com/u/2631731?v=4","gravatar_id":"","url":"https://api.github.com/users/DenisMartyanov","html_url":"https://github.com/DenisMartyanov","followers_url":"https://api.github.com/users/DenisMartyanov/followers","following_url":"https://api.github.com/users/DenisMartyanov/following{/other_user}","gists_url":"https://api.github.com/users/DenisMartyanov/gists{/gist_id}","starred_url":"https://api.github.com/users/DenisMartyanov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DenisMartyanov/subscriptions","organizations_url":"https://api.github.com/users/DenisMartyanov/orgs","repos_url":"https://api.github.com/users/DenisMartyanov/repos","events_url":"https://api.github.com/users/DenisMartyanov/events{/privacy}","received_events_url":"https://api.github.com/users/DenisMartyanov/received_events","type":"User","site_admin":false},"labels":[{"id":144457604,"node_id":"MDU6TGFiZWwxNDQ0NTc2MDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Settings","name":":Core/Infra/Settings","color":"0e8a16","default":false,"description":"Settings infrastructure and APIs"}],"state":"closed","locked":false,"assignee":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"assignees":[{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2019-02-05T10:45:31Z","updated_at":"2019-05-22T08:26:41Z","closed_at":"2019-05-22T08:26:41Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.5.4\r\n\r\n**Plugins installed**: [discovery-ec2]\r\n\r\n**JVM version** (`java -version`): 1.8.0_191\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nBased on documentation, I see that we can make use of discovery.ec2.tag. in the EC2 discovery plugin as a Prefix to filter down the EC2 instances to be included in the discovery process. I use OpsWorks and filter by opsworks:stack tag:\r\n\r\ndiscovery.ec2.tag.opsworks:stack: StackName\r\n\r\nBut while starting up Elastic Search instance after including the above tag in elasticsearch.yml file, it complains\r\n```\r\nStartupException: java.lang.IllegalArgumentException: unknown setting [discovery.ec2.tag.opsworks:stack] please check that any required plugins are installed, or check the breaking changes documentation for removed settings. \r\n```\r\nI tried to enclose in quotes (both single ' and double \"), but nothing changes. If I try to use any tag without colon (:), everything works correctly.\r\nIt worked without issues in 5.6.4, but doesn't work in both 6.6.0 and 6.5.4\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Install ec2-discovery plugin\r\n 2. Add discovery.ec2.tag.opsworks:stack: StackName line in elasticsearch.yml file\r\n 3. Restart the Elastic Search instance. As soon as you start, you will see the following error pasted in logs section\r\n\r\n**Provide logs (if relevant)**:\r\n```\r\n[o.e.b.ElasticsearchUncaughtExceptionHandler] [IntappOpenNode1] uncaught exception in thread [main]\r\norg.elasticsearch.bootstrap.StartupException: java.lang.IllegalArgumentException: unknown setting [discovery.ec2.tag.opsworks:stack] please check that any required plugins are installed, or check the breaking changes documentation for removed settings\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:140) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:127) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[elasticsearch-cli-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:86) ~[elasticsearch-6.5.4.jar:6.5.4]\r\nCaused by: java.lang.IllegalArgumentException: unknown setting [discovery.ec2.tag.opsworks:stack] please check that any required plugins are installed, or check the breaking changes documentation for removed settings\r\n        at org.elasticsearch.common.settings.AbstractScopedSettings.validate(AbstractScopedSettings.java:476) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.common.settings.AbstractScopedSettings.validate(AbstractScopedSettings.java:421) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.common.settings.AbstractScopedSettings.validate(AbstractScopedSettings.java:392) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.common.settings.AbstractScopedSettings.validate(AbstractScopedSettings.java:363) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.common.settings.SettingsModule.<init>(SettingsModule.java:148) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:373) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.node.Node.<init>(Node.java:265) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:212) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:212) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:333) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:136) ~[elasticsearch-6.5.4.jar:6.5.4]\r\n        ... 6 more\r\n```","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}