{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30893","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30893/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30893/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30893/events","html_url":"https://github.com/elastic/elasticsearch/issues/30893","id":326811589,"node_id":"MDU6SXNzdWUzMjY4MTE1ODk=","number":30893,"title":"Changing cross cluster search settings using REST API","user":{"login":"redlus","id":7827282,"node_id":"MDQ6VXNlcjc4MjcyODI=","avatar_url":"https://avatars3.githubusercontent.com/u/7827282?v=4","gravatar_id":"","url":"https://api.github.com/users/redlus","html_url":"https://github.com/redlus","followers_url":"https://api.github.com/users/redlus/followers","following_url":"https://api.github.com/users/redlus/following{/other_user}","gists_url":"https://api.github.com/users/redlus/gists{/gist_id}","starred_url":"https://api.github.com/users/redlus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redlus/subscriptions","organizations_url":"https://api.github.com/users/redlus/orgs","repos_url":"https://api.github.com/users/redlus/repos","events_url":"https://api.github.com/users/redlus/events{/privacy}","received_events_url":"https://api.github.com/users/redlus/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-05-27T12:13:30Z","updated_at":"2018-05-27T22:07:41Z","closed_at":"2018-05-27T13:40:59Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\n\r\n**Elasticsearch version**\r\n6.2.3\r\n\r\n**Plugins installed**\r\ningest-attachment\r\ningest-geoip\r\nmapper-murmur3\r\nmapper-size\r\nrepository-azure\r\nrepository-gcs\r\nrepository-s3\r\n\r\n**JVM version**\r\nopenjdk version \"1.8.0_151\"\r\nOpenJDK Runtime Environment (build 1.8.0_151-8u151-b12-0ubuntu0.16.04.2-b12)\r\nOpenJDK 64-Bit Server VM (build 25.151-b12, mixed mode)\r\n**OS version** (`uname -a` if on a Unix-like system):\r\n\r\n**Description of the problem including expected versus actual behavior**\r\nWe're using the cross-cluster search to make searches across several clusters. The settings are pushed using PUT to _cluster/settings on the live clusters. When acknowledged, the remote clusters get the [default settings](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-cross-cluster-search.html#cross-cluster-search-settings) as views in _remote/info.\r\n\r\nTrying to change these settings through the same API raises errors; for example, calling:\r\n`{\r\n    \"persistent\": {\r\n        \"search\": {\r\n            \"remote\": {\r\n                \"tier-2\": {\r\n                    \"seeds\": \"192.168.0.47:9300\",\r\n                    \"initial_connect_timeout\": \"60s\"\r\n                },\r\n                \"tier-1\": {\r\n                    \"seeds\": \"192.168.0.45:9300\",\r\n                    \"initial_connect_timeout\": \"60s\"\r\n                }\r\n            }\r\n        }\r\n    }\r\n}`\r\n\r\nreturns this:\r\n`{\r\n    \"error\": {\r\n        \"root_cause\": [\r\n            {\r\n                \"type\": \"remote_transport_exception\",\r\n                \"reason\": \"[elasticmaster1][192.168.0.42:9300][cluster:admin/settings/update]\"\r\n            }\r\n        ],\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"persistent setting [search.remote.tier-1.initial_connect_timeout], not recognized\"\r\n    },\r\n    \"status\": 400\r\n}`\r\n\r\nIf these settings should be changed only in elasticsearch.yml, it should be stated so in the documentation. However, given that new remote clusters can be set on the fly, I see not reason to support different settings only though one option and not the other.\r\n\r\n**Steps to reproduce**\r\n 1. Create two clusters (can be one node each).\r\n 2. Introduce two aliases to one of the cluster, one alias is its own, the other is for searching the other cluster. Add one of the settings (aside from 'seed') to the PUT call.\r\n 3. Eat your popcorn and enjoy the error message.\r\n\r\n**Provide logs (if relevant)**\r\nThe master node presents the following log message:\r\n\r\n> [2018-05-27T12:11:37,841][DEBUG][o.e.a.a.c.s.TransportClusterUpdateSettingsAction] [elasticmaster1] failed to perform [cluster_update_settings]\r\njava.lang.IllegalArgumentException: persistent setting [search.remote.tier-1.initial_connect_timeout], not recognized\r\n\tat org.elasticsearch.common.settings.AbstractScopedSettings.updateSettings(AbstractScopedSettings.java:574) ~[elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.common.settings.AbstractScopedSettings.updateDynamicSettings(AbstractScopedSettings.java:520) ~[elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.action.admin.cluster.settings.SettingsUpdater.updateSettings(SettingsUpdater.java:60) ~[elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.action.admin.cluster.settings.TransportClusterUpdateSettingsAction$1.execute(TransportClusterUpdateSettingsAction.java:183) ~[elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.cluster.ClusterStateUpdateTask.execute(ClusterStateUpdateTask.java:45) ~[elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.cluster.service.MasterService.executeTasks(MasterService.java:643) ~[elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.cluster.service.MasterService.calculateTaskOutputs(MasterService.java:273) ~[elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.cluster.service.MasterService.runTasks(MasterService.java:198) [elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.cluster.service.MasterService$Batcher.run(MasterService.java:133) [elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.cluster.service.TaskBatcher.runIfNotProcessed(TaskBatcher.java:150) [elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.cluster.service.TaskBatcher$BatchedTask.run(TaskBatcher.java:188) [elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:566) [elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:244) [elasticsearch-6.2.0.jar:6.2.0]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:207) [elasticsearch-6.2.0.jar:6.2.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_151]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_151]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}