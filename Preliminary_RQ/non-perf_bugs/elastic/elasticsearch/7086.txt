{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7086","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7086/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7086/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7086/events","html_url":"https://github.com/elastic/elasticsearch/issues/7086","id":39065007,"node_id":"MDU6SXNzdWUzOTA2NTAwNw==","number":7086,"title":"ClusterBlockException cannot be caught for bulk request when using node client","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2014-07-30T06:52:21Z","updated_at":"2014-07-31T15:15:39Z","closed_at":"2014-07-31T15:15:39Z","author_association":"MEMBER","active_lock_reason":null,"body":"When the cluster is in the ClusterBlockException state (Eg. not enough master to meet min master nodes), the ClusterBlockException cannot be caught for a bulk request when using node client:\n\n``` java\n BulkRequestBuilder brb = client.prepareBulk();\n            XContentBuilder builder = XContentFactory.jsonBuilder().startObject().field(\"bfield1\", \"bvalue1\").endObject();\n            String jsonString = builder.string();\n            IndexRequestBuilder irb = client.prepareIndex(INDEX_NAME,TYPE_NAME,\"b1\");\n            irb.setSource(jsonString);\n            brb.add(irb);\n            BulkResponse bulkResponse = brb.execute().actionGet();\n```\n\nReturns the exception:\n\n```\nException in thread \"elasticsearch[client_node][generic][T#4]\" org.elasticsearch.cluster.block.ClusterBlockException: blocked by: [SERVICE_UNAVAILABLE/1/state not recovered / initialized];[SERVICE_UNAVAILABLE/2/no master];\n    at org.elasticsearch.cluster.block.ClusterBlocks.globalBlockedException(ClusterBlocks.java:138)\n    at org.elasticsearch.cluster.block.ClusterBlocks.globalBlockedRaiseException(ClusterBlocks.java:128)\n    at org.elasticsearch.action.bulk.TransportBulkAction.executeBulk(TransportBulkAction.java:197)\n    at org.elasticsearch.action.bulk.TransportBulkAction.access$000(TransportBulkAction.java:65)\n    at org.elasticsearch.action.bulk.TransportBulkAction$1.onFailure(TransportBulkAction.java:143)\n    at org.elasticsearch.action.support.TransportAction$ThreadedActionListener$2.run(TransportAction.java:119)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\nThe above cannot be caught in a catch(ClusterBlockException exception) clause.  However, when the cluster is in the same state using the node client, the ClusterBlockException can be caught for search requests.\n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}