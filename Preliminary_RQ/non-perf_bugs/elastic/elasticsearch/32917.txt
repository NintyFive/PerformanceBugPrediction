{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32917","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32917/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32917/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32917/events","html_url":"https://github.com/elastic/elasticsearch/issues/32917","id":351308891,"node_id":"MDU6SXNzdWUzNTEzMDg4OTE=","number":32917,"title":"Nodes sometimes rejoin with same name but are blocked by allocation","user":{"login":"danielkasen","id":31549908,"node_id":"MDQ6VXNlcjMxNTQ5OTA4","avatar_url":"https://avatars1.githubusercontent.com/u/31549908?v=4","gravatar_id":"","url":"https://api.github.com/users/danielkasen","html_url":"https://github.com/danielkasen","followers_url":"https://api.github.com/users/danielkasen/followers","following_url":"https://api.github.com/users/danielkasen/following{/other_user}","gists_url":"https://api.github.com/users/danielkasen/gists{/gist_id}","starred_url":"https://api.github.com/users/danielkasen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielkasen/subscriptions","organizations_url":"https://api.github.com/users/danielkasen/orgs","repos_url":"https://api.github.com/users/danielkasen/repos","events_url":"https://api.github.com/users/danielkasen/events{/privacy}","received_events_url":"https://api.github.com/users/danielkasen/received_events","type":"User","site_admin":false},"labels":[{"id":837246479,"node_id":"MDU6TGFiZWw4MzcyNDY0Nzk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Allocation","name":":Distributed/Allocation","color":"0e8a16","default":false,"description":"All issues relating to the decision making around placing a shard (both master logic & on the nodes)"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-08-16T17:59:27Z","updated_at":"2018-09-10T07:27:33Z","closed_at":"2018-09-10T07:27:33Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** : 6.3.2\r\n\r\n**JVM version** (`java -version`): 1.8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Ubuntu 14.04\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nDuring a rolling restart if I restart 10+ nodes at once all will rejoin, but unassigned shards won't attempt to re-assign. When running the explain api I receive:\r\n```  \"can_allocate\": \"allocation_delayed\",\r\n  \"allocate_explanation\": \"cannot allocate because the cluster is still waiting 10.2m for the departed node holding a replica to rejoin, despite being allowed to allocate the shard to at least one other node\",```\r\n \r\nBut when I check the _nodes list I can find the node in the list. Once I restart just that node a second time it'll re-join and allocation continues as expected.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Set Node Delayed timeout to 10m\r\n 2. Restart 10+ nodes and wait for all to rejoin\r\n 3. Run explain on unassigned shards\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```{\r\n  \"index\": \"test-2018.08.16.15.45-1\",\r\n  \"shard\": 11,\r\n  \"primary\": false,\r\n  \"current_state\": \"unassigned\",\r\n  \"unassigned_info\": {\r\n    \"reason\": \"NODE_LEFT\",\r\n    \"at\": \"2018-08-16T17:21:52.924Z\",\r\n    \"details\": \"node_left[B72OqLj_Qi6TwGcKMHzICA]\",\r\n    \"last_allocation_status\": \"no_attempt\"\r\n  },\r\n  \"can_allocate\": \"allocation_delayed\",\r\n  \"allocate_explanation\": \"cannot allocate because the cluster is still waiting 10.2m for the departed node holding a replica to rejoin, despite being allowed to allocate the shard to at least one other node\",```","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}