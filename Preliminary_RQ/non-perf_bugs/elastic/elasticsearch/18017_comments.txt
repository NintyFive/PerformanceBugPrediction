[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/215657049","html_url":"https://github.com/elastic/elasticsearch/issues/18017#issuecomment-215657049","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18017","id":215657049,"node_id":"MDEyOklzc3VlQ29tbWVudDIxNTY1NzA0OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-29T08:25:01Z","updated_at":"2016-04-29T08:25:01Z","author_association":"CONTRIBUTOR","body":"Whether this fails or not depends on the order of requests, eg given this document:\n\n```\nPUT t/t/1\n{\n  \"operation_date\": \"2001/10/10\"\n}\n```\n\nIf you run a non-scripting agg which refers to the time zone first:\n\n```\nGET _search\n{\n  \"aggs\": {\n    \"NAME\": {\n      \"date_histogram\": {\n        \"field\": \"operation_date\",\n        \"interval\": \"hour\",\n        \"time_zone\": \"America/New_York\"\n      }\n    }\n  }\n}\n```\n\nthen this request succeeds, and so do the scripting request:\n\n```\nGET _search\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"group_by_hour\": {\n      \"terms\": {\n        \"script\": \"def opDate = new DateTime(doc['operation_date'].date); opDate.withZone(DateTimeZone.forID('America/New_York')).getHourOfDay()\",\n        \"order\": {\n          \"_term\": \"asc\"\n        }\n      }\n    }\n  }\n}\n```\n\nIf you reverse the order of the searches, then both fail.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/219038824","html_url":"https://github.com/elastic/elasticsearch/issues/18017#issuecomment-219038824","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18017","id":219038824,"node_id":"MDEyOklzc3VlQ29tbWVudDIxOTAzODgyNA==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2016-05-13T13:12:58Z","updated_at":"2016-05-13T13:12:58Z","author_association":"CONTRIBUTOR","body":"If you don't have an aggregation, there is currently no way to get timezones and work with scripts. Any ETA on fixing this? Any workaround that can be defined inside the script?\n\nI tried modifying the `java.policy` file but doesn't look like it works. Isn't this related to #14524? Is there any workaround other than performing a fake search operation before running the script?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/219039470","html_url":"https://github.com/elastic/elasticsearch/issues/18017#issuecomment-219039470","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18017","id":219039470,"node_id":"MDEyOklzc3VlQ29tbWVudDIxOTAzOTQ3MA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-13T13:15:41Z","updated_at":"2016-05-13T13:15:41Z","author_association":"MEMBER","body":"Modifying the `java.policy` file will not help, the issue is in Joda Time.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/219039988","html_url":"https://github.com/elastic/elasticsearch/issues/18017#issuecomment-219039988","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18017","id":219039988,"node_id":"MDEyOklzc3VlQ29tbWVudDIxOTAzOTk4OA==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2016-05-13T13:17:56Z","updated_at":"2016-05-13T13:18:17Z","author_association":"CONTRIBUTOR","body":"Thanks for the quick answer @jasontedor . So there isn't a real workaround? Is it related to JodaOrg/joda-time#327? Until this is not fixed, one cannot do this operation? \n\nIs there something that we can do for this? Looks like the Joda Time issue has been opened for a while already.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220210268","html_url":"https://github.com/elastic/elasticsearch/issues/18017#issuecomment-220210268","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18017","id":220210268,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDIxMDI2OA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T02:13:10Z","updated_at":"2016-05-19T02:13:10Z","author_association":"MEMBER","body":"I opened JodaOrg/joda-time#375. When we can incorporate a new release of Joda Time that contains this into Elasticsearch we will be able to close this bug out. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220300889","html_url":"https://github.com/elastic/elasticsearch/issues/18017#issuecomment-220300889","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18017","id":220300889,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMwMDg4OQ==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T11:45:00Z","updated_at":"2016-05-19T11:45:00Z","author_association":"CONTRIBUTOR","body":"@jasontedor is this going to be added in a `2.3.x` release for ES?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/220301475","html_url":"https://github.com/elastic/elasticsearch/issues/18017#issuecomment-220301475","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18017","id":220301475,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDMwMTQ3NQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-05-19T11:47:52Z","updated_at":"2016-05-19T11:48:58Z","author_association":"MEMBER","body":"> is this going to be added in a 2.3.x release for ES?\n\nI don't know; we have to see if JodaOrg/joda-time#375 is accepted into Joda Time first, and if it is, the timeline under which a bug fix release of Joda Time is made that includes it that we can incorporate into Elasticsearch. \n","performed_via_github_app":null}]