{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13236","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13236/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13236/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13236/events","html_url":"https://github.com/elastic/elasticsearch/issues/13236","id":104219640,"node_id":"MDU6SXNzdWUxMDQyMTk2NDA=","number":13236,"title":"Issue with time_zone in date_histogram aggregations","user":{"login":"colmaengus","id":6358852,"node_id":"MDQ6VXNlcjYzNTg4NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/6358852?v=4","gravatar_id":"","url":"https://api.github.com/users/colmaengus","html_url":"https://github.com/colmaengus","followers_url":"https://api.github.com/users/colmaengus/followers","following_url":"https://api.github.com/users/colmaengus/following{/other_user}","gists_url":"https://api.github.com/users/colmaengus/gists{/gist_id}","starred_url":"https://api.github.com/users/colmaengus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colmaengus/subscriptions","organizations_url":"https://api.github.com/users/colmaengus/orgs","repos_url":"https://api.github.com/users/colmaengus/repos","events_url":"https://api.github.com/users/colmaengus/events{/privacy}","received_events_url":"https://api.github.com/users/colmaengus/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"assignees":[{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2015-09-01T09:02:02Z","updated_at":"2015-09-07T19:15:56Z","closed_at":"2015-09-07T18:04:33Z","author_association":"NONE","active_lock_reason":null,"body":"Hi folks,\n\nWe are currently using the date_histogram pre_zone/post_zone parameters and would like to change to using time_zone since the others are deprecated.\nHowever they produce different results when using an hour interval.\n\nTo see this I created an index with four documents\n\n``` javascript\n[{\"date\": \"2014-12-31T23:30:00.000Z\"},\n{\"date\": \"2014-12-31T23:30:00.000Z\"},\n{\"date\": \"2015-1-1T00:30:00.000Z\"},\n{\"date\": \"2015-1-1T01:30:00.000Z\"}]\n```\n\nUsing the pre_zone parameters\n\n``` javascript\n{\n  \"aggs\": {\n    \"articles_over_time\": {\n      \"date_histogram\": {\n        \"field\": \"date\",\n        \"interval\": \"hour\",\n        \"pre_zone\": \"-01:00\",\n        \"post_zone\": \"-01:00\",\n        \"pre_zone_adjust_large_interval\": true\n      }\n    }\n  }\n}\n```\n\ngives\n\n``` javascript\n[\n  {\"key_as_string\": \"2014-12-31T22:00:00.000Z\", \"key\": 1420063200000, \"doc_count\": 1},\n  {\"key_as_string\": \"2014-12-31T23:00:00.000Z\", \"key\": 1420066800000, \"doc_count\": 1},\n  {\"key_as_string\": \"2015-01-01T00:00:00.000Z\", \"key\": 1420070400000, \"doc_count\": 1},\n  {\"key_as_string\": \"2015-01-01T01:00:00.000Z\", \"key\": 1420074000000, \"doc_count\": 1}\n]\n```\n\nUsing the time_zone parameter\n\n``` javascript\n{\n  \"aggs\": {\n    \"articles_over_time\": {\n      \"date_histogram\": {\n        \"field\": \"date\",\n        \"interval\": \"hour\",\n        \"time_zone\": \"-01:00\"\n      }\n    }\n  }\n}\n```\n\ngives\n\n``` javascript\n[\n  {\"key_as_string\": \"2014-12-31T23:00:00.000Z\", \"key\": 1420066800000, \"doc_count\": 1},\n  {\"key_as_string\": \"2015-01-01T00:00:00.000Z\", \"key\": 1420070400000, \"doc_count\": 1},\n  {\"key_as_string\": \"2015-01-01T01:00:00.000Z\", \"key\": 1420074000000, \"doc_count\": 1},\n  {\"key_as_string\": \"2015-01-01T02:00:00.000Z\", \"key\": 1420077600000, \"doc_count\": 1}\n]\n```\n\nChanging the value of time_zone has no impact on the results.\nIt works fine with larger intervals (day, month, year) just not with hour.\nI'm using Elasticsearch 1.7.0 on windows.\n\nRegards\n\nColm A\n\nP.S. Its not an issue but I wondering why the key_as_string is always returned in UTC even when using time_zone. The time part of the string is correct for the time zone just the lack of timezone in is unexpected.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}