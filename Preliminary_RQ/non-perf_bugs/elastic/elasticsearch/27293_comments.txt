[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/342400372","html_url":"https://github.com/elastic/elasticsearch/issues/27293#issuecomment-342400372","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27293","id":342400372,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MjQwMDM3Mg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2017-11-07T07:41:09Z","updated_at":"2017-11-07T07:41:09Z","author_association":"MEMBER","body":"This is not a bug, you can only order the terms aggregation by a numeric metric aggregation. Pipeline aggregations like the `sum_bucket` aggregation cannot be used for terms aggregation order as mentioned in the documentation (https://www.elastic.co/guide/en/elasticsearch/reference/5.6/search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-order). This is indeed because the pipeline aggregation are calculated only during the reduce phase on the coordinating node and so cannot be used to sort on the shards where each shard needs to return its top-N terms","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/342401866","html_url":"https://github.com/elastic/elasticsearch/issues/27293#issuecomment-342401866","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27293","id":342401866,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MjQwMTg2Ng==","user":{"login":"ali-bugdayci","id":1422344,"node_id":"MDQ6VXNlcjE0MjIzNDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1422344?v=4","gravatar_id":"","url":"https://api.github.com/users/ali-bugdayci","html_url":"https://github.com/ali-bugdayci","followers_url":"https://api.github.com/users/ali-bugdayci/followers","following_url":"https://api.github.com/users/ali-bugdayci/following{/other_user}","gists_url":"https://api.github.com/users/ali-bugdayci/gists{/gist_id}","starred_url":"https://api.github.com/users/ali-bugdayci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ali-bugdayci/subscriptions","organizations_url":"https://api.github.com/users/ali-bugdayci/orgs","repos_url":"https://api.github.com/users/ali-bugdayci/repos","events_url":"https://api.github.com/users/ali-bugdayci/events{/privacy}","received_events_url":"https://api.github.com/users/ali-bugdayci/received_events","type":"User","site_admin":false},"created_at":"2017-11-07T07:49:01Z","updated_at":"2017-11-07T07:49:01Z","author_association":"NONE","body":"Yeah, as I noted since they are calculated at the very end. The thing is it is inside search-aggregations documentation. Hence I could not find it. \r\n\r\nIt would be better if it was mentioned or linked to it inside pipeline aggregations documentation too:\r\n\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-pipeline.html\r\n","performed_via_github_app":null}]