{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/48665","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48665/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48665/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48665/events","html_url":"https://github.com/elastic/elasticsearch/issues/48665","id":514274066,"node_id":"MDU6SXNzdWU1MTQyNzQwNjY=","number":48665,"title":"Look into integrating IndexSortDocValuesRangeQuery.","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":1967498216,"node_id":"MDU6TGFiZWwxOTY3NDk4MjE2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Search","name":"Team:Search","color":"fef2c0","default":false,"description":"Meta label for search team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-10-29T22:45:06Z","updated_at":"2020-05-29T00:05:50Z","closed_at":"2020-05-29T00:05:49Z","author_association":"MEMBER","active_lock_reason":null,"body":"We recently added the range query `IndexSortDocValuesRangeQuery` to Lucene, which takes advantage of index sorting to run only on doc values (https://issues.apache.org/jira/browse/LUCENE-7714).  When the following conditions hold, the query is able to run efficiently using only doc values, otherwise it must fall back to a delegate range query: \r\n* The index is sorted, and its primary sort is on the same field as the query.\r\n* The query field has SortedNumericDocValues.\r\n* The segment has at most one field value per document.\r\n\r\nWe should investigate whether it could be helpful to integrate this query into Elasticsearch. In particular, it may allow us to avoid indexing the field used for the primary index sort, while still supporting range queries. There are a few open questions around the integration:\r\n* If the field is not indexed, then there is no efficient range query to fall back to. Could we somehow ensure that the documents contain only one field value, to make sure we can run efficiently on doc values?\r\n* The query has only been benchmarked against dense doc values, and may not show good performance on sparse doc values. Is there anything we can do to improve the sparse case, or at least guard against it?","closed_by":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"performed_via_github_app":null}