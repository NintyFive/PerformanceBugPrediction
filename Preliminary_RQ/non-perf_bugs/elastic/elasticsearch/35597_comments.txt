[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/439127532","html_url":"https://github.com/elastic/elasticsearch/issues/35597#issuecomment-439127532","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35597","id":439127532,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTEyNzUzMg==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-11-15T17:40:44Z","updated_at":"2018-11-15T17:40:44Z","author_association":"CONTRIBUTOR","body":"It is perhaps notable that all of the failures I can see have been in the two-thirds upgraded cluster or the fully-upgraded cluster. We've also seen cases where the cluster _does_ form but then times out in a subsequent health check:\r\n\r\n```\r\nERROR   70.6s | RecoveryIT.testRecoveryWithConcurrentIndexing <<< FAILURES!\r\n   > Throwable #1: org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:44918], URI [/_cluster/health/recovery_with_concurrent_indexing?wait_for_no_relocating_shards=true&level=shards&timeout=70s&wait_for_status=green], status line [HTTP/1.1 408 Request Timeout]\r\n   > {\"cluster_name\":\"rolling-upgrade\",\"status\":\"yellow\",\"timed_out\":true,\"number_of_nodes\":3,\"number_of_data_nodes\":3,\"active_primary_shards\":1,\"active_shards\":2,\"relocating_shards\":0,\"initializing_shards\":0,\"unassigned_shards\":1,\"delayed_unassigned_shards\":0,\"number_of_pending_tasks\":0,\"number_of_in_flight_fetch\":0,\"task_max_waiting_in_queue_millis\":0,\"active_shards_percent_as_number\":98.68421052631578,\"indices\":{\"recovery_with_concurrent_indexing\":{\"status\":\"yellow\",\"number_of_shards\":1,\"number_of_replicas\":2,\"active_primary_shards\":1,\"active_shards\":2,\"relocating_shards\":0,\"initializing_shards\":0,\"unassigned_shards\":1,\"shards\":{\"0\":{\"status\":\"yellow\",\"primary_active\":true,\"active_shards\":2,\"relocating_shards\":0,\"initializing_shards\":0,\"unassigned_shards\":1}}}}}\r\n   > \tat __randomizedtesting.SeedInfo.seed([DA5FC8F3EE50997:8DF438DCBC41D75D]:0)\r\n   > \tat org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:926)\r\n   > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:229)\r\n   > \tat org.elasticsearch.test.rest.ESRestTestCase.ensureGreen(ESRestTestCase.java:711)\r\n   > \tat org.elasticsearch.upgrades.RecoveryIT.testRecoveryWithConcurrentIndexing(RecoveryIT.java:141)\r\n   > \tat java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:44918], URI [/_cluster/health/recovery_with_concurrent_indexing?wait_for_no_relocating_shards=true&level=shards&timeout=70s&wait_for_status=green], status line [HTTP/1.1 408 Request Timeout]\r\n   > {\"cluster_name\":\"rolling-upgrade\",\"status\":\"yellow\",\"timed_out\":true,\"number_of_nodes\":3,\"number_of_data_nodes\":3,\"active_primary_shards\":1,\"active_shards\":2,\"relocating_shards\":0,\"initializing_shards\":0,\"unassigned_shards\":1,\"delayed_unassigned_shards\":0,\"number_of_pending_tasks\":0,\"number_of_in_flight_fetch\":0,\"task_max_waiting_in_queue_millis\":0,\"active_shards_percent_as_number\":98.68421052631578,\"indices\":{\"recovery_with_concurrent_indexing\":{\"status\":\"yellow\",\"number_of_shards\":1,\"number_of_replicas\":2,\"active_primary_shards\":1,\"active_shards\":2,\"relocating_shards\":0,\"initializing_shards\":0,\"unassigned_shards\":1,\"shards\":{\"0\":{\"status\":\"yellow\",\"primary_active\":true,\"active_shards\":2,\"relocating_shards\":0,\"initializing_shards\":0,\"unassigned_shards\":1}}}}}\r\n   > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:546)\r\n   > \tat org.elasticsearch.client.RestClient$1.completed(RestClient.java:531)\r\n   > \tat org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n   > \tat org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n   > \tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n   > \tat org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n   > \tat org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n   > \tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n   > \tat org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n   > \tat org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n   > \tat org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n   > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n   > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n   > \tat org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n   > \tat org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n   > \tat org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n   > \t... 1 more\r\n```\r\n(from https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+intake/186/console)\r\n\r\nUnfortunately the first few failures in the sequence of broken builds on 6.x seem unrelated to this one, with more changes having been pushed on top of the red CI, so it's hard to narrow down the point at which things started to break. Looking at the changes, I wonder if perhaps #34902 or #35332 could have this sort of effect?\r\n\r\nAnyhow, muted in 188de54bed63e728dbd83419a8a5c209aa1c7f78.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/439142327","html_url":"https://github.com/elastic/elasticsearch/issues/35597#issuecomment-439142327","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35597","id":439142327,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTE0MjMyNw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-11-15T18:27:54Z","updated_at":"2018-11-15T18:29:19Z","author_association":"CONTRIBUTOR","body":"Ok I reverted 0c5e87f5289567b1ef105d151c45f8a174849da5 (#35332) and that seemed to clear it up. Letting @tlrx know.\r\n\r\nEdit: I do not mean I reverted this in `6.x`, just on my local machine.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/439313306","html_url":"https://github.com/elastic/elasticsearch/issues/35597#issuecomment-439313306","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35597","id":439313306,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTMxMzMwNg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-11-16T08:06:15Z","updated_at":"2018-11-16T08:06:15Z","author_association":"MEMBER","body":"@DaveCTurner Sorry to hear that, this is concerning. I'm looking at this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/439315810","html_url":"https://github.com/elastic/elasticsearch/issues/35597#issuecomment-439315810","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35597","id":439315810,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTMxNTgxMA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-11-16T08:17:30Z","updated_at":"2018-11-16T08:17:30Z","author_association":"MEMBER","body":"Also muted the test in master in https://github.com/elastic/elasticsearch/commit/f9aff7b181d330d7b801cf32ffe15e57920d95ce","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/439419447","html_url":"https://github.com/elastic/elasticsearch/issues/35597#issuecomment-439419447","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35597","id":439419447,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTQxOTQ0Nw==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-11-16T14:59:57Z","updated_at":"2018-11-16T14:59:57Z","author_association":"MEMBER","body":"Thanks @DaveCTurner, your preliminary investigation helped a lot. I reverted  #35332 from master in d3d7c0158e2e79db53c3183fe3f81861e73a1b37 and 6.x in c70b8ac361772cf4e72f156dd623a93671f6dc98 and unmuted the test. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440203594","html_url":"https://github.com/elastic/elasticsearch/issues/35597#issuecomment-440203594","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35597","id":440203594,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDIwMzU5NA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-11-20T09:28:18Z","updated_at":"2018-11-20T09:28:18Z","author_association":"MEMBER","body":"For a better explanation of the issue, see https://github.com/elastic/elasticsearch/pull/35695#issuecomment-440203302","performed_via_github_app":null}]