{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6527","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6527/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6527/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6527/events","html_url":"https://github.com/elastic/elasticsearch/issues/6527","id":35866611,"node_id":"MDU6SXNzdWUzNTg2NjYxMQ==","number":6527,"title":"version 1.2.1 has_child query with function_score can not access child's numeric field value","user":{"login":"fiefdx","id":3204360,"node_id":"MDQ6VXNlcjMyMDQzNjA=","avatar_url":"https://avatars1.githubusercontent.com/u/3204360?v=4","gravatar_id":"","url":"https://api.github.com/users/fiefdx","html_url":"https://github.com/fiefdx","followers_url":"https://api.github.com/users/fiefdx/followers","following_url":"https://api.github.com/users/fiefdx/following{/other_user}","gists_url":"https://api.github.com/users/fiefdx/gists{/gist_id}","starred_url":"https://api.github.com/users/fiefdx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fiefdx/subscriptions","organizations_url":"https://api.github.com/users/fiefdx/orgs","repos_url":"https://api.github.com/users/fiefdx/repos","events_url":"https://api.github.com/users/fiefdx/events{/privacy}","received_events_url":"https://api.github.com/users/fiefdx/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-06-17T08:10:10Z","updated_at":"2014-06-17T08:14:13Z","closed_at":"2014-06-17T08:14:13Z","author_association":"NONE","active_lock_reason":null,"body":"index script as:\n# !/bin/sh\n# assume the index products doesn't exist\n# otherwise uncomment the following line\n# curl -XDELETE localhost:9200/products\n# echo \"\"\n\ncurl -XPOST 'localhost:9200/products/' -d '{\n    \"index\" : {\n        \"number_of_shards\" : 4,\n        \"number_of_replicas\" : 1\n    }\n}'\necho \"\"\n\ncurl -XPOST localhost:9200/products/product/_mapping -d '{\n  \"product\":{\n    \"properties\" : {\n      \"property1\" : {\"type\" : \"string\"}\n    }\n  }\n}'\necho \"\"\n\ncurl -XPOST localhost:9200/products/offer/_mapping -d '{\n  \"offer\":{\n    \"_parent\": {\"type\": \"product\"},\n    \"properties\" : {\n      \"color\" : {\"type\" : \"string\"},\n      \"size\" : {\"type\" : \"integer\"},\n      \"price\" : {\"type\" : \"float\"}\n    }\n  }\n}'\necho \"\"\n\ncurl -XPUT localhost:9200/products/product/1 -d'{\n  \"property1\": \"value1\"\n}'\necho \"\"\n\ncurl -XPUT localhost:9200/products/product/2 -d'{\n  \"property1\": \"value2\"\n}'\necho \"\"\n\ncurl -XPOST localhost:9200/products/offer/1?parent=1 -d '{\n   \"color\": \"blue\",\n   \"size\": 1,\n   \"price\": 99.4\n}'\necho \"\"\n\ncurl -XPOST localhost:9200/products/offer/2?parent=1 -d '{\n   \"color\": \"red\",\n   \"size\": 2,\n   \"price\": 100.5\n}'\necho \"\"\n\ncurl -XPOST localhost:9200/products/offer/3?parent=2 -d '{\n   \"color\": \"blue\",\n   \"size\": 3,\n   \"price\": 100.7\n}'\necho \"\"\n\nsearch script as:\ncurl -s -XPOST 'localhost:9200/products/product,offer/_search?pretty=true' -d '{\n  \"query\" : {\n    \"has_child\" : {\n      \"type\" : \"offer\",\n      \"score_mode\" : \"max\",\n      \"query\" : {\n        \"function_score\" : {\n          \"boost_mode\" : \"replace\",\n          \"query\" : {\n            \"bool\" : {\n              \"must\" : [\n                { \"term\" : { \"color\" : \"blue\" } }\n              ]\n            }\n          },\n          \"script_score\" : {\n            \"script\" : \"doc['offer.price'].value\"\n          }\n        }\n      }\n    }\n  }\n}'\necho \"\"\n\nget exception:\nnested: PropertyAccessException[[Error: could not access: offer; in class: org.elasticsearch.search.lookup.DocLookup]\\n[Near : {... doc[offer.price].value ....}\n\nCan function_score get child's numeric field as parent's score like version 0.90.x custom_score did?\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}