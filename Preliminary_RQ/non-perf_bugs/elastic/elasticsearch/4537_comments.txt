[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/35800659","html_url":"https://github.com/elastic/elasticsearch/issues/4537#issuecomment-35800659","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4537","id":35800659,"node_id":"MDEyOklzc3VlQ29tbWVudDM1ODAwNjU5","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2014-02-22T11:39:53Z","updated_at":"2014-02-22T11:39:53Z","author_association":"MEMBER","body":"I spent some time on this and I can confirm this might happen when creating and deleting the same river quickly. The reason is that the delete mapping does return after the type has been deleted from the cluster state (on all nodes), but that triggers additional _asynchronous_ events in case the operation happens under the `_river` index. \n\nIf the actual river deletion hasn't happened yet when you send the second command (to register again the same river), which can happen given its asynchronous nature, it might happen that the river gets added and immediately deleted as well.\n\nThe way to solve it so that we don't require a `sleep` between the two operations is making this whole process completely synchronous so that when the delete mapping returns everything is done, which is not as easy as it might sound given all the little async steps this overall process is composed of.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/90646583","html_url":"https://github.com/elastic/elasticsearch/issues/4537#issuecomment-90646583","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4537","id":90646583,"node_id":"MDEyOklzc3VlQ29tbWVudDkwNjQ2NTgz","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-04-07T17:01:20Z","updated_at":"2015-04-07T17:01:20Z","author_association":"MEMBER","body":"Rivers are deprecated, see #10345 . \n","performed_via_github_app":null}]