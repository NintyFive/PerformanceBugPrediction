[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298882617","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-298882617","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":298882617,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODg4MjYxNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-05-03T11:11:23Z","updated_at":"2017-06-06T13:21:18Z","author_association":"CONTRIBUTOR","body":"TL;DR: The cluster health request with local flag set to true is super trappy\r\n\r\nWhat happens here is the following:\r\n1) at the end of the test, the disruption is stopped\r\n```\r\n  1> [2017-05-03T22:08:49,567][INFO ][o.e.d.DiscoveryWithServiceDisruptionsIT] stopping disruption\r\n  1> [2017-05-03T22:08:49,567][INFO ][o.e.t.d.NetworkDisruption] stop disrupting (disruption scheme: network unresponsive, disrupted links: two partitions (partition 1: [node_t2] and partition 2: [node_t1, node_t0]))\r\n```\r\n2) the test then calls `ensureStableCluster` for each node and also `ensureGreen`\r\n```\r\n  1> [2017-05-03T22:08:49,568][DEBUG][o.e.d.DiscoveryWithServiceDisruptionsIT] ensuring cluster is stable with [3] nodes. access node: [node_t0]. timeout: [40s]\r\n  1> [2017-05-03T22:08:49,568][TRACE][o.e.c.s.ClusterService   ] [node_t0] will process [cluster_health (wait_for_events [LANGUID])]\r\n  1> [2017-05-03T22:08:49,568][DEBUG][o.e.c.s.ClusterService   ] [node_t0] processing [cluster_health (wait_for_events [LANGUID])]: execute\r\n  1> [2017-05-03T22:08:49,568][DEBUG][o.e.c.s.ClusterService   ] [node_t0] processing [cluster_health (wait_for_events [LANGUID])]: took [0s] no change in cluster_state\r\n  1> [2017-05-03T22:08:49,568][DEBUG][o.e.d.DiscoveryWithServiceDisruptionsIT] ensuring cluster is stable with [3] nodes. access node: [node_t1]. timeout: [40s]\r\n  1> [2017-05-03T22:08:49,569][TRACE][o.e.c.s.ClusterService   ] [node_t1] will process [cluster_health (wait_for_events [LANGUID])]\r\n  1> [2017-05-03T22:08:49,569][DEBUG][o.e.c.s.ClusterService   ] [node_t1] processing [cluster_health (wait_for_events [LANGUID])]: execute\r\n  1> [2017-05-03T22:08:49,569][DEBUG][o.e.c.s.ClusterService   ] [node_t1] processing [cluster_health (wait_for_events [LANGUID])]: took [0s] no change in cluster_state\r\n  1> [2017-05-03T22:08:49,569][DEBUG][o.e.d.DiscoveryWithServiceDisruptionsIT] ensuring cluster is stable with [3] nodes. access node: [node_t2]. timeout: [40s]\r\n  1> [2017-05-03T22:08:49,569][TRACE][o.e.c.s.ClusterService   ] [node_t2] will process [cluster_health (wait_for_events [LANGUID])]\r\n  1> [2017-05-03T22:08:49,569][DEBUG][o.e.c.s.ClusterService   ] [node_t2] processing [cluster_health (wait_for_events [LANGUID])]: execute\r\n  1> [2017-05-03T22:08:49,569][DEBUG][o.e.c.s.ClusterService   ] [node_t2] processing [cluster_health (wait_for_events [LANGUID])]: took [0s] no change in cluster_state\r\n  1> [2017-05-03T22:08:49,570][TRACE][o.e.c.s.ClusterService   ] [node_t0] will process [cluster_health (wait_for_events [LANGUID])]\r\n  1> [2017-05-03T22:08:49,570][DEBUG][o.e.c.s.ClusterService   ] [node_t0] processing [cluster_health (wait_for_events [LANGUID])]: execute\r\n  1> [2017-05-03T22:08:49,571][DEBUG][o.e.c.s.ClusterService   ] [node_t0] processing [cluster_health (wait_for_events [LANGUID])]: took [0s] no change in cluster_state\r\n  1> [2017-05-03T22:08:49,571][DEBUG][o.e.d.DiscoveryWithServiceDisruptionsIT] indices [test] are green\r\n```\r\n3) finally the test does a number of `GET` operations to validate that all acked operations have been successfully indexed.\r\n\r\nThe issue is that `ensureStableCluster` and `ensureGreen` get to execute and properly return while the cluster is still in a transition state. `node_t2` in particular is still isolated from the rest of the cluster and has a state with a `NO_MASTER_BLOCK` but the cluster health action with local flag that is done as part of `ensureStableCluster` does not care about that. The health response will show as red but provide no other information that indicates that the node that was queried is not part of a cluster.\r\n\r\n/cc: @bleskes @jasontedor ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/374561885","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-374561885","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":374561885,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NDU2MTg4NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-03-20T11:19:27Z","updated_at":"2018-03-20T11:19:27Z","author_association":"MEMBER","body":"@ywelsch I think the idea of the local flag is to make sure that all nodes have processed the fact that the cluster is stable. I think a better way is to first reach out to the master and then validate all nodes have applied at least as high a cluster state version. Does that make sense?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/383865830","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-383865830","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":383865830,"node_id":"MDEyOklzc3VlQ29tbWVudDM4Mzg2NTgzMA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-04-24T09:26:57Z","updated_at":"2018-04-24T09:26:57Z","author_association":"MEMBER","body":"@ywelsch do you still feel that we should pick this up? if so, what do you think of my suggestion?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/425940254","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-425940254","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":425940254,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNTk0MDI1NA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2018-10-01T15:00:54Z","updated_at":"2018-10-01T15:00:54Z","author_association":"CONTRIBUTOR","body":"failures still continue to occasionally happen on 5.6 with a rate 1-2 times a week:\r\n\r\nRecent failure\r\n\r\nLog: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.6+multijob-unix-compatibility/os=sles/33/console\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/504002489","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-504002489","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":504002489,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDAwMjQ4OQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-06-20T12:15:34Z","updated_at":"2019-06-20T12:36:57Z","author_association":"CONTRIBUTOR","body":"We still have failures from this test though with different errors, for instance this one:\r\n\r\nhttps://scans.gradle.com/s/npcyedhjecs2m/tests/kyv2y2z3r4v7m-f6hbue3yhtsqi?openStackTraces=WzBd\r\n\r\nA notable warning here is:\r\n\r\n```\r\n[2019-06-15T03:48:31,786][WARN ][o.e.t.n.MockNioTransport ] [node_t2] Slow execution on network thread [49634 milliseconds]\r\njava.lang.RuntimeException: Slow exception on network thread\r\n\tat org.elasticsearch.transport.nio.MockNioTransport$TransportThreadWatchdog.maybeLogElapsedTime(MockNioTransport.java:367) ~[framework-7.2.0-SNAPSHOT.jar:7.2.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.nio.MockNioTransport$TransportThreadWatchdog.unregister(MockNioTransport.java:359) ~[framework-7.2.0-SNAPSHOT.jar:7.2.0-SNAPSHOT]\r\n\tat org.elasticsearch.transport.nio.TestEventHandler.acceptChannel(TestEventHandler.java:54) ~[framework-7.2.0-SNAPSHOT.jar:7.2.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.processKey(NioSelector.java:227) ~[elasticsearch-nio-7.2.0-SNAPSHOT.jar:7.2.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:172) ~[elasticsearch-nio-7.2.0-SNAPSHOT.jar:7.2.0-SNAPSHOT]\r\n\tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:129) ~[elasticsearch-nio-7.2.0-SNAPSHOT.jar:7.2.0-SNAPSHOT]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n```\r\n\r\nwhich does look similar to #43387. Backported #42617 to 7.2 to maybe get a bit more info out if this happens again.\r\n\r\nSeems above is the cause of:\r\n\r\n```\r\n[2019-06-15T03:48:31,817][WARN ][o.e.t.TransportService   ] [node_t0] Received response for a request that has timed out, sent [50634ms] ago, timed out [49634ms] ago, action [internal:coordination/fault_detection/follower_check], node [{node_t1}{WAoGuh0HSK6508Jf_-39Nw}{qnt8jnKxSJ6mOz8vp_t3UQ}{127.0.0.1}{127.0.0.1:40454}], id [116]\r\n[2019-06-15T03:48:31,817][WARN ][o.e.t.TransportService   ] [node_t1] Received response for a request that has timed out, sent [50837ms] ago, timed out [49836ms] ago, action [internal:coordination/fault_detection/leader_check], node [{node_t0}{BGklU2FGQXSNVDdEyBPidA}{LDhKR4chTBqKoWKA1MW-gA}{127.0.0.1}{127.0.0.1:48266}], id [54]\r\n[2019-06-15T03:48:31,817][WARN ][o.e.t.TransportService   ] [node_t0] Received response for a request that has timed out, sent [25618ms] ago, timed out [10607ms] ago, action [cluster:monitor/nodes/stats[n]], node [{node_t1}{WAoGuh0HSK6508Jf_-39Nw}{qnt8jnKxSJ6mOz8vp_t3UQ}{127.0.0.1}{127.0.0.1:40454}], id [119]\r\n```\r\n\r\nand also the reason why handshakes start going well afterwards:\r\n\r\n```\r\n[2019-06-15T03:48:31,818][TRACE][o.e.d.HandshakingTransportAddressConnector] [node_t0] [connectToRemoteMasterNode[127.0.0.1:40454]] handshake successful: {node_t1}{WAoGuh0HSK6508Jf_-39Nw}{qnt8jnKxSJ6mOz8vp_t3UQ}{127.0.0.1}{127.0.0.1:40454}\r\n```\r\n\r\nNotice that the disruption was a disconnnect one. And was stopped 52 seconds earlier:\r\n\r\n```\r\n[2019-06-15T03:47:39,823][INFO ][o.e.t.d.NetworkDisruption] [testAckedIndexing] stop disrupting (disruption scheme: network disconnects, disrupted links: two partitions (partition 1: [node_t2] and partition 2: [node_t1, node_t0]))\r\n```\r\n\r\nThe failure here was:\r\n\r\n```\r\nfailed to reach a stable cluster of [3] nodes. Tried via [node_t0]. last cluster state:\r\n```\r\n\r\nI tried hard reproducing this locally, but did not find a way to provoke neither that warning nor the failure.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/504015125","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-504015125","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":504015125,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDAxNTEyNQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-06-20T12:56:56Z","updated_at":"2019-06-20T16:19:28Z","author_association":"CONTRIBUTOR","body":"Checked all the recent failures of this test and they fall into following categories:\r\n\r\n1. Network unresponsive disruption, none of those since #42579 was merged, though this is only 9 days ago (so need more time to be conclusive on that part).\r\n2. Global checkpoint not in sync, should be fixed by #41068, now in 7.2 too.\r\n3. The above symptom (twice in the last week, both on 7.2, once on debian 8 and once on zulu11/docker build).\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/504093672","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-504093672","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":504093672,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDA5MzY3Mg==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-06-20T16:27:48Z","updated_at":"2019-06-20T16:27:48Z","author_association":"CONTRIBUTOR","body":"New incident from 7.x, same symptom, but with the additional logging that @original-brownbear added:\r\n\r\n```\r\n[2019-06-20T10:24:56,622][WARN ][o.e.t.n.MockNioTransport ] [node_t0] Potentially blocked execution on network thread [elasticsearch[node_t0][transport_worker][T#2]] [55630 milliseconds]: \r\nsun.nio.ch.ServerSocketChannelImpl.accept0(Native Method)\r\nsun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422)\r\nsun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory$$Lambda$1613/1836336234.run(Unknown Source)\r\njava.security.AccessController.doPrivileged(Native Method)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory.accept(ChannelFactory.java:223)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory.acceptNioChannel(ChannelFactory.java:180)\r\norg.elasticsearch.nio.ChannelFactory.acceptNioChannel(ChannelFactory.java:55)\r\norg.elasticsearch.nio.ServerChannelContext.acceptChannels(ServerChannelContext.java:47)\r\norg.elasticsearch.nio.EventHandler.acceptChannel(EventHandler.java:45)\r\norg.elasticsearch.transport.nio.TestEventHandler.acceptChannel(TestEventHandler.java:51)\r\norg.elasticsearch.nio.NioSelector.processKey(NioSelector.java:227)\r\norg.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:172)\r\norg.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:129)\r\norg.elasticsearch.nio.NioSelectorGroup$$Lambda$1556/832165726.run(Unknown Source)\r\njava.lang.Thread.run(Thread.java:748)\r\n[2019-06-20T10:24:56,699][WARN ][o.e.t.n.MockNioTransport ] [node_t1] Potentially blocked execution on network thread [elasticsearch[node_t1][transport_worker][T#2]] [56029 milliseconds]: \r\nsun.nio.ch.ServerSocketChannelImpl.accept0(Native Method)\r\nsun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422)\r\nsun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory$$Lambda$1613/1836336234.run(Unknown Source)\r\njava.security.AccessController.doPrivileged(Native Method)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory.accept(ChannelFactory.java:223)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory.acceptNioChannel(ChannelFactory.java:180)\r\norg.elasticsearch.nio.ChannelFactory.acceptNioChannel(ChannelFactory.java:55)\r\norg.elasticsearch.nio.ServerChannelContext.acceptChannels(ServerChannelContext.java:47)\r\norg.elasticsearch.nio.EventHandler.acceptChannel(EventHandler.java:45)\r\norg.elasticsearch.transport.nio.TestEventHandler.acceptChannel(TestEventHandler.java:51)\r\norg.elasticsearch.nio.NioSelector.processKey(NioSelector.java:227)\r\norg.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:172)\r\norg.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:129)\r\norg.elasticsearch.nio.NioSelectorGroup$$Lambda$1556/832165726.run(Unknown Source)\r\njava.lang.Thread.run(Thread.java:748)\r\n[2019-06-20T10:24:56,761][WARN ][o.e.t.n.MockNioTransport ] [node_t2] Potentially blocked execution on network thread [elasticsearch[node_t2][transport_worker][T#2]] [54829 milliseconds]: \r\nsun.nio.ch.ServerSocketChannelImpl.accept0(Native Method)\r\nsun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422)\r\nsun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory$$Lambda$1613/1836336234.run(Unknown Source)\r\njava.security.AccessController.doPrivileged(Native Method)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory.accept(ChannelFactory.java:223)\r\norg.elasticsearch.nio.ChannelFactory$RawChannelFactory.acceptNioChannel(ChannelFactory.java:180)\r\norg.elasticsearch.nio.ChannelFactory.acceptNioChannel(ChannelFactory.java:55)\r\norg.elasticsearch.nio.ServerChannelContext.acceptChannels(ServerChannelContext.java:47)\r\norg.elasticsearch.nio.EventHandler.acceptChannel(EventHandler.java:45)\r\norg.elasticsearch.transport.nio.TestEventHandler.acceptChannel(TestEventHandler.java:51)\r\norg.elasticsearch.nio.NioSelector.processKey(NioSelector.java:227)\r\norg.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:172)\r\norg.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:129)\r\norg.elasticsearch.nio.NioSelectorGroup$$Lambda$1556/832165726.run(Unknown Source)\r\njava.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nhttps://scans.gradle.com/s/62jsofae5l5n4/tests/kyv2y2z3r4v7m-f6hbue3yhtsqi","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/504097900","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-504097900","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":504097900,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDA5NzkwMA==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-06-20T16:40:25Z","updated_at":"2019-06-20T16:40:25Z","author_association":"CONTRIBUTOR","body":"Just realized that all 3 above build failures and the one in #43387 have run on debian 8. That runs kernel 3.16, which is subject to:\r\n\r\nhttps://groups.google.com/forum/m/#!msg/mechanical-sympathy/QbmpZxp6C64/HRwMTvPXl1UJ\r\n\r\nfixed in 3.18 but also in a number of point fixes. I am going to chase that direction a bit more.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/504342936","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-504342936","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":504342936,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDM0MjkzNg==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T08:36:12Z","updated_at":"2019-06-21T08:36:12Z","author_association":"CONTRIBUTOR","body":"The futex wait should be fixed long ago in that kernel:\r\n\r\nhttps://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?h=linux-3.16.y&id=b89814999ab2a2120be803c1468fc54ad965df1f\r\n\r\nTried to reproduce the accept hang issue in a minimalistic program doing connects and disconnects, but were not able to provoke it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/504355001","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-504355001","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":504355001,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDM1NTAwMQ==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-06-21T09:14:20Z","updated_at":"2019-06-21T09:14:20Z","author_association":"MEMBER","body":"@henningandersen same here, I ran a bunch of rounds of the failing test task over night (whole Gradle run) on Debian 8 without any hanging. Might not be the futex issue, but certainly is something else system specific.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/512359537","html_url":"https://github.com/elastic/elasticsearch/issues/24457#issuecomment-512359537","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24457","id":512359537,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjM1OTUzNw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2019-07-17T16:39:30Z","updated_at":"2019-07-17T16:39:30Z","author_association":"CONTRIBUTOR","body":"The remaining problems are tracked in https://github.com/elastic/elasticsearch/issues/41068 and https://github.com/elastic/elasticsearch/issues/43387","performed_via_github_app":null}]