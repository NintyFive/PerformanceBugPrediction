[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409692853","html_url":"https://github.com/elastic/elasticsearch/issues/32562#issuecomment-409692853","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32562","id":409692853,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTY5Mjg1Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-01T19:25:56Z","updated_at":"2018-08-01T19:25:56Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-security","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409832447","html_url":"https://github.com/elastic/elasticsearch/issues/32562#issuecomment-409832447","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32562","id":409832447,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTgzMjQ0Nw==","user":{"login":"jakommo","id":6436143,"node_id":"MDQ6VXNlcjY0MzYxNDM=","avatar_url":"https://avatars2.githubusercontent.com/u/6436143?v=4","gravatar_id":"","url":"https://api.github.com/users/jakommo","html_url":"https://github.com/jakommo","followers_url":"https://api.github.com/users/jakommo/followers","following_url":"https://api.github.com/users/jakommo/following{/other_user}","gists_url":"https://api.github.com/users/jakommo/gists{/gist_id}","starred_url":"https://api.github.com/users/jakommo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakommo/subscriptions","organizations_url":"https://api.github.com/users/jakommo/orgs","repos_url":"https://api.github.com/users/jakommo/repos","events_url":"https://api.github.com/users/jakommo/events{/privacy}","received_events_url":"https://api.github.com/users/jakommo/received_events","type":"User","site_admin":false},"created_at":"2018-08-02T07:25:21Z","updated_at":"2018-08-02T07:25:21Z","author_association":"CONTRIBUTOR","body":"I'm proposing a third option, which is a dedicated .security backup role, that only allows a (full) backup of .security, but does not grant all the other superuser permissions. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/410674686","html_url":"https://github.com/elastic/elasticsearch/issues/32562#issuecomment-410674686","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32562","id":410674686,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMDY3NDY4Ng==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-08-06T11:15:36Z","updated_at":"2018-08-06T11:15:36Z","author_association":"CONTRIBUTOR","body":"To be precise, to create and restore snapshots, the user needs the `manage` cluster privilege. It is a rather broad privilege so it's not completely erroneous to refer to it as `superuser`. Reading the linked SDHEs, it looks like `superuser` is indeed required when doing the snapshot from curator which first lists the indices that it is suppose to snapshot.\r\n\r\nSince the request is to lower the privilege for snapshot/restore I think it's important to note that because we don't authorize on the indices being restored, but on the restore action itself, any restore privilege is equivalent to the `manage_security`, when restoring includes the `.security` index, because a user can restore a snapshot that it had altered on it's own local cluster.\r\n\r\nSo, if the goal is to downgrade privileges for ordinary snapshots I think we could have a `manage_snapshot` privilege. However, it should not snapshot access tokens from the `.security` index. And I would also not allow it to restore anything?\r\nThe action of restoring should be higher privileged, especially if the `.security` index is involved (at least `manage_security`). I don't like @joshbressers solution of a separate API dealing with the snapshoting of the `.security` index specifically, but given the present authz architecture I think it's the easiest way.\r\n\r\nOr, we could check indices permissions for read when snapshoting and indices permissions for write when restoring? I think that's the best way, but I think it's difficult to implement.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/434621169","html_url":"https://github.com/elastic/elasticsearch/issues/32562#issuecomment-434621169","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32562","id":434621169,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNDYyMTE2OQ==","user":{"login":"albertzaharovits","id":4568420,"node_id":"MDQ6VXNlcjQ1Njg0MjA=","avatar_url":"https://avatars2.githubusercontent.com/u/4568420?v=4","gravatar_id":"","url":"https://api.github.com/users/albertzaharovits","html_url":"https://github.com/albertzaharovits","followers_url":"https://api.github.com/users/albertzaharovits/followers","following_url":"https://api.github.com/users/albertzaharovits/following{/other_user}","gists_url":"https://api.github.com/users/albertzaharovits/gists{/gist_id}","starred_url":"https://api.github.com/users/albertzaharovits/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertzaharovits/subscriptions","organizations_url":"https://api.github.com/users/albertzaharovits/orgs","repos_url":"https://api.github.com/users/albertzaharovits/repos","events_url":"https://api.github.com/users/albertzaharovits/events{/privacy}","received_events_url":"https://api.github.com/users/albertzaharovits/received_events","type":"User","site_admin":false},"created_at":"2018-10-31T09:38:18Z","updated_at":"2018-10-31T09:38:18Z","author_association":"CONTRIBUTOR","body":"We had a meeting at EAH and we've put together a meta issue https://github.com/elastic/elasticsearch/issues/34454 with an action plan about the plan to implement this. That issue supersedes this one. Closing.","performed_via_github_app":null}]