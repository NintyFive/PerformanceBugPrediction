{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32951","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32951/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32951/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32951/events","html_url":"https://github.com/elastic/elasticsearch/issues/32951","id":351635675,"node_id":"MDU6SXNzdWUzNTE2MzU2NzU=","number":32951,"title":"SQL: ArrayIndexOutOfBoundsException: 0 when selecting wildcard and nested wildcard fields","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"labels":[{"id":912794284,"node_id":"MDU6TGFiZWw5MTI3OTQyODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Query%20Languages/SQL","name":":Query Languages/SQL","color":"0e8a16","default":false,"description":"SQL querying"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":962378555,"node_id":"MDU6TGFiZWw5NjIzNzg1NTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.5.0","name":"v6.5.0","color":"Dddddd","default":false,"description":""},{"id":1102494662,"node_id":"MDU6TGFiZWwxMTAyNDk0NjYy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.6.0","name":"v6.6.0","color":"dddddd","default":false,"description":""},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-08-17T15:19:15Z","updated_at":"2019-02-07T08:23:08Z","closed_at":"2018-10-30T13:52:06Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"For the following mapping:\r\n\r\n```\r\n    \"mappings\" : {\r\n      \"test\" : {\r\n        \"properties\" : {\r\n          \"simple\" : {\r\n            \"type\" : \"text\",\r\n            \"fields\" : {\r\n              \"keyword\" : {\r\n                \"type\" : \"keyword\",\r\n                \"ignore_above\" : 256\r\n              }\r\n            }\r\n          },\r\n          \"simple_nested\" : {\r\n            \"type\" : \"nested\",\r\n            \"properties\" : {\r\n              \"field2\" : {\r\n                \"type\" : \"text\",\r\n                \"fields\" : {\r\n                  \"keyword\" : {\r\n                    \"type\" : \"keyword\",\r\n                    \"ignore_above\" : 256\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n```\r\n\r\nand test data `{\"simple_nested\":{\"field2\":\"text5\"},\"simple\":\"text4\"}` the following exception is thrown when running `SELECT simple_nested.*, simple FROM test2`:\r\n\r\n```\r\nServer error [Server encountered an error [0]. [java.lang.ArrayIndexOutOfBoundsException: 0\r\n        at org.elasticsearch.xpack.sql.execution.search.SearchHitRowSet.getColumn(SearchHitRowSet.java:111)\r\n        at org.elasticsearch.xpack.sql.session.AbstractRowSet.column(AbstractRowSet.java:18)\r\n        at org.elasticsearch.xpack.sql.session.RowView.forEachColumn(RowView.java:38)\r\n        at org.elasticsearch.xpack.sql.plugin.TransportSqlQueryAction.lambda$createResponse$2(TransportSqlQueryAction.java:91)\r\n        at org.elasticsearch.xpack.sql.session.RowSet.forEachRow(RowSet.java:32)\r\n        at org.elasticsearch.xpack.sql.plugin.TransportSqlQueryAction.createResponse(TransportSqlQueryAction.java:89)\r\n        at org.elasticsearch.xpack.sql.plugin.TransportSqlQueryAction.createResponse(TransportSqlQueryAction.java:84)\r\n        at org.elasticsearch.xpack.sql.plugin.TransportSqlQueryAction.lambda$operation$0(TransportSqlQueryAction.java:66)\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n        at org.elasticsearch.xpack.sql.execution.search.Querier$ScrollActionListener.lambda$handleResponse$0(Querier.java:328)\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n        at org.elasticsearch.xpack.sql.execution.search.Querier$BaseActionListener.lambda$clear$3(Querier.java:432)\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n        at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:66)\r\n        at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:62)\r\n        at org.elasticsearch.action.search.ClearScrollController.onFreedContext(ClearScrollController.java:130)\r\n        at org.elasticsearch.action.search.ClearScrollController.lambda$cleanScrollIds$2(ClearScrollController.java:115)\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n        at org.elasticsearch.action.ActionListenerResponseHandler.handleResponse(ActionListenerResponseHandler.java:46)\r\n        at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleResponse(TransportService.java:1088)\r\n        at org.elasticsearch.transport.TransportService$DirectResponseChannel.processResponse(TransportService.java:1164)\r\n        at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1154)\r\n        at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:1143)\r\n        at org.elasticsearch.transport.TaskTransportChannel.sendResponse(TaskTransportChannel.java:54)\r\n        at org.elasticsearch.action.search.SearchTransportService.lambda$registerRequestHandler$1(SearchTransportService.java:316)\r\n        at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63)\r\n        at org.elasticsearch.transport.TransportService.sendLocalRequest(TransportService.java:689)\r\n        at org.elasticsearch.transport.TransportService.access$000(TransportService.java:76)\r\n        at org.elasticsearch.transport.TransportService$3.sendRequest(TransportService.java:134)\r\n        at org.elasticsearch.transport.TransportService.sendRequestInternal(TransportService.java:635)\r\n        at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:554)\r\n        at org.elasticsearch.action.search.SearchTransportService.sendFreeContext(SearchTransportService.java:110)\r\n        at org.elasticsearch.action.search.ClearScrollController.lambda$cleanScrollIds$4(ClearScrollController.java:114)\r\n        at org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n        at org.elasticsearch.action.search.SearchScrollAsyncAction.collectNodesAndRun(SearchScrollAsyncAction.java:129)\r\n        at org.elasticsearch.action.search.ClearScrollController.cleanScrollIds(ClearScrollController.java:105)\r\n        at org.elasticsearch.action.search.ClearScrollController.lambda$new$1(ClearScrollController.java:71)\r\n        at org.elasticsearch.action.search.ClearScrollController.run(ClearScrollController.java:80)\r\n        at org.elasticsearch.action.search.TransportClearScrollAction.doExecute(TransportClearScrollAction.java:49)\r\n        at org.elasticsearch.action.search.TransportClearScrollAction.doExecute(TransportClearScrollAction.java:31)\r\n        at org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:143)\r\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:119)\r\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:62)\r\n        at org.elasticsearch.client.node.NodeClient.executeLocally(NodeClient.java:83)\r\n        at org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:72)\r\n        at org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:400)\r\n        at org.elasticsearch.action.ActionRequestBuilder.execute(ActionRequestBuilder.java:70)\r\n        at org.elasticsearch.xpack.sql.execution.search.Querier$BaseActionListener.clear(Querier.java:430)\r\n        at org.elasticsearch.xpack.sql.execution.search.Querier$ScrollActionListener.handleResponse(Querier.java:327)\r\n        at org.elasticsearch.xpack.sql.execution.search.Querier$BaseActionListener.onResponse(Querier.java:405)\r\n        at org.elasticsearch.xpack.sql.execution.search.Querier$BaseActionListener.onResponse(Querier.java:381)\r\n        at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:66)\r\n        at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:62)\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.onResponse(AbstractSearchAsyncAction.java:313)\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.onResponse(AbstractSearchAsyncAction.java:50)\r\n        at org.elasticsearch.action.search.FetchSearchPhase$3.run(FetchSearchPhase.java:212)\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:160)\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:153)\r\n        at org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:119)\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:160)\r\n        at org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:153)\r\n        at org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:205)\r\n        at org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$2(FetchSearchPhase.java:104)\r\n        at org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:110)\r\n        at org.elasticsearch.action.search.FetchSearchPhase.access$000(FetchSearchPhase.java:44)\r\n        at org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:86)\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:723)\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n        at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41)\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n        at java.base/java.lang.Thread.run(Thread.java:844)\r\n```","closed_by":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"performed_via_github_app":null}