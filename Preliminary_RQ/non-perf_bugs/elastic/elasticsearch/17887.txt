{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17887","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17887/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17887/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17887/events","html_url":"https://github.com/elastic/elasticsearch/issues/17887","id":149736691,"node_id":"MDU6SXNzdWUxNDk3MzY2OTE=","number":17887,"title":"regression: cannot index dates with a year >= 10000","user":{"login":"drallax","id":14543491,"node_id":"MDQ6VXNlcjE0NTQzNDkx","avatar_url":"https://avatars1.githubusercontent.com/u/14543491?v=4","gravatar_id":"","url":"https://api.github.com/users/drallax","html_url":"https://github.com/drallax","followers_url":"https://api.github.com/users/drallax/followers","following_url":"https://api.github.com/users/drallax/following{/other_user}","gists_url":"https://api.github.com/users/drallax/gists{/gist_id}","starred_url":"https://api.github.com/users/drallax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drallax/subscriptions","organizations_url":"https://api.github.com/users/drallax/orgs","repos_url":"https://api.github.com/users/drallax/repos","events_url":"https://api.github.com/users/drallax/events{/privacy}","received_events_url":"https://api.github.com/users/drallax/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-04-20T11:04:20Z","updated_at":"2018-03-13T13:55:34Z","closed_at":"2018-03-13T13:55:34Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.1\n**JVM version**: JDK 7, JDK 8\n**OS version**: linux\n\n**Description of the problem including expected versus actual behavior**:\nwhen indexing a document with a date field and the date is after the year 10000,\nthe index operation fails with the following exception:\n\nMapperParsingException[failed to parse [document/datefield]]; nested: IllegalArgumentException[Invalid format: \"28910-05-16T19:52:39.000Z\" is malformed at \"0-05-16T19:52:39.000Z\"];\n\nThe error does not occur with ES 1.7.2 or earlier\n\n**Steps to reproduce**:\n1. use the java api\n2. assign a java.util.Date after the year 10,000 to a document's field of type \"date\"\n3. index the document\n\n**Cause**:\nI believe the issue is with StrictISODateTimeFormat, which seems to be an edited copy of joda's ISODateTimeFormat.\nas the following unit test demonstrates:\n\n```\n    @Test\n    public void testLargeDate() {\n        final DateTimeFormatter joda = StrictISODateTimeFormat.dateOptionalTimeParser();\n        assertEquals(9999, joda.parseLocalDate(\"9999-01-02T03:04:05\").year().get());\n        assertEquals(10000, joda.parseLocalDate(\"10000-01-02T03:04:05\").year().get()); //BROKEN\n    }\n```\n\nthe second assert fails with the same exception as when indexing a document with a date after the year 10,000.\nWhen using joda's ISODateTimeFormat instead of ES's StrictISODateTimeFormat, the test works correctly.\n\n**Provide logs (if relevant)**:\nMapperParsingException[failed to parse [document/datefield]]; nested: IllegalArgumentException[Invalid format: \"28910-05-16T19:52:39.000Z\" is malformed at \"0-05-16T19:52:39.000Z\"];\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}