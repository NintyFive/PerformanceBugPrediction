[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59605604","html_url":"https://github.com/elastic/elasticsearch/issues/8149#issuecomment-59605604","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8149","id":59605604,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NjA1NjA0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-18T09:55:36Z","updated_at":"2014-10-18T09:55:36Z","author_association":"CONTRIBUTOR","body":"@ppf2 The `total_shards..` options scare me a bit because they are a hard limit, and can make it impossible to assign shards.\n\nIt seems like the `cluster.routing.allocation.balance.primary` setting _should_  do what you are after, but perhaps the value needs some tuning. Could you give more detail about why this particular option doesn't work well enough?\n\nI'd prefer to keep the number of options small, as the more you add, the more difficult it is to reason about the outcome.  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59814621","html_url":"https://github.com/elastic/elasticsearch/issues/8149#issuecomment-59814621","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8149","id":59814621,"node_id":"MDEyOklzc3VlQ29tbWVudDU5ODE0NjIx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-20T18:18:32Z","updated_at":"2014-10-20T18:18:32Z","author_association":"CONTRIBUTOR","body":"@ppf2 so it looks like `balance.primary` tries to balance ALL primary shards, rather than just the primary shards within each index.  I've also seen problems where I add a new node, and it receives mostly replicas.\n\nSo there is no doubt that this heuristic needs improvement.  But the `total*` setting is a blunt weapon, and, like most weapons, can harm the person who wields it.\n\nPart of the problem is that the rebalancing algorithm is a bit of a black box.  I've opened https://github.com/elasticsearch/elasticsearch/issues/8170 to see if we can improve that situation.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59855090","html_url":"https://github.com/elastic/elasticsearch/issues/8149#issuecomment-59855090","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8149","id":59855090,"node_id":"MDEyOklzc3VlQ29tbWVudDU5ODU1MDkw","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"created_at":"2014-10-20T23:11:20Z","updated_at":"2014-10-20T23:11:20Z","author_association":"MEMBER","body":"Thanks @clintongormley.  Agree that total\\* setting if not used properly can cause primary shards not to be fully allocated.  Would be nice to provide some way (not necessarily the total\\* setting) in the future to balance primary shards per index per node, something that's more automatic without having to manually reroute/move the shards around.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59913040","html_url":"https://github.com/elastic/elasticsearch/issues/8149#issuecomment-59913040","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8149","id":59913040,"node_id":"MDEyOklzc3VlQ29tbWVudDU5OTEzMDQw","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2014-10-21T11:21:21Z","updated_at":"2014-10-21T11:21:21Z","author_association":"CONTRIBUTOR","body":"There are several reasons why I think we need to solve this problem differently. The problem here is really not the balance function or anything in that code it's the fact that updates put extra pressure on the primary shard and therefore don't scale very well. I am against a setting like this because it can bring your cluster in a very bad state where it can potentially not allocate a primary at all, or we need to move a shard from one node to another to make space for a primary which is the wrong thing to do. \n\nBeing a primary is only a boolean flag really and flipping it in order to make another healthy replica a primary should be simple and IMO is the way to go. It might be part of the balancing algorithm but not via an allocation decider or anything along those lines. The problem here is really the update feature and not the balancing algorithm.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62031343","html_url":"https://github.com/elastic/elasticsearch/issues/8149#issuecomment-62031343","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8149","id":62031343,"node_id":"MDEyOklzc3VlQ29tbWVudDYyMDMxMzQz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-06T18:58:13Z","updated_at":"2014-11-06T18:58:13Z","author_association":"CONTRIBUTOR","body":"See #8369\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/75212409","html_url":"https://github.com/elastic/elasticsearch/issues/8149#issuecomment-75212409","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8149","id":75212409,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MjEyNDA5","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-02-20T09:43:59Z","updated_at":"2015-02-20T09:43:59Z","author_association":"CONTRIBUTOR","body":"removing the discuss tag since we are all on the same page here and we have #8369\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158677566","html_url":"https://github.com/elastic/elasticsearch/issues/8149#issuecomment-158677566","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8149","id":158677566,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODY3NzU2Ng==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-21T19:55:16Z","updated_at":"2015-11-21T19:55:16Z","author_association":"CONTRIBUTOR","body":"Closing in favour of #8369\n","performed_via_github_app":null}]