{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/26272","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26272/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26272/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26272/events","html_url":"https://github.com/elastic/elasticsearch/issues/26272","id":251164059,"node_id":"MDU6SXNzdWUyNTExNjQwNTk=","number":26272,"title":"Bitwise operator 4&7 !=0 returns 0 but must be 1.","user":{"login":"gr3ysky","id":1905019,"node_id":"MDQ6VXNlcjE5MDUwMTk=","avatar_url":"https://avatars1.githubusercontent.com/u/1905019?v=4","gravatar_id":"","url":"https://api.github.com/users/gr3ysky","html_url":"https://github.com/gr3ysky","followers_url":"https://api.github.com/users/gr3ysky/followers","following_url":"https://api.github.com/users/gr3ysky/following{/other_user}","gists_url":"https://api.github.com/users/gr3ysky/gists{/gist_id}","starred_url":"https://api.github.com/users/gr3ysky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gr3ysky/subscriptions","organizations_url":"https://api.github.com/users/gr3ysky/orgs","repos_url":"https://api.github.com/users/gr3ysky/repos","events_url":"https://api.github.com/users/gr3ysky/events{/privacy}","received_events_url":"https://api.github.com/users/gr3ysky/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-08-18T07:37:28Z","updated_at":"2018-02-14T13:20:57Z","closed_at":"2017-08-18T14:31:07Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch version: 5.0.2\r\nOS version:Linux\r\nI have a document containing a field productId with value 7\r\nHere is the doc\r\n```\r\n{\r\n    \"took\": 1,\r\n    \"timed_out\": false,\r\n    \"_shards\": {\r\n        \"total\": 5,\r\n        \"successful\": 5,\r\n        \"failed\": 0\r\n    },\r\n    \"hits\": {\r\n        \"total\": 1,\r\n        \"max_score\": 1,\r\n        \"hits\": [\r\n            {\r\n                \"_index\": \"smartex\",\r\n                \"_type\": \"product_trend_report_data\",\r\n                \"_id\": \"5d32ccc9-e085-49ee-b6bd-5eb1c2b9da69\",\r\n                \"_score\": 1,\r\n                \"_source\": {\r\n                    \"reportType\": 3,\r\n                    \"shiftId\": 1,\r\n                    \"tenantId\": 2,\r\n                    \"locationId\": 267,\r\n                    \"expressionId\": 1,\r\n                    \"variableId\": 1,\r\n                    \"variableType\": 3,\r\n                    \"reportPeriod\": 5,\r\n                    \"creationTime\": \"2017-08-12T00:00:00\",\r\n                    \"reportValue\": \"80\",\r\n                    \"persistTime\": \"2017-08-18T07:19:10.3192712Z\",\r\n                    \"id\": \"5d32ccc9-e085-49ee-b6bd-5eb1c2b9da69\",\r\n                    **\"productId\": 7,**\r\n                    \"serialNo\": \"\"\r\n                }\r\n            }\r\n        ]\r\n    }\r\n}\r\n```\r\n\r\nFor the query \r\n```\r\n{\r\n\t\"script_fields\" : {\r\n        \"test\" : {\r\n            \"script\" : {\r\n                \"lang\": \"expression\",\r\n                \"inline\": \"pids & doc['productId'].value\", \r\n                \"params\": {\r\n                \t\"pids\": 4\r\n              }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\nI get \r\n```\r\n{\r\n    \"took\": 3,\r\n    \"timed_out\": false,\r\n    \"_shards\": {\r\n        \"total\": 5,\r\n        \"successful\": 5,\r\n        \"failed\": 0\r\n    },\r\n    \"hits\": {\r\n        \"total\": 1,\r\n        \"max_score\": 1,\r\n        \"hits\": [\r\n            {\r\n                \"_index\": \"smartex\",\r\n                \"_type\": \"product_trend_report_data\",\r\n                \"_id\": \"5d32ccc9-e085-49ee-b6bd-5eb1c2b9da69\",\r\n                \"_score\": 1,\r\n                \"fields\": {\r\n                    \"test\": [\r\n                        **4**\r\n                    ]\r\n                }\r\n            }\r\n        ]\r\n    }\r\n}\r\n```\r\nwhich is correct.\r\nBut when I use !=0 operator \r\n```\r\n{\r\n\t\"script_fields\" : {\r\n        \"test\" : {\r\n            \"script\" : {\r\n                \"lang\": \"expression\",\r\n                \"inline\": \"**pids & doc['productId'].value!=0**\", \r\n                \"params\": {\r\n                \t\"pids\": 4\r\n              }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\nI get \r\n\r\n```\r\n{\r\n    \"took\": 3,\r\n    \"timed_out\": false,\r\n    \"_shards\": {\r\n        \"total\": 5,\r\n        \"successful\": 5,\r\n        \"failed\": 0\r\n    },\r\n    \"hits\": {\r\n        \"total\": 1,\r\n        \"max_score\": 1,\r\n        \"hits\": [\r\n            {\r\n                \"_index\": \"smartex\",\r\n                \"_type\": \"product_trend_report_data\",\r\n                \"_id\": \"5d32ccc9-e085-49ee-b6bd-5eb1c2b9da69\",\r\n                \"_score\": 1,\r\n                \"fields\": {\r\n                    **\"test\": [\r\n                        0\r\n                    ]**\r\n                }\r\n            }\r\n        ]\r\n    }\r\n}\r\n```\r\n0 on the test field but it must be 1\r\n\r\nCan u patch this please. Thanks\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"performed_via_github_app":null}