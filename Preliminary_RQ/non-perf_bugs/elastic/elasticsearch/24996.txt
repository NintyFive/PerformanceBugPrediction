{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24996","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24996/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24996/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24996/events","html_url":"https://github.com/elastic/elasticsearch/issues/24996","id":232769172,"node_id":"MDU6SXNzdWUyMzI3NjkxNzI=","number":24996,"title":"A budge in ES hightlight about keyword \"before\"","user":{"login":"liuguangmin","id":3112623,"node_id":"MDQ6VXNlcjMxMTI2MjM=","avatar_url":"https://avatars3.githubusercontent.com/u/3112623?v=4","gravatar_id":"","url":"https://api.github.com/users/liuguangmin","html_url":"https://github.com/liuguangmin","followers_url":"https://api.github.com/users/liuguangmin/followers","following_url":"https://api.github.com/users/liuguangmin/following{/other_user}","gists_url":"https://api.github.com/users/liuguangmin/gists{/gist_id}","starred_url":"https://api.github.com/users/liuguangmin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/liuguangmin/subscriptions","organizations_url":"https://api.github.com/users/liuguangmin/orgs","repos_url":"https://api.github.com/users/liuguangmin/repos","events_url":"https://api.github.com/users/liuguangmin/events{/privacy}","received_events_url":"https://api.github.com/users/liuguangmin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-06-01T05:25:19Z","updated_at":"2017-06-01T10:11:23Z","closed_at":"2017-06-01T10:11:23Z","author_association":"NONE","active_lock_reason":null,"body":"ES：5.3.0\r\nOS：Linux\r\njava：jdk1.8\r\n #**my mapping is below:**\r\n============my mappings =============\r\n{\r\n  \"zhongxing2\": {\r\n    \"mappings\": {\r\n      \"zhongxing2\": {\r\n        \"_all\": {\r\n          \"enabled\": false\r\n        },\r\n        \"properties\": {\r\n          \"itemid\": {\r\n            \"type\": \"keyword\",\r\n            \"store\": true\r\n          },\r\n          \"OriginalLog\": {\r\n            \"type\": \"text\",\r\n            \"store\": true,\r\n            \"term_vector\": \"with_positions_offsets\",\r\n            \"norms\": false,\r\n            \"index_options\": \"offsets\",\r\n            \"copy_to\": [\r\n              \"OriginalLog_regex\"\r\n            ],\r\n            \"analyzer\": \"log_analyzer\"\r\n          },\r\n          \"OriginalLog_regex\": {\r\n            \"type\": \"text\",\r\n            \"term_vector\": \"with_positions_offsets\",\r\n            \"norms\": false,\r\n            \"index_options\": \"offsets\",\r\n            \"analyzer\": \"log_regex_analyzer\"\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"settings\": {\r\n      \"index\": {\r\n        \"analysis\": {\r\n          \"analyzer\": {\r\n            \"log_analyzer\": {\r\n              \"filter\": [\r\n                \"synonym\",\r\n                \"lowercase\",\r\n                \"log_snow\"\r\n              ],\r\n              \"type\": \"custom\",\r\n              \"tokenizer\": \"log_tokenizer\"\r\n            },\r\n            \"log_regex_analyzer\": {\r\n              \"filter\": [\r\n                \"lowercase\"\r\n              ],\r\n              \"type\": \"custom\",\r\n              \"tokenizer\": \"log_tokenizer\"\r\n            }\r\n          },\r\n          \"tokenizer\": {\r\n            \"log_tokenizer\": {\r\n              \"pattern\": \"(?=\\\\W)[^-]\",\r\n              \"type\": \"pattern\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n========= ===      ================\r\n**I insert  6 item as below** \r\n===========doc========\r\n(1) curl -i -X POST -H \"'Content-type':'application/json', 'charset':'utf-8', 'Accept': 'text/plain'\" -d 'json_data={\"appname\":\"zhongxing2\",\"log_list\":[{\"itemid\":\"1885469469509\",\"is_online\":\"1\",\"detail\":\"I have a dream\",\"OriginalLog\":\"017-05-25T14:12:35Z ERROR ops.eps.trans system test in logsearch pythonjava after and search engin\"},{\"itemid\":\"1885469469510\",\"is_online\":\"1\",\"detail\":\"I have two dream\",\"OriginalLog\":\"before before before before\"}],\"request_id\":\"2222\"}' http://123.56.120.196:9449/logpush/zte_log\r\n\r\n(2) curl -i -X POST -H \"'Content-type':'application/json', 'charset':'utf-8', 'Accept': 'text/plain'\" -d 'json_data={\"appname\":\"zhongxing2\",\"log_list\":[{\"itemid\":\"1885469469507\",\"is_online\":\"1\",\"detail\":\"I have a dream\",\"OriginalLog\":\"017-05-25T14:12:35Z ERROR ops.eps.trans system test in logsearch gogogo after and search engin\"},{\"itemid\":\"1885469469508\",\"is_online\":\"1\",\"detail\":\"I have two dream\",\"OriginalLog\":\"before before before before\"}],\"request_id\":\"3333\"}' http://123.56.120.196:9449/logpush/zte_log\r\n\r\n(3) curl -i -X POST -H \"'Content-type':'application/json', 'charset':'utf-8', 'Accept': 'text/plain'\" -d 'json_data={\"appname\":\"zhongxing2\",\"log_list\":[{\"itemid\":\"1885469469505\",\"is_online\":\"1\",\"detail\":\"I have a dream\",\"OriginalLog\":\"017-05-25T14:12:35Z ERROR ops.eps.trans system test in logsearch before after and search engin\"},{\"itemid\":\"1885469469506\",\"is_online\":\"1\",\"detail\":\"I have two dream\",\"OriginalLog\":\"before before before before\"}],\"request_id\":\"3333\"}' http://123.56.120.196:9449/logpush/zte_log\r\n============= ==== ====\r\n# when I use the query as follow \r\n========my query:===========\r\nGET zhongxing2/_search\r\n{\r\n  \"highlight\": {\r\n    \"pre_tags\": \"<font color=red>\",\r\n    \"fields\": {\r\n      \"OriginalLog\": {\r\n        \"number_of_fragments\": 0,\r\n        \"no_match_size\": 150,\r\n        \"require_field_match\": false,\r\n        \"fragment_size\": 150\r\n      }\r\n    },\r\n    \"post_tags\": \"</font>\"\r\n  },\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [],\r\n      \"should\": [],\r\n      \"must_not\": [],\r\n      \"must\": [\r\n        {\r\n          \"query_string\": {\r\n            \"query\": \"OriginalLog_regex:pythonjava\",\r\n            \"default_operator\": \"AND\"\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  \"from\": 0,\r\n  \"size\": 20\r\n}\r\nthe result is \r\n\"highlight\": {\r\n          \"OriginalLog\": [\r\n            \"017-05-25T14:12:35Z ERROR ops.eps.trans system test in logsearch <color=red>pythonjava<red> after and search engin\"\r\n          ]\r\n        }\r\nthe pythonjava is highlight  is # <color=red>pythonjava<red> ,because if i use the highlight symbol,the color is disappear ,so i use the <color=red><red> instand \r\n========= ======\r\n#but when I use the follow query \r\nGET zhongxing2/_search\r\n{\r\n  \"highlight\": {\r\n    \"pre_tags\": \"<font color=red>\",\r\n    \"fields\": {\r\n      \"OriginalLog\": {\r\n        \"number_of_fragments\": 0,\r\n        \"no_match_size\": 150,\r\n        \"require_field_match\": false,\r\n        \"fragment_size\": 150\r\n      }\r\n    },\r\n    \"post_tags\": \"</font>\"\r\n  },\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [],\r\n      \"should\": [],\r\n      \"must_not\": [],\r\n      \"must\": [\r\n        {\r\n          \"query_string\": {\r\n            \"query\": \"OriginalLog_regex:before\",\r\n            \"default_operator\": \"AND\"\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  \"from\": 0,\r\n  \"size\": 20\r\n}\r\n\r\nthe result is \r\n        \"highlight\": {\r\n          \"OriginalLog\": [\r\n            \"before before before before\"\r\n          ]\r\n        }\r\n \"highlight\": {\r\n          \"OriginalLog\": [\r\n            \"017-05-25T14:12:35Z ERROR ops.eps.trans system test in logsearch before after and search engin\"\r\n          ]\r\n        }\r\n\r\nwhat's more I have try many times ,but the \"before\" is not hightlight ?\r\nso I wonder the before is a keyword in es or maybe this a big budge in ES ?\r\n I very puzzled\r\n\r\n\r\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}