{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44557","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44557/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44557/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44557/events","html_url":"https://github.com/elastic/elasticsearch/issues/44557","id":469720510,"node_id":"MDU6SXNzdWU0Njk3MjA1MTA=","number":44557,"title":"[ML] Data frame progress is not reporting for continuous","user":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":1434538947,"node_id":"MDU6TGFiZWwxNDM0NTM4OTQ3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.4.0","name":"v7.4.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"assignees":[{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-07-18T11:38:04Z","updated_at":"2019-08-14T16:22:40Z","closed_at":"2019-08-14T16:22:40Z","author_association":"NONE","active_lock_reason":null,"body":"Found in 7.3.0-SNAPSHOT `{\r\n  \"build\" : {\r\n    \"hash\" : \"a57a5c5\",\r\n    \"date\" : \"2019-07-16T14:52:05.956252Z\"\r\n  },`\r\n\r\nCheckpoint progress is not being updated for checkpoints 1 and above, presumably since the introduction of page-by-page processing to avoid terms explosion. Progress is reported and updated for checkpoint 0.\r\n\r\nThis is related to https://github.com/elastic/elasticsearch/issues/43767. We may wish to revisit how we can show indicative checkpoint progress for continuous data frames. For example, 20% progress at page 2 of 10 could be a good enough indicator.\r\n\r\nIn debug logging you can see the following\r\n\r\n```\r\n[2019-07-18T11:03:33,859][DEBUG][o.e.x.c.i.AsyncTwoPhaseIndexer] [node1] Beginning to index [df01], state: [STARTED]\r\n[2019-07-18T11:03:34,944][DEBUG][o.e.x.d.c.DataFrameTransformsCheckpointService] [node1] Failed to retrieve source checkpoint for data frame [df01]\r\n[2019-07-18T11:03:35,556][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"2.124.127.204\"},\"bucket_position\":{\"clientip\":\"2.122.228.0\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":15692,\"percent_complete\":50.9625}}]\r\n[2019-07-18T11:03:40,741][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"31.51.217.58\"},\"bucket_position\":{\"clientip\":\"31.49.140.121\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:03:46,353][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"49.212.153.96\"},\"bucket_position\":{\"clientip\":\"46.252.71.2\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:03:51,018][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"64.246.178.34\"},\"bucket_position\":{\"clientip\":\"64.246.161.190\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:03:55,571][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"70.63.164.253\"},\"bucket_position\":{\"clientip\":\"70.29.234.38\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:03:59,916][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"80.128.104.91\"},\"bucket_position\":{\"clientip\":\"80.87.25.79\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:04:03,630][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"82.145.209.89\"},\"bucket_position\":{\"clientip\":\"82.132.245.233\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:04:06,957][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"86.161.217.16\"},\"bucket_position\":{\"clientip\":\"86.161.54.214\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:04:10,428][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"91.192.111.141\"},\"bucket_position\":{\"clientip\":\"91.125.129.31\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:04:14,504][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"101.226.168.240\"},\"bucket_position\":{\"clientip\":\"101.226.166.216\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:04:17,897][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"157.55.34.107\"},\"bucket_position\":{\"clientip\":\"157.55.33.249\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:04:21,134][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Updating persistent state of transform [df01] to [{\"task_state\":\"started\",\"indexer_state\":\"indexing\",\"position\":{\"indexer_position\":{\"clientip\":\"188.29.164.205\"},\"bucket_position\":{\"clientip\":\"188.29.37.197\"}},\"checkpoint\":5,\"progress\":{\"total_docs\":32000,\"docs_remaining\":0,\"percent_complete\":100.0}}]\r\n[2019-07-18T11:04:23,961][DEBUG][o.e.x.c.i.AsyncTwoPhaseIndexer] [node1] Finished indexing for job [df01], saving state and shutting down.\r\n[2019-07-18T11:04:23,961][DEBUG][o.e.x.d.t.DataFrameTransformTask] [node1] Finished indexing for data frame transform [df01] checkpoint [5]\r\n```","closed_by":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"performed_via_github_app":null}