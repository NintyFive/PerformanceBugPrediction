[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320085307","html_url":"https://github.com/elastic/elasticsearch/issues/26048#issuecomment-320085307","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26048","id":320085307,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDA4NTMwNw==","user":{"login":"tsayao","id":30704286,"node_id":"MDQ6VXNlcjMwNzA0Mjg2","avatar_url":"https://avatars3.githubusercontent.com/u/30704286?v=4","gravatar_id":"","url":"https://api.github.com/users/tsayao","html_url":"https://github.com/tsayao","followers_url":"https://api.github.com/users/tsayao/followers","following_url":"https://api.github.com/users/tsayao/following{/other_user}","gists_url":"https://api.github.com/users/tsayao/gists{/gist_id}","starred_url":"https://api.github.com/users/tsayao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsayao/subscriptions","organizations_url":"https://api.github.com/users/tsayao/orgs","repos_url":"https://api.github.com/users/tsayao/repos","events_url":"https://api.github.com/users/tsayao/events{/privacy}","received_events_url":"https://api.github.com/users/tsayao/received_events","type":"User","site_admin":false},"created_at":"2017-08-03T20:46:20Z","updated_at":"2017-08-03T20:46:20Z","author_association":"NONE","body":"Tested with TransportClient 5.0.2 and the leak does not happen.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320139621","html_url":"https://github.com/elastic/elasticsearch/issues/26048#issuecomment-320139621","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26048","id":320139621,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDEzOTYyMQ==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T02:26:50Z","updated_at":"2017-08-04T02:26:50Z","author_association":"CONTRIBUTOR","body":"I was able to reproduce this in \r\n\r\n* 5.5.1\r\n* 5.4.3\r\n* 5.3.3\r\n* 5.2.2\r\n* 5.1.2\r\n\r\nin these versions after the client is closed, these byte arrays make up >90% of the heap and survive gc prompts from visualvm\r\n\r\n<img width=\"1331\" alt=\"memory-5 5 1\" src=\"https://user-images.githubusercontent.com/29205940/28951338-2815ec4a-787f-11e7-9646-1c891bc6cd87.png\">\r\n\r\n[The test program I used and the log from a run on 5.1.2](https://gist.github.com/andy-elastic/7164017fec607e800893a434c683fd49)\r\n\r\nVersions 5.0.2 and 5.1.1 don't appear to have this behavior; in these versions byte arrays make up about 50% of heap after the client is closed, but almost all of that is released after gc prompt from visualvm","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320140242","html_url":"https://github.com/elastic/elasticsearch/issues/26048#issuecomment-320140242","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26048","id":320140242,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDE0MDI0Mg==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T02:31:52Z","updated_at":"2017-08-04T02:31:52Z","author_association":"CONTRIBUTOR","body":"[Log from 5.1.2 with ](https://gist.github.com/andy-elastic/870a7f9b6356a94e86716b3d038ecf18) `-Dio.netty.leakDetection.level=advanced`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320141227","html_url":"https://github.com/elastic/elasticsearch/issues/26048#issuecomment-320141227","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26048","id":320141227,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDE0MTIyNw==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T02:39:40Z","updated_at":"2017-08-04T02:39:40Z","author_association":"CONTRIBUTOR","body":"I'll assign this to @jasontedor as I see him on similar issues","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320247156","html_url":"https://github.com/elastic/elasticsearch/issues/26048#issuecomment-320247156","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26048","id":320247156,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDI0NzE1Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T13:20:56Z","updated_at":"2017-08-04T13:21:52Z","author_association":"MEMBER","body":"It's not a leak per se, it's from the pooled allocator which would be shared across transport client instances that you create and not removed when you close a transport client instance. You can either disable the pooled allocator (start the JVM with the system property `io.netty.allocator.type` set to `unpooled`), or if you want to continue using the pooled allocator, you could look into tuning it for your use case.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320251931","html_url":"https://github.com/elastic/elasticsearch/issues/26048#issuecomment-320251931","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26048","id":320251931,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDI1MTkzMQ==","user":{"login":"tsayao","id":30704286,"node_id":"MDQ6VXNlcjMwNzA0Mjg2","avatar_url":"https://avatars3.githubusercontent.com/u/30704286?v=4","gravatar_id":"","url":"https://api.github.com/users/tsayao","html_url":"https://github.com/tsayao","followers_url":"https://api.github.com/users/tsayao/followers","following_url":"https://api.github.com/users/tsayao/following{/other_user}","gists_url":"https://api.github.com/users/tsayao/gists{/gist_id}","starred_url":"https://api.github.com/users/tsayao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsayao/subscriptions","organizations_url":"https://api.github.com/users/tsayao/orgs","repos_url":"https://api.github.com/users/tsayao/repos","events_url":"https://api.github.com/users/tsayao/events{/privacy}","received_events_url":"https://api.github.com/users/tsayao/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T13:41:36Z","updated_at":"2017-08-04T13:41:36Z","author_association":"NONE","body":"Thanks jason, that did the trick.\r\n\r\nI suggest to mention it on the documentation, as for my case the client is not running on a server, it's running on a desktop application running with JavaFX, so taking 100+ mb of memory is not optimal.\r\n\r\nAlso, it's only one user per machine, so sharing instances will never happen.\r\n\r\nThanks.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/320257619","html_url":"https://github.com/elastic/elasticsearch/issues/26048#issuecomment-320257619","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26048","id":320257619,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMDI1NzYxOQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-08-04T14:04:50Z","updated_at":"2017-08-04T14:04:50Z","author_association":"MEMBER","body":"You're welcome, sorry that you ran into the trouble.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/327461709","html_url":"https://github.com/elastic/elasticsearch/issues/26048#issuecomment-327461709","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26048","id":327461709,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNzQ2MTcwOQ==","user":{"login":"gaurav36","id":6826559,"node_id":"MDQ6VXNlcjY4MjY1NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6826559?v=4","gravatar_id":"","url":"https://api.github.com/users/gaurav36","html_url":"https://github.com/gaurav36","followers_url":"https://api.github.com/users/gaurav36/followers","following_url":"https://api.github.com/users/gaurav36/following{/other_user}","gists_url":"https://api.github.com/users/gaurav36/gists{/gist_id}","starred_url":"https://api.github.com/users/gaurav36/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaurav36/subscriptions","organizations_url":"https://api.github.com/users/gaurav36/orgs","repos_url":"https://api.github.com/users/gaurav36/repos","events_url":"https://api.github.com/users/gaurav36/events{/privacy}","received_events_url":"https://api.github.com/users/gaurav36/received_events","type":"User","site_admin":false},"created_at":"2017-09-06T12:01:06Z","updated_at":"2017-09-06T12:03:27Z","author_association":"NONE","body":"I am still getting memory leak when i upload large number of files, This time memory leak in java rest client.\r\n\r\nI also used @jasontedor  suggestion  io.netty.allocator.type set to unpooled but still getting memory leak.\r\n\r\nfor more info:  https://discuss.elastic.co/t/memory-leak-in-elasticsearch-java-rest-client-version-5-5/99551","performed_via_github_app":null}]