[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/506822838","html_url":"https://github.com/elastic/elasticsearch/issues/43767#issuecomment-506822838","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767","id":506822838,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjgyMjgzOA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-06-28T17:52:30Z","updated_at":"2019-06-28T17:52:30Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508461360","html_url":"https://github.com/elastic/elasticsearch/issues/43767#issuecomment-508461360","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767","id":508461360,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODQ2MTM2MA==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T12:15:51Z","updated_at":"2019-07-04T12:15:51Z","author_association":"CONTRIBUTOR","body":"We discussed the format and came up with the following new design:\r\n\r\n```\r\n{\r\n  \"count\": 1,\r\n  \"transforms\": [ {\r\n      \"id\": \"sycn1844\",\r\n       # removed the state object \r\n      \"task_state\": \"started\",\r\n      \"node\" : {\r\n          \"id\" : \"zMfxBopWSkOIdU0EVdIYVg\",\r\n          \"name\" : \"xyz\",\r\n          \"ephemeral_id\" : \"BijLWKBHQ-iIWH5sFlvLzA\",\r\n          \"transport_address\" : \"127.0.0.1:9300\",\r\n          \"attributes\" : { }\r\n        },\r\n      \"stats\": {\r\n          \"pages_processed\": 559,\r\n          \"documents_processed\": 4207753,\r\n          \"documents_indexed\": 278783,\r\n          \"trigger_count\": 2,\r\n          \"index_time_in_ms\": 14467,\r\n          \"index_total\": 558,\r\n          \"index_failures\": 0,\r\n          \"search_time_in_ms\": 284161,\r\n          \"search_total\": 559,\r\n          \"search_failures\": 0\r\n      },\r\n      \"checkpointing\": {\r\n          # renamed current -> “last”\r\n          # renamed in_progress -> “next”\r\n          \"last\": {\r\n              # moving the checkpoint here so it’s better understood\r\n              \"checkpoint\": 100,\r\n              \"timestamp\": \"2019-06-28T16:44:12.497Z\",\r\n              \"timestamp_millis\": 1561740252497,\r\n              \"time_upper_bound\": \"2019-06-28T16:43:12.497Z\",\r\n              \"time_upper_bound_millis\": 1561740192497\r\n          },\r\n          \"next\": {\r\n              # not surprising what the next cp is, but users hopefully better \r\n              # understand the concept of checkpointing\r\n              \"checkpoint\": 101,\r\n              # moved indexer state here\r\n              \"indexer_state\": \"indexing\",\r\n              \"current_position\": {\r\n                  \"hashtag\": \"abcd1234\"\r\n              },\r\n              # progress is only about the next checkpoint\r\n              \"checkpoint_progress\": {\r\n                  \"total_docs\": 1900883,\r\n                  \"docs_remaining\": 1722762,\r\n                  \"percent_complete\": 9.370434687458408\r\n              },\r\n              \"timestamp\": \"2019-06-28T16:50:29.172Z\",\r\n              \"timestamp_millis\": 1561740629172,\r\n              \"time_upper_bound\": \"2019-06-28T16:49:29.172Z\",\r\n              \"time_upper_bound_millis\": 1561740569172\r\n          },\r\n          \"operations_behind\": 27000\r\n      }\r\n    }\r\n  ]\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508552450","html_url":"https://github.com/elastic/elasticsearch/issues/43767#issuecomment-508552450","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767","id":508552450,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODU1MjQ1MA==","user":{"login":"sophiec20","id":4185750,"node_id":"MDQ6VXNlcjQxODU3NTA=","avatar_url":"https://avatars2.githubusercontent.com/u/4185750?v=4","gravatar_id":"","url":"https://api.github.com/users/sophiec20","html_url":"https://github.com/sophiec20","followers_url":"https://api.github.com/users/sophiec20/followers","following_url":"https://api.github.com/users/sophiec20/following{/other_user}","gists_url":"https://api.github.com/users/sophiec20/gists{/gist_id}","starred_url":"https://api.github.com/users/sophiec20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sophiec20/subscriptions","organizations_url":"https://api.github.com/users/sophiec20/orgs","repos_url":"https://api.github.com/users/sophiec20/repos","events_url":"https://api.github.com/users/sophiec20/events{/privacy}","received_events_url":"https://api.github.com/users/sophiec20/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T18:21:01Z","updated_at":"2019-07-04T18:21:01Z","author_association":"NONE","body":"https://github.com/elastic/kibana/issues/40378 Note that if we want to show progress to the user in the UI, then `checkpointing.last.time_upper_bound` should always be present and not just whilst `\"indexer_state\": \"indexing\"` (with possible exception for checkpoint zero). ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/512838677","html_url":"https://github.com/elastic/elasticsearch/issues/43767#issuecomment-512838677","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767","id":512838677,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjgzODY3Nw==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-07-18T14:25:25Z","updated_at":"2019-07-18T14:37:15Z","author_association":"CONTRIBUTOR","body":"> `# progress is only about the next checkpoint`\r\n\r\nThis turns out to be quite a far-reaching change.  For checkpoints that are processed quickly it means that progress is only available for a very short time before that \"next\" checkpoint is completed and moves to \"last\".\r\n\r\nOne effect is that integration tests cannot really assert on progress any more, because depending on OS scheduling there might not be any progress field in the stats by the time the test asks for it - search for `TODO progress is now checkpoint progress and it may be that no checkpoint is in progress here` in [the 8th commit](https://github.com/elastic/elasticsearch/pull/44350/commits/c6e35f200169cf5c507d33ca950696e325824a38) of #44350 to see the effect on our tests.  Given that there is a need to change progress again due to #44557 I'm inclined to leave these `TODO`s in #44350 and they can be revisited in the fix for #44557.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/512889870","html_url":"https://github.com/elastic/elasticsearch/issues/43767#issuecomment-512889870","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43767","id":512889870,"node_id":"MDEyOklzc3VlQ29tbWVudDUxMjg4OTg3MA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-07-18T16:28:49Z","updated_at":"2019-07-18T16:28:49Z","author_association":"CONTRIBUTOR","body":"> `# moved indexer state here`\r\n\r\nIn terms of test assertions this also suffers from the problem mentioned in the previous comment of:\r\n\r\n> checkpoints that are processed quickly\r\n\r\nIn [the 10th commit](https://github.com/elastic/elasticsearch/pull/44350/commits/9b96fca762bda1b9c42ebe451efde5efc39804f8) of #44350 I had to remove all the YAML test assertions on `indexer_state` for this reason.","performed_via_github_app":null}]