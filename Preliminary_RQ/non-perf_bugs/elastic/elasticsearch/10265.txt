{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10265","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10265/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10265/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10265/events","html_url":"https://github.com/elastic/elasticsearch/issues/10265","id":64294337,"node_id":"MDU6SXNzdWU2NDI5NDMzNw==","number":10265,"title":"_ttl calculation appears to be incorrect when _timestamp extracted from external value via path","user":{"login":"nellicus","id":8770097,"node_id":"MDQ6VXNlcjg3NzAwOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/8770097?v=4","gravatar_id":"","url":"https://api.github.com/users/nellicus","html_url":"https://github.com/nellicus","followers_url":"https://api.github.com/users/nellicus/followers","following_url":"https://api.github.com/users/nellicus/following{/other_user}","gists_url":"https://api.github.com/users/nellicus/gists{/gist_id}","starred_url":"https://api.github.com/users/nellicus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nellicus/subscriptions","organizations_url":"https://api.github.com/users/nellicus/orgs","repos_url":"https://api.github.com/users/nellicus/repos","events_url":"https://api.github.com/users/nellicus/events{/privacy}","received_events_url":"https://api.github.com/users/nellicus/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-03-25T15:10:49Z","updated_at":"2015-03-25T15:56:06Z","closed_at":"2015-03-25T15:56:06Z","author_association":"MEMBER","active_lock_reason":null,"body":"on 1.5.0\nCreating a document using the below\n\n```\nDELETE my_index\n\nPUT my_index\n\nPUT my_index/_mapping/doc\n{\n  \"_timestamp\": {\n    \"enabled\": true,\n    \"store\": \"yes\",\n    \"path\": \"my_external_timestamp\"\n  },\n  \"_ttl\": {\n    \"enabled\": true,\n    \"default\": \"1s\"\n  },\n  \"properties\": {\n    \"title\": {\n      \"type\": \"string\"\n    },\n    \"my_external_timestamp\":{\n      \"type\": \"date\"\n    }\n  }\n}\n```\n\nindex the doc at around 2015-03-25T16:03:00.000 \n\n```\nPUT my_index/doc/1\n{\"title\":\"test\",\n \"my_external_timestamp\":\"2015-03-25T16:05:00.000\"}\n```\n\nImmediately ask for current _ttl \n\n```\nGET my_index/_search\n{\n  \"fields\": [\n    \"_timestamp\",\n    \"_ttl\",\n    \"_source\"\n  ],\n  \"query\": {\n    \"match_all\": {}\n  }\n}\n```\n\nreturns\n\n```\n{\n   \"took\": 2,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 5,\n      \"successful\": 5,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 1,\n      \"max_score\": 1,\n      \"hits\": [\n         {\n            \"_index\": \"my_index\",\n            \"_type\": \"doc\",\n            \"_id\": \"1\",\n            \"_score\": 1,\n            \"_source\": {\n               \"title\": \"test\",\n               \"my_external_timestamp\": \"2015-03-25T16:05:00.000\"\n            },\n            \"fields\": {\n               \"_ttl\": 3699935,\n               \"_timestamp\": 1427299500000\n            }\n         }\n      ]\n   }\n}\n```\n\n_ttl is way bigger than it should be ( should be about 3 minutes )\n_timestamp is correct\n\nfor 1427299500000\nConvert epoch to human readable date and vice versa\n Timestamp to Human date  [batch convert timestamps to human dates]\nAssuming that this timestamp is in milliseconds:\nGMT: Wed, 25 Mar 2015 16:05:00 GMT\n\nExact same test works as expected when _timestamp is not extracted via path and I let elasticsearch assign default value of now().\n","closed_by":{"login":"nellicus","id":8770097,"node_id":"MDQ6VXNlcjg3NzAwOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/8770097?v=4","gravatar_id":"","url":"https://api.github.com/users/nellicus","html_url":"https://github.com/nellicus","followers_url":"https://api.github.com/users/nellicus/followers","following_url":"https://api.github.com/users/nellicus/following{/other_user}","gists_url":"https://api.github.com/users/nellicus/gists{/gist_id}","starred_url":"https://api.github.com/users/nellicus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nellicus/subscriptions","organizations_url":"https://api.github.com/users/nellicus/orgs","repos_url":"https://api.github.com/users/nellicus/repos","events_url":"https://api.github.com/users/nellicus/events{/privacy}","received_events_url":"https://api.github.com/users/nellicus/received_events","type":"User","site_admin":false},"performed_via_github_app":null}