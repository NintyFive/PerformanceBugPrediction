{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13359","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13359/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13359/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13359/events","html_url":"https://github.com/elastic/elasticsearch/issues/13359","id":104977645,"node_id":"MDU6SXNzdWUxMDQ5Nzc2NDU=","number":13359,"title":"Add a \"conditional install\" option to plugin for easier automation","user":{"login":"morgango","id":3835173,"node_id":"MDQ6VXNlcjM4MzUxNzM=","avatar_url":"https://avatars3.githubusercontent.com/u/3835173?v=4","gravatar_id":"","url":"https://api.github.com/users/morgango","html_url":"https://github.com/morgango","followers_url":"https://api.github.com/users/morgango/followers","following_url":"https://api.github.com/users/morgango/following{/other_user}","gists_url":"https://api.github.com/users/morgango/gists{/gist_id}","starred_url":"https://api.github.com/users/morgango/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/morgango/subscriptions","organizations_url":"https://api.github.com/users/morgango/orgs","repos_url":"https://api.github.com/users/morgango/repos","events_url":"https://api.github.com/users/morgango/events{/privacy}","received_events_url":"https://api.github.com/users/morgango/received_events","type":"User","site_admin":false},"labels":[{"id":146832994,"node_id":"MDU6TGFiZWwxNDY4MzI5OTQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Plugins","name":":Core/Infra/Plugins","color":"0e8a16","default":false,"description":"Plugin API and infrastructure"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-09-04T22:02:23Z","updated_at":"2017-03-15T21:27:43Z","closed_at":"2017-03-15T21:27:43Z","author_association":"NONE","active_lock_reason":null,"body":"I have been working with Docker quite a bit lately, and have found that there are some difficulties with using Elastic's commercial plugins within Docker.  Not any technical incompatibilities, per se.  But, here is the issue that comes up because of different operational assumptions.\n1. The \"[official Elasticsearch image](https://github.com/dockerfile/elasticsearch)\" for Docker does not include plugins like Shield, Watcher, or Marvel.\n2. Docker expects a single command to be run when a \n3.  You need to install these yourself, not a big deal.  \n4. You can do this with a command like:\n\n```\nsh -c 'plugin -i elasticsearch/license/latest\\\n                && plugin -i elasticsearch/shield/latest\\\n                && plugin -i elasticsearch/marvel/latest\\\n                && plugin -i elasticsearch/watcher/latest\\\n                && elasticsearch'\n```\n\nGroovy, no problem.\n\n**Except for The Problem**\n\nThe issue is that a Docker build will fail if a single command fails.  So, if your plugin command installs the plugins the first time it runs, the next time it runs it will fail, causing the entire build to fail.\n\nWhat would be great is if there were a conditional installation option where I could try to install a plugin.  Something like:\n\n`bin/plugin --install --conditional elasticsearch/shield/latest`\n\nIf the plugin were installed, or up-to-date then there wouldn't be any error thrown and we can continue on our merry way.  No error code returned, just a message to stdout that the plugin is already up-to-date.\n\nBTW, I know that you _can_ create your own Dockerfile that does a lot of this for you with shell scripting logic.  However, the overwhelming majority of users are going to use the stock \"official image\" and don't want to build it themselves.  \n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}