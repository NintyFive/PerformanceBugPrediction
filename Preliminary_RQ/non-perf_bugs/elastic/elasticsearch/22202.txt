{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22202","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22202/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22202/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22202/events","html_url":"https://github.com/elastic/elasticsearch/issues/22202","id":195880213,"node_id":"MDU6SXNzdWUxOTU4ODAyMTM=","number":22202,"title":"Bizzare 100% CPU Utilization on 5.X - Windows 2008R2","user":{"login":"trevorndodds","id":10899305,"node_id":"MDQ6VXNlcjEwODk5MzA1","avatar_url":"https://avatars2.githubusercontent.com/u/10899305?v=4","gravatar_id":"","url":"https://api.github.com/users/trevorndodds","html_url":"https://github.com/trevorndodds","followers_url":"https://api.github.com/users/trevorndodds/followers","following_url":"https://api.github.com/users/trevorndodds/following{/other_user}","gists_url":"https://api.github.com/users/trevorndodds/gists{/gist_id}","starred_url":"https://api.github.com/users/trevorndodds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trevorndodds/subscriptions","organizations_url":"https://api.github.com/users/trevorndodds/orgs","repos_url":"https://api.github.com/users/trevorndodds/repos","events_url":"https://api.github.com/users/trevorndodds/events{/privacy}","received_events_url":"https://api.github.com/users/trevorndodds/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":146854632,"node_id":"MDU6TGFiZWwxNDY4NTQ2MzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Network","name":":Distributed/Network","color":"0e8a16","default":false,"description":"Http and internode communication implementations"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2016-12-15T18:31:03Z","updated_at":"2017-01-10T09:19:36Z","closed_at":"2017-01-10T09:19:36Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\r\nElasticsearch 5.0.0 now 5.1.1\r\nRunning JVM 1.8.102 and then updated to JVM 1.8.112 - problem occurs on both.\r\nWindows 2008 R2\r\n\r\nI updated from 2.4.1 to 5.0 then to 5.1.1 since I've moved to 5.0 I've been having nodes drop out of the cluster. I have a 6 data nodes, each one exhibits the exact same problem but at random times. My ingest and master nodes do not exhibit this issue, but as soon as I enable a ingest node as a data node it starts to drop. I never had this issue before when on 2.4.1.\r\n\r\nLogging doesn't show anything other than the node left and joined, I turned the logging up to debug but the same problem logging stops outputting anything, even the usual 10s marvel metrics shipping stops logging. I'm not able to bring up the hot threads via 9200 as that connection times out. Even trying to do a jstack dump hangs until the java process starts to normalize. The 100% cpu spike can last a few seconds to a few minutes, but it does recover on it's own. Disk I/O is at nothing. I've reduced my cluster down to 2 data nodes made them mangers and removed 95% of my indexes to accommodate only the current daily indexes, the problem persists. No searches are occurring. I'm now starting to disable all other windows services to see if there's some conflict.\r\n\r\nI only have process explorer, and the thread dump from as soon as the jstack was able to connect and dump.\r\n\r\nThese are all the threads in the java.exe when running at 100%\r\n![image](https://cloud.githubusercontent.com/assets/10899305/21236561/879a68ce-c2c9-11e6-8af0-fee168727fdd.png)\r\n\r\nSome stack views from the TIDs if these will help any.\r\n![10224](https://cloud.githubusercontent.com/assets/10899305/21236815/7eb1a7f8-c2ca-11e6-89e1-5431434c10ac.png)\r\n![2936](https://cloud.githubusercontent.com/assets/10899305/21236824/877da74c-c2ca-11e6-89c4-6e3d62e3b793.png)\r\n\r\n\r\n![image](https://cloud.githubusercontent.com/assets/10899305/21236574/9f9f9156-c2c9-11e6-98f9-b51943c8bc6a.png)\r\n\r\n\r\n[threadDumps.txt](https://github.com/elastic/elasticsearch/files/655492/threadDumps.txt)\r\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}