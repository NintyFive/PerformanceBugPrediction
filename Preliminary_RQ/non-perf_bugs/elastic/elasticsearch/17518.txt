{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/17518","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17518/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17518/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17518/events","html_url":"https://github.com/elastic/elasticsearch/issues/17518","id":145766741,"node_id":"MDU6SXNzdWUxNDU3NjY3NDE=","number":17518,"title":"Filter aggregation with no filter results in a NullPointerException","user":{"login":"gmarz","id":1594777,"node_id":"MDQ6VXNlcjE1OTQ3Nzc=","avatar_url":"https://avatars0.githubusercontent.com/u/1594777?v=4","gravatar_id":"","url":"https://api.github.com/users/gmarz","html_url":"https://github.com/gmarz","followers_url":"https://api.github.com/users/gmarz/followers","following_url":"https://api.github.com/users/gmarz/following{/other_user}","gists_url":"https://api.github.com/users/gmarz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmarz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmarz/subscriptions","organizations_url":"https://api.github.com/users/gmarz/orgs","repos_url":"https://api.github.com/users/gmarz/repos","events_url":"https://api.github.com/users/gmarz/events{/privacy}","received_events_url":"https://api.github.com/users/gmarz/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-04-04T18:28:34Z","updated_at":"2016-04-05T16:21:20Z","closed_at":"2016-04-05T16:21:20Z","author_association":"MEMBER","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: master\n\n**JVM version**: 1.8.0_74\n\n**OS version**: Win 10\n\n**Description of the problem including expected versus actual behavior**:\n\nNot really a typical use case, but an issue nonetheless caught by our integration tests.  Specifying no filter in a filter agg results in a NPE.\n\n**Steps to reproduce**:\n\n```\n{\n  \"aggs\": {\n    \"empty_filter\": {\n      \"filter\": {}\n    }\n  }\n}\n```\n\nResponse:\n\n```\n{\n  \"error\" : {\n    \"root_cause\" : [ {\n      \"type\" : \"null_pointer_exception\",\n      \"reason\" : null\n    } ],\n    \"type\" : \"search_phase_execution_exception\",\n    \"reason\" : \"all shards failed\",\n    \"phase\" : \"query\",\n    \"grouped\" : true,\n    \"failed_shards\" : [ {\n      \"shard\" : 0,\n      \"index\" : \"project\",\n      \"node\" : \"9QsiljMeTtKbZ2FijGofvw\",\n      \"reason\" : {\n        \"type\" : \"null_pointer_exception\",\n        \"reason\" : null\n      }\n    } ],\n    \"caused_by\" : {\n      \"type\" : \"null_pointer_exception\",\n      \"reason\" : null\n    }\n  },\n  \"status\" : 500\n}\n```\n\n**Provide logs (if relevant)**:\n\n```\nFailed to execute [org.elasticsearch.action.search.SearchRequest@3218e268]\nRemoteTransportException[[readonly-node-55e651][127.0.0.1:9300][indices:data/read/search[phase/query]]]; nested: NullPointerException;\nCaused by: java.lang.NullPointerException\n    at org.apache.lucene.search.IndexSearcher.rewrite(IndexSearcher.java:684)\n    at org.apache.lucene.search.IndexSearcher.createNormalizedWeight(IndexSearcher.java:734)\n    at org.elasticsearch.search.internal.ContextIndexSearcher.createNormalizedWeight(ContextIndexSearcher.java:107)\n    at org.elasticsearch.search.aggregations.bucket.filter.FilterAggregatorFactory.<init>(FilterAggregatorFactory.java:46)\n    at org.elasticsearch.search.aggregations.bucket.filter.FilterAggregatorBuilder.doBuild(FilterAggregatorBuilder.java:60)\n    at org.elasticsearch.search.aggregations.AggregatorBuilder.build(AggregatorBuilder.java:120)\n    at org.elasticsearch.search.aggregations.AggregatorFactories$Builder.build(AggregatorFactories.java:171)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:709)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:577)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:526)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:277)\n    at org.elasticsearch.search.action.SearchTransportService$SearchQueryTransportHandler.messageReceived(SearchTransportService.java:369)\n    at org.elasticsearch.search.action.SearchTransportService$SearchQueryTransportHandler.messageReceived(SearchTransportService.java:366)\n    at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:65)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\n    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:468)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\n<!--\nIf you are filing a feature request, please remove the above bug\nreport block and provide responses for all of the below items.\n-->\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}