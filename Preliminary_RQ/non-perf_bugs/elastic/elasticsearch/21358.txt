{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21358","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21358/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21358/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21358/events","html_url":"https://github.com/elastic/elasticsearch/issues/21358","id":187518132,"node_id":"MDU6SXNzdWUxODc1MTgxMzI=","number":21358,"title":"Bug - changing field in partials update script throws error","user":{"login":"florianbepunkt","id":8314202,"node_id":"MDQ6VXNlcjgzMTQyMDI=","avatar_url":"https://avatars1.githubusercontent.com/u/8314202?v=4","gravatar_id":"","url":"https://api.github.com/users/florianbepunkt","html_url":"https://github.com/florianbepunkt","followers_url":"https://api.github.com/users/florianbepunkt/followers","following_url":"https://api.github.com/users/florianbepunkt/following{/other_user}","gists_url":"https://api.github.com/users/florianbepunkt/gists{/gist_id}","starred_url":"https://api.github.com/users/florianbepunkt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/florianbepunkt/subscriptions","organizations_url":"https://api.github.com/users/florianbepunkt/orgs","repos_url":"https://api.github.com/users/florianbepunkt/repos","events_url":"https://api.github.com/users/florianbepunkt/events{/privacy}","received_events_url":"https://api.github.com/users/florianbepunkt/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-11-05T19:31:48Z","updated_at":"2016-11-07T13:17:47Z","closed_at":"2016-11-05T23:54:23Z","author_association":"NONE","active_lock_reason":null,"body":"I have a local installaton of ES5. When I create a new index and run the following partial update script:\r\n\r\n```\r\nbody: {\r\n    \"script\" : {\r\n\t    \"inline\": \"ctx._source.hasLiked.add(params.swipedUserID)\",\r\n\t    \"lang\": \"painless\",\r\n\t    \"params\" : {\r\n\t        \"swipedUserID\": \"123456\"\r\n\t    }\r\n\t},\r\n\t\"upsert\": {\r\n\t\"hasLiked\": ['123456]\r\n\t}\r\n}\r\n```\r\n\r\neverything works as exspected: the value is added to array or upserted if not-existing.\r\n\r\nBut when I change the script now to `ctx._source.excludeFromQuery.add(params.swipedUserID)` after I run the first version I get an error. But the error seems not to be in my script. If I delete the index and create it again (same mapping, same name, etc) and then run the scripts in reversed order, the `ctx._source.excludeFromQuery.add(params.swipedUserID)` script runs fine, but the `ctx._source.hasLiked.add(params.swipedUserID)` one now throws the (same) error.\r\n\r\nError: \r\n\r\n```\r\n{ Error: [remote_transport_exception] [oPvNqgZ][127.0.0.1:9300][indices:data/write/update[s]]\r\n    at respond (/Users/floriannorbertbepunkt/Dropbox/Dropbox Arbeit/Mister Bishop Studios/Roomary/Data/firebase-server/node_modules/elasticsearch/src/lib/transport.js:289:15)\r\n    at checkRespForFailure (/Users/floriannorbertbepunkt/Dropbox/Dropbox Arbeit/Mister Bishop Studios/Roomary/Data/firebase-server/node_modules/elasticsearch/src/lib/transport.js:248:7)\r\n    at HttpConnector.<anonymous> (/Users/floriannorbertbepunkt/Dropbox/Dropbox Arbeit/Mister Bishop Studios/Roomary/Data/firebase-server/node_modules/elasticsearch/src/lib/connectors/http.js:164:7)\r\n    at IncomingMessage.wrapper (/Users/floriannorbertbepunkt/Dropbox/Dropbox Arbeit/Mister Bishop Studios/Roomary/Data/firebase-server/node_modules/lodash/index.js:3095:19)\r\n    at emitNone (events.js:91:20)\r\n    at IncomingMessage.emit (events.js:185:7)\r\n    at endReadableNT (_stream_readable.js:974:12)\r\n    at _combinedTickCallback (internal/process/next_tick.js:74:11)\r\n    at process._tickCallback (internal/process/next_tick.js:98:9)\r\n  status: 400,\r\n  displayName: 'BadRequest',\r\n  message: '[remote_transport_exception] [oPvNqgZ][127.0.0.1:9300][indices:data/write/update[s]]',\r\n  path: '/roomary_swipes/userSwipeData/6HFntI1L8NOzbZj3O5SnfvKHt5C2/_update',\r\n  query: {},\r\n  body: \r\n   { error: \r\n      { root_cause: [Object],\r\n        type: 'illegal_argument_exception',\r\n        reason: 'failed to execute script',\r\n        caused_by: [Object] },\r\n     status: 400 },\r\n  statusCode: 400,\r\n  response: '{\"error\":{\"root_cause\":[{\"type\":\"remote_transport_exception\",\"reason\":\"[oPvNqgZ][127.0.0.1:9300][indices:data/write/update[s]]\"}],\"type\":\"illegal_argument_exception\",\"reason\":\"failed to execute script\",\"caused_by\":{\"type\":\"script_exception\",\"reason\":\"runtime error\",\"caused_by\":{\"type\":\"null_pointer_exception\",\"reason\":null},\"script_stack\":[\"ctx._source.hasLiked.add(params.swipedUserID)\",\"                               ^---- HERE\"],\"script\":\"ctx._source.hasLiked.add(params.swipedUserID)\",\"lang\":\"painless\"}},\"status\":400}',\r\n  toString: [Function],\r\n  toJSON: [Function] }\r\n```\r\n\r\n","closed_by":{"login":"florianbepunkt","id":8314202,"node_id":"MDQ6VXNlcjgzMTQyMDI=","avatar_url":"https://avatars1.githubusercontent.com/u/8314202?v=4","gravatar_id":"","url":"https://api.github.com/users/florianbepunkt","html_url":"https://github.com/florianbepunkt","followers_url":"https://api.github.com/users/florianbepunkt/followers","following_url":"https://api.github.com/users/florianbepunkt/following{/other_user}","gists_url":"https://api.github.com/users/florianbepunkt/gists{/gist_id}","starred_url":"https://api.github.com/users/florianbepunkt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/florianbepunkt/subscriptions","organizations_url":"https://api.github.com/users/florianbepunkt/orgs","repos_url":"https://api.github.com/users/florianbepunkt/repos","events_url":"https://api.github.com/users/florianbepunkt/events{/privacy}","received_events_url":"https://api.github.com/users/florianbepunkt/received_events","type":"User","site_admin":false},"performed_via_github_app":null}