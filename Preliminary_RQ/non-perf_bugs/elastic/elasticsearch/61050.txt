{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/61050","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61050/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61050/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/61050/events","html_url":"https://github.com/elastic/elasticsearch/issues/61050","id":677839602,"node_id":"MDU6SXNzdWU2Nzc4Mzk2MDI=","number":61050,"title":"Secure HDFS fixture startup fails on JDK 8u262 to 8u271","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1967496670,"node_id":"MDU6TGFiZWwxOTY3NDk2Njcw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Distributed","name":"Team:Distributed","color":"fef2c0","default":false,"description":"Meta label for distributed team"},{"id":249799053,"node_id":"MDU6TGFiZWwyNDk3OTkwNTM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/jvm%20bug","name":"jvm bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-08-12T16:54:30Z","updated_at":"2020-08-14T01:36:11Z","closed_at":"2020-08-14T01:36:10Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Build scan**: https://gradle-enterprise.elastic.co/s/r7hg55pyb7g6i\r\nhttps://gradle-enterprise.elastic.co/s/2vx2ssb2jkzl4\r\nhttps://gradle-enterprise.elastic.co/s/7jdmamwoandv6\r\n\r\nOn 7.x, when the runtime Java home is a JDK 8 build between u262 and u271, the secureHDFS fixture will fail to start up due to a NullPointerException when logging in via Kerberos. \r\n\r\n```\r\n   java.io.IOException: Login failure for hdfs/hdfs.build.elastic.co@BUILD.ELASTIC.CO from keytab /dev/shm/elastic+elasticsearch+7.x+matrix-java-periodic/ES_RUNTIME_JAVA/zulu8/nodes/general-purpose/test/fixtures/krb5kdc-fixture/testfixtures_shared/shared/hdfs/keytabs/hdfs_hdfs.build.elastic.co.keytab: javax.security.auth.login.LoginException: java.lang.NullPointerException\r\n    \tat sun.security.krb5.KrbKdcRep.check(KrbKdcRep.java:137)\r\n    \tat sun.security.krb5.KrbAsRep.decrypt(KrbAsRep.java:159)\r\n    \tat sun.security.krb5.KrbAsRep.decryptUsingKeyTab(KrbAsRep.java:121)\r\n    \tat sun.security.krb5.KrbAsReqBuilder.resolve(KrbAsReqBuilder.java:310)\r\n    \tat sun.security.krb5.KrbAsReqBuilder.action(KrbAsReqBuilder.java:498)\r\n    \tat com.sun.security.auth.module.Krb5LoginModule.attemptAuthentication(Krb5LoginModule.java:780)\r\n    \tat com.sun.security.auth.module.Krb5LoginModule.login(Krb5LoginModule.java:618)\r\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n    \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n    \tat java.lang.reflect.Method.invoke(Method.java:498)\r\n    \tat javax.security.auth.login.LoginContext.invoke(LoginContext.java:755)\r\n    \tat javax.security.auth.login.LoginContext.access$000(LoginContext.java:195)\r\n    \tat javax.security.auth.login.LoginContext$4.run(LoginContext.java:682)\r\n    \tat javax.security.auth.login.LoginContext$4.run(LoginContext.java:680)\r\n    \tat java.security.AccessController.doPrivileged(Native Method)\r\n    \tat javax.security.auth.login.LoginContext.invokePriv(LoginContext.java:680)\r\n    \tat javax.security.auth.login.LoginContext.login(LoginContext.java:587)\r\n    \tat org.apache.hadoop.security.UserGroupInformation.loginUserFromKeytab(UserGroupInformation.java:1057)\r\n    \tat org.apache.hadoop.security.SecurityUtil.login(SecurityUtil.java:286)\r\n    \tat org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:1081)\r\n    \tat org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:376)\r\n    \tat org.apache.hadoop.hdfs.DFSTestUtil.formatNameNode(DFSTestUtil.java:233)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.createNameNodesAndSetConf(MiniDFSCluster.java:1027)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.initMiniDFSCluster(MiniDFSCluster.java:830)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:485)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster$Builder.build(MiniDFSCluster.java:444)\r\n    \tat hdfs.MiniHDFS.main(MiniHDFS.java:119)\r\n    \r\n    \tat org.apache.hadoop.security.UserGroupInformation.loginUserFromKeytab(UserGroupInformation.java:1066)\r\n    \tat org.apache.hadoop.security.SecurityUtil.login(SecurityUtil.java:286)\r\n    \tat org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:1081)\r\n    \tat org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:376)\r\n    \tat org.apache.hadoop.hdfs.DFSTestUtil.formatNameNode(DFSTestUtil.java:233)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.createNameNodesAndSetConf(MiniDFSCluster.java:1027)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.initMiniDFSCluster(MiniDFSCluster.java:830)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:485)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster$Builder.build(MiniDFSCluster.java:444)\r\n    \tat hdfs.MiniHDFS.main(MiniHDFS.java:119)\r\n    Caused by: javax.security.auth.login.LoginException: java.lang.NullPointerException\r\n    \tat sun.security.krb5.KrbKdcRep.check(KrbKdcRep.java:137)\r\n    \tat sun.security.krb5.KrbAsRep.decrypt(KrbAsRep.java:159)\r\n    \tat sun.security.krb5.KrbAsRep.decryptUsingKeyTab(KrbAsRep.java:121)\r\n    \tat sun.security.krb5.KrbAsReqBuilder.resolve(KrbAsReqBuilder.java:310)\r\n    \tat sun.security.krb5.KrbAsReqBuilder.action(KrbAsReqBuilder.java:498)\r\n    \tat com.sun.security.auth.module.Krb5LoginModule.attemptAuthentication(Krb5LoginModule.java:780)\r\n    \tat com.sun.security.auth.module.Krb5LoginModule.login(Krb5LoginModule.java:618)\r\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n    \tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n    \tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n    \tat java.lang.reflect.Method.invoke(Method.java:498)\r\n    \tat javax.security.auth.login.LoginContext.invoke(LoginContext.java:755)\r\n    \tat javax.security.auth.login.LoginContext.access$000(LoginContext.java:195)\r\n    \tat javax.security.auth.login.LoginContext$4.run(LoginContext.java:682)\r\n    \tat javax.security.auth.login.LoginContext$4.run(LoginContext.java:680)\r\n    \tat java.security.AccessController.doPrivileged(Native Method)\r\n    \tat javax.security.auth.login.LoginContext.invokePriv(LoginContext.java:680)\r\n    \tat javax.security.auth.login.LoginContext.login(LoginContext.java:587)\r\n    \tat org.apache.hadoop.security.UserGroupInformation.loginUserFromKeytab(UserGroupInformation.java:1057)\r\n    \tat org.apache.hadoop.security.SecurityUtil.login(SecurityUtil.java:286)\r\n    \tat org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:1081)\r\n    \tat org.apache.hadoop.hdfs.server.namenode.NameNode.format(NameNode.java:376)\r\n    \tat org.apache.hadoop.hdfs.DFSTestUtil.formatNameNode(DFSTestUtil.java:233)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.createNameNodesAndSetConf(MiniDFSCluster.java:1027)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.initMiniDFSCluster(MiniDFSCluster.java:830)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster.<init>(MiniDFSCluster.java:485)\r\n    \tat org.apache.hadoop.hdfs.MiniDFSCluster$Builder.build(MiniDFSCluster.java:444)\r\n    \tat hdfs.MiniHDFS.main(MiniHDFS.java:119)\r\n    \r\n    \tat javax.security.auth.login.LoginContext.invoke(LoginContext.java:856)\r\n    \tat javax.security.auth.login.LoginContext.access$000(LoginContext.java:195)\r\n    \tat javax.security.auth.login.LoginContext$4.run(LoginContext.java:682)\r\n    \tat javax.security.auth.login.LoginContext$4.run(LoginContext.java:680)\r\n    \tat java.security.AccessController.doPrivileged(Native Method)\r\n    \tat javax.security.auth.login.LoginContext.invokePriv(LoginContext.java:680)\r\n    \tat javax.security.auth.login.LoginContext.login(LoginContext.java:587)\r\n    \tat org.apache.hadoop.security.UserGroupInformation.loginUserFromKeytab(UserGroupInformation.java:1057)\r\n    \t... 9 more\r\n    2020-08-12 16:23:39,761 INFO  [main] hdfs.MiniDFSCluster (MiniDFSCluster.java:shutdown(1789)) - Shutting down the Mini HDFS Cluster\r\n```\r\n\r\nThe root cause is the same as https://github.com/elastic/elasticsearch/issues/56507, which was caused by https://bugs.openjdk.java.net/browse/JDK-8246193.\r\n\r\n","closed_by":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"performed_via_github_app":null}