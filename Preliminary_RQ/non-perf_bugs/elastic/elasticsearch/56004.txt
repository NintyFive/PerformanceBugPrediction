{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/56004","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56004/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56004/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/56004/events","html_url":"https://github.com/elastic/elasticsearch/issues/56004","id":609721778,"node_id":"MDU6SXNzdWU2MDk3MjE3Nzg=","number":56004,"title":"[Ingest Node Pipelines] More detailed _simulate response","user":{"login":"jloleysens","id":8155004,"node_id":"MDQ6VXNlcjgxNTUwMDQ=","avatar_url":"https://avatars3.githubusercontent.com/u/8155004?v=4","gravatar_id":"","url":"https://api.github.com/users/jloleysens","html_url":"https://github.com/jloleysens","followers_url":"https://api.github.com/users/jloleysens/followers","following_url":"https://api.github.com/users/jloleysens/following{/other_user}","gists_url":"https://api.github.com/users/jloleysens/gists{/gist_id}","starred_url":"https://api.github.com/users/jloleysens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jloleysens/subscriptions","organizations_url":"https://api.github.com/users/jloleysens/orgs","repos_url":"https://api.github.com/users/jloleysens/repos","events_url":"https://api.github.com/users/jloleysens/events{/privacy}","received_events_url":"https://api.github.com/users/jloleysens/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":1967496097,"node_id":"MDU6TGFiZWwxOTY3NDk2MDk3","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Features","name":"Team:Core/Features","color":"fef2c0","default":false,"description":"Meta label for core/features team"},{"id":1967500052,"node_id":"MDU6TGFiZWwxOTY3NTAwMDUy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:UI","name":"Team:UI","color":"fef2c0","default":false,"description":"Meta label for UI team"}],"state":"closed","locked":false,"assignee":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"assignees":[{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2020-04-30T08:44:54Z","updated_at":"2020-08-04T18:09:09Z","closed_at":"2020-08-04T18:09:09Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\nIn Kibana, new UI was built to support management of ingest node pipelines (https://github.com/elastic/kibana/pull/62321). The UI also gives users a way of simulating the pipeline while creating or editing it.\r\n\r\nThe simulate UI we are envisioning will provide users with detailed information about the path each document has traveled through the simulated pipeline. Including the following information:\r\n\r\n1. An indication of all processors that ran against the document. This will enable a tree view of the set (or subset) of processors.\r\n2. At each processor did it fail or not pass the conditional (`if`). This will enable ✅  and ❌ indications at each processor. Critically, it would be important to know _why_ something went wrong.\r\n3. For a specific processor what was updated in the document (or a point-in-time look at the document post-processor) - something like this would enable a visual diff at each step.\r\n\r\nOn ES `8.0.0` snapshot this is an example request-response pair:\r\n\r\n<details>\r\n<summary>Request</summary>\r\n\r\n```json\r\n{\r\n\t\"pipeline\": {\r\n\t\t\"description\": \"_description\",\r\n\t\t\"processors\": [\r\n\t\t\t{\r\n\t\t\t\t\"set\": {\r\n\t\t\t\t\t\"field\": \"field3\",\r\n\t\t\t\t\t\"value\": \"_value3\",\r\n\t\t\t\t\t\"tag\": \"THIS SHOULD BE THERE\"\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"rename\": {\r\n\t\t\t\t\t\"if\": \"ctx.foo == 'bar'\",\r\n\t\t\t\t\t\"field\": \"foo1\",\r\n\t\t\t\t\t\"target_field\": \"fieldA\",\r\n\t\t\t\t\t\"tag\": \"field1_renamer\",\r\n\t\t\t\t\t\"on_failure\": [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"set\": {\r\n\t\t\t\t\t\t\t\t\"field\": \"field4\",\r\n\t\t\t\t\t\t\t\t\"value\": \"THIS SHOULD BE THERE FROM FAILURE\",\r\n\t\t\t\t\t\t\t\t\"tag\": \"BLAH TEST\"\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"set\": {\r\n\t\t\t\t\t\"field\": \"field3\",\r\n\t\t\t\t\t\"value\": \"_value3\",\r\n\t\t\t\t\t\"tag\": \"THIS SHOULD BE THERE\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t\"docs\": [\r\n\t\t{\r\n\t\t\t\"_index\": \"index\",\r\n\t\t\t\"_id\": \"id\",\r\n\t\t\t\"_source\": {\r\n\t\t\t\t\"foo\": \"bar\"\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"_index\": \"index\",\r\n\t\t\t\"_id\": \"id\",\r\n\t\t\t\"_source\": {\r\n\t\t\t\t\"foo\": \"123\"\r\n\t\t\t}\r\n\t\t}\r\n\t]\r\n}\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Response</summary>\r\n\r\n```json\r\n{\r\n  \"docs\": [\r\n    {\r\n      \"processor_results\": [\r\n        {\r\n          \"tag\": \"THIS SHOULD BE THERE\",\r\n          \"doc\": {\r\n            \"_index\": \"index\",\r\n            \"_id\": \"id\",\r\n            \"_source\": {\r\n              \"field3\": \"_value3\",\r\n              \"foo\": \"bar\"\r\n            },\r\n            \"_ingest\": {\r\n              \"pipeline\": \"_simulate_pipeline\",\r\n              \"timestamp\": \"2020-04-30T08:26:53.842161Z\"\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"field1_renamer\",\r\n          \"doc\": {\r\n            \"_index\": \"index\",\r\n            \"_id\": \"id\",\r\n            \"_source\": {\r\n              \"field3\": \"_value3\",\r\n              \"foo\": \"bar\",\r\n              \"field4\": \"THIS SHOULD BE THERE FROM FAILURE\"\r\n            },\r\n            \"_ingest\": {\r\n              \"pipeline\": \"_simulate_pipeline\",\r\n              \"timestamp\": \"2020-04-30T08:26:53.842161Z\"\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"THIS SHOULD BE THERE\",\r\n          \"doc\": {\r\n            \"_index\": \"index\",\r\n            \"_id\": \"id\",\r\n            \"_source\": {\r\n              \"field3\": \"_value3\",\r\n              \"foo\": \"bar\",\r\n              \"field4\": \"THIS SHOULD BE THERE FROM FAILURE\"\r\n            },\r\n            \"_ingest\": {\r\n              \"pipeline\": \"_simulate_pipeline\",\r\n              \"timestamp\": \"2020-04-30T08:26:53.842161Z\"\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"processor_results\": [\r\n        {\r\n          \"tag\": \"THIS SHOULD BE THERE\",\r\n          \"doc\": {\r\n            \"_index\": \"index\",\r\n            \"_id\": \"id\",\r\n            \"_source\": {\r\n              \"field3\": \"_value3\",\r\n              \"foo\": \"123\"\r\n            },\r\n            \"_ingest\": {\r\n              \"pipeline\": \"_simulate_pipeline\",\r\n              \"timestamp\": \"2020-04-30T08:26:53.842165Z\"\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"tag\": \"THIS SHOULD BE THERE\",\r\n          \"doc\": {\r\n            \"_index\": \"index\",\r\n            \"_id\": \"id\",\r\n            \"_source\": {\r\n              \"field3\": \"_value3\",\r\n              \"foo\": \"123\"\r\n            },\r\n            \"_ingest\": {\r\n              \"pipeline\": \"_simulate_pipeline\",\r\n              \"timestamp\": \"2020-04-30T08:26:53.842165Z\"\r\n            }\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n</details>\r\n\r\nGiven the above, we do not have a way of mapping these results back to the submitted pipeline to achieve 1 and 2, only a less detailed version of 3. (Where does `THIS SHOULD BE THERE FROM FAILURE` actually come from?)\r\n\r\nOne solution is that the response would be a structural mirror of the pipeline submitted to simulate. This would be simplest for consumers to map the result tree back to the submitted tree, each path would map back to a specific processor.\r\n\r\nAlternatively, a flat structure could still work if we use `tag` as a placeholder for a serialised path which points to the processor in the submitted pipeline (e.g., `0.on_failure.1`). However `tag` will still be exposed to users as a field they can enter values into (so we would be hijacking it for the call to `_simulate`). See this issue (https://github.com/elastic/elasticsearch/issues/56000) concerning the multiple concerns of tag.\r\n\r\nAssistance here would be greatly appreciated.\r\n\r\nCC @jakelandis @talevy @cjcenizal ","closed_by":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"performed_via_github_app":null}