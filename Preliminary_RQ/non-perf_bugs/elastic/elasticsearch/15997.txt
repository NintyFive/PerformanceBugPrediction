{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15997","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15997/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15997/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15997/events","html_url":"https://github.com/elastic/elasticsearch/issues/15997","id":126715121,"node_id":"MDU6SXNzdWUxMjY3MTUxMjE=","number":15997,"title":"Disabling _source prevents any further updates to mapping","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2016-01-14T18:18:22Z","updated_at":"2016-01-19T08:28:04Z","closed_at":"2016-01-19T08:28:04Z","author_association":"MEMBER","active_lock_reason":null,"body":"It seems that if you disable the `_source` when first creating the index, and subsequent updates to the mapping will fail with `Merge failed with failures {[Cannot update enabled setting for [_source]]}`, even if the update doesn't change `_source` at all.\n\nTested on ES 2.1\n\n``` json\n{\n   \"name\": \"Domo\",\n   \"cluster_name\": \"elasticsearch\",\n   \"version\": {\n      \"number\": \"2.1.0\",\n      \"build_hash\": \"72cd1f1a3eee09505e036106146dc1949dc5dc87\",\n      \"build_timestamp\": \"2015-11-18T22:40:03Z\",\n      \"build_snapshot\": false,\n      \"lucene_version\": \"5.3.1\"\n   },\n   \"tagline\": \"You Know, for Search\"\n}\n```\n### Example\n\n``` js\nDELETE /data\n\nPUT /data\n{\n    \"mappings\": {\n        \"data\": {\n            \"_source\": {\n                \"enabled\": false\n            },\n            \"properties\": {\n                \"float\": {\n                    \"type\": \"float\"\n                },\n                \"double\": {\n                    \"type\": \"double\"\n                }\n            }\n        }\n    }\n}\n\nGET /data/_mapping\n```\n\n``` json\n{\n   \"data\": {\n      \"mappings\": {\n         \"data\": {\n            \"_source\": {\n               \"enabled\": false\n            },\n            \"properties\": {\n               \"double\": {\n                  \"type\": \"double\"\n               },\n               \"float\": {\n                  \"type\": \"float\"\n               }\n            }\n         }\n      }\n   }\n}\n```\n\nAll good, but if we try to update the mapping:\n\n``` js\nPUT /data/_mapping/data\n{\n   \"properties\": {\n      \"long\": {\n         \"type\": \"long\"\n      }\n   }\n}\n```\n\n``` json\n{\n   \"error\": {\n      \"root_cause\": [\n         {\n            \"type\": \"merge_mapping_exception\",\n            \"reason\": \"Merge failed with failures {[Cannot update enabled setting for [_source]]}\"\n         }\n      ],\n      \"type\": \"merge_mapping_exception\",\n      \"reason\": \"Merge failed with failures {[Cannot update enabled setting for [_source]]}\"\n   },\n   \"status\": 400\n}\n```\n\nIf you repeat the process without touching `_source`, everything works as expected:\n\n``` js\nDELETE /data\n\nPUT /data\n{\n    \"mappings\": {\n        \"data\": {\n            \"properties\": {\n                \"float\": {\n                    \"type\": \"float\"\n                },\n                \"double\": {\n                    \"type\": \"double\"\n                }\n            }\n        }\n    }\n}\n\nGET /data/_mapping\n\nPUT /data/_mapping/data\n{\n   \"properties\": {\n      \"long\": {\n         \"type\": \"long\"\n      }\n   }\n}\n\nGET /data/_mapping\n```\n\n``` json\n{\n   \"data\": {\n      \"mappings\": {\n         \"data\": {\n            \"properties\": {\n               \"double\": {\n                  \"type\": \"double\"\n               },\n               \"float\": {\n                  \"type\": \"float\"\n               },\n               \"long\": {\n                  \"type\": \"long\"\n               }\n            }\n         }\n      }\n   }\n}\n```\n\nAnd it doesn't seem to matter if you enable or disable _source, both cases will cause the error.  It seems to be the presence of specifying _source that breaks future updates.\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}