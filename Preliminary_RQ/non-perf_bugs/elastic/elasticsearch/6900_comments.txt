[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49285346","html_url":"https://github.com/elastic/elasticsearch/issues/6900#issuecomment-49285346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6900","id":49285346,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Mjg1MzQ2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-17T09:46:39Z","updated_at":"2014-07-17T09:46:39Z","author_association":"CONTRIBUTOR","body":"Hi @praj2 \n\nPlease provide a recreation of what you are doing.\n\nthanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49291965","html_url":"https://github.com/elastic/elasticsearch/issues/6900#issuecomment-49291965","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6900","id":49291965,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MjkxOTY1","user":{"login":"praj2","id":6479566,"node_id":"MDQ6VXNlcjY0Nzk1NjY=","avatar_url":"https://avatars2.githubusercontent.com/u/6479566?v=4","gravatar_id":"","url":"https://api.github.com/users/praj2","html_url":"https://github.com/praj2","followers_url":"https://api.github.com/users/praj2/followers","following_url":"https://api.github.com/users/praj2/following{/other_user}","gists_url":"https://api.github.com/users/praj2/gists{/gist_id}","starred_url":"https://api.github.com/users/praj2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/praj2/subscriptions","organizations_url":"https://api.github.com/users/praj2/orgs","repos_url":"https://api.github.com/users/praj2/repos","events_url":"https://api.github.com/users/praj2/events{/privacy}","received_events_url":"https://api.github.com/users/praj2/received_events","type":"User","site_admin":false},"created_at":"2014-07-17T10:54:48Z","updated_at":"2014-07-17T10:54:48Z","author_association":"NONE","body":"My ES node is setup to have 32 shards.\n\nI store survey data in my ES, and each survey can have multiple versions.\nI need to find out all possible survey names and their respective versions list.\n\nHence I query thus:\nPOST /blah/blah_type/_search\n{\n  \"size\": 0, \n  \"aggs\": {\n    \"SURVEYS\": {\n      \"terms\": {\n        \"field\": \"survey_type\",\n        \"size\": 100\n      },\n      \"aggs\": {\n        \"VERSIONS\": {\n          \"terms\": {\n            \"field\": \"version\",\n            \"size\": 10\n          }\n        }\n      }\n    }\n  }\n}\n\nIn my local setup with 5 shards, I get no errors. However in a remote cloud setup I get errors from 3-4 shards. What could be the issue?\nAlso, in case it helps, I set custom routing as MMyyyy from the date of the survey response.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49293364","html_url":"https://github.com/elastic/elasticsearch/issues/6900#issuecomment-49293364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6900","id":49293364,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MjkzMzY0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-17T11:11:36Z","updated_at":"2014-07-17T11:11:36Z","author_association":"CONTRIBUTOR","body":"Can you paste the stack trace from the logs?  It may be related to this issue: #5048\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49295975","html_url":"https://github.com/elastic/elasticsearch/issues/6900#issuecomment-49295975","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6900","id":49295975,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5Mjk1OTc1","user":{"login":"praj2","id":6479566,"node_id":"MDQ6VXNlcjY0Nzk1NjY=","avatar_url":"https://avatars2.githubusercontent.com/u/6479566?v=4","gravatar_id":"","url":"https://api.github.com/users/praj2","html_url":"https://github.com/praj2","followers_url":"https://api.github.com/users/praj2/followers","following_url":"https://api.github.com/users/praj2/following{/other_user}","gists_url":"https://api.github.com/users/praj2/gists{/gist_id}","starred_url":"https://api.github.com/users/praj2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/praj2/subscriptions","organizations_url":"https://api.github.com/users/praj2/orgs","repos_url":"https://api.github.com/users/praj2/repos","events_url":"https://api.github.com/users/praj2/events{/privacy}","received_events_url":"https://api.github.com/users/praj2/received_events","type":"User","site_admin":false},"created_at":"2014-07-17T11:39:32Z","updated_at":"2014-07-17T11:39:32Z","author_association":"NONE","body":"JSON response:\n   \"took\": 1078,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 32,\n      \"successful\": 28,\n      \"failed\": 4,\n      \"failures\": [\n         {\n            \"index\": \"blah\",\n            \"shard\": 8,\n            \"status\": 500,\n            \"reason\": \"ArrayIndexOutOfBoundsException[0]\"\n         },\n         {\n            \"index\": \"blah\",\n            \"shard\": 3,\n            \"status\": 500,\n            \"reason\": \"ArrayIndexOutOfBoundsException[0]\"\n         },\n         {\n            \"index\": \"blah\",\n            \"shard\": 26,\n            \"status\": 500,\n            \"reason\": \"ArrayIndexOutOfBoundsException[0]\"\n         },\n         {\n            \"index\": \"blah\",\n            \"shard\": 20,\n            \"status\": 500,\n            \"reason\": \"ArrayIndexOutOfBoundsException[0]\"\n         }\n      ]\n   },\n   \"hits\": {\n      \"total\": 14241209,\n\nSTACKTRACE:\n[2014-07-17 07:46:48,465][DEBUG][action.search.type       ] [Dragonfly] [blah][8], node[C9YP6YFJQ2alZpUfevE73g], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@46e0309e] lastShard [true]\njava.lang.ArrayIndexOutOfBoundsException: 0\n        at org.elasticsearch.common.util.BigArrays$ObjectArrayWrapper.set(BigArrays.java:264)\n        at org.elasticsearch.search.aggregations.AggregatorFactories$1.<init>(AggregatorFactories.java:68)\n        at org.elasticsearch.search.aggregations.AggregatorFactories.createSubAggregators(AggregatorFactories.java:62)\n        at org.elasticsearch.search.aggregations.Aggregator.<init>(Aggregator.java:78)\n        at org.elasticsearch.search.aggregations.bucket.BucketsAggregator.<init>(BucketsAggregator.java:46)\n        at org.elasticsearch.search.aggregations.bucket.terms.StringTermsAggregator.<init>(StringTermsAggregator.java:64)\n        at org.elasticsearch.search.aggregations.bucket.terms.StringTermsAggregator$WithOrdinals.<init>(StringTermsAggregator.java:264)\n        at org.elasticsearch.search.aggregations.bucket.terms.TermsAggregatorFactory.create(TermsAggregatorFactory.java:111)\n        at org.elasticsearch.search.aggregations.support.ValueSourceAggregatorFactory.create(ValueSourceAggregatorFactory.java:58)\n        at org.elasticsearch.search.aggregations.AggregatorFactories.createTopLevelAggregators(AggregatorFactories.java:123)\n        at org.elasticsearch.search.aggregations.AggregationPhase.preProcess(AggregationPhase.java:79)\n        at org.elasticsearch.search.query.QueryPhase.preProcess(QueryPhase.java:91)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:502)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:474)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:467)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:239)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:202)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:80)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:216)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:203)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:186)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:724)\n[2014-07-17 07:46:48,466][DEBUG][action.search.type       ] [Dragonfly] [blah][3], node[C9YP6YFJQ2alZpUfevE73g], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@46e0309e] lastShard [true]\njava.lang.ArrayIndexOutOfBoundsException: 0\n        at org.elasticsearch.common.util.BigArrays$ObjectArrayWrapper.set(BigArrays.java:264)\n        at org.elasticsearch.search.aggregations.AggregatorFactories$1.<init>(AggregatorFactories.java:68)\n        at org.elasticsearch.search.aggregations.AggregatorFactories.createSubAggregators(AggregatorFactories.java:62)\n        at org.elasticsearch.search.aggregations.Aggregator.<init>(Aggregator.java:78)\n        at org.elasticsearch.search.aggregations.bucket.BucketsAggregator.<init>(BucketsAggregator.java:46)\n        at org.elasticsearch.search.aggregations.bucket.terms.StringTermsAggregator.<init>(StringTermsAggregator.java:64)\n        at org.elasticsearch.search.aggregations.bucket.terms.StringTermsAggregator$WithOrdinals.<init>(StringTermsAggregator.java:264)\n        at org.elasticsearch.search.aggregations.bucket.terms.TermsAggregatorFactory.create(TermsAggregatorFactory.java:111)\n        at org.elasticsearch.search.aggregations.support.ValueSourceAggregatorFactory.create(ValueSourceAggregatorFactory.java:58)\n        at org.elasticsearch.search.aggregations.AggregatorFactories.createTopLevelAggregators(AggregatorFactories.java:123)\n        at org.elasticsearch.search.aggregations.AggregationPhase.preProcess(AggregationPhase.java:79)\n        at org.elasticsearch.search.query.QueryPhase.preProcess(QueryPhase.java:91)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:502)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:474)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:467)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:239)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:202)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:80)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:216)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:203)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:186)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:724)\n[2014-07-17 07:46:49,178][DEBUG][action.search.type       ] [Dragonfly] [blah][26], node[C9YP6YFJQ2alZpUfevE73g], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@46e0309e] lastShard [true]\njava.lang.ArrayIndexOutOfBoundsException: 0\n        at org.elasticsearch.common.util.BigArrays$ObjectArrayWrapper.set(BigArrays.java:264)\n        at org.elasticsearch.search.aggregations.AggregatorFactories$1.<init>(AggregatorFactories.java:68)\n        at org.elasticsearch.search.aggregations.AggregatorFactories.createSubAggregators(AggregatorFactories.java:62)\n        at org.elasticsearch.search.aggregations.Aggregator.<init>(Aggregator.java:78)\n        at org.elasticsearch.search.aggregations.bucket.BucketsAggregator.<init>(BucketsAggregator.java:46)\n        at org.elasticsearch.search.aggregations.bucket.terms.StringTermsAggregator.<init>(StringTermsAggregator.java:64)\n        at org.elasticsearch.search.aggregations.bucket.terms.StringTermsAggregator$WithOrdinals.<init>(StringTermsAggregator.java:264)\n        at org.elasticsearch.search.aggregations.bucket.terms.TermsAggregatorFactory.create(TermsAggregatorFactory.java:111)\n        at org.elasticsearch.search.aggregations.support.ValueSourceAggregatorFactory.create(ValueSourceAggregatorFactory.java:58)\n        at org.elasticsearch.search.aggregations.AggregatorFactories.createTopLevelAggregators(AggregatorFactories.java:123)\n        at org.elasticsearch.search.aggregations.AggregationPhase.preProcess(AggregationPhase.java:79)\n        at org.elasticsearch.search.query.QueryPhase.preProcess(QueryPhase.java:91)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:502)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:474)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:467)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:239)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:202)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:80)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:216)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:203)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:186)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:724)\n[2014-07-17 07:46:49,287][DEBUG][action.search.type       ] [Dragonfly] [blah][20], node[C9YP6YFJQ2alZpUfevE73g], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@46e0309e] lastShard [true]\njava.lang.ArrayIndexOutOfBoundsException: 0\n        at org.elasticsearch.common.util.BigArrays$ObjectArrayWrapper.set(BigArrays.java:264)\n        at org.elasticsearch.search.aggregations.AggregatorFactories$1.<init>(AggregatorFactories.java:68)\n        at org.elasticsearch.search.aggregations.AggregatorFactories.createSubAggregators(AggregatorFactories.java:62)\n        at org.elasticsearch.search.aggregations.Aggregator.<init>(Aggregator.java:78)\n        at org.elasticsearch.search.aggregations.bucket.BucketsAggregator.<init>(BucketsAggregator.java:46)\n        at org.elasticsearch.search.aggregations.bucket.terms.StringTermsAggregator.<init>(StringTermsAggregator.java:64)\n        at org.elasticsearch.search.aggregations.bucket.terms.StringTermsAggregator$WithOrdinals.<init>(StringTermsAggregator.java:264)\n        at org.elasticsearch.search.aggregations.bucket.terms.TermsAggregatorFactory.create(TermsAggregatorFactory.java:111)\n        at org.elasticsearch.search.aggregations.support.ValueSourceAggregatorFactory.create(ValueSourceAggregatorFactory.java:58)\n        at org.elasticsearch.search.aggregations.AggregatorFactories.createTopLevelAggregators(AggregatorFactories.java:123)\n        at org.elasticsearch.search.aggregations.AggregationPhase.preProcess(AggregationPhase.java:79)\n        at org.elasticsearch.search.query.QueryPhase.preProcess(QueryPhase.java:91)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:502)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:474)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:467)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:239)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:202)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:80)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:216)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:203)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction$2.run(TransportSearchTypeAction.java:186)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:724)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49306923","html_url":"https://github.com/elastic/elasticsearch/issues/6900#issuecomment-49306923","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6900","id":49306923,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzA2OTIz","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-17T13:35:17Z","updated_at":"2014-07-17T13:35:17Z","author_association":"CONTRIBUTOR","body":"@jpountz please could you take a look at this one?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/49308985","html_url":"https://github.com/elastic/elasticsearch/issues/6900#issuecomment-49308985","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6900","id":49308985,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MzA4OTg1","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-07-17T13:52:30Z","updated_at":"2014-07-17T13:52:30Z","author_association":"CONTRIBUTOR","body":"@clintongormley This one is different from #5048\n\n@praj2 This bug is fixed in recents releases of Elasticsearch.\n","performed_via_github_app":null}]