{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20178","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20178/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20178/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20178/events","html_url":"https://github.com/elastic/elasticsearch/issues/20178","id":173466526,"node_id":"MDU6SXNzdWUxNzM0NjY1MjY=","number":20178,"title":"Deterministic implementation of the cardinality aggregation stage for low-cardinality fields","user":{"login":"pfreixes","id":1226121,"node_id":"MDQ6VXNlcjEyMjYxMjE=","avatar_url":"https://avatars0.githubusercontent.com/u/1226121?v=4","gravatar_id":"","url":"https://api.github.com/users/pfreixes","html_url":"https://github.com/pfreixes","followers_url":"https://api.github.com/users/pfreixes/followers","following_url":"https://api.github.com/users/pfreixes/following{/other_user}","gists_url":"https://api.github.com/users/pfreixes/gists{/gist_id}","starred_url":"https://api.github.com/users/pfreixes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pfreixes/subscriptions","organizations_url":"https://api.github.com/users/pfreixes/orgs","repos_url":"https://api.github.com/users/pfreixes/repos","events_url":"https://api.github.com/users/pfreixes/events{/privacy}","received_events_url":"https://api.github.com/users/pfreixes/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2016-08-26T14:28:41Z","updated_at":"2017-03-21T14:52:23Z","closed_at":"2017-03-21T14:52:23Z","author_association":"NONE","active_lock_reason":null,"body":"Currently ES only supports a none deterministic algorithm called `Hyperloglog++` to compute on query time the cardinality of a field. The implementation claims to work very well for high-cardinality sets with an impact in terms of memory space constant, and configurable through the `precision_threshold`  attribute.\n\nThe issue here comes with low-cardinality fields, even thought `Hyperloglog++` claims to work with a excellent accuracy with them also. Current implementation can guarantee - correct me if Im wrong - a zero percentage of errors due the implementation.\n\nThe idea here is give to the user, up his responsibility and his own risk, a new implementation based on a determinist algorithm  - such as a hash implementation with collision support or a bitmap with the ordinals of this field- to get always a precision number of the cardinality. Regarding low-cardinality fields with a none high impact in memory.\n\nSome defensive mechanisms can be implemented, such as give an attribute to configure the maximum number of elements allocatable per default, u others.\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}