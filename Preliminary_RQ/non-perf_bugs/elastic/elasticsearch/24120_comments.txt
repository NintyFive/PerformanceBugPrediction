[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294255399","html_url":"https://github.com/elastic/elasticsearch/issues/24120#issuecomment-294255399","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24120","id":294255399,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDI1NTM5OQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-14T23:29:31Z","updated_at":"2017-04-14T23:29:31Z","author_association":"MEMBER","body":"This does not sound right, we [mark](https://github.com/elastic/elasticsearch/blob/v5.3.0/distribution/build.gradle#L407) it as a configuration file and I'm pretty sure that we have a test for it. I will check on Monday. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294255647","html_url":"https://github.com/elastic/elasticsearch/issues/24120#issuecomment-294255647","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24120","id":294255647,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDI1NTY0Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-14T23:31:56Z","updated_at":"2017-04-14T23:31:56Z","author_association":"MEMBER","body":"What version was the upgrade from and to?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294291313","html_url":"https://github.com/elastic/elasticsearch/issues/24120#issuecomment-294291313","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24120","id":294291313,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDI5MTMxMw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-15T12:48:49Z","updated_at":"2017-04-15T12:48:49Z","author_association":"MEMBER","body":"I tested this and everything behaved as expected. Specifically, I installed Elasticsearch 5.2.1, edited the log4j2.properties, upgraded to Elasticsearch 5.2.2, and the modifications that I made were still present. I then upgraded to Elasticsearch 5.3.0, and the modifications that I made were still present. The reason that I tested a second upgrade is because we shipped a new log4j2.properties file starting in Elasticsearch 5.3.0 and the expected behavior here is not that the new configuration file would overwrite the existing configuration file (if there were modifications) but would instead be saved alongside the existing configuration file so that an end-user has the option to merge the new package-provided configuration file with their existing configuration file if they so desire. This is exactly what happened.\r\n\r\nCentOS 6:\r\n\r\n```\r\ncentos-6:/home/vagrant$ rpm -i elasticsearch-5.2.1.rpm \r\nwarning: elasticsearch-5.2.1.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY\r\nCreating elasticsearch group... OK\r\nCreating elasticsearch user... OK\r\n### NOT starting on installation, please execute the following statements to configure elasticsearch service to start automatically using chkconfig\r\n sudo chkconfig --add elasticsearch\r\n### You can start elasticsearch service by executing\r\n sudo service elasticsearch start\r\ncentos-6:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = info\r\ncentos-6:/home/vagrant$ perl -p -i -e 's/info/debug/g' /etc/elasticsearch/log4j2.properties\r\ncentos-6:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\ncentos-6:/home/vagrant$ rpm -U elasticsearch-5.2.2.rpm \r\nwarning: elasticsearch-5.2.2.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY\r\ncentos-6:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\ncentos-6:/home/vagrant$ rpm -U elasticsearch-5.3.0.rpm \r\nwarning: elasticsearch-5.3.0.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY\r\nwarning: /etc/elasticsearch/log4j2.properties created as /etc/elasticsearch/log4j2.properties.rpmnew\r\ncentos-6:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\ncentos-6:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties.rpmnew \r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = info\r\ncentos-6:/home/vagrant$ \r\n```\r\n\r\nCentOS 7:\r\n\r\n```\r\ncentos-7:/home/vagrant$ rpm -i elasticsearch-5.2.1.rpm \r\nwarning: elasticsearch-5.2.1.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY\r\nCreating elasticsearch group... OK\r\nCreating elasticsearch user... OK\r\n### NOT starting on installation, please execute the following statements to configure elasticsearch service to start automatically using systemd\r\n sudo systemctl daemon-reload\r\n sudo systemctl enable elasticsearch.service\r\n### You can start elasticsearch service by executing\r\n sudo systemctl start elasticsearch.service\r\ncentos-7:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = info\r\ncentos-7:/home/vagrant$ perl -p -i -e 's/info/debug/g' /etc/elasticsearch/log4j2.properties\r\ncentos-7:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\ncentos-7:/home/vagrant$ rpm -U elasticsearch-5.2.2.rpm \r\nwarning: elasticsearch-5.2.2.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY\r\ncentos-7:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\ncentos-7:/home/vagrant$ rpm -U elasticsearch-5.3.0.rpm \r\nwarning: elasticsearch-5.3.0.rpm: Header V4 RSA/SHA512 Signature, key ID d88e42b4: NOKEY\r\nwarning: /etc/elasticsearch/log4j2.properties created as /etc/elasticsearch/log4j2.properties.rpmnew\r\ncentos-7:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\ncentos-7:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties.rpmnew \r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = info\r\n```\r\n\r\nUbuntu 14.04:\r\n\r\n```\r\nubuntu-1404:/home/vagrant$ dpkg -i elasticsearch-5.2.1.deb \r\nSelecting previously unselected package elasticsearch.\r\n(Reading database ... 145976 files and directories currently installed.)\r\nPreparing to unpack elasticsearch-5.2.1.deb ...\r\nCreating elasticsearch group... OK\r\nCreating elasticsearch user... OK\r\nUnpacking elasticsearch (5.2.1) ...\r\nSetting up elasticsearch (5.2.1) ...\r\nProcessing triggers for ureadahead (0.100.0-16) ...\r\nureadahead will be reprofiled on next reboot\r\nubuntu-1404:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = info\r\nubuntu-1404:/home/vagrant$ perl -p -i -e 's/info/debug/g' /etc/elasticsearch/log4j2.properties\r\nubuntu-1404:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\nubuntu-1404:/home/vagrant$ dpkg -i elasticsearch-5.2.2.deb \r\n(Reading database ... 146101 files and directories currently installed.)\r\nPreparing to unpack elasticsearch-5.2.2.deb ...\r\nUnpacking elasticsearch (5.2.2) over (5.2.1) ...\r\nSetting up elasticsearch (5.2.2) ...\r\nInstalling new version of config file /usr/lib/systemd/system/elasticsearch.service ...\r\nProcessing triggers for ureadahead (0.100.0-16) ...\r\nubuntu-1404:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\nubuntu-1404:/home/vagrant$ dpkg -i elasticsearch-5.3.0.deb \r\n(Reading database ... 146101 files and directories currently installed.)\r\nPreparing to unpack elasticsearch-5.3.0.deb ...\r\nUnpacking elasticsearch (5.3.0) over (5.2.2) ...\r\nSetting up elasticsearch (5.3.0) ...\r\nInstalling new version of config file /etc/elasticsearch/jvm.options ...\r\n\r\nConfiguration file '/etc/elasticsearch/log4j2.properties'\r\n ==> Modified (by you or by a script) since installation.\r\n ==> Package distributor has shipped an updated version.\r\n   What would you like to do about it ?  Your options are:\r\n    Y or I  : install the package maintainer's version\r\n    N or O  : keep your currently-installed version\r\n      D     : show the differences between the versions\r\n      Z     : start a shell to examine the situation\r\n The default action is to keep your current version.\r\n*** log4j2.properties (Y/I/N/O/D/Z) [default=N] ? N\r\nInstalling new version of config file /usr/lib/systemd/system/elasticsearch.service ...\r\nProcessing triggers for ureadahead (0.100.0-16) ...\r\nubuntu-1404:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\nubuntu-1404:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties.dpkg-dist \r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = info\r\n```\r\n\r\nUbuntu 16.04:\r\n\r\n```\r\nubuntu-1604:/home/vagrant$ dpkg -i elasticsearch-5.2.1.deb \r\nSelecting previously unselected package elasticsearch.\r\n(Reading database ... 117778 files and directories currently installed.)\r\nPreparing to unpack elasticsearch-5.2.1.deb ...\r\nCreating elasticsearch group... OK\r\nCreating elasticsearch user... OK\r\nUnpacking elasticsearch (5.2.1) ...\r\nSetting up elasticsearch (5.2.1) ...\r\nProcessing triggers for systemd (229-4ubuntu16) ...\r\nProcessing triggers for ureadahead (0.100.0-19) ...\r\nubuntu-1604:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = info\r\nubuntu-1604:/home/vagrant$ perl -p -i -e 's/info/debug/g' /etc/elasticsearch/log4j2.properties\r\nubuntu-1604:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\nubuntu-1604:/home/vagrant$ dpkg -i elasticsearch-5.2.2.deb \r\n(Reading database ... 117903 files and directories currently installed.)\r\nPreparing to unpack elasticsearch-5.2.2.deb ...\r\nUnpacking elasticsearch (5.2.2) over (5.2.1) ...\r\nSetting up elasticsearch (5.2.2) ...\r\nInstalling new version of config file /usr/lib/systemd/system/elasticsearch.service ...\r\nProcessing triggers for systemd (229-4ubuntu16) ...\r\nProcessing triggers for ureadahead (0.100.0-19) ...\r\nubuntu-1604:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\nubuntu-1604:/home/vagrant$ dpkg -i elasticsearch-5.3.0.deb \r\n(Reading database ... 117903 files and directories currently installed.)\r\nPreparing to unpack elasticsearch-5.3.0.deb ...\r\nUnpacking elasticsearch (5.3.0) over (5.2.2) ...\r\nSetting up elasticsearch (5.3.0) ...\r\nInstalling new version of config file /etc/elasticsearch/jvm.options ...\r\n\r\nConfiguration file '/etc/elasticsearch/log4j2.properties'\r\n ==> Modified (by you or by a script) since installation.\r\n ==> Package distributor has shipped an updated version.\r\n   What would you like to do about it ?  Your options are:\r\n    Y or I  : install the package maintainer's version\r\n    N or O  : keep your currently-installed version\r\n      D     : show the differences between the versions\r\n      Z     : start a shell to examine the situation\r\n The default action is to keep your current version.\r\n*** log4j2.properties (Y/I/N/O/D/Z) [default=N] ? N\r\nInstalling new version of config file /usr/lib/systemd/system/elasticsearch.service ...\r\nProcessing triggers for systemd (229-4ubuntu16) ...\r\nProcessing triggers for ureadahead (0.100.0-19) ...\r\nubuntu-1604:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties\r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = debug\r\nubuntu-1604:/home/vagrant$ grep \"\\(debug\\|info\\)\" /etc/elasticsearch/log4j2.properties.dpkg-dist \r\n# log action execution errors for easier debugging\r\nlogger.action.level = debug\r\nrootLogger.level = info\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294291343","html_url":"https://github.com/elastic/elasticsearch/issues/24120#issuecomment-294291343","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24120","id":294291343,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDI5MTM0Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-15T12:49:28Z","updated_at":"2017-04-15T12:49:28Z","author_association":"MEMBER","body":"@seang-es We will need more details including a reproduction to further triage this one.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/297221710","html_url":"https://github.com/elastic/elasticsearch/issues/24120#issuecomment-297221710","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24120","id":297221710,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzIyMTcxMA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-26T02:44:08Z","updated_at":"2017-04-26T02:44:08Z","author_association":"MEMBER","body":"No additional feedback, closing.","performed_via_github_app":null}]