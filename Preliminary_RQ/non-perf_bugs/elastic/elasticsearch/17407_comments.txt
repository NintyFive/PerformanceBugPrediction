[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/213364540","html_url":"https://github.com/elastic/elasticsearch/issues/17407#issuecomment-213364540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17407","id":213364540,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMzM2NDU0MA==","user":{"login":"smithsimonj","id":6840292,"node_id":"MDQ6VXNlcjY4NDAyOTI=","avatar_url":"https://avatars1.githubusercontent.com/u/6840292?v=4","gravatar_id":"","url":"https://api.github.com/users/smithsimonj","html_url":"https://github.com/smithsimonj","followers_url":"https://api.github.com/users/smithsimonj/followers","following_url":"https://api.github.com/users/smithsimonj/following{/other_user}","gists_url":"https://api.github.com/users/smithsimonj/gists{/gist_id}","starred_url":"https://api.github.com/users/smithsimonj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smithsimonj/subscriptions","organizations_url":"https://api.github.com/users/smithsimonj/orgs","repos_url":"https://api.github.com/users/smithsimonj/repos","events_url":"https://api.github.com/users/smithsimonj/events{/privacy}","received_events_url":"https://api.github.com/users/smithsimonj/received_events","type":"User","site_admin":false},"created_at":"2016-04-22T09:59:54Z","updated_at":"2016-04-22T09:59:54Z","author_association":"NONE","body":"I also see the above problem in Elastic 2.3.1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/219089995","html_url":"https://github.com/elastic/elasticsearch/issues/17407#issuecomment-219089995","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17407","id":219089995,"node_id":"MDEyOklzc3VlQ29tbWVudDIxOTA4OTk5NQ==","user":{"login":"smithsimonj","id":6840292,"node_id":"MDQ6VXNlcjY4NDAyOTI=","avatar_url":"https://avatars1.githubusercontent.com/u/6840292?v=4","gravatar_id":"","url":"https://api.github.com/users/smithsimonj","html_url":"https://github.com/smithsimonj","followers_url":"https://api.github.com/users/smithsimonj/followers","following_url":"https://api.github.com/users/smithsimonj/following{/other_user}","gists_url":"https://api.github.com/users/smithsimonj/gists{/gist_id}","starred_url":"https://api.github.com/users/smithsimonj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smithsimonj/subscriptions","organizations_url":"https://api.github.com/users/smithsimonj/orgs","repos_url":"https://api.github.com/users/smithsimonj/repos","events_url":"https://api.github.com/users/smithsimonj/events{/privacy}","received_events_url":"https://api.github.com/users/smithsimonj/received_events","type":"User","site_admin":false},"created_at":"2016-05-13T16:16:56Z","updated_at":"2016-05-13T16:18:08Z","author_association":"NONE","body":"Any news on this ticket?\n\nI also see a related bug on this data:\n\n```\n{\"type\": \"polygon\", \"coordinates\": [[[-100.7193347, 37.9217785], [-100.7180306, 37.9207239], [-100.7180379, 37.9202649], [-100.715946, 37.9185112], [-100.7181033, 37.91686], [-100.7208637, 37.9161565], [-100.7264067, 37.9162093], [-100.7290355, 37.9182905], [-100.7289411, 37.9254825], [-100.7370413, 37.9320032], [-100.7344506, 37.9340071], [-100.7299369, 37.9304726], [-100.7249065, 37.9343839], [-100.7248924, 37.944431], [-100.7202908, 37.944422], [-100.7199423, 37.9439893], [-100.7199856, 37.9341727], [-100.7199863, 37.9340851], [-100.7199081, 37.9340847], [-100.7199087, 37.9340092], [-100.7199091, 37.9339619], [-100.7194596, 37.9340074], [-100.7186862, 37.9340038], [-100.7187256, 37.9288659], [-100.7194599, 37.9288675], [-100.7196063, 37.9288697], [-100.7196066, 37.9287782], [-100.7200695, 37.9287791], [-100.7200696, 37.9287473], [-100.7201195, 37.9287474], [-100.7201239, 37.9285088], [-100.7196, 37.9285077], [-100.7196003, 37.9284157], [-100.719624, 37.9282132], [-100.7196325, 37.927568], [-100.7198495, 37.9275697], [-100.7198458, 37.9272774], [-100.7197668, 37.9272145], [-100.7198542, 37.9271518], [-100.7198613, 37.9271555], [-100.7198696, 37.9271479], [-100.7199004, 37.9271347], [-100.7199004, 37.9271115], [-100.7199739, 37.9271115], [-100.7197711, 37.9271115], [-100.719771, 37.9270036], [-100.7197264, 37.9270037], [-100.7197264, 37.9269267], [-100.7197708, 37.9269266], [-100.7197707, 37.9267495], [-100.7198207, 37.9267495], [-100.7198197, 37.9267195], [-100.7197613, 37.9267195], [-100.7197614, 37.9265483], [-100.7197653, 37.9263681], [-100.7192492, 37.9263589], [-100.718921, 37.9263575], [-100.7189234, 37.9260172], [-100.7184264, 37.9260161], [-100.7184245, 37.9258315], [-100.7184284, 37.9253979], [-100.7191241, 37.9254001], [-100.719126, 37.9253251], [-100.7191263, 37.9251287], [-100.7191306, 37.9247127], [-100.719131, 37.9246704], [-100.7193174, 37.9235621], [-100.7193347, 37.9217785]]]}\n```\n\nError is:\n\n```\nMapperParsingException[failed to parse [location]]; nested: InvalidShapeException[Self-intersection at or near point (-100.7199739, 37.9271115, NaN)];\n    at org.elasticsearch.index.mapper.geo.GeoShapeFieldMapper.parse(GeoShapeFieldMapper.java:463)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:309)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:326)\n    at org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:252)\n    at org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:122)\n    at org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:309)\n    at org.elasticsearch.index.shard.IndexShard.prepareCreate(IndexShard.java:529)\n    at org.elasticsearch.index.shard.IndexShard.prepareCreateOnPrimary(IndexShard.java:506)\n    at org.elasticsearch.action.index.TransportIndexAction.prepareIndexOperationOnPrimary(TransportIndexAction.java:215)\n    at org.elasticsearch.action.index.TransportIndexAction.executeIndexRequestOnPrimary(TransportIndexAction.java:224)\n    at org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:158)\n    at org.elasticsearch.action.index.TransportIndexAction.shardOperationOnPrimary(TransportIndexAction.java:66)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.doRun(TransportReplicationAction.java:639)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:279)\n    at org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:271)\n    at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:75)\n    at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\n    at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: com.spatial4j.core.exception.InvalidShapeException: Self-intersection at or near point (-100.7199739, 37.9271115, NaN)\n    at com.spatial4j.core.shape.jts.JtsGeometry.validate(JtsGeometry.java:125)\n    at org.elasticsearch.common.geo.builders.ShapeBuilder.jtsGeometry(ShapeBuilder.java:94)\n    at org.elasticsearch.common.geo.builders.BasePolygonBuilder.build(BasePolygonBuilder.java:165)\n    at org.elasticsearch.index.mapper.geo.GeoShapeFieldMapper.parse(GeoShapeFieldMapper.java:446)\n    ... 21 more\n```\n\nOn elastic 2.3.2\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/224424206","html_url":"https://github.com/elastic/elasticsearch/issues/17407#issuecomment-224424206","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17407","id":224424206,"node_id":"MDEyOklzc3VlQ29tbWVudDIyNDQyNDIwNg==","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2016-06-07T21:44:33Z","updated_at":"2016-06-07T21:45:07Z","author_association":"CONTRIBUTOR","body":"Thanks for the issue @smithsimonj \n\nThe second parse exception is not a bug. If you look close at the shape there is a self intersection at `[-100.7199739, 37.9271115]`. Remove that coordinate and ES is happy.\n\n![self-intersection](https://cloud.githubusercontent.com/assets/830187/15875554/21ec45a6-2cce-11e6-8ed8-a0583f5d45e0.png)\n\nI'll dig deeper into the Antarctica parse exception. At quick glance there are a handful of coordinates at `180.000000000000171` longitude. This meridian gets translated to a valid -179.999999999999829.  There is a close point at `[-179.999999999999886, -90.0]`. So its possible this is suffering from round-off error but I'll look closer.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/353002163","html_url":"https://github.com/elastic/elasticsearch/issues/17407#issuecomment-353002163","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17407","id":353002163,"node_id":"MDEyOklzc3VlQ29tbWVudDM1MzAwMjE2Mw==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2017-12-20T08:50:31Z","updated_at":"2017-12-20T08:50:31Z","author_association":"CONTRIBUTOR","body":"This is a tricky one, but the provided outline of Antarctica is technically _not_ valid GeoJSON because it is oriented clockwise whereas https://tools.ietf.org/html/rfc7946#section-3.1.6 says:\r\n\r\n```\r\n   o  A linear ring MUST follow the right-hand rule with respect to the\r\n      area it bounds, i.e., exterior rings are counterclockwise, and\r\n      holes are clockwise.\r\n```\r\n\r\nIt's tricky because ES silently accepts incorrectly-oriented polygons that cross ≤180° of longitude, which is most countries, but Antarctica crosses every line of longitude so this leniency doesn't work any more. Unfortunately, the resulting error message isn't helpful in determining that this was the problem.\r\n\r\nThe fix is either to correct the orientation of the data to follow the spec, or to alter the mapping to include `\"orientation\": \"clockwise\"`. With that change to the mapping, the provided outline is accepted by ES.\r\n\r\nI'm going to close this issue and take up the question of how to improve the error message over on #27832.","performed_via_github_app":null}]