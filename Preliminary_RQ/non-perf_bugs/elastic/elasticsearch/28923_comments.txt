[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/371128893","html_url":"https://github.com/elastic/elasticsearch/issues/28923#issuecomment-371128893","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28923","id":371128893,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MTEyODg5Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-07T12:52:40Z","updated_at":"2018-03-07T12:52:40Z","author_association":"MEMBER","body":"We have a [test case](https://github.com/elastic/elasticsearch/blob/v6.0.1/modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java#L71-L75) that tests that `HEAD` requests for an existing index operate correctly.\r\n\r\nThis is not to say that there is not a bug here, but it is to say that without a correlating log message or a reproduction, we are unlikely to make much progress on this issue. Do you have anything here? What happens if you send the request without `GET` instead of `HEAD`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/371129083","html_url":"https://github.com/elastic/elasticsearch/issues/28923#issuecomment-371129083","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28923","id":371129083,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MTEyOTA4Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-07T12:53:19Z","updated_at":"2018-03-07T12:53:19Z","author_association":"MEMBER","body":"FYI @elastic/es-core-infra.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/371137321","html_url":"https://github.com/elastic/elasticsearch/issues/28923#issuecomment-371137321","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28923","id":371137321,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MTEzNzMyMQ==","user":{"login":"kevcodez","id":14073399,"node_id":"MDQ6VXNlcjE0MDczMzk5","avatar_url":"https://avatars3.githubusercontent.com/u/14073399?v=4","gravatar_id":"","url":"https://api.github.com/users/kevcodez","html_url":"https://github.com/kevcodez","followers_url":"https://api.github.com/users/kevcodez/followers","following_url":"https://api.github.com/users/kevcodez/following{/other_user}","gists_url":"https://api.github.com/users/kevcodez/gists{/gist_id}","starred_url":"https://api.github.com/users/kevcodez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kevcodez/subscriptions","organizations_url":"https://api.github.com/users/kevcodez/orgs","repos_url":"https://api.github.com/users/kevcodez/repos","events_url":"https://api.github.com/users/kevcodez/events{/privacy}","received_events_url":"https://api.github.com/users/kevcodez/received_events","type":"User","site_admin":false},"created_at":"2018-03-07T13:25:34Z","updated_at":"2018-03-07T13:26:25Z","author_association":"NONE","body":"@jasontedor Same goes for GET - 400 bad request with empty response. Executing both GET and HEAD via curl against the ES instance did just fine.\r\n\r\nSwitchting to the basic apache http client with the same request URL resulted in a 200 OK rather than 400. This was just getting more strange, as I could not reproduce this locally.\r\n\r\nI will try to get some logs out of the AWS service by tomorrow, I cannot access the logs today.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/371161397","html_url":"https://github.com/elastic/elasticsearch/issues/28923#issuecomment-371161397","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28923","id":371161397,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MTE2MTM5Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-03-07T14:47:22Z","updated_at":"2018-03-07T14:47:22Z","author_association":"MEMBER","body":"Do you have a proxy between the client and the instance? There might be a problem with that here; I did just now test the client through a proxy and I had no troubles, but maybe your proxy configuration is different.\r\n\r\nThis worked fine for me:\r\n\r\n```java\r\npublic class Head {\r\n\r\n    public static void main(String[] args) throws IOException {\r\n        final HttpHost host = new HttpHost(\"<redacted>\", 9243, \"https\");\r\n        final Header header = new BasicHeader(\"Authorization\", \"Basic <redacted>\");\r\n        try (RestClient client = RestClient.builder(host).setDefaultHeaders(new Header[] { header }).build()) {\r\n            final Response response = client.performRequest(\"HEAD\", \"/metricbeat-6.2.1-2018.03.07\", Collections.emptyMap());\r\n            System.out.println(response.getStatusLine());\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nwhere the address I used here is a proxy.\r\n\r\nOutput:\r\n\r\n```\r\n09:44:56 [jason:~/src/jasontedor/head] $ ./gradlew run\r\n\r\n> Task :run \r\nHTTP/1.1 200 OK\r\n\r\n\r\nBUILD SUCCESSFUL in 1s\r\n2 actionable tasks: 2 executed\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/380233256","html_url":"https://github.com/elastic/elasticsearch/issues/28923#issuecomment-380233256","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28923","id":380233256,"node_id":"MDEyOklzc3VlQ29tbWVudDM4MDIzMzI1Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-04-10T20:19:07Z","updated_at":"2018-04-10T20:19:07Z","author_association":"MEMBER","body":"No additional feedback, closing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/394552860","html_url":"https://github.com/elastic/elasticsearch/issues/28923#issuecomment-394552860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28923","id":394552860,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NDU1Mjg2MA==","user":{"login":"gskoropada","id":8730079,"node_id":"MDQ6VXNlcjg3MzAwNzk=","avatar_url":"https://avatars3.githubusercontent.com/u/8730079?v=4","gravatar_id":"","url":"https://api.github.com/users/gskoropada","html_url":"https://github.com/gskoropada","followers_url":"https://api.github.com/users/gskoropada/followers","following_url":"https://api.github.com/users/gskoropada/following{/other_user}","gists_url":"https://api.github.com/users/gskoropada/gists{/gist_id}","starred_url":"https://api.github.com/users/gskoropada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gskoropada/subscriptions","organizations_url":"https://api.github.com/users/gskoropada/orgs","repos_url":"https://api.github.com/users/gskoropada/repos","events_url":"https://api.github.com/users/gskoropada/events{/privacy}","received_events_url":"https://api.github.com/users/gskoropada/received_events","type":"User","site_admin":false},"created_at":"2018-06-05T01:39:15Z","updated_at":"2018-06-05T01:39:15Z","author_association":"NONE","body":"@kevcodez I've just came across the same issue and figured out that the problem was a missing `/` in the URI.\r\nIt worked fine with a local Elasticsearch docker container, but got 400s from AWS.\r\nWhen I added that `/` it worked just fine.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/411395669","html_url":"https://github.com/elastic/elasticsearch/issues/28923#issuecomment-411395669","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28923","id":411395669,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMTM5NTY2OQ==","user":{"login":"aug24","id":5476326,"node_id":"MDQ6VXNlcjU0NzYzMjY=","avatar_url":"https://avatars3.githubusercontent.com/u/5476326?v=4","gravatar_id":"","url":"https://api.github.com/users/aug24","html_url":"https://github.com/aug24","followers_url":"https://api.github.com/users/aug24/followers","following_url":"https://api.github.com/users/aug24/following{/other_user}","gists_url":"https://api.github.com/users/aug24/gists{/gist_id}","starred_url":"https://api.github.com/users/aug24/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aug24/subscriptions","organizations_url":"https://api.github.com/users/aug24/orgs","repos_url":"https://api.github.com/users/aug24/repos","events_url":"https://api.github.com/users/aug24/events{/privacy}","received_events_url":"https://api.github.com/users/aug24/received_events","type":"User","site_admin":false},"created_at":"2018-08-08T12:57:28Z","updated_at":"2018-08-10T11:40:30Z","author_association":"NONE","body":"I'll add to this for posterity, as it's taken me ~15 hours to work this one out:\r\n\r\nWhen making a new high level ElasticSearch java client, and making requests via the underlying low level client, to an AWS ELB/ALB, failure to put the leading slash on the URI will result in a 400 from the ELB/ALB, *EVEN THOUGH* direct connections (eg your test database) will work just fine.\r\n\r\nThe line causing the problem is (I think)\r\nhttps://github.com/elastic/elasticsearch/blob/master/client/rest/src/main/java/org/elasticsearch/client/RestClient.java#L806\r\n\r\nWhich ought to be replaced with a check to see if the path begins with \"/\" and prepends it if not.\r\n\r\n[edit]\r\n\r\nJust found out that this was discussed here: https://github.com/elastic/elasticsearch/pull/30119#issuecomment-384272558\r\n\r\nThe official 'fix' is to use the 'pathPrefix' option to always prepend with \"/\".  The 'benefit' of this approach is that users can make invalid requests if they really really want to!\r\n\r\nThe remaining problem is that your error will simply be a 400 from AWS because the request is not valid HTTP, so if you are here reading this, then I hope I have improved your day!","performed_via_github_app":null}]