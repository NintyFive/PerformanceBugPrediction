[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323128643","html_url":"https://github.com/elastic/elasticsearch/issues/26256#issuecomment-323128643","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26256","id":323128643,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzEyODY0Mw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-08-17T16:42:36Z","updated_at":"2017-08-17T16:42:36Z","author_association":"CONTRIBUTOR","body":"Sorry I don't understand what the bug is, can you explain what your expectations are and what you get?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323251777","html_url":"https://github.com/elastic/elasticsearch/issues/26256#issuecomment-323251777","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26256","id":323251777,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzI1MTc3Nw==","user":{"login":"forestlcoder","id":26137810,"node_id":"MDQ6VXNlcjI2MTM3ODEw","avatar_url":"https://avatars0.githubusercontent.com/u/26137810?v=4","gravatar_id":"","url":"https://api.github.com/users/forestlcoder","html_url":"https://github.com/forestlcoder","followers_url":"https://api.github.com/users/forestlcoder/followers","following_url":"https://api.github.com/users/forestlcoder/following{/other_user}","gists_url":"https://api.github.com/users/forestlcoder/gists{/gist_id}","starred_url":"https://api.github.com/users/forestlcoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/forestlcoder/subscriptions","organizations_url":"https://api.github.com/users/forestlcoder/orgs","repos_url":"https://api.github.com/users/forestlcoder/repos","events_url":"https://api.github.com/users/forestlcoder/events{/privacy}","received_events_url":"https://api.github.com/users/forestlcoder/received_events","type":"User","site_admin":false},"created_at":"2017-08-18T03:45:35Z","updated_at":"2017-08-18T03:47:26Z","author_association":"NONE","body":"Expectations:if the document is not existed ,the source int the hits should not be empty\r\nActually:if the document is not existed ,the source int the hits is empty actually\r\nthe upsert code as follows:\r\n`for (Map<String, Object> rsData : finalList) {\r\n//\t\t\t\t将_id设置为task_order_id\r\n\t\t\t\tif (!StringUtils.isEmpty(rsData.get(\"task_order_id\"))) {//排除task_order_id不为空和null的情况\r\n\t\t\t\t\tString s = (String) rsData.get(\"task_order_id\");\r\n\t\t\t\t\ts = deleteQuotes(s);\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tindexReq = new IndexRequest(\"m-new-worder\", Type)\r\n\t\t\t\t\t\t\t\t.source(XContentFactory.jsonBuilder()\r\n\t\t\t\t\t\t\t\t\t\t.startObject()\r\n\t\t\t\t\t\t\t\t.endObject());\r\n\t\t\t\t\t} catch (IOException e1) {\r\n\t\t\t\t\t\te1.printStackTrace();\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tupdateReq = new UpdateRequest(\"m-new-worder\", Type, String.valueOf(s))\r\n\t\t\t\t\t\t\t.doc(XContentFactory.jsonBuilder()\r\n\t\t\t\t\t\t\t\t.map(rsData))\r\n\t\t\t\t\t\t\t.upsert(indexReq);\r\n\t\t\t\t\t} catch (IOException e) {\r\n\t\t\t\t\t\te.printStackTrace();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbulkReq.add(updateReq);\r\n\t\t\t\t}\r\n\t\t\t}`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323301772","html_url":"https://github.com/elastic/elasticsearch/issues/26256#issuecomment-323301772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26256","id":323301772,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzMwMTc3Mg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2017-08-18T09:08:53Z","updated_at":"2017-08-18T09:08:53Z","author_association":"MEMBER","body":"If the document does not already exist, the contents of the upsert element will be inserted as a new document. In your case, upsert is set to `indexReq` which is an `IndexRequest` with empty source. That's why you have an empty document after the first execution. If you execute it twice, the doc will be be merged with the existing empty document.\r\n\r\nMaybe https://www.elastic.co/guide/en/elasticsearch/reference/5.5/docs-update.html#_literal_doc_as_upsert_literal is what you need.","performed_via_github_app":null}]