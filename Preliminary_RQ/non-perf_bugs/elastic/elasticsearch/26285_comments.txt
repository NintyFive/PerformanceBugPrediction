[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323633024","html_url":"https://github.com/elastic/elasticsearch/issues/26285#issuecomment-323633024","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26285","id":323633024,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzYzMzAyNA==","user":{"login":"th72228120","id":9714377,"node_id":"MDQ6VXNlcjk3MTQzNzc=","avatar_url":"https://avatars3.githubusercontent.com/u/9714377?v=4","gravatar_id":"","url":"https://api.github.com/users/th72228120","html_url":"https://github.com/th72228120","followers_url":"https://api.github.com/users/th72228120/followers","following_url":"https://api.github.com/users/th72228120/following{/other_user}","gists_url":"https://api.github.com/users/th72228120/gists{/gist_id}","starred_url":"https://api.github.com/users/th72228120/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/th72228120/subscriptions","organizations_url":"https://api.github.com/users/th72228120/orgs","repos_url":"https://api.github.com/users/th72228120/repos","events_url":"https://api.github.com/users/th72228120/events{/privacy}","received_events_url":"https://api.github.com/users/th72228120/received_events","type":"User","site_admin":false},"created_at":"2017-08-21T02:35:22Z","updated_at":"2017-08-21T02:35:22Z","author_association":"NONE","body":"the same as v5.4.2, \\<em\\> tags are dislocated in the highlighted search result ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323640613","html_url":"https://github.com/elastic/elasticsearch/issues/26285#issuecomment-323640613","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26285","id":323640613,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzY0MDYxMw==","user":{"login":"th72228120","id":9714377,"node_id":"MDQ6VXNlcjk3MTQzNzc=","avatar_url":"https://avatars3.githubusercontent.com/u/9714377?v=4","gravatar_id":"","url":"https://api.github.com/users/th72228120","html_url":"https://github.com/th72228120","followers_url":"https://api.github.com/users/th72228120/followers","following_url":"https://api.github.com/users/th72228120/following{/other_user}","gists_url":"https://api.github.com/users/th72228120/gists{/gist_id}","starred_url":"https://api.github.com/users/th72228120/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/th72228120/subscriptions","organizations_url":"https://api.github.com/users/th72228120/orgs","repos_url":"https://api.github.com/users/th72228120/repos","events_url":"https://api.github.com/users/th72228120/events{/privacy}","received_events_url":"https://api.github.com/users/th72228120/received_events","type":"User","site_admin":false},"created_at":"2017-08-21T03:50:38Z","updated_at":"2017-08-21T03:50:58Z","author_association":"NONE","body":"when I use english it is repeated, too\r\n1. create a document. \r\ncurl -XPUT web1:6250/test_1/mtype/9 -d '{\"doc\":[ \"hello word =\", \"this is my hello word\", \"hello world\"]}'\r\n2. search query is:\r\n{\r\n  \"query\": {\r\n    \"multi_match\": {\r\n      \"slop\": 2,\r\n      \"fields\": [\r\n        \"doc\"\r\n      ],\r\n      \"minimum_should_match\": 1,\r\n      \"operator\": \"and\",\r\n      \"query\": \"hello world\",\r\n      \"type\": \"phrase\"\r\n    }\r\n  },\r\n  \"highlight\": {\r\n    \"fields\": {\r\n      \"doc\": {\r\n        \"fragment_size\": 180,\r\n        \"number_of_fragments\": 15\r\n      }\r\n    }\r\n  }\r\n}\r\n3. result is\r\n{\r\n        \"_index\" : \"test_1\",\r\n        \"_type\" : \"mtype\",\r\n        \"_id\" : \"9\",\r\n        \"_score\" : 3.0837474,\r\n        \"_source\" : {\r\n          \"doc\" : [\r\n            \"hello word =\",\r\n            \"this is my hello word\",\r\n            \"hello world\"\r\n          ]\r\n        },\r\n        \"highlight\" : {\r\n          \"doc\" : [\r\n            \"this is my hello wor\\<em\\>d\\</em\\>\",\r\n            \"\\<em\\>hello wor\\</em\\>ld\"\r\n          ]\r\n        }\r\n      }","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323669045","html_url":"https://github.com/elastic/elasticsearch/issues/26285#issuecomment-323669045","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26285","id":323669045,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzY2OTA0NQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-08-21T07:36:51Z","updated_at":"2017-08-21T07:36:51Z","author_association":"MEMBER","body":"Can you share the definition of the custom `ik` analyzer that you defined for the `test_1` index. I cannot reproduce the bug without this. Also can you try to use the `unified` highlighter instead and see if the bug reproduces ? The `fvh` highlighter is still maintained but we plan to remove it in favor of the `unified` highlighter in a near future. The `unified` highlighter can use term vectors to extract the offsets so the performance should be similar.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323675125","html_url":"https://github.com/elastic/elasticsearch/issues/26285#issuecomment-323675125","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26285","id":323675125,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzY3NTEyNQ==","user":{"login":"th72228120","id":9714377,"node_id":"MDQ6VXNlcjk3MTQzNzc=","avatar_url":"https://avatars3.githubusercontent.com/u/9714377?v=4","gravatar_id":"","url":"https://api.github.com/users/th72228120","html_url":"https://github.com/th72228120","followers_url":"https://api.github.com/users/th72228120/followers","following_url":"https://api.github.com/users/th72228120/following{/other_user}","gists_url":"https://api.github.com/users/th72228120/gists{/gist_id}","starred_url":"https://api.github.com/users/th72228120/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/th72228120/subscriptions","organizations_url":"https://api.github.com/users/th72228120/orgs","repos_url":"https://api.github.com/users/th72228120/repos","events_url":"https://api.github.com/users/th72228120/events{/privacy}","received_events_url":"https://api.github.com/users/th72228120/received_events","type":"User","site_admin":false},"created_at":"2017-08-21T08:06:00Z","updated_at":"2017-08-21T08:06:00Z","author_association":"NONE","body":"I download the ik analyzer from https://github.com/medcl/elasticsearch-analysis-ik/tree/v5.4.2 and my mapping is :\r\n{\r\n  \"test_1\" : {\r\n    \"mappings\" : {\r\n      \"mtype\" : {\r\n        \"properties\" : {\r\n          \"doc\" : {\r\n            \"type\" : \"text\",\r\n            \"term_vector\" : \"with_positions_offsets\",\r\n            \"analyzer\" : \"ik_max_word\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nright now I try the unified highlighter and it doesn't seems to work yet\r\nmy query is:\r\n{\r\n  \"query\": {\r\n    \"multi_match\": {\r\n      \"slop\": 2,\r\n      \"fields\": [\r\n        \"doc\"\r\n      ],\r\n      \"minimum_should_match\": 1,\r\n      \"operator\": \"and\",\r\n      \"query\": \"hello world\",\r\n      \"type\": \"phrase\"\r\n    }\r\n  },\r\n  \"highlight\": {\r\n    \"fields\": {\r\n      \"doc\": {\r\n        \"type\": \"unified\",\r\n        \"fragment_size\": 180,\r\n        \"number_of_fragments\": 15\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nthe result is :\r\n{\r\n        \"_index\" : \"test_1\",\r\n        \"_type\" : \"mtype\",\r\n        \"_id\" : \"9\",\r\n        \"_score\" : 2.1357477,\r\n        \"_source\" : {\r\n          \"doc\" : [\r\n            \"hello word = \",\r\n            \"this is my hello word\",\r\n            \"hello world\"\r\n          ]\r\n        },\r\n        \"highlight\" : {\r\n          \"doc\" : [\r\n            \"this is my hello wo\\<em\\>rd\\u0000he\\</em\\>\",\r\n            \"hel\\<em\\>lo wo\\</em\\>rld\"\r\n          ]\r\n        }\r\n      }","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323716398","html_url":"https://github.com/elastic/elasticsearch/issues/26285#issuecomment-323716398","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26285","id":323716398,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzcxNjM5OA==","user":{"login":"th72228120","id":9714377,"node_id":"MDQ6VXNlcjk3MTQzNzc=","avatar_url":"https://avatars3.githubusercontent.com/u/9714377?v=4","gravatar_id":"","url":"https://api.github.com/users/th72228120","html_url":"https://github.com/th72228120","followers_url":"https://api.github.com/users/th72228120/followers","following_url":"https://api.github.com/users/th72228120/following{/other_user}","gists_url":"https://api.github.com/users/th72228120/gists{/gist_id}","starred_url":"https://api.github.com/users/th72228120/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/th72228120/subscriptions","organizations_url":"https://api.github.com/users/th72228120/orgs","repos_url":"https://api.github.com/users/th72228120/repos","events_url":"https://api.github.com/users/th72228120/events{/privacy}","received_events_url":"https://api.github.com/users/th72228120/received_events","type":"User","site_admin":false},"created_at":"2017-08-21T11:09:54Z","updated_at":"2017-08-21T11:09:54Z","author_association":"NONE","body":"I find the problem is due to the ik analyzer.\r\nthanks a lot.","performed_via_github_app":null}]