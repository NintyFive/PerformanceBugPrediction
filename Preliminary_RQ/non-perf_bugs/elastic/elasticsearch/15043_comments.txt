[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160150602","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-160150602","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":160150602,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDE1MDYwMg==","user":{"login":"vs-adm","id":370526,"node_id":"MDQ6VXNlcjM3MDUyNg==","avatar_url":"https://avatars1.githubusercontent.com/u/370526?v=4","gravatar_id":"","url":"https://api.github.com/users/vs-adm","html_url":"https://github.com/vs-adm","followers_url":"https://api.github.com/users/vs-adm/followers","following_url":"https://api.github.com/users/vs-adm/following{/other_user}","gists_url":"https://api.github.com/users/vs-adm/gists{/gist_id}","starred_url":"https://api.github.com/users/vs-adm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vs-adm/subscriptions","organizations_url":"https://api.github.com/users/vs-adm/orgs","repos_url":"https://api.github.com/users/vs-adm/repos","events_url":"https://api.github.com/users/vs-adm/events{/privacy}","received_events_url":"https://api.github.com/users/vs-adm/received_events","type":"User","site_admin":false},"created_at":"2015-11-27T14:29:32Z","updated_at":"2015-11-27T14:29:32Z","author_association":"NONE","body":"Anyone? I can handle this by moving failed shard to another node by the way.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160226379","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-160226379","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":160226379,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDIyNjM3OQ==","user":{"login":"vs-adm","id":370526,"node_id":"MDQ6VXNlcjM3MDUyNg==","avatar_url":"https://avatars1.githubusercontent.com/u/370526?v=4","gravatar_id":"","url":"https://api.github.com/users/vs-adm","html_url":"https://github.com/vs-adm","followers_url":"https://api.github.com/users/vs-adm/followers","following_url":"https://api.github.com/users/vs-adm/following{/other_user}","gists_url":"https://api.github.com/users/vs-adm/gists{/gist_id}","starred_url":"https://api.github.com/users/vs-adm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vs-adm/subscriptions","organizations_url":"https://api.github.com/users/vs-adm/orgs","repos_url":"https://api.github.com/users/vs-adm/repos","events_url":"https://api.github.com/users/vs-adm/events{/privacy}","received_events_url":"https://api.github.com/users/vs-adm/received_events","type":"User","site_admin":false},"created_at":"2015-11-27T23:18:43Z","updated_at":"2015-11-27T23:26:16Z","author_association":"NONE","body":"It seems like NPE is in cache eviction method which can't aquire stats counters using `stats2`\n\n``` java\nprotected void onDocIdSetEviction(Object readerCoreKey, int numEntries, long sumRamBytesUsed) {\n                assert Thread.holdsLock(this);\n                super.onDocIdSetEviction(readerCoreKey, numEntries, sumRamBytesUsed);\n                // We can't use ShardCoreKeyMap here because its core closed\n                // listener is called before the listener of the cache which\n                // triggers this eviction. So instead we use use stats2 that\n                // we only evict when nothing is cached anymore on the segment\n                // instead of relying on close listeners\n                final StatsAndCount statsAndCount = stats2.get(readerCoreKey);\n                final Stats shardStats = statsAndCount.stats;\n                shardStats.cacheSize -= numEntries;\n                shardStats.ramBytesUsed -= sumRamBytesUsed;\n                statsAndCount.count -= numEntries;\n                if (statsAndCount.count == 0) {\n                    stats2.remove(readerCoreKey);\n                }\n            }\n```\n\nWhat is the preferable way to fix this? Ignoring stats update if `statsAndCount` is `null` leads to incorrect statistics.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160226692","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-160226692","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":160226692,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDIyNjY5Mg==","user":{"login":"vs-adm","id":370526,"node_id":"MDQ6VXNlcjM3MDUyNg==","avatar_url":"https://avatars1.githubusercontent.com/u/370526?v=4","gravatar_id":"","url":"https://api.github.com/users/vs-adm","html_url":"https://github.com/vs-adm","followers_url":"https://api.github.com/users/vs-adm/followers","following_url":"https://api.github.com/users/vs-adm/following{/other_user}","gists_url":"https://api.github.com/users/vs-adm/gists{/gist_id}","starred_url":"https://api.github.com/users/vs-adm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vs-adm/subscriptions","organizations_url":"https://api.github.com/users/vs-adm/orgs","repos_url":"https://api.github.com/users/vs-adm/repos","events_url":"https://api.github.com/users/vs-adm/events{/privacy}","received_events_url":"https://api.github.com/users/vs-adm/received_events","type":"User","site_admin":false},"created_at":"2015-11-27T23:26:05Z","updated_at":"2015-11-27T23:26:05Z","author_association":"NONE","body":"Also, API call `POST /_cache/clear` episodically gives the same error\n\n``` json\n{\n  \"_shards\": {\n    \"total\": 6830,\n    \"successful\": 6827,\n    \"failed\": 3,\n    \"failures\": [\n      {\n        \"shard\": 2,\n        \"index\": \"logstash-2015.11.26\",\n        \"status\": \"INTERNAL_SERVER_ERROR\",\n        \"reason\": {\n          \"type\": \"null_pointer_exception\",\n          \"reason\": null\n        }\n      }\n    ]\n  }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160296550","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-160296550","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":160296550,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDI5NjU1MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-11-28T13:41:48Z","updated_at":"2015-11-28T13:41:48Z","author_association":"CONTRIBUTOR","body":"@s1monw Is this issue fixed by https://github.com/elastic/elasticsearch/pull/15012 ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/160662777","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-160662777","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":160662777,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MDY2Mjc3Nw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-30T15:34:40Z","updated_at":"2015-11-30T15:34:40Z","author_association":"MEMBER","body":"@clintongormley I think this is something else, relating to evictions in the new query cache. Maybe @jpountz can take a look?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161244015","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-161244015","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":161244015,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI0NDAxNQ==","user":{"login":"IngaFeick","id":9050786,"node_id":"MDQ6VXNlcjkwNTA3ODY=","avatar_url":"https://avatars2.githubusercontent.com/u/9050786?v=4","gravatar_id":"","url":"https://api.github.com/users/IngaFeick","html_url":"https://github.com/IngaFeick","followers_url":"https://api.github.com/users/IngaFeick/followers","following_url":"https://api.github.com/users/IngaFeick/following{/other_user}","gists_url":"https://api.github.com/users/IngaFeick/gists{/gist_id}","starred_url":"https://api.github.com/users/IngaFeick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IngaFeick/subscriptions","organizations_url":"https://api.github.com/users/IngaFeick/orgs","repos_url":"https://api.github.com/users/IngaFeick/repos","events_url":"https://api.github.com/users/IngaFeick/events{/privacy}","received_events_url":"https://api.github.com/users/IngaFeick/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T10:00:04Z","updated_at":"2015-12-02T10:00:04Z","author_association":"NONE","body":"Same story here. Updated to 2.1 a couple of days ago also, and ever since we have the same error message that some temporary files could not be deleted:\n\n```\n[2015-12-02 09:31:41,802][WARN ][index.translog           ] [Bacon] [.kibana][0] failed to delete temp file /appdata/elasticsearch/data/elasticsearch/nodes/0/indices/.kibana/0/translog/translog-4247269950871871367.tlog\n```\n\nThe mentioned files never exist. \nAlso some of our shards are stuck in a translog state. When this first occured a couple of days ago, they would recover from it after some time, but now that's not working anymore and the number of affected shards is growing. Restarting elasticsearch does not help (anymore). The indices also cannot be closed or deleted via the http api anymore. Indexing is stuck, too.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161254367","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-161254367","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":161254367,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI1NDM2Nw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T10:39:34Z","updated_at":"2015-12-02T10:39:34Z","author_association":"CONTRIBUTOR","body":"@IngaFeick This warning can be safely ignored. It will be fixed in 2.1.1, see https://github.com/elastic/elasticsearch/pull/14872.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161257310","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-161257310","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":161257310,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI1NzMxMA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T10:53:41Z","updated_at":"2015-12-02T10:53:41Z","author_association":"CONTRIBUTOR","body":"To be clear, only this warning that elasticsearch \"failed to delete\" a temp file will be fixed. The NullPointerException mentioned above is an actual bug however.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161258522","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-161258522","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":161258522,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI1ODUyMg==","user":{"login":"IngaFeick","id":9050786,"node_id":"MDQ6VXNlcjkwNTA3ODY=","avatar_url":"https://avatars2.githubusercontent.com/u/9050786?v=4","gravatar_id":"","url":"https://api.github.com/users/IngaFeick","html_url":"https://github.com/IngaFeick","followers_url":"https://api.github.com/users/IngaFeick/followers","following_url":"https://api.github.com/users/IngaFeick/following{/other_user}","gists_url":"https://api.github.com/users/IngaFeick/gists{/gist_id}","starred_url":"https://api.github.com/users/IngaFeick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IngaFeick/subscriptions","organizations_url":"https://api.github.com/users/IngaFeick/orgs","repos_url":"https://api.github.com/users/IngaFeick/repos","events_url":"https://api.github.com/users/IngaFeick/events{/privacy}","received_events_url":"https://api.github.com/users/IngaFeick/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T10:57:42Z","updated_at":"2015-12-02T10:57:42Z","author_association":"NONE","body":"Thanks @jpountz , unfortunately we get that NPE also:\n\n```\njava.lang.NullPointerException\n        at org.elasticsearch.indices.cache.query.IndicesQueryCache$1.onDocIdSetEviction(IndicesQueryCache.java:158)\n        at org.apache.lucene.search.LRUQueryCache.clearCoreCacheKey(LRUQueryCache.java:313)\n        at org.apache.lucene.search.LRUQueryCache$1.onClose(LRUQueryCache.java:276)\n        at org.apache.lucene.index.SegmentCoreReaders.notifyCoreClosedListeners(SegmentCoreReaders.java:168)\n        at org.apache.lucene.index.SegmentCoreReaders.decRef(SegmentCoreReaders.java:157)\n        at org.apache.lucene.index.SegmentReader.doClose(SegmentReader.java:175)\n        at org.apache.lucene.index.IndexReader.decRef(IndexReader.java:253)\n        at org.apache.lucene.index.ReadersAndUpdates.dropReaders(ReadersAndUpdates.java:182)\n        at org.apache.lucene.index.IndexWriter$ReaderPool.dropAll(IndexWriter.java:603)\n        at org.apache.lucene.index.IndexWriter.rollbackInternal(IndexWriter.java:2075)\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161259092","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-161259092","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":161259092,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI1OTA5Mg==","user":{"login":"vs-adm","id":370526,"node_id":"MDQ6VXNlcjM3MDUyNg==","avatar_url":"https://avatars1.githubusercontent.com/u/370526?v=4","gravatar_id":"","url":"https://api.github.com/users/vs-adm","html_url":"https://github.com/vs-adm","followers_url":"https://api.github.com/users/vs-adm/followers","following_url":"https://api.github.com/users/vs-adm/following{/other_user}","gists_url":"https://api.github.com/users/vs-adm/gists{/gist_id}","starred_url":"https://api.github.com/users/vs-adm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vs-adm/subscriptions","organizations_url":"https://api.github.com/users/vs-adm/orgs","repos_url":"https://api.github.com/users/vs-adm/repos","events_url":"https://api.github.com/users/vs-adm/events{/privacy}","received_events_url":"https://api.github.com/users/vs-adm/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T10:58:44Z","updated_at":"2015-12-02T10:58:44Z","author_association":"NONE","body":"As a temporary and dirty workaround I'm running `POST /cache/clear` every ten minutes in cronjob. This slows down search requests but prevents shards format failing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161260205","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-161260205","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":161260205,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTI2MDIwNQ==","user":{"login":"IngaFeick","id":9050786,"node_id":"MDQ6VXNlcjkwNTA3ODY=","avatar_url":"https://avatars2.githubusercontent.com/u/9050786?v=4","gravatar_id":"","url":"https://api.github.com/users/IngaFeick","html_url":"https://github.com/IngaFeick","followers_url":"https://api.github.com/users/IngaFeick/followers","following_url":"https://api.github.com/users/IngaFeick/following{/other_user}","gists_url":"https://api.github.com/users/IngaFeick/gists{/gist_id}","starred_url":"https://api.github.com/users/IngaFeick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IngaFeick/subscriptions","organizations_url":"https://api.github.com/users/IngaFeick/orgs","repos_url":"https://api.github.com/users/IngaFeick/repos","events_url":"https://api.github.com/users/IngaFeick/events{/privacy}","received_events_url":"https://api.github.com/users/IngaFeick/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T11:00:39Z","updated_at":"2015-12-02T11:00:39Z","author_association":"NONE","body":"@vs-adm we tried that also, to no noticable effect, but I'll give that cronjob a try to prevent additional failures. Thanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/161434814","html_url":"https://github.com/elastic/elasticsearch/issues/15043#issuecomment-161434814","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15043","id":161434814,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTQzNDgxNA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-02T21:10:12Z","updated_at":"2015-12-02T21:10:12Z","author_association":"CONTRIBUTOR","body":"I managed to find a case in which I'm able to reproduce the above NullPointerException, see #15202. Hopefully this is the same case as this one.\n","performed_via_github_app":null}]