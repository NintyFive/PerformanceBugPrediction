{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23868","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23868/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23868/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23868/events","html_url":"https://github.com/elastic/elasticsearch/issues/23868","id":218754221,"node_id":"MDU6SXNzdWUyMTg3NTQyMjE=","number":23868,"title":"ES 5.2.2 Data nodes heap suddenly jump to max, causing cluster crash","user":{"login":"itaydvir","id":10347224,"node_id":"MDQ6VXNlcjEwMzQ3MjI0","avatar_url":"https://avatars3.githubusercontent.com/u/10347224?v=4","gravatar_id":"","url":"https://api.github.com/users/itaydvir","html_url":"https://github.com/itaydvir","followers_url":"https://api.github.com/users/itaydvir/followers","following_url":"https://api.github.com/users/itaydvir/following{/other_user}","gists_url":"https://api.github.com/users/itaydvir/gists{/gist_id}","starred_url":"https://api.github.com/users/itaydvir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itaydvir/subscriptions","organizations_url":"https://api.github.com/users/itaydvir/orgs","repos_url":"https://api.github.com/users/itaydvir/repos","events_url":"https://api.github.com/users/itaydvir/events{/privacy}","received_events_url":"https://api.github.com/users/itaydvir/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-04-02T09:58:43Z","updated_at":"2017-04-03T19:02:41Z","closed_at":"2017-04-03T19:02:41Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n**Elasticsearch version**: 5.2.2\r\n\r\n**Plugins installed**: [analysis-kuromoji, analysis-smartcn]\r\n\r\n**JVM version**: 1.8.0_65\r\n\r\n**OS version**: Debian 3.16.36\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nES 5.2.2 Data nodes heap suddenly jump to max (from 6GB to 15GB) causing cluster crash.\r\nCluster includes:\r\n1) 3 master nodes\r\n2) 5 data nodes (32GB RAM, 8 cores)\r\n3) indices are not that big, most used ones contains 1.5 Mil docs, and take 4GB store size \r\nindices used for aggs contains about 6Mil docs and weight about 15GB.\r\n\r\nOur usage is pretty basic, mainly textual search, some aggregations (sum, avg, and some contains scripts). very very low usage of nested documents and no usage of parent/child relationships.\r\n\r\nPlease read full issue description + graphs images here: https://discuss.elastic.co/t/upgrading-es-2-3-3-to-5-2-causing-cluster-crash.\r\n\r\nP.S.\r\nIt was a blocker for us, and after several attempts we decided to do rollback to 2.3.3. so for now, we are not running 5.2 anymore.\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}