[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/306729837","html_url":"https://github.com/elastic/elasticsearch/issues/25088#issuecomment-306729837","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25088","id":306729837,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjcyOTgzNw==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2017-06-07T08:41:02Z","updated_at":"2017-06-07T08:41:20Z","author_association":"CONTRIBUTOR","body":"Highlighting is an inexact science and a highlighter has to balance the competing demands of speed, accuracy and ability to summarize lengthy docs. The reason we have so many highlighter implementations reflects the legacy of various people taking up the challenge of creating the definitive Lucene highlighter.\r\nEach implementation has its pros and cons (preserves phrases, works with n-grams, splits on sentences, is fast etc). A failure to highlight is not necessarily a \"bug\" but sometimes a deliberate design trade-off of an implementation (speed over accuracy).\r\n\r\nWhat you are seeing is a deficiency with the `fvh` highlighter and I note that if you set the type to `plain` your example works OK.\r\n\r\nThe latest hot contender for _one-highlighter-to-rule-them-all_ is the `unified` highlighter but I see that this also fails on this example. \r\n\r\nI don't know for sure that the failure in this case is an oversight or a deliberate limitation of fvh in trying to be a _Fast_ Vector Highlighter. The `plain` highlighter offers a workaround in this case and so this issue may ultimately be closed with \"wontfix\".\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/306769616","html_url":"https://github.com/elastic/elasticsearch/issues/25088#issuecomment-306769616","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25088","id":306769616,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjc2OTYxNg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-06-07T11:41:17Z","updated_at":"2017-06-07T11:41:17Z","author_association":"CONTRIBUTOR","body":"Given that we're wanting to replace the `plain` highlighter with the `unified` highlighter, would be good to fix this.\r\n\r\nThe `unified` highlighter dies with \r\n\r\n          \"type\": \"illegal_argument_exception\",\r\n          \"reason\": \"Less than 2 subSpans.size():1\"\r\n\r\nChanging the `phrase_prefix` query to a `phrase` query works.  Makes me wonder if there is something wrong with that query in particular.\r\n\r\n@jimczi any thoughts?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/306775915","html_url":"https://github.com/elastic/elasticsearch/issues/25088#issuecomment-306775915","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25088","id":306775915,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjc3NTkxNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-06-07T12:11:59Z","updated_at":"2017-06-07T12:11:59Z","author_association":"MEMBER","body":"The `unified` highlighter has a bug when the `phrase_prefix` query contain a single term. I'll work on a fix but I don't think this is related with the bug in the `fvh`. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/306813861","html_url":"https://github.com/elastic/elasticsearch/issues/25088#issuecomment-306813861","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25088","id":306813861,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjgxMzg2MQ==","user":{"login":"v1r","id":321221,"node_id":"MDQ6VXNlcjMyMTIyMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/321221?v=4","gravatar_id":"","url":"https://api.github.com/users/v1r","html_url":"https://github.com/v1r","followers_url":"https://api.github.com/users/v1r/followers","following_url":"https://api.github.com/users/v1r/following{/other_user}","gists_url":"https://api.github.com/users/v1r/gists{/gist_id}","starred_url":"https://api.github.com/users/v1r/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v1r/subscriptions","organizations_url":"https://api.github.com/users/v1r/orgs","repos_url":"https://api.github.com/users/v1r/repos","events_url":"https://api.github.com/users/v1r/events{/privacy}","received_events_url":"https://api.github.com/users/v1r/received_events","type":"User","site_admin":false},"created_at":"2017-06-07T14:34:09Z","updated_at":"2017-06-07T17:51:56Z","author_association":"NONE","body":"Thank you guys for your input. Please also note that the following query fails too while both queries works in ES 2.x. \r\n\r\n```\r\nGET blog/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"should\": [\r\n        {        \"match_phrase_prefix\" : {\r\n            \"title\" : \"test\"\r\n        }\r\n          \r\n      }, {        \"match_phrase_prefix\" : {\r\n            \"body\" : \"test\"\r\n        }\r\n      }\r\n      ]\r\n    }\r\n  },\r\n  \"highlight\": {\r\n    \"fields\": {\r\n      \"title\": {\r\n        \"number_of_fragments\": 0, \r\n        \"matched_fields\": [\r\n          \"title\",\r\n          \"body\"\r\n        ], \r\n        \"type\": \"fvh\"\r\n      }\r\n    }, \r\n    \"require_field_match\": false\r\n  }\r\n}\r\n\r\n```\r\n\r\n@markharwood Thanks for your comment, this is a regression compared to ES 2.x. \r\n\r\n\r\n**Update**\r\nAnother attempt with the following: \r\n\r\n```\r\nGET blog/_search\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"should\": [\r\n        {        \r\n            \"match_phrase_prefix\" : {\r\n            \"title\" : \"test\"\r\n        }},   {        \r\n            \"match_phrase_prefix\" : {\r\n            \"body\" : \"test\"\r\n        }\r\n      }\r\n      ]\r\n    }\r\n  },\r\n  \"highlight\": {\r\n    \"fields\": {\r\n      \"title\": {\r\n        \"number_of_fragments\": 0, \r\n        \"type\": \"fvh\"\r\n      },\r\n      \"body\": {\r\n        \"number_of_fragments\": 0, \r\n        \"type\": \"fvh\"\r\n      }\r\n    }, \r\n    \"require_field_match\": false\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/306924959","html_url":"https://github.com/elastic/elasticsearch/issues/25088#issuecomment-306924959","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25088","id":306924959,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjkyNDk1OQ==","user":{"login":"v1r","id":321221,"node_id":"MDQ6VXNlcjMyMTIyMQ==","avatar_url":"https://avatars2.githubusercontent.com/u/321221?v=4","gravatar_id":"","url":"https://api.github.com/users/v1r","html_url":"https://github.com/v1r","followers_url":"https://api.github.com/users/v1r/followers","following_url":"https://api.github.com/users/v1r/following{/other_user}","gists_url":"https://api.github.com/users/v1r/gists{/gist_id}","starred_url":"https://api.github.com/users/v1r/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/v1r/subscriptions","organizations_url":"https://api.github.com/users/v1r/orgs","repos_url":"https://api.github.com/users/v1r/repos","events_url":"https://api.github.com/users/v1r/events{/privacy}","received_events_url":"https://api.github.com/users/v1r/received_events","type":"User","site_admin":false},"created_at":"2017-06-07T21:06:19Z","updated_at":"2017-06-07T21:06:19Z","author_association":"NONE","body":"Another simpler query \r\n\r\n```\r\nGET blog/_search\r\n{\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  },\r\n  \"highlight\": {\r\n    \"fields\": {\r\n      \"title\": {\r\n        \"number_of_fragments\": 0, \r\n        \"highlight_query\": {\r\n              \"match_phrase_prefix\" : {\r\n                  \"title\" : \"tests\"\r\n              }\r\n        },\r\n        \"type\": \"fvh\"\r\n      }\r\n    }, \r\n    \"require_field_match\": false\r\n  }\r\n}\r\n```","performed_via_github_app":null}]