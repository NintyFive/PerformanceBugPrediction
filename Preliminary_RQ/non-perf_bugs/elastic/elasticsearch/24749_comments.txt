[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302330681","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-302330681","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":302330681,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjMzMDY4MQ==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2017-05-18T07:59:46Z","updated_at":"2017-05-18T08:08:10Z","author_association":"MEMBER","body":"hey, can you provide a full stacktrace from your logs?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302341652","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-302341652","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":302341652,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjM0MTY1Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-05-18T08:48:22Z","updated_at":"2017-05-18T08:48:22Z","author_association":"CONTRIBUTOR","body":"...plus the full index templates that you're using, and some examples of failed docs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302361282","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-302361282","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":302361282,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjM2MTI4Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-05-18T10:09:18Z","updated_at":"2017-05-18T10:09:18Z","author_association":"CONTRIBUTOR","body":"Also, are you using an ingest pipeline?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302488926","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-302488926","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":302488926,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjQ4ODkyNg==","user":{"login":"marc-lebourdais","id":4622295,"node_id":"MDQ6VXNlcjQ2MjIyOTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4622295?v=4","gravatar_id":"","url":"https://api.github.com/users/marc-lebourdais","html_url":"https://github.com/marc-lebourdais","followers_url":"https://api.github.com/users/marc-lebourdais/followers","following_url":"https://api.github.com/users/marc-lebourdais/following{/other_user}","gists_url":"https://api.github.com/users/marc-lebourdais/gists{/gist_id}","starred_url":"https://api.github.com/users/marc-lebourdais/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marc-lebourdais/subscriptions","organizations_url":"https://api.github.com/users/marc-lebourdais/orgs","repos_url":"https://api.github.com/users/marc-lebourdais/repos","events_url":"https://api.github.com/users/marc-lebourdais/events{/privacy}","received_events_url":"https://api.github.com/users/marc-lebourdais/received_events","type":"User","site_admin":false},"created_at":"2017-05-18T17:49:58Z","updated_at":"2017-05-18T17:49:58Z","author_association":"NONE","body":"With some values obscured, here's the full stack trace with the document data:\r\n\r\n```\r\n[2017-05-17 23:37:17,348][DEBUG][action.bulk              ] [d-d08p03r05u05-t0g2] [storage-2017.05.17][0] failed to execute bulk item (index) index {[storage-2017.05.17][events][AVwYxdUg3Xm6BAlG1BiH], source[{\"@timestamp\":\"2017-05-17T23:37:17.216887+00:00\",\"syslog_host\":\"somehost\",\"syslog_program\":\"cleaner_tuna\",\"syslog_severity\":\"info\",\"syslog_facility\":\"local7\",\"syslog_tag\":\"cleaner_tuna[1]:\",\"syslog_region\":\"someregion\",\"noidx_rawmsg\":\"<190>2017-05-17T23:37:17.216887+00:00 somehost cleaner_tuna[1]: @cee:{\\\"egid\\\":999,\\\"eid\\\":999,\\\"env\\\":\\\"production\\\",\\\"host\\\":\\\"ephemeralhost\\\",\\\"intent\\\":{\\\"Intent\\\":{\\\"DeleteSnapshot\\\":{\\\"snapshot\\\":{\\\"allocation_id\\\":\\\"someallocationid\\\",\\\"backend\\\":{\\\"Details\\\":{\\\"Ceph\\\":{\\\"pool\\\":\\\"rbd\\\"}},\\\"cluster_id\\\":\\\"someclusterid\\\"},\\\"created_at\\\":\\\"2017-03-23T22:20:12Z\\\",\\\"id\\\":\\\"someid\\\",\\\"lifecycle_event_count\\\":1,\\\"name\\\":\\\"somename\\\",\\\"old_ceph_details\\\":{\\\"cluster\\\":\\\"somecluster\\\",\\\"pool\\\":\\\"rbd\\\"},\\\"parent_size_bytes\\\":107374182400,\\\"pending_events\\\":[{\\\"Event\\\":{\\\"SnapshotCreate\\\":{\\\"created_at\\\":\\\"2017-03-23T22:20:12Z\\\",\\\"name\\\":\\\"somename\\\"}},\\\"parent_id\\\":\\\"someparentid\\\",\\\"user_id\\\":117102}],\\\"user_id\\\":123456}}},\\\"claimed_at\\\":\\\"2017-05-17T23:37:17Z\\\",\\\"created_at\\\":\\\"2017-03-23T22:22:13Z\\\",\\\"delay_secs\\\":120,\\\"id\\\":\\\"someid\\\",\\\"owner\\\":{\\\"name\\\":\\\"somename\\\"}},\\\"level\\\":\\\"info\\\",\\\"msg\\\":\\\"releasing intent\\\",\\\"pid\\\":1,\\\"pname\\\":\\\"\\/cleanerd\\\",\\\"time\\\":\\\"2017-05-17T23:37:17Z\\\",\\\"version\\\":\\\"d8c41ea964\\\"}\", \"egid\": 999, \"eid\": 999, \"env\": \"production\", \"host\": \"cleaner-2795265912-tqeu6\", \"intent\": { \"Intent\": { \"DeleteSnapshot\": { \"snapshot\": { \"allocation_id\": \"someallocationid\", \"backend\": { \"Details\": { \"Ceph\": { \"pool\": \"rbd\" } }, \"cluster_id\": \"fra1-prod\" }, \"created_at\": \"2017-03-23T22:20:12Z\", \"id\": \"someid\", \"lifecycle_event_count\": 1, \"name\": \"volume-fra1-test-snapshot-1\", \"old_ceph_details\": { \"cluster\": \"fra1-prod\", \"pool\": \"rbd\" }, \"parent_size_bytes\": 107374182400, \"pending_events\": [ { \"Event\": { \"SnapshotCreate\": { \"created_at\": \"2017-03-23T22:20:12Z\", \"name\": \"somename\" } }, \"parent_id\": \"someparentid\", \"user_id\": 12345 } ], \"user_id\": 12345 } } }, \"claimed_at\": \"2017-05-17T23:37:17Z\", \"created_at\": \"2017-03-23T22:22:13Z\", \"delay_secs\": 120, \"id\": \"someid\", \"owner\": { \"name\": \"somename\" } }, \"level\": \"info\", \"msg\": \"releasing intent\", \"pid\": 1, \"pname\": \"\\/cleanerd\", \"time\": \"2017-05-17T23:37:17Z\", \"version\": \"d8c41ea964\" }]}\r\nMapperParsingException[failed to parse]; nested: PatternSyntaxException[Dangling meta character '*' near index 0\r\n*\r\n^];\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:156)\r\n\tat org.elasticsearch.index.mapper.DocumentMapper.parse(DocumentMapper.java:309)\r\n\tat org.elasticsearch.index.shard.IndexShard.prepareCreate(IndexShard.java:529)\r\n\tat org.elasticsearch.index.shard.IndexShard.prepareCreateOnPrimary(IndexShard.java:506)\r\n\tat org.elasticsearch.action.index.TransportIndexAction.prepareIndexOperationOnPrimary(TransportIndexAction.java:214)\r\n\tat org.elasticsearch.action.index.TransportIndexAction.executeIndexRequestOnPrimary(TransportIndexAction.java:223)\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.shardIndexOperation(TransportShardBulkAction.java:327)\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:120)\r\n\tat org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnPrimary(TransportShardBulkAction.java:68)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryPhase.doRun(TransportReplicationAction.java:657)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:287)\r\n\tat org.elasticsearch.action.support.replication.TransportReplicationAction$PrimaryOperationTransportHandler.messageReceived(TransportReplicationAction.java:279)\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:77)\r\n\tat org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: java.util.regex.PatternSyntaxException: Dangling meta character '*' near index 0\r\n*\r\n^\r\n\tat java.util.regex.Pattern.error(Pattern.java:1955)\r\n\tat java.util.regex.Pattern.sequence(Pattern.java:2123)\r\n\tat java.util.regex.Pattern.expr(Pattern.java:1996)\r\n\tat java.util.regex.Pattern.compile(Pattern.java:1696)\r\n\tat java.util.regex.Pattern.<init>(Pattern.java:1351)\r\n\tat java.util.regex.Pattern.compile(Pattern.java:1028)\r\n\tat java.util.regex.Pattern.matches(Pattern.java:1133)\r\n\tat java.lang.String.matches(String.java:2121)\r\n\tat org.elasticsearch.index.mapper.object.DynamicTemplate.patternMatch(DynamicTemplate.java:163)\r\n\tat org.elasticsearch.index.mapper.object.DynamicTemplate.match(DynamicTemplate.java:131)\r\n\tat org.elasticsearch.index.mapper.object.RootObjectMapper.findTemplate(RootObjectMapper.java:263)\r\n\tat org.elasticsearch.index.mapper.object.RootObjectMapper.findTemplateBuilder(RootObjectMapper.java:248)\r\n\tat org.elasticsearch.index.mapper.object.RootObjectMapper.findTemplateBuilder(RootObjectMapper.java:244)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.createBuilderFromDynamicValue(DocumentParser.java:557)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseDynamicValue(DocumentParser.java:619)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseValue(DocumentParser.java:444)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:264)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:308)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseAndMergeUpdate(DocumentParser.java:740)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:354)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:254)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:308)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseAndMergeUpdate(DocumentParser.java:740)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:354)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:254)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:308)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseAndMergeUpdate(DocumentParser.java:740)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:354)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:254)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObjectOrField(DocumentParser.java:308)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseAndMergeUpdate(DocumentParser.java:740)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:354)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseObject(DocumentParser.java:254)\r\n\tat org.elasticsearch.index.mapper.DocumentParser.parseDocument(DocumentParser.java:124)\r\n\t... 18 more\r\n```\r\n\r\nOur setup is has queue-backed rsyslog instances writing bulk indexing requests to ES. The full index templates are as follows:\r\n\r\n```\r\n{\r\n  \"template\": \"*\",\r\n  \"order\": 0,\r\n  \"settings\": {\r\n    \"index\": {\r\n      \"refresh_interval\": \"5s\"\r\n    }\r\n  },\r\n  \"mappings\": {\r\n    \"_default_\": {\r\n      \"properties\": {\r\n        \"geoip\": {\r\n          \"properties\": {\r\n            \"longitude\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"float\"\r\n            },\r\n            \"latitude\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"float\"\r\n            },\r\n            \"location\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"geo_point\"\r\n            },\r\n            \"ip\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"ip\"\r\n            }\r\n          },\r\n          \"dynamic\": true,\r\n          \"type\": \"object\"\r\n        },\r\n        \"@version\": {\r\n          \"doc_values\": true,\r\n          \"index\": \"not_analyzed\",\r\n          \"type\": \"string\"\r\n        },\r\n        \"@timestamp\": {\r\n          \"doc_values\": true,\r\n          \"type\": \"date\"\r\n        }\r\n      },\r\n      \"dynamic_templates\": [\r\n        {\r\n          \"numeric_fields\": {\r\n            \"mapping\": {\r\n              \"index\": \"not_analyzed\",\r\n              \"type\": \"double\"\r\n            },\r\n            \"match\": \"(?i)(.*[_-])?(code|size|length|count|seconds?|sec|us|ms|s)\",\r\n            \"unmatch\": \"grpc_code\",\r\n            \"match_pattern\": \"regex\"\r\n          }\r\n        },\r\n        {\r\n          \"date_fields\": {\r\n            \"mapping\": {\r\n              \"index\": \"not_analyzed\",\r\n              \"type\": \"date\"\r\n            },\r\n            \"path_match\": \"(?i)(.*[_-])?(timestamp|time|at)\",\r\n            \"match_pattern\": \"regex\"\r\n          }\r\n        },\r\n        {\r\n          \"large_text_fields\": {\r\n            \"mapping\": {\r\n              \"index\": \"no\",\r\n              \"type\": \"string\"\r\n            },\r\n            \"path_match\": \"(?i)(noidx.*)\",\r\n            \"match_pattern\": \"regex\"\r\n          }\r\n        },\r\n        {\r\n          \"message_field\": {\r\n            \"mapping\": {\r\n              \"omit_norms\": true,\r\n              \"index\": \"analyzed\",\r\n              \"type\": \"string\"\r\n            },\r\n            \"match_mapping_type\": \"string\",\r\n            \"match\": \"message\"\r\n          }\r\n        },\r\n        {\r\n          \"id_field\": {\r\n            \"mapping\": {\r\n              \"fields\": {\r\n                \"raw\": {\r\n                  \"ignore_above\": 256,\r\n                  \"doc_values\": true,\r\n                  \"index\": \"not_analyzed\",\r\n                  \"type\": \"string\"\r\n                }\r\n              },\r\n              \"omit_norms\": true,\r\n              \"index\": \"analyzed\",\r\n              \"type\": \"string\"\r\n            },\r\n            \"type\": \"string\",\r\n            \"match\": \"*_id\"\r\n          }\r\n        },\r\n        {\r\n          \"process_id_field\": {\r\n            \"mapping\": {\r\n              \"fields\": {\r\n                \"raw\": {\r\n                  \"ignore_above\": 256,\r\n                  \"doc_values\": true,\r\n                  \"index\": \"not_analyzed\",\r\n                  \"type\": \"string\"\r\n                }\r\n              },\r\n              \"omit_norms\": true,\r\n              \"index\": \"analyzed\",\r\n              \"type\": \"string\"\r\n            },\r\n            \"type\": \"string\",\r\n            \"match\": \"pid\"\r\n          }\r\n        },\r\n        {\r\n          \"req_params_image_field\": {\r\n            \"mapping\": {\r\n              \"fields\": {\r\n                \"raw\": {\r\n                  \"ignore_above\": 256,\r\n                  \"doc_values\": true,\r\n                  \"index\": \"not_analyzed\",\r\n                  \"type\": \"string\"\r\n                }\r\n              },\r\n              \"omit_norms\": true,\r\n              \"index\": \"analyzed\",\r\n              \"type\": \"string\"\r\n            },\r\n            \"type\": \"string\",\r\n            \"match\": \"req_params_image\"\r\n          }\r\n        },\r\n        {\r\n          \"string_fields\": {\r\n            \"mapping\": {\r\n              \"fields\": {\r\n                \"raw\": {\r\n                  \"ignore_above\": 256,\r\n                  \"doc_values\": true,\r\n                  \"index\": \"not_analyzed\",\r\n                  \"type\": \"string\"\r\n                }\r\n              },\r\n              \"omit_norms\": true,\r\n              \"index\": \"analyzed\",\r\n              \"type\": \"string\"\r\n            },\r\n            \"match_mapping_type\": \"string\",\r\n            \"match\": \"*\"\r\n          }\r\n        },\r\n        {\r\n          \"float_fields\": {\r\n            \"mapping\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"float\"\r\n            },\r\n            \"match_mapping_type\": \"float\",\r\n            \"match\": \"*\"\r\n          }\r\n        },\r\n        {\r\n          \"double_fields\": {\r\n            \"mapping\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"double\"\r\n            },\r\n            \"match_mapping_type\": \"double\",\r\n            \"match\": \"*\"\r\n          }\r\n        },\r\n        {\r\n          \"byte_fields\": {\r\n            \"mapping\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"byte\"\r\n            },\r\n            \"match_mapping_type\": \"byte\",\r\n            \"match\": \"*\"\r\n          }\r\n        },\r\n        {\r\n          \"short_fields\": {\r\n            \"mapping\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"short\"\r\n            },\r\n            \"match_mapping_type\": \"short\",\r\n            \"match\": \"*\"\r\n          }\r\n        },\r\n        {\r\n          \"integer_fields\": {\r\n            \"mapping\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"integer\"\r\n            },\r\n            \"match_mapping_type\": \"integer\",\r\n            \"match\": \"*\"\r\n          }\r\n        },\r\n        {\r\n          \"long_fields\": {\r\n            \"mapping\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"long\"\r\n            },\r\n            \"match_mapping_type\": \"long\",\r\n            \"match\": \"*\"\r\n          }\r\n        },\r\n        {\r\n          \"date_fields\": {\r\n            \"mapping\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"date\"\r\n            },\r\n            \"match_mapping_type\": \"date\",\r\n            \"match\": \"*\"\r\n          }\r\n        },\r\n        {\r\n          \"geo_point_fields\": {\r\n            \"mapping\": {\r\n              \"doc_values\": true,\r\n              \"type\": \"geo_point\"\r\n            },\r\n            \"match_mapping_type\": \"geo_point\",\r\n            \"match\": \"*\"\r\n          }\r\n        }\r\n      ],\r\n      \"_all\": {\r\n        \"omit_norms\": true,\r\n        \"enabled\": true\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n```\r\n{\r\n  \"template\": \"storage-*\",\r\n  \"order\" : 1,\r\n  \"settings\": {\r\n    \"number_of_shards\" : \"1\",\r\n    \"number_of_replicas\": \"2\"\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303691968","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-303691968","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":303691968,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzY5MTk2OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-05-24T11:03:09Z","updated_at":"2017-05-24T11:03:09Z","author_association":"CONTRIBUTOR","body":"Do you have any examples of failed documents?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303692699","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-303692699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":303692699,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzY5MjY5OQ==","user":{"login":"marc-lebourdais","id":4622295,"node_id":"MDQ6VXNlcjQ2MjIyOTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4622295?v=4","gravatar_id":"","url":"https://api.github.com/users/marc-lebourdais","html_url":"https://github.com/marc-lebourdais","followers_url":"https://api.github.com/users/marc-lebourdais/followers","following_url":"https://api.github.com/users/marc-lebourdais/following{/other_user}","gists_url":"https://api.github.com/users/marc-lebourdais/gists{/gist_id}","starred_url":"https://api.github.com/users/marc-lebourdais/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marc-lebourdais/subscriptions","organizations_url":"https://api.github.com/users/marc-lebourdais/orgs","repos_url":"https://api.github.com/users/marc-lebourdais/repos","events_url":"https://api.github.com/users/marc-lebourdais/events{/privacy}","received_events_url":"https://api.github.com/users/marc-lebourdais/received_events","type":"User","site_admin":false},"created_at":"2017-05-24T11:06:49Z","updated_at":"2017-05-24T11:06:49Z","author_association":"NONE","body":"There was an example in the exception trace:\r\n```\r\n{\r\n  \"@timestamp\": \"2017-05-17T23:37:17.216887+00:00\",\r\n  \"syslog_host\": \"somehost\",\r\n  \"syslog_program\": \"cleaner_tuna\",\r\n  \"syslog_severity\": \"info\",\r\n  \"syslog_facility\": \"local7\",\r\n  \"syslog_tag\": \"cleaner_tuna[1]:\",\r\n  \"syslog_region\": \"someregion\",\r\n  \"noidx_rawmsg\": \"<190>2017-05-17T23:37:17.216887+00:00 somehost cleaner_tuna[1]: @cee:{\\\"egid\\\":999,\\\"eid\\\":999,\\\"env\\\":\\\"production\\\",\\\"host\\\":\\\"ephemeralhost\\\",\\\"intent\\\":{\\\"Intent\\\":{\\\"DeleteSnapshot\\\":{\\\"snapshot\\\":{\\\"allocation_id\\\":\\\"someallocationid\\\",\\\"backend\\\":{\\\"Details\\\":{\\\"Ceph\\\":{\\\"pool\\\":\\\"rbd\\\"}},\\\"cluster_id\\\":\\\"someclusterid\\\"},\\\"created_at\\\":\\\"2017-03-23T22:20:12Z\\\",\\\"id\\\":\\\"someid\\\",\\\"lifecycle_event_count\\\":1,\\\"name\\\":\\\"somename\\\",\\\"old_ceph_details\\\":{\\\"cluster\\\":\\\"somecluster\\\",\\\"pool\\\":\\\"rbd\\\"},\\\"parent_size_bytes\\\":107374182400,\\\"pending_events\\\":[{\\\"Event\\\":{\\\"SnapshotCreate\\\":{\\\"created_at\\\":\\\"2017-03-23T22:20:12Z\\\",\\\"name\\\":\\\"somename\\\"}},\\\"parent_id\\\":\\\"someparentid\\\",\\\"user_id\\\":117102}],\\\"user_id\\\":123456}}},\\\"claimed_at\\\":\\\"2017-05-17T23:37:17Z\\\",\\\"created_at\\\":\\\"2017-03-23T22:22:13Z\\\",\\\"delay_secs\\\":120,\\\"id\\\":\\\"someid\\\",\\\"owner\\\":{\\\"name\\\":\\\"somename\\\"}},\\\"level\\\":\\\"info\\\",\\\"msg\\\":\\\"releasing intent\\\",\\\"pid\\\":1,\\\"pname\\\":\\\"\\/cleanerd\\\",\\\"time\\\":\\\"2017-05-17T23:37:17Z\\\",\\\"version\\\":\\\"d8c41ea964\\\"}\",\r\n  \"egid\": 999,\r\n  \"eid\": 999,\r\n  \"env\": \"production\",\r\n  \"host\": \"cleaner-2795265912-tqeu6\",\r\n  \"intent\": {\r\n    \"Intent\": {\r\n      \"DeleteSnapshot\": {\r\n        \"snapshot\": {\r\n          \"allocation_id\": \"someallocationid\",\r\n          \"backend\": {\r\n            \"Details\": {\r\n              \"Ceph\": {\r\n                \"pool\": \"rbd\"\r\n              }\r\n            },\r\n            \"cluster_id\": \"fra1-prod\"\r\n          },\r\n          \"created_at\": \"2017-03-23T22:20:12Z\",\r\n          \"id\": \"someid\",\r\n          \"lifecycle_event_count\": 1,\r\n          \"name\": \"somename\",\r\n          \"old_ceph_details\": {\r\n            \"cluster\": \"fra1-prod\",\r\n            \"pool\": \"rbd\"\r\n          },\r\n          \"parent_size_bytes\": 107374182400,\r\n          \"pending_events\": [\r\n            {\r\n              \"Event\": {\r\n                \"SnapshotCreate\": {\r\n                  \"created_at\": \"2017-03-23T22:20:12Z\",\r\n                  \"name\": \"somename\"\r\n                }\r\n              },\r\n              \"parent_id\": \"someparentid\",\r\n              \"user_id\": 12345\r\n            }\r\n          ],\r\n          \"user_id\": 12345\r\n        }\r\n      }\r\n    },\r\n    \"claimed_at\": \"2017-05-17T23:37:17Z\",\r\n    \"created_at\": \"2017-03-23T22:22:13Z\",\r\n    \"delay_secs\": 120,\r\n    \"id\": \"someid\",\r\n    \"owner\": {\r\n      \"name\": \"somename\"\r\n    }\r\n  },\r\n  \"level\": \"info\",\r\n  \"msg\": \"releasing intent\",\r\n  \"pid\": 1,\r\n  \"pname\": \"\\/cleanerd\",\r\n  \"time\": \"2017-05-17T23:37:17Z\",\r\n  \"version\": \"d8c41ea964\"\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303692849","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-303692849","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":303692849,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzY5Mjg0OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-05-24T11:07:33Z","updated_at":"2017-05-24T11:07:33Z","author_association":"CONTRIBUTOR","body":"sorry, didn't see that\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303698118","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-303698118","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":303698118,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzY5ODExOA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2017-05-24T11:35:04Z","updated_at":"2017-05-24T11:35:04Z","author_association":"CONTRIBUTOR","body":"Hmmm nothing obvious that I can see.  Your regexes should use `[_\\-]` instead of `[_-]`, but I doubt that's the issue.  It doesn't replicate for me, but you said it happens only sometimes.  I wonder if a simple pattern like `*` is being parsed as a regex somewhere?\r\n\r\nHave you been able to narrow it down at all?  eg removing parts of the template to see if the problem goes away?  I'd also be interested to know if upgrading ES or Java helps.\r\n\r\nI don't have any ideas - I'll leave it for somebody else to investigate.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/303704606","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-303704606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":303704606,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMzcwNDYwNg==","user":{"login":"marc-lebourdais","id":4622295,"node_id":"MDQ6VXNlcjQ2MjIyOTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4622295?v=4","gravatar_id":"","url":"https://api.github.com/users/marc-lebourdais","html_url":"https://github.com/marc-lebourdais","followers_url":"https://api.github.com/users/marc-lebourdais/followers","following_url":"https://api.github.com/users/marc-lebourdais/following{/other_user}","gists_url":"https://api.github.com/users/marc-lebourdais/gists{/gist_id}","starred_url":"https://api.github.com/users/marc-lebourdais/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marc-lebourdais/subscriptions","organizations_url":"https://api.github.com/users/marc-lebourdais/orgs","repos_url":"https://api.github.com/users/marc-lebourdais/repos","events_url":"https://api.github.com/users/marc-lebourdais/events{/privacy}","received_events_url":"https://api.github.com/users/marc-lebourdais/received_events","type":"User","site_admin":false},"created_at":"2017-05-24T12:08:33Z","updated_at":"2017-05-24T12:08:33Z","author_association":"NONE","body":"This is our production cluster ingesting about 2TB of log data per day, with ~40TB total data. We don't have a lot of freedom to play around with arbitrary tests to see if the issue goes away, when it's seemingly sporadic as is. We're already on the 2.4.1 series running in docker, so I could bump to 2.4.4 but I don't have any reason to believe that that would fix the underlying problem.\r\n\r\nAt this point, we don't have to operational capacity to migrate to 5.x, so I was hoping the issue would be pretty obvious from the stack trace.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372667529","html_url":"https://github.com/elastic/elasticsearch/issues/24749#issuecomment-372667529","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24749","id":372667529,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjY2NzUyOQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T13:37:58Z","updated_at":"2018-03-13T13:37:58Z","author_association":"CONTRIBUTOR","body":"I don't think 2.4.4 would fix the problem either. I suspect @clintongormley is right that a simple pattern is sometimes parsed as a regex even though it shouldn't. The fact that you mentioned that this issue is sporadic also leads me to thinking that it might be specific to one node of the cluster.\r\n\r\nI will close this issue and improve validation of the match pattern for now: #29013. Let's revisit if/when someone reports this issue with a newer version. We will have more information to understand what is happening.","performed_via_github_app":null}]