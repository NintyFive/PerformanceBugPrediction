{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34785","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34785/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34785/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34785/events","html_url":"https://github.com/elastic/elasticsearch/issues/34785","id":373258376,"node_id":"MDU6SXNzdWUzNzMyNTgzNzY=","number":34785,"title":"TribeClientYamlTestSuiteIT fails with a 'master not discovered' exception.","user":{"login":"jtibshirani","id":7461306,"node_id":"MDQ6VXNlcjc0NjEzMDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7461306?v=4","gravatar_id":"","url":"https://api.github.com/users/jtibshirani","html_url":"https://github.com/jtibshirani","followers_url":"https://api.github.com/users/jtibshirani/followers","following_url":"https://api.github.com/users/jtibshirani/following{/other_user}","gists_url":"https://api.github.com/users/jtibshirani/gists{/gist_id}","starred_url":"https://api.github.com/users/jtibshirani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jtibshirani/subscriptions","organizations_url":"https://api.github.com/users/jtibshirani/orgs","repos_url":"https://api.github.com/users/jtibshirani/repos","events_url":"https://api.github.com/users/jtibshirani/events{/privacy}","received_events_url":"https://api.github.com/users/jtibshirani/received_events","type":"User","site_admin":false},"labels":[{"id":912843355,"node_id":"MDU6TGFiZWw5MTI4NDMzNTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Rollup","name":":Analytics/Rollup","color":"0e8a16","default":false,"description":"Turn fine-grained time-based data into coarser-grained data"},{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2018-10-24T00:39:51Z","updated_at":"2018-10-24T15:05:23Z","closed_at":"2018-10-24T15:05:02Z","author_association":"MEMBER","active_lock_reason":null,"body":"This failure reliably reproduces for me locally on 6.x.\r\n\r\n---\r\n\r\nLink to the build: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+default-distro/22/console\r\n\r\nCommand to reproduce:\r\n```\r\n./gradlew :qa:smoke-test-tribe-node:integTestRunner \\\r\n  -Dtests.seed=84307D98419C3703 \\\r\n  -Dtests.class=org.elasticsearch.tribe.TribeClientYamlTestSuiteIT \\\r\n  -Dtests.method=\"test {yaml=tribe/10_basic/Tribe node test}\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ga-IE \\\r\n  -Dtests.timezone=America/Maceio \\\r\n  -Dtests.distribution=zip \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nRelevant excerpt from the logs:\r\n```\r\nERROR   1.30s | TribeClientYamlTestSuiteIT.test {yaml=tribe/10_basic/Tribe node test} <<< FAILURES!\r\n   > Throwable #1: org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:40200], URI [/_xpack/rollup/job/_all], status line [HTTP/1.1 503 Service Unavailable]\r\n   > {\"error\":{\"root_cause\":[{\"type\":\"master_not_discovered_exception\",\"reason\":\"no known master nodes\"}],\"type\":\"master_not_discovered_exception\",\"reason\":\"no known master nodes\"},\"status\":503}\r\n   >    at __randomizedtesting.SeedInfo.seed([84307D98419C3703:C644242EF605AFB]:0)\r\n   >    at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:926)\r\n   >    at org.elasticsearch.client.RestClient.performRequest(RestClient.java:229)\r\n   >    at org.elasticsearch.test.rest.ESRestTestCase.wipeRollupJobs(ESRestTestCase.java:464)\r\n   >    at org.elasticsearch.test.rest.ESRestTestCase.wipeCluster(ESRestTestCase.java:389)\r\n   >    at org.elasticsearch.test.rest.ESRestTestCase.cleanUpCluster(ESRestTestCase.java:184)\r\n   >    at java.lang.Thread.run(Thread.java:748)\r\n   > Caused by: org.elasticsearch.client.ResponseException: method [GET], host [http://[::1]:40200], URI [/_xpack/rollup/job/_all], status line [HTTP/1.1 503 Service Unavailable]\r\n   > {\"error\":{\"root_cause\":[{\"type\":\"master_not_discovered_exception\",\"reason\":\"no known master nodes\"}],\"type\":\"master_not_discovered_exception\",\"reason\":\"no known master nodes\"},\"status\":503}\r\n   >    at org.elasticsearch.client.RestClient$1.completed(RestClient.java:546)\r\n   >    at org.elasticsearch.client.RestClient$1.completed(RestClient.java:531)\r\n   >    at org.apache.http.concurrent.BasicFuture.completed(BasicFuture.java:119)\r\n   >    at org.apache.http.impl.nio.client.DefaultClientExchangeHandlerImpl.responseCompleted(DefaultClientExchangeHandlerImpl.java:177)\r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.processResponse(HttpAsyncRequestExecutor.java:436)\r\n   >    at org.apache.http.nio.protocol.HttpAsyncRequestExecutor.inputReady(HttpAsyncRequestExecutor.java:326)\r\n   >    at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:265)\r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:81)\r\n   >    at org.apache.http.impl.nio.client.InternalIODispatch.onInputReady(InternalIODispatch.java:39)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:114)\r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:162)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:337)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:315)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:276)\r\n   >    at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:104)\r\n   >    at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:588)\r\n   >    ... 1 more\r\n```\r\n\r\nFull build log: [build_log.txt](https://github.com/elastic/elasticsearch/files/2508622/build_log.txt)\r\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}