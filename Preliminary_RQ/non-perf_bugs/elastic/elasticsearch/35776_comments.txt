[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440664589","html_url":"https://github.com/elastic/elasticsearch/issues/35776#issuecomment-440664589","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35776","id":440664589,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDY2NDU4OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T13:37:48Z","updated_at":"2018-11-21T13:37:48Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440665243","html_url":"https://github.com/elastic/elasticsearch/issues/35776#issuecomment-440665243","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35776","id":440665243,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDY2NTI0Mw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T13:40:09Z","updated_at":"2018-11-21T13:40:09Z","author_association":"MEMBER","body":"I'm not positive if it is identical in practice, but I would guess that [`terminate_after` parameter](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-body.html#_parameters_4) gives much the same effect?  `terminate_after` tells the shard to stop collecting results after `n` documents have been collected","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440694172","html_url":"https://github.com/elastic/elasticsearch/issues/35776#issuecomment-440694172","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35776","id":440694172,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDY5NDE3Mg==","user":{"login":"pontus-mp","id":19261514,"node_id":"MDQ6VXNlcjE5MjYxNTE0","avatar_url":"https://avatars1.githubusercontent.com/u/19261514?v=4","gravatar_id":"","url":"https://api.github.com/users/pontus-mp","html_url":"https://github.com/pontus-mp","followers_url":"https://api.github.com/users/pontus-mp/followers","following_url":"https://api.github.com/users/pontus-mp/following{/other_user}","gists_url":"https://api.github.com/users/pontus-mp/gists{/gist_id}","starred_url":"https://api.github.com/users/pontus-mp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pontus-mp/subscriptions","organizations_url":"https://api.github.com/users/pontus-mp/orgs","repos_url":"https://api.github.com/users/pontus-mp/repos","events_url":"https://api.github.com/users/pontus-mp/events{/privacy}","received_events_url":"https://api.github.com/users/pontus-mp/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T15:00:40Z","updated_at":"2018-11-21T15:00:40Z","author_association":"NONE","body":"`terminate_after` didn't work as expected when I experimented with it. I did a test with `offset=100`, `size=200`, which (if I understand things correctly) should collect 300 hits per shard. However, using `terminate_after=300` with an otherwise unchanged query resulted in very different hits.\r\n\r\nI assume it's more intended as a circuit breaker which does not consider scoring when triggered, or similar?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440868917","html_url":"https://github.com/elastic/elasticsearch/issues/35776#issuecomment-440868917","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35776","id":440868917,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDg2ODkxNw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-11-22T00:46:06Z","updated_at":"2018-11-22T00:46:06Z","author_association":"MEMBER","body":"`terminate_after` stops the collection after `n` documents have been collected regardless of how they rank in the query. The costly part of deep pagination is that each shard needs to return the top N documents starting from 0 no matter what `from` is. The feature that is proposed here is to return a top N per shard where N is less than the total requested `size`. The idea is that the contribution to the final top N is spread among the shards if the rank of documents is randomly distributed. \r\n\r\nI have some concerns with this approach. I understand it can help to speed up the retrieval of a deep page but how can you ensure a consistent pagination if retrieving the next deep page can completely invalidate the top N of the previous page ? With this solution it would be possible to return the same document on two different pages which makes the pagination less useful.\r\nI also don't think we should encourage deep pagination like that, we have other solutions that are more scalable and that does not require to sacrifice precision. A feature like [`search_after`](https://www.elastic.co/guide/en/elasticsearch/reference/master/search-request-search-after.html) for instance allows to efficiently walk deep into a search, why not using that ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440938823","html_url":"https://github.com/elastic/elasticsearch/issues/35776#issuecomment-440938823","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35776","id":440938823,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDkzODgyMw==","user":{"login":"pontus-mp","id":19261514,"node_id":"MDQ6VXNlcjE5MjYxNTE0","avatar_url":"https://avatars1.githubusercontent.com/u/19261514?v=4","gravatar_id":"","url":"https://api.github.com/users/pontus-mp","html_url":"https://github.com/pontus-mp","followers_url":"https://api.github.com/users/pontus-mp/followers","following_url":"https://api.github.com/users/pontus-mp/following{/other_user}","gists_url":"https://api.github.com/users/pontus-mp/gists{/gist_id}","starred_url":"https://api.github.com/users/pontus-mp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pontus-mp/subscriptions","organizations_url":"https://api.github.com/users/pontus-mp/orgs","repos_url":"https://api.github.com/users/pontus-mp/repos","events_url":"https://api.github.com/users/pontus-mp/events{/privacy}","received_events_url":"https://api.github.com/users/pontus-mp/received_events","type":"User","site_admin":false},"created_at":"2018-11-22T07:36:14Z","updated_at":"2018-11-22T07:36:14Z","author_association":"NONE","body":"`search_after` is great when you are doing things like iterating over entire result sets, but implementing good pagination for user-facing search functionality ends up being quite challenging. Using \"next-only\" pagination is simple, but that tends to frustrate users.\r\n\r\nThe shard-level limit might seem quite dangerous at first, but you can do things like having no limit for the first X pages and then using a limit that will still give you 99.9% accuracy as you go deeper into the result set. Shutterstock actually does this, apparently quite successfully!\r\n\r\nI'm not suggesting that there should be some built-in \"fuzzy-pagination\" function in elasticsearch, but rather that the tools are available for that.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/489969943","html_url":"https://github.com/elastic/elasticsearch/issues/35776#issuecomment-489969943","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35776","id":489969943,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4OTk2OTk0Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-05-07T07:38:29Z","updated_at":"2019-05-07T07:38:29Z","author_association":"MEMBER","body":"We don't plan to work on this feature so I am closing this issue, we have solutions for deep pagination (`search_after`, `scroll`)  that don't affect precision. It is still possible to implement the proposed solution but we think that it would be more consistent to do it in a plugin rather than in the `_search` endpoint.","performed_via_github_app":null}]