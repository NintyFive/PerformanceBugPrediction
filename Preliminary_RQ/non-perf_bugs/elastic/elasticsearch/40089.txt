{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/40089","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40089/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40089/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/40089/events","html_url":"https://github.com/elastic/elasticsearch/issues/40089","id":421485847,"node_id":"MDU6SXNzdWU0MjE0ODU4NDc=","number":40089,"title":"[CI] Multiple failures in CcrRetentionLeaseIT ","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"labels":[{"id":912824565,"node_id":"MDU6TGFiZWw5MTI4MjQ1NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CCR","name":":Distributed/CCR","color":"0e8a16","default":false,"description":"Issues around the Cross Cluster State Replication features"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1222918656,"node_id":"MDU6TGFiZWwxMjIyOTE4NjU2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.0","name":"v7.2.0","color":"DDDDDD","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-03-15T12:01:37Z","updated_at":"2019-03-23T13:51:41Z","closed_at":"2019-03-23T13:51:41Z","author_association":"MEMBER","active_lock_reason":null,"body":"Possibly related to #39509\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+internalClusterTest/2350/console\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:internalClusterTest \\\r\n  -Dtests.seed=377894C8C7910121 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT \\\r\n  -Dtests.method=\"testRetentionLeasesAreNotBeingRenewedAfterRecoveryCompletes\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ja-JP-u-ca-japanese-x-lvariant-JP \\\r\n  -Dtests.timezone=GMT0 \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:internalClusterTest \\\r\n  -Dtests.seed=377894C8C7910121 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT \\\r\n  -Dtests.method=\"testUnfollowFailsToRemoveRetentionLeases\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ja-JP-u-ca-japanese-x-lvariant-JP \\\r\n  -Dtests.timezone=GMT0 \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:internalClusterTest \\\r\n  -Dtests.seed=377894C8C7910121 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT \\\r\n  -Dtests.method=\"testRetentionLeaseRenewedWhileFollowing\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ja-JP-u-ca-japanese-x-lvariant-JP \\\r\n  -Dtests.timezone=GMT0 \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n\r\nREPRODUCE WITH: ./gradlew :x-pack:plugin:ccr:internalClusterTest \\\r\n  -Dtests.seed=377894C8C7910121 \\\r\n  -Dtests.class=org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT \\\r\n  -Dtests.method=\"testRetentionLeaseIsAddedIfItDisappearsWhileFollowing\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ja-JP-u-ca-japanese-x-lvariant-JP \\\r\n  -Dtests.timezone=GMT0 \\\r\n  -Dcompiler.java=11 \\\r\n  -Druntime.java=8\r\n```\r\n\r\nA number of errors like:\r\n\r\n```\r\njava.lang.AssertionError: CreateIndexResponse failed - index creation acked but not all shards were started\r\n\tat org.junit.Assert.fail(Assert.java:88)\r\n\tat org.junit.Assert.assertTrue(Assert.java:41)\r\n\tat org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked(ElasticsearchAssertions.java:125)\r\n\tat org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT.testRetentionLeaseIsAddedIfItDisappearsWhileFollowing(CcrRetentionLeaseIT.java:759)\r\n\r\n\r\njava.lang.AssertionError: CreateIndexResponse failed - index creation acked but not all shards were started\r\n\tat org.junit.Assert.fail(Assert.java:88)\r\n\tat org.junit.Assert.assertTrue(Assert.java:41)\r\n\tat org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked(ElasticsearchAssertions.java:125)\r\n\tat org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT.testUnfollowRemovesRetentionLeases(CcrRetentionLeaseIT.java:379)\r\n\r\njava.lang.AssertionError: CreateIndexResponse failed - index creation acked but not all shards were started\r\n\tat org.junit.Assert.fail(Assert.java:88)\r\n\tat org.junit.Assert.assertTrue(Assert.java:41)\r\n\tat org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked(ElasticsearchAssertions.java:125)\r\n\tat org.elasticsearch.xpack.ccr.CcrRetentionLeaseIT.testForgetFollower(CcrRetentionLeaseIT.java:931)\r\n\r\ncom.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=47, name=elasticsearch[leaderd4][transport_worker][T#2], state=RUNNABLE, group=TGRP-CcrRetentionLeaseIT]\r\nCaused by: java.lang.AssertionError: shard [leader][0], node[xAJZZ5hpRLCJklizBkx0uw], [P], recovery_source[new shard recovery], s[INITIALIZING], a[id=MYU37kVrQOiBS8JDjMLVJA], unassigned_info[[reason=INDEX_CREATED], at[2019-03-15T02:17:39.163Z], delayed=false, allocation_status[no_attempt]] is not a primary shard in primary mode\r\n\tat __randomizedtesting.SeedInfo.seed([377894C8C7910121]:0)\r\n\tat org.elasticsearch.index.shard.IndexShard.assertPrimaryMode(IndexShard.java:1576)\r\n\tat org.elasticsearch.index.shard.IndexShard.renewRetentionLease(IndexShard.java:1974)\r\n\tat org.elasticsearch.index.seqno.RetentionLeaseActions$Renew$TransportAction.doRetentionLeaseAction(RetentionLeaseActions.java:217)\r\n\tat org.elasticsearch.index.seqno.RetentionLeaseActions$Renew$TransportAction.doRetentionLeaseAction(RetentionLeaseActions.java:193)\r\n\tat org.elasticsearch.index.seqno.RetentionLeaseActions$TransportRetentionLeaseAction$1.onResponse(RetentionLeaseActions.java:103)\r\n\tat org.elasticsearch.index.seqno.RetentionLeaseActions$TransportRetentionLeaseAction$1.onResponse(RetentionLeaseActions.java:98)\r\n\tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:269)\r\n\tat org.elasticsearch.index.shard.IndexShardOperationPermits.acquire(IndexShardOperationPermits.java:236)\r\n\tat org.elasticsearch.index.shard.IndexShard.acquirePrimaryOperationPermit(IndexShard.java:2503)\r\n\tat org.elasticsearch.index.seqno.RetentionLeaseActions$TransportRetentionLeaseAction.asyncShardOperation(RetentionLeaseActions.java:97)\r\n\tat org.elasticsearch.index.seqno.RetentionLeaseActions$TransportRetentionLeaseAction.asyncShardOperation(RetentionLeaseActions.java:59)\r\n\tat org.elasticsearch.action.support.single.shard.TransportSingleShardAction$ShardTransportHandler.messageReceived(TransportSingleShardAction.java:299)\r\n\tat org.elasticsearch.action.support.single.shard.TransportSingleShardAction$ShardTransportHandler.messageReceived(TransportSingleShardAction.java:292)\r\n\tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63)\r\n\tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1073)\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n\tat org.elasticsearch.common.util.concurrent.EsExecutors$DirectExecutorService.execute(EsExecutors.java:192)\r\n\tat org.elasticsearch.transport.TcpTransport.handleRequest(TcpTransport.java:1032)\r\n\tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:918)\r\n\tat org.elasticsearch.transport.TcpTransport.inboundMessage(TcpTransport.java:753)\r\n\tat org.elasticsearch.transport.TcpTransport.consumeNetworkReads(TcpTransport.java:780)\r\n\tat org.elasticsearch.transport.nio.MockNioTransport$MockTcpReadWriteHandler.consumeReads(MockNioTransport.java:241)\r\n\tat org.elasticsearch.nio.SocketChannelContext.handleReadBytes(SocketChannelContext.java:213)\r\n\tat org.elasticsearch.nio.BytesChannelContext.read(BytesChannelContext.java:47)\r\n\tat org.elasticsearch.nio.EventHandler.handleRead(EventHandler.java:119)\r\n\tat org.elasticsearch.transport.nio.TestEventHandler.handleRead(TestEventHandler.java:121)\r\n\tat org.elasticsearch.nio.NioSelector.handleRead(NioSelector.java:397)\r\n\tat org.elasticsearch.nio.NioSelector.processKey(NioSelector.java:246)\r\n\tat org.elasticsearch.nio.NioSelector.singleLoop(NioSelector.java:172)\r\n\tat org.elasticsearch.nio.NioSelector.runLoop(NioSelector.java:129)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n[The full test log](https://github.com/elastic/elasticsearch/files/2970878/test_log.txt)\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}