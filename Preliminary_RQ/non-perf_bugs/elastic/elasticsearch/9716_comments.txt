[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/86151083","html_url":"https://github.com/elastic/elasticsearch/issues/9716#issuecomment-86151083","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9716","id":86151083,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MTUxMDgz","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2015-03-25T18:03:02Z","updated_at":"2015-03-25T18:03:02Z","author_association":"CONTRIBUTOR","body":"Can you post your field mappings?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/86402025","html_url":"https://github.com/elastic/elasticsearch/issues/9716#issuecomment-86402025","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9716","id":86402025,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NDAyMDI1","user":{"login":"j0r0","id":370737,"node_id":"MDQ6VXNlcjM3MDczNw==","avatar_url":"https://avatars1.githubusercontent.com/u/370737?v=4","gravatar_id":"","url":"https://api.github.com/users/j0r0","html_url":"https://github.com/j0r0","followers_url":"https://api.github.com/users/j0r0/followers","following_url":"https://api.github.com/users/j0r0/following{/other_user}","gists_url":"https://api.github.com/users/j0r0/gists{/gist_id}","starred_url":"https://api.github.com/users/j0r0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/j0r0/subscriptions","organizations_url":"https://api.github.com/users/j0r0/orgs","repos_url":"https://api.github.com/users/j0r0/repos","events_url":"https://api.github.com/users/j0r0/events{/privacy}","received_events_url":"https://api.github.com/users/j0r0/received_events","type":"User","site_admin":false},"created_at":"2015-03-26T08:35:41Z","updated_at":"2015-03-26T08:35:41Z","author_association":"CONTRIBUTOR","body":"Sure. I am posting only the relevant fields\n\n```\n\"ts\": {\n  \"format\": \"dateOptionalTime\",\n  \"type\": \"date\"\n},\n\"loc\": {\n  \"tree\": \"quadtree\",\n  \"type\": \"geo_shape\"\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/86925643","html_url":"https://github.com/elastic/elasticsearch/issues/9716#issuecomment-86925643","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9716","id":86925643,"node_id":"MDEyOklzc3VlQ29tbWVudDg2OTI1NjQz","user":{"login":"j0r0","id":370737,"node_id":"MDQ6VXNlcjM3MDczNw==","avatar_url":"https://avatars1.githubusercontent.com/u/370737?v=4","gravatar_id":"","url":"https://api.github.com/users/j0r0","html_url":"https://github.com/j0r0","followers_url":"https://api.github.com/users/j0r0/followers","following_url":"https://api.github.com/users/j0r0/following{/other_user}","gists_url":"https://api.github.com/users/j0r0/gists{/gist_id}","starred_url":"https://api.github.com/users/j0r0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/j0r0/subscriptions","organizations_url":"https://api.github.com/users/j0r0/orgs","repos_url":"https://api.github.com/users/j0r0/repos","events_url":"https://api.github.com/users/j0r0/events{/privacy}","received_events_url":"https://api.github.com/users/j0r0/received_events","type":"User","site_admin":false},"created_at":"2015-03-27T12:22:24Z","updated_at":"2015-03-27T12:22:24Z","author_association":"CONTRIBUTOR","body":"I just noticed something which can eventually help you.\nThe direction of polygon I am describing is clockwise.\nSo : topleft , topright,bottomright,bottomleft,repeatfirst\n\nIf i change the direction to ccw, it is returning correct results.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/87050244","html_url":"https://github.com/elastic/elasticsearch/issues/9716#issuecomment-87050244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9716","id":87050244,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MDUwMjQ0","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2015-03-27T18:48:02Z","updated_at":"2015-03-27T18:48:02Z","author_association":"CONTRIBUTOR","body":"@j0r0 Thanks for the feedback.\n\nIf I understand the behavior you're describing then its working as expected.  We switched the ShapeBuilder winding order to comply with the OGC right-hand rule.  While geojson does not care, this indifference becomes problematic for ambiguous polygons such as yours (e.g., no way of knowing whether the specified poly crosses the dateline or spans the globe).  By complying with the right-hand rule we impose deterministic ordering in the ShapeBuilder to remove these ambiguities.  When you specified your coordinates in clockwise order, the builder interpreted them in counter-clockwise - thus the poly crosses the dateline instead of spanning the globe.  The one exception is a global spanning polygon - which is unambiguous.  \n\nThere's also another issue at play here (which affects the results for large filters).  If you increase the `tree_level` and reduce the `distance_error_pct` values in your mapping, you will (should) see different results.  That behavior is related to issues #2361, #9691, #9680 and has to do with the accuracy of the quad cells.  By accepting defaults you're using a `tree_level` of 12 which maps to a cell coverage area of ~0.022/0.044 degrees lat/lon.  The `distance_error_pct` adds another fuzzy factor (default of 2.5% the length of the shape's bounding box diagonal)  So for large polygons this error factor will increase.  This is an issue thats currently being worked and should be fixed very soon.  For now, the best approach is to find a balance between the precision you really need and performance requirements.  Post filtering results in the application layer is a good way of weeding out the false matches (which you won't need to do once these issues are corrected).\n\nI hope this helps  \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89759099","html_url":"https://github.com/elastic/elasticsearch/issues/9716#issuecomment-89759099","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9716","id":89759099,"node_id":"MDEyOklzc3VlQ29tbWVudDg5NzU5MDk5","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T12:27:06Z","updated_at":"2015-04-05T12:27:06Z","author_association":"CONTRIBUTOR","body":"@nknize can this issue be closed, or do you want to keep it open for now?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/90070044","html_url":"https://github.com/elastic/elasticsearch/issues/9716#issuecomment-90070044","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9716","id":90070044,"node_id":"MDEyOklzc3VlQ29tbWVudDkwMDcwMDQ0","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2015-04-06T13:43:56Z","updated_at":"2015-04-06T13:43:56Z","author_association":"CONTRIBUTOR","body":"Unless @j0r0 has an outstanding issue I consider this resolved.  Lets give a day or so for further feedback.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/92826196","html_url":"https://github.com/elastic/elasticsearch/issues/9716#issuecomment-92826196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9716","id":92826196,"node_id":"MDEyOklzc3VlQ29tbWVudDkyODI2MTk2","user":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"created_at":"2015-04-14T13:20:50Z","updated_at":"2015-04-14T13:20:50Z","author_association":"CONTRIBUTOR","body":"Closing as non-issue\n","performed_via_github_app":null}]