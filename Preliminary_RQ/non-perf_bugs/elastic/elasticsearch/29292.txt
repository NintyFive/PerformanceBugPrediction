{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/29292","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29292/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29292/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29292/events","html_url":"https://github.com/elastic/elasticsearch/issues/29292","id":309673387,"node_id":"MDU6SXNzdWUzMDk2NzMzODc=","number":29292,"title":"Build: Forbiddenapis is not running for Java9 SourceSet","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"labels":[{"id":106454670,"node_id":"MDU6TGFiZWwxMDY0NTQ2NzA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Build","name":":Delivery/Build","color":"0e8a16","default":false,"description":"Build or test infrastructure"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2018-03-29T08:59:20Z","updated_at":"2020-11-11T21:41:50Z","closed_at":"2018-04-18T06:02:56Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Due to a bug in forbiddenapis the forbidden tasks are not enabled for the sourceSet named \"java9\" in the server module.\r\n\r\nThe corresponding bug is: https://github.com/policeman-tools/forbidden-apis/issues/138\r\n\r\nSee also discussion on #29289\r\n\r\nI fixed the bug locally and it was working now, the only problem is setup of signatures files for the \"java9\" sourceSet: We do not have any dependencies, so parsing the default signatures fails:\r\n\r\n```\r\n:server:java9Classes (Thread[Task worker for ':' Thread 3,5,main]) completed. Took 0.0 secs.\r\n:server:forbiddenApisJava9 (Thread[Task worker for ':' Thread 3,5,main]) started.\r\n\r\n> Task :server:forbiddenApisJava9 FAILED\r\nTask ':server:forbiddenApisJava9' is not up-to-date because:\r\n  Task has failed previously.\r\nReading bundled API signatures: jdk-unsafe-1.8\r\nReading bundled API signatures: jdk-deprecated-1.8\r\nReading bundled API signatures: jdk-non-portable\r\nReading bundled API signatures: jdk-system-out\r\nReading API signatures: jar:file:/C:/Users/Uwe%20Schindler/.gradle/caches/jars-3/f2f51995af2698f84880e96f412cac8d/buildSrc-7.0.0-alpha1-SNAPSHOT.jar!/forbidden/jdk-signatures.txt\r\nReading API signatures: jar:file:/C:/Users/Uwe%20Schindler/.gradle/caches/jars-3/f2f51995af2698f84880e96f412cac8d/buildSrc-7.0.0-alpha1-SNAPSHOT.jar!/forbidden/es-all-signatures.txt\r\n\r\n:server:forbiddenApisJava9 (Thread[Task worker for ':' Thread 3,5,main]) completed. Took 0.538 secs.\r\n\r\nFAILURE: Build failed with an exception.\r\n\r\n* What went wrong:\r\nExecution failed for task ':server:forbiddenApisJava9'.\r\n> Parsing signatures failed: Class 'org.apache.lucene.util.IOUtils' not found on classpath while parsing signature: org.apache.lucene.util.IOUtils\r\n```\r\n\r\nThis has to be fixed once forbiddenApis is updated:\r\n\r\n- set `targetCompatibility` (like done for the compile task). Maybe there is a more generic solution in the build plugin.\r\n- add missing dependencies to compile classpath, or alternatively remove the signatures that don't work.","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}