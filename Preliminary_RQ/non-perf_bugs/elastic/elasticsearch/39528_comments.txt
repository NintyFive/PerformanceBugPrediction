[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/468434902","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-468434902","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":468434902,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODQzNDkwMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-02-28T20:55:59Z","updated_at":"2019-02-28T20:55:59Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/468436851","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-468436851","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":468436851,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODQzNjg1MQ==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2019-02-28T21:01:51Z","updated_at":"2019-02-28T21:01:51Z","author_association":"CONTRIBUTOR","body":"Thanks for reporting this, it looks like there's an issue with this setting in general in 6.6.1 (not particular to percolator or query string queries)\r\n\r\nI'm able to reproduce this by\r\n\r\n1. setting `indices.query.bool.max_clause_count` above 1024 in elasticsearch.yml before node startup (I set it to 5000)\r\n\r\n2. \r\n\r\n```\r\nPUT /test/\r\n{\r\n  \"settings\": {\r\n    \"number_of_replicas\": 0,\r\n    \"number_of_shards\": 1\r\n  },\r\n  \"mappings\": {\r\n    \"_doc\": {\r\n      \"properties\": {\r\n        \"message\": {\r\n          \"type\": \"keyword\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n3. Running a bool query against the field in this index with 2000 term queries in `should` clauses\r\n\r\nI get\r\n\r\n```\r\nFailed to execute [SearchRequest{searchType=QUERY_THEN_FETCH, indices=[test], indicesOptions=IndicesOptions[ignore_unavailable=false, allow_no_indices=true, expand_wildcards_open=true, expand_wildcards_closed=false, allow_aliases_to_multiple_indices=true, forbid_closed_indices=true, ignore_aliases=false, ignore_throttled=true], types=[], routing='null', preference='null', requestCache=null, scroll=null, maxConcurrentShardRequests=5, batchedReduceSize=512, preFilterShardSize=128, allowPartialSearchResults=true, source={\"query\":<huge bool query>\r\norg.elasticsearch.transport.RemoteTransportException: [SDLDw-H][127.0.0.1:9300][indices:data/read/search[phase/query]]\r\nCaused by: org.elasticsearch.index.query.QueryShardException: failed to create query: <huge bool query>\r\n\r\n        at org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:324) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:307) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:806) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:656) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:631) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:388) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.access$100(SearchService.java:126) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:360) [elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:356) [elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1117) [elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:759) [elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) [elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.6.1.jar:6.6.1]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n        at java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: org.apache.lucene.search.BooleanQuery$TooManyClauses: maxClauseCount is set to 1024\r\n        at org.apache.lucene.search.BooleanQuery$Builder.add(BooleanQuery.java:114) ~[lucene-core-7.6.0.jar:7.6.0 719cde97f84640faa1e3525690d262946571245f - nknize - 2018-12-07 14:44:20]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.addBooleanClauses(BoolQueryBuilder.java:422) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.index.query.BoolQueryBuilder.doToQuery(BoolQueryBuilder.java:385) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.index.query.AbstractQueryBuilder.toQuery(AbstractQueryBuilder.java:104) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.index.query.QueryShardContext.lambda$toQuery$2(QueryShardContext.java:308) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:320) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.index.query.QueryShardContext.toQuery(QueryShardContext.java:307) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:806) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:656) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:631) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:388) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService.access$100(SearchService.java:126) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:360) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService$2.onResponse(SearchService.java:356) [elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.search.SearchService$4.doRun(SearchService.java:1117) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:759) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.6.1.jar:6.6.1]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n        at java.lang.Thread.run(Thread.java:834) ~[?:?]\r\n[2019-02-28T12:44:02,655][DEBUG][o.e.a.s.TransportSearchAction] [SDLDw-H] All shards failed for phase: [query]","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/468719774","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-468719774","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":468719774,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODcxOTc3NA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2019-03-01T16:16:51Z","updated_at":"2019-03-01T16:16:51Z","author_association":"CONTRIBUTOR","body":"This just came up in a support issue - not a percolator request but a regular search with a lot of terms.\r\nThe 6.6.0 distribution I tested failed but the 6.7 branch running in my IDE was OK","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469289942","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-469289942","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":469289942,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTI4OTk0Mg==","user":{"login":"ra-coder","id":47606823,"node_id":"MDQ6VXNlcjQ3NjA2ODIz","avatar_url":"https://avatars0.githubusercontent.com/u/47606823?v=4","gravatar_id":"","url":"https://api.github.com/users/ra-coder","html_url":"https://github.com/ra-coder","followers_url":"https://api.github.com/users/ra-coder/followers","following_url":"https://api.github.com/users/ra-coder/following{/other_user}","gists_url":"https://api.github.com/users/ra-coder/gists{/gist_id}","starred_url":"https://api.github.com/users/ra-coder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ra-coder/subscriptions","organizations_url":"https://api.github.com/users/ra-coder/orgs","repos_url":"https://api.github.com/users/ra-coder/repos","events_url":"https://api.github.com/users/ra-coder/events{/privacy}","received_events_url":"https://api.github.com/users/ra-coder/received_events","type":"User","site_admin":false},"created_at":"2019-03-04T15:17:57Z","updated_at":"2019-03-04T15:17:57Z","author_association":"NONE","body":"also find this bug ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469616982","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-469616982","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":469616982,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTYxNjk4Mg==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T09:58:37Z","updated_at":"2019-03-05T09:58:37Z","author_association":"CONTRIBUTOR","body":"Another case here: https://discuss.elastic.co/t/booleanquery-toomanyclauses-buyt-have-updated-config-file-to-increase-it/170858","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469756664","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-469756664","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":469756664,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTc1NjY2NA==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T16:47:12Z","updated_at":"2019-03-05T16:47:12Z","author_association":"CONTRIBUTOR","body":"I tested this on snapshot builds at the heads of master (`8.0.0-SNAPSHOT`), 7.x (`7.1.0-SNAPSHOT`), 6.7 (`6.7.0-SNAPSHOT`), and 6.6 (`6.6.2-SNAPSHOT`) and did not reproduce on any of them","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469778121","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-469778121","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":469778121,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTc3ODEyMQ==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T17:39:03Z","updated_at":"2019-03-05T17:41:36Z","author_association":"CONTRIBUTOR","body":"Reproduced on 7.0.0-beta1\r\n\r\nconfig/elasticsearch.yml:\r\n\r\n    indices.query.bool.max_clause_count: 2048\r\n\r\nSetting confirmed in http://localhost:9200/_nodes?pretty\r\n\r\n        \"indices\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"max_clause_count\" : \"2048\"\r\n            }\r\n          }\r\n        },\r\n\r\nUsing this python script I get an error complaining about a 1024 limit.\r\n\r\n\tfrom elasticsearch.client import Elasticsearch\r\n\tes = Elasticsearch()\r\n\r\n\tindexName = \"test\"\r\n\tes = Elasticsearch()\r\n\tindexSettings = {\r\n\t\t\"settings\": {\r\n\t\t\t\"number_of_shards\": 1\r\n\t\t},\r\n\t\t\"mappings\": {\r\n\t\t\t# \"_doc\": {\r\n\t\t\t\"properties\": {\r\n\t\t\t\t\"message\": {\r\n\t\t\t\t\t\"type\": \"keyword\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t# }\r\n\t\t}\r\n\t}\r\n\tif not es.indices.exists(index=indexName):\r\n\t\tes.indices.create(index=indexName, body=indexSettings)\r\n\r\n\t# This is OK\r\n\tmaxIds = 1024\r\n\t# But below fails with Caused by: org.apache.lucene.search.BooleanQuery$TooManyClauses: maxClauseCount is set to 1024\r\n\t# maxIds = 1025\r\n\r\n\tnumItems = 0\r\n\tshoulds = []\r\n\twhile numItems < maxIds:\r\n\t\tnumItems += 1\r\n\t\tshoulds.append({\r\n\t\t\t\"term\": {\r\n\t\t\t\t\"message\": \"foo\" + str(numItems)\r\n\t\t\t}\r\n\t\t})\r\n\tq = {\r\n\t\t\"size\": 10,\r\n\t\t\"query\": {\r\n\t\t\t\"bool\": {\r\n\t\t\t\t\"should\": shoulds\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tresults = es.search(index=\"test\", body=q)\r\n\r\n\r\nCan you share your test rig @andyb-elastic   ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469785699","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-469785699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":469785699,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTc4NTY5OQ==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T17:59:00Z","updated_at":"2019-03-05T17:59:00Z","author_association":"CONTRIBUTOR","body":"Yeah this is what I'm doing\r\n\r\n1. build from branch\r\n2. Add `indices.query.bool.max_clause_count: 5000` to config\r\n3.  `curl -X PUT localhost:9200/test -H 'Content-Type: application/json' -d '{\"settings\":{\"number_of_replicas\": 0,\"number_of_shards\": 1},\"mappings\":{\"properties\": {\"message\": {\"type\": \"keyword\"}}}}'`\r\n4. `curl --data @entire-long-bool-query.json -H 'Content-Type: application/json' localhost:9200/test/_search`\r\n\r\nThe file with that query\r\n[entire-long-bool-query.json.txt](https://github.com/elastic/elasticsearch/files/2932158/entire-long-bool-query.json.txt)\r\n\r\nI was able to reproduce this on 7.0.0-SNAPSHOT (19fa399380f15c9d8bc6dc92601fba3ba48fa91f) from the default distribution (linux-tar) but not from the oss distribution (oss-linux-tar) so I'll go back and check the other versions' default distributions","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469788241","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-469788241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":469788241,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTc4ODI0MQ==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T18:05:33Z","updated_at":"2019-03-05T18:05:33Z","author_association":"CONTRIBUTOR","body":"I wonder if it's a classloader thing - the code that sets and reads the `BooleanQuery.maxClauseCount` setting is using Lucene classes that are different to the ones executing search.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469789713","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-469789713","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":469789713,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTc4OTcxMw==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T18:09:31Z","updated_at":"2019-03-05T18:09:31Z","author_association":"CONTRIBUTOR","body":"It looks like it's the default distribution, that's probably why it slipped through testing. I can reproduce it on the default distribution on master and other active branches","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/469793259","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-469793259","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":469793259,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTc5MzI1OQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-05T18:19:19Z","updated_at":"2019-03-05T18:19:19Z","author_association":"MEMBER","body":"I think I found the issue, the `XContentObjectTransformer` creates a SearchModule at https://github.com/elastic/elasticsearch/blob/3e04a90e9924f333f018c74a4c981eace7cb562b/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/utils/XContentObjectTransformer.java#L44 and this code is executed **after** we created the original SearchModule so it overrides the max bool setting for the entire process. We should remove the `SearchModule` from the ml code or refactor the class so that we don't set the max boolean clause in the constructor.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470084600","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-470084600","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":470084600,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDA4NDYwMA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-03-06T12:10:39Z","updated_at":"2019-03-06T12:10:39Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470143764","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-470143764","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":470143764,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDE0Mzc2NA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-03-06T15:11:50Z","updated_at":"2019-03-06T15:11:50Z","author_association":"CONTRIBUTOR","body":"> We should remove the `SearchModule` from the ml code or refactor the class so that we don't set the max boolean clause in the constructor.\r\n\r\nWe will do the first of these things, as there is another problem with having a static copy in ML in that `Collections.emptyList()` is passed for the list of search plugins.  This means that extra search functionality added by search plugins is missing.  We can solve both discrepancies by using the one created in the `Node` constructor.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470152635","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-470152635","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":470152635,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDE1MjYzNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-06T15:32:55Z","updated_at":"2019-03-06T15:32:55Z","author_association":"MEMBER","body":"Good point, thanks @droberts195 ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471525897","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-471525897","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":471525897,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTUyNTg5Nw==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T12:51:10Z","updated_at":"2019-03-11T12:51:10Z","author_association":"MEMBER","body":"@jimczi ^^ PRs have been merged that address ML constructing a new `SearchModule` with empty settings. Backported to 6.7, 7.0, 7.1. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/471526565","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-471526565","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":471526565,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTUyNjU2NQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-11T12:53:18Z","updated_at":"2019-03-11T12:53:18Z","author_association":"MEMBER","body":"Thanks a ton @benwtrent!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/520245691","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-520245691","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":520245691,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMDI0NTY5MQ==","user":{"login":"AShyPig","id":34854899,"node_id":"MDQ6VXNlcjM0ODU0ODk5","avatar_url":"https://avatars1.githubusercontent.com/u/34854899?v=4","gravatar_id":"","url":"https://api.github.com/users/AShyPig","html_url":"https://github.com/AShyPig","followers_url":"https://api.github.com/users/AShyPig/followers","following_url":"https://api.github.com/users/AShyPig/following{/other_user}","gists_url":"https://api.github.com/users/AShyPig/gists{/gist_id}","starred_url":"https://api.github.com/users/AShyPig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AShyPig/subscriptions","organizations_url":"https://api.github.com/users/AShyPig/orgs","repos_url":"https://api.github.com/users/AShyPig/repos","events_url":"https://api.github.com/users/AShyPig/events{/privacy}","received_events_url":"https://api.github.com/users/AShyPig/received_events","type":"User","site_admin":false},"created_at":"2019-08-11T17:27:11Z","updated_at":"2019-08-11T17:27:11Z","author_association":"NONE","body":"@benwtrent I encountered the same problem in version 6.6.2. Is version 6.6.2 not fixed?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/520252916","html_url":"https://github.com/elastic/elasticsearch/issues/39528#issuecomment-520252916","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/39528","id":520252916,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMDI1MjkxNg==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-08-11T19:15:23Z","updated_at":"2019-08-11T19:15:23Z","author_association":"CONTRIBUTOR","body":"@AShyPig this bug is present in all 6.6.x versions. It is fixed in 6.7.0.","performed_via_github_app":null}]