[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59404886","html_url":"https://github.com/elastic/elasticsearch/issues/8099#issuecomment-59404886","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8099","id":59404886,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDA0ODg2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T18:11:55Z","updated_at":"2014-10-16T18:11:55Z","author_association":"CONTRIBUTOR","body":"Hi @farracha \n\nPlease can you provide a simple but complete replication, with curl statements that we can execute locally.  It's much easier to follow code.\n\nthnkas\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59444452","html_url":"https://github.com/elastic/elasticsearch/issues/8099#issuecomment-59444452","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8099","id":59444452,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDQ0NDUy","user":{"login":"farracha","id":9105818,"node_id":"MDQ6VXNlcjkxMDU4MTg=","avatar_url":"https://avatars3.githubusercontent.com/u/9105818?v=4","gravatar_id":"","url":"https://api.github.com/users/farracha","html_url":"https://github.com/farracha","followers_url":"https://api.github.com/users/farracha/followers","following_url":"https://api.github.com/users/farracha/following{/other_user}","gists_url":"https://api.github.com/users/farracha/gists{/gist_id}","starred_url":"https://api.github.com/users/farracha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farracha/subscriptions","organizations_url":"https://api.github.com/users/farracha/orgs","repos_url":"https://api.github.com/users/farracha/repos","events_url":"https://api.github.com/users/farracha/events{/privacy}","received_events_url":"https://api.github.com/users/farracha/received_events","type":"User","site_admin":false},"created_at":"2014-10-16T23:03:08Z","updated_at":"2014-10-16T23:03:08Z","author_association":"NONE","body":"I couldn't reproduced it with curl on the first scenario:\nTried standalone indexing and with bulk api ( both types at the same time and one at a time), but the datatype was correct in index metadata.\n\nI have to think on an easy way to replicate my issue, because I'm using the java api (transport class) with bulkprocessor where it receives events straight from the source. And I get the same erroneous behaviour I show next on the second scenario .\n\nRegarding the second scenario I was able to reproduce it.\n1) Create Template with the following definition\ncurl -XPUT http://localhost:9200/_template/template_def\n{\n  \"template\": \"*\",\n  \"settings\": {\n    \"index.refresh_interval\": \"60s\",\n    \"index.number_of_replicas\": \"0\",\n    \"index.number_of_shards\": \"3\"\n  },\n  \"mappings\": {\n    \"_default_\": {\n      \"_source\": {\n        \"compress\": true,\n        \"enabled\": true\n      },\n      \"dynamic_templates\": [\n        {\n          \"string_fields\": {\n            \"mapping\": {\n              \"index\": \"not_analyzed\",\n              \"omit_norms\": true,\n              \"norms\": {\n                \"enabled\": false\n              },\n              \"type\": \"string\"\n            },\n            \"match_mapping_type\": \"string\",\n            \"match\": \"*\"\n          }\n        }\n      ],\n      \"numeric_detection\": false,\n      \"date_detection\": false,\n      \"_ttl\": {\n        \"enabled\": true,\n        \"default\": \"25w\"\n      },\n      \"properties\": {\n        \"@version\": {\n          \"index\": \"not_analyzed\",\n          \"norms\": {\n            \"enabled\": false\n          },\n          \"type\": \"string\"\n        }\n      },\n      \"_all\": {\n        \"enabled\": false\n      }\n    },\n    “firsttype”: {\n      \"properties\": {\n        “col1”: {\n          \"norms\": {\n            \"enabled\": false\n          },\n          \"type\": \"double\"\n        }\n      }\n    },\n    “secondtype: {\n      \"properties\": {\n        “col2”: {\n          \"norms\": {\n            \"enabled\": false\n          },\n          \"type\": \"double\"\n        }\n      }\n    }\n  }\n}\n\n2) Then insert data on both types\n\ncurl http://localhost:9200/scenario/firsttype/ -d '{\"colA\":\"random column\", \"col1\":\"123\"}'\n\ncurl http://localhost:9200/scenario/secondtype/ -d '{\"colB\":\"other random column\",\"colC\":\"another\", \"col2\":\"456\"}'\n\nEverything at this point is fine, both col1 and col2 are of type double in index metadata.\n\n3) Then update the template:\nAdd a new column \"col3\" just like col2 on secondtype\n\n4)\ncurl http://localhost:9200/scenario/secondtype/ -d '{\"colB\":\"buggy type\",\"colC\":\"just check col3 type\", \"col2\":\"789\", \"col3\":\"101\"}'\n\ncol3 will be of type String instead of double. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59467580","html_url":"https://github.com/elastic/elasticsearch/issues/8099#issuecomment-59467580","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8099","id":59467580,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDY3NTgw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T05:20:24Z","updated_at":"2014-10-17T05:20:24Z","author_association":"CONTRIBUTOR","body":"@farracha Templates are only taken into account at index creation time.  If you want to add `col3` to an existing mapping, then you need to use the update-mapping API instead.  Updating the template at this point won't help.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59482663","html_url":"https://github.com/elastic/elasticsearch/issues/8099#issuecomment-59482663","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8099","id":59482663,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDgyNjYz","user":{"login":"farracha","id":9105818,"node_id":"MDQ6VXNlcjkxMDU4MTg=","avatar_url":"https://avatars3.githubusercontent.com/u/9105818?v=4","gravatar_id":"","url":"https://api.github.com/users/farracha","html_url":"https://github.com/farracha","followers_url":"https://api.github.com/users/farracha/followers","following_url":"https://api.github.com/users/farracha/following{/other_user}","gists_url":"https://api.github.com/users/farracha/gists{/gist_id}","starred_url":"https://api.github.com/users/farracha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farracha/subscriptions","organizations_url":"https://api.github.com/users/farracha/orgs","repos_url":"https://api.github.com/users/farracha/repos","events_url":"https://api.github.com/users/farracha/events{/privacy}","received_events_url":"https://api.github.com/users/farracha/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T08:28:46Z","updated_at":"2014-10-17T08:28:46Z","author_association":"NONE","body":"Thanks. I didn't know that.\n","performed_via_github_app":null}]