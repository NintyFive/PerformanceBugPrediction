{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20321","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20321/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20321/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20321/events","html_url":"https://github.com/elastic/elasticsearch/issues/20321","id":174979330,"node_id":"MDU6SXNzdWUxNzQ5NzkzMzA=","number":20321,"title":"Every time Elasticsearch is updated it fails to start","user":{"login":"jazoom","id":8279246,"node_id":"MDQ6VXNlcjgyNzkyNDY=","avatar_url":"https://avatars2.githubusercontent.com/u/8279246?v=4","gravatar_id":"","url":"https://api.github.com/users/jazoom","html_url":"https://github.com/jazoom","followers_url":"https://api.github.com/users/jazoom/followers","following_url":"https://api.github.com/users/jazoom/following{/other_user}","gists_url":"https://api.github.com/users/jazoom/gists{/gist_id}","starred_url":"https://api.github.com/users/jazoom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jazoom/subscriptions","organizations_url":"https://api.github.com/users/jazoom/orgs","repos_url":"https://api.github.com/users/jazoom/repos","events_url":"https://api.github.com/users/jazoom/events{/privacy}","received_events_url":"https://api.github.com/users/jazoom/received_events","type":"User","site_admin":false},"labels":[{"id":146832994,"node_id":"MDU6TGFiZWwxNDY4MzI5OTQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Plugins","name":":Core/Infra/Plugins","color":"0e8a16","default":false,"description":"Plugin API and infrastructure"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-09-05T01:01:41Z","updated_at":"2017-03-21T18:59:21Z","closed_at":"2017-03-21T18:59:21Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.0 - 2.4\n\n**Plugins installed**: [cloud-aws, head, kopf]\n\n**JVM version**: 1.8.0_101\n\n**OS version**: Ubuntu 14.04\n\n**Description of the problem including expected versus actual behavior**:\nElasticsearch servers are updated via Ansible script:\n\n```\n- name: import the Elasticsearch public GPG key into apt\n  apt_key: url=https://packages.elastic.co/GPG-KEY-elasticsearch state=present\n- name: create Elasticsearch source list\n  apt_repository: repo='deb http://packages.elastic.co/elasticsearch/2.x/debian stable main' state=present\n- name: install Elasticsearch\n  apt: name=elasticsearch state=present update_cache=yes\n- name: send Elasticsearch configuration template\n  template: src=elasticsearch.j2 dest=/etc/elasticsearch/elasticsearch.yml mode=0644\n- name: make Elasticsearch start on system boot\n  command: update-rc.d elasticsearch defaults 95 10\n- name: start Elasticsearch service\n  service: name=elasticsearch state=started\n\n- name: install AWS plugin for Elasticsearch\n  elasticsearch_plugin: state=present name=\"cloud-aws\" plugin_bin=\"/usr/share/elasticsearch/bin/plugin\"\n\n- name: restart Elasticsearch service\n  service: name=elasticsearch state=restarted\n```\n\nThis updates Elasticsearch just fine, but the old version of cloud-aws hangs around. This causes Elasticsearch to fail to start up. This has been causing a headache for every Elasticsearch version for a while now and makes updates a pain.\n\nIs the expected behaviour to remove the plugin before every update?\n\n**Steps to reproduce**:\n1. Run the Ansible task above\n","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}