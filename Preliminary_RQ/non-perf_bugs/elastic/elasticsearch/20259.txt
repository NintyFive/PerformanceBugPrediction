{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20259","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20259/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20259/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20259/events","html_url":"https://github.com/elastic/elasticsearch/issues/20259","id":174321790,"node_id":"MDU6SXNzdWUxNzQzMjE3OTA=","number":20259,"title":"Phrase suggester test in docs fails with wrong score","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"labels":[{"id":146833729,"node_id":"MDU6TGFiZWwxNDY4MzM3Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Suggesters","name":":Search/Suggesters","color":"0e8a16","default":false,"description":"\"Did you mean\" and suggestions as you type"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-08-31T16:41:11Z","updated_at":"2018-05-18T14:37:03Z","closed_at":"2018-05-18T14:37:03Z","author_association":"MEMBER","active_lock_reason":null,"body":"It [failed](https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=opensuse/109/console) with the error below and it's not reproducible. Opening an issue hare in case it's a real race condition that affects suggester scoring.\n\n```\nSuite: org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT\n  1> [2016-08-31 13:58:20,087][INFO ][org.elasticsearch.smoketest] Stash dump on failure [{\n  1>   \"stash\" : {\n  2> REPRODUCE WITH: gradle :docs:integTest -Dtests.seed=F5407B0B4DA21C4A -Dtests.class=org.elasticsearch.smoketest.DocsClientYamlTestSuiteIT -Dtests.method=\"test {yaml=reference/search/suggesters/phrase-suggest/line_86}\" -Dtests.security.manager=true -Dtests.locale=id -Dtests.timezone=America/Kentucky/Monticello\n  1>     \"body\" : {\n  1>       \"_shards\" : {\n  1>         \"total\" : 1,\n  1>         \"successful\" : 1,\n  1>         \"failed\" : 0\n  1>       },\n  1>       \"simple_phrase\" : [\n  1>         {\n  1>           \"text\" : \"noble prize\",\n  1>           \"offset\" : 0,\n  1>           \"length\" : 11,\n  1>           \"options\" : [\n  1>             {\n  1>               \"text\" : \"nobel prize\",\n  1>               \"highlighted\" : \"<em>nobel</em> prize\",\n  1>               \"score\" : 0.5962314\n  1>             }\n  1>           ]\n  1>         }\n  1>       ]\n  1>     }\n  1>   }\n  1> }]\n  1> [2016-08-31 13:58:20,088][ERROR][org.elasticsearch.smoketest] This failing test was generated by documentation starting at reference/search/suggesters/phrase-suggest.asciidoc:line_86. It may include many snippets. See docs/README.asciidoc for an explanation of test generation.\nFAILURE 1.93s | DocsClientYamlTestSuiteIT.test {yaml=reference/search/suggesters/phrase-suggest/line_86} <<< FAILURES!\n   > Throwable #1: java.lang.AssertionError: Failure at [reference/search/suggesters/phrase-suggest:98]: $body didn't match the expected value:\n   >                          $body: \n   >                          _shards: \n   >                             failed: same [0]\n   >                         successful: same [1]\n   >                              total: same [1]\n   >                    simple_phrase: \n   >                                  0: \n   >                               length: same [11]\n   >                               offset: same [0]\n   >                              options: \n   >                                      0: \n   >                              highlighted: same [<em>nobel</em> prize]\n   >                                    score: expected [0.40765354] but was [0.5962314]\n   >                                     text: same [nobel prize]\n   >                                 text: same [noble prize]\n   >    at __randomizedtesting.SeedInfo.seed([F5407B0B4DA21C4A:7D1444D1E35E71B2]:0)\n   >    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:329)\n   >    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.test(ESClientYamlSuiteTestCase.java:309)\n   >    at java.lang.Thread.run(Thread.java:745)\n   > Caused by: java.lang.AssertionError: $body didn't match the expected value:\n   >                          $body: \n   >                          _shards: \n   >                             failed: same [0]\n   >                         successful: same [1]\n   >                              total: same [1]\n   >                    simple_phrase: \n   >                                  0: \n   >                               length: same [11]\n   >                               offset: same [0]\n   >                              options: \n   >                                      0: \n   >                              highlighted: same [<em>nobel</em> prize]\n   >                                    score: expected [0.40765354] but was [0.5962314]\n   >                                     text: same [nobel prize]\n   >                                 text: same [noble prize]\n   >    at org.elasticsearch.test.rest.yaml.section.MatchAssertion.doAssert(MatchAssertion.java:84)\n   >    at org.elasticsearch.test.rest.yaml.section.Assertion.execute(Assertion.java:76)\n   >    at org.elasticsearch.test.rest.yaml.ESClientYamlSuiteTestCase.executeSection(ESClientYamlSuiteTestCase.java:325)\n   >    ... 38 more\n```\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}