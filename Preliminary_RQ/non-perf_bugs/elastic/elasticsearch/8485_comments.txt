[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63071430","html_url":"https://github.com/elastic/elasticsearch/issues/8485#issuecomment-63071430","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8485","id":63071430,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDcxNDMw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T14:30:13Z","updated_at":"2014-11-14T14:30:13Z","author_association":"CONTRIBUTOR","body":"Hi @mruediger \n\nDid you map the the `value` field explicitly, or just rely on dynamic mapping?  Currently there is an issue where a new field can be added to two shards at the same time, with different mappings (eg `double` vs `long`).  One mapping will win, but the other mapping continues to exist on the other shard.\n\nI think this is what you're running into.  When you run the aggregations, some shards are returning longs while other shards are returning doubles, which is causing this mixup.\n\nWe plan on fixing this mapping issue, but in the meantime you can handle this by explicitly specifying the field type.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63071873","html_url":"https://github.com/elastic/elasticsearch/issues/8485#issuecomment-63071873","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8485","id":63071873,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDcxODcz","user":{"login":"mruediger","id":377833,"node_id":"MDQ6VXNlcjM3NzgzMw==","avatar_url":"https://avatars1.githubusercontent.com/u/377833?v=4","gravatar_id":"","url":"https://api.github.com/users/mruediger","html_url":"https://github.com/mruediger","followers_url":"https://api.github.com/users/mruediger/followers","following_url":"https://api.github.com/users/mruediger/following{/other_user}","gists_url":"https://api.github.com/users/mruediger/gists{/gist_id}","starred_url":"https://api.github.com/users/mruediger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mruediger/subscriptions","organizations_url":"https://api.github.com/users/mruediger/orgs","repos_url":"https://api.github.com/users/mruediger/repos","events_url":"https://api.github.com/users/mruediger/events{/privacy}","received_events_url":"https://api.github.com/users/mruediger/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T14:33:25Z","updated_at":"2014-11-14T14:33:53Z","author_association":"NONE","body":"Hey @clintongormley , thanks for the quick reply.\n\nI suspected something like this and ran\n`curl -XPUT http://localhost:9200/sensu/_mapping/cpu_metrics/ -d '{ \"cpu_metrics\" : { \"properties\" : { \"value\" : { \"type\" : \"long\" }}}}'`\n\nI don't now if that is enough to configure the mapping. Is it even possible to set the mapping for data that is already stored? Sorry, I am pretty new to elasticsearch.\n\n-Mathias\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63072256","html_url":"https://github.com/elastic/elasticsearch/issues/8485#issuecomment-63072256","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8485","id":63072256,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDcyMjU2","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T14:36:14Z","updated_at":"2014-11-14T14:36:14Z","author_association":"CONTRIBUTOR","body":"@mruediger no worries :)\n\nIt isn't sufficient to fix existing mappings.  You will need to reindex.\n\nbtw, a colleague has just clarified my description of the problem, as it is not quite as clear cut as a described.  In your case the `long` mapping won.  The problem shows up when the primary or replica shard with the internal `double` mapping is moved to another node, which then interprets the existing data as `long`, when really it has been indexed as a `double`.\n\nReindexing is the only way forward here I'm afraid. Perhaps try a subset of the data first, to confirm that it is the issue.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63074649","html_url":"https://github.com/elastic/elasticsearch/issues/8485#issuecomment-63074649","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8485","id":63074649,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDc0NjQ5","user":{"login":"mruediger","id":377833,"node_id":"MDQ6VXNlcjM3NzgzMw==","avatar_url":"https://avatars1.githubusercontent.com/u/377833?v=4","gravatar_id":"","url":"https://api.github.com/users/mruediger","html_url":"https://github.com/mruediger","followers_url":"https://api.github.com/users/mruediger/followers","following_url":"https://api.github.com/users/mruediger/following{/other_user}","gists_url":"https://api.github.com/users/mruediger/gists{/gist_id}","starred_url":"https://api.github.com/users/mruediger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mruediger/subscriptions","organizations_url":"https://api.github.com/users/mruediger/orgs","repos_url":"https://api.github.com/users/mruediger/repos","events_url":"https://api.github.com/users/mruediger/events{/privacy}","received_events_url":"https://api.github.com/users/mruediger/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T14:53:00Z","updated_at":"2014-11-14T14:53:00Z","author_association":"NONE","body":"I will try that. Thanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63074727","html_url":"https://github.com/elastic/elasticsearch/issues/8485#issuecomment-63074727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8485","id":63074727,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDc0NzI3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T14:53:30Z","updated_at":"2014-11-14T14:53:30Z","author_association":"CONTRIBUTOR","body":"please let us know if that works - if it doesn't then there is another issue\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63085308","html_url":"https://github.com/elastic/elasticsearch/issues/8485#issuecomment-63085308","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8485","id":63085308,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDg1MzA4","user":{"login":"mruediger","id":377833,"node_id":"MDQ6VXNlcjM3NzgzMw==","avatar_url":"https://avatars1.githubusercontent.com/u/377833?v=4","gravatar_id":"","url":"https://api.github.com/users/mruediger","html_url":"https://github.com/mruediger","followers_url":"https://api.github.com/users/mruediger/followers","following_url":"https://api.github.com/users/mruediger/following{/other_user}","gists_url":"https://api.github.com/users/mruediger/gists{/gist_id}","starred_url":"https://api.github.com/users/mruediger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mruediger/subscriptions","organizations_url":"https://api.github.com/users/mruediger/orgs","repos_url":"https://api.github.com/users/mruediger/repos","events_url":"https://api.github.com/users/mruediger/events{/privacy}","received_events_url":"https://api.github.com/users/mruediger/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T16:00:05Z","updated_at":"2014-11-14T16:00:05Z","author_association":"NONE","body":"It seems to be working now. Thanks :-)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63086792","html_url":"https://github.com/elastic/elasticsearch/issues/8485#issuecomment-63086792","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8485","id":63086792,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDg2Nzky","user":{"login":"mruediger","id":377833,"node_id":"MDQ6VXNlcjM3NzgzMw==","avatar_url":"https://avatars1.githubusercontent.com/u/377833?v=4","gravatar_id":"","url":"https://api.github.com/users/mruediger","html_url":"https://github.com/mruediger","followers_url":"https://api.github.com/users/mruediger/followers","following_url":"https://api.github.com/users/mruediger/following{/other_user}","gists_url":"https://api.github.com/users/mruediger/gists{/gist_id}","starred_url":"https://api.github.com/users/mruediger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mruediger/subscriptions","organizations_url":"https://api.github.com/users/mruediger/orgs","repos_url":"https://api.github.com/users/mruediger/repos","events_url":"https://api.github.com/users/mruediger/events{/privacy}","received_events_url":"https://api.github.com/users/mruediger/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T16:08:56Z","updated_at":"2014-11-14T16:09:04Z","author_association":"NONE","body":"Its normal that the min/max and avg results are returned as a floating point number (e.g. 4.654463936E9)?\n\nMathias\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63289957","html_url":"https://github.com/elastic/elasticsearch/issues/8485#issuecomment-63289957","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8485","id":63289957,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMjg5OTU3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-17T11:11:03Z","updated_at":"2014-11-17T11:11:03Z","author_association":"CONTRIBUTOR","body":"Hi @mruediger \n\nYes, these aggs always return doubles.\n","performed_via_github_app":null}]