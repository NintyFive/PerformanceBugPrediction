[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262987388","html_url":"https://github.com/elastic/elasticsearch/issues/21714#issuecomment-262987388","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21714","id":262987388,"node_id":"MDEyOklzc3VlQ29tbWVudDI2Mjk4NzM4OA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2016-11-25T16:04:32Z","updated_at":"2016-11-25T16:04:32Z","author_association":"CONTRIBUTOR","body":"We have `min_doc_count` indeed, but it is really designed for the special values 0 and 1. One issue we have with implementing such a feature is that we can only know whether a bucket meets this constraints when we know the total doc count, which only the coordinating node can know. So this feature has important limitations and `max_doc_count` would have a similar one.\r\n\r\n> I've been reading the Pipeline aggregation doc, but I can't seem to figure out how to access doc_count\r\n\r\nYou need to use the special path `_count`.\r\n\r\n```\r\nGET t/_search\r\n{\r\n  \"aggs\": {\r\n    \"filtered\": {\r\n      \"filter\": {\r\n        \"bool\": {\r\n          \"must\": [\r\n            {\r\n              \"range\": {\r\n                \"@timestamp\": {\r\n                  \"from\": \"now-1y\",\r\n                  \"to\": \"now\"\r\n                }\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      },\r\n      \"aggs\": {\r\n        \"hosts\": {\r\n          \"terms\": {\r\n            \"field\": \"hostname\",\r\n            \"size\": 30\r\n          },\r\n          \"aggs\": {\r\n            \"rare_hosts\": {\r\n              \"bucket_selector\": {\r\n                \"buckets_path\": {\r\n                  \"doc_count\": \"_count\"\r\n                },\r\n                \"script\": {\r\n                  \"inline\": \"params.doc_count < 3\"\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"size\": 0\r\n}\r\n```\r\n\r\nNote using such a bucket selector means that you might end up with no buckets at all if none of the top buckets met the constraint.\r\n\r\nI am closing this issue since wo have no plans to implement a `max_doc_count` constraint and we are thinking about making `0` and `1` the only two supported values for `min_doc_count`.","performed_via_github_app":null}]