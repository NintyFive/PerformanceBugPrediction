[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419350441","html_url":"https://github.com/elastic/elasticsearch/issues/33489#issuecomment-419350441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33489","id":419350441,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTM1MDQ0MQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-09-07T07:34:07Z","updated_at":"2018-09-07T07:34:07Z","author_association":"MEMBER","body":"The profiling is done by checking the relative time of each function call in the query. We use `System.nanoTime` to measure the time and this adds a significant overhead to the performance of the query. In order to mitigate the performance impact we've decided to sample the profiling for each function call so the final timing is an approximation (starting in `5.6.0`):\r\nhttps://github.com/elastic/elasticsearch/pull/25772\r\nThe `took` time is not an approximation so it is possible that the profile time returns a value greater than the total time of the query. For small queries the difference should be small but it can get bigger for long running query that returns millions of documents. This shouldn't be an issue though because the comparison should be done with other timings in the profiling in order to give you an estimate of the cost of each part of the query. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419351454","html_url":"https://github.com/elastic/elasticsearch/issues/33489#issuecomment-419351454","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33489","id":419351454,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTM1MTQ1NA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-07T07:38:27Z","updated_at":"2018-09-07T07:38:27Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419416312","html_url":"https://github.com/elastic/elasticsearch/issues/33489#issuecomment-419416312","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33489","id":419416312,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTQxNjMxMg==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-09-07T11:53:45Z","updated_at":"2018-09-07T11:53:45Z","author_association":"MEMBER","body":"++ to what @jimczi said :)\r\n\r\nAlso note that there is an open bug where profiled requests can interact poorly with caching.  That can lead to confusing/surprising combinations of `took` and profile timing: https://github.com/elastic/elasticsearch/issues/29024","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/419506878","html_url":"https://github.com/elastic/elasticsearch/issues/33489#issuecomment-419506878","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33489","id":419506878,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTUwNjg3OA==","user":{"login":"maxshortzp","id":31416805,"node_id":"MDQ6VXNlcjMxNDE2ODA1","avatar_url":"https://avatars1.githubusercontent.com/u/31416805?v=4","gravatar_id":"","url":"https://api.github.com/users/maxshortzp","html_url":"https://github.com/maxshortzp","followers_url":"https://api.github.com/users/maxshortzp/followers","following_url":"https://api.github.com/users/maxshortzp/following{/other_user}","gists_url":"https://api.github.com/users/maxshortzp/gists{/gist_id}","starred_url":"https://api.github.com/users/maxshortzp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxshortzp/subscriptions","organizations_url":"https://api.github.com/users/maxshortzp/orgs","repos_url":"https://api.github.com/users/maxshortzp/repos","events_url":"https://api.github.com/users/maxshortzp/events{/privacy}","received_events_url":"https://api.github.com/users/maxshortzp/received_events","type":"User","site_admin":false},"created_at":"2018-09-07T17:15:00Z","updated_at":"2018-09-07T17:15:00Z","author_association":"NONE","body":"Thanks for everyone's help.\r\n\r\nIt sounds like even though the profile times may not match actual times (due to sampling) I can still compare them with each other to understand what parts of the query are costly.","performed_via_github_app":null}]