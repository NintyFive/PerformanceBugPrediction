[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412451883","html_url":"https://github.com/elastic/elasticsearch/issues/32804#issuecomment-412451883","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32804","id":412451883,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjQ1MTg4Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-13T08:55:51Z","updated_at":"2018-08-13T08:55:51Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416711040","html_url":"https://github.com/elastic/elasticsearch/issues/32804#issuecomment-416711040","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32804","id":416711040,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjcxMTA0MA==","user":{"login":"albendz","id":12453997,"node_id":"MDQ6VXNlcjEyNDUzOTk3","avatar_url":"https://avatars3.githubusercontent.com/u/12453997?v=4","gravatar_id":"","url":"https://api.github.com/users/albendz","html_url":"https://github.com/albendz","followers_url":"https://api.github.com/users/albendz/followers","following_url":"https://api.github.com/users/albendz/following{/other_user}","gists_url":"https://api.github.com/users/albendz/gists{/gist_id}","starred_url":"https://api.github.com/users/albendz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albendz/subscriptions","organizations_url":"https://api.github.com/users/albendz/orgs","repos_url":"https://api.github.com/users/albendz/repos","events_url":"https://api.github.com/users/albendz/events{/privacy}","received_events_url":"https://api.github.com/users/albendz/received_events","type":"User","site_admin":false},"created_at":"2018-08-28T19:27:55Z","updated_at":"2018-08-28T19:27:55Z","author_association":"CONTRIBUTOR","body":"I'm wondering if I can pick this up.\r\n\r\nAlso, is there a way for us to provide a trivial script that they can reference in this call? It would just be a way to reduce error for users if they try and fail to write a trivial script by providing them with one.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/416882229","html_url":"https://github.com/elastic/elasticsearch/issues/32804#issuecomment-416882229","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32804","id":416882229,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjg4MjIyOQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-08-29T09:09:48Z","updated_at":"2018-08-29T09:09:48Z","author_association":"MEMBER","body":"@albendz If you'd like to work on this that would be great\r\n\r\nWe could potentially provide a trivial script int eh documentation but honestly I'm not sure its worth it as the output of the aggregation is not going to be very useful if the user doesn't provide combine and reduce scripts that are specific to their use case. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/417879275","html_url":"https://github.com/elastic/elasticsearch/issues/32804#issuecomment-417879275","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32804","id":417879275,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzg3OTI3NQ==","user":{"login":"albendz","id":12453997,"node_id":"MDQ6VXNlcjEyNDUzOTk3","avatar_url":"https://avatars3.githubusercontent.com/u/12453997?v=4","gravatar_id":"","url":"https://api.github.com/users/albendz","html_url":"https://github.com/albendz","followers_url":"https://api.github.com/users/albendz/followers","following_url":"https://api.github.com/users/albendz/following{/other_user}","gists_url":"https://api.github.com/users/albendz/gists{/gist_id}","starred_url":"https://api.github.com/users/albendz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albendz/subscriptions","organizations_url":"https://api.github.com/users/albendz/orgs","repos_url":"https://api.github.com/users/albendz/repos","events_url":"https://api.github.com/users/albendz/events{/privacy}","received_events_url":"https://api.github.com/users/albendz/received_events","type":"User","site_admin":false},"created_at":"2018-09-01T18:42:38Z","updated_at":"2018-09-01T18:42:38Z","author_association":"CONTRIBUTOR","body":"I can see that these scripts are used here: https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java\r\n\r\nI'm having trouble finding where the entry point to the API is defined. My IntelliJ config is a little messed up with the nested projects and while I work that out, a pointer to the API spec would be appreciated.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418031442","html_url":"https://github.com/elastic/elasticsearch/issues/32804#issuecomment-418031442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32804","id":418031442,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODAzMTQ0Mg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-09-03T07:52:44Z","updated_at":"2018-09-03T07:52:51Z","author_association":"MEMBER","body":"@albendz It should be a case of adding some checks in [`ScriptedMetricAggregationBuilder.doBuild`](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java#L196) so an exception is thrown if we try to build without a combine or reduce script provided in the builder.\r\n\r\n> I'm having trouble finding where the entry point to the API is defined\r\n\r\nThe Aggregation builders are the closest thing to an entry point that exists for aggregations since they are one of many components in the Search API. The entry point of the Search API itself can be found in [`RestSearchAction`](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java) which will eventually call [`TransportSearchAction`](https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java) which is what actually start execution of the search request.\r\n\r\n> a pointer to the API spec would be appreciated.\r\n\r\nWe have a spec for the [REST API](https://github.com/elastic/elasticsearch/tree/master/rest-api-spec/src/main/resources/rest-api-spec/api) which is used by the language clients but it current does not define the body of the request, only the HTTP method(s), URL paths, and URL parameters so I'm not sure you will find it useful for this task.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418179216","html_url":"https://github.com/elastic/elasticsearch/issues/32804#issuecomment-418179216","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32804","id":418179216,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODE3OTIxNg==","user":{"login":"albendz","id":12453997,"node_id":"MDQ6VXNlcjEyNDUzOTk3","avatar_url":"https://avatars3.githubusercontent.com/u/12453997?v=4","gravatar_id":"","url":"https://api.github.com/users/albendz","html_url":"https://github.com/albendz","followers_url":"https://api.github.com/users/albendz/followers","following_url":"https://api.github.com/users/albendz/following{/other_user}","gists_url":"https://api.github.com/users/albendz/gists{/gist_id}","starred_url":"https://api.github.com/users/albendz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albendz/subscriptions","organizations_url":"https://api.github.com/users/albendz/orgs","repos_url":"https://api.github.com/users/albendz/repos","events_url":"https://api.github.com/users/albendz/events{/privacy}","received_events_url":"https://api.github.com/users/albendz/received_events","type":"User","site_admin":false},"created_at":"2018-09-03T19:10:25Z","updated_at":"2018-09-03T19:10:25Z","author_association":"CONTRIBUTOR","body":"Thank you for those pointers. I will focus on adding validation in the builder.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418179920","html_url":"https://github.com/elastic/elasticsearch/issues/32804#issuecomment-418179920","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32804","id":418179920,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODE3OTkyMA==","user":{"login":"albendz","id":12453997,"node_id":"MDQ6VXNlcjEyNDUzOTk3","avatar_url":"https://avatars3.githubusercontent.com/u/12453997?v=4","gravatar_id":"","url":"https://api.github.com/users/albendz","html_url":"https://github.com/albendz","followers_url":"https://api.github.com/users/albendz/followers","following_url":"https://api.github.com/users/albendz/following{/other_user}","gists_url":"https://api.github.com/users/albendz/gists{/gist_id}","starred_url":"https://api.github.com/users/albendz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albendz/subscriptions","organizations_url":"https://api.github.com/users/albendz/orgs","repos_url":"https://api.github.com/users/albendz/repos","events_url":"https://api.github.com/users/albendz/events{/privacy}","received_events_url":"https://api.github.com/users/albendz/received_events","type":"User","site_admin":false},"created_at":"2018-09-03T19:15:48Z","updated_at":"2018-09-03T19:15:48Z","author_association":"CONTRIBUTOR","body":"Another question: should it be combine AND reduce scripts, combine OR reduce scripts, or combine XOR reduce scripts?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/418274352","html_url":"https://github.com/elastic/elasticsearch/issues/32804#issuecomment-418274352","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32804","id":418274352,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODI3NDM1Mg==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2018-09-04T07:51:34Z","updated_at":"2018-09-04T07:51:34Z","author_association":"MEMBER","body":"We should throw an exception if there is no reduce scripts. We should also throw an exception if there is no combine script. I think these two checks can be separate checks though, i.e.:\r\n```\r\nif (no combine_script) {\r\n    throw exception\r\n}\r\nif (no reduce_script) {\r\n    throw exception\r\n}\r\n```","performed_via_github_app":null}]