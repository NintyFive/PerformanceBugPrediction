{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19036","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19036/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19036/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19036/events","html_url":"https://github.com/elastic/elasticsearch/issues/19036","id":161813940,"node_id":"MDU6SXNzdWUxNjE4MTM5NDA=","number":19036,"title":"__es__.tmp left behind from atomic move check prevents node startup","user":{"login":"ppf2","id":7216393,"node_id":"MDQ6VXNlcjcyMTYzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/7216393?v=4","gravatar_id":"","url":"https://api.github.com/users/ppf2","html_url":"https://github.com/ppf2","followers_url":"https://api.github.com/users/ppf2/followers","following_url":"https://api.github.com/users/ppf2/following{/other_user}","gists_url":"https://api.github.com/users/ppf2/gists{/gist_id}","starred_url":"https://api.github.com/users/ppf2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppf2/subscriptions","organizations_url":"https://api.github.com/users/ppf2/orgs","repos_url":"https://api.github.com/users/ppf2/repos","events_url":"https://api.github.com/users/ppf2/events{/privacy}","received_events_url":"https://api.github.com/users/ppf2/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-06-23T00:08:13Z","updated_at":"2017-01-31T17:45:51Z","closed_at":"2016-07-07T18:40:05Z","author_association":"MEMBER","active_lock_reason":null,"body":"**Elasticsearch version**:  2.3.0\n\nHave an environment where **es**.tmp is left behind from our atomic_move check on the file system.  The directory only has the **es**.tmp file (i.e. no **es**.final).  \n\ntotal 4\n-rw-r--r--. 1 elasticsearch elasticsearch 0 Jun 21 19:36 **es**.tmp\ndrwxr-xr-x. 39 elasticsearch elasticsearch 4096 Jun 21 00:02 indices\n-rw-r--r--. 1 elasticsearch elasticsearch 0 Mar 31 15:12 node.lock\ndrwxr-xr-x. 2 elasticsearch elasticsearch 33 Jun 6 18:17 _state\n\n```\n[2016-06-22 00:00:01,812][INFO ][node                     ] [node_name] version[2.3.0], pid[7400], build[8371be8/2016-03-29T07:54:48Z]\n[2016-06-22 00:00:01,812][INFO ][node                     ] [node_name] initializing ...\n[2016-06-22 00:00:02,204][INFO ][plugins                  ] [node_name] modules [reindex, lang-expression, lang-groovy], plugins [license, shield, marvel-agent], sites []\n[2016-06-22 00:00:02,223][INFO ][env                      ] [node_name] using [1] data paths, mounts [[/var (/dev/mapper/vg00-lv--var)]], net usable_space [580.9gb], net total_space [1tb], spins? [possibly], types [xfs]\n[2016-06-22 00:00:02,223][INFO ][env                      ] [node_name] heap size [989.8mb], compressed ordinary object pointers [true]\n[2016-06-22 00:00:02,223][WARN ][env                      ] [node_name] max file descriptors [4096] for elasticsearch process likely too low, consider increasing to at least [65536]\n[2016-06-22 00:00:02,542][INFO ][http                     ] [node_name] Using [org.elasticsearch.http.netty.NettyHttpServerTransport] as http transport, overridden by [shield]\n[2016-06-22 00:00:02,654][INFO ][transport                ] [node_name] Using [org.elasticsearch.shield.transport.ShieldServerTransportService] as transport service, overridden by [shield]\n[2016-06-22 00:00:02,654][INFO ][transport                ] [node_name] Using [org.elasticsearch.shield.transport.netty.ShieldNettyTransport] as transport, overridden by [shield]\n[2016-06-22 00:00:03,535][ERROR][bootstrap                ] Guice Exception: java.nio.file.FileAlreadyExistsException: /var/lib/elasticsearch-20/cluster_name/nodes/0/__es__.tmp\n    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:88)\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\n    at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)\n    at java.nio.file.Files.newByteChannel(Files.java:361)\n    at java.nio.file.Files.createFile(Files.java:632)\n    at org.elasticsearch.env.NodeEnvironment.ensureAtomicMoveSupported(NodeEnvironment.java:794)\n    at org.elasticsearch.gateway.GatewayMetaState.<init>(GatewayMetaState.java:82)\n    at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\n    at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\n    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\n    at java.lang.reflect.Constructor.newInstance(Constructor.java:423)\n    at <<<guice>>>\n    at org.elasticsearch.node.Node.<init>(Node.java:213)\n    at org.elasticsearch.node.Node.<init>(Node.java:140)\n    at org.elasticsearch.node.NodeBuilder.build(NodeBuilder.java:143)\n    at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:178)\n    at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:270)\n    at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)\n```\n\nIt didn't throw an AtomicMoveNotSupportedException so it appears that the check passed, but somehow it has trouble cleaning up the tmp file, so that on the next run, it bombs out when it tries to do a file create  when the tmp file already exists.  Should we handle this more gracefully and still allow the node to start up?  If not, a more intuitive error handling message will be helpful.\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}