{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5284","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5284/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5284/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5284/events","html_url":"https://github.com/elastic/elasticsearch/issues/5284","id":28473442,"node_id":"MDU6SXNzdWUyODQ3MzQ0Mg==","number":5284,"title":"Tribe node partialy breaks after 20+ min of runtime.","user":{"login":"Jeppesen-io","id":5796153,"node_id":"MDQ6VXNlcjU3OTYxNTM=","avatar_url":"https://avatars3.githubusercontent.com/u/5796153?v=4","gravatar_id":"","url":"https://api.github.com/users/Jeppesen-io","html_url":"https://github.com/Jeppesen-io","followers_url":"https://api.github.com/users/Jeppesen-io/followers","following_url":"https://api.github.com/users/Jeppesen-io/following{/other_user}","gists_url":"https://api.github.com/users/Jeppesen-io/gists{/gist_id}","starred_url":"https://api.github.com/users/Jeppesen-io/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jeppesen-io/subscriptions","organizations_url":"https://api.github.com/users/Jeppesen-io/orgs","repos_url":"https://api.github.com/users/Jeppesen-io/repos","events_url":"https://api.github.com/users/Jeppesen-io/events{/privacy}","received_events_url":"https://api.github.com/users/Jeppesen-io/received_events","type":"User","site_admin":false},"labels":[{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-02-28T02:19:29Z","updated_at":"2016-11-06T12:25:14Z","closed_at":"2016-11-06T12:25:14Z","author_association":"NONE","active_lock_reason":null,"body":"After a tribe node has been running for 20min to an hour or more, _hosts query fails. Others queries seem to work, unfortunately Kibana needs to use the _hosts query to work. \n\nThe ES clusters behind the tribe node have no errors that can be seen. I've tested this with 1.0.0 and 1.0.1.\n\n```\ncurl http://tribenode:9200/_hosts/\n(times out)\n```\n\nNo errors are seen on the ES clusters the tribe node points to.\n\nMy workaround is to restart Elasticsearch on the tribe node every 20min\n\nTribe node configuration\n\n```\ntribe:\n  tribe_datacenter1:\n    cluster.name:   prod_datacenter1\n    discovery.zen.ping.multicast.enabled: false\n    transport.tcp.port: 9302\n    discovery.zen.ping.unicast.hosts:  [\"node1.datacenter1:9300\"\"node2.datacenter1:9300,]\n\n  tribe_datacenter2:\n    cluster.name:   prod_datacenter2\n    discovery.zen.ping.multicast.enabled: false\n    transport.tcp.port: 9303\n    discovery.zen.ping.unicast.hosts: [\"node1.datacenter2:9300\"\"node2.datacenter2:9300,]\n\ncluster.name: prod_tribe\nnode.name: tribenode.local\ntransport.tcp.port: 9301\npath.data: /data/elasticsearch/data\npath.logs: /var/log/elasticsearch\n```\n\nSome metrics pulled from the the Tribe node from Elasticsearch HQ; as you can see, not much load at all.\n\nHeap Used:  127.6MB\nHeap Committed: 2.8GB\nNon Heap Used:  28.0MB\nNon Heap Committed: 28.6MB\nJVM Uptime: 01:47:54\nThread Count/Peak:  60 / 68\nGC (Old) Count: 4\nGC (Old)Time:   00:00:00\nGC (Young) Count:   0\nGC (Young)Time: 00:00:00\nJava Version:   1.7.0_51\nJVM Vendor: Oracle Corporation\nJVM:    OpenJDK 64-Bit Server VM\nUptime: 00:01:12\nTotal Memory:   4.73 GB\nTotal Swap: 2.00 GB\nMemory (Used/Free): 897.54 MB / 3.85 GB\nSwap (Used/Free):   0 B / 2.00 GB\nCPU User/Sys:   0% / 0%\nCPU Idle:   99%\nCPU Vendor: Intel\nCPU Model:  Xeon\nTotal Cores:    2\nIndex (Queue/Peak/Active):  0/0/0\nGet (Queue/Peak/Active):    0/0/0\nSearch (Queue/Peak/Active): 0/0/0\nBulk (Queue/Peak/Active):   0/0/0\nRefresh (Queue/Peak/Active):    0/0/0\nFlush (Queue/Peak/Active):  0/0/0\nMerge (Queue/Peak/Active):  0/0/0\nManagement (Queue/Peak/Active): 0/1/1\nOpen File Descriptors:  389\nCPU Usage:  0% of 200%\nCPU System: 00:00:13\nCPU User:   00:00:55\nCPU Total:  00:01:08\nResident Memory:    316.3MB\nShared Memory:  12.7MB\nTotal Virtual Memory:   4.3GB\n\nErrors seen on tribe node:\n\n```\n[2014-02-27 12:35:16,431][DEBUG][action.admin.cluster.node.info] [tribenode] failed to execute on node [zr5f6hDBQSGNubAhz2JX2g]\norg.elasticsearch.transport.SendRequestTransportException: [tribenode/prod_datacenter2][inet[/1.1.1.1:9302]][cluster/nodes/info/n]\n        at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:202)\n        at org.elasticsearch.action.support.nodes.TransportNodesOperationAction$AsyncAction.start(TransportNodesOperationAction.java:168)\n        at org.elasticsearch.action.support.nodes.TransportNodesOperationAction$AsyncAction.access$300(TransportNodesOperationAction.java:102)\n        at org.elasticsearch.action.support.nodes.TransportNodesOperationAction.doExecute(TransportNodesOperationAction.java:73)\n        at org.elasticsearch.action.support.nodes.TransportNodesOperationAction.doExecute(TransportNodesOperationAction.java:43)\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:63)\n        at org.elasticsearch.client.node.NodeClusterAdminClient.execute(NodeClusterAdminClient.java:72)\n        at org.elasticsearch.client.support.AbstractClusterAdminClient.nodesInfo(AbstractClusterAdminClient.java:179)\n        at org.elasticsearch.rest.action.admin.cluster.node.info.RestNodesInfoAction.handleRequest(RestNodesInfoAction.java:105)\n        at org.elasticsearch.rest.RestController.executeHandler(RestController.java:159)\n        at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:142)\n        at org.elasticsearch.http.HttpServer.internalDispatchRequest(HttpServer.java:121)\n        at org.elasticsearch.http.HttpServer$Dispatcher.dispatchRequest(HttpServer.java:83)\n        at org.elasticsearch.http.netty.NettyHttpServerTransport.dispatchRequest(NettyHttpServerTransport.java:291)\n        at org.elasticsearch.http.netty.HttpRequestHandler.messageReceived(HttpRequestHandler.java:43)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459)\n        at org.elasticsearch.common.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536)\n        at org.elasticsearch.common.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:74)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n        at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\nCaused by: org.elasticsearch.transport.NodeNotConnectedException: [tribenode/prod_datacenter2][inet[/1.1.1.1:9302]] Node not connected\n        at org.elasticsearch.transport.netty.NettyTransport.nodeChannel(NettyTransport.java:859)\n        at org.elasticsearch.transport.netty.NettyTransport.sendRequest(NettyTransport.java:540)\n        at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:189)\n        ... 43 more\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}