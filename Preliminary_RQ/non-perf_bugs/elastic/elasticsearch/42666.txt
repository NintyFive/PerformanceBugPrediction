{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42666","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42666/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42666/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42666/events","html_url":"https://github.com/elastic/elasticsearch/issues/42666","id":449737304,"node_id":"MDU6SXNzdWU0NDk3MzczMDQ=","number":42666,"title":"Make timestamp field name in audit log consistent","user":{"login":"ycombinator","id":51061,"node_id":"MDQ6VXNlcjUxMDYx","avatar_url":"https://avatars2.githubusercontent.com/u/51061?v=4","gravatar_id":"","url":"https://api.github.com/users/ycombinator","html_url":"https://github.com/ycombinator","followers_url":"https://api.github.com/users/ycombinator/followers","following_url":"https://api.github.com/users/ycombinator/following{/other_user}","gists_url":"https://api.github.com/users/ycombinator/gists{/gist_id}","starred_url":"https://api.github.com/users/ycombinator/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ycombinator/subscriptions","organizations_url":"https://api.github.com/users/ycombinator/orgs","repos_url":"https://api.github.com/users/ycombinator/repos","events_url":"https://api.github.com/users/ycombinator/events{/privacy}","received_events_url":"https://api.github.com/users/ycombinator/received_events","type":"User","site_admin":false},"labels":[{"id":151561891,"node_id":"MDU6TGFiZWwxNTE1NjE4OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Logging","name":":Core/Infra/Logging","color":"0e8a16","default":false,"description":"Log management and logging utilities"},{"id":912837734,"node_id":"MDU6TGFiZWw5MTI4Mzc3MzQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Security/Audit","name":":Security/Audit","color":"0e8a16","default":false,"description":"X-Pack Audit logging"}],"state":"closed","locked":false,"assignee":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"assignees":[{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2019-05-29T10:53:57Z","updated_at":"2019-06-05T09:32:04Z","closed_at":"2019-06-05T09:32:04Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I ran Elasticsearch 7.1.0 in a Docker container with audit logging turned on. Consider the following sample log entry I generated:\r\n\r\n```\r\n{\"type\": \"server\", \"timestamp\": \"2019-05-28T19:17:36,708+0000\", \"level\": \"INFO\", \"component\": \"o.e.x.s.a.l.LoggingAuditTrail\", \"cluster.name\": \"docker-cluster\", \"node.name\": \"68394c3e3bbe\", \"cluster.uuid\": \"BI0VZnPyRJuQWQzhuwO8sg\", \"node.id\": \"mQjSOd7bREOwl_I4IUaEtw\",  \"message\": \"event.action=\\\"anonymous_access_denied\\\" event.type=\\\"rest\\\" node.id=\\\"mQjSOd7bREOwl_I4IUaEtw\\\" origin.address=\\\"172.17.0.1:36744\\\" origin.type=\\\"rest\\\" request.id=\\\"2nj_ww26T0eODoilHXDPSA\\\" request.method=\\\"GET\\\" url.path=\\\"/\\\"\"  }\r\n```\r\n\r\nNotice that the name of the timestamp field is `timestamp`.\r\n\r\nNow, I ran Elasticsearch 7.1.0 again, but by downloading and extracting it from a `.tar.gz` file instead of in a Docker container. Here's a sample audit log entry I generated:\r\n\r\n```\r\n{\"@timestamp\":\"2019-05-28T12:33:31,246\", \"node.id\":\"qUZG15diSquz8jpvQbTmhA\", \"event.type\":\"rest\", \"event.action\":\"anonymous_access_denied\", \"origin.type\":\"rest\", \"origin.address\":\"[::1]:49499\", \"url.path\":\"/\", \"request.method\":\"GET\", \"request.id\":\"b5A_F-ihQaOHrxBgAa3gjA\"}\r\n```\r\n\r\nNotice that the name of the timestamp field is `@timestamp`.\r\n\r\nThis field name discrepancy is causing [some issues for users](https://discuss.elastic.co/t/filebeat-7-1-0-elasticsearch-module-audit-pipeline-incorrectly-references-timestamp-instead-of-timestamp/182721) trying to use Filebeat to parse the audit log, depending on whether the environment is a Docker container vs. not.\r\n\r\nOther types of Elasticsearch logs (server, deprecation) consistently use `timestamp` (no `@` prefix) in either Docker or non-Docker logs.\r\n\r\nFor the short term we should make Filebeat look for either `@timestamp` or `timestamp` when its trying to parse Elasticsearch deprecation logs. I've created https://github.com/elastic/beats/issues/12339 to track this.\r\n\r\nBut for the longer term it would be nice if Elasticsearch consistently just used `timestamp` (no `@` prefix) for audit logs in both Docker and non-Docker logs.\r\n","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}