{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20875","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20875/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20875/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20875/events","html_url":"https://github.com/elastic/elasticsearch/issues/20875","id":182425712,"node_id":"MDU6SXNzdWUxODI0MjU3MTI=","number":20875,"title":"\"optimize_bbox\": \"memory\" in geo_distance sort query returns illegal latitude value [269.901123046875] for [GeoDistanceSort]","user":{"login":"seperman","id":2314797,"node_id":"MDQ6VXNlcjIzMTQ3OTc=","avatar_url":"https://avatars2.githubusercontent.com/u/2314797?v=4","gravatar_id":"","url":"https://api.github.com/users/seperman","html_url":"https://github.com/seperman","followers_url":"https://api.github.com/users/seperman/followers","following_url":"https://api.github.com/users/seperman/following{/other_user}","gists_url":"https://api.github.com/users/seperman/gists{/gist_id}","starred_url":"https://api.github.com/users/seperman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seperman/subscriptions","organizations_url":"https://api.github.com/users/seperman/orgs","repos_url":"https://api.github.com/users/seperman/repos","events_url":"https://api.github.com/users/seperman/events{/privacy}","received_events_url":"https://api.github.com/users/seperman/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"},{"id":651957037,"node_id":"MDU6TGFiZWw2NTE5NTcwMzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.4.7","name":"v2.4.7","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"assignees":[{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2016-10-12T03:19:39Z","updated_at":"2017-10-09T14:25:29Z","closed_at":"2017-10-09T14:25:29Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.5\n\n**Plugins installed**: [Kibana]\n\n**JVM version**: java version \"1.7.0_111\"\n\n**OS version**: Debian 7.11\n\n**Description of the problem including expected versus actual behavior**:\nSetting `\"optimize_bbox\": \"memory\"` in geo_distance sort query yields to `illegal latitude value [269.901123046875] for [GeoDistanceSort]`.\n\n**Steps to reproduce**:\n1. Have an index with a geopoint called geolocation.\n2. Hit the Elasticsearch with a query like:\n   \n   ``` json\n   GET myindex/model/_search?from=30\n   {\n       \"sort\": [\n           { \"_score\": { \"order\": \"desc\" }},\n           {\n               \"_geo_distance\": {\n                   \"geolocation\": {\n                       \"lat\": 34,\n                       \"lon\": -118\n                   },\n                   \"order\": \"asc\",\n                   \"unit\": \"mi\",\n                   \"distance_type\": \"sloppy_arc\",\n                   \"optimize_bbox\": \"memory\"\n               }\n           }\n       ]\n   }\n   ```\n3. You will get a response like\n   \n   ``` json\n   {\n      \"error\": {\n         \"root_cause\": [\n            {\n               \"type\": \"parse_exception\",\n               \"reason\": \"illegal latitude value [269.901123046875] for [GeoDistanceSort]\"\n            }\n         ],\n         \"type\": \"search_phase_execution_exception\",\n         \"reason\": \"all shards failed\",\n         \"phase\": \"query\",\n         \"grouped\": true,\n         \"failed_shards\": [\n            {\n               \"shard\": 0,\n               \"index\": \"myindex\",\n               \"node\": \"p4UZTuZFRBaAnTUAznvIrw\",\n               \"reason\": {\n                  \"type\": \"parse_exception\",\n                  \"reason\": \"illegal latitude value [269.901123046875] for [GeoDistanceSort]\"\n               }\n            }\n         ]\n      },\n      \"status\": 400\n   }\n   ```\n   \n   which is misleading. I spent a while trying to figure out where 269.901123046875 comes from.\n4. Now remove that `\"optimize_bbox\": \"memory\"` and it works fine.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}