{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18444","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18444/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18444/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18444/events","html_url":"https://github.com/elastic/elasticsearch/issues/18444","id":155501727,"node_id":"MDU6SXNzdWUxNTU1MDE3Mjc=","number":18444,"title":"All-numeric query prefix causes NullPointerException with SimpleQueryAnalyzer and analyze_wildcard: true","user":{"login":"jamestait","id":1237300,"node_id":"MDQ6VXNlcjEyMzczMDA=","avatar_url":"https://avatars3.githubusercontent.com/u/1237300?v=4","gravatar_id":"","url":"https://api.github.com/users/jamestait","html_url":"https://github.com/jamestait","followers_url":"https://api.github.com/users/jamestait/followers","following_url":"https://api.github.com/users/jamestait/following{/other_user}","gists_url":"https://api.github.com/users/jamestait/gists{/gist_id}","starred_url":"https://api.github.com/users/jamestait/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamestait/subscriptions","organizations_url":"https://api.github.com/users/jamestait/orgs","repos_url":"https://api.github.com/users/jamestait/repos","events_url":"https://api.github.com/users/jamestait/events{/privacy}","received_events_url":"https://api.github.com/users/jamestait/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"assignees":[{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2016-05-18T13:30:48Z","updated_at":"2018-02-14T13:33:08Z","closed_at":"2016-05-18T14:44:26Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.2 (also seen in 2.2.0)\n\n**JVM version**: OpenJDK Runtime Environment (IcedTea 2.6.6) (7u101-2.6.6-0ubuntu0.14.04.1)\nOpenJDK 64-Bit Server VM (build 24.95-b01, mixed mode)\n\n**OS version**: Ubuntu 14.04.4 LTS\n\n**Description of the problem including expected versus actual behavior**:\nWhen issuing a `simple_query_string` query containing a numeric-prefix term (e.g. \"1234*\") against a field that uses the `SimpleQueryAnalyzer` using `analyze_wildcard: true`, Elasticsearch throws a `NullPointerException`.\n\n**Steps to reproduce**:\n\n```\n#!/bin/bash\n\nexport ELASTICSEARCH_ENDPOINT=\"http://localhost:9200\"\n\n# Create indexes\n\ncurl -XPUT \"$ELASTICSEARCH_ENDPOINT/play\" -d '{\n    \"mappings\": {\n        \"type\": {\n            \"properties\": {\n                \"prop1\": {\n                    \"type\": \"string\",\n                    \"analyzer\": \"simple\"\n                },\n                \"prop2\": {\n                    \"type\": \"string\",\n                    \"analyzer\": \"whitespace\"\n                }\n            }\n        }\n    }\n}'\n\n# Index documents\ncurl -XPOST \"$ELASTICSEARCH_ENDPOINT/_bulk?refresh=true\" -d '\n{\"index\":{\"_index\":\"play\",\"_type\":\"type\"}}\n{\"prop1\":\"value1\",\"prop2\":\"value2\"}\n'\n\n# Do searches\n\ncurl -XPOST \"$ELASTICSEARCH_ENDPOINT/_search?pretty\" -d '\n{\n    \"query\": {\n        \"simple_query_string\": {\n            \"query\": \"1234*\",\n            \"fields\": [\n                \"prop1\"\n            ],\n            \"analyze_wildcard\": true\n        }\n    }\n}\n'\n\ncurl -XPOST \"$ELASTICSEARCH_ENDPOINT/_search?pretty\" -d '\n{\n    \"query\": {\n        \"simple_query_string\": {\n            \"query\": \"1234*\",\n            \"fields\": [\n                \"prop2\"\n            ],\n            \"analyze_wildcard\": true\n        }\n    }\n}\n'\n```\n\n**Provide logs (if relevant)**:\n\n```\n[2016-05-18 14:20:53,093][DEBUG][action.search.type       ] [Amphibius] [play2][4], node[HgT_hAH2RC6wTntYZy7rPQ], [P], v[2], s[STARTED], a[id=L9qtfcf9SyyVKb-HZxap9A]: Failed to execute [org.elasticsearch.action.search.SearchRequest@7873a5ad] lastShard [true]\nRemoteTransportException[[Amphibius][127.0.0.1:9300][indices:data/read/search[phase/query]]]; nested: SearchParseException[failed to parse search source [\n{\n    \"query\": {\n        \"simple_query_string\": {\n            \"query\": \"1234*\",\n            \"fields\": [\n                \"prop1\"\n            ],\n            \"analyze_wildcard\": true\n        }\n    }\n}\n]]; nested: NullPointerException;\nCaused by: SearchParseException[failed to parse search source [\n{\n    \"query\": {\n        \"simple_query_string\": {\n            \"query\": \"1234*\",\n            \"fields\": [\n                \"prop1\"\n            ],\n            \"analyze_wildcard\": true\n        }\n    }\n}\n]]; nested: NullPointerException;\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:853)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:652)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:618)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:369)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:368)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:365)\n        at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:350)\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NullPointerException\n        at org.elasticsearch.index.query.SimpleQueryParser.newPrefixQuery(SimpleQueryParser.java:131)\n        at org.apache.lucene.queryparser.simple.SimpleQueryParser.consumeToken(SimpleQueryParser.java:406)\n        at org.apache.lucene.queryparser.simple.SimpleQueryParser.parseSubQuery(SimpleQueryParser.java:212)\n        at org.apache.lucene.queryparser.simple.SimpleQueryParser.parse(SimpleQueryParser.java:152)\n        at org.elasticsearch.index.query.SimpleQueryStringParser.parse(SimpleQueryStringParser.java:212)\n        at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:256)\n        at org.elasticsearch.index.query.IndexQueryParserService.innerParse(IndexQueryParserService.java:303)\n        at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:206)\n        at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:201)\n        at org.elasticsearch.search.query.QueryParseElement.parse(QueryParseElement.java:33)\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:836)\n        ... 10 more\n```\n","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}