{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51855","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51855/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51855/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51855/events","html_url":"https://github.com/elastic/elasticsearch/issues/51855","id":559626340,"node_id":"MDU6SXNzdWU1NTk2MjYzNDA=","number":51855,"title":"Failure to connect to remote cluster may prevent node startup","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"labels":[{"id":146854632,"node_id":"MDU6TGFiZWwxNDY4NTQ2MzI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Network","name":":Distributed/Network","color":"0e8a16","default":false,"description":"Http and internode communication implementations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-02-04T10:31:34Z","updated_at":"2020-03-20T13:49:50Z","closed_at":"2020-03-20T13:49:50Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Today, if `RemoteClusterService#initializeRemoteClusters` times out while connecting to the remote clusters then the node logs a warning and continues. However if all of the connection attempts complete before the timeout, and any of them failed, then the exception will be propagated and the node will fail at startup.\r\n\r\nFor instance, with this `elasticsearch.yml`:\r\n\r\n```\r\ntransport.connect_timeout: 10s\r\ncluster.remote.test_remote.seeds: 192.168.1.1:9300 ## not a node\r\n```\r\n\r\nI get this:\r\n\r\n```\r\n[2020-02-04T10:29:43,739][DEBUG][o.e.t.RemoteClusterConnection] [node-0] [test_remote] opening connection to seed node: [{test_remote#192.168.1.1:9300}{9uVe8O5nSpGLTlweWgp74Q}{192.168.1.1}{192.168.1.1:9300}{dim}] proxy address: []\r\n[2020-02-04T10:29:53,769][WARN ][o.e.t.RemoteClusterConnection] [node-0] fetching nodes from external cluster [test_remote] failed\r\norg.elasticsearch.transport.ConnectTransportException: [][192.168.1.1:9300] connect_timeout[10s]\r\n\tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onTimeout(TcpTransport.java:995) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:703) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:830) [?:?]\r\n[2020-02-04T10:29:53,776][WARN ][o.e.t.RemoteClusterService] [node-0] failed to update seed list for cluster: test_remote\r\norg.elasticsearch.transport.ConnectTransportException: [][192.168.1.1:9300] connect_timeout[10s]\r\n\tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onTimeout(TcpTransport.java:995) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:703) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:830) [?:?]\r\n[2020-02-04T10:29:53,779][ERROR][o.e.b.Bootstrap          ] [node-0] Exception\r\njava.lang.IllegalStateException: failed to connect to remote clusters\r\n\tat org.elasticsearch.transport.RemoteClusterService.initializeRemoteClusters(RemoteClusterService.java:450) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.transport.TransportService.doStart(TransportService.java:241) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:59) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.node.Node.start(Node.java:688) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.start(Bootstrap.java:273) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:358) [elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) [elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150) [elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) [elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:125) [elasticsearch-cli-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.cli.Command.main(Command.java:90) [elasticsearch-cli-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:115) [elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:92) [elasticsearch-7.5.1.jar:7.5.1]\r\nCaused by: java.util.concurrent.ExecutionException: ConnectTransportException[[][192.168.1.1:9300] connect_timeout[10s]]\r\n\tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:266) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:239) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:65) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.transport.RemoteClusterService.initializeRemoteClusters(RemoteClusterService.java:444) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\t... 12 more\r\nCaused by: org.elasticsearch.transport.ConnectTransportException: [][192.168.1.1:9300] connect_timeout[10s]\r\n\tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onTimeout(TcpTransport.java:995) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:703) ~[elasticsearch-7.5.1.jar:7.5.1]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n\tat java.lang.Thread.run(Thread.java:830) ~[?:?]\r\n```\r\n\r\nRoughly the same thing happens in the event of a `Connection refused`.","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}