[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/641888117","html_url":"https://github.com/elastic/elasticsearch/issues/57917#issuecomment-641888117","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57917","id":641888117,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTg4ODExNw==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-06-10T09:46:57Z","updated_at":"2020-06-10T09:46:57Z","author_association":"MEMBER","body":"@RashmiRam thanks for raising this, I tried reproducing this with 6.6.2 but wasn't able to get the error you are seeing. Is this a single local 6.6.2 node you are running or some larger cluster? Do you see a stack-trace in the logs that you could attach?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/641888412","html_url":"https://github.com/elastic/elasticsearch/issues/57917#issuecomment-641888412","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57917","id":641888412,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTg4ODQxMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-06-10T09:47:32Z","updated_at":"2020-06-10T09:47:32Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Search)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/641914183","html_url":"https://github.com/elastic/elasticsearch/issues/57917#issuecomment-641914183","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57917","id":641914183,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTkxNDE4Mw==","user":{"login":"RashmiRam","id":9073011,"node_id":"MDQ6VXNlcjkwNzMwMTE=","avatar_url":"https://avatars1.githubusercontent.com/u/9073011?v=4","gravatar_id":"","url":"https://api.github.com/users/RashmiRam","html_url":"https://github.com/RashmiRam","followers_url":"https://api.github.com/users/RashmiRam/followers","following_url":"https://api.github.com/users/RashmiRam/following{/other_user}","gists_url":"https://api.github.com/users/RashmiRam/gists{/gist_id}","starred_url":"https://api.github.com/users/RashmiRam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RashmiRam/subscriptions","organizations_url":"https://api.github.com/users/RashmiRam/orgs","repos_url":"https://api.github.com/users/RashmiRam/repos","events_url":"https://api.github.com/users/RashmiRam/events{/privacy}","received_events_url":"https://api.github.com/users/RashmiRam/received_events","type":"User","site_admin":false},"created_at":"2020-06-10T10:34:26Z","updated_at":"2020-06-10T10:35:04Z","author_association":"NONE","body":"@cbuescher Thanks for looking into this. Even I tried running this in my local mac, I wasn't able to reproduce this. But, This is reproducible in production multi node cluster. \r\n\r\nStack trace\r\n\r\n`[2020-06-10T07:54:29,360][WARN ][r.suppressed             ] [cluster-1-client-2]path: /bigint_sample/_search, params: {index=bigint_sample} org.elasticsearch.action.search.SearchPhaseExecutionException: all shards failed \tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseFailure(AbstractSearchAsyncAction.java:293) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:133) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.AbstractSearchAsyncAction.onPhaseDone(AbstractSearchAsyncAction.java:254) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.InitialSearchPhase.onShardFailure(InitialSearchPhase.java:101) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.InitialSearchPhase.access$100(InitialSearchPhase.java:48) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.InitialSearchPhase$2.lambda$onFailure$1(InitialSearchPhase.java:221) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.InitialSearchPhase.maybeFork(InitialSearchPhase.java:175) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.InitialSearchPhase.access$000(InitialSearchPhase.java:48) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.InitialSearchPhase$2.onFailure(InitialSearchPhase.java:221) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.SearchExecutionStatsCollector.onFailure(SearchExecutionStatsCollector.java:73) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.ActionListenerResponseHandler.handleException(ActionListenerResponseHandler.java:53) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.SearchTransportService$ConnectionCountingHandler.handleException(SearchTransportService.java:462) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:1103) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TransportService$6.doRun(TransportService.java:660) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:759) [elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.6.2.jar:6.6.2] \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?] \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?] \tat java.lang.Thread.run(Thread.java:834) [?:?] Caused by: org.elasticsearch.ElasticsearchException$1: can not write type [class java.math.BigInteger] \tat org.elasticsearch.ElasticsearchException.guessRootCauses(ElasticsearchException.java:657) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:131) [elasticsearch-6.6.2.jar:6.6.2] \t... 17 more Caused by: java.io.IOException: can not write type [class java.math.BigInteger] \tat org.elasticsearch.common.io.stream.StreamOutput.writeGenericValue(StreamOutput.java:725) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.index.query.BaseTermQueryBuilder.doWriteTo(BaseTermQueryBuilder.java:134) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.index.query.AbstractQueryBuilder.writeTo(AbstractQueryBuilder.java:80) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.common.io.stream.StreamOutput.writeNamedWriteable(StreamOutput.java:975) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.index.query.AbstractQueryBuilder.writeQueries(AbstractQueryBuilder.java:264) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.index.query.BoolQueryBuilder.doWriteTo(BoolQueryBuilder.java:109) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.index.query.AbstractQueryBuilder.writeTo(AbstractQueryBuilder.java:80) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.common.io.stream.StreamOutput.writeNamedWriteable(StreamOutput.java:975) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.common.io.stream.StreamOutput.writeOptionalNamedWriteable(StreamOutput.java:986) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.search.builder.SearchSourceBuilder.writeTo(SearchSourceBuilder.java:283) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.common.io.stream.StreamOutput.writeOptionalWriteable(StreamOutput.java:833) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.search.internal.ShardSearchLocalRequest.innerWriteTo(ShardSearchLocalRequest.java:254) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.search.internal.ShardSearchTransportRequest.writeTo(ShardSearchTransportRequest.java:171) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TcpTransport.buildMessage(TcpTransport.java:889) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TcpTransport.sendRequestToChannel(TcpTransport.java:740) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TcpTransport.access$300(TcpTransport.java:111) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TcpTransport$NodeChannels.sendRequest(TcpTransport.java:286) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TransportService.sendRequestInternal(TransportService.java:627) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:542) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TransportService.sendChildRequest(TransportService.java:586) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.transport.TransportService.sendChildRequest(TransportService.java:577) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.SearchTransportService.sendExecuteQuery(SearchTransportService.java:149) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.SearchQueryThenFetchAsyncAction.executePhaseOnShard(SearchQueryThenFetchAsyncAction.java:54) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.InitialSearchPhase.performPhaseOnShard(InitialSearchPhase.java:212) ~[elasticsearch-6.6.2.jar:6.6.2] \tat org.elasticsearch.action.search.InitialSearchPhase.onShardFailure(InitialSearchPhase.java:110) ~[elasticsearch-6.6.2.jar:6.6.2] \t... 15 more\r\n`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/642632296","html_url":"https://github.com/elastic/elasticsearch/issues/57917#issuecomment-642632296","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57917","id":642632296,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjYzMjI5Ng==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T13:00:24Z","updated_at":"2020-06-11T13:00:24Z","author_association":"MEMBER","body":"The problem seems to be that for `{ \"term\": { \"test\": { \"value\": 80315953321748200608 } } }`, the value gets parsed to a BigInteger instance by the json parser, but we cannot send those objects over the wire to another node. This explains why on a single node this wouldn't fail. I can reproduce now with one of our integration test that spins up several nodes and will open a PR to fix this, although I'm not entirely sure on which level we should prevent this.\r\nIn the meantime a workaround would be to send the value as a String: `{ \"term\": { \"test\": { \"value\": \"80315953321748200608\" } } }`. Does that work as expected then?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/642637970","html_url":"https://github.com/elastic/elasticsearch/issues/57917#issuecomment-642637970","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57917","id":642637970,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjYzNzk3MA==","user":{"login":"RashmiRam","id":9073011,"node_id":"MDQ6VXNlcjkwNzMwMTE=","avatar_url":"https://avatars1.githubusercontent.com/u/9073011?v=4","gravatar_id":"","url":"https://api.github.com/users/RashmiRam","html_url":"https://github.com/RashmiRam","followers_url":"https://api.github.com/users/RashmiRam/followers","following_url":"https://api.github.com/users/RashmiRam/following{/other_user}","gists_url":"https://api.github.com/users/RashmiRam/gists{/gist_id}","starred_url":"https://api.github.com/users/RashmiRam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RashmiRam/subscriptions","organizations_url":"https://api.github.com/users/RashmiRam/orgs","repos_url":"https://api.github.com/users/RashmiRam/repos","events_url":"https://api.github.com/users/RashmiRam/events{/privacy}","received_events_url":"https://api.github.com/users/RashmiRam/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T13:10:58Z","updated_at":"2020-06-11T13:10:58Z","author_association":"NONE","body":"Thanks for the explanation @cbuescher. Yes, we are aware of the workaround and unfortunately we don't have control over changing it to the string part of the query now. Is this the same with recent versions of ES also or specific to this version?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/642644965","html_url":"https://github.com/elastic/elasticsearch/issues/57917#issuecomment-642644965","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57917","id":642644965,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjY0NDk2NQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T13:23:18Z","updated_at":"2020-06-11T13:23:18Z","author_association":"MEMBER","body":"> Is this the same with recent versions of ES also or specific to this version?\r\n\r\nI think its still an issue, I tested this on our master branch. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/645892476","html_url":"https://github.com/elastic/elasticsearch/issues/57917#issuecomment-645892476","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57917","id":645892476,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NTg5MjQ3Ng==","user":{"login":"RashmiRam","id":9073011,"node_id":"MDQ6VXNlcjkwNzMwMTE=","avatar_url":"https://avatars1.githubusercontent.com/u/9073011?v=4","gravatar_id":"","url":"https://api.github.com/users/RashmiRam","html_url":"https://github.com/RashmiRam","followers_url":"https://api.github.com/users/RashmiRam/followers","following_url":"https://api.github.com/users/RashmiRam/following{/other_user}","gists_url":"https://api.github.com/users/RashmiRam/gists{/gist_id}","starred_url":"https://api.github.com/users/RashmiRam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RashmiRam/subscriptions","organizations_url":"https://api.github.com/users/RashmiRam/orgs","repos_url":"https://api.github.com/users/RashmiRam/repos","events_url":"https://api.github.com/users/RashmiRam/events{/privacy}","received_events_url":"https://api.github.com/users/RashmiRam/received_events","type":"User","site_admin":false},"created_at":"2020-06-18T09:15:52Z","updated_at":"2020-06-18T09:15:52Z","author_association":"NONE","body":"@cbuescher which version does have this fix?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/645925485","html_url":"https://github.com/elastic/elasticsearch/issues/57917#issuecomment-645925485","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57917","id":645925485,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NTkyNTQ4NQ==","user":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"created_at":"2020-06-18T10:17:39Z","updated_at":"2020-06-18T10:17:39Z","author_association":"MEMBER","body":"@RashmiRam this will be in the next 7.8 release. Seeing that you are still on 6, its unclear if there will be any more 6.8 patch releases. I'm currently trying to find out if a backport to 6.8 is possible in the unlikely event that we will have another release there.","performed_via_github_app":null}]