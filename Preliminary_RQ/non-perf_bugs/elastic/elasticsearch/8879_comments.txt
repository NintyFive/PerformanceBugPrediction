[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/66463580","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-66463580","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":66463580,"node_id":"MDEyOklzc3VlQ29tbWVudDY2NDYzNTgw","user":{"login":"mvdz","id":9332217,"node_id":"MDQ6VXNlcjkzMzIyMTc=","avatar_url":"https://avatars1.githubusercontent.com/u/9332217?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdz","html_url":"https://github.com/mvdz","followers_url":"https://api.github.com/users/mvdz/followers","following_url":"https://api.github.com/users/mvdz/following{/other_user}","gists_url":"https://api.github.com/users/mvdz/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdz/subscriptions","organizations_url":"https://api.github.com/users/mvdz/orgs","repos_url":"https://api.github.com/users/mvdz/repos","events_url":"https://api.github.com/users/mvdz/events{/privacy}","received_events_url":"https://api.github.com/users/mvdz/received_events","type":"User","site_admin":false},"created_at":"2014-12-10T15:01:01Z","updated_at":"2014-12-10T15:01:01Z","author_association":"NONE","body":"Workaround: set 'threadpool.percolate.size' to 1\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69564819","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-69564819","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":69564819,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NTY0ODE5","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-01-12T12:47:13Z","updated_at":"2015-01-12T12:47:13Z","author_association":"MEMBER","body":"Just reproduced this bug in an integration test. \n\nWhat I suspect to be the source of this issue: when a shard is recovered (right after startup for example), the percolate queries of the shard are parsed then loaded in memory. While being parsed, the script filter instantiates a `GroovyScript` for the `script doc['name'].value == 'b'` with a `SearchLookup` that comes from the `QueryParsedContext` used for parsing.\n\nWhen a doc is percolated, the cached query is re-used and executed against an in-memory index but the script filter still use the same `GroovyScript` instance with the same `SearchLookup` instance. When executed concurrently, the `SearchLookup` instance is used by several `Collector` at the same time and matching doc are mixed.\n\nThe only solution I see is to keep in memory the string representation of percolate queries and parse them for every doc to percolate... but this will drastically impact performance.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/69820080","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-69820080","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":69820080,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODIwMDgw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-01-13T21:07:24Z","updated_at":"2015-01-13T21:07:24Z","author_association":"CONTRIBUTOR","body":"@martijnvg any suggestions?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/70466022","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-70466022","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":70466022,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNDY2MDIy","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-01-19T09:30:49Z","updated_at":"2015-01-19T09:30:49Z","author_association":"MEMBER","body":"@clintongormley no, @tlrx explanation makes sense and this issue needs to be fixed. (each percolator query for example should have its own SearchLookup then the bug doesn't occur)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/72014805","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-72014805","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":72014805,"node_id":"MDEyOklzc3VlQ29tbWVudDcyMDE0ODA1","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-01-29T12:15:24Z","updated_at":"2015-01-29T12:15:24Z","author_association":"MEMBER","body":"To get back to this: I tried to fix this in such a way that each `script_filter` execution has its own SearchLookup, but unfortunately this doesn't fix the bug. \n\nWhat I did was in ScriptFilterParser.ScriptFilter#getDocIdSet(...) create a new SearchScript and SearchLookup, just to be sure that in the percolator each percolate request is working on its own data structures. This isn't how should fix this issue, but should prevent bug, however this didn't help. Now I'm not sure what else can cause this issue with script_filter in the percolator.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/76941847","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-76941847","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":76941847,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTQxODQ3","user":{"login":"mvdz","id":9332217,"node_id":"MDQ6VXNlcjkzMzIyMTc=","avatar_url":"https://avatars1.githubusercontent.com/u/9332217?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdz","html_url":"https://github.com/mvdz","followers_url":"https://api.github.com/users/mvdz/followers","following_url":"https://api.github.com/users/mvdz/following{/other_user}","gists_url":"https://api.github.com/users/mvdz/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdz/subscriptions","organizations_url":"https://api.github.com/users/mvdz/orgs","repos_url":"https://api.github.com/users/mvdz/repos","events_url":"https://api.github.com/users/mvdz/events{/privacy}","received_events_url":"https://api.github.com/users/mvdz/received_events","type":"User","site_admin":false},"created_at":"2015-03-03T13:07:54Z","updated_at":"2015-03-03T13:07:54Z","author_association":"NONE","body":"Hello @martijnvg, I've taken another look at this and implemented a workaround that appears to be the same as what you describe. It does seem to work for me, could you take a look at it?\n\nhttps://github.com/mvdz/elasticsearch/commit/04707f7fd25bc545aae00e34d7a0e443096b8456\n\nI understand this isn't the real fix, but hopefully it can lead to something better. Also it only works for Groovy scripts, while the issue also exists for other script languages. It's based on the 1.4 branch.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/77270792","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-77270792","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":77270792,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjcwNzky","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-03-04T23:08:31Z","updated_at":"2015-03-04T23:08:31Z","author_association":"MEMBER","body":"thanks for sharing this @mvdz! I'll take a look at it, maybe I did something wrong.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/103391986","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-103391986","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":103391986,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMzM5MTk4Ng==","user":{"login":"robth","id":709051,"node_id":"MDQ6VXNlcjcwOTA1MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/709051?v=4","gravatar_id":"","url":"https://api.github.com/users/robth","html_url":"https://github.com/robth","followers_url":"https://api.github.com/users/robth/followers","following_url":"https://api.github.com/users/robth/following{/other_user}","gists_url":"https://api.github.com/users/robth/gists{/gist_id}","starred_url":"https://api.github.com/users/robth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robth/subscriptions","organizations_url":"https://api.github.com/users/robth/orgs","repos_url":"https://api.github.com/users/robth/repos","events_url":"https://api.github.com/users/robth/events{/privacy}","received_events_url":"https://api.github.com/users/robth/received_events","type":"User","site_admin":false},"created_at":"2015-05-19T08:12:08Z","updated_at":"2015-05-19T08:12:08Z","author_association":"NONE","body":"Hi guys, any progress on this issue?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/105214281","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-105214281","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":105214281,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNTIxNDI4MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-05-25T11:29:57Z","updated_at":"2015-05-25T11:29:57Z","author_association":"CONTRIBUTOR","body":"Hi @robth - no progress yet. /cc @martijnvg \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/105564605","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-105564605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":105564605,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNTU2NDYwNQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-05-26T15:21:27Z","updated_at":"2015-05-26T15:21:27Z","author_association":"MEMBER","body":"@clintongormley @robth Fixing the script issue has become easier because of the merge of queries and filters on the Lucene level. I think we can properly fix this for 2.0. In 1.x the only fix I can come up with isn't a clean one.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/105787973","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-105787973","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":105787973,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNTc4Nzk3Mw==","user":{"login":"robth","id":709051,"node_id":"MDQ6VXNlcjcwOTA1MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/709051?v=4","gravatar_id":"","url":"https://api.github.com/users/robth","html_url":"https://github.com/robth","followers_url":"https://api.github.com/users/robth/followers","following_url":"https://api.github.com/users/robth/following{/other_user}","gists_url":"https://api.github.com/users/robth/gists{/gist_id}","starred_url":"https://api.github.com/users/robth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robth/subscriptions","organizations_url":"https://api.github.com/users/robth/orgs","repos_url":"https://api.github.com/users/robth/repos","events_url":"https://api.github.com/users/robth/events{/privacy}","received_events_url":"https://api.github.com/users/robth/received_events","type":"User","site_admin":false},"created_at":"2015-05-27T07:07:55Z","updated_at":"2015-05-27T07:07:55Z","author_association":"NONE","body":"@clintongormley @martijnvg Thanks for the feedback!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159854573","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-159854573","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":159854573,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTg1NDU3Mw==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-11-26T09:14:08Z","updated_at":"2015-11-26T09:14:08Z","author_association":"MEMBER","body":"I took some more time to look at this issue again and also talked to @martijnvg about a potential fix.\n\nThis issue was easy to reproduce on 1.x versions of Elasticsearch where a `GroovyScript` instance is initialized by the percolator at parsing time with a given `SearchLookup` instance before being cached, making the percolating query reuse the same search lookup instance again and again while percolating documents, resulting in collisions.\n\nI think this issue disappeared in 2.0 thanks to #10389 where `SearchScript` has been split into `SearchScript` and `LeafSearchScript` and the `GroovyScriptEngineService` modified so that `GroovyScript` now use a dedicated `LeafSearchLookup` instance at search time and do not get mixed when percolating documents concurrently.\n\n@martijnvg I do now think that the fix you suggested is not necessary anymore... what do you think?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159877524","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-159877524","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":159877524,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTg3NzUyNA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-11-26T10:51:40Z","updated_at":"2015-11-26T10:51:40Z","author_association":"MEMBER","body":"Cool, that fixes the `doc[fieldx]` lookup, but I think the `_source.fieldx` still can fail? Looking at the code the `SourceLookup` is still being reused. \n\nMaybe instead of adding a lazy script query (which gets accesses to the SearchLookup at a later stage) we could do the same trick to SearchLookup as is done with DocLookup and FieldsLookup? (getting a dedicatedLeadDocLookup / LeafFieldLookup instances at percolate time)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159881417","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-159881417","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":159881417,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTg4MTQxNw==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2015-11-26T11:01:17Z","updated_at":"2015-11-26T11:01:17Z","author_association":"MEMBER","body":"@martijnvg I didn't catch this one but I guess you're talking about [this line](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/search/lookup/SearchLookup.java#L47) right?\n\nI'll try your solution, thanks for the suggestion\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159896998","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-159896998","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":159896998,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTg5Njk5OA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2015-11-26T12:04:58Z","updated_at":"2015-11-26T12:04:58Z","author_association":"MEMBER","body":"@tlrx yes, that exact line.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/263072305","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-263072305","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":263072305,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MzA3MjMwNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-11-26T16:27:36Z","updated_at":"2016-11-26T16:27:36Z","author_association":"CONTRIBUTOR","body":"@martijnvg Just tried this on 5.0 and the doc[] case works fine, but when trying to use `_source`, I get no matches:\r\n\r\n```\r\nPUT /test\r\n{\r\n  \"mappings\" : {\r\n    \"test\" : {\r\n      \"properties\" : {\r\n        \"name\" : {\r\n          \"type\" : \"keyword\"\r\n        },\r\n        \"query\": {\r\n          \"type\": \"percolator\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nPUT /test/test/1\r\n{\r\n  \"type\": \"test\",\r\n  \"query\": {\r\n    \"constant_score\": {\r\n      \"filter\": {\r\n        \"script\": {\r\n          \"script\": {\"inline\": \"_source.name == \\\"a\\\"\",\r\n          \"lang\": \"groovy\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nGET /test/test/_percolate\r\n{ \"doc\": { \"name\": \"a\" } }\r\n```\r\n\r\nIs `_source` not available in groovy scripts in the percolator? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/311671292","html_url":"https://github.com/elastic/elasticsearch/issues/8879#issuecomment-311671292","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8879","id":311671292,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMTY3MTI5Mg==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-28T14:10:01Z","updated_at":"2017-06-28T14:10:01Z","author_association":"MEMBER","body":"Closing this as this is no longer an issue. \r\n\r\n@clintongormley The memory index doesn't store `_source` and that is the reason why no matches are returned. I'll document this as a limitation.","performed_via_github_app":null}]