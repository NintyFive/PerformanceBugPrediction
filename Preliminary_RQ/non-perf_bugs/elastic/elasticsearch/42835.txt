{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42835","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42835/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42835/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42835/events","html_url":"https://github.com/elastic/elasticsearch/issues/42835","id":451841722,"node_id":"MDU6SXNzdWU0NTE4NDE3MjI=","number":42835,"title":"Broken range queries on \"date||epoch_millis\" fields in 7.1","user":{"login":"phil-bl","id":35024225,"node_id":"MDQ6VXNlcjM1MDI0MjI1","avatar_url":"https://avatars0.githubusercontent.com/u/35024225?v=4","gravatar_id":"","url":"https://api.github.com/users/phil-bl","html_url":"https://github.com/phil-bl","followers_url":"https://api.github.com/users/phil-bl/followers","following_url":"https://api.github.com/users/phil-bl/following{/other_user}","gists_url":"https://api.github.com/users/phil-bl/gists{/gist_id}","starred_url":"https://api.github.com/users/phil-bl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/phil-bl/subscriptions","organizations_url":"https://api.github.com/users/phil-bl/orgs","repos_url":"https://api.github.com/users/phil-bl/repos","events_url":"https://api.github.com/users/phil-bl/events{/privacy}","received_events_url":"https://api.github.com/users/phil-bl/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"assignees":[{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2019-06-04T07:35:23Z","updated_at":"2019-06-13T09:01:36Z","closed_at":"2019-06-13T09:01:36Z","author_association":"NONE","active_lock_reason":null,"body":"After upgrading from 6.8 to 7.1.1 the following query results in error:\r\n```\r\n{\r\n  \"query\": {\r\n\t  \"bool\": {\r\n\t    \"filter\": [\r\n\t      {\r\n\t        \"range\": {\r\n\t          \"create_date\": {\r\n\t            \"to\": 297276785531,\r\n\t            \"include_upper\": true\r\n\t          }\r\n\t        }\r\n\t      }\r\n\t    ]\r\n\t }\r\n  }\r\n}\r\n```\r\nit used to work before the upgrade. The problem is in `include_upper = true`, it works if changed to `false`.\r\n\r\nThe error message is:\r\n```\r\nfailed to parse date field [297276785531] with format [date||epoch_millis]: [Text '297276785531' could not be parsed, unparsed text found at index 0]\r\n```\r\n\r\nmapping for this field is:\r\n```\r\n      \"create_date\": {\r\n        \"type\": \"date\",\r\n        \"format\": \"date||epoch_millis\"\r\n      }\r\n```\r\n\r\nanother example of the same issue, but with `include_lower`:\r\n```\r\n{\r\n  \"query\": {\r\n\t  \"bool\": {\r\n\t    \"filter\": [\r\n\t      {\r\n\t        \"range\": {\r\n\t          \"create_date\": {\r\n\t            \"from\": 297276785531,\r\n\t            \"include_lower\": false\r\n\t          }\r\n\t        }\r\n\t      }\r\n\t    ]\r\n\t }\r\n  }\r\n}\r\n```\r\nAgain, it works with `\"include_lower\": true`\r\n\r\nThis behavior doesn't affect \"date_hour_minute_second_fraction||epoch_millis\" fields, the issue seems to be related only to \"date||epoch_millis\" mapping format.\r\n\r\n**Elasticsearch version**:\r\nVersion: 7.1.1, Build: oss/docker/7a013de/2019-05-23T14:04:00.380842Z, JVM: 12.0.1\r\n\r\n**JVM version**:\r\nOpenJDK 64 12.0.1\r\n\r\n**OS version**\r\n4.14.78-coreos","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}