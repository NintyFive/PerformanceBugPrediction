{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10260","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10260/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10260/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10260/events","html_url":"https://github.com/elastic/elasticsearch/issues/10260","id":64243058,"node_id":"MDU6SXNzdWU2NDI0MzA1OA==","number":10260,"title":"Aggregations: new `frequencies` aggregation","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"}],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2015-03-25T11:04:24Z","updated_at":"2015-08-26T19:07:19Z","closed_at":"2015-08-26T19:07:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"When working on time-based data, a farily common question is to ask about the frequency of certain field values. For instance imagine that you are indexing Apache logs, you might wonder how many visitors are new visitors vs. recurring visitors. Or more generally, how many visitors have visited your website more than 5, 50 or 500 times.\n\nIt is possible to do it right now using the terms aggregation and doing the analysis on client-side. But this doesn't scale on high-cardinality fields as you would essentially need to retrieve the frequency of all the terms in the index. If we are speaking about unique ips that visited a high-traffic website, this just won't work. The other alternative is to implement [entity-centric indexing](https://www.elastic.co/elasticon/2015/sf/building-entity-centric-indexes) but it is not always easy/efficient (but to be fair also allows to answer many more questions).\n\nWe could make this information available by implementing a new aggregation based on the [count-min sketch](http://en.wikipedia.org/wiki/Count%E2%80%93min_sketch) algorithm.\n\nIn terms of API, this aggregation would take a list of frequencies and return (an approximation of) how many unique values have greater frequencies.\n\nOne challenge with this aggregation is to pick a good name. I'm currently thinking of `frequencies` or `count-min` (like the algorithm name) but there might be better options.\n\nNote: this issue is mostly a reminder for myself since I've seen this kind of questions coming more often, I don't actually know yet how well or even if it will work.\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}