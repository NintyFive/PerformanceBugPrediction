{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38442","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38442/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38442/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38442/events","html_url":"https://github.com/elastic/elasticsearch/issues/38442","id":406864205,"node_id":"MDU6SXNzdWU0MDY4NjQyMDU=","number":38442,"title":"How can I select a test document which state has changed from \"passed\" to \"failed\"","user":{"login":"asamsung","id":39164995,"node_id":"MDQ6VXNlcjM5MTY0OTk1","avatar_url":"https://avatars0.githubusercontent.com/u/39164995?v=4","gravatar_id":"","url":"https://api.github.com/users/asamsung","html_url":"https://github.com/asamsung","followers_url":"https://api.github.com/users/asamsung/followers","following_url":"https://api.github.com/users/asamsung/following{/other_user}","gists_url":"https://api.github.com/users/asamsung/gists{/gist_id}","starred_url":"https://api.github.com/users/asamsung/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asamsung/subscriptions","organizations_url":"https://api.github.com/users/asamsung/orgs","repos_url":"https://api.github.com/users/asamsung/repos","events_url":"https://api.github.com/users/asamsung/events{/privacy}","received_events_url":"https://api.github.com/users/asamsung/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-02-05T16:24:17Z","updated_at":"2019-02-05T17:10:49Z","closed_at":"2019-02-05T17:10:30Z","author_association":"NONE","active_lock_reason":null,"body":"I have test documents like one below:\r\ntest_reslulsts:\r\n{\r\n\"report_id\":\"my_report_1\",\r\n\"test_name\":\"some_test_name_123\",\r\n\"status\":\"passed\"\r\n\"parent_details\":\r\n  {\r\n      \"parent_id\":\"154865976079\",\r\n      \"run_tag\":125\r\n  }\r\n}\r\n\r\nI need to select all the test_results that were passing for given \"parent_id\" and failing for another \"parent_id\".\r\n\r\nI am using composite aggregation now, but it returns me only the tests whose status have changed.\r\nI want to specify how the status was changed (for example from \"passed\" to \"failed\") and get all such documents not just their ids.\r\n\r\nGET test_results/_search\r\n{\"query\": \r\n       {\"bool\": {\"must\": [\r\n   {\"terms\": { \"test_reslulsts.parent_id\": [\"154865976079\",\"154881593370\"]}}]\r\n}},\r\n\"aggs\" : {\r\n        \"my_buckets\": {\r\n            \"composite\" : { \"size\": 100,\r\n                \"sources\" : [\r\n                    { \"test_name\": { \"terms\" : { \"field\": \"name\" } } },\r\n                    { \"test_result\": { \"terms\" : { \"field\": \"status\" } } }\r\n                ],\r\n        \"after\": {\r\n        \"test_name\": \"some_test_name_1234\",\r\n        \"test_result\": \"failed\"\r\n      }\r\n            },\r\n          \"aggs\": {\r\n          \"filter\": {\r\n            \"bucket_selector\": {\r\n              \"buckets_path\": {\r\n                \"doc_count\": \"_count\"\r\n              },\r\n              \"script\": \"params.doc_count == 1\"\r\n            }\r\n         }\r\n      }}\r\n},\r\n\"size\": 0\r\n}\r\n\r\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}