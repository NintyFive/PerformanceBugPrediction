[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347668929","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347668929","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347668929,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY2ODkyOQ==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:26:34Z","updated_at":"2017-11-28T21:26:34Z","author_association":"CONTRIBUTOR","body":"Hi @synhershko! Your question is better suited to the support forums over at https://discuss.elastic.co. We prefer to use Github issues only for bug reports and feature requests, and we think it's more likely this is a question (about a nonstandard installer) than a bug report. I'm closing this as an issue here, but encourage you to ask this question in the forum instead. Many thanks.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347670051","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347670051","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347670051,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3MDA1MQ==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:30:46Z","updated_at":"2017-11-28T21:30:46Z","author_association":"CONTRIBUTOR","body":"If you actually read the issue you'd see this is actually happening with the default installer provided and released by you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347670226","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347670226","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347670226,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3MDIyNg==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:31:29Z","updated_at":"2017-11-28T21:31:29Z","author_association":"CONTRIBUTOR","body":"And also, a client-only node shouldn't be checking on the data path anyway. If that's not a bug I don't know what is.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347670410","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347670410","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347670410,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3MDQxMA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:32:13Z","updated_at":"2017-11-28T21:32:13Z","author_association":"MEMBER","body":"This is a \"bug\", of sorts. When configuring the security policy, we do not look at any settings to determine if the path may or may not be used. I'm going to reopen this, but know that this is very low priority.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347670702","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347670702","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347670702,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3MDcwMg==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:33:20Z","updated_at":"2017-11-28T21:33:20Z","author_association":"CONTRIBUTOR","body":"@rjernst if you can point me at the right file in the code base I'll be happy to adopt.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347671052","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347671052","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347671052,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3MTA1Mg==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:34:36Z","updated_at":"2017-11-28T21:34:36Z","author_association":"CONTRIBUTOR","body":"My apologies @synhershko, I misunderstood the origin of the installer.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347671154","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347671154","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347671154,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3MTE1NA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:35:00Z","updated_at":"2017-11-28T21:35:17Z","author_association":"MEMBER","body":"@synhershko `core/src/main/java/org/elasticsearch/bootstrap/Security.java`. The `addFilePermissions` method.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347672963","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347672963","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347672963,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3Mjk2Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:41:52Z","updated_at":"2017-11-28T21:41:52Z","author_association":"MEMBER","body":"> If you actually read the issue you'd see this is actually happening with the default installer provided and released by you.\r\n\r\n> If that's not a bug I don't know what is.\r\n\r\nThere is a bug here and the issue was closed prematurely which we will work on our end, but this kind of tone is still not acceptable. We are collaborators here, not adversaries.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347673346","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347673346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347673346,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3MzM0Ng==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T21:43:24Z","updated_at":"2017-11-28T21:43:24Z","author_association":"MEMBER","body":"For now you can work around this by simply creating that directory with permissions for the Elasticsearch user.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347677996","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347677996","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347677996,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY3Nzk5Ng==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T22:01:03Z","updated_at":"2017-11-28T22:01:03Z","author_association":"CONTRIBUTOR","body":"> There is a bug here and the issue was closed prematurely which we will work on our end, but this kind of tone is still not acceptable. We are collaborators here, not adversaries.\r\n\r\nYou are right @jasontedor , and my apologies for that @DaveCTurner.\r\n\r\nI'm going to look at that file and see if I can send a PR to fix it. I'd rather avoid creating that folder because I'm using automation scripts and those tend to get too specific too fast otherwise.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347681641","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347681641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347681641,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY4MTY0MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T22:14:40Z","updated_at":"2017-11-28T22:14:40Z","author_association":"MEMBER","body":"@synhershko I am not sure if I want that file to become node-type aware so I don’t think there’s an obvious fix at the moment. That might be the fix we have to go with but I want to see if we have other options first. \r\n\r\nAnother workaround is to set `path.data` to `/var/lib/elasticsearch` or another directory like that.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347683502","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347683502","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347683502,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY4MzUwMg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T22:21:25Z","updated_at":"2017-11-28T22:21:25Z","author_association":"MEMBER","body":"> Another workaround is to set `path.data` to `/var/lib/elasticsearch` or another directory like that.\r\n\r\nTo be clear here: this is what the default packaging does and it ensures that directory exists.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347683691","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347683691","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347683691,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzY4MzY5MQ==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2017-11-28T22:22:10Z","updated_at":"2017-11-28T22:22:10Z","author_association":"CONTRIBUTOR","body":"Okay, the fix is rather trivial other than the concern you raised:\r\n\r\n```java\r\n        // only need to access default/configured data paths if we are running on a data node\r\n        if (Node.NODE_DATA_SETTING.get(environment.settings())) {\r\n            if (environment.sharedDataFile() != null) {\r\n                addDirectoryPath(policy, Environment.PATH_SHARED_DATA_SETTING.getKey(), environment.sharedDataFile(),\r\n                    \"read,readlink,write,delete\");\r\n            }\r\n            final Set<Path> dataFilesPaths = new HashSet<>();\r\n            for (Path path : environment.dataFiles()) {\r\n                addDirectoryPath(policy, Environment.PATH_DATA_SETTING.getKey(), path, \"read,readlink,write,delete\");\r\n            /*\r\n             * We have to do this after adding the path because a side effect of that is that the directory is created; the Path#toRealPath\r\n             * invocation will fail if the directory does not already exist. We use Path#toRealPath to follow symlinks and handle issues\r\n             * like unicode normalization or case-insensitivity on some filesystems (e.g., the case-insensitive variant of HFS+ on macOS).\r\n             */\r\n                try {\r\n                    final Path realPath = path.toRealPath();\r\n                    if (!dataFilesPaths.add(realPath)) {\r\n                        throw new IllegalStateException(\"path [\" + realPath + \"] is duplicated by [\" + path + \"]\");\r\n                    }\r\n                } catch (final IOException e) {\r\n                    throw new IllegalStateException(\"unable to access [\" + path + \"]\", e);\r\n                }\r\n            }\r\n            for (Path path : environment.repoFiles()) {\r\n                addDirectoryPath(policy, Environment.PATH_REPO_SETTING.getKey(), path, \"read,readlink,write,delete\");\r\n            }\r\n        }\r\n```\r\n\r\nIMO this makes perfect sense - you only want to perform certain operations and throw exceptions on failure of them if the setup is right for it. I'm not sure why this wasn't happening in 5.x though - perhaps something in the installer changed? `/usr/share/elasticsearch` currently is owned by root:root.\r\n\r\nPlease let me know if I should submit a PR for it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347766554","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347766554","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347766554,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzc2NjU1NA==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T06:33:04Z","updated_at":"2017-11-29T06:33:04Z","author_association":"CONTRIBUTOR","body":"> To be clear here: this is what the default packaging does and it ensures that directory exists.\r\n\r\n@jasontedor How come 6.0 (using the deb installer) looks at `/usr/share/elasticsearch` ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347808037","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347808037","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347808037,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzgwODAzNw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T09:51:05Z","updated_at":"2017-11-29T09:51:05Z","author_association":"MEMBER","body":"> How come 6.0 (using the deb installer) looks at `/usr/share/elasticsearch` ?\r\n\r\nIt looks at `path.data` which is packaged to be `/var/lib/elasticsearch`. You have overridden this to not be set so it falls back to the default which is `ES_HOME/data`. Here, `ES_HOME` is `/usr/share/elasticsearch`. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347812889","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347812889","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347812889,"node_id":"MDEyOklzc3VlQ29tbWVudDM0NzgxMjg4OQ==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T10:09:08Z","updated_at":"2017-11-29T10:09:08Z","author_association":"CONTRIBUTOR","body":"Ok, so that is the change between 5.x and 6.x, thanks. Was that made on\npurpose?\n\n--\n\nItamar Syn-Hershko\nFreelance Developer & Consultant\nElasticsearch Partner\nMicrosoft MVP | Lucene.NET PMC\nhttp://code972.com | @synhershko <https://twitter.com/synhershko>\nhttp://BigDataBoutique.co.il/\n\nOn Wed, Nov 29, 2017 at 11:51 AM, Jason Tedor <notifications@github.com>\nwrote:\n\n> How come 6.0 (using the deb installer) looks at /usr/share/elasticsearch ?\n>\n> It looks at path.data which is packaged to be /var/lib/elasticsearch. You\n> have overridden this to not be set so it falls back to the default which is\n> ES_HOME/data. Here, ES_HOME is /usr/share/elasticsearch.\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347808037>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAM9HIxvlYZqI9eMzWpJN5M82stLxDaTks5s7Sk8gaJpZM4Qt1sl>\n> .\n>\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347848914","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347848914","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347848914,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzg0ODkxNA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T12:41:14Z","updated_at":"2017-11-29T12:41:14Z","author_association":"MEMBER","body":"Indirectly, yes. I think the relevant change is the removal of default settings (e.g., `default.path.data`, see #25408). The point is that in the past if you did not set `path.data` then we would fall back to `default.path.data`. The service scripts set `default.path.data` to `/var/lib/elasticsearch` which again the packages ensure exists so there's no problem when `path.data` is not set. Now when `path.data` is not set we fall back to `ES_HOME/data` instead which is different than the previous fallback.\r\n\r\n> Was that made on purpose?\r\n\r\nSince it's not clear to me we are talking about the same change until I clarified which change it is, I can't answer this question. What are you asking?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347888226","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347888226","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347888226,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzg4ODIyNg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T15:06:35Z","updated_at":"2017-11-29T15:06:35Z","author_association":"MEMBER","body":"@synhershko The fix you have proposed is not sufficient, it does not cover the case of master nodes. It also does not cover the case of coordinating-only nodes that do persist cluster state (`node.local_storage` defaults to true). And anyway, it makes this class node-aware which I do not want to do. I think I have a solution that I am happy with. I will open a PR later today.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347893847","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347893847","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347893847,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzg5Mzg0Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T15:23:53Z","updated_at":"2017-11-29T16:57:14Z","author_association":"MEMBER","body":"By the way, there is actually no bug in *your* case because you have not set `node.local_storage` to false (defaults to true). There is a bug in the case that `node.local_storage` is false. In this case we should not be trying to access `path.data` but I would go further and say that we should reject the settings if `node.local_storage` is false and `path.data` is set.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347896060","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347896060","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347896060,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzg5NjA2MA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T15:30:14Z","updated_at":"2017-11-29T15:30:14Z","author_association":"MEMBER","body":"I opened #27587.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347941577","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347941577","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347941577,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzk0MTU3Nw==","user":{"login":"synhershko","id":212252,"node_id":"MDQ6VXNlcjIxMjI1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/212252?v=4","gravatar_id":"","url":"https://api.github.com/users/synhershko","html_url":"https://github.com/synhershko","followers_url":"https://api.github.com/users/synhershko/followers","following_url":"https://api.github.com/users/synhershko/following{/other_user}","gists_url":"https://api.github.com/users/synhershko/gists{/gist_id}","starred_url":"https://api.github.com/users/synhershko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/synhershko/subscriptions","organizations_url":"https://api.github.com/users/synhershko/orgs","repos_url":"https://api.github.com/users/synhershko/repos","events_url":"https://api.github.com/users/synhershko/events{/privacy}","received_events_url":"https://api.github.com/users/synhershko/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T17:52:22Z","updated_at":"2017-11-29T17:52:22Z","author_association":"CONTRIBUTOR","body":"> By the way, there is actually no bug in your case because you have not set node.local_storage to false (defaults to true).\r\n\r\nSorry this should have been a comment here - I do want `node.local_storage` to be set to true on my client-only nodes, to persist cluster state (because, why not).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/347960334","html_url":"https://github.com/elastic/elasticsearch/issues/27572#issuecomment-347960334","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27572","id":347960334,"node_id":"MDEyOklzc3VlQ29tbWVudDM0Nzk2MDMzNA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-11-29T18:57:04Z","updated_at":"2017-11-29T18:57:04Z","author_association":"MEMBER","body":"> Sorry this should have been a comment here - I do want `node.local_storage` to be set to true on my client-only nodes, to persist cluster state (because, why not).\r\n\r\nRight, and like I say: there's no bug here for you then because we are going to ensure that `path.data` exists and we have permissions for them in this case then. You have a broken configuration, you need to set `path.data` to `/var/lib/elasticsearch` (as the packaging defaults to and ensure exists) or somewhere else where you are comfortable ensuring Elasticsearch can store data.\r\n\r\nThe only bug is when `node.local_storage` is false and `node.master` and `node.data` are false. That's addressed by #27587 now.","performed_via_github_app":null}]