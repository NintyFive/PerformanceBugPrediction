[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/36129116","html_url":"https://github.com/elastic/elasticsearch/issues/5141#issuecomment-36129116","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5141","id":36129116,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTI5MTE2","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"created_at":"2014-02-26T14:20:07Z","updated_at":"2014-02-26T14:20:07Z","author_association":"CONTRIBUTOR","body":"Any news about this issue?\n\nUsing new connection for every single request doesn't look like a good idea.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37322852","html_url":"https://github.com/elastic/elasticsearch/issues/5141#issuecomment-37322852","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5141","id":37322852,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzIyODUy","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"created_at":"2014-03-11T17:18:16Z","updated_at":"2014-03-11T17:18:16Z","author_association":"CONTRIBUTOR","body":"On 0.9.11 you could spot in logs:\n\n```\n[2014-03-11 21:14:54,830][DEBUG][action.deletebyquery     ] [Nick Fury] [elastica_test][0], node[v4P07UGDRMeJm8z-q3fWlg], [P], s[STARTED]: Failed to execute [delete_by_query {[elastica_test][], query [{\"query\":{\"query_string\":{\"query\":\"ian\"}}}]}]\norg.elasticsearch.index.query.QueryParsingException: [elastica_test] No query registered for [query]\n        at org.elasticsearch.index.query.QueryParseContext.parseInnerQuery(QueryParseContext.java:211)\n        at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:284)\n        at org.elasticsearch.index.query.IndexQueryParserService.parse(IndexQueryParserService.java:225)\n        at org.elasticsearch.index.shard.service.InternalIndexShard.prepareDeleteByQuery(InternalIndexShard.java:426)\n        at org.elasticsearch.action.deletebyquery.TransportShardDeleteByQueryAction.shardOperationOnPrimary(TransportShardDeleteByQueryAction.java:113)\n        at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction.performOnPrimary(TransportShardReplicationOperationAction.java:556)\n        at org.elasticsearch.action.support.replication.TransportShardReplicationOperationAction$AsyncShardOperationAction$1.run(TransportShardReplicationOperationAction.java:426)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:744)\n```\n\nAnd this is after:\n\n```\nsend($conn, $host, \"DELETE\", '/elastica_test/_query', array('q' => 'nicolas'));\n```\n\nwhere query is different. Clearly requests are messed up.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37325162","html_url":"https://github.com/elastic/elasticsearch/issues/5141#issuecomment-37325162","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5141","id":37325162,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzI1MTYy","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2014-03-11T17:36:21Z","updated_at":"2014-03-11T17:36:21Z","author_association":"MEMBER","body":"it doesn't seem like the delete by query relates to persistent http connections from the client? Maybe the client resets the connections on errors and it simply tries to reconnect and fail all the time?\n\nNote that the format of the body of delete by query changed between 0.90. and 1.0, maybe the failure is because of that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37325180","html_url":"https://github.com/elastic/elasticsearch/issues/5141#issuecomment-37325180","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5141","id":37325180,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzI1MTgw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-03-11T17:36:28Z","updated_at":"2014-03-11T17:36:28Z","author_association":"CONTRIBUTOR","body":"```\nsend($conn, $host, \"DELETE\", '/elastica_test/_query', array('q' => 'nicolas'));\n```\n\nJudging by your other request, that `q` is being sent in the body, not in the query string as it should be.\n\nAlternatively, you could do:\n\n```\nDELETE /elastica_test/_query\n{ \n    \"query_string\":  {\n        \"query\": \"nicholas\"\n    }\n}\n```\n\nAnd from 1.0 onwards:\n\n```\nDELETE /elastica_test/_query\n{ \n    \"query: {\n        \"query_string\":  {\n            \"query\": \"nicholas\"\n        }\n    }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37328991","html_url":"https://github.com/elastic/elasticsearch/issues/5141#issuecomment-37328991","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5141","id":37328991,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzI4OTkx","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"created_at":"2014-03-11T18:06:33Z","updated_at":"2014-03-11T18:06:33Z","author_association":"CONTRIBUTOR","body":"@clintongormley it's query string, body is the 6th parameter.\n\nHere is output for 1.0.0:\n\n```\nDELETE http://127.0.0.1:9200/elastica_test/?\n> {\"acknowledged\":true}\nPUT http://127.0.0.1:9200/elastica_test/? {\"index\":{\"number_of_shards\":1,\"number_of_replicas\":0}}\n> {\"acknowledged\":true}\nPUT http://127.0.0.1:9200/elastica_test/test/1? {\"name\":\"ruflin nicolas\"}\n> {\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"1\",\"_version\":1,\"created\":true}\nPUT http://127.0.0.1:9200/elastica_test/test/2? {\"name\":\"ruflin\"}\n> {\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"2\",\"_version\":1,\"created\":true}\nPUT http://127.0.0.1:9200/elastica_test/test/3? {\"name\":\"ian\"}\n> {\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"3\",\"_version\":1,\"created\":true}\nPOST http://127.0.0.1:9200/elastica_test/_refresh?\n> {\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0}}\nPOST http://127.0.0.1:9200/elastica_test/_search? {\"query\":{\"query_string\":{\"query\":\"ruflin*\"}}}\n> {\"took\":31,\"timed_out\":false,\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"hits\":{\"total\":2,\"max_score\":1.0,\"hits\":[{\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"1\",\"_score\":1.0, \"_source\" : {\"name\":\"ruflin nicolas\"}},{\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"2\",\"_score\":1.0, \"_source\" : {\"name\":\"ruflin\"}}]}}\nPOST http://127.0.0.1:9200/elastica_test/_search? {\"query\":{\"query_string\":{\"query\":\"nicolas\"}}}\n> {\"took\":3,\"timed_out\":false,\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":0.8784157,\"hits\":[{\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"1\",\"_score\":0.8784157, \"_source\" : {\"name\":\"ruflin nicolas\"}}]}}\nPOST http://127.0.0.1:9200/elastica_test/_search? {\"query\":{\"query_string\":{\"query\":\"ian\"}}}\n> {\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"hits\":{\"total\":1,\"max_score\":1.4054651,\"hits\":[{\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"3\",\"_score\":1.4054651, \"_source\" : {\"name\":\"ian\"}}]}}\nDELETE http://127.0.0.1:9200/elastica_test/_query?q=nicolas\n> {\"_indices\":{\"elastica_test\":{\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0}}}}\nPOST http://127.0.0.1:9200/elastica_test/_refresh?\n> {\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0}}\nPOST http://127.0.0.1:9200/elastica_test/_search? {\"query\":{\"query_string\":{\"query\":\"ruflin*\"}}}\n> {\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"hits\":{\"total\":2,\"max_score\":1.0,\"hits\":[{\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"1\",\"_score\":1.0, \"_source\" : {\"name\":\"ruflin nicolas\"}},{\"_index\":\"elastica_test\",\"_type\":\"test\",\"_id\":\"2\",\"_score\":1.0, \"_source\" : {\"name\":\"ruflin\"}}]}}\n```\n\n@kimchy there are no errors as you can see.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37330727","html_url":"https://github.com/elastic/elasticsearch/issues/5141#issuecomment-37330727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5141","id":37330727,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzMwNzI3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-03-11T18:19:35Z","updated_at":"2014-03-11T18:19:35Z","author_association":"CONTRIBUTOR","body":"@bobrik Sorry yes, I misread.\n\nThe curl docs say that if you plan on reusing the same connection for a GET after a POST, then you should reset it with CURLOPT_HTTPGET: http://curl.haxx.se/libcurl/c/curl_easy_setopt.html#CURLOPTHTTPGET\n\nI wonder if the same thing applies to a DELETE?\n\nPerhaps try it?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37333565","html_url":"https://github.com/elastic/elasticsearch/issues/5141#issuecomment-37333565","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5141","id":37333565,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MzMzNTY1","user":{"login":"bobrik","id":89186,"node_id":"MDQ6VXNlcjg5MTg2","avatar_url":"https://avatars0.githubusercontent.com/u/89186?v=4","gravatar_id":"","url":"https://api.github.com/users/bobrik","html_url":"https://github.com/bobrik","followers_url":"https://api.github.com/users/bobrik/followers","following_url":"https://api.github.com/users/bobrik/following{/other_user}","gists_url":"https://api.github.com/users/bobrik/gists{/gist_id}","starred_url":"https://api.github.com/users/bobrik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobrik/subscriptions","organizations_url":"https://api.github.com/users/bobrik/orgs","repos_url":"https://api.github.com/users/bobrik/repos","events_url":"https://api.github.com/users/bobrik/events{/privacy}","received_events_url":"https://api.github.com/users/bobrik/received_events","type":"User","site_admin":false},"created_at":"2014-03-11T18:42:04Z","updated_at":"2014-03-11T18:42:04Z","author_association":"CONTRIBUTOR","body":"I've put tcp proxy in the middle and found out that curl reused body from previous requests if they were not cleared explicitly. Gonna fix that it [ruflin/Elastica](https://github.com/ruflin/Elastica) then.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/37509746","html_url":"https://github.com/elastic/elasticsearch/issues/5141#issuecomment-37509746","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5141","id":37509746,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTA5NzQ2","user":{"login":"ruflin","id":244900,"node_id":"MDQ6VXNlcjI0NDkwMA==","avatar_url":"https://avatars3.githubusercontent.com/u/244900?v=4","gravatar_id":"","url":"https://api.github.com/users/ruflin","html_url":"https://github.com/ruflin","followers_url":"https://api.github.com/users/ruflin/followers","following_url":"https://api.github.com/users/ruflin/following{/other_user}","gists_url":"https://api.github.com/users/ruflin/gists{/gist_id}","starred_url":"https://api.github.com/users/ruflin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruflin/subscriptions","organizations_url":"https://api.github.com/users/ruflin/orgs","repos_url":"https://api.github.com/users/ruflin/repos","events_url":"https://api.github.com/users/ruflin/events{/privacy}","received_events_url":"https://api.github.com/users/ruflin/received_events","type":"User","site_admin":false},"created_at":"2014-03-13T08:33:57Z","updated_at":"2014-03-13T08:33:57Z","author_association":"CONTRIBUTOR","body":"@clintongormley Thanks for the input. It's good to learn something new every day ;-)\n","performed_via_github_app":null}]