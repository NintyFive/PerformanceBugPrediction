[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448944046","html_url":"https://github.com/elastic/elasticsearch/issues/36881#issuecomment-448944046","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36881","id":448944046,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODk0NDA0Ng==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T10:10:15Z","updated_at":"2018-12-20T10:10:15Z","author_association":"CONTRIBUTOR","body":"First observation is that this is a lot of indices. If possible it would make sense to reduce this number.\r\n\r\nLooks like the error is happening when attempting to update the cluster state which holds the mappings for all indices in the cluster. With dynamic mappings it is is possible that new documents can explode the set of fields associated with an index mapping although we have safeguards to limit the number of fields.\r\nWould it be possible to get a copy of your [cluster state](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-state.html) somehow?\r\nOr at least some indication of the size of this output.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448944140","html_url":"https://github.com/elastic/elasticsearch/issues/36881#issuecomment-448944140","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36881","id":448944140,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODk0NDE0MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T10:10:35Z","updated_at":"2018-12-20T10:10:35Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/449000967","html_url":"https://github.com/elastic/elasticsearch/issues/36881#issuecomment-449000967","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36881","id":449000967,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTAwMDk2Nw==","user":{"login":"FarmerLinT","id":46016262,"node_id":"MDQ6VXNlcjQ2MDE2MjYy","avatar_url":"https://avatars0.githubusercontent.com/u/46016262?v=4","gravatar_id":"","url":"https://api.github.com/users/FarmerLinT","html_url":"https://github.com/FarmerLinT","followers_url":"https://api.github.com/users/FarmerLinT/followers","following_url":"https://api.github.com/users/FarmerLinT/following{/other_user}","gists_url":"https://api.github.com/users/FarmerLinT/gists{/gist_id}","starred_url":"https://api.github.com/users/FarmerLinT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FarmerLinT/subscriptions","organizations_url":"https://api.github.com/users/FarmerLinT/orgs","repos_url":"https://api.github.com/users/FarmerLinT/repos","events_url":"https://api.github.com/users/FarmerLinT/events{/privacy}","received_events_url":"https://api.github.com/users/FarmerLinT/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T13:34:27Z","updated_at":"2018-12-20T13:34:27Z","author_association":"NONE","body":"Sorry, I can't give you a copy of our cluster state. The cluster state data size is 19MB.\r\n What do you mean by “some indication of the size of this output”. We use dynamic templates like that: \"dynamic_templates\":[{\"str\":{\"match\":\"*\",\"match_mapping_type\":\"string\",\"mapping\":{\"ignore_above\":\"32766\",\"index\":\"not_analyzed\",\"type\":\"keyword\"}}}].\r\nStackOverflowError happens not only  update the cluster state, but also during bulk insert data to cluster.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/449031062","html_url":"https://github.com/elastic/elasticsearch/issues/36881#issuecomment-449031062","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36881","id":449031062,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTAzMTA2Mg==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T15:14:06Z","updated_at":"2018-12-20T15:14:06Z","author_association":"CONTRIBUTOR","body":">What do you mean by “some indication of the size of this output”.\r\n\r\nIt's fine - I meant this:\r\n\r\n>The cluster state data size is 19MB.\r\n\r\nThat's not the biggest I've heard of. \r\n\r\n>StackOverflowError happens not only update the cluster state, but also during bulk insert data to cluster.\r\n\r\nA bulk insert of data can bring new fields which in turn will try update the cluster state. It's conceivable a \"poison document\" could have excessive nesting to produce an overflow e.g. \r\n\r\n    { foo1: { foo2:{ foo3:{ foo4: { foo5: {foo6: { foo7 ......\r\n\r\nDoes this seem likely? It will be hard to debug further without seeing the cluster state. Perhaps you can anonymise the field/index names by replacing them with numbers e.g a hash of the strings?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/460992041","html_url":"https://github.com/elastic/elasticsearch/issues/36881#issuecomment-460992041","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36881","id":460992041,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MDk5MjA0MQ==","user":{"login":"andrershov","id":600624,"node_id":"MDQ6VXNlcjYwMDYyNA==","avatar_url":"https://avatars1.githubusercontent.com/u/600624?v=4","gravatar_id":"","url":"https://api.github.com/users/andrershov","html_url":"https://github.com/andrershov","followers_url":"https://api.github.com/users/andrershov/followers","following_url":"https://api.github.com/users/andrershov/following{/other_user}","gists_url":"https://api.github.com/users/andrershov/gists{/gist_id}","starred_url":"https://api.github.com/users/andrershov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrershov/subscriptions","organizations_url":"https://api.github.com/users/andrershov/orgs","repos_url":"https://api.github.com/users/andrershov/repos","events_url":"https://api.github.com/users/andrershov/events{/privacy}","received_events_url":"https://api.github.com/users/andrershov/received_events","type":"User","site_admin":false},"created_at":"2019-02-06T11:33:58Z","updated_at":"2019-02-06T11:33:58Z","author_association":"CONTRIBUTOR","body":"No further feedback received. @FarmerLinT if you have the requested \r\ninformation please add it in a comment and we can look at re-opening \r\nthis issue.","performed_via_github_app":null}]