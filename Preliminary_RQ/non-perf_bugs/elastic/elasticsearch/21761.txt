{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21761","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21761/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21761/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21761/events","html_url":"https://github.com/elastic/elasticsearch/issues/21761","id":191353117,"node_id":"MDU6SXNzdWUxOTEzNTMxMTc=","number":21761,"title":"Wildcard query fails when one document has missing field","user":{"login":"xgp","id":244253,"node_id":"MDQ6VXNlcjI0NDI1Mw==","avatar_url":"https://avatars2.githubusercontent.com/u/244253?v=4","gravatar_id":"","url":"https://api.github.com/users/xgp","html_url":"https://github.com/xgp","followers_url":"https://api.github.com/users/xgp/followers","following_url":"https://api.github.com/users/xgp/following{/other_user}","gists_url":"https://api.github.com/users/xgp/gists{/gist_id}","starred_url":"https://api.github.com/users/xgp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xgp/subscriptions","organizations_url":"https://api.github.com/users/xgp/orgs","repos_url":"https://api.github.com/users/xgp/repos","events_url":"https://api.github.com/users/xgp/events{/privacy}","received_events_url":"https://api.github.com/users/xgp/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-11-23T18:48:39Z","updated_at":"2017-03-31T09:51:51Z","closed_at":"2017-03-31T09:51:51Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**: 5.0.1\r\n\r\n**Plugins installed**: [x-pack]\r\n\r\n**JVM version**: 1.8.0_102\r\n\r\n**OS version**: Linux version 3.16.0-55-generic (buildd@lgw01-42) (gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) ) \\#74~14.04.1-Ubuntu SMP Tue Nov 17 10:15:59 UTC 2015\r\n\r\n**Description of the problem including expected versus actual behavior**: When searching documents with a wildcard query, the query will fail if one document is inserted with an empty value for the field that is being searched. The expected behavior is that the same results will be returned, without the documents with the missing field.\r\n\r\n**Steps to reproduce**:\r\n 1. Index some documents:\r\n```\r\n$ curl --user elastic:changeme -XPUT \"http://localhost:9200/test/event/1\" -d'\r\n{\r\n  \"@timestamp\": \"2016-11-23T16:12:33.000+0000\",\r\n  \"name\": \"XYZ.abc.FAILURE\",\r\n  \"message\": \"test\"\r\n}'\r\n\r\n$ curl --user elastic:changeme -XPUT \"http://localhost:9200/test/event/2\" -d'\r\n{\r\n  \"@timestamp\": \"2016-11-23T15:12:33.000+0000\",\r\n  \"name\": \"ABC.xyz.SUCCESS\",\r\n  \"message\": \"test\"\r\n}'\r\n\r\n$ curl --user elastic:changeme -XPUT \"http://localhost:9200/test/event/3\" -d'\r\n{\r\n  \"@timestamp\": \"2016-11-23T15:12:33.000+0000\",\r\n  \"name\": \"ABC.xyz.FAILURE\",\r\n  \"message\": \"test\"\r\n}'\r\n```\r\n 2. Do a wildcard search on term 'name':\r\n```\r\n$ curl --user elastic:changeme -XGET \"http://localhost:9200/test/event/_search\" -d'\r\n{\r\n    \"query\": {\r\n        \"wildcard\" : { \"name.keyword\" : \"ABC*\" }\r\n    }\r\n}\r\n```\r\nWhich yields the results:\r\n```\r\n{\r\n  \"took\": 1,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 5,\r\n    \"successful\": 5,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": 2,\r\n    \"max_score\": 1,\r\n    \"hits\": [\r\n      {\r\n        \"_index\": \"test\",\r\n        \"_type\": \"event\",\r\n        \"_id\": \"2\",\r\n        \"_score\": 1,\r\n        \"_source\": {\r\n          \"@timestamp\": \"2016-11-23T15:12:33.000+0000\",\r\n          \"name\": \"ABC.xyz.FAILURE\",\r\n          \"message\": \"test\"\r\n        }\r\n      },\r\n      {\r\n        \"_index\": \"test\",\r\n        \"_type\": \"event\",\r\n        \"_id\": \"1\",\r\n        \"_score\": 1,\r\n        \"_source\": {\r\n          \"@timestamp\": \"2016-11-23T15:12:33.000+0000\",\r\n          \"name\": \"ABC.xyz.SUCCESS\",\r\n          \"message\": \"test\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n 3. Add one more document with missing field 'name':\r\n```\r\n$ curl --user elastic:changeme -XPUT \"http://localhost:9201/test/event/4\" -d'\r\n{\r\n  \"@timestamp\": \"2016-11-23T15:12:33.000+0000\",\r\n  \"message\": \"test\"\r\n}'\r\n```\r\n4. Repeat the search in \\#2 above. All the documents are returned.\r\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}