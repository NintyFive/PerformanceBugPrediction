{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53931","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53931/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53931/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53931/events","html_url":"https://github.com/elastic/elasticsearch/issues/53931","id":585681248,"node_id":"MDU6SXNzdWU1ODU2ODEyNDg=","number":53931,"title":"[CI] Transforms mixed cluster tests can fail in 7.x due to index.hidden attribute","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1789304462,"node_id":"MDU6TGFiZWwxNzg5MzA0NDYy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.7.0","name":"v7.7.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2020-03-22T09:57:07Z","updated_at":"2020-03-24T21:54:20Z","closed_at":"2020-03-24T21:54:20Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Since #53902 was merged there have been numerous failures of the `mixed_cluster/80_transform_jobs_crud/Test GET, start, and stop old cluster batch transforms` test in the X-Pack rolling upgrade tests.\r\n\r\nOne example is:\r\n\r\n* Build scan: https://gradle-enterprise.elastic.co/s/5z6xq7c75jkui\r\n* Jenkins: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+default-distro+bwc/BWC_VERSION=7.4.0,nodes=centos-7&&immutable/684/\r\n\r\nThe error is:\r\n\r\n```\r\nexpected [2xx] status code but api [data_frame_transform_deprecated.stop_transform] returned [409 Conflict] [{\"error\":{\"root_cause\":[{\"type\":\"status_exception\",\"reason\":\"Unable to stop data frame transform [old-simple-transform] as it is in a failed state with reason [Failed to create internal index mappings[java.lang.IllegalArgumentException: unknown setting [index.hidden] please check that any required plugins are installed, or check the breaking changes documentation for removed settings]]. Use force stop to stop the data frame transform.\",\"stack_trace\":\"ElasticsearchStatusException[Unable to stop data frame transform [old-simple-transform] as it is in a failed state with reason [Failed to create internal index mappings[java.lang.IllegalArgumentException: unknown setting [index.hidden] please check that any required plugins are installed, or check the breaking changes documentation for removed settings]]. Use force stop to stop the data frame transform.]\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.validateTaskState(TransportStopDataFrameTransformAction.java:96)\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.lambda$doExecute$0(TransportStopDataFrameTransformAction.java:125)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.xpack.dataframe.persistence.DataFrameTransformsConfigManager.lambda$expandTransformIds$9(DataFrameTransformsConfigManager.java:400)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:70)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.sendSearchResponse(AbstractSearchAsyncAction.java:309)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$3.run(FetchSearchPhase.java:217)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:180)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:174)\\n\\tat org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:119)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:180)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:174)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:210)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$2(FetchSearchPhase.java:104)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:110)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.access$000(FetchSearchPhase.java:44)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:86)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.base/java.lang.Thread.run(Thread.java:830)\\n\"}],\"type\":\"status_exception\",\"reason\":\"Unable to stop data frame transform [old-simple-transform] as it is in a failed state with reason [Failed to create internal index mappings[java.lang.IllegalArgumentException: unknown setting [index.hidden] please check that any required plugins are installed, or check the breaking changes documentation for removed settings]]. Use force stop to stop the data frame transform.\",\"stack_trace\":\"ElasticsearchStatusException[Unable to stop data frame transform [old-simple-transform] as it is in a failed state with reason [Failed to create internal index mappings[java.lang.IllegalArgumentException: unknown setting [index.hidden] please check that any required plugins are installed, or check the breaking changes documentation for removed settings]]. Use force stop to stop the data frame transform.]\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.validateTaskState(TransportStopDataFrameTransformAction.java:96)\\n\\tat org.elasticsearch.xpack.dataframe.action.TransportStopDataFrameTransformAction.lambda$doExecute$0(TransportStopDataFrameTransformAction.java:125)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.xpack.dataframe.persistence.DataFrameTransformsConfigManager.lambda$expandTransformIds$9(DataFrameTransformsConfigManager.java:400)\\n\\tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:62)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:70)\\n\\tat org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:64)\\n\\tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.sendSearchResponse(AbstractSearchAsyncAction.java:309)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$3.run(FetchSearchPhase.java:217)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:180)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:174)\\n\\tat org.elasticsearch.action.search.ExpandSearchPhase.run(ExpandSearchPhase.java:119)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executePhase(AbstractSearchAsyncAction.java:180)\\n\\tat org.elasticsearch.action.search.AbstractSearchAsyncAction.executeNextPhase(AbstractSearchAsyncAction.java:174)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.moveToNextPhase(FetchSearchPhase.java:210)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.lambda$innerRun$2(FetchSearchPhase.java:104)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.innerRun(FetchSearchPhase.java:110)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase.access$000(FetchSearchPhase.java:44)\\n\\tat org.elasticsearch.action.search.FetchSearchPhase$1.doRun(FetchSearchPhase.java:86)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:44)\\n\\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773)\\n\\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\\n\\tat java.base/java.lang.Thread.run(Thread.java:830)\\n\"},\"status\":409}]\r\n```\r\n\r\nThe important bit of that is obviously `Failed to create internal index mappings[java.lang.IllegalArgumentException: unknown setting [index.hidden] please check that any required plugins are installed, or check the breaking changes documentation for removed settings]`.\r\n\r\nIt's interesting that the other tests in that file haven't failed for the same reason.  This suggests that:\r\n\r\n1. This test only fails when it is randomly selected as the first one to run out of the tests in the same file\r\n2. If you create transform in a mixed version cluster before starting it then there is no problem, but if you start one that previously existed then you get this error\r\n\r\n/cc @gwbrown @jaymode in case this is a sign of a wider problem with the introduction of hidden indices and rolling upgrades","closed_by":{"login":"gwbrown","id":1522844,"node_id":"MDQ6VXNlcjE1MjI4NDQ=","avatar_url":"https://avatars1.githubusercontent.com/u/1522844?v=4","gravatar_id":"","url":"https://api.github.com/users/gwbrown","html_url":"https://github.com/gwbrown","followers_url":"https://api.github.com/users/gwbrown/followers","following_url":"https://api.github.com/users/gwbrown/following{/other_user}","gists_url":"https://api.github.com/users/gwbrown/gists{/gist_id}","starred_url":"https://api.github.com/users/gwbrown/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gwbrown/subscriptions","organizations_url":"https://api.github.com/users/gwbrown/orgs","repos_url":"https://api.github.com/users/gwbrown/repos","events_url":"https://api.github.com/users/gwbrown/events{/privacy}","received_events_url":"https://api.github.com/users/gwbrown/received_events","type":"User","site_admin":false},"performed_via_github_app":null}