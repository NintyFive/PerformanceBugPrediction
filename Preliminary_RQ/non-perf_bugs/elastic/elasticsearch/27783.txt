{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27783","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27783/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27783/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27783/events","html_url":"https://github.com/elastic/elasticsearch/issues/27783","id":281458122,"node_id":"MDU6SXNzdWUyODE0NTgxMjI=","number":27783,"title":"Ingest Pipelines not working after removing plugin","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"assignees":[{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2017-12-12T16:53:22Z","updated_at":"2018-03-08T23:29:41Z","closed_at":"2018-03-08T23:29:41Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.0\r\n\r\n**Plugins installed**: ingest-geoip\r\n\r\n**JVM version** (`java -version`): Any\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Any\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Install `ingest-geoip` plugin in Elasticsearch\r\n2. Create a pipeline like the one that shows here: https://www.elastic.co/guide/en/elasticsearch/plugins/6.0/using-ingest-geoip.html\r\n3. Create another simple pipeline [1]\r\n4. Stop Elasticsearch\r\n5. Remove the `ingest-geoip` plugin in Elasticsearch\r\n6. Start Elasticsearch\r\n7. Try to index a document [2]\r\n\r\n[1]\r\n```\r\nPUT _ingest/pipeline/my-pipeline-id\r\n{\r\n  \"description\" : \"describe pipeline\",\r\n  \"processors\" : [\r\n    {\r\n      \"set\" : {\r\n        \"field\": \"foo\",\r\n        \"value\": \"bar\"\r\n      }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n[2]\r\n```\r\nPOST index/test?pipeline=my-pipeline-id\r\n{\r\n  \"something\": true\r\n}\r\n```\r\n\r\nElasticsearch will return:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"illegal_argument_exception\",\r\n        \"reason\": \"pipeline with id [my-pipeline-id] does not exist\"\r\n      }\r\n    ],\r\n    \"type\": \"illegal_argument_exception\",\r\n    \"reason\": \"pipeline with id [my-pipeline-id] does not exist\"\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nIt seems to be that the problem is coming from the beginning when trying to apply the cluster state:\r\n\r\n```\r\n[2017-12-12T14:44:24,067][WARN ][o.e.c.s.ClusterApplierService] [_vjNi7c] failed to notify ClusterStateApplier\r\norg.elasticsearch.ElasticsearchParseException: No processor type exists with name [geoip]\r\n\tat org.elasticsearch.ingest.ConfigurationUtils.newConfigurationException(ConfigurationUtils.java:239) ~[elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessor(ConfigurationUtils.java:341) ~[elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.ingest.ConfigurationUtils.readProcessorConfigs(ConfigurationUtils.java:259) ~[elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.ingest.Pipeline$Factory.create(Pipeline.java:122) ~[elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.ingest.PipelineStore.innerUpdatePipelines(PipelineStore.java:82) ~[elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.ingest.PipelineStore.applyClusterState(PipelineStore.java:69) ~[elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService.lambda$callClusterStateAppliers$6(ClusterApplierService.java:495) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService$$Lambda$2050/1070007033.accept(Unknown Source) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat java.lang.Iterable.forEach(Iterable.java:75) [?:1.8.0_45]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService.callClusterStateAppliers(ClusterApplierService.java:492) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService.applyChanges(ClusterApplierService.java:479) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService.runTask(ClusterApplierService.java:429) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.cluster.service.ClusterApplierService$UpdateTask.run(ClusterApplierService.java:158) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:569) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:247) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:210) [elasticsearch-6.0.0.jar:6.0.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_45]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_45]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_45]\r\n```\r\n","closed_by":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}