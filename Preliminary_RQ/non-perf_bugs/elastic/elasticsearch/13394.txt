{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13394","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13394/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13394/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13394/events","html_url":"https://github.com/elastic/elasticsearch/issues/13394","id":105372658,"node_id":"MDU6SXNzdWUxMDUzNzI2NTg=","number":13394,"title":"inner hits: huge number in \"size\" makes node go OOM even with very few docs","user":{"login":"brwe","id":4320215,"node_id":"MDQ6VXNlcjQzMjAyMTU=","avatar_url":"https://avatars0.githubusercontent.com/u/4320215?v=4","gravatar_id":"","url":"https://api.github.com/users/brwe","html_url":"https://github.com/brwe","followers_url":"https://api.github.com/users/brwe/followers","following_url":"https://api.github.com/users/brwe/following{/other_user}","gists_url":"https://api.github.com/users/brwe/gists{/gist_id}","starred_url":"https://api.github.com/users/brwe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brwe/subscriptions","organizations_url":"https://api.github.com/users/brwe/orgs","repos_url":"https://api.github.com/users/brwe/repos","events_url":"https://api.github.com/users/brwe/events{/privacy}","received_events_url":"https://api.github.com/users/brwe/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-09-08T12:43:53Z","updated_at":"2018-02-14T13:26:40Z","closed_at":"2015-09-09T11:14:11Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"spin off from https://discuss.elastic.co/t/difficulty-in-formulating-query-for-my-usecase/28773/4\n\nThe below example will make elasticsearch 1.7.1 OOM. I assume this is similar to https://github.com/elastic/elasticsearch/issues/12510 ?\n\n```\n\nDELETE testidx\n\nPUT testidx\n{\n  \"mappings\": {\n    \"doc\": {\n      \"properties\": {\n        \"inner_hits\": {\n          \"type\": \"nested\"\n        }\n      }\n    }\n  }\n}\n\nPOST testidx/doc\n{\n  \"Language\": [\n    \"English\"\n  ],\n  \"Tags\": [\n    \"MT\",\n    \"MUMBAI\",\n    \"CHEN\"\n  ],\n  \"_boost\": 3,\n  \"inner_hits\": [\n    {\n      \"Code\": \"ET00009709\",\n      \"IsDefault\": \"\",\n      \"Language\": \"English\",\n      \"Format\": \"3D\",\n      \"Region\": \"MUMBAI\"\n    },\n    {\n      \"Code\": \"ET00009710\",\n      \"IsDefault\": \"Y\",\n      \"Language\": \"English\",\n      \"Format\": \"2D\",\n      \"Region\": \"CHEN\"\n    },\n    {\n      \"Code\": \"ET00009713\",\n      \"IsDefault\": \"\",\n      \"Language\": \"Hindi\",\n      \"Format\": \"2D\",\n      \"Region\": \"MUMBAI\"\n    },\n    {\n      \"Code\": \"ET00009714\",\n      \"IsDefault\": \"\",\n      \"Language\": \"Tamil\",\n      \"Format\": \"3D\",\n      \"Region\": \"MUMBAI\"\n    },\n    {\n      \"Code\": \"ET00009715\",\n      \"IsDefault\": \"\",\n      \"Language\": \"Hindi\",\n      \"Format\": \"3D\",\n      \"Region\": \"MUMBAI\"\n    },\n    {\n      \"Code\": \"ET00009716\",\n      \"IsDefault\": \"\",\n      \"Language\": \"Bengali\",\n      \"Format\": \"2D\",\n      \"Region\": \"MUMBAI\"\n    }\n  ]\n}\n\nPOST testidx/_search\n{\n  \"fields\": [], \n  \"query\": {\n    \"nested\": {\n      \"path\": \"inner_hits\",\n      \"query\": {\n        \"match\": {\n          \"Region\": \"MUMBAI\"\n        }\n      },\n      \"inner_hits\": {\n        \"size\": 100000000\n      }\n    }\n  }\n}\n\n```\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}