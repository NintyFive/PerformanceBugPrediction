[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/307984","html_url":"https://github.com/elastic/elasticsearch/issues/136#issuecomment-307984","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/136","id":307984,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzk4NA==","user":{"login":"mootpointer","id":126967,"node_id":"MDQ6VXNlcjEyNjk2Nw==","avatar_url":"https://avatars2.githubusercontent.com/u/126967?v=4","gravatar_id":"","url":"https://api.github.com/users/mootpointer","html_url":"https://github.com/mootpointer","followers_url":"https://api.github.com/users/mootpointer/followers","following_url":"https://api.github.com/users/mootpointer/following{/other_user}","gists_url":"https://api.github.com/users/mootpointer/gists{/gist_id}","starred_url":"https://api.github.com/users/mootpointer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mootpointer/subscriptions","organizations_url":"https://api.github.com/users/mootpointer/orgs","repos_url":"https://api.github.com/users/mootpointer/repos","events_url":"https://api.github.com/users/mootpointer/events{/privacy}","received_events_url":"https://api.github.com/users/mootpointer/received_events","type":"User","site_admin":false},"created_at":"2010-07-12T00:12:05Z","updated_at":"2010-07-12T00:12:05Z","author_association":"NONE","body":"I'm also seeing these issues using master. I have 30 shards for my index, and I'm only getting 10 successfully responding on the first request, and sometimes none as things continue. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/316073","html_url":"https://github.com/elastic/elasticsearch/issues/136#issuecomment-316073","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/136","id":316073,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNjA3Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2010-07-17T11:28:52Z","updated_at":"2010-07-17T11:28:52Z","author_association":"CONTRIBUTOR","body":"Yep - scrolling is still broken\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/566243","html_url":"https://github.com/elastic/elasticsearch/issues/136#issuecomment-566243","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/136","id":566243,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjI0Mw==","user":{"login":"otisg","id":332580,"node_id":"MDQ6VXNlcjMzMjU4MA==","avatar_url":"https://avatars2.githubusercontent.com/u/332580?v=4","gravatar_id":"","url":"https://api.github.com/users/otisg","html_url":"https://github.com/otisg","followers_url":"https://api.github.com/users/otisg/followers","following_url":"https://api.github.com/users/otisg/following{/other_user}","gists_url":"https://api.github.com/users/otisg/gists{/gist_id}","starred_url":"https://api.github.com/users/otisg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/otisg/subscriptions","organizations_url":"https://api.github.com/users/otisg/orgs","repos_url":"https://api.github.com/users/otisg/repos","events_url":"https://api.github.com/users/otisg/events{/privacy}","received_events_url":"https://api.github.com/users/otisg/received_events","type":"User","site_admin":false},"created_at":"2010-11-25T10:17:52Z","updated_at":"2010-11-25T10:17:52Z","author_association":"NONE","body":"Same here.  I'm wondering if Shay can give us a hint about the ETA for this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/571795","html_url":"https://github.com/elastic/elasticsearch/issues/136#issuecomment-571795","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/136","id":571795,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTc5NQ==","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2010-11-28T23:32:48Z","updated_at":"2010-11-28T23:32:48Z","author_association":"MEMBER","body":"I am going to push for getting scrolling working properly for 0.14.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/571841","html_url":"https://github.com/elastic/elasticsearch/issues/136#issuecomment-571841","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/136","id":571841,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTg0MQ==","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2010-11-29T00:06:03Z","updated_at":"2010-11-29T00:06:03Z","author_association":"MEMBER","body":"Scrolling issues, fix releasing search context eagerly, they should not be released when scrolling, closed by 84f97e96a5e415a5af6ce452e3797f17242b994a.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/597523","html_url":"https://github.com/elastic/elasticsearch/issues/136#issuecomment-597523","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/136","id":597523,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NzUyMw==","user":{"login":"tpoljak","id":363541,"node_id":"MDQ6VXNlcjM2MzU0MQ==","avatar_url":"https://avatars0.githubusercontent.com/u/363541?v=4","gravatar_id":"","url":"https://api.github.com/users/tpoljak","html_url":"https://github.com/tpoljak","followers_url":"https://api.github.com/users/tpoljak/followers","following_url":"https://api.github.com/users/tpoljak/following{/other_user}","gists_url":"https://api.github.com/users/tpoljak/gists{/gist_id}","starred_url":"https://api.github.com/users/tpoljak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tpoljak/subscriptions","organizations_url":"https://api.github.com/users/tpoljak/orgs","repos_url":"https://api.github.com/users/tpoljak/repos","events_url":"https://api.github.com/users/tpoljak/events{/privacy}","received_events_url":"https://api.github.com/users/tpoljak/received_events","type":"User","site_admin":false},"created_at":"2010-12-08T17:51:07Z","updated_at":"2010-12-08T17:57:33Z","author_association":"NONE","body":"I've tested scrolling through the whole result set (for updating results) on latest master (elasticsearch-0.14.0-SNAPSHOT, built date 2010-12-08) and scrolling issue doesn't seem fixed (to me). Here is the problem reconstruction:\n1. Index documents with the following code:\n   \n   ```\n   for (int i = 0; i < 500; i++) {\n       IndexResponse response = client.prepareIndex(\"twitter\", \"tweet\", Integer.toString(i)).setSource(\n               jsonBuilder().startObject().field(\"user\", \"kimchy\").field(\"postDate\", new Date().getTime()).field(\"message\",\n                       \"trying out Elastic Search\").endObject()).execute().actionGet();\n   }\n   ```\n2. Check the number of indexed documents for query q=user:kimchy'\n   \n   ```\n   curl -XGET 'http://localhost:9200/twitter/tweet/_count?q=user:kimchy'\n   ```\n   \n   {\"count\":500,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0}}\n3. Scroll through the result set for the same query (q=user:kimchy') and update documents with code below:\n   \n   ```\n   SearchResponse searchResponse = client.prepareSearch()\n   .setQuery(queryString(\"user:kimchy\"))\n   .setSize(35)\n   .setScroll(TimeValue.timeValueMinutes(2))\n   .addSort(\"postDate\", SortOrder.ASC)\n   .execute().actionGet();\n   \n   do {\n       for (SearchHit searchHit : searchResponse.hits().hits()) {\n           Map<String, Object> map = searchHit.sourceAsMap();\n           map.put(\"message\", \"test\");\n           client.index(indexRequest(\"twitter\").type(\"tweet\").id(searchHit.getId()).source(map)).actionGet();\n       }\n       searchResponse = client.prepareSearchScroll(searchResponse.scrollId()).setScroll(TimeValue.timeValueMinutes(2))\n               .execute().actionGet();\n   } while (searchResponse.hits().hits().length > 0);\n   ```\n4. Check the number of updated docs\n\nOnce it was: \n        curl -XGET 'http://localhost:9200/twitter/tweet/_count?q=message:test'\n{\"count\":429,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0}}\n\nSecond time was: \n        curl -XGET 'http://localhost:9200/twitter/tweet/_count?q=message:test'\n{\"count\":466,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0}}\n\netc. (different number of updated documents on each try). Am I'm doing something wrong or is scrolling issue still not fixed?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/597709","html_url":"https://github.com/elastic/elasticsearch/issues/136#issuecomment-597709","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/136","id":597709,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NzcwOQ==","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2010-12-08T18:58:25Z","updated_at":"2010-12-08T18:58:25Z","author_association":"MEMBER","body":"Hey, added exactly the same test to the test suite I have, and it seems to work: https://github.com/elasticsearch/elasticsearch/commit/e1495ff8be7c9c90ba13c330e15920aea6610ab5.\n\nObviously, you are getting this, trying to think of the best way to recreate the same thing you are getting. Maybe you can mail me the Java env/project test case you have? And I will run it?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/597954","html_url":"https://github.com/elastic/elasticsearch/issues/136#issuecomment-597954","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/136","id":597954,"node_id":"MDEyOklzc3VlQ29tbWVudDU5Nzk1NA==","user":{"login":"tpoljak","id":363541,"node_id":"MDQ6VXNlcjM2MzU0MQ==","avatar_url":"https://avatars0.githubusercontent.com/u/363541?v=4","gravatar_id":"","url":"https://api.github.com/users/tpoljak","html_url":"https://github.com/tpoljak","followers_url":"https://api.github.com/users/tpoljak/followers","following_url":"https://api.github.com/users/tpoljak/following{/other_user}","gists_url":"https://api.github.com/users/tpoljak/gists{/gist_id}","starred_url":"https://api.github.com/users/tpoljak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tpoljak/subscriptions","organizations_url":"https://api.github.com/users/tpoljak/orgs","repos_url":"https://api.github.com/users/tpoljak/repos","events_url":"https://api.github.com/users/tpoljak/events{/privacy}","received_events_url":"https://api.github.com/users/tpoljak/received_events","type":"User","site_admin":false},"created_at":"2010-12-08T20:21:11Z","updated_at":"2010-12-08T20:25:49Z","author_association":"NONE","body":"Hey Kimchy,\nI think I've figured out the problem. First I was testing without sort param (without SortOrder.ASC on \"postDate\"), I executed index function manually:\n\n```\nprivate void index() throws IOException {\n    for (int i = 0; i < 500; i++) {\n        IndexResponse response = client.prepareIndex(\"twitter\", \"tweet\", Integer.toString(i)).setSource(\n                jsonBuilder().startObject().field(\"user\", \"kimchy\").field(\"postDate\", new Date()).field(\"message\",\n                        \"trying out Elastic Search\").endObject()).execute().actionGet();\n    }\n}\n```\n\nand executed later manually \n    private void scrollUpdate() {\n\n```\n    SearchResponse searchResponse = client.prepareSearch()\n    .setQuery(queryString(\"user:kimchy\"))\n    .setSize(35)\n    .setScroll(TimeValue.timeValueMinutes(2))\n    .execute().actionGet();\n\n    do {\n        for (SearchHit searchHit : searchResponse.hits().hits()) {\n            Map<String, Object> map = searchHit.sourceAsMap();\n            map.put(\"message\", \"simple\");\n            client.index(indexRequest(\"twitter\").type(\"tweet\").id(searchHit.getId()).source(map)).actionGet();\n        }\n        searchResponse = client.prepareSearchScroll(searchResponse.scrollId()).setScroll(TimeValue.timeValueMinutes(2))\n                .execute().actionGet();\n    } while (searchResponse.hits().hits().length > 0);\n\n}\n```\n\nand this doesn't update all docs (seems like similar problem as in paginate 'from' param workaround -> without a sort not all docs get updated for a query).\n\nLater I introduced new Date().getTime() in indexing function (so I can sort on it) and added .addSort(\"postDate\", SortOrder.ASC) in a scroll query, but unfortunately at the same time I introduced an automatism in testing where in test function I call:\n\n```\n    index();\n    scrollUpdate();\n```\n\none after other without 1 sec delay or index.refresh() and this is what produced problems same/similar as when scroll was broken (last documents from index phase did not become 'visible' before scroll update started)\n\nAfter adding \n\n```\n    index();\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    scrollUpdate();\n```\n\nor \n\n```\n    index();\n    client.admin().indices().prepareRefresh().execute().actionGet();\n    scrollUpdate();\n```\n\nand having a sort field added to scroll request everything seems to work correctly. Sorry for my mistake in testing :)\n","performed_via_github_app":null}]