{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50033","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50033/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50033/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50033/events","html_url":"https://github.com/elastic/elasticsearch/issues/50033","id":535773417,"node_id":"MDU6SXNzdWU1MzU3NzM0MTc=","number":50033,"title":"[Transform] improve placement of transform task targetting a remote index","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"labels":[{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":929267538,"node_id":"MDU6TGFiZWw5MjkyNjc1Mzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/team-discuss","name":"team-discuss","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2019-12-10T14:40:28Z","updated_at":"2020-03-02T08:01:19Z","closed_at":"2020-03-02T08:01:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Transform supports CCS indexes starting with 7.6.\r\n\r\n## The problem\r\n\r\nA transform using remote source requires `cluster.remote.connect:true` (default) to execute search queries, if `cluster.remote.connect:false` is set on a node the transform will fail. \r\n\r\nTransform validation will disallow preview/create if `cluster.remote.connect:false` is set to false on the executing node, assuming the situation is the same for all nodes.\r\n\r\nHowever, `cluster.remote.connect` is a node setting. Worst-case a user has a mixed environment with some nodes enabled and some not. In this case p-task placement is unable to find out and can not choose a data node that has CCS support and validation might fail or not.\r\n\r\nThe problem applies not only to transform but also to ML, see #46025.\r\n\r\n## The workaround: Known Limitation\r\n\r\nFor #43201 this issue is out of scope, in order to use transform CCS you must have remote-support enabled on all data and the master node.\r\n\r\nIn case remote is disabled on the executing node transform will fail at start with a descriptive error.\r\n\r\n## A possible Solution: node attributes\r\n\r\nWhether `cluster.remote.connect` is `true` or `false` can not be retrieved from cluster state. A nodeinfo call would be possible, but calls all nodes in the cluster and is therefore not considered as an option.\r\n\r\nSimilar to the ML plugin, we could use node attributes which are available in cluster state. A special attribute could be set if `cluster.remote.connect:false` at the start of the node, e.g. as part of x-pack core (all features that require remote aware placement are part of x-pack, ignoring that CCS is a core feature (OSS)).\r\n\r\n## Other solutions\r\n\r\n@elastic/es-search any ideas? comments?","closed_by":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"performed_via_github_app":null}