{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9250","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9250/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9250/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9250/events","html_url":"https://github.com/elastic/elasticsearch/issues/9250","id":54043904,"node_id":"MDU6SXNzdWU1NDA0MzkwNA==","number":9250,"title":"unicast zen.discovery fails for a specific host","user":{"login":"wsw70","id":1345886,"node_id":"MDQ6VXNlcjEzNDU4ODY=","avatar_url":"https://avatars2.githubusercontent.com/u/1345886?v=4","gravatar_id":"","url":"https://api.github.com/users/wsw70","html_url":"https://github.com/wsw70","followers_url":"https://api.github.com/users/wsw70/followers","following_url":"https://api.github.com/users/wsw70/following{/other_user}","gists_url":"https://api.github.com/users/wsw70/gists{/gist_id}","starred_url":"https://api.github.com/users/wsw70/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wsw70/subscriptions","organizations_url":"https://api.github.com/users/wsw70/orgs","repos_url":"https://api.github.com/users/wsw70/repos","events_url":"https://api.github.com/users/wsw70/events{/privacy}","received_events_url":"https://api.github.com/users/wsw70/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-01-12T11:34:09Z","updated_at":"2015-01-12T16:44:52Z","closed_at":"2015-01-12T16:39:52Z","author_association":"NONE","active_lock_reason":null,"body":"This is the replica of [a question on stackoverflow.com](http://stackoverflow.com/questions/27863179/elasticsearch-server-status-503-discovery-fails) which in fact may be a bug.\n\nThe machine which does not want to join has two NICs.\n\nI am building a cluster of nodes. Two work fine (they are joined into a cluster), I am trying to add a third one (called `eu5`) and while it starts, it does not join the cluster:\n\n```\n[root@eu5:/etc/elasticsearch]# curl eu5:9200\n{\n  \"status\" : 503,\n  \"name\" : \"eu5\",\n  \"cluster_name\" : \"security\",\n  \"version\" : {\n    \"number\" : \"1.4.2\",\n    \"build_hash\" : \"927caff6f05403e936c20bf4529f144f0c89fd8c\",\n    \"build_timestamp\" : \"2014-12-16T14:11:12Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.10.2\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n\nThe logs mention a problem with discovery:\n\n```\n[2015-01-09 15:35:23,399][INFO ][node                     ] [eu5] starting ...\n[2015-01-09 15:35:23,468][INFO ][transport                ] [eu5] bound_address {inet[/10.81.147.186:9300]}, publish_address {inet[/10.81.147.186:9300]}\n[2015-01-09 15:35:23,475][INFO ][discovery                ] [eu5] security/FdjfWCWgT-mQtipLdi9BFA\n[2015-01-09 15:35:53,476][WARN ][discovery                ] [eu5] waited for 30s and no initial state was set by the discovery\n[2015-01-09 15:35:53,493][INFO ][http                     ] [eu5] bound_address {inet[/10.81.147.186:9200]}, publish_address {inet[/10.81.147.186:9200]}\n[2015-01-09 15:35:53,494][INFO ][node                     ] [eu5] started\n```\n\nThe configuration forces unicast\n\n```\ncluster.name: security\nnode.name: eu5\nnetwork.host: 10.81.147.186\ndiscovery.zen.minimum_master_nodes: 2\ndiscovery.zen.ping.multicast.enabled: false\ndiscovery.zen.ping.unicast: [\"elk.example.com\"]\n```\n\nand the hint server is available from the one I want to join:\n\n```\n[root@eu5:/etc/elasticsearch]# curl elk.example.com:9200\n{\n  \"status\" : 200,\n  \"name\" : \"eu4\",\n  \"cluster_name\" : \"security\",\n  \"version\" : {\n    \"number\" : \"1.4.2\",\n    \"build_hash\" : \"927caff6f05403e936c20bf4529f144f0c89fd8c\",\n    \"build_timestamp\" : \"2014-12-16T14:11:12Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.10.2\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n\nThe 9200 and 9300 ports are available both ways, from the server I want to join\n\n```\n[root@eu5:/etc/elasticsearch]# nmap -p9200,9300 elk.example.com\n(...)\nPORT     STATE SERVICE\n9200/tcp open  wap-wsp\n9300/tcp open  vrace\n```\n\nas well as from the master to that server\n\n```\n[root@eu4:/etc/elasticsearch]#  nmap -p9200,9300 eu5.example.com\n(...)\nPORT     STATE SERVICE\n9200/tcp open  wap-wsp\n9300/tcp open  vrace\n```\n\nIs there anything else I should check? \n\n**UPDATE**: Following [Andrei Stefan](http://stackoverflow.com/users/3498062/andrei-stefan)'s comments I switch to `DEBUG` for the logging. I get lines such as \n\n```\n[2015-01-12 11:14:41,609][DEBUG][discovery.zen            ] [eu5] filtered ping responses: (filter_client[true], filter_data[false]) {none}\n[2015-01-12 11:14:44,615][DEBUG][discovery.zen            ] [eu5] filtered ping responses: (filter_client[true], filter_data[false]) {none}\n```\n\nduring the discovery phase (the 30 seconds after which there is a timeout). A quick glance at [the code](https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java#L987) (I do not know Java, though) seems to indicate that the `{none}` means that ping failed.\n\nThe tests I did above indicate that, **from the OS perspective**, the connectivity is OK.\n\n**UPDATE 2**: below is the `tcpdump` corresponding to the events above (`eu5`, the machine which wants to join is `10.81.144.186`)\n\n![enter image description here](http://i.stack.imgur.com/vLi7r.png)\n\nFull image: http://i.stack.imgur.com/vLi7r.png\n","closed_by":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"performed_via_github_app":null}