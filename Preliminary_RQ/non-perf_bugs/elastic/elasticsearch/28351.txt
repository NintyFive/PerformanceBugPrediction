{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28351","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28351/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28351/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28351/events","html_url":"https://github.com/elastic/elasticsearch/issues/28351","id":291080357,"node_id":"MDU6SXNzdWUyOTEwODAzNTc=","number":28351,"title":"IllegalStateException on data nodes when upgrading 5.6.5 to 6.1.1","user":{"login":"yawboateng","id":17864529,"node_id":"MDQ6VXNlcjE3ODY0NTI5","avatar_url":"https://avatars1.githubusercontent.com/u/17864529?v=4","gravatar_id":"","url":"https://api.github.com/users/yawboateng","html_url":"https://github.com/yawboateng","followers_url":"https://api.github.com/users/yawboateng/followers","following_url":"https://api.github.com/users/yawboateng/following{/other_user}","gists_url":"https://api.github.com/users/yawboateng/gists{/gist_id}","starred_url":"https://api.github.com/users/yawboateng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yawboateng/subscriptions","organizations_url":"https://api.github.com/users/yawboateng/orgs","repos_url":"https://api.github.com/users/yawboateng/repos","events_url":"https://api.github.com/users/yawboateng/events{/privacy}","received_events_url":"https://api.github.com/users/yawboateng/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2018-01-24T04:23:28Z","updated_at":"2018-02-20T03:40:16Z","closed_at":"2018-01-24T10:38:21Z","author_association":"NONE","active_lock_reason":null,"body":"So i was running 5.4, upgraded that to 5.6.5 (the official docker image on top of kubernetes), and used the migration assistant from the kibana ui to migrate the indexes but after upgrading the cluster to 6.1.1, the container is in a crash loop with the following logs:\r\n\r\n```\r\n[2018-01-24T04:35:44,015][ERROR][o.e.g.GatewayMetaState   ] [sJP3p8k] failed to read local state, exiting...\r\njava.lang.IllegalStateException: index and alias names need to be unique, but the following duplicates were found [.watches (alias of [.watches-6/FbLIamfiTieF8hzOKJWbpQ])]\r\n\tat org.elasticsearch.cluster.metadata.MetaData$Builder.build(MetaData.java:1032) ~[elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.gateway.MetaStateService.loadFullState(MetaStateService.java:73) ~[elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.gateway.GatewayMetaState.<init>(GatewayMetaState.java:92) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) [?:1.8.0_151]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) [?:1.8.0_151]\r\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) [?:1.8.0_151]\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423) [?:1.8.0_151]\r\n\tat org.elasticsearch.common.inject.DefaultConstructionProxyFactory$1.newInstance(DefaultConstructionProxyFactory.java:49) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ConstructorInjector.construct(ConstructorInjector.java:86) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:116) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter$1.call(ProviderToInternalFactoryAdapter.java:47) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:825) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:43) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.Scopes$1$1.get(Scopes.java:59) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:50) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.SingleParameterInjector.inject(SingleParameterInjector.java:42) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.SingleParameterInjector.getAll(SingleParameterInjector.java:66) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ConstructorInjector.construct(ConstructorInjector.java:85) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:116) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter$1.call(ProviderToInternalFactoryAdapter.java:47) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:825) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:43) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.Scopes$1$1.get(Scopes.java:59) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:50) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorBuilder$1.call(InjectorBuilder.java:191) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorBuilder$1.call(InjectorBuilder.java:183) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorImpl.callInContext(InjectorImpl.java:818) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorBuilder.loadEagerSingletons(InjectorBuilder.java:183) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorBuilder.loadEagerSingletons(InjectorBuilder.java:173) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorBuilder.injectDynamically(InjectorBuilder.java:161) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.InjectorBuilder.build(InjectorBuilder.java:96) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.Guice.createInjector(Guice.java:96) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.Guice.createInjector(Guice.java:70) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.common.inject.ModulesBuilder.createInjector(ModulesBuilder.java:42) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:499) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.node.Node.<init>(Node.java:245) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.bootstrap.Bootstrap$5.<init>(Bootstrap.java:233) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:233) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:342) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:132) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:123) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:70) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:134) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.cli.Command.main(Command.java:90) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:91) [elasticsearch-5.6.5.jar:5.6.5]\r\n\tat org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:84) [elasticsearch-5.6.5.jar:5.6.5]\r\n[2018-01-24T04:35:44,277][ERROR][o.e.g.GatewayMetaState   ] [sJP3p8k] failed to read local state, exiting...\r\n```\r\n\r\nNote: i have the basic license and do not use watcher. is there a way to recover from this state without losing any data? ","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}