{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9878","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9878/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9878/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9878/events","html_url":"https://github.com/elastic/elasticsearch/issues/9878","id":58898163,"node_id":"MDU6SXNzdWU1ODg5ODE2Mw==","number":9878,"title":"NullPointerException on scroll where initial query with geohash_grid aggrigations","user":{"login":"estin","id":520814,"node_id":"MDQ6VXNlcjUyMDgxNA==","avatar_url":"https://avatars3.githubusercontent.com/u/520814?v=4","gravatar_id":"","url":"https://api.github.com/users/estin","html_url":"https://github.com/estin","followers_url":"https://api.github.com/users/estin/followers","following_url":"https://api.github.com/users/estin/following{/other_user}","gists_url":"https://api.github.com/users/estin/gists{/gist_id}","starred_url":"https://api.github.com/users/estin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/estin/subscriptions","organizations_url":"https://api.github.com/users/estin/orgs","repos_url":"https://api.github.com/users/estin/repos","events_url":"https://api.github.com/users/estin/events{/privacy}","received_events_url":"https://api.github.com/users/estin/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2015-02-25T13:04:13Z","updated_at":"2015-08-16T11:04:03Z","closed_at":"2015-08-16T11:03:56Z","author_association":"NONE","active_lock_reason":null,"body":"start elasticsearch in docker\n\n```\nsudo docker run -p 9200:9200 -p 9300:9300 -v `pwd`/esdata:/data dockerfile/elasticsearch /elasticsearch/bin/elasticsearch\n```\n\ncheck elasticsearch version in output\n\nscript\n\n```\n#!/bin/bash\necho 'version'\ncurl -XGET 'http://localhost:9200' | python -mjson.tool\n\necho;\ncurl -XDELETE 'http://localhost:9200/places'\nsleep 1;\ncurl -XPOST 'http://localhost:9200/places' -d'{\n    \"mappings\": {\n        \"place\": {\n            \"_id\": {\n                \"path\": \"id\"\n            },\n            \"properties\": {\n                \"id\": {\"type\": \"long\"},\n                \"name\": {\"type\": \"string\"},\n                \"alias\": {\"type\": \"string\"},\n                \"location\": {\n                    \"type\": \"geo_point\",\n                    \"geohash\": true,\n                    \"geohash_prefix\": true,\n                    \"geohash_precision\": 1\n                },\n                \"popup\": {\n                    \"type\": \"object\",\n                    \"properties\": {\n                        \"name\": {\"type\": \"string\"},\n                        \"alias\": {\"type\": \"string\"}\n                    }\n                }\n            }\n        }\n    }\n}\n'\ncurl -XPOST 'http://localhost:9200/places/_refresh'\n\necho;\necho 'bulk create documents'\ncurl -XPOST 'http://localhost:9200/_bulk?refresh=true' -d '{\"index\": {\"_type\": \"place\", \"_id\": 1455, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place0\", \"name\": \"place0\"}, \"alias\": \"place0\", \"location\": {\"lat\": 41.101, \"lon\": 41.1}, \"id\": 1455, \"name\": \"place0\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1456, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place1\", \"name\": \"place1\"}, \"alias\": \"place1\", \"location\": {\"lat\": 41.101, \"lon\": 41.1}, \"id\": 1456, \"name\": \"place1\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1457, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place2\", \"name\": \"place2\"}, \"alias\": \"place2\", \"location\": {\"lat\": 41.101, \"lon\": 41.1}, \"id\": 1457, \"name\": \"place2\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1458, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place3\", \"name\": \"place3\"}, \"alias\": \"place3\", \"location\": {\"lat\": 41.102, \"lon\": 41.1}, \"id\": 1458, \"name\": \"place3\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1459, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place4\", \"name\": \"place4\"}, \"alias\": \"place4\", \"location\": {\"lat\": 41.102, \"lon\": 41.1}, \"id\": 1459, \"name\": \"place4\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1460, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place5\", \"name\": \"place5\"}, \"alias\": \"place5\", \"location\": {\"lat\": 41.103, \"lon\": 41.1}, \"id\": 1460, \"name\": \"place5\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1461, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place6\", \"name\": \"place6\"}, \"alias\": \"place6\", \"location\": {\"lat\": 41.103, \"lon\": 41.1}, \"id\": 1461, \"name\": \"place6\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1462, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place7\", \"name\": \"place7\"}, \"alias\": \"place7\", \"location\": {\"lat\": 41.105, \"lon\": 41.1}, \"id\": 1462, \"name\": \"place7\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1463, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place8\", \"name\": \"place8\"}, \"alias\": \"place8\", \"location\": {\"lat\": 41.106, \"lon\": 41.1}, \"id\": 1463, \"name\": \"place8\"}\n{\"index\": {\"_type\": \"place\", \"_id\": 1464, \"_index\": \"places\"}}\n{\"popup\": {\"alias\": \"place9\", \"name\": \"place9\"}, \"alias\": \"place9\", \"location\": {\"lat\": 41.107, \"lon\": 41.1}, \"id\": 1464, \"name\": \"place9\"}\n'\n\nRES=$(curl -XGET 'http://localhost:9200/places/place/_search?scroll=10m' -d '{\n  \"aggs\": {\n    \"clusters\": {\n      \"aggs\": {\n        \"popup\": {\n          \"top_hits\": {\n            \"_source\": {\n              \"include\": [\n                \"location\",\n                \"popup\"\n              ]\n            },\n            \"size\": 1,\n            \"sort\": [\n              {\n                \"_id\": {\n                  \"order\": \"desc\"\n                }\n              }\n            ]\n          }\n        }\n      },\n      \"geohash_grid\": {\n        \"field\": \"location\",\n        \"precision\": 8\n      }\n    }\n  },\n  \"filter\": {\n      \"geo_bounding_box\": {\n          \"location\": {\n            \"bottom_left\": {\n              \"lat\": 41.1,\n              \"lon\": 41.09\n            },\n            \"top_right\": {\n              \"lat\": 41.11,\n              \"lon\": 41.108\n            }\n          }\n        }\n   },\n  \"size\": 2\n}')\n\necho;\necho 'result'\necho $RES | python -mjson.tool\n\necho;\necho 'scroll_id'\nSCROLL_ID=$(echo $RES | python -c\"import sys, json; sys.stdout.write(json.loads(sys.stdin.read())['_scroll_id'])\")\necho $SCROLL_ID\n\necho;\necho 'scroll next'\ncurl -XGET \"http://localhost:9200/_search/scroll?scroll=10m&size=10\" -d\"$SCROLL_ID\" | python -mjson.tool\n```\n\noutput\n\n```\nversion\n{\n    \"cluster_name\": \"elasticsearch\",\n    \"name\": \"Fever Pitch\",\n    \"status\": 200,\n    \"tagline\": \"You Know, for Search\",\n    \"version\": {\n        \"build_hash\": \"c88f77ffc81301dfa9dfd81ca2232f09588bd512\",\n        \"build_snapshot\": false,\n        \"build_timestamp\": \"2015-02-19T13:05:36Z\",\n        \"lucene_version\": \"4.10.3\",\n        \"number\": \"1.4.4\"\n    }\n}\n\n{\"acknowledged\":true}{\"acknowledged\":true}{\"_shards\":{\"total\":10,\"successful\":4,\"failed\":0}}\nbulk create documents\n{\"took\":397,\"errors\":false,\"items\":[{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1455\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1456\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1457\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1458\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1459\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1460\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1461\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1462\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1463\",\"_version\":1,\"status\":201}},{\"index\":{\"_index\":\"places\",\"_type\":\"place\",\"_id\":\"1464\",\"_version\":1,\"status\":201}}]}\nresult\n{\n    \"_scroll_id\": \"cXVlcnlUaGVuRmV0Y2g7NTsxNTY6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzsxNjA6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzsxNTg6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzsxNTk6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzsxNTc6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzswOw==\",\n    \"_shards\": {\n        \"failed\": 0,\n        \"successful\": 5,\n        \"total\": 5\n    },\n    \"aggregations\": {\n        \"clusters\": {\n            \"buckets\": [\n                {\n                    \"doc_count\": 3,\n                    \"key\": \"szm1z60n\",\n                    \"popup\": {\n                        \"hits\": {\n                            \"hits\": [\n                                {\n                                    \"_id\": \"1457\",\n                                    \"_index\": \"places\",\n                                    \"_score\": null,\n                                    \"_source\": {\n                                        \"location\": {\n                                            \"lat\": 41.101,\n                                            \"lon\": 41.1\n                                        },\n                                        \"popup\": {\n                                            \"alias\": \"place2\",\n                                            \"name\": \"place2\"\n                                        }\n                                    },\n                                    \"_type\": \"place\",\n                                    \"sort\": [\n                                        null\n                                    ]\n                                }\n                            ],\n                            \"max_score\": null,\n                            \"total\": 3\n                        }\n                    }\n                },\n                {\n                    \"doc_count\": 2,\n                    \"key\": \"szm1z684\",\n                    \"popup\": {\n                        \"hits\": {\n                            \"hits\": [\n                                {\n                                    \"_id\": \"1460\",\n                                    \"_index\": \"places\",\n                                    \"_score\": null,\n                                    \"_source\": {\n                                        \"location\": {\n                                            \"lat\": 41.103,\n                                            \"lon\": 41.1\n                                        },\n                                        \"popup\": {\n                                            \"alias\": \"place5\",\n                                            \"name\": \"place5\"\n                                        }\n                                    },\n                                    \"_type\": \"place\",\n                                    \"sort\": [\n                                        null\n                                    ]\n                                }\n                            ],\n                            \"max_score\": null,\n                            \"total\": 2\n                        }\n                    }\n                },\n                {\n                    \"doc_count\": 2,\n                    \"key\": \"szm1z62h\",\n                    \"popup\": {\n                        \"hits\": {\n                            \"hits\": [\n                                {\n                                    \"_id\": \"1458\",\n                                    \"_index\": \"places\",\n                                    \"_score\": null,\n                                    \"_source\": {\n                                        \"location\": {\n                                            \"lat\": 41.102,\n                                            \"lon\": 41.1\n                                        },\n                                        \"popup\": {\n                                            \"alias\": \"place3\",\n                                            \"name\": \"place3\"\n                                        }\n                                    },\n                                    \"_type\": \"place\",\n                                    \"sort\": [\n                                        null\n                                    ]\n                                }\n                            ],\n                            \"max_score\": null,\n                            \"total\": 2\n                        }\n                    }\n                },\n                {\n                    \"doc_count\": 1,\n                    \"key\": \"szm1z721\",\n                    \"popup\": {\n                        \"hits\": {\n                            \"hits\": [\n                                {\n                                    \"_id\": \"1464\",\n                                    \"_index\": \"places\",\n                                    \"_score\": null,\n                                    \"_source\": {\n                                        \"location\": {\n                                            \"lat\": 41.107,\n                                            \"lon\": 41.1\n                                        },\n                                        \"popup\": {\n                                            \"alias\": \"place9\",\n                                            \"name\": \"place9\"\n                                        }\n                                    },\n                                    \"_type\": \"place\",\n                                    \"sort\": [\n                                        null\n                                    ]\n                                }\n                            ],\n                            \"max_score\": null,\n                            \"total\": 1\n                        }\n                    }\n                },\n                {\n                    \"doc_count\": 1,\n                    \"key\": \"szm1z705\",\n                    \"popup\": {\n                        \"hits\": {\n                            \"hits\": [\n                                {\n                                    \"_id\": \"1463\",\n                                    \"_index\": \"places\",\n                                    \"_score\": null,\n                                    \"_source\": {\n                                        \"location\": {\n                                            \"lat\": 41.106,\n                                            \"lon\": 41.1\n                                        },\n                                        \"popup\": {\n                                            \"alias\": \"place8\",\n                                            \"name\": \"place8\"\n                                        }\n                                    },\n                                    \"_type\": \"place\",\n                                    \"sort\": [\n                                        null\n                                    ]\n                                }\n                            ],\n                            \"max_score\": null,\n                            \"total\": 1\n                        }\n                    }\n                },\n                {\n                    \"doc_count\": 1,\n                    \"key\": \"szm1z6bj\",\n                    \"popup\": {\n                        \"hits\": {\n                            \"hits\": [\n                                {\n                                    \"_id\": \"1462\",\n                                    \"_index\": \"places\",\n                                    \"_score\": null,\n                                    \"_source\": {\n                                        \"location\": {\n                                            \"lat\": 41.105,\n                                            \"lon\": 41.1\n                                        },\n                                        \"popup\": {\n                                            \"alias\": \"place7\",\n                                            \"name\": \"place7\"\n                                        }\n                                    },\n                                    \"_type\": \"place\",\n                                    \"sort\": [\n                                        null\n                                    ]\n                                }\n                            ],\n                            \"max_score\": null,\n                            \"total\": 1\n                        }\n                    }\n                }\n            ]\n        }\n    },\n    \"hits\": {\n        \"hits\": [],\n        \"max_score\": null,\n        \"total\": 0\n    },\n    \"timed_out\": false,\n    \"took\": 6\n}\n\nscroll_id\ncXVlcnlUaGVuRmV0Y2g7NTsxNTY6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzsxNjA6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzsxNTg6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzsxNTk6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzsxNTc6SkFXblB6OTdSZFNtZGpuQ01yMUpJZzswOw==\n\nscroll next\n{\n    \"error\": \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[JAWnPz97RdSmdjnCMr1JIg][places][0]: QueryPhaseExecutionException[[places][0]: query[ConstantScore(cache(_type:place))],from[2],size[2]: Query Failed [Failed to execute main query]]; nested: NullPointerException; }{[JAWnPz97RdSmdjnCMr1JIg][places][1]: QueryPhaseExecutionException[[places][1]: query[ConstantScore(cache(_type:place))],from[2],size[2]: Query Failed [Failed to execute main query]]; nested: NullPointerException; }{[JAWnPz97RdSmdjnCMr1JIg][places][2]: QueryPhaseExecutionException[[places][2]: query[ConstantScore(cache(_type:place))],from[2],size[2]: Query Failed [Failed to execute main query]]; nested: NullPointerException; }{[JAWnPz97RdSmdjnCMr1JIg][places][3]: QueryPhaseExecutionException[[places][3]: query[ConstantScore(cache(_type:place))],from[2],size[2]: Query Failed [Failed to execute main query]]; nested: NullPointerException; }{[JAWnPz97RdSmdjnCMr1JIg][places][4]: QueryPhaseExecutionException[[places][4]: query[ConstantScore(cache(_type:place))],from[2],size[2]: Query Failed [Failed to execute main query]]; nested: NullPointerException; }]\",\n    \"status\": 500\n}\n```\n\nSorry for my poor English\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}