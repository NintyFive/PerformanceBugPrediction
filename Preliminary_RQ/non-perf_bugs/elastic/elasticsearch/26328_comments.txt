[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324177540","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-324177540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":324177540,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDE3NzU0MA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-08-22T23:16:59Z","updated_at":"2017-08-22T23:16:59Z","author_association":"CONTRIBUTOR","body":"I don't think that we should use any shading for the REST client libraries that we publicly provide. The reason for shading the dependencies (commons-logging, apache-httpclient) in the first place (AFAICS, looking at #25208) was for interoperability with the ES test framework, as our own ES plugins use other versions of said dependencies. The issue lies with the ES test framework here, which puts the plugin under test into the same shared classpath with the REST client. I don't think that the issues of a test component should influence the way we package and expose our main Java client libraries. The question then is: How can we fix the test framework?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324184038","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-324184038","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":324184038,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDE4NDAzOA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-08-23T00:02:30Z","updated_at":"2017-08-23T00:02:30Z","author_association":"MEMBER","body":"> The reason for shading the dependencies (commons-logging, apache-httpclient) in the first place (AFAICS, looking at #25208) was for interoperability with the ES test framework\r\n\r\nThat was part of the reason, but not the only reason.  Fixing the test framework is difficult. Even if the rest runner were separated out, there are still tests in core which want to check http, and those need an http client.\r\n\r\n> I don't think that we should use any shading for the REST client libraries that we publicly provide\r\n\r\nIf the client has dependencies, there will always be someone to complain about the version of that dependency colliding with their own.  I don't have any problem with shading, as long as it is done in a way that tests are run against the shaded version, and apis of the shaded classes are not leaked (the latter of which I lost in debate). ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324262602","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-324262602","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":324262602,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDI2MjYwMg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-08-23T08:42:05Z","updated_at":"2017-08-23T08:42:05Z","author_association":"MEMBER","body":"On my end, the main reason for shading was to help users and increase adoption of the java rest client (including the high-level one which depends on the low-level one) rather than our test framework. I agree that the issues of a test component should not influence the way we package and expose our client, but this is not the case. Users would also like us to shade dependencies of the high-level client as well (e.g. jackson). Many applications use the apache http client so if we depend on it, shading it will address potential conflicts for sure.\r\n\r\nAs for why we depend on commons-logging in the low-level REST client: apache http client uses commons-logging already, so we just stuck with the same library. I am not sure whether there are alternatives that would help in this matter.\r\n\r\nIt would be nice to hear directly from our users on what would help them the most.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324533704","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-324533704","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":324533704,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDUzMzcwNA==","user":{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false},"created_at":"2017-08-24T05:03:47Z","updated_at":"2017-08-24T05:03:47Z","author_association":"CONTRIBUTOR","body":"@bleskes @jasontedor @rjernst I was able to shade an older `log4j-jcl` (2.0.2), and with some manual hackery in `META-INF`, got things wired up so commons logging is using log4j2 and the log4j-jcl shaded jar. I verified it uses my `org.elasticsearch.client.logging.log4j.jcl.LogFactoryImpl`, which was modified in `META-INF/services/org.apache.commons.logging.LogFactory`. \r\n\r\nI did run into a problem with newer log4j versions, as there is a binary file that defines the plugins (META-INF/org/apache/logging/log4j/core/config/plugins/Log4j2Plugins.dat), and I just have not been able to fix that up in the limited timeframe. So newer log4j is puking at runtime, and I cannot say whether its solvable or not at present. \r\n\r\nSo, the answer to whether we can even use another backend thats SPI'd, we can. But it does require significant effort on the end user, and some things may not be compatible (still unsure about the Plugins.dat). \r\n\r\nThe question of whether its worth it still stands, and we should solve it asap.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324586929","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-324586929","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":324586929,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDU4NjkyOQ==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-08-24T09:41:57Z","updated_at":"2017-08-24T09:41:57Z","author_association":"MEMBER","body":"I don't have a clear picture of how many people may be using commons-logging together with SPI. If that is an advanced usecase, and not that common, we could accept these issues caused by shading, especially if there is a work-around. By still shading the jar we would help users who use commons-logging without SPI and may have version conflicts. On the other hand, we could stop shading commons-logging but then any commons-logging user who wants to use our low-level client may have version conflicts. I would be leaning towards keeping things as they are for now, till we understand better from users what they need and react upon it.\r\n\r\nWhatever we decide to do above, I think it's important to keep on shading the apache http client dependency.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324669952","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-324669952","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":324669952,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDY2OTk1Mg==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-08-24T15:27:15Z","updated_at":"2017-08-24T15:27:15Z","author_association":"MEMBER","body":"This is the summary of discussions with @bleskes and @javanna.\r\n\r\nWe do not know what problems we are trying to solve, we feel there is not enough information to make a decision one way or the other whether or not to shade. We have one user saying not shading is fine for now (#25208), and another using having run into trouble with how we approached shading in an earlier 5.6.0-SNAPSHOT (#26318). (If there is additional existing user feedback on this issue, I would appreciate being pointed to it.) The simplest approach here is to not shade, users that need to shade can do this on their end, and they can control exactly what they need shaded. Until we have a better understanding what problems users are going to encounter, we should hold off on introducing shading.\r\n\r\nConclusion:\r\n1. revert shading for 5.6.0\r\n2. publish docs how users can shade on their end, if needed\r\n3. revert shading for 6.0.0-beta2\r\n4. open an issue deferring the decision for whether or not to shade for 6.0.0 pending feedback on the 5.6.0 release and the 6.0.0-beta2 release\r\n\r\nPlease feel free to add or correct any aspects I have wrong.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324671164","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-324671164","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":324671164,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDY3MTE2NA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2017-08-24T15:31:23Z","updated_at":"2017-08-24T15:31:52Z","author_association":"MEMBER","body":"I also saw some feedback on version conflicts as part of #23331 but that referred to the lucene dependency, which we decided not to shade for now anyway (it's a transitive dependency of the high-level client). ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/324712506","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-324712506","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":324712506,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDcxMjUwNg==","user":{"login":"hub-cap","id":613352,"node_id":"MDQ6VXNlcjYxMzM1Mg==","avatar_url":"https://avatars2.githubusercontent.com/u/613352?v=4","gravatar_id":"","url":"https://api.github.com/users/hub-cap","html_url":"https://github.com/hub-cap","followers_url":"https://api.github.com/users/hub-cap/followers","following_url":"https://api.github.com/users/hub-cap/following{/other_user}","gists_url":"https://api.github.com/users/hub-cap/gists{/gist_id}","starred_url":"https://api.github.com/users/hub-cap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hub-cap/subscriptions","organizations_url":"https://api.github.com/users/hub-cap/orgs","repos_url":"https://api.github.com/users/hub-cap/repos","events_url":"https://api.github.com/users/hub-cap/events{/privacy}","received_events_url":"https://api.github.com/users/hub-cap/received_events","type":"User","site_admin":false},"created_at":"2017-08-24T18:06:22Z","updated_at":"2017-08-24T18:06:22Z","author_association":"CONTRIBUTOR","body":"I created #26366 to address feedback on 6.0.0.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/325200846","html_url":"https://github.com/elastic/elasticsearch/issues/26328#issuecomment-325200846","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/26328","id":325200846,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNTIwMDg0Ng==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2017-08-27T14:13:05Z","updated_at":"2017-08-27T14:13:05Z","author_association":"MEMBER","body":"thx for all the iterations  @hub-cap ","performed_via_github_app":null}]