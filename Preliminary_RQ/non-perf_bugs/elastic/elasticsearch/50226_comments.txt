[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/566033381","html_url":"https://github.com/elastic/elasticsearch/issues/50226#issuecomment-566033381","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50226","id":566033381,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NjAzMzM4MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-12-16T12:05:16Z","updated_at":"2019-12-16T12:05:16Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/Engine)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/568405720","html_url":"https://github.com/elastic/elasticsearch/issues/50226#issuecomment-568405720","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50226","id":568405720,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODQwNTcyMA==","user":{"login":"zhichen","id":10560048,"node_id":"MDQ6VXNlcjEwNTYwMDQ4","avatar_url":"https://avatars2.githubusercontent.com/u/10560048?v=4","gravatar_id":"","url":"https://api.github.com/users/zhichen","html_url":"https://github.com/zhichen","followers_url":"https://api.github.com/users/zhichen/followers","following_url":"https://api.github.com/users/zhichen/following{/other_user}","gists_url":"https://api.github.com/users/zhichen/gists{/gist_id}","starred_url":"https://api.github.com/users/zhichen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhichen/subscriptions","organizations_url":"https://api.github.com/users/zhichen/orgs","repos_url":"https://api.github.com/users/zhichen/repos","events_url":"https://api.github.com/users/zhichen/events{/privacy}","received_events_url":"https://api.github.com/users/zhichen/received_events","type":"User","site_admin":false},"created_at":"2019-12-23T08:47:16Z","updated_at":"2019-12-23T08:47:16Z","author_association":"CONTRIBUTOR","body":"No one responded to this issue for a week. Does anyone help to see if this optimization is appropriate? Is there a better way to shorten the refresh execution time?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/568633655","html_url":"https://github.com/elastic/elasticsearch/issues/50226#issuecomment-568633655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50226","id":568633655,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODYzMzY1NQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-12-24T02:45:41Z","updated_at":"2019-12-24T02:45:41Z","author_association":"MEMBER","body":"Yes, your proposal can be an option, but we first need to understand the bottleneck. Do you enable [eager global ordinals](https://www.elastic.co/guide/en/elasticsearch/reference/master/eager-global-ordinals.html#eager-global-ordinals) for those indices? Can you share the [hot threads](https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster-nodes-hot-threads.html) when you suspect refresh is slower than the expectation? Thank you!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/568644119","html_url":"https://github.com/elastic/elasticsearch/issues/50226#issuecomment-568644119","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50226","id":568644119,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODY0NDExOQ==","user":{"login":"zhichen","id":10560048,"node_id":"MDQ6VXNlcjEwNTYwMDQ4","avatar_url":"https://avatars2.githubusercontent.com/u/10560048?v=4","gravatar_id":"","url":"https://api.github.com/users/zhichen","html_url":"https://github.com/zhichen","followers_url":"https://api.github.com/users/zhichen/followers","following_url":"https://api.github.com/users/zhichen/following{/other_user}","gists_url":"https://api.github.com/users/zhichen/gists{/gist_id}","starred_url":"https://api.github.com/users/zhichen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhichen/subscriptions","organizations_url":"https://api.github.com/users/zhichen/orgs","repos_url":"https://api.github.com/users/zhichen/repos","events_url":"https://api.github.com/users/zhichen/events{/privacy}","received_events_url":"https://api.github.com/users/zhichen/received_events","type":"User","site_admin":false},"created_at":"2019-12-24T03:53:21Z","updated_at":"2019-12-24T03:53:55Z","author_association":"CONTRIBUTOR","body":"@dnhatn  Thank you for your reply. I did not set eager global ordinals, and I also understand that setting eager global ordinals will greatly affect the refresh execution time, but I am not targeting this scenario. \r\n     My hot_threads are usually in IndexWriter.getReader (r = StandardDirectoryReader.open (this, segmentInfos, applyAllDeletes, writeAllDeletes)), when you suspect refresh is slower than the expectation.\r\n     At that time, I only recorded part of the hot_threads. If necessary, I can intercept the complete hot_threads after recurring the problem.\r\n```\r\n4/10 snapshots sharing following 27 elements\r\n       app//org.apache.lucene.index.StandardDirectoryReader.open(StandardDirectoryReader.java:106)\r\n       app//org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:493)\r\n       app//org.apache.lucene.index.StandardDirectoryReader.doOpenFromWriter(StandardDirectoryReader.java:294)\r\n       app//org.apache.lucene.index.StandardDirectoryReader.doOpenIfChanged(StandardDirectoryReader.java:269)\r\n       app//org.apache.lucene.index.StandardDirectoryReader.doOpenIfChanged(StandardDirectoryReader.java:259)\r\n       app//org.apache.lucene.index.FilterDirectoryReader.doOpenIfChanged(FilterDirectoryReader.java:112)\r\n       app//org.apache.lucene.index.DirectoryReader.openIfChanged(DirectoryReader.java:140)\r\n       app//org.apache.lucene.search.SearcherManager.refreshIfNeeded(SearcherManager.java:156)\r\n       app//org.apache.lucene.search.SearcherManager.refreshIfNeeded(SearcherManager.java:58)\r\n       app//org.apache.lucene.search.ReferenceManager.doMaybeRefresh(ReferenceManager.java:176)\r\n```\r\n\r\n\r\nI tried to modify the lucene source code and type the time overhead of StandardDirectoryReader.open. When the merged segment exceeds 2G, the time of StandardDirectoryReader.open exceeds 2S.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/568645841","html_url":"https://github.com/elastic/elasticsearch/issues/50226#issuecomment-568645841","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50226","id":568645841,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODY0NTg0MQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-12-24T04:06:15Z","updated_at":"2019-12-24T04:06:15Z","author_association":"MEMBER","body":"> At that time, I only recorded part of the hot_threads. If necessary, I can intercept the complete hot_threads after recurring the problem.\r\n\r\nIt will be clearer if we have a full picture of the hot threads.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/581508573","html_url":"https://github.com/elastic/elasticsearch/issues/50226#issuecomment-581508573","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50226","id":581508573,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTUwODU3Mw==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T16:49:55Z","updated_at":"2020-02-03T16:49:55Z","author_association":"CONTRIBUTOR","body":"No further feedback received. @zhichen if you have the requested\r\ninformation please add it in a comment and we can look at re-opening\r\nthis issue.","performed_via_github_app":null}]