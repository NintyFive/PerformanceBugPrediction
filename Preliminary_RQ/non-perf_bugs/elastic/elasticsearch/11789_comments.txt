[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/113856722","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-113856722","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":113856722,"node_id":"MDEyOklzc3VlQ29tbWVudDExMzg1NjcyMg==","user":{"login":"markwalkom","id":3184718,"node_id":"MDQ6VXNlcjMxODQ3MTg=","avatar_url":"https://avatars0.githubusercontent.com/u/3184718?v=4","gravatar_id":"","url":"https://api.github.com/users/markwalkom","html_url":"https://github.com/markwalkom","followers_url":"https://api.github.com/users/markwalkom/followers","following_url":"https://api.github.com/users/markwalkom/following{/other_user}","gists_url":"https://api.github.com/users/markwalkom/gists{/gist_id}","starred_url":"https://api.github.com/users/markwalkom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markwalkom/subscriptions","organizations_url":"https://api.github.com/users/markwalkom/orgs","repos_url":"https://api.github.com/users/markwalkom/repos","events_url":"https://api.github.com/users/markwalkom/events{/privacy}","received_events_url":"https://api.github.com/users/markwalkom/received_events","type":"User","site_admin":false},"created_at":"2015-06-21T02:51:02Z","updated_at":"2015-06-21T02:51:02Z","author_association":"MEMBER","body":"This is not what should happen.\nAre you seeing indices/documents go missing?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/113869770","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-113869770","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":113869770,"node_id":"MDEyOklzc3VlQ29tbWVudDExMzg2OTc3MA==","user":{"login":"ricardojmendez","id":31263,"node_id":"MDQ6VXNlcjMxMjYz","avatar_url":"https://avatars1.githubusercontent.com/u/31263?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardojmendez","html_url":"https://github.com/ricardojmendez","followers_url":"https://api.github.com/users/ricardojmendez/followers","following_url":"https://api.github.com/users/ricardojmendez/following{/other_user}","gists_url":"https://api.github.com/users/ricardojmendez/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardojmendez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardojmendez/subscriptions","organizations_url":"https://api.github.com/users/ricardojmendez/orgs","repos_url":"https://api.github.com/users/ricardojmendez/repos","events_url":"https://api.github.com/users/ricardojmendez/events{/privacy}","received_events_url":"https://api.github.com/users/ricardojmendez/received_events","type":"User","site_admin":false},"created_at":"2015-06-21T06:48:09Z","updated_at":"2015-06-21T06:48:09Z","author_association":"NONE","body":"Yes. All documents that were inserted on Node 2 while Node 1 was down disappear.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114209928","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-114209928","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":114209928,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDIwOTkyOA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-06-22T18:33:01Z","updated_at":"2015-06-22T18:33:01Z","author_association":"CONTRIBUTOR","body":"can you give me some more information ie. configuration of your index, are you using any special features, are you running on the same physical machine etc. etc. Can you reproduce this problem and if so can you switch on debug logging so we can see what's going on?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114210638","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-114210638","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":114210638,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDIxMDYzOA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-06-22T18:35:41Z","updated_at":"2015-06-22T18:35:41Z","author_association":"MEMBER","body":"@ricardojmendez when node_1 came back online, did you see in the logs that it accepted node2 as a master? I'm looking for something like:\n\n```\n[2015-06-22 20:35:14,433][INFO ][cluster.service          ] [Infant Terrible] detected_master [Hulk 2099][dCuk05JITNCtrKKURPGYsw][Boazs-MBP.local][inet[/192.168.1.178:9300]], added {[Hulk 2099][dCuk05JITNCtrKKURPGYsw][Boazs-MBP.local][inet[/192.168.1.178:9300]],}, reason: zen-disco-receive(from master [[Hulk 2099][dCuk05JITNCtrKKURPGYsw][Boazs-MBP.local][inet[/192.168.1.178:9300]]])\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114217309","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-114217309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":114217309,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDIxNzMwOQ==","user":{"login":"ricardojmendez","id":31263,"node_id":"MDQ6VXNlcjMxMjYz","avatar_url":"https://avatars1.githubusercontent.com/u/31263?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardojmendez","html_url":"https://github.com/ricardojmendez","followers_url":"https://api.github.com/users/ricardojmendez/followers","following_url":"https://api.github.com/users/ricardojmendez/following{/other_user}","gists_url":"https://api.github.com/users/ricardojmendez/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardojmendez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardojmendez/subscriptions","organizations_url":"https://api.github.com/users/ricardojmendez/orgs","repos_url":"https://api.github.com/users/ricardojmendez/repos","events_url":"https://api.github.com/users/ricardojmendez/events{/privacy}","received_events_url":"https://api.github.com/users/ricardojmendez/received_events","type":"User","site_admin":false},"created_at":"2015-06-22T18:48:45Z","updated_at":"2015-06-22T19:07:21Z","author_association":"NONE","body":"@s1monw: Not using any special features I'm aware of - it was a vanilla install. Both are running on different machines. I've seen the issue twice, once when testing what would happen, and the second one when I had just moved to work on a laptop for some time, then came back with it to the same network where the original desktop was.   I had meant to first back up the database in case it happened again, to have a repro case, but forgot.\n\nI haven't tested since, will see about finding a time window.\n\n@bleskes: On the logs for that day I see it on Node2. I believe Node1 was up before I brought Node2 into the network (I may have restarted it after booting Node1, as iirc I was running it from the terminal).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114229673","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-114229673","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":114229673,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDIyOTY3Mw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-06-22T19:30:31Z","updated_at":"2015-06-22T19:30:31Z","author_association":"MEMBER","body":"thx. I'm confused though - you said \"Node 1 goes down\" and \"At some later point, Node 1 comes back up.\" . I was referring to the logs at the moment node 1 comes back. I suspect it doesn't see node2 and decides it's alone and re-uses it's local copy as a last resort (albeit it being stale).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114236197","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-114236197","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":114236197,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDIzNjE5Nw==","user":{"login":"ricardojmendez","id":31263,"node_id":"MDQ6VXNlcjMxMjYz","avatar_url":"https://avatars1.githubusercontent.com/u/31263?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardojmendez","html_url":"https://github.com/ricardojmendez","followers_url":"https://api.github.com/users/ricardojmendez/followers","following_url":"https://api.github.com/users/ricardojmendez/following{/other_user}","gists_url":"https://api.github.com/users/ricardojmendez/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardojmendez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardojmendez/subscriptions","organizations_url":"https://api.github.com/users/ricardojmendez/orgs","repos_url":"https://api.github.com/users/ricardojmendez/repos","events_url":"https://api.github.com/users/ricardojmendez/events{/privacy}","received_events_url":"https://api.github.com/users/ricardojmendez/received_events","type":"User","site_admin":false},"created_at":"2015-06-22T19:48:41Z","updated_at":"2015-06-22T21:42:23Z","author_association":"NONE","body":"@bleskes: I was jetlagged when they rejoined the network, so looking back right now I can't be 100% sure that Node2 on the network when I booted Node 1 (I had turned wireless off on the plane) which is why I thought to clarify it.\n\nWhen Node 1 comes back, it does not have any log of finding Node2 as a master. It does have a record of Node2 joining, which matches that of Node2 finding Node1 as a master.\n\nRegarding your scenario:  I'd understand why Node 1 would keep a stale copy and _not sync_, but given that Node2 had data in it, would you expect that Node2 would then dump all new records in favor of Node1's old state?\n\nWhen Node2 syncs with Node1, do they do it by exchanging transaction logs (or their equivalents) or by just having whomever gets designated as master propagate its current state?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114893923","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-114893923","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":114893923,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDg5MzkyMw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-06-24T14:44:16Z","updated_at":"2015-06-24T14:44:16Z","author_association":"MEMBER","body":"> I'd understand why Node 1 would keep a stale copy and not sync, but given that Node2 had data in it, would you expect that Node2 would then dump all new records in favor of Node1's old state?\n\nIt's important to realize that once node1 was elected as master and designated it's own copy as primary, that shard copy will accept (versioned) writes. Those writes may conflict with what ever operations that may have found their way to node2's copy while node1 was down. There are a couple of ways to solve this conflict,  almost all of them complex. Things like CRDTs (compromising on functionality to only what CRDTs can do), try to do some kind of last write wins and suffering all the pains of time shifting, offload the pain to the user (repair on read) and so fourth. In ES we chose to keep things simple and rely on the mastership of the master node and it's decision to choose a primary shard. We never try to resolve operations from multiple copies but rather make sure all copies revert themselves to the primary shard (this is similar to algorithms to like RAFT).\n\n> When Node2 syncs with Node1, do they do it by exchanging transaction logs (or their equivalents) or by just having whomever gets designated as master propagate its current state?\n\nNo it - make sure it will have a true copy of node1's primary.\n\nLast I have to say that 2 is a tricky number in distributed systems as there is no majority. A two node cluster is good for not loosing data due to hardware failures but you have to make sure the nodes will not be able to operate independently (set `min_master_nodes` to 2). Without this you run the risk of having split brains and thus data loss and other bad things...\n\nI'm going to close this now as we seemed to have found the source of the problem. Do feel free to reopen if you feel differently.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114943523","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-114943523","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":114943523,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDk0MzUyMw==","user":{"login":"ricardojmendez","id":31263,"node_id":"MDQ6VXNlcjMxMjYz","avatar_url":"https://avatars1.githubusercontent.com/u/31263?v=4","gravatar_id":"","url":"https://api.github.com/users/ricardojmendez","html_url":"https://github.com/ricardojmendez","followers_url":"https://api.github.com/users/ricardojmendez/followers","following_url":"https://api.github.com/users/ricardojmendez/following{/other_user}","gists_url":"https://api.github.com/users/ricardojmendez/gists{/gist_id}","starred_url":"https://api.github.com/users/ricardojmendez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricardojmendez/subscriptions","organizations_url":"https://api.github.com/users/ricardojmendez/orgs","repos_url":"https://api.github.com/users/ricardojmendez/repos","events_url":"https://api.github.com/users/ricardojmendez/events{/privacy}","received_events_url":"https://api.github.com/users/ricardojmendez/received_events","type":"User","site_admin":false},"created_at":"2015-06-24T17:07:02Z","updated_at":"2015-06-24T17:07:02Z","author_association":"NONE","body":"Thanks. To be absolutely sure we're talking about the same case @bleskes (since there's mention of record versioning), on a two node scenario, if:\n\n1) Node1 and Node2 lose contact with each other.\n2) During that time, \n2.1) Node1 doesn't modify, insert or delete any records.\n2.2) Node2 doesn't modify or delete any existing records, only inserts new ones.\n3) When they rejoin, Node1 gets elected as master.\n\nThen even though there are _no conflicts or changes_ on the shared records, and only new records inserted on Node2, then Node2 will discard all its newly created records, given they don't exist on the master.\n\nIs that correct?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/116592363","html_url":"https://github.com/elastic/elasticsearch/issues/11789#issuecomment-116592363","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11789","id":116592363,"node_id":"MDEyOklzc3VlQ29tbWVudDExNjU5MjM2Mw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-06-29T10:09:17Z","updated_at":"2015-06-29T10:09:17Z","author_association":"MEMBER","body":"that's correct. At the moment we don't try to do a doc by doc analysis and try to figure what is safe to keep and what should be rejected.\n\nNote that that point 3 is weird in normal procedure. If Node2 is was on and a master, node1 will join it rather than elect it self (in which case everything goes OK). The issue is that node1 was elected as master first and node2 has joined it.\n","performed_via_github_app":null}]