{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24696","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24696/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24696/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24696/events","html_url":"https://github.com/elastic/elasticsearch/issues/24696","id":228930995,"node_id":"MDU6SXNzdWUyMjg5MzA5OTU=","number":24696,"title":"elastic 5.1, cat indices NPE, cat nodes master removed and readded","user":{"login":"sinsonglew","id":12896760,"node_id":"MDQ6VXNlcjEyODk2NzYw","avatar_url":"https://avatars1.githubusercontent.com/u/12896760?v=4","gravatar_id":"","url":"https://api.github.com/users/sinsonglew","html_url":"https://github.com/sinsonglew","followers_url":"https://api.github.com/users/sinsonglew/followers","following_url":"https://api.github.com/users/sinsonglew/following{/other_user}","gists_url":"https://api.github.com/users/sinsonglew/gists{/gist_id}","starred_url":"https://api.github.com/users/sinsonglew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sinsonglew/subscriptions","organizations_url":"https://api.github.com/users/sinsonglew/orgs","repos_url":"https://api.github.com/users/sinsonglew/repos","events_url":"https://api.github.com/users/sinsonglew/events{/privacy}","received_events_url":"https://api.github.com/users/sinsonglew/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-05-16T06:48:18Z","updated_at":"2017-05-25T01:47:39Z","closed_at":"2017-05-16T07:37:11Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 5.1.1\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 1.8_111\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): centOS 6.x\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nexpectation:\r\ncat indices list each index normally;\r\ncat nodes show complete infomation\r\n\r\nactually:\r\nNPE/missed some node info, the master node included\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. when cat nodes, not each node info got listed, some lack load and cpu info;\r\n 2. came to node logs, NodeNotConnectedException appears and found many nodes got removed;\r\n\r\n**Provide logs (if relevant)**:\r\n`[2017-05-16T11:36:10,005][WARN ][o.e.t.n.Netty3Transport  ] [node75] exception caught on transport layer [[id: 0x32b26cc8, /10.07.24.75:59742 => 10.07.24.79/10.07.24.79:9371]], closing connection\r\njava.lang.IllegalStateException: Message not fully read (response) for requestId [143219], handler [org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler/org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1@75cacb24], error [false]; resetting\r\n\tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:1257) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.netty3.Netty3MessageChannelHandler.messageReceived(Netty3MessageChannelHandler.java:73) ~[transport-netty3-5.1.1.jar:5.1.1]\r\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) ~[netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:303) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42) [netty-3.10.6.Final.jar:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_111]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_111]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_111]\r\n[2017-05-16T11:36:10,005][WARN ][o.e.t.n.Netty3Transport  ] [node75] exception caught on transport layer [[id: 0x1ff141b8, /10.07.24.75:50015 => 10.07.24.72/10.07.24.72:9371]], closing connection\r\njava.lang.IllegalStateException: Message not fully read (response) for requestId [143217], handler [org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler/org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1@38654ffd], error [false]; resetting\r\n\tat org.elasticsearch.transport.TcpTransport.messageReceived(TcpTransport.java:1257) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n\tat org.elasticsearch.transport.netty3.Netty3MessageChannelHandler.messageReceived(Netty3MessageChannelHandler.java:73) ~[transport-netty3-5.1.1.jar:5.1.1]\r\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) ~[netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:296) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:303) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:268) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.Channels.fireMessageReceived(Channels.java:255) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:337) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108) [netty-3.10.6.Final.jar:?]\r\n\tat org.jboss.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42) [netty-3.10.6.Final.jar:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_111]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_111]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_111]\r\n[2017-05-16T11:36:10,007][INFO ][o.e.d.z.ZenDiscovery     ] [node75] master_left [{node72}{C96zII7GQAywJY-Z15a-iQ}{480aO4cUTTWT53z6fI4CfA}{10.07.24.72}{10.07.24.72:9371}], reason [transport disconnected]\r\n[2017-05-16T11:36:10,008][WARN ][o.e.d.z.ZenDiscovery     ] [node75] master left (reason = transport disconnected), current nodes: nodes: \r\n   {node77}{_dn3sUWxRFGqfsFN1FQ_ag}{n2_JFL96RIy9AvJ-hchpTw}{10.07.24.77}{10.07.24.77:9371}\r\n   {node74}{bvG9NZuMS9Krrz9FCQnOsw}{-aXpRRNWRymTjbjRFwXD-A}{10.07.24.74}{10.07.24.74:9371}\r\n   {node79}{R7E5QswhQy6sSQt2DUKazQ}{Ic538WxUR42bUYQJY1pMJg}{10.07.24.79}{10.07.24.79:9371}\r\n   {node78}{FgfCdXu1R9qqmpyIRPf5LQ}{P9UVxmSkTX-cbhUaIaHRBA}{10.07.24.78}{10.07.24.78:9371}\r\n   {node22}{jn1MmeOKRnGnS-HiXAutOw}{WgYK9HHfR82Pp3sa10lkIA}{10.07.27.22}{10.07.27.22:9371}\r\n   {node70}{tJp2oOCyTXWb3XGnHACr9A}{rBwp8j4IQmW_cvQoZDLlYw}{10.07.24.70}{10.07.24.70:9371}\r\n   {node71}{g1XDb-cGTCqOVLgwL5dW7A}{mFJTjLRAQdOVSI1U_G5kcA}{10.07.24.71}{10.07.24.71:9371}\r\n   {node76}{VEJVuKCSREugsJeRGkbigA}{nDqh04oJTwuPle1pOKhSgw}{10.07.24.76}{10.07.24.76:9371}\r\n   {node75}{7kgChQzaRoWPeBF6r0nHxg}{dWGdAmlgQcCJ44mSoIUgsw}{10.07.24.75}{10.07.24.75:9371}, local\r\n   {node73}{GCSMRAArS8ik7aoOtQnxCA}{cqWXaEtARQGIOUXsb81hvQ}{10.07.24.73}{10.07.24.73:9371}\r\n   {node24}{qvz24kf1SJC6SIMgtdBm6Q}{ONKezttVS2WtrLNh98qq5Q}{10.07.27.24}{10.07.27.24:9371}\r\n   {node23}{EEqGk6EwSwKO76w1KrZn0A}{ktTICW1WTfGqDjyXI4SrlA}{10.07.27.23}{10.07.27.23:9371}\r\n\r\n[2017-05-16T11:36:10,008][INFO ][o.e.c.s.ClusterService   ] [node75] removed {{node72}{C96zII7GQAywJY-Z15a-iQ}{480aO4cUTTWT53z6fI4CfA}{10.07.24.72}{10.07.24.72:9371},}, reason: master_failed ({node72}{C96zII7GQAywJY-Z15a-iQ}{480aO4cUTTWT53z6fI4CfA}{10.07.24.72}{10.07.24.72:9371})\r\n[2017-05-16T11:36:13,020][INFO ][o.e.c.s.ClusterService   ] [node75] detected_master {node72}{C96zII7GQAywJY-Z15a-iQ}{480aO4cUTTWT53z6fI4CfA}{10.07.24.72}{10.07.24.72:9371}, added {{node72}{C96zII7GQAywJY-Z15a-iQ}{480aO4cUTTWT53z6fI4CfA}{10.07.24.72}{10.07.24.72:9371},}, reason: zen-disco-receive(from master [master {node72}{C96zII7GQAywJY-Z15a-iQ}{480aO4cUTTWT53z6fI4CfA}{10.07.24.72}{10.07.24.72:9371} committed version [1896]])\r\n`\r\n\r\n","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}