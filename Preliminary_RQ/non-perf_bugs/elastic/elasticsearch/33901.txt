{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33901","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33901/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33901/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33901/events","html_url":"https://github.com/elastic/elasticsearch/issues/33901","id":362236456,"node_id":"MDU6SXNzdWUzNjIyMzY0NTY=","number":33901,"title":"Infinite loop on malformed input JSON","user":{"login":"sabi0","id":11509875,"node_id":"MDQ6VXNlcjExNTA5ODc1","avatar_url":"https://avatars3.githubusercontent.com/u/11509875?v=4","gravatar_id":"","url":"https://api.github.com/users/sabi0","html_url":"https://github.com/sabi0","followers_url":"https://api.github.com/users/sabi0/followers","following_url":"https://api.github.com/users/sabi0/following{/other_user}","gists_url":"https://api.github.com/users/sabi0/gists{/gist_id}","starred_url":"https://api.github.com/users/sabi0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sabi0/subscriptions","organizations_url":"https://api.github.com/users/sabi0/orgs","repos_url":"https://api.github.com/users/sabi0/repos","events_url":"https://api.github.com/users/sabi0/events{/privacy}","received_events_url":"https://api.github.com/users/sabi0/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-09-20T15:15:41Z","updated_at":"2018-12-11T15:13:16Z","closed_at":"2018-12-11T15:13:16Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Loops like this will iterate forever if the input stream does not have a closing curly brace:\r\nhttps://github.com/elastic/elasticsearch/blob/8f2feb84143aff46225f0bca84d6f7d0d40f99fc/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/input/chain/ChainInput.java#L62\r\n\r\nA null check should be added to prevent this:\r\n```\r\nwhile ((token = parser.nextToken()) != XContentParser.Token.END_OBJECT && token != null) {\r\n```\r\n\r\nSome other occurrences of the same problem:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/1136a9583792ae20ffc2d6c58324ce4e04962976/x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/security/action/privilege/PutPrivilegesRequestBuilder.java#L64\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/5bcdff73d756814f270794110fb4502d0a2a513a/server/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotStats.java#L229\r\n\r\nNote that sometimes there is an (indirect) check for `token == null` inside the loop. See e.g. BasicAuth.java:\r\nhttps://github.com/elastic/elasticsearch/blob/e1206a6272d1ce2269efa97119071584cc35f44c/x-pack/plugin/watcher/src/main/java/org/elasticsearch/xpack/watcher/common/http/BasicAuth.java#L78\r\n\r\n\r\nAnd a few more with `END_ARRAY`:\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/237650e9c054149fd08213b38a81a3666c1868e5/server/src/main/java/org/elasticsearch/search/profile/SearchProfileShardResults.java#L147\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/237650e9c054149fd08213b38a81a3666c1868e5/server/src/main/java/org/elasticsearch/search/profile/aggregation/AggregationProfileShardResult.java#L88\r\n\r\nhttps://github.com/elastic/elasticsearch/blob/38bdf9ce3238c5399e18b33efba34df3a269e17c/x-pack/plugin/graph/src/main/java/org/elasticsearch/xpack/graph/rest/action/RestGraphAction.java#L146","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}