{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/19034","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19034/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19034/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19034/events","html_url":"https://github.com/elastic/elasticsearch/issues/19034","id":161774424,"node_id":"MDU6SXNzdWUxNjE3NzQ0MjQ=","number":19034,"title":"Specific JSON key ordering causes search query failure","user":{"login":"nanotone","id":282869,"node_id":"MDQ6VXNlcjI4Mjg2OQ==","avatar_url":"https://avatars0.githubusercontent.com/u/282869?v=4","gravatar_id":"","url":"https://api.github.com/users/nanotone","html_url":"https://github.com/nanotone","followers_url":"https://api.github.com/users/nanotone/followers","following_url":"https://api.github.com/users/nanotone/following{/other_user}","gists_url":"https://api.github.com/users/nanotone/gists{/gist_id}","starred_url":"https://api.github.com/users/nanotone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nanotone/subscriptions","organizations_url":"https://api.github.com/users/nanotone/orgs","repos_url":"https://api.github.com/users/nanotone/repos","events_url":"https://api.github.com/users/nanotone/events{/privacy}","received_events_url":"https://api.github.com/users/nanotone/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"assignees":[{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2016-06-22T20:11:42Z","updated_at":"2018-02-14T13:32:58Z","closed_at":"2016-06-24T09:50:21Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**:\n\n5.0.0~alpha3\n\n**JVM version**:\n\njava version \"1.8.0_91\"\nJava(TM) SE Runtime Environment (build 1.8.0_91-b14)\nJava HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode)\n\n**OS version**:\n\nLinux ip-10-10-155-146 3.13.0-74-generic #118-Ubuntu SMP Thu Dec 17 22:52:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n\n**Description of the problem including expected versus actual behavior**:\n\n**Steps to reproduce**:\nCreate an index with two mappings in a parent/child relationship. e.g.\n\n``` bash\n$ curl -XPUT 'http://localhost:9200/foo/' -d '{\"settings\":{\"number_of_shards\":1},\"mappings\":{\"blog\":{\"properties\":{\"name\":{\"type\":\"keyword\"}}},\"tag\":{\"_parent\":{\"type\":\"blog\"},\"properties\":{\"name\":{\"type\":\"keyword\"}}}}}'\n{\"acknowledged\":true}\n```\n\nMake this search query, with the `query` key preceding the `has_child` key in the `should` clause.\n\n``` bash\n$ curl 'http://localhost:9200/foo/_search' -d '{\"query\":{\"bool\":{\"should\":{\"query\":{\"query_string\":{\"query\":\"go\"}},\"has_child\":{\"query\":{\"query_string\":{\"query\":\"go\"}},\"child_type\":\"tag\"}}}}}'\n{\"error\":{\"root_cause\":[{\"type\":\"parsing_exception\",\"reason\":\"no [query] registered for [query]\",\"line\":1,\"col\":37}],\"type\":\"parsing_exception\",\"reason\":\"no [query] registered for [query]\",\"line\":1,\"col\":37},\"status\":400}\n```\n\nBut switching the key order makes it work. According to http://json.org/ this serialization represents the exact same object as before.\n\n``` bash\n$ curl 'http://localhost:9200/foo/_search' -d '{\"query\":{\"bool\":{\"should\":{\"has_child\":{\"query\":{\"query_string\":{\"query\":\"go\"}},\"child_type\":\"tag\"},\"query\":{\"query_string\":{\"query\":\"go\"}}}}}}'\n{\"took\":102,\"timed_out\":false,\"_shards\":{\"total\":1,\"successful\":1,\"failed\":0},\"hits\":{\"total\":0,\"max_score\":null,\"hits\":[]}}\n```\n\n**Provide logs (if relevant)**:\nNo logs appear to be generated for the error.\n","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}