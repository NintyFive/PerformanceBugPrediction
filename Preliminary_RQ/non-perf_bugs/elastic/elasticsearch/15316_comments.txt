[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/162933009","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-162933009","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":162933009,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MjkzMzAwOQ==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2015-12-08T16:16:44Z","updated_at":"2015-12-08T16:16:44Z","author_association":"CONTRIBUTOR","body":"@rferrante1966 \n\nCurrently i think that this can be done by Scripted Metric Aggregations. However they are expensive and i don't think that we support them in Kibana yet.\n\nA new aggregation can be useful to provide the insight of the data in a pretty straight forward way. But i am not sure if this is too specific to a \"Transactions\" user case.\n\n@clintongormley  any thoughts?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/162987549","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-162987549","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":162987549,"node_id":"MDEyOklzc3VlQ29tbWVudDE2Mjk4NzU0OQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-08T19:20:42Z","updated_at":"2015-12-08T19:20:42Z","author_association":"CONTRIBUTOR","body":"I can't find them but I think we had other issues related to that topic. In short it is not something that we can implement efficiently at query time. The best option today would be to index in an entity-centric way so that components of a transaction are already grouped together in a single document in the index and ready to be aggregated.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/162989338","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-162989338","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":162989338,"node_id":"MDEyOklzc3VlQ29tbWVudDE2Mjk4OTMzOA==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2015-12-08T19:27:39Z","updated_at":"2015-12-08T19:27:39Z","author_association":"CONTRIBUTOR","body":"Thanks @jpountz i do think that having them grouped using nested or parent child can work. For this a reindex is needed so then you can change the mapping and structure.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/162994426","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-162994426","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":162994426,"node_id":"MDEyOklzc3VlQ29tbWVudDE2Mjk5NDQyNg==","user":{"login":"rferrante1966","id":6255319,"node_id":"MDQ6VXNlcjYyNTUzMTk=","avatar_url":"https://avatars3.githubusercontent.com/u/6255319?v=4","gravatar_id":"","url":"https://api.github.com/users/rferrante1966","html_url":"https://github.com/rferrante1966","followers_url":"https://api.github.com/users/rferrante1966/followers","following_url":"https://api.github.com/users/rferrante1966/following{/other_user}","gists_url":"https://api.github.com/users/rferrante1966/gists{/gist_id}","starred_url":"https://api.github.com/users/rferrante1966/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rferrante1966/subscriptions","organizations_url":"https://api.github.com/users/rferrante1966/orgs","repos_url":"https://api.github.com/users/rferrante1966/repos","events_url":"https://api.github.com/users/rferrante1966/events{/privacy}","received_events_url":"https://api.github.com/users/rferrante1966/received_events","type":"User","site_admin":false},"created_at":"2015-12-08T19:47:42Z","updated_at":"2015-12-08T19:47:42Z","author_association":"NONE","body":"It may not be easy to implement at query time, but it may worth considering as demand for cross stack transaction reporting is huge and looks to only be growing. ...   \n\nWithout this feature, I was thinking along the same lines as @jpountz  that the best we could do was create transaction records outside of Elasticsearch (the single document @jpountz referenced) and insert them as a basis for reporting. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/163150931","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-163150931","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":163150931,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MzE1MDkzMQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-12-09T08:39:42Z","updated_at":"2015-12-09T08:39:42Z","author_association":"CONTRIBUTOR","body":"@rferrante1966 If you already have transaction ids in your events, you might be able to use them as document ids in elasticsearch and use the upsert capabilities to either create the document if it does not exist or append to it otherwise.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/163160972","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-163160972","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":163160972,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MzE2MDk3Mg==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2015-12-09T09:29:00Z","updated_at":"2015-12-09T09:29:00Z","author_association":"CONTRIBUTOR","body":"@jpountz @rferrante1966  I think that for a regular indexing use case, that can work, however for a logging use case, this is not straight forward. Also, using upsert can impact the cluster for too many updates, i think that the best option is to pull the documents and re-index them in a way that you can actually perform some operations that gives you the result. Other than than, Scripted Metric Aggregation can be expensive, but depending how many times per day you want to run this, it can be an option.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/163162259","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-163162259","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":163162259,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MzE2MjI1OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-12-09T09:32:08Z","updated_at":"2015-12-09T09:32:08Z","author_association":"CONTRIBUTOR","body":"@rferrante1966 Have a look at @markharwood 's talk about entity centric indexing https://www.youtube.com/watch?v=yBf7oeJKH2Y , where he goes into the whys and hows of doing what you're after.  This is not something we can do efficiently at query time, but we are thinking about how we can make it easier to do at index time, possibly using the changes API(https://github.com/elastic/elasticsearch/issues/1242)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/163785854","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-163785854","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":163785854,"node_id":"MDEyOklzc3VlQ29tbWVudDE2Mzc4NTg1NA==","user":{"login":"rferrante1966","id":6255319,"node_id":"MDQ6VXNlcjYyNTUzMTk=","avatar_url":"https://avatars3.githubusercontent.com/u/6255319?v=4","gravatar_id":"","url":"https://api.github.com/users/rferrante1966","html_url":"https://github.com/rferrante1966","followers_url":"https://api.github.com/users/rferrante1966/followers","following_url":"https://api.github.com/users/rferrante1966/following{/other_user}","gists_url":"https://api.github.com/users/rferrante1966/gists{/gist_id}","starred_url":"https://api.github.com/users/rferrante1966/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rferrante1966/subscriptions","organizations_url":"https://api.github.com/users/rferrante1966/orgs","repos_url":"https://api.github.com/users/rferrante1966/repos","events_url":"https://api.github.com/users/rferrante1966/events{/privacy}","received_events_url":"https://api.github.com/users/rferrante1966/received_events","type":"User","site_admin":false},"created_at":"2015-12-10T23:31:04Z","updated_at":"2015-12-10T23:31:04Z","author_association":"NONE","body":"Mark's presentation is certainly on target.  I hope to spend some time looking at the example he provided in which he routinely processes the raw events and creates session (transaction) records for optimized search. Thanks.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/163925146","html_url":"https://github.com/elastic/elasticsearch/issues/15316#issuecomment-163925146","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15316","id":163925146,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MzkyNTE0Ng==","user":{"login":"gmoskovicz","id":1675411,"node_id":"MDQ6VXNlcjE2NzU0MTE=","avatar_url":"https://avatars3.githubusercontent.com/u/1675411?v=4","gravatar_id":"","url":"https://api.github.com/users/gmoskovicz","html_url":"https://github.com/gmoskovicz","followers_url":"https://api.github.com/users/gmoskovicz/followers","following_url":"https://api.github.com/users/gmoskovicz/following{/other_user}","gists_url":"https://api.github.com/users/gmoskovicz/gists{/gist_id}","starred_url":"https://api.github.com/users/gmoskovicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmoskovicz/subscriptions","organizations_url":"https://api.github.com/users/gmoskovicz/orgs","repos_url":"https://api.github.com/users/gmoskovicz/repos","events_url":"https://api.github.com/users/gmoskovicz/events{/privacy}","received_events_url":"https://api.github.com/users/gmoskovicz/received_events","type":"User","site_admin":false},"created_at":"2015-12-11T12:17:48Z","updated_at":"2015-12-11T12:17:48Z","author_association":"CONTRIBUTOR","body":"@rferrante1966 this was one of the ideas that we had at the beginning of this thread. Some times we need to change the way that the data is represented to be able to query in a simpler way. However, for this we should:\n1. Change the data, create new mapping, create new structures.\n2. Change how the data is stored: Index and Documents.\n3. Change the way that we think about logs: Log Centric vs Profile/Transaction Centric.\n\nWhile this will require extra work, you should be able to decrease the amount of time spend in writing queries or thinking about aggregation, for time of extracting the data and adding to the `profile` or the information that you need.\n\nThanks @clintongormley for pasting the youtube video, i think that it clarifies more how this can be done!\n","performed_via_github_app":null}]