{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/14099","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14099/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14099/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14099/events","html_url":"https://github.com/elastic/elasticsearch/issues/14099","id":111264463,"node_id":"MDU6SXNzdWUxMTEyNjQ0NjM=","number":14099,"title":"discovery-ec2 plugin needs to throttle itself if it gets a RequestLimitExceeded exception","user":{"login":"rtkmhart","id":2601414,"node_id":"MDQ6VXNlcjI2MDE0MTQ=","avatar_url":"https://avatars1.githubusercontent.com/u/2601414?v=4","gravatar_id":"","url":"https://api.github.com/users/rtkmhart","html_url":"https://github.com/rtkmhart","followers_url":"https://api.github.com/users/rtkmhart/followers","following_url":"https://api.github.com/users/rtkmhart/following{/other_user}","gists_url":"https://api.github.com/users/rtkmhart/gists{/gist_id}","starred_url":"https://api.github.com/users/rtkmhart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rtkmhart/subscriptions","organizations_url":"https://api.github.com/users/rtkmhart/orgs","repos_url":"https://api.github.com/users/rtkmhart/repos","events_url":"https://api.github.com/users/rtkmhart/events{/privacy}","received_events_url":"https://api.github.com/users/rtkmhart/received_events","type":"User","site_admin":false},"labels":[{"id":160579278,"node_id":"MDU6TGFiZWwxNjA1NzkyNzg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Discovery-Plugins","name":":Distributed/Discovery-Plugins","color":"0e8a16","default":false,"description":"Anything related to our integration plugins with EC2, GCP and Azure"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-10-13T20:31:16Z","updated_at":"2018-02-13T19:50:14Z","closed_at":"2015-11-23T14:07:20Z","author_association":"NONE","active_lock_reason":null,"body":"Occasionally when building a cluster things go into a funny state (not ES's fault) and the discovery plugin (using https://github.com/elastic/elasticsearch-cloud-aws) tries to find the master. If the master can't be found, it appears that the plugin starts spamming the EC2 API with as many lookups per second as it can, which quickly ends with EC2 throwing RequestLimitExceeded exceptions. The proper behaviour in this case is for the plugin to backoff but it doesn't appear to do so. When this occurs, the EC2 console becomes unusable, affecting every EC2 api call for that AWS account.\n\nUnfortunately I can't replicate the issue easily (we caught this when stumbling over a CloudFormation bug) and the CloudFormation stack would eventually roll back or we'd have to destroy the stack manually to try bring it under control. In either case we couldn't get any logs off the instances in time. I can share the CloudTrail logs if that will help. \n\nThis issue was raised here: https://github.com/elastic/elasticsearch-cloud-aws/issues/229\n\nWith a PR against that repo: https://github.com/elastic/elasticsearch-cloud-aws/pull/231\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}