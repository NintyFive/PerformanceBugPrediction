[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42694087","html_url":"https://github.com/elastic/elasticsearch/issues/6110#issuecomment-42694087","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6110","id":42694087,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjk0MDg3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-05-09T17:49:29Z","updated_at":"2014-05-09T17:49:29Z","author_association":"CONTRIBUTOR","body":"Replicated in master.  It looks like the filter is created before the mapping, and isn't updated after the mapping is changed.\n\nThe `explain` API output for a query via alias created via the template is: \n\n```\nConstantScore(+cache(_type:example) +MatchNoDocsFilter) doesn't match id 0\n```\n\nWhile for the alias created after the mapping is in place is:\n\n```\nConstantScore(+cache(_type:example) +cache(host:computer1 host:computer2 host:computer3)), \n```\n\nThis has nothing to do with the filter caching.  Slightly simplified recreation:\n\n```\nPUT /accesscontrol/group/admin\n{\n    \"name\" : \"admin\",\n    \"hosts\" : [\"computer1\",\"computer2\",\"computer3\"]\n}\n\nPUT /_template/admin_group\n{\n    \"template\" : \"logstash-*\",\n    \"aliases\" : {        \n        \"template-admin-{index}\" : {\n            \"filter\" : {\n                \"terms\" : {\n                    \"host\" : {\n                        \"index\" : \"accesscontrol\",\n                        \"type\" : \"group\",\n                        \"id\" : \"admin\",\n                        \"path\" : \"hosts\"\n                    }\n                }\n            }\n        }\n    }\n}\n\nPOST /logstash-2014.05.09/example/1\n{\n    \"message\":\"my sample data\",\n    \"@version\":\"1\",\n    \"@timestamp\":\"2014-05-09T16:25:45.613Z\",\n    \"type\":\"example\",\n    \"host\":\"computer1\"\n}\n\nPOST /_aliases\n{\n    \"actions\" : [\n        { \n            \"add\" : { \n                \"index\" : \"logstash-2014.05.09\",\n                \"alias\" : \"admin-logstash-2014.05.09\",\n                \"filter\": {\n                    \"terms\" : {\n                        \"host\" : {\n                            \"index\" : \"accesscontrol\",\n                            \"type\" : \"group\",\n                            \"id\" : \"admin\",\n                            \"path\" : \"hosts\"\n                        }\n                    }\n                }\n            }\n        }\n    ]\n}\n\n# returns the document\nGET /admin-logstash-2014.05.09/_search\n\n# matches no docs\nGET /template-admin-logstash-2014.05.09/_search\n\n\nGET /admin-logstash-2014.05.09/example/1/_explain\n{\"query\": {\"match_all\": {}}}\n\nGET /template-admin-logstash-2014.05.09/example/1/_explain\n{\"query\": {\"match_all\": {}}}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42699046","html_url":"https://github.com/elastic/elasticsearch/issues/6110#issuecomment-42699046","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6110","id":42699046,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjk5MDQ2","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2014-05-09T18:36:53Z","updated_at":"2014-05-09T18:36:53Z","author_association":"MEMBER","body":"I confirm @clintongormley's diagnosis. This happens specifically with terms filter lookup since the filter gets parsed upon index creation, before the dynamic mapping gets created.\n\nSame reproduces with ordinary aliases too if created before the first document gets indexed (just creating an empty index before creating the alias):\n\n```\nPUT /accesscontrol/group/admin\n{\n    \"name\" : \"admin\",\n    \"hosts\" : [\"computer1\",\"computer2\",\"computer3\"]\n}\n\nPUT /logstash-2014.05.09\n\nPOST /_aliases\n{\n    \"actions\" : [\n        { \n            \"add\" : { \n                \"index\" : \"logstash-2014.05.09\",\n                \"alias\" : \"admin-logstash-2014.05.09\",\n                \"filter\": {\n                    \"terms\" : {\n                        \"host\" : {\n                            \"index\" : \"accesscontrol\",\n                            \"type\" : \"group\",\n                            \"id\" : \"admin\",\n                            \"path\" : \"hosts\"\n                        }\n                    }\n                }\n            }\n        }\n    ]\n}\n\nPOST /logstash-2014.05.09/example/1\n{\n    \"message\":\"my sample data\",\n    \"@version\":\"1\",\n    \"@timestamp\":\"2014-05-09T16:25:45.613Z\",\n    \"type\":\"example\",\n    \"host\":\"computer1\"\n}\n\n# matches no docs\nGET /admin-logstash-2014.05.09/_search\n```\n\nA work around till we find a proper way to solve it is to manually create the index specifying its mappings before indexing the first document. This way the filter gets created after the mapping is parsed:\n\n```\nPUT /accesscontrol/group/admin\n{\n    \"name\" : \"admin\",\n    \"hosts\" : [\"computer1\",\"computer2\",\"computer3\"]\n}\n\nPUT /_template/admin_group\n{\n    \"template\" : \"logstash-*\",\n    \"aliases\" : {        \n        \"template-admin-{index}\" : {\n            \"filter\" : {\n                \"terms\" : {\n                    \"host\" : {\n                        \"index\" : \"accesscontrol\",\n                        \"type\" : \"group\",\n                        \"id\" : \"admin\",\n                        \"path\" : \"hosts\"\n                    }\n                }\n            }\n        }\n    }\n}\n\n\nPUT /logstash-2014.05.09\n{\n  \"mappings\": {\n    \"example\" : {\n      \"properties\": {\n        \"host\" : {\n          \"type\" : \"string\"\n        }  \n      } \n    }\n  }\n}\n\nPOST /logstash-2014.05.09/example/1\n{\n    \"message\":\"my sample data\",\n    \"@version\":\"1\",\n    \"@timestamp\":\"2014-05-09T16:25:45.613Z\",\n    \"type\":\"example\",\n    \"host\":\"computer1\"\n}\n\nGET /template-admin-logstash-2014.05.09/_search\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42699423","html_url":"https://github.com/elastic/elasticsearch/issues/6110#issuecomment-42699423","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6110","id":42699423,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNjk5NDIz","user":{"login":"cvializ","id":2363700,"node_id":"MDQ6VXNlcjIzNjM3MDA=","avatar_url":"https://avatars2.githubusercontent.com/u/2363700?v=4","gravatar_id":"","url":"https://api.github.com/users/cvializ","html_url":"https://github.com/cvializ","followers_url":"https://api.github.com/users/cvializ/followers","following_url":"https://api.github.com/users/cvializ/following{/other_user}","gists_url":"https://api.github.com/users/cvializ/gists{/gist_id}","starred_url":"https://api.github.com/users/cvializ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cvializ/subscriptions","organizations_url":"https://api.github.com/users/cvializ/orgs","repos_url":"https://api.github.com/users/cvializ/repos","events_url":"https://api.github.com/users/cvializ/events{/privacy}","received_events_url":"https://api.github.com/users/cvializ/received_events","type":"User","site_admin":false},"created_at":"2014-05-09T18:40:40Z","updated_at":"2014-05-09T18:40:40Z","author_association":"NONE","body":"Thank you, that helps a lot!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/42830727","html_url":"https://github.com/elastic/elasticsearch/issues/6110#issuecomment-42830727","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6110","id":42830727,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODMwNzI3","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2014-05-12T13:22:54Z","updated_at":"2014-05-12T13:22:54Z","author_association":"MEMBER","body":"Glad to hear @cvializ !\n\nOne thing I missed is that you can also add the mappings to your template, that would make things nicely work without needing to manually create the index upfront:\n\n```\nPUT /accesscontrol/group/admin\n{\n    \"name\" : \"admin\",\n    \"hosts\" : [\"computer1\",\"computer2\",\"computer3\"]\n}\n\n\nPUT /_template/admin_group\n{\n    \"template\" : \"logstash-*\",\n    \"aliases\" : {        \n        \"template-admin-{index}\" : {\n            \"filter\" : {\n                \"terms\" : {\n                    \"host\" : {\n                        \"index\" : \"accesscontrol\",\n                        \"type\" : \"group\",\n                        \"id\" : \"admin\",\n                        \"path\" : \"hosts\"\n                    }\n                }\n            }\n        }\n    },\n    \"mappings\": {\n      \"example\" : {\n        \"properties\": {\n          \"host\" : {\n            \"type\" : \"string\"\n          }  \n        } \n      }\n    }\n}\n\n\nPOST /logstash-2014.05.09/example/1\n{\n    \"message\":\"my sample data\",\n    \"@version\":\"1\",\n    \"@timestamp\":\"2014-05-09T16:25:45.613Z\",\n    \"type\":\"example\",\n    \"host\":\"computer1\"\n}\n\n\nGET /template-admin-logstash-2014.05.09/_search\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/59479227","html_url":"https://github.com/elastic/elasticsearch/issues/6110#issuecomment-59479227","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6110","id":59479227,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NDc5MjI3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-10-17T08:03:05Z","updated_at":"2014-10-17T08:03:05Z","author_association":"CONTRIBUTOR","body":"Fixed by #6664\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62728624","html_url":"https://github.com/elastic/elasticsearch/issues/6110#issuecomment-62728624","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6110","id":62728624,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNzI4NjI0","user":{"login":"loren","id":42840,"node_id":"MDQ6VXNlcjQyODQw","avatar_url":"https://avatars2.githubusercontent.com/u/42840?v=4","gravatar_id":"","url":"https://api.github.com/users/loren","html_url":"https://github.com/loren","followers_url":"https://api.github.com/users/loren/followers","following_url":"https://api.github.com/users/loren/following{/other_user}","gists_url":"https://api.github.com/users/loren/gists{/gist_id}","starred_url":"https://api.github.com/users/loren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loren/subscriptions","organizations_url":"https://api.github.com/users/loren/orgs","repos_url":"https://api.github.com/users/loren/repos","events_url":"https://api.github.com/users/loren/events{/privacy}","received_events_url":"https://api.github.com/users/loren/received_events","type":"User","site_admin":false},"created_at":"2014-11-12T14:47:37Z","updated_at":"2014-11-12T14:47:37Z","author_association":"NONE","body":"I'm confused how this got fixed with #6664 and marked closed. Without @javanna 's workaround, @clintongormley 's slightly simplified recreation fails in 1.4.0 with \n\n``` json\n{\n   \"error\": \"ElasticsearchIllegalArgumentException[failed to parse filter for alias [template-admin-logstash-2014.05.09]]; nested: QueryParsingException[[logstash-2014.05.09] Strict field resolution and no field mapping can be found for the field with name [host]]; \",\n   \"status\": 400\n}\n```\n\nIf `host` is mapped explicitly in the logstash mapping, why can't the `admin_group` template make use of it?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/62730554","html_url":"https://github.com/elastic/elasticsearch/issues/6110#issuecomment-62730554","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6110","id":62730554,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNzMwNTU0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-12T14:58:35Z","updated_at":"2014-11-12T14:58:35Z","author_association":"CONTRIBUTOR","body":"@loren not following exactly.  In my example, the `host` field is **not** mapped explicitly in the logstash mapping.  The way to fix this is to add the `host` field into the template, eg:\n\n```\nDELETE _all\n\nPUT /accesscontrol/group/admin\n{\n    \"name\" : \"admin\",\n    \"hosts\" : [\"computer1\",\"computer2\",\"computer3\"]\n}\n\nPUT /_template/admin_group\n{\n    \"template\" : \"logstash-*\",\n    \"mappings\": {\n      \"example\": {\n        \"properties\": {\n          \"host\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\"\n          }\n        }\n      }\n    }, \n    \"aliases\" : {        \n        \"template-admin-{index}\" : {\n            \"filter\" : {\n                \"terms\" : {\n                    \"host\" : {\n                        \"index\" : \"accesscontrol\",\n                        \"type\" : \"group\",\n                        \"id\" : \"admin\",\n                        \"path\" : \"hosts\"\n                    }\n                }\n            }\n        }\n    }\n}\n\nPOST /logstash-2014.05.09/example/1\n{\n    \"message\":\"my sample data\",\n    \"@version\":\"1\",\n    \"@timestamp\":\"2014-05-09T16:25:45.613Z\",\n    \"type\":\"example\",\n    \"host\":\"computer1\"\n}\n```\n","performed_via_github_app":null}]