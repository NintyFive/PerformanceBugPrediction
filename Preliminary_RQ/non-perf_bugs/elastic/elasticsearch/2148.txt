{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2148","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2148/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2148/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2148/events","html_url":"https://github.com/elastic/elasticsearch/issues/2148","id":6091838,"node_id":"MDU6SXNzdWU2MDkxODM4","number":2148,"title":"shardFailures in SearchResponse showing from previous query","user":{"login":"lmader","id":730149,"node_id":"MDQ6VXNlcjczMDE0OQ==","avatar_url":"https://avatars0.githubusercontent.com/u/730149?v=4","gravatar_id":"","url":"https://api.github.com/users/lmader","html_url":"https://github.com/lmader","followers_url":"https://api.github.com/users/lmader/followers","following_url":"https://api.github.com/users/lmader/following{/other_user}","gists_url":"https://api.github.com/users/lmader/gists{/gist_id}","starred_url":"https://api.github.com/users/lmader/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lmader/subscriptions","organizations_url":"https://api.github.com/users/lmader/orgs","repos_url":"https://api.github.com/users/lmader/repos","events_url":"https://api.github.com/users/lmader/events{/privacy}","received_events_url":"https://api.github.com/users/lmader/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"assignees":[{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2012-08-07T23:31:38Z","updated_at":"2013-11-02T08:44:42Z","closed_at":"2013-11-02T08:44:42Z","author_association":"NONE","active_lock_reason":null,"body":"Steps to repro issue with the shardFailures array showing msgs from a previous (not current) query:\n\n1) create something\ncurl -XPUT localhost:9200/acme/blog/1111 -d '{\"message\":\"foo\"}'\n\n2) execute this query - it should succeed\ncurl -XGET localhost:9200/acme/blog/_search -d '{\"query\":{\"field\":{\"message\":\"foo\"}}}'\n\n3) this is an invalid query and is expected to fail\ncurl -XGET localhost:9200/acme/blog/_search -d '{\"foobar\":{\"message\":\"foo\"}}'\n\n4) now rerun the query from step 2. This query succeeds, and returns the hits, but also shows the shardFailures from the failed query in step 3\ncurl -XGET localhost:9200/acme/blog/_search -d '{\"query\":{\"field\":{\"message\":\"foo\"}}}'\n\nHere is the output I get from step 4)  :\n\n{\"took\":3,\"timed_out\":false,\"_shards\":{\"total\":5,\"successful\":5,\"failed\":0,\"failures\":[{\"index\":\"acme\",\"shard\":1,\"status\":400,\"reason\":\"SearchParseException[[acme][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"foobar\\\":{\\\"message\\\":\\\"foo\\\"}}]]]; nested: SearchParseException[[acme][1]: from[-1],size[-1]: Parse Failure [No parser for element [foobar]]]; \"},{\"index\":\"acme\",\"shard\":0,\"status\":400,\"reason\":\"SearchParseException[[acme][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"foobar\\\":{\\\"message\\\":\\\"foo\\\"}}]]]; nested: SearchParseException[[acme][0]: from[-1],size[-1]: Parse Failure [No parser for element [foobar]]]; \"},{\"index\":\"acme\",\"shard\":4,\"status\":400,\"reason\":\"SearchParseException[[acme][4]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\\"foobar\\\":{\\\"message\\\":\\\"foo\\\"}}]]]; nested: SearchParseException[[acme][4]: from[-1],size[-1]: Parse Failure [No parser for element [foobar]]]; \"}]},\"hits\":{\"total\":1,\"max_score\":1.6931472,\"hits\":[{\"_index\":\"acme\",\"_type\":\"blog\",\"_id\":\"1111\",\"_score\":1.6931472, \"_source\" : {\"message\" : \"foo\" }}]}}\n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}