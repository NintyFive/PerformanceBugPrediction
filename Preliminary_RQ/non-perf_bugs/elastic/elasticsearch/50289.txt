{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50289","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50289/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50289/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50289/events","html_url":"https://github.com/elastic/elasticsearch/issues/50289","id":539254983,"node_id":"MDU6SXNzdWU1MzkyNTQ5ODM=","number":50289,"title":"Cluster Yellow with master not discovered error and other errors after 7.4 upgrade","user":{"login":"angelpunn","id":44981560,"node_id":"MDQ6VXNlcjQ0OTgxNTYw","avatar_url":"https://avatars3.githubusercontent.com/u/44981560?v=4","gravatar_id":"","url":"https://api.github.com/users/angelpunn","html_url":"https://github.com/angelpunn","followers_url":"https://api.github.com/users/angelpunn/followers","following_url":"https://api.github.com/users/angelpunn/following{/other_user}","gists_url":"https://api.github.com/users/angelpunn/gists{/gist_id}","starred_url":"https://api.github.com/users/angelpunn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/angelpunn/subscriptions","organizations_url":"https://api.github.com/users/angelpunn/orgs","repos_url":"https://api.github.com/users/angelpunn/repos","events_url":"https://api.github.com/users/angelpunn/events{/privacy}","received_events_url":"https://api.github.com/users/angelpunn/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-12-17T19:06:49Z","updated_at":"2019-12-18T02:22:02Z","closed_at":"2019-12-18T02:22:02Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.4\r\n\r\n**Plugins installed**: none\r\n\r\n**JVM version** (`java -version`):11.0.5\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): aws ec2 linux\r\n\r\n**Description of the problem including expected versus actual behavior**: Our cluster keeps going into yellow state mentioning that master not discovered this started happening after we moved to 7.4. We have tried everything including increasing capacity we have around 180 data nodes and 3 master nodes. \r\n\r\n**Provide logs (if relevant)**:\r\n\r\nwe are seeing these logs when the cluster goes into yellow:\r\n\r\n[2019-12-17T18:05:23,358][WARN ][o.e.a.s.TransportClearScrollAction] [query-0-17x.xx.xx.x]Clear SC failed on node[{data-0-172.30.201.95}{IWIzDcbLSIu0JSBBrdM9lw}{WGxWMOG2S86b2ltx2ANgeQ}{}{host=17x.xx.xx rack_id=us-east-1a, ml.machine_memory=64385785856, ml.max_open_jobs=20, xpack.installed=true}]\r\norg.elasticsearch.transport.RemoteTransportException: [data-0-172.xx.xx][[indices:data/read/search[free_context/scroll]]\r\nCaused by: org.elasticsearch.common.breaker.CircuitBreakingException: [parent] Data too large, data for [<transport_request>] would be [31961865140/29.7gb], which is larger than the limit of [30386474188/28.2gb], real usage: [31961864696/29.7gb], new bytes reserved: [444/444b], usages [request=0/0b, fielddata=21490892/20.4mb, in_flight_requests=444/444b, accounting=4658750179/4.3gb]\r\n\tat org.elasticsearch.indices.breaker.HierarchyCircuitBreakerService.checkParentLimit(HierarchyCircuitBreakerService.java:343) ~[elasticsearch-7.4.1.jar:7.4.1]\r\n\r\n2019-12-17T18:07:54,493][WARN ][o.e.c.NodeConnectionsService] [master-0-xx.xx.xx]failed to connect to {data-0-1xx.xx.xx}{lfhAg0FlRae3DVGeavemyQ}{TRxRnfcZTIaxGvXS6NLxFg}}{host=17x.xx.xx rack_id=us-east-1b, ml.machine_memory=73758015488, ml.max_open_jobs=20, xpack.installed=true} (tried [1] times)\r\norg.elasticsearch.transport.ConnectTransportException: [data-0-172..xxxx] connect_exception\r\n\tat org.elasticsearch.transport.TcpTransport$ChannelsConnectedListener.onFailure(TcpTransport.java:976) ~[elasticsearch-7.4.1.jar:7.4.1]\r\n\tat org.elasticsearch.action.ActionListener.lambda$toBiConsumer$3(ActionListener.java:161) ~[elasticsearch-7.4.1.jar:7.4.1]\r\n\tat org.elasticsearch.common.concurrent.CompletableContext.lambda$addListener$0(CompletableContext.java:42) ~[elasticsearch-core-7.4.1.jar:7.4.1]\r\n\r\n[2019-12-17T18:05:24,237][WARN ][o.e.c.r.a.AllocationService] [master-0-172.xx.xx.xx]failing shard [failed shard, shard [complete-tagged-2019-12-v2][131], node[IWIzDcbLSIu0JSBBrdM9lw], [R], s[STARTED], a[id=XhQMwYoCTPuqZ5MlXSHRdg], message [failed to perform indices:data/write/bulk[s] on replica [complete-tagged-2019-12-v2][131], node[IWIzDcbLSIu0JSBBrdM9lw], [R], s[STARTED], a[id=XhQMwYoCTPuqZ5MlXSHRdg]], failure [RemoteTransportException[[data-0-172.30.201.95][172.30.201.95:9300][indices:data/write/bulk[s][r]]]; nested: CircuitBreakingException[[parent] Data too large, data for [<transport_request>] would be [30519071200/28.4gb], which is larger than the limit of [30386474188/28.2gb], real usage: [30519024120/28.4gb], new bytes reserved: [47080/45.9kb], usages [request=0/0b, fielddata=21490892/20.4mb, in_flight_requests=47520/46.4kb, accounting=4658686279/4.3gb]]; ], markAsStale [true]]\r\n\r\n\r\n\r\n  | Dec 17 12:43:44.236 | i-0a8b8e974fc8db3b6 | elasticsearch |   | [2019-12-17T17:43:44,236][WARN ][o.e.c.c.ClusterFormationFailureHelper] [query-0-1xx.xx.xx]master not discovered yet: have discovered [{query-0-172.30.201.187}{y_8CAEETRHmGnl-Vptim-A}{dgnRXCGkRbiTNsWVQyGpaA}{17xx.xx.xx}{1xx.xx.xx:xxx}{il}{rack_id=us-east-1a, ml.machine_memory=133658669056, xpack.installed=true, host=17xx.xx.xx, ml.max_open_jobs=20}, {master-0-1xx.xx.xx}{UJpnhA0oQLWyxeT2B8NiDA}{oBTXtCl0RNuKGIHAFhPMcA}","closed_by":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"performed_via_github_app":null}