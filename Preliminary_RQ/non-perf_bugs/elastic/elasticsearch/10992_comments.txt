[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/99377264","html_url":"https://github.com/elastic/elasticsearch/issues/10992#issuecomment-99377264","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10992","id":99377264,"node_id":"MDEyOklzc3VlQ29tbWVudDk5Mzc3MjY0","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2015-05-06T08:26:38Z","updated_at":"2015-05-06T08:26:38Z","author_association":"MEMBER","body":"I think the problem is query templates can really only deal with string parameters, because in order to fill in template parameters can only be described in strings. I think what we need to do is \"pass through\" the type, so running your query template with this should work:\n\n```\nGET /_search\n{\n    \"query\": {\n        \"template\": {\n            \"query\": ..., \n            \"params\" : {\n                \"foo\" : 10\n            }\n        }\n    }\n}\n```\n\nHowever, at a quick glance it doesn't seem like mustache has this ability. @uboness any ideas?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100212571","html_url":"https://github.com/elastic/elasticsearch/issues/10992#issuecomment-100212571","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10992","id":100212571,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDIxMjU3MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-05-08T12:07:27Z","updated_at":"2015-05-08T12:07:27Z","author_association":"CONTRIBUTOR","body":"This works as long as the template is saved as a file, eg: save this as `config/scripts/test.mustache`:\n\n```\n{\n  \"script_fields\": {\n    \"FIELD\": {\n      \"script\": \"param + 123\",\n      \"lang\": \"expression\",\n      \"params\": {\n        \"param\": {{param}}\n      }\n    }\n  }\n}\n```\n\nThen this request works:\n\n```\nGET _search/template\n{\n  \"template\": \"test\",\n  \"params\": {\n    \"param\": 10\n  }\n}\n```\n\nIt also works when storing the template in .scripts index as a string:\n\n```\nPOST _search/template/x\n{\n  \"template\": \"{  \\\"script_fields\\\": {    \\\"FIELD\\\": {      \\\"script\\\": \\\"param + 123\\\",      \\\"lang\\\": \\\"expression\\\",      \\\"params\\\": {        \\\"param\\\": {{param}}      }    }  }}\"\n}\n```\n\nHowever, passing the same script as an inline string doesn't:\n\n```\nGET _search/template\n{\n  \"template\": \"{  \\\"script_fields\\\": {    \\\"FIELD\\\": {      \\\"script\\\": \\\"param + 123\\\",      \\\"lang\\\": \\\"expression\\\",      \\\"params\\\": {        \\\"param\\\": {{param}}      }    }  }}\",\n  \"params\": {\n    \"param\": 1\n  }\n}\n```\n\nThrows this exception:\n\n```\nFailed to parse template]; nested: JsonParseException[Unexpected character ('{' (code 123)): was expecting either valid name character (for unquoted name) or double-quote (for quoted) to start field name\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100213270","html_url":"https://github.com/elastic/elasticsearch/issues/10992#issuecomment-100213270","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10992","id":100213270,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDIxMzI3MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-05-08T12:12:11Z","updated_at":"2015-05-08T12:12:11Z","author_association":"CONTRIBUTOR","body":"@MaineC is this related to #8393?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/108427901","html_url":"https://github.com/elastic/elasticsearch/issues/10992#issuecomment-108427901","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10992","id":108427901,"node_id":"MDEyOklzc3VlQ29tbWVudDEwODQyNzkwMQ==","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"created_at":"2015-06-03T13:50:12Z","updated_at":"2015-06-03T13:50:12Z","author_association":"MEMBER","body":"@clintongormley I just tested your steps on master and the new script API logic has resolved the issue, inline, file and index templates work with your template content using both the new API and the old one.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206881726","html_url":"https://github.com/elastic/elasticsearch/issues/10992#issuecomment-206881726","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10992","id":206881726,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjg4MTcyNg==","user":{"login":"gkozyryatskyy","id":7124946,"node_id":"MDQ6VXNlcjcxMjQ5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7124946?v=4","gravatar_id":"","url":"https://api.github.com/users/gkozyryatskyy","html_url":"https://github.com/gkozyryatskyy","followers_url":"https://api.github.com/users/gkozyryatskyy/followers","following_url":"https://api.github.com/users/gkozyryatskyy/following{/other_user}","gists_url":"https://api.github.com/users/gkozyryatskyy/gists{/gist_id}","starred_url":"https://api.github.com/users/gkozyryatskyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gkozyryatskyy/subscriptions","organizations_url":"https://api.github.com/users/gkozyryatskyy/orgs","repos_url":"https://api.github.com/users/gkozyryatskyy/repos","events_url":"https://api.github.com/users/gkozyryatskyy/events{/privacy}","received_events_url":"https://api.github.com/users/gkozyryatskyy/received_events","type":"User","site_admin":false},"created_at":"2016-04-07T12:55:38Z","updated_at":"2016-04-07T12:57:48Z","author_association":"NONE","body":"@colings86 \nThis \n\n`curl -XPOST localhost:9200/_scripts/mustache/scr1 -d '{\"template\" : { \"size\" : {{size}} }}'`\n\nstill throws an exception\n\n`{\n   \"error\":{\n      \"root_cause\":[\n         {\n            \"type\":\"illegal_argument_exception\",\n            \"reason\":\"failed to parse template script\"\n         }\n      ],\n      \"type\":\"illegal_argument_exception\",\n      \"reason\":\"failed to parse template script\",\n      \"caused_by\":{\n         \"type\":\"json_parse_exception\",\n         \"reason\":\"Unexpected character ('{' (code 123)): was expecting either valid name character (for unquoted name) or double-quote (for quoted) to start field name\\n at [Source: [B@8133db3; line: 1, column: 28]\"\n      }\n   },\n   \"status\":400\n}\n`\n\nelasticsearch 2.2.0\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206977893","html_url":"https://github.com/elastic/elasticsearch/issues/10992#issuecomment-206977893","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10992","id":206977893,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjk3Nzg5Mw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-07T16:19:34Z","updated_at":"2016-04-07T16:19:34Z","author_association":"CONTRIBUTOR","body":"@gkozyryatskyy your exception has nothing to do with this issue. You are passing invalid JSON, so you need to pass your template as a string instead.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/209911906","html_url":"https://github.com/elastic/elasticsearch/issues/10992#issuecomment-209911906","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10992","id":209911906,"node_id":"MDEyOklzc3VlQ29tbWVudDIwOTkxMTkwNg==","user":{"login":"gkozyryatskyy","id":7124946,"node_id":"MDQ6VXNlcjcxMjQ5NDY=","avatar_url":"https://avatars3.githubusercontent.com/u/7124946?v=4","gravatar_id":"","url":"https://api.github.com/users/gkozyryatskyy","html_url":"https://github.com/gkozyryatskyy","followers_url":"https://api.github.com/users/gkozyryatskyy/followers","following_url":"https://api.github.com/users/gkozyryatskyy/following{/other_user}","gists_url":"https://api.github.com/users/gkozyryatskyy/gists{/gist_id}","starred_url":"https://api.github.com/users/gkozyryatskyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gkozyryatskyy/subscriptions","organizations_url":"https://api.github.com/users/gkozyryatskyy/orgs","repos_url":"https://api.github.com/users/gkozyryatskyy/repos","events_url":"https://api.github.com/users/gkozyryatskyy/events{/privacy}","received_events_url":"https://api.github.com/users/gkozyryatskyy/received_events","type":"User","site_admin":false},"created_at":"2016-04-14T12:21:00Z","updated_at":"2016-04-14T12:21:00Z","author_association":"NONE","body":"@clintongormley Thx for you reply. I understand the problem, but is there any other api to pass templates with out json validation? Now Im using java api PutIndexedScriptRequestBuilder.\n","performed_via_github_app":null}]