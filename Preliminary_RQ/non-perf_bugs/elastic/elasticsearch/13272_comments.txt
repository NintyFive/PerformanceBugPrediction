[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137143400","html_url":"https://github.com/elastic/elasticsearch/issues/13272#issuecomment-137143400","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13272","id":137143400,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzE0MzQwMA==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T15:58:08Z","updated_at":"2015-09-02T15:58:08Z","author_association":"CONTRIBUTOR","body":"I am a little confused about the example, is it because of the query/filter refactoring for 2.0?\n\nHistorically, setting boost on `filtered` should work as lucene's FilteredQuery supported that (and multiplied the boost into the inner weight itself).\n\nBut now filtered is really gone, its replaced by BooleanQuery. So IMO that boost on `filtered` should be applied to booleanquery which is the implementation of `filtered`\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137148811","html_url":"https://github.com/elastic/elasticsearch/issues/13272#issuecomment-137148811","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13272","id":137148811,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzE0ODgxMQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T16:14:31Z","updated_at":"2015-09-02T16:14:31Z","author_association":"CONTRIBUTOR","body":"> The example above contains for instance a single term query, so the final lucene query will simply be a term query (rather than a filtered query), but what should the boost be?\n\nWhy wouldn't it be a filtered query? (or rather a boolean query now) This is something that query rewriting will happily simplify when rewriting the query (single-clause boolean queries rewrite to the wrapped clause, and merge boosts by multiplying them) so I don't think we should try to optimize things at parsing time?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137181122","html_url":"https://github.com/elastic/elasticsearch/issues/13272#issuecomment-137181122","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13272","id":137181122,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzE4MTEyMg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T17:33:01Z","updated_at":"2015-09-02T17:33:01Z","author_association":"MEMBER","body":"sorry the main example was around filtered query which is deprecated now, but this is not caused by the filter refactoring, it is not a lucene issue at all, it is something that we do in elasticsearch while parsing queries and converting them back to lucene queries... have a look [here](https://github.com/elastic/elasticsearch/blob/master/core/src/main/java/org/elasticsearch/index/query/FilteredQueryParser.java#L97) for instance. From your answers I would say we should fix the filtered query to always create a boolean query under the hood. That sounds good to me.\n\nquery_string seems to behave correctly by manually multiplying the boost parsed from the query and the boost set to the query.\n\nOther cases where we might have a similar problem are wrapper query (available only in the java api),  query filter (deprecated) and template queries. Those are all wrapper for queries, but they do allow to specify a boost (new in query-refactoring branch), so you might end up with the main boost and the boost of the inner query, which will become the actual lucene query. I don't know yet what we should do with those boosts, although I realize that this is an edge case and it doesn't make much sense to set the boost to some wrapper query...\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137222129","html_url":"https://github.com/elastic/elasticsearch/issues/13272#issuecomment-137222129","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13272","id":137222129,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzIyMjEyOQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-09-02T19:34:20Z","updated_at":"2015-09-02T19:34:20Z","author_association":"CONTRIBUTOR","body":"> sorry the main example was around filtered query which is deprecated now, but this is not caused by the filter refactoring, it is not a lucene issue at all, it is something that we do in elasticsearch while parsing queries and converting them back to lucene queries... have a look here for instance. From your answers I would say we should fix the filtered query to always create a boolean query under the hood. That sounds good to me.\n\nok I get it. Looks like we do a lot of \"rewrite()\" type logic in the parser itself and it has some bugs where it drops boosts. I just see that as a bug: in general for cases like that, multiply the boosts. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137532382","html_url":"https://github.com/elastic/elasticsearch/issues/13272#issuecomment-137532382","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13272","id":137532382,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzUzMjM4Mg==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2015-09-03T18:14:58Z","updated_at":"2015-09-03T18:14:58Z","author_association":"CONTRIBUTOR","body":"@javanna Can it be closed now that #13312 is merged or is there more stuff to do?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/137534152","html_url":"https://github.com/elastic/elasticsearch/issues/13272#issuecomment-137534152","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13272","id":137534152,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNzUzNDE1Mg==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-09-03T18:22:32Z","updated_at":"2015-09-03T18:22:32Z","author_association":"MEMBER","body":"@jpountz I have a little more things to do, will close when done\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/138610737","html_url":"https://github.com/elastic/elasticsearch/issues/13272#issuecomment-138610737","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13272","id":138610737,"node_id":"MDEyOklzc3VlQ29tbWVudDEzODYxMDczNw==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-09-08T16:01:08Z","updated_at":"2015-09-08T16:01:08Z","author_association":"MEMBER","body":"We can close this now.\n","performed_via_github_app":null}]