{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9816","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9816/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9816/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9816/events","html_url":"https://github.com/elastic/elasticsearch/issues/9816","id":58587592,"node_id":"MDU6SXNzdWU1ODU4NzU5Mg==","number":9816,"title":"Incorrect query at start makes some aggregations stop working","user":{"login":"ltworf","id":1379609,"node_id":"MDQ6VXNlcjEzNzk2MDk=","avatar_url":"https://avatars1.githubusercontent.com/u/1379609?v=4","gravatar_id":"","url":"https://api.github.com/users/ltworf","html_url":"https://github.com/ltworf","followers_url":"https://api.github.com/users/ltworf/followers","following_url":"https://api.github.com/users/ltworf/following{/other_user}","gists_url":"https://api.github.com/users/ltworf/gists{/gist_id}","starred_url":"https://api.github.com/users/ltworf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ltworf/subscriptions","organizations_url":"https://api.github.com/users/ltworf/orgs","repos_url":"https://api.github.com/users/ltworf/repos","events_url":"https://api.github.com/users/ltworf/events{/privacy}","received_events_url":"https://api.github.com/users/ltworf/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":5,"created_at":"2015-02-23T13:50:54Z","updated_at":"2015-12-14T20:09:08Z","closed_at":"2015-12-14T20:09:08Z","author_association":"NONE","active_lock_reason":null,"body":"It took me a little while to narrow down this bug.\n\nI have a cluster with various indexes and types, and I have a query that performs aggregations, that only works on one index/type and fails miserably if executed on anything else.\n\nThis is the query I use:\n\n```\n{\n  \"aggs\": {\n    \"genre\": {\n      \"scripted_metric\": {\n        \"init_script\": \"_agg.genre = [:]\",\n        \"map_script\": \"genres=doc['genre'][0].split('/'); for (i=0; i<genres.size(); i++) _agg.genre.put(genres[i],_agg.genre.get (genres[i],0)+1)\",\n        \"reduce_script\": \"retval = [:];for (i in 0.._aggs.genre.size()) {for ( e in _aggs.genre[i] ) {retval.put(e.key,retval.get(e.key,0)+e.value)}};return retval;\"\n      }\n    },\n    \"decade\": {\n      \"scripted_metric\": {\n        \"init_script\": \"_agg.decade = [:]\",\n        \"map_script\": \"try {dec = ((doc['releasedYear'][0].toInteger()/10).toInteger()*10).toString();_agg.decade.put(dec,_agg.decade.get(dec,0)+1);} catch (e) {}\",\n        \"reduce_script\": \"retval = [:];for (i in 0.._aggs.decade.size()) {for ( e in _aggs.decade[i] ) {retval.put(e.key,retval.get(e.key,0)+e.value)}}; retval.remove('0'); return retval;\"\n      }\n    },\n    \"movieRating\": {\n      \"terms\": {\n        \"field\": \"movieRating\"\n      }\n    },\n    \"releasedYear\": {\n      \"terms\": {\n        \"field\": \"releasedYear\"\n      }\n    }\n  },\n  \"query\": {\n    \"filtered\": {\n      \"filter\": {},\n      \"query\": {\n        \"match_all\": {}\n      }\n    }\n  }\n}\n```\n\nAnd this is an example of document inside the type\n\n```\n{\n\"_index\": \"edge\",\n\"_type\": \"AssetsDetails\",\n\"_id\": \"10026\",\n\"_score\": 1,\n\"_source\": {\n\"_id\": 10026,\n\"fantasyViolence\": false,\n\"assetType\": \"FTP\",\n\"castFirstName\": [\n\"James Buchli\"\n,\n\" Toni Myers\"\n],\n\"closedCaption\": true,\n\"contentId\": 10026,\n\"contentType\": \"ASSET\",\n\"createDate\": 1422669583,\n\"creditsFirstName\": [ ],\n\"description\": \"From the unique vantage point of 200 miles above Earth's surface, we see how natural forces - volcanoes, earthquakes and hurricanes - affect our world, and how a powerful new force - humankind - has begun to alter the face of the planet. From Amazon rain forests to Serengeti grasslands, Blue Planet inspires a new appreciation of life on Earth, our only home.\",\n\"distributor\": \"someone\",\n\"dolbyStereo\": false,\n\"downloadAllowed\": true,\n\"encodingType\": \"MPEG-2 TS\",\n\"encripted\": false,\n\"endVodDate\": 2019686400,\n\"episodeTitle\": \"\",\n\"genre\": \"Documentary/Short\",\n\"hd\": true,\n\"isSubscriptionPart\": true,\n\"language\": false,\n\"madefortv\": false,\n\"modifyDate\": 1422669583,\n\"movieRating\": \"G\",\n\"movieRatingId\": 2,\n\"price\": 199,\n\"protocol\": \"HLS\",\n\"providerassetid\": \"ZVOD2013100819121602\",\n\"reducedDesc\": \"From the unique vantage point of 200 miles above Earth's surface, we see how natural forces - volcanoes, earthquakes and hurricanes - affect our world, and how a powerful new force - humankind - has begun to alter the face of the planet. From Amazon rain forests to Serengeti grasslands, Blue Planet inspires a new appreciation of life on Earth, our only home.\",\n\"reducedTitle\": \"IMAX - Blue Planet\",\n\"releasedYear\": \"1990\",\n\"rentTime\": 2,\n\"resourceId\": 144,\n\"rtsp\": true,\n\"runtime\": 2400,\n\"sexRating\": false,\n\"spFile\": \"http://192.168.9.12/inside_job/inside_job_36.m3u8\",\n\"sppath\": \"\",\n\"startVodDate\": 1293840000,\n\"startvodsetdate\": 1293840000,\n\"startvodsetid\": 2,\n\"status\": true,\n\"studioroyaltyflatrate\": 0,\n\"studioroyaltyminimum\": 0,\n\"studioroyaltypercent\": 0,\n\"subtitleLanguage\": \"\",\n\"suggestiveDialog\": false,\n\"supplierid\": -1,\n\"imageId\": 21,\n\"title\": \"6_IMAX Blue Planet\",\n\"trickPlay\": true,\n\"tvRatingId\": -1,\n\"tvnAssetId\": \"6_ZVOD2013100819121601\",\n\"tvnassetname\": \"IMAX_Blue_Planet_title\",\n\"tvnbillingid\": \"927278\",\n\"tvnprovider\": \"\",\n\"tvnprovidercontenttier\": 0,\n\"tvnproviderid\": \"\",\n\"tvnsuggestedprice\": 199,\n\"tvnversionmajor\": 1,\n\"tvnversionminor\": 0,\n\"customerassettype\": \"MOD\",\n\"version\": 1,\n\"violence\": false,\n\"vsFile\": \"http://192.168.9.12/inside_job/inside_job_36.m3u8\",\n\"uri\": \"\",\n\"serverIp\": \"hlsurl\",\n\"serverPort\": \"0\",\n\"serverType\": \"HLS\"\n}\n}\n```\n\nNow the problem is that if I try to run the query on `/`, I will get some exceptions\n\n```\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.06][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,741][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.09][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.09][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,748][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.18][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.18][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,754][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.12][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.12][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,769][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.19][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.19][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,770][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.16][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.16][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,776][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.13][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.13][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,788][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.23][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.23][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,862][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.11][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.11][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,864][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.10][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.10][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:34,869][DEBUG][action.search.type       ] [Dark Beast] [.marvel-2015.02.20][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [.marvel-2015.02.20][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: ElasticsearchIllegalArgumentException[No field found for [genre] in mapping with types []]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:35,070][DEBUG][action.search.type       ] [Dark Beast] [edge][0], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [edge][0]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: NullPointerException[Cannot invoke method split() on null object]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:35,081][DEBUG][action.search.type       ] [Dark Beast] [edge][4], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [edge][4]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: NullPointerException[Cannot invoke method split() on null object]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:35,086][DEBUG][action.search.type       ] [Dark Beast] [edge][1], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [edge][1]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: NullPointerException[Cannot invoke method split() on null object]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:35,088][DEBUG][action.search.type       ] [Dark Beast] [edge][2], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94] lastShard [true]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [edge][2]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: NullPointerException[Cannot invoke method split() on null object]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n[2015-02-23 14:41:35,099][DEBUG][action.search.type       ] [Dark Beast] [edge][3], node[OXjTmwuySZSw-isia4Yxbw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@3e4a3c94]\norg.elasticsearch.search.query.QueryPhaseExecutionException: [edge][3]: query[ConstantScore(*:*)],from[0],size[10]: Query Failed [Failed to execute main query]\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:163)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:275)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptExecutionException: NullPointerException[Cannot invoke method split() on null object]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService$GroovyScript.run(GroovyScriptEngineService.java:253)\n        at org.elasticsearch.search.aggregations.metrics.scripted.ScriptedMetricAggregator.collect(ScriptedMetricAggregator.java:96)\n        at org.elasticsearch.search.aggregations.AggregationPhase$AggregationsCollector.collect(AggregationPhase.java:161)\n        at org.elasticsearch.common.lucene.MultiCollector.collect(MultiCollector.java:60)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.scoreAll(Weight.java:193)\n        at org.apache.lucene.search.Weight$DefaultBulkScorer.score(Weight.java:163)\n        at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:35)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:621)\n        at org.elasticsearch.search.internal.ContextIndexSearcher.search(ContextIndexSearcher.java:191)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:491)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:448)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:281)\n        at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:269)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:157)\n        ... 7 more\n```\n\nAfter the exceptions, if I run the query on the correct index/type, the aggregations on the years and decades will work fine, however if I run the query on `/` as first thing after starting elasticsearch, then subsequent correct queries will fail to aggregate years and decades, which will only contain empty data structures in the response.\n\nLet me know if you need more information.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}