{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4297","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4297/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4297/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4297/events","html_url":"https://github.com/elastic/elasticsearch/issues/4297","id":23479677,"node_id":"MDU6SXNzdWUyMzQ3OTY3Nw==","number":4297,"title":"has_child filter yields inconsistent results when the number of child docs are high","user":{"login":"joelabrahamsson","id":218986,"node_id":"MDQ6VXNlcjIxODk4Ng==","avatar_url":"https://avatars2.githubusercontent.com/u/218986?v=4","gravatar_id":"","url":"https://api.github.com/users/joelabrahamsson","html_url":"https://github.com/joelabrahamsson","followers_url":"https://api.github.com/users/joelabrahamsson/followers","following_url":"https://api.github.com/users/joelabrahamsson/following{/other_user}","gists_url":"https://api.github.com/users/joelabrahamsson/gists{/gist_id}","starred_url":"https://api.github.com/users/joelabrahamsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joelabrahamsson/subscriptions","organizations_url":"https://api.github.com/users/joelabrahamsson/orgs","repos_url":"https://api.github.com/users/joelabrahamsson/repos","events_url":"https://api.github.com/users/joelabrahamsson/events{/privacy}","received_events_url":"https://api.github.com/users/joelabrahamsson/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":13,"created_at":"2013-11-29T08:20:43Z","updated_at":"2013-12-04T22:46:16Z","closed_at":"2013-12-04T22:46:16Z","author_association":"NONE","active_lock_reason":null,"body":"Using 0.90.7 we've experienced the following: We have ~100K parent docs and ~1M child docs. We're essentially doing what's described here: http://joelabrahamsson.com/grouping-in-elasticsearch-using-child-documents/\n\nWhen searching for parent docs and filtering using has_child it works as expected when the has_child filter contains a filter that limits the possible child docs to ~200K. The same goes when the number of child docs in the index is lower. \n\nWhen we we however use the exact same query/filters with the exception that the has_child filter only limits the possible child docs to  > ~500K we start seeing results that can't possibly be right. Also, when we run the same query again it produces a different result.\n\nSo, it seems to me that when the number of child docs become large the search results become inconsistent. The result does not however contain any indication that something has gone wrong (10 shards, 10 successful).\n\nWe're using five small nodes where ES has 1GB memory on each. The relevant index has 10 shards and 1 replica.\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}