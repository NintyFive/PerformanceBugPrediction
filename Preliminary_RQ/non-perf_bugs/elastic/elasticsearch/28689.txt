{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28689","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28689/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28689/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28689/events","html_url":"https://github.com/elastic/elasticsearch/issues/28689","id":297388280,"node_id":"MDU6SXNzdWUyOTczODgyODA=","number":28689,"title":"org.elasticsearch.index.store.CorruptedFileIT.testReplicaCorruption fails on 6.2 on windows","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":152510590,"node_id":"MDU6TGFiZWwxNTI1MTA1OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Recovery","name":":Distributed/Recovery","color":"0e8a16","default":false,"description":"Anything around constructing a new shard, either from a local or a remote source."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"assignees":[{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2018-02-15T10:05:26Z","updated_at":"2018-02-15T10:14:07Z","closed_at":"2018-02-15T10:09:12Z","author_association":"MEMBER","active_lock_reason":null,"body":"Build URL: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.2+multijob-windows-compatibility/102/console\r\n\r\nReproduce command (does not reproduce locally):\r\n```\r\ngradlew :server:integTest -Dtests.seed=61D4E20F8D5605B4 -Dtests.class=org.elasticsearch.index.store.CorruptedFileIT -Dtests.method=\"testReplicaCorruption\" -Dtests.security.manager=true -Dtests.locale=et-EE -Dtests.timezone=Brazil/East\r\n```\r\n\r\nFailure output:\r\n```\r\n08:43:54   1> org.elasticsearch.indices.recovery.RecoveryFailedException: [test][0]: Recovery failed from {node_sd1}{jMzQ547AQtK1eI1DylRRKg}{vImfhP3OTz6oT5_UmkGF2w}{127.0.0.1}{127.0.0.1:57384} into {node_sd2}{FoLDzscZSWeK7uSKAA4zQA}{BlKZ2W1tQZ-7-gg_f63qMQ}{127.0.0.1}{127.0.0.1:57385}\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.doRecovery(PeerRecoveryTargetService.java:287) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService.access$900(PeerRecoveryTargetService.java:80) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$RecoveryRunner.doRun(PeerRecoveryTargetService.java:632) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:635) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[main/:?]\r\n08:43:54   1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_162]\r\n08:43:54   1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_162]\r\n08:43:54   1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_162]\r\n08:43:54   1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_sd1][127.0.0.1:57384][internal:index/shard/recovery/start_recovery]\r\n08:43:54   1> Caused by: org.elasticsearch.index.engine.RecoveryEngineException: Phase[1] prepare target for translog failed\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.RecoverySourceHandler.recoverToTarget(RecoverySourceHandler.java:194) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.recover(PeerRecoverySourceService.java:98) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService.access$000(PeerRecoverySourceService.java:50) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:107) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoverySourceService$StartRecoveryTransportRequestHandler.messageReceived(PeerRecoverySourceService.java:104) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1555) ~[main/:?]\r\n08:43:54   1> \t... 5 more\r\n08:43:54   1> Caused by: org.elasticsearch.transport.RemoteTransportException: [node_sd2][127.0.0.1:57385][internal:index/shard/recovery/prepare_translog]\r\n08:43:54   1> Caused by: org.elasticsearch.index.engine.EngineCreationFailureException: failed to create engine\r\n08:43:54   1> \tat org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:206) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:152) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:25) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.shard.IndexShard.newEngine(IndexShard.java:2163) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.shard.IndexShard.createNewEngine(IndexShard.java:2145) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:1376) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.shard.IndexShard.openIndexAndSkipTranslogRecovery(IndexShard.java:1342) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.RecoveryTarget.prepareForTranslogOperations(RecoveryTarget.java:371) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$PrepareForTranslogOperationsRequestHandler.messageReceived(PeerRecoveryTargetService.java:406) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$PrepareForTranslogOperationsRequestHandler.messageReceived(PeerRecoveryTargetService.java:400) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1555) ~[main/:?]\r\n08:43:54   1> \t... 5 more\r\n08:43:54   1> Caused by: org.elasticsearch.index.translog.TranslogCorruptedException: expected shard UUID [58 77 39 2d 4e 6e 41 76 54 44 32 79 7a 48 7a 54 63 6b 53 6a 64 41] but got: [6b 34 41 57 31 42 33 6f 52 74 6d 7a 45 62 4b 43 53 31 52 51 45 41] this translog file belongs to a different translog. path:C:\\Users\\jenkins\\workspace\\elastic+elasticsearch+6.2+multijob-windows-compatibility\\server\\build\\testrun\\integTest\\J2\\temp\\org.elasticsearch.index.store.CorruptedFileIT_61D4E20F8D5605B4-001\\tempDir-002\\data\\nodes\\1\\indices\\ADl5rMV4S4aeixiedoV5ag\\0\\translog\\translog-2.tlog\r\n08:43:54   1> \tat org.elasticsearch.index.translog.TranslogReader.open(TranslogReader.java:131) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.translog.Translog.openReader(Translog.java:292) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.translog.Translog.recoverFromFiles(Translog.java:238) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.translog.Translog.<init>(Translog.java:176) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.engine.InternalEngine.openTranslog(InternalEngine.java:523) ~[main/:?]\r\n08:43:54   2> REPRODUCE WITH: gradlew :server:integTest -Dtests.seed=61D4E20F8D5605B4 -Dtests.class=org.elasticsearch.index.store.CorruptedFileIT -Dtests.method=\"testReplicaCorruption\" -Dtests.security.manager=true -Dtests.locale=et-EE -Dtests.timezone=Brazil/East\r\n08:43:54 \r\n08:43:54   1> \tat org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:185) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.engine.InternalEngine.<init>(InternalEngine.java:152) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.engine.InternalEngineFactory.newReadWriteEngine(InternalEngineFactory.java:25) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.shard.IndexShard.newEngine(IndexShard.java:2163) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.shard.IndexShard.createNewEngine(IndexShard.java:2145) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.shard.IndexShard.innerOpenEngineAndTranslog(IndexShard.java:1376) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.index.shard.IndexShard.openIndexAndSkipTranslogRecovery(IndexShard.java:1342) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.RecoveryTarget.prepareForTranslogOperations(RecoveryTarget.java:371) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$PrepareForTranslogOperationsRequestHandler.messageReceived(PeerRecoveryTargetService.java:406) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.indices.recovery.PeerRecoveryTargetService$PrepareForTranslogOperationsRequestHandler.messageReceived(PeerRecoveryTargetService.java:400) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:30) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:66) ~[main/:?]\r\n08:43:54   1> \tat org.elasticsearch.transport.TcpTransport$RequestHandler.doRun(TcpTransport.java:1555) ~[main/:?]\r\n08:43:54   1> \t... 5 more\r\n```\r\n\r\n@dnhatn @ywelsch - @bleskes mentioned that this might be because recent relevant commits to fix this were only back-ported to 6.3 and might need to be back-ported to 6.2 as well?","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}