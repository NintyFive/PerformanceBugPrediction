{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/44479","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44479/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44479/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/44479/events","html_url":"https://github.com/elastic/elasticsearch/issues/44479","id":469057178,"node_id":"MDU6SXNzdWU0NjkwNTcxNzg=","number":44479,"title":"ReplicaToPrimaryPromotionIT.testPromoteReplicaToPrimary() fails","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"labels":[{"id":836542781,"node_id":"MDU6TGFiZWw4MzY1NDI3ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Engine","name":":Distributed/Engine","color":"0e8a16","default":false,"description":"Anything around managing Lucene and the Translog in an open shard."},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"},{"id":1194435738,"node_id":"MDU6TGFiZWwxMTk0NDM1NzM4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v8.0.0","name":"v8.0.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2019-07-17T08:29:30Z","updated_at":"2019-08-21T13:57:24Z","closed_at":"2019-08-21T13:57:23Z","author_association":"MEMBER","active_lock_reason":null,"body":"The test `testPromoteReplicaToPrimary()` failed today on CI:\r\nhttps://scans.gradle.com/s/k3fjyxepqf2kc\r\n\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :server:integTest --tests \"org.elasticsearch.indices.recovery.ReplicaToPrimaryPromotionIT.testPromoteReplicaToPrimary\" -Dtests.seed=74EB02FB45178972 -Dtests.security.manager=true -Dtests.locale=es-CL -Dtests.timezone=Asia/Harbin -Dcompiler.java=12 -Druntime.java=11\r\n--\r\n2> java.lang.AssertionError: CloseIndexResponse failed - not acked\r\nExpected: <true>\r\nbut: was <false>\r\nat __randomizedtesting.SeedInfo.seed([74EB02FB45178972:FE9BAE80DCAFA5B9]:0)\r\nat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)\r\nat org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked(ElasticsearchAssertions.java:110)\r\nat org.elasticsearch.test.hamcrest.ElasticsearchAssertions.assertAcked(ElasticsearchAssertions.java:98)\r\nat org.elasticsearch.indices.recovery.ReplicaToPrimaryPromotionIT.testPromoteReplicaToPrimary(ReplicaToPrimaryPromotionIT.java:60)\r\n\r\n```\r\n\r\nClosing the index was not acknowledged. It does not reproduce locally after multiple runs but I suspect that it happens on slower machines with a high number of shards and/or with async translog durability, and that the global checkpoint takes time to catch up with the max seq no on replicas when closing the index.\r\n\r\nWe could retry to close the index but before I'd like to add more log traces to get the full close index response to confirm my assumption.","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}