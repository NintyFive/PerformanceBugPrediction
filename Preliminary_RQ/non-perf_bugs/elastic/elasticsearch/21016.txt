{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21016","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21016/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21016/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21016/events","html_url":"https://github.com/elastic/elasticsearch/issues/21016","id":183927607,"node_id":"MDU6SXNzdWUxODM5Mjc2MDc=","number":21016,"title":"Insufficient encoding of Location http header","user":{"login":"weltenwort","id":973741,"node_id":"MDQ6VXNlcjk3Mzc0MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/973741?v=4","gravatar_id":"","url":"https://api.github.com/users/weltenwort","html_url":"https://github.com/weltenwort","followers_url":"https://api.github.com/users/weltenwort/followers","following_url":"https://api.github.com/users/weltenwort/following{/other_user}","gists_url":"https://api.github.com/users/weltenwort/gists{/gist_id}","starred_url":"https://api.github.com/users/weltenwort/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weltenwort/subscriptions","organizations_url":"https://api.github.com/users/weltenwort/orgs","repos_url":"https://api.github.com/users/weltenwort/repos","events_url":"https://api.github.com/users/weltenwort/events{/privacy}","received_events_url":"https://api.github.com/users/weltenwort/received_events","type":"User","site_admin":false},"labels":[{"id":152517143,"node_id":"MDU6TGFiZWwxNTI1MTcxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/REST%20API","name":":Core/Infra/REST API","color":"0e8a16","default":false,"description":"REST infrastructure and utilities"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-10-19T10:46:55Z","updated_at":"2016-12-19T20:56:10Z","closed_at":"2016-12-19T20:56:10Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 5.0.0-rc1\n\n**Plugins installed**: []\n\n**JVM version**: OpenJDK Runtime Environment (build 1.8.0_92-internal-alpine-r1-b14)\n\n**OS version**: Alpine Linux 3.4.0\n\n**Description of the problem including expected versus actual behavior**:\n\nThe `Location` HTTP header sent by ElasticSearch in response to `POST` or `PUT` requests is not a correctly encoded URL of the resource. This breaks down into two aspects:\n- Characters with codes between 128 and 255 are just included in the URL, which is acceptable according to RFC 5987, but can cause problems with clients that only support US-ASCII encoding in the header values as suggested by RFC 7230.\n- Unicode characters are replaced by a question mark, which would break clients that actually parse and use the value of the `Location` header.\n\nIn both cases a percent-encoded URL would solve the problem.\n\n**Steps to reproduce**:\n- Create a document with a non-US-ASCII id:\n\n```\n$ curl -XPUT --trace - 'http://localhost:9200/someindex/sometype/%C3%A4' -d '{}'\n[...]\n<= Recv header, 22 bytes (0x16)\n0000: 48 54 54 50 2f 31 2e 31 20 32 30 31 20 43 72 65 HTTP/1.1 201 Cre\n0010: 61 74 65 64 0d 0a                               ated..\n<= Recv header, 33 bytes (0x21)\n0000: 4c 6f 63 61 74 69 6f 6e 3a 20 2f 73 6f 6d 65 69 Location: /somei\n0010: 6e 64 65 78 2f 73 6f 6d 65 74 79 70 65 2f e4 0d ndex/sometype/..    <---\n0020: 0a                                              .\n<= Recv header, 47 bytes (0x2f)\n0000: 63 6f 6e 74 65 6e 74 2d 74 79 70 65 3a 20 61 70 content-type: ap\n0010: 70 6c 69 63 61 74 69 6f 6e 2f 6a 73 6f 6e 3b 20 plication/json;\n0020: 63 68 61 72 73 65 74 3d 55 54 46 2d 38 0d 0a    charset=UTF-8..\n<= Recv header, 21 bytes (0x15)\n0000: 63 6f 6e 74 65 6e 74 2d 6c 65 6e 67 74 68 3a 20 content-length:\n0010: 31 34 37 0d 0a                                  147..\n<= Recv header, 2 bytes (0x2)\n0000: 0d 0a                                           ..\n<= Recv data, 147 bytes (0x93)\n0000: 7b 22 5f 69 6e 64 65 78 22 3a 22 73 6f 6d 65 69 {\"_index\":\"somei\n0010: 6e 64 65 78 22 2c 22 5f 74 79 70 65 22 3a 22 73 ndex\",\"_type\":\"s\n0020: 6f 6d 65 74 79 70 65 22 2c 22 5f 69 64 22 3a 22 ometype\",\"_id\":\"\n0030: c3 a4 22 2c 22 5f 76 65 72 73 69 6f 6e 22 3a 33 ..\",\"_version\":3\n0040: 2c 22 72 65 73 75 6c 74 22 3a 22 63 72 65 61 74 ,\"result\":\"creat\n0050: 65 64 22 2c 22 5f 73 68 61 72 64 73 22 3a 7b 22 ed\",\"_shards\":{\"\n0060: 74 6f 74 61 6c 22 3a 32 2c 22 73 75 63 63 65 73 total\":2,\"succes\n0070: 73 66 75 6c 22 3a 31 2c 22 66 61 69 6c 65 64 22 sful\":1,\"failed\"\n0080: 3a 30 7d 2c 22 63 72 65 61 74 65 64 22 3a 74 72 :0},\"created\":tr\n0090: 75 65 7d                                        ue}\n```\n- Create a document with a non-ASCII id:\n\n```\n$ curl -XPUT --trace - 'http://localhost:9200/someindex/sometype/%E2%9D%A4' -d '{}'\n[...]\n<= Recv header, 22 bytes (0x16)\n0000: 48 54 54 50 2f 31 2e 31 20 32 30 31 20 43 72 65 HTTP/1.1 201 Cre\n0010: 61 74 65 64 0d 0a                               ated..\n<= Recv header, 33 bytes (0x21)\n0000: 4c 6f 63 61 74 69 6f 6e 3a 20 2f 73 6f 6d 65 69 Location: /somei\n0010: 6e 64 65 78 2f 73 6f 6d 65 74 79 70 65 2f 3f 0d ndex/sometype/?.    <---\n0020: 0a                                              .\n<= Recv header, 47 bytes (0x2f)\n0000: 63 6f 6e 74 65 6e 74 2d 74 79 70 65 3a 20 61 70 content-type: ap\n0010: 70 6c 69 63 61 74 69 6f 6e 2f 6a 73 6f 6e 3b 20 plication/json;\n0020: 63 68 61 72 73 65 74 3d 55 54 46 2d 38 0d 0a    charset=UTF-8..\n<= Recv header, 21 bytes (0x15)\n0000: 63 6f 6e 74 65 6e 74 2d 6c 65 6e 67 74 68 3a 20 content-length:\n0010: 31 34 39 0d 0a                                  149..\n<= Recv header, 2 bytes (0x2)\n0000: 0d 0a                                           ..\n<= Recv data, 149 bytes (0x95)\n0000: 7b 22 5f 69 6e 64 65 78 22 3a 22 73 6f 6d 65 69 {\"_index\":\"somei\n0010: 6e 64 65 78 22 2c 22 5f 74 79 70 65 22 3a 22 73 ndex\",\"_type\":\"s\n0020: 6f 6d 65 74 79 70 65 22 2c 22 5f 69 64 22 3a 22 ometype\",\"_id\":\"\n0030: e2 9d a4 22 2c 22 5f 76 65 72 73 69 6f 6e 22 3a ...\",\"_version\":\n0040: 31 30 2c 22 72 65 73 75 6c 74 22 3a 22 63 72 65 10,\"result\":\"cre\n0050: 61 74 65 64 22 2c 22 5f 73 68 61 72 64 73 22 3a ated\",\"_shards\":\n0060: 7b 22 74 6f 74 61 6c 22 3a 32 2c 22 73 75 63 63 {\"total\":2,\"succ\n0070: 65 73 73 66 75 6c 22 3a 31 2c 22 66 61 69 6c 65 essful\":1,\"faile\n0080: 64 22 3a 30 7d 2c 22 63 72 65 61 74 65 64 22 3a d\":0},\"created\":\n0090: 74 72 75 65 7d                                  true}\n```\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}