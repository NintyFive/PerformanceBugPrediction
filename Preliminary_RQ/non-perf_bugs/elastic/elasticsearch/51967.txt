{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51967","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51967/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51967/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51967/events","html_url":"https://github.com/elastic/elasticsearch/issues/51967","id":560678962,"node_id":"MDU6SXNzdWU1NjA2Nzg5NjI=","number":51967,"title":"Compound query","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"assignees":[{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-02-05T22:58:48Z","updated_at":"2020-02-18T15:51:03Z","closed_at":"2020-02-18T15:51:02Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"This is related to #42811 -- deprecating function_score query\r\n\r\nA proposal is to have a new type of  compound query that has an ability to combine scores from different queries:\r\n\r\n```js\r\n{\r\n  \"query\": {\r\n    \"compound\": {\r\n      \"queries\": [\r\n        {\r\n          \"match\": {\"message\": \"elasticsearch\"}\r\n        },\r\n        {\r\n         \"match\": {\"author\": \"shay banon\"}\r\n        }\r\n      ],\r\n      \"combine_mode\": \"sum\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\ncombine_mode has the same values and definitions as in [Function Score Query's score_mode](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-function-score-query.html)\r\n\r\ncombine_mode | definition\r\n-- | --\r\nsum | scores are summed (default)\r\nmultiply | scores are multiplied \r\navg | scores are averaged\r\nfirst | the first function that has a matching filter is applied\r\nmax | maximum score is used\r\nmin | minimum score is used\r\n\r\n----\r\nThe intention for this query is to allow custom scoring logic, so internal queries are primarily expected to be `script_score` queries. For example, the intention fo the following query is to find \"best fit\" candidate with necessary skills: \r\n```js\r\n{\r\n  \"query\": {\r\n    \"compound\": {\r\n      \"queries\": [\r\n        {\r\n          \"script_score\": {\r\n            \"query\": {\r\n              \"match\": {\r\n                \"skills\": \"Java\"\r\n              }\r\n            },\r\n            \"script\": { \"source\": \"10.0\"}\r\n          }\r\n        },\r\n        {\r\n          \"script_score\": {\r\n            \"query\": {\r\n              \"match\": {\r\n                \"skills\": \"Scala\"\r\n              }\r\n            },\r\n            \"script\": {\"source\": \"5.0\"}\r\n          }\r\n        },\r\n        {\r\n          \"script_score\": {\r\n            \"query\": {\r\n              \"match\": {\r\n                \"skills\": \"Python\"\r\n              }\r\n            },\r\n            \"script\": {\"source\": \"1.0\"}\r\n          }\r\n        }\r\n      ],\r\n      \"combine_mode\": \"first\"\r\n    }\r\n  }\r\n}\r\n```","closed_by":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"performed_via_github_app":null}