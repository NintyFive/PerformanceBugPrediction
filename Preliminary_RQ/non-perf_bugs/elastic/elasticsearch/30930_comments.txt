[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/392837579","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-392837579","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":392837579,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MjgzNzU3OQ==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-05-29T16:16:17Z","updated_at":"2018-05-29T16:16:17Z","author_association":"MEMBER","body":"Do you have any indication that there is a memory leak in Elasticsearch? Unless you have an indication that there is a memory leak or other problem internal to Elasticsearch, I will close this issue as not being a bug. OutOfMemoryErrors can happen due to overloading the cluster with aggregations and/or indexing. For recommendations and help with fixing these issues, you can start a new thread at https://discuss.elastic.co/c/elasticsearch. You may also look at the heap dump that you have in a tool like Eclipse Memory Analyzer (MAT) to provide more details when asking for help in the forums.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/392888820","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-392888820","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":392888820,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Mjg4ODgyMA==","user":{"login":"ArielCoralogix","id":37430438,"node_id":"MDQ6VXNlcjM3NDMwNDM4","avatar_url":"https://avatars0.githubusercontent.com/u/37430438?v=4","gravatar_id":"","url":"https://api.github.com/users/ArielCoralogix","html_url":"https://github.com/ArielCoralogix","followers_url":"https://api.github.com/users/ArielCoralogix/followers","following_url":"https://api.github.com/users/ArielCoralogix/following{/other_user}","gists_url":"https://api.github.com/users/ArielCoralogix/gists{/gist_id}","starred_url":"https://api.github.com/users/ArielCoralogix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArielCoralogix/subscriptions","organizations_url":"https://api.github.com/users/ArielCoralogix/orgs","repos_url":"https://api.github.com/users/ArielCoralogix/repos","events_url":"https://api.github.com/users/ArielCoralogix/events{/privacy}","received_events_url":"https://api.github.com/users/ArielCoralogix/received_events","type":"User","site_admin":false},"created_at":"2018-05-29T18:34:40Z","updated_at":"2018-05-29T18:37:10Z","author_association":"NONE","body":"Hey @jaymode! Shouldn't the request circuit breaker protect us from this case exactly? it's set on our cluster with its default value.\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#request-circuit-breaker\r\n@danielmitterdorfer @jimczi @clintongormley looks like you have already discussed this here: https://github.com/elastic/elasticsearch/issues/20250","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/392912138","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-392912138","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":392912138,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MjkxMjEzOA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-05-29T19:28:55Z","updated_at":"2018-05-29T19:28:55Z","author_association":"MEMBER","body":"The circuit breakers are a best effort attempt to prevent OOM, but it is possible to still overload Elasticsearch and get a OOM. For example, you might have the breaker set to 60% of the total heap but you may not actually have 60% of your total heap free so you can still get a OOM.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/392927650","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-392927650","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":392927650,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MjkyNzY1MA==","user":{"login":"ArielCoralogix","id":37430438,"node_id":"MDQ6VXNlcjM3NDMwNDM4","avatar_url":"https://avatars0.githubusercontent.com/u/37430438?v=4","gravatar_id":"","url":"https://api.github.com/users/ArielCoralogix","html_url":"https://github.com/ArielCoralogix","followers_url":"https://api.github.com/users/ArielCoralogix/followers","following_url":"https://api.github.com/users/ArielCoralogix/following{/other_user}","gists_url":"https://api.github.com/users/ArielCoralogix/gists{/gist_id}","starred_url":"https://api.github.com/users/ArielCoralogix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArielCoralogix/subscriptions","organizations_url":"https://api.github.com/users/ArielCoralogix/orgs","repos_url":"https://api.github.com/users/ArielCoralogix/repos","events_url":"https://api.github.com/users/ArielCoralogix/events{/privacy}","received_events_url":"https://api.github.com/users/ArielCoralogix/received_events","type":"User","site_admin":false},"created_at":"2018-05-29T20:12:12Z","updated_at":"2018-05-29T20:12:12Z","author_association":"NONE","body":"That's a pretty strange way to treat this. IMHO, A query, no matter how complex, should not crash an entire cluster if properly configured.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/392939904","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-392939904","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":392939904,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MjkzOTkwNA==","user":{"login":"amnons77","id":20814629,"node_id":"MDQ6VXNlcjIwODE0NjI5","avatar_url":"https://avatars2.githubusercontent.com/u/20814629?v=4","gravatar_id":"","url":"https://api.github.com/users/amnons77","html_url":"https://github.com/amnons77","followers_url":"https://api.github.com/users/amnons77/followers","following_url":"https://api.github.com/users/amnons77/following{/other_user}","gists_url":"https://api.github.com/users/amnons77/gists{/gist_id}","starred_url":"https://api.github.com/users/amnons77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amnons77/subscriptions","organizations_url":"https://api.github.com/users/amnons77/orgs","repos_url":"https://api.github.com/users/amnons77/repos","events_url":"https://api.github.com/users/amnons77/events{/privacy}","received_events_url":"https://api.github.com/users/amnons77/received_events","type":"User","site_admin":false},"created_at":"2018-05-29T20:50:42Z","updated_at":"2018-05-29T20:50:42Z","author_association":"NONE","body":"Hey @jaymode \r\naccording to the circuit breakers documentation:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/circuit-breaker.html#request-circuit-breaker\r\nthe defaults is 60% from the **JVM** and not from the **total memory**, we didn't changed the circuit breakers defaults and we set the JVM to use only half of the total machine memory, my question is, will it possible to configure elasticsearch not to crash with OOM or is it by designed and the solution is to add more nodes?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393014700","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-393014700","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":393014700,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MzAxNDcwMA==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-05-30T02:58:05Z","updated_at":"2018-05-30T02:58:05Z","author_association":"MEMBER","body":"@ArielCoralogix We are continuously working on improving our handling of memory and adding safeguards to prevent OOM errors. This issue is closed as there is nothing more than “some data nodes crashed with OOM and I can give you a heap dump”, which is not actionable. We use github for confirmed bugs and features and our forums as a place to get help for issues like this. There are other open issues for specific items that relate to circuit breakers.\r\n\r\n@amnons77 I am referring to the JVM heap in my previous answer. Today we cannot prevent OOM 100%. I cannot give you an answer without more details and the forum is a place to get help with these kinds of questions.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393039885","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-393039885","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":393039885,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MzAzOTg4NQ==","user":{"login":"farin99","id":683343,"node_id":"MDQ6VXNlcjY4MzM0Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/683343?v=4","gravatar_id":"","url":"https://api.github.com/users/farin99","html_url":"https://github.com/farin99","followers_url":"https://api.github.com/users/farin99/followers","following_url":"https://api.github.com/users/farin99/following{/other_user}","gists_url":"https://api.github.com/users/farin99/gists{/gist_id}","starred_url":"https://api.github.com/users/farin99/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farin99/subscriptions","organizations_url":"https://api.github.com/users/farin99/orgs","repos_url":"https://api.github.com/users/farin99/repos","events_url":"https://api.github.com/users/farin99/events{/privacy}","received_events_url":"https://api.github.com/users/farin99/received_events","type":"User","site_admin":false},"created_at":"2018-05-30T05:59:53Z","updated_at":"2018-05-30T05:59:53Z","author_association":"NONE","body":"@jaymode IMHO an OOM is always a bug and the memory dump should be analyzed to find the root cause.\r\nWe are trying to analyze it our selves, of course, it much easier\\ideal for someone who is more familiar with the code base :)\r\nRegarding more information, please let us know what you need. As this is a production issue on a multi user environment, it is hard to provide the specific use case. I would argue that this is why elastic creates a memory dump on OOM by default.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393164346","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-393164346","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":393164346,"node_id":"MDEyOklzc3VlQ29tbWVudDM5MzE2NDM0Ng==","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"created_at":"2018-05-30T13:36:36Z","updated_at":"2018-05-30T13:37:05Z","author_association":"MEMBER","body":"> IMHO an OOM is always a bug\r\n\r\nAs a development team, we try our best to prevent OOM. There are cases of OOM that we know needs work and there are other cases where we cannot control like if there is a high GC overhead that leads to an OOM from the JVM even when memory can be allocated.\r\n\r\n> the memory dump should be analyzed to find the root cause.\r\n\r\nGithub is not the right place for analysis. As I mentioned earlier, the forums would be a good place to ask for help. Developers and community members are active on the forums.\r\n\r\n> Regarding more information, please let us know what you need\r\n\r\nCluster Topology\r\nNumber of CPUs and load\r\nAmount of memory\r\nSize of heap\r\nChanged JVM parameters\r\nNumber of indices and shards\r\nNumber of search req/s\r\nDid anything spike at the time of the issue\r\nSSDs/Spinning Disks\r\nLogs\r\nAny GC logs?\r\n\r\nBasically as much information you can provide when you ask for help on the forums.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/393944890","html_url":"https://github.com/elastic/elasticsearch/issues/30930#issuecomment-393944890","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30930","id":393944890,"node_id":"MDEyOklzc3VlQ29tbWVudDM5Mzk0NDg5MA==","user":{"login":"farin99","id":683343,"node_id":"MDQ6VXNlcjY4MzM0Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/683343?v=4","gravatar_id":"","url":"https://api.github.com/users/farin99","html_url":"https://github.com/farin99","followers_url":"https://api.github.com/users/farin99/followers","following_url":"https://api.github.com/users/farin99/following{/other_user}","gists_url":"https://api.github.com/users/farin99/gists{/gist_id}","starred_url":"https://api.github.com/users/farin99/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/farin99/subscriptions","organizations_url":"https://api.github.com/users/farin99/orgs","repos_url":"https://api.github.com/users/farin99/repos","events_url":"https://api.github.com/users/farin99/events{/privacy}","received_events_url":"https://api.github.com/users/farin99/received_events","type":"User","site_admin":false},"created_at":"2018-06-01T17:04:03Z","updated_at":"2018-06-01T17:04:03Z","author_association":"NONE","body":"@jaymode from the memory dump it seems like org.apache.lucene.search.DisjunctionMaxQuery objects take ~70% of the heap. Will you please consider reopening the bug or help us get to the bottom of this crash?\r\nAll of the information you requested plus our observations from the memory dump is in the [discussion](https://discuss.elastic.co/t/elasticsearch-data-node-crashing-with-outofmemoryerror/133873)\r\nThanks!","performed_via_github_app":null}]