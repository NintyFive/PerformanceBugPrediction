{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/46973","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46973/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46973/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46973/events","html_url":"https://github.com/elastic/elasticsearch/issues/46973","id":497055236,"node_id":"MDU6SXNzdWU0OTcwNTUyMzY=","number":46973,"title":"Prepare for removal of the CMS garbage collector","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":158399402,"node_id":"MDU6TGFiZWwxNTgzOTk0MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Meta","name":"Meta","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"ebadyano","id":26631211,"node_id":"MDQ6VXNlcjI2NjMxMjEx","avatar_url":"https://avatars0.githubusercontent.com/u/26631211?v=4","gravatar_id":"","url":"https://api.github.com/users/ebadyano","html_url":"https://github.com/ebadyano","followers_url":"https://api.github.com/users/ebadyano/followers","following_url":"https://api.github.com/users/ebadyano/following{/other_user}","gists_url":"https://api.github.com/users/ebadyano/gists{/gist_id}","starred_url":"https://api.github.com/users/ebadyano/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebadyano/subscriptions","organizations_url":"https://api.github.com/users/ebadyano/orgs","repos_url":"https://api.github.com/users/ebadyano/repos","events_url":"https://api.github.com/users/ebadyano/events{/privacy}","received_events_url":"https://api.github.com/users/ebadyano/received_events","type":"User","site_admin":false},"assignees":[{"login":"ebadyano","id":26631211,"node_id":"MDQ6VXNlcjI2NjMxMjEx","avatar_url":"https://avatars0.githubusercontent.com/u/26631211?v=4","gravatar_id":"","url":"https://api.github.com/users/ebadyano","html_url":"https://github.com/ebadyano","followers_url":"https://api.github.com/users/ebadyano/followers","following_url":"https://api.github.com/users/ebadyano/following{/other_user}","gists_url":"https://api.github.com/users/ebadyano/gists{/gist_id}","starred_url":"https://api.github.com/users/ebadyano/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebadyano/subscriptions","organizations_url":"https://api.github.com/users/ebadyano/orgs","repos_url":"https://api.github.com/users/ebadyano/repos","events_url":"https://api.github.com/users/ebadyano/events{/privacy}","received_events_url":"https://api.github.com/users/ebadyano/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2019-09-23T12:02:34Z","updated_at":"2020-01-08T16:07:59Z","closed_at":"2020-01-08T16:07:59Z","author_association":"MEMBER","active_lock_reason":null,"body":"### Context\r\n\r\nAccording to [JEP 363](https://openjdk.java.net/jeps/363) (originally [draft JEP 8229049](https://openjdk.java.net/jeps/8229049)) the CMS garbage collector will be removed from OpenJDK ([discussion of the patch](http://mail.openjdk.java.net/pipermail/hotspot-dev/2019-October/039787.html) and [commit](http://hg.openjdk.java.net/jdk/jdk/rev/ba6c248cae19)). The [corresponding discussion on the OpenJDK mailing list](https://mail.openjdk.java.net/pipermail/hotspot-gc-dev/2019-August/026655.html) mentions JDK 14 as targeted JDK. There is currently no release date for [JDK 14](https://openjdk.java.net/projects/jdk/14/) but based on past release cadence we should expect it to be released in late March 2020. As Elasticsearch currently recommends the CMS garbage collector we should be prepared for its removal.  I'm raising this issue as a meta-issue to collect our thoughts on what is missing to run Elasticsearch with a different garbage collector than CMS out of the box.\r\n\r\n### Prior work\r\n\r\nWe have already investigated G1GC as an alternative garbage collector for Elasticsearch in https://github.com/elastic/elasticsearch/pull/33685 and have recently adjusted the out-of-the box settings in https://github.com/elastic/elasticsearch/pull/46169 to improve the effectiveness of Elasticsearch's real-memory circuit breaker with G1GC.\r\n\r\n### Tasks\r\n\r\nThe following list may be incomplete, please add new tasks as needed:\r\n\r\n* [x] Ensure we don't use CMS for JDK 14 anymore: https://github.com/elastic/elasticsearch/pull/49123\r\n* [x] Investigate whether we always want to use G1 as the garbage collector (it *might* make sense to ergonomically choose parallel GC for smaller heaps) - see https://github.com/elastic/elasticsearch/issues/46973#issuecomment-565167478.\r\n* [x] Update our default JVM configuration to not use CMS https://github.com/elastic/elasticsearch/pull/49123\r\n* [x] Update our reference documentation to remove any references to CMS (e.g. our [bootstrap checks docs](https://github.com/elastic/elasticsearch/blob/master/docs/reference/setup/bootstrap-checks.asciidoc))\r\n","closed_by":{"login":"ebadyano","id":26631211,"node_id":"MDQ6VXNlcjI2NjMxMjEx","avatar_url":"https://avatars0.githubusercontent.com/u/26631211?v=4","gravatar_id":"","url":"https://api.github.com/users/ebadyano","html_url":"https://github.com/ebadyano","followers_url":"https://api.github.com/users/ebadyano/followers","following_url":"https://api.github.com/users/ebadyano/following{/other_user}","gists_url":"https://api.github.com/users/ebadyano/gists{/gist_id}","starred_url":"https://api.github.com/users/ebadyano/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebadyano/subscriptions","organizations_url":"https://api.github.com/users/ebadyano/orgs","repos_url":"https://api.github.com/users/ebadyano/repos","events_url":"https://api.github.com/users/ebadyano/events{/privacy}","received_events_url":"https://api.github.com/users/ebadyano/received_events","type":"User","site_admin":false},"performed_via_github_app":null}