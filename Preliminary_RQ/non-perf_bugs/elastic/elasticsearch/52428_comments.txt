[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/587070606","html_url":"https://github.com/elastic/elasticsearch/issues/52428#issuecomment-587070606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52428","id":587070606,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NzA3MDYwNg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-02-17T16:24:31Z","updated_at":"2020-02-17T16:24:31Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Build)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/587080576","html_url":"https://github.com/elastic/elasticsearch/issues/52428#issuecomment-587080576","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52428","id":587080576,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NzA4MDU3Ng==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2020-02-17T16:49:33Z","updated_at":"2020-02-17T16:49:33Z","author_association":"CONTRIBUTOR","body":"Many tests wait for pending tasks to complete during their cleanup phase so that tasks started by one test do not continue to run during the next test and cause hard-to-reproduce failures in that subsequent test.\r\n\r\nAs you say, this means that if one test leaves a rogue task behind that never completes then it fails every subsequent test that waits for pending tasks and also makes the test suite take an eternity to complete.\r\n\r\nSo maybe we should change the \"wait for pending tasks\" test cleanup functionality such that if the wait times out it instantly fails the entire test suite.  It's just a question of how to do this in such a way that:\r\n\r\n* The test for which the \"wait for pending tasks\" timed out is reported as a failure\r\n* Subsequent tests are ideally not reported as failures, but as skipped","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/587560189","html_url":"https://github.com/elastic/elasticsearch/issues/52428#issuecomment-587560189","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52428","id":587560189,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NzU2MDE4OQ==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2020-02-18T16:50:03Z","updated_at":"2020-02-18T16:50:30Z","author_association":"CONTRIBUTOR","body":"The problem seems to be the test that failed before, which is the problem described in #52429 \r\n\r\nThe task leakage happens because after the failure, the test does not continue execution and therefore does not stop the task. \r\n\r\nIndependent of #52429 it raises the question why execution continues after the failure. Because after the root cause, task cleanup does not happen, therefore all subsequent tests have the leaked task. I see 2 solutions:\r\n\r\n- fail fast: do not continue further test execution\r\n- cleanup all transform tasks as part of `@After`, e.g. rollup does this\r\n\r\nConceptually I like \"fail fast\", however there is a reason why 2 has been implemented at least for rollup. I like to learn about the reason.\r\n\r\n@astefan I am not understanding the links below the first failure. 7.6 should not be affected by this issue. If I follow the links the builds look fine to me.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/587561783","html_url":"https://github.com/elastic/elasticsearch/issues/52428#issuecomment-587561783","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52428","id":587561783,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NzU2MTc4Mw==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2020-02-18T16:53:17Z","updated_at":"2020-02-18T16:53:17Z","author_association":"CONTRIBUTOR","body":"@hendrikmuhs you are right, those links are not needed. Will remove them from the initial description.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/588134453","html_url":"https://github.com/elastic/elasticsearch/issues/52428#issuecomment-588134453","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52428","id":588134453,"node_id":"MDEyOklzc3VlQ29tbWVudDU4ODEzNDQ1Mw==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2020-02-19T09:59:22Z","updated_at":"2020-02-19T09:59:22Z","author_association":"CONTRIBUTOR","body":"created a PR for #52429, this should fix the failure.\r\n\r\nI keep this issue open to clarify the desired behavior when a test fails and whether it should stop immediately or not, see https://github.com/elastic/elasticsearch/issues/52428#issuecomment-587560189","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/590690480","html_url":"https://github.com/elastic/elasticsearch/issues/52428#issuecomment-590690480","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52428","id":590690480,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MDY5MDQ4MA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2020-02-25T05:26:49Z","updated_at":"2020-02-25T05:26:49Z","author_association":"MEMBER","body":"@hendrikmuhs I think we generally agree we should fail fast. IMO the problem is the cleanup is being done as normal test actions. Instead, could it be done as actual cleanup? Currently each yml file has a single setup/cleanup that is run before/after each test section. If the cleanup of these can't go into that cleanup section, maybe we need to consider a dedication teardown within each test section.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/592523364","html_url":"https://github.com/elastic/elasticsearch/issues/52428#issuecomment-592523364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52428","id":592523364,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MjUyMzM2NA==","user":{"login":"hendrikmuhs","id":7126422,"node_id":"MDQ6VXNlcjcxMjY0MjI=","avatar_url":"https://avatars3.githubusercontent.com/u/7126422?v=4","gravatar_id":"","url":"https://api.github.com/users/hendrikmuhs","html_url":"https://github.com/hendrikmuhs","followers_url":"https://api.github.com/users/hendrikmuhs/followers","following_url":"https://api.github.com/users/hendrikmuhs/following{/other_user}","gists_url":"https://api.github.com/users/hendrikmuhs/gists{/gist_id}","starred_url":"https://api.github.com/users/hendrikmuhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hendrikmuhs/subscriptions","organizations_url":"https://api.github.com/users/hendrikmuhs/orgs","repos_url":"https://api.github.com/users/hendrikmuhs/repos","events_url":"https://api.github.com/users/hendrikmuhs/events{/privacy}","received_events_url":"https://api.github.com/users/hendrikmuhs/received_events","type":"User","site_admin":false},"created_at":"2020-02-28T13:56:28Z","updated_at":"2020-02-28T13:56:28Z","author_association":"CONTRIBUTOR","body":"> IMO the problem is the cleanup is being done as normal test actions. Instead, could it be done as actual cleanup? Currently each yml file has a single setup/cleanup that is run before/after each test section.\r\n\r\n@rjernst Yes, that's a good point and should be possible, I have to move the test into a separate file but this also in the interest of cleaner test separation. I will implement your suggestion.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/648931169","html_url":"https://github.com/elastic/elasticsearch/issues/52428#issuecomment-648931169","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52428","id":648931169,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODkzMTE2OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2020-06-24T16:37:02Z","updated_at":"2020-06-24T16:37:02Z","author_association":"MEMBER","body":"While XPackRestIT still suffers from timeouts on MacOS, this failure was broader and fixed a while ago.","performed_via_github_app":null}]