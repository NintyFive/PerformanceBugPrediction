{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16128","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16128/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16128/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16128/events","html_url":"https://github.com/elastic/elasticsearch/issues/16128","id":127706094,"node_id":"MDU6SXNzdWUxMjc3MDYwOTQ=","number":16128,"title":"Memory Leak using InternalSearchHit.sourceAsMap","user":{"login":"arciisine","id":1264175,"node_id":"MDQ6VXNlcjEyNjQxNzU=","avatar_url":"https://avatars2.githubusercontent.com/u/1264175?v=4","gravatar_id":"","url":"https://api.github.com/users/arciisine","html_url":"https://github.com/arciisine","followers_url":"https://api.github.com/users/arciisine/followers","following_url":"https://api.github.com/users/arciisine/following{/other_user}","gists_url":"https://api.github.com/users/arciisine/gists{/gist_id}","starred_url":"https://api.github.com/users/arciisine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arciisine/subscriptions","organizations_url":"https://api.github.com/users/arciisine/orgs","repos_url":"https://api.github.com/users/arciisine/repos","events_url":"https://api.github.com/users/arciisine/events{/privacy}","received_events_url":"https://api.github.com/users/arciisine/received_events","type":"User","site_admin":false},"labels":[{"id":146829143,"node_id":"MDU6TGFiZWwxNDY4MjkxNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Transport%20API","name":":Core/Infra/Transport API","color":"0e8a16","default":false,"description":"Transport client API"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-01-20T15:24:32Z","updated_at":"2016-02-05T18:09:18Z","closed_at":"2016-02-05T18:07:16Z","author_association":"NONE","active_lock_reason":null,"body":"I'm experiencing an odd behavior in a project I'm currently working on. What I'm seeing is that when I reference an InternalSearchHit.sourceAsMap directly I'm experiencing a memory leak. The code is doing some graph traversal and so there are references to other InternalSearchHit.sourceAsMap documents as well.\n\nI'm currently writing groovy code, and so part of what I'm seeing is:\n\n```\ndef docMap = hit.sourceAsMap() \n//Add data into hash map\n//Add other InternalSearchHit.sourceAsMap as child of map\n```\n\n   I end up with a memory leak.\n\nIf I copy the map using the HashMap constructor:\n\n```\ndef docMap = new HashMap(hit.sourceAsMap())\n//Add data into hash map\n//Add other InternalSearchHit.sourceAsMap as child of map\n```\n\nThen the memory leak goes away.\n\nI took a look at the source for InternalSearchHit and I didn't see anything glaring. At best what I can guess, is that referencing the sourceAsMap object retains a hold on the SearchHit which in turn retains a hold on something else.\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}