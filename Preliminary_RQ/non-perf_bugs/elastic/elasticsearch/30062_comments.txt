[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/439870509","html_url":"https://github.com/elastic/elasticsearch/issues/30062#issuecomment-439870509","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30062","id":439870509,"node_id":"MDEyOklzc3VlQ29tbWVudDQzOTg3MDUwOQ==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2018-11-19T12:02:25Z","updated_at":"2018-11-19T12:02:25Z","author_association":"CONTRIBUTOR","body":"Despite #30668 a failure of the same test with an identical stack trace occurred in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.x+matrix-java-periodic/ES_BUILD_JAVA=java11,ES_RUNTIME_JAVA=java11,nodes=virtual&&linux/65/console:\r\n\r\n```\r\nERROR   0.19s J3 | TokenServiceTests.testTokenExpiry <<< FAILURES!\r\n   > Throwable #1: java.util.concurrent.ExecutionException: ElasticsearchSecurityException[token expired]\r\n   > \tat __randomizedtesting.SeedInfo.seed([CEDED5FE2915C12D:D16B8734FE15D88B]:0)\r\n   > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.getValue(BaseFuture.java:265)\r\n   > \tat org.elasticsearch.common.util.concurrent.BaseFuture$Sync.get(BaseFuture.java:252)\r\n   > \tat org.elasticsearch.common.util.concurrent.BaseFuture.get(BaseFuture.java:94)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenServiceTests.testTokenExpiry(TokenServiceTests.java:534)\r\n   > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n   > \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n   > \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n   > \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n   > \tat java.base/java.lang.Thread.run(Thread.java:834)\r\n   > Caused by: ElasticsearchSecurityException[token expired]\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.expiredTokenException(TokenService.java:1158)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.lambda$decodeAndValidateToken$5(TokenService.java:339)\r\n   > \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.lambda$decodeToken$8(TokenService.java:407)\r\n   > \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n   > \tat org.elasticsearch.action.support.ContextPreservingActionListener.onResponse(ContextPreservingActionListener.java:43)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenServiceTests.lambda$mockGetTokenFromId$11(TokenServiceTests.java:713)\r\n   > \tat org.mockito.internal.stubbing.StubbedInvocationMatcher.answer(StubbedInvocationMatcher.java:34)\r\n   > \tat org.mockito.internal.handler.MockHandlerImpl.handle(MockHandlerImpl.java:91)\r\n   > \tat org.mockito.internal.handler.NullResultGuardian.handle(NullResultGuardian.java:29)\r\n   > \tat org.mockito.internal.handler.InvocationNotifierHandler.handle(InvocationNotifierHandler.java:38)\r\n   > \tat org.mockito.internal.creation.MethodInterceptorFilter.intercept(MethodInterceptorFilter.java:51)\r\n   > \tat org.elasticsearch.client.Client$$EnhancerByMockitoWithCGLIB$$fc152304.get(<generated>)\r\n   > \tat org.elasticsearch.xpack.core.ClientHelper.executeAsyncWithOrigin(ClientHelper.java:75)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.lambda$decodeToken$10(TokenService.java:393)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenServiceTests.lambda$setupClient$4(TokenServiceTests.java:153)\r\n   > \tat org.mockito.internal.stubbing.StubbedInvocationMatcher.answer(StubbedInvocationMatcher.java:34)\r\n   > \tat org.mockito.internal.handler.MockHandlerImpl.handle(MockHandlerImpl.java:91)\r\n   > \tat org.mockito.internal.handler.NullResultGuardian.handle(NullResultGuardian.java:29)\r\n   > \tat org.mockito.internal.handler.InvocationNotifierHandler.handle(InvocationNotifierHandler.java:38)\r\n   > \tat org.mockito.internal.creation.MethodInterceptorFilter.intercept(MethodInterceptorFilter.java:51)\r\n   > \tat org.elasticsearch.xpack.security.support.SecurityIndexManager$$EnhancerByMockitoWithCGLIB$$f2e1f23.checkIndexVersionThenExecute(<generated>)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.lambda$decodeToken$11(TokenService.java:387)\r\n   > \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.decryptTokenId(TokenService.java:474)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.lambda$decodeToken$12(TokenService.java:382)\r\n   > \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.getKeyAsync(TokenService.java:451)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.decodeToken(TokenService.java:376)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.decodeAndValidateToken(TokenService.java:334)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenService.getAndValidateToken(TokenService.java:295)\r\n   > \tat org.elasticsearch.xpack.security.authc.TokenServiceTests.testTokenExpiry(TokenServiceTests.java:533)\r\n   > \t... 36 more\r\n```\r\n\r\nThis didn't reproduce using:\r\n\r\n```\r\n./gradlew :x-pack:plugin:security:test -Dtests.seed=CEDED5FE2915C12D -Dtests.class=org.elasticsearch.xpack.security.authc.TokenServiceTests -Dtests.method=\"testTokenExpiry\" -Dtests.security.manager=true -Dtests.locale=fi-FI -Dtests.timezone=Asia/Sakhalin -Dcompiler.java=11 -Druntime.java=11\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440728493","html_url":"https://github.com/elastic/elasticsearch/issues/30062#issuecomment-440728493","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30062","id":440728493,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDcyODQ5Mw==","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T16:29:57Z","updated_at":"2018-11-21T16:29:57Z","author_association":"CONTRIBUTOR","body":"#30668 was sadly never backported to 6.x, my bad. I will fix this now\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/440731148","html_url":"https://github.com/elastic/elasticsearch/issues/30062#issuecomment-440731148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30062","id":440731148,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MDczMTE0OA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2018-11-21T16:37:28Z","updated_at":"2018-11-21T16:37:28Z","author_association":"CONTRIBUTOR","body":"Thanks @jkakavas, I assumed the fix was in 6.x because that PR was labelled with 6.3.0 and 6.4.0.  I've changed the labels on the PR to show the earliest version it's in is now 6.6.0.","performed_via_github_app":null}]