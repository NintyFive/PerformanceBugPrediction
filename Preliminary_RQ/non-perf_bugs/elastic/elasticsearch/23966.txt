{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23966","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23966/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23966/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23966/events","html_url":"https://github.com/elastic/elasticsearch/issues/23966","id":220177529,"node_id":"MDU6SXNzdWUyMjAxNzc1Mjk=","number":23966,"title":"query_string and simple_query_string cannot apply minimum should match consistently","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":92913658,"node_id":"MDU6TGFiZWw5MjkxMzY1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/blocker","name":"blocker","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-04-07T10:41:04Z","updated_at":"2018-02-14T13:29:05Z","closed_at":"2017-06-08T09:18:17Z","author_association":"MEMBER","active_lock_reason":null,"body":"We apply the requested `minimum_should_match` on parsed queries produced by `query_string` and `simple_query_string`. Since these queries can target multiple fields we used to rely on the `disableCoord` property of the `Boolean` query. Now that coords are gone in Lucene 7 we are not able to distinguish queries with multiple positions like:\r\n\r\n`````\r\n\"query\": {\r\n\t\"simple_query_string\": {\r\n\t\t\"fields\": [\"field1\", \"field2\"],\r\n\t\t\"query\": \"foo bar\",\r\n\t\t\"minimum_should_match\": 1\r\n\t}\r\n}\r\n`````\r\n\r\n.... with single position queries on multiple fields:\r\n`````\r\n\"query\": {\r\n\t\"simple_query_string\": {\r\n\t\t\"fields\": [\"field1\", \"field2\", \"field3],\r\n\t\t\"query\": \"foo\",\r\n\t\t\"minimum_should_match\": 2\r\n\t}\r\n}\r\n`````\r\nIn 5.x we were able to detect that the later query produces a single position and that `minimum_should_match`should not be applied.\r\n\r\nIn 6.0 this query would be rewritten in:\r\n`foo must appear in 2 out of the 3 provided fields`\r\n\r\nThis is problematic but I can't think of a good fix for this. \r\nFurthermore applying `minimum_should_match` on `query_string` and `simple_query_string` is difficult to understand for users (it depends on settings like `split_on_whitespace`, tokenization, ...) so I wonder if we should just remove the support for this option in these query parsers.\r\nThe `match` and `multi_match_query` are not impacted since we apply `minimum_should_match` per `analyzer` group.","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}