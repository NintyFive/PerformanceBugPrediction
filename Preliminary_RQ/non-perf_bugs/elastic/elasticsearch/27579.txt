{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27579","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27579/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27579/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27579/events","html_url":"https://github.com/elastic/elasticsearch/issues/27579","id":277683164,"node_id":"MDU6SXNzdWUyNzc2ODMxNjQ=","number":27579,"title":"After upgrade elasticsearch version getting error no [query] registered for [filter]\",\"line\":1,\"col\":20}],\"type\":\"parsing_exception\",\"reason\":\"no [query] registered for [filter]\",\"line\":1,\"col\":20},\"status\":400} ","user":{"login":"mkhilwani","id":2409427,"node_id":"MDQ6VXNlcjI0MDk0Mjc=","avatar_url":"https://avatars3.githubusercontent.com/u/2409427?v=4","gravatar_id":"","url":"https://api.github.com/users/mkhilwani","html_url":"https://github.com/mkhilwani","followers_url":"https://api.github.com/users/mkhilwani/followers","following_url":"https://api.github.com/users/mkhilwani/following{/other_user}","gists_url":"https://api.github.com/users/mkhilwani/gists{/gist_id}","starred_url":"https://api.github.com/users/mkhilwani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkhilwani/subscriptions","organizations_url":"https://api.github.com/users/mkhilwani/orgs","repos_url":"https://api.github.com/users/mkhilwani/repos","events_url":"https://api.github.com/users/mkhilwani/events{/privacy}","received_events_url":"https://api.github.com/users/mkhilwani/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-11-29T09:28:07Z","updated_at":"2017-11-29T09:54:07Z","closed_at":"2017-11-29T09:54:06Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 5.0\r\n\r\n**Plugins installed**: [] NO\r\n\r\n**JVM version** (`java -version`):\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n**I upgrade elastic search 5.0 version and I using below query** \r\n\r\n'body' => [\r\n        'query' => [\r\n            'filtered' => [\r\n                'filter' => [\r\n                    'bool' => [\r\n                        'must' => [\r\n                            'multi_match' => [\r\n                                'query' => $search,\r\n                                'fields' => [\r\n                                    'product_description',\r\n                                    'link_page_content',\r\n                                    'faq_group',\r\n                                    'forum_title',\r\n                                    'faq_question',\r\n                                    'faq_answer',\r\n                                    'forum_contents',\r\n                                    'keyword_content'\r\n                                ],\r\n                                'operator' => 'and',\r\n                                'minimum_should_match' => '100%',\r\n                                'boost' => 10\r\n                            ]\r\n                        ]\r\n                    ]\r\n                ]\r\n            ]\r\n        ]\r\n**and I using below settings**\r\n\r\n'settings' => [\r\n        'analysis' => [\r\n            'filter' => [\r\n                'nGram_filter' => [\r\n                    'type' => 'nGram',\r\n                    'min_gram' => 1,\r\n                    'max_gram' => 20,\r\n                    'token_chars' => [\r\n                        'letter',\r\n                        'digit',\r\n                        'punctuation',\r\n                        'symbol'\r\n                    ]\r\n                ],\r\n                'custom_english_stemmer' => [\r\n                    'type' => 'stemmer',\r\n                    'name' => 'english'\r\n                ]\r\n            ],\r\n            'analyzer' => [\r\n                'nGram_analyzer' => [\r\n                    'type' => 'custom',\r\n                    'tokenizer' => 'whitespace',\r\n                    'filter' => [\r\n                        'lowercase',\r\n                        'custom_english_stemmer',\r\n                        'asciifolding',\r\n                        'nGram_filter'\r\n                    ]\r\n                ],\r\n                'whitespace_analyzer' => [\r\n                    'type' => 'custom',\r\n                    'tokenizer' => 'whitespace',\r\n                    'filter' => [\r\n                        'lowercase',\r\n                        'custom_english_stemmer',\r\n                        'asciifolding'\r\n                    ]\r\n                ],\r\n                'analyzer_startswith' => [\r\n                    'tokenizer' => 'keyword',\r\n                    'filter' => 'lowercase'\r\n                ]\r\n            ]\r\n        ]\r\n    ],\r\n    'mappings' => [ \r\n        'dvm_content_search' => [\r\n            'properties' => [\r\n                'link_text' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'link_href' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'link_page_content' => [\r\n                    'type' => 'string',\r\n                    'index' => 'analyzed',\r\n                    'analyzer' => 'nGram_analyzer',\r\n                    'search_analyzer' => 'whitespace_analyzer',\r\n                    'term_vector' => 'with_positions_offsets'\r\n                ]\r\n            ]\r\n        ],\r\n        'dvm_faq_search' => [\r\n            'properties' => [\r\n                'link_text' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'link_href' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'question_no' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'faq_group' => [\r\n                    'type' => 'text',\r\n                    'index' => 'true',\r\n                    'analyzer' => 'nGram_analyzer',\r\n                    'search_analyzer' => 'whitespace_analyzer',\r\n                    'term_vector' => 'with_positions_offsets'\r\n                ],\r\n                'faq_question' => [\r\n                    'type' => 'text',\r\n                    'index' => 'true',\r\n                    'analyzer' => 'nGram_analyzer',\r\n                    'search_analyzer' => 'whitespace_analyzer',\r\n                    'term_vector' => 'with_positions_offsets'\r\n                ],\r\n                'faq_answer' => [\r\n                    'type' => 'text',\r\n                    'index' => 'true',\r\n                    'analyzer' => 'nGram_analyzer',\r\n                    'search_analyzer' => 'whitespace_analyzer',\r\n                    'term_vector' => 'with_positions_offsets'\r\n                ]\r\n            ]\r\n        ],\r\n        'dvm_forum_search' => [\r\n            'properties' => [\r\n                'link_text' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'link_href' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'forum_id' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'forum_parent_id' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'forum_title'  => [\r\n                    'type' => 'text',\r\n                    'index' => 'true',\r\n                    'analyzer' => 'nGram_analyzer',\r\n                    'search_analyzer' => 'whitespace_analyzer',\r\n                    'term_vector' => 'with_positions_offsets'\r\n                ],\r\n                'forum_contents' => [\r\n                    'type' => 'text',\r\n                    'index' => 'true',\r\n                    'analyzer' => 'nGram_analyzer',\r\n                    'search_analyzer' => 'whitespace_analyzer',\r\n                    'term_vector' => 'with_positions_offsets'\r\n                ]\r\n            ]\r\n        ],\r\n        'dvm_product_search' => [\r\n            'properties' => [\r\n                'link_text' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'link_href' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'product_id' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'product_name' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'product_description' => [\r\n                    'type' => 'text',\r\n                    'index' => 'true',\r\n                    'analyzer' => 'nGram_analyzer',\r\n                    'search_analyzer' => 'whitespace_analyzer',\r\n                    'term_vector' => 'with_positions_offsets'\r\n                ]\r\n            ]\r\n        ],\r\n        'dvm_keyword_search' => [\r\n            'properties' => [\r\n                'link_text' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'link_href' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'keyword_content' => [\r\n                    'type' => 'text',\r\n                    'index' => 'true',\r\n                    'analyzer' => 'nGram_analyzer',\r\n                    'search_analyzer' => 'whitespace_analyzer',\r\n                    'term_vector' => 'with_positions_offsets'\r\n                ],\r\n                'keyword_discription' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ],\r\n                'keyword_conditions' => [\r\n                    'type' => 'string',\r\n                    'index' => 'not_analyzed'\r\n                ]\r\n            ]\r\n        ]\r\n    ] \r\n\r\n**I am getting below error** \r\n\r\nFatal error: Uncaught exception 'Elasticsearch\\Common\\Exceptions\\BadRequest400Exception' with message '{\"error\":{\"root_cause\":[{\"type\":\"parsing_exception\",\"reason\":\"no [query] registered for [filter]\",\"line\":1,\"col\":20}],\"type\":\"parsing_exception\",\"reason\":\"no [query] registered for [filter]\",\"line\":1,\"col\":20},\"status\":400}' in /var/www/html/releases/vendor/elasticsearch/elasticsearch/src/Elasticsearch/Connections/Connection.php:610 Stack trace: #0 /var/www/html/releases/vendor/elasticsearch/elasticsearch/src/Elasticsearch/Connections/Connection.php(273): Elasticsearch\\Connections\\Connection->process4xxError(Array, Array, Array) #1 /var/www/html/releases/vendor/react/promise/src/FulfilledPromise.php(25): Elasticsearch\\Connections\\Connection->Elasticsearch\\Connections\\{closure}(Array) #2 /var/www/html/releases/vendor/guzzlehttp/ringphp/src/Future/CompletedFutureValue.php(55): React\\Promise\\FulfilledPromise->then(Object(Closure), NULL, NULL) #3 /var/www/html/releases/vendor/guzzlehttp/ringphp/src/Core.php(341): GuzzleHttp\\ in /var/www/html/releases/vendor/elasticsearch/elasticsearch/src/Elasticsearch/Connections/Connection.php on line 610\r\n\r\n\r\n**Steps to reproduce**:\r\n\r\n\r\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}