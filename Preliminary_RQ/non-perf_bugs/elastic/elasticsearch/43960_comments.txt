[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508404998","html_url":"https://github.com/elastic/elasticsearch/issues/43960#issuecomment-508404998","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43960","id":508404998,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODQwNDk5OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T09:07:44Z","updated_at":"2019-07-04T09:07:44Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508408720","html_url":"https://github.com/elastic/elasticsearch/issues/43960#issuecomment-508408720","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43960","id":508408720,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODQwODcyMA==","user":{"login":"alpar-t","id":2565652,"node_id":"MDQ6VXNlcjI1NjU2NTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2565652?v=4","gravatar_id":"","url":"https://api.github.com/users/alpar-t","html_url":"https://github.com/alpar-t","followers_url":"https://api.github.com/users/alpar-t/followers","following_url":"https://api.github.com/users/alpar-t/following{/other_user}","gists_url":"https://api.github.com/users/alpar-t/gists{/gist_id}","starred_url":"https://api.github.com/users/alpar-t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alpar-t/subscriptions","organizations_url":"https://api.github.com/users/alpar-t/orgs","repos_url":"https://api.github.com/users/alpar-t/repos","events_url":"https://api.github.com/users/alpar-t/events{/privacy}","received_events_url":"https://api.github.com/users/alpar-t/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T09:18:13Z","updated_at":"2019-07-04T09:18:13Z","author_association":"CONTRIBUTOR","body":"Muted on `master`, `7.x` and `7.3`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508487857","html_url":"https://github.com/elastic/elasticsearch/issues/43960#issuecomment-508487857","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43960","id":508487857,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODQ4Nzg1Nw==","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T13:44:42Z","updated_at":"2019-07-04T13:44:42Z","author_association":"CONTRIBUTOR","body":"This looks quite strange. I cannot understand where this stacktrace comes from, I can't see it neither in the node logs nor the console output. The stacktrace itself doesn't help understand where this search came from or what it was doing. I have run the test locally with many iterations and I can't reproduce. I think we should enable low level logging and re-enable the test to get more to go with.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508508510","html_url":"https://github.com/elastic/elasticsearch/issues/43960#issuecomment-508508510","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43960","id":508508510,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODUwODUxMA==","user":{"login":"mayya-sharipova","id":5738841,"node_id":"MDQ6VXNlcjU3Mzg4NDE=","avatar_url":"https://avatars1.githubusercontent.com/u/5738841?v=4","gravatar_id":"","url":"https://api.github.com/users/mayya-sharipova","html_url":"https://github.com/mayya-sharipova","followers_url":"https://api.github.com/users/mayya-sharipova/followers","following_url":"https://api.github.com/users/mayya-sharipova/following{/other_user}","gists_url":"https://api.github.com/users/mayya-sharipova/gists{/gist_id}","starred_url":"https://api.github.com/users/mayya-sharipova/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayya-sharipova/subscriptions","organizations_url":"https://api.github.com/users/mayya-sharipova/orgs","repos_url":"https://api.github.com/users/mayya-sharipova/repos","events_url":"https://api.github.com/users/mayya-sharipova/events{/privacy}","received_events_url":"https://api.github.com/users/mayya-sharipova/received_events","type":"User","site_admin":false},"created_at":"2019-07-04T14:50:17Z","updated_at":"2019-07-04T14:50:17Z","author_association":"CONTRIBUTOR","body":"More recent failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob+fast+part2/49/console\r\n\r\nDoesn't reproduce for me as well.\r\n\r\nIndeed not much info in the [console log](https://scans.gradle.com/s/nejhkolxou4m4/console-log?task=:x-pack:plugin:ml:qa:native-multi-node-tests:integTestRunner) .","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508683497","html_url":"https://github.com/elastic/elasticsearch/issues/43960#issuecomment-508683497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43960","id":508683497,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODY4MzQ5Nw==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T08:47:32Z","updated_at":"2019-07-05T08:47:32Z","author_association":"MEMBER","body":"This is the relevant part of the log\r\n\r\n```\r\n\r\n[2019-07-04T14:14:35,405][INFO ][o.e.x.m.a.TransportStartDataFrameAnalyticsAction] [integTest-2] [test_stop_outlier_detection_with_enough_docs_to_scroll] Starting data frame analytics\r\n[2019-07-04T14:14:35,460][INFO ][o.e.x.m.d.DataFrameAnalyticsManager] [integTest-2] [test_stop_outlier_detection_with_enough_docs_to_scroll] Creating destination index [test-stop-outlier-detection-with-enough-docs-to-scroll-results]\r\n[2019-07-04T14:14:35,480][INFO ][o.e.x.m.a.TransportStopDataFrameAnalyticsAction] [integTest-2] [test_stop_outlier_detection_with_enough_docs_to_scroll] Stopping task with force [false]\r\n[2019-07-04T14:14:36,152][WARN ][o.e.a.a.i.r.TransportShardRefreshAction] [integTest-2] unexpected error during the primary phase for action [indices:admin/refresh[s]], request [BasicReplicationRequest{[test-stop-outlier-detection-with-enough-docs-to-scroll-results][0]}]\r\norg.elasticsearch.index.IndexNotFoundException: no such index [test-stop-outlier-detection-with-enough-docs-to-scroll-results]\r\nat org.elasticsearch.cluster.metadata.IndexNameExpressionResolver.concreteIndices(IndexNameExpressionResolver.java:194) ~[elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.cluster.metadata.IndexNameExpressionResolver.concreteIndices(IndexNameExpressionResolver.java:120) ~[elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.cluster.metadata.IndexNameExpressionResolver.concreteSingleIndex(IndexNameExpressionResolver.java:282) ~[elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.action.support.replication.TransportReplicationAction.concreteIndex(TransportReplicationAction.java:235) ~[elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.action.support.replication.TransportReplicationAction.access$1600(TransportReplicationAction.java:97) ~[elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase.doRun(TransportReplicationAction.java:656) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.action.support.replication.TransportReplicationAction$ReroutePhase$2.onNewClusterState(TransportReplicationAction.java:802) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.cluster.ClusterStateObserver$ContextPreservingListener.onNewClusterState(ClusterStateObserver.java:311) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.cluster.ClusterStateObserver$ObserverClusterStateListener.postAdded(ClusterStateObserver.java:220) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.cluster.service.ClusterApplierService$1.run(ClusterApplierService.java:288) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:688) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:252) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:215) [elasticsearch-7.4.0-SNAPSHOT.jar:7.4.0-SNAPSHOT]\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\nat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n[2019-07-04T14:14:36,157][WARN ][o.e.p.PersistentTasksNodeService] [integTest-2] attempt to complete task [xpack/ml/data_frame/analytics[c]] with id [data_frame_analytics-test_stop_outlier_detection_with_enough_docs_to_scroll] in the [COMPLETED] state\r\n[2019-07-04T14:14:38,490][INFO ][o.e.x.m.a.TransportStartDataFrameAnalyticsAction] [integTest-2] [test_outlier_detection_with_enough_docs_to_scroll] Starting data frame analytics\r\n[2019-07-04T14:14:38,546][INFO ][o.e.x.m.d.DataFrameAnalyticsManager] [integTest-2] [test_outlier_detection_with_enough_docs_to_scroll] Creating destination index [test-outlier-detection-with-enough-docs-to-scroll-results]\r\n[2019-07-04T14:14:39,363][INFO ][o.e.x.m.d.p.AnalyticsProcessManager] [integTest-2] [test_outlier_detection_with_enough_docs_to_scroll] Waiting for result processor to complete\r\n[2019-07-04T14:14:39,728][INFO ][o.e.x.m.d.p.AnalyticsProcessManager] [integTest-2] [test_outlier_detection_with_enough_docs_to_scroll] Result processor has completed\r\n[2019-07-04T14:14:39,728][INFO ][o.e.x.m.d.p.AnalyticsProcessManager] [integTest-2] [test_outlier_detection_with_enough_docs_to_scroll] Closing process\r\n[2019-07-04T14:14:39,729][INFO ][o.e.x.m.d.p.AnalyticsProcessManager] [integTest-2] [test_outlier_detection_with_enough_docs_to_scroll] Closed process\r\n[2019-07-04T14:14:39,729][INFO ][o.e.x.m.d.p.AnalyticsProcessManager] [integTest-2] [test_outlier_detection_with_enough_docs_to_scroll] Marking task completed\r\n```\r\n\r\nCould there be a race between creating the destination index and stopping the Data frame analysis or is it somehow deleted before the `BasicReplicationRequest` ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/508689658","html_url":"https://github.com/elastic/elasticsearch/issues/43960#issuecomment-508689658","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43960","id":508689658,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODY4OTY1OA==","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"created_at":"2019-07-05T09:08:00Z","updated_at":"2019-07-05T09:08:00Z","author_association":"CONTRIBUTOR","body":"Here are the logs for the failure in the original issue description:\r\n\r\nNode 0:\r\n\r\n```\r\n[2019-07-03T20:48:45,294][INFO ][o.e.c.m.MetaDataIndexTemplateService] [integTest-0] adding template [random_index_template] for index patterns [*]\r\n[2019-07-03T20:48:45,325][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [test-stop-outlier-detection-with-enough-docs-to-scroll] creating index, cause [api], templates [random_index_template], shards [1]/[1], mappings [_doc]\r\n[2019-07-03T20:48:45,544][INFO ][o.e.c.r.a.AllocationService] [integTest-0] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[test-stop-outlier-detection-with-enough-docs-to-scroll][0]] ...]).\r\n[2019-07-03T20:48:46,888][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [.ml-config] creating index, cause [auto(bulk api)], templates [random_index_template, .ml-config], shards [1]/[1], mappings [_doc]\r\n[2019-07-03T20:48:46,929][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [.ml-annotations-6] creating index, cause [api], templates [random_index_template], shards [1]/[1], mappings [_doc]\r\n[2019-07-03T20:48:47,081][INFO ][o.e.x.m.MlInitializationService] [integTest-0] Created ML annotations index and aliases\r\n[2019-07-03T20:48:47,086][INFO ][o.e.c.m.MetaDataMappingService] [integTest-0] [.ml-config/QzuPzrIRRmq2A0E7Z5eqHw] update_mapping [_doc]\r\n[2019-07-03T20:48:47,295][INFO ][o.e.c.m.MetaDataCreateIndexService] [integTest-0] [test-stop-outlier-detection-with-enough-docs-to-scroll-results] creating index, cause [api], templates [random_index_template], shards [1]/[1], mappings [_doc]\r\n[2019-07-03T20:48:47,655][INFO ][o.e.c.r.a.AllocationService] [integTest-0] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[.ml-config][0]] ...]).\r\n[2019-07-03T20:48:47,950][WARN ][o.e.p.PersistentTasksClusterService] [integTest-0] trying to update state on non-existing task data_frame_analytics-test_stop_outlier_detection_with_enough_docs_to_scroll\r\n```\r\n\r\nNode 1:\r\n\r\n```\r\n[2019-07-03T20:48:47,197][INFO ][o.e.x.m.a.TransportStartDataFrameAnalyticsAction] [integTest-1] [test_stop_outlier_detection_with_enough_docs_to_scroll] Starting data frame analytics\r\n[2019-07-03T20:48:47,272][INFO ][o.e.x.m.d.DataFrameAnalyticsManager] [integTest-1] [test_stop_outlier_detection_with_enough_docs_to_scroll] Creating destination index [test-stop-outlier-detection-with-enough-docs-to-scroll-results]\r\n[2019-07-03T20:48:47,294][INFO ][o.e.x.m.a.TransportStopDataFrameAnalyticsAction] [integTest-1] [test_stop_outlier_detection_with_enough_docs_to_scroll] Stopping task with force [false]\r\n[2019-07-03T20:48:47,952][WARN ][o.e.p.PersistentTasksNodeService] [integTest-1] attempt to complete task [xpack/ml/data_frame/analytics[c]] with id [data_frame_analytics-test_stop_outlier_detection_with_enough_docs_to_scroll] in the [COMPLETED] state\r\n```\r\n\r\n> Could there be a race between creating the destination index and stopping the Data frame analysis\r\n\r\nLooks like it - the time on \"Stopping task with force\" is 20:48:47,294 and the time on \"creating index, cause [api]\" is 20:48:47,295.","performed_via_github_app":null}]