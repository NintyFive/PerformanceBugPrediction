{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5381","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5381/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5381/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5381/events","html_url":"https://github.com/elastic/elasticsearch/issues/5381","id":29119100,"node_id":"MDU6SXNzdWUyOTExOTEwMA==","number":5381,"title":"Highlighting is returning results not searched for","user":{"login":"Jrizzi1","id":622313,"node_id":"MDQ6VXNlcjYyMjMxMw==","avatar_url":"https://avatars3.githubusercontent.com/u/622313?v=4","gravatar_id":"","url":"https://api.github.com/users/Jrizzi1","html_url":"https://github.com/Jrizzi1","followers_url":"https://api.github.com/users/Jrizzi1/followers","following_url":"https://api.github.com/users/Jrizzi1/following{/other_user}","gists_url":"https://api.github.com/users/Jrizzi1/gists{/gist_id}","starred_url":"https://api.github.com/users/Jrizzi1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jrizzi1/subscriptions","organizations_url":"https://api.github.com/users/Jrizzi1/orgs","repos_url":"https://api.github.com/users/Jrizzi1/repos","events_url":"https://api.github.com/users/Jrizzi1/events{/privacy}","received_events_url":"https://api.github.com/users/Jrizzi1/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-03-10T18:18:37Z","updated_at":"2015-04-16T09:14:37Z","closed_at":"2015-04-16T09:14:37Z","author_association":"NONE","active_lock_reason":null,"body":"here is my test case\n\nindex : \n\n``` JSON\nPUT /test/1/1' -d \n{\n\"ZIPCODE\": [\n                  \"92121\",\n                  \"92120-2001\",\n                  \"92104-3426\",\n                  \"92116-4153\",\n                  \"92101\",\n                  \"92101-2892\",\n                  \"60631-2590\"\n               ],\n               \"STREET3\": \" \",\n               \"FIRST_NAME\": \"James\",\n               \"MIDDLE_NAME\": \"Wesley\",\n               \"STATE_CODE\": [\n                  \"CA\",\n                  \"IL\"\n               ],\n               \"CITY\": [\n                  \"San Diego\",\n                  \"Chicago\"\n               ],\n               \"PREF_MAIL_NAME\": \"James W. Smith\",\n               \"EMAIL_ADDRESS\": [\n                  \"james.w.smith@cardinal.com\",\n                  \"jsmith@eraeagle.com\"\n               ],\n               \"LAST_NAME\": \"Smith\",\n               \"STREET2\": [\n                  \" \",\n                  \"4434 Louisiana Street\",\n                  \"850 Beech Street\",\n                  \"6060 Northwest Highway\"\n               ],\n               \"PREF_CLASS_YEAR\": \"1993\",\n               \"STREET1\": [\n                  \"10020 Pacific Mesa Boulevard\",\n                  \"7533 Clear Sky Rd\",\n                  \"3584-A Villa Terrace\",\n                  \"Apartment 8\",\n                  \"Apartment 315\",\n                  \"SAFCO Corporation\"\n               ]\n               }\n```\n\nSearch (notice the EMAIL_ADDRESS criteria)\n\n``` JSON\nPOST /test/1/_search\n{\n   \"query\": {\n      \"bool\": {\n         \"should\": [\n            {\n               \"match_phrase_prefix\": {\n                  \"FIRST_NAME\": {\n                     \"query\": \"James\"\n                  }\n               }\n            },\n            {\n               \"match_phrase_prefix\": {\n                  \"LAST_NAME\": \"Smith\"\n               }\n            },\n            {\n               \"match_phrase_prefix\": {\n                  \"MIDDLE_NAME\": \"\"\n               }\n            },\n            {\n               \"match\": {\n                  \"PREF_CLASS_YEAR\": \"\"\n               }\n            },\n            {\n               \"match\": {\n                  \"EMAIL_ADDRESS\": \"jones@.stackoverflow.com\"\n               }\n            },\n            {\n               \"multi_match\": {\n                  \"query\": \"10020 Pacific Mesa\",\n                  \"fields\": [\n                     \"STREET1\",\n                     \"STREET2\",\n                     \"STREET3\"\n                  ]\n               }\n            },\n            {\n               \"match\": {\n                  \"CITY\": \"San Diego\"\n               }\n            },\n            {\n               \"match\": {\n                  \"STATE_CODE\": \"CA\"\n               }\n            },\n            {\n               \"match\": {\n                  \"ZIPCODE\": \"92121\"\n               }\n            }\n         ],\n         \"minimum_should_match\": \"3\"\n      }\n   },\n   \"from\": \"0\",\n   \"highlight\": {\n      \"pre_tags\": \"<b>\",\n      \"post_tags\": \"</b>\",\n      \"fields\": {\n         \"ZIPCODE\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"STREET3\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"FIRST_NAME\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"MIDDLE_NAME\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"LAST_NAME\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"STREET1\": {\n            \"number_of_fragments\": \"5\"\n         },         \n         \"STATE_CODE\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"CITY\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"STREET2\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"EMAIL_ADDRESS\": {\n            \"number_of_fragments\": \"5\"\n         },\n         \"PREF_CLASS_YEAR\": {\n            \"number_of_fragments\": \"5\"\n         }\n\n      }\n   },\n   \"size\": \"5\"\n}  \n```\n\nThe highlight result is clearly showing a value for EMAIL_ADDRESS that i did not search for, it does not even show on the explain plan\n\n``` JSON\n\"highlight\": {\n               \"ZIPCODE\": [\n                  \"<em>92121</em>\"\n               ],\n               \"FIRST_NAME\": [\n                  \"<em>James</em>\"\n               ],\n               \"STATE_CODE\": [\n                  \"<em>CA</em>\"\n               ],\n               \"CITY\": [\n                  \"<em>San</em> <em>Diego</em>\"\n               ],\n               \"EMAIL_ADDRESS\": [\n                  \"<em>james.w.smith</em>@cardinal.com\"\n               ],\n               \"LAST_NAME\": [\n                  \"<em>Smith</em>\"\n               ],\n               \"STREET1\": [\n                  \"<em>10020</em> <em>Pacific</em> <em>Mesa</em> Boulevard\"\n               ]\n            }\n```\n\n*update: by changing my match_phrase_prefix queries to match, the highlighting of erroneous email_address goes away...but that still makes no sense\n","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}