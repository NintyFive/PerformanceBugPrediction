{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1316","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1316/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1316/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1316/events","html_url":"https://github.com/elastic/elasticsearch/issues/1316","id":1606249,"node_id":"MDU6SXNzdWUxNjA2MjQ5","number":1316,"title":"Per document TTL support","user":{"login":"Paikan","id":822586,"node_id":"MDQ6VXNlcjgyMjU4Ng==","avatar_url":"https://avatars2.githubusercontent.com/u/822586?v=4","gravatar_id":"","url":"https://api.github.com/users/Paikan","html_url":"https://github.com/Paikan","followers_url":"https://api.github.com/users/Paikan/followers","following_url":"https://api.github.com/users/Paikan/following{/other_user}","gists_url":"https://api.github.com/users/Paikan/gists{/gist_id}","starred_url":"https://api.github.com/users/Paikan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Paikan/subscriptions","organizations_url":"https://api.github.com/users/Paikan/orgs","repos_url":"https://api.github.com/users/Paikan/repos","events_url":"https://api.github.com/users/Paikan/events{/privacy}","received_events_url":"https://api.github.com/users/Paikan/received_events","type":"User","site_admin":false},"labels":[{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":127902,"node_id":"MDU6TGFiZWwxMjc5MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.18.0","name":"v0.18.0","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2011-09-09T09:25:17Z","updated_at":"2013-11-27T06:38:24Z","closed_at":"2011-09-09T14:24:32Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"A lot of documents naturally come with an expiration date and it can be painful to handle yourself the task of deleting all expired documents regularly. \n\nTherefore a new field, called `_ttl` has been added. \n## enabled\n\nBy default it is disabled, in order to enable it, the following mapping should be defined:\n\n``` javascript\n{\n    \"tweet\" : {\n        \"_ttl\" : { \"enabled\" : true }\n    }\n}\n```\n## default\n\nYou can provide a per index/type default ttl value as follows:\n\n``` javascript\n{\n    \"tweet\" : {\n        \"_ttl\" : { \"enabled\" : true, \"default\" : \"1d\" }\n    }\n}\n```\n\nIf you don't provide `_ttl` in your query or in the `_source` all tweets will have a TTL of 1 day.\n## How it works\n\nThe `_ttl` field allows to attach a TTL to your documents. Note that the expiration date that will be set for a document with a provided TTL is relative to the `_timestamp` of the document, meaning it can be based on the time of indexing or on any time provided inside your `_source` document. Note also that the `_timestamp` field need not to be enabled in order for `_ttl` to work.\n\nThe provided `_ttl` value must be strictly positive and can be a number (in milliseconds) or any valid time value as shown in the following examples.\n\nYou can provided the `_ttl` externally in your indexing order or inside the `_source`:\n\n<pre>\n// One day  in ms\ncurl -XPUT 'http://localhost:9200/twitter/tweet/1?ttl=86400000' -d '{\n    \"user\": \"kimchy\",\n    \"message\": \"Trying out elasticsearch, so far so good?\"\n}'\n</pre>\n\n\n<pre>\n// One day using a time value format\ncurl -XPUT 'http://localhost:9200/twitter/tweet/1?ttl=1d' -d '{\n    \"user\": \"kimchy\",\n    \"message\": \"Trying out elasticsearch, so far so good?\"\n}'\n</pre>\n\n\n<pre>\n// One day inside the _source\ncurl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{\n    \"_ttl\": \"1d\",\n    \"user\": \"kimchy\",\n    \"message\": \"Trying out elasticsearch, so far so good?\"\n}'\n</pre>\n\n\nYou can display the `_ttl` field value as follow:\n\n<pre>\ncurl -XGET 'http://localhost:9200/twitter/tweet/_search?q=user:kimchy&pretty=1&fields=_source,_ttl'\n</pre>\n\n\nGiving this output:\n\n``` javascript\n{\n  \"took\" : 2,\n  \"timed_out\" : false,\n  \"_shards\" : {\n    \"total\" : 5,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"hits\" : {\n    \"total\" : 1,\n    \"max_score\" : 0.30685282,\n    \"hits\" : [ {\n      \"_index\" : \"twitter\",\n      \"_type\" : \"tweet\",\n      \"_id\" : \"1\",\n      \"_score\" : 0.30685282, \"_source\" : {\n    \"_ttl\": 86400000,\n    \"user\": \"kimchy\",\n    \"message\": \"Trying out elasticsearch, so far so good?\"\n},\n      \"fields\" : {\n        \"_ttl\" : 86394472 // Note the _ttl value here returned in ms\n      }\n    } ]\n  }\n}\n```\n\nThe `_ttl` value can also be displayed using realtime get, for example:\n\n<pre>\ncurl -XGET 'http://localhost:9200/twitter/tweet/1?pretty=1&fields=_source,_ttl'\n</pre>\n\n## Documents expiration\n\nExpired documents will be automatically deleted regularly.  You can dynamically set the `indices.ttl.interval` to fit your needs. The default value is `60s`.\n\nThe deletion orders are processed by bulk. You can set `indices.ttl.bulk_size` to fit your needs. The default value is `10000`.\n\nNote that the expiration procedure handle versioning properly so if a document is updated between the collection of documents to expire and the delete order, the document won't be deleted.\n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}