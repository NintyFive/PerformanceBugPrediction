{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53630","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53630/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53630/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53630/events","html_url":"https://github.com/elastic/elasticsearch/issues/53630","id":582552863,"node_id":"MDU6SXNzdWU1ODI1NTI4NjM=","number":53630,"title":"No handler for type [dense_vector] for version 7.4.2","user":{"login":"koren-v","id":45794881,"node_id":"MDQ6VXNlcjQ1Nzk0ODgx","avatar_url":"https://avatars3.githubusercontent.com/u/45794881?v=4","gravatar_id":"","url":"https://api.github.com/users/koren-v","html_url":"https://github.com/koren-v","followers_url":"https://api.github.com/users/koren-v/followers","following_url":"https://api.github.com/users/koren-v/following{/other_user}","gists_url":"https://api.github.com/users/koren-v/gists{/gist_id}","starred_url":"https://api.github.com/users/koren-v/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/koren-v/subscriptions","organizations_url":"https://api.github.com/users/koren-v/orgs","repos_url":"https://api.github.com/users/koren-v/repos","events_url":"https://api.github.com/users/koren-v/events{/privacy}","received_events_url":"https://api.github.com/users/koren-v/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-03-16T19:34:48Z","updated_at":"2020-03-17T21:33:40Z","closed_at":"2020-03-17T21:33:40Z","author_association":"NONE","active_lock_reason":null,"body":"Hi, I'm trying to load the data stored in index with a 6.7.0 version to the new index with a 7.4.2 version adding field with 'dense_vector' type. But got the next error: \r\nRequestError(400, 'mapper_parsing_exception', 'No handler for type [dense_vector] declared on field [vector]'). Can you explain the reason for it?\r\n\r\n``\r\ndef append_data(database_size = 20000, request_size = 10000):\r\n\r\n    \"\"\"\r\n    Append vectors of description to elastic\r\n    :param: database_size - num of rows in elastic\r\n    :maram: request_size - max num of rows, that we can get\r\n    from one request\r\n    \"\"\"\r\n    \r\n    \r\n    new_client.indices.create(index=NEW_INDEX_NAME,\r\n                              body=BODY)\r\n    \r\n    # as firstly we need to conect to elastic not via scroll\r\n    # we define scroll as None \r\n    scroll = None\r\n    \r\n    if database_size%request_size == 0:\r\n        number_of_requests = database_size//request_size\r\n    else:    \r\n        number_of_requests = database_size//request_size + 1\r\n    \r\n    for i in range(number_of_requests):\r\n        \r\n        result_dict, scroll = get_data(old_client,\r\n                                       scroll, \r\n                                       max_size = request_size)\r\n\r\n        docs = []\r\n        count = 0\r\n        \r\n        \r\n        for video in result_dict[\"hits\"][\"hits\"]:\r\n\r\n            docs.append(video)\r\n            count += 1\r\n            \r\n            #indexind descriptions by batches\r\n            if count % BATCH_SIZE == 0:\r\n                index_batch(docs)\r\n                docs = []\r\n                print(\"Indexed {} documents.\".format(count))\r\n\r\n        if docs:\r\n            index_batch(docs)\r\n            print(\"Indexed {} documents.\".format(count))\r\n\r\n    new_client.indices.refresh(index=NEW_INDEX_NAME)\r\n    print(\"Done indexing.\")\r\n\r\n\r\ndef index_batch(docs):\r\n    \r\n    \"\"\"Create vector field for docs\"\"\"\r\n    \r\n    titles = [doc['_source']['description'] for doc in docs]\r\n    title_vectors = embed_text(titles)\r\n\r\n    requests = []\r\n\r\n    for i, doc in enumerate(docs):\r\n        #request = doc #\r\n        request = {}\r\n        request['id'] = doc['_source']['id']\r\n        request['title'] = doc['_source']['title']\r\n        request['description'] = doc['_source']['description']\r\n        request['_source'][\"vector\"] = title_vectors[i]\r\n\r\n        requests.append(request)\r\n\r\n    bulk(new_client, iter(requests))\r\n``\r\n\r\nBODY = \"\"\"\r\n{\r\n  \"settings\": {\r\n    \"number_of_shards\": 2,\r\n    \"number_of_replicas\": 2\r\n  },\r\n   \"mappings\": {\r\n    \"dynamic\": \"true\",\r\n    \"_source\": {\r\n      \"enabled\": \"true\"\r\n    },\r\n    \"properties\": {\r\n      \"id\": {\r\n        \"type\": \"keyword\"\r\n      },\r\n      \"title\": {\r\n        \"type\": \"text\"\r\n      },\r\n      \"description\": {\r\n        \"type\": \"text\"\r\n      },\r\n      \"vector\": {\r\n        \"type\": \"dense_vector\",\r\n        \"dims\": 768\r\n      }\r\n    }\r\n  }\r\n}\r\n\"\"\"","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}