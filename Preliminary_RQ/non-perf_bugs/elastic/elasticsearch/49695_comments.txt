[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559594772","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559594772","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559594772,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTU5NDc3Mg==","user":{"login":"alexklibisz","id":8015228,"node_id":"MDQ6VXNlcjgwMTUyMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/8015228?v=4","gravatar_id":"","url":"https://api.github.com/users/alexklibisz","html_url":"https://github.com/alexklibisz","followers_url":"https://api.github.com/users/alexklibisz/followers","following_url":"https://api.github.com/users/alexklibisz/following{/other_user}","gists_url":"https://api.github.com/users/alexklibisz/gists{/gist_id}","starred_url":"https://api.github.com/users/alexklibisz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexklibisz/subscriptions","organizations_url":"https://api.github.com/users/alexklibisz/orgs","repos_url":"https://api.github.com/users/alexklibisz/repos","events_url":"https://api.github.com/users/alexklibisz/events{/privacy}","received_events_url":"https://api.github.com/users/alexklibisz/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T20:05:45Z","updated_at":"2019-11-28T20:05:45Z","author_association":"NONE","body":"After a bit more googling, I found that you can also access the original source using `params._source`.\r\nSo now this version of the script is working:\r\n\r\n```\r\n# Run a scripted search that just returns the 0th element.\r\nGET vectors/_search\r\n{\r\n  \"query\": {\r\n    \"script_score\": {\r\n      \"query\": {\r\n        \"exists\": {\r\n          \"field\": \"values\"\r\n        }\r\n      },\r\n      \"script\": {\r\n        \"source\": \"return params._source['values'][0];\",\r\n        \"lang\": \"painless\"\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThese SO questions were helpful:\r\n- https://stackoverflow.com/questions/41972733/elasticsearch-array-field-is-sorted-when-accessed-within-painless-scripting-lang?rq=1\r\n- https://stackoverflow.com/questions/55219970/es-painlessdifference-between-doc-and-params-source?rq=1\r\n\r\nIt would be great to get confirmation that this is the correct way to solve this problem. Thanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559598123","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559598123","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559598123,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTU5ODEyMw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T20:29:59Z","updated_at":"2019-11-28T20:29:59Z","author_association":"MEMBER","body":"Multi-valued field are sorted at index time in the doc-values so painless is not responsible of this ordering. This is intended but we should document this more clearly which is why I am marking this issue with the docs tag. \r\nRegarding the workaround, it is not recommended to access the source directly since your query will need to retrieve the entire json to extract a single value on all documents. You could instead use a separate field that records the first value and use the doc values of this field in your script score ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559598163","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559598163","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559598163,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTU5ODE2Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T20:30:13Z","updated_at":"2019-11-28T20:30:13Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search (:Search/Mapping)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559598169","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559598169","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559598169,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTU5ODE2OQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T20:30:14Z","updated_at":"2019-11-28T20:30:14Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-docs (>docs)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559601978","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559601978","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559601978,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTYwMTk3OA==","user":{"login":"alexklibisz","id":8015228,"node_id":"MDQ6VXNlcjgwMTUyMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/8015228?v=4","gravatar_id":"","url":"https://api.github.com/users/alexklibisz","html_url":"https://github.com/alexklibisz","followers_url":"https://api.github.com/users/alexklibisz/followers","following_url":"https://api.github.com/users/alexklibisz/following{/other_user}","gists_url":"https://api.github.com/users/alexklibisz/gists{/gist_id}","starred_url":"https://api.github.com/users/alexklibisz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexklibisz/subscriptions","organizations_url":"https://api.github.com/users/alexklibisz/orgs","repos_url":"https://api.github.com/users/alexklibisz/repos","events_url":"https://api.github.com/users/alexklibisz/events{/privacy}","received_events_url":"https://api.github.com/users/alexklibisz/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T20:58:53Z","updated_at":"2019-11-28T20:58:53Z","author_association":"NONE","body":"> Multi-valued field are sorted at index time in the doc-values so painless is not responsible of this ordering. This is intended but we should document this more clearly which is why I am marking this issue with the docs tag.\r\n> Regarding the workaround, it is not recommended to access the source directly since your query will need to retrieve the entire json to extract a single value on all documents. You could instead use a separate field that records the first value and use the doc values of this field in your script score ?\r\n\r\nI appreciate the quick response. I don't think I understand your recommendation. Could you show an example of the document JSON for the pattern you proposed?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559603140","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559603140","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559603140,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTYwMzE0MA==","user":{"login":"alexklibisz","id":8015228,"node_id":"MDQ6VXNlcjgwMTUyMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/8015228?v=4","gravatar_id":"","url":"https://api.github.com/users/alexklibisz","html_url":"https://github.com/alexklibisz","followers_url":"https://api.github.com/users/alexklibisz/followers","following_url":"https://api.github.com/users/alexklibisz/following{/other_user}","gists_url":"https://api.github.com/users/alexklibisz/gists{/gist_id}","starred_url":"https://api.github.com/users/alexklibisz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexklibisz/subscriptions","organizations_url":"https://api.github.com/users/alexklibisz/orgs","repos_url":"https://api.github.com/users/alexklibisz/repos","events_url":"https://api.github.com/users/alexklibisz/events{/privacy}","received_events_url":"https://api.github.com/users/alexklibisz/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T21:07:47Z","updated_at":"2019-11-28T21:07:47Z","author_association":"NONE","body":"Here are a couple other ways I could handle this:\r\n\r\n- Store the index alongside each element:\r\n```\r\n{ \"values\": { \"0\": 0.333, \"1\": 0.111, \"2\": 0.222 } }\r\n```\r\nI'm expecting to always have dense vectors, so this seems like it would waste a lot of space.\r\n\r\n- Store the vector as a comma-separated string:\r\n```\r\n{ \"values\": \"0.333,0.111,0.222\" }\r\n```\r\nI don't like this either since the added string parsing will likely slow down the script.\r\n\r\nIs there any way to just disable the index-time sorting?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559605489","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559605489","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559605489,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTYwNTQ4OQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T21:26:14Z","updated_at":"2019-11-28T21:26:14Z","author_association":"MEMBER","body":"> Is there any way to just disable the index-time sorting?\r\n\r\nWe have a [dense vector](https://www.elastic.co/guide/en/elasticsearch/reference/current/dense-vector.html) field type so you should take a look there. Can you describe the scoring that you apply on your vectors ? We have some [predefined functions](https://www.elastic.co/guide/en/elasticsearch/reference/master/query-dsl-script-score-query.html#vector-functions) that you could use.  ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559606096","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559606096","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559606096,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTYwNjA5Ng==","user":{"login":"alexklibisz","id":8015228,"node_id":"MDQ6VXNlcjgwMTUyMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/8015228?v=4","gravatar_id":"","url":"https://api.github.com/users/alexklibisz","html_url":"https://github.com/alexklibisz","followers_url":"https://api.github.com/users/alexklibisz/followers","following_url":"https://api.github.com/users/alexklibisz/following{/other_user}","gists_url":"https://api.github.com/users/alexklibisz/gists{/gist_id}","starred_url":"https://api.github.com/users/alexklibisz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexklibisz/subscriptions","organizations_url":"https://api.github.com/users/alexklibisz/orgs","repos_url":"https://api.github.com/users/alexklibisz/repos","events_url":"https://api.github.com/users/alexklibisz/events{/privacy}","received_events_url":"https://api.github.com/users/alexklibisz/received_events","type":"User","site_admin":false},"created_at":"2019-11-28T21:31:00Z","updated_at":"2019-11-28T21:31:00Z","author_association":"NONE","body":"> > Is there any way to just disable the index-time sorting?\r\n> \r\n> We have a [dense vector](https://www.elastic.co/guide/en/elasticsearch/reference/current/dense-vector.html) field type so you should take a look there. Can you describe the scoring that you apply on your vectors ? We have some [predefined functions](https://www.elastic.co/guide/en/elasticsearch/reference/master/query-dsl-script-score-query.html#vector-functions) that you could use.\r\n\r\nI'm computing distance functions, but not all of the functions I want are provided. Also, I'm confused by the \"X-Pack\" tags on those features, so I've avoided them. I assumed it means I have to have to have the commercial version of ES to use them.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/559832271","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-559832271","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":559832271,"node_id":"MDEyOklzc3VlQ29tbWVudDU1OTgzMjI3MQ==","user":{"login":"alexklibisz","id":8015228,"node_id":"MDQ6VXNlcjgwMTUyMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/8015228?v=4","gravatar_id":"","url":"https://api.github.com/users/alexklibisz","html_url":"https://github.com/alexklibisz","followers_url":"https://api.github.com/users/alexklibisz/followers","following_url":"https://api.github.com/users/alexklibisz/following{/other_user}","gists_url":"https://api.github.com/users/alexklibisz/gists{/gist_id}","starred_url":"https://api.github.com/users/alexklibisz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexklibisz/subscriptions","organizations_url":"https://api.github.com/users/alexklibisz/orgs","repos_url":"https://api.github.com/users/alexklibisz/repos","events_url":"https://api.github.com/users/alexklibisz/events{/privacy}","received_events_url":"https://api.github.com/users/alexklibisz/received_events","type":"User","site_admin":false},"created_at":"2019-11-29T16:01:48Z","updated_at":"2019-11-29T16:01:48Z","author_association":"NONE","body":"I looked more at the dense vector type. There are a few issues for my use case:\r\n1. It only supports storing floats. There are cases where I need to store boolean vectors as well.\r\n2. It doesn't support accessing values from a custom script. The `.get` method throws an exception when trying to access an index.\r\n3. I noticed sparse vectors were recently deprecated due to lack of adoption. Could dense vectors also be deprecated?\r\n\r\nI acknwoledge my use-case is a bit niche, and I don't want to hog resources. It would be best if there's a way to disable the index-time sorting so I can access the doc-values vector in its original order. If not, I'll just continue accessing via `params._source`, and if it becomes a performance bottleneck I'll revisit the issue. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/560051392","html_url":"https://github.com/elastic/elasticsearch/issues/49695#issuecomment-560051392","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/49695","id":560051392,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MDA1MTM5Mg==","user":{"login":"alexklibisz","id":8015228,"node_id":"MDQ6VXNlcjgwMTUyMjg=","avatar_url":"https://avatars2.githubusercontent.com/u/8015228?v=4","gravatar_id":"","url":"https://api.github.com/users/alexklibisz","html_url":"https://github.com/alexklibisz","followers_url":"https://api.github.com/users/alexklibisz/followers","following_url":"https://api.github.com/users/alexklibisz/following{/other_user}","gists_url":"https://api.github.com/users/alexklibisz/gists{/gist_id}","starred_url":"https://api.github.com/users/alexklibisz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexklibisz/subscriptions","organizations_url":"https://api.github.com/users/alexklibisz/orgs","repos_url":"https://api.github.com/users/alexklibisz/repos","events_url":"https://api.github.com/users/alexklibisz/events{/privacy}","received_events_url":"https://api.github.com/users/alexklibisz/received_events","type":"User","site_admin":false},"created_at":"2019-12-01T04:08:02Z","updated_at":"2019-12-01T04:08:02Z","author_association":"NONE","body":"Closing as I was able to work around this by creating a mapper plugin to store my double and boolean vectors with a proper `get(i)` method to access the elements in their original order. I'm planning to open source this work so I'll try to remember to post a link on this issue once I do. \r\n\r\nIt would still be great to get some additional docs describing the original quirk about accessing elements in lists from painless scripts. Thanks for your help @jimczi.","performed_via_github_app":null}]