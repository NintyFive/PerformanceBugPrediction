{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20959","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20959/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20959/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20959/events","html_url":"https://github.com/elastic/elasticsearch/issues/20959","id":183338925,"node_id":"MDU6SXNzdWUxODMzMzg5MjU=","number":20959,"title":"ArrayIndexOutOfBoundsException while searching index, the number of return documents shoud be very large ","user":{"login":"rubbyjing20","id":22879910,"node_id":"MDQ6VXNlcjIyODc5OTEw","avatar_url":"https://avatars2.githubusercontent.com/u/22879910?v=4","gravatar_id":"","url":"https://api.github.com/users/rubbyjing20","html_url":"https://github.com/rubbyjing20","followers_url":"https://api.github.com/users/rubbyjing20/followers","following_url":"https://api.github.com/users/rubbyjing20/following{/other_user}","gists_url":"https://api.github.com/users/rubbyjing20/gists{/gist_id}","starred_url":"https://api.github.com/users/rubbyjing20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rubbyjing20/subscriptions","organizations_url":"https://api.github.com/users/rubbyjing20/orgs","repos_url":"https://api.github.com/users/rubbyjing20/repos","events_url":"https://api.github.com/users/rubbyjing20/events{/privacy}","received_events_url":"https://api.github.com/users/rubbyjing20/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-10-17T06:55:19Z","updated_at":"2016-10-17T08:42:35Z","closed_at":"2016-10-17T07:12:17Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\nI am using latest version of elasticsearch to search a large number of index. The number of returned document should be around 4000000. I don't want to use scroll cause I would like to record the time to return the result without counting the network time in multiple scrolls. However, when size in search increase to 712227,  I got the ArrayIndexOutOfBoundsException error.  I increase the heap size to 64G and increase the max open file to 65535. Neither of them works. \n\nThe stack trace are as below:\njava.lang.ArrayIndexOutOfBoundsException: -131072\n.       at org.elasticsearch.common.util.BigByteArray.set(BigByteArray.java:97)\n.       at org.elasticsearch.common.io.stream.BytesStreamOutput.writeBytes(BytesStreamOutput.java:93)\n.       at org.elasticsearch.common.io.stream.StreamOutput.write(StreamOutput.java:299)\n.       at com.fasterxml.jackson.core.json.UTF8JsonGenerator._flushBuffer(UTF8JsonGenerator.java:2014)\n.       at com.fasterxml.jackson.core.json.UTF8JsonGenerator.flush(UTF8JsonGenerator.java:1027)\n.       at org.elasticsearch.common.xcontent.json.JsonXContentGenerator.flush(JsonXContentGenerator.java:436)\n.       at org.elasticsearch.common.xcontent.json.JsonXContentGenerator.writeRawField(JsonXContentGenerator.java:369)\n.       at org.elasticsearch.common.xcontent.XContentBuilder.rawField(XContentBuilder.java:914)\n.       at org.elasticsearch.common.xcontent.XContentHelper.writeRawField(XContentHelper.java:378)\n.       at org.elasticsearch.search.internal.InternalSearchHit.toXContent(InternalSearchHit.java:476)\n.       at org.elasticsearch.search.internal.InternalSearchHits.toXContent(InternalSearchHits.java:184)\n.       at org.elasticsearch.search.internal.InternalSearchResponse.toXContent(InternalSearchResponse.java:111)\n.       at org.elasticsearch.action.search.SearchResponse.toXContent(SearchResponse.java:195)\n.       at org.elasticsearch.rest.action.support.RestStatusToXContentListener.buildResponse(RestStatusToXContentListener.java:43)\n.       at org.elasticsearch.rest.action.support.RestStatusToXContentListener.buildResponse(RestStatusToXContentListener.java:38)\n.       at org.elasticsearch.rest.action.support.RestStatusToXContentListener.buildResponse(RestStatusToXContentListener.java:30)\n.       at org.elasticsearch.rest.action.support.RestResponseListener.processResponse(RestResponseListener.java:43)\n.       at org.elasticsearch.rest.action.support.RestActionListener.onResponse(RestActionListener.java:49)\n.       at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:89)\n.       at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:85)\n.       at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction.innerFinishHim(SearchScrollQueryThenFetchAsyncAction.java:223)\n.       at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction.finishHim(SearchScrollQueryThenFetchAsyncAction.java:211)\n.       at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction.access$100(SearchScrollQueryThenFetchAsyncAction.java:44)\n.       at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction$2.onResponse(SearchScrollQueryThenFetchAsyncAction.java:191)\n.       at org.elasticsearch.action.search.SearchScrollQueryThenFetchAsyncAction$2.onResponse(SearchScrollQueryThenFetchAsyncAction.java:185)\n.       at org.elasticsearch.action.ActionListenerResponseHandler.handleResponse(ActionListenerResponseHandler.java:41)\n.       at org.elasticsearch.transport.TransportService$DirectResponseChannel.processResponse(TransportService.java:836)\n.       at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:820)\n.       at org.elasticsearch.transport.TransportService$DirectResponseChannel.sendResponse(TransportService.java:810)\n.       at org.elasticsearch.transport.DelegatingTransportChannel.sendResponse(DelegatingTransportChannel.java:58)\n.       at org.elasticsearch.transport.RequestHandlerRegistry$TransportChannelWrapper.sendResponse(RequestHandlerRegistry.java:140)\n.       at org.elasticsearch.search.action.SearchServiceTransportAction$FetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:409)\n.       at org.elasticsearch.search.action.SearchServiceTransportAction$FetchByIdTransportHandler.messageReceived(SearchServiceTransportAction.java:405)\n.       at org.elasticsearch.transport.TransportRequestHandler.messageReceived(TransportRequestHandler.java:33)\n.       at org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:77)\n.       at org.elasticsearch.transport.TransportService$4.doRun(TransportService.java:376)\n.       at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\n.       at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n.       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n.       at java.lang.Thread.run(Thread.java:745)\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}