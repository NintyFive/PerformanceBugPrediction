[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279832460","html_url":"https://github.com/elastic/elasticsearch/issues/23169#issuecomment-279832460","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23169","id":279832460,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTgzMjQ2MA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-02-14T20:53:29Z","updated_at":"2017-02-14T20:53:29Z","author_association":"MEMBER","body":"@seang-es Can you please include the exact mappings, as well as the output when retrieving the updated document?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279858626","html_url":"https://github.com/elastic/elasticsearch/issues/23169#issuecomment-279858626","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23169","id":279858626,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTg1ODYyNg==","user":{"login":"jpcarey","id":5118470,"node_id":"MDQ6VXNlcjUxMTg0NzA=","avatar_url":"https://avatars2.githubusercontent.com/u/5118470?v=4","gravatar_id":"","url":"https://api.github.com/users/jpcarey","html_url":"https://github.com/jpcarey","followers_url":"https://api.github.com/users/jpcarey/followers","following_url":"https://api.github.com/users/jpcarey/following{/other_user}","gists_url":"https://api.github.com/users/jpcarey/gists{/gist_id}","starred_url":"https://api.github.com/users/jpcarey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpcarey/subscriptions","organizations_url":"https://api.github.com/users/jpcarey/orgs","repos_url":"https://api.github.com/users/jpcarey/repos","events_url":"https://api.github.com/users/jpcarey/events{/privacy}","received_events_url":"https://api.github.com/users/jpcarey/received_events","type":"User","site_admin":false},"created_at":"2017-02-14T22:35:53Z","updated_at":"2017-02-14T22:35:53Z","author_association":"MEMBER","body":"Elasticsearch 5.2.0 + x-pack, macOS Sierra 10.12.3 (16D32), Oracle java version \"1.8.0_65\"\r\n```\r\nPOST t/t/1\r\n{\r\n  \"foo\": \"bar\"\r\n}\r\nPOST t/t/1/_update\r\n{\r\n  \"script\": {\r\n    \"inline\": \"ctx._source.timestamp_now = ctx._now; ctx._source.epochms = new Date().getTime();\",\r\n    \"lang\": \"painless\"\r\n  },\r\n  \"upsert\": {\r\n    \"foo\": \"bar2\"\r\n  }\r\n}\r\n```\r\n`GET t/t/1` Response:\r\n```\r\n{\r\n  \"_index\": \"t\",\r\n  \"_type\": \"t\",\r\n  \"_id\": \"1\",\r\n  \"_version\": 4,\r\n  \"found\": true,\r\n  \"_source\": {\r\n    \"foo\": \"bar\",\r\n    \"timestamp_now\": 1206909990,\r\n    \"epochms\": 1487111464024\r\n  }\r\n}\r\n```\r\n`GET t/_mapping` Response:\r\n```\r\n{\r\n  \"t\": {\r\n    \"mappings\": {\r\n      \"t\": {\r\n        \"properties\": {\r\n          \"epochms\": {\r\n            \"type\": \"long\"\r\n          },\r\n          \"foo\": {\r\n            \"type\": \"text\",\r\n            \"fields\": {\r\n              \"keyword\": {\r\n                \"type\": \"keyword\",\r\n                \"ignore_above\": 256\r\n              }\r\n            }\r\n          },\r\n          \"timestamp_now\": {\r\n            \"type\": \"long\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279860788","html_url":"https://github.com/elastic/elasticsearch/issues/23169#issuecomment-279860788","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23169","id":279860788,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTg2MDc4OA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2017-02-14T22:45:19Z","updated_at":"2017-02-14T22:45:19Z","author_association":"CONTRIBUTOR","body":"I think this is a bug. _now is set to nanotime in millis. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279886649","html_url":"https://github.com/elastic/elasticsearch/issues/23169#issuecomment-279886649","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23169","id":279886649,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTg4NjY0OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-02-15T01:02:59Z","updated_at":"2017-02-15T01:02:59Z","author_association":"MEMBER","body":"I found the bug. We currently use `System.nanoTime()` and convert that to milliseconds, but that is *not* milliseconds since epoch. This was changed about 1.5 years ago to avoid System.currentTimeMillis() from going backwards (see #11626).  We either need to go back to System.currentTimeMillis(), or look at how to protecting from negative time diffs differently.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/279889085","html_url":"https://github.com/elastic/elasticsearch/issues/23169#issuecomment-279889085","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23169","id":279889085,"node_id":"MDEyOklzc3VlQ29tbWVudDI3OTg4OTA4NQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-02-15T01:17:25Z","updated_at":"2017-02-15T01:17:25Z","author_association":"MEMBER","body":"Oops sorry Simon, I guess that's what you were trying to say. :) ","performed_via_github_app":null}]