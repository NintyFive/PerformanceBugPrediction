{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11360","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11360/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11360/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11360/events","html_url":"https://github.com/elastic/elasticsearch/issues/11360","id":81098833,"node_id":"MDU6SXNzdWU4MTA5ODgzMw==","number":11360,"title":"JNA is not optional when testing on windows","user":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"assignees":[{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2015-05-26T19:20:08Z","updated_at":"2015-05-27T17:14:26Z","closed_at":"2015-05-27T17:14:23Z","author_association":"MEMBER","active_lock_reason":null,"body":"The JNA library is listed as optional in the pom file but when running tests in another project without the library, we still try to load it and loading fails with a `ClassNotFoundException`:\n\n```\n   > Throwable #1: java.lang.NoClassDefFoundError: com/sun/jna/win32/StdCallLibrary$StdCallCallback\n   >    at org.elasticsearch.common.jna.Natives.tryVirtualLock(Natives.java:83)\n   >    at org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:93)\n   >    at org.elasticsearch.bootstrap.BootstrapForTesting.<clinit>(BootstrapForTesting.java:52)\n   >    at org.elasticsearch.test.ElasticsearchTestCase.<clinit>(ElasticsearchTestCase.java:97)\n   >    at java.lang.Class.forName0(Native Method)\n   >    at java.lang.Class.forName(Class.java:274)\n   > Caused by: java.lang.ClassNotFoundException: com.sun.jna.win32.StdCallLibrary$StdCallCallback\n   >    at java.net.URLClassLoader$1.run(URLClassLoader.java:366)\n   >    at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n   >    at java.security.AccessController.doPrivileged(Native Method)\n   >    at java.net.URLClassLoader.findClass(URLClassLoader.java:354)\n   >    at java.lang.ClassLoader.loadClass(ClassLoader.java:425)\n   >    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)\n   >    at java.lang.ClassLoader.loadClass(ClassLoader.java:358)\n   >    ... 7 more\n```\n\nwhich then cascades into:\n\n```\n   > Throwable #1: java.lang.NoClassDefFoundError: org.elasticsearch.test.ElasticsearchTestCase\n   >    at java.lang.Class.getDeclaredMethods0(Native Method)\n   >    at java.lang.Class.privateGetDeclaredMethods(Class.java:2615)\n   >    at java.lang.Class.getDeclaredMethods(Class.java:1860)\n   >    at com.carrotsearch.randomizedtesting.ClassModel$3.members(ClassModel.java:215)\n   >    at com.carrotsearch.randomizedtesting.ClassModel$3.members(ClassModel.java:212)\n   >    at com.carrotsearch.randomizedtesting.ClassModel$ModelBuilder.build(ClassModel.java:85)\n   >    at com.carrotsearch.randomizedtesting.ClassModel.methodsModel(ClassModel.java:224)\n   >    at com.carrotsearch.randomizedtesting.ClassModel.<init>(ClassModel.java:207)\n   >    at java.lang.reflect.Constructor.newInstance(Constructor.java:526)\n```\n\nThis seems to be provoked only on Windows by the `Natives#tryVirtualLock` method currently.\n","closed_by":{"login":"jaymode","id":4339958,"node_id":"MDQ6VXNlcjQzMzk5NTg=","avatar_url":"https://avatars1.githubusercontent.com/u/4339958?v=4","gravatar_id":"","url":"https://api.github.com/users/jaymode","html_url":"https://github.com/jaymode","followers_url":"https://api.github.com/users/jaymode/followers","following_url":"https://api.github.com/users/jaymode/following{/other_user}","gists_url":"https://api.github.com/users/jaymode/gists{/gist_id}","starred_url":"https://api.github.com/users/jaymode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaymode/subscriptions","organizations_url":"https://api.github.com/users/jaymode/orgs","repos_url":"https://api.github.com/users/jaymode/repos","events_url":"https://api.github.com/users/jaymode/events{/privacy}","received_events_url":"https://api.github.com/users/jaymode/received_events","type":"User","site_admin":false},"performed_via_github_app":null}