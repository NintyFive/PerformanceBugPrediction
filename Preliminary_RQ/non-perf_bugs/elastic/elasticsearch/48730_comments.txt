[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/548259875","html_url":"https://github.com/elastic/elasticsearch/issues/48730#issuecomment-548259875","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48730","id":548259875,"node_id":"MDEyOklzc3VlQ29tbWVudDU0ODI1OTg3NQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2019-10-31T08:16:22Z","updated_at":"2019-10-31T08:16:22Z","author_association":"MEMBER","body":"Is the flush api used frequently? This can cause the creation of many small translog files.\r\nCan you share node stats for this particular node (GET /_nodes/{node-id}/stats/_all)?\r\n\r\n> this node has thousands of shards\r\n\r\nThat is a large number of shards for a single node. I would suggest to either reduce the number of shards or add more data nodes. In case of the many translog files, having this many shards, can cause the number of translog files to grow to a large number on this node.\r\n\r\nAlso `lsof` reports open file handles many times over. Combined with having many shards on this node, the number of translog open file handles that `lsof` reports can be a lot.\r\n\r\nRecently an improvement (#47414) was made that restricts the number of translog files in cases where the translog files are very small. This improvement is part of the 6.8.4 release, so perhaps it makes sense to upgrade to this version.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/548682502","html_url":"https://github.com/elastic/elasticsearch/issues/48730#issuecomment-548682502","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48730","id":548682502,"node_id":"MDEyOklzc3VlQ29tbWVudDU0ODY4MjUwMg==","user":{"login":"wangkhc","id":32295978,"node_id":"MDQ6VXNlcjMyMjk1OTc4","avatar_url":"https://avatars1.githubusercontent.com/u/32295978?v=4","gravatar_id":"","url":"https://api.github.com/users/wangkhc","html_url":"https://github.com/wangkhc","followers_url":"https://api.github.com/users/wangkhc/followers","following_url":"https://api.github.com/users/wangkhc/following{/other_user}","gists_url":"https://api.github.com/users/wangkhc/gists{/gist_id}","starred_url":"https://api.github.com/users/wangkhc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangkhc/subscriptions","organizations_url":"https://api.github.com/users/wangkhc/orgs","repos_url":"https://api.github.com/users/wangkhc/repos","events_url":"https://api.github.com/users/wangkhc/events{/privacy}","received_events_url":"https://api.github.com/users/wangkhc/received_events","type":"User","site_admin":false},"created_at":"2019-11-01T06:31:26Z","updated_at":"2019-11-01T06:31:26Z","author_association":"CONTRIBUTOR","body":"> Is the flush api used frequently?\r\n\r\nNo, this user already stopped any operations to this cluster.\r\n\r\n> Can you share node stats for this particular node (GET /_nodes/{node-id}/stats/_all)?\r\n\r\nUnfortunally, this cluster was already released by user for this unstable performace, I'm afraid no more scene can be acquired from this cluster :(\r\n\r\n> Also lsof reports open file handles many times over. Combined with having many shards on this node, the number of translog open file handles that lsof reports can be a lot.\r\n\r\nThe point is, taking translog-3.ckp as an example in the screenshot, this file is created several days ago, why did this file still not be released, which finally exhausted os total file handler?\r\n\r\n> Recently an improvement (#47414) was made that restricts the number of translog files in cases where the translog files are very small. This improvement is part of the 6.8.4 release, so perhaps it makes sense to upgrade to this version.\r\n\r\nTks, This pr seems to be a feasible workaround, but I still wonder that besides manually invoking \"flush\" api, is there any corner situation that can cause inner flush keeps happening? ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/548749352","html_url":"https://github.com/elastic/elasticsearch/issues/48730#issuecomment-548749352","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/48730","id":548749352,"node_id":"MDEyOklzc3VlQ29tbWVudDU0ODc0OTM1Mg==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2019-11-01T11:00:30Z","updated_at":"2019-11-01T11:00:30Z","author_association":"CONTRIBUTOR","body":"There is significant confusion here. The screenshot above shows many different files called `translog-3.ckp` with different paths. It is the expected behaviour that some of these remain open for days at a time. Also, `lsof | grep | wc` gives a number that is usually wildly inaccurate as an estimate of the number of open file handles. Given that the cluster no longer exists for further investigation I think we cannot take any action here so I am closing this.","performed_via_github_app":null}]