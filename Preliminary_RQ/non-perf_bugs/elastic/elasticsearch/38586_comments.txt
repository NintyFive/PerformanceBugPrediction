[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/461616182","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-461616182","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":461616182,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MTYxNjE4Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-02-07T22:19:07Z","updated_at":"2019-02-07T22:19:07Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470048263","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-470048263","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":470048263,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDA0ODI2Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-06T10:08:55Z","updated_at":"2019-03-06T10:08:55Z","author_association":"MEMBER","body":"Regardless of the fix proposed in https://github.com/elastic/elasticsearch/pull/39200 I wonder if we should not force the execution of the fetch phase in the coordinating node like we do for the search phase: https://github.com/elastic/elasticsearch/blob/9e706966282eaadafc77727059dd4194cbed492a/server/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java#L176 \r\nI don't think we should fail the execution just because we fork a thread to reduce the results coming from different shards, rejection should happen at the shard level and not at the coord level where the execution of the query already started. @jpountz, @s1monw what do you think ?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470271879","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-470271879","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":470271879,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDI3MTg3OQ==","user":{"login":"jainankitk","id":8193480,"node_id":"MDQ6VXNlcjgxOTM0ODA=","avatar_url":"https://avatars2.githubusercontent.com/u/8193480?v=4","gravatar_id":"","url":"https://api.github.com/users/jainankitk","html_url":"https://github.com/jainankitk","followers_url":"https://api.github.com/users/jainankitk/followers","following_url":"https://api.github.com/users/jainankitk/following{/other_user}","gists_url":"https://api.github.com/users/jainankitk/gists{/gist_id}","starred_url":"https://api.github.com/users/jainankitk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jainankitk/subscriptions","organizations_url":"https://api.github.com/users/jainankitk/orgs","repos_url":"https://api.github.com/users/jainankitk/repos","events_url":"https://api.github.com/users/jainankitk/events{/privacy}","received_events_url":"https://api.github.com/users/jainankitk/received_events","type":"User","site_admin":false},"created_at":"2019-03-06T20:52:34Z","updated_at":"2019-03-06T23:52:20Z","author_association":"CONTRIBUTOR","body":"On a similar note, I find [query validation happening on non-coordinator nodes](https://github.com/elastic/elasticsearch/issues/26799) kind of confusing and inefficient.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470278395","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-470278395","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":470278395,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDI3ODM5NQ==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2019-03-06T21:11:54Z","updated_at":"2019-03-06T21:11:54Z","author_association":"CONTRIBUTOR","body":"@jimczi I agree that it feels wrong to reject fetch phases when we already likely did most of the work with the query phase. I'm wondering that maybe we should only allow rejections on the first phase that does something significant (ie. not can_match)? I need to think more about it but never rejecting on the coordinating node feels potentially dangerous to me?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470391604","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-470391604","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":470391604,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDM5MTYwNA==","user":{"login":"atris","id":1724131,"node_id":"MDQ6VXNlcjE3MjQxMzE=","avatar_url":"https://avatars0.githubusercontent.com/u/1724131?v=4","gravatar_id":"","url":"https://api.github.com/users/atris","html_url":"https://github.com/atris","followers_url":"https://api.github.com/users/atris/followers","following_url":"https://api.github.com/users/atris/following{/other_user}","gists_url":"https://api.github.com/users/atris/gists{/gist_id}","starred_url":"https://api.github.com/users/atris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atris/subscriptions","organizations_url":"https://api.github.com/users/atris/orgs","repos_url":"https://api.github.com/users/atris/repos","events_url":"https://api.github.com/users/atris/events{/privacy}","received_events_url":"https://api.github.com/users/atris/received_events","type":"User","site_admin":false},"created_at":"2019-03-07T05:34:24Z","updated_at":"2019-03-07T05:34:24Z","author_association":"NONE","body":"+1 on rejecting early than in FetchPhase. It is way too expensive to discard all of the QueryPhase's processing.\r\n\r\nOn that note, would it help if we gave FetchPhase a higher priority than SearchPhase during execution, since both are scheduled on the same threadpool? This situation would typically occur in a search heavy workload, so the coordinator node has to keep all the shard responses in memory until the FetchPhase completes. If FetchPhase were to complete faster, then the probability of throttling triggering during a FetchPhase's lifetime decreases.\r\n\r\nThoughts?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470429857","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-470429857","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":470429857,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDQyOTg1Nw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2019-03-07T08:19:49Z","updated_at":"2019-03-07T08:19:49Z","author_association":"CONTRIBUTOR","body":"Giving fetch tasks a higher priority to fetch tasks sounds desirable to me too. I had opened #29366 with data nodes in mind but it probably makes sense for coordinating nodes as well.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470434987","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-470434987","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":470434987,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDQzNDk4Nw==","user":{"login":"atris","id":1724131,"node_id":"MDQ6VXNlcjE3MjQxMzE=","avatar_url":"https://avatars0.githubusercontent.com/u/1724131?v=4","gravatar_id":"","url":"https://api.github.com/users/atris","html_url":"https://github.com/atris","followers_url":"https://api.github.com/users/atris/followers","following_url":"https://api.github.com/users/atris/following{/other_user}","gists_url":"https://api.github.com/users/atris/gists{/gist_id}","starred_url":"https://api.github.com/users/atris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atris/subscriptions","organizations_url":"https://api.github.com/users/atris/orgs","repos_url":"https://api.github.com/users/atris/repos","events_url":"https://api.github.com/users/atris/events{/privacy}","received_events_url":"https://api.github.com/users/atris/received_events","type":"User","site_admin":false},"created_at":"2019-03-07T08:37:28Z","updated_at":"2019-03-07T08:37:28Z","author_association":"NONE","body":"@jpountz I can help take a crack at both, if it helps. It sems we would have the same priority assignment mechanism across both the coordinator and data nodes.\r\n\r\nPer our discussion on the other issue, the task right now is to generate significant search workload so that this issue becomes relevant. I can imagine some ways of artifically simulating the scenario, but I doubt if that is the right way to test.\r\n\r\nAny thoughts on generating the workload? Maybe a more intensive nyc_taxis track would help?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470987220","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-470987220","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":470987220,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDk4NzIyMA==","user":{"login":"atris","id":1724131,"node_id":"MDQ6VXNlcjE3MjQxMzE=","avatar_url":"https://avatars0.githubusercontent.com/u/1724131?v=4","gravatar_id":"","url":"https://api.github.com/users/atris","html_url":"https://github.com/atris","followers_url":"https://api.github.com/users/atris/followers","following_url":"https://api.github.com/users/atris/following{/other_user}","gists_url":"https://api.github.com/users/atris/gists{/gist_id}","starred_url":"https://api.github.com/users/atris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atris/subscriptions","organizations_url":"https://api.github.com/users/atris/orgs","repos_url":"https://api.github.com/users/atris/repos","events_url":"https://api.github.com/users/atris/events{/privacy}","received_events_url":"https://api.github.com/users/atris/received_events","type":"User","site_admin":false},"created_at":"2019-03-08T16:22:42Z","updated_at":"2019-03-08T16:22:42Z","author_association":"NONE","body":"@jpountz @javanna Should I open a separate issue for the discussion above?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470989556","html_url":"https://github.com/elastic/elasticsearch/issues/38586#issuecomment-470989556","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38586","id":470989556,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDk4OTU1Ng==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2019-03-08T16:29:13Z","updated_at":"2019-03-08T16:29:13Z","author_association":"CONTRIBUTOR","body":"Please do.","performed_via_github_app":null}]