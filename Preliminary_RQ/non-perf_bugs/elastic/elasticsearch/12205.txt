{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12205","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12205/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12205/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12205/events","html_url":"https://github.com/elastic/elasticsearch/issues/12205","id":94731077,"node_id":"MDU6SXNzdWU5NDczMTA3Nw==","number":12205,"title":"UpdateRequest after ES 1.5.0 doesnâ€™t work function script()","user":{"login":"CamiloSierraH","id":6648062,"node_id":"MDQ6VXNlcjY2NDgwNjI=","avatar_url":"https://avatars3.githubusercontent.com/u/6648062?v=4","gravatar_id":"","url":"https://api.github.com/users/CamiloSierraH","html_url":"https://github.com/CamiloSierraH","followers_url":"https://api.github.com/users/CamiloSierraH/followers","following_url":"https://api.github.com/users/CamiloSierraH/following{/other_user}","gists_url":"https://api.github.com/users/CamiloSierraH/gists{/gist_id}","starred_url":"https://api.github.com/users/CamiloSierraH/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CamiloSierraH/subscriptions","organizations_url":"https://api.github.com/users/CamiloSierraH/orgs","repos_url":"https://api.github.com/users/CamiloSierraH/repos","events_url":"https://api.github.com/users/CamiloSierraH/events{/privacy}","received_events_url":"https://api.github.com/users/CamiloSierraH/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-07-13T14:16:30Z","updated_at":"2015-07-13T16:05:13Z","closed_at":"2015-07-13T14:21:11Z","author_association":"NONE","active_lock_reason":null,"body":"i use kafka(input) and logstash (1.5.2) with (output) elasticsearch (ES 1.5.2 or 1.6.0)\n- i change the code in plugin output elasticsearch to be able to update documents and for that i use the UpdateRequest API.\n  https://github.com/logstash-plugins/logstash-output-elasticsearch/pull/188/files\n- until Elasticsearch 1.5.0 the function request.script(args[:_script]) works without problem but after in versions 1.5.2 or 1.6.0 this function doesn't work anymore \n\nEven a simple action in the script like update a integer field fail : \n\n```\n{\"document_id\":\"2754\",\"script\":\"ctx._source.country = 76\",\"action\":\"update\",\"retry_on_conflict\":3}\n```\n\nerror log : \n\n```\n    failedactionwithresponseof400,\ndroppingaction: [\n    \"update\",\n    {\n        : _id=>\"21-2-1\",\n        : _index=>\"drilling_m02_2014_test\",\n        : _type=>\"detailed\",\n        : _routing=>nil,\n        : _script=>\" if (ctx._source.edt == null) { ctx._source.edt = eventData; ctx._source.vdu = []; ctx._source.pdt = []; } else { ctx._source.edt += eventData; } \",\n        : _scriptParams=>{\n            \"label\"=>\"eventData\",\n            \"params\"=><Java: : JavaUtil: : ArrayList: -610349907[\n                {\n                    \"filter\"=>\"city\",\n                    \"value\"=>\"New York\",\n                    \"vid\"=>156442965,\n                    \"eid\"=>16928\n                },\n                {\n                    \"filter\"=>\"image_id\",\n                    \"value\"=>\"34eerts7\",\n                    \"vid\"=>156442965,\n                    \"eid\"=>16928\n                }\n            ]>\n        },\n        : _retry_on_conflict=>5\n    },\n    #<LogStash: : Event: 0x3a60323f@metadata={\n        \"retry_count\"=>0\n    },\n    @accessors=#<LogStash: : Util: : Accessors: 0x38494d4c@store={\n        \"action\"=>\"update\",\n        \"document_id\"=>\"21-2-1\",\n        \"index_date\"=>\"drilling_m02_2014_test\",\n        \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n    },\n    @lut={\n        \"@version\"=>[\n            {\n                \"action\"=>\"update\",\n                \"document_id\"=>\"21-2-1\",\n                \"index_date\"=>\"drilling_m02_2014_test\",\n                \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n            },\n            \"@version\"\n        ],\n        \"index_date\"=>[\n            {\n                \"action\"=>\"update\",\n                \"document_id\"=>\"21-2-1\",\n                \"index_date\"=>\"drilling_m02_2014_test\",\n                \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n            },\n            \"index_date\"\n        ],\n        \"document_id\"=>[\n            {\n                \"action\"=>\"update\",\n                \"document_id\"=>\"21-2-1\",\n                \"index_date\"=>\"drilling_m02_2014_test\",\n                \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n            },\n            \"document_id\"\n        ],\n        \"action\"=>[\n            {\n                \"action\"=>\"update\",\n                \"document_id\"=>\"21-2-1\",\n                \"index_date\"=>\"drilling_m02_2014_test\",\n                \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n            },\n            \"action\"\n        ],\n        \"script\"=>[\n            {\n                \"action\"=>\"update\",\n                \"document_id\"=>\"21-2-1\",\n                \"index_date\"=>\"drilling_m02_2014_test\",\n                \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n            },\n            \"script\"\n        ],\n        \"scriptParams\"=>[\n            {\n                \"action\"=>\"update\",\n                \"document_id\"=>\"21-2-1\",\n                \"index_date\"=>\"drilling_m02_2014_test\",\n                \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n            },\n            \"scriptParams\"\n        ],\n        \"retry_on_conflict\"=>[\n            {\n                \"action\"=>\"update\",\n                \"document_id\"=>\"21-2-1\",\n                \"index_date\"=>\"drilling_m02_2014_test\",\n                \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n            },\n            \"retry_on_conflict\"\n        ]\n    }>,\n    @data={\n        \"action\"=>\"update\",\n        \"document_id\"=>\"21-2-1\",\n        \"index_date\"=>\"drilling_m02_2014_test\",\n        \"@timestamp\"=>\"2015-07-13T09:58:13.297Z\"\n    },\n    @metadata_accessors=#<LogStash: : Util: : Accessors: 0x3dc05ec4@store={\n        \"retry_count\"=>0\n    },\n    @lut={\n\n    }>,\n    @cancelled=false>\n]{\n    : level=>: warn\n}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}