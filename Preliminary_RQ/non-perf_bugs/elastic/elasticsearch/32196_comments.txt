[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/406280981","html_url":"https://github.com/elastic/elasticsearch/issues/32196#issuecomment-406280981","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196","id":406280981,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjI4MDk4MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-19T13:44:14Z","updated_at":"2018-07-19T13:44:14Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/406311348","html_url":"https://github.com/elastic/elasticsearch/issues/32196#issuecomment-406311348","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196","id":406311348,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNjMxMTM0OA==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2018-07-19T15:11:22Z","updated_at":"2018-07-19T15:11:22Z","author_association":"MEMBER","body":"> 15:12:15   1> java.net.SocketException: Socket is closed\r\n\r\nThe test is an evil test that randomly takes down nodes in the cluster to assert the ml jobs relocate correctly so these log messages are expected. \r\n\r\nThe test failed because of zombie threads leaking \r\n>  2> SEVERE: There are still zombie threads that couldn't be terminated:\r\n  2>    1) Thread[id=262, name=elasticsearch[node_t0][ml_autodetect][T#1], state=RUNNABLE, group=TGRP-BasicDistributedJobsIT]\r\n\r\n>  2> INFO: Starting to interrupt leaked threads:\r\n...\r\n> at org.elasticsearch.xpack.ml.job.process.autodetect.AutodetectCommunicator.waitFlushToCompletion(AutodetectCommunicator.java:282)\r\n\r\nI see why we get the zombie threads because the interrupt is caught [here](https://github.com/elastic/elasticsearch/blob/308e37f80ed474c86546d3b319e439b7da3c810a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/process/autodetect/output/FlushListener.java#L35) returning null which causes [this loop](https://github.com/elastic/elasticsearch/blob/308e37f80ed474c86546d3b319e439b7da3c810a/x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/job/process/autodetect/AutodetectCommunicator.java#L282) to continue. \r\n\r\nEssentially the interrupt is ignored and we can fix that but the underlying question is why was the thread still running when the job should have been closed at the end of the test. \r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/409699840","html_url":"https://github.com/elastic/elasticsearch/issues/32196#issuecomment-409699840","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196","id":409699840,"node_id":"MDEyOklzc3VlQ29tbWVudDQwOTY5OTg0MA==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2018-08-01T19:51:02Z","updated_at":"2018-08-01T19:51:02Z","author_association":"MEMBER","body":"https://github.com/elastic/elasticsearch/pull/32541 Addressed the zombie thread issue, but the root cause of the job being closed not causing it to completely die is still not known. \r\n\r\nMore data is required, and hopefully the aforementioned PR will provide some of that data if we see this test failure again. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/433094840","html_url":"https://github.com/elastic/elasticsearch/issues/32196#issuecomment-433094840","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196","id":433094840,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMzA5NDg0MA==","user":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"created_at":"2018-10-25T15:23:57Z","updated_at":"2018-10-25T15:23:57Z","author_association":"CONTRIBUTOR","body":"@benwtrent I've assigned this to you (we're trying to cut down on unassigned test failure issues) but think this can probably be closed until it fails again.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/433121516","html_url":"https://github.com/elastic/elasticsearch/issues/32196#issuecomment-433121516","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196","id":433121516,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMzEyMTUxNg==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2018-10-25T16:37:57Z","updated_at":"2018-10-25T16:37:57Z","author_association":"MEMBER","body":"@DaveCTurner Cool! I will Just close it then :D","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/433344400","html_url":"https://github.com/elastic/elasticsearch/issues/32196#issuecomment-433344400","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32196","id":433344400,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMzM0NDQwMA==","user":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"created_at":"2018-10-26T09:19:26Z","updated_at":"2018-10-26T09:19:26Z","author_association":"MEMBER","body":"I suspect the close job request in the teardown section timed out due to a slow machine/GC pause then there was a race between the job closing and the test framework interrupting the active threads. It hasn't happened since and if it does occur again we can consider increasing the timeout","performed_via_github_app":null}]