[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/520503402","html_url":"https://github.com/elastic/elasticsearch/issues/45460#issuecomment-520503402","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45460","id":520503402,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMDUwMzQwMg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-12T16:46:50Z","updated_at":"2019-08-12T16:46:50Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/520656811","html_url":"https://github.com/elastic/elasticsearch/issues/45460#issuecomment-520656811","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45460","id":520656811,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMDY1NjgxMQ==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-08-13T01:48:15Z","updated_at":"2019-08-13T01:48:15Z","author_association":"MEMBER","body":"> some times we are deleting more documents than we fetch in the _query call\r\n\r\n@apoloa You can avoid the problem by using [optimistic concurrency control](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-delete.html#optimistic-concurrency-control-delete) when deleting documents. Please let me know if it works for you.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/522942808","html_url":"https://github.com/elastic/elasticsearch/issues/45460#issuecomment-522942808","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45460","id":522942808,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMjk0MjgwOA==","user":{"login":"apoloa","id":8296904,"node_id":"MDQ6VXNlcjgyOTY5MDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/8296904?v=4","gravatar_id":"","url":"https://api.github.com/users/apoloa","html_url":"https://github.com/apoloa","followers_url":"https://api.github.com/users/apoloa/followers","following_url":"https://api.github.com/users/apoloa/following{/other_user}","gists_url":"https://api.github.com/users/apoloa/gists{/gist_id}","starred_url":"https://api.github.com/users/apoloa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apoloa/subscriptions","organizations_url":"https://api.github.com/users/apoloa/orgs","repos_url":"https://api.github.com/users/apoloa/repos","events_url":"https://api.github.com/users/apoloa/events{/privacy}","received_events_url":"https://api.github.com/users/apoloa/received_events","type":"User","site_admin":false},"created_at":"2019-08-20T09:54:50Z","updated_at":"2019-08-20T09:54:50Z","author_association":"NONE","body":"@dnhatn But will be great to only do one request to Elastic instead of using two. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/523055814","html_url":"https://github.com/elastic/elasticsearch/issues/45460#issuecomment-523055814","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45460","id":523055814,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMzA1NTgxNA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-08-20T15:01:30Z","updated_at":"2019-08-20T15:01:30Z","author_association":"MEMBER","body":"@apoloa If the query matches a huge number of documents, then ES won't able to hold or return the result. In your case, you can use a [scroll](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-body.html#request-body-search-scroll) API to query the documents that you wanna delete, then use [optimistic concurrency control](https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-delete.html#optimistic-concurrency-control-delete) to delete exactly those documents.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/523960667","html_url":"https://github.com/elastic/elasticsearch/issues/45460#issuecomment-523960667","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45460","id":523960667,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMzk2MDY2Nw==","user":{"login":"apoloa","id":8296904,"node_id":"MDQ6VXNlcjgyOTY5MDQ=","avatar_url":"https://avatars0.githubusercontent.com/u/8296904?v=4","gravatar_id":"","url":"https://api.github.com/users/apoloa","html_url":"https://github.com/apoloa","followers_url":"https://api.github.com/users/apoloa/followers","following_url":"https://api.github.com/users/apoloa/following{/other_user}","gists_url":"https://api.github.com/users/apoloa/gists{/gist_id}","starred_url":"https://api.github.com/users/apoloa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apoloa/subscriptions","organizations_url":"https://api.github.com/users/apoloa/orgs","repos_url":"https://api.github.com/users/apoloa/repos","events_url":"https://api.github.com/users/apoloa/events{/privacy}","received_events_url":"https://api.github.com/users/apoloa/received_events","type":"User","site_admin":false},"created_at":"2019-08-22T15:41:37Z","updated_at":"2019-08-22T15:41:37Z","author_association":"NONE","body":"@dnhatn I don't think about the return the whole document, only the id, or provide a scroll API to get the elements deleted?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/524982370","html_url":"https://github.com/elastic/elasticsearch/issues/45460#issuecomment-524982370","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45460","id":524982370,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNDk4MjM3MA==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2019-08-26T18:49:58Z","updated_at":"2019-08-26T18:49:58Z","author_association":"MEMBER","body":"@apoloa We should not keep/return the list of Ids. It's still expensive if we are deleting a very large number of documents. We can't return the scroll from the delete-by-query as that scroll is consumed by the server already.\r\n\r\nI think my [answer](https://github.com/elastic/elasticsearch/issues/45460#issuecomment-523055814) above solves your problem. I am closing this issue, but feel free to continue the discussion on the [forums](https://discuss.elastic.co/).\r\n\r\nThanks very much for your interest in Elasticsearch.","performed_via_github_app":null}]