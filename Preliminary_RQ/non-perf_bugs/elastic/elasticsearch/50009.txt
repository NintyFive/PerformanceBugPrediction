{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50009/events","html_url":"https://github.com/elastic/elasticsearch/issues/50009","id":535557268,"node_id":"MDU6SXNzdWU1MzU1NTcyNjg=","number":50009,"title":"Range query rounding error when used with date_range fields","user":{"login":"deadbeef84","id":961178,"node_id":"MDQ6VXNlcjk2MTE3OA==","avatar_url":"https://avatars0.githubusercontent.com/u/961178?v=4","gravatar_id":"","url":"https://api.github.com/users/deadbeef84","html_url":"https://github.com/deadbeef84","followers_url":"https://api.github.com/users/deadbeef84/followers","following_url":"https://api.github.com/users/deadbeef84/following{/other_user}","gists_url":"https://api.github.com/users/deadbeef84/gists{/gist_id}","starred_url":"https://api.github.com/users/deadbeef84/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deadbeef84/subscriptions","organizations_url":"https://api.github.com/users/deadbeef84/orgs","repos_url":"https://api.github.com/users/deadbeef84/repos","events_url":"https://api.github.com/users/deadbeef84/events{/privacy}","received_events_url":"https://api.github.com/users/deadbeef84/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"}],"state":"closed","locked":false,"assignee":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"assignees":[{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2019-12-10T07:54:57Z","updated_at":"2020-01-31T13:15:15Z","closed_at":"2020-01-31T13:15:15Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): 6.8.5 and 7.5.0\r\n\r\n**Plugins installed**: default from docker image `docker.elastic.co/elasticsearch/elasticsearch:6.8.5` and `docker.elastic.co/elasticsearch/elasticsearch:7.5.0`\r\n\r\n**JVM version** (`java -version`):\r\nOpenJDK Runtime Environment AdoptOpenJDK (build 13.0.1+9)\r\nOpenJDK 64-Bit Server VM AdoptOpenJDK (build 13.0.1+9, mixed mode, sharing)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux dd0d4200f531 4.15.0-70-generic #79-Ubuntu SMP Tue Nov 12 10:36:11 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWhen using `date_range` type in combination with `range` query, range `lte` seems to round down. I would expect this to round up as it does with fields of date type.\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Create index with the following mapping:\r\n```\r\ncurl -X PUT \"localhost:9200/mytest?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"mappings\": {\r\n    \"properties\": {\r\n      \"foo\": {\r\n        \"type\": \"date\"\r\n      },\r\n      \"bar\": {\r\n        \"type\": \"date_range\"\r\n      }\r\n    }\r\n  }\r\n}\r\n'\r\n```\r\n\r\n 2. Index the following document:\r\n```\r\ncurl -X POST \"localhost:9200/mytest/_doc/?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"foo\": \"2019-12-09T12:00:00.000Z\",\r\n  \"bar\": {\r\n    \"gte\": \"2019-12-09T12:00:00.000Z\",\r\n    \"lte\": \"2019-12-09T13:00:00.000Z\"\r\n  }\r\n}\r\n'\r\n```\r\n\r\n 3. Search using range query:\r\n```\r\ncurl -X GET \"localhost:9200/mytest/_search?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"query\":{\r\n    \"range\":{\r\n      \"bar\": {\r\n        \"gte\":\"2019-12-09||/d\",\r\n        \"lte\":\"2019-12-09||/d\"\r\n      }\r\n    }\r\n  }\r\n}\r\n'\r\n```\r\n\r\nYields no hits. I would expect `gte` to round to start of day, and `lte` to round to end of day, but it appears `lte` rounds to start of day. It works as expected when changing range query to use `foo` field. It also works correctly if I change `lte` to `2019-12-10||/d` or `2019-12-09T23:59:59`.","closed_by":{"login":"cbuescher","id":10398885,"node_id":"MDQ6VXNlcjEwMzk4ODg1","avatar_url":"https://avatars0.githubusercontent.com/u/10398885?v=4","gravatar_id":"","url":"https://api.github.com/users/cbuescher","html_url":"https://github.com/cbuescher","followers_url":"https://api.github.com/users/cbuescher/followers","following_url":"https://api.github.com/users/cbuescher/following{/other_user}","gists_url":"https://api.github.com/users/cbuescher/gists{/gist_id}","starred_url":"https://api.github.com/users/cbuescher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cbuescher/subscriptions","organizations_url":"https://api.github.com/users/cbuescher/orgs","repos_url":"https://api.github.com/users/cbuescher/repos","events_url":"https://api.github.com/users/cbuescher/events{/privacy}","received_events_url":"https://api.github.com/users/cbuescher/received_events","type":"User","site_admin":false},"performed_via_github_app":null}