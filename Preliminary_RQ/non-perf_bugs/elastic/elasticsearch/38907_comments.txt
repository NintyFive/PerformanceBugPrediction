[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463717575","html_url":"https://github.com/elastic/elasticsearch/issues/38907#issuecomment-463717575","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38907","id":463717575,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzcxNzU3NQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-02-14T17:32:17Z","updated_at":"2019-02-14T17:33:29Z","author_association":"MEMBER","body":"> I want to increase the queue capacity for my ingest nodes\r\n\r\nDid you indeed set this only on your ingest nodes? The relevant place is the data nodes, where the bulk shard requests are actually executed on the bulk thread pool.\r\n\r\nAll appears to be well, otherwise:\r\n\r\n```\r\n12:32:46 [jason@totoro:~/src/elastic/elasticsearch] retention-lease-ccr+ 130 Â± echo \"thread_pool.write.queue_size: 500\" > /tmp/elasticsearch.yml; echo \"network.host: 0.0.0.0\" >> /tmp/elasticsearch.yml; docker run --rm -it -e discovery.type=single-node -p 9200:9200 -p 9300:9300 -v /tmp/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml docker.elastic.co/elasticsearch/elasticsearch:6.5.0\r\nOpenJDK 64-Bit Server VM warning: Option UseConcMarkSweepGC was deprecated in version 9.0 and will likely be removed in a future release.\r\n[2019-02-14T17:32:49,841][WARN ][o.e.c.l.LogConfigurator  ] [unknown] Some logging configurations have %marker but don't have %node_name. We will automatically add %node_name to the pattern to ease the migration for users who customize log4j2.properties but will stop this behavior in 7.0. You should manually replace `%node_name` with `[%node_name]%marker ` in these locations:\r\n  /usr/share/elasticsearch/config/log4j2.properties\r\n[2019-02-14T17:32:50,075][INFO ][o.e.e.NodeEnvironment    ] [WRXPJM6] using [1] data paths, mounts [[/ (overlay)]], net usable_space [23.1gb], net total_space [48.9gb], types [overlay]\r\n[2019-02-14T17:32:50,076][INFO ][o.e.e.NodeEnvironment    ] [WRXPJM6] heap size [989.8mb], compressed ordinary object pointers [true]\r\n[2019-02-14T17:32:50,077][INFO ][o.e.n.Node               ] [WRXPJM6] node name derived from node ID [WRXPJM68SBOmfLLRXzxleA]; set [node.name] to override\r\n[2019-02-14T17:32:50,078][INFO ][o.e.n.Node               ] [WRXPJM6] version[6.5.0], pid[1], build[default/tar/816e6f6/2018-11-09T18:58:36.352602Z], OS[Linux/4.20.6-200.fc29.x86_64/amd64], JVM[Oracle Corporation/OpenJDK 64-Bit Server VM/11.0.1/11.0.1+13]\r\n[2019-02-14T17:32:50,078][INFO ][o.e.n.Node               ] [WRXPJM6] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/tmp/elasticsearch.dNKooJub, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m, -Djava.locale.providers=COMPAT, -XX:UseAVX=2, -Des.cgroups.hierarchy.override=/, -Des.path.home=/usr/share/elasticsearch, -Des.path.conf=/usr/share/elasticsearch/config, -Des.distribution.flavor=default, -Des.distribution.type=tar]\r\n[2019-02-14T17:32:51,237][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [aggs-matrix-stats]\r\n[2019-02-14T17:32:51,237][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [analysis-common]\r\n[2019-02-14T17:32:51,237][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [ingest-common]\r\n[2019-02-14T17:32:51,237][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [lang-expression]\r\n[2019-02-14T17:32:51,237][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [lang-mustache]\r\n[2019-02-14T17:32:51,237][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [lang-painless]\r\n[2019-02-14T17:32:51,237][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [mapper-extras]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [parent-join]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [percolator]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [rank-eval]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [reindex]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [repository-url]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [transport-netty4]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [tribe]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-ccr]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-core]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-deprecation]\r\n[2019-02-14T17:32:51,238][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-graph]\r\n[2019-02-14T17:32:51,239][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-logstash]\r\n[2019-02-14T17:32:51,239][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-ml]\r\n[2019-02-14T17:32:51,239][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-monitoring]\r\n[2019-02-14T17:32:51,239][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-rollup]\r\n[2019-02-14T17:32:51,239][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-security]\r\n[2019-02-14T17:32:51,239][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-sql]\r\n[2019-02-14T17:32:51,239][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-upgrade]\r\n[2019-02-14T17:32:51,239][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded module [x-pack-watcher]\r\n[2019-02-14T17:32:51,240][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded plugin [ingest-geoip]\r\n[2019-02-14T17:32:51,240][INFO ][o.e.p.PluginsService     ] [WRXPJM6] loaded plugin [ingest-user-agent]\r\n[2019-02-14T17:32:53,615][INFO ][o.e.x.s.a.s.FileRolesStore] [WRXPJM6] parsed [0] roles from file [/usr/share/elasticsearch/config/roles.yml]\r\n[2019-02-14T17:32:53,965][INFO ][o.e.x.m.j.p.l.CppLogMessageHandler] [WRXPJM6] [controller/82] [Main.cc@109] controller (64 bit): Version 6.5.0 (Build 71882a589e5556) Copyright (c) 2018 Elasticsearch BV\r\n[2019-02-14T17:32:54,359][INFO ][o.e.d.DiscoveryModule    ] [WRXPJM6] using discovery type [single-node] and host providers [settings]\r\n[2019-02-14T17:32:54,859][INFO ][o.e.n.Node               ] [WRXPJM6] initialized\r\n[2019-02-14T17:32:54,859][INFO ][o.e.n.Node               ] [WRXPJM6] starting ...\r\n[2019-02-14T17:32:55,008][INFO ][o.e.t.TransportService   ] [WRXPJM6] publish_address {172.17.0.2:9300}, bound_addresses {0.0.0.0:9300}\r\n[2019-02-14T17:32:55,020][WARN ][o.e.b.BootstrapChecks    ] [WRXPJM6] max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\r\n[2019-02-14T17:32:55,059][INFO ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [WRXPJM6] publish_address {172.17.0.2:9200}, bound_addresses {0.0.0.0:9200}\r\n[2019-02-14T17:32:55,059][INFO ][o.e.n.Node               ] [WRXPJM6] started\r\n[2019-02-14T17:32:55,134][WARN ][o.e.x.s.a.s.m.NativeRoleMappingStore] [WRXPJM6] Failed to clear cache for realms [[]]\r\n[2019-02-14T17:32:55,181][INFO ][o.e.g.GatewayService     ] [WRXPJM6] recovered [0] indices into cluster_state\r\n[2019-02-14T17:32:55,322][INFO ][o.e.c.m.MetaDataIndexTemplateService] [WRXPJM6] adding template [.watch-history-9] for index patterns [.watcher-history-9*]\r\n[2019-02-14T17:32:55,352][INFO ][o.e.c.m.MetaDataIndexTemplateService] [WRXPJM6] adding template [.watches] for index patterns [.watches*]\r\n[2019-02-14T17:32:55,380][INFO ][o.e.c.m.MetaDataIndexTemplateService] [WRXPJM6] adding template [.triggered_watches] for index patterns [.triggered_watches*]\r\n[2019-02-14T17:32:55,417][INFO ][o.e.c.m.MetaDataIndexTemplateService] [WRXPJM6] adding template [.monitoring-logstash] for index patterns [.monitoring-logstash-6-*]\r\n[2019-02-14T17:32:55,457][INFO ][o.e.c.m.MetaDataIndexTemplateService] [WRXPJM6] adding template [.monitoring-es] for index patterns [.monitoring-es-6-*]\r\n[2019-02-14T17:32:55,489][INFO ][o.e.c.m.MetaDataIndexTemplateService] [WRXPJM6] adding template [.monitoring-alerts] for index patterns [.monitoring-alerts-6]\r\n[2019-02-14T17:32:55,528][INFO ][o.e.c.m.MetaDataIndexTemplateService] [WRXPJM6] adding template [.monitoring-beats] for index patterns [.monitoring-beats-6-*]\r\n[2019-02-14T17:32:55,560][INFO ][o.e.c.m.MetaDataIndexTemplateService] [WRXPJM6] adding template [.monitoring-kibana] for index patterns [.monitoring-kibana-6-*]\r\n[2019-02-14T17:32:55,659][INFO ][o.e.l.LicenseService     ] [WRXPJM6] license [bf57109e-991d-4127-b942-1b8e28fa2819] mode [basic] - valid\r\n```\r\n\r\nAnd then:\r\n\r\n```\r\n12:32:58 [jason:~] $ curl -XGET \"totoro.home.tedor.me:9200/_nodes/thread_pool?pretty=true&&filter_path=**.write\"\r\n{\r\n  \"nodes\" : {\r\n    \"WRXPJM68SBOmfLLRXzxleA\" : {\r\n      \"thread_pool\" : {\r\n        \"write\" : {\r\n          \"type\" : \"fixed\",\r\n          \"min\" : 20,\r\n          \"max\" : 20,\r\n          \"queue_size\" : 500\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463731054","html_url":"https://github.com/elastic/elasticsearch/issues/38907#issuecomment-463731054","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38907","id":463731054,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzczMTA1NA==","user":{"login":"tylfin","id":4380912,"node_id":"MDQ6VXNlcjQzODA5MTI=","avatar_url":"https://avatars0.githubusercontent.com/u/4380912?v=4","gravatar_id":"","url":"https://api.github.com/users/tylfin","html_url":"https://github.com/tylfin","followers_url":"https://api.github.com/users/tylfin/followers","following_url":"https://api.github.com/users/tylfin/following{/other_user}","gists_url":"https://api.github.com/users/tylfin/gists{/gist_id}","starred_url":"https://api.github.com/users/tylfin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tylfin/subscriptions","organizations_url":"https://api.github.com/users/tylfin/orgs","repos_url":"https://api.github.com/users/tylfin/repos","events_url":"https://api.github.com/users/tylfin/events{/privacy}","received_events_url":"https://api.github.com/users/tylfin/received_events","type":"User","site_admin":false},"created_at":"2019-02-14T18:10:24Z","updated_at":"2019-02-14T18:10:39Z","author_association":"NONE","body":"@jasontedor I assumed the error was propagating from the ingest nodes... I'll reboot the data nodes and see if the issue persists... ðŸ˜¶ ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463733004","html_url":"https://github.com/elastic/elasticsearch/issues/38907#issuecomment-463733004","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38907","id":463733004,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzczMzAwNA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-02-14T18:15:51Z","updated_at":"2019-02-14T18:16:06Z","author_association":"MEMBER","body":"No, you can see that in the exception message:\r\n\r\n```\r\nnested: RemoteTransportException[[es-logging-data-1][10.203.8.102:9300][indices:data/write/bulk[s][p]]]; nested: EsRejectedExecutionException[rejected execution of processing of [17279822][indices:data/write/bulk[s][p]]\r\n```\r\n\r\nIt's a remote transport exception happening on `es-logging-data-1`, and the cause is a full queue on that node.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463738318","html_url":"https://github.com/elastic/elasticsearch/issues/38907#issuecomment-463738318","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38907","id":463738318,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzczODMxOA==","user":{"login":"tylfin","id":4380912,"node_id":"MDQ6VXNlcjQzODA5MTI=","avatar_url":"https://avatars0.githubusercontent.com/u/4380912?v=4","gravatar_id":"","url":"https://api.github.com/users/tylfin","html_url":"https://github.com/tylfin","followers_url":"https://api.github.com/users/tylfin/followers","following_url":"https://api.github.com/users/tylfin/following{/other_user}","gists_url":"https://api.github.com/users/tylfin/gists{/gist_id}","starred_url":"https://api.github.com/users/tylfin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tylfin/subscriptions","organizations_url":"https://api.github.com/users/tylfin/orgs","repos_url":"https://api.github.com/users/tylfin/repos","events_url":"https://api.github.com/users/tylfin/events{/privacy}","received_events_url":"https://api.github.com/users/tylfin/received_events","type":"User","site_admin":false},"created_at":"2019-02-14T18:30:51Z","updated_at":"2019-02-14T18:30:51Z","author_association":"NONE","body":"@jasontedor ++ yeah thanks my bad","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/463739054","html_url":"https://github.com/elastic/elasticsearch/issues/38907#issuecomment-463739054","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38907","id":463739054,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2MzczOTA1NA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2019-02-14T18:32:45Z","updated_at":"2019-02-14T18:32:45Z","author_association":"MEMBER","body":"No worries!","performed_via_github_app":null}]