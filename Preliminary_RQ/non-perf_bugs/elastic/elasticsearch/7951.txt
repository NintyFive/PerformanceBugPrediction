{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7951","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7951/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7951/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7951/events","html_url":"https://github.com/elastic/elasticsearch/issues/7951","id":44583214,"node_id":"MDU6SXNzdWU0NDU4MzIxNA==","number":7951,"title":"Assertion failure when doing a significant terms aggregation.","user":{"login":"ovidiu","id":63847,"node_id":"MDQ6VXNlcjYzODQ3","avatar_url":"https://avatars2.githubusercontent.com/u/63847?v=4","gravatar_id":"","url":"https://api.github.com/users/ovidiu","html_url":"https://github.com/ovidiu","followers_url":"https://api.github.com/users/ovidiu/followers","following_url":"https://api.github.com/users/ovidiu/following{/other_user}","gists_url":"https://api.github.com/users/ovidiu/gists{/gist_id}","starred_url":"https://api.github.com/users/ovidiu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ovidiu/subscriptions","organizations_url":"https://api.github.com/users/ovidiu/orgs","repos_url":"https://api.github.com/users/ovidiu/repos","events_url":"https://api.github.com/users/ovidiu/events{/privacy}","received_events_url":"https://api.github.com/users/ovidiu/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":133685408,"node_id":"MDU6TGFiZWwxMzM2ODU0MDg=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.3.5","name":"v1.3.5","color":"dddddd","default":false,"description":null},{"id":132222001,"node_id":"MDU6TGFiZWwxMzIyMjIwMDE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.4.0","name":"v1.4.0","color":"dddddd","default":false,"description":null},{"id":127700367,"node_id":"MDU6TGFiZWwxMjc3MDAzNjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.5.0","name":"v1.5.0","color":"dddddd","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"assignees":[{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2014-10-01T16:13:53Z","updated_at":"2014-10-03T13:16:38Z","closed_at":"2014-10-03T12:47:46Z","author_association":"NONE","active_lock_reason":null,"body":"Hello.\n\nI'm running: Version: 1.3.0, Build: 1265b14/2014-07-23T13:46:36Z, JVM: 1.7.0_65\n\nI'm trying to do a simple significant terms aggregation and I get an exception:\n\nCommand:\n\n```\ncurl -s XGET 'localhost:9200/test_index/job/_search?pretty' -d '{\n    \"query\": {\n        \"filtered\": {\n            \"filter\": {\n                \"terms\": {\n                    \"profession\": [\n                        \"4980\"\n                    ]\n                }\n            }\n        }\n    },\n    \"size\": 0,\n    \"aggs\": {\n        \"term_cloud\": {\n            \"significant_terms\": {\n                \"field\": \"fulltext\"\n            }\n        }\n    }\n}'\n```\n\nResponse:\n\n```\n{\n  \"error\" : \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[w_0mi1Z-Tvm68G3dfr7rUg][test_index][2]: ElasticsearchIllegalArgumentException[supersetFreq > supersetSize, in JLHScore.score(..)]}{[w_0mi1Z-Tvm68G3dfr7rUg][test_index][3]: ElasticsearchIllegalArgumentException[supersetFreq > supersetSize, in JLHScore.score(..)]}{[w_0mi1Z-Tvm68G3dfr7rUg][test_index][4]: ElasticsearchIllegalArgumentException[supersetFreq > supersetSize, in JLHScore.score(..)]}{[w_0mi1Z-Tvm68G3dfr7rUg][test_index][0]: ElasticsearchIllegalArgumentException[supersetFreq > supersetSize, in JLHScore.score(..)]}{[w_0mi1Z-Tvm68G3dfr7rUg][test_index][1]: ElasticsearchIllegalArgumentException[supersetFreq > supersetSize, in JLHScore.score(..)]}]\",\n  \"status\" : 400\n}\n```\n\nConsole:\n\n```\n[2014-10-01 18:02:55,119][DEBUG][action.search.type       ] [Joystick] [test_index][2], node[w_0mi1Z-Tvm68G3dfr7rUg], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@4b58136a]\norg.elasticsearch.ElasticsearchIllegalArgumentException: supersetFreq > supersetSize, in JLHScore.score(..)\n        at org.elasticsearch.search.aggregations.bucket.significant.heuristics.JLHScore.getScore(JLHScore.java:79)\n        at org.elasticsearch.search.aggregations.bucket.significant.InternalSignificantTerms$Bucket.updateScore(InternalSignificantTerms.java:80)\n        at org.elasticsearch.search.aggregations.bucket.significant.GlobalOrdinalsSignificantTermsAggregator.buildAggregation(GlobalOrdinalsSignificantTermsAggregator.java:102)\n        at org.elasticsearch.search.aggregations.bucket.significant.GlobalOrdinalsSignificantTermsAggregator.buildAggregation(GlobalOrdinalsSignificantTermsAggregator.java:41)\n        at org.elasticsearch.search.aggregations.AggregationPhase.execute(AggregationPhase.java:133)\n        at org.elasticsearch.search.query.QueryPhase.execute(QueryPhase.java:171)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:261)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:206)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:203)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:517)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\n```\n\nThe mapping for the two fields involved:\n\n```\n\"profession\" : {\"type\" : \"integer\"},\n\"fulltext\" : {\"type\" : \"string\"},\n```\n","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}