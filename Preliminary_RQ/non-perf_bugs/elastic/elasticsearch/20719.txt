{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20719","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20719/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20719/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20719/events","html_url":"https://github.com/elastic/elasticsearch/issues/20719","id":180633177,"node_id":"MDU6SXNzdWUxODA2MzMxNzc=","number":20719,"title":"Source Filtering does not Expose Field Names with Dots","user":{"login":"jbaiera","id":875779,"node_id":"MDQ6VXNlcjg3NTc3OQ==","avatar_url":"https://avatars1.githubusercontent.com/u/875779?v=4","gravatar_id":"","url":"https://api.github.com/users/jbaiera","html_url":"https://github.com/jbaiera","followers_url":"https://api.github.com/users/jbaiera/followers","following_url":"https://api.github.com/users/jbaiera/following{/other_user}","gists_url":"https://api.github.com/users/jbaiera/gists{/gist_id}","starred_url":"https://api.github.com/users/jbaiera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbaiera/subscriptions","organizations_url":"https://api.github.com/users/jbaiera/orgs","repos_url":"https://api.github.com/users/jbaiera/repos","events_url":"https://api.github.com/users/jbaiera/events{/privacy}","received_events_url":"https://api.github.com/users/jbaiera/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"assignees":[{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2016-10-03T12:54:44Z","updated_at":"2016-10-10T07:32:27Z","closed_at":"2016-10-10T07:32:27Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!--\nGitHub is reserved for bug reports and feature requests. The best place\nto ask a general question is at the Elastic Discourse forums at\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\na feature request, please include one and only one of the below blocks\nin your new issue. Note that whether you're filing a bug report or a\nfeature request, ensure that your submission is for an\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\nBug reports on an OS that we do not support or feature requests\nspecific to an OS that we do not support will be closed.\n-->\n\n<!--\nIf you are filing a bug report, please remove the below feature\nrequest block and provide responses for all of the below items.\n-->\n\n**Elasticsearch version**: 5.0.0-beta1\n\n**Plugins installed**: []\n\n**JVM version**: 1.8.0_91\n\n**Description of the problem including expected versus actual behavior**:\nIn certain cases of using source filtering on field names that contain dots, results that are inconsistent can be returned. My understanding of the source filtering is that it is strictly a filter that is applied over the source document as is.\n\n**Steps to reproduce**:\n1. Insert a document with a dotted field name and a field that is a regular object:\n   - `curl -XPUT localhost:9200/dots/test/1 -d '{\"a.b\":0,\"c\":1,\"d\":{\"e\":2}}'`\n2. Execute a match all query and request each field explicitly from the source filter:\n   - `curl -XPOST 'localhost:9200/dots/test/_search?_source=a,c,d'`\n3. Notice that the response does not include the \"a.b\" field:\n   - `\"hits\" : [\n     {\n       \"_index\" : \"dots\",\n       \"_type\" : \"test\",\n       \"_id\" : \"1\",\n       \"_score\" : 1.0,\n       \"_source\" : {\n         \"c\" : 1,\n         \"d\" : {\n           \"e\" : 2\n         }\n       }\n     }\n     ]`\n4. Execute a match all query and request the `a` field using a wild card:\n   - `curl -XPOST 'localhost:9200/dots/test/_search?_source=a.*,c,d'`\n5. Notice that the response includes the \"a.b\" field now:\n   1. `\"hits\" : [\n      {\n        \"_index\" : \"dots\",\n        \"_type\" : \"test\",\n        \"_id\" : \"1\",\n        \"_score\" : 1.0,\n        \"_source\" : {\n          \"c\" : 1,\n          \"a.b\" : 0,\n          \"d\" : {\n            \"e\" : 2\n          }\n        }\n      }\n      ]`\n\nWorth Mentioning:\n1. If you insert another document into the index that contains `a.b` as a json object, the fields from that document come back in source filtered queries:\n   1. `curl -XPUT localhost:9200/dots/test/2 -d '{\"a\":{\"b\":5}}'`\n2. `curl -XPOST 'localhost:9200/dots/test/_search?_source=a,c,d&pretty'`\n   1. `\"hits\" : [\n      {\n        \"_index\" : \"dots\",\n        \"_type\" : \"test\",\n        \"_id\" : \"1\",\n        \"_score\" : 1.0,\n        \"_source\" : {\n          \"c\" : 1,\n          \"d\" : {\n            \"e\" : 2\n          }\n        }\n      },\n      {\n        \"_index\" : \"dots\",\n        \"_type\" : \"test\",\n        \"_id\" : \"2\",\n        \"_score\" : 1.0,\n        \"_source\" : {\n          \"a\" : {\n            \"b\" : 5\n          }\n        }\n      }\n      ]`\n\n**Describe the feature**:\nMy understanding is that the source filter works only on the raw source field. In the above case the field `a` does not exist in the original document, only the field `a.b`. Since `\"a.b\" != \"a\"` the field is ignored. The discussion that I want to whip up about this is whether or not the source filter logic should be consistent with the rest of Elasticsearch in how it handles parsing of dotted field names before checking if they match a source filter.\n\nEdit: Removed a bogus reproduction step.\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}