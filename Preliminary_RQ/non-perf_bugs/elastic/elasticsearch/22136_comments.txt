[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/266712971","html_url":"https://github.com/elastic/elasticsearch/issues/22136#issuecomment-266712971","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22136","id":266712971,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NjcxMjk3MQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2016-12-13T11:18:22Z","updated_at":"2016-12-13T11:18:22Z","author_association":"MEMBER","body":"You can check here why we decided to remove the `size:0` option:\r\nhttps://github.com/elastic/elasticsearch/issues/18838\r\n\r\n> Having size: 0 as an option makes it look like there is a short cut here and we can do the give me all the buckets case in a different very efficient way, which we can't. Internally we rewrite size:0 to Integer.MAX_VALUE\r\n\r\nSo you can just specify a size that is bigger than the cardinality of your field. If the cardinality is big you should consider other options since returning millions of terms is going to cause problem in your cluster.\r\n\r\nAlso we reserve github for bugs and feature requests so the best way to get an answer for questions like this is to use the discuss forum:\r\nhttps://discuss.elastic.co/c/elasticsearch","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/359741147","html_url":"https://github.com/elastic/elasticsearch/issues/22136#issuecomment-359741147","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22136","id":359741147,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTc0MTE0Nw==","user":{"login":"Jiangew","id":5180293,"node_id":"MDQ6VXNlcjUxODAyOTM=","avatar_url":"https://avatars2.githubusercontent.com/u/5180293?v=4","gravatar_id":"","url":"https://api.github.com/users/Jiangew","html_url":"https://github.com/Jiangew","followers_url":"https://api.github.com/users/Jiangew/followers","following_url":"https://api.github.com/users/Jiangew/following{/other_user}","gists_url":"https://api.github.com/users/Jiangew/gists{/gist_id}","starred_url":"https://api.github.com/users/Jiangew/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jiangew/subscriptions","organizations_url":"https://api.github.com/users/Jiangew/orgs","repos_url":"https://api.github.com/users/Jiangew/repos","events_url":"https://api.github.com/users/Jiangew/events{/privacy}","received_events_url":"https://api.github.com/users/Jiangew/received_events","type":"User","site_admin":false},"created_at":"2018-01-23T10:05:32Z","updated_at":"2018-01-23T10:05:32Z","author_association":"NONE","body":"Using size parameter for Query and Terms Aggregations on 5.6.x\r\n```json\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"filter\": [\r\n        {\r\n          \"terms\": {\r\n            \"mid\": [\r\n              185422,\r\n              13446728\r\n            ]\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  \"aggs\": {\r\n    \"group_mids\": {\r\n      \"terms\": {\r\n        \"field\": \"mid\",\r\n        \"size\": 5,\r\n        \"shard_size\": 10, \r\n        \"order\": {\r\n          \"max_hot\": \"desc\"\r\n        }\r\n      },\r\n      \"aggs\": {\r\n        \"max_hot\": {\r\n          \"max\": {\r\n            \"field\": \"hotvalue\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"_source\": {\r\n    \"includes\": [\r\n      \"mid\",\r\n      \"cid\",\r\n      \"hotvalue\"\r\n    ]\r\n  },\r\n  \"sort\": [\r\n    {\r\n      \"lastreptime\": \"desc\"\r\n    }\r\n  ],\r\n  \"from\": 0,\r\n  \"size\": 10\r\n}\r\n```\r\nBut every buckets do not match the size = 5, Why ï¼Ÿ","performed_via_github_app":null}]