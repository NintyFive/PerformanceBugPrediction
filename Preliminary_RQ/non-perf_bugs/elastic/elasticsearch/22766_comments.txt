[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/276342258","html_url":"https://github.com/elastic/elasticsearch/issues/22766#issuecomment-276342258","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22766","id":276342258,"node_id":"MDEyOklzc3VlQ29tbWVudDI3NjM0MjI1OA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2017-01-31T11:41:36Z","updated_at":"2017-01-31T11:41:36Z","author_association":"MEMBER","body":"@jomarl Thanks for reporting. I looked at what you describe and I'm surprised it even worked in previous versions of elasticsearch. \r\n\r\nSearch templates are designed to be self sufficient, ie you only provide some parameters and the whole query can be built out of them; but they are not designed to be kind of completed or altered using the Java API. In 5.x, many things were improved in search template to ensure that (before 5.x, search templates, script and template query code were really intricate and mixed, they are now better separated).\r\n\r\nYou could maybe use a combination of search template + template queries to replicate what you did in 1.6. I spent some time trying to find a good solution but I failed. Maybe you'll be luckier than me :) Maybe you could also use a search template that defines the common aggregations, and build the query string on application side and pass it as a parameter. In any case, template queries are deprecated in 5.x and will be removed in next versions so the solution must not be based on it.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356622909","html_url":"https://github.com/elastic/elasticsearch/issues/22766#issuecomment-356622909","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22766","id":356622909,"node_id":"MDEyOklzc3VlQ29tbWVudDM1NjYyMjkwOQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-01-10T14:45:08Z","updated_at":"2018-01-10T14:45:08Z","author_association":"MEMBER","body":"No feedback, closing.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356879115","html_url":"https://github.com/elastic/elasticsearch/issues/22766#issuecomment-356879115","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22766","id":356879115,"node_id":"MDEyOklzc3VlQ29tbWVudDM1Njg3OTExNQ==","user":{"login":"jomarl","id":2825496,"node_id":"MDQ6VXNlcjI4MjU0OTY=","avatar_url":"https://avatars3.githubusercontent.com/u/2825496?v=4","gravatar_id":"","url":"https://api.github.com/users/jomarl","html_url":"https://github.com/jomarl","followers_url":"https://api.github.com/users/jomarl/followers","following_url":"https://api.github.com/users/jomarl/following{/other_user}","gists_url":"https://api.github.com/users/jomarl/gists{/gist_id}","starred_url":"https://api.github.com/users/jomarl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jomarl/subscriptions","organizations_url":"https://api.github.com/users/jomarl/orgs","repos_url":"https://api.github.com/users/jomarl/repos","events_url":"https://api.github.com/users/jomarl/events{/privacy}","received_events_url":"https://api.github.com/users/jomarl/received_events","type":"User","site_admin":false},"created_at":"2018-01-11T09:38:17Z","updated_at":"2018-01-11T09:38:17Z","author_association":"NONE","body":"Hi, and a delayed thanks for the help.\r\n\r\nWe moved away from using mustache templates to building our search queries using the java api. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/361859489","html_url":"https://github.com/elastic/elasticsearch/issues/22766#issuecomment-361859489","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22766","id":361859489,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTg1OTQ4OQ==","user":{"login":"AkopovaAnna","id":20566789,"node_id":"MDQ6VXNlcjIwNTY2Nzg5","avatar_url":"https://avatars0.githubusercontent.com/u/20566789?v=4","gravatar_id":"","url":"https://api.github.com/users/AkopovaAnna","html_url":"https://github.com/AkopovaAnna","followers_url":"https://api.github.com/users/AkopovaAnna/followers","following_url":"https://api.github.com/users/AkopovaAnna/following{/other_user}","gists_url":"https://api.github.com/users/AkopovaAnna/gists{/gist_id}","starred_url":"https://api.github.com/users/AkopovaAnna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AkopovaAnna/subscriptions","organizations_url":"https://api.github.com/users/AkopovaAnna/orgs","repos_url":"https://api.github.com/users/AkopovaAnna/repos","events_url":"https://api.github.com/users/AkopovaAnna/events{/privacy}","received_events_url":"https://api.github.com/users/AkopovaAnna/received_events","type":"User","site_admin":false},"created_at":"2018-01-31T08:30:09Z","updated_at":"2018-01-31T08:30:09Z","author_association":"NONE","body":"Hi @jomarl ;\r\nI have also used mustache, and encountered with problems and exceptions, such as org.elasticsearch.script.mustache.SearchTemplateRequest cannot be cast to org.elasticsearch.script.mustache.SearchTemplateRequest\". This is actual also in the simple examples used in elasticsearch template query search example.\r\nAs a result the search template query could not be build and execute. Could you help and suggest what kind of solutions you use?","performed_via_github_app":null}]