[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/565146529","html_url":"https://github.com/elastic/elasticsearch/issues/50152#issuecomment-565146529","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50152","id":565146529,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NTE0NjUyOQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-12-12T19:20:22Z","updated_at":"2019-12-12T19:20:22Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Scripting)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/567580413","html_url":"https://github.com/elastic/elasticsearch/issues/50152#issuecomment-567580413","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50152","id":567580413,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NzU4MDQxMw==","user":{"login":"stu-elastic","id":24232742,"node_id":"MDQ6VXNlcjI0MjMyNzQy","avatar_url":"https://avatars0.githubusercontent.com/u/24232742?v=4","gravatar_id":"","url":"https://api.github.com/users/stu-elastic","html_url":"https://github.com/stu-elastic","followers_url":"https://api.github.com/users/stu-elastic/followers","following_url":"https://api.github.com/users/stu-elastic/following{/other_user}","gists_url":"https://api.github.com/users/stu-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/stu-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stu-elastic/subscriptions","organizations_url":"https://api.github.com/users/stu-elastic/orgs","repos_url":"https://api.github.com/users/stu-elastic/repos","events_url":"https://api.github.com/users/stu-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/stu-elastic/received_events","type":"User","site_admin":false},"created_at":"2019-12-19T17:15:15Z","updated_at":"2019-12-19T18:55:33Z","author_association":"CONTRIBUTOR","body":"In `ScriptService`\r\n`SCRIPT_CACHE_SIZE_SETTING` and `SCRIPT_MAX_COMPILATIONS_RATE`, `SCRIPT_CACHE_EXPIRE_SETTING` needs to be per context as well as `Cache<CacheKey, Object> cache;` along with `scriptMetrics`, which is where they are being tracked.\r\n\r\n`SCRIPT_MAX_COMPILATIONS_RATE` needs to be able to be unlimited.\r\n\r\nIn `compile` we can sychronize on the context rather than `this`.  Can add arbitrary private object used for locking.\r\n\r\nIdea: encapsulate these into a `ContextCompiler`, move all compile logic into here.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/587927041","html_url":"https://github.com/elastic/elasticsearch/issues/50152#issuecomment-587927041","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50152","id":587927041,"node_id":"MDEyOklzc3VlQ29tbWVudDU4NzkyNzA0MQ==","user":{"login":"stu-elastic","id":24232742,"node_id":"MDQ6VXNlcjI0MjMyNzQy","avatar_url":"https://avatars0.githubusercontent.com/u/24232742?v=4","gravatar_id":"","url":"https://api.github.com/users/stu-elastic","html_url":"https://github.com/stu-elastic","followers_url":"https://api.github.com/users/stu-elastic/followers","following_url":"https://api.github.com/users/stu-elastic/following{/other_user}","gists_url":"https://api.github.com/users/stu-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/stu-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stu-elastic/subscriptions","organizations_url":"https://api.github.com/users/stu-elastic/orgs","repos_url":"https://api.github.com/users/stu-elastic/repos","events_url":"https://api.github.com/users/stu-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/stu-elastic/received_events","type":"User","site_admin":false},"created_at":"2020-02-18T22:06:29Z","updated_at":"2020-03-10T16:17:41Z","author_association":"CONTRIBUTOR","body":"Code staging:\r\n1) General context cache\r\n2) Add settings for context caches.  Make them dynamically updatable.  Default to general compiler. Ability to transition to context caches without restart.\r\n3) Add defaults for each context\r\n4) Add unlimited compile rate settings\r\n5) Default to per context settings and deprecate old general settings\r\n6) Update stats API\r\n\r\nBehavior:\r\nIf general settings, use general compiler and deprecate log\r\nIf no general settings use context specific\r\nIf general settings and context specific, error\r\n -> cluster update settings for context specific and general then context specific rejected","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/591671162","html_url":"https://github.com/elastic/elasticsearch/issues/50152#issuecomment-591671162","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50152","id":591671162,"node_id":"MDEyOklzc3VlQ29tbWVudDU5MTY3MTE2Mg==","user":{"login":"stu-elastic","id":24232742,"node_id":"MDQ6VXNlcjI0MjMyNzQy","avatar_url":"https://avatars0.githubusercontent.com/u/24232742?v=4","gravatar_id":"","url":"https://api.github.com/users/stu-elastic","html_url":"https://github.com/stu-elastic","followers_url":"https://api.github.com/users/stu-elastic/followers","following_url":"https://api.github.com/users/stu-elastic/following{/other_user}","gists_url":"https://api.github.com/users/stu-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/stu-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stu-elastic/subscriptions","organizations_url":"https://api.github.com/users/stu-elastic/orgs","repos_url":"https://api.github.com/users/stu-elastic/repos","events_url":"https://api.github.com/users/stu-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/stu-elastic/received_events","type":"User","site_admin":false},"created_at":"2020-02-26T22:12:47Z","updated_at":"2020-02-26T22:12:47Z","author_association":"CONTRIBUTOR","body":"Should we disable caching all together if a user sets an unlimited compilation rate?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/651240646","html_url":"https://github.com/elastic/elasticsearch/issues/50152#issuecomment-651240646","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50152","id":651240646,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTI0MDY0Ng==","user":{"login":"stu-elastic","id":24232742,"node_id":"MDQ6VXNlcjI0MjMyNzQy","avatar_url":"https://avatars0.githubusercontent.com/u/24232742?v=4","gravatar_id":"","url":"https://api.github.com/users/stu-elastic","html_url":"https://github.com/stu-elastic","followers_url":"https://api.github.com/users/stu-elastic/followers","following_url":"https://api.github.com/users/stu-elastic/following{/other_user}","gists_url":"https://api.github.com/users/stu-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/stu-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stu-elastic/subscriptions","organizations_url":"https://api.github.com/users/stu-elastic/orgs","repos_url":"https://api.github.com/users/stu-elastic/repos","events_url":"https://api.github.com/users/stu-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/stu-elastic/received_events","type":"User","site_admin":false},"created_at":"2020-06-29T16:53:48Z","updated_at":"2020-06-29T16:55:17Z","author_association":"CONTRIBUTOR","body":"Having `script` and `script_cache` in `_node/stats` is redundant.  Here's the value of `_node/stats` in 7.x:\r\n```json\r\n      \"script\" : {\r\n        \"compilations\" : 172,\r\n        \"cache_evictions\" : 72,\r\n        \"compilation_limit_triggered\" : 0\r\n      },\r\n```\r\n\r\nHere's it in 8.x right now:\r\n```json  \r\n      \"script_cache\": {                                                      \r\n        \"sum\": {                      \r\n          \"compilations\": 1,                                                 \r\n          \"cache_evictions\": 0,                                              \r\n          \"compilation_limit_triggered\": 0                                   \r\n        },                            \r\n        \"contexts\": [                                                        \r\n          {                           \r\n            \"context\": \"aggregation_selector\",                               \r\n            \"compilations\": 0,                                               \r\n            \"cache_evictions\": 0,                                            \r\n            \"compilation_limit_triggered\": 0                                 \r\n          },                                  \r\n```\r\n\r\nWe will remove `script_cache` in 8 and hoist `sum` to the top level.  Here's what we'll have:\r\n```json  \r\n      \"script\": {                          \r\n        \"compilations\": 1,\r\n        \"cache_evictions\": 0,\r\n        \"compilation_limit_triggered\": 0,\r\n        \"contexts\":[\r\n          {\r\n            \"context\": \"aggregation_selector\",                               \r\n            \"compilations\": 0,                                               \r\n            \"cache_evictions\": 0,                                            \r\n            \"compilation_limit_triggered\": 0                                 \r\n          },                                  \r\n```\r\n \r\nThis keeps the format the same between 7 and 8 so we can easily drop `script_cache`.  Also the `sum` is unnecessary indirection.","performed_via_github_app":null}]