[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414698833","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-414698833","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":414698833,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDY5ODgzMw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-08-21T14:41:48Z","updated_at":"2018-08-21T14:41:48Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/415355520","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-415355520","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":415355520,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNTM1NTUyMA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-08-23T09:39:16Z","updated_at":"2018-08-23T09:39:16Z","author_association":"MEMBER","body":"Another question that popped up is whether we should return \"precise\" lower bounds or just indicate the lower lower bound. If `track_total_hits` is set to 100 for instance, returning `123+` doesn't bring much more than returning `100+`. The lower bound computed on each shard is not an approximation so any result above 100 can be misleading, a simple `term` query that can skip a lot of documents may return  a small lower bound even if this term is present in all documents.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/415386626","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-415386626","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":415386626,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNTM4NjYyNg==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2018-08-23T11:47:54Z","updated_at":"2018-08-23T11:47:54Z","author_association":"CONTRIBUTOR","body":"I don't like changing the meaning of `total` or make it a string. We already return `\"total\" : -1` if `track_total_hits` is false. We can add an additional parameter `at_least` to inform the user how many hits we can have at least. We can also add this easily to 6.x. From my perspective this would only guarantee best effort. On the request end I am in favor of option 1.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/415401569","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-415401569","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":415401569,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNTQwMTU2OQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2018-08-23T12:46:58Z","updated_at":"2018-08-23T12:46:58Z","author_association":"MEMBER","body":"I'm also not a fan of the options where the meaning of `total` is context-dependent.  I'd rather have a new field.  In both cases you need to conditionally check two things, but at least this way incorrect assumptions are quickly noticed (`total: -1`) and it doesn't change the meaning of `total`.\r\n\r\nIt's also a bit more graceful upgrade path.  UIs might be showing a bad value (`-1`) but it doesn't break code outright and users can implement the check for `at_least`/`min`/whatever when they get a chance.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/415425834","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-415425834","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":415425834,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNTQyNTgzNA==","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2018-08-23T14:05:11Z","updated_at":"2018-08-23T14:06:02Z","author_association":"MEMBER","body":"Also prefer an additional property, `total` can already be skewed in the case of partial results (if `allow_partial_search_results` is not true (default false)) which throws people. A new property on the response is more explicit.\r\n\r\nOn the request side can we create a new property e.g `track_total_hits_upto=NUMBER` or `total_accuracy=NUMBER` and deprecate`track_total_hits=BOOL` instead of reusing `track_total_hits` ? \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/424392404","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-424392404","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":424392404,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNDM5MjQwNA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-09-25T15:34:23Z","updated_at":"2018-09-25T15:34:23Z","author_association":"CONTRIBUTOR","body":"We had a long discussion about this issue, here are some arguments that have been made:\r\n - we already have a big breaking change coming: the removal of types, maybe we should try to not introduce another major breaking change at the same time\r\n - it's too late for breaking changes in 7.0, anything that would require clients to change behavior by default would have to wait for 8.0 anyway\r\n - we want to enable this optimization by default eventually, because users should opt in to get more info at the expense of more CPU usage\r\n - option 3 is similar to 4 but is easier to parse and feels better\r\n - in general option 1 didn't get much support\r\n - option 2 raised concerns around the fact that one needs to check the value of another field (out of many) to know how to interpret the value of `hits.total`\r\n - option 0 and 2 have the benefit of not being breaking for apps that don't check hit counts\r\n - often apps check the hit count to know whether they need to display something, so we need to be careful with not breaking apps that work like that\r\n\r\nEven though we couldn't make a decision, we narrowed down to two main paths:\r\n\r\n**A. Keep same format**\r\n - In 7.0 we make `track_total_hits` accept numbers in addition to boolean, which acts as a threshold for the number of hits to count. If `hits.total` is greater than or equal to this number then its value is a lower bound of the actual hit count. `hits.total` is still `-1` if `track_total_hits` is set to `false` like in 6.x.\r\n - In 7.0 we issue deprecation warnings when not setting `track_total_hits`\r\n - In 8.0 we change the default of `track_total_hits` to `false`.\r\n\r\nOne modified version of this plan that has been discussed is to not return `hits.total` at all when `track_total_hits` is set to `false` in 8.0, to be consistent with eg. `aggs` which don't have any value when not requested, and not confuse users starting with Elasticsearch that something may be broken if `hits.total` is not a number.\r\n\r\nThis path has the downside of making the transition easier but the response is less explicit: you need to know the threshold that was set in the request in order to know how to interpret `hits.total` in the response.\r\n\r\n**B. Make `hits.total` an object**\r\n - In 7.0 we make `track_total_hits` accept numbers in addition to boolean, which acts as a threshold for the number of hits to count. If set to a number then `hits.total` is an object (it remains an integer by default for bw compat) that looks like `{ \"hits\": { \"total\": { \"value\": 1234, \"relation\": \"gte\" } } }`\r\n - In version 7.0 we issue deprecation warnings when `track_total_hits` is not set to a number to force users to opt in for the new response format.\r\n - In version 8.0 we can change the default value to potentially 1000 like Lucene or 0 to disable the tracking of hit counts entirely\r\n\r\nThis path requires more changes on client side and makes it harder to perform generic processing of search responses due to the fact that the format of `hits.total` will depend on the request in 7.x. Yet it makes responses more self-contained.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431929703","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-431929703","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":431929703,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTkyOTcwMw==","user":{"login":"stacey-gammon","id":16563603,"node_id":"MDQ6VXNlcjE2NTYzNjAz","avatar_url":"https://avatars3.githubusercontent.com/u/16563603?v=4","gravatar_id":"","url":"https://api.github.com/users/stacey-gammon","html_url":"https://github.com/stacey-gammon","followers_url":"https://api.github.com/users/stacey-gammon/followers","following_url":"https://api.github.com/users/stacey-gammon/following{/other_user}","gists_url":"https://api.github.com/users/stacey-gammon/gists{/gist_id}","starred_url":"https://api.github.com/users/stacey-gammon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stacey-gammon/subscriptions","organizations_url":"https://api.github.com/users/stacey-gammon/orgs","repos_url":"https://api.github.com/users/stacey-gammon/repos","events_url":"https://api.github.com/users/stacey-gammon/events{/privacy}","received_events_url":"https://api.github.com/users/stacey-gammon/received_events","type":"User","site_admin":false},"created_at":"2018-10-22T18:38:11Z","updated_at":"2018-10-22T18:38:11Z","author_association":"NONE","body":"Just want to confirm my understanding of the latest plan:\r\n\r\nKibana will not have to do anything for 7.0 and everything will continue to work the same except we may see deprecation warnings.\r\n\r\nIf that changes (e.g. the decision to switch the default in 7.0 changes), or is incorrect, please let me know!\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431935295","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-431935295","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":431935295,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTkzNTI5NQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-10-22T18:52:10Z","updated_at":"2018-10-22T18:52:10Z","author_association":"MEMBER","body":"Sorry I thought that I commented in this issue but for some reasons my comment is not there anymore.\r\nSo the current status after the internal discussion we had is that we'll disable `track_total_hits` by default in `7.0` and make `hits.total` and object with `total` (an integer that contains the number of hits) and `relation`, a string that defines how the `total` should be interpreted. When `track_total_hits` is false (default behavior) the `total` is filled with `-1`. We also discussed a way to get a response with the old format and decided that the client could send the major version in the request (as an header for instance), `7` would mean new response format and would default to `\"track_total_hits\":false` whereas `6` would behave like a 6x cluster (`track_total_hits:true` and `hits.total` returned as a simple integer). For Kibana this means that you'll have to explicitly set `track_total_hits` to true or use this new client versioning. The former can be tested now since the `track_total_hits` option is already available in `6x`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436209928","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-436209928","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":436209928,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjIwOTkyOA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-11-06T10:45:28Z","updated_at":"2018-11-06T10:45:28Z","author_association":"MEMBER","body":"I opened #35291 to discuss another alternative that doesn't require to change the `hits.total`. The pr adds the ability to set `track_total_hits` as a number that indicates the number of hits to count accurately. The `hits.total` in the search response is set to `-1` in this case and a new section called `tracked_total` indicates the number of tracked hits and whether the number is a lower bound or accurate:\r\n```\r\n{\r\n  \"_shards\": ...\r\n   \"hits\" : {\r\n      \"total\" : -1,\r\n      \"tracked_total\": {\r\n        \"value\": 100,\r\n        \"relation\": \"gte\"\r\n      },\r\n      \"max_score\" : 0.42,\r\n      \"hits\" : []\r\n  }\r\n}\r\n```\r\nI prefer this option because it doesn't require a breaking change in the search response format so users that want exact count (or no count at all) are not impacted and we don't need to handle backward compatibility.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436272029","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-436272029","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":436272029,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjI3MjAyOQ==","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2018-11-06T14:31:05Z","updated_at":"2018-11-06T14:31:05Z","author_association":"MEMBER","body":"If the current thinking is to disable `track_total_hits` by default in 7.0, returning `-1` might be just as breaking for applications as returning `total` as an object.\r\n\r\nRaising this only to make sure we don't phrasing this as backwards compatible. I can get behind both options (an additional field or total as an object) as long as we feel its the cleanest option. \r\n\r\nI personally much prefer the object approach since we can just have one location for the count and an additional field to indicate how to interpret this value. \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436308517","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-436308517","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":436308517,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjMwODUxNw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-11-06T16:07:52Z","updated_at":"2018-11-06T16:07:52Z","author_association":"MEMBER","body":"> Raising this only to make sure we don't phrasing this as backwards compatible.\r\n\r\nI was just talking about the format of the response no matter if you disable hit counts or not. But I agree that disabling total hit count by default is a breaking change ;).\r\n\r\n> I personally much prefer the object approach since we can just have one location for the count and an additional field to indicate how to interpret this value.\r\n\r\nPersonally I prefer option A where we keep the same format. The only scenario where an object is needed is when a user explicitly sets the `track_total_hits` threshold and this is only possible in ES 7.\r\nI agree that disabling the hit count by default is a breaking change but changing the response format is another one. I opened #35291 to avoid the latter with the downside of having two location for the count depending on the request options.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/436360011","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-436360011","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":436360011,"node_id":"MDEyOklzc3VlQ29tbWVudDQzNjM2MDAxMQ==","user":{"login":"Mpdreamz","id":245275,"node_id":"MDQ6VXNlcjI0NTI3NQ==","avatar_url":"https://avatars3.githubusercontent.com/u/245275?v=4","gravatar_id":"","url":"https://api.github.com/users/Mpdreamz","html_url":"https://github.com/Mpdreamz","followers_url":"https://api.github.com/users/Mpdreamz/followers","following_url":"https://api.github.com/users/Mpdreamz/following{/other_user}","gists_url":"https://api.github.com/users/Mpdreamz/gists{/gist_id}","starred_url":"https://api.github.com/users/Mpdreamz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Mpdreamz/subscriptions","organizations_url":"https://api.github.com/users/Mpdreamz/orgs","repos_url":"https://api.github.com/users/Mpdreamz/repos","events_url":"https://api.github.com/users/Mpdreamz/events{/privacy}","received_events_url":"https://api.github.com/users/Mpdreamz/received_events","type":"User","site_admin":false},"created_at":"2018-11-06T18:34:57Z","updated_at":"2018-11-06T18:34:57Z","author_association":"MEMBER","body":"I prefer the object approach because its explicit. Typed languages will get a heads up on the change in defaults. \r\n\r\nAdittionally you can write pagination over `hits.total.value` no matter what setting is used for the search. \r\n\r\nWe need a tiebreaker on this one I reckon :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438969961","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-438969961","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":438969961,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODk2OTk2MQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-11-15T09:11:30Z","updated_at":"2018-11-15T09:11:30Z","author_association":"MEMBER","body":"We had a discussion internally and we've decided to make `hits.total` an object in 7.0:\r\n````\r\n{ \"hits\": { \"total\": { \"value\": 1234, \"relation\": \"gte\" } } }\r\n````\r\nThis is inlined with option B above. The revised plan to make this change in 7.0 is the following:\r\n* In 7.0 hits.total is an object. Users can opt out from this format with a request parameter.\r\n* In 7.0 we make track_total_hits accept numbers in addition to boolean, which acts as a threshold for the number of hits to count. \r\n* In 6x we issue deprecation warnings when track_total_hits is not set\r\n* In version 7.0 we change the default value to 1000 like Lucene or 0 to disable the tracking of hit counts entirely. Users can opt out from this new behavior with a request parameter.\r\n\r\nWe'll use [API versioning](https://github.com/elastic/elasticsearch/issues/11184) to opt out from the new behaviors (format change and default value to track total hits). Official clients in 6x and 7 will send their version in the request automatically which will allow clients in 6x to search in a cluster with mixed versions (6x and 7). \r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438975557","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-438975557","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":438975557,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODk3NTU1Nw==","user":{"login":"karmi","id":4790,"node_id":"MDQ6VXNlcjQ3OTA=","avatar_url":"https://avatars1.githubusercontent.com/u/4790?v=4","gravatar_id":"","url":"https://api.github.com/users/karmi","html_url":"https://github.com/karmi","followers_url":"https://api.github.com/users/karmi/followers","following_url":"https://api.github.com/users/karmi/following{/other_user}","gists_url":"https://api.github.com/users/karmi/gists{/gist_id}","starred_url":"https://api.github.com/users/karmi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karmi/subscriptions","organizations_url":"https://api.github.com/users/karmi/orgs","repos_url":"https://api.github.com/users/karmi/repos","events_url":"https://api.github.com/users/karmi/events{/privacy}","received_events_url":"https://api.github.com/users/karmi/received_events","type":"User","site_admin":false},"created_at":"2018-11-15T09:30:05Z","updated_at":"2018-11-15T09:30:05Z","author_association":"CONTRIBUTOR","body":"Great to see that we're changing to the object!\r\n\r\n> Official clients in 6x and 7 will send their version in the request automatically which will allow clients in 6x to search in a cluster with mixed versions (6x and 7).\r\n\r\nCan you provide more info how that will specifically work, @jimczi ? Does it only mean that a 6.x client will send a different header than a 7.x client, and it's the reponsibility of the user to use two separate clients? How would a 6.x client \"know\" which header to send otherwise?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/438983412","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-438983412","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":438983412,"node_id":"MDEyOklzc3VlQ29tbWVudDQzODk4MzQxMg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-11-15T09:56:14Z","updated_at":"2018-11-15T09:56:14Z","author_association":"MEMBER","body":"> Does it only mean that a 6.x client will send a different header than a 7.x client, and it's the reponsibility of the user to use two separate clients? How would a 6.x client \"know\" which header to send otherwise?\r\n\r\nA 6.x client should send an header indicating its version (6) so that nodes in the cluster can adapt their  defaults and responses to the version. Clients are forward compatible so during a rolling upgrade to 7 users can still use a 6x client and with this mechanism they will not see the breaking change until they upgrade their client to 7x. There are still open questions regarding this versioning but they should be tracked on the main [issue](https://github.com/elastic/elasticsearch/issues/11184). ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/516577625","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-516577625","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":516577625,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNjU3NzYyNQ==","user":{"login":"camerondavison","id":165381,"node_id":"MDQ6VXNlcjE2NTM4MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/165381?v=4","gravatar_id":"","url":"https://api.github.com/users/camerondavison","html_url":"https://github.com/camerondavison","followers_url":"https://api.github.com/users/camerondavison/followers","following_url":"https://api.github.com/users/camerondavison/following{/other_user}","gists_url":"https://api.github.com/users/camerondavison/gists{/gist_id}","starred_url":"https://api.github.com/users/camerondavison/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/camerondavison/subscriptions","organizations_url":"https://api.github.com/users/camerondavison/orgs","repos_url":"https://api.github.com/users/camerondavison/repos","events_url":"https://api.github.com/users/camerondavison/events{/privacy}","received_events_url":"https://api.github.com/users/camerondavison/received_events","type":"User","site_admin":false},"created_at":"2019-07-30T20:13:07Z","updated_at":"2019-07-30T20:13:07Z","author_association":"NONE","body":"whatever happened here. I like\r\n\r\n>  A 6.x client should send an header indicating its version (6) so that nodes in the cluster can adapt their defaults and responses to the version. Clients are forward compatible so during a rolling upgrade to 7 users can still use a 6x client and with this mechanism \r\n\r\nBut it does not look like this was ever implemented for the java es client? I am trying with the high level rest client in `6.8.1` and I never get back any total hits since its an object but the rest client is expecting it to be a long?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/516579735","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-516579735","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":516579735,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNjU3OTczNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-07-30T20:19:23Z","updated_at":"2019-07-30T20:19:23Z","author_association":"MEMBER","body":"> But it does not look like this was ever implemented for the java es client? I am trying with the high level rest client in 6.8.1 and I never get back any total hits since its an object but the rest client is expecting it to be a long?\r\n\r\nThis was not implemented (we target the next major version for this) so the error is expected. Instead we introduced a new parameter called `rest_total_hits_as_int` in order to allow 6.x rest client to talk to a 7.x cluster but the HLRC does not have this option yet. There is an issue open to add the support for it here: https://github.com/elastic/elasticsearch/issues/43925 so you can follow the progress in the issue.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/516582242","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-516582242","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":516582242,"node_id":"MDEyOklzc3VlQ29tbWVudDUxNjU4MjI0Mg==","user":{"login":"camerondavison","id":165381,"node_id":"MDQ6VXNlcjE2NTM4MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/165381?v=4","gravatar_id":"","url":"https://api.github.com/users/camerondavison","html_url":"https://github.com/camerondavison","followers_url":"https://api.github.com/users/camerondavison/followers","following_url":"https://api.github.com/users/camerondavison/following{/other_user}","gists_url":"https://api.github.com/users/camerondavison/gists{/gist_id}","starred_url":"https://api.github.com/users/camerondavison/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/camerondavison/subscriptions","organizations_url":"https://api.github.com/users/camerondavison/orgs","repos_url":"https://api.github.com/users/camerondavison/repos","events_url":"https://api.github.com/users/camerondavison/events{/privacy}","received_events_url":"https://api.github.com/users/camerondavison/received_events","type":"User","site_admin":false},"created_at":"2019-07-30T20:26:45Z","updated_at":"2019-07-30T20:26:45Z","author_association":"NONE","body":"@jimczi thanks for the quick reply","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/652746860","html_url":"https://github.com/elastic/elasticsearch/issues/33028#issuecomment-652746860","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33028","id":652746860,"node_id":"MDEyOklzc3VlQ29tbWVudDY1Mjc0Njg2MA==","user":{"login":"NelsonBurton","id":3894754,"node_id":"MDQ6VXNlcjM4OTQ3NTQ=","avatar_url":"https://avatars2.githubusercontent.com/u/3894754?v=4","gravatar_id":"","url":"https://api.github.com/users/NelsonBurton","html_url":"https://github.com/NelsonBurton","followers_url":"https://api.github.com/users/NelsonBurton/followers","following_url":"https://api.github.com/users/NelsonBurton/following{/other_user}","gists_url":"https://api.github.com/users/NelsonBurton/gists{/gist_id}","starred_url":"https://api.github.com/users/NelsonBurton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NelsonBurton/subscriptions","organizations_url":"https://api.github.com/users/NelsonBurton/orgs","repos_url":"https://api.github.com/users/NelsonBurton/repos","events_url":"https://api.github.com/users/NelsonBurton/events{/privacy}","received_events_url":"https://api.github.com/users/NelsonBurton/received_events","type":"User","site_admin":false},"created_at":"2020-07-02T02:42:43Z","updated_at":"2020-07-02T02:42:43Z","author_association":"NONE","body":"In 7.x, will adding the `rest_total_hits_as_int` negatively affect performance of a query as opposed to leaving it off? In the discussion above, there is a note that to calculate the accurate hits number another aggregation query would need to be run...","performed_via_github_app":null}]