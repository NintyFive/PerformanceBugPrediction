{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10070","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10070/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10070/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10070/events","html_url":"https://github.com/elastic/elasticsearch/issues/10070","id":60782604,"node_id":"MDU6SXNzdWU2MDc4MjYwNA==","number":10070,"title":"[Bug] 'ignore_malformed' does not always work, and occasionally throws an exception","user":{"login":"Chetane","id":765364,"node_id":"MDQ6VXNlcjc2NTM2NA==","avatar_url":"https://avatars0.githubusercontent.com/u/765364?v=4","gravatar_id":"","url":"https://api.github.com/users/Chetane","html_url":"https://github.com/Chetane","followers_url":"https://api.github.com/users/Chetane/followers","following_url":"https://api.github.com/users/Chetane/following{/other_user}","gists_url":"https://api.github.com/users/Chetane/gists{/gist_id}","starred_url":"https://api.github.com/users/Chetane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Chetane/subscriptions","organizations_url":"https://api.github.com/users/Chetane/orgs","repos_url":"https://api.github.com/users/Chetane/repos","events_url":"https://api.github.com/users/Chetane/events{/privacy}","received_events_url":"https://api.github.com/users/Chetane/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-03-12T07:49:12Z","updated_at":"2017-12-01T02:26:31Z","closed_at":"2015-12-05T20:25:23Z","author_association":"NONE","active_lock_reason":null,"body":"The idea behind `ignore_malformed` setting, is to ensure all records being added get added to the index, even if some of the JSON attribute use an invalid data type (compared to the index's expected mapping). This is particularly useful with dynamic JSON document, where it's most important that all objects are \"added\" (rather than rejected via exception).\n\nHowever, there are some cases where malformed JSON object are being reject (exception) instead of getting accepted. Repro steps:\n-  Make sure the `ignore_malformed` setting is enabled\n- Add a first record\n\n```\n~$ curl -XPUT 'http://127.0.0.1:9200/tweets/tweet/123' -d '{ \"value\" : 12345 }'\n{\"_index\":\"tweets\",\"_type\":\"tweet\",\"_id\":\"123\",\"_version\":1,\"created\":true}~ $\n```\n\nThe index now expected a `long` value for the \"value\" field.\n- Add a malformed record\n\n```\n~ $ curl -XPUT 'http://127.0.0.1:9200/tweets/tweet/124' -d '{ \"value\" : \"Hello\" }'\n{\"_index\":\"tweets\",\"_type\":\"tweet\",\"_id\":\"124\",\"_version\":1,\"created\":true}\n```\n\nThe malformed record is accepted, as expected.\n- Add another malformed record\n\n```\n~ $ curl -XPUT 'http://127.0.0.1:9200/tweets/tweet/125' -d '{ \"value\" : 123123123123123123123 }'\n{\"error\":\"MapperParsingException[failed to parse [value]]; nested: JsonParseException[Numeric value (123123123123123123123) out of range of long (-9223372036854775808 - 9223372036854775807)\\n at [Source: [B@52259927; line: 1, column: 34]]; \",\"status\":400}\n```\n\nExpected: This malformed record should still be added, with the `123123123123123123123` value coerced into a `string`.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}