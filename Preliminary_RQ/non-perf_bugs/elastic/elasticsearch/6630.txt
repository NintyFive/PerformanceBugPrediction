{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/6630","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6630/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6630/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/6630/events","html_url":"https://github.com/elastic/elasticsearch/issues/6630","id":36571458,"node_id":"MDU6SXNzdWUzNjU3MTQ1OA==","number":6630,"title":"Bulk API: Fix return of wrong request type on failed updates","user":{"login":"tuxnco","id":562313,"node_id":"MDQ6VXNlcjU2MjMxMw==","avatar_url":"https://avatars0.githubusercontent.com/u/562313?v=4","gravatar_id":"","url":"https://api.github.com/users/tuxnco","html_url":"https://github.com/tuxnco","followers_url":"https://api.github.com/users/tuxnco/followers","following_url":"https://api.github.com/users/tuxnco/following{/other_user}","gists_url":"https://api.github.com/users/tuxnco/gists{/gist_id}","starred_url":"https://api.github.com/users/tuxnco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tuxnco/subscriptions","organizations_url":"https://api.github.com/users/tuxnco/orgs","repos_url":"https://api.github.com/users/tuxnco/repos","events_url":"https://api.github.com/users/tuxnco/events{/privacy}","received_events_url":"https://api.github.com/users/tuxnco/received_events","type":"User","site_admin":false},"labels":[{"id":145572580,"node_id":"MDU6TGFiZWwxNDU1NzI1ODA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CRUD","name":":Distributed/CRUD","color":"0e8a16","default":false,"description":"A catch all label for issues around indexing, updating and getting a doc by id. Not search."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":104188881,"node_id":"MDU6TGFiZWwxMDQxODg4ODE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.2.2","name":"v1.2.2","color":"DDDDDD","default":false,"description":null},{"id":95090930,"node_id":"MDU6TGFiZWw5NTA5MDkzMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.3.0","name":"v1.3.0","color":"DDDDDD","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"assignees":[{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false}],"milestone":null,"comments":0,"created_at":"2014-06-26T12:36:02Z","updated_at":"2018-02-13T19:39:54Z","closed_at":"2014-07-02T10:42:43Z","author_association":"NONE","active_lock_reason":null,"body":"Opening an issue as suggested by @dadoonet after the following discussion on the mailing list: https://groups.google.com/forum/#!topic/elasticsearch/HAA4Y8Qziqg\n\nWhen a bulk update action fails, an \"index\" entry can be returned in the response.\n\nExample bulk commands list with an update command failing because the second date can't be parsed:\n\n``` json\n{ \"index\" : { \"_index\" : \"test\", \"_type\" : \"type1\", \"_id\" : \"1\" } } \n{ \"title\" : \"Great Title of doc 1\" } \n{ \"index\" : { \"_index\" : \"test\", \"_type\" : \"type1\", \"_id\" : \"2\" } } \n{ \"title\" : \"Great Title of doc 2\" } \n{ \"update\" : { \"_index\" : \"test\", \"_type\" : \"type1\", \"_id\" : \"1\" } } \n{ \"doc\" : { \"date\" : \"2014-04-30T23:59:57\" }} \n{ \"update\" : { \"_index\" : \"test\", \"_type\" : \"type1\", \"_id\" : \"2\" } } \n{ \"doc\" : { \"date\" : \"2014-04-31T00:00:01\" }} \n{ \"delete\" : { \"_index\" : \"test\", \"_type\" : \"type1\", \"_id\" : \"1\" } } \n{ \"delete\" : { \"_index\" : \"test\", \"_type\" : \"type1\", \"_id\" : \"2\" } }\n```\n\nHere is the actual response (elasticsearch v1.1):\n\n``` json\n{\n  \"took\" : 4, \n  \"errors\" : true, \n  \"items\" : [ { \n    \"index\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"1\", \n      \"_version\" : 8, \n      \"status\" : 201 \n    } \n  }, { \n    \"index\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"2\", \n      \"_version\" : 5, \n      \"status\" : 201 \n    } \n  }, { \n    \"update\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"1\", \n      \"_version\" : 9, \n      \"status\" : 200 \n    } \n  }, { \n    \"index\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"2\", \n      \"status\" : 400, \n      \"error\" : \"MapperParsingException[failed to parse [date]]; nested: MapperParsingException[failed to parse date field [2014-04-31T00:00:01], tried both date format [dateOptionalTime], and timestamp number with locale []]; nested: IllegalFieldValueException[Cannot parse \\\"2014-04-31T00:00:01\\\": Value 31 for dayOfMonth must be in the range [1,30]]; \" \n    } \n  }, { \n    \"delete\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"1\", \n      \"_version\" : 10, \n      \"status\" : 200, \n      \"found\" : true \n    } \n  }, { \n    \"delete\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"2\", \n      \"_version\" : 6, \n      \"status\" : 200, \n      \"found\" : true \n    } \n  } ] \n}\n```\n\nThe problem here concerns the bulk update response for the forth item. It's key is `index` while it should be `update`, as in the following hand edited response:\n\n``` json\n{\n  \"took\" : 4, \n  \"errors\" : true, \n  \"items\" : [ { \n    \"index\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"1\", \n      \"_version\" : 8, \n      \"status\" : 201 \n    } \n  }, { \n    \"index\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"2\", \n      \"_version\" : 5, \n      \"status\" : 201 \n    } \n  }, { \n    \"update\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"1\", \n      \"_version\" : 9, \n      \"status\" : 200 \n    } \n  }, { \n    \"update\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"2\", \n      \"status\" : 400, \n      \"error\" : \"MapperParsingException[failed to parse [date]]; nested: MapperParsingException[failed to parse date field [2014-04-31T00:00:01], tried both date format [dateOptionalTime], and timestamp number with locale []]; nested: IllegalFieldValueException[Cannot parse \\\"2014-04-31T00:00:01\\\": Value 31 for dayOfMonth must be in the range [1,30]]; \" \n    } \n  }, { \n    \"delete\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"1\", \n      \"_version\" : 10, \n      \"status\" : 200, \n      \"found\" : true \n    } \n  }, { \n    \"delete\" : { \n      \"_index\" : \"test\", \n      \"_type\" : \"type1\", \n      \"_id\" : \"2\", \n      \"_version\" : 6, \n      \"status\" : 200, \n      \"found\" : true \n    } \n  } ] \n}\n```\n\nI didn't do a lot of code reading but a possible starting point for investigations is there: https://github.com/elasticsearch/elasticsearch/blob/1.1/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java#L317\n","closed_by":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"performed_via_github_app":null}