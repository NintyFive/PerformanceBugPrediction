{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42107","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42107/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42107/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42107/events","html_url":"https://github.com/elastic/elasticsearch/issues/42107","id":443110527,"node_id":"MDU6SXNzdWU0NDMxMTA1Mjc=","number":42107,"title":"Provide per-pipeline timestamps","user":{"login":"peterpramb","id":11035668,"node_id":"MDQ6VXNlcjExMDM1NjY4","avatar_url":"https://avatars0.githubusercontent.com/u/11035668?v=4","gravatar_id":"","url":"https://api.github.com/users/peterpramb","html_url":"https://github.com/peterpramb","followers_url":"https://api.github.com/users/peterpramb/followers","following_url":"https://api.github.com/users/peterpramb/following{/other_user}","gists_url":"https://api.github.com/users/peterpramb/gists{/gist_id}","starred_url":"https://api.github.com/users/peterpramb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterpramb/subscriptions","organizations_url":"https://api.github.com/users/peterpramb/orgs","repos_url":"https://api.github.com/users/peterpramb/repos","events_url":"https://api.github.com/users/peterpramb/events{/privacy}","received_events_url":"https://api.github.com/users/peterpramb/received_events","type":"User","site_admin":false},"labels":[{"id":268963484,"node_id":"MDU6TGFiZWwyNjg5NjM0ODQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Ingest","name":":Core/Features/Ingest","color":"0e8a16","default":false,"description":"Execution or management of Ingest Pipelines"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-05-12T14:27:41Z","updated_at":"2019-06-01T15:42:45Z","closed_at":"2019-06-01T15:42:45Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:\r\n\r\nCurrently `_ingest.timestamp` seems to be only set initially when entering an ingest pipeline at the first time. However to measure per-pipeline ingest delays (as discussed in elastic/ecs#453) an updated timestamp per pipeline would be needed.\r\n\r\nOf course one can retrieve the date via script, but it would be more convenient to directly access it via metadata, either by letting `_ingest.timestamp` be updated on each pipeline call or by introducing a new ingest metadata field.\r\n\r\nHere is a simple test case, Elasticsearch version is 6.7.1:\r\n```\r\nPUT /_ingest/pipeline/testing2-ingest-pipeline\r\n{\r\n    \"processors\": [\r\n        {\r\n            \"append\": {\r\n                \"field\": \"ingest.timestamps\",\r\n                \"value\": \"{{_ingest.timestamp}}\"\r\n            }\r\n        },\r\n        {\r\n            \"pipeline\": {\r\n                \"name\": \"testing2-chained-pipeline\"\r\n            }\r\n        }\r\n    ]\r\n}\r\n```\r\n```\r\nPUT /_ingest/pipeline/testing2-chained-pipeline\r\n{\r\n    \"processors\": [\r\n        {\r\n            \"append\": {\r\n                \"field\": \"ingest.timestamps\",\r\n                \"value\": \"{{_ingest.timestamp}}\"\r\n            }\r\n        }\r\n    ]\r\n}\r\n```\r\n```\r\nPOST /testing2-chained/_doc/?pipeline=testing2-ingest-pipeline\r\n{\r\n  \"field\": \"value\"\r\n}\r\n```\r\n```\r\nGET /testing2-chained/_doc/S25crGoBkBB05GCNSA5t\r\n{\r\n    \"_id\": \"S25crGoBkBB05GCNSA5t\",\r\n    \"_index\": \"testing2-chained\",\r\n    \"_primary_term\": 1,\r\n    \"_seq_no\": 0,\r\n    \"_source\": {\r\n        \"field\": \"value\",\r\n        \"ingest\": {\r\n            \"timestamps\": [\r\n                \"2019-05-12T14:04:50.054Z\",\r\n                \"2019-05-12T14:04:50.054Z\"\r\n            ]\r\n        }\r\n    },\r\n    \"_type\": \"_doc\",\r\n    \"_version\": 1,\r\n    \"found\": true\r\n}\r\n```","closed_by":{"login":"peterpramb","id":11035668,"node_id":"MDQ6VXNlcjExMDM1NjY4","avatar_url":"https://avatars0.githubusercontent.com/u/11035668?v=4","gravatar_id":"","url":"https://api.github.com/users/peterpramb","html_url":"https://github.com/peterpramb","followers_url":"https://api.github.com/users/peterpramb/followers","following_url":"https://api.github.com/users/peterpramb/following{/other_user}","gists_url":"https://api.github.com/users/peterpramb/gists{/gist_id}","starred_url":"https://api.github.com/users/peterpramb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterpramb/subscriptions","organizations_url":"https://api.github.com/users/peterpramb/orgs","repos_url":"https://api.github.com/users/peterpramb/repos","events_url":"https://api.github.com/users/peterpramb/events{/privacy}","received_events_url":"https://api.github.com/users/peterpramb/received_events","type":"User","site_admin":false},"performed_via_github_app":null}