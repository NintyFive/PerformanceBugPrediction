{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9910","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9910/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9910/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9910/events","html_url":"https://github.com/elastic/elasticsearch/issues/9910","id":59153240,"node_id":"MDU6SXNzdWU1OTE1MzI0MA==","number":9910,"title":"Unable to use JSON query string with SearchRequestBuilder (Elasticsearch 1.4.2 & 1.4.4)","user":{"login":"cooniur","id":3030052,"node_id":"MDQ6VXNlcjMwMzAwNTI=","avatar_url":"https://avatars0.githubusercontent.com/u/3030052?v=4","gravatar_id":"","url":"https://api.github.com/users/cooniur","html_url":"https://github.com/cooniur","followers_url":"https://api.github.com/users/cooniur/followers","following_url":"https://api.github.com/users/cooniur/following{/other_user}","gists_url":"https://api.github.com/users/cooniur/gists{/gist_id}","starred_url":"https://api.github.com/users/cooniur/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cooniur/subscriptions","organizations_url":"https://api.github.com/users/cooniur/orgs","repos_url":"https://api.github.com/users/cooniur/repos","events_url":"https://api.github.com/users/cooniur/events{/privacy}","received_events_url":"https://api.github.com/users/cooniur/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-02-26T22:15:39Z","updated_at":"2015-02-27T21:45:41Z","closed_at":"2015-02-27T21:45:41Z","author_association":"NONE","active_lock_reason":null,"body":"Previously, I use the following code to query Elasticsearch using JSON string (code is in Groovy):\n\n```\n    Settings settings = ImmutableSettings.settingsBuilder().put(\"cluster.name\", \"elasticsearch\").build();\n    Client client = new TransportClient(settings).addTransportAddress(new InetSocketTransportAddress(\"localhost\", \"9300\"));\n\n    String jsonQuery = \"\"\"{\"query\":{\"filtered\":{\"filter\":{\"term\":{\"_id\":\"100\"}}}}}\"\"\"\n    SearchRequestBuilder request = client.prepareSearch(\"twitter\")\n            .setTypes(\"data\")\n            .setSource(jsonQuery)\n\n    SearchResponse response = request.execute().actionGet()\n```\n\nAs you can read from the above, I want to filter the documents to find one with `_id=100`. Now it returns all documents, totally ignoring my query.\n\nIf I use `QueryBuilders`, I get ClassNoFoundException, which is described here: https://github.com/elasticsearch/elasticsearch/issues/9891\n\nIf I use `setExtraSource()`, it works. But `setSource()` was working before (from November 2014 till yesterday). And according to the documentation, it is the method that can be used to set JSON query string.\n\nHere is my dependencies:\n\n```\n<properties>\n    <java.version>1.8</java.version>\n    <plugin.groovy-eclipse-compiler>2.9.0-01</plugin.groovy-eclipse-compiler>\n    <plugin.groovy-eclipse-batch>2.3.4-01</plugin.groovy-eclipse-batch>\n</properties>\n\n<dependencies>\n    <dependency>\n        <groupId>org.elasticsearch</groupId>\n        <artifactId>elasticsearch</artifactId>\n        <version>1.4.2</version>\n    </dependency>\n    <dependency>\n        <groupId>org.codehaus.groovy</groupId>\n        <artifactId>groovy-all</artifactId>\n        <version>2.4.1</version>\n    </dependency>\n\n    <dependency>\n        <groupId>org.slf4j</groupId>\n        <artifactId>slf4j-api</artifactId>\n        <version>1.7.10</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>ch.qos.logback</groupId>\n        <artifactId>logback-classic</artifactId>\n        <version>1.1.2</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>junit</groupId>\n        <artifactId>junit</artifactId>\n        <version>4.12</version>\n        <scope>test</scope>\n    </dependency>\n    <dependency>\n        <groupId>org.hamcrest</groupId>\n        <artifactId>hamcrest-all</artifactId>\n        <version>1.3</version>\n    </dependency>\n</dependencies>\n```\n\nIt can be reproduced on my colleague's environment, too. We both use Oracle JDK 8 (1.8.0_31) on Mac. IDEs are Eclipse (his) and IntelliJ (mine).\n\nTested on Elasticsearch 1.4.2 & 1.4.4, both failed.\n","closed_by":{"login":"cooniur","id":3030052,"node_id":"MDQ6VXNlcjMwMzAwNTI=","avatar_url":"https://avatars0.githubusercontent.com/u/3030052?v=4","gravatar_id":"","url":"https://api.github.com/users/cooniur","html_url":"https://github.com/cooniur","followers_url":"https://api.github.com/users/cooniur/followers","following_url":"https://api.github.com/users/cooniur/following{/other_user}","gists_url":"https://api.github.com/users/cooniur/gists{/gist_id}","starred_url":"https://api.github.com/users/cooniur/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cooniur/subscriptions","organizations_url":"https://api.github.com/users/cooniur/orgs","repos_url":"https://api.github.com/users/cooniur/repos","events_url":"https://api.github.com/users/cooniur/events{/privacy}","received_events_url":"https://api.github.com/users/cooniur/received_events","type":"User","site_admin":false},"performed_via_github_app":null}