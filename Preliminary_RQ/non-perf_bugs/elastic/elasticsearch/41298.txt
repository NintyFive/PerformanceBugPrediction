{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41298/events","html_url":"https://github.com/elastic/elasticsearch/issues/41298","id":434159024,"node_id":"MDU6SXNzdWU0MzQxNTkwMjQ=","number":41298,"title":"Reindexing a 5.x index in 6.7.1 causes ArrayOutOfBoundsException","user":{"login":"braunsonm","id":5280764,"node_id":"MDQ6VXNlcjUyODA3NjQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5280764?v=4","gravatar_id":"","url":"https://api.github.com/users/braunsonm","html_url":"https://github.com/braunsonm","followers_url":"https://api.github.com/users/braunsonm/followers","following_url":"https://api.github.com/users/braunsonm/following{/other_user}","gists_url":"https://api.github.com/users/braunsonm/gists{/gist_id}","starred_url":"https://api.github.com/users/braunsonm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/braunsonm/subscriptions","organizations_url":"https://api.github.com/users/braunsonm/orgs","repos_url":"https://api.github.com/users/braunsonm/repos","events_url":"https://api.github.com/users/braunsonm/events{/privacy}","received_events_url":"https://api.github.com/users/braunsonm/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"}],"state":"closed","locked":false,"assignee":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"assignees":[{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2019-04-17T08:36:17Z","updated_at":"2019-05-28T11:04:06Z","closed_at":"2019-05-28T11:04:05Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version** (`bin/elasticsearch --version`): \r\nVersion: 6.7.1, Build: default/deb/2f32220/2019-04-02T15:59:27.961366Z, JVM: 1.8.0_212\r\n\r\n\r\n**Plugins installed**: None\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk version \"1.8.0_212\"\r\nOpenJDK Runtime Environment (build 1.8.0_212-8u212-b01-1~deb9u1-b01)\r\nOpenJDK 64-Bit Server VM (build 25.212-b01, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux  4.9.0-4-amd64 #1 SMP Debian 4.9.65-3+deb9u1 (2017-12-23) x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI have successfully moved from ES 5.x to 6.7.1, and I wish to reindex my indices before moving to 7.0 as I have some created from in 5.x that I would like to keep.\r\n\r\nHowever this results in the following exception when running this request:\r\n```\r\ncurl -X POST \"localhost:9200/_reindex\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"source\": {\r\n    \"index\": \"logs\"\r\n  },\r\n  \"dest\": {\r\n    \"index\": \"logs_v6\"\r\n  }\r\n}\r\n'\r\n```\r\n\r\n```\r\n[2019-04-17T08:31:13,268][DEBUG][o.e.a.s.TransportSearchScrollAction] [Q0LH2rW] [12] Failed to execute fetch phase\r\norg.elasticsearch.transport.RemoteTransportException: [Q0LH2rW][127.0.0.1:9300][indices:data/read/search[phase/fetch/id/scroll]]\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException\r\n        at org.apache.lucene.codecs.compressing.LZ4.decompress(LZ4.java:130) ~[lucene-core-7.7.0.jar:7.7.0 8c831daf4eb41153c25ddb152501ab5bae3ea3d5 - jimczi - 2019-02-04 23:16:28]\r\n        at org.apache.lucene.codecs.compressing.CompressionMode$4.decompress(CompressionMode.java:138) ~[lucene-core-7.7.0.jar:7.7.0 8c831daf4eb41153c25ddb152501ab5bae3ea3d5 - jimczi - 2019-02-04 23:16:28]\r\n        at org.apache.lucene.codecs.compressing.CompressingStoredFieldsReader$BlockState.document(CompressingStoredFieldsReader.java:555) ~[lucene-core-7.7.0.jar:7.7.0 8c831daf4eb41153c25ddb152501ab5bae3ea3d5 - jimczi - $\r\n        at org.apache.lucene.codecs.compressing.CompressingStoredFieldsReader.document(CompressingStoredFieldsReader.java:571) ~[lucene-core-7.7.0.jar:7.7.0 8c831daf4eb41153c25ddb152501ab5bae3ea3d5 - jimczi - 2019-02-04 $\r\n        at org.apache.lucene.codecs.compressing.CompressingStoredFieldsReader.visitDocument(CompressingStoredFieldsReader.java:578) ~[lucene-core-7.7.0.jar:7.7.0 8c831daf4eb41153c25ddb152501ab5bae3ea3d5 - jimczi - 2019-0$\r\n        at org.apache.lucene.index.CodecReader.document(CodecReader.java:84) ~[lucene-core-7.7.0.jar:7.7.0 8c831daf4eb41153c25ddb152501ab5bae3ea3d5 - jimczi - 2019-02-04 23:16:28]\r\n        at org.apache.lucene.index.FilterLeafReader.document(FilterLeafReader.java:341) ~[lucene-core-7.7.0.jar:7.7.0 8c831daf4eb41153c25ddb152501ab5bae3ea3d5 - jimczi - 2019-02-04 23:16:28]\r\n        at org.elasticsearch.search.fetch.FetchPhase.loadStoredFields(FetchPhase.java:435) ~[elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.search.fetch.FetchPhase.getSearchFields(FetchPhase.java:234) ~[elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.search.fetch.FetchPhase.createSearchHit(FetchPhase.java:209) ~[elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.search.fetch.FetchPhase.execute(FetchPhase.java:160) ~[elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.search.SearchService.lambda$executeFetchPhase$3(SearchService.java:540) ~[elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.search.SearchService$3.doRun(SearchService.java:380) [elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.common.util.concurrent.TimedRunnable.doRun(TimedRunnable.java:41) [elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:751) [elasticsearch-6.7.1.jar:6.7.1]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.7.1.jar:6.7.1]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n\r\n```\r\n\r\n**Steps to reproduce**:\r\n\r\nUnfortunately, not sure. I simply run the reindex command. The `logs` index is fully searchable and mutable.","closed_by":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"performed_via_github_app":null}