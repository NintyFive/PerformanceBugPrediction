[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388556767","html_url":"https://github.com/elastic/elasticsearch/issues/30551#issuecomment-388556767","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30551","id":388556767,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODU1Njc2Nw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-05-12T13:52:41Z","updated_at":"2018-05-12T13:52:41Z","author_association":"COLLABORATOR","body":"Pinging @elastic/ml-core","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/388742025","html_url":"https://github.com/elastic/elasticsearch/issues/30551#issuecomment-388742025","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30551","id":388742025,"node_id":"MDEyOklzc3VlQ29tbWVudDM4ODc0MjAyNQ==","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"created_at":"2018-05-14T08:45:10Z","updated_at":"2018-05-14T08:45:10Z","author_association":"CONTRIBUTOR","body":"@richcollier Can you see any `model_snapshot` documents in the results index with `job_id` set to `test_kpi`?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/389149990","html_url":"https://github.com/elastic/elasticsearch/issues/30551#issuecomment-389149990","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30551","id":389149990,"node_id":"MDEyOklzc3VlQ29tbWVudDM4OTE0OTk5MA==","user":{"login":"richcollier","id":7461287,"node_id":"MDQ6VXNlcjc0NjEyODc=","avatar_url":"https://avatars2.githubusercontent.com/u/7461287?v=4","gravatar_id":"","url":"https://api.github.com/users/richcollier","html_url":"https://github.com/richcollier","followers_url":"https://api.github.com/users/richcollier/followers","following_url":"https://api.github.com/users/richcollier/following{/other_user}","gists_url":"https://api.github.com/users/richcollier/gists{/gist_id}","starred_url":"https://api.github.com/users/richcollier/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richcollier/subscriptions","organizations_url":"https://api.github.com/users/richcollier/orgs","repos_url":"https://api.github.com/users/richcollier/repos","events_url":"https://api.github.com/users/richcollier/events{/privacy}","received_events_url":"https://api.github.com/users/richcollier/received_events","type":"User","site_admin":false},"created_at":"2018-05-15T12:33:15Z","updated_at":"2018-05-15T12:33:15Z","author_association":"NONE","body":"@dimitris-athanasiou - there are no documents in `.ml-anomalies` for `job_id:test_kpi`","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/389194635","html_url":"https://github.com/elastic/elasticsearch/issues/30551#issuecomment-389194635","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30551","id":389194635,"node_id":"MDEyOklzc3VlQ29tbWVudDM4OTE5NDYzNQ==","user":{"login":"dimitris-athanasiou","id":9351617,"node_id":"MDQ6VXNlcjkzNTE2MTc=","avatar_url":"https://avatars3.githubusercontent.com/u/9351617?v=4","gravatar_id":"","url":"https://api.github.com/users/dimitris-athanasiou","html_url":"https://github.com/dimitris-athanasiou","followers_url":"https://api.github.com/users/dimitris-athanasiou/followers","following_url":"https://api.github.com/users/dimitris-athanasiou/following{/other_user}","gists_url":"https://api.github.com/users/dimitris-athanasiou/gists{/gist_id}","starred_url":"https://api.github.com/users/dimitris-athanasiou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dimitris-athanasiou/subscriptions","organizations_url":"https://api.github.com/users/dimitris-athanasiou/orgs","repos_url":"https://api.github.com/users/dimitris-athanasiou/repos","events_url":"https://api.github.com/users/dimitris-athanasiou/events{/privacy}","received_events_url":"https://api.github.com/users/dimitris-athanasiou/received_events","type":"User","site_admin":false},"created_at":"2018-05-15T14:48:26Z","updated_at":"2018-05-15T14:52:09Z","author_association":"CONTRIBUTOR","body":"We found the cause of this. It was a bug that was introduced in version `6.1`. When we persist the model state, we persist the state documents in `.ml-state` index and a `model_snapshot` document in the results index. Later, in order to delete the state documents, we need to have the model snapshot doc. Due to the bug, during background periodic persistence, the state documents were persisted but the model snapshot document was put in a buffer. If the job was deleted from the UI before the buffer was flushed, the snapshot documents would never be indexed, meaning the state docs would be left behind after the job was deleted.\r\n\r\nThe above bug is resolved in `6.3.0` (and `6.2.5` if that version is ever released). However, in order to ensure those documents are deleted and to prevent such cases in the future, I will work on enhancing the daily maintenance service to look for left-behind state docs and clean them up.","performed_via_github_app":null}]