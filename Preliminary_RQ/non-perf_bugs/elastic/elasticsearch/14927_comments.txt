[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/158878807","html_url":"https://github.com/elastic/elasticsearch/issues/14927#issuecomment-158878807","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14927","id":158878807,"node_id":"MDEyOklzc3VlQ29tbWVudDE1ODg3ODgwNw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T08:51:39Z","updated_at":"2015-11-23T08:51:39Z","author_association":"MEMBER","body":"@jasontedor do you mind taking a look at this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159013624","html_url":"https://github.com/elastic/elasticsearch/issues/14927#issuecomment-159013624","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14927","id":159013624,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTAxMzYyNA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T18:03:42Z","updated_at":"2015-11-23T18:03:42Z","author_association":"MEMBER","body":"The `IllegalIndexShardStateException`s that you are seeing in the log messages here are not from the index creation, but from stats requests that are being issued. These stats requests appear to be issued while the physical shards are in the state of `IndexShardState.RECOVERING` which is a state that physical shards pass through, for instance, upon index creation.\n\nI think that the reason that you're seeing this behavior on 2.0 but were not seeing it on 1.7 is because of a [change](https://github.com/elastic/elasticsearch/commit/5cb86130ec65c508b25b503d228f0acfb1797663#diff-be8942a0b62ccd463e4b261e67d110a0R65) to the shards that are considered during an indices stats request.\n\nThis shouldn't be negatively impacting your cluster other than spamming your logs. If you want to prevent it, you'll need to track down the source of those stats requests and, if needed, make them wait for the index health to be green before issuing a stats request against the index.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159036985","html_url":"https://github.com/elastic/elasticsearch/issues/14927#issuecomment-159036985","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14927","id":159036985,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTAzNjk4NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T19:28:21Z","updated_at":"2015-11-23T19:28:21Z","author_association":"MEMBER","body":"@jasontedor correct if I'm wrong, but I don't see the change to IndexShard.docStats that enforces readAllowed() . Also, I think it's wrong to block stats report if the engine is already open and we are recovering. I'm thinking, for example, of reporting the translog length, or the memory signature of lucene, number of segments etc. If the engine is not yet open, we can ignore the shard as it is not relevant for the stats. I feel a trace message is more appropriate here. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159041563","html_url":"https://github.com/elastic/elasticsearch/issues/14927#issuecomment-159041563","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14927","id":159041563,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTA0MTU2Mw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T19:43:39Z","updated_at":"2015-11-23T21:08:09Z","author_association":"MEMBER","body":"> correct if I'm wrong, but I don't see the change to IndexShard.docStats that enforces readAllowed()\n\n@bleskes I wasn't suggesting it was a change to `IndexShard#docStats`; the [change](https://github.com/elastic/elasticsearch/commit/5cb86130ec65c508b25b503d228f0acfb1797663#diff-be8942a0b62ccd463e4b261e67d110a0R65) is to `TransportIndicesStatsAction#shards`.\n\n> If the engine is not yet open, we can ignore the shard as it is not relevant for the stats.\n\nThe shard doesn't get counted as \"failed\" in the stats response.\n\n> I feel a trace message is more appropriate here.\n\nOkay.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159044280","html_url":"https://github.com/elastic/elasticsearch/issues/14927#issuecomment-159044280","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14927","id":159044280,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTA0NDI4MA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T19:51:57Z","updated_at":"2015-11-23T19:51:57Z","author_association":"MEMBER","body":"Oh , I see. OK :) before we didn't even try... \n\nAs I said, I think we can be less strict then readAllowed() but that's not a regression then. Re the trace - note how we ignore this error completely in the response:\n\n```\n if (!TransportActions.isShardNotAvailableException(throwable)) {\n                        exceptions.add(new DefaultShardOperationFailedException(throwable.getIndex(), throwable.getShardId().getId(), throwable));\n                    }\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/159046927","html_url":"https://github.com/elastic/elasticsearch/issues/14927#issuecomment-159046927","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/14927","id":159046927,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTA0NjkyNw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2015-11-23T20:00:13Z","updated_at":"2015-11-23T20:00:13Z","author_association":"MEMBER","body":"Yes, see #14950.\n","performed_via_github_app":null}]