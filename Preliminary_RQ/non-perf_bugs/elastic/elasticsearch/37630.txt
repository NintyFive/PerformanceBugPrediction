{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/37630","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37630/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37630/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/37630/events","html_url":"https://github.com/elastic/elasticsearch/issues/37630","id":400984191,"node_id":"MDU6SXNzdWU0MDA5ODQxOTE=","number":37630,"title":"Faraday::ConnectionFailed: read function returned funny value","user":{"login":"swzensar8","id":22793324,"node_id":"MDQ6VXNlcjIyNzkzMzI0","avatar_url":"https://avatars1.githubusercontent.com/u/22793324?v=4","gravatar_id":"","url":"https://api.github.com/users/swzensar8","html_url":"https://github.com/swzensar8","followers_url":"https://api.github.com/users/swzensar8/followers","following_url":"https://api.github.com/users/swzensar8/following{/other_user}","gists_url":"https://api.github.com/users/swzensar8/gists{/gist_id}","starred_url":"https://api.github.com/users/swzensar8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swzensar8/subscriptions","organizations_url":"https://api.github.com/users/swzensar8/orgs","repos_url":"https://api.github.com/users/swzensar8/repos","events_url":"https://api.github.com/users/swzensar8/events{/privacy}","received_events_url":"https://api.github.com/users/swzensar8/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-01-19T10:48:22Z","updated_at":"2019-01-20T21:26:16Z","closed_at":"2019-01-20T21:26:16Z","author_association":"NONE","active_lock_reason":null,"body":"I am getting this error for large(1 MB) data sync from one application to rails application and after sync I am doing elasticsearch indexing. Previously I used ruby 2.3.3 and rails 4.2.7 it was working fine with large data also but now I have updated ruby to 2.5.1 and rails 4.2.10 and its giving \"Faraday::ConnectionFailed: read function returned funny value\" error while indexing large data.\r\n\r\n**Tried with listed version of elasticsearch gem**\r\n\r\nelasticsearch (6.1.0, 2.0.2) \r\nelasticsearch-api (6.1.0, 2.0.2) \r\nelasticsearch-model (6.0.0, 2.0.1) \r\nelasticsearch-rails (6.0.0, 2.0.1)\r\nelasticsearch-transport (6.1.0, 2.0.2)\r\n\r\n**Also tried with faraday and faraday_middleware gem update**\r\n\r\nfaraday (0.15.4, 0.9.2) \r\nfaraday_middleware (0.12.2)\r\n\r\nAdaptor and version is: gem 'patron', '~> 0.4.18'\r\n\r\n**Details of gemfile.lock**\r\nelasticsearch (2.0.2)\r\n  elasticsearch-api (= 2.0.2)\r\n  elasticsearch-transport (= 2.0.2)\r\nelasticsearch-api (2.0.2)\r\n  multi_json\r\nelasticsearch-model (2.0.1)\r\n  activesupport (> 3)\r\n  elasticsearch (~> 2)\r\n  hashie\r\nelasticsearch-rails (2.0.1)\r\nelasticsearch-transport (2.0.2)\r\n  faraday\r\n  multi_json\r\n\r\nfaraday (0.9.2)\r\n  multipart-post (>= 1.2, < 3)\r\nfaraday_middleware (0.12.2)\r\n  faraday (>= 0.7.4, < 1.0)\r\n\r\ngoogleauth (0.5.1)\r\n  faraday (~> 0.9)\r\n\r\noauth2 (1.0.0)\r\n  faraday (>= 0.8, < 0.10)\r\n  jwt (~> 1.0)\r\n  multi_json (~> 1.3)\r\n  multi_xml (~> 0.5)\r\n  rack (~> 1.2)\r\nomniauth (1.8.1)\r\n  hashie (>= 3.4.6, < 3.6.0)\r\n  rack (>= 1.6.2, < 3)\r\nomniauth-oauth2 (1.2.0)\r\n  faraday (>= 0.8, < 0.10)\r\n  multi_json (~> 1.3)\r\n  oauth2 (~> 1.0)\r\n  omniauth (~> 1.2)\r\n\r\nsignet (0.7.3)\r\n  addressable (~> 2.3)\r\n  faraday (~> 0.9) \r\n\r\n**Also tried using the ideas from**\r\nhttps://stackoverflow.com/questions/33565919/searchkick-with-elasticsearch-returns-faradayconnectionfailed-execution-expi\r\n\r\nElasticsearch::Model.client = Elasticsearch::Client.new(log: logging, adapter: :patron, url: ENV['ELASTICSEARCH_URL'], retry_on_failure: true, transport_options: {request: {timeout: 250}})\r\n\r\n**Error detail:**\r\n\r\n[Faraday::ConnectionFailed] Cannot connect to {:scheme=>\"https\", :user=>nil, :password=>nil, :host=>\"example.com\", :path=>\"\", :port=>443, :protocol=>\"https\"} after 4 tries\r\nrake aborted!\r\nFaraday::ConnectionFailed: read function returned funny value\r\n/www/rails/app/models/concerns/searchable.rb:34:in `index_document'\r\n/www/rails/lib/drupal/drupal_changes.rb:21:in `block (2 levels) in process'\r\n/www/rails/lib/drupal/drupal_changes.rb:12:in `block in process'\r\n/www/rails/lib/drupal/drupal_changes.rb:9:in `loop'\r\n/www/rails/lib/drupal/drupal_changes.rb:9:in `process'\r\n/www/rails/lib/tasks/drupal_change_syncronizer.rake:106:in `block (2 levels) in <top (required)>'\r\n/www/rails/lib/tasks/drupal_change_syncronizer.rake:115:in `block (3 levels) in <top (required)>'\r\n/www/rails/lib/tasks/drupal_change_syncronizer.rake:13:in `if_not_syncing'\r\n/www/rails/lib/tasks/drupal_change_syncronizer.rake:112:in `block (2 levels) in <top (required)>'\r\n/opt/rubies/ruby-2.5.1/bin/bundle:30:in `block in <main>'\r\n/opt/rubies/ruby-2.5.1/bin/bundle:22:in `<main>'\r\nPatron::Error: read function returned funny value\r\n\r\nhttps://stackoverflow.com/questions/54266205/faradayconnectionfailed-read-function-returned-funny-value#54266205\r\n\r\nPlease help. Thanks in advance.","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}