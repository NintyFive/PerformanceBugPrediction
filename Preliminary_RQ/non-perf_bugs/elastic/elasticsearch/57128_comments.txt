[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/636134204","html_url":"https://github.com/elastic/elasticsearch/issues/57128#issuecomment-636134204","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57128","id":636134204,"node_id":"MDEyOklzc3VlQ29tbWVudDYzNjEzNDIwNA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-05-29T18:57:48Z","updated_at":"2020-05-29T18:57:48Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features (:Core/Features/ILM+SLM)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/641929207","html_url":"https://github.com/elastic/elasticsearch/issues/57128#issuecomment-641929207","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57128","id":641929207,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTkyOTIwNw==","user":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"created_at":"2020-06-10T11:05:02Z","updated_at":"2020-06-10T12:55:07Z","author_association":"CONTRIBUTOR","body":"@godlockin thank you for raising this.\r\nIn short - the problem you are seeing is related to java.time implementation treating `y` as year of era. **You should be using `Y` which is considered week based year.** https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html\r\nThis `java.time`  implementation detail, but it is able to format the date with incorrect `yyyy-'w'-ww` but it is not able to parse a date like that. Should be `YYYY-'w'-ww`\r\n\r\nEDIT However there is a bug in 7.6 that is currently preventing using the right format. \r\n\r\n**Consider upgrading to 7.7.. Another option would be to modify your jvm options, and add a line `9-:-Djava.locale.providers=SPI,COMPAT`.**\r\n\r\nConsequently you see different results of `_simulate` api and `ingest` - because of the java.time being able to format the date with incorrect format `yyyy-'w'-ww` but is not able to correctly parse it.\r\nYour response for `simulate` is `        \"_index\" : \"<ms_ccy_weekly_details_{2020w22||/w{yyyy'w'ww|Asia/Shanghai}}>\", ` which is just a dynamic index pattern.\r\nWhen you try to use it, you will noticed that it will resolve to incorrect index name. (again because what we ask here is to parse 2020w22 with yyyy'w'ww) https://www.elastic.co/guide/en/elasticsearch/reference/current/date-index-name-processor.html\r\n```\r\ncurl --request POST \\\r\n  --url http://localhost:9200/%3Cms_ccy_weekly_details_%7B2020w22%7C%7C%2Fw%7Byyyy%27w%27ww%7CAsia%2FShanghai%7D%7D%3E/_doc/ \\\r\n  --header 'authorization: Basic ZWxhc3RpYzpwYXNzd29yZA==' \\\r\n  --header 'content-type: application/json' \\\r\n  --data '{\r\n  }'\r\n```\r\nresults with\r\n```\r\n{\r\n  \"_index\": \"ms_ccy_weekly_details_2019w01\",\r\n  \"_type\": \"_doc\",\r\n  \"_id\": \"9CXlnXIBgpiz29aVywzS\",\r\n  \"_version\": 1,\r\n  \"result\": \"created\",\r\n  \"_shards\": {\r\n    \"total\": 2,\r\n    \"successful\": 1,\r\n    \"failed\": 0\r\n  },\r\n  \"_seq_no\": 1,\r\n  \"_primary_term\": 1\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/641929690","html_url":"https://github.com/elastic/elasticsearch/issues/57128#issuecomment-641929690","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57128","id":641929690,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTkyOTY5MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-06-10T11:06:11Z","updated_at":"2020-06-10T11:06:11Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra (:Core/Infra/Core)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/641988697","html_url":"https://github.com/elastic/elasticsearch/issues/57128#issuecomment-641988697","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57128","id":641988697,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTk4ODY5Nw==","user":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"created_at":"2020-06-10T12:57:15Z","updated_at":"2020-06-10T12:57:15Z","author_association":"CONTRIBUTOR","body":"@godlockin I have update my comment above few times. sorry for trouble, please reread.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/642374974","html_url":"https://github.com/elastic/elasticsearch/issues/57128#issuecomment-642374974","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/57128","id":642374974,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjM3NDk3NA==","user":{"login":"godlockin","id":31117750,"node_id":"MDQ6VXNlcjMxMTE3NzUw","avatar_url":"https://avatars1.githubusercontent.com/u/31117750?v=4","gravatar_id":"","url":"https://api.github.com/users/godlockin","html_url":"https://github.com/godlockin","followers_url":"https://api.github.com/users/godlockin/followers","following_url":"https://api.github.com/users/godlockin/following{/other_user}","gists_url":"https://api.github.com/users/godlockin/gists{/gist_id}","starred_url":"https://api.github.com/users/godlockin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/godlockin/subscriptions","organizations_url":"https://api.github.com/users/godlockin/orgs","repos_url":"https://api.github.com/users/godlockin/repos","events_url":"https://api.github.com/users/godlockin/events{/privacy}","received_events_url":"https://api.github.com/users/godlockin/received_events","type":"User","site_admin":false},"created_at":"2020-06-11T02:55:52Z","updated_at":"2020-06-11T02:55:52Z","author_association":"NONE","body":"@pgomulka thanks for the answer, the solution works below.\r\n```\r\nAnother option would be to modify your jvm options, and add a line 9-:-Djava.locale.providers=SPI,COMPAT\r\n```\r\n\r\nwhile I tried to change the format into [YYYY'w'ww] instead of [yyyy'w'ww], but the follow error will be raised.\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"parse_exception\",\r\n        \"reason\": \"failed to parse date field [2020w24] with format [YYYY'w'ww]: [temporal accessor [{WeekBasedYear[WeekFields[SUNDAY,1]]=2020, WeekOfWeekBasedYear[WeekFields[SUNDAY,1]]=24},ISO,Asia/Shanghai] cannot be converted to zoned date time]\"\r\n      }\r\n    ],\r\n    \"type\": \"parse_exception\",\r\n    \"reason\": \"failed to parse date field [2020w24] with format [YYYY'w'ww]: [temporal accessor [{WeekBasedYear[WeekFields[SUNDAY,1]]=2020, WeekOfWeekBasedYear[WeekFields[SUNDAY,1]]=24},ISO,Asia/Shanghai] cannot be converted to zoned date time]\",\r\n    \"caused_by\": {\r\n      \"type\": \"illegal_argument_exception\",\r\n      \"reason\": \"temporal accessor [{WeekBasedYear[WeekFields[SUNDAY,1]]=2020, WeekOfWeekBasedYear[WeekFields[SUNDAY,1]]=24},ISO,Asia/Shanghai] cannot be converted to zoned date time\"\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nAnyway, your suggestion is quite helpful, many thanks again","performed_via_github_app":null}]