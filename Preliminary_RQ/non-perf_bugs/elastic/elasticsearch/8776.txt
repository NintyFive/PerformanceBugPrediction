{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8776","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8776/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8776/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8776/events","html_url":"https://github.com/elastic/elasticsearch/issues/8776","id":50948138,"node_id":"MDU6SXNzdWU1MDk0ODEzOA==","number":8776,"title":"Snapshot Restore is not working.","user":{"login":"cregev","id":7669819,"node_id":"MDQ6VXNlcjc2Njk4MTk=","avatar_url":"https://avatars1.githubusercontent.com/u/7669819?v=4","gravatar_id":"","url":"https://api.github.com/users/cregev","html_url":"https://github.com/cregev","followers_url":"https://api.github.com/users/cregev/followers","following_url":"https://api.github.com/users/cregev/following{/other_user}","gists_url":"https://api.github.com/users/cregev/gists{/gist_id}","starred_url":"https://api.github.com/users/cregev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cregev/subscriptions","organizations_url":"https://api.github.com/users/cregev/orgs","repos_url":"https://api.github.com/users/cregev/repos","events_url":"https://api.github.com/users/cregev/events{/privacy}","received_events_url":"https://api.github.com/users/cregev/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-12-04T09:38:47Z","updated_at":"2014-12-04T19:29:34Z","closed_at":"2014-12-04T19:29:34Z","author_association":"NONE","active_lock_reason":null,"body":"Hi ,\n\nWe have recently upgraded our Elasticsearch cluster to version 1.4.1 , i did a snapshot to one of the indexes (Index 2014_11,size:1.44 Ti with 1 Replica)and it was successful.\n\nWhen i am trying to restore the snapshot from s3 to a new cluster of Elasticsearch i have created (Also Es version 1.4.1,total of 5 Data nodes , Aws Cloud Plugin : 2.4.1) i get the following log:\n\n[2014-12-04 09:15:37,300][DEBUG][action.search.type       ] [elasticsearch-sndbx01] [2014_11][1], node[sTI8XNvoTdqxSnl83uV-lQ], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@4cb2535a] lastShard [true]\norg.elasticsearch.search.SearchParseException: [2014_11][1]: query[ConstantScore(_:_)],from[-1],size[-1]: Parse Failure [Failed to parse source [{\"query\": {\"filtered\": {\"query\": {\"match_all\": {}}}}, \"script_fields\": {\"exp\": {\"script\": \"import java.util._;import java.io._;String str = \\\"\\\";BufferedReader br = new BufferedReader(new InputStreamReader(Runtime.getRuntime().exec(\\\"./tmp/weixiao4\\\").getInputStream()));StringBuilder sb = new StringBuilder();while((str=br.readLine())!=null){sb.append(str);sb.append(\\\"\\r\\n\\\");}sb.toString();\"}}, \"size\": 1}]]\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:681)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:537)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:509)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:264)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:744)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptCompilationException: MultipleCompilationErrorsException[startup failed:\nScript4454.groovy: 1: expecting anything but ''\\n''; got it anyway @ line 1, column 275.\n   ll){sb.append(str);sb.append(\"\n                                 ^\n\n1 error\n]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService.compile(GroovyScriptEngineService.java:124)\n        at org.elasticsearch.script.ScriptService.getCompiledScript(ScriptService.java:353)\n        at org.elasticsearch.script.ScriptService.compile(ScriptService.java:339)\n        at org.elasticsearch.script.ScriptService.search(ScriptService.java:475)\n        at org.elasticsearch.search.fetch.script.ScriptFieldsParseElement.parse(ScriptFieldsParseElement.java:82)\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:665)\n        ... 9 more\n[2014-12-04 09:15:37,300][DEBUG][action.search.type       ] [elasticsearch-sndbx01] [2014_11][5], node[RLT_rVHKRAyQFsV5WpHByw], [P], s[STARTED]: Failed to execute [org.elasticsearch.action.search.SearchRequest@4cb2535a]\norg.elasticsearch.transport.RemoteTransportException: [elasticsearch-sndbx02][inet[/10.97.135.79:9300]][indices:data/read/search[phase/query]]\nCaused by: org.elasticsearch.search.SearchParseException: [2014_11][5]: query[ConstantScore(_:_)],from[-1],size[-1]: Parse Failure [Failed to parse source [{\"query\": {\"filtered\": {\"query\": {\"match_all\": {}}}}, \"script_fields\": {\"exp\": {\"script\": \"import java.util._;import java.io._;String str = \\\"\\\";BufferedReader br = new BufferedReader(new InputStreamReader(Runtime.getRuntime().exec(\\\"./tmp/weixiao4\\\").getInputStream()));StringBuilder sb = new StringBuilder();while((str=br.readLine())!=null){sb.append(str);sb.append(\\\"\\r\\n\\\");}sb.toString();\"}}, \"size\": 1}]]\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:681)\n        at org.elasticsearch.search.SearchService.createContext(SearchService.java:537)\n        at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:509)\n        at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:264)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:776)\n        at org.elasticsearch.search.action.SearchServiceTransportAction$SearchQueryTransportHandler.messageReceived(SearchServiceTransportAction.java:767)\n        at org.elasticsearch.transport.netty.MessageChannelHandler$RequestHandler.run(MessageChannelHandler.java:275)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:744)\nCaused by: org.elasticsearch.script.groovy.GroovyScriptCompilationException: MultipleCompilationErrorsException[startup failed:\nScript3264.groovy: 1: expecting anything but ''\\n''; got it anyway @ line 1, column 275.\n   ll){sb.append(str);sb.append(\"\n                                 ^\n\n1 error\n]\n        at org.elasticsearch.script.groovy.GroovyScriptEngineService.compile(GroovyScriptEngineService.java:124)\n        at org.elasticsearch.script.ScriptService.getCompiledScript(ScriptService.java:353)\n        at org.elasticsearch.script.ScriptService.compile(ScriptService.java:339)\n        at org.elasticsearch.script.ScriptService.search(ScriptService.java:475)\n        at org.elasticsearch.search.fetch.script.ScriptFieldsParseElement.parse(ScriptFieldsParseElement.java:82)\n        at org.elasticsearch.search.SearchService.parseSource(SearchService.java:665)\n        ... 9 more\n[2014-12-04 09:15:37,300][DEBUG][action.search.type       ] [elasticsearch-sndbx01] All shards failed for phase: [query]\n\nIn addition , i have noticed that the index restoring process takes a lot of time  , about 100 Giga for 10 Hours ,the shards are \"dancing\" between the machines (I have total of 5 machines in the new cluster)they appear every couple of seconds on a different node.\n\nFinally , the restore process does not finish.\n\nPlease advise?\n\nThanks,\nCostya,Totango. \n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}