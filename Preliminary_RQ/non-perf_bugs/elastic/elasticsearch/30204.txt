{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30204","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30204/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30204/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30204/events","html_url":"https://github.com/elastic/elasticsearch/issues/30204","id":318396745,"node_id":"MDU6SXNzdWUzMTgzOTY3NDU=","number":30204,"title":"when using update api to elasticsearch, elasticsearch primary shard and replication shard are both failed","user":{"login":"highmoutain","id":16812890,"node_id":"MDQ6VXNlcjE2ODEyODkw","avatar_url":"https://avatars1.githubusercontent.com/u/16812890?v=4","gravatar_id":"","url":"https://api.github.com/users/highmoutain","html_url":"https://github.com/highmoutain","followers_url":"https://api.github.com/users/highmoutain/followers","following_url":"https://api.github.com/users/highmoutain/following{/other_user}","gists_url":"https://api.github.com/users/highmoutain/gists{/gist_id}","starred_url":"https://api.github.com/users/highmoutain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/highmoutain/subscriptions","organizations_url":"https://api.github.com/users/highmoutain/orgs","repos_url":"https://api.github.com/users/highmoutain/repos","events_url":"https://api.github.com/users/highmoutain/events{/privacy}","received_events_url":"https://api.github.com/users/highmoutain/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2018-04-27T12:47:31Z","updated_at":"2019-03-20T01:45:45Z","closed_at":"2019-03-12T11:04:50Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):  5.1.1\r\n\r\n**Plugins installed**: []  no\r\n\r\n**JVM version** (`java -version`): 1.8.0_77\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): CentOS Linux release 7.2.1511 (Core) \r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nwhen using update api ,highly concurrency , primary shard and replication shard all failed.\r\nAnd this happened many times in 2 machines. So I think tihs is a bug.\r\n\r\n\r\n\r\n\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n[2018-04-27T12:02:22,797][WARN ][o.e.c.a.s.ShardStateAction] [172.20.3.2] [analytics_profile_12014][7] received shard failed for shard id [[analytics_profile_12014][7]], allocation id [xIEoF3JaTLWQz6X2KxMWRA], primary term [0], message [shard failure, reason [refresh failed]], failure [EOFException[read past EOF: MMapIndexInput(path=\"/mnt/esdata2/nodes/0/indices/fzJHAFdQQQO5zPL70D2b6g/7/index/_fqb1.cfe\")]]\r\njava.io.EOFException: read past EOF: MMapIndexInput(path=\"/mnt/esdata2/nodes/0/indices/fzJHAFdQQQO5zPL70D2b6g/7/index/_fqb1.cfe\")\r\n        Suppressed: org.apache.lucene.index.CorruptIndexException: checksum status indeterminate: remaining=0, please run checkindex for more details (resource=BufferedChecksumIndexInput(MMapIndexInput(path=\"/mnt/esdata2/nodes/0/indices/fzJHAFdQQQO5zPL70D2b6g/7/index/_fqb1.cfe\")))\r\norg.elasticsearch.action.FailedNodeException: Failed node [BbfFMNRpRvW5p8LDs3rquQ]\r\n        at org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction$1.handleException(TransportNodesAction.java:219) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.TransportService$ContextRestoreResponseHandler.handleException(TransportService.java:984) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.TcpTransport.lambda$handleException$17(TcpTransport.java:1314) ~[elasticsearch-5.1.1.jar:5.1.1]\r\n        at org.elasticsearch.transport.TcpTransport.handleException(TcpTransport.java:1312) [elasticsearch-5.1.1.jar:5.1.1]\r\nCaused by: org.elasticsearch.transport.RemoteTransportException: [172.20.3.2_1][172.20.3.2:9301][internal:cluster/nodes/indices/shard/store[n]]\r\nCaused by: org.elasticsearch.ElasticsearchException: Failed to list store metadata for shard [[analytics_action_12014_201804][15]]\r\nCaused by: org.apache.lucene.index.CorruptIndexException: failed engine (reason: [corrupt file (source: [index])]) (resource=preexisting_corruption)\r\nCaused by: java.io.IOException: failed engine (reason: [corrupt file (source: [index])])\r\nCaused by: org.apache.lucene.index.CorruptIndexException: compound sub-files must have a valid codec header and footer: file is too small (0 bytes) (resource=BufferedChecksumIndexInput(MMapIndexInput(path=\"/mnt/esdata1/nodes/0/indices/cBECbko7SMKP3oXsTGi_kg/15/index/_2kqi.fdx\")))\r\n[2018-04-27T12:02:22,800][WARN ][o.e.c.a.s.ShardStateAction] [172.20.3.2] [analytics_profile_12014][18] received shard failed for shard id [[analytics_profile_12014][18]], allocation id [7TieFxLRRZ-28uOsPFr1yQ], primary term [0], message [shard failure, reason [refresh failed]], failure [EOFException[read past EOF: MMapIndexInput(path=\"/mnt/esdata2/nodes/0/indices/fzJHAFdQQQO5zPL70D2b6g/18/index/_fhe2.cfe\")]]\r\njava.io.EOFException: read past EOF: MMapIndexInput(path=\"/mnt/esdata2/nodes/0/indices/fzJHAFdQQQO5zPL70D2b6g/18/index/_fhe2.cfe\")\r\n        Suppressed: org.apache.lucene.index.CorruptIndexException: checksum status indeterminate: remaining=0, please run checkindex for more details (resource=BufferedChecksumIndexInput(MMapIndexInput(path=\"/mnt/esdata2/nodes/0/indices/fzJHAFdQQQO5zPL70D2b6g/18/index/_fhe2.cfe\")))\r\n\r\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}