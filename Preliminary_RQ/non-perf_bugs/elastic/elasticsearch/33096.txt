{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33096","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33096/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33096/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33096/events","html_url":"https://github.com/elastic/elasticsearch/issues/33096","id":353404329,"node_id":"MDU6SXNzdWUzNTM0MDQzMjk=","number":33096,"title":"Pings suddenly fail several times a day","user":{"login":"eranhirs","id":3372820,"node_id":"MDQ6VXNlcjMzNzI4MjA=","avatar_url":"https://avatars1.githubusercontent.com/u/3372820?v=4","gravatar_id":"","url":"https://api.github.com/users/eranhirs","html_url":"https://github.com/eranhirs","followers_url":"https://api.github.com/users/eranhirs/followers","following_url":"https://api.github.com/users/eranhirs/following{/other_user}","gists_url":"https://api.github.com/users/eranhirs/gists{/gist_id}","starred_url":"https://api.github.com/users/eranhirs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eranhirs/subscriptions","organizations_url":"https://api.github.com/users/eranhirs/orgs","repos_url":"https://api.github.com/users/eranhirs/repos","events_url":"https://api.github.com/users/eranhirs/events{/privacy}","received_events_url":"https://api.github.com/users/eranhirs/received_events","type":"User","site_admin":false},"labels":[{"id":881394071,"node_id":"MDU6TGFiZWw4ODEzOTQwNzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Cluster%20Coordination","name":":Distributed/Cluster Coordination","color":"0e8a16","default":false,"description":"Cluster formation and cluster state publication, including cluster membership and fault detection."},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-08-23T14:21:11Z","updated_at":"2018-08-30T14:33:02Z","closed_at":"2018-08-23T18:23:32Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version**: 5.5.1\r\n\r\n**Plugins installed**: [google cloud storage]\r\n\r\n**JVM version**:\r\n\r\n**OS version** Ubuntu 16.04.1, using elasticsearch docker image\r\n\r\n**Description of the problem including expected versus actual behavior**:  \r\nWe just moved our cluster from AWS EC2 to Google Compute, and a few times a day we have nodes disconnecting from the cluster and reconnecting a few seconds after.\r\nWe also changed from installing manually elasticsearch to using docker.\r\n\r\nIt starts with the error\r\n```\r\nmaster left (reason = failed to ping, tried [3] times, each with maximum [30s] timeout), current nodes: nodes:\r\n```\r\nChecking the logs it doesn't seem like the server is restarting.\r\nThis is weird that for 180 seconds it couldn't ping, because only 3 seconds after the disconnect it already reconnects.\r\n\r\nIn these 3 seconds, the *master* node receives the message\r\n`mark copy as stale`\r\n\r\nAfter a few seconds they are back online, but when they are back online I get the error\r\n```\r\nobtaining shard lock timed out after 5000ms\r\n```\r\n\r\n\r\n**We already tried**\r\n1. Check network issues with - `nohup ping -i 5 -t google.com  &` - no network issues even once\r\n2. Change `sysctl` - `keepalive` settings (based on https://blog.trifork.com/2015/04/08/dealing-with-nodenotavailableexceptions-in-elasticsearch/)\r\n3. Increasing the number of pings elasticsearch sends to 10\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. 5 nodes in the cluster, all configured both as master and data, all are based on docker image, overall 2TB of data\r\n 2. Wait for a few days\r\n\r\n**Provide logs (if relevant)**:\r\nProvided in the description of the issue.\r\n","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}