{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/35874","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35874/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35874/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/35874/events","html_url":"https://github.com/elastic/elasticsearch/issues/35874","id":383943553,"node_id":"MDU6SXNzdWUzODM5NDM1NTM=","number":35874,"title":"[CI] UpgradeClusterClientYamlTestSuiteIT failure","user":{"login":"bizybot","id":902768,"node_id":"MDQ6VXNlcjkwMjc2OA==","avatar_url":"https://avatars2.githubusercontent.com/u/902768?v=4","gravatar_id":"","url":"https://api.github.com/users/bizybot","html_url":"https://github.com/bizybot","followers_url":"https://api.github.com/users/bizybot/followers","following_url":"https://api.github.com/users/bizybot/following{/other_user}","gists_url":"https://api.github.com/users/bizybot/gists{/gist_id}","starred_url":"https://api.github.com/users/bizybot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bizybot/subscriptions","organizations_url":"https://api.github.com/users/bizybot/orgs","repos_url":"https://api.github.com/users/bizybot/repos","events_url":"https://api.github.com/users/bizybot/events{/privacy}","received_events_url":"https://api.github.com/users/bizybot/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"assignees":[{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false}],"milestone":null,"comments":9,"created_at":"2018-11-23T23:59:42Z","updated_at":"2018-11-26T13:21:47Z","closed_at":"2018-11-26T12:34:37Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Build Link: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/296/console\r\n\r\nReproduces locally with command\r\n```\r\n./gradlew :qa:rolling-upgrade:v6.6.0#oldClusterTestRunner \\\r\n -Dtests.seed=C8ADCC320FE24AF4 \\\r\n -Dtests.class=org.elasticsearch.upgrades.UpgradeClusterClientYamlTestSuiteIT \\\r\n -Dtests.method=\"test {p0=old_cluster/10_basic/Create things in the cluster state that we'll validate are there after the upgrade}\" \\\r\n -Dtests.security.manager=true \\\r\n -Dtests.locale=es-MX \\\r\n -Dtests.timezone=Zulu \\\r\n -Dcompiler.java=11 \\\r\n -Druntime.java=8 \\\r\n -Dtests.rest.suite=old_cluster\r\n```\r\n\r\n```\r\n  1> [2018-11-23T22:28:44,531][INFO ][o.e.u.UpgradeClusterClientYamlTestSuiteIT] [test] Stash dump on test failure [{\r\n  1>   \"stash\" : {\r\n  1>     \"body\" : {\r\n  1>       \"error\" : {\r\n  1>         \"root_cause\" : [\r\n  1>           {\r\n  1>             \"type\" : \"repository_verification_exception\",\r\n  1>             \"reason\" : \"[my_repo] path  is not accessible on master node\",\r\n  1>             \"stack_trace\" : \"RepositoryVerificationException[[my_repo] path  is not accessible on master node]; nested: IOException[snapshot.test];\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.startVerification(BlobStoreRepository.java:647)\r\n  1>    at org.elasticsearch.repositories.RepositoriesService.lambda$verifyRepository$2(RepositoriesService.java:221)\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:627)\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n  1>    at java.lang.Thread.run(Thread.java:834)\r\n  1> Caused by: java.io.IOException: snapshot.test\r\n  1>    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:220)\r\n  1>    at java.net.Socket.connect(Socket.java:591)\r\n  1>    at java.net.Socket.connect(Socket.java:540)\r\n  1>    at sun.net.NetworkClient.doConnect(NetworkClient.java:182)\r\n  1>    at sun.net.www.http.HttpClient.openServer(HttpClient.java:474)\r\n  1>    at sun.net.www.http.HttpClient.openServer(HttpClient.java:569)\r\n  1>    at sun.net.www.http.HttpClient.<init>(HttpClient.java:242)\r\n  1>    at sun.net.www.http.HttpClient.New(HttpClient.java:341)\r\n  1>    at sun.net.www.http.HttpClient.New(HttpClient.java:362)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:1242)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.plainConnect0(HttpURLConnection.java:1181)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:1075)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:1009)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1581)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1509)\r\n  1>    at java.net.URL.openStream(URL.java:1117)\r\n  1>    at java.security.AccessController.doPrivileged(Native Method)\r\n  1>    at org.elasticsearch.common.blobstore.url.URLBlobContainer.getInputStream(URLBlobContainer.java:118)\r\n  1>    at org.elasticsearch.common.blobstore.url.URLBlobContainer.readBlob(URLBlobContainer.java:104)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.readSnapshotIndexLatestBlob(BlobStoreRepository.java:816)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.latestIndexBlobId(BlobStoreRepository.java:807)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.startVerification(BlobStoreRepository.java:633)\r\n  1>    ... 5 more\r\n  1> \"\r\n  1>           }\r\n  1>         ],\r\n  1>         \"type\" : \"repository_verification_exception\",\r\n  1>         \"reason\" : \"[my_repo] path  is not accessible on master node\",\r\n  1>         \"caused_by\" : {\r\n  1>           \"type\" : \"i_o_exception\",\r\n  1>           \"reason\" : \"snapshot.test\",\r\n1>           \"stack_trace\" : \"java.io.IOException: snapshot.test\r\n  1>    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:220)\r\n  1>    at java.net.Socket.connect(Socket.java:591)\r\n  1>    at java.net.Socket.connect(Socket.java:540)\r\n  1>    at sun.net.NetworkClient.doConnect(NetworkClient.java:182)\r\n  1>    at sun.net.www.http.HttpClient.openServer(HttpClient.java:474)\r\n  1>    at sun.net.www.http.HttpClient.openServer(HttpClient.java:569)\r\n  1>    at sun.net.www.http.HttpClient.<init>(HttpClient.java:242)\r\n  1>    at sun.net.www.http.HttpClient.New(HttpClient.java:341)\r\n  1>    at sun.net.www.http.HttpClient.New(HttpClient.java:362)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:1242)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.plainConnect0(HttpURLConnection.java:1181)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:1075)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:1009)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1581)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1509)\r\n  1>    at java.net.URL.openStream(URL.java:1117)\r\n  1>    at java.security.AccessController.doPrivileged(Native Method)\r\n  1>    at org.elasticsearch.common.blobstore.url.URLBlobContainer.getInputStream(URLBlobContainer.java:118)\r\n  1>    at org.elasticsearch.common.blobstore.url.URLBlobContainer.readBlob(URLBlobContainer.java:104)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.readSnapshotIndexLatestBlob(BlobStoreRepository.java:816)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.latestIndexBlobId(BlobStoreRepository.java:807)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.startVerification(BlobStoreRepository.java:633)\r\n  1>    at org.elasticsearch.repositories.RepositoriesService.lambda$verifyRepository$2(RepositoriesService.java:221)\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:627)\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n  1>    at java.lang.Thread.run(Thread.java:834)\r\n  1> \"\r\n  1>         },\r\n  1>         \"stack_trace\" : \"RepositoryVerificationException[[my_repo] path  is not accessible on master node]; nested: IOException[snapshot.test];\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.startVerification(BlobStoreRepository.java:647)\r\n  1>    at org.elasticsearch.repositories.RepositoriesService.lambda$verifyRepository$2(RepositoriesService.java:221)\r\n  1>    at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:627)\r\n  1>    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n  1>    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n  1>    at java.lang.Thread.run(Thread.java:834)\r\n  1> Caused by: java.io.IOException: snapshot.test\r\n  1>    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:220)\r\n  1>    at java.net.Socket.connect(Socket.java:591)\r\n  1>    at java.net.Socket.connect(Socket.java:540)\r\n  1>    at sun.net.NetworkClient.doConnect(NetworkClient.java:182)\r\n  1>    at sun.net.www.http.HttpClient.openServer(HttpClient.java:474)\r\n  1>    at sun.net.www.http.HttpClient.openServer(HttpClient.java:569)\r\n  1>    at sun.net.www.http.HttpClient.<init>(HttpClient.java:242)\r\n  1>    at sun.net.www.http.HttpClient.New(HttpClient.java:341)\r\n  1>    at sun.net.www.http.HttpClient.New(HttpClient.java:362)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getNewHttpClient(HttpURLConnection.java:1242)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.plainConnect0(HttpURLConnection.java:1181)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:1075)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.connect(HttpURLConnection.java:1009)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1581)\r\n  1>    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1509)\r\n  1>    at java.net.URL.openStream(URL.java:1117)\r\n  1>    at java.security.AccessController.doPrivileged(Native Method)\r\n  1>    at org.elasticsearch.common.blobstore.url.URLBlobContainer.getInputStream(URLBlobContainer.java:118)\r\n  1>    at org.elasticsearch.common.blobstore.url.URLBlobContainer.readBlob(URLBlobContainer.java:104)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.readSnapshotIndexLatestBlob(BlobStoreRepository.java:816)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.latestIndexBlobId(BlobStoreRepository.java:807)\r\n  1>    at org.elasticsearch.repositories.blobstore.BlobStoreRepository.startVerification(BlobStoreRepository.java:633)\r\n  1>    ... 5 more\r\n  1> \"\r\n  1>       },\r\n  1>       \"status\" : 500\r\n  1>     }\r\n  1>   }\r\n  1> }]\r\n1> [2018-11-23T22:28:44,580][INFO ][o.e.u.UpgradeClusterClientYamlTestSuiteIT] [test] [p0=old_cluster/10_basic/Create things in the cluster state that we'll validate are there after the upgrade]\r\n```\r\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}