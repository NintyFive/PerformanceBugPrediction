{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/63888","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63888/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63888/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/63888/events","html_url":"https://github.com/elastic/elasticsearch/issues/63888","id":724750138,"node_id":"MDU6SXNzdWU3MjQ3NTAxMzg=","number":63888,"title":"[ML] Notifications index mappings don't have ignore_above on message.raw multi-field","user":{"login":"droberts195","id":7405510,"node_id":"MDQ6VXNlcjc0MDU1MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7405510?v=4","gravatar_id":"","url":"https://api.github.com/users/droberts195","html_url":"https://github.com/droberts195","followers_url":"https://api.github.com/users/droberts195/followers","following_url":"https://api.github.com/users/droberts195/following{/other_user}","gists_url":"https://api.github.com/users/droberts195/gists{/gist_id}","starred_url":"https://api.github.com/users/droberts195/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/droberts195/subscriptions","organizations_url":"https://api.github.com/users/droberts195/orgs","repos_url":"https://api.github.com/users/droberts195/repos","events_url":"https://api.github.com/users/droberts195/events{/privacy}","received_events_url":"https://api.github.com/users/droberts195/received_events","type":"User","site_admin":false},"labels":[{"id":912833043,"node_id":"MDU6TGFiZWw5MTI4MzMwNDM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml","name":":ml","color":"0e8a16","default":false,"description":"Machine learning"},{"id":1272783040,"node_id":"MDU6TGFiZWwxMjcyNzgzMDQw","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:ml/Transform","name":":ml/Transform","color":"0e8a16","default":false,"description":"Transform"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-10-19T15:48:54Z","updated_at":"2020-11-18T14:09:29Z","closed_at":"2020-11-18T14:09:29Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"The mappings for the `.ml-notifications*` and `.transform-notifications*` indices contain this:\r\n\r\n```\r\n        \"message\": {\r\n          \"type\": \"text\",\r\n          \"fields\": {\r\n            \"raw\": {\r\n              \"type\": \"keyword\"\r\n            }\r\n          }\r\n        },\r\n```\r\n\r\nBecause there is no `ignore_above` on the `keyword` multi-field, we are vulnerable to errors like `Document contains at least one immense term in field=\"message.raw\" (whose UTF8 encoding is longer than the max length 32766), all of which were skipped. Please correct the analyzer to not produce such terms.`\r\n\r\nAccording to the [docs](https://www.elastic.co/guide/en/elasticsearch/reference/current/ignore-above.html):\r\n\r\n> The `ignore_above` setting can be updated on existing fields using the [PUT mapping API](https://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html).\r\n\r\nSo in this case we might be able to correct the mappings in a minor release rather than having to wait for the next major.\r\n\r\nWe can certainly update our notification index template mappings so that future notifications indices do not suffer from this problem.  UPDATE this was implemented in #64455","closed_by":{"login":"davidkyle","id":2353640,"node_id":"MDQ6VXNlcjIzNTM2NDA=","avatar_url":"https://avatars1.githubusercontent.com/u/2353640?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkyle","html_url":"https://github.com/davidkyle","followers_url":"https://api.github.com/users/davidkyle/followers","following_url":"https://api.github.com/users/davidkyle/following{/other_user}","gists_url":"https://api.github.com/users/davidkyle/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkyle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkyle/subscriptions","organizations_url":"https://api.github.com/users/davidkyle/orgs","repos_url":"https://api.github.com/users/davidkyle/repos","events_url":"https://api.github.com/users/davidkyle/events{/privacy}","received_events_url":"https://api.github.com/users/davidkyle/received_events","type":"User","site_admin":false},"performed_via_github_app":null}