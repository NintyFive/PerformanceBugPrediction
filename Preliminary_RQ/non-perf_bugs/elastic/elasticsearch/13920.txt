{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13920","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13920/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13920/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13920/events","html_url":"https://github.com/elastic/elasticsearch/issues/13920","id":109660394,"node_id":"MDU6SXNzdWUxMDk2NjAzOTQ=","number":13920,"title":"function_score query bug using boolean filter with script_score function","user":{"login":"JnBrymn-EB","id":11304245,"node_id":"MDQ6VXNlcjExMzA0MjQ1","avatar_url":"https://avatars1.githubusercontent.com/u/11304245?v=4","gravatar_id":"","url":"https://api.github.com/users/JnBrymn-EB","html_url":"https://github.com/JnBrymn-EB","followers_url":"https://api.github.com/users/JnBrymn-EB/followers","following_url":"https://api.github.com/users/JnBrymn-EB/following{/other_user}","gists_url":"https://api.github.com/users/JnBrymn-EB/gists{/gist_id}","starred_url":"https://api.github.com/users/JnBrymn-EB/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JnBrymn-EB/subscriptions","organizations_url":"https://api.github.com/users/JnBrymn-EB/orgs","repos_url":"https://api.github.com/users/JnBrymn-EB/repos","events_url":"https://api.github.com/users/JnBrymn-EB/events{/privacy}","received_events_url":"https://api.github.com/users/JnBrymn-EB/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-10-04T03:21:37Z","updated_at":"2015-10-05T15:18:25Z","closed_at":"2015-10-05T09:59:53Z","author_association":"NONE","active_lock_reason":null,"body":"(elasticsearch 2.0.0-beta2)\nRunning this, what would you expect the result to be?\n\n``` python\ntest='test'\ndoc='doc'\nbody = {\n    'id': 1,\n    'shiny': True,\n}\nes.index(test,doc,body)\nbody = {\n    'id': 2,\n    'shiny': True,\n    'happy': True,\n}\nes.index(test,doc,body)\nbody = {\n    'query': {\n        'function_score': {\n            'functions': [{\n                'filter': {\n                    'bool': {\n                        'should': {\n                            'term': { 'shiny': True},\n                            'term': { 'happy': True},\n                        },\n                    }\n                },\n                'script_score' : {\n                    'script': \"\"\"\n                        3*doc['shiny'].value +\n                        2*doc['happy'].value\n                        \"\"\"\n                }\n            }\n        ]}\n    }\n}\n```\n\nDoc 1 should have a score of 5 and doc 2 should have a score of 3. However instead doc 1 has a score of 5 and doc 2 has a score of 1 indicating that is was filtered out. So it seems like the `should` is acting like a `must`.\n\nHowever, if I replace the `bool` filter with this:\n\n```\n'query_string': {\n    'query': 'shiny:* happy:*'\n}\n```\n\nThen I get the expected results.\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}