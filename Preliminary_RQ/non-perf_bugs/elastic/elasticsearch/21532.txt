{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21532","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21532/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21532/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21532/events","html_url":"https://github.com/elastic/elasticsearch/issues/21532","id":189093905,"node_id":"MDU6SXNzdWUxODkwOTM5MDU=","number":21532,"title":"Master not discovered exception on elasticsearch 5.0.0","user":{"login":"girishramnani","id":6551988,"node_id":"MDQ6VXNlcjY1NTE5ODg=","avatar_url":"https://avatars2.githubusercontent.com/u/6551988?v=4","gravatar_id":"","url":"https://api.github.com/users/girishramnani","html_url":"https://github.com/girishramnani","followers_url":"https://api.github.com/users/girishramnani/followers","following_url":"https://api.github.com/users/girishramnani/following{/other_user}","gists_url":"https://api.github.com/users/girishramnani/gists{/gist_id}","starred_url":"https://api.github.com/users/girishramnani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/girishramnani/subscriptions","organizations_url":"https://api.github.com/users/girishramnani/orgs","repos_url":"https://api.github.com/users/girishramnani/repos","events_url":"https://api.github.com/users/girishramnani/events{/privacy}","received_events_url":"https://api.github.com/users/girishramnani/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2016-11-14T11:52:34Z","updated_at":"2020-11-11T21:57:47Z","closed_at":"2016-11-24T15:39:29Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\r\nI am trying to create a 3 node elasticsearch 5.0 cluster on digital ocean. I am using systemd to run elasticsearch and each elasticsearch instance runs inside a docker container ( the official elasticsearch container ). This is the elasticsearch config file \r\n\r\nhttps://gist.github.com/girishramnani/f5f9a425e7ad986ce746117da62dd831\r\n\r\nAnd this is the `ExecStart` portion of the unit file\r\n\r\n```\r\nExecStart=/bin/sh -c '/usr/bin/docker run -v /home/core/esdata:/usr/share/elasticsearch/data --rm --name elasticsearch-${instance_index}  \\            \r\n             -e ES_HOSTS=\"elasticsearch-3,elasticsearch-2,elasticsearch-1,\" \\\r\n             -e MIN_MASTER_NODES=\"2\" \\\r\n             -e NUM_REPLICAS=\"1\" \\\r\n             -p 9200:9200 -p 9300:9300 elasticsearch:5 \\\r\n            /bin/sh -c \\'chown -R elasticsearch:elasticsearch /usr/share/elasticsearch/data ; \\\r\n            gosu elasticsearch elasticsearch \\''\r\n\r\n```\r\nAfter all the 3 nodes start, none of them are able to connect and a **master not discovered** error shows on health check. This is the error trace.\r\n\r\nhttps://gist.github.com/girishramnani/0dabde87ffada26df7f658ff34f09ba1\r\n\r\nThe `ES_HOSTS` variable is set in the env as `elasticsearch-3,elasticsearch-2,elasticsearch-1,`.\r\nThis is the complete env inside the elasticsearch containers.\r\n\r\n```\r\n\r\nHOSTNAME=elasticsearch_1\r\nES_HOSTS=elasticsearch-3,elasticsearch-2,elasticsearch-1,\r\nNUM_REPLICAS=1\r\nCA_CERTIFICATES_JAVA_VERSION=20140324\r\nPATH=/usr/share/elasticsearch/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\r\nWEAVE_CIDR=192.168.16.1/24\r\nPWD=/usr/share/elasticsearch\r\nJAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64/jre\r\nLANG=C.UTF-8\r\nJAVA_VERSION=8u111\r\nSHLVL=1\r\nHOME=/root\r\nJAVA_DEBIAN_VERSION=8u111-b14-2~bpo8+1\r\nMIN_MASTER_NODES=2\r\nELASTICSEARCH_VERSION=5.0.0\r\nGOSU_VERSION=1.7\r\n_=/usr/bin/env\r\n\r\n```\r\n\r\nand from inside the container I can reach the other elasticsearch instances i.e. from elasticsearch-1 i can reach elasticsearch-2\r\n\r\n```\r\n\r\ncurl http://elasticsearch-2:9200                                                                  \r\n{\r\n  \"name\" : \"xGIB2_i\",\r\n  \"cluster_name\" : \"elasticsearch\",\r\n  \"cluster_uuid\" : \"_na_\",\r\n  \"version\" : {\r\n    \"number\" : \"5.0.0\",\r\n    \"build_hash\" : \"253032b\",\r\n    \"build_date\" : \"2016-10-26T05:11:34.737Z\",\r\n    \"build_snapshot\" : false,\r\n    \"lucene_version\" : \"6.2.0\"\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}\r\n\r\n```\r\n### OS specification \r\n\r\nOS - CoreOS\r\nversion - stable (1185.3)","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}