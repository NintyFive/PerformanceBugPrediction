{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9704","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9704/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9704/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9704/events","html_url":"https://github.com/elastic/elasticsearch/issues/9704","id":57729488,"node_id":"MDU6SXNzdWU1NzcyOTQ4OA==","number":9704,"title":"Index Recovery Failed after upgrade to 1.4.3","user":{"login":"HenrikOssipoff","id":4737224,"node_id":"MDQ6VXNlcjQ3MzcyMjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/4737224?v=4","gravatar_id":"","url":"https://api.github.com/users/HenrikOssipoff","html_url":"https://github.com/HenrikOssipoff","followers_url":"https://api.github.com/users/HenrikOssipoff/followers","following_url":"https://api.github.com/users/HenrikOssipoff/following{/other_user}","gists_url":"https://api.github.com/users/HenrikOssipoff/gists{/gist_id}","starred_url":"https://api.github.com/users/HenrikOssipoff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HenrikOssipoff/subscriptions","organizations_url":"https://api.github.com/users/HenrikOssipoff/orgs","repos_url":"https://api.github.com/users/HenrikOssipoff/repos","events_url":"https://api.github.com/users/HenrikOssipoff/events{/privacy}","received_events_url":"https://api.github.com/users/HenrikOssipoff/received_events","type":"User","site_admin":false},"labels":[{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-02-15T12:57:32Z","updated_at":"2015-07-31T10:02:18Z","closed_at":"2015-07-31T10:02:18Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Today we attempted to do an upgrade of our Elasticsearch cluster from 1.3.0 to 1.4.3. After having upgraded the first node, it joins the cluster just fine, but we cannot get it to initialize shards. Our logs are spammed with the following error per index:\n\n``` bash\norg.elasticsearch.indices.recovery.RecoveryFailedException: [pim_v3][0]: Recovery failed from [elasticsearch02][K5GW34H-TMO8_sMIB5P77g][elasticsearch02][inet[/172.31.7.56:9300]] into [elasticsearch01][nSy51hptRKSMMQqhPPvGVg][elasticsearch01][inet[172.31.7.55/172.31.7.55:9300]]\n        at org.elasticsearch.indices.recovery.RecoveryTarget.doRecovery(RecoveryTarget.java:308)\n        at org.elasticsearch.indices.recovery.RecoveryTarget.access$200(RecoveryTarget.java:65)\n        at org.elasticsearch.indices.recovery.RecoveryTarget$2.run(RecoveryTarget.java:177)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.transport.RemoteTransportException: [elasticsearch02][inet[/172.31.7.56:9300]][index/shard/recovery/startRecovery]\nCaused by: java.lang.IllegalArgumentException: No enum constant org.apache.lucene.util.Version.4.9.0\n        at java.lang.Enum.valueOf(Enum.java:236)\n        at org.apache.lucene.util.Version.valueOf(Version.java:32)\n        at org.apache.lucene.util.Version.parseLeniently(Version.java:250)\n        at org.elasticsearch.index.store.StoreFileMetaData.readFrom(StoreFileMetaData.java:105)\n        at org.elasticsearch.index.store.StoreFileMetaData.readStoreFileMetaData(StoreFileMetaData.java:89)\n        at org.elasticsearch.indices.recovery.StartRecoveryRequest.readFrom(StartRecoveryRequest.java:115)\n        at org.elasticsearch.transport.netty.MessageChannelHandler.handleRequest(MessageChannelHandler.java:214)\n        at org.elasticsearch.transport.netty.MessageChannelHandler.messageReceived(MessageChannelHandler.java:111)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:462)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.callDecode(FrameDecoder.java:443)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.messageReceived(FrameDecoder.java:310)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:74)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n        at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\n[2015-02-15 13:21:10,115][WARN ][cluster.action.shard     ] [elasticsearch01] [pim_v3][0] sending failed shard for [pim_v3][0], node[nSy51hptRKSMMQqhPPvGVg], [R], s[INITIALIZING], indexUUID [67HPMYJ7RmeVQ-_rHyIBTQ], reason [Failed to start shard, message [RecoveryFailedException[[pim_v3][0]: Recovery failed from [elasticsearch02][K5GW34H-TMO8_sMIB5P77g][elasticsearch02][inet[/172.31.7.56:9300]] into [elasticsearch01][nSy51hptRKSMMQqhPPvGVg][elasticsearch01][inet[172.31.7.55/172.31.7.55:9300]]]; nested: RemoteTransportException[[elasticsearch02][inet[/172.31.7.56:9300]][index/shard/recovery/startRecovery]]; nested: IllegalArgumentException[No enum constant org.apache.lucene.util.Version.4.9.0]; ]]\n```\n\nThe node remains unable to have any shards allocated.\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}