{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21980","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21980/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21980/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21980/events","html_url":"https://github.com/elastic/elasticsearch/issues/21980","id":193555926,"node_id":"MDU6SXNzdWUxOTM1NTU5MjY=","number":21980,"title":"[TEST] Incorrect indentation in the `skip` part of YAML files leads to incorrect definitions","user":{"login":"karmi","id":4790,"node_id":"MDQ6VXNlcjQ3OTA=","avatar_url":"https://avatars1.githubusercontent.com/u/4790?v=4","gravatar_id":"","url":"https://api.github.com/users/karmi","html_url":"https://github.com/karmi","followers_url":"https://api.github.com/users/karmi/followers","following_url":"https://api.github.com/users/karmi/following{/other_user}","gists_url":"https://api.github.com/users/karmi/gists{/gist_id}","starred_url":"https://api.github.com/users/karmi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karmi/subscriptions","organizations_url":"https://api.github.com/users/karmi/orgs","repos_url":"https://api.github.com/users/karmi/repos","events_url":"https://api.github.com/users/karmi/events{/privacy}","received_events_url":"https://api.github.com/users/karmi/received_events","type":"User","site_admin":false},"labels":[{"id":60445228,"node_id":"MDU6TGFiZWw2MDQ0NTIyOA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest","name":">test","color":"5319e7","default":false,"description":"Issues or PRs that are addressing/adding tests"}],"state":"closed","locked":false,"assignee":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"assignees":[{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false}],"milestone":null,"comments":3,"created_at":"2016-12-05T17:09:59Z","updated_at":"2017-03-02T14:55:01Z","closed_at":"2017-03-02T11:43:21Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Frequently, in the `skip` definition of tests, we use incorrect indentation, like in [`cat.nodes/10_basic.yaml`](https://github.com/elastic/elasticsearch/blob/d77d4fa/rest-api-spec/src/main/resources/rest-api-spec/test/cat.nodes/10_basic.yaml#L63-L65):\r\n\r\n```yaml\r\n- skip:\r\n  version: \" - 5.0.0\"\r\n  reason:  The full_id setting was rejected in 5.0.0 see #21266\r\n```\r\n\r\nThe `version` and `reason` keys are on the same level as `skip`, leading to an incorrect definition of the skip section (example based on Ruby):\r\n\r\n```json\r\n[{\"skip\":null,\"version\":\" - 5.0.0\",\"reason\":\"The full_id setting was rejected in 5.0.0 see\"}]\r\n```\r\n\r\nThe expected definition is:\r\n\r\n```json\r\n[{\"skip\":{\"version\":\" - 5.0.0\",\"reason\":\"The full_id setting was rejected in 5.0.0 see\"}}]\r\n```\r\n\r\nThis happens frequently also for the `do` clauses (see eg. 8c721b10af2b3f300d45dc9f615e71b5c08c958d), leading to incorrect test definitions. It seems that the Java YAML parser is more lenient/intelligent than parsers for other languages, because these tests seem to run under Java, but fail under Ruby, Python, etc.\r\n\r\nI suggest we add code to the YAML test runner which verifies that every clause (\"action\") such as `do`, `skip`, `match` has only a _single key_ and throws an error otherwise. The Python runner already [does this verification](https://github.com/elastic/elasticsearch-py/blob/master/test_elasticsearch/test_server/test_common.py#L98), and when it has been added to the Ruby runner, it has identified the example listed in this issue.\r\n\r\n----\r\n\r\n/cc @elastic/es-clients","closed_by":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"performed_via_github_app":null}