[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202217748","html_url":"https://github.com/elastic/elasticsearch/issues/17359#issuecomment-202217748","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17359","id":202217748,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjIxNzc0OA==","user":{"login":"GlenRSmith","id":1327920,"node_id":"MDQ6VXNlcjEzMjc5MjA=","avatar_url":"https://avatars3.githubusercontent.com/u/1327920?v=4","gravatar_id":"","url":"https://api.github.com/users/GlenRSmith","html_url":"https://github.com/GlenRSmith","followers_url":"https://api.github.com/users/GlenRSmith/followers","following_url":"https://api.github.com/users/GlenRSmith/following{/other_user}","gists_url":"https://api.github.com/users/GlenRSmith/gists{/gist_id}","starred_url":"https://api.github.com/users/GlenRSmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GlenRSmith/subscriptions","organizations_url":"https://api.github.com/users/GlenRSmith/orgs","repos_url":"https://api.github.com/users/GlenRSmith/repos","events_url":"https://api.github.com/users/GlenRSmith/events{/privacy}","received_events_url":"https://api.github.com/users/GlenRSmith/received_events","type":"User","site_admin":false},"created_at":"2016-03-28T03:28:26Z","updated_at":"2016-03-28T03:28:26Z","author_association":"CONTRIBUTOR","body":"Possibly relevant:\n\nAfter changing index to have only 1 shard\n\nv2.2.1 throws an exception when attempting to load fielddata on a search result.\n\nUsing the query_string query that does succeed, the error is returned.\n\n```\nPOST /test_index/_search\n{\n  \"fielddata_fields\": [\"contents\"], \n  \"query\": {\n    \"query_string\": {\n      \"query\": \"hello\"\n    }\n  }\n}\n\n{\n   \"error\": {\n      \"root_cause\": [\n         {\n            \"type\": \"illegal_argument_exception\",\n            \"reason\": \"failed to find field data builder for field contents, and type attachment\"\n         }\n      ],\n      \"type\": \"search_phase_execution_exception\",\n      \"reason\": \"all shards failed\",\n      \"phase\": \"query_fetch\",\n      \"grouped\": true,\n      \"failed_shards\": [\n         {\n            \"shard\": 0,\n            \"index\": \"test_index\",\n            \"node\": \"NSripkQmT9qAZCuoTdzR9w\",\n            \"reason\": {\n               \"type\": \"illegal_argument_exception\",\n               \"reason\": \"failed to find field data builder for field contents, and type attachment\"\n            }\n         }\n      ]\n   },\n   \"status\": 400\n}\n```\n\nWith v1.7.3, the fielddata is populated and returned.\n\n```\nPOST /test_index/testfile/_search\n{\n  \"fielddata_fields\": [\"contents\"], \n  \"query\": {\n    \"query_string\": {\n      \"query\": \"hello\"\n    }\n  }\n}\n```\n\nreturns\n\n```\n{\n   \"took\": 2,\n   \"timed_out\": false,\n   \"_shards\": {\n      \"total\": 2,\n      \"successful\": 2,\n      \"failed\": 0\n   },\n   \"hits\": {\n      \"total\": 1,\n      \"max_score\": 0.095891505,\n      \"hits\": [\n         {\n            \"_index\": \"test_index\",\n            \"_type\": \"testfile\",\n            \"_id\": \"AVO7NoVgsHxrzUVsaSN9\",\n            \"_score\": 0.095891505,\n            \"_source\": {\n               \"fileId\": 101,\n               \"contents\": \"aGVsbG8gd29ybGQ=\"\n            },\n            \"fields\": {\n               \"contents\": [\n                  \"hello\",\n                  \"world\"\n               ]\n            }\n         }\n      ]\n   }\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202646950","html_url":"https://github.com/elastic/elasticsearch/issues/17359#issuecomment-202646950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17359","id":202646950,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjY0Njk1MA==","user":{"login":"eskibars","id":2246002,"node_id":"MDQ6VXNlcjIyNDYwMDI=","avatar_url":"https://avatars0.githubusercontent.com/u/2246002?v=4","gravatar_id":"","url":"https://api.github.com/users/eskibars","html_url":"https://github.com/eskibars","followers_url":"https://api.github.com/users/eskibars/followers","following_url":"https://api.github.com/users/eskibars/following{/other_user}","gists_url":"https://api.github.com/users/eskibars/gists{/gist_id}","starred_url":"https://api.github.com/users/eskibars/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eskibars/subscriptions","organizations_url":"https://api.github.com/users/eskibars/orgs","repos_url":"https://api.github.com/users/eskibars/repos","events_url":"https://api.github.com/users/eskibars/events{/privacy}","received_events_url":"https://api.github.com/users/eskibars/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T00:42:31Z","updated_at":"2016-03-29T00:42:31Z","author_association":"CONTRIBUTOR","body":"query_string defaults to index.query.default_field (which is _all by default).  That's why the query_string is working as expected.\n\nYou can get your match_phrase query to work by searching field contents.content, which is mapper-attachments dumps the document content to (https://www.elastic.co/guide/en/elasticsearch/plugins/2.2/mapper-attachments-usage.html)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202717817","html_url":"https://github.com/elastic/elasticsearch/issues/17359#issuecomment-202717817","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17359","id":202717817,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjcxNzgxNw==","user":{"login":"jaxx","id":723258,"node_id":"MDQ6VXNlcjcyMzI1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/723258?v=4","gravatar_id":"","url":"https://api.github.com/users/jaxx","html_url":"https://github.com/jaxx","followers_url":"https://api.github.com/users/jaxx/followers","following_url":"https://api.github.com/users/jaxx/following{/other_user}","gists_url":"https://api.github.com/users/jaxx/gists{/gist_id}","starred_url":"https://api.github.com/users/jaxx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaxx/subscriptions","organizations_url":"https://api.github.com/users/jaxx/orgs","repos_url":"https://api.github.com/users/jaxx/repos","events_url":"https://api.github.com/users/jaxx/events{/privacy}","received_events_url":"https://api.github.com/users/jaxx/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T05:33:57Z","updated_at":"2016-03-29T05:35:07Z","author_association":"NONE","body":"If I'm building my queries with NEST and using expressions to get field names from properties, how do I know which field is meant for full-text search??? In previous versions it was simple - I built universal query and it worked with all fields.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202739920","html_url":"https://github.com/elastic/elasticsearch/issues/17359#issuecomment-202739920","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17359","id":202739920,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjczOTkyMA==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T06:35:06Z","updated_at":"2016-03-29T06:35:06Z","author_association":"MEMBER","body":"In your case it should be contents.content\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202745690","html_url":"https://github.com/elastic/elasticsearch/issues/17359#issuecomment-202745690","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17359","id":202745690,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjc0NTY5MA==","user":{"login":"jaxx","id":723258,"node_id":"MDQ6VXNlcjcyMzI1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/723258?v=4","gravatar_id":"","url":"https://api.github.com/users/jaxx","html_url":"https://github.com/jaxx","followers_url":"https://api.github.com/users/jaxx/followers","following_url":"https://api.github.com/users/jaxx/following{/other_user}","gists_url":"https://api.github.com/users/jaxx/gists{/gist_id}","starred_url":"https://api.github.com/users/jaxx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaxx/subscriptions","organizations_url":"https://api.github.com/users/jaxx/orgs","repos_url":"https://api.github.com/users/jaxx/repos","events_url":"https://api.github.com/users/jaxx/events{/privacy}","received_events_url":"https://api.github.com/users/jaxx/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T06:59:59Z","updated_at":"2016-03-29T07:03:31Z","author_association":"NONE","body":"I understand, but if I have a class\n\n```\npublic class ESFile\n{\n    public int Id { get; set; }\n    public string Contents { get; set; }\n}\n```\n\nAnd I'm building my queries like \n\n```\nbuilder.Build<ESFile>(x => x.Id).Add(x => x.Contents);\n```\n\nHow can I know which field is content field? Why this functionality changed compared to earlier versions? Can I tell NEST with somekind of an attribute that Contents is attachment?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202755941","html_url":"https://github.com/elastic/elasticsearch/issues/17359#issuecomment-202755941","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17359","id":202755941,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjc1NTk0MQ==","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T07:31:54Z","updated_at":"2016-03-29T07:31:54Z","author_association":"MEMBER","body":"I don't really remember why it changed. I think it was cleaner to not modify what the user entered and generate the content in another field.\n\nSo you send:\n\n``` js\n{\n  \"foo\": \"base64\"\n}\n```\n\nIt generates behind the scene:\n\n``` js\n{\n  \"foo\": {\n     \"foo\": \"base64\",\n     \"content\": \"bar\" \n  }\n}\n```\n\nIf you search in `foo`, it uses `foo.foo` (default behavior for multi fields). If you want to search in extracted text, you have to search in  `foo.content`.\n\nBut you have to know that it will change again in the future as mapper attachments plugin will be replaced by an ingest pipeline. See https://www.elastic.co/guide/en/elasticsearch/plugins/master/ingest-attachment.html\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/202763983","html_url":"https://github.com/elastic/elasticsearch/issues/17359#issuecomment-202763983","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17359","id":202763983,"node_id":"MDEyOklzc3VlQ29tbWVudDIwMjc2Mzk4Mw==","user":{"login":"jaxx","id":723258,"node_id":"MDQ6VXNlcjcyMzI1OA==","avatar_url":"https://avatars0.githubusercontent.com/u/723258?v=4","gravatar_id":"","url":"https://api.github.com/users/jaxx","html_url":"https://github.com/jaxx","followers_url":"https://api.github.com/users/jaxx/followers","following_url":"https://api.github.com/users/jaxx/following{/other_user}","gists_url":"https://api.github.com/users/jaxx/gists{/gist_id}","starred_url":"https://api.github.com/users/jaxx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaxx/subscriptions","organizations_url":"https://api.github.com/users/jaxx/orgs","repos_url":"https://api.github.com/users/jaxx/repos","events_url":"https://api.github.com/users/jaxx/events{/privacy}","received_events_url":"https://api.github.com/users/jaxx/received_events","type":"User","site_admin":false},"created_at":"2016-03-29T07:43:27Z","updated_at":"2016-03-29T07:43:27Z","author_association":"NONE","body":"Thank you for your answer.\n","performed_via_github_app":null}]