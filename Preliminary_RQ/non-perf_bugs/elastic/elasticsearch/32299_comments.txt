[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407197504","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-407197504","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":407197504,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzE5NzUwNA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-23T20:53:30Z","updated_at":"2018-07-23T20:53:30Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407197748","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-407197748","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":407197748,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzE5Nzc0OA==","user":{"login":"andyb-elastic","id":29205940,"node_id":"MDQ6VXNlcjI5MjA1OTQw","avatar_url":"https://avatars2.githubusercontent.com/u/29205940?v=4","gravatar_id":"","url":"https://api.github.com/users/andyb-elastic","html_url":"https://github.com/andyb-elastic","followers_url":"https://api.github.com/users/andyb-elastic/followers","following_url":"https://api.github.com/users/andyb-elastic/following{/other_user}","gists_url":"https://api.github.com/users/andyb-elastic/gists{/gist_id}","starred_url":"https://api.github.com/users/andyb-elastic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andyb-elastic/subscriptions","organizations_url":"https://api.github.com/users/andyb-elastic/orgs","repos_url":"https://api.github.com/users/andyb-elastic/repos","events_url":"https://api.github.com/users/andyb-elastic/events{/privacy}","received_events_url":"https://api.github.com/users/andyb-elastic/received_events","type":"User","site_admin":false},"created_at":"2018-07-23T20:54:21Z","updated_at":"2018-07-23T20:54:21Z","author_association":"CONTRIBUTOR","body":"Actually this does look odd from the integ cluster logs, though it happens after the request failing that fails the test\r\n\r\n```\r\n[2018-07-23T22:10:15,863][ERROR][o.e.s.m.MustacheScriptEngine] Error running com.github.mustachejava.codes.DefaultMustache@56a43cff\r\ncom.github.mustachejava.MustacheException: Failed to get value for ctx @[query-template:1]\r\n        at com.github.mustachejava.codes.ValueCode.execute(ValueCode.java:74) ~[compiler-0.9.3.jar:?]\r\n        at com.github.mustachejava.codes.DefaultMustache.run(DefaultMustache.java:34) ~[compiler-0.9.3.jar:?]\r\n        at com.github.mustachejava.codes.DefaultCode.execute(DefaultCode.java:162) ~[compiler-0.9.3.jar:?]\r\n        at com.github.mustachejava.codes.DefaultMustache.execute(DefaultMustache.java:55) ~[compiler-0.9.3.jar:?]\r\n        at com.github.mustachejava.Mustache.execute(Mustache.java:38) ~[compiler-0.9.3.jar:?]\r\n        at org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.lambda$execute$0(MustacheScriptEngine.java:111) ~[lang-mustache-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at java.security.AccessController.doPrivileged(Native Method) ~[?:?]\r\n        at org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.execute(MustacheScriptEngine.java:110) [lang-mustache-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.watcher.common.text.TextTemplateEngine.render(TextTemplateEngine.java:57) [x-pack-watcher-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.watcher.actions.logging.ExecutableLoggingAction.execute(ExecutableLoggingAction.java:46) [x-pack-watcher-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.core.watcher.actions.ActionWrapper.execute(ActionWrapper.java:144) [x-pack-core-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT] \r\n        at org.elasticsearch.xpack.watcher.execution.ExecutionService.executeInner(ExecutionService.java:464) [x-pack-watcher-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.watcher.execution.ExecutionService.execute(ExecutionService.java:295) [x-pack-watcher-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.xpack.watcher.transport.actions.execute.TransportExecuteWatchAction$1.doRun(TransportExecuteWatchAction.java:154) [x-pack-watcher-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:514) [?:?]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:624) [elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1135) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) [?:?]\r\n        at java.lang.Thread.run(Thread.java:844) [?:?]\r\nCaused by: java.lang.IllegalArgumentException: Iterable object is self-referencing itself\r\n        at org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:253) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:256) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:256) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:256) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:231) ~[elasticsearch-6.4.0-SNAPSHOT.jar:6.4.0-SNAPSHOT]\r\n        at org.elasticsearch.script.mustache.CustomReflectionObjectHandler.stringify(CustomReflectionObjectHandler.java:160) ~[?:?]\r\n        at com.github.mustachejava.codes.ValueCode.execute(ValueCode.java:69) ~[?:?]\r\n        ... 20 more\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/407634761","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-407634761","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":407634761,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNzYzNDc2MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2018-07-25T05:07:45Z","updated_at":"2018-07-25T05:07:45Z","author_association":"MEMBER","body":"Good catch @andyb-elastic.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/417421726","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-417421726","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":417421726,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzQyMTcyNg==","user":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"created_at":"2018-08-30T18:30:15Z","updated_at":"2018-08-30T18:30:15Z","author_association":"MEMBER","body":"Another instance: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/2645/consoleText","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/465803286","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-465803286","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":465803286,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NTgwMzI4Ng==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-20T23:53:54Z","updated_at":"2019-02-20T23:53:54Z","author_association":"CONTRIBUTOR","body":"I have enabled `x-pack/qa/smoke-test-watcher` again.\r\nI have covered the issues that I know about, but there's a comment above\r\n\r\n> This test has failed a handful of times in the last three months but for different resaons.\r\n\r\nI don't have logs for all those, so it's possible that some still exist.\r\nPlease re-mute this test if it turns out to still be flaky.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466152390","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-466152390","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":466152390,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjE1MjM5MA==","user":{"login":"benwtrent","id":4357155,"node_id":"MDQ6VXNlcjQzNTcxNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/4357155?v=4","gravatar_id":"","url":"https://api.github.com/users/benwtrent","html_url":"https://github.com/benwtrent","followers_url":"https://api.github.com/users/benwtrent/followers","following_url":"https://api.github.com/users/benwtrent/following{/other_user}","gists_url":"https://api.github.com/users/benwtrent/gists{/gist_id}","starred_url":"https://api.github.com/users/benwtrent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benwtrent/subscriptions","organizations_url":"https://api.github.com/users/benwtrent/orgs","repos_url":"https://api.github.com/users/benwtrent/repos","events_url":"https://api.github.com/users/benwtrent/events{/privacy}","received_events_url":"https://api.github.com/users/benwtrent/received_events","type":"User","site_admin":false},"created_at":"2019-02-21T20:23:45Z","updated_at":"2019-02-21T20:23:45Z","author_association":"MEMBER","body":"Another failure: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+intake/2183/console\r\n\r\n```\r\n./gradlew :x-pack:qa:smoke-test-watcher:integTestRunner -Dtests.seed=921232DB4961CB4E -Dtests.class=org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT -Dtests.method=\"testMonitorClusterHealth\" -Dtests.security.manager=true -Dtests.locale=en-NZ -Dtests.timezone=Europe/Warsaw -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n```\r\n12:06:36 FAILURE 2.58s | SmokeTestWatcherTestSuiteIT.testMonitorClusterHealth <<< FAILURES!\r\n12:06:36    > Throwable #1: java.lang.AssertionError: Watch count (from _watcher/stats)\r\n12:06:36    > Expected: is <0>\r\n12:06:36    >      but: was <1>\r\n12:06:36    > \tat __randomizedtesting.SeedInfo.seed([921232DB4961CB4E:61CAABBBBA00A4C4]:0)\r\n12:06:36    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n12:06:36    > \tat org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT.assertWatchCount(SmokeTestWatcherTestSuiteIT.java:230)\r\n12:06:36    > \tat org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT.testMonitorClusterHealth(SmokeTestWatcherTestSuiteIT.java:162)\r\n12:06:36    > \tat java.lang.Thread.run(Thread.java:748)\r\n12:06:36 Completed [3/3] in 2.61s, 1 test, 1 failure <<< FAILURES!\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466201037","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-466201037","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":466201037,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjIwMTAzNw==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-21T22:52:41Z","updated_at":"2019-02-21T22:52:41Z","author_association":"CONTRIBUTOR","body":"Thanks, I'll look today and re-mute if needed.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/466305686","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-466305686","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":466305686,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NjMwNTY4Ng==","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"created_at":"2019-02-22T07:47:29Z","updated_at":"2019-02-22T07:47:29Z","author_association":"CONTRIBUTOR","body":"By piecing together the output from the test with the cluster log, I have a theory about what's happening here:\r\n```\r\n#TEST# [2019-02-21T19:06:35,018][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n\r\n#NODE# [2019-02-21T18:06:35,070][DEBUG][o.e.x.w.t.s.e.TickerScheduleTriggerEngine] [node-0] triggered job [cluster_health_watch] at [2019-02-21T18:06:35.070Z] (scheduled time was [2019-02-21T18:06:34.919Z])\r\n#NODE# [2019-02-21T18:06:35,081][INFO ][o.e.c.m.MetaDataCreateIndexService] [node-0] [.triggered_watches] creating index, cause [auto(bulk api)], templates [.triggered_watches], shards [1]/[1], mappings [doc]\r\n#NODE# [2019-02-21T18:06:35,083][INFO ][o.e.c.r.a.AllocationService] [node-0] updating number_of_replicas to [0] for indices [.triggered_watches]\r\n#NODE# [2019-02-21T18:06:35,155][INFO ][o.e.c.r.a.AllocationService] [node-0] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[.triggered_watches][0]] ...]).\r\n#NODE# [2019-02-21T18:06:35,184][DEBUG][o.e.x.w.e.ExecutionService] [node-0] executing watch [cluster_health_watch]\r\n#NODE# [2019-02-21T18:06:35,212][INFO ][o.e.x.w.a.l.ExecutableLoggingAction] [node-0] executed\r\n#NODE# [2019-02-21T18:06:35,215][DEBUG][o.e.x.w.WatcherIndexingListener] [node-0] adding watch [cluster_health_watch] to trigger service\r\n#NODE# [2019-02-21T18:06:35,231][INFO ][o.e.c.m.MetaDataCreateIndexService] [node-0] [.watcher-history-9-2019.02.21] creating index, cause [auto(bulk api)], templates [.watch-history-9], shards [1]/[0], mappings [doc]\r\n#NODE# [2019-02-21T18:06:35,299][INFO ][o.e.c.r.a.AllocationService] [node-0] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[.watcher-history-9-2019.02.21][0]] ...])\r\n#NODE# [2019-02-21T18:06:35,327][INFO ][o.e.c.m.MetaDataMappingService] [node-0] [.watcher-history-9-2019.02.21/KRXX-Mz_QzeQXiarK-39yw] update_mapping [doc]\r\n#NODE# [2019-02-21T18:06:35,373][DEBUG][o.e.x.w.e.ExecutionService] [node-0] finished [cluster_health_watch]/[cluster_health_watch_53e3c983-2cc4-48e8-85e2-e27e15af89b9-2019-02-21T18:06:35.072183Z]\r\n\r\n#TEST# [2019-02-21T19:06:36,043][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n#TEST# [2019-02-21T19:06:36,079][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n\r\n#NODE# [2019-02-21T18:06:36,078][DEBUG][o.e.x.w.t.s.e.TickerScheduleTriggerEngine] [node-0] triggered job [cluster_health_watch] at [2019-02-21T18:06:36.077Z] (scheduled time was [2019-02-21T18:06:35.919Z])\r\n#NODE# [2019-02-21T18:06:36,089][DEBUG][o.e.x.w.e.ExecutionService] [node-0] executing watch [cluster_health_watch]\r\n\r\n#TEST# [2019-02-21T19:06:36,093][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [1] hits in watcher history\r\n#TEST# [2019-02-21T19:06:36,093][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Watch hit 0 has id [cluster_health_watch] (expecting [cluster_health_watch])\r\n\r\n#NODE# [2019-02-21T18:06:36,098][DEBUG][o.e.x.w.WatcherIndexingListener] [node-0] adding watch [cluster_health_watch] to trigger service\r\n#NODE# [2019-02-21T18:06:36,103][DEBUG][o.e.x.w.e.ExecutionService] [node-0] failed to execute watch [cluster_health_watch]\r\norg.elasticsearch.index.engine.VersionConflictEngineException: [doc][cluster_health_watch]: version conflict, required seqNo [1], primary term [1]. current document has seqNo [2] and primary term [1]\r\n\r\n#TEST# [2019-02-21T19:06:36,306][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] after test\r\n#TEST  Watch count (from _watcher/stats) Expected: is <0> but: was <1>\r\n```\r\n\r\nIt seems there was a concurrency issue between deleting the watch (somewhere between `19:06:36,093` and `19:06:36,306` in the test) and an executing of the test being written to the `.watches` index (around `18:06:36,098` on the node).\r\n\r\nThe watcher stats are driven from the `TriggerService`, and the `WatcherIndexingListener` updates the `TriggerService` as part of the `preIndex` method. \r\n\r\nSo delete watch removes the watch from the `TriggerService` which removes it from the stats count, but then the watch finishes executing which tries to update the `.watches` index, and that causes it to be added back to the `TriggerService`.\r\nThe indexing to the `watches` index _fails_ because of a version conflict (the delete), and the `postIndex` listener is supposed to detect that and clean up the `TriggerService` stats.\r\nAnd it might do, except the test has already failed by then, so the cluster shuts down.\r\n\r\nI think an `assertBusy` on the `assertWatchCount` will do the trick, but it's a bit ugly.\r\n\r\nI don't have time to fix it today, but will try to get a PR up next week.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/467864241","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-467864241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":467864241,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2Nzg2NDI0MQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2019-02-27T13:37:04Z","updated_at":"2019-02-27T13:37:45Z","author_association":"MEMBER","body":"Failed again today: https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/800\r\n\r\nIt does not reproduce with:\r\n\r\n```\r\n./gradlew :x-pack:qa:smoke-test-watcher:integTestRunner -Dtests.seed=37D3466CC78964DE -Dtests.class=org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT -Dtests.method=\"testMonitorClusterHealth\" -Dtests.security.manager=true -Dtests.locale=ro -Dtests.timezone=PST -Dcompiler.java=11 -Druntime.java=8\r\n```\r\n\r\n<details>\r\n04:35:05   1> [2019-02-26T20:35:00,582][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] before test\r\n04:35:05   1> [2019-02-26T20:35:00,779][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] initializing REST clients against [http://[::1]:39892]\r\n04:35:05   1> [2019-02-26T20:35:01,980][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Successfully indexed watch with id [cluster_health_watch]\r\n04:35:05   1> [2019-02-26T20:35:01,986][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Watch count is [1]\r\n04:35:05   1> [2019-02-26T20:35:01,987][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:01,992][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,006][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,011][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,015][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,020][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,023][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,026][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,032][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,036][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,040][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,045][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,053][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,057][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,062][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,079][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,084][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,089][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,122][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,127][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,132][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,197][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,202][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,207][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,336][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,340][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,345][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,601][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,607][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:02,611][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:03,124][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:03,130][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:03,136][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [0] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:04,161][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Refreshing watcher history\r\n04:35:05   1> [2019-02-26T20:35:04,225][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Searching watcher history\r\n04:35:05   1> [2019-02-26T20:35:04,282][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Found [1] hits in watcher history\r\n04:35:05   1> [2019-02-26T20:35:04,282][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] Watch hit 0 has id [cluster_health_watch] (expecting [cluster_health_watch])\r\n04:35:05   1> [2019-02-26T20:35:04,644][INFO ][o.e.s.SmokeTestWatcherTestSuiteIT] [testMonitorClusterHealth] after test\r\n04:35:05 FAILURE 4.11s | SmokeTestWatcherTestSuiteIT.testMonitorClusterHealth <<< FAILURES!\r\n04:35:05    > Throwable #1: java.lang.AssertionError: Watch count (from _watcher/stats)\r\n04:35:05    > Expected: is <0>\r\n04:35:05    >      but: was <1>\r\n04:35:05    > \tat __randomizedtesting.SeedInfo.seed([37D3466CC78964DE:C40BDF0C34E80B54]:0)\r\n04:35:05    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n04:35:05    > \tat org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT.assertWatchCount(SmokeTestWatcherTestSuiteIT.java:230)\r\n04:35:05    > \tat org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT.testMonitorClusterHealth(SmokeTestWatcherTestSuiteIT.java:162)\r\n04:35:05    > \tat java.lang.Thread.run(Thread.java:748)\r\n04:35:05 Completed [1/3] in 5.52s, 1 test, 1 failure <<< FAILURES!\r\n04:35:05 \r\n04:35:13 Suite: org.elasticsearch.smoketest.WatcherRestIT\r\n04:35:13 Completed [2/3] in 7.98s, 19 tests\r\n04:35:13 \r\n04:35:13 Suite: org.elasticsearch.smoketest.WatcherTemplateTests\r\n04:35:13 Completed [3/3] in 0.21s, 3 tests\r\n04:35:13 \r\n04:35:13 [ant:junit4] JVM J0: stderr was not empty, see: /var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic/x-pack/qa/smoke-test-watcher/build/testrun/integTestRunner/temp/junit4-J0-20190227_043458_7637981882383782499459.syserr\r\n04:35:13 \r\n04:35:13 > Task :x-pack:qa:smoke-test-watcher:integTestRunner FAILED\r\n04:35:13 Tests with failures:\r\n04:35:13   - org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT.testMonitorClusterHealth\r\n04:35:13 \r\n04:35:13 Slow Tests Summary:\r\n04:35:13   7.98s | org.elasticsearch.smoketest.WatcherRestIT\r\n04:35:13   5.52s | org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT\r\n04:35:13   0.21s | org.elasticsearch.smoketest.WatcherTemplateTests\r\n04:35:13 \r\n04:35:13 [ant:junit4] JVM J0:     0.27 ..    14.82 =    14.55s\r\n04:35:13 [ant:junit4] Execution time total: 14 seconds\r\n04:35:13 [ant:junit4] Tests summary: 3 suites, 23 tests, 1 failure\r\n04:35:13 \r\n04:35:13 Cluster x-pack_qa_smoke-test-watcher_integTestCluster - node 0 log excerpt:\r\n04:35:13 (full log at /var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic/x-pack/qa/smoke-test-watcher/build/cluster/integTestCluster node0/elasticsearch-8.0.0-SNAPSHOT/logs/x-pack_qa_smoke-test-watcher_integTestCluster.log)\r\n04:35:13 -----------------------------------------\r\n04:35:13 [2019-02-27T04:34:51,913][INFO ][o.e.e.NodeEnvironment    ] [node-0] using [1] data paths, mounts [[/ (rootfs)]], net usable_space [232gb], net total_space [299.9gb], types [rootfs]\r\n04:35:13 [2019-02-27T04:34:51,917][INFO ][o.e.e.NodeEnvironment    ] [node-0] heap size [494.9mb], compressed ordinary object pointers [true]\r\n04:35:13 [2019-02-27T04:34:51,920][INFO ][o.e.n.Node               ] [node-0] node name [node-0], node ID [u8lpcbgsSQ2WlEiI1SYlSA]\r\n04:35:13 [2019-02-27T04:34:51,921][INFO ][o.e.n.Node               ] [node-0] version[8.0.0-SNAPSHOT], pid[275430], build[default/tar/eae83fd/2019-02-27T01:28:14.922909Z], OS[Linux/3.10.0-957.5.1.el7.x86_64/amd64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/11.0.2/11.0.2+9-LTS]\r\n04:35:13 [2019-02-27T04:34:51,921][INFO ][o.e.n.Node               ] [node-0] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/tmp/elasticsearch-6033938558246586518, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m, -Djava.locale.providers=COMPAT, -XX:UseAVX=2, -Dio.netty.allocator.type=unpooled, -Xms512m, -Xmx512m, -ea, -esa, -Des.path.home=/var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic/x-pack/qa/smoke-test-watcher/build/cluster/integTestCluster node0/elasticsearch-8.0.0-SNAPSHOT, -Des.path.conf=/var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic/x-pack/qa/smoke-test-watcher/build/cluster/integTestCluster node0/elasticsearch-8.0.0-SNAPSHOT/config, -Des.distribution.flavor=default, -Des.distribution.type=tar]\r\n04:35:13 [2019-02-27T04:34:51,922][WARN ][o.e.n.Node               ] [node-0] version [8.0.0-SNAPSHOT] is a pre-release version of Elasticsearch and is not suitable for production\r\n04:35:13 [2019-02-27T04:34:53,631][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [aggs-matrix-stats]\r\n04:35:13 [2019-02-27T04:34:53,632][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [analysis-common]\r\n04:35:13 [2019-02-27T04:34:53,632][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [data-frame]\r\n04:35:13 [2019-02-27T04:34:53,633][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [ingest-common]\r\n04:35:13 [2019-02-27T04:34:53,634][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [ingest-geoip]\r\n04:35:13 [2019-02-27T04:34:53,634][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [ingest-user-agent]\r\n04:35:13 [2019-02-27T04:34:53,634][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [lang-expression]\r\n04:35:13 [2019-02-27T04:34:53,634][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [lang-mustache]\r\n04:35:13 [2019-02-27T04:34:53,635][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [lang-painless]\r\n04:35:13 [2019-02-27T04:34:53,635][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [mapper-extras]\r\n04:35:13 [2019-02-27T04:34:53,635][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [parent-join]\r\n04:35:13 [2019-02-27T04:34:53,636][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [percolator]\r\n04:35:13 [2019-02-27T04:34:53,636][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [rank-eval]\r\n04:35:13 [2019-02-27T04:34:53,636][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [reindex]\r\n04:35:13 [2019-02-27T04:34:53,636][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [repository-url]\r\n04:35:13 [2019-02-27T04:34:53,636][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [transport-netty4]\r\n04:35:13 [2019-02-27T04:34:53,637][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-ccr]\r\n04:35:13 [2019-02-27T04:34:53,637][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-core]\r\n04:35:13 [2019-02-27T04:34:53,637][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-deprecation]\r\n04:35:13 [2019-02-27T04:34:53,637][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-graph]\r\n04:35:13 [2019-02-27T04:34:53,638][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-ilm]\r\n04:35:13 [2019-02-27T04:34:53,638][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-logstash]\r\n04:35:13 [2019-02-27T04:34:53,638][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-ml]\r\n04:35:13 [2019-02-27T04:34:53,638][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-monitoring]\r\n04:35:13 [2019-02-27T04:34:53,638][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-rollup]\r\n04:35:13 [2019-02-27T04:34:53,638][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-security]\r\n04:35:13 [2019-02-27T04:34:53,639][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-sql]\r\n04:35:13 [2019-02-27T04:34:53,639][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-upgrade]\r\n04:35:13 [2019-02-27T04:34:53,639][INFO ][o.e.p.PluginsService     ] [node-0] loaded module [x-pack-watcher]\r\n04:35:13 [2019-02-27T04:34:53,640][INFO ][o.e.p.PluginsService     ] [node-0] no plugins loaded\r\n04:35:13 [2019-02-27T04:34:57,336][INFO ][o.e.d.DiscoveryModule    ] [node-0] using discovery type [zen] and seed hosts providers [settings, file]\r\n04:35:13 [2019-02-27T04:34:58,019][INFO ][o.e.n.Node               ] [node-0] initialized\r\n04:35:13 [2019-02-27T04:34:58,020][INFO ][o.e.n.Node               ] [node-0] starting ...\r\n04:35:13 [2019-02-27T04:34:58,180][INFO ][o.e.t.TransportService   ] [node-0] publish_address {127.0.0.1:37607}, bound_addresses {[::1]:40656}, {127.0.0.1:37607}\r\n04:35:13 [2019-02-27T04:34:58,204][WARN ][o.e.d.FileBasedSeedHostsProvider] [node-0] expected, but did not find, a dynamic hosts list at [/var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic/x-pack/qa/smoke-test-watcher/build/cluster/integTestCluster node0/elasticsearch-8.0.0-SNAPSHOT/config/unicast_hosts.txt]\r\n04:35:13 [2019-02-27T04:34:58,206][INFO ][o.e.c.c.Coordinator      ] [node-0] setting initial configuration to VotingConfiguration{u8lpcbgsSQ2WlEiI1SYlSA}\r\n04:35:13 [2019-02-27T04:34:58,250][INFO ][o.e.h.AbstractHttpServerTransport] [node-0] publish_address {127.0.0.1:41472}, bound_addresses {[::1]:39892}, {127.0.0.1:41472}\r\n04:35:13 [2019-02-27T04:34:58,252][INFO ][o.e.n.Node               ] [node-0] started\r\n04:35:13 [2019-02-27T04:34:58,282][INFO ][o.e.c.s.MasterService    ] [node-0] elected-as-master ([1] nodes joined)[{node-0}{u8lpcbgsSQ2WlEiI1SYlSA}{Sturk2hjRDq3y4le33PmDw}{127.0.0.1}{127.0.0.1:37607}{xpack.installed=true, testattr=test} elect leader, _BECOME_MASTER_TASK_, _FINISH_ELECTION_], term: 1, version: 1, reason: master node changed {previous [], current [{node-0}{u8lpcbgsSQ2WlEiI1SYlSA}{Sturk2hjRDq3y4le33PmDw}{127.0.0.1}{127.0.0.1:37607}{xpack.installed=true, testattr=test}]}\r\n04:35:13 [2019-02-27T04:34:58,326][INFO ][o.e.c.s.ClusterApplierService] [node-0] master node changed {previous [], current [{node-0}{u8lpcbgsSQ2WlEiI1SYlSA}{Sturk2hjRDq3y4le33PmDw}{127.0.0.1}{127.0.0.1:37607}{xpack.installed=true, testattr=test}]}, term: 1, version: 1, reason: Publication{term=1, version=1}\r\n04:35:13 [2019-02-27T04:34:58,350][DEBUG][o.e.x.w.s.WatcherIndexTemplateRegistry] [node-0] adding index template [.triggered_watches], because it doesn't exist\r\n04:35:13 [2019-02-27T04:34:58,351][DEBUG][o.e.x.w.s.WatcherIndexTemplateRegistry] [node-0] adding index template [.watch-history-9], because it doesn't exist\r\n04:35:13 [2019-02-27T04:34:58,352][DEBUG][o.e.x.w.s.WatcherIndexTemplateRegistry] [node-0] adding index template [.watches], because it doesn't exist\r\n04:35:13 [2019-02-27T04:34:58,386][INFO ][o.e.g.GatewayService     ] [node-0] recovered [0] indices into cluster_state\r\n04:35:13 [2019-02-27T04:34:58,412][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [node-0] uncaught exception in thread [elasticsearch[node-0][generic][T#2]]\r\n04:35:13 java.lang.IllegalStateException: failed to find action [org.elasticsearch.xpack.core.indexlifecycle.action.PutLifecycleAction@d06806ea] to execute\r\n04:35:13 \tat org.elasticsearch.client.node.NodeClient.transportAction(NodeClient.java:116) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.client.node.NodeClient.executeLocally(NodeClient.java:83) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:72) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:393) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.core.indexlifecycle.client.ILMClient.putLifecyclePolicy(ILMClient.java:42) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.support.WatcherIndexTemplateRegistry.lambda$putPolicy$3(WatcherIndexTemplateRegistry.java:188) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.xpack.core.ClientHelper.executeAsyncWithOrigin(ClientHelper.java:83) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.support.WatcherIndexTemplateRegistry.lambda$putPolicy$4(WatcherIndexTemplateRegistry.java:171) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n04:35:13 \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n04:35:13 \tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n04:35:13 ... SKIPPED 80 LINES ...\r\n04:35:13 [2019-02-27T04:35:05,541][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [my_logging_watch_1c43fcc2-2093-4ac2-87a3-c6b10a255a0c-2019-02-27T04:35:05.510914Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 37 LINES ...\r\n04:35:13 [2019-02-27T04:35:06,446][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [my_watch_600f1dff-9778-4072-8e4f-e2fb500f94f5-2019-02-27T04:35:06.444438Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 3 LINES ...\r\n04:35:13 [2019-02-27T04:35:06,494][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [my_watch_4a3cd295-9ead-406e-b348-fdac02df7114-2019-02-27T04:35:06.489475Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 21 LINES ...\r\n04:35:13 [2019-02-27T04:35:07,074][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [my_exe_watch_6f85dfff-9302-43a5-ae60-03fc2e6b05a7-2019-02-27T04:35:06.905692Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 19 LINES ...\r\n04:35:13 [2019-02-27T04:35:07,467][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [my_watch_c9b1fe1b-017b-40aa-9272-e27d2c2d5608-2019-02-27T04:35:07.464404Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 3 LINES ...\r\n04:35:13 [2019-02-27T04:35:07,505][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [my_watch_2e5f2266-275f-460a-9fbe-5a99b7a7233b-2019-02-27T04:35:07.50331Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 67 LINES ...\r\n04:35:13 [2019-02-27T04:35:09,000][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [my_exe_watch_fa140609-254f-4814-b14f-bf0fcc0cab55-2019-02-27T04:35:08.846498Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 32 LINES ...\r\n04:35:13 [2019-02-27T04:35:09,862][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [test_watch_3c32ac97-38fc-4513-87a6-6f21e726d44c-2019-02-27T04:35:09.591496Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 52 LINES ...\r\n04:35:13 [2019-02-27T04:35:11,260][ERROR][o.e.x.w.Watcher          ] [node-0] triggered watches could not be deleted [test_watch_d4af228d-7aaa-466f-bed4-674d65f14f64-2019-02-27T04:35:11.211714Z], failure [[.triggered_watches] IndexNotFoundException[no such index [.triggered_watches]]]\r\n04:35:13 ... SKIPPED 57 LINES ...\r\n04:35:13 [2019-02-27T04:35:12,356][ERROR][o.e.s.m.MustacheScriptEngine] [node-0] Error running com.github.mustachejava.codes.DefaultMustache@786363e1\r\n04:35:13 com.github.mustachejava.MustacheException: Failed to get value for ctx @[query-template:1]\r\n04:35:13 \tat com.github.mustachejava.codes.ValueCode.execute(ValueCode.java:74) ~[compiler-0.9.3.jar:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultMustache.run(DefaultMustache.java:34) ~[compiler-0.9.3.jar:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultCode.execute(DefaultCode.java:162) ~[compiler-0.9.3.jar:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultMustache.execute(DefaultMustache.java:55) ~[compiler-0.9.3.jar:?]\r\n04:35:13 \tat com.github.mustachejava.Mustache.execute(Mustache.java:38) ~[compiler-0.9.3.jar:?]\r\n04:35:13 \tat org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.lambda$execute$0(MustacheScriptEngine.java:119) ~[lang-mustache-client-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat java.security.AccessController.doPrivileged(Native Method) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.execute(MustacheScriptEngine.java:118) [lang-mustache-client-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.common.text.TextTemplateEngine.render(TextTemplateEngine.java:58) [x-pack-watcher-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.actions.logging.ExecutableLoggingAction.execute(ExecutableLoggingAction.java:45) [x-pack-watcher-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.core.watcher.actions.ActionWrapper.execute(ActionWrapper.java:144) [x-pack-core-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.execution.ExecutionService.executeInner(ExecutionService.java:460) [x-pack-watcher-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.execution.ExecutionService.execute(ExecutionService.java:299) [x-pack-watcher-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.transport.actions.execute.TransportExecuteWatchAction$1.doRun(TransportExecuteWatchAction.java:149) [x-pack-watcher-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\r\n04:35:13 \tat java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\r\n04:35:13 \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n04:35:13 \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n04:35:13 \tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n04:35:13 Caused by: java.lang.IllegalArgumentException: Iterable object is self-referencing itself (CustomReflectionObjectHandler stringify)\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:267) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:270) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:270) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:270) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:242) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.script.mustache.CustomReflectionObjectHandler.stringify(CustomReflectionObjectHandler.java:160) ~[lang-mustache-client-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat com.github.mustachejava.codes.ValueCode.execute(ValueCode.java:69) ~[compiler-0.9.3.jar:?]\r\n04:35:13 \t... 20 more\r\n04:35:13 [2019-02-27T04:35:12,358][ERROR][o.e.x.w.a.l.ExecutableLoggingAction] [node-0] failed to execute action [_inlined_/my-logging]\r\n04:35:13 org.elasticsearch.script.GeneralScriptException: Error running com.github.mustachejava.codes.DefaultMustache@786363e1\r\n04:35:13 \tat org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.execute(MustacheScriptEngine.java:124) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.common.text.TextTemplateEngine.render(TextTemplateEngine.java:58) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.actions.logging.ExecutableLoggingAction.execute(ExecutableLoggingAction.java:45) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.xpack.core.watcher.actions.ActionWrapper.execute(ActionWrapper.java:144) [x-pack-core-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.execution.ExecutionService.executeInner(ExecutionService.java:460) [x-pack-watcher-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.execution.ExecutionService.execute(ExecutionService.java:299) [x-pack-watcher-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.xpack.watcher.transport.actions.execute.TransportExecuteWatchAction$1.doRun(TransportExecuteWatchAction.java:149) [x-pack-watcher-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\r\n04:35:13 \tat java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\r\n04:35:13 \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:681) [elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n04:35:13 \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n04:35:13 \tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n04:35:13 Caused by: com.github.mustachejava.MustacheException: Failed to get value for ctx @[query-template:1]\r\n04:35:13 \tat com.github.mustachejava.codes.ValueCode.execute(ValueCode.java:74) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultMustache.run(DefaultMustache.java:34) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultCode.execute(DefaultCode.java:162) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultMustache.execute(DefaultMustache.java:55) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.Mustache.execute(Mustache.java:38) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.lambda$execute$0(MustacheScriptEngine.java:119) ~[?:?]\r\n04:35:13 \tat java.security.AccessController.doPrivileged(Native Method) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.execute(MustacheScriptEngine.java:118) ~[?:?]\r\n04:35:13 \t... 13 more\r\n04:35:13 Caused by: java.lang.IllegalArgumentException: Iterable object is self-referencing itself (CustomReflectionObjectHandler stringify)\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:267) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:270) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:270) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:270) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.common.util.CollectionUtils.ensureNoSelfReferences(CollectionUtils.java:242) ~[elasticsearch-8.0.0-SNAPSHOT.jar:8.0.0-SNAPSHOT]\r\n04:35:13 \tat org.elasticsearch.script.mustache.CustomReflectionObjectHandler.stringify(CustomReflectionObjectHandler.java:160) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.codes.ValueCode.execute(ValueCode.java:69) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultMustache.run(DefaultMustache.java:34) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultCode.execute(DefaultCode.java:162) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.codes.DefaultMustache.execute(DefaultMustache.java:55) ~[?:?]\r\n04:35:13 \tat com.github.mustachejava.Mustache.execute(Mustache.java:38) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.lambda$execute$0(MustacheScriptEngine.java:119) ~[?:?]\r\n04:35:13 \tat java.security.AccessController.doPrivileged(Native Method) ~[?:?]\r\n04:35:13 \tat org.elasticsearch.script.mustache.MustacheScriptEngine$MustacheExecutableScript.execute(MustacheScriptEngine.java:118) ~[?:?]\r\n04:35:13 \t... 13 more\r\n04:35:13 =========================================\r\n04:35:13 :x-pack:qa:smoke-test-watcher:integTestRunner (Thread[Execution worker for ':' Thread 7,5,main]) completed. Took 14.863 secs.\r\n04:35:13 :x-pack:qa:smoke-test-watcher:integTestCluster#stop (Thread[Execution worker for ':' Thread 7,5,main]) started.\r\n04:35:13 \r\n04:35:13 > Task :x-pack:qa:smoke-test-watcher:integTestCluster#stop\r\n04:35:13 Task ':x-pack:qa:smoke-test-watcher:integTestCluster#stop' is not up-to-date because:\r\n04:35:13   Task has not declared any outputs despite executing actions.\r\n04:35:13 Custom actions are attached to task ':x-pack:qa:smoke-test-watcher:integTestCluster#stop'.\r\n04:35:13 Shutting down external node with pid 275430\r\n04:35:13 Starting process 'command 'kill''. Working directory: /var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic/x-pack/qa/smoke-test-watcher Command: kill -9 275430\r\n04:35:13 Successfully started process 'command 'kill''\r\n04:35:13 :x-pack:qa:smoke-test-watcher:integTestCluster#stop (Thread[Execution worker for ':' Thread 7,5,main]) completed. Took 0.006 secs.\r\n04:35:13 \r\n04:35:13 \r\n04:35:13 FAILURE: Build failed with an exception.\r\n04:35:13 Deprecated Gradle features were used in this build, making it incompatible with Gradle 6.0.\r\n04:35:13 Use '--warning-mode all' to show the individual deprecation warnings.\r\n04:35:13 See https://docs.gradle.org/5.2.1/userguide/command_line_interface.html#sec:command_line_warnings\r\n04:35:13 \r\n04:35:13 4998 actionable tasks: 2646 executed, 2352 up-to-date\r\n04:35:13 * What went wrong:\r\n04:35:13 Execution failed for task ':x-pack:qa:smoke-test-watcher:integTestRunner'.\r\n04:35:13 > There were test failures: 3 suites, 23 tests, 1 failure [seed: 37D3466CC78964DE]\r\n04:35:13 \r\n04:35:13 * Try:\r\n04:35:13 Run with --stacktrace option to get the stack trace. Run with --debug option to get more log output. Run with --scan to get full insights.\r\n04:35:13 \r\n04:35:13 * Get more help at https://help.gradle.org\r\n04:35:13 \r\n04:35:13 BUILD FAILED in 2h 58m 10s\r\n04:35:13 \r\n04:35:13 Publishing build scan...\r\n04:35:14 https://gradle.com/s/f2z2tmrm2icti\r\n04:35:14 \r\n04:35:15 runbld>>> <<<<<<<<<<<< SCRIPT EXECUTION END <<<<<<<<<<<<\r\n04:35:15 runbld>>> DURATION: 11384070ms\r\n04:35:15 runbld>>> STDOUT: 24661127 bytes\r\n04:35:15 runbld>>> STDERR: 115672 bytes\r\n04:35:15 runbld>>> WRAPPED PROCESS: FAILURE (1)\r\n04:35:15 runbld>>> Searching for build metadata in /var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic\r\n04:35:23 runbld>>> Storing build metadata: bwc_refspec_distribution:bwc:minor=a9e86bc941776083ca36525fdecd4b1944d1f199;bwc_refspec_distribution:bwc:staged=4f1a0cc4fd15acd67b47fe01ba4aea37a41dd547\r\n04:35:23 runbld>>> Adding test report.\r\n04:35:23 runbld>>> Searching for junit test output files with the pattern: TEST-.*\\.xml$ in: /var/lib/jenkins/workspace/elastic+elasticsearch+master+periodic\r\n04:35:30 runbld>>> Found 3790 test output files\r\n04:36:05 runbld>>> Test output logs contained: Errors: 0 Failures: 1 Tests: 35311 Skipped: 652\r\n04:36:05 runbld>>> Storing result\r\n04:36:05 runbld>>> FAILURES: 1\r\n04:36:06 runbld>>> Store result: updated {:total 2, :successful 2, :failed 0} 2\r\n04:36:06 runbld>>> BUILD: https://c150076387b5421f9154dfbf536e5c60.us-west1.gcp.cloud.es.io:9243/build-1531848254847/t/20190227012527-DD895739\r\n04:36:19 runbld>>> MAILING: build-elasticsearch@e***.co\r\n04:36:21 runbld>>> Mail sent.  Output: {:code 0, :error :SUCCESS, :message \"messages sent\"}\r\n\r\n</details>\r\n\r\nI muted the test again in 69fe79a85ea27ad6228ecde02d54cad83b462f6d","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/575235207","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-575235207","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":575235207,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NTIzNTIwNw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-01-16T16:33:53Z","updated_at":"2020-01-16T16:33:53Z","author_association":"MEMBER","body":"It just failed again with the above commit: https://gradle-enterprise.elastic.co/s/4665fyvjoklhy\r\n\r\nI'm going to mute the test for now and look into the logs that have been produced.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577885953","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-577885953","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":577885953,"node_id":"MDEyOklzc3VlQ29tbWVudDU3Nzg4NTk1Mw==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2020-01-23T21:30:09Z","updated_at":"2020-01-23T21:30:09Z","author_association":"MEMBER","body":"Failure with NPE, but I think this might be from the test itself\r\n\r\nhttps://gradle-enterprise.elastic.co/s/mjpliukhzhawm\r\n\r\n```\r\n./gradlew ':x-pack:qa:smoke-test-watcher:integTestRunner' --tests \"org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT.testMonitorClusterHealth\" \\\r\n  -Dtests.seed=849FC7F5DD295954 \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=th-TH \\\r\n  -Dtests.timezone=Asia/Nicosia \\\r\n  -Dcompiler.java=13\r\n```\r\n```\r\njava.lang.NullPointerException\r\n        at __randomizedtesting.SeedInfo.seed([849FC7F5DD295954:77475E952E4836DE]:0)\r\n        at org.elasticsearch.smoketest.SmokeTestWatcherTestSuiteIT.testMonitorClusterHealth(SmokeTestWatcherTestSuiteIT.java:159)\r\n\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578016081","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-578016081","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":578016081,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODAxNjA4MQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-01-24T07:03:47Z","updated_at":"2020-01-24T07:03:47Z","author_association":"MEMBER","body":"Thanks @polyfractal. This test failed a few times. I will mute it and investigate the logs.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578084685","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-578084685","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":578084685,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODA4NDY4NQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-01-24T11:01:04Z","updated_at":"2020-01-24T11:01:04Z","author_association":"MEMBER","body":"The NPE is caused by the fact that history docs where returned with a state :`not_executed_already_queued`. This events docs have a `result` json object, which causes the code to retrieve `hits.hits.0._source.result.condition.met` to return `null`. The test then tries to cast this is a `boolean`, which results in a NPE. The history doc that does contain a `result` object is returned, but not as the first hit. I will fix this shortly.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578631305","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-578631305","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":578631305,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODYzMTMwNQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-01-27T07:58:45Z","updated_at":"2020-01-27T07:58:45Z","author_association":"MEMBER","body":"This test has failed a few times over the weekend. I will mute this test and analyse the failures.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/580183403","html_url":"https://github.com/elastic/elasticsearch/issues/32299#issuecomment-580183403","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32299","id":580183403,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MDE4MzQwMw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-01-30T10:16:19Z","updated_at":"2020-01-30T10:16:19Z","author_association":"MEMBER","body":"I think #51466 has fixed this issue. If this test fails again then a new issue should be opened and possible reference this issue if the failure looks similar.","performed_via_github_app":null}]