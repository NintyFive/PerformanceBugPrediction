{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10868","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10868/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10868/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10868/events","html_url":"https://github.com/elastic/elasticsearch/issues/10868","id":71796831,"node_id":"MDU6SXNzdWU3MTc5NjgzMQ==","number":10868,"title":"Stop - start sequence drives to IllegalThreadStateException","user":{"login":"atomcat1978","id":5517738,"node_id":"MDQ6VXNlcjU1MTc3Mzg=","avatar_url":"https://avatars2.githubusercontent.com/u/5517738?v=4","gravatar_id":"","url":"https://api.github.com/users/atomcat1978","html_url":"https://github.com/atomcat1978","followers_url":"https://api.github.com/users/atomcat1978/followers","following_url":"https://api.github.com/users/atomcat1978/following{/other_user}","gists_url":"https://api.github.com/users/atomcat1978/gists{/gist_id}","starred_url":"https://api.github.com/users/atomcat1978/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atomcat1978/subscriptions","organizations_url":"https://api.github.com/users/atomcat1978/orgs","repos_url":"https://api.github.com/users/atomcat1978/repos","events_url":"https://api.github.com/users/atomcat1978/events{/privacy}","received_events_url":"https://api.github.com/users/atomcat1978/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-04-29T07:03:12Z","updated_at":"2015-05-22T09:25:35Z","closed_at":"2015-05-22T09:25:27Z","author_association":"NONE","active_lock_reason":null,"body":"After a node is created, and stop()-start() method is called sequentially, an IllegalThreadStateException is thrown.\n\nSe below:\n\n<pre>\nException in thread \"main\" java.lang.IllegalThreadStateException\n    at java.lang.Thread.start(Thread.java:705)\n    at org.elasticsearch.indices.ttl.IndicesTTLService.doStart(IndicesTTLService.java:95)\n    at org.elasticsearch.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:85)\n    at org.elasticsearch.node.internal.InternalNode.start(InternalNode.java:245)\n    at no.capraconsulting.esbug.App.main(App.java:31)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:483)\n    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:134)\n</pre>\n\n\nThe problem seems to be in the `IndicesTTLService` class. Its `purgerThread` attribute is in `Thread.State.TERMINATED` as `purgerThread.start()` is invoked from `IndicesTTLService::start`.\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}