{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23426","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23426/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23426/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23426/events","html_url":"https://github.com/elastic/elasticsearch/issues/23426","id":211005816,"node_id":"MDU6SXNzdWUyMTEwMDU4MTY=","number":23426,"title":"Issue with TransportClient on 5.2.1","user":{"login":"rozing","id":13348722,"node_id":"MDQ6VXNlcjEzMzQ4NzIy","avatar_url":"https://avatars1.githubusercontent.com/u/13348722?v=4","gravatar_id":"","url":"https://api.github.com/users/rozing","html_url":"https://github.com/rozing","followers_url":"https://api.github.com/users/rozing/followers","following_url":"https://api.github.com/users/rozing/following{/other_user}","gists_url":"https://api.github.com/users/rozing/gists{/gist_id}","starred_url":"https://api.github.com/users/rozing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rozing/subscriptions","organizations_url":"https://api.github.com/users/rozing/orgs","repos_url":"https://api.github.com/users/rozing/repos","events_url":"https://api.github.com/users/rozing/events{/privacy}","received_events_url":"https://api.github.com/users/rozing/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2017-03-01T07:59:05Z","updated_at":"2017-07-16T06:33:53Z","closed_at":"2017-03-01T08:27:18Z","author_association":"NONE","active_lock_reason":null,"body":"hi,\r\nthis is a copy from: https://discuss.elastic.co/t/issue-with-transportclient-on-5-2-1/76827\r\ni'm trying to upgrade our ES to 5.2.1 from 2.3.1 and i'm having a ton of issues...\r\ncurrently i'm facing the following problem:\r\nour java application uses the TransportClient for connecting to our ES servers.\r\ni'm following your \"updated\" documentation and it seems to be obsolete..\r\nhttps://www.elastic.co/guide/en/elasticsearch/client/java-api/current/transport-client.html1\r\ni'm assuming PreBuiltTransportClient is a class i create that should derive from TransportClient?\r\nour old code(2.3.1) is as follows:\r\n\r\nfinal Settings.Builder settings = Settings.settingsBuilder();\r\nsettings.put(\"cluster.name\", config.get(\"cluster.name\", \"elasticsearch\"));\r\nsettings.put(\"client.transport.sniff\", config.getBoolean(\"client.transport.sniff\", true));\r\nsettings.put(\"client.transport.ignore_cluster_name\", config.getBoolean(\"client.transport.ignore_cluster_name\", true));\r\nsettings.put(\"client.transport.ping_timeout\", config.get(\"client.transport.ping_timeout\", \"10s\"));\r\nsettings.put(\"client.transport.nodes_sampler_interval\", config.get(\"client.transport.nodes_sampler_interval\", \"10s\"));\r\nsettings.put(\"node.data\", config.getBoolean(\"node.data\", false));\r\n\r\nfinal TransportClient transportclient = new TransportClient.Builder().settings(settings).build();\r\ntransportclient.addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(IP[for this example localhost or 127.0.0.1 will do]), 9300));\r\n\r\nthen we call the .perpareSearch etc etc...\r\n\r\nI've converted the code to compile with the 5.2.1 java sdk,\r\nthese are the errors:\r\n\r\nfirst i got the Unsupported transport.type [] error, which i've somehow found other guys with the same problem and \"fixed\" it by adding settings.put(\"transport.type\", \"local\"); (tho i believe it is a bad fix!)\r\nsince there are no other transport types available... tho it is probably problematic since we need to execute the request on a remote machine eventually..\r\nLocalTransport.java in the doStart creates a default localAddress with a value of \"1\".... I tried giving it a value of 127.0.0.1 by setting the param \"transport.local.address\" in settings i got an exception that this param is not valid in settings..... (a change from 5.0...)\r\n\r\nnow my debug observations:\r\nafter setting the localAdress, next the TransportClientNodesService.addTransportAddresses is being called (to add my custom node address(127.0.0.1:9300).\r\nthen TransportClientNodesService.SniffNodesSampler::doSample::run is being called to verify that the node i've given is \"connectable\"..\r\nit goes to LocalTransport::connectToNode and looks inside the \"transports\" map that contains only the key \"1\" to verify if the current node i'm adding (\"127.0.0.1\") exists there.. obviously it doesn't, since only \"1\" exists there...\r\nthen it gets ConnectTransportException and the node is not added to the connectedNodes...\r\nso finally i get the lovely result: NoNodeAvailableException[None of the configured nodes are available: [{#transport#-1}{YAsFCt4NR6aGgs2TqlQpKg}{localhost}{127.0.0.1:9300}]]\r\n\r\nmy code is:\r\npublic PgwsTransportClient(final Settings settings) {\r\nsuper(settings, Collections.EMPTY_LIST);\r\n}\r\n\r\nfinal Settings.Builder settingsBuilder = Settings.builder();\r\nsettingsBuilder.put(\"cluster.name\", config.get(\"cluster.name\", \"elasticsearch\"));\r\nsettingsBuilder.put(\"client.transport.sniff\", config.getBoolean(\"client.transport.sniff\", true));\r\nsettingsBuilder.put(\"client.transport.ignore_cluster_name\", config.getBoolean(\"client.transport.ignore_cluster_name\", true));\r\nsettingsBuilder.put(\"client.transport.ping_timeout\", config.get(\"client.transport.ping_timeout\", \"10s\"));\r\nsettingsBuilder.put(\"client.transport.nodes_sampler_interval\", config.get(\"client.transport.nodes_sampler_interval\", \"10s\"));\r\nsettingsBuilder.put(\"transport.type\", \"local\");\r\nsettingsBuilder.put(\"node.data\", config.getBoolean(\"node.data\", false));\r\nSettings settings = settingsBuilder.build();\r\n\r\nTransportClient transportclient = new PgwsTransportClient(settings);\r\ntransportclient.addTransportAddress(new InetSocketTransportAddress(InetAddress.getByName(\"127.0.0.1\"), 9300));\r\n\r\nthe issues summary:\r\n1) untested documentation\r\n2) tansport.type -> only local is available...\r\n3) when using local transport type, it won't connect to localhost\r\n4) can't set \"transport.local.address\" param in settings\r\n\r\nbest regards","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}