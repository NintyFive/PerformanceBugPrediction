{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/52126","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52126/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52126/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/52126/events","html_url":"https://github.com/elastic/elasticsearch/issues/52126","id":562334397,"node_id":"MDU6SXNzdWU1NjIzMzQzOTc=","number":52126,"title":"[CI][7.x] CCR downgrade-to-basic-license timeout waiting for yellow","user":{"login":"tvernum","id":2244393,"node_id":"MDQ6VXNlcjIyNDQzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/2244393?v=4","gravatar_id":"","url":"https://api.github.com/users/tvernum","html_url":"https://github.com/tvernum","followers_url":"https://api.github.com/users/tvernum/followers","following_url":"https://api.github.com/users/tvernum/following{/other_user}","gists_url":"https://api.github.com/users/tvernum/gists{/gist_id}","starred_url":"https://api.github.com/users/tvernum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tvernum/subscriptions","organizations_url":"https://api.github.com/users/tvernum/orgs","repos_url":"https://api.github.com/users/tvernum/repos","events_url":"https://api.github.com/users/tvernum/events{/privacy}","received_events_url":"https://api.github.com/users/tvernum/received_events","type":"User","site_admin":false},"labels":[{"id":912824565,"node_id":"MDU6TGFiZWw5MTI4MjQ1NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/CCR","name":":Distributed/CCR","color":"0e8a16","default":false,"description":"Issues around the Cross Cluster State Replication features"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"assignees":[{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-02-10T05:29:35Z","updated_at":"2020-02-17T16:55:08Z","closed_at":"2020-02-17T16:55:08Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"- https://gradle-enterprise.elastic.co/s/rogeosz34u2de/console-log?task=:x-pack:plugin:ccr:qa:downgrade-to-basic-license:follow-clusterRunner\r\n- https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+matrix-java-periodic/ES_RUNTIME_JAVA=corretto11,nodes=general-purpose/503/console\r\n\r\n_Doesn't reproduce_\r\n```\r\n./gradlew ':x-pack:plugin:ccr:qa:downgrade-to-basic-license:follow-clusterRunner' \\\r\n  --tests \"org.elasticsearch.xpack.ccr.FollowIndexIT.testDowngradeRemoteClusterToBasic\" \\\r\n  -Dtests.seed=F143CD0F19764898 \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-IQ -Dtests.timezone=CET \\\r\n  -Dcompiler.java=13\r\n```\r\n\r\n```\r\nrg.elasticsearch.xpack.ccr.FollowIndexIT > testDowngradeRemoteClusterToBasic FAILED\t\r\n    org.elasticsearch.client.ResponseException: method [GET], host [http://127.0.0.1:39119], URI [/_cluster/health/logs-20190101?level=shards&wait_for_no_initializing_shards=true&wait_for_status=yellow&wait_for_active_shards=1&wait_for_no_relocating_shards=true&timeout=5s], status line [HTTP/1.1 408 Request Timeout]\t\r\n    {\"cluster_name\":\"follow-cluster\",\"status\":\"yellow\",\"timed_out\":true,\"number_of_nodes\":1,\"number_of_data_nodes\":1,\"active_primary_shards\":0,\"active_shards\":0,\"relocating_shards\":0,\"initializing_shards\":1,\"unassigned_shards\":1,\"delayed_unassigned_shards\":0,\"number_of_pending_tasks\":8,\"number_of_in_flight_fetch\":0,\"task_max_waiting_in_queue_millis\":2647,\"active_shards_percent_as_number\":50.0,\"indices\":{\"logs-20190101\":{\"status\":\"yellow\",\"number_of_shards\":1,\"number_of_replicas\":1,\"active_primary_shards\":0,\"active_shards\":0,\"relocating_shards\":0,\"initializing_shards\":1,\"unassigned_shards\":1,\"shards\":{\"0\":{\"status\":\"yellow\",\"primary_active\":false,\"active_shards\":0,\"relocating_shards\":0,\"initializing_shards\":1,\"unassigned_shards\":1}}}}}\t\r\n        at __randomizedtesting.SeedInfo.seed([F143CD0F19764898:9DD8623DF648135E]:0)\t\r\n        at org.elasticsearch.client.RestClient.convertResponse(RestClient.java:283)\t\r\n        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:261)\t\r\n        at org.elasticsearch.client.RestClient.performRequest(RestClient.java:235)\t\r\n        at org.elasticsearch.xpack.ccr.ESCCRRestTestCase.ensureYellow(ESCCRRestTestCase.java:225)\t\r\n        at org.elasticsearch.xpack.ccr.ESCCRRestTestCase.ensureYellow(ESCCRRestTestCase.java:214)\t\r\n        at org.elasticsearch.xpack.ccr.FollowIndexIT.lambda$testDowngradeRemoteClusterToBasic$0(FollowIndexIT.java:49)\t\r\n        at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:893)\t\r\n        at org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:878)\t\r\n        at org.elasticsearch.xpack.ccr.FollowIndexIT.testDowngradeRemoteClusterToBasic(FollowIndexIT.java:48)\r\n```\r\n\r\n<details><summary>Node Log</summary>\r\n\r\n#### Follow Cluster Log\r\n```\r\n» [2020-02-10T04:42:21,815][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=16}\t\r\n» [2020-02-10T04:42:21,851][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [17] with uuid [mGX1C2WuSqGQ8pM16E3SdA], diff size [560]\t\r\n» [2020-02-10T04:42:22,055][INFO ][o.e.l.LicenseService     ] [follow-cluster-0] license [3c73c800-1bb0-4d06-b95a-a5899fa73228] mode [trial] - valid\t\r\n» [2020-02-10T04:42:22,056][INFO ][o.e.x.s.s.SecurityStatusChangeListener] [follow-cluster-0] Active license is now [TRIAL]; Security is disabled\t\r\n» [2020-02-10T04:42:22,057][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=17}\t\r\n» [2020-02-10T04:42:22,072][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [18] with uuid [ACM7Z8_LQv6RonPKKWfpag], diff size [294]\t\r\n» [2020-02-10T04:42:22,181][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=18}\t\r\n» [2020-02-10T04:42:22,187][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [19] with uuid [QeGPtBzDShuxRGTVs4LBGQ], diff size [427]\t\r\n» [2020-02-10T04:42:22,332][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=19}\t\r\n» [2020-02-10T04:42:26,842][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [20] with uuid [JoQId75gSHO4hcVD3jJoWQ], diff size [200]\t\r\n» [2020-02-10T04:42:26,953][INFO ][o.e.x.c.a.AutoFollowCoordinator] [follow-cluster-0] starting auto-follower for remote cluster [leader_cluster]\t\r\n» [2020-02-10T04:42:26,973][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=20}\t\r\n» [2020-02-10T04:42:28,187][INFO ][o.e.c.m.MetaDataCreateIndexService] [follow-cluster-0] [.watches] creating index, cause [auto(bulk api)], templates [.watches], shards [1]/[0], mappings [_doc]\t\r\n» [2020-02-10T04:42:28,823][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [21] with uuid [_oP4O82MQmSgwB_ZAAbWAQ], diff size [632]\t\r\n» [2020-02-10T04:42:29,992][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=21}\t\r\n» [2020-02-10T04:42:30,515][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [22] with uuid [ijB_cpwpROufLOT8zrAalA], diff size [696]\t\r\n» [2020-02-10T04:42:30,736][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=22}\t\r\n» [2020-02-10T04:42:30,742][INFO ][o.e.x.c.a.AutoFollowCoordinator] [follow-cluster-0] Auto followed leader index [logs-20190101] as follow index [logs-20190101]\t\r\n» [2020-02-10T04:42:30,971][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [23] with uuid [YmVPGDA7S2GqFmT2uYHsKw], diff size [488]\t\r\n» [2020-02-10T04:42:31,279][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=23}\t\r\n» [2020-02-10T04:42:31,359][INFO ][o.e.c.m.MetaDataCreateIndexService] [follow-cluster-0] [.monitoring-es-7-2020.02.10] creating index, cause [auto(bulk api)], templates [.monitoring-es], shards [1]/[0], mappings [_doc]\t\r\n» [2020-02-10T04:42:31,399][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [24] with uuid [fFBDGH75TsaxWceTFiVmRw], diff size [2364]\t\r\n» [2020-02-10T04:42:31,625][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=24}\t\r\n» [2020-02-10T04:42:31,685][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [25] with uuid [AxrgdF1ZQ5KPo95aS-iIUg], diff size [376]\t\r\n» [2020-02-10T04:42:31,891][INFO ][o.e.x.w.WatcherService   ] [follow-cluster-0] reloading watcher, reason [new local watcher shard allocation ids], cancelled [0] queued tasks\t\r\n» [2020-02-10T04:42:31,971][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=25}\t\r\n» [2020-02-10T04:42:32,020][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [26] with uuid [_NZwucieTHSjqP0CctuN9Q], diff size [401]\t\r\n» [2020-02-10T04:42:32,425][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=26}\t\r\n» [2020-02-10T04:42:32,529][INFO ][o.e.c.m.MetaDataMappingService] [follow-cluster-0] [.watches/k-Z4J6-7TLiKpRE5mQ-zUQ] update_mapping [_doc]\t\r\n» [2020-02-10T04:42:32,617][INFO ][o.e.c.m.MetaDataMappingService] [follow-cluster-0] [.watches/k-Z4J6-7TLiKpRE5mQ-zUQ] update_mapping [_doc]\t\r\n» [2020-02-10T04:42:32,651][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [27] with uuid [b-1U9ouGSzeNm1drGn6o5g], diff size [711]\t\r\n» [2020-02-10T04:42:33,120][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=27}\t\r\n» [2020-02-10T04:42:33,583][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [28] with uuid [9kK0ncWrQ8mdiYpKhpev5g], diff size [223]\t\r\n» [2020-02-10T04:42:33,942][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=28}\t\r\n» [2020-02-10T04:42:33,956][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [29] with uuid [IHR6uMltREOqCnyBK5lkcA], diff size [458]\t\r\n» [2020-02-10T04:42:34,081][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=29}\t\r\n» [2020-02-10T04:42:34,100][DEBUG][o.e.c.c.PublicationTransportHandler] [follow-cluster-0] received diff cluster state version [30] with uuid [xIFLDwQRQ3e2TAWQFwRTDw], diff size [156]\t\r\n» [2020-02-10T04:42:34,225][DEBUG][o.e.c.c.C.CoordinatorPublication] [follow-cluster-0] publication ended successfully: Publication{term=1, version=30}\t\r\n» [2020-02-10T04:42:34.293944Z] [BUILD] Stopping node\r\n```\r\n</details>","closed_by":{"login":"dnhatn","id":13474362,"node_id":"MDQ6VXNlcjEzNDc0MzYy","avatar_url":"https://avatars3.githubusercontent.com/u/13474362?v=4","gravatar_id":"","url":"https://api.github.com/users/dnhatn","html_url":"https://github.com/dnhatn","followers_url":"https://api.github.com/users/dnhatn/followers","following_url":"https://api.github.com/users/dnhatn/following{/other_user}","gists_url":"https://api.github.com/users/dnhatn/gists{/gist_id}","starred_url":"https://api.github.com/users/dnhatn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnhatn/subscriptions","organizations_url":"https://api.github.com/users/dnhatn/orgs","repos_url":"https://api.github.com/users/dnhatn/repos","events_url":"https://api.github.com/users/dnhatn/events{/privacy}","received_events_url":"https://api.github.com/users/dnhatn/received_events","type":"User","site_admin":false},"performed_via_github_app":null}