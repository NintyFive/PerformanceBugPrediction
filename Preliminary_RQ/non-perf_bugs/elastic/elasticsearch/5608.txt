{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5608","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5608/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5608/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5608/events","html_url":"https://github.com/elastic/elasticsearch/issues/5608","id":30468858,"node_id":"MDU6SXNzdWUzMDQ2ODg1OA==","number":5608,"title":"Aggregations; Support bucket-leve calculated aggregations","user":{"login":"roytmana","id":2524911,"node_id":"MDQ6VXNlcjI1MjQ5MTE=","avatar_url":"https://avatars0.githubusercontent.com/u/2524911?v=4","gravatar_id":"","url":"https://api.github.com/users/roytmana","html_url":"https://github.com/roytmana","followers_url":"https://api.github.com/users/roytmana/followers","following_url":"https://api.github.com/users/roytmana/following{/other_user}","gists_url":"https://api.github.com/users/roytmana/gists{/gist_id}","starred_url":"https://api.github.com/users/roytmana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roytmana/subscriptions","organizations_url":"https://api.github.com/users/roytmana/orgs","repos_url":"https://api.github.com/users/roytmana/repos","events_url":"https://api.github.com/users/roytmana/events{/privacy}","received_events_url":"https://api.github.com/users/roytmana/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-03-30T16:43:05Z","updated_at":"2014-11-13T12:05:03Z","closed_at":"2014-11-13T12:05:03Z","author_association":"NONE","active_lock_reason":null,"body":"There are many cases where a metrics is based on one or more aggregated values within the same bucket. For example if you need to calculate an effectiveness rate of product development as total amount generated by a product sales divided by all the money invested into the product and group it by product, FY etc.\n\nI would like to be able to define an aggregation as a \"calculated\"\n\"Calculated\" aggregations would be evaluated last after all real ones and based on values of the real ones. \n\nYou could go even further and have an expression language working on against aggregate level\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}