[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/577323081","html_url":"https://github.com/elastic/elasticsearch/issues/51329#issuecomment-577323081","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51329","id":577323081,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NzMyMzA4MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-22T18:32:16Z","updated_at":"2020-01-22T18:32:16Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed (:Distributed/Distributed)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578304211","html_url":"https://github.com/elastic/elasticsearch/issues/51329#issuecomment-578304211","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51329","id":578304211,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODMwNDIxMQ==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2020-01-24T21:12:45Z","updated_at":"2020-01-24T21:12:45Z","author_association":"CONTRIBUTOR","body":"This `ClusterDisruptionIT` test failure looks related:\r\nhttps://gradle-enterprise.elastic.co/s/pvcdd3ofnjkws/tests/kyv2y2z3r4v7m-5jnxwnv3ti4aw?open-stacktraces=WzBd\r\n\r\nin that it also has:\r\n\r\n```\r\norg.elasticsearch.ElasticsearchException: publication cancelled before committing: timed out after 1s\r\n```\r\n\r\nThis affects two builds, one on 21st January and one on 22nd January:\r\n\r\nhttps://build-stats.elastic.co/app/kibana#/discover?_g=(refreshInterval:(pause:!t,value:0),time:(from:now-60d,mode:quick,to:now))&_a=(columns:!(_source),index:f0e86d70-7efd-11e8-bf69-63c8ef516157,interval:auto,query:(language:lucene,query:'log:%20%22publication%20cancelled%20before%20committing:%20timed%20out%20after%201s%22'),sort:!(time,desc))\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578538448","html_url":"https://github.com/elastic/elasticsearch/issues/51329#issuecomment-578538448","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51329","id":578538448,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODUzODQ0OA==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2020-01-26T20:14:30Z","updated_at":"2020-01-26T20:41:58Z","author_association":"CONTRIBUTOR","body":"[One more](https://gradle-enterprise.elastic.co/s/umqmke7psdp64/tests/kyv2y2z3r4v7m-f6hbue3yhtsqi?open-stacktraces=WzBd) `ClusterDisruptionIT` failure (`testAckedIndexing`). It has:\r\n\r\n```\r\n[2020-01-25T07:40:50,994][DEBUG][o.e.g.PersistedClusterStateService] [node_t1] writing cluster state took [802ms]; wrote global metadata [false] and metadata for [1] indices and skipped [0] unchanged indices\r\n[2020-01-25T07:40:50,995][TRACE][o.e.d.PeerFinder         ] [node_t1] deactivating and setting leader to {node_t2}{QtOY0rJkRXmpkH0xgGHoZg}{Ea30Kzn6QHC22qRyh0R3fQ}{127.0.0.1}{127.0.0.1:38941}{dim}\r\n[2020-01-25T07:40:50,995][TRACE][o.e.d.PeerFinder         ] [node_t1] not active\r\n[2020-01-25T07:40:51,091][DEBUG][o.e.g.PersistedClusterStateService] [node_t0] writing cluster state took [1011ms]; wrote global metadata [false] and metadata for [1] indices and skipped [0] unchanged indices\r\n[2020-01-25T07:40:51,091][TRACE][o.e.d.PeerFinder         ] [node_t0] deactivating and setting leader to {node_t2}{QtOY0rJkRXmpkH0xgGHoZg}{Ea30Kzn6QHC22qRyh0R3fQ}{127.0.0.1}{127.0.0.1:38941}{dim}\r\n[2020-01-25T07:40:51,091][TRACE][o.e.d.PeerFinder         ] [node_t0] not active\r\n[2020-01-25T07:40:51,093][DEBUG][o.e.g.PersistedClusterStateService] [node_t2] writing cluster state took [1020ms]; wrote global metadata [false] and metadata for [1] indices and skipped [0] unchanged indices\r\n```\r\n\r\nwhich seems the likely cause of the publication timeout:\r\n\r\n```\r\n[2020-01-25T07:40:51,094][DEBUG][o.e.c.s.M.AckCountDownListener] [node_t2] ack received from node [{node_t0}{b_u8b1vZThyx--PcTJ-Cbg}{ZmPcAsP_T2y2y0RhkvXt_w}{127.0.0.1}{127.0.0.1:39767}{dim}], cluster_state update (version: 4)\r\norg.elasticsearch.ElasticsearchException: publication cancelled before committing: timed out after 1s\r\n\tat org.elasticsearch.cluster.coordination.Publication.cancel(Publication.java:86) [main/:?]\r\n\tat org.elasticsearch.cluster.coordination.Coordinator$CoordinatorPublication$2.run(Coordinator.java:1303) [main/:?]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:633) [main/:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:832) [?:?]\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/578543527","html_url":"https://github.com/elastic/elasticsearch/issues/51329#issuecomment-578543527","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51329","id":578543527,"node_id":"MDEyOklzc3VlQ29tbWVudDU3ODU0MzUyNw==","user":{"login":"henningandersen","id":33268011,"node_id":"MDQ6VXNlcjMzMjY4MDEx","avatar_url":"https://avatars2.githubusercontent.com/u/33268011?v=4","gravatar_id":"","url":"https://api.github.com/users/henningandersen","html_url":"https://github.com/henningandersen","followers_url":"https://api.github.com/users/henningandersen/followers","following_url":"https://api.github.com/users/henningandersen/following{/other_user}","gists_url":"https://api.github.com/users/henningandersen/gists{/gist_id}","starred_url":"https://api.github.com/users/henningandersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/henningandersen/subscriptions","organizations_url":"https://api.github.com/users/henningandersen/orgs","repos_url":"https://api.github.com/users/henningandersen/repos","events_url":"https://api.github.com/users/henningandersen/events{/privacy}","received_events_url":"https://api.github.com/users/henningandersen/received_events","type":"User","site_admin":false},"created_at":"2020-01-26T21:10:49Z","updated_at":"2020-01-30T15:30:43Z","author_association":"CONTRIBUTOR","body":"Running `testAckedIndexing` locally does not reveal the same long write times. Opened #51462 to increase logging for `PersistedClusterStateService` to see if it gives a hint into where the time is spent on CI.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/581318763","html_url":"https://github.com/elastic/elasticsearch/issues/51329#issuecomment-581318763","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51329","id":581318763,"node_id":"MDEyOklzc3VlQ29tbWVudDU4MTMxODc2Mw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2020-02-03T09:28:34Z","updated_at":"2020-02-03T09:28:34Z","author_association":"CONTRIBUTOR","body":"I wonder if we should increase the timeout. \"1s\" for publication timeout is very little time (same for leader and follower checks) for any small stalls to cause test failures. Also note that these tests randomly use multiple data paths, which means that the cluster state needs to be sequentially written to multiple paths. I would increase the timeouts to \"5s\" as this will only affect tests with NetworkUnresponsive disruption.","performed_via_github_app":null}]