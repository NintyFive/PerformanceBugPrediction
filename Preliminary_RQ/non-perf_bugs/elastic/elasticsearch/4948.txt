{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4948","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4948/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4948/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4948/events","html_url":"https://github.com/elastic/elasticsearch/issues/4948","id":26569174,"node_id":"MDU6SXNzdWUyNjU2OTE3NA==","number":4948,"title":"Mapping update on stored field requires a restart","user":{"login":"aflag","id":33273,"node_id":"MDQ6VXNlcjMzMjcz","avatar_url":"https://avatars1.githubusercontent.com/u/33273?v=4","gravatar_id":"","url":"https://api.github.com/users/aflag","html_url":"https://github.com/aflag","followers_url":"https://api.github.com/users/aflag/followers","following_url":"https://api.github.com/users/aflag/following{/other_user}","gists_url":"https://api.github.com/users/aflag/gists{/gist_id}","starred_url":"https://api.github.com/users/aflag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aflag/subscriptions","organizations_url":"https://api.github.com/users/aflag/orgs","repos_url":"https://api.github.com/users/aflag/repos","events_url":"https://api.github.com/users/aflag/events{/privacy}","received_events_url":"https://api.github.com/users/aflag/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-01-30T01:37:18Z","updated_at":"2014-12-24T19:01:30Z","closed_at":"2014-12-24T19:01:30Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\n\nElasticsearch is not working as I expect when I change the mapping of a stored field to a multi_field.\n\nI create an index called test, then assign a mapping to it. The mapping contains a field called _title_ which is stored string.\n\nI add a document with a _title_ to the index.\n\nI change the mapping of _title_ to multi_field. The multi_field has two subfields: title and simple_title. Both strings. Neither stored.\n\nI add a new document with a _title_ to the index.\n\nA query which specifies that only the field _title_ should be shown returns two documents but no fields. Restarting elasticsearch makes the same query display the _title_ field correctly. Is that expected behaviour?\n\nBelow are the same actions written in ES-friendly way:\n\n```\nPUT test\n{\n    \"index\" : {\n        \"number_of_shards\": 5,\n        \"number_of_replicas\" : 0\n    }\n}\n\nPUT test/test/_mapping\n{\n    \"test\": {\n        \"properties\": {\n            \"title\": {\n                \"type\": \"string\",\n                \"store\": \"yes\"\n            }\n        }\n    }\n}\n\nPUT test/test/before_mapping_update\n{\n   \"title\": \"hello oi oi\"\n}\n\nPUT test/test/_mapping\n{\n    \"test\": {\n        \"properties\": {\n            \"title\": {\n                \"type\": \"multi_field\",\n                \"fields\": {\n                    \"title\": {\"type\":\"string\"},\n                    \"title_simple\": {\"type\":\"string\"}\n                }\n            }\n        }\n    }\n}\n\nPUT test/test/after_mapping_update\n{\n   \"title\": \"hello oi oi\"\n}\n\nPOST test/test/_search\n{\n    \"fields\":[\"title\"],\n    \"query\":{\n        \"match_all\": {}    \n    }\n}\n```\n\nCheers,\nRafael\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}