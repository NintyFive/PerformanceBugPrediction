{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53267","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53267/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53267/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53267/events","html_url":"https://github.com/elastic/elasticsearch/issues/53267","id":577687216,"node_id":"MDU6SXNzdWU1Nzc2ODcyMTY=","number":53267,"title":"property totalHits is always 0 on BoolQuery Search response","user":{"login":"durancu","id":858387,"node_id":"MDQ6VXNlcjg1ODM4Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/858387?v=4","gravatar_id":"","url":"https://api.github.com/users/durancu","html_url":"https://github.com/durancu","followers_url":"https://api.github.com/users/durancu/followers","following_url":"https://api.github.com/users/durancu/following{/other_user}","gists_url":"https://api.github.com/users/durancu/gists{/gist_id}","starred_url":"https://api.github.com/users/durancu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/durancu/subscriptions","organizations_url":"https://api.github.com/users/durancu/orgs","repos_url":"https://api.github.com/users/durancu/repos","events_url":"https://api.github.com/users/durancu/events{/privacy}","received_events_url":"https://api.github.com/users/durancu/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2020-03-09T06:29:12Z","updated_at":"2020-03-19T05:04:34Z","closed_at":"2020-03-19T05:03:21Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\n**Describe the feature**: totalHits property always returns 0, but hits contains items\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 7.6\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 8\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): MacOS\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nI am using Java REST Client to implement a microservice that integrates to Elasticsearch (via AWS).\r\nWhen I am debugging, I see totalHits is coming always as zero (0),\r\nIf I run same query in Kibana, it returns the right value of totalHits.\r\n\r\nI create a boolQuery, with several must queries inside it. For the example I am debugging, I have a BoolQueryBuilder object, and the generated query is:\r\n\r\n```\r\n{\r\n  \"bool\" : {\r\n    \"must\" : [\r\n      {\r\n        \"match_phrase\" : {\r\n          \"wellSiteName.keyword\" : {\r\n            \"query\" : \"XXXXXXX 501H, 502H\",\r\n            \"slop\" : 0,\r\n            \"zero_terms_query\" : \"NONE\",\r\n            \"boost\" : 1.0\r\n          }\r\n        }\r\n      }\r\n    ],\r\n    \"adjust_pure_negative\" : true,\r\n    \"boost\" : 1.0\r\n  }\r\n}\r\n```\r\n\r\nThis is my request object toString:\r\n\r\n```\r\nSearchRequest{searchType=QUERY_THEN_FETCH, indices=[], indicesOptions=IndicesOptions[ignore_unavailable=false, allow_no_indices=true, expand_wildcards_open=true, expand_wildcards_closed=false, allow_aliases_to_multiple_indices=true, forbid_closed_indices=true, ignore_aliases=false], types=[], routing='null', preference='null', requestCache=null, scroll=null, maxConcurrentShardRequests=0, batchedReduceSize=512, preFilterShardSize=128, allowPartialSearchResults=null, source={\"query\":{\"bool\":{\"must\":[{\"match_phrase\":{\"wellSiteName.keyword\":{\"query\":\"WINNEBAGO 30 STATE COM 501H, 502H\",\"slop\":0,\"zero_terms_query\":\"NONE\",\"boost\":1.0}}}],\"adjust_pure_negative\":true,\"boost\":1.0}}}}\r\n```\r\n\r\nThis is the response I get:\r\n\r\n<img width=\"1074\" alt=\"Screen Shot 2020-03-09 at 1 19 44 AM\" src=\"https://user-images.githubusercontent.com/858387/76187763-37fbc880-61a4-11ea-860a-055a1bb47ed9.png\">\r\n\r\nAs you can see, despites there are many hits, `totalHits` property is 0\r\n\r\nHowever, if I run same query in Kibana, I get a number of totalHits matching that query, that is not 0\r\n\r\n![Screen Shot 2020-03-09 at 1 22 23 AM](https://user-images.githubusercontent.com/858387/76187862-801aeb00-61a4-11ea-8d99-86c55e038141.png)\r\n\r\n\r\n**Steps to reproduce**:\r\n\r\n1- Create a BoolQueryBuilder object\r\n2- Add a must query to the object, using matchPhraseQuery, on a keyword column\r\n3- Create a SearchRequest object\r\n4- Create a SearchSourceBuilder object\r\n5- Add BoolQueryBuilder object to SearchSourceBuilder object as query\r\n6- Set SearchSourceBuilder object as source of SearchRequest.\r\n7- Call Elasticsearch client using SearchRequest object and RequestOptions.DEFAULT\r\n\r\n","closed_by":{"login":"durancu","id":858387,"node_id":"MDQ6VXNlcjg1ODM4Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/858387?v=4","gravatar_id":"","url":"https://api.github.com/users/durancu","html_url":"https://github.com/durancu","followers_url":"https://api.github.com/users/durancu/followers","following_url":"https://api.github.com/users/durancu/following{/other_user}","gists_url":"https://api.github.com/users/durancu/gists{/gist_id}","starred_url":"https://api.github.com/users/durancu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/durancu/subscriptions","organizations_url":"https://api.github.com/users/durancu/orgs","repos_url":"https://api.github.com/users/durancu/repos","events_url":"https://api.github.com/users/durancu/events{/privacy}","received_events_url":"https://api.github.com/users/durancu/received_events","type":"User","site_admin":false},"performed_via_github_app":null}