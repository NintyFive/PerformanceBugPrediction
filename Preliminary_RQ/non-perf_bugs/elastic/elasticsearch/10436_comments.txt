[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89838497","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-89838497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":89838497,"node_id":"MDEyOklzc3VlQ29tbWVudDg5ODM4NDk3","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T19:35:39Z","updated_at":"2015-04-05T19:35:39Z","author_association":"CONTRIBUTOR","body":"Hi @r0goyal \n\nYou've given us incomplete information, eg how you set the template up, what the document contains, what you mean by \"the mapping is not applied\" (ie all of it? or just some field mappings?) etc.\n\nA simple recreation of the problem would be appreciated.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/89843786","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-89843786","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":89843786,"node_id":"MDEyOklzc3VlQ29tbWVudDg5ODQzNzg2","user":{"login":"r0goyal","id":3274291,"node_id":"MDQ6VXNlcjMyNzQyOTE=","avatar_url":"https://avatars1.githubusercontent.com/u/3274291?v=4","gravatar_id":"","url":"https://api.github.com/users/r0goyal","html_url":"https://github.com/r0goyal","followers_url":"https://api.github.com/users/r0goyal/followers","following_url":"https://api.github.com/users/r0goyal/following{/other_user}","gists_url":"https://api.github.com/users/r0goyal/gists{/gist_id}","starred_url":"https://api.github.com/users/r0goyal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r0goyal/subscriptions","organizations_url":"https://api.github.com/users/r0goyal/orgs","repos_url":"https://api.github.com/users/r0goyal/repos","events_url":"https://api.github.com/users/r0goyal/events{/privacy}","received_events_url":"https://api.github.com/users/r0goyal/received_events","type":"User","site_admin":false},"created_at":"2015-04-05T20:00:08Z","updated_at":"2015-04-05T20:00:08Z","author_association":"NONE","body":"Hi @clintongormley \n\nFollowing is the code snippet\n\n``` java\n    public static void main(String[] args) throws IOException {\n        ImmutableSettings.Builder elasticsearchSettings = ImmutableSettings.settingsBuilder()\n                .put(\"http.enabled\", \"false\")\n                .put(\"path.data\", \"target/\" + UUID.randomUUID().toString());\n\n        Node esNode = nodeBuilder()\n                .local(true)\n                .settings(elasticsearchSettings.build())\n                .node();\n        Client client = esNode.client();\n\n        PutIndexTemplateRequest templateRequest = getClusterTemplateMapping(client.admin().indices());\n        client.admin().indices().putTemplate(templateRequest).actionGet();\n\n        String index = \"foxtrot-abcd\";\n        String type = \"document\";\n\n        Map<String, String> data = Collections.singletonMap(\"abcd\", \"abcd\");\n        client.prepareIndex()\n                .setIndex(index)\n                .setType(type)\n                .setId(UUID.randomUUID().toString())\n                .setTimestamp(Long.toString(System.currentTimeMillis()))\n                .setConsistencyLevel(WriteConsistencyLevel.QUORUM)\n                .setSource(new ObjectMapper().writeValueAsString(data))\n                .execute()\n                .actionGet();\n\n        GetMappingsResponse mappingsResponse = client.admin().indices()\n                .prepareGetMappings(index)\n                .execute().actionGet();\n        MappingMetaData metaData = mappingsResponse.getMappings().get(index).get(type);\n    }\n    public static PutIndexTemplateRequest getClusterTemplateMapping(IndicesAdminClient indicesAdminClient) {\n        PutIndexTemplateRequestBuilder builder = new PutIndexTemplateRequestBuilder(indicesAdminClient, \"generic_template\");\n        builder.setTemplate(\"foxtrot-*\");\n        builder.addMapping(\"document\", \"{\\n\" +\n                \"            \\\"_source\\\" : { \\\"enabled\\\" : false },\\n\" +\n                \"            \\\"_all\\\" : { \\\"enabled\\\" : false },\\n\" +\n                \"            \\\"_timestamp\\\" : { \\\"enabled\\\" : true, \\\"store\\\" : true },\\n\" +\n                \"\\n\" +\n                \"            \\\"dynamic_templates\\\" : [\\n\" +\n                \"                {\\n\" +\n                \"                    \\\"template_timestamp\\\" : {\\n\" +\n                \"                        \\\"match\\\" : \\\"timestamp\\\",\\n\" +\n                \"                        \\\"mapping\\\" : {\\n\" +\n                \"                            \\\"store\\\" : false,\\n\" +\n                \"                            \\\"index\\\" : \\\"not_analyzed\\\",\\n\" +\n                \"                            \\\"type\\\" : \\\"date\\\"\\n\" +\n                \"                        }\\n\" +\n                \"                    }\\n\" +\n                \"                },\\n\" +\n                \"                {\\n\" +\n                \"                    \\\"template_no_store_analyzed\\\" : {\\n\" +\n                \"                        \\\"match\\\" : \\\"*\\\",\\n\" +\n                \"                        \\\"match_mapping_type\\\" : \\\"string\\\",\\n\" +\n                \"                        \\\"mapping\\\" : {\\n\" +\n                \"                            \\\"store\\\" : false,\\n\" +\n                \"                            \\\"index\\\" : \\\"not_analyzed\\\",\\n\" +\n                \"                            \\\"fields\\\" : {\\n\" +\n                \"                                \\\"analyzed\\\": {\\n\" +\n                \"                                    \\\"store\\\" : false,\\n\" +\n                \"                                    \\\"type\\\": \\\"string\\\",\\n\" +\n                \"                                    \\\"index\\\": \\\"analyzed\\\"\\n\" +\n                \"                                }\\n\" +\n                \"                            }\\n\" +\n                \"                        }\\n\" +\n                \"                    }\\n\" +\n                \"                },\\n\" +\n                \"                {\\n\" +\n                \"                    \\\"template_no_store\\\" : {\\n\" +\n                \"                        \\\"match_mapping_type\\\": \\\"date|boolean|double|long|integer\\\",\\n\" +\n                \"                        \\\"match_pattern\\\": \\\"regex\\\",\\n\" +\n                \"                        \\\"path_match\\\": \\\".*\\\",\\n\" +\n                \"                        \\\"mapping\\\" : {\\n\" +\n                \"                            \\\"store\\\" : false,\\n\" +\n                \"                            \\\"index\\\" : \\\"not_analyzed\\\"\\n\" +\n                \"                        }\\n\" +\n                \"                    }\\n\" +\n                \"                }\\n\" +\n                \"            ]\\n\" +\n                \"        }\");\n        return builder.request();\n    }\n```\n\nWith ES 1.1.1 to 1.4.0 in classpath, serializing metaData gives \n\n``` json\n{\n    \"dynamic_templates\": [\n        {\n            \"template_timestamp\": {\n                \"mapping\": {\n                    \"index\": \"not_analyzed\",\n                    \"store\": false,\n                    \"type\": \"date\"\n                },\n                \"match\": \"timestamp\"\n            }\n        },\n        {\n            \"template_no_store_analyzed\": {\n                \"mapping\": {\n                    \"index\": \"not_analyzed\",\n                    \"store\": false,\n                    \"fields\": {\n                        \"analyzed\": {\n                            \"index\": \"analyzed\",\n                            \"store\": false,\n                            \"type\": \"string\"\n                        }\n                    }\n                },\n                \"match\": \"*\",\n                \"match_mapping_type\": \"string\"\n            }\n        },\n        {\n            \"template_no_store\": {\n                \"mapping\": {\n                    \"index\": \"not_analyzed\",\n                    \"store\": false\n                },\n                \"match_mapping_type\": \"date|boolean|double|long|integer\",\n                \"match_pattern\": \"regex\",\n                \"path_match\": \".*\"\n            }\n        }\n    ],\n    \"_all\": {\n        \"enabled\": false\n    },\n    \"_timestamp\": {\n        \"enabled\": true,\n        \"store\": true\n    },\n    \"_source\": {\n        \"enabled\": false\n    },\n    \"properties\": {\n        \"abcd\": {\n            \"type\": \"string\",\n            \"index\": \"not_analyzed\",\n            \"fields\": {\n                \"analyzed\": {\n                    \"type\": \"string\"\n                }\n            }\n        }\n    }\n}\n```\n\nHowever with ES 1.4.1 and above, only following mapping is present - \n\n``` json\n{\"properties\":{\"abcd\":{\"type\":\"string\"}}}\n```\n\nPlease let me know if you need anything else as well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/92725351","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-92725351","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":92725351,"node_id":"MDEyOklzc3VlQ29tbWVudDkyNzI1MzUx","user":{"login":"r0goyal","id":3274291,"node_id":"MDQ6VXNlcjMyNzQyOTE=","avatar_url":"https://avatars1.githubusercontent.com/u/3274291?v=4","gravatar_id":"","url":"https://api.github.com/users/r0goyal","html_url":"https://github.com/r0goyal","followers_url":"https://api.github.com/users/r0goyal/followers","following_url":"https://api.github.com/users/r0goyal/following{/other_user}","gists_url":"https://api.github.com/users/r0goyal/gists{/gist_id}","starred_url":"https://api.github.com/users/r0goyal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r0goyal/subscriptions","organizations_url":"https://api.github.com/users/r0goyal/orgs","repos_url":"https://api.github.com/users/r0goyal/repos","events_url":"https://api.github.com/users/r0goyal/events{/privacy}","received_events_url":"https://api.github.com/users/r0goyal/received_events","type":"User","site_admin":false},"created_at":"2015-04-14T09:46:49Z","updated_at":"2015-04-14T09:46:49Z","author_association":"NONE","body":"@clintongormley Any update on this ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/92862304","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-92862304","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":92862304,"node_id":"MDEyOklzc3VlQ29tbWVudDkyODYyMzA0","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-14T14:00:46Z","updated_at":"2015-04-14T14:00:46Z","author_association":"CONTRIBUTOR","body":"Can anybody who can read Java give some feedback here?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/94458671","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-94458671","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":94458671,"node_id":"MDEyOklzc3VlQ29tbWVudDk0NDU4Njcx","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-04-20T13:59:55Z","updated_at":"2015-04-20T13:59:55Z","author_association":"MEMBER","body":"I had a look and can confirm this behaviour. You should wrap the whole mapping object, including `dynamic_templates` etc. into a `document` object in the json, which is what your type is called. Not sure why this used to work with 1.4.0 to be honest (I confirm it does), do you know @clintongormley ?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/94892589","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-94892589","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":94892589,"node_id":"MDEyOklzc3VlQ29tbWVudDk0ODkyNTg5","user":{"login":"r0goyal","id":3274291,"node_id":"MDQ6VXNlcjMyNzQyOTE=","avatar_url":"https://avatars1.githubusercontent.com/u/3274291?v=4","gravatar_id":"","url":"https://api.github.com/users/r0goyal","html_url":"https://github.com/r0goyal","followers_url":"https://api.github.com/users/r0goyal/followers","following_url":"https://api.github.com/users/r0goyal/following{/other_user}","gists_url":"https://api.github.com/users/r0goyal/gists{/gist_id}","starred_url":"https://api.github.com/users/r0goyal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r0goyal/subscriptions","organizations_url":"https://api.github.com/users/r0goyal/orgs","repos_url":"https://api.github.com/users/r0goyal/repos","events_url":"https://api.github.com/users/r0goyal/events{/privacy}","received_events_url":"https://api.github.com/users/r0goyal/received_events","type":"User","site_admin":false},"created_at":"2015-04-21T18:11:25Z","updated_at":"2015-04-21T18:11:25Z","author_association":"NONE","body":"@javanna I am already wrapping this whole mapping in \"document\" object in the Json.  Look at the getClusterTemplateMapping() method. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/95055442","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-95055442","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":95055442,"node_id":"MDEyOklzc3VlQ29tbWVudDk1MDU1NDQy","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-04-22T07:12:50Z","updated_at":"2015-04-22T07:12:50Z","author_association":"MEMBER","body":"Hi @r0goyal I ran your code, I see you are passing in the type as an argument, but the mapping itself doesn't contain the document type: `builder.addMapping(\"document\", \"{\\n\" + \\\"_source\\\" : { \\\"enabled\\\" : false },....\"` should be `builder.addMapping(\"document\", \"{ \\\"document\\\" : { \\n\" + \\\"_source\\\" : { \\\"enabled\\\" : false },....}\"`, that is what I meant. If you do that you should work around the problem you are seeing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96258488","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-96258488","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":96258488,"node_id":"MDEyOklzc3VlQ29tbWVudDk2MjU4NDg4","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-04-25T18:39:33Z","updated_at":"2015-04-25T18:39:33Z","author_association":"CONTRIBUTOR","body":"@javanna that seems very odd.  Is `addMapping` the equivalent of the update mapping REST API?  \n\nIn the REST layer, we support passing the mapping with the type name and without.  In fact, I thought we preferred the version without the type name, but I see the docs still show the example with type name: http://www.elastic.co/guide/en/elasticsearch/reference/current/indices-put-mapping.html\n\nNo idea what changed in 1.4\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/96971942","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-96971942","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":96971942,"node_id":"MDEyOklzc3VlQ29tbWVudDk2OTcxOTQy","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T08:27:36Z","updated_at":"2015-04-28T13:35:28Z","author_association":"MEMBER","body":"agreed @clintongormley it is odd, I have no idea either what changed in 1.4 to be honest, only tested and acknowledged the problem.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/97066420","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-97066420","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":97066420,"node_id":"MDEyOklzc3VlQ29tbWVudDk3MDY2NDIw","user":{"login":"r0goyal","id":3274291,"node_id":"MDQ6VXNlcjMyNzQyOTE=","avatar_url":"https://avatars1.githubusercontent.com/u/3274291?v=4","gravatar_id":"","url":"https://api.github.com/users/r0goyal","html_url":"https://github.com/r0goyal","followers_url":"https://api.github.com/users/r0goyal/followers","following_url":"https://api.github.com/users/r0goyal/following{/other_user}","gists_url":"https://api.github.com/users/r0goyal/gists{/gist_id}","starred_url":"https://api.github.com/users/r0goyal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/r0goyal/subscriptions","organizations_url":"https://api.github.com/users/r0goyal/orgs","repos_url":"https://api.github.com/users/r0goyal/repos","events_url":"https://api.github.com/users/r0goyal/events{/privacy}","received_events_url":"https://api.github.com/users/r0goyal/received_events","type":"User","site_admin":false},"created_at":"2015-04-28T13:34:58Z","updated_at":"2015-04-28T13:34:58Z","author_association":"NONE","body":"@javanna Yes it started working with the fix suggested by you. Thanks a lot.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/172060358","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-172060358","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":172060358,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MjA2MDM1OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-15T19:26:13Z","updated_at":"2016-01-15T19:26:13Z","author_association":"CONTRIBUTOR","body":"In summary, an `addMapping` request in the Java API requires the mapping to be wrapped in a JSON object with the type name as a key, while the REST API allows you to specify the mapping directly without this extra layer.\n\nShould we change the Java API to work in the same way as the REST layer?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/212504215","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-212504215","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":212504215,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMjUwNDIxNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-20T16:35:28Z","updated_at":"2016-04-20T16:35:28Z","author_association":"CONTRIBUTOR","body":"Another person just bitten by this in #17886 \n\nWe should make the Java API consistent with the REST api.  Should be easy to do as using a type name at the top level will throw an exception (bad mapping)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298199111","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-298199111","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":298199111,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODE5OTExMQ==","user":{"login":"billnbell","id":25377089,"node_id":"MDQ6VXNlcjI1Mzc3MDg5","avatar_url":"https://avatars2.githubusercontent.com/u/25377089?v=4","gravatar_id":"","url":"https://api.github.com/users/billnbell","html_url":"https://github.com/billnbell","followers_url":"https://api.github.com/users/billnbell/followers","following_url":"https://api.github.com/users/billnbell/following{/other_user}","gists_url":"https://api.github.com/users/billnbell/gists{/gist_id}","starred_url":"https://api.github.com/users/billnbell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/billnbell/subscriptions","organizations_url":"https://api.github.com/users/billnbell/orgs","repos_url":"https://api.github.com/users/billnbell/repos","events_url":"https://api.github.com/users/billnbell/events{/privacy}","received_events_url":"https://api.github.com/users/billnbell/received_events","type":"User","site_admin":false},"created_at":"2017-04-29T22:45:08Z","updated_at":"2017-04-29T22:45:08Z","author_association":"NONE","body":"I got bitten today on 5.3.1","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/372618743","html_url":"https://github.com/elastic/elasticsearch/issues/10436#issuecomment-372618743","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10436","id":372618743,"node_id":"MDEyOklzc3VlQ29tbWVudDM3MjYxODc0Mw==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2018-03-13T10:29:39Z","updated_at":"2018-03-13T10:29:39Z","author_association":"MEMBER","body":"I can't reproduce this problem any more.\r\n\r\nJava code\r\n\r\n```java\r\npublic class Application {\r\n\r\n    public static void main(String[] args) throws Exception {\r\n        Settings settings = Settings.builder()\r\n                .put(\"cluster.name\", \"distribution_run\").build();\r\n        try (TransportClient client = new PreBuiltTransportClient(settings)\r\n                .addTransportAddress(new TransportAddress(InetAddress.getByName(\"localhost\"), 9300))) {\r\n            PutIndexTemplateRequest templateRequest = getClusterTemplateMapping(client.admin().indices());\r\n            client.admin().indices().putTemplate(templateRequest).actionGet();\r\n\r\n            String index = \"foxtrot-abcd\";\r\n            String type = \"document\";\r\n\r\n            Map<String, String> data = Collections.singletonMap(\"abcd\", \"abcd\");\r\n            client.prepareIndex()\r\n                    .setIndex(index)\r\n                    .setType(type)\r\n                    .setId(UUID.randomUUID().toString())\r\n                    .setSource(data)\r\n                    .execute()\r\n                    .actionGet();\r\n\r\n            GetMappingsResponse mappingsResponse = client.admin().indices()\r\n                    .prepareGetMappings(index)\r\n                    .execute().actionGet();\r\n            MappingMetaData metaData = mappingsResponse.getMappings().get(index).get(type);\r\n        }\r\n    }\r\n\r\n    private static PutIndexTemplateRequest getClusterTemplateMapping(IndicesAdminClient indicesAdminClient) {\r\n        PutIndexTemplateRequestBuilder builder = indicesAdminClient.preparePutTemplate(\"generic_template\");\r\n        builder.setPatterns(Collections.singletonList(\"foxtrot-*\"));\r\n        builder.addMapping(\"document\", \"{\\n\" +\r\n                \"            \\\"_source\\\" : { \\\"enabled\\\" : false },\\n\" +\r\n                \"\\n\" +\r\n                \"            \\\"dynamic_templates\\\" : [\\n\" +\r\n                \"                {\\n\" +\r\n                \"                    \\\"template_timestamp\\\" : {\\n\" +\r\n                \"                        \\\"match\\\" : \\\"timestamp\\\",\\n\" +\r\n                \"                        \\\"mapping\\\" : {\\n\" +\r\n                \"                            \\\"store\\\" : false,\\n\" +\r\n                \"                            \\\"index\\\" : \\\"true\\\",\\n\" +\r\n                \"                            \\\"type\\\" : \\\"date\\\"\\n\" +\r\n                \"                        }\\n\" +\r\n                \"                    }\\n\" +\r\n                \"                },\\n\" +\r\n                \"                {\\n\" +\r\n                \"                    \\\"template_no_store_analyzed\\\" : {\\n\" +\r\n                \"                        \\\"match\\\" : \\\"*\\\",\\n\" +\r\n                \"                        \\\"match_mapping_type\\\" : \\\"string\\\",\\n\" +\r\n                \"                        \\\"mapping\\\" : {\\n\" +\r\n                \"                            \\\"type\\\" : \\\"text\\\"\\n\" +\r\n                \"                        }\\n\" +\r\n                \"                    }\\n\" +\r\n                \"                },\\n\" +\r\n                \"                {\\n\" +\r\n                \"                    \\\"template_no_store\\\" : {\\n\" +\r\n                \"                        \\\"match_mapping_type\\\": \\\"string\\\",\\n\" +\r\n                \"                        \\\"match_pattern\\\": \\\"regex\\\",\\n\" +\r\n                \"                        \\\"path_match\\\": \\\".*\\\",\\n\" +\r\n                \"                        \\\"mapping\\\" : {\\n\" +\r\n                \"                            \\\"store\\\" : false,\\n\" +\r\n                \"                            \\\"index\\\" : \\\"true\\\"\\n\" +\r\n                \"                        }\\n\" +\r\n                \"                    }\\n\" +\r\n                \"                }\\n\" +\r\n                \"            ]\\n\" +\r\n                \"        }\", XContentType.JSON);\r\n        return builder.request();\r\n    }\r\n\r\n}\r\n```\r\n\r\nand this resulted in the expected mapping:\r\n\r\n```json\r\n{\r\n  \"foxtrot-abcd\" : {\r\n    \"mappings\" : {\r\n      \"document\" : {\r\n        \"_source\" : {\r\n          \"enabled\" : false\r\n        },\r\n        \"dynamic_templates\" : [\r\n          {\r\n            \"template_timestamp\" : {\r\n              \"match\" : \"timestamp\",\r\n              \"mapping\" : {\r\n                \"index\" : \"true\",\r\n                \"store\" : false,\r\n                \"type\" : \"date\"\r\n              }\r\n            }\r\n          },\r\n          {\r\n            \"template_no_store_analyzed\" : {\r\n              \"match\" : \"*\",\r\n              \"match_mapping_type\" : \"string\",\r\n              \"mapping\" : {\r\n                \"type\" : \"text\"\r\n              }\r\n            }\r\n          },\r\n          {\r\n            \"template_no_store\" : {\r\n              \"path_match\" : \".*\",\r\n              \"match_mapping_type\" : \"string\",\r\n              \"match_pattern\" : \"regex\",\r\n              \"mapping\" : {\r\n                \"index\" : \"true\",\r\n                \"store\" : false\r\n              }\r\n            }\r\n          }\r\n        ],\r\n        \"properties\" : {\r\n          \"abcd\" : {\r\n            \"type\" : \"text\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```","performed_via_github_app":null}]