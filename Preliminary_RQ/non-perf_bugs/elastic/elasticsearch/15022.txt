{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/15022","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15022/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15022/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/15022/events","html_url":"https://github.com/elastic/elasticsearch/issues/15022","id":118871227,"node_id":"MDU6SXNzdWUxMTg4NzEyMjc=","number":15022,"title":"when filtering after a 'terms_stats' sort query isnt applied v1.5.0","user":{"login":"BarryGr","id":16019643,"node_id":"MDQ6VXNlcjE2MDE5NjQz","avatar_url":"https://avatars0.githubusercontent.com/u/16019643?v=4","gravatar_id":"","url":"https://api.github.com/users/BarryGr","html_url":"https://github.com/BarryGr","followers_url":"https://api.github.com/users/BarryGr/followers","following_url":"https://api.github.com/users/BarryGr/following{/other_user}","gists_url":"https://api.github.com/users/BarryGr/gists{/gist_id}","starred_url":"https://api.github.com/users/BarryGr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BarryGr/subscriptions","organizations_url":"https://api.github.com/users/BarryGr/orgs","repos_url":"https://api.github.com/users/BarryGr/repos","events_url":"https://api.github.com/users/BarryGr/events{/privacy}","received_events_url":"https://api.github.com/users/BarryGr/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-11-25T16:16:52Z","updated_at":"2015-11-28T17:30:33Z","closed_at":"2015-11-28T17:30:33Z","author_association":"NONE","active_lock_reason":null,"body":"Hi All\n\nI am having an issue with using terms_stats in Kibana, I am not on current version due to problems with the new Kibana interface. \n\nThis is the first time I have come across this, I am trying to get back a very small section of data however only the date filters seem to get applied before the data is returned. this means a large response is returned but the data is null. I have tried changing \"should\" to \"Must\" and it still doesnt work.\n\nI have tried\n\nHas this already been addressed?\n\ndoes anyone know a fix for this ?\n\nMany thanks \n\nBarry\n\n{\n    \"facets\": {\n        \"terms\": {\n            \"terms_stats\": {\n                \"value_field\": \"AverageSeconds.raw\",\n                \"key_field\": \"Machine.raw\",\n                \"size\": 2,\n                \"order\": \"term\"\n            },\n            \"facet_filter\": {\n                \"fquery\": {\n                    \"query\": {\n                        \"filtered\": {\n                            \"query\": {\n                                \"bool\": {\n                                    \"should\": [{\n                                        \"query_string\": {\n                                            \"query\": \"type:S_Agent AND SourceName.raw:S_Averages\"\n                                        }\n                                    }]\n                                }\n                            },\n                            \"filter\": {\n                                \"bool\": {\n                                    \"must\": [{\n                                        \"range\": {\n                                            \"@timestamp\": {\n                                                \"from\": 1447860850443,\n                                                \"to\": 1448465650443\n                                            }\n                                        }\n                                    }]\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    },\n    \"size\": 0\n}'\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}