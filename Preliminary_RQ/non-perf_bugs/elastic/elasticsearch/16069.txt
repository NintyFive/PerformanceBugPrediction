{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/16069","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16069/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16069/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16069/events","html_url":"https://github.com/elastic/elasticsearch/issues/16069","id":127331589,"node_id":"MDU6SXNzdWUxMjczMzE1ODk=","number":16069,"title":"Attachment mapper plugin: configuring sub-fields per documentation results in \"ClassCastException: java.lang.Integer cannot be cast to java.lang.String\"","user":{"login":"dminkovsky","id":218725,"node_id":"MDQ6VXNlcjIxODcyNQ==","avatar_url":"https://avatars1.githubusercontent.com/u/218725?v=4","gravatar_id":"","url":"https://api.github.com/users/dminkovsky","html_url":"https://github.com/dminkovsky","followers_url":"https://api.github.com/users/dminkovsky/followers","following_url":"https://api.github.com/users/dminkovsky/following{/other_user}","gists_url":"https://api.github.com/users/dminkovsky/gists{/gist_id}","starred_url":"https://api.github.com/users/dminkovsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dminkovsky/subscriptions","organizations_url":"https://api.github.com/users/dminkovsky/orgs","repos_url":"https://api.github.com/users/dminkovsky/repos","events_url":"https://api.github.com/users/dminkovsky/events{/privacy}","received_events_url":"https://api.github.com/users/dminkovsky/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-01-18T23:35:38Z","updated_at":"2018-02-13T20:49:19Z","closed_at":"2016-03-01T13:06:45Z","author_association":"NONE","active_lock_reason":null,"body":"Re: Attachment mapper plugin\n\nMigrating this issue from [elastic/elasticsearch-mapper-attachments](https://github.com/elastic/elasticsearch-mapper-attachments/issues/202):\n\nRegarding sub-field mappings, [documentation says](https://www.elastic.co/guide/en/elasticsearch/plugins/master/mapper-attachments-usage.html):\n\n> The other fields map to their respective metadata names, but there is no need to specify the type (like string or date) since it is already known.\n\nThis is either incorrect or misleading because when I set\n\n```\n\"content_length\" : { \"store\" : true }\n```\n\nin my mapping, `content_length` was not indexed. Instead, I got (with errors ignored):\n\n```\n[2016-01-18 17:33:46,053][DEBUG][mapper.attachment        ] Ignoring MapperParsingException catch while parsing content_length: [failed to parse [data.content_length]]: [55]\n```\n\nor (with errors not ignored):\n\n```\n[2016-01-18 17:38:54,660][DEBUG][action.index             ] [Red Ronin] [live][3], node[4-sneDHnRr-n_I9iZpGmEA], [P], v[8], s[STARTED], a[id=HRjjSSzORZKvyrsV3DlDHQ]: Failed to execute [index {[live][attac\nhment][1], source[{ \"data\": \"IkdvZCBTYXZlIHRoZSBRdWVlbiIgKGFsdGVybmF0aXZlbHkgIkdvZCBTYXZlIHRoZSBLaW5nIg==\" }]}]\nMapperParsingException[failed to parse [data.content_length]]; nested: ClassCastException[java.lang.Integer cannot be cast to java.lang.String];\n        at org.elasticsearch.index.mapper.FieldMapper.parse(FieldMapper.java:339)\n        at org.elasticsearch.index.mapper.attachment.AttachmentMapper.parse(AttachmentMapper.java:605)\n```\n\nThis happened because in the resulting mapping, `type` of `content_length` is `string`.\n\n```\n\"content_length\" : {\n    \"type\" : \"string\",\n    \"store\" : true\n}\n```\n\nIt appears that if you specify any properties of a subfield and omit `type`, type is `string`. So in order to store `content_length` and have it work, it must be specified completely as \n\n```\n\"content_length\" : {\n    \"type\" : \"integer\",\n    \"store\" : true\n}\n```\n\nThis appears to be the opposite of what the documentation states.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}