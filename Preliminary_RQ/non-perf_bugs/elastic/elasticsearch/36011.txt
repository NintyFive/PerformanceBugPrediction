{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36011","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36011/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36011/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36011/events","html_url":"https://github.com/elastic/elasticsearch/issues/36011","id":385369416,"node_id":"MDU6SXNzdWUzODUzNjk0MTY=","number":36011,"title":"Unable to parse response from ClearScrollRequest","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"labels":[{"id":493198109,"node_id":"MDU6TGFiZWw0OTMxOTgxMDk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Java%20High%20Level%20REST%20Client","name":":Core/Features/Java High Level REST Client","color":"0e8a16","default":false,"description":"Expressive Java Client for Elasticsearch"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-11-28T17:07:20Z","updated_at":"2018-11-28T17:34:45Z","closed_at":"2018-11-28T17:34:44Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 2.4.4\r\n\r\n**High Level Rest Client version**: 6.4.3\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`): 1.8.0_171\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): 3.10.0-327.el7.x86_64 #1 SMP Thu Oct 29 17:29:29 EDT 2015 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nA `java.io.IOException` is thrown when sending a Clear Scroll Request to Elastic Search. Response code 200 seems to indicate the operation was successful, but its response could not be parsed by the High Level Rest Client.\r\nExpected behaviour is that no exception is thrown.\r\n\r\n**Steps to reproduce**:\r\n\r\nWith version 6.4.3 of the High Level Rest Client, the following code produces the exception:\r\n\r\n```\r\nprivate final RestHighLevelClient client;\r\n\r\nprivate void clearScrollIfFinished(SearchResponse searchResponse) {\r\n        if (searchResponse.getHits().getHits().length == 0) {\r\n            ClearScrollRequest clearScrollRequest = new ClearScrollRequest();\r\n            clearScrollRequest.addScrollId(searchResponse.getScrollId());\r\n\r\n            try {\r\n                LOGGER.debug(\"Clearing scroll with scrollId={}\", searchResponse.getScrollId());\r\n                client.clearScroll(clearScrollRequest, RequestOptions.DEFAULT);\r\n            } catch (IOException e) {\r\n                LOGGER.warn(\"Clear Scroll Request could not be processed\", e);\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n```\r\nDEBUG com.company.service.ElasticSearchClient - Clearing scroll with scrollId=cXVlcnlUaGVuRmV0Y2g7NzsyMTUyNzM6NGtncXlCQldTY3VYdzRTZXRXcnpXZzsyMTUyNzQ6NGtncXlCQldTY3VYdzRTZXRXcnpXZzsyMTUyNzU6NGtncXlCQldTY3VYdzRTZXRXcnpXZzsyMTUyNzc6NGtncXlCQldTY3VYdzRTZXRXcnpXZzsyMTUyNzY6NGtncXlCQldTY3VYdzRTZXRXcnpXZzsyMTUyNzk6NGtncXlCQldTY3VYdzRTZXRXcnpXZzsyMTUyNzg6NGtncXlCQldTY3VYdzRTZXRXcnpXZzswOw==\r\nWARN  com.company.service.ElasticSearchClient - Clear Scroll Request could not be processed\r\njava.io.IOException: Unable to parse response body for Response{requestLine=DELETE /_search/scroll HTTP/1.1, host=https://logging-es:9200, response=HTTP/1.1 200 OK}\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1275) ~[elasticsearch-rest-high-level-client-6.4.3.jar:6.4.3]\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:1231) ~[elasticsearch-rest-high-level-client-6.4.3.jar:6.4.3]\r\n\tat org.elasticsearch.client.RestHighLevelClient.clearScroll(RestHighLevelClient.java:947) ~[elasticsearch-rest-high-level-client-6.4.3.jar:6.4.3]\r\n```\r\n\r\n```\r\nCaused by: java.lang.IllegalArgumentException: Required [succeeded, num_freed]\r\n\tat org.elasticsearch.common.xcontent.ConstructingObjectParser$Target.finish(ConstructingObjectParser.java:449) ~[elasticsearch-x-content-6.5.0.jar:6.5.0]\r\n\tat org.elasticsearch.common.xcontent.ConstructingObjectParser$Target.access$000(ConstructingObjectParser.java:350) ~[elasticsearch-x-content-6.5.0.jar:6.5.0]\r\n\tat org.elasticsearch.common.xcontent.ConstructingObjectParser.parse(ConstructingObjectParser.java:169) ~[elasticsearch-x-content-6.5.0.jar:6.5.0]\r\n\tat org.elasticsearch.common.xcontent.ConstructingObjectParser.apply(ConstructingObjectParser.java:161) ~[elasticsearch-x-content-6.5.0.jar:6.5.0]\r\n\tat org.elasticsearch.action.search.ClearScrollResponse.fromXContent(ClearScrollResponse.java:95) ~[elasticsearch-6.4.3.jar:6.4.3]\r\n\tat org.elasticsearch.client.RestHighLevelClient.parseEntity(RestHighLevelClient.java:1406) ~[elasticsearch-rest-high-level-client-6.4.3.jar:6.4.3]\r\n\tat org.elasticsearch.client.RestHighLevelClient.lambda$performRequestAndParseEntity$9(RestHighLevelClient.java:1232) ~[elasticsearch-rest-high-level-client-6.4.3.jar:6.4.3]\r\n\tat org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:1273) ~[elasticsearch-rest-high-level-client-6.4.3.jar:6.4.3]\r\n\t... 116 more\r\n```","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}