{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27194/events","html_url":"https://github.com/elastic/elasticsearch/issues/27194","id":270091788,"node_id":"MDU6SXNzdWUyNzAwOTE3ODg=","number":27194,"title":"Pending Tasks Queue flooded with Shard-Failed Tasks after loosing a data node.","user":{"login":"russellday","id":5925146,"node_id":"MDQ6VXNlcjU5MjUxNDY=","avatar_url":"https://avatars3.githubusercontent.com/u/5925146?v=4","gravatar_id":"","url":"https://api.github.com/users/russellday","html_url":"https://github.com/russellday","followers_url":"https://api.github.com/users/russellday/followers","following_url":"https://api.github.com/users/russellday/following{/other_user}","gists_url":"https://api.github.com/users/russellday/gists{/gist_id}","starred_url":"https://api.github.com/users/russellday/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/russellday/subscriptions","organizations_url":"https://api.github.com/users/russellday/orgs","repos_url":"https://api.github.com/users/russellday/repos","events_url":"https://api.github.com/users/russellday/events{/privacy}","received_events_url":"https://api.github.com/users/russellday/received_events","type":"User","site_admin":false},"labels":[{"id":836504707,"node_id":"MDU6TGFiZWw4MzY1MDQ3MDc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Distributed","name":":Distributed/Distributed","color":"0e8a16","default":false,"description":"A catch all label for anything in the Distributed Area. If you aren't sure, use this one."},{"id":624853144,"node_id":"MDU6TGFiZWw2MjQ4NTMxNDQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.5.1","name":"v5.5.1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"assignees":[{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false}],"milestone":null,"comments":32,"created_at":"2017-10-31T19:33:43Z","updated_at":"2018-02-13T19:25:23Z","closed_at":"2017-12-18T09:26:51Z","author_association":"NONE","active_lock_reason":null,"body":"I am running a large cluster on public AWS EC2 that ingests significant volume (several TB per day). The cluster will periodically loose a data node, typically due to Heap OOM. When this happens the pending tasks queue fills with several hundred thousand \"Shard-Failed\" tasks. This renders the cluster useless I recycle the cluster several times. I feel it's likely something with either my implementation or configuration because ES should be able to lose data nodes in a more graceful manor. Can I please get some guidance on how I might mitigate this issue?\r\n\r\nI am using the new ROLLOVER API is that is of consequence.\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n5.1.1\r\n\r\n**Plugins installed**: [amazon-cloudwatch, discovery-ec2, repository-s3]\r\n\r\n**JVM version** (`java -version`):\r\n      \"versions\" : [\r\n        {\r\n          \"version\" : \"1.8.0_141\",\r\n          \"vm_name\" : \"OpenJDK 64-Bit Server VM\",\r\n          \"vm_version\" : \"25.141-b16\",\r\n          \"vm_vendor\" : \"Oracle Corporation\",\r\n          \"count\" : 38\r\n        },\r\n        {\r\n          \"version\" : \"1.8.0_151\",\r\n          \"vm_name\" : \"OpenJDK 64-Bit Server VM\",\r\n          \"vm_version\" : \"25.151-b12\",\r\n          \"vm_vendor\" : \"Oracle Corporation\",\r\n          \"count\" : 11\r\n        }\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nAmazon Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n(Above)\r\n\r\n**Steps to reproduce**:\r\nIntermittent, cluster will run fine for a few hours then I will lose a node due to ingestion rate.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\n{\r\n  \"cluster_name\" : \"removed\",\r\n  \"status\" : \"red\",\r\n  \"timed_out\" : false,\r\n  \"number_of_nodes\" : 49,\r\n  \"number_of_data_nodes\" : 35,\r\n  \"active_primary_shards\" : 2112,\r\n  \"active_shards\" : 2492,\r\n  \"relocating_shards\" : 0,\r\n  \"initializing_shards\" : 0,\r\n  \"unassigned_shards\" : 72,\r\n  \"delayed_unassigned_shards\" : 0,\r\n  \"number_of_pending_tasks\" : 423050,\r\n  \"number_of_in_flight_fetch\" : 0,\r\n  \"task_max_waiting_in_queue_millis\" : 8814583,\r\n  \"active_shards_percent_as_number\" : 95.75388767550702\r\n}\r\n\r\n\r\n","closed_by":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"performed_via_github_app":null}