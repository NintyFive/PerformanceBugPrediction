{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/58075","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58075/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58075/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/58075/events","html_url":"https://github.com/elastic/elasticsearch/issues/58075","id":638090382,"node_id":"MDU6SXNzdWU2MzgwOTAzODI=","number":58075,"title":"SearchSourceBuilder not functional on Android","user":{"login":"jhudis","id":16857822,"node_id":"MDQ6VXNlcjE2ODU3ODIy","avatar_url":"https://avatars2.githubusercontent.com/u/16857822?v=4","gravatar_id":"","url":"https://api.github.com/users/jhudis","html_url":"https://github.com/jhudis","followers_url":"https://api.github.com/users/jhudis/followers","following_url":"https://api.github.com/users/jhudis/following{/other_user}","gists_url":"https://api.github.com/users/jhudis/gists{/gist_id}","starred_url":"https://api.github.com/users/jhudis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhudis/subscriptions","organizations_url":"https://api.github.com/users/jhudis/orgs","repos_url":"https://api.github.com/users/jhudis/repos","events_url":"https://api.github.com/users/jhudis/events{/privacy}","received_events_url":"https://api.github.com/users/jhudis/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1967495446,"node_id":"MDU6TGFiZWwxOTY3NDk1NDQ2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Core/Infra","name":"Team:Core/Infra","color":"fef2c0","default":false,"description":"Meta label for core/infra team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-06-13T04:00:23Z","updated_at":"2020-10-16T17:06:47Z","closed_at":"2020-10-16T17:06:46Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests; it is not the place\r\nfor general questions. If you have a question or an unconfirmed bug , please\r\nvisit the [forums](https://discuss.elastic.co/c/elasticsearch).  Please also\r\ncheck your OS is [supported](https://www.elastic.co/support/matrix#show_os).\r\nIf it is not, the issue is likely to be closed.\r\n\r\nFor security vulnerabilities please only send reports to security@elastic.co.\r\nSee https://www.elastic.co/community/security for more information.\r\n\r\nPlease fill in the following details to help us reproduce the bug:\r\n-->\r\n\r\n**Elasticsearch version**: 7.7.1\r\n\r\n**Plugins installed**: Kibana\r\n\r\n**JVM version**: 1.8.0_251\r\n\r\n**OS version**: Android 10\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nOur team is trying to use the Elasticsearch Java High Level REST Client 7.7.1 on an Android device. So far we've only been indexing data, not querying, and that code has been functional. But when trying to simply *instantiate* a `SearchSourceBuilder` object, the following error occurs:\r\n```\r\nCaused by: java.lang.NullPointerException: Attempt to invoke virtual method 'java.security.CodeSource java.security.ProtectionDomain.getCodeSource()' on a null object reference\r\n   at org.elasticsearch.Build.getElasticsearchCodeSourceLocation(Build.java:194)\r\n   at org.elasticsearch.Build.<clinit>(Build.java:137)\r\n   at org.elasticsearch.common.logging.DeprecationLogger.<clinit>(DeprecationLogger.java:154) \r\n   at org.elasticsearch.search.builder.SearchSourceBuilder.<clinit>(SearchSourceBuilder.java:83)\r\n```\r\nThe specific line of code which causes this `NullPointerException` is the following (`Build.java:194`):\r\n```\r\nfinal CodeSource codeSource = Build.class.getProtectionDomain().getCodeSource();\r\n```\r\nApparently, per [this StackOverflow answer](https://stackoverflow.com/questions/27790348/getclass-getprotectiondomain-getcodesource-getlocation-getpath-throw-a), the method `getProtectionDomain()` \"is not implemented in Android's version of Java.\" `Build.class.getProtectionDomain()` thus returns null, hence the `NullPointerException`.\r\n\r\nThis would indicate that any classes which use the `DeprecationLogger`, such as the critically important `SearchSourceBuilder`, will not function on Android. This is an issue with the Java REST Client.\r\n\r\n**Steps to reproduce**:\r\n\r\n 1. Add Elasticsearch Java REST Client 7.7.1 to an Android app\r\n 2. Instantiate a SearchSourceBuilder object\r\n 3. Run the app","closed_by":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"performed_via_github_app":null}