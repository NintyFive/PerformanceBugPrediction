{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8456","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8456/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8456/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8456/events","html_url":"https://github.com/elastic/elasticsearch/issues/8456","id":48533990,"node_id":"MDU6SXNzdWU0ODUzMzk5MA==","number":8456,"title":"ElasticSearch needs faster, smarter recovery from downtime","user":{"login":"roncemer","id":5806658,"node_id":"MDQ6VXNlcjU4MDY2NTg=","avatar_url":"https://avatars2.githubusercontent.com/u/5806658?v=4","gravatar_id":"","url":"https://api.github.com/users/roncemer","html_url":"https://github.com/roncemer","followers_url":"https://api.github.com/users/roncemer/followers","following_url":"https://api.github.com/users/roncemer/following{/other_user}","gists_url":"https://api.github.com/users/roncemer/gists{/gist_id}","starred_url":"https://api.github.com/users/roncemer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roncemer/subscriptions","organizations_url":"https://api.github.com/users/roncemer/orgs","repos_url":"https://api.github.com/users/roncemer/repos","events_url":"https://api.github.com/users/roncemer/events{/privacy}","received_events_url":"https://api.github.com/users/roncemer/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-11-12T16:56:22Z","updated_at":"2014-11-12T19:36:37Z","closed_at":"2014-11-12T19:36:37Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nI've been using ES for about a month now on a 6-node cluster.  There are a few issues ES exhibits when coming up from a failed-node or failed-cluster scenario.  These are pretty major, IMHO, because they result in longer downtime than is absolutely necessary.\n\nPlease forgive me if this is a duplicate issue.  I'm dealing with ES recovery as I write this, so time is at a premium.\n\nOne thing I'm noticing is that ES begins relocating shards as soon as the cluster is started up.  This is bad, because it results in unnecessary delays getting the cluster to the yellow, then green state.  If there are any unassigned or uninitialized shards, or the cluster status is anything other than green, shard relocation should be delayed until everything else is done, all shards are initialized and running, and the cluster state is green.\n\nAn even bigger issue, and you may want to split this into two issues, is that sometimes ES leaves shards unassigned.  It just doesn't assign them.  Even if you have to start up another thread to look for unassigned shards and assign them, under no circumstances should ES ever leave a shard unassigned, period.  Doing this forces the cluster state to red, and forces the admin to manually assign those shards.  This is something ES should take care of automatically.  So...NEVER leave a shard in the unassigned state.\n\nOther than these two bugs in how ES recovers from a downed node or a complete cluster restart, ES has been fabulous for us.  Certainly a night-and-day improvement over Riak.  Keep up the awesome work!\n\nOh...we're running the latest release, downloaded just yesterday, elasticsearch-1.4.0-1.noarch, RPM version, under Amazon Linux (RHEL), x86-64 architecture, on java version 1.7.0_71 (OpenJDK).\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}