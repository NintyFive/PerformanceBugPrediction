[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206521371","html_url":"https://github.com/elastic/elasticsearch/issues/17570#issuecomment-206521371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17570","id":206521371,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjUyMTM3MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T19:22:12Z","updated_at":"2016-04-06T19:22:52Z","author_association":"MEMBER","body":"> It appears that #17288 was taken too far and is not checking that we are overriding to a public interface.\n\nIt wasn't, this is currently how all of the the bootstrap checks operate by design. If you keep the enforced settings at their default, then the checks do not error. If you set any of them, then the checks do error. \n\nIt's not just a simple matter of checking whether or not we are bound to localhost only. For example, we definitely want to consider binding to localhost but publishing to an external interface that nginx or another proxy is listening on to be production mode.\n\nThat said, I have proof-of-concept improvement to this that I want to noodle on a little longer before I turn it into a formal pull request. The main thing that I want think about is whether or not we are failing too late (because with my proof-of-concept we have to startup most services including network services!). This requires caution.\n\nI have it to the point where we can _explicitly_ bind to localhost and pass:\n\n``` bash\n± ~/elasticsearch/elasticsearch-5.0.0-alpha1-SNAPSHOT/bin/elasticsearch -E es.network.host=_local_\n[2016-04-06 15:18:55,165][INFO ][node                     ] [Mr. M] version[5.0.0-alpha1-SNAPSHOT], pid[9512], build[57059f1/2016-04-06T19:13:15.556Z]\n[2016-04-06 15:18:55,165][INFO ][node                     ] [Mr. M] initializing ...\n[2016-04-06 15:18:55,437][INFO ][plugins                  ] [Mr. M] modules [lang-mustache, lang-painless, ingest-grok, reindex, lang-expression, lang-groovy], plugins []\n[2016-04-06 15:18:55,459][INFO ][env                      ] [Mr. M] using [1] data paths, mounts [[/ (/dev/disk1)]], net usable_space [106.8gb], net total_space [232.6gb], spins? [unknown], types [hfs]\n[2016-04-06 15:18:55,459][INFO ][env                      ] [Mr. M] heap size [989.8mb], compressed ordinary object pointers [true]\n[2016-04-06 15:18:56,992][INFO ][node                     ] [Mr. M] initialized\n[2016-04-06 15:18:56,992][INFO ][node                     ] [Mr. M] starting ...\n[2016-04-06 15:18:57,065][INFO ][transport                ] [Mr. M] publish_address {127.0.0.1:9300}, bound_addresses {[fe80::1]:9300}, {[::1]:9300}, {127.0.0.1:9300}\n[2016-04-06 15:18:57,066][WARN ][node                     ] [Mr. M] please set [discovery.zen.minimum_master_nodes] to a majority of the number of master eligible nodes in your cluster.\n[2016-04-06 15:19:00,107][INFO ][cluster.service          ] [Mr. M] new_master {Mr. M}{8Zg2JgGfTwu13BtKjw6LRw}{127.0.0.1}{127.0.0.1:9300}, reason: zen-disco-join(elected_as_master, [0] joins received)\n[2016-04-06 15:19:00,126][INFO ][http                     ] [Mr. M] publish_address {127.0.0.1:9200}, bound_addresses {[fe80::1]:9200}, {[::1]:9200}, {127.0.0.1:9200}\n[2016-04-06 15:19:00,126][INFO ][node                     ] [Mr. M] started\n[2016-04-06 15:19:00,130][INFO ][gateway                  ] [Mr. M] recovered [0] indices into cluster_state\n```\n\nbut bind to localhost and publish externally and fail:\n\n``` bash\n± ~/elasticsearch/elasticsearch-5.0.0-alpha1-SNAPSHOT/bin/elasticsearch -E es.network.host=_local_ -E es.network.publish_host=_en0_\n[2016-04-06 15:20:32,521][INFO ][node                     ] [Ebon Seeker] version[5.0.0-alpha1-SNAPSHOT], pid[9780], build[57059f1/2016-04-06T19:13:15.556Z]\n[2016-04-06 15:20:32,521][INFO ][node                     ] [Ebon Seeker] initializing ...\n[2016-04-06 15:20:32,778][INFO ][plugins                  ] [Ebon Seeker] modules [lang-mustache, lang-painless, ingest-grok, reindex, lang-expression, lang-groovy], plugins []\n[2016-04-06 15:20:32,800][INFO ][env                      ] [Ebon Seeker] using [1] data paths, mounts [[/ (/dev/disk1)]], net usable_space [106.8gb], net total_space [232.6gb], spins? [unknown], types [hfs]\n[2016-04-06 15:20:32,800][INFO ][env                      ] [Ebon Seeker] heap size [989.8mb], compressed ordinary object pointers [true]\n[2016-04-06 15:20:34,181][INFO ][node                     ] [Ebon Seeker] initialized\n[2016-04-06 15:20:34,181][INFO ][node                     ] [Ebon Seeker] starting ...\n[2016-04-06 15:20:34,256][INFO ][transport                ] [Ebon Seeker] publish_address {192.168.1.8:9300}, bound_addresses {[fe80::1]:9300}, {[::1]:9300}, {127.0.0.1:9300}\nException in thread \"main\" java.lang.RuntimeException: please set [discovery.zen.minimum_master_nodes] to a majority of the number of master eligible nodes in your cluster.\n        at org.elasticsearch.bootstrap.BootstrapCheck.check(BootstrapCheck.java:79)\n        at org.elasticsearch.node.Node.start(Node.java:331)\n        at org.elasticsearch.bootstrap.Bootstrap.start(Bootstrap.java:202)\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:265)\n        at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:111)\n        at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:106)\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:88)\n        at org.elasticsearch.cli.Command.main(Command.java:53)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:74)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:67)\nRefer to the log for complete error details.\n[2016-04-06 15:20:34,259][INFO ][node                     ] [Ebon Seeker] stopping ...\n[2016-04-06 15:20:34,267][INFO ][node                     ] [Ebon Seeker] stopped\n[2016-04-06 15:20:34,267][INFO ][node                     ] [Ebon Seeker] closing ...\n[2016-04-06 15:20:34,274][INFO ][node                     ] [Ebon Seeker] closed\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206583296","html_url":"https://github.com/elastic/elasticsearch/issues/17570#issuecomment-206583296","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17570","id":206583296,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjU4MzI5Ng==","user":{"login":"djschny","id":129643,"node_id":"MDQ6VXNlcjEyOTY0Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/129643?v=4","gravatar_id":"","url":"https://api.github.com/users/djschny","html_url":"https://github.com/djschny","followers_url":"https://api.github.com/users/djschny/followers","following_url":"https://api.github.com/users/djschny/following{/other_user}","gists_url":"https://api.github.com/users/djschny/gists{/gist_id}","starred_url":"https://api.github.com/users/djschny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djschny/subscriptions","organizations_url":"https://api.github.com/users/djschny/orgs","repos_url":"https://api.github.com/users/djschny/repos","events_url":"https://api.github.com/users/djschny/events{/privacy}","received_events_url":"https://api.github.com/users/djschny/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T21:40:43Z","updated_at":"2016-04-06T21:40:43Z","author_association":"CONTRIBUTOR","body":"Do we really think this will help people properly configure? I'm afraid this will cause more harm than good. For example:\n- Person sets the first non-prod cluster (typically 1-3 nodes) that is not bound to localhost and finds this issue when starting ES\n- They hopefully [Google the setting](https://www.google.com/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=%22discovery.zen.minimum_master_nodes%22%20elasticsearch) and then arrive at the [Zen Discovery Module page](https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-discovery-zen.html). \n\nDo we feel confident this will actually help or will people just configure it quickly to get it working and then forget about the setting as they add more nodes, etc.\n\nI'm thinking in the docs we should have explicit yes/no configurations for the simple one, two, or three node configurations that most folks new to Elasticsearch will setup.\n\nThis essentially makes `discovery.zen.minimum_master_nodes` a required setting for any cluster. \n\nI'd be happy to help with documentation additions to that page too if you would like.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206584461","html_url":"https://github.com/elastic/elasticsearch/issues/17570#issuecomment-206584461","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17570","id":206584461,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjU4NDQ2MQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T21:45:24Z","updated_at":"2016-04-06T21:45:24Z","author_association":"MEMBER","body":"@djschny #15625 should help with this also or instead of\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206592581","html_url":"https://github.com/elastic/elasticsearch/issues/17570#issuecomment-206592581","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17570","id":206592581,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjU5MjU4MQ==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T22:12:52Z","updated_at":"2016-04-07T16:00:49Z","author_association":"MEMBER","body":"> Do we really think this will help people properly configure?\n\nYes, and note that it's exactly for the reasons that you outlined. People have to set it, and the error message suggests that they set it to a majority of their master-eligible nodes. You said they will search for it and this helps too. It's not perfect, but it's an incremental improvement over what we have today where it's too easy to not even know to set this setting at all. This setting is too important to not try to do something.\n\n> Do we feel confident this will actually help or will people just configure it quickly to get it working and then forget about the setting as they add more nodes, etc.\n\nYes, I truly think that it will help. But note that we also have #15625 from @ywelsch that detects the number of master eligible nodes and warns when `discovery.zen.minimum_master_nodes` is not set to a quorum of that detected number.\n\n> This essentially makes `discovery.zen.minimum_master_nodes` a required setting for any cluster.\n\nAs it should be.\n\n> I'd be happy to help with documentation additions to that page too if you would like.\n\nThat would be awesome.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206755581","html_url":"https://github.com/elastic/elasticsearch/issues/17570#issuecomment-206755581","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17570","id":206755581,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjc1NTU4MQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-04-07T08:19:14Z","updated_at":"2016-04-07T08:19:14Z","author_association":"MEMBER","body":"> Do we feel confident this will actually help or will people just configure it quickly to get it working and then forget about the setting as they add more nodes, etc.\n\nI think we'd be in a better situation as opposed to where people never heard of the setting.\n\n> This essentially makes discovery.zen.minimum_master_nodes a required setting for any cluster.\n\nExactly. This is a tension between people trying out ES on the laptop and having a good OOB experience versus making sure that we the setup a proper cluster they'll think about this and other crucial environment settings (like file descriptors). If run a single node local cluster all you need to do is set the setting to 1. \n\n> I'm thinking in the docs we should have explicit yes/no configurations for the simple one, two, or three node configurations that most folks new to Elasticsearch will setup.\n\nI think there is some value in an example 3 node cluster setup (next to a dedicated master setup) but I think it's valid for more than just the min master nodes settings. Thinking of things like node names and expected_nodes (for the dedicated master setup).\n\n> I'd be happy to help with documentation additions to that page too if you would like.\n\nOf course! \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206967847","html_url":"https://github.com/elastic/elasticsearch/issues/17570#issuecomment-206967847","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17570","id":206967847,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjk2Nzg0Nw==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2016-04-07T15:56:32Z","updated_at":"2016-04-07T15:56:32Z","author_association":"MEMBER","body":"I opened #17595.\n","performed_via_github_app":null}]