[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131570","html_url":"https://github.com/elastic/elasticsearch/issues/29877#issuecomment-384131570","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29877","id":384131570,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTU3MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-11T11:31:22Z","updated_at":"2018-04-25T01:27:05Z","author_association":"COLLABORATOR","body":"*Original comment by @albertzaharovits:*\n\nI have came upon several such failures:\r\nLINK REDACTED\r\nLINK REDACTED\r\nLINK REDACTED\r\nwhich don't reproduce locally.\r\n```\r\n./gradlew :x-pack-elasticsearch:qa:smoke-test-watcher-with-security:integTestRunner \\\r\n  -Dtests.seed=E4F4AFFF2B7ABA44 \\\r\n  -Dtests.class=org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT \\\r\n  -Dtests.method=\"testIndexActionInsufficientPrivileges\" \\\r\n  -Dtests.security.manager=true \\\r\n  -Dtests.locale=ar-IQ \\\r\n  -Dtests.timezone=America/Indiana/Indianapolis\r\n```\r\nThe error is as before:\r\n```\r\n10:18:12 org.elasticsearch.ElasticsearchSecurityException: action [indices:data/write/bulk[s]] is unauthorized for user [watcher_manager]\r\n10:18:12 \tat org.elasticsearch.xpack.core.security.support.Exceptions.authorizationError(Exceptions.java:42) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authz.AuthorizationService.denialException(AuthorizationService.java:586) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authz.AuthorizationService.denial(AuthorizationService.java:564) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authz.AuthorizationService.authorize(AuthorizationService.java:309) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$authorizeRequest$4(SecurityActionFilter.java:183) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:185) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:179) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:167) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.authorizeRequest(SecurityActionFilter.java:195) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$applyInternal$3(SecurityActionFilter.java:173) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-7.0.0-alpha1-SNAPSHOT.jar:7.0.0-alpha1-SNAPSHOT]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:184) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:217) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:228) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:182) ~[?:?]\r\n10:18:12 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:143) ~[?:?]\r\n```\r\nBut I suspect there is a race condition with the `.security` index not being available:\r\n```\r\n10:18:12 ERROR   10.4s | SmokeTestWatcherWithSecurityIT.testIndexActionInsufficientPrivileges <<< FAILURES!\r\n10:18:12    > Throwable LINK REDACTED: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopped\"\r\n10:18:12    > \tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12   2> NOTE: leaving temporary files on disk at: /var/lib/jenkins/workspace/elastic+x-pack-elasticsearch+master+periodic/elasticsearch-extra/x-pack-elasticsearch/qa/smoke-test-watcher-with-security/build/testrun/integTestRunner/J0/temp/org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT_E4F4AFFF2B7ABA44-001\r\n10:18:12    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:734)\r\n10:18:12   2> NOTE: test params are: codec=Asserting(Lucene70), sim=RandomSimilarity(queryNorm=false): {}, locale=ar-IQ, timezone=America/Indiana/Indianapolis\r\n10:18:12   2> NOTE: Linux 4.4.0-1048-aws amd64/Oracle Corporation 1.8.0_162 (64-bit)/cpus=4,threads=1,free=377815112,total=514850816\r\n10:18:12   2> NOTE: All tests run in this JVM: [SmokeTestWatcherWithSecurityClientYamlTestSuiteIT, SmokeTestWatcherWithSecurityIT]\r\n10:18:12    > \tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:708)\r\n10:18:12    > \tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.startWatcher(SmokeTestWatcherWithSecurityIT.java:63)\r\n10:18:12    > \tat java.lang.Thread.run(Thread.java:748)\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopping\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopped\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopped\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopped\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 more\r\n10:18:12    > \tSuppressed: java.lang.AssertionError: \r\n10:18:12    > Expected: is \"started\"\r\n10:18:12    >      but: was \"stopped\"\r\n10:18:12    > \t\tat org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)\r\n10:18:12    > \t\tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.lambda$startWatcher$0(SmokeTestWatcherWithSecurityIT.java:74)\r\n10:18:12    > \t\tat org.elasticsearch.test.ESTestCase.assertBusy(ESTestCase.java:722)\r\n10:18:12    > \t\t... 38 moreThrowable LINK REDACTED: org.elasticsearch.client.ResponseException: method [DELETE], host [http://[::1]:34429], URI [_xpack/watcher/watch/my_watch], status line [HTTP/1.1 404 Not Found]\r\n10:18:12    > {\"error\":{\"root_cause\":[{\"type\":\"index_not_found_exception\",\"reason\":\"no such index\",\"resource.type\":\"index_expression\",\"resource.id\":\".watches\",\"index_uuid\":\"_na_\",\"index\":\".watches\"}],\"type\":\"index_not_found_exception\",\"reason\":\"no such index\",\"resource.type\":\"index_expression\",\"resource.id\":\".watches\",\"index_uuid\":\"_na_\",\"index\":\".watches\"},\"status\":404}\r\n10:18:12    > \tat org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:705)\r\n10:18:12    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:235)\r\n10:18:12    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:198)\r\n10:18:12    > \tat org.elasticsearch.client.RestClient.performRequest(RestClient.java:160)\r\n10:18:12    > \tat org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityIT.stopWatcher(SmokeTestWatcherWithSecurityIT.java:83)\r\n10:18:12    > \tat java.lang.Thread.run(Thread.java:748)\r\n10:18:12    > Caused by: org.elasticsearch.client.ResponseException: method [DELETE], host [http://[::1]:34429], URI [_xpack/watcher/watch/my_watch], status line [HTTP/1.1 404 Not Found]\r\n10:18:12    > {\"error\":{\"root_cause\":[{\"type\":\"index_not_found_exception\",\"reason\":\"no such index\",\"resource.type\":\"index_expression\",\"resource.id\":\".watches\",\"index_uuid\":\"_na_\",\"index\":\".watches\"}],\"type\":\"index_not_found_exception\",\"reason\":\"no such index\",\"resource.type\":\"index_expression\",\"resource.id\":\".watches\",\"index_uuid\":\"_na_\",\"index\":\".watches\"},\"status\":404}\r\n```\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131571","html_url":"https://github.com/elastic/elasticsearch/issues/29877#issuecomment-384131571","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29877","id":384131571,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTU3MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-13T12:37:30Z","updated_at":"2018-04-25T01:27:05Z","author_association":"COLLABORATOR","body":"*Original comment by @javanna:*\n\nAnother failure similar to the last one posted by Albert: \r\nLINK REDACTED","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/384131572","html_url":"https://github.com/elastic/elasticsearch/issues/29877#issuecomment-384131572","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29877","id":384131572,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDEzMTU3Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-04-13T12:43:03Z","updated_at":"2018-04-25T01:27:06Z","author_association":"COLLABORATOR","body":"*Original comment by @javanna:*\n\nAnd another occurrence: LINK REDACTED","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/442577630","html_url":"https://github.com/elastic/elasticsearch/issues/29877#issuecomment-442577630","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29877","id":442577630,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MjU3NzYzMA==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2018-11-28T19:39:40Z","updated_at":"2018-11-28T19:39:40Z","author_association":"CONTRIBUTOR","body":"Re-opening. Another occurrence on `6.5`\r\n\r\n```\r\nREPRODUCE WITH: ./gradlew :x-pack:qa:smoke-test-watcher-with-security:integTestRunner -Dtests.seed=CEA725D4AE7A0067 -Dtests.class=org.elasticsearch.smoketest.SmokeTestWatcherWithSecurityClientYamlTestSuiteIT -Dtests.method=\"test {yaml=watcher/put_watch/70_put_watch_with_index_action_using_id/Test put watch api with index action using _id field}\" -Dtests.security.manager=true -Dtests.locale=ar-LY -Dtests.timezone=Europe/Tirane -Dcompiler.java=11 -Druntime.java=8FIPS -Djavax.net.ssl.keyStorePassword=password -Djavax.net.ssl.trustStorePassword=password\r\n```\r\nTest muted via https://github.com/elastic/elasticsearch/issues/35361#issuecomment-442381657\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+6.5+matrix-java-periodic/ES_BUILD_JAVA=java11,ES_RUNTIME_JAVA=java8fips,nodes=virtual&&linux/68/consoleFull\r\n```\r\n09:27:36 [2018-11-28T15:25:57,471][ERROR][o.e.x.w.a.i.IndexActionFactory] [node-0] failed to execute action [RkLZTFgslpcRTYyrlzIN/index]\r\n09:27:36 org.elasticsearch.ElasticsearchSecurityException: action [indices:data/write/bulk[s]] is unauthorized for user [watcher_manager]\r\n09:27:36 \tat org.elasticsearch.xpack.core.security.support.Exceptions.authorizationError(Exceptions.java:30) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationService.denialException(AuthorizationService.java:579) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationService.denial(AuthorizationService.java:554) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationService.authorize(AuthorizationService.java:298) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$authorizeRequest$4(SecurityActionFilter.java:169) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:173) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:167) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:155) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.authorizeRequest(SecurityActionFilter.java:181) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$applyInternal$3(SecurityActionFilter.java:159) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:176) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:209) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:220) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:174) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:134) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:104) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.applyInternal(SecurityActionFilter.java:158) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.apply(SecurityActionFilter.java:111) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:165) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:139) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:81) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.bulk.TransportBulkAction$BulkOperation.doRun(TransportBulkAction.java:384) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.bulk.TransportBulkAction.executeBulk(TransportBulkAction.java:496) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.bulk.TransportBulkAction.executeIngestAndBulk(TransportBulkAction.java:243) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:169) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.bulk.TransportBulkAction.doExecute(TransportBulkAction.java:89) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:167) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$apply$0(SecurityActionFilter.java:90) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$authorizeRequest$4(SecurityActionFilter.java:179) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:173) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:167) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:155) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.authorizeRequest(SecurityActionFilter.java:181) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$applyInternal$3(SecurityActionFilter.java:159) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:176) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:209) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:220) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:174) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:134) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:104) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.applyInternal(SecurityActionFilter.java:158) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.apply(SecurityActionFilter.java:111) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:165) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:139) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.bulk.TransportSingleItemBulkWriteAction.doExecute(TransportSingleItemBulkWriteAction.java:69) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.bulk.TransportSingleItemBulkWriteAction.doExecute(TransportSingleItemBulkWriteAction.java:44) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:167) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$apply$0(SecurityActionFilter.java:90) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$authorizeRequest$4(SecurityActionFilter.java:179) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.maybeRun(AuthorizationUtils.java:173) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.setRunAsRoles(AuthorizationUtils.java:167) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authz.AuthorizationUtils$AsyncAuthorizer.authorize(AuthorizationUtils.java:155) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.authorizeRequest(SecurityActionFilter.java:181) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.lambda$applyInternal$3(SecurityActionFilter.java:159) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.action.ActionListener$1.onResponse(ActionListener.java:60) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$authenticateAsync$2(AuthenticationService.java:176) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lambda$lookForExistingAuthentication$4(AuthenticationService.java:209) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.lookForExistingAuthentication(AuthenticationService.java:220) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.authenticateAsync(AuthenticationService.java:174) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService$Authenticator.access$000(AuthenticationService.java:134) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.authc.AuthenticationService.authenticate(AuthenticationService.java:104) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.applyInternal(SecurityActionFilter.java:158) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.security.action.filter.SecurityActionFilter.apply(SecurityActionFilter.java:111) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction$RequestFilterChain.proceed(TransportAction.java:165) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:139) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:81) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.client.node.NodeClient.executeLocally(NodeClient.java:87) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.client.node.NodeClient.doExecute(NodeClient.java:76) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:395) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.client.support.AbstractClient.execute(AbstractClient.java:384) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.client.support.AbstractClient.index(AbstractClient.java:402) ~[elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.watcher.actions.index.ExecutableIndexAction.lambda$execute$0(ExecutableIndexAction.java:100) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.core.ClientHelper.executeWithHeaders(ClientHelper.java:121) ~[x-pack-core-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.watcher.actions.index.ExecutableIndexAction.execute(ExecutableIndexAction.java:99) ~[?:?]\r\n09:27:36 \tat org.elasticsearch.xpack.core.watcher.actions.ActionWrapper.execute(ActionWrapper.java:144) [x-pack-core-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.watcher.execution.ExecutionService.executeInner(ExecutionService.java:455) [x-pack-watcher-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.watcher.execution.ExecutionService.execute(ExecutionService.java:295) [x-pack-watcher-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.watcher.execution.ExecutionService.lambda$executeAsync$5(ExecutionService.java:395) [x-pack-watcher-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.xpack.watcher.execution.ExecutionService$WatchExecutionTask.run(ExecutionService.java:544) [x-pack-watcher-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:624) [elasticsearch-6.5.2-SNAPSHOT.jar:6.5.2-SNAPSHOT]\r\n09:27:36 \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n09:27:36 \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n09:27:36 \tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/442577937","html_url":"https://github.com/elastic/elasticsearch/issues/29877#issuecomment-442577937","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29877","id":442577937,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MjU3NzkzNw==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2018-11-28T19:40:26Z","updated_at":"2018-11-28T19:40:26Z","author_association":"CONTRIBUTOR","body":"Ping @elastic/es-core-features ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/539180088","html_url":"https://github.com/elastic/elasticsearch/issues/29877#issuecomment-539180088","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/29877","id":539180088,"node_id":"MDEyOklzc3VlQ29tbWVudDUzOTE4MDA4OA==","user":{"login":"jakelandis","id":976291,"node_id":"MDQ6VXNlcjk3NjI5MQ==","avatar_url":"https://avatars2.githubusercontent.com/u/976291?v=4","gravatar_id":"","url":"https://api.github.com/users/jakelandis","html_url":"https://github.com/jakelandis","followers_url":"https://api.github.com/users/jakelandis/followers","following_url":"https://api.github.com/users/jakelandis/following{/other_user}","gists_url":"https://api.github.com/users/jakelandis/gists{/gist_id}","starred_url":"https://api.github.com/users/jakelandis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakelandis/subscriptions","organizations_url":"https://api.github.com/users/jakelandis/orgs","repos_url":"https://api.github.com/users/jakelandis/repos","events_url":"https://api.github.com/users/jakelandis/events{/privacy}","received_events_url":"https://api.github.com/users/jakelandis/received_events","type":"User","site_admin":false},"created_at":"2019-10-07T20:02:54Z","updated_at":"2019-10-07T20:02:54Z","author_association":"CONTRIBUTOR","body":"Closing this issue out due to lack of actionable items. \r\n\r\nThis test was re-enabled via https://github.com/elastic/elasticsearch/commit/70b6134ac50f8420f8559df123dd3da928e9670d and any new failures should be on their own issue. ","performed_via_github_app":null}]