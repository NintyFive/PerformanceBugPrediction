{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11004","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11004/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11004/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11004/events","html_url":"https://github.com/elastic/elasticsearch/issues/11004","id":73570542,"node_id":"MDU6SXNzdWU3MzU3MDU0Mg==","number":11004,"title":"can't recover index from snapshot to multi-node cluster","user":{"login":"minde-eagleeye","id":7629410,"node_id":"MDQ6VXNlcjc2Mjk0MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7629410?v=4","gravatar_id":"","url":"https://api.github.com/users/minde-eagleeye","html_url":"https://github.com/minde-eagleeye","followers_url":"https://api.github.com/users/minde-eagleeye/followers","following_url":"https://api.github.com/users/minde-eagleeye/following{/other_user}","gists_url":"https://api.github.com/users/minde-eagleeye/gists{/gist_id}","starred_url":"https://api.github.com/users/minde-eagleeye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/minde-eagleeye/subscriptions","organizations_url":"https://api.github.com/users/minde-eagleeye/orgs","repos_url":"https://api.github.com/users/minde-eagleeye/repos","events_url":"https://api.github.com/users/minde-eagleeye/events{/privacy}","received_events_url":"https://api.github.com/users/minde-eagleeye/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-05-06T09:29:32Z","updated_at":"2015-05-06T15:19:48Z","closed_at":"2015-05-06T15:19:47Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I had one node \"cluster\" running 1.3.4 made a snapshot and tried to recover on 3 data node cluster (version 1.5.2).\n\nI copied snapshot to master node of new cluster and run recovery, most of the indexes perfectly fine, but some had this issue:\nIndex has 2 primary shards one of them is recovered on master node, second one is trying to recover in any but master node, and it keeps looping between to other nodes trying to initialize it but it never goes to master where the recovery files are.\n\nwhat I notice is that recovery data of that index is transferred to one of non master nodes, but only first shard documents are there second shard documents are not transferred.\n\nlogs keeps outputting same message which I think is related to this #9433 \n\nerror logs from non master node:\n\n```\n[2015-05-06 08:57:24,192][WARN ][indices.cluster          ] [esdn0001.dev.localdomain] [[phoenix_basket_20140910][0]] marking and sending shard failed due to [failed recovery]\norg.elasticsearch.index.gateway.IndexShardGatewayRecoveryException: [phoenix_basket_20140910][0] failed recovery\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:162)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.index.snapshots.IndexShardRestoreFailedException: [phoenix_basket_20140910][0] restore failed\n        at org.elasticsearch.index.snapshots.IndexShardSnapshotAndRestoreService.restore(IndexShardSnapshotAndRestoreService.java:135)\n        at org.elasticsearch.index.gateway.IndexShardGatewayService$1.run(IndexShardGatewayService.java:109)\n        ... 3 more\nCaused by: org.elasticsearch.index.snapshots.IndexShardRestoreFailedException: [phoenix_basket_20140910][0] failed to restore snapshot [snapshot_1]\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository.restore(BlobStoreIndexShardRepository.java:164)\n        at org.elasticsearch.index.snapshots.IndexShardSnapshotAndRestoreService.restore(IndexShardSnapshotAndRestoreService.java:126)\n        ... 4 more\nCaused by: org.elasticsearch.index.snapshots.IndexShardRestoreFailedException: [phoenix_basket_20140910][0] failed to read shard snapshot file\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$Context.loadSnapshot(BlobStoreIndexShardRepository.java:318)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$RestoreContext.restore(BlobStoreIndexShardRepository.java:710)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository.restore(BlobStoreIndexShardRepository.java:162)\n        ... 5 more\nCaused by: java.io.FileNotFoundException: /var/log/elasticsearch/snapshots/indices/phoenix_basket_20140910/0/snapshot-snapshot_1 (No such file or directory)\n        at java.io.FileInputStream.open(Native Method)\n        at java.io.FileInputStream.<init>(FileInputStream.java:146)\n        at org.elasticsearch.common.blobstore.fs.FsBlobContainer.openInput(FsBlobContainer.java:87)\n        at org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardRepository$Context.loadSnapshot(BlobStoreIndexShardRepository.java:315)\n        ... 7 more\n\n```\n\nIf you need any additional data let me know.\n\nwork around would be copy snapshot to all nodes then it recovers it correctly\n","closed_by":{"login":"minde-eagleeye","id":7629410,"node_id":"MDQ6VXNlcjc2Mjk0MTA=","avatar_url":"https://avatars0.githubusercontent.com/u/7629410?v=4","gravatar_id":"","url":"https://api.github.com/users/minde-eagleeye","html_url":"https://github.com/minde-eagleeye","followers_url":"https://api.github.com/users/minde-eagleeye/followers","following_url":"https://api.github.com/users/minde-eagleeye/following{/other_user}","gists_url":"https://api.github.com/users/minde-eagleeye/gists{/gist_id}","starred_url":"https://api.github.com/users/minde-eagleeye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/minde-eagleeye/subscriptions","organizations_url":"https://api.github.com/users/minde-eagleeye/orgs","repos_url":"https://api.github.com/users/minde-eagleeye/repos","events_url":"https://api.github.com/users/minde-eagleeye/events{/privacy}","received_events_url":"https://api.github.com/users/minde-eagleeye/received_events","type":"User","site_admin":false},"performed_via_github_app":null}