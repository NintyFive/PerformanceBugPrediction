[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185655104","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-185655104","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":185655104,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTY1NTEwNA==","user":{"login":"marek-obuchowicz","id":712751,"node_id":"MDQ6VXNlcjcxMjc1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/712751?v=4","gravatar_id":"","url":"https://api.github.com/users/marek-obuchowicz","html_url":"https://github.com/marek-obuchowicz","followers_url":"https://api.github.com/users/marek-obuchowicz/followers","following_url":"https://api.github.com/users/marek-obuchowicz/following{/other_user}","gists_url":"https://api.github.com/users/marek-obuchowicz/gists{/gist_id}","starred_url":"https://api.github.com/users/marek-obuchowicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marek-obuchowicz/subscriptions","organizations_url":"https://api.github.com/users/marek-obuchowicz/orgs","repos_url":"https://api.github.com/users/marek-obuchowicz/repos","events_url":"https://api.github.com/users/marek-obuchowicz/events{/privacy}","received_events_url":"https://api.github.com/users/marek-obuchowicz/received_events","type":"User","site_admin":false},"created_at":"2016-02-18T10:57:56Z","updated_at":"2016-02-18T10:58:51Z","author_association":"NONE","body":"Soma additional outputs:\n\n```\nGET /_cat/shards:\nproducts_spryker-2016-02-17-21-39-29 2     r      STARTED    107042 240.8mb 10.22.113.51 psz-ses-01\nproducts_spryker-2016-02-17-21-39-29 2     p      STARTED    107042 240.9mb 10.22.112.98 psz-ses-00\nproducts_spryker-2016-02-17-21-39-29 1     p      STARTED    106425 241.9mb 10.22.113.51 psz-ses-01\nproducts_spryker-2016-02-17-21-39-29 1     r      RELOCATING 106425 241.9mb 10.22.112.98 psz-ses-00 -> 10.22.112.64 6t4CEQiNTRaltfhWsMkTJA psz-ses-02\nproducts_spryker-2016-02-17-21-39-29 5     r      STARTED    105494 226.2mb 10.22.113.51 psz-ses-01\nproducts_spryker-2016-02-17-21-39-29 5     p      STARTED    105494 226.2mb 10.22.112.98 psz-ses-00\nproducts_spryker-2016-02-17-21-39-29 4     r      STARTED    105446 229.9mb 10.22.113.51 psz-ses-01\nproducts_spryker-2016-02-17-21-39-29 4     p      STARTED    105446 244.8mb 10.22.112.98 psz-ses-00\nproducts_spryker-2016-02-17-21-39-29 3     r      STARTED    105700 226.3mb 10.22.113.51 psz-ses-01\nproducts_spryker-2016-02-17-21-39-29 3     p      STARTED    105700   232mb 10.22.112.98 psz-ses-00\nproducts_spryker-2016-02-17-21-39-29 0     r      STARTED    104388 217.5mb 10.22.113.51 psz-ses-01\nproducts_spryker-2016-02-17-21-39-29 0     p      RELOCATING 104388 235.6mb 10.22.112.98 psz-ses-00 -> 10.22.112.64 6t4CEQiNTRaltfhWsMkTJA psz-ses-02\n```\n\n```\nGET /_cat/recovery:\nindex                                shard time    type       stage    source_host  target_host  repository snapshot files files_percent bytes     bytes_percent total_files total_bytes translog translog_percent total_translog\nproducts_spryker-2016-02-17-21-39-29 0     235958  replica    done     10.22.112.98 10.22.113.51 n/a        n/a      1     100.0%        130       100.0%        1           130         22436    100.0%           22436\nproducts_spryker-2016-02-17-21-39-29 0     1554689 relocation translog 10.22.112.98 10.22.112.64 n/a        n/a      1     100.0%        130       100.0%        1           130         0        0.0%             22444\nproducts_spryker-2016-02-17-21-39-29 0     90      replica    done     10.22.113.51 10.22.112.98 n/a        n/a      1     100.0%        130       100.0%        1           130         0        100.0%           0\nproducts_spryker-2016-02-17-21-39-29 1     1831    replica    done     10.22.112.98 10.22.113.51 n/a        n/a      31    100.0%        37723981  100.0%        184         253227154   0        100.0%           0\nproducts_spryker-2016-02-17-21-39-29 1     1554690 replica    translog 10.22.113.51 10.22.112.64 n/a        n/a      0     0.0%          0         0.0%          0           0           0        0.0%             3\nproducts_spryker-2016-02-17-21-39-29 1     398     replica    done     10.22.113.51 10.22.112.98 n/a        n/a      0     0.0%          0         0.0%          0           0           2        100.0%           2\n```\n\n(numbers in _cat/recovery do not change over time, it's frozen with this status)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185723112","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-185723112","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":185723112,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTcyMzExMg==","user":{"login":"Lavode","id":1827358,"node_id":"MDQ6VXNlcjE4MjczNTg=","avatar_url":"https://avatars3.githubusercontent.com/u/1827358?v=4","gravatar_id":"","url":"https://api.github.com/users/Lavode","html_url":"https://github.com/Lavode","followers_url":"https://api.github.com/users/Lavode/followers","following_url":"https://api.github.com/users/Lavode/following{/other_user}","gists_url":"https://api.github.com/users/Lavode/gists{/gist_id}","starred_url":"https://api.github.com/users/Lavode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lavode/subscriptions","organizations_url":"https://api.github.com/users/Lavode/orgs","repos_url":"https://api.github.com/users/Lavode/repos","events_url":"https://api.github.com/users/Lavode/events{/privacy}","received_events_url":"https://api.github.com/users/Lavode/received_events","type":"User","site_admin":false},"created_at":"2016-02-18T13:39:30Z","updated_at":"2016-02-18T13:39:30Z","author_association":"NONE","body":"Potentially related to the issue mentioned above, we also have some of the nodes occasionally spawning a few thousand threads, which ultimately leads to crashes caused by OOM.\n\nRight now we're slightly above 6.5k threads, with an additional ~2 being spawned each second.\n\n```\nroot@psz-ses-00:~# ps -Lf -p 570 | wc -l\n6502\n```\n\nThe threads in question:\n\n```\nelastic+   570     1   570  0 5702 Feb17 ?        00:00:00 /usr/lib/jvm/java-7-openjdk-amd64//bin/java -Xms16384m -Xmx16384m -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintClassHistogram -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/log/elasticsearch-production/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/elasticsearch-2.1.0.jar:/usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch start -d -p /var/run/elasticsearch-production.pid --default.path.home=/usr/share/elasticsearch --default.path.logs=/data/logs/production/elasticsearch --default.path.data=/data/shop/production/shared/elasticsearch --default.path.conf=/etc/elasticsearch-production\nelastic+   570     1   642  0 5702 Feb17 ?        00:00:08 /usr/lib/jvm/java-7-openjdk-amd64//bin/java -Xms16384m -Xmx16384m -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintClassHistogram -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/log/elasticsearch-production/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/elasticsearch-2.1.0.jar:/usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch start -d -p /var/run/elasticsearch-production.pid --default.path.home=/usr/share/elasticsearch --default.path.logs=/data/logs/production/elasticsearch --default.path.data=/data/shop/production/shared/elasticsearch --default.path.conf=/etc/elasticsearch-production\nelastic+   570     1   673  0 5702 Feb17 ?        00:11:52 /usr/lib/jvm/java-7-openjdk-amd64//bin/java -Xms16384m -Xmx16384m -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintClassHistogram -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/log/elasticsearch-production/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/elasticsearch-2.1.0.jar:/usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch start -d -p /var/run/elasticsearch-production.pid --default.path.home=/usr/share/elasticsearch --default.path.logs=/data/logs/production/elasticsearch --default.path.data=/data/shop/production/shared/elasticsearch --default.path.conf=/etc/elasticsearch-production\nelastic+   570     1   674  0 5702 Feb17 ?        00:11:52 /usr/lib/jvm/java-7-openjdk-amd64//bin/java -Xms16384m -Xmx16384m -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintClassHistogram -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/log/elasticsearch-production/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/elasticsearch-2.1.0.jar:/usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch start -d -p /var/run/elasticsearch-production.pid --default.path.home=/usr/share/elasticsearch --default.path.logs=/data/logs/production/elasticsearch --default.path.data=/data/shop/production/shared/elasticsearch --default.path.conf=/etc/elasticsearch-production\nelastic+   570     1   675  0 5702 Feb17 ?        00:11:52 /usr/lib/jvm/java-7-openjdk-amd64//bin/java -Xms16384m -Xmx16384m -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintClassHistogram -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/log/elasticsearch-production/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/elasticsearch-2.1.0.jar:/usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch start -d -p /var/run/elasticsearch-production.pid --default.path.home=/usr/share/elasticsearch --default.path.logs=/data/logs/production/elasticsearch --default.path.data=/data/shop/production/shared/elasticsearch --default.path.conf=/etc/elasticsearch-productio\n```\n\nHere an example of a 'healthy' and a 'misbehaving' node's memory usage & thread count.\n![elasticsearch_memory](https://cloud.githubusercontent.com/assets/1827358/13144848/3ec4e804-d64d-11e5-889c-afedcf48b1bd.jpg)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185942221","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-185942221","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":185942221,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTk0MjIyMQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2016-02-18T22:03:02Z","updated_at":"2016-02-18T22:03:02Z","author_association":"CONTRIBUTOR","body":"can you provide your mappings please and your settings?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/185992118","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-185992118","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":185992118,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NTk5MjExOA==","user":{"login":"marek-obuchowicz","id":712751,"node_id":"MDQ6VXNlcjcxMjc1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/712751?v=4","gravatar_id":"","url":"https://api.github.com/users/marek-obuchowicz","html_url":"https://github.com/marek-obuchowicz","followers_url":"https://api.github.com/users/marek-obuchowicz/followers","following_url":"https://api.github.com/users/marek-obuchowicz/following{/other_user}","gists_url":"https://api.github.com/users/marek-obuchowicz/gists{/gist_id}","starred_url":"https://api.github.com/users/marek-obuchowicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marek-obuchowicz/subscriptions","organizations_url":"https://api.github.com/users/marek-obuchowicz/orgs","repos_url":"https://api.github.com/users/marek-obuchowicz/repos","events_url":"https://api.github.com/users/marek-obuchowicz/events{/privacy}","received_events_url":"https://api.github.com/users/marek-obuchowicz/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T00:27:44Z","updated_at":"2016-02-19T00:27:44Z","author_association":"NONE","body":"I have sent mappings, settings and configuration to e-mail address associated with your github account\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186212641","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-186212641","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":186212641,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjIxMjY0MQ==","user":{"login":"marek-obuchowicz","id":712751,"node_id":"MDQ6VXNlcjcxMjc1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/712751?v=4","gravatar_id":"","url":"https://api.github.com/users/marek-obuchowicz","html_url":"https://github.com/marek-obuchowicz","followers_url":"https://api.github.com/users/marek-obuchowicz/followers","following_url":"https://api.github.com/users/marek-obuchowicz/following{/other_user}","gists_url":"https://api.github.com/users/marek-obuchowicz/gists{/gist_id}","starred_url":"https://api.github.com/users/marek-obuchowicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marek-obuchowicz/subscriptions","organizations_url":"https://api.github.com/users/marek-obuchowicz/orgs","repos_url":"https://api.github.com/users/marek-obuchowicz/repos","events_url":"https://api.github.com/users/marek-obuchowicz/events{/privacy}","received_events_url":"https://api.github.com/users/marek-obuchowicz/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T13:25:55Z","updated_at":"2016-02-19T13:25:55Z","author_association":"NONE","body":"Some update - instead of shutting down / starting nodes, I tried to move shards manually using API (in order to move all shards from a host before shutting it down).\nBy doing manual operations `_cluster/reroute` - commands, move - i have not observed any problems with relocating primary shards. However, the issue mentioned above happens when trying to relocate replica shards:\n\n```\n[2016-02-19 13:23:24,888][WARN ][cluster.action.shard     ] [psz-ses-00] [products_spryker-2016-02-19-11-56-53][0] received shard failed for [products_spryker-2016-02-19-11-56-53][0], node[8ae9oqRCS9SjVepIgJ_OYg], relocating [WNL6ds1EQcKs2n3bwwB01w], [P], v[14], s[INITIALIZING], a[id=fR1O4e-vTDKmxIeZ91QMew, rId=TiQmjZaRRlykJHE3P0thog], expected_shard_size[201664505], indexUUID [YtxdtlD5TtGPcV2K_Anm0g], message [failed to update mappings], failure [IllegalArgumentException[Mapper for [_all] conflicts with existing mapping in other types:\n[mapper [_all] cannot be changed from type [_all] to [string]]]]\njava.lang.IllegalArgumentException: Mapper for [_all] conflicts with existing mapping in other types:\n[mapper [_all] cannot be changed from type [_all] to [string]]\n    at org.elasticsearch.index.mapper.FieldTypeLookup.checkCompatibility(FieldTypeLookup.java:117)\n    at org.elasticsearch.index.mapper.MapperService.checkNewMappersCompatibility(MapperService.java:364)\n    at org.elasticsearch.index.mapper.MapperService.merge(MapperService.java:315)\n    at org.elasticsearch.index.mapper.MapperService.merge(MapperService.java:261)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.processMapping(IndicesClusterStateService.java:418)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.applyMappings(IndicesClusterStateService.java:372)\n    at org.elasticsearch.indices.cluster.IndicesClusterStateService.clusterChanged(IndicesClusterStateService.java:177)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:494)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.runAndClean(PrioritizedEsThreadPoolExecutor.java:231)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:194)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n[2016-02-19 13:23:24,888][WARN ][cluster.action.shard     ] [psz-ses-00] [products_spryker-2016-02-19-11-56-53][0] received shard failed for [products_spryker-2016-02-19-11-56-53][0], node[8ae9oqRCS9SjVepIgJ_OYg], relocating [WNL6ds1EQcKs2n3bwwB01w], [P], v[14], s[INITIALIZING], a[id=fR1O4e-vTDKmxIeZ91QMew, rId=TiQmjZaRRlykJHE3P0thog], expected_shard_size[201664505], indexUUID [YtxdtlD5TtGPcV2K_Anm0g], message [master {psz-ses-00}{WNL6ds1EQcKs2n3bwwB01w}{10.22.112.98}{10.22.112.98:25005}{max_local_storage_nodes=1, master=true} marked shard as initializing, but shard is marked as failed, resend shard failure], failure [Unknown]\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186255602","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-186255602","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":186255602,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjI1NTYwMg==","user":{"login":"marek-obuchowicz","id":712751,"node_id":"MDQ6VXNlcjcxMjc1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/712751?v=4","gravatar_id":"","url":"https://api.github.com/users/marek-obuchowicz","html_url":"https://github.com/marek-obuchowicz","followers_url":"https://api.github.com/users/marek-obuchowicz/followers","following_url":"https://api.github.com/users/marek-obuchowicz/following{/other_user}","gists_url":"https://api.github.com/users/marek-obuchowicz/gists{/gist_id}","starred_url":"https://api.github.com/users/marek-obuchowicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marek-obuchowicz/subscriptions","organizations_url":"https://api.github.com/users/marek-obuchowicz/orgs","repos_url":"https://api.github.com/users/marek-obuchowicz/repos","events_url":"https://api.github.com/users/marek-obuchowicz/events{/privacy}","received_events_url":"https://api.github.com/users/marek-obuchowicz/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T15:16:38Z","updated_at":"2016-02-19T15:16:38Z","author_association":"NONE","body":"Process startup parameters:\n\n```\n/usr/lib/jvm/java-7-openjdk-amd64//bin/java -Xms16384m -Xmx16384m -Djava.awt.headless=true -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintClassHistogram -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/var/log/elasticsearch-production/gc.log -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC -Dfile.encoding=UTF-8 -Djna.nosys=true -Des.path.home=/usr/share/elasticsearch -cp /usr/share/elasticsearch/lib/elasticsearch-2.1.0.jar:/usr/share/elasticsearch/lib/* org.elasticsearch.bootstrap.Elasticsearch start -d -p /var/run/elasticsearch-production.pid --default.path.home=/usr/share/elasticsearch --default.path.logs=/data/logs/production/elasticsearch --default.path.data=/data/shop/production/shared/elasticsearch --default.path.conf=/etc/elasticsearch-production\n```\n\nHost info:\n\n```\n32242 MB RAM, Debian GNU/Linux 8.3 (jessie), kernel 3.16.0-4, AWS instance m4.2xlarge, ami-02b78e1f\njava version \"1.7.0_95\"\nOpenJDK Runtime Environment (IcedTea 2.6.4) (7u95-2.6.4-1~deb8u1)\nOpenJDK 64-Bit Server VM (build 24.95-b01, mixed mode)\n```\n\nStorage\n\n```\nEBS volumes\n/dev/xvda1 on / type ext4 (rw,relatime,data=ordered)\n/dev/xvdf on /data type ext4 (rw,noatime,nodiratime,nobarrier,data=ordered)\n```\n\nChanged sysctl's:\n\n```\nvm.swappiness = 5\n```\n\nPlugins:\n\n```\nInstalled plugins in /usr/share/elasticsearch/plugins:\n    - elasticsearch-analysis-decompound ver. 2.1.0.0\n    - head \n    - cloud-aws\n```\n\nMapping:\n\n```\ncurl localhost:15005/products_spryker-2016-02-17-21-39-29/_mapping?pretty\n{\n  \"products_spryker-2016-02-17-21-39-29\" : {\n    \"mappings\" : {\n      \"product\" : {\n        \"_all\" : {\n          \"analyzer\" : \"main_analyzer\"\n        },\n        \"properties\" : {\n          \"_all\" : {\n            \"type\" : \"string\",\n            \"analyzer\" : \"main_analyzer\"\n          },\n          \"brand_name\" : {\n            \"type\" : \"string\",\n            \"fields\" : {\n              \"raw\" : {\n                \"type\" : \"string\",\n                \"index\" : \"not_analyzed\"\n              },\n              \"suggest\" : {\n                \"type\" : \"completion\",\n                \"analyzer\" : \"simple\",\n                \"payloads\" : true,\n                \"preserve_separators\" : true,\n                \"preserve_position_increments\" : true,\n                \"max_input_length\" : 50\n              }\n            }\n          },\n          \"brand_suggest\" : {\n            \"type\" : \"completion\",\n            \"analyzer\" : \"simple\",\n            \"payloads\" : true,\n            \"preserve_separators\" : true,\n            \"preserve_position_increments\" : true,\n            \"max_input_length\" : 50\n          },\n          \"de_CH\" : {\n            \"properties\" : {\n              \"attributes\" : {\n                \"properties\" : {\n                  \"productScore\" : {\n                    \"type\" : \"long\"\n                  },\n                  \"tags\" : {\n                    \"type\" : \"string\",\n                    \"fields\" : {\n                      \"raw\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                      }\n                    }\n                  }\n                }\n              },\n              \"categories\" : {\n                \"type\" : \"nested\",\n                \"properties\" : {\n                  \"dump\" : {\n                    \"type\" : \"string\",\n                    \"index\" : \"not_analyzed\"\n                  },\n                  \"id\" : {\n                    \"type\" : \"long\"\n                  },\n                  \"name\" : {\n                    \"type\" : \"string\",\n                    \"fields\" : {\n                      \"decomp\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"decomp_analyzer\",\n                        \"search_analyzer\" : \"main_analyzer\"\n                      },\n                      \"english_words\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"english_main_analyzer\"\n                      },\n                      \"front\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"edgengram_analyzer\"\n                      },\n                      \"ngrams\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"ngram_analyzer\"\n                      },\n                      \"raw\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                      },\n                      \"shingles\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"analyzer_shingle\"\n                      },\n                      \"suggest\" : {\n                        \"type\" : \"completion\",\n                        \"analyzer\" : \"simple\",\n                        \"payloads\" : true,\n                        \"preserve_separators\" : true,\n                        \"preserve_position_increments\" : true,\n                        \"max_input_length\" : 50\n                      }\n                    }\n                  }\n                }\n              },\n              \"long_description\" : {\n                \"type\" : \"string\",\n                \"analyzer\" : \"main_analyzer\",\n                \"fields\" : {\n                  \"correction\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"suggestion_analyzer\"\n                  },\n                  \"decomp\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"decomp_analyzer\",\n                    \"search_analyzer\" : \"main_analyzer\"\n                  },\n                  \"english_words\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"english_main_analyzer\"\n                  },\n                  \"front\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"edgengram_analyzer\"\n                  },\n                  \"keywords\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"keywords_analyzer\"\n                  },\n                  \"ngrams\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"ngram_analyzer\"\n                  },\n                  \"prefix\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"prefix_analyzer\"\n                  },\n                  \"shingles\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"analyzer_shingle\"\n                  },\n                  \"suggest\" : {\n                    \"type\" : \"completion\",\n                    \"analyzer\" : \"simple\",\n                    \"payloads\" : true,\n                    \"preserve_separators\" : true,\n                    \"preserve_position_increments\" : true,\n                    \"max_input_length\" : 50\n                  }\n                }\n              },\n              \"name\" : {\n                \"type\" : \"string\",\n                \"analyzer\" : \"main_analyzer\",\n                \"fields\" : {\n                  \"correction\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"suggestion_analyzer\"\n                  },\n                  \"decomp\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"decomp_analyzer\",\n                    \"search_analyzer\" : \"main_analyzer\"\n                  },\n                  \"english_words\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"english_main_analyzer\"\n                  },\n                  \"front\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"edgengram_analyzer\"\n                  },\n                  \"keywords\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"keywords_analyzer\"\n                  },\n                  \"ngrams\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"ngram_analyzer\"\n                  },\n                  \"prefix\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"prefix_analyzer\"\n                  },\n                  \"shingles\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"analyzer_shingle\"\n                  },\n                  \"suggest\" : {\n                    \"type\" : \"completion\",\n                    \"analyzer\" : \"simple\",\n                    \"payloads\" : true,\n                    \"preserve_separators\" : true,\n                    \"preserve_position_increments\" : true,\n                    \"max_input_length\" : 50\n                  }\n                }\n              },\n              \"parent_categories\" : {\n                \"type\" : \"nested\",\n                \"properties\" : {\n                  \"id\" : {\n                    \"type\" : \"long\"\n                  },\n                  \"name\" : {\n                    \"type\" : \"string\",\n                    \"fields\" : {\n                      \"decomp\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"decomp_analyzer\",\n                        \"search_analyzer\" : \"main_analyzer\"\n                      },\n                      \"english_words\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"english_main_analyzer\"\n                      },\n                      \"front\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"edgengram_analyzer\"\n                      },\n                      \"ngrams\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"ngram_analyzer\"\n                      },\n                      \"raw\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                      },\n                      \"shingles\" : {\n                        \"type\" : \"string\",\n                        \"analyzer\" : \"analyzer_shingle\"\n                      },\n                      \"suggest\" : {\n                        \"type\" : \"completion\",\n                        \"analyzer\" : \"simple\",\n                        \"payloads\" : true,\n                        \"preserve_separators\" : true,\n                        \"preserve_position_increments\" : true,\n                        \"max_input_length\" : 50\n                      }\n                    }\n                  }\n                }\n              },\n              \"short_description\" : {\n                \"type\" : \"string\",\n                \"analyzer\" : \"main_analyzer\",\n                \"fields\" : {\n                  \"correction\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"suggestion_analyzer\"\n                  },\n                  \"decomp\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"decomp_analyzer\",\n                    \"search_analyzer\" : \"main_analyzer\"\n                  },\n                  \"english_words\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"english_main_analyzer\"\n                  },\n                  \"front\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"edgengram_analyzer\"\n                  },\n                  \"keywords\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"keywords_analyzer\"\n                  },\n                  \"ngrams\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"ngram_analyzer\"\n                  },\n                  \"prefix\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"prefix_analyzer\"\n                  },\n                  \"shingles\" : {\n                    \"type\" : \"string\",\n                    \"analyzer\" : \"analyzer_shingle\"\n                  },\n                  \"suggest\" : {\n                    \"type\" : \"completion\",\n                    \"analyzer\" : \"simple\",\n                    \"payloads\" : true,\n                    \"preserve_separators\" : true,\n                    \"preserve_position_increments\" : true,\n                    \"max_input_length\" : 50\n                  }\n                }\n              },\n              \"top_features\" : {\n                \"type\" : \"nested\",\n                \"properties\" : {\n                  \"name\" : {\n                    \"type\" : \"string\",\n                    \"fields\" : {\n                      \"raw\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                      }\n                    }\n                  },\n                  \"value\" : {\n                    \"type\" : \"string\",\n                    \"fields\" : {\n                      \"raw\" : {\n                        \"type\" : \"string\",\n                        \"index\" : \"not_analyzed\"\n                      }\n                    }\n                  }\n                }\n              },\n              \"url\" : {\n                \"type\" : \"string\"\n              }\n            }\n          },\n          \"images\" : {\n            \"properties\" : {\n              \"highres\" : {\n                \"type\" : \"string\",\n                \"index\" : \"not_analyzed\"\n              },\n              \"lowres\" : {\n                \"type\" : \"string\",\n                \"index\" : \"not_analyzed\"\n              },\n              \"thumbnails\" : {\n                \"type\" : \"string\",\n                \"index\" : \"not_analyzed\"\n              }\n            }\n          },\n          \"is_active\" : {\n            \"type\" : \"boolean\"\n          },\n          \"is_top_seller_category_l1\" : {\n            \"type\" : \"boolean\"\n          },\n          \"is_top_seller_category_l2\" : {\n            \"type\" : \"boolean\"\n          },\n          \"is_top_seller_category_l3\" : {\n            \"type\" : \"boolean\"\n          },\n          \"is_top_seller_home\" : {\n            \"type\" : \"boolean\"\n          },\n          \"is_top_seller_theme_world\" : {\n            \"type\" : \"boolean\"\n          },\n          \"key\" : {\n            \"type\" : \"string\"\n          },\n          \"localizedAttributes\" : {\n            \"type\" : \"object\"\n          },\n          \"merchants\" : {\n            \"properties\" : {\n              \"id\" : {\n                \"type\" : \"long\"\n              },\n              \"is_active\" : {\n                \"type\" : \"boolean\"\n              },\n              \"name\" : {\n                \"type\" : \"string\",\n                \"fields\" : {\n                  \"raw\" : {\n                    \"type\" : \"string\",\n                    \"index\" : \"not_analyzed\"\n                  }\n                }\n              },\n              \"price\" : {\n                \"type\" : \"long\"\n              },\n              \"sku\" : {\n                \"type\" : \"string\"\n              },\n              \"stock_quantity\" : {\n                \"type\" : \"long\"\n              },\n              \"uuid\" : {\n                \"type\" : \"string\"\n              }\n            }\n          },\n          \"min_price\" : {\n            \"type\" : \"long\"\n          },\n          \"minimum_stock\" : {\n            \"type\" : \"long\"\n          },\n          \"search-result-data\" : {\n            \"properties\" : {\n              \"abstract_name\" : {\n                \"type\" : \"string\",\n                \"index\" : \"not_analyzed\"\n              },\n              \"abstract_sku\" : {\n                \"type\" : \"string\",\n                \"index\" : \"not_analyzed\"\n              },\n              \"id_abstract_product\" : {\n                \"type\" : \"long\"\n              },\n              \"id_touch\" : {\n                \"type\" : \"long\"\n              },\n              \"url\" : {\n                \"type\" : \"string\",\n                \"index\" : \"not_analyzed\"\n              }\n            }\n          },\n          \"sku\" : {\n            \"type\" : \"string\",\n            \"index\" : \"not_analyzed\"\n          },\n          \"tags\" : {\n            \"type\" : \"string\"\n          }\n        }\n      },\n      \"marker\" : {\n        \"_all\" : {\n          \"analyzer\" : \"main_analyzer\"\n        },\n        \"properties\" : {\n          \"timestamp\" : {\n            \"type\" : \"string\"\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nSettings via API:\n\n```\ncurl localhost:15005/_settings?pretty\n{\n  \"products_spryker-2016-02-17-21-39-29\" : {\n    \"settings\" : {\n      \"index\" : {\n        \"creation_date\" : \"1455745169452\",\n        \"number_of_replicas\" : \"1\",\n        \"max_result_window\" : \"100000\",\n        \"uuid\" : \"djrjnzRyQ-OqhoWMdvqBpA\",\n        \"analysis\" : {\n          \"filter\" : {\n            \"decomp\" : {\n              \"type\" : \"decompound\"\n            },\n            \"german_stemmer\" : {\n              \"type\" : \"stemmer\",\n              \"language\" : \"light_german\"\n            },\n            \"german_stop\" : {\n              \"type\" : \"stop\",\n              \"stopwords\" : \"_german_\"\n            },\n            \"edgengram_filter\" : {\n              \"max_gram\" : \"15\",\n              \"type\" : \"edgeNGram\",\n              \"min_gram\" : \"4\",\n              \"side\" : \"front\"\n            },\n            \"ngram_filter\" : {\n              \"type\" : \"nGram\",\n              \"min_gram\" : \"4\",\n              \"max_gram\" : \"15\"\n            },\n            \"filter_shingle\" : {\n              \"type\" : \"shingle\",\n              \"min_shingle_size\" : \"2\",\n              \"max_shingle_size\" : \"3\",\n              \"output_unigrams\" : \"false\"\n            },\n            \"synonym_filter\" : {\n              \"type\" : \"synonym\",\n              \"synonyms\" : [ \"bvlgari,bulgari\", \"box,kiste,behälter\", \"Handy,natel,mobile phone\" ],\n              \"ignore_case\" : \"true\"\n            },\n            \"filter_stop\" : {\n              \"type\" : \"stop\"\n            }\n          },\n          \"analyzer\" : {\n            \"english_main_analyzer\" : {\n              \"type\" : \"english\",\n              \"filter\" : [ \"lowercase\", \"synonym_filter\" ],\n              \"tokenizer\" : \"standard\"\n            },\n            \"prefix_analyzer\" : {\n              \"filter\" : \"lowercase\",\n              \"tokenizer\" : \"keyword\"\n            },\n            \"main_analyzer\" : {\n              \"type\" : \"custom\",\n              \"filter\" : [ \"lowercase\", \"synonym_filter\", \"german_stop\", \"german_normalization\", \"german_stemmer\" ],\n              \"tokenizer\" : \"standard\"\n            },\n            \"decomp_analyzer\" : {\n              \"filter\" : [ \"lowercase\", \"decomp\", \"unique\", \"synonym_filter\", \"german_stop\", \"german_normalization\", \"german_stemmer\" ],\n              \"tokenizer\" : \"decomp\"\n            },\n            \"analyzer_shingle\" : {\n              \"type\" : \"custom\",\n              \"stopwords\" : \"_german_\",\n              \"char_filter\" : [ \"html_strip\" ],\n              \"filter\" : [ \"standard\", \"lowercase\", \"synonym_filter\", \"filter_shingle\" ],\n              \"tokenizer\" : \"standard\"\n            },\n            \"suggestion_analyzer\" : {\n              \"filter\" : [ \"lowercase\" ],\n              \"tokenizer\" : \"standard\"\n            },\n            \"keywords_analyzer\" : {\n              \"char_filter\" : [ \"html_strip\" ],\n              \"filter\" : [ \"german_stop\" ],\n              \"tokenizer\" : \"standard\"\n            },\n            \"ngram_analyzer\" : {\n              \"type\" : \"custom\",\n              \"char_filter\" : [ \"html_strip\" ],\n              \"filter\" : [ \"standard\", \"lowercase\", \"synonym_filter\", \"asciifolding\", \"edgengram_filter\", \"ngram_filter\" ],\n              \"tokenizer\" : \"lowercase\"\n            },\n            \"edgengram_analyzer\" : {\n              \"type\" : \"custom\",\n              \"char_filter\" : [ \"html_strip\" ],\n              \"filter\" : [ \"standard\", \"lowercase\", \"synonym_filter\", \"asciifolding\", \"edgengram_filter\" ],\n              \"tokenizer\" : \"lowercase\"\n            }\n          },\n          \"tokenizer\" : {\n            \"decomp\" : {\n              \"type\" : \"standard\",\n              \"filter\" : [ \"decomp\" ]\n            }\n          }\n        },\n        \"number_of_shards\" : \"6\",\n        \"version\" : {\n          \"created\" : \"2010099\"\n        }\n      }\n    }\n  },\n  \"ch_production_catalog\" : {\n    \"settings\" : {\n      \"index\" : {\n        \"creation_date\" : \"1449005895395\",\n        \"uuid\" : \"0Wmnq0XNR-OBI20Ts3eNSw\",\n        \"number_of_replicas\" : \"1\",\n        \"number_of_shards\" : \"4\",\n        \"version\" : {\n          \"created\" : \"2010099\"\n        }\n      }\n    }\n  },\n  \"stats\" : {\n    \"settings\" : {\n      \"index\" : {\n        \"creation_date\" : \"1455008875587\",\n        \"uuid\" : \"vIEGmhOXQ5abPpSVcedwiw\",\n        \"number_of_replicas\" : \"1\",\n        \"number_of_shards\" : \"6\",\n        \"version\" : {\n          \"created\" : \"2010099\"\n        }\n      }\n    }\n  }\n}\n```\n\ncurl localhost:15005/_cluster/settings?pretty\n\n```\n{\n  \"persistent\" : { },\n  \"transient\" : {\n    \"logger\" : {\n      \"_root\" : \"INFO\"\n    },\n    \"cluster\" : {\n      \"routing\" : {\n        \"allocation\" : {\n          \"enable\" : \"all\"\n        }\n      }\n    }\n  }\n}\n```\n\nelasticsearch.yml:\n\n```\ncat /etc/elasticsearch-production/elasticsearch.yml  | sed 's/#.*//' | grep -v '^ *$'\ncluster.name: spryker-production\nnode.name: psz-ses-00\nnode.master: true\nnode.data: true\nnode.max_local_storage_nodes: 1\nindex.number_of_shards: 6\nindex.number_of_replicas: 1\nbootstrap.mlockall: true\nnetwork.bind_host: 0.0.0.0\nnetwork.publish_host: 10.x.x.x\nhttp.port: 15005\ntransport.tcp.port: 25005\ntransport.tcp.compress: false\ngateway.recover_after_nodes: 2\ngateway.recover_after_time: 3m\ngateway.expected_nodes: 3\ncluster.routing.allocation.node_initial_primaries_recoveries: 4\ncluster.routing.allocation.node_concurrent_recoveries: 2\ncluster.routing.allocation.disk.watermark.low: 90%\ncluster.routing.allocation.disk.watermark.high: 95%\nindices.recovery.max_bytes_per_sec: 50mb\nindices.recovery.concurrent_streams: 5\nindices.store.throttle.max_bytes_per_sec: 100mb\nindices.cache.filter.size: 100M\nindices.fielddata.cache.size: 100M\nindices.fielddata.cache.expire: 30m\nindices.memory.index_buffer_size: 15%\nindex.query.bool.max_clause_count: 10000\ndiscovery.zen.minimum_master_nodes: 2\ndiscovery.zen.ping.timeout: 5s\ndiscovery.zen.ping.multicast.enabled: false\ndiscovery.type: ec2\ncloud.aws.region: eu-central-1\ndiscovery.ec2.groups: sg-xxxxxxxx\nplugin.mandatory: \"cloud-aws\"\nindex.search.slowlog.threshold.query.warn: 10s\nindex.search.slowlog.threshold.query.info: 5s\nindex.search.slowlog.threshold.fetch.warn: 1s\nindex.search.slowlog.threshold.fetch.info: 800ms\nindex.indexing.slowlog.threshold.index.warn: 10s\nindex.indexing.slowlog.threshold.index.info: 5s\nmonitor.jvm.gc.young.warn: 1000ms\nmonitor.jvm.gc.young.info: 700ms\nmonitor.jvm.gc.young.debug: 400ms\nmonitor.jvm.gc.old.warn: 10s\nmonitor.jvm.gc.old.info: 5s\nmonitor.jvm.gc.old.debug: 2s\naction.disable_delete_all_indices: true\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186378228","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-186378228","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":186378228,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjM3ODIyOA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T19:55:13Z","updated_at":"2016-02-19T19:55:13Z","author_association":"MEMBER","body":"Do you have an index template set up?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186395696","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-186395696","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":186395696,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjM5NTY5Ng==","user":{"login":"marek-obuchowicz","id":712751,"node_id":"MDQ6VXNlcjcxMjc1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/712751?v=4","gravatar_id":"","url":"https://api.github.com/users/marek-obuchowicz","html_url":"https://github.com/marek-obuchowicz","followers_url":"https://api.github.com/users/marek-obuchowicz/followers","following_url":"https://api.github.com/users/marek-obuchowicz/following{/other_user}","gists_url":"https://api.github.com/users/marek-obuchowicz/gists{/gist_id}","starred_url":"https://api.github.com/users/marek-obuchowicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marek-obuchowicz/subscriptions","organizations_url":"https://api.github.com/users/marek-obuchowicz/orgs","repos_url":"https://api.github.com/users/marek-obuchowicz/repos","events_url":"https://api.github.com/users/marek-obuchowicz/events{/privacy}","received_events_url":"https://api.github.com/users/marek-obuchowicz/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T20:36:34Z","updated_at":"2016-02-19T20:36:34Z","author_association":"NONE","body":"No, I'm not using it. Just double checked, `GET /_template` returns empty response.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186396885","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-186396885","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":186396885,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjM5Njg4NQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T20:40:49Z","updated_at":"2016-02-19T20:40:49Z","author_association":"MEMBER","body":"What request do you use to create the index? Do you do a put mappings after the index is created?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186409755","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-186409755","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":186409755,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjQwOTc1NQ==","user":{"login":"marek-obuchowicz","id":712751,"node_id":"MDQ6VXNlcjcxMjc1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/712751?v=4","gravatar_id":"","url":"https://api.github.com/users/marek-obuchowicz","html_url":"https://github.com/marek-obuchowicz","followers_url":"https://api.github.com/users/marek-obuchowicz/followers","following_url":"https://api.github.com/users/marek-obuchowicz/following{/other_user}","gists_url":"https://api.github.com/users/marek-obuchowicz/gists{/gist_id}","starred_url":"https://api.github.com/users/marek-obuchowicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marek-obuchowicz/subscriptions","organizations_url":"https://api.github.com/users/marek-obuchowicz/orgs","repos_url":"https://api.github.com/users/marek-obuchowicz/repos","events_url":"https://api.github.com/users/marek-obuchowicz/events{/privacy}","received_events_url":"https://api.github.com/users/marek-obuchowicz/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T21:13:44Z","updated_at":"2016-02-19T21:13:44Z","author_association":"NONE","body":"When setting up a new index, we call:\n\n```\nPUT /index_name\n```\n\nwith body like\n\n```\n{\n   \"settings\": {\n      \"index\": {\n         \"max_result_window\": 100000\n      },\n      \"analysis\": {\n         ....\n      }\n  },\n  \"mappings\": {\n    ...\n  }\n}\n\nAnd then we put data into new index.\nWhen we need to adjust mappings, we create a new index, point `writer` alias there, put data and when it's done - we point alias `reader` there, so we don't have downtimes. So the answer is - no, we don't update mappings afterwards. \n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186415674","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-186415674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":186415674,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjQxNTY3NA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T21:30:48Z","updated_at":"2016-02-19T21:30:48Z","author_association":"MEMBER","body":"And the mappings are exactly what you posted earlier in your get mappings output? You have _all there under properties as a string, which is what causes the conflict. Bit I am trying to understand how this got through mapping conflict checks, but then triggers them later. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/186425703","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-186425703","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":186425703,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NjQyNTcwMw==","user":{"login":"marek-obuchowicz","id":712751,"node_id":"MDQ6VXNlcjcxMjc1MQ==","avatar_url":"https://avatars1.githubusercontent.com/u/712751?v=4","gravatar_id":"","url":"https://api.github.com/users/marek-obuchowicz","html_url":"https://github.com/marek-obuchowicz","followers_url":"https://api.github.com/users/marek-obuchowicz/followers","following_url":"https://api.github.com/users/marek-obuchowicz/following{/other_user}","gists_url":"https://api.github.com/users/marek-obuchowicz/gists{/gist_id}","starred_url":"https://api.github.com/users/marek-obuchowicz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marek-obuchowicz/subscriptions","organizations_url":"https://api.github.com/users/marek-obuchowicz/orgs","repos_url":"https://api.github.com/users/marek-obuchowicz/repos","events_url":"https://api.github.com/users/marek-obuchowicz/events{/privacy}","received_events_url":"https://api.github.com/users/marek-obuchowicz/received_events","type":"User","site_admin":false},"created_at":"2016-02-19T21:54:02Z","updated_at":"2016-02-19T21:54:02Z","author_association":"NONE","body":"The initial definition for mapping, when creating index, is following:\n\n```\n{\n   \"mappings\": {\n      \"product\": {\n         \"properties\": {\n            \"_all\": {\n               \"type\": \"string\",\n               \"analyzer\": \"main_analyzer\"\n            },\n            \"is_active\": {\n               \"type\": \"boolean\"\n            },\n            \"sku\": {\n               \"type\": \"string\",\n               \"index\": \"not_analyzed\"\n            },\n            \"min_price\": {\n               \"type\": \"long\"\n            },\n            \"merchants\": {\n               \"properties\": {\n                  \"id\": {\n                     \"type\": \"long\"\n                  },\n                  \"name\": {\n                     \"type\": \"string\",\n                     \"fields\": {\n                        \"raw\": {\n                           \"type\": \"string\",\n                           \"index\": \"not_analyzed\"\n                        }\n                     }\n                  },\n                  \"is_active\": {\n                     \"type\": \"boolean\"\n                  },\n                  \"price\": {\n                     \"type\": \"long\"\n                  }\n               }\n            },\n            \"brand_name\": {\n               \"type\": \"string\",\n               \"fields\": {\n                  \"raw\": {\n                     \"type\": \"string\",\n                     \"index\": \"not_analyzed\"\n                  },\n                  \"suggest\": {\n                     \"type\": \"completion\",\n                     \"analyzer\": \"simple\",\n                     \"search_analyzer\": \"simple\",\n                     \"payloads\": true\n                  }\n               }\n            },\n            \"brand_suggest\": {\n               \"type\": \"completion\",\n               \"analyzer\": \"simple\",\n               \"search_analyzer\": \"simple\",\n               \"payloads\": true\n            },\n            \"de_CH\": {\n               \"properties\": {\n                  \"short_description\": {\n                     \"type\": \"string\",\n                     \"analyzer\": \"main_analyzer\",\n                     \"fields\": {\n                        \"english_words\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"english_main_analyzer\"\n                        },\n                        \"shingles\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"analyzer_shingle\"\n                        },\n                        \"decomp\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"decomp_analyzer\",\n                           \"search_analyzer\": \"main_analyzer\"\n                        },\n                        \"ngrams\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"ngram_analyzer\"\n                        },\n                        \"correction\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"suggestion_analyzer\"\n                        },\n                        \"suggest\": {\n                           \"type\": \"completion\",\n                           \"analyzer\": \"simple\",\n                           \"search_analyzer\": \"simple\",\n                           \"payloads\": true\n                        },\n                        \"front\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"edgengram_analyzer\"\n                        },\n                        \"prefix\": {\n                           \"analyzer\": \"prefix_analyzer\",\n                           \"type\": \"string\"\n                        },\n                        \"keywords\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"keywords_analyzer\"\n                        }\n                     }\n                  },\n                  \"long_description\": {\n                     \"type\": \"string\",\n                     \"analyzer\": \"main_analyzer\",\n                     \"fields\": {\n                        \"english_words\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"english_main_analyzer\"\n                        },\n                        \"shingles\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"analyzer_shingle\"\n                        },\n                        \"decomp\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"decomp_analyzer\",\n                           \"search_analyzer\": \"main_analyzer\"\n                        },\n                        \"ngrams\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"ngram_analyzer\"\n                        },\n                        \"correction\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"suggestion_analyzer\"\n                        },\n                        \"suggest\": {\n                           \"type\": \"completion\",\n                           \"analyzer\": \"simple\",\n                           \"search_analyzer\": \"simple\",\n                           \"payloads\": true\n                        },\n                        \"front\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"edgengram_analyzer\"\n                        },\n                        \"prefix\": {\n                           \"analyzer\": \"prefix_analyzer\",\n                           \"type\": \"string\"\n                        },\n                        \"keywords\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"keywords_analyzer\"\n                        }\n                     }\n                  },\n                  \"name\": {\n                     \"type\": \"string\",\n                     \"analyzer\": \"main_analyzer\",\n                     \"fields\": {\n                        \"english_words\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"english_main_analyzer\"\n                        },\n                        \"shingles\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"analyzer_shingle\"\n                        },\n                        \"decomp\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"decomp_analyzer\",\n                           \"search_analyzer\": \"main_analyzer\"\n                        },\n                        \"ngrams\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"ngram_analyzer\"\n                        },\n                        \"correction\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"suggestion_analyzer\"\n                        },\n                        \"suggest\": {\n                           \"type\": \"completion\",\n                           \"analyzer\": \"simple\",\n                           \"search_analyzer\": \"simple\",\n                           \"payloads\": true\n                        },\n                        \"front\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"edgengram_analyzer\"\n                        },\n                        \"prefix\": {\n                           \"analyzer\": \"prefix_analyzer\",\n                           \"type\": \"string\"\n                        },\n                        \"keywords\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"keywords_analyzer\"\n                        }\n                     }\n                  },\n                  \"categories\": {\n                     \"type\": \"nested\",\n                     \"properties\": {\n                        \"id\": {\n                           \"type\": \"long\"\n                        },\n                        \"name\": {\n                           \"type\": \"string\",\n                           \"fields\": {\n                              \"raw\": {\n                                 \"type\": \"string\",\n                                 \"index\": \"not_analyzed\"\n                              },\n                              \"suggest\": {\n                                 \"type\": \"completion\",\n                                 \"analyzer\": \"simple\",\n                                 \"search_analyzer\": \"simple\",\n                                 \"payloads\": true\n                              },\n                              \"english_words\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"english_main_analyzer\"\n                              },\n                              \"shingles\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"analyzer_shingle\"\n                              },\n                              \"decomp\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"decomp_analyzer\",\n                                 \"search_analyzer\": \"main_analyzer\"\n                              },\n                              \"ngrams\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"ngram_analyzer\"\n                              },\n                              \"front\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"edgengram_analyzer\"\n                              }\n                           }\n                        }\n                     }\n                  },\n                  \"parent_categories\": {\n                     \"type\": \"nested\",\n                     \"properties\": {\n                        \"id\": {\n                           \"type\": \"long\"\n                        },\n                        \"name\": {\n                           \"type\": \"string\",\n                           \"fields\": {\n                              \"raw\": {\n                                 \"type\": \"string\",\n                                 \"index\": \"not_analyzed\"\n                              },\n                              \"suggest\": {\n                                 \"type\": \"completion\",\n                                 \"analyzer\": \"simple\",\n                                 \"search_analyzer\": \"simple\",\n                                 \"payloads\": true\n                              },\n                              \"english_words\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"english_main_analyzer\"\n                              },\n                              \"shingles\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"analyzer_shingle\"\n                              },\n                              \"decomp\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"decomp_analyzer\",\n                                 \"search_analyzer\": \"main_analyzer\"\n                              },\n                              \"ngrams\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"ngram_analyzer\"\n                              },\n                              \"front\": {\n                                 \"type\": \"string\",\n                                 \"analyzer\": \"edgengram_analyzer\"\n                              }\n                           }\n                        }\n                     }\n                  },\n                  \"top_features\": {\n                     \"type\": \"nested\",\n                     \"properties\": {\n                        \"name\": {\n                           \"type\": \"string\",\n                           \"fields\": {\n                              \"raw\": {\n                                 \"type\": \"string\",\n                                 \"index\": \"not_analyzed\"\n                              }\n                           }\n                        },\n                        \"value\": {\n                           \"type\": \"string\",\n                           \"fields\": {\n                              \"raw\": {\n                                 \"type\": \"string\",\n                                 \"index\": \"not_analyzed\"\n                              }\n                           }\n                        }\n                     }\n                  },\n                  \"attributes\": {\n                     \"properties\": {\n                        \"tags\": {\n                           \"type\": \"string\",\n                           \"fields\": {\n                              \"raw\": {\n                                 \"type\": \"string\",\n                                 \"index\": \"not_analyzed\"\n                              }\n                           }\n                        }\n                     }\n                  }\n               }\n            },\n            \"images\": {\n               \"properties\": {\n                  \"highres\": {\n                     \"type\": \"string\",\n                     \"index\": \"not_analyzed\"\n                  },\n                  \"lowres\": {\n                     \"type\": \"string\",\n                     \"index\": \"not_analyzed\"\n                  },\n                  \"thumbnails\": {\n                     \"type\": \"string\",\n                     \"index\": \"not_analyzed\"\n                  }\n               }\n            },\n            \"search-result-data\": {\n               \"properties\": {\n                  \"abstract_name\": {\n                     \"type\": \"string\",\n                     \"index\": \"not_analyzed\"\n                  },\n                  \"abstract_sku\": {\n                     \"type\": \"string\",\n                     \"index\": \"not_analyzed\"\n                  },\n                  \"id_abstract_product\": {\n                     \"type\": \"long\"\n                  },\n                  \"id_touch\": {\n                     \"type\": \"long\"\n                  },\n                  \"url\": {\n                     \"type\": \"string\",\n                     \"index\": \"not_analyzed\"\n                  }\n               }\n            },\n            \"localizedAttributes\": {\n               \"properties\": {\n               }\n            }\n         }\n      }\n   }\n}\n```\n\n(i removed `analysys` section from the snippet above, as it seems to be not important in this issue)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/187422279","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-187422279","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":187422279,"node_id":"MDEyOklzc3VlQ29tbWVudDE4NzQyMjI3OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-02-22T22:43:45Z","updated_at":"2016-02-22T22:43:45Z","author_association":"MEMBER","body":"@marek-obuchowicz The issue is you specify a metadata mapper (`_all`) inside mapping properties, as well as try to set the type to `string`.  `_all` is a special field, and the type is an internal mapper, not just a normal string. I'm still not sure how 2.1 allows setting it this way without an error and does not find the issue until a recovery is done, but this should be fixed in 2.2 (where we have additional checks that metadata mappers are not recreated inside mappings).\n\nYou need to change your mappings from this:\n\n```\n{\n   \"mappings\": {\n      \"product\": {\n         \"properties\": {\n            \"_all\": {\n               \"type\": \"string\",\n               \"analyzer\": \"main_analyzer\"\n            },\n...\n```\n\nTo this:\n\n```\n{\n   \"mappings\": {\n      \"product\": {\n        \"_all\": {\n          \"analyzer\": \"main_analyzer\"\n        },\n        \"properties\": {\n...    \n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/206293978","html_url":"https://github.com/elastic/elasticsearch/issues/16716#issuecomment-206293978","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/16716","id":206293978,"node_id":"MDEyOklzc3VlQ29tbWVudDIwNjI5Mzk3OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-04-06T10:25:11Z","updated_at":"2016-04-06T10:25:11Z","author_association":"CONTRIBUTOR","body":"I think this issue can be closed now\n","performed_via_github_app":null}]