{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/32822","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32822/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32822/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/32822/events","html_url":"https://github.com/elastic/elasticsearch/issues/32822","id":350174837,"node_id":"MDU6SXNzdWUzNTAxNzQ4Mzc=","number":32822,"title":"minimum_should_match ignored in ES 2.4","user":{"login":"elenaoat","id":3646926,"node_id":"MDQ6VXNlcjM2NDY5MjY=","avatar_url":"https://avatars2.githubusercontent.com/u/3646926?v=4","gravatar_id":"","url":"https://api.github.com/users/elenaoat","html_url":"https://github.com/elenaoat","followers_url":"https://api.github.com/users/elenaoat/followers","following_url":"https://api.github.com/users/elenaoat/following{/other_user}","gists_url":"https://api.github.com/users/elenaoat/gists{/gist_id}","starred_url":"https://api.github.com/users/elenaoat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elenaoat/subscriptions","organizations_url":"https://api.github.com/users/elenaoat/orgs","repos_url":"https://api.github.com/users/elenaoat/repos","events_url":"https://api.github.com/users/elenaoat/events{/privacy}","received_events_url":"https://api.github.com/users/elenaoat/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-08-13T20:08:55Z","updated_at":"2018-08-14T17:52:39Z","closed_at":"2018-08-14T07:39:09Z","author_association":"NONE","active_lock_reason":null,"body":"I am getting weird behaviour with \"minimum_should_match\" used inside \"multi_match\".\r\nES version: 2.4.6\r\n\r\nPlugins installed: Kibana, sense\r\n\r\nJava version:\r\njava version \"1.8.0_102\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_102-b14)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.102-b14, mixed mode)\r\n\r\nOS:\r\nDarwin Kernel Version 17.7.0\r\n\r\nHere's the request I am using to create the index:\r\n\r\n```\r\nPUT /docs \r\n{\r\n    \"settings\": {\r\n        \"number_of_shards\": 1,\r\n        \"number_of_replicas\": 1,\r\n        \"index\": {\r\n            \"analysis\": {\r\n                \"filter\": {\r\n                    \"trigrams_filter\": {\r\n                        \"type\":     \"ngram\",\r\n                        \"min_gram\": 3,\r\n                        \"max_gram\": 3\r\n                    }\r\n                },\r\n                \"analyzer\": {\r\n                    \"analyzer_startswith\": {\r\n                        \"tokenizer\": \"keyword\",\r\n                        \"filter\": \"lowercase\"\r\n                    },\r\n                    \"snowball\" : {\r\n                      \"type\" : \"snowball\"\r\n                    },\r\n                    \"trigrams\": {\r\n                        \"type\":      \"custom\",\r\n                        \"tokenizer\": \"standard\",\r\n                        \"filter\":   [\r\n                            \"lowercase\",\r\n                            \"trigrams_filter\"\r\n                        ]\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    \"mappings\": {\r\n        \"modelresult\": {\r\n            \"properties\": {\r\n              \"allergies\" : {\r\n                \"type\" : \"string\",\r\n                \"analyzer\" : \"snowball\"\r\n              },\r\n              \"diets\" : {\r\n                \"type\" : \"string\",\r\n                \"analyzer\" : \"snowball\"\r\n              },\r\n              \"mealtypes\" : {\r\n                \"type\" : \"string\",\r\n                \"analyzer\" : \"snowball\"\r\n              },\r\n              \"medications\" : {\r\n                \"type\" : \"string\",\r\n                \"analyzer\" : \"snowball\"\r\n              },\r\n              \"django_ct\" : {\r\n                \"type\" : \"string\",\r\n                \"index\" : \"not_analyzed\",\r\n                \"include_in_all\" : \"false\"\r\n              },\r\n              \"django_id\" : {\r\n                \"type\" : \"string\",\r\n                \"index\" : \"not_analyzed\",\r\n                \"include_in_all\" : \"false\"\r\n              },\r\n              \"id\" : {\r\n                \"type\" : \"string\"\r\n              },\r\n              \"is_published\" : {\r\n                \"type\" : \"boolean\"\r\n              },\r\n              \"outdated\" : {\r\n                \"type\" : \"boolean\"\r\n              },\r\n              \"source_db\" : {\r\n                \"type\" : \"string\"\r\n              },\r\n              \"FdGrp_Cd\" : {\r\n                \"type\" : \"string\"\r\n              },\r\n              \"original_country\" : {\r\n                \"type\" : \"string\"\r\n              },\r\n              \"additional_information\" : {\r\n                \"type\" : \"string\"\r\n              },\r\n              \"text\" : {\r\n                \"type\" : \"string\",\r\n                \"fields\": {\r\n                  \"en\": {\r\n                    \"type\":     \"string\",\r\n                    \"analyzer\": \"english\"\r\n                  },\r\n                  \"fi\": {\r\n                    \"type\":     \"string\",\r\n                    \"analyzer\": \"finnish\"\r\n                  },\r\n                  \"de\": {\r\n                    \"type\":     \"string\",\r\n                    \"analyzer\": \"german\"\r\n                  },\r\n                  \"sv\": {\r\n                    \"type\":     \"string\",\r\n                    \"analyzer\": \"swedish\"\r\n                  },\r\n                  \"general\": {\r\n                    \"type\":     \"string\",\r\n                    \"analyzer\": \"trigrams\"\r\n                  }\r\n                }\r\n              },\r\n              \"user_id\" : {\r\n                \"type\" : \"string\",\r\n                \"analyzer\" : \"snowball\"\r\n              },\r\n              \"homecare_area\" : {\r\n                \"type\" : \"string\",\r\n                \"analyzer\" : \"snowball\"\r\n              },\r\n              \"lang\" : {\r\n                \"type\" : \"string\",\r\n                \"analyzer\" : \"snowball\"\r\n              }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n```\r\nHere's the query I am running:\r\n```\r\nGET /docs/_search\r\n{\r\n  \"query\": {\r\n    \"filtered\": {\r\n      \"filter\": {\r\n        \"bool\": {\r\n          \"must\": [\r\n            {\r\n              \"term\": {\r\n                \"outdated\": \"false\"\r\n              }\r\n            },\r\n            {\r\n              \"term\": {\r\n                \"lang\": \"fi\"\r\n              }\r\n            }\r\n          ],\r\n          \"must_not\": [\r\n            {\r\n              \"term\": {\r\n                \"django_ct\": \"web.plantranslation\"\r\n              }\r\n            },\r\n            {\r\n              \"term\": {\r\n                \"django_ct\": \"web.recipetranslation\"\r\n              }\r\n            },\r\n            {\r\n              \"term\": {\r\n                \"django_ct\": \"web.fooddestranslation\"\r\n              }\r\n            },\r\n            {\r\n              \"term\": {\r\n                \"django_ct\": \"web.dishtranslation\"\r\n              }\r\n            },\r\n            {\r\n              \"term\": {\r\n                \"django_ct\": \"web.customerinformation\"\r\n              }\r\n            }\r\n          ],\r\n          \"should\": []\r\n        }\r\n      },\r\n      \"query\": {\r\n        \"bool\": {\r\n          \"should\": [\r\n            {\r\n              \"span_first\": {\r\n                \"boost\": 10,\r\n                \"end\": 1,\r\n                \"match\": {\r\n                  \"span_term\": {\r\n                    \"text\": \"makkara\"\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          ],\r\n          \"must\": [\r\n            {\r\n              \"multi_match\": {\r\n                \"query\": \"makkara\",\r\n                \"type\": \"most_fields\",\r\n                \"fields\": [\"text.general\", \"text.fi\"],\r\n                \"minimum_should_match\": \"50%\"\r\n              }\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"size\": 1000\r\n}\r\n```\r\nThe minimum_should_match is being ignored in ES 2.4.6. It doesn't matter what value is put, it always returns way too many results. \r\nThis worked for ES 1.7, 2.0.1 and 2.0.2, I've tested. But it's being ignored for ES 2.4.6. What is the reason? Was there some change introduced that makes \"minimum_should_match\" obsolete?\r\n\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}