{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27661","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27661/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27661/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27661/events","html_url":"https://github.com/elastic/elasticsearch/issues/27661","id":279210590,"node_id":"MDU6SXNzdWUyNzkyMTA1OTA=","number":27661,"title":"After upgrading from 5.6.3 to 6.0.0, complains that ingest pipeline does not exists, although it does still exist.","user":{"login":"vchan2002","id":10999697,"node_id":"MDQ6VXNlcjEwOTk5Njk3","avatar_url":"https://avatars3.githubusercontent.com/u/10999697?v=4","gravatar_id":"","url":"https://api.github.com/users/vchan2002","html_url":"https://github.com/vchan2002","followers_url":"https://api.github.com/users/vchan2002/followers","following_url":"https://api.github.com/users/vchan2002/following{/other_user}","gists_url":"https://api.github.com/users/vchan2002/gists{/gist_id}","starred_url":"https://api.github.com/users/vchan2002/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vchan2002/subscriptions","organizations_url":"https://api.github.com/users/vchan2002/orgs","repos_url":"https://api.github.com/users/vchan2002/repos","events_url":"https://api.github.com/users/vchan2002/events{/privacy}","received_events_url":"https://api.github.com/users/vchan2002/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-12-05T01:17:01Z","updated_at":"2017-12-07T13:49:05Z","closed_at":"2017-12-07T13:49:04Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**:\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** 6.0.0\r\n\r\n**Plugins installed**: ec2-discovery,s3-repository\r\n\r\n**JVM version** (`java -version`): 1.8.151\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Amazon Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\n**Steps to reproduce**:\r\n\r\n\r\n 1.  Initially, I have a ES 5.6.3 cluster, which I have filebeat 6.0.0 pointing system logs to it.  I enabled the system module, which created several ingest pipelines, one of which is called filebeat-6.0.0-system-auth-pipeline.  Filebeat was working fine and elasticsearch ingest pipeline was parsing the system logs correctly.\r\n 2.  I decided to upgrade to 6.0.0 by spinning up a 6.0.0 node, then retiring the old 5.6.3 node, then adding another 6.0.0 node.  I did the Kibana upgrade and it worked fine.\r\n 3.  The 1st 6.0.0 node on elasticsearch complains that the filebeat-6.0.0-system-auth-pipeline is missing... However, what is odd is that hitting _ingest/pipeline/filebeat-6.0.0-system-auth-pipeline API turns up the pipeline with all of the information.. so it's there....\r\n4.  Just to be curious, I restarted the ES node that's throwing the error, but then it stopped throwing the error about ingest pipeline missing.\r\n5.  During all this time, however, the additional parsing that I'm expecting from the ingest node has stopped working.\r\n6.  Just to be curious, I went back to the filebeat node that I have setup, which had been working fine... the filebeat config does not explicitly specify the a pipeline... even though.. when it was in 5.6.3, it was able to work and the ingest nodes were parsing the logs....\r\n7.  So, I was like... why not.... I added, explictly, the pipeline parameter in the output section....\r\n8.  Now Beats throws an error complaining the ingest pipeline does not exists... again.... the pipeline actually does exist.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\nFrom elasticsearch\r\n\r\n[2017-12-05T00:13:42,662][DEBUG][o.e.a.b.TransportBulkAction] [venuereporting-es5-2-43-7f9c-es-01] failed to execute pipeline [filebeat-6.0.0-system-auth-pipeline] for document [filebeat-6.0.0-2017.12.05/doc/null]\r\njava.lang.IllegalArgumentException: pipeline with id [filebeat-6.0.0-system-auth-pipeline] does not exist\r\n        at org.elasticsearch.ingest.PipelineExecutionService.getPipeline(PipelineExecutionService.java:189) ~[elasticsearch-6.0.0.jar:6.0.0]\r\n        at org.elasticsearch.ingest.PipelineExecutionService.access$100(PipelineExecutionService.java:41) ~[elasticsearch-6.0.0.jar:6.0.0]\r\n        at org.elasticsearch.ingest.PipelineExecutionService$2.doRun(PipelineExecutionService.java:88) [elasticsearch-6.0.0.jar:6.0.0]\r\n        at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:638) [elasticsearch-6.0.0.jar:6.0.0]\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-6.0.0.jar:6.0.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_151]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_151]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\n\r\nLogs from BEATS after I tried to have it explicitly use a pipeline.\r\n\r\n2017-12-05T01:07:38Z WARN Can not index event (status=400): {\"type\":\"illegal_argument_exception\",\"reason\":\"pipeline with id [filebeat-6.0.0-system-auth-pipeline] does not exist\"}\r\n\r\nDo ingest pipelines carry over from version upgrade of 5 to 6?  Did I miss something that needs to be done to them?\r\n\r\n\r\n","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}