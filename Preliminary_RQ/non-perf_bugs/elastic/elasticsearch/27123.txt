{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/27123","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27123/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27123/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/27123/events","html_url":"https://github.com/elastic/elasticsearch/issues/27123","id":268730498,"node_id":"MDU6SXNzdWUyNjg3MzA0OTg=","number":27123,"title":"Documents outside geoshape query are returned","user":{"login":"arko-r","id":6031118,"node_id":"MDQ6VXNlcjYwMzExMTg=","avatar_url":"https://avatars3.githubusercontent.com/u/6031118?v=4","gravatar_id":"","url":"https://api.github.com/users/arko-r","html_url":"https://github.com/arko-r","followers_url":"https://api.github.com/users/arko-r/followers","following_url":"https://api.github.com/users/arko-r/following{/other_user}","gists_url":"https://api.github.com/users/arko-r/gists{/gist_id}","starred_url":"https://api.github.com/users/arko-r/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arko-r/subscriptions","organizations_url":"https://api.github.com/users/arko-r/orgs","repos_url":"https://api.github.com/users/arko-r/repos","events_url":"https://api.github.com/users/arko-r/events{/privacy}","received_events_url":"https://api.github.com/users/arko-r/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-10-26T11:52:24Z","updated_at":"2017-12-22T11:54:29Z","closed_at":"2017-12-22T11:54:29Z","author_association":"NONE","active_lock_reason":null,"body":"I have a geoshape query which returns more documents than it should.\r\nSome of the documents are outside of the coordinates specified in the query.\r\n\r\nThe query specifies a latitude between 54 and 55, but in the results documents with a latitude of 55.01 are also returned (longitude is inside specified coordinate range).\r\nHowever searching for a longitude between -8 and 9, a longitude of 9.01 is not included in the results (latitude is inside specified coordinate range)\r\n\r\nDid I miss something what causes the document with latitude 55.01 to be returned, or is this a bug?\r\n\r\n**Elasticsearch version**: 6.0.0-rc1\r\n**JVM version**: 1.8.0_144\r\n**OS version**: Windows 10\r\n\r\n**Steps to reproduce**:\r\n_Mapping_\r\n`curl -XPUT \"http://localhost:9200/test\" -H 'Content-Type: application/json' -d'\r\n{\"settings\":{\"number_of_shards\":1,\"number_of_replicas\":0},\"mappings\":{\"value\":{\"properties\":{\"location\":{\"type\":\"geo_shape\"}}}}}'`\r\n_Data_\r\n`curl -XPOST \"http://localhost:9200/_bulk\" -H 'Content-Type: application/json' -d'\r\n{\"index\":{\"_index\":\"test\",\"_type\":\"value\"}}\r\n{\"location\":{\"type\":\"point\",\"coordinates\":[54.999,7.497]}}\r\n{\"index\":{\"_index\":\"test\",\"_type\":\"value\"}}\r\n{\"location\":{\"type\":\"point\",\"coordinates\":[55,7.497]}}\r\n{\"index\":{\"_index\":\"test\",\"_type\":\"value\"}}\r\n{\"location\":{\"type\":\"point\",\"coordinates\":[55.01,8.2]}}\r\n{\"index\":{\"_index\":\"test\",\"_type\":\"value\"}}\r\n{\"location\":{\"type\":\"point\",\"coordinates\":[54.5,9.01]}}\r\n{\"index\":{\"_index\":\"test\",\"_type\":\"value\"}}\r\n{\"location\":{\"type\":\"point\",\"coordinates\":[54.5,9.01]}}\r\n'`\r\n_Query_\r\n`curl -XGET \"http://localhost:9200/test/_search\" -H 'Content-Type: application/json' -d'\r\n{\"query\":{\"bool\":{\"must\":{\"match_all\":{}},\"filter\":{\"geo_shape\":{\"location\":{\"shape\":{\"type\":\"envelope\",\"coordinates\":[[55,-8],[54,9]]},\"relation\":\"within\"}}}}}}'`","closed_by":{"login":"DaveCTurner","id":5058284,"node_id":"MDQ6VXNlcjUwNTgyODQ=","avatar_url":"https://avatars3.githubusercontent.com/u/5058284?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveCTurner","html_url":"https://github.com/DaveCTurner","followers_url":"https://api.github.com/users/DaveCTurner/followers","following_url":"https://api.github.com/users/DaveCTurner/following{/other_user}","gists_url":"https://api.github.com/users/DaveCTurner/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveCTurner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveCTurner/subscriptions","organizations_url":"https://api.github.com/users/DaveCTurner/orgs","repos_url":"https://api.github.com/users/DaveCTurner/repos","events_url":"https://api.github.com/users/DaveCTurner/events{/privacy}","received_events_url":"https://api.github.com/users/DaveCTurner/received_events","type":"User","site_admin":false},"performed_via_github_app":null}