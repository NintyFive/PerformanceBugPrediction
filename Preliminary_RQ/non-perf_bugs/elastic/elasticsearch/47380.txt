{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/47380","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47380/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47380/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/47380/events","html_url":"https://github.com/elastic/elasticsearch/issues/47380","id":501004414,"node_id":"MDU6SXNzdWU1MDEwMDQ0MTQ=","number":47380,"title":"AzureBlobStoreRepositoryTests.testSnapshotWithLargeSegmentFiles fails on 7.x with Internal Server Error","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"},{"id":148612629,"node_id":"MDU6TGFiZWwxNDg2MTI2Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Etest-failure","name":">test-failure","color":"207de5","default":false,"description":"Triaged test failures from CI"}],"state":"closed","locked":false,"assignee":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"assignees":[{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2019-10-01T16:19:57Z","updated_at":"2019-10-22T09:40:26Z","closed_at":"2019-10-22T09:40:26Z","author_association":"MEMBER","active_lock_reason":null,"body":"The failure looks like it's coming from the Azure plugin:\r\n\r\n```\r\n  1> [2019-10-01T16:32:40,341][WARN ][o.e.r.VerifyNodeRepositoryAction] [node_sd1] [zcsoxknmm] failed to verify repository\r\n  1> org.elasticsearch.repositories.RepositoryVerificationException: [zcsoxknmm] store location [container] is not accessible on the node [{node_sd1}{38kFyoC3RuSBjX_rgphzjQ}{cO84XnveTPafOEcEqSWK3w}{127.0.0.1}{127.0.0.1:39435}{di}]\r\n  1> \tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.verify(BlobStoreRepository.java:1211) ~[elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.repositories.VerifyNodeRepositoryAction.doVerify(VerifyNodeRepositoryAction.java:126) ~[elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.repositories.VerifyNodeRepositoryAction.access$400(VerifyNodeRepositoryAction.java:49) ~[elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.repositories.VerifyNodeRepositoryAction$VerifyNodeRepositoryRequestHandler.messageReceived(VerifyNodeRepositoryAction.java:158) [elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.repositories.VerifyNodeRepositoryAction$VerifyNodeRepositoryRequestHandler.messageReceived(VerifyNodeRepositoryAction.java:153) [elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.RequestHandlerRegistry.processMessageReceived(RequestHandlerRegistry.java:63) [elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.transport.InboundHandler$RequestHandler.doRun(InboundHandler.java:264) [elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:773) [elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_221]\r\n  1> \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_221]\r\n  1> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_221]\r\n  1> Caused by: java.io.IOException: Can not write blob data-38kFyoC3RuSBjX_rgphzjQ.dat\r\n  1> \tat org.elasticsearch.repositories.azure.AzureBlobContainer.writeBlob(AzureBlobContainer.java:104) ~[main/:?]\r\n  1> \tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.verify(BlobStoreRepository.java:1208) ~[elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n  1> \t... 11 more\r\n  1> Caused by: com.microsoft.azure.storage.StorageException: Internal Server Error\r\n  1> \tat com.microsoft.azure.storage.StorageException.translateException(StorageException.java:87) ~[azure-storage-8.0.0.jar:?]\r\n  1> \tat com.microsoft.azure.storage.core.StorageRequest.materializeException(StorageRequest.java:313) ~[azure-storage-8.0.0.jar:?]\r\n  1> \tat com.microsoft.azure.storage.core.ExecutionEngine.executeWithRetry(ExecutionEngine.java:185) ~[azure-storage-8.0.0.jar:?]\r\n  1> \tat com.microsoft.azure.storage.blob.CloudBlockBlob.uploadFullBlob(CloudBlockBlob.java:938) ~[azure-storage-8.0.0.jar:?]\r\n  1> \tat com.microsoft.azure.storage.blob.CloudBlockBlob.upload(CloudBlockBlob.java:768) ~[azure-storage-8.0.0.jar:?]\r\n  1> \tat org.elasticsearch.repositories.azure.AzureStorageService.lambda$writeBlob$15(AzureStorageService.java:333) ~[main/:?]\r\n  1> \tat org.elasticsearch.repositories.azure.SocketAccess.lambda$doPrivilegedVoidException$0(SocketAccess.java:64) ~[main/:?]\r\n  1> \tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_221]\r\n  1> \tat org.elasticsearch.repositories.azure.SocketAccess.doPrivilegedVoidException(SocketAccess.java:63) ~[main/:?]\r\n  1> \tat org.elasticsearch.repositories.azure.AzureStorageService.writeBlob(AzureStorageService.java:332) ~[main/:?]\r\n  1> \tat org.elasticsearch.repositories.azure.AzureBlobStore.writeBlob(AzureBlobStore.java:120) ~[main/:?]\r\n  1> \tat org.elasticsearch.repositories.azure.AzureBlobContainer.writeBlob(AzureBlobContainer.java:102) ~[main/:?]\r\n  1> \tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.verify(BlobStoreRepository.java:1208) ~[elasticsearch-7.5.0-SNAPSHOT.jar:7.5.0-SNAPSHOT]\r\n```\r\n\r\nThis didn't reproduce for me with:\r\n\r\n```\r\n./gradlew ':plugins:repository-azure:test' --tests \"org.elasticsearch.repositories.azure.AzureBlobStoreRepositoryTests.testSnapshotWithLargeSegmentFiles\" -Dtests.seed=163A499DF6578E5A -Dtests.security.manager=true -Dtests.locale=fr-BE -Dtests.timezone=Europe/Zaporozhye -Dcompiler.java=12 -Druntime.java=8\r\n```\r\n\r\nhttps://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+7.x+EAR/158/console\r\nhttps://gradle-enterprise.elastic.co/s/snmdwrgcmvbja","closed_by":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"performed_via_github_app":null}