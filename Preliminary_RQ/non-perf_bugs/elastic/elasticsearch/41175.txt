{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/41175","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41175/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41175/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/41175/events","html_url":"https://github.com/elastic/elasticsearch/issues/41175","id":432795797,"node_id":"MDU6SXNzdWU0MzI3OTU3OTc=","number":41175,"title":"value_as_string does not match value when aggregation involves \"epoch_second\" format","user":{"login":"pushshift","id":12604285,"node_id":"MDQ6VXNlcjEyNjA0Mjg1","avatar_url":"https://avatars3.githubusercontent.com/u/12604285?v=4","gravatar_id":"","url":"https://api.github.com/users/pushshift","html_url":"https://github.com/pushshift","followers_url":"https://api.github.com/users/pushshift/followers","following_url":"https://api.github.com/users/pushshift/following{/other_user}","gists_url":"https://api.github.com/users/pushshift/gists{/gist_id}","starred_url":"https://api.github.com/users/pushshift/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pushshift/subscriptions","organizations_url":"https://api.github.com/users/pushshift/orgs","repos_url":"https://api.github.com/users/pushshift/repos","events_url":"https://api.github.com/users/pushshift/events{/privacy}","received_events_url":"https://api.github.com/users/pushshift/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-04-13T01:56:56Z","updated_at":"2019-04-15T18:01:17Z","closed_at":"2019-04-15T18:01:16Z","author_association":"NONE","active_lock_reason":null,"body":"**Version:** Elasticsearch version 7.0.0 GA\r\n\r\n**Description of problem:**\r\n\r\nWhen an aggregation using an \"epoch_second\" field is used, the value_as_string amount is 1,000 times less than the actual value field. \r\n\r\n**Expected Result:**\r\n\r\n\"value_as_string\" would more or less match the value field.\r\n\r\nRelevant mapping field:\r\n\r\n```\r\n    \"author_created_delta\": {\r\n        \"type\": \"date\",\r\n        \"format\": \"epoch_second\"\r\n    },\r\n```\r\n\r\n**Query:**\r\n\r\n```\r\n{\r\n  \"size\": 0,\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": []\r\n    }\r\n  },\r\n  \"aggs\": {\r\n    \"author_delta\": {\r\n      \"terms\": {\r\n        \"field\": \"author.keyword\",\r\n        \"order\": {\r\n          \"score\": \"asc\"\r\n        },\r\n        \"min_doc_count\": 1000,\r\n        \"size\": 1,\r\n        \"shard_size\": 50010\r\n      },\r\n      \"aggs\": {\r\n        \"score\": {\r\n          \"avg\": {\r\n            \"field\": \"author_created_delta\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Response:**\r\n\r\n```\r\n{\r\n  \"took\": 13115,\r\n  \"timed_out\": false,\r\n  \"_shards\": {\r\n    \"total\": 8,\r\n    \"successful\": 8,\r\n    \"skipped\": 0,\r\n    \"failed\": 0\r\n  },\r\n  \"hits\": {\r\n    \"total\": {\r\n      \"value\": 10000,\r\n      \"relation\": \"gte\"\r\n    },\r\n    \"max_score\": null,\r\n    \"hits\": []\r\n  },\r\n  \"aggregations\": {\r\n    \"author_delta\": {\r\n      \"doc_count_error_upper_bound\": -1,\r\n      \"sum_other_doc_count\": 38857716,\r\n      \"buckets\": [\r\n        {\r\n          \"key\": \"Image-to-Braille-Bot\",\r\n          \"doc_count\": 7156,\r\n          \"score\": {\r\n            \"value\": 10475043.739519285,\r\n            \"value_as_string\": \"10475.043\"\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n","closed_by":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"performed_via_github_app":null}