{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/9390/events","html_url":"https://github.com/elastic/elasticsearch/issues/9390","id":55235433,"node_id":"MDU6SXNzdWU1NTIzNTQzMw==","number":9390,"title":"request queue blocked forever (again)","user":{"login":"Jens-G","id":5834733,"node_id":"MDQ6VXNlcjU4MzQ3MzM=","avatar_url":"https://avatars2.githubusercontent.com/u/5834733?v=4","gravatar_id":"","url":"https://api.github.com/users/Jens-G","html_url":"https://github.com/Jens-G","followers_url":"https://api.github.com/users/Jens-G/followers","following_url":"https://api.github.com/users/Jens-G/following{/other_user}","gists_url":"https://api.github.com/users/Jens-G/gists{/gist_id}","starred_url":"https://api.github.com/users/Jens-G/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jens-G/subscriptions","organizations_url":"https://api.github.com/users/Jens-G/orgs","repos_url":"https://api.github.com/users/Jens-G/repos","events_url":"https://api.github.com/users/Jens-G/events{/privacy}","received_events_url":"https://api.github.com/users/Jens-G/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-01-23T01:52:59Z","updated_at":"2015-01-27T08:57:46Z","closed_at":"2015-01-27T08:57:46Z","author_association":"NONE","active_lock_reason":null,"body":"I got a very similar problem as described in #4887. But I run 1.4.2 and the behaviour is still very reliable reproducible on my test machine here. I just try to feed a lot of small entries via logstash into ES and get a similar message and the net effect of a hanging, overloaded queue. \n\nI might add that said test machine is a bit low resourced, just in case it plays a role here. The ES setup I use is basically \"factory default\".\n\n```\n[2015-01-23 02:25:41,572][DEBUG][action.search.type       ] [Agamemnon] [logstash-1990.10.17][2], node[hUACqH-ETmabS0aMAwVi4g], [P], s[STARTED]: Failed to execu\nte [org.elasticsearch.action.search.SearchRequest@4e76a9] lastShard [true]\norg.elasticsearch.common.util.concurrent.EsRejectedExecutionException: rejected execution (queue capacity 1000) on org.elasticsearch.search.action.SearchService\nTransportAction$23@19362f0\n        at org.elasticsearch.common.util.concurrent.EsAbortPolicy.rejectedExecution(EsAbortPolicy.java:62)\n        at java.util.concurrent.ThreadPoolExecutor.reject(Unknown Source)\n        at java.util.concurrent.ThreadPoolExecutor.execute(Unknown Source)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.execute(SearchServiceTransportAction.java:551)\n        at org.elasticsearch.search.action.SearchServiceTransportAction.sendExecuteQuery(SearchServiceTransportAction.java:228)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction$AsyncAction.sendExecuteFirstPhase(TransportSearchQueryThenFetchAction.java:8\n2)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.performFirstPhase(TransportSearchTypeAction.java:171)\n        at org.elasticsearch.action.search.type.TransportSearchTypeAction$BaseAsyncAction.start(TransportSearchTypeAction.java:153)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction.doExecute(TransportSearchQueryThenFetchAction.java:61)\n        at org.elasticsearch.action.search.type.TransportSearchQueryThenFetchAction.doExecute(TransportSearchQueryThenFetchAction.java:51)\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:75)\n        at org.elasticsearch.action.search.TransportSearchAction.doExecute(TransportSearchAction.java:103)\n        at org.elasticsearch.action.search.TransportSearchAction.doExecute(TransportSearchAction.java:45)\n        at org.elasticsearch.action.support.TransportAction.execute(TransportAction.java:75)\n        at org.elasticsearch.client.node.NodeClient.execute(NodeClient.java:98)\n        at org.elasticsearch.client.FilterClient.execute(FilterClient.java:66)\n        at org.elasticsearch.rest.BaseRestHandler$HeadersAndContextCopyClient.execute(BaseRestHandler.java:92)\n        at org.elasticsearch.client.support.AbstractClient.search(AbstractClient.java:334)\n        at org.elasticsearch.rest.action.search.RestSearchAction.handleRequest(RestSearchAction.java:81)\n        at org.elasticsearch.rest.BaseRestHandler.handleRequest(BaseRestHandler.java:53)\n        at org.elasticsearch.rest.RestController.executeHandler(RestController.java:197)\n        at org.elasticsearch.rest.RestController.dispatchRequest(RestController.java:180)\n        at org.elasticsearch.http.HttpServer.internalDispatchRequest(HttpServer.java:121)\n        at org.elasticsearch.http.HttpServer$Dispatcher.dispatchRequest(HttpServer.java:83)\n        at org.elasticsearch.http.netty.NettyHttpServerTransport.dispatchRequest(NettyHttpServerTransport.java:319)\n        at org.elasticsearch.http.netty.HttpRequestHandler.messageReceived(HttpRequestHandler.java:61)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.http.netty.pipelining.HttpPipeliningHandler.messageReceived(HttpPipeliningHandler.java:60)\n        at org.elasticsearch.common.netty.channel.SimpleChannelHandler.handleUpstream(SimpleChannelHandler.java:88)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.handler.codec.http.HttpChunkAggregator.messageReceived(HttpChunkAggregator.java:145)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.handler.codec.http.HttpContentDecoder.messageReceived(HttpContentDecoder.java:108)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:296)\n        at org.elasticsearch.common.netty.handler.codec.frame.FrameDecoder.unfoldAndFireMessageReceived(FrameDecoder.java:459)\n        at org.elasticsearch.common.netty.handler.codec.replay.ReplayingDecoder.callDecode(ReplayingDecoder.java:536)\n        at org.elasticsearch.common.netty.handler.codec.replay.ReplayingDecoder.messageReceived(ReplayingDecoder.java:435)\n        at org.elasticsearch.common.netty.channel.SimpleChannelUpstreamHandler.handleUpstream(SimpleChannelUpstreamHandler.java:70)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline$DefaultChannelHandlerContext.sendUpstream(DefaultChannelPipeline.java:791)\n        at org.elasticsearch.common.netty.OpenChannelsHandler.handleUpstream(OpenChannelsHandler.java:74)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:564)\n        at org.elasticsearch.common.netty.channel.DefaultChannelPipeline.sendUpstream(DefaultChannelPipeline.java:559)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:268)\n        at org.elasticsearch.common.netty.channel.Channels.fireMessageReceived(Channels.java:255)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.read(NioWorker.java:88)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.process(AbstractNioWorker.java:108)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioSelector.run(AbstractNioSelector.java:318)\n        at org.elasticsearch.common.netty.channel.socket.nio.AbstractNioWorker.run(AbstractNioWorker.java:89)\n        at org.elasticsearch.common.netty.channel.socket.nio.NioWorker.run(NioWorker.java:178)\n        at org.elasticsearch.common.netty.util.ThreadRenamingRunnable.run(ThreadRenamingRunnable.java:108)\n        at org.elasticsearch.common.netty.util.internal.DeadLockProofWorker$1.run(DeadLockProofWorker.java:42)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\n        at java.lang.Thread.run(Unknown Source)\n```\n\nWhen I stop the thing, it prints a huge pile of the messages below right before exiting:\n\n```\n[2015-01-23 02:46:14,559][DEBUG][action.bulk              ] [Agamemnon] observer timed out. notifying listener. timeout setting [1m], time since start [26m]\n[2015-01-23 02:46:14,590][DEBUG][action.bulk              ] [Agamemnon] observer timed out. notifying listener. timeout setting [1m], time since start [26m]\n[2015-01-23 02:46:14,621][DEBUG][action.bulk              ] [Agamemnon] observer timed out. notifying listener. timeout setting [1m], time since start [26m]\n[2015-01-23 02:46:14,653][DEBUG][action.bulk              ] [Agamemnon] observer timed out. notifying listener. timeout setting [1m], time since start [26m]\n[2015-01-23 02:46:14,653][DEBUG][action.bulk              ] [Agamemnon] observer timed out. notifying listener. timeout setting [1m], time since start [26m]\n[2015-01-23 02:46:14,574][DEBUG][action.bulk              ] [Agamemnon] observer timed out. notifying listener. timeout setting [1m], time since start [26m]\n[2015-01-23 02:46:14,653][DEBUG][action.bulk              ] [Agamemnon] observer timed out. notifying listener. timeout setting [1m], time since start [26m]\n[2015-01-23 02:46:14,637][INFO ][node                     ] [Agamemnon] stopped\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}