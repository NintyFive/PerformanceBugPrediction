{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/43741","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43741/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43741/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/43741/events","html_url":"https://github.com/elastic/elasticsearch/issues/43741","id":462012596,"node_id":"MDU6SXNzdWU0NjIwMTI1OTY=","number":43741,"title":"NullPointerException in Elasticsearch when adding Index Pattern in kibana","user":{"login":"marekmarkowski84","id":52320213,"node_id":"MDQ6VXNlcjUyMzIwMjEz","avatar_url":"https://avatars0.githubusercontent.com/u/52320213?v=4","gravatar_id":"","url":"https://api.github.com/users/marekmarkowski84","html_url":"https://github.com/marekmarkowski84","followers_url":"https://api.github.com/users/marekmarkowski84/followers","following_url":"https://api.github.com/users/marekmarkowski84/following{/other_user}","gists_url":"https://api.github.com/users/marekmarkowski84/gists{/gist_id}","starred_url":"https://api.github.com/users/marekmarkowski84/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marekmarkowski84/subscriptions","organizations_url":"https://api.github.com/users/marekmarkowski84/orgs","repos_url":"https://api.github.com/users/marekmarkowski84/repos","events_url":"https://api.github.com/users/marekmarkowski84/events{/privacy}","received_events_url":"https://api.github.com/users/marekmarkowski84/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":1222918656,"node_id":"MDU6TGFiZWwxMjIyOTE4NjU2","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.2.0","name":"v7.2.0","color":"DDDDDD","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-06-28T12:32:29Z","updated_at":"2020-04-06T20:34:15Z","closed_at":"2019-07-03T07:23:08Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: Version: 7.2.0\r\n**Kibana version**: 7.2.0\r\n**JVM version**: JVM: 1.8.0_171\r\n**OS version**: Ubuntu 18.04\r\n\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nHey,\r\n\r\nI noticed NullPointerException in the Elasticsearch logs (`org.elasticsearch.action.fieldcaps.TransportFieldCapabilitiesIndexAction:106`) when trying to add in kibana index pattern.\r\nIn addition, Kibana does not see the index fields (only meta fields).\r\n\r\n**I suspect that the reason for the problems is using `index_prefixes`.**\r\n\r\n\r\n\r\n\r\n\r\n\r\n**Steps to reproduce**:\r\n\r\n1. Just delete index if exists\r\n``` \r\ncurl -XDELETE \"http://localhost:9200/test02\"\r\n```\r\n2. Create index\r\n```\r\ncurl -XPUT \"http://localhost:9200/test02\" -H 'Content-Type: application/json' -d'{\r\n  \"mappings\": {\r\n    \"properties\": {\r\n      \"app_name\": {\r\n        \"type\": \"text\",\r\n        \"fields\": {\r\n          \"keyword\": {\r\n            \"type\": \"keyword\",\r\n            \"ignore_above\": 256\r\n          },\r\n          \"prefix_app_name\": {\r\n            \"type\": \"text\",\r\n            \"index_prefixes\": {\r\n              \"min_chars\": 1,\r\n              \"max_chars\": 19\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'\r\n```\r\n3. Index document\r\n```\r\ncurl -XPOST \"http://localhost:9200/test02/_doc\" -H 'Content-Type: application/json' -d'{  \"app_name\":\"my super app1\"}'\r\n```\r\n\r\n4. Create index pattern in kibana for test02\r\n\r\n![image](https://user-images.githubusercontent.com/52320213/60342303-67b9c600-99b1-11e9-8ea4-09f645389284.png)\r\n\r\nException is thrown after click Next Step\r\n\r\n\r\nI kibana presents only meta fields\r\n\r\n![image](https://user-images.githubusercontent.com/52320213/60342332-7acc9600-99b1-11e9-98ce-cebe66212e08.png)\r\n\r\n\r\n\r\n**Logs**:\r\n\r\n```\r\n[2019-06-28T09:57:12,064][DEBUG][o.e.a.f.TransportFieldCapabilitiesIndexAction] [marekm] null: failed to execute [org.elasticsearch.action.fieldcaps.FieldCapabilitiesIndexRequest@30bb56e3]\r\norg.elasticsearch.transport.RemoteTransportException: [marekm][127.0.0.1:9300][indices:data/read/field_caps[index][s]]\r\nCaused by: java.lang.NullPointerException\r\n\tat org.elasticsearch.action.fieldcaps.TransportFieldCapabilitiesIndexAction.shardOperation(TransportFieldCapabilitiesIndexAction.java:106) ~[elasticsearch-7.2.0.jar:7.2.0]\r\n\tat org.elasticsearch.action.fieldcaps.TransportFieldCapabilitiesIndexAction.shardOperation(TransportFieldCapabilitiesIndexAction.java:46) ~[elasticsearch-7.2.0.jar:7.2.0]\r\n\tat org.elasticsearch.action.support.single.shard.TransportSingleShardAction$1.doRun(TransportSingleShardAction.java:113) ~[elasticsearch-7.2.0.jar:7.2.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:758) [elasticsearch-7.2.0.jar:7.2.0]\r\n\tat org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-7.2.0.jar:7.2.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_171]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_171]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_171]\r\n\r\n```\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}