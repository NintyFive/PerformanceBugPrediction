[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/208265337","html_url":"https://github.com/elastic/elasticsearch/issues/17630#issuecomment-208265337","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17630","id":208265337,"node_id":"MDEyOklzc3VlQ29tbWVudDIwODI2NTMzNw==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-04-11T10:02:47Z","updated_at":"2016-04-11T10:02:47Z","author_association":"MEMBER","body":"In order to assign primaries the master goes out and asks the node if they have data for those shards. With 2.x we actually try to [read the lucene index](org.elasticsearch.index.store.Store#tryOpenIndex) before returning a response. If the nodes fail to open the index the shard will not be assigned to them and will be left unassigned (assuming no other copy is available) and nothing will change in the unassigned info (at least today).  Currently you can use the shard stores API to get the same information the master uses (and this should be added IMO to the new allocation explain API ).\n\nWhat surprise me in this report is that shard 1 actually managed to be assigned. It seems the exceptions comes from reading the segments info, which is also read by the [shard data fetching](TransportNodesListGatewayStartedShards) action mentioned above. Do you have any idea what this may have happened?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/208342681","html_url":"https://github.com/elastic/elasticsearch/issues/17630#issuecomment-208342681","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17630","id":208342681,"node_id":"MDEyOklzc3VlQ29tbWVudDIwODM0MjY4MQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2016-04-11T13:30:21Z","updated_at":"2016-04-11T13:30:21Z","author_association":"MEMBER","body":"> Do you have any idea what this may have happened?\n\nThe only thing I could think of is that the shard store fetching returned successfully and then it tried to open the actual index. What's interesting is that the same corruption was added to both the 0 and 1 shards\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/208578469","html_url":"https://github.com/elastic/elasticsearch/issues/17630#issuecomment-208578469","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17630","id":208578469,"node_id":"MDEyOklzc3VlQ29tbWVudDIwODU3ODQ2OQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-04-11T21:54:00Z","updated_at":"2016-04-11T21:54:00Z","author_association":"MEMBER","body":"@dakrone I found the source of the race condition and opened #17663 . I'm not sure it fully closes this issue as I think part of the problem is proper reporting. I think the allocation explain API should cover this. Do you agree and there an issue we can close this in favor of?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/208583619","html_url":"https://github.com/elastic/elasticsearch/issues/17630#issuecomment-208583619","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/17630","id":208583619,"node_id":"MDEyOklzc3VlQ29tbWVudDIwODU4MzYxOQ==","user":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"created_at":"2016-04-11T22:06:25Z","updated_at":"2016-04-11T22:06:25Z","author_association":"MEMBER","body":"> I think the allocation explain API should cover this. Do you agree and there an issue we can close this in favor of?\n\nYeah, I've already started integrating the shard stores API into the allocation explain API, so I'll close this for now. Thanks for opening the PR\n","performed_via_github_app":null}]