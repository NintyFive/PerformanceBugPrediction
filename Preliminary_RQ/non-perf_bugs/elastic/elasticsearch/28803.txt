{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28803","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28803/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28803/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28803/events","html_url":"https://github.com/elastic/elasticsearch/issues/28803","id":299747104,"node_id":"MDU6SXNzdWUyOTk3NDcxMDQ=","number":28803,"title":"How to expose custom frequencies?","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"},{"id":23172,"node_id":"MDU6TGFiZWwyMzE3Mg==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Efeature","name":">feature","color":"006b75","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-02-23T15:24:30Z","updated_at":"2018-09-12T13:01:13Z","closed_at":"2018-09-12T13:01:12Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"In [LUCENE-7854](https://issues.apache.org/jira/browse/LUCENE-7854), Lucene gained the ability to index custom term frequencies. This is typically useful in order to do index-time boosting of terms. The same can be achieved with payloads, with the downside that payloads are per-position while frequencies are per-term, which makes them much heavier if you don't need per-position boosts. I have seen multiple users do token stuffing in the past, so I think some people would use this feature, though I don't know what their actual use-cases were.\r\n\r\nThere are multiple options how to expose it:\r\n 1. expose Lucene's `DelimitedTermFrequencyTokenFilter` so that it can be used in any `text` field: #27552\r\n 2. add the ability to configure a term frequency with keyword fields, eg. `my_keyword_field: [{ \"keyword\": \"foo\", \"frequency\": 3 }, { \"keyword\": \"bar\", \"frequency\": 2 }]` instead of `my_keyword_field: [ \"foo\", \"foo\", \"foo\", \"bar\", \"bar\" ]`\r\n 3. add a new field type, similar to `keyword`, to support this feature so that `keyword` doesn't have to be modified to accept objects\r\n\r\nSome notes/questions about these options:\r\n - Option 1. would require index options to be set to `docs_and_freqs` since custom frequencies are rejected when positions are indexed, which is the default for `text` fields.\r\n - Should norms be enabled when this feature is used? Norms are disabled on keywords by default.\r\n\r\ncc @elastic/es-search-aggs ","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}