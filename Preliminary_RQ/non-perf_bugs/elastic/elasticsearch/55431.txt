{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/55431","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55431/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55431/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/55431/events","html_url":"https://github.com/elastic/elasticsearch/issues/55431","id":602679586,"node_id":"MDU6SXNzdWU2MDI2Nzk1ODY=","number":55431,"title":"Expose preserveOriginal in NGramTokenFilterFactory which is marked as TODO in master code.","user":{"login":"amitmbm","id":4751393,"node_id":"MDQ6VXNlcjQ3NTEzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/4751393?v=4","gravatar_id":"","url":"https://api.github.com/users/amitmbm","html_url":"https://github.com/amitmbm","followers_url":"https://api.github.com/users/amitmbm/followers","following_url":"https://api.github.com/users/amitmbm/following{/other_user}","gists_url":"https://api.github.com/users/amitmbm/gists{/gist_id}","starred_url":"https://api.github.com/users/amitmbm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amitmbm/subscriptions","organizations_url":"https://api.github.com/users/amitmbm/orgs","repos_url":"https://api.github.com/users/amitmbm/repos","events_url":"https://api.github.com/users/amitmbm/events{/privacy}","received_events_url":"https://api.github.com/users/amitmbm/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-04-19T10:28:14Z","updated_at":"2020-05-04T11:33:19Z","closed_at":"2020-05-04T11:33:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\n`preserveOriginal` setting is currently not supported in the `NGramTokenFilter` https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-ngram-tokenfilter.html and there is even TODO comment in the master code of Elasticsearch(as of 19th Apr, 2020) to Expose preserveOriginal as shown in this GitHub code link https://github.com/elastic/elasticsearch/blob/master/modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/NGramTokenFilterFactory.java#L53 \r\n\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n8.0.0-SNAPSHOT\r\n\r\n**Plugins installed**: []\r\nN/A\r\n\r\n**JVM version** (`java -version`):\r\nopenjdk 14.0.1 2020-04-14\r\nOpenJDK Runtime Environment (build 14.0.1+7)\r\nOpenJDK 64-Bit Server VM (build 14.0.1+7, mixed mode, sharing)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nDarwin LT6577 19.3.0 Darwin Kernel Version 19.3.0: Thu Jan  9 20:58:23 PST 2020; root:xnu-6153.81.5~1/RELEASE_X86_64 x86_64\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nIts a feature request and mentioned in the TODO of Elasticsearch master code, if provided preserve original functionality would work with n-gram token filter.\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Delete the existing index with the name `preserveoriginal` to test this feature.\r\n`curl --user elastic:password -XDELETE localhost:9200/preserveoriginal`\r\n 2. Create a new index with  custom analyzer which uses`ngram` token filter.\r\n```\r\ncurl --user elastic:password -X PUT \"localhost:9200/preserveoriginal?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n    \"settings\": {\r\n        \"max_ngram_diff\": 50,\r\n        \"analysis\": {\r\n            \"filter\": {\r\n                \"ngram_filter\": {\r\n                    \"type\": \"ngram\",\r\n                    \"min_gram\": 1,\r\n                    \"max_gram\": 2\r\n                }\r\n            },\r\n            \"analyzer\": {\r\n                \"ngram_analyzer\": {\r\n                    \"type\": \"custom\",\r\n                    \"tokenizer\": \"whitespace\",\r\n                    \"filter\": [\r\n                        \"lowercase\",\r\n                        \"ngram_filter\"\r\n                    ]\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n'\r\n```\r\n 3. Check the tokens generated by `ngram_analyzer` created in the above step:\r\n```\r\ncurl --user elastic:password -X GET \"localhost:9200/preserveoriginal/_analyze?pretty\" -H 'Content-Type: application/json' -d'\r\n{\r\n  \"analyzer\" : \"ngram_analyzer\",\r\n  \"text\" : \"foo\"\r\n}\r\n'\r\n```\r\n4. Output of above analyzer API.\r\n```\r\n{\r\n  \"tokens\" : [\r\n    {\r\n      \"token\" : \"f\",\r\n      \"start_offset\" : 0,\r\n      \"end_offset\" : 3,\r\n      \"type\" : \"word\",\r\n      \"position\" : 0\r\n    },\r\n    {\r\n      \"token\" : \"fo\",\r\n      \"start_offset\" : 0,\r\n      \"end_offset\" : 3,\r\n      \"type\" : \"word\",\r\n      \"position\" : 0\r\n    },\r\n    {\r\n      \"token\" : \"o\",\r\n      \"start_offset\" : 0,\r\n      \"end_offset\" : 3,\r\n      \"type\" : \"word\",\r\n      \"position\" : 0\r\n    },\r\n    {\r\n      \"token\" : \"oo\",\r\n      \"start_offset\" : 0,\r\n      \"end_offset\" : 3,\r\n      \"type\" : \"word\",\r\n      \"position\" : 0\r\n    },\r\n    {\r\n      \"token\" : \"o\",\r\n      \"start_offset\" : 0,\r\n      \"end_offset\" : 3,\r\n      \"type\" : \"word\",\r\n      \"position\" : 0\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n**Please see `foo` original token isn't present in the result.**\r\n\r\n**Provide logs (if relevant)**:\r\nN/A\r\n","closed_by":{"login":"amitmbm","id":4751393,"node_id":"MDQ6VXNlcjQ3NTEzOTM=","avatar_url":"https://avatars0.githubusercontent.com/u/4751393?v=4","gravatar_id":"","url":"https://api.github.com/users/amitmbm","html_url":"https://github.com/amitmbm","followers_url":"https://api.github.com/users/amitmbm/followers","following_url":"https://api.github.com/users/amitmbm/following{/other_user}","gists_url":"https://api.github.com/users/amitmbm/gists{/gist_id}","starred_url":"https://api.github.com/users/amitmbm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amitmbm/subscriptions","organizations_url":"https://api.github.com/users/amitmbm/orgs","repos_url":"https://api.github.com/users/amitmbm/repos","events_url":"https://api.github.com/users/amitmbm/events{/privacy}","received_events_url":"https://api.github.com/users/amitmbm/received_events","type":"User","site_admin":false},"performed_via_github_app":null}