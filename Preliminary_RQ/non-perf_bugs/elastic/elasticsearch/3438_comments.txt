[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22078786","html_url":"https://github.com/elastic/elasticsearch/issues/3438#issuecomment-22078786","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3438","id":22078786,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDc4Nzg2","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2013-08-04T20:55:31Z","updated_at":"2013-08-04T20:55:31Z","author_association":"MEMBER","body":"When the first percolate query is indexed the field `count` doesn't exists yet in any type in the test index and it is treated as a string field, which is default behaviour. When the first document with a `count` field is indexed, the mapping knows it is a number based field (long). When the second percolate query is indexed the range filter is really used as a numeric range filter, because the count field in the mapping is of a number based type, therefore the percolate queries after the second index request work as expected.\n\nIf you change the create index request into the following also the first two percolate requests should work as expected:\n\n``` bash\ncurl -XPUT 'localhost:9200/test' -d '{\n    \"mappings\" : {\n        \"counter\" : {\n            \"properties\" : {\n                \"count\" : {\n                    \"type\" : \"long\"\n                }\n            }\n        }\n    }\n}'\n```\n\nA range filter can get parsed into two different Lucene queries:\n- `TermRangeFilter` - Meant for alphabetic ranges and is used when the field in the mapping isn't a number based field.\n- `NumericRangeFilter` - Does numeric ranges and is used when the field in mapping is a number based field.\n\nWhen indexing documents the type can be automatically guessed based on the json type, this isn't the case for fields mentioned in the the percolate queries (would be nice though), this is a bit confusing.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/22092674","html_url":"https://github.com/elastic/elasticsearch/issues/3438#issuecomment-22092674","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3438","id":22092674,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMDkyNjc0","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2013-08-05T08:21:52Z","updated_at":"2013-08-05T08:21:52Z","author_association":"MEMBER","body":"This all makes sense. Something the user definately has to be aware of. Most simple workaround:\n\na) Create the mapping manually beforehand for all fields to percolate on\nb) Index data first before creating a percolator so the mapping is already in place\n","performed_via_github_app":null}]