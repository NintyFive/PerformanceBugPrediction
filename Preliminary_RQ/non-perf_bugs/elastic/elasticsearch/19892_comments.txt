[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238673497","html_url":"https://github.com/elastic/elasticsearch/issues/19892#issuecomment-238673497","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19892","id":238673497,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODY3MzQ5Nw==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T20:03:28Z","updated_at":"2016-08-09T20:03:28Z","author_association":"CONTRIBUTOR","body":"@djschny The reason this happens is that the rename processor only does `set` and `remove` operations on the document. It only `remove`s the original `field` after it successfully `set`s the `target_field`. I believe this was done this way since we do not have a notion of a transaction within a processor's execution. The rational was that in this way, the worst case is that you have duplicate values and keep the old data instead of fail and you have just lost the field down the pipeline.\n\nI am open to loosening this up so that you can do as you suggest above. This does seem to be a super super conservative way of operating on the document that may not be necessary, but I'd like to hear your opinion around that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238681747","html_url":"https://github.com/elastic/elasticsearch/issues/19892#issuecomment-238681747","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19892","id":238681747,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODY4MTc0Nw==","user":{"login":"djschny","id":129643,"node_id":"MDQ6VXNlcjEyOTY0Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/129643?v=4","gravatar_id":"","url":"https://api.github.com/users/djschny","html_url":"https://github.com/djschny","followers_url":"https://api.github.com/users/djschny/followers","following_url":"https://api.github.com/users/djschny/following{/other_user}","gists_url":"https://api.github.com/users/djschny/gists{/gist_id}","starred_url":"https://api.github.com/users/djschny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djschny/subscriptions","organizations_url":"https://api.github.com/users/djschny/orgs","repos_url":"https://api.github.com/users/djschny/repos","events_url":"https://api.github.com/users/djschny/events{/privacy}","received_events_url":"https://api.github.com/users/djschny/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T20:32:44Z","updated_at":"2016-08-09T20:32:44Z","author_association":"CONTRIBUTOR","body":"Thanks for the explanation behind the scenes @talevy. The `rename` processor essentially is just a convenience once then for folks?\n\n> The rational was that in this way, the worst case is that you have duplicate values and keep the old data instead of fail and you have just lost the field down the pipeline.\n\nI'm trying to think of a situation where a user would want the processor to continue instead of fail, but am having trouble coming up with a situation where that would be useful.\n\nIMO we are safer going out with the failure behavior always and then can loosen back to the way it is implemented now. However going the opposite way in the future (add failure) would be a much harder change for the end user I'm thinking.\n\nThoughts?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/238694805","html_url":"https://github.com/elastic/elasticsearch/issues/19892#issuecomment-238694805","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19892","id":238694805,"node_id":"MDEyOklzc3VlQ29tbWVudDIzODY5NDgwNQ==","user":{"login":"talevy","id":388837,"node_id":"MDQ6VXNlcjM4ODgzNw==","avatar_url":"https://avatars0.githubusercontent.com/u/388837?v=4","gravatar_id":"","url":"https://api.github.com/users/talevy","html_url":"https://github.com/talevy","followers_url":"https://api.github.com/users/talevy/followers","following_url":"https://api.github.com/users/talevy/following{/other_user}","gists_url":"https://api.github.com/users/talevy/gists{/gist_id}","starred_url":"https://api.github.com/users/talevy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/talevy/subscriptions","organizations_url":"https://api.github.com/users/talevy/orgs","repos_url":"https://api.github.com/users/talevy/repos","events_url":"https://api.github.com/users/talevy/events{/privacy}","received_events_url":"https://api.github.com/users/talevy/received_events","type":"User","site_admin":false},"created_at":"2016-08-09T21:18:23Z","updated_at":"2016-08-09T21:18:23Z","author_association":"CONTRIBUTOR","body":"> I'm trying to think of a situation where a user would want the processor to continue instead of fail, but am having trouble coming up with a situation where that would be useful.\n\nthe pipeline may continue if the `rename` processor or the pipeline declare `on_failure` processors. If, for whatever reason, the field is removed and not successfully added into the new field... then they would lose the data.\n\nthat being said, this exception can be caught, and the processor can re-insert the field back into the original `field`.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/239846566","html_url":"https://github.com/elastic/elasticsearch/issues/19892#issuecomment-239846566","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19892","id":239846566,"node_id":"MDEyOklzc3VlQ29tbWVudDIzOTg0NjU2Ng==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-08-15T16:08:51Z","updated_at":"2016-08-15T16:08:51Z","author_association":"MEMBER","body":"The cause of this exception is because ingest expects `version` to be a json object when setting the value for `version.displayName` and that isn't the case (it is a plain value).\n\nThe same exception bubbles up when the `set` processor is used like this:\n\n```\nPOST _ingest/pipeline/_simulate\n{\n  \"pipeline\": {\n    \"processors\": [\n      {\n        \"set\": {\n          \"field\": \"version.displayName\",\n          \"value\": \"{{version}}\"\n        }\n      }\n    ]\n  },\n  \"docs\": [\n    {\n      \"_index\": \"myindex\",\n      \"_type\": \"doc\",\n      \"_id\": \"1\",\n      \"_source\": {\n        \"version\": \"1.1.0\"\n      }\n    }\n  ]\n}\n```\n\nI think we should fix, both examples should just work. Ingest should just plainly overwrite the version field and not care about the previous value. The version field should become a json object that has a displayName string field.\n\nIn this case only if the version field is already a json object it should not be overwritten. For example in this case (which works as expected):\n\n```\nPOST _ingest/pipeline/_simulate\n{\n  \"pipeline\": {\n    \"processors\": [\n      {\n        \"rename\": {\n          \"field\": \"version.name\",\n          \"target_field\": \"version.displayName\"\n        }\n      }\n    ]\n  },\n  \"docs\": [\n    {\n      \"_index\": \"myindex\",\n      \"_type\": \"doc\",\n      \"_id\": \"1\",\n      \"_source\": {\n        \"version\": {\n          \"name\" : \"1.1.0\"\n        }\n      }\n    }\n  ]\n}\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/252704253","html_url":"https://github.com/elastic/elasticsearch/issues/19892#issuecomment-252704253","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19892","id":252704253,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MjcwNDI1Mw==","user":{"login":"djschny","id":129643,"node_id":"MDQ6VXNlcjEyOTY0Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/129643?v=4","gravatar_id":"","url":"https://api.github.com/users/djschny","html_url":"https://github.com/djschny","followers_url":"https://api.github.com/users/djschny/followers","following_url":"https://api.github.com/users/djschny/following{/other_user}","gists_url":"https://api.github.com/users/djschny/gists{/gist_id}","starred_url":"https://api.github.com/users/djschny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djschny/subscriptions","organizations_url":"https://api.github.com/users/djschny/orgs","repos_url":"https://api.github.com/users/djschny/repos","events_url":"https://api.github.com/users/djschny/events{/privacy}","received_events_url":"https://api.github.com/users/djschny/received_events","type":"User","site_admin":false},"created_at":"2016-10-10T18:38:33Z","updated_at":"2016-10-10T18:38:33Z","author_association":"CONTRIBUTOR","body":"I see this changed was merged and is labeled for v5, but with my testing on `v5.0.0-rc1` the error is still thrown.\n\nIs it intentional that the merged change was not included in `v5.0.0-rc1`?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/253071976","html_url":"https://github.com/elastic/elasticsearch/issues/19892#issuecomment-253071976","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19892","id":253071976,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzA3MTk3Ng==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2016-10-11T22:59:11Z","updated_at":"2016-10-11T22:59:11Z","author_association":"MEMBER","body":"@djschny This change is part of of rc1 (and beta1), so that shouldn't happen any more. I just checked the request snippet you shared initially in this issue and that doesn't fail. Or can you make the rename processor fail with a different request?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/253092322","html_url":"https://github.com/elastic/elasticsearch/issues/19892#issuecomment-253092322","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19892","id":253092322,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzA5MjMyMg==","user":{"login":"djschny","id":129643,"node_id":"MDQ6VXNlcjEyOTY0Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/129643?v=4","gravatar_id":"","url":"https://api.github.com/users/djschny","html_url":"https://github.com/djschny","followers_url":"https://api.github.com/users/djschny/followers","following_url":"https://api.github.com/users/djschny/following{/other_user}","gists_url":"https://api.github.com/users/djschny/gists{/gist_id}","starred_url":"https://api.github.com/users/djschny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djschny/subscriptions","organizations_url":"https://api.github.com/users/djschny/orgs","repos_url":"https://api.github.com/users/djschny/repos","events_url":"https://api.github.com/users/djschny/events{/privacy}","received_events_url":"https://api.github.com/users/djschny/received_events","type":"User","site_admin":false},"created_at":"2016-10-12T01:16:32Z","updated_at":"2016-10-12T01:16:32Z","author_association":"CONTRIBUTOR","body":"@martijnvg that's great that it is included! Didn't think it was fixed since the issue was not closed.\n\nI'm going back through my Console/Sense histories and trying to find the situation where I saw the error. Sorry I should have posted the snippet on my previous comment. You are correct everything is working great with the snippet in my original post.\n\nIf you don't mind give me another day to review with the work I was doing before and will report back with whether I made a mistake or found a different situation.\n\nRegardless thank you for the work, it really helps make the pipelines simpler!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/255893657","html_url":"https://github.com/elastic/elasticsearch/issues/19892#issuecomment-255893657","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/19892","id":255893657,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTg5MzY1Nw==","user":{"login":"djschny","id":129643,"node_id":"MDQ6VXNlcjEyOTY0Mw==","avatar_url":"https://avatars0.githubusercontent.com/u/129643?v=4","gravatar_id":"","url":"https://api.github.com/users/djschny","html_url":"https://github.com/djschny","followers_url":"https://api.github.com/users/djschny/followers","following_url":"https://api.github.com/users/djschny/following{/other_user}","gists_url":"https://api.github.com/users/djschny/gists{/gist_id}","starred_url":"https://api.github.com/users/djschny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djschny/subscriptions","organizations_url":"https://api.github.com/users/djschny/orgs","repos_url":"https://api.github.com/users/djschny/repos","events_url":"https://api.github.com/users/djschny/events{/privacy}","received_events_url":"https://api.github.com/users/djschny/received_events","type":"User","site_admin":false},"created_at":"2016-10-24T23:22:22Z","updated_at":"2016-10-24T23:22:22Z","author_association":"CONTRIBUTOR","body":"Sorry for the delay and was unable to reproduce, sorry for the noise, I either was using a different version or misread a different error for this one. Thanks again for getting this into v5.\n","performed_via_github_app":null}]