{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/34529","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34529/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34529/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34529/events","html_url":"https://github.com/elastic/elasticsearch/issues/34529","id":370652594,"node_id":"MDU6SXNzdWUzNzA2NTI1OTQ=","number":34529,"title":"Use fuzzy transpositions with an english stemmer","user":{"login":"alexandremottet","id":617692,"node_id":"MDQ6VXNlcjYxNzY5Mg==","avatar_url":"https://avatars0.githubusercontent.com/u/617692?v=4","gravatar_id":"","url":"https://api.github.com/users/alexandremottet","html_url":"https://github.com/alexandremottet","followers_url":"https://api.github.com/users/alexandremottet/followers","following_url":"https://api.github.com/users/alexandremottet/following{/other_user}","gists_url":"https://api.github.com/users/alexandremottet/gists{/gist_id}","starred_url":"https://api.github.com/users/alexandremottet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexandremottet/subscriptions","organizations_url":"https://api.github.com/users/alexandremottet/orgs","repos_url":"https://api.github.com/users/alexandremottet/repos","events_url":"https://api.github.com/users/alexandremottet/events{/privacy}","received_events_url":"https://api.github.com/users/alexandremottet/received_events","type":"User","site_admin":false},"labels":[{"id":142001965,"node_id":"MDU6TGFiZWwxNDIwMDE5NjU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Analysis","name":":Search/Analysis","color":"0e8a16","default":false,"description":"How text is split into tokens"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-10-16T14:51:42Z","updated_at":"2018-10-18T14:04:27Z","closed_at":"2018-10-18T14:04:27Z","author_association":"NONE","active_lock_reason":null,"body":"**Describe the feature**:\r\n\r\nHave the ability to detect fuzzy transpositions like \"sahde\" to \"shade\" when using an english stemmer\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.4.2\r\n\r\n**Plugins installed**: [] None\r\n\r\n**JVM version** (`java -version`): java: command not found\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): Linux 4609d58f2f21 4.9.93-linuxkit-aufs #1 SMP Wed Jun 6 16:55:56 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nI have the following documents :\r\n\r\n```\r\n{\r\n  \"title\": \"Understanding shading\",\r\n  \"language\": \"en\"\r\n}\r\n```\r\n```\r\n{\r\n  \"title\": \"Understanding shade\",\r\n  \"language\": \"en\"\r\n}\r\n```\r\n\r\nI want to be able to search for a \"sahde\" title (with the misspelling) and have the two previous documents in the result.\r\n\r\nWith a default index, the following search queries will work and I will get the document with ```shade``` in it : \r\n```shade```, ```hsade```, ```sahde```, ```shdae```, ```shaed```\r\n\r\nWith an index that use an english stemmer, the following search queries will work and I will get the document with ```shade``` and ```shading``` in it :\r\n```shade```, ```hsade```, ```shdae```\r\n\r\nBut the following queries will have no result :\r\n```sahde```, ```shaed```\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 0. Start the docker container\r\n```docker run -p 9200:9200 -p 9300:9300 -e \"discovery.type=single-node\" --name elastic -d docker.elastic.co/elasticsearch/elasticsearch:6.4.2```\r\n\r\n 1. Create the index ```PUT /teststemmer```\r\n ```\r\n {\r\n  \"settings\": {\r\n    \"analysis\": {\r\n      \"filter\": {\r\n        \"english_stemmer\": {\r\n          \"type\":       \"stemmer\",\r\n          \"language\":   \"english\" \r\n        }\r\n      },\r\n      \"analyzer\": {\r\n        \"english\": {\r\n          \"tokenizer\":  \"standard\",\r\n          \"filter\": [\r\n            \"lowercase\",\r\n            \"english_stemmer\"\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n ```\r\n\r\n 2. Create the field mapping ```PUT /teststemmer/_mapping/article```\r\n```\r\n{\r\n    \"properties\": {\r\n        \"title\": {\r\n            \"type\": \"text\",\r\n            \"analyzer\": \"english\"\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n 3. Add the two documents\r\n\r\n 4. Do this query ```POST /teststemmer/_search```\r\n```\r\n{\r\n  \"query\": {\r\n    \"multi_match\" : {\r\n      \"query\" : \"sahde\",\r\n      \"fields\" : [ \"title\" ],\r\n      \"fuzziness\" : \"1\",\r\n      \"fuzzy_transpositions\": true\r\n    }\r\n  }\r\n}\r\n``` \r\n\r\n**Provide logs (if relevant)**:\r\n\r\n","closed_by":{"login":"alexandremottet","id":617692,"node_id":"MDQ6VXNlcjYxNzY5Mg==","avatar_url":"https://avatars0.githubusercontent.com/u/617692?v=4","gravatar_id":"","url":"https://api.github.com/users/alexandremottet","html_url":"https://github.com/alexandremottet","followers_url":"https://api.github.com/users/alexandremottet/followers","following_url":"https://api.github.com/users/alexandremottet/following{/other_user}","gists_url":"https://api.github.com/users/alexandremottet/gists{/gist_id}","starred_url":"https://api.github.com/users/alexandremottet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexandremottet/subscriptions","organizations_url":"https://api.github.com/users/alexandremottet/orgs","repos_url":"https://api.github.com/users/alexandremottet/repos","events_url":"https://api.github.com/users/alexandremottet/events{/privacy}","received_events_url":"https://api.github.com/users/alexandremottet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}