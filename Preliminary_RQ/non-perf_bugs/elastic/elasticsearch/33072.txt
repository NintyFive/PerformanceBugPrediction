{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/33072","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33072/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33072/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33072/events","html_url":"https://github.com/elastic/elasticsearch/issues/33072","id":353151608,"node_id":"MDU6SXNzdWUzNTMxNTE2MDg=","number":33072,"title":"Limit the maximum number of concurrent shard searches issued by an msearch request.","user":{"login":"ebernhardson","id":558434,"node_id":"MDQ6VXNlcjU1ODQzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/558434?v=4","gravatar_id":"","url":"https://api.github.com/users/ebernhardson","html_url":"https://github.com/ebernhardson","followers_url":"https://api.github.com/users/ebernhardson/followers","following_url":"https://api.github.com/users/ebernhardson/following{/other_user}","gists_url":"https://api.github.com/users/ebernhardson/gists{/gist_id}","starred_url":"https://api.github.com/users/ebernhardson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ebernhardson/subscriptions","organizations_url":"https://api.github.com/users/ebernhardson/orgs","repos_url":"https://api.github.com/users/ebernhardson/repos","events_url":"https://api.github.com/users/ebernhardson/events{/privacy}","received_events_url":"https://api.github.com/users/ebernhardson/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-08-22T22:37:49Z","updated_at":"2019-05-07T07:42:43Z","closed_at":"2019-05-07T07:42:43Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Feature request -->\r\n\r\nThe msearch API currently allows limiting the maximum number of concurrent searches performed. I'm interpreting this feature as having the goal of limiting the maximum concurrent load generated by the msearch request. I'm defining maximum concurrent load as the maximum number of threads consumed from search thread pools across cluster at any point in time.  When clusters are fairly uniform the number of searches is a reasonable proxy for generated load, but in heterogeneous clusters (we have indicies ranging from a single shard with <100MB, to 600GB indices with 20 shards) this proxy is less useful.\r\n\r\nIf the number of concurrent shard searches could be specified it would allow finer grained control of the maximum concurrent load generated by a single msearch query. Single requests could still be processed as normal, but the condition for issuing the next request in the msearch batch would be if the number of shards in the referenced index(es) is less than the remainder of the concurrent shard limit. Queries that can't be issued because they would query more shards than the concurrent limit  would return a failure.\r\n\r\nAn alternate solution that might be presented is to use the thread pool queues as they were intended, and accept thread pool rejections as back pressure. The difficulty with this solution is there is a single search thread pool, but there can be many kinds of requests. Forcing interactive searches, where latency matters, to sit behind (by default) 1000 non-interactive queries currently waiting for the thread pool is undesirable. Because latency of the interactive searches is important we don't want them to queue up and we treat anything beyond minor queueing to smooth spikes as a problem to be addressed.","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}