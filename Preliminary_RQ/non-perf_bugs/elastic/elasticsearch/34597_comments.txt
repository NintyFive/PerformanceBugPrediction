[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/431020756","html_url":"https://github.com/elastic/elasticsearch/issues/34597#issuecomment-431020756","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34597","id":431020756,"node_id":"MDEyOklzc3VlQ29tbWVudDQzMTAyMDc1Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-10-18T14:02:26Z","updated_at":"2018-10-18T14:02:26Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/442462425","html_url":"https://github.com/elastic/elasticsearch/issues/34597#issuecomment-442462425","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34597","id":442462425,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MjQ2MjQyNQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-11-28T14:19:12Z","updated_at":"2018-11-28T14:19:12Z","author_association":"MEMBER","body":"We discussed this internally and we agreed that this is something we want to support. This will allow scripts used in sort to return null values and we'll translate the value automatically based on the type of the field and the value used in the `missing` option.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/454633762","html_url":"https://github.com/elastic/elasticsearch/issues/34597#issuecomment-454633762","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34597","id":454633762,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDYzMzc2Mg==","user":{"login":"affanv14","id":13151040,"node_id":"MDQ6VXNlcjEzMTUxMDQw","avatar_url":"https://avatars3.githubusercontent.com/u/13151040?v=4","gravatar_id":"","url":"https://api.github.com/users/affanv14","html_url":"https://github.com/affanv14","followers_url":"https://api.github.com/users/affanv14/followers","following_url":"https://api.github.com/users/affanv14/following{/other_user}","gists_url":"https://api.github.com/users/affanv14/gists{/gist_id}","starred_url":"https://api.github.com/users/affanv14/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/affanv14/subscriptions","organizations_url":"https://api.github.com/users/affanv14/orgs","repos_url":"https://api.github.com/users/affanv14/repos","events_url":"https://api.github.com/users/affanv14/events{/privacy}","received_events_url":"https://api.github.com/users/affanv14/received_events","type":"User","site_admin":false},"created_at":"2019-01-16T02:59:42Z","updated_at":"2019-01-16T02:59:42Z","author_association":"NONE","body":"I'd like to take this on","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470545912","html_url":"https://github.com/elastic/elasticsearch/issues/34597#issuecomment-470545912","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34597","id":470545912,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDU0NTkxMg==","user":{"login":"astefan","id":893749,"node_id":"MDQ6VXNlcjg5Mzc0OQ==","avatar_url":"https://avatars2.githubusercontent.com/u/893749?v=4","gravatar_id":"","url":"https://api.github.com/users/astefan","html_url":"https://github.com/astefan","followers_url":"https://api.github.com/users/astefan/followers","following_url":"https://api.github.com/users/astefan/following{/other_user}","gists_url":"https://api.github.com/users/astefan/gists{/gist_id}","starred_url":"https://api.github.com/users/astefan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/astefan/subscriptions","organizations_url":"https://api.github.com/users/astefan/orgs","repos_url":"https://api.github.com/users/astefan/repos","events_url":"https://api.github.com/users/astefan/events{/privacy}","received_events_url":"https://api.github.com/users/astefan/received_events","type":"User","site_admin":false},"created_at":"2019-03-07T14:27:17Z","updated_at":"2019-03-07T14:27:17Z","author_association":"CONTRIBUTOR","body":"Following @rjernst reply in the [PR opened for this issue](https://github.com/elastic/elasticsearch/pull/37513#issuecomment-465314108), I want to provide some more background to help with a decision for this issue.\r\n\r\nIn SQL, an user can do `SELECT first_name, SQRT(languages) AS sq FROM employees ORDER BY sq ASC NULLS FIRST` and the result would place the null values (missing values) - the square root of languages - as first in the result and after them order the rest of the results by the square root of the \"languages\" numeric values.\r\n\r\nThere are also functions in SQL that return string values (think of CONCAT, SUBSTRING etc) and when applied on missing values it would return a \"missing\" value.\r\n\r\nThe ORDER BY a function example above is basically using the `\"sort\": [{\"_script\": {\"script\": {` script sorting to work its magic. For functions that return numerics, we could use in scripts the Double min value or max value to place the missing values as first or last, but for strings there is no mechanism at the moment.\r\n\r\nThe _missing values in sorting_ functionality I believe is also inconsistent in Elasticsearch:\r\n- it exists for simple fields\r\n- it doesn't exist for `composite` aggs, but this is tracked [here](https://github.com/elastic/elasticsearch/issues/34221)\r\n- it doesn't exist for script sorting","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/470995813","html_url":"https://github.com/elastic/elasticsearch/issues/34597#issuecomment-470995813","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34597","id":470995813,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDk5NTgxMw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2019-03-08T16:47:30Z","updated_at":"2019-03-08T16:47:30Z","author_association":"MEMBER","body":"> it doesn't exist for script sorting\r\n\r\nThat is by design. Scripts are meant to be an advanced feature that allows the user to completely control the behavior of an API (in this case, generating the value used for sorting documents). There is no need for `missing` in scripts because the scripts can return whatever they want (including using min/max values to mimic first/last behavior).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/473210193","html_url":"https://github.com/elastic/elasticsearch/issues/34597#issuecomment-473210193","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/34597","id":473210193,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzIxMDE5Mw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-03-15T09:06:53Z","updated_at":"2019-03-15T09:06:53Z","author_association":"MEMBER","body":"We discussed this issue internally and decided that we'll not implement this feature. The script sort implies that the script must return a value for every document, there are multiple strategies that can be implemented when a field is missing so it is more flexible to implement them directly in the script. However for the case where creating a missing value in the script is not possible (string sort) we agreed that the solution should be to use two scripts sort, one responsible for sorting missing values first or last and the second one to tiebreak documents that create a value for the script. The solution could look like this:\r\n\r\n```\r\nsort\" : [\r\n      {\r\n        \"_script\" : {\r\n            \"type\" : \"number\",\r\n            \"script\" : {\r\n                \"lang\": \"painless\",\r\n                # returns 1 if a field is missing, 0 otherwise (missing last)\r\n                \"source\": \"if (doc['country'].isEmpty() || doc[`city'].isEmpty()) { return 1; } else { return 0;}\",\r\n            },\r\n            \"order\" : \"asc\"\r\n        }\r\n    },\r\n    {\r\n        \"_script\" : {\r\n            \"type\" : \"string\",\r\n            \"script\" : {\r\n                \"lang\": \"painless\",\r\n                \"source\": \"doc['country'].value + \"-\" + doc[`city']\",\r\n            },\r\n            \"order\" : \"asc\"\r\n        }\r\n    }\r\n}\r\n```","performed_via_github_app":null}]