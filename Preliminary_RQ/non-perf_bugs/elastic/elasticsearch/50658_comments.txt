[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/571160482","html_url":"https://github.com/elastic/elasticsearch/issues/50658#issuecomment-571160482","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50658","id":571160482,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MTE2MDQ4Mg==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2020-01-06T14:35:52Z","updated_at":"2020-01-06T14:35:52Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-features (:Core/Features/Watcher)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/572133342","html_url":"https://github.com/elastic/elasticsearch/issues/50658#issuecomment-572133342","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50658","id":572133342,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjEzMzM0Mg==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-01-08T15:55:30Z","updated_at":"2020-01-08T15:55:30Z","author_association":"MEMBER","body":"This failed because the watch didn't trigger, which was caused by the fact that the scheduler was paused:\r\n\r\n```\r\n[2020-01-06T16:08:15,403][INFO ][o.e.x.w.t.ScheduleTriggerEngineMock] [testCanUseAnyConcreteIndexName] not executing watch [mywatch] on this scheduler because it is paused\r\n```\r\n\r\nThe reason the scheduler was paused:\r\n\r\n```\r\n[2020-01-06T16:08:15,349][INFO ][o.e.x.w.WatcherService   ] [node_s1] paused watch execution, reason [no local watcher shards found], cancelled [0] queued tasks\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/572158634","html_url":"https://github.com/elastic/elasticsearch/issues/50658#issuecomment-572158634","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/50658","id":572158634,"node_id":"MDEyOklzc3VlQ29tbWVudDU3MjE1ODYzNA==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2020-01-08T16:52:38Z","updated_at":"2020-01-08T16:52:38Z","author_association":"MEMBER","body":"This test replaces the watch index after watcher got started. This triggers watches being reloaded and while this happens the trigger engine is paused, which disallows watches from being triggered. At this time there are no watches in the .watches index and I think this is just unlucky timing. \r\n\r\nReloading of watches happens in the background and the watch state can be started when that happens. For normal schedule trigger engines this is not an issue, because watches that are meant to be triggered are triggered when the engine triggers the next time. However for the mock scheduled trigger engine this is different, because watches are triggered programatically and there is no retry in this. \r\n\r\nI think just adding `timeWarp().trigger(\"mywatch\");` inside in assertBusy(...) is the right fix here. If it fails because the mock schedule trigger engine is paused then the test will try again. In the mean time the the watches can be reloaded, which then resumes the mock scheduled trigger engine.","performed_via_github_app":null}]