[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/3991396","html_url":"https://github.com/elastic/elasticsearch/issues/1645#issuecomment-3991396","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1645","id":3991396,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTEzOTY=","user":{"login":"markbirbeck","id":62572,"node_id":"MDQ6VXNlcjYyNTcy","avatar_url":"https://avatars2.githubusercontent.com/u/62572?v=4","gravatar_id":"","url":"https://api.github.com/users/markbirbeck","html_url":"https://github.com/markbirbeck","followers_url":"https://api.github.com/users/markbirbeck/followers","following_url":"https://api.github.com/users/markbirbeck/following{/other_user}","gists_url":"https://api.github.com/users/markbirbeck/gists{/gist_id}","starred_url":"https://api.github.com/users/markbirbeck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markbirbeck/subscriptions","organizations_url":"https://api.github.com/users/markbirbeck/orgs","repos_url":"https://api.github.com/users/markbirbeck/repos","events_url":"https://api.github.com/users/markbirbeck/events{/privacy}","received_events_url":"https://api.github.com/users/markbirbeck/received_events","type":"User","site_admin":false},"created_at":"2012-02-15T22:59:18Z","updated_at":"2012-02-15T22:59:18Z","author_association":"NONE","body":"Hi @kimchy,\n\nHave you (or anyone else) had a chance to look at this issue? It would be much appreciated if you could.\n\nGiven how badly out the numbers are I'm surprised that no-one else is seeing the same issue. I'm open to the idea that it could be a configuration issue on my part, but I can't for the life of me think what it could be. And what's most strange -- as you'll see from the Gist -- is that the problem can be reproduced with a very small number of records.\n\nThanks for any help you can give!\n\nMark\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/4007452","html_url":"https://github.com/elastic/elasticsearch/issues/1645#issuecomment-4007452","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1645","id":4007452,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMDc0NTI=","user":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"created_at":"2012-02-16T19:25:19Z","updated_at":"2012-02-16T19:25:19Z","author_association":"MEMBER","body":"It might be because not many use scoped facets on nested query within a bool query. To be honest, its still open as to what is the correct count to return in this case, is it an effort to return just the matches on the nested query, regardless of what other query, or return just relevant intersection of the two. What counts do you expect to get back in your gist?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/4031039","html_url":"https://github.com/elastic/elasticsearch/issues/1645#issuecomment-4031039","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1645","id":4031039,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzEwMzk=","user":{"login":"markbirbeck","id":62572,"node_id":"MDQ6VXNlcjYyNTcy","avatar_url":"https://avatars2.githubusercontent.com/u/62572?v=4","gravatar_id":"","url":"https://api.github.com/users/markbirbeck","html_url":"https://github.com/markbirbeck","followers_url":"https://api.github.com/users/markbirbeck/followers","following_url":"https://api.github.com/users/markbirbeck/following{/other_user}","gists_url":"https://api.github.com/users/markbirbeck/gists{/gist_id}","starred_url":"https://api.github.com/users/markbirbeck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markbirbeck/subscriptions","organizations_url":"https://api.github.com/users/markbirbeck/orgs","repos_url":"https://api.github.com/users/markbirbeck/repos","events_url":"https://api.github.com/users/markbirbeck/events{/privacy}","received_events_url":"https://api.github.com/users/markbirbeck/received_events","type":"User","site_admin":false},"created_at":"2012-02-18T01:34:40Z","updated_at":"2012-02-18T01:34:40Z","author_association":"NONE","body":"Hi Shay,\n\nThanks for getting back to me.\n\nI'd expect a count of 1 in both gists since they both have:\n\n```\n...\n{ \"query_string\": {\"query\": \"title:\\\"Article 1\\\"\"} }\n...\n```\n\nas part of their query. The first gist does return 1, but the second doesn't, and the only difference is that in the first gist 5 records are inserted, and in the second gist 6 are inserted.\n\nI'm afraid I haven't had time to experiment further but I was going to see whether the number of shards made a difference; it seems a bit of a coincidence that the jump happens at 5! (And I was also going to see whether I got another jump between 10 and 11...I'll try to find some time over the weekend to see if I get that.)\n\nThanks again.\n\nMark\n\nPS Scoped facets are the main reason we're using ES...putting aside this inaccuracy they work really well. After I first spotted this problem I changed tack and tried to see if I could get the behaviour I needed with some of Solr's newer features. Although I could get exact numbers by using hierarchical joins, the performance was substantially slower than with ES. In fact it was so much slower that we're back to using ES, and living with the incorrect -- but fast -- numbers. (With fingers crossed of course, that the numbers will at some point be correct.)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/4658479","html_url":"https://github.com/elastic/elasticsearch/issues/1645#issuecomment-4658479","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1645","id":4658479,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2NTg0Nzk=","user":{"login":"markbirbeck","id":62572,"node_id":"MDQ6VXNlcjYyNTcy","avatar_url":"https://avatars2.githubusercontent.com/u/62572?v=4","gravatar_id":"","url":"https://api.github.com/users/markbirbeck","html_url":"https://github.com/markbirbeck","followers_url":"https://api.github.com/users/markbirbeck/followers","following_url":"https://api.github.com/users/markbirbeck/following{/other_user}","gists_url":"https://api.github.com/users/markbirbeck/gists{/gist_id}","starred_url":"https://api.github.com/users/markbirbeck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markbirbeck/subscriptions","organizations_url":"https://api.github.com/users/markbirbeck/orgs","repos_url":"https://api.github.com/users/markbirbeck/repos","events_url":"https://api.github.com/users/markbirbeck/events{/privacy}","received_events_url":"https://api.github.com/users/markbirbeck/received_events","type":"User","site_admin":false},"created_at":"2012-03-23T12:58:25Z","updated_at":"2012-03-23T12:58:25Z","author_association":"NONE","body":"Issue still present in version 0.19.1.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/6242032","html_url":"https://github.com/elastic/elasticsearch/issues/1645#issuecomment-6242032","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1645","id":6242032,"node_id":"MDEyOklzc3VlQ29tbWVudDYyNDIwMzI=","user":{"login":"markbirbeck","id":62572,"node_id":"MDQ6VXNlcjYyNTcy","avatar_url":"https://avatars2.githubusercontent.com/u/62572?v=4","gravatar_id":"","url":"https://api.github.com/users/markbirbeck","html_url":"https://github.com/markbirbeck","followers_url":"https://api.github.com/users/markbirbeck/followers","following_url":"https://api.github.com/users/markbirbeck/following{/other_user}","gists_url":"https://api.github.com/users/markbirbeck/gists{/gist_id}","starred_url":"https://api.github.com/users/markbirbeck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markbirbeck/subscriptions","organizations_url":"https://api.github.com/users/markbirbeck/orgs","repos_url":"https://api.github.com/users/markbirbeck/repos","events_url":"https://api.github.com/users/markbirbeck/events{/privacy}","received_events_url":"https://api.github.com/users/markbirbeck/received_events","type":"User","site_admin":false},"created_at":"2012-06-11T11:25:29Z","updated_at":"2012-06-11T11:25:29Z","author_association":"NONE","body":"Bumping this again.\n\n@kimchy The issue is related to the number of shards. I thought I'd run the tests again to see how things were with 0.19.4 and at first it seemed that the the error had disappeared. However, we've started using 6 shards as our default setting now, rather than 5, so I increased the number of records inserted by 1, and sure enough the error reappeared.\n\nOne other thing: you mentioned in our previous exchange that it was an open issue as to what values should be returned when doing this kind of query, and whilst I agree with you that there are a number of ways this could be interpreted, the key problem here is that we get _different_ results depending on how many records are in the index. So to clarify the issue:\n- if we insert 5 records and search for a specific record with facets we get 1 hit (correct) and 1 facet (correct again);\n- however, if we insert 1 record more than the number of shards and run the query again we get 1 hit (correct) and _2_ facets (incorrect).\n\nIf you have any chance to look at this it would be much appreciated. I would be really surprised if this was a localised issue, and would guess that there are other results that would be impacted by this problem.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/48339731","html_url":"https://github.com/elastic/elasticsearch/issues/1645#issuecomment-48339731","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1645","id":48339731,"node_id":"MDEyOklzc3VlQ29tbWVudDQ4MzM5NzMx","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-07-08T14:02:32Z","updated_at":"2014-07-08T14:02:32Z","author_association":"CONTRIBUTOR","body":"This issue has been resolved in aggregations.  Nested scopes are no longer supported.\n","performed_via_github_app":null}]