[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422363083","html_url":"https://github.com/elastic/elasticsearch/issues/33764#issuecomment-422363083","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33764","id":422363083,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjM2MzA4Mw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T11:53:50Z","updated_at":"2018-09-18T11:53:50Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422364268","html_url":"https://github.com/elastic/elasticsearch/issues/33764#issuecomment-422364268","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33764","id":422364268,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjM2NDI2OA==","user":{"login":"javanna","id":832460,"node_id":"MDQ6VXNlcjgzMjQ2MA==","avatar_url":"https://avatars1.githubusercontent.com/u/832460?v=4","gravatar_id":"","url":"https://api.github.com/users/javanna","html_url":"https://github.com/javanna","followers_url":"https://api.github.com/users/javanna/followers","following_url":"https://api.github.com/users/javanna/following{/other_user}","gists_url":"https://api.github.com/users/javanna/gists{/gist_id}","starred_url":"https://api.github.com/users/javanna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javanna/subscriptions","organizations_url":"https://api.github.com/users/javanna/orgs","repos_url":"https://api.github.com/users/javanna/repos","events_url":"https://api.github.com/users/javanna/events{/privacy}","received_events_url":"https://api.github.com/users/javanna/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T11:58:37Z","updated_at":"2018-09-18T11:58:37Z","author_association":"MEMBER","body":"At first glance, I would say that you increased the number of parallel reindex tasks a bit too much. 16 at the same time cause rejections like you have found out rather than just delays and that is expected. The way that the indexing threadpool works is that we queue up a certain number of requests, but at some point (like in your case) the queue may reach a threshold, which causes rejections. I will let somebody @elastic/es-distributed comment though before closing, just to make sure that there is nothing we can do.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422383064","html_url":"https://github.com/elastic/elasticsearch/issues/33764#issuecomment-422383064","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33764","id":422383064,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjM4MzA2NA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T12:59:22Z","updated_at":"2018-09-18T13:03:38Z","author_association":"CONTRIBUTOR","body":"This looks like a bug to me. I think the same retry policy should be used for storing the task result as for sending the bulk requests. @nik9000 what are your thoughts on this?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/422385416","html_url":"https://github.com/elastic/elasticsearch/issues/33764#issuecomment-422385416","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33764","id":422385416,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjM4NTQxNg==","user":{"login":"Katulus","id":1485893,"node_id":"MDQ6VXNlcjE0ODU4OTM=","avatar_url":"https://avatars2.githubusercontent.com/u/1485893?v=4","gravatar_id":"","url":"https://api.github.com/users/Katulus","html_url":"https://github.com/Katulus","followers_url":"https://api.github.com/users/Katulus/followers","following_url":"https://api.github.com/users/Katulus/following{/other_user}","gists_url":"https://api.github.com/users/Katulus/gists{/gist_id}","starred_url":"https://api.github.com/users/Katulus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Katulus/subscriptions","organizations_url":"https://api.github.com/users/Katulus/orgs","repos_url":"https://api.github.com/users/Katulus/repos","events_url":"https://api.github.com/users/Katulus/events{/privacy}","received_events_url":"https://api.github.com/users/Katulus/received_events","type":"User","site_admin":false},"created_at":"2018-09-18T13:06:10Z","updated_at":"2018-09-18T13:06:10Z","author_association":"NONE","body":"I admit that 16 parallel tasks is much and I don't need to run that many. I created this case to point out that the way how ES handles the rejection does not allow client to react. If it instead of removing failed task sets the task result to something like \"rejected\" and let client back off and retry later it would be perfectly fine.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/427589430","html_url":"https://github.com/elastic/elasticsearch/issues/33764#issuecomment-427589430","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/33764","id":427589430,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNzU4OTQzMA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2018-10-06T16:57:10Z","updated_at":"2018-10-06T16:57:10Z","author_association":"CONTRIBUTOR","body":"> @nik9000 what are your thoughts on this?\r\n\r\nI think we should be fairly relentless about storing the task result, yes. This is more fuel for the \"don't stick task results into an index\" argument.\r\n\r\n>  If it instead of removing failed task sets the task result to something like \"rejected\" and let client back off and retry later it would be perfectly fine.\r\n\r\nIf we didn't accidentally throw the task result away you'd get something like that. It'd be a failure recorded with the reason set to \"rejected\" or something along those lines and it'd be up to you to figure out how to handle it. How you handle it is kind of dependant on the data that you were reindexing. Sometimes it'd be fine to just retry the reindex.","performed_via_github_app":null}]