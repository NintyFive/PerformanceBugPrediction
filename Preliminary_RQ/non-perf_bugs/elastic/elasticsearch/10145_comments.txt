[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83641516","html_url":"https://github.com/elastic/elasticsearch/issues/10145#issuecomment-83641516","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10145","id":83641516,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNjQxNTE2","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-03-19T15:53:11Z","updated_at":"2015-03-19T15:53:11Z","author_association":"CONTRIBUTOR","body":"We hit a similar issue in lucene when upgrading. @uschindler is filing a bug at oracle.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83652168","html_url":"https://github.com/elastic/elasticsearch/issues/10145#issuecomment-83652168","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10145","id":83652168,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNjUyMTY4","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2015-03-19T16:30:58Z","updated_at":"2015-03-19T16:30:58Z","author_association":"CONTRIBUTOR","body":"I submitted a bug report! Its is not yet visible, I will report back. The problem is caused by the diamond operator with -source/target 1.7. The diamond's real type is deducted not from left side of assignement as JLS spec says, but instead from the parameter passed to the constructor (e.g. new HashSet<>(otherSet)). In that case it takes type from otherSet which is wrong.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83652887","html_url":"https://github.com/elastic/elasticsearch/issues/10145#issuecomment-83652887","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10145","id":83652887,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNjUyODg3","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-03-19T16:34:17Z","updated_at":"2015-03-19T16:34:17Z","author_association":"CONTRIBUTOR","body":"Thanks for digging Uwe. I tried to understand the problems, I felt like i was looking at c++ compiler errors with tons of templates :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/83653005","html_url":"https://github.com/elastic/elasticsearch/issues/10145#issuecomment-83653005","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10145","id":83653005,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNjUzMDA1","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2015-03-19T16:34:46Z","updated_at":"2015-03-19T16:34:46Z","author_association":"CONTRIBUTOR","body":"Link to Lucene: http://mail-archives.apache.org/mod_mbox/lucene-dev/201503.mbox/%3C066501d06256%242f949300%248ebdb900%24%40thetaphi.de%3E\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/85422658","html_url":"https://github.com/elastic/elasticsearch/issues/10145#issuecomment-85422658","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10145","id":85422658,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDIyNjU4","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2015-03-24T09:34:03Z","updated_at":"2015-03-24T09:34:03Z","author_association":"CONTRIBUTOR","body":"Hi,\nthe bug report at Oracle is: https://bugs.openjdk.java.net/browse/JDK-8075793\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/85422797","html_url":"https://github.com/elastic/elasticsearch/issues/10145#issuecomment-85422797","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10145","id":85422797,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDIyNzk3","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2015-03-24T09:34:53Z","updated_at":"2015-03-24T09:34:53Z","author_association":"CONTRIBUTOR","body":"thanks @uschindler \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100454233","html_url":"https://github.com/elastic/elasticsearch/issues/10145#issuecomment-100454233","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10145","id":100454233,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDQ1NDIzMw==","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2015-05-09T09:07:09Z","updated_at":"2015-05-09T09:10:20Z","author_association":"CONTRIBUTOR","body":"Hi,\naccording to the OpenJDK people, this is not really a bug in the JDK, because the Java Language Spec was implemented in a wrong way up to Java 8. The current code is only valid according to JLS with Java 8+ (where the JLS was adopted to allow this behaviour that we expected) - this is why it works in Lucene trunk with Java 8. It was just a bug in the Java 5, 6, 7 compilers that did a \"wrong\"shortcut to get the type of the diamond.\n\nThis wrong behaviour in Javac is fixed in Java 9, so the broken code should only compile with -source 8 or -source 9 (LOL).\n\nIn fact you have to add the type into the diamond for Java 7, so basically the code on our side was wrong (I did not verify that from the JLS, this is what was written by Dan Smith).\n\nDan Smith wrote:\n\n> Simplified test:\n> \n> ```\n>   class C<T> {}\n> \n>   <T> C<T> m(C<? extends T> x) { return null; }\n> \n>   void test(C<? extends Number> arg) {\n>     C<Number> c = m(arg);\n>   }\n> ```\n> \n> Type checking behavior is clear, per JLS 3 and JLS 7:\n> - The type of 'arg' is C<CAP#1>, where CAP#1 extends Number (6.5.6.1)\n> - Inference determines that T has lower bound CAP#1 (15.12.2.7)\n> - The type of T is inferred as CAP#1 (15.12.2.7)\n> - The type of the method invocation ('m(arg)') is C<CAP#1> (15.12.2.6)\n> - C<CAP#1> cannot be assigned to C<Number> (4.10.2)\n> \n> Traditionally, javac has performed some unspecified \"simplifications\" that led to T being inferred as 'Number' rather than 'CAP#1'. These unspecified behaviors break programs that should compile, but also allow programs like these to be compiled when the spec disallows them (see JDK-8039214).\n> \n> For the class of programs described by this bug, changes made to inference in JLS 8 make these JLS/javac inconsistencies moot, because both strategies get the same answer. But under -source 7, the distinction is apparent, and fixing JDK-8039214 exposes these programs' dependency on incorrect type checking behavior.\n> \n> Broadly, our choices:\n> - Not A Bug, expect users to fix their code\n> - Freeze the -source 7 type checking implementation, and stop fixing bugs in it (hard to separate JDK-8039214 from many other bugs...)\n> - Retroactively \"specify\" javac's legacy behavior as part of inference in 5-7, re-implement it, and hope this doesn't cause subtle breakage elsewhere\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/100461015","html_url":"https://github.com/elastic/elasticsearch/issues/10145#issuecomment-100461015","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10145","id":100461015,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDQ2MTAxNQ==","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2015-05-09T10:21:41Z","updated_at":"2015-05-09T10:21:41Z","author_association":"CONTRIBUTOR","body":"Because it is unclear, how this issue is solved on the OpenJDK side, I would recommend to stay with the current fix, because those diamonds and type guessing by the compiler was always broken (my personal opinion). There also exist differences between Eclipse's compiler and JDK's and most of those differences are around this type of stuff.\n\nI always hated diamonds and was always more happy with being explicit. So we should be more explicit in our code, if the type inference is not easy to explain!\n\nThanks,\nthe Generics Policeman :-)\n","performed_via_github_app":null}]