{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/13557","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13557/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13557/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/13557/events","html_url":"https://github.com/elastic/elasticsearch/issues/13557","id":106347150,"node_id":"MDU6SXNzdWUxMDYzNDcxNTA=","number":13557,"title":"Running bin/plugin creates empty log files","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"labels":[{"id":114977275,"node_id":"MDU6TGFiZWwxMTQ5NzcyNzU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Delivery/Packaging","name":":Delivery/Packaging","color":"0e8a16","default":false,"description":"RPM and deb packaging, tar and zip archives, shell and batch scripts"},{"id":2495976472,"node_id":"MDU6TGFiZWwyNDk1OTc2NDcy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/Team:Delivery","name":"Team:Delivery","color":"fef2c0","default":false,"description":"Meta label for Delivery team"},{"id":267570376,"node_id":"MDU6TGFiZWwyNjc1NzAzNzY=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-rc1","name":"v2.0.0-rc1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"assignees":[{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2015-09-14T14:00:12Z","updated_at":"2020-11-11T21:59:21Z","closed_at":"2015-09-22T15:19:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Recently, running `bin/plugin` started creating empty log files:\n\n```\n-rw-r--r--. 1 root root 0 Sep 14 13:50 elasticsearch_deprecation.log\n-rw-r--r--. 1 root root 0 Sep 14 13:50 elasticsearch_index_indexing_slowlog.log\n-rw-r--r--. 1 root root 0 Sep 14 13:50 elasticsearch_index_search_slowlog.log\n-rw-r--r--. 1 root root 0 Sep 14 13:50 elasticsearch.log\n\ndrwxr-xr-x. 2 root          root           4096 Sep 14 13:54 logs\n```\n\nThe trouble is that they are created as the user that ran `bin/plugin` which is usually `root`. Elasticsearch is never run as root so it fails to create and write to to the logs. It warns pretty mightily:\n\n```\n   log4j:ERROR setFile(null,true) call failed.\n   java.io.FileNotFoundException: /tmp/elasticsearch/logs/elasticsearch.log (Permission denied)\n        at java.io.FileOutputStream.open0(Native Method)\n        at java.io.FileOutputStream.open(FileOutputStream.java:270)\n        at java.io.FileOutputStream.<init>(FileOutputStream.java:213)\n        at java.io.FileOutputStream.<init>(FileOutputStream.java:133)\n        at org.apache.log4j.FileAppender.setFile(FileAppender.java:294)\n        at org.apache.log4j.FileAppender.activateOptions(FileAppender.java:165)\n        at org.apache.log4j.DailyRollingFileAppender.activateOptions(DailyRollingFileAppender.java:223)\n        at org.apache.log4j.config.PropertySetter.activate(PropertySetter.java:307)\n        at org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:172)\n        at org.apache.log4j.config.PropertySetter.setProperties(PropertySetter.java:104)\n        at org.apache.log4j.PropertyConfigurator.parseAppender(PropertyConfigurator.java:842)\n        at org.apache.log4j.PropertyConfigurator.parseCategory(PropertyConfigurator.java:768)\n        at org.apache.log4j.PropertyConfigurator.configureRootCategory(PropertyConfigurator.java:648)\n        at org.apache.log4j.PropertyConfigurator.doConfigure(PropertyConfigurator.java:514)\n        at org.apache.log4j.PropertyConfigurator.configure(PropertyConfigurator.java:440)\n        at org.elasticsearch.common.logging.log4j.LogConfigurator.configure(LogConfigurator.java:116)\n        at org.elasticsearch.bootstrap.Bootstrap.setupLogging(Bootstrap.java:187)\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:244)\n        at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:35)\n   log4j:ERROR Either File or DatePattern options are not set for appender [file].\n```\n\nYou can recreate it with the tar distribution:\n\n``` bash\nmkdir tmp\ncd tmp\ntar xf ../elasticsearch-2.1.0-SNAPSHOT.tar.gz\ncd elasticsearch*\nsudo bin/plugin install file://${SOME_PATH_TO_A_PLUG}\nls -l | grep log\n```\n\nNote: if you do this inside vagrant do it in `/tmp` or something. `/elasticsearch` is shared using virtualboxfs and will always be owned by the virtualbox user.\n","closed_by":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"performed_via_github_app":null}