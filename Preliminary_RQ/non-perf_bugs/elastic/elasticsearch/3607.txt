{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3607","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3607/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3607/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3607/events","html_url":"https://github.com/elastic/elasticsearch/issues/3607","id":18906498,"node_id":"MDU6SXNzdWUxODkwNjQ5OA==","number":3607,"title":"Term facet accepts an array for \"order\", yet, only last value is used","user":{"login":"lmenezes","id":750074,"node_id":"MDQ6VXNlcjc1MDA3NA==","avatar_url":"https://avatars1.githubusercontent.com/u/750074?v=4","gravatar_id":"","url":"https://api.github.com/users/lmenezes","html_url":"https://github.com/lmenezes","followers_url":"https://api.github.com/users/lmenezes/followers","following_url":"https://api.github.com/users/lmenezes/following{/other_user}","gists_url":"https://api.github.com/users/lmenezes/gists{/gist_id}","starred_url":"https://api.github.com/users/lmenezes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lmenezes/subscriptions","organizations_url":"https://api.github.com/users/lmenezes/orgs","repos_url":"https://api.github.com/users/lmenezes/repos","events_url":"https://api.github.com/users/lmenezes/events{/privacy}","received_events_url":"https://api.github.com/users/lmenezes/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2013-09-03T12:57:57Z","updated_at":"2014-08-08T16:38:59Z","closed_at":"2014-08-08T16:38:59Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"the TermsFacetParser doesn't treat the case of receiving an array/object for fields that don't support it. it should maybe throw an QueryParsingException around \nhttps://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/search/facet/terms/TermsFacetParser.java#L102-L119\nin the case of being an array/object and not matching one of the possible fields in those blocks.\nfor this snippet for example\n\n```\ncurl -XPOST http://localhost:9200/foo\ncurl -XPUT http://localhost:9200/foo/bar/1 -d '{\"id\":1, \"tag\":\"a1 a2 a3 a4 a5\"}'\ncurl -XPUT http://localhost:9200/foo/bar/2 -d '{\"id\":2, \"tag\":\"b1 b2 b3 b4 b5\"}'\ncurl -XPUT http://localhost:9200/foo/bar/3 -d '{\"id\":3, \"tag\":\"a1 a2 a3 a4 a5 b1 b2 b3 b4 b5\"}'\ncurl -XPOST http://localhost:9200/foo/bar/_search -d '{ \"query\": { \"match_all\":{} }, \"facets\": { \"tags\": { \"terms\": { \"field\": \"tag\", \"size\":5, \"order\":[\"count\",\"term\"] } } }, \"size\":0 }'\n```\n\nES will accept the request without problems(even though multiple values are passed for the order) and will just use \"term\" as order, since inside the parser at some moment it wont match any of the possibilities, and will just skip to the next token.\nit would be nice getting some parsing error for that, since it might be a little confusing.\n\nthis ticket actually started as a feature request to accept multiple values for order inside facets, but i suppose with the whole facet module being rewritten, i won't have much luck with it.\n- i also checked some other parsers and I think this could actually happen in a few different places.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}