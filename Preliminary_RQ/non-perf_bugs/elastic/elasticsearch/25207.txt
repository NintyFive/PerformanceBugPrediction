{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25207","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25207/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25207/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25207/events","html_url":"https://github.com/elastic/elasticsearch/issues/25207","id":235673195,"node_id":"MDU6SXNzdWUyMzU2NzMxOTU=","number":25207,"title":"Cluster Stats API Returning Incorrect Values","user":{"login":"MaxFlanders","id":16246896,"node_id":"MDQ6VXNlcjE2MjQ2ODk2","avatar_url":"https://avatars1.githubusercontent.com/u/16246896?v=4","gravatar_id":"","url":"https://api.github.com/users/MaxFlanders","html_url":"https://github.com/MaxFlanders","followers_url":"https://api.github.com/users/MaxFlanders/followers","following_url":"https://api.github.com/users/MaxFlanders/following{/other_user}","gists_url":"https://api.github.com/users/MaxFlanders/gists{/gist_id}","starred_url":"https://api.github.com/users/MaxFlanders/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MaxFlanders/subscriptions","organizations_url":"https://api.github.com/users/MaxFlanders/orgs","repos_url":"https://api.github.com/users/MaxFlanders/repos","events_url":"https://api.github.com/users/MaxFlanders/events{/privacy}","received_events_url":"https://api.github.com/users/MaxFlanders/received_events","type":"User","site_admin":false},"labels":[{"id":146836529,"node_id":"MDU6TGFiZWwxNDY4MzY1Mjk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/Stats","name":":Core/Features/Stats","color":"0e8a16","default":false,"description":"Statistics tracking and retrieval APIs"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"assignees":[{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2017-06-13T19:53:04Z","updated_at":"2017-09-06T18:20:05Z","closed_at":"2017-09-06T18:20:05Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n<!-- Bug report -->\r\nI have also raised this issue on the elastic forums here where it has received a little bit of discussion: https://discuss.elastic.co/t/es-cluster-stats-api-returning-false-values/84949\r\n\r\n**Elasticsearch version**: 5.3.0\r\n\r\n**Plugins installed**: [\r\nmapper-size,\r\nx-pack,\r\ninstall-repository-hdfs-plugin,\r\ninstall-repository-s3-plugin,\r\ninstall-repository-gcs-plugin\r\n]\r\n\r\n**JVM version** (`java -version`):\r\njava version \"1.8.0_25\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_25-b17)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nLinux kibana-uscen-a-c016-n001 4.4.0-45-generic #66~14.04.1-Ubuntu SMP Wed Oct 19 15:05:38 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nOn some of our nodes, when we hit the cluster stats api in order to check the fs stats and see how much disk we are using, we receive a response of 8192pb/8192pb.\r\nEx. `curl \"$(hostname -i):9200/_cluster/stats?human&pretty\"` (jump down to fs, third from bottom)\r\n```\r\n{\r\n  \"_nodes\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"failed\" : 0\r\n  },\r\n  \"cluster_name\" : \"c016-logging\",\r\n  \"timestamp\" : 1497382449906,\r\n  \"status\" : \"green\",\r\n  \"indices\" : {\r\n    \"count\" : 75,\r\n    \"shards\" : {\r\n      \"total\" : 390,\r\n      \"primaries\" : 195,\r\n      \"replication\" : 1.0,\r\n      \"index\" : {\r\n        \"shards\" : {\r\n          \"min\" : 2,\r\n          \"max\" : 10,\r\n          \"avg\" : 5.2\r\n        },\r\n        \"primaries\" : {\r\n          \"min\" : 1,\r\n          \"max\" : 5,\r\n          \"avg\" : 2.6\r\n        },\r\n        \"replication\" : {\r\n          \"min\" : 1.0,\r\n          \"max\" : 1.0,\r\n          \"avg\" : 1.0\r\n        }\r\n      }\r\n    },\r\n    \"docs\" : {\r\n      \"count\" : 69448767,\r\n      \"deleted\" : 35952\r\n    },\r\n    \"store\" : {\r\n      \"size\" : \"265.8gb\",\r\n      \"size_in_bytes\" : 285424410206,\r\n      \"throttle_time\" : \"0s\",\r\n      \"throttle_time_in_millis\" : 0\r\n    },\r\n    \"fielddata\" : {\r\n      \"memory_size\" : \"69.7kb\",\r\n      \"memory_size_in_bytes\" : 71400,\r\n      \"evictions\" : 0\r\n    },\r\n    \"query_cache\" : {\r\n      \"memory_size\" : \"73.4mb\",\r\n      \"memory_size_in_bytes\" : 77011824,\r\n      \"total_count\" : 180142263,\r\n      \"hit_count\" : 173476473,\r\n      \"miss_count\" : 6665790,\r\n      \"cache_size\" : 61613,\r\n      \"cache_count\" : 92730,\r\n      \"evictions\" : 31117\r\n    },\r\n    \"completion\" : {\r\n      \"size\" : \"0b\",\r\n      \"size_in_bytes\" : 0\r\n    },\r\n    \"segments\" : {\r\n      \"count\" : 6744,\r\n      \"memory\" : \"579.4mb\",\r\n      \"memory_in_bytes\" : 607625919,\r\n      \"terms_memory\" : \"428.9mb\",\r\n      \"terms_memory_in_bytes\" : 449782182,\r\n      \"stored_fields_memory\" : \"88.5mb\",\r\n      \"stored_fields_memory_in_bytes\" : 92872968,\r\n      \"term_vectors_memory\" : \"0b\",\r\n      \"term_vectors_memory_in_bytes\" : 0,\r\n      \"norms_memory\" : \"17.7mb\",\r\n      \"norms_memory_in_bytes\" : 18603328,\r\n      \"points_memory\" : \"4.9mb\",\r\n      \"points_memory_in_bytes\" : 5192169,\r\n      \"doc_values_memory\" : \"39.2mb\",\r\n      \"doc_values_memory_in_bytes\" : 41175272,\r\n      \"index_writer_memory\" : \"43.6mb\",\r\n      \"index_writer_memory_in_bytes\" : 45782632,\r\n      \"version_map_memory\" : \"215.7kb\",\r\n      \"version_map_memory_in_bytes\" : 220924,\r\n      \"fixed_bit_set\" : \"0b\",\r\n      \"fixed_bit_set_memory_in_bytes\" : 0,\r\n      \"max_unsafe_auto_id_timestamp\" : 1497312009291,\r\n      \"file_sizes\" : { }\r\n    }\r\n  },\r\n  \"nodes\" : {\r\n    \"count\" : {\r\n      \"total\" : 5,\r\n      \"data\" : 3,\r\n      \"coordinating_only\" : 1,\r\n      \"master\" : 3,\r\n      \"ingest\" : 4\r\n    },\r\n    \"versions\" : [\r\n      \"5.3.0\"\r\n    ],\r\n    \"os\" : {\r\n      \"available_processors\" : 10,\r\n      \"allocated_processors\" : 10,\r\n      \"names\" : [\r\n        {\r\n          \"name\" : \"Linux\",\r\n          \"count\" : 5\r\n        }\r\n      ],\r\n      \"mem\" : {\r\n        \"total\" : \"36.5gb\",\r\n        \"total_in_bytes\" : 39216926720,\r\n        \"free\" : \"2.9gb\",\r\n        \"free_in_bytes\" : 3192020992,\r\n        \"used\" : \"33.5gb\",\r\n        \"used_in_bytes\" : 36024905728,\r\n        \"free_percent\" : 8,\r\n        \"used_percent\" : 92\r\n      }\r\n    },\r\n    \"process\" : {\r\n      \"cpu\" : {\r\n        \"percent\" : 77\r\n      },\r\n      \"open_file_descriptors\" : {\r\n        \"min\" : 315,\r\n        \"max\" : 1414,\r\n        \"avg\" : 677\r\n      }\r\n    },\r\n    \"jvm\" : {\r\n      \"max_uptime\" : \"34d\",\r\n      \"max_uptime_in_millis\" : 2945872000,\r\n      \"versions\" : [\r\n        {\r\n          \"version\" : \"1.8.0_25\",\r\n          \"vm_name\" : \"Java HotSpot(TM) 64-Bit Server VM\",\r\n          \"vm_version\" : \"25.25-b02\",\r\n          \"vm_vendor\" : \"Oracle Corporation\",\r\n          \"count\" : 5\r\n        }\r\n      ],\r\n      \"mem\" : {\r\n        \"heap_used\" : \"5.9gb\",\r\n        \"heap_used_in_bytes\" : 6391948904,\r\n        \"heap_max\" : \"14.9gb\",\r\n        \"heap_max_in_bytes\" : 16018964480\r\n      },\r\n      \"threads\" : 356\r\n    },\r\n    \"fs\" : {\r\n      \"total\" : \"8192pb\",\r\n      \"total_in_bytes\" : 9223372036854775807,\r\n      \"free\" : \"8192pb\",\r\n      \"free_in_bytes\" : 9223372036854775807,\r\n      \"available\" : \"8192pb\",\r\n      \"available_in_bytes\" : 9223372036854775807,\r\n      \"spins\" : \"true\"\r\n    },\r\n    \"plugins\" : [\r\n      {\r\n        \"name\" : \"x-pack\",\r\n        \"version\" : \"5.3.0\",\r\n        \"description\" : \"Elasticsearch Expanded Pack Plugin\",\r\n        \"classname\" : \"org.elasticsearch.xpack.XPackPlugin\"\r\n      },\r\n      {\r\n        \"name\" : \"mapper-size\",\r\n        \"version\" : \"5.3.0\",\r\n        \"description\" : \"The Mapper Size plugin allows document to record their uncompressed size at index time.\",\r\n        \"classname\" : \"org.elasticsearch.plugin.mapper.MapperSizePlugin\"\r\n      }\r\n    ],\r\n    \"network_types\" : {\r\n      \"transport_types\" : {\r\n        \"netty4\" : 4,\r\n        \"security4\" : 1\r\n      },\r\n      \"http_types\" : {\r\n        \"netty4\" : 4,\r\n        \"security4\" : 1\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nIn reality, each data node has a 200gb disk for a total of 600gb, and I would expect it to reflect that.\r\n\r\n**Steps to reproduce**:\r\n\r\nWe dont know what the precise conditions are that created this issue but we have one cluster currently demonstrating it, and that cluster consists of:\r\n\r\n3 Dual Master/Data Nodes\r\n1 Client Node (also running kibana on the same machine)\r\n1 Tribe Node\r\n\r\nWhen hitting the stats api, from the Master/Data nodes, we receive the expected result:\r\n```\r\n    \"fs\" : {\r\n      \"total\" : \"600gb\",\r\n      \"total_in_bytes\" : 644268523520,\r\n      \"free\" : \"328gb\",\r\n      \"free_in_bytes\" : 352259792896,\r\n      \"available\" : \"297.5gb\",\r\n      \"available_in_bytes\" : 319443623936,\r\n      \"spins\" : \"true\"\r\n    }\r\n```\r\nBut when hitting the stats api from the client node, we receive the incorrect result:\r\n```\r\n    \"fs\" : {\r\n      \"total\" : \"8192pb\",\r\n      \"total_in_bytes\" : 9223372036854775807,\r\n      \"free\" : \"8192pb\",\r\n      \"free_in_bytes\" : 9223372036854775807,\r\n      \"available\" : \"8192pb\",\r\n      \"available_in_bytes\" : 9223372036854775807,\r\n      \"spins\" : \"true\"\r\n    }\r\n```\r\nWhile I don't know what conditions to recreate it, we do have a live cluster in this state which I would be happy to run any diagnostics against.","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}