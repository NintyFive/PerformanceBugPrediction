{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/2398","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2398/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2398/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/2398/events","html_url":"https://github.com/elastic/elasticsearch/issues/2398","id":8273804,"node_id":"MDU6SXNzdWU4MjczODA0","number":2398,"title":"Inconsistent results of facets running with a nested query scope","user":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2012-11-11T17:47:53Z","updated_at":"2013-02-06T10:16:16Z","closed_at":"2013-02-06T10:16:16Z","author_association":"MEMBER","active_lock_reason":null,"body":"When a nested query is combined with a parent query and a facet is executed against the nested query scope, the facet results depend on the order of execution of nested and parent queries.  For example, if a bool query has two `must` clauses and the nested query is the first clause, the nested facets are filtered by the parents query in the last clause. If the nested query is the last clause, the nested facet runs against all nested document ignoring the parent query in the first clause. Example: https://gist.github.com/c505e3ce1f535d700f37\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}