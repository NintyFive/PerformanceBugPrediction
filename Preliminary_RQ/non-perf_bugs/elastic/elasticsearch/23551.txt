{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23551","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23551/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23551/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23551/events","html_url":"https://github.com/elastic/elasticsearch/issues/23551","id":213592464,"node_id":"MDU6SXNzdWUyMTM1OTI0NjQ=","number":23551,"title":"Missing mapping for nested dynamic field results in error \"failed to find nested object under path\"","user":{"login":"shunitben","id":1317934,"node_id":"MDQ6VXNlcjEzMTc5MzQ=","avatar_url":"https://avatars3.githubusercontent.com/u/1317934?v=4","gravatar_id":"","url":"https://api.github.com/users/shunitben","html_url":"https://github.com/shunitben","followers_url":"https://api.github.com/users/shunitben/followers","following_url":"https://api.github.com/users/shunitben/following{/other_user}","gists_url":"https://api.github.com/users/shunitben/gists{/gist_id}","starred_url":"https://api.github.com/users/shunitben/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shunitben/subscriptions","organizations_url":"https://api.github.com/users/shunitben/orgs","repos_url":"https://api.github.com/users/shunitben/repos","events_url":"https://api.github.com/users/shunitben/events{/privacy}","received_events_url":"https://api.github.com/users/shunitben/received_events","type":"User","site_admin":false},"labels":[{"id":141145460,"node_id":"MDU6TGFiZWwxNDExNDU0NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Mapping","name":":Search/Mapping","color":"0e8a16","default":false,"description":"How fields should be indexed"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-03-12T09:07:29Z","updated_at":"2018-03-14T08:30:39Z","closed_at":"2018-03-14T08:20:44Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\nGitHub is reserved for bug reports and feature requests. The best place\r\nto ask a general question is at the Elastic Discourse forums at\r\nhttps://discuss.elastic.co. If you are in fact posting a bug report or\r\na feature request, please include one and only one of the below blocks\r\nin your new issue. Note that whether you're filing a bug report or a\r\nfeature request, ensure that your submission is for an\r\n[OS that we support](https://www.elastic.co/support/matrix#show_os).\r\nBug reports on an OS that we do not support or feature requests\r\nspecific to an OS that we do not support will be closed.\r\n-->\r\n\r\n<!--\r\nIf you are filing a bug report, please remove the below feature\r\nrequest block and provide responses for all of the below items.\r\n-->\r\n\r\n**Elasticsearch version**: 2.3.4\r\n\r\n**Plugins installed**: none\r\n\r\n**JVM version**: java version \"1.8.0_65\"\r\n\r\n**OS version**: Mac OSX el capitan\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nWe have items in our system, and each item can have translations. A translation may contain these fields: name, teaser, tags. We have a dynamic list of languages, so we map the translations fields dynamicly.\r\n\r\nThe elastic index mapping defines dynamic templates, which have definitions for regular string fields, and for nested \"tags\" fields:\r\n\r\n      \"dynamic_templates\": [\r\n        {\r\n          \"tags\": {\r\n            \"mapping\": {\r\n              \"type\": \"nested\",\r\n              \"properties\": {\r\n                \"name\": {\r\n                  \"type\": \"string\"\r\n                },\r\n                \"weight\": {\r\n                  \"type\": \"integer\"\r\n                }\r\n              }\r\n            },\r\n            \"path_match\": \"translations.*.tags\"\r\n          }\r\n        },\r\n  \t  \t... [strings dynamic mapping]\r\n      ]\r\n\t  \r\n\t  \r\nWhen documents are added to the index, this results in such mappings:\r\n\t  \r\n      \"properties\": {\r\n\t    ...\r\n        \"translations\": {\r\n          \"properties\": {\r\n            \"fr\": {\r\n              \"properties\": {\r\n                \"name\": {\r\n                  \"type\": \"string\",\r\n                  \"fields\": {\r\n                    \"raw_lowercase\": {\r\n                      \"type\": \"string\",\r\n                      \"analyzer\": \"raw_lowercase\"\r\n                    }\r\n                  },\r\n                  \"analyzer\": \"standard-stopwords\"\r\n                },\r\n                \"tags\" : {\r\n                  \"type\": \"nested\",\r\n                  \"properties\": {\r\n                    \"name\": {\r\n                      \"type\": \"string\"\r\n                    },\r\n                    \"weight\": {\r\n                      \"type\": \"integer\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            },\r\n\t\t\t...[other langs]\r\n          }\r\n        }\r\n      }\r\n\t  \r\nOur issue is when querying in languages where a document that contains these fields hasn't yet been added for a specific language.\r\nFor example, if I've only added one document with a russian translation, and this russian translation only has a name (no teaser or tags fields), then the resulting mapping for russian will look like this:\r\n\r\n            \"ru\": {\r\n              \"properties\": {\r\n                \"name\": {\r\n                  ...\r\n                }\r\n              }\r\n            }\r\n\r\nIf I then run a query that uses translations.ru.tags, I get the following error:\r\n\r\n\tfailed to find nested object under path [translations.ru.tags]  \r\n\r\nHowever, a query using translations.ru.teaser is perfectly fine - it does not complain, but of course, it won't return any results.\r\n\r\nWe would expect nested fields to be ignored in the same way as regular string fields, or to have some flag that would allow this behavior. Is there such a thing? We couldn't find it.\r\n\r\n\r\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}