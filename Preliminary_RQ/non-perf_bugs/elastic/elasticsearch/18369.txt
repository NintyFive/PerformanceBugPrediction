{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/18369","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18369/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18369/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/18369/events","html_url":"https://github.com/elastic/elasticsearch/issues/18369","id":154996498,"node_id":"MDU6SXNzdWUxNTQ5OTY0OTg=","number":18369,"title":"Query string and boolean operator (AND, OR) not working as expected","user":{"login":"sterchelen","id":17292393,"node_id":"MDQ6VXNlcjE3MjkyMzkz","avatar_url":"https://avatars2.githubusercontent.com/u/17292393?v=4","gravatar_id":"","url":"https://api.github.com/users/sterchelen","html_url":"https://github.com/sterchelen","followers_url":"https://api.github.com/users/sterchelen/followers","following_url":"https://api.github.com/users/sterchelen/following{/other_user}","gists_url":"https://api.github.com/users/sterchelen/gists{/gist_id}","starred_url":"https://api.github.com/users/sterchelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sterchelen/subscriptions","organizations_url":"https://api.github.com/users/sterchelen/orgs","repos_url":"https://api.github.com/users/sterchelen/repos","events_url":"https://api.github.com/users/sterchelen/events{/privacy}","received_events_url":"https://api.github.com/users/sterchelen/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-05-16T09:51:34Z","updated_at":"2016-05-20T09:28:43Z","closed_at":"2016-05-20T09:28:35Z","author_association":"NONE","active_lock_reason":null,"body":"Hello everyone,\n\nI try to run a simple query string like that :\n\n```\n{\n   \"query\": {\n      \"query_string\": {\n         \"fields\": [\n            \"newsitem.itemdetails.fulltext\",\n            \"newsitem.itemdetails.headline\"\n         ],\n         \"query\": \"(alzheimer AND apple) OR \\\"Bruno Dubois\\\"\",\n         \"analyzer\": \"docAnalyzer\"\n      }\n   },\n   \"highlight\": {\n      \"fields\": {\n         \"newsitem.itemdetails.fulltext\": {\n            \"number_of_fragments\": \"0\"\n         },\n         \"newsitem.itemdetails.headline\": {\n            \"number_of_fragments\": \"0\"\n         }\n      },\n      \"pre_tags\": [\n         \"<test>\"\n      ],\n      \"post_tags\": [\n         \"</test>\"\n      ]\n   }\n}\n```\n\nI expect to get only documents who alzheimer and apple is present and \"Bruno Dubois\" should be present.\nWhat I'm getting, is highlights with alzheimer whereas apple is not present in the text ... It's quite confusing.\n\nHere is my settings + mapping :\n\n```\nPUT _template/kmcloud_test\n{\n   \"order\": 0,\n   \"template\": \"kmcloud_test_*\",\n   \"settings\": {\n      \"index\": {\n         \"number_of_replicas\": \"2\",\n         \"analysis\": {\n            \"filter\": {\n               \"elision\": {\n                  \"type\": \"elision\",\n                  \"articles\": [\n                     \"l\",\n                     \"m\",\n                     \"t\",\n                     \"qu\",\n                     \"n\",\n                     \"s\",\n                     \"j\",\n                     \"d\"\n                  ]\n               }\n            },\n            \"analyzer\": {\n               \"docAnalyzer\": {\n                  \"type\": \"custom\",\n                  \"filter\": [\n                     \"lowercase\",\n                     \"asciifolding\",\n                     \"elision\"\n                  ],\n                        \"tokenizer\": \"doc_tokenizer\"\n               },\n               \"casesensitive_analyzer\": {\n                  \"type\": \"custom\",\n                  \"tokenizer\": \"standard\"\n               }\n            },\n            \"tokenizer\": {\n               \"doc_tokenizer\": {\n                  \"type\": \"pattern\",\n                  \"pattern\": \"\\\\s+|\\\\.$|\\\\.+\\\\s+|,|;|:|!|\\\\}|\\\\{|\\\\(|\\\\)|\\\\?|â€™|\\\\'|\\\\/|@\"\n               }\n            }\n         },\n         \"number_of_shards\": \"3\",\n         \"index\": {\n            \"mapper\": {\n               \"dynamic\": \"false\"\n            }\n         }\n      }\n   },\n   \"mappings\": {\n      \"kmcloud_test\": {\n         \"dynamic\": \"strict\",\n         \"properties\": {\n            \"indexingdate\": {\n               \"format\": \"dateOptionalTime\",\n               \"type\": \"date\"\n            },\n            \"sendingdate\": {\n               \"format\": \"dateOptionalTime\",\n               \"type\": \"date\"\n            },\n            \"newsitem\": {\n               \"properties\": {\n                  \"itemdetails\": {\n                     \"properties\": {\n                        \"translatedheadline\": {\n                           \"properties\": {\n                              \"value\": {\n                                 \"index\": \"not_analyzed\",\n                                 \"type\": \"string\"\n                              },\n                              \"languageisocode\": {\n                                 \"index\": \"not_analyzed\",\n                                 \"type\": \"string\"\n                              }\n                           }\n                        },\n                        \"headline\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"docAnalyzer\",\n                           \"fields\": {\n                              \"cs\": {\n                                 \"analyzer\": \"casesensitive_analyzer\",\n                                 \"type\": \"string\"\n                              }\n                           }\n                        },\n                        \"originalurl\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"wordcount\": {\n                           \"type\": \"integer\"\n                        },\n                        \"articletype\": {\n                           \"type\": \"integer\"\n                        },\n                        \"pagelist\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"author\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"imdurl\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"pagecount\": {\n                           \"type\": \"integer\"\n                        },\n                        \"retriurl\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"tweetparentid\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"numberofretweet\": {\n                           \"type\": \"integer\"\n                        },\n                        \"itemfilenames\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"itemkey\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"fulltext200\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"docAnalyzer\",\n                           \"fields\": {\n                              \"cs\": {\n                                 \"analyzer\": \"casesensitive_analyzer\",\n                                 \"type\": \"string\"\n                              }\n                           }\n                        },\n                        \"ave\": {\n                           \"type\": \"integer\"\n                        },\n                        \"fulltext\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"docAnalyzer\",\n                           \"fields\": {\n                              \"cs\": {\n                                 \"analyzer\": \"casesensitive_analyzer\",\n                                 \"type\": \"string\"\n                              }\n                           }\n                        },\n                        \"languageisocode\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"abstract\": {\n                           \"properties\": {\n                              \"value\": {\n                                 \"index\": \"not_analyzed\",\n                                 \"type\": \"string\"\n                              },\n                              \"languageisocode\": {\n                                 \"index\": \"not_analyzed\",\n                                 \"type\": \"string\"\n                              }\n                           }\n                        },\n                        \"nlaobjectid\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"keywords\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"urls\": {\n                           \"properties\": {\n                              \"urltype\": {\n                                 \"index\": \"not_analyzed\",\n                                 \"type\": \"string\"\n                              },\n                              \"value\": {\n                                 \"index\": \"not_analyzed\",\n                                 \"ignore_above\": 1000,\n                                 \"type\": \"string\"\n                              }\n                           },\n                           \"type\": \"nested\"\n                        },\n                        \"fulltext100\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"docAnalyzer\",\n                           \"fields\": {\n                              \"cs\": {\n                                 \"analyzer\": \"casesensitive_analyzer\",\n                                 \"type\": \"string\"\n                              }\n                           }\n                        },\n                        \"fulltext300\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"docAnalyzer\",\n                           \"fields\": {\n                              \"cs\": {\n                                 \"analyzer\": \"casesensitive_analyzer\",\n                                 \"type\": \"string\"\n                              }\n                           }\n                        },\n                        \"header\": {\n                           \"type\": \"string\",\n                           \"analyzer\": \"docAnalyzer\",\n                           \"fields\": {\n                              \"cs\": {\n                                 \"analyzer\": \"casesensitive_analyzer\",\n                                 \"type\": \"string\"\n                              }\n                           }\n                        },\n                        \"headlinesearch\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"interviewtype\": {\n                           \"type\": \"integer\"\n                        },\n                        \"geolocalisation\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        },\n                        \"itemranking\": {\n                           \"type\": \"integer\"\n                        },\n                        \"typeoftweet\": {\n                           \"index\": \"not_analyzed\",\n                           \"type\": \"string\"\n                        }\n                     }\n                  }\n               }\n            }\n         },\n         \"_all\": {\n            \"enabled\": false\n         }\n      }\n   },\n   \"aliases\": {\n      \"kmcloud_test\": {}\n   }\n}\n```\n\nDocument :\n\n```\n\n{\n    \"indexingdate\": \"2016-05-13T07:28:39.6555239+02:00\",\n    \"supplier\": {\n        \"suppliername\": \"FRANCE ACTU REGION\",\n        \"supplierkey\": \"FAR\"\n    },\n    \"newsitem\": {\n        \"customerkey\": {\n            \"disableindexation\": false\n        },\n        \"publicationdetails\": {\n            \"media\": \"Press Publication\",\n            \"publicationkey\": \"146571\",\n            \"globalpublicationkey\": \"42398\",\n            \"publicationdate\": \"2016-05-13T00:00:00\",\n            \"publicationname\": \"ProgrÃ¨s [Le] - Oyonnax â€“ LÃ©man â€“ Bugey â€“ Bas-Bugey\",\n            \"supplementname\": \"\",\n            \"countryisocode\": \"FR\",\n            \"sector\": \"\",\n            \"avatar\": \"\"\n        },\n        \"itemdetails\": {\n            \"itemkey\": \"303512345\",\n            \"headline\": \"Une Ã©cole de tennis\",\n            \"header\": \"\",\n            \"translatedheadline\": {\n                \"languageisocode\": \"EN\",\n                \"value\": \"\"\n            },\n            \"abstract\": {\n                \"languageisocode\": \"fr\",\n                \"value\": \"\"\n            },\n            \"fulltext\": \"Une Ã©cole de tennis existe aussi et Alzheimer une vingtaine dâ€™enfants pratique cette discipline. Â«Â â€‰Concernant lâ€™Ã©cole, nous minimisons le groupe car nous souhaitons former en privilÃ©giant la qualitÃ© \nde lâ€™enseignementâ€‰Â Â», explique Bruno Dubois.\",\n            \"fulltext100\": \"Une Ã©cole de tennis existe aussi et une vingtaine dâ€™enfants pratique cette discipline. Â«Â â€‰Concernant lâ€™Ã©cole, nous minimisons le groupe car nous souhaitons former en privilÃ©giant la \nqualitÃ© de lâ€™enseignementâ€‰Â Â», explique Bruno Dubois.\",\n            \"fulltext200\": \"Une Ã©cole de tennis existe aussi et une vingtaine dâ€™enfants pratique cette discipline. Â«Â â€‰Concernant lâ€™Ã©cole, nous minimisons le groupe car nous souhaitons former en privilÃ©giant la \nqualitÃ© de lâ€™enseignementâ€‰Â Â», explique Bruno Dubois.\",\n            \"fulltext300\": \"Une Ã©cole de tennis existe aussi et une vingtaine dâ€™enfants pratique cette discipline. Â«Â â€‰Concernant lâ€™Ã©cole, nous minimisons le groupe car nous souhaitons former en privilÃ©giant la \nqualitÃ© de lâ€™enseignementâ€‰Â Â», explique Bruno Dubois.\",\n            \"itemfilenames\": [\"\"],\n            \"originalurl\": \"\",\n            \"keywords\": [\"\"],\n            \"languageisocode\": \"fr\",\n            \"author\": \"\",\n            \"pagelist\": \"\",\n            \"typeoftweet\": \"\",\n            \"tweetparentid\": \"\",\n            \"numberofretweet\": 0,\n            \"geolocalisation\": \"\",\n            \"urls\": [],\n            \"imdurl\": \"\",\n            \"retriurl\": \"\",\n            \"nlaobjectid\": \"\"\n        }\n    }\n}\n```\n\nThank you.\n\nNicolas.\n","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}