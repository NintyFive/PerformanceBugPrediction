{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24361","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24361/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24361/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24361/events","html_url":"https://github.com/elastic/elasticsearch/issues/24361","id":224733137,"node_id":"MDU6SXNzdWUyMjQ3MzMxMzc=","number":24361,"title":"Elasticsearch hangs if a NFS mount point is stale","user":{"login":"dineshpathak","id":1397912,"node_id":"MDQ6VXNlcjEzOTc5MTI=","avatar_url":"https://avatars0.githubusercontent.com/u/1397912?v=4","gravatar_id":"","url":"https://api.github.com/users/dineshpathak","html_url":"https://github.com/dineshpathak","followers_url":"https://api.github.com/users/dineshpathak/followers","following_url":"https://api.github.com/users/dineshpathak/following{/other_user}","gists_url":"https://api.github.com/users/dineshpathak/gists{/gist_id}","starred_url":"https://api.github.com/users/dineshpathak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dineshpathak/subscriptions","organizations_url":"https://api.github.com/users/dineshpathak/orgs","repos_url":"https://api.github.com/users/dineshpathak/repos","events_url":"https://api.github.com/users/dineshpathak/events{/privacy}","received_events_url":"https://api.github.com/users/dineshpathak/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-04-27T09:59:44Z","updated_at":"2017-04-28T13:44:27Z","closed_at":"2017-04-28T12:19:28Z","author_association":"NONE","active_lock_reason":null,"body":"We are running ES 2.0 on a system which has some stale NFS mount points also, but the data directory given to ES is on HDD only. Seems ES on start tries to figure out whether the device containing data directory spins or not and the underlying java API iterates over all the available mount points and issues a stat call. Since this NFS mount point is stale, ES hangs for sometime and then crashes and this keeps on happening. \r\nOn linux systems, it can query /proc/self/mounts or do a mount | grep <mountpoint> or a parameter can be taken from user in data.path config to say if this device spins or not.\r\n\r\nBelow is the stack of main thread in hung state.\r\n\r\n\"main\" #1 prio=5 os_prio=0 tid=0x00007fc5d000a800 nid=0xce9f runnable [0x00007fc5d82d8000]\r\n   java.lang.Thread.State: RUNNABLE\r\n        at sun.nio.fs.UnixNativeDispatcher.stat0(Native Method)\r\n        at sun.nio.fs.UnixNativeDispatcher.stat(UnixNativeDispatcher.java:286)\r\n        at sun.nio.fs.UnixFileAttributes.get(UnixFileAttributes.java:70)\r\n        at sun.nio.fs.UnixFileStore.devFor(UnixFileStore.java:55)\r\n        at sun.nio.fs.UnixFileStore.<init>(UnixFileStore.java:70)\r\n        at sun.nio.fs.LinuxFileStore.<init>(LinuxFileStore.java:48)\r\n        at sun.nio.fs.LinuxFileSystem.getFileStore(LinuxFileSystem.java:112)\r\n        at sun.nio.fs.UnixFileSystem$FileStoreIterator.readNext(UnixFileSystem.java:213)\r\n        at sun.nio.fs.UnixFileSystem$FileStoreIterator.hasNext(UnixFileSystem.java:224)\r\n        - locked <0x000000070058a288> (a sun.nio.fs.UnixFileSystem$FileStoreIterator)\r\n        at org.apache.lucene.util.IOUtils.getFileStore(IOUtils.java:534)\r\n        at org.apache.lucene.util.IOUtils.spinsLinux(IOUtils.java:483)\r\n        at org.apache.lucene.util.IOUtils.spins(IOUtils.java:472)\r\n        at org.elasticsearch.env.ESFileStore.<init>(ESFileStore.java:57)\r\n        at org.elasticsearch.env.Environment.<clinit>(Environment.java:88)\r\n        at org.elasticsearch.node.internal.InternalSettingsPreparer.prepareEnvironment(InternalSettingsPreparer.java:82)\r\n        at org.elasticsearch.common.cli.CliTool.<init>(CliTool.java:107)\r\n        at org.elasticsearch.common.cli.CliTool.<init>(CliTool.java:100)\r\n        at org.elasticsearch.bootstrap.BootstrapCLIParser.<init>(BootstrapCLIParser.java:48)\r\n        at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:226)","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}