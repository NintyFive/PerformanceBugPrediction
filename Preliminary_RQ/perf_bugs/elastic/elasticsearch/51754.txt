{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/51754","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51754/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51754/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/51754/events","html_url":"https://github.com/elastic/elasticsearch/issues/51754","id":558226844,"node_id":"MDU6SXNzdWU1NTgyMjY4NDQ=","number":51754,"title":"HELP!  ES 7.4 Search performance is much slow than ES 5.5","user":{"login":"taoyantu","id":13854732,"node_id":"MDQ6VXNlcjEzODU0NzMy","avatar_url":"https://avatars3.githubusercontent.com/u/13854732?v=4","gravatar_id":"","url":"https://api.github.com/users/taoyantu","html_url":"https://github.com/taoyantu","followers_url":"https://api.github.com/users/taoyantu/followers","following_url":"https://api.github.com/users/taoyantu/following{/other_user}","gists_url":"https://api.github.com/users/taoyantu/gists{/gist_id}","starred_url":"https://api.github.com/users/taoyantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/taoyantu/subscriptions","organizations_url":"https://api.github.com/users/taoyantu/orgs","repos_url":"https://api.github.com/users/taoyantu/repos","events_url":"https://api.github.com/users/taoyantu/events{/privacy}","received_events_url":"https://api.github.com/users/taoyantu/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-01-31T16:16:50Z","updated_at":"2020-01-31T17:06:35Z","closed_at":"2020-01-31T17:06:35Z","author_association":"NONE","active_lock_reason":null,"body":"We currently use the ES 5.5 version and plan to upgrade to the ES 7.4 version.\r\n\r\nI deployed two environments,use the same server , 88 core cpu , 256G memory , the cluster have 3 servers, each server starts 3 nodes, the cluster has a total of 9 nodes.\r\n\r\njvm is configured to 30G, others use the default configuration\r\n\r\nI used jmeter to write the same data to the cluster,index with 9 shards and 1 replcate. The amount of data is 300G.\r\n\r\nWhen executing the query, the ES 7.4  result took a lot larger than the ES 5.5 , and the ES 7.4 server's io is also very large, there are a lot of disk read conditions.\r\n\r\nQuery like:\r\n{\r\n    \"size\": 0,\r\n    \"query\": {\r\n        \"bool\": {\r\n            \"filter\": [{\r\n                    \"term\": {\r\n                        \"aaa\": \"bbb\"\r\n                    }\r\n                }, {\r\n                    \"range\": {\r\n                        \"@timestamp\": {\r\n                            \"gte\": \"1576117714282\",\r\n                            \"lte\": \"1576118614282\"\r\n                        }\r\n                    }\r\n                }\r\n            ], \"Must_not\": [{\r\n                    \"terms\": {\r\n                        \"bizcode\": [\"00000000\"]\r\n                    }\r\n                }\r\n            ]\r\n        }\r\n    },\r\n    \"aggs\": {\r\n        \"distribution\": {\r\n            \"terms\": {\r\n                \"field\": \"payer\",\r\n                \"size\": 10,\r\n                \"order\": {\r\n                    \"_count\": \"desc\"\r\n                }\r\n            }\r\n        },\r\n        \"aggs\": {\r\n            \"distribution2\": {\r\n                \"terms\": {\r\n                    \"field\": \"from\",\r\n                    \"size\": 10,\r\n                    \"order\": {\r\n                        \"_count\": \"desc\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nWhat is the cause of this problem? Are there any changes to the query in ES 7.4?","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}