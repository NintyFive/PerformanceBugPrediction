{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/12201","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12201/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12201/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/12201/events","html_url":"https://github.com/elastic/elasticsearch/issues/12201","id":94665875,"node_id":"MDU6SXNzdWU5NDY2NTg3NQ==","number":12201,"title":"Performance Issue when using ~ operator with Query String Query - ES 1.6","user":{"login":"effoeffi","id":7524834,"node_id":"MDQ6VXNlcjc1MjQ4MzQ=","avatar_url":"https://avatars1.githubusercontent.com/u/7524834?v=4","gravatar_id":"","url":"https://api.github.com/users/effoeffi","html_url":"https://github.com/effoeffi","followers_url":"https://api.github.com/users/effoeffi/followers","following_url":"https://api.github.com/users/effoeffi/following{/other_user}","gists_url":"https://api.github.com/users/effoeffi/gists{/gist_id}","starred_url":"https://api.github.com/users/effoeffi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/effoeffi/subscriptions","organizations_url":"https://api.github.com/users/effoeffi/orgs","repos_url":"https://api.github.com/users/effoeffi/repos","events_url":"https://api.github.com/users/effoeffi/events{/privacy}","received_events_url":"https://api.github.com/users/effoeffi/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-07-13T08:29:16Z","updated_at":"2015-07-13T08:44:50Z","closed_at":"2015-07-13T08:44:50Z","author_association":"NONE","active_lock_reason":null,"body":"Hello,\n\nWhen running a query like:\n\n``` json\nPOST /my-index/_search\n{\n  \"from\" : 0,\n  \"size\" : 5,\n  \"query\" : {\n      \"query_string\" : {\n      \"fields\" : [\"field1\",\"field2\",...,\"fieldn\"],\n      \"query\" : \"flight~\",\n      \"use_dis_max\" : true\n    }\n  },\n  \"highlight\" : {\n    \"pre_tags\" : [ \"<span class=\\\"mark\\\">\" ],\n    \"post_tags\" : [ \"</span>\" ],\n    \"order\" : \"score\",\n    \"encoder\" : \"html\",\n    \"require_field_match\" : true,\n    \"fields\" : {    \n      \"*\" : {}\n    }\n  }\n}\n```\n\nquery_string contains n fields (in my case about 40 fields), and query contains ~ operator (in the example flight~), takes about 6 seconds.\nIf I run the same query (flight~), but remove the fields section from query_string section, it takes 10 milliseconds (no time).\n\nWhy does it happen?\nIs there a solution for this performance penalty (I have to determine specific fields into _query_string_ in order to solve highlight issue, see below)?\n\n**Background:**\nUsing elasticsearch 1.6.\nRun it on index that contains 1000 documents.\nDetermine specific fields into _query_string_ in order to solve follow highlight issue:\nhttps://discuss.elastic.co/t/highlight-when-query-contains-fields-and-text-es-1-6-0/24311/5\n\nThanks,\nEffi\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}