{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/23084","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23084/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23084/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/23084/events","html_url":"https://github.com/elastic/elasticsearch/issues/23084","id":206594260,"node_id":"MDU6SXNzdWUyMDY1OTQyNjA=","number":23084,"title":"Deadlock when index.translog.sync_interval: 99999s","user":{"login":"avleen","id":539525,"node_id":"MDQ6VXNlcjUzOTUyNQ==","avatar_url":"https://avatars1.githubusercontent.com/u/539525?v=4","gravatar_id":"","url":"https://api.github.com/users/avleen","html_url":"https://github.com/avleen","followers_url":"https://api.github.com/users/avleen/followers","following_url":"https://api.github.com/users/avleen/following{/other_user}","gists_url":"https://api.github.com/users/avleen/gists{/gist_id}","starred_url":"https://api.github.com/users/avleen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avleen/subscriptions","organizations_url":"https://api.github.com/users/avleen/orgs","repos_url":"https://api.github.com/users/avleen/repos","events_url":"https://api.github.com/users/avleen/events{/privacy}","received_events_url":"https://api.github.com/users/avleen/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-02-09T18:46:53Z","updated_at":"2017-02-09T19:14:52Z","closed_at":"2017-02-09T19:10:55Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.4.4\r\n\r\n**Plugins installed**: delete-by-query, mapper-size\r\n\r\n**JVM version**: Oracle JDK 1.8.0_60\r\n\r\n**OS version**: CentOS 7.3\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nAccepting that this increases the potential for data loss, we wanted to try and disable the translog flush, for performance reasons.\r\nWe can't actually disable it, so we set it to 99999s, and the size to 1Gb.\r\nWe have a 32Gb heap and there should be plenty of room for the extra data.\r\nAfter a few minutes of running, the node mostly stops processing data, except for maybe we very small trickle.\r\n\r\nData is log lines coming from Logstash and we see the bulk thread pull maxed out, as well as the bulk queue. Neither number moves.\r\n\r\n**Steps to reproduce**:\r\n 1. Close all indices\r\n 2.\r\n```\r\ncurl -XPUT 'localhost:9200/_all/_settings' -d '{\r\n  \"settings\": {\r\n    \"index.translog.durability\": \"async\",\r\n    \"index.translog.sync_interval\": \"99999s\"\r\n  }\r\n}'\r\n```\r\n 3. Ship large amounts of logs.\r\n\r\n**Provide logs (if relevant)**:\r\nThe output of hot_threads?threads=20 for this host is available here:\r\nhttps://gist.github.com/avleen/640903a62ad422fe5b4997a198d0c85b\r\n\r\nThe thread dump is available here:\r\nhttps://gist.github.com/avleen/859a36980c580d5ec1b90c1af8074185","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}