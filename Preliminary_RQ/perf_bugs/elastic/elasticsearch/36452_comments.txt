[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446099948","html_url":"https://github.com/elastic/elasticsearch/issues/36452#issuecomment-446099948","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36452","id":446099948,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjA5OTk0OA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-12-11T07:29:33Z","updated_at":"2018-12-11T07:29:33Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446121927","html_url":"https://github.com/elastic/elasticsearch/issues/36452#issuecomment-446121927","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36452","id":446121927,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjEyMTkyNw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-12-11T08:55:22Z","updated_at":"2018-12-11T08:55:22Z","author_association":"MEMBER","body":"@melissachang I tried a recreation in 6.4 with the information you gave (7K fields and a few of them per document) and highlighting was fast. We added a [shortcut](https://github.com/elastic/elasticsearch/pull/32090) in this version to bypass fields that don't appear in the document when highlighting so I guess that you're using a version without this enhancement.\r\nHowever the issue with lot of fields should not affect the `plain` and `fvh` highlighter so I am not sure if this is what caused the slow queries in your case. Are you sure that the timings you reported are not all linked to the `unified` highlighter. I tried the same recreation in 6.3.2 and the query took several minutes to complete but the other highlighters responded in less than a second.\r\nCould you please provide us with the version you used in your tests and check if the new (6.5) solved your issue ?\r\nI am also a bit sad when I see the title of your issue, we try our best to provide tools that can be used for various use cases so when something isn't working as you want it is probably a bug or something wrong in your configuration (using 7k fields doesn't help here ;) ). Can you change the title to reflect the real issue here ? Highlighting is slow on mappings with thousands of fields, this is a bug that we hope we fixed in 6.4 for the `unified` highlighter but again since it shouldn't affect the other highlighters I suspect that something else is at play here so we'll need more informations. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446342280","html_url":"https://github.com/elastic/elasticsearch/issues/36452#issuecomment-446342280","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36452","id":446342280,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjM0MjI4MA==","user":{"login":"melissachang","id":10929390,"node_id":"MDQ6VXNlcjEwOTI5Mzkw","avatar_url":"https://avatars1.githubusercontent.com/u/10929390?v=4","gravatar_id":"","url":"https://api.github.com/users/melissachang","html_url":"https://github.com/melissachang","followers_url":"https://api.github.com/users/melissachang/followers","following_url":"https://api.github.com/users/melissachang/following{/other_user}","gists_url":"https://api.github.com/users/melissachang/gists{/gist_id}","starred_url":"https://api.github.com/users/melissachang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/melissachang/subscriptions","organizations_url":"https://api.github.com/users/melissachang/orgs","repos_url":"https://api.github.com/users/melissachang/repos","events_url":"https://api.github.com/users/melissachang/events{/privacy}","received_events_url":"https://api.github.com/users/melissachang/received_events","type":"User","site_admin":false},"created_at":"2018-12-11T20:02:59Z","updated_at":"2018-12-11T20:02:59Z","author_association":"NONE","body":"Apologies, it didn't occur to me to file a bug report instead of a feature request. (And because I was using the feature request template, I didn't include Elasticsearch version.) I am using the docker image  docker.elastic.co/elasticsearch/elasticsearch-oss:6.2.2. I am trying 6.5.3 now. I'll update this issue afterwards.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/446415610","html_url":"https://github.com/elastic/elasticsearch/issues/36452#issuecomment-446415610","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36452","id":446415610,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjQxNTYxMA==","user":{"login":"melissachang","id":10929390,"node_id":"MDQ6VXNlcjEwOTI5Mzkw","avatar_url":"https://avatars1.githubusercontent.com/u/10929390?v=4","gravatar_id":"","url":"https://api.github.com/users/melissachang","html_url":"https://github.com/melissachang","followers_url":"https://api.github.com/users/melissachang/followers","following_url":"https://api.github.com/users/melissachang/following{/other_user}","gists_url":"https://api.github.com/users/melissachang/gists{/gist_id}","starred_url":"https://api.github.com/users/melissachang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/melissachang/subscriptions","organizations_url":"https://api.github.com/users/melissachang/orgs","repos_url":"https://api.github.com/users/melissachang/repos","events_url":"https://api.github.com/users/melissachang/events{/privacy}","received_events_url":"https://api.github.com/users/melissachang/received_events","type":"User","site_admin":false},"created_at":"2018-12-12T00:29:11Z","updated_at":"2018-12-12T00:43:43Z","author_association":"NONE","body":"(I realized when I was searching for similar issues, I came across [#34015 Leverage the Lucene's Matches API in a new highlighter type](https://github.com/elastic/elasticsearch/issues/34015), which influenced me to create a feature request for new highlighter type.)\r\n\r\nWith 6.5.3:\r\nunified - Gave up after 4 mins\r\nplain - Worked after 4 mins 15 sec. No logs from elasticsearch.\r\nfvh - Haven't tried yet, haven't reindexed with necessary flags.\r\n\r\nUnfortunately my data is private. I'll try to find similar public data and repro. I'll let you know if I do.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/452936500","html_url":"https://github.com/elastic/elasticsearch/issues/36452#issuecomment-452936500","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36452","id":452936500,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MjkzNjUwMA==","user":{"login":"melissachang","id":10929390,"node_id":"MDQ6VXNlcjEwOTI5Mzkw","avatar_url":"https://avatars1.githubusercontent.com/u/10929390?v=4","gravatar_id":"","url":"https://api.github.com/users/melissachang","html_url":"https://github.com/melissachang","followers_url":"https://api.github.com/users/melissachang/followers","following_url":"https://api.github.com/users/melissachang/following{/other_user}","gists_url":"https://api.github.com/users/melissachang/gists{/gist_id}","starred_url":"https://api.github.com/users/melissachang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/melissachang/subscriptions","organizations_url":"https://api.github.com/users/melissachang/orgs","repos_url":"https://api.github.com/users/melissachang/repos","events_url":"https://api.github.com/users/melissachang/events{/privacy}","received_events_url":"https://api.github.com/users/melissachang/received_events","type":"User","site_admin":false},"created_at":"2019-01-10T01:31:16Z","updated_at":"2019-01-10T01:31:16Z","author_association":"NONE","body":"Unfortunately I wasn't able to create a index that reproduces this problem.\r\n\r\nHere are some properties of my index:\r\n```\r\nbash-4.4# curl \"localhost:9200/_cat/indices?v&s=index\"\r\nhealth status index                       uuid                   pri rep docs.count docs.deleted store.size pri.store.size\r\ngreen  open   nurse_s_health_study        FxMn0ugWQ9G3vhM4agzfHw   5   1     121701            0     11.2gb          5.3gb\r\n```\r\nAcross all documents, there are a total of 6624 fields. ~4k of the fields are string (as opposed to numeric). A single document may have 2k fields, give or take.\r\n\r\nIf anyone comes across a similar index, please try out the above queries.\r\n\r\nI work on a tool that indexes Google BigQuery tables. If anyone comes across a public BigQuery table with the above properties (> 6k columns, > 120k rows), I'm happy to run my indexer and try to repro this bug.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/479830589","html_url":"https://github.com/elastic/elasticsearch/issues/36452#issuecomment-479830589","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36452","id":479830589,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3OTgzMDU4OQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-04-04T09:51:38Z","updated_at":"2019-04-04T09:51:38Z","author_association":"MEMBER","body":"As explained in this [comment](https://github.com/elastic/elasticsearch/issues/36452#issuecomment-446121927) we have a shortcut to bypass highlighting if the field is empty or null in the current document. I tried to reproduce the slow query in >6.4 and it responded in less than a second so I think that something else is at play in your setup. I am going to close this issue but we can revisit if you provide a clear reproduction since the example in the description should be fixed by  https://github.com/elastic/elasticsearch/pull/32090.","performed_via_github_app":null}]