{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/36338","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36338/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36338/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/36338/events","html_url":"https://github.com/elastic/elasticsearch/issues/36338","id":388421562,"node_id":"MDU6SXNzdWUzODg0MjE1NjI=","number":36338,"title":"Upgrading from 6.1.2 to 6.5.1 indexing performance drop 40%","user":{"login":"luann-trend","id":36053673,"node_id":"MDQ6VXNlcjM2MDUzNjcz","avatar_url":"https://avatars1.githubusercontent.com/u/36053673?v=4","gravatar_id":"","url":"https://api.github.com/users/luann-trend","html_url":"https://github.com/luann-trend","followers_url":"https://api.github.com/users/luann-trend/followers","following_url":"https://api.github.com/users/luann-trend/following{/other_user}","gists_url":"https://api.github.com/users/luann-trend/gists{/gist_id}","starred_url":"https://api.github.com/users/luann-trend/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luann-trend/subscriptions","organizations_url":"https://api.github.com/users/luann-trend/orgs","repos_url":"https://api.github.com/users/luann-trend/repos","events_url":"https://api.github.com/users/luann-trend/events{/privacy}","received_events_url":"https://api.github.com/users/luann-trend/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2018-12-06T22:16:20Z","updated_at":"2019-02-13T09:26:49Z","closed_at":"2019-02-13T09:26:41Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`):\r\n\r\n6.5.1\r\n\r\n**Plugins installed**: []\r\n\r\nrepository-gcs\r\n\r\nand disable all x-pack features\r\n\r\nxpack.security.enabled: false\r\nxpack.watcher.enabled: false\r\nxpack.ml.enabled: false\r\nxpack.monitoring.enabled: false\r\nxpack.graph.enabled: false\r\nxpack.rollup.enabled: false\r\nxpack.logstash.enabled: false\r\n\r\n**JVM version** (`java -version`):\r\nUsing docker image from docker.elastic.co/elasticsearch/elasticsearch:6.5.1\r\n\r\n**OS version** (`uname -a` if on a Unix-like system):\r\nUsing docker image, uname -a give this info\r\n\r\nLinux es-data-hot-0 4.14.56+ #1 SMP Sat Aug 11 23:13:59 PDT 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nIndex performance drop significant when upgrading from ES 6.1.2 to 6.5.1\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n Running the indexing performance test with the following setup \r\n\r\n- Elasticsearch cluster with 10 hot data nodes and 3 warm nodes, 1 replica, 10 shards, container start with 32G of memory\r\n- Each hot node is individual VM with \"High memory machine type with 8 vCPUs and 52 GB of memory.\"\r\n- \"settings\": {\r\n    \"index\": {\r\n      \"number_of_shards\": 10,\r\n      \"number_of_replicas\": 1,\r\n      \"refresh_interval\": \"60s\",\r\n      \"routing.allocation.require.box_type\": \"hot\",\r\n      \"translog\": {\r\n        \"durability\": \"async\",\r\n        \"sync_interval\": \"10s\",\r\n        \"flush_threshold_size\": \"1gb\"\r\n      }\r\n     }\r\n  }\r\n\r\n- JVM options:\r\n-Xms24G \r\n-Xmx24G\r\n-XX:+UseG1GC\r\n-XX:MaxGCPauseMillis=400\r\n\r\nThe same configuration on 6.1.2 except for JVM \r\n-Xms24G \r\n-Xmx24G\r\n-XX:+UseConcMarkSweepGC\r\n-XX:CMSInitiatingOccupancyFraction=75\r\n-XX:+UseCMSInitiatingOccupancyOnly\r\n\r\n***Notes: if using the same JVM of 6.1.2 for 6.5.1 the performance get even worst.\r\n\r\nPlease see ES 6.1.2 vs 6.5.1 Documents Indexed Rates from the graphs\r\n\r\n![6 1 2indexingperformance](https://user-images.githubusercontent.com/36053673/49615073-6b84ed00-f97a-11e8-94ec-9e3fecadb8ec.png)\r\n\r\n![6 5 1indexingperformance](https://user-images.githubusercontent.com/36053673/49615108-7f305380-f97a-11e8-93a1-8a7551c42cc7.png)\r\n","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}