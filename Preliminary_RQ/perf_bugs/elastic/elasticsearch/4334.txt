{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/4334","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4334/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4334/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/4334/events","html_url":"https://github.com/elastic/elasticsearch/issues/4334","id":23691904,"node_id":"MDU6SXNzdWUyMzY5MTkwNA==","number":4334,"title":"Node deadlock on shutdown","user":{"login":"aganapat","id":5826509,"node_id":"MDQ6VXNlcjU4MjY1MDk=","avatar_url":"https://avatars2.githubusercontent.com/u/5826509?v=4","gravatar_id":"","url":"https://api.github.com/users/aganapat","html_url":"https://github.com/aganapat","followers_url":"https://api.github.com/users/aganapat/followers","following_url":"https://api.github.com/users/aganapat/following{/other_user}","gists_url":"https://api.github.com/users/aganapat/gists{/gist_id}","starred_url":"https://api.github.com/users/aganapat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aganapat/subscriptions","organizations_url":"https://api.github.com/users/aganapat/orgs","repos_url":"https://api.github.com/users/aganapat/repos","events_url":"https://api.github.com/users/aganapat/events{/privacy}","received_events_url":"https://api.github.com/users/aganapat/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":65649829,"node_id":"MDU6TGFiZWw2NTY0OTgyOQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.90.8","name":"v0.90.8","color":"DDDDDD","default":false,"description":null},{"id":63637703,"node_id":"MDU6TGFiZWw2MzYzNzcwMw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v1.0.0.RC1","name":"v1.0.0.RC1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"assignees":[{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2013-12-04T03:16:55Z","updated_at":"2013-12-23T02:06:16Z","closed_at":"2013-12-15T03:13:44Z","author_association":"NONE","active_lock_reason":null,"body":"ES Version: 0.90.7, Java version: 1.7 update 45 64 bit Server VM.\n\nI have a 7 node cluster with 5 master nodes and 2 client nodes. \nWhen I was shutting down all nodes to do a full cluster restart, one node did not die and looks there is a deadlock.\n\nStack Trace:\n\n2013-12-03 22:07:50\nFull thread dump Java HotSpot(TM) 64-Bit Server VM (24.45-b08 mixed mode):\n\n\"Attach Listener\" daemon prio=10 tid=0x00007f8ed4028000 nid=0x5d32 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Thread-1\" prio=10 tid=0x00007f8e88698000 nid=0x5c6e waiting on condition [0x00007f8e7e861000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.awaitTermination(ThreadPoolExecutor.java:1461)\n    at org.elasticsearch.threadpool.ThreadPool.awaitTermination(ThreadPool.java:249)\n    at org.elasticsearch.node.internal.InternalNode.close(InternalNode.java:342)\n    at org.elasticsearch.bootstrap.Bootstrap$1.run(Bootstrap.java:73)\n\n\"SIGTERM handler\" daemon prio=10 tid=0x00007f8ed4042000 nid=0x5c6b in Object.wait() [0x00007f8ee7915000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on <0x00000005fd3d76c8> (a org.elasticsearch.bootstrap.Bootstrap$1)\n    at java.lang.Thread.join(Thread.java:1280)\n    - locked <0x00000005fd3d76c8> (a org.elasticsearch.bootstrap.Bootstrap$1)\n    at java.lang.Thread.join(Thread.java:1354)\n    at java.lang.ApplicationShutdownHooks.runHooks(ApplicationShutdownHooks.java:106)\n    at java.lang.ApplicationShutdownHooks$1.run(ApplicationShutdownHooks.java:46)\n    at java.lang.Shutdown.runHooks(Shutdown.java:123)\n    at java.lang.Shutdown.sequence(Shutdown.java:167)\n    at java.lang.Shutdown.exit(Shutdown.java:212)\n    - locked <0x00000005fd340058> (a java.lang.Class for java.lang.Shutdown)\n    at java.lang.Terminator$1.handle(Terminator.java:52)\n    at sun.misc.Signal$1.run(Signal.java:212)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"elasticsearch[AG 8][search][T#7]\" daemon prio=10 tid=0x00007f8e84112800 nid=0x799a waiting on condition [0x00007f8ee7c62000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:998)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"elasticsearch[AG 8][search][T#12]\" daemon prio=10 tid=0x00007f8e8c11f800 nid=0x7999 waiting on condition [0x00007f8ee7ca3000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:998)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"elasticsearch[AG 8][search][T#3]\" daemon prio=10 tid=0x00007f8e8011e000 nid=0x7997 waiting on condition [0x00007f8ee7d25000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:998)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"elasticsearch[AG 8][search][T#2]\" daemon prio=10 tid=0x00007f8e8c11d800 nid=0x7996 waiting on condition [0x00007f8ee7d66000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:998)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"elasticsearch[AG 8][search][T#4]\" daemon prio=10 tid=0x00007f8e84111000 nid=0x7995 waiting on condition [0x00007f8ee7da7000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:998)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"elasticsearch[AG 8][search][T#8]\" daemon prio=10 tid=0x0000000001fa0800 nid=0x7991 waiting for monitor entry [0x00007f8ee7f7c000]\n   java.lang.Thread.State: BLOCKED (on object monitor)\n    at org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor.terminated(EsThreadPoolExecutor.java:64)\n    - waiting to lock <0x00000005fdbaaf50> (a java.lang.Object)\n    - locked <0x00000005fae03ef0> (a org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor)\n    at java.util.concurrent.ThreadPoolExecutor.tryTerminate(ThreadPoolExecutor.java:704)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:1006)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"elasticsearch[AG 8][search][T#6]\" daemon prio=10 tid=0x0000000001f9f000 nid=0x7990 waiting on condition [0x00007f8ee7fbd000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:998)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"elasticsearch[AG 8][search][T#1]\" daemon prio=10 tid=0x00007f8e8410f000 nid=0x798f waiting on condition [0x00007f8ee7ffe000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:998)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"DestroyJavaVM\" prio=10 tid=0x00007f8f1000a800 nid=0x775c waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"elasticsearch[AG 8][clusterService#updateTask][T#1]\" daemon prio=10 tid=0x00007f8e84107800 nid=0x7798 waiting on condition [0x00007f8eee056000]\n   java.lang.Thread.State: WAITING (parking)\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.interruptIdleWorkers(ThreadPoolExecutor.java:781)\n    at java.util.concurrent.ThreadPoolExecutor.tryTerminate(ThreadPoolExecutor.java:695)\n    at java.util.concurrent.ThreadPoolExecutor.shutdown(ThreadPoolExecutor.java:1397)\n    at org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor.shutdown(EsThreadPoolExecutor.java:56)\n    - locked <0x00000005fdbaaf50> (a java.lang.Object)\n    at org.elasticsearch.threadpool.ThreadPool.updateSettings(ThreadPool.java:395)\n    at org.elasticsearch.threadpool.ThreadPool$ApplySettings.onRefreshSettings(ThreadPool.java:656)\n    at org.elasticsearch.node.settings.NodeSettingsService.clusterChanged(NodeSettingsService.java:84)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:417)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:135)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\n\"Service Thread\" daemon prio=10 tid=0x00007f8f10113800 nid=0x7769 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"C2 CompilerThread1\" daemon prio=10 tid=0x00007f8f10111000 nid=0x7768 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"C2 CompilerThread0\" daemon prio=10 tid=0x00007f8f1010e800 nid=0x7767 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Signal Dispatcher\" daemon prio=10 tid=0x00007f8f1010c800 nid=0x7766 runnable [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Surrogate Locker Thread (Concurrent GC)\" daemon prio=10 tid=0x00007f8f10102000 nid=0x7765 waiting on condition [0x0000000000000000]\n   java.lang.Thread.State: RUNNABLE\n\n\"Finalizer\" daemon prio=10 tid=0x00007f8f100eb800 nid=0x7764 in Object.wait() [0x00007f8f0c1bd000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on <0x00000005fce11a08> (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)\n    - locked <0x00000005fce11a08> (a java.lang.ref.ReferenceQueue$Lock)\n    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)\n    at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:189)\n\n\"Reference Handler\" daemon prio=10 tid=0x00007f8f100e7800 nid=0x7763 in Object.wait() [0x00007f8f0c1fe000]\n   java.lang.Thread.State: WAITING (on object monitor)\n    at java.lang.Object.wait(Native Method)\n    - waiting on <0x00000005fce13cb0> (a java.lang.ref.Reference$Lock)\n    at java.lang.Object.wait(Object.java:503)\n    at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)\n    - locked <0x00000005fce13cb0> (a java.lang.ref.Reference$Lock)\n\n\"VM Thread\" prio=10 tid=0x00007f8f100e5000 nid=0x7762 runnable \n\n\"Gang worker#0 (Parallel GC Threads)\" prio=10 tid=0x00007f8f1001c000 nid=0x775d runnable \n\n\"Gang worker#1 (Parallel GC Threads)\" prio=10 tid=0x00007f8f1001e000 nid=0x775e runnable \n\n\"Gang worker#2 (Parallel GC Threads)\" prio=10 tid=0x00007f8f1001f800 nid=0x775f runnable \n\n\"Gang worker#3 (Parallel GC Threads)\" prio=10 tid=0x00007f8f10021800 nid=0x7760 runnable \n\n\"Concurrent Mark-Sweep GC Thread\" prio=10 tid=0x00007f8f100a2000 nid=0x7761 runnable \n\"VM Periodic Task Thread\" prio=10 tid=0x00007f8f1011e800 nid=0x776a waiting on condition \n\nJNI global references: 284\n# Found one Java-level deadlock:\n\n\"Thread-1\":\n  waiting for ownable synchronizer 0x00000005fdba9278, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),\n  which is held by \"elasticsearch[AG 8][search][T#8]\"\n\"elasticsearch[AG 8][search][T#8]\":\n  waiting to lock monitor 0x00007f8e980a33a8 (object 0x00000005fdbaaf50, a java.lang.Object),\n  which is held by \"elasticsearch[AG 8][clusterService#updateTask][T#1]\"\n\"elasticsearch[AG 8][clusterService#updateTask][T#1]\":\n  waiting for ownable synchronizer 0x00000005fdba9278, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),\n  which is held by \"elasticsearch[AG 8][search][T#8]\"\n# Java stack information for the threads listed above:\n\n\"Thread-1\":\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.awaitTermination(ThreadPoolExecutor.java:1461)\n    at org.elasticsearch.threadpool.ThreadPool.awaitTermination(ThreadPool.java:249)\n    at org.elasticsearch.node.internal.InternalNode.close(InternalNode.java:342)\n    at org.elasticsearch.bootstrap.Bootstrap$1.run(Bootstrap.java:73)\n\"elasticsearch[AG 8][search][T#8]\":\n    at org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor.terminated(EsThreadPoolExecutor.java:64)\n    - waiting to lock <0x00000005fdbaaf50> (a java.lang.Object)\n    - locked <0x00000005fae03ef0> (a org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor)\n    at java.util.concurrent.ThreadPoolExecutor.tryTerminate(ThreadPoolExecutor.java:704)\n    at java.util.concurrent.ThreadPoolExecutor.processWorkerExit(ThreadPoolExecutor.java:1006)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1163)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\"elasticsearch[AG 8][clusterService#updateTask][T#1]\":\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000005fdba9278> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:214)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:290)\n    at java.util.concurrent.ThreadPoolExecutor.interruptIdleWorkers(ThreadPoolExecutor.java:781)\n    at java.util.concurrent.ThreadPoolExecutor.tryTerminate(ThreadPoolExecutor.java:695)\n    at java.util.concurrent.ThreadPoolExecutor.shutdown(ThreadPoolExecutor.java:1397)\n    at org.elasticsearch.common.util.concurrent.EsThreadPoolExecutor.shutdown(EsThreadPoolExecutor.java:56)\n    - locked <0x00000005fdbaaf50> (a java.lang.Object)\n    at org.elasticsearch.threadpool.ThreadPool.updateSettings(ThreadPool.java:395)\n    at org.elasticsearch.threadpool.ThreadPool$ApplySettings.onRefreshSettings(ThreadPool.java:656)\n    at org.elasticsearch.node.settings.NodeSettingsService.clusterChanged(NodeSettingsService.java:84)\n    at org.elasticsearch.cluster.service.InternalClusterService$UpdateTask.run(InternalClusterService.java:417)\n    at org.elasticsearch.common.util.concurrent.PrioritizedEsThreadPoolExecutor$TieBreakingPrioritizedRunnable.run(PrioritizedEsThreadPoolExecutor.java:135)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:744)\n\nFound 1 deadlock.\n","closed_by":{"login":"imotov","id":655851,"node_id":"MDQ6VXNlcjY1NTg1MQ==","avatar_url":"https://avatars3.githubusercontent.com/u/655851?v=4","gravatar_id":"","url":"https://api.github.com/users/imotov","html_url":"https://github.com/imotov","followers_url":"https://api.github.com/users/imotov/followers","following_url":"https://api.github.com/users/imotov/following{/other_user}","gists_url":"https://api.github.com/users/imotov/gists{/gist_id}","starred_url":"https://api.github.com/users/imotov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imotov/subscriptions","organizations_url":"https://api.github.com/users/imotov/orgs","repos_url":"https://api.github.com/users/imotov/repos","events_url":"https://api.github.com/users/imotov/events{/privacy}","received_events_url":"https://api.github.com/users/imotov/received_events","type":"User","site_admin":false},"performed_via_github_app":null}