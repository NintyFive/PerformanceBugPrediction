{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/30428","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30428/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30428/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/30428/events","html_url":"https://github.com/elastic/elasticsearch/issues/30428","id":320877466,"node_id":"MDU6SXNzdWUzMjA4Nzc0NjY=","number":30428,"title":"Core cache implementation can deadlock","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"labels":[{"id":144797810,"node_id":"MDU6TGFiZWwxNDQ3OTc4MTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Core","name":":Core/Infra/Core","color":"0e8a16","default":false,"description":"Core issues without another label"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913658,"node_id":"MDU6TGFiZWw5MjkxMzY1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/blocker","name":"blocker","color":"e11d21","default":false,"description":null},{"id":905326255,"node_id":"MDU6TGFiZWw5MDUzMjYyNTU=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v5.6.10","name":"v5.6.10","color":"DDDDDD","default":false,"description":""},{"id":753477051,"node_id":"MDU6TGFiZWw3NTM0NzcwNTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.3.0","name":"v6.3.0","color":"DDDDDD","default":false,"description":null},{"id":912911731,"node_id":"MDU6TGFiZWw5MTI5MTE3MzE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v6.4.0","name":"v6.4.0","color":"DDDDDD","default":false,"description":""},{"id":1223177445,"node_id":"MDU6TGFiZWwxMjIzMTc3NDQ1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.0.0-beta1","name":"v7.0.0-beta1","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"assignees":[{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2018-05-07T16:55:09Z","updated_at":"2019-02-07T08:33:02Z","closed_at":"2018-05-09T15:52:39Z","author_association":"MEMBER","active_lock_reason":null,"body":"Here is a stack dump from a failing test:\r\n\r\n```\r\n\"Thread-1\" #19 prio=5 os_prio=31 tid=0x00007f906eb14800 nid=0x7803 waiting on condition  [0x000070000618c000]\r\n   java.lang.Thread.State: WAITING (parking)\r\n        at jdk.internal.misc.Unsafe.park(java.base@10/Native Method)\r\n        - parking to wait for  <0x00000006cecb5790> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\r\n        at java.util.concurrent.locks.LockSupport.park(java.base@10/LockSupport.java:194)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(java.base@10/AbstractQueuedSynchronizer.java:883)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(java.base@10/AbstractQueuedSynchronizer.java:915)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(java.base@10/AbstractQueuedSynchronizer.java:1238)\r\n        at java.util.concurrent.locks.ReentrantLock.lock(java.base@10/ReentrantLock.java:267)\r\n        at org.elasticsearch.common.util.concurrent.ReleasableLock.acquire(ReleasableLock.java:55)\r\n        at org.elasticsearch.common.cache.Cache.lambda$computeIfAbsent$5(Cache.java:391)\r\n        at org.elasticsearch.common.cache.Cache$$Lambda$207/1567223321.apply(Unknown Source)\r\n        at java.util.concurrent.CompletableFuture.uniHandle(java.base@10/CompletableFuture.java:930)\r\n        at java.util.concurrent.CompletableFuture$UniHandle.tryFire(java.base@10/CompletableFuture.java:907)\r\n        at java.util.concurrent.CompletableFuture.postComplete(java.base@10/CompletableFuture.java:506)\r\n        at java.util.concurrent.CompletableFuture.complete(java.base@10/CompletableFuture.java:2073)\r\n        at org.elasticsearch.common.cache.Cache.computeIfAbsent(Cache.java:422)\r\n        at org.elasticsearch.common.cache.CacheTests.lambda$testComputeIfAbsentDeadlock$9(CacheTests.java:358)\r\n        at org.elasticsearch.common.cache.CacheTests$$Lambda$200/1841769401.run(Unknown Source)\r\n        at java.lang.Thread.run(java.base@10/Thread.java:844)\r\n\r\n\"Thread-2\" #20 prio=5 os_prio=31 tid=0x00007f906eb17000 nid=0x8d03 waiting on condition  [0x000070000628e000]\r\n   java.lang.Thread.State: WAITING (parking)\r\n        at jdk.internal.misc.Unsafe.park(java.base@10/Native Method)\r\n        - parking to wait for  <0x00000006ce8b7498> (a java.util.concurrent.CompletableFuture$Signaller)\r\n        at java.util.concurrent.locks.LockSupport.park(java.base@10/LockSupport.java:194)\r\n        at java.util.concurrent.CompletableFuture$Signaller.block(java.base@10/CompletableFuture.java:1796)\r\n        at java.util.concurrent.ForkJoinPool.managedBlock(java.base@10/ForkJoinPool.java:3156)\r\n        at java.util.concurrent.CompletableFuture.waitingGet(java.base@10/CompletableFuture.java:1823)\r\n        at java.util.concurrent.CompletableFuture.get(java.base@10/CompletableFuture.java:1998)\r\n        at org.elasticsearch.common.cache.Cache$CacheSegment.remove(Cache.java:290)\r\n        at org.elasticsearch.common.cache.Cache.evictEntry(Cache.java:720)\r\n        at org.elasticsearch.common.cache.Cache.evict(Cache.java:711)\r\n        at org.elasticsearch.common.cache.Cache.promote(Cache.java:701)\r\n        at org.elasticsearch.common.cache.Cache.lambda$computeIfAbsent$5(Cache.java:392)\r\n        at org.elasticsearch.common.cache.Cache$$Lambda$207/1567223321.apply(Unknown Source)\r\n        at java.util.concurrent.CompletableFuture.uniHandle(java.base@10/CompletableFuture.java:930)\r\n        at java.util.concurrent.CompletableFuture$UniHandle.tryFire(java.base@10/CompletableFuture.java:907)\r\n        at java.util.concurrent.CompletableFuture.postComplete(java.base@10/CompletableFuture.java:506)\r\n        at java.util.concurrent.CompletableFuture.complete(java.base@10/CompletableFuture.java:2073)\r\n        at org.elasticsearch.common.cache.Cache.computeIfAbsent(Cache.java:422)\r\n        at org.elasticsearch.common.cache.CacheTests.lambda$testComputeIfAbsentDeadlock$9(CacheTests.java:358)\r\n        at org.elasticsearch.common.cache.CacheTests$$Lambda$200/1841769401.run(Unknown Source)\r\n        at java.lang.Thread.run(java.base@10/Thread.java:844)\r\n```\r\n\r\nI will push the failing test and mark it as awaiting fix by this issue.","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}