{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786/events","html_url":"https://github.com/elastic/elasticsearch/issues/25786","id":243961499,"node_id":"MDU6SXNzdWUyNDM5NjE0OTk=","number":25786,"title":"Performance of Unified Highlighter is ~5 times worse than Postings highlighter in Elasticsearch 5.5.0","user":{"login":"ShilpiRachna","id":27772104,"node_id":"MDQ6VXNlcjI3NzcyMTA0","avatar_url":"https://avatars1.githubusercontent.com/u/27772104?v=4","gravatar_id":"","url":"https://api.github.com/users/ShilpiRachna","html_url":"https://github.com/ShilpiRachna","followers_url":"https://api.github.com/users/ShilpiRachna/followers","following_url":"https://api.github.com/users/ShilpiRachna/following{/other_user}","gists_url":"https://api.github.com/users/ShilpiRachna/gists{/gist_id}","starred_url":"https://api.github.com/users/ShilpiRachna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShilpiRachna/subscriptions","organizations_url":"https://api.github.com/users/ShilpiRachna/orgs","repos_url":"https://api.github.com/users/ShilpiRachna/repos","events_url":"https://api.github.com/users/ShilpiRachna/events{/privacy}","received_events_url":"https://api.github.com/users/ShilpiRachna/received_events","type":"User","site_admin":false},"labels":[{"id":111549183,"node_id":"MDU6TGFiZWwxMTE1NDkxODM=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Highlighting","name":":Search/Highlighting","color":"0e8a16","default":false,"description":"How a query matched a document"}],"state":"closed","locked":false,"assignee":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"assignees":[{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false}],"milestone":null,"comments":7,"created_at":"2017-07-19T08:28:06Z","updated_at":"2018-06-19T11:05:28Z","closed_at":"2017-07-24T18:17:12Z","author_association":"NONE","active_lock_reason":null,"body":"Elasticsearch version: 5.5.0 \r\nJVM version: 1.8.0_72 \r\nOS version: Windows 10\r\n\r\nDescription of the problem including expected versus actual behavior:\r\n--\r\nWe indexed around 1 million documents in a single shard, zero replica index with _source enabled. Each document has around 40 to 50 fields. There is only one mapping used for all documents and it has around 500 fields. We highlight only 12 fields.\r\n\r\nI had filed an issue https://github.com/elastic/elasticsearch/issues/25699 for the performance of unified highlighter as compared to postings highlighter for multi match queries.\r\n\r\nCommit https://github.com/elastic/elasticsearch/commit/41ea8fdcec064b5920a1ae392974fa6c51e9aef6 was done as part of the fix. I applied the commit on v5.5.0 branch (manually) and tried our scenario. The performance has improved significantly but it is still 5-6 times slower than postings highlighter for majority of the queries.\r\n\r\nComparison of performance for Multi-match query (in ms):\r\n--\r\n50th Percentile for our queries:\r\nPostings: 20\r\nUnified: 115\r\n\r\n80th percentile for our queries:\r\nPostings: 104\r\nUnified: 310\r\n\r\nHave attached the mapping and sample document:\r\nhttps://github.com/elastic/elasticsearch/files/1147583/SampleDocument.txt\r\nhttps://github.com/elastic/elasticsearch/files/1147584/Mapping.txt\r\n\r\nThanks!\r\n","closed_by":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"performed_via_github_app":null}