{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22087","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22087/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22087/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22087/events","html_url":"https://github.com/elastic/elasticsearch/issues/22087","id":194678497,"node_id":"MDU6SXNzdWUxOTQ2Nzg0OTc=","number":22087,"title":"Geo-shape indexing is very slow","user":{"login":"mohmad-null","id":22342282,"node_id":"MDQ6VXNlcjIyMzQyMjgy","avatar_url":"https://avatars0.githubusercontent.com/u/22342282?v=4","gravatar_id":"","url":"https://api.github.com/users/mohmad-null","html_url":"https://github.com/mohmad-null","followers_url":"https://api.github.com/users/mohmad-null/followers","following_url":"https://api.github.com/users/mohmad-null/following{/other_user}","gists_url":"https://api.github.com/users/mohmad-null/gists{/gist_id}","starred_url":"https://api.github.com/users/mohmad-null/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohmad-null/subscriptions","organizations_url":"https://api.github.com/users/mohmad-null/orgs","repos_url":"https://api.github.com/users/mohmad-null/repos","events_url":"https://api.github.com/users/mohmad-null/events{/privacy}","received_events_url":"https://api.github.com/users/mohmad-null/received_events","type":"User","site_admin":false},"labels":[{"id":141079527,"node_id":"MDU6TGFiZWwxNDEwNzk1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Geo","name":":Analytics/Geo","color":"0e8a16","default":false,"description":"Indexing, search aggregations of geo points and shapes"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"assignees":[{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false}],"milestone":null,"comments":10,"created_at":"2016-12-09T19:34:29Z","updated_at":"2018-03-26T20:09:22Z","closed_at":"2018-03-26T20:09:22Z","author_association":"NONE","active_lock_reason":null,"body":"I'm seeing *very* slow indexing with ElasticSearch when I set up a geo-shape type.\r\nI'm using a stock 5.0.0 on Windows 7, no customisations, and I'm accessing it via the Python (3.5) wrapper. One shard.\r\n\r\nI have 75 documents to index and if I don't set up a mapping, they index near instantly.\r\n\r\nBut the second I include a geo-shape mapping, the processing time rockets, as does CPU usage and inevitably it times out on the index creation, even with the timeout increased to 30s.\r\n\r\nMy mapping for the geo-shape looks like this:\r\n \"bbox\": {\r\n \"type\": \"geo_shape\",\r\n \"precision\": \"100m\"\r\n },\r\nThe rest of the mapping is just type:text. _all is disabled.\r\n\r\nEach document has up to two geo-shapes. The shapes are simple envelope types as they're only bounding boxes - spatially this should be the simplest indexing there is for a polygon.\r\n\r\nThe problem is exagerated by the precision, but even with a precison of 1000m, when I send in larger quantiies of documents, it still flakes out after only a few hundred have been indexed.\r\n\r\nChanging the tree type to **quadtree** is several times faster than the **geohash**, but it still times out after using considerably more resources.\r\n\r\nI've seen the section on \"performance considerations\" in the docs (https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-shape.html ) - but this is far slower than I would expect any spatial indexing to occur.\r\nIn a conventional spatial RDBMS (PostGIS/Oracle) I'm used to being able to insert hundreds if not thousands of complex spatial features every second.\r\nElasticSearch is failing to handle even a few dozen a second of basic bounding boxes geometries.\r\n\r\nI appreciate I haven't optimised my deployment (still in dev), but an unoptimised RDBMS is orders of magnitude faster at the same operation. I think there's considerable scope for optimisation here, especially compared to ES's non-spatial indexing.","closed_by":{"login":"nknize","id":830187,"node_id":"MDQ6VXNlcjgzMDE4Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/830187?v=4","gravatar_id":"","url":"https://api.github.com/users/nknize","html_url":"https://github.com/nknize","followers_url":"https://api.github.com/users/nknize/followers","following_url":"https://api.github.com/users/nknize/following{/other_user}","gists_url":"https://api.github.com/users/nknize/gists{/gist_id}","starred_url":"https://api.github.com/users/nknize/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nknize/subscriptions","organizations_url":"https://api.github.com/users/nknize/orgs","repos_url":"https://api.github.com/users/nknize/repos","events_url":"https://api.github.com/users/nknize/events{/privacy}","received_events_url":"https://api.github.com/users/nknize/received_events","type":"User","site_admin":false},"performed_via_github_app":null}