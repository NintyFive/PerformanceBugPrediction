[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/260375606","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-260375606","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":260375606,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDM3NTYwNg==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2016-11-14T15:59:08Z","updated_at":"2016-11-14T15:59:08Z","author_association":"MEMBER","body":"I wonder if it is worthwhile to try doing a simple comparison first, and only if that fails normalize the requested path?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/264430520","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-264430520","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":264430520,"node_id":"MDEyOklzc3VlQ29tbWVudDI2NDQzMDUyMA==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2016-12-02T11:07:29Z","updated_at":"2016-12-02T11:07:29Z","author_association":"CONTRIBUTOR","body":"We have agreed on Fixit Friday to revisit this issue once JDK 9 goes GA / when we release ES v6.0.0. Leaving it open and marking it as blocker for v6.0.0.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/282351816","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-282351816","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":282351816,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MjM1MTgxNg==","user":{"login":"uschindler","id":1005388,"node_id":"MDQ6VXNlcjEwMDUzODg=","avatar_url":"https://avatars2.githubusercontent.com/u/1005388?v=4","gravatar_id":"","url":"https://api.github.com/users/uschindler","html_url":"https://github.com/uschindler","followers_url":"https://api.github.com/users/uschindler/followers","following_url":"https://api.github.com/users/uschindler/following{/other_user}","gists_url":"https://api.github.com/users/uschindler/gists{/gist_id}","starred_url":"https://api.github.com/users/uschindler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uschindler/subscriptions","organizations_url":"https://api.github.com/users/uschindler/orgs","repos_url":"https://api.github.com/users/uschindler/repos","events_url":"https://api.github.com/users/uschindler/events{/privacy}","received_events_url":"https://api.github.com/users/uschindler/received_events","type":"User","site_admin":false},"created_at":"2017-02-24T17:29:34Z","updated_at":"2017-02-24T17:30:13Z","author_association":"CONTRIBUTOR","body":"Hi,\r\nthere were some changes in build 158 because of bug reports by Lucene (so they added some symlink-handling special cases - e.g. the proposal was that if a file permission was created using a symlink, 2 permissions will be added to the policy - one for the symlink and one for the real path. This is still work in progress.\r\n\r\nHere is the actual state, sent yesterday:\r\n\r\n> -----Original Message-----\r\n> From: Weijun Wang [mailto:weijun.wang@oracle.com]\r\n> Sent: Friday, February 24, 2017 9:03 AM\r\n> To: jdk9-dev@openjdk.java.net\r\n> Cc: Uwe Schindler <uschindler@apache.org>; Rory O'Donnell\r\n> <rory.odonnell@oracle.com>\r\n> Subject: More change in jdk-9+158 (was: FilePermission change in jdk-9+140)\r\n> \r\n> Hi Again\r\n> \r\n> The following changeset is included in jdk-9+158:\r\n> \r\n>     http://hg.openjdk.java.net/jdk9/dev/jdk/rev/8b0d55e02f54\r\n> \r\n> As said in the parent mail below:\r\n> \r\n>  >> Please note the compatibility layer does NOT cover:\r\n>  >>\r\n>  >> 1. A user-defined security manager or policy implementation, because\r\n> we cannot control it. (Not always, but you need to test).\r\n> \r\n> In fact, we did try to cover 3rd-party Policy implementations last time,\r\n> but it turns out not working perfectly, and we've disabled it in\r\n> JDK-8168410.\r\n> \r\n> If you have a user-defined Policy implementation that grants\r\n> FilePermission on ${user.dir}/-, reading a file in the current directory\r\n> using its base name will fail.\r\n> \r\n> Still the same solution: Ensure that the path used in permission\r\n> granting has the same style as the one how you access the file.\r\n> \r\n> Setting -Djdk.security.filePermCompat=true will take you back to the\r\n> jdk-9+140 behavior. Setting -Djdk.io.permissionsUseCanonicalPath=true\r\n> will take you back to the jdk8 behavior.\r\n> \r\n> Any feedback is welcome.\r\n> \r\n> Thanks\r\n> Max\r\n> \r\n> On 10/14/2016 10:03 PM, Wang Weijun wrote:\r\n> > Hi All\r\n> >\r\n> > If you use a security manager and file permissions then read on.\r\n> >\r\n> > The following changeset is included in jdk-9+140:\r\n> >\r\n> >   8164705: Remove pathname canonicalization from FilePermission\r\n> >   http://hg.openjdk.java.net/jdk9/jdk9/jdk/rev/4251b451be17\r\n> >\r\n> > This code change removes pathname canonicalization from FilePermission\r\n> creation, thus calculations of the equals() and implies() methods will be\r\n> based on the raw path string one provides in \"new FilePermission(path,\r\n> action)\".\r\n> >\r\n> > The new behavior is described as @implNote at various places in\r\n> >\r\n> >   http://download.java.net/java/jdk9/docs/api/java/io/FilePermission.html\r\n> >\r\n> > We do this mainly for performance enhancement so that there is no need\r\n> to consult the file system every time a FilePermisson is created.\r\n> >\r\n> > This means FilePermissions on the following pathnames will be unrelated:\r\n> >\r\n> > 1. On \"./file\" and \"/path/to/current/directory/file\".\r\n> >\r\n> > 2. On symlink and its target.\r\n> >\r\n> > 3. On \"C:\\Program Files\" and \"C:\\PROGRA~1\" on Windows.\r\n> >\r\n> > and any other name change that a canonicalization can make.\r\n> >\r\n> > Please note that the new FilePermission implementation is based on NIO\r\n> Path, and Path happens to understand case-sensitiveness and various other\r\n> things, so there is no need to worry about \"C:\\PATH\" and \"c:\\path\" on\r\n> Windows or abundant ./down/.. on all platforms.\r\n> >\r\n> > That said, this changeset also adds a compatibility layer at the permission\r\n> check level to translate between an absolute pathname and a relative one.\r\n> So, even if FilePermission on a relative path does not imply one on an\r\n> absolute path pointing to the same file, when you grant a permission in a\r\n> relative pathname, you are still allowed to read the file with an absolute\r\n> pathname.\r\n> >\r\n> > This compatibility layer covers these cases:\r\n> >\r\n> > 1. When a permission is granted in a policy file.\r\n> >\r\n> > 2. When a permission is automatically granted because it's on a path where\r\n> the class files are stored.\r\n> >\r\n> > 3. When a permission is requested in a doPrivileged-with-permissions call\r\n> >\r\n> > We do hope that whenever you want to access a file, the permission you\r\n> granted in a policy would be better to match the pathname you use to access\r\n> the file. For example, if you plan to call 'new\r\n> FileInputStream(\"/home/me/x\")', please also grant FilePermission on\r\n> \"/home/me/x\" instead of just \"x\".\r\n> >\r\n> > Please note the compatibility layer does NOT cover:\r\n> >\r\n> > 1. A user-defined security manager or policy implementation, because we\r\n> cannot control it. (Not always, but you need to test).\r\n> >\r\n> > 2. The translation between a symlink and its target, because it needs to\r\n> read the file system.\r\n> >\r\n> > 3. The translation between a Windows long file name and its DOS-8.3\r\n> shorted name, because it needs to read the file system.\r\n> >\r\n> > Also, \"/-\" does not imply \"./file\" even if it's a Unix. Please use \"<<ALL\r\n> FILES>>\" instead.\r\n> >\r\n> > Finally, if you cannot live with this new behavior and like the pre-jdk9 style,\r\n> you can always set the system property jdk.io.permissionsUseCanonicalPath\r\n> back to true.\r\n> >\r\n> > Thanks\r\n> > Max\r\n> >\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289424159","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-289424159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":289424159,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTQyNDE1OQ==","user":{"login":"wangweij","id":574013,"node_id":"MDQ6VXNlcjU3NDAxMw==","avatar_url":"https://avatars1.githubusercontent.com/u/574013?v=4","gravatar_id":"","url":"https://api.github.com/users/wangweij","html_url":"https://github.com/wangweij","followers_url":"https://api.github.com/users/wangweij/followers","following_url":"https://api.github.com/users/wangweij/following{/other_user}","gists_url":"https://api.github.com/users/wangweij/gists{/gist_id}","starred_url":"https://api.github.com/users/wangweij/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangweij/subscriptions","organizations_url":"https://api.github.com/users/wangweij/orgs","repos_url":"https://api.github.com/users/wangweij/repos","events_url":"https://api.github.com/users/wangweij/events{/privacy}","received_events_url":"https://api.github.com/users/wangweij/received_events","type":"User","site_admin":false},"created_at":"2017-03-27T11:16:07Z","updated_at":"2017-03-27T11:18:03Z","author_association":"NONE","body":"I'm the author of the new FilePermission behavior.\r\n\r\nIn our benchmarking, the new behavior is much faster than the old one if every FilePermission on the right hand side of implies() is created from a brand new path, and much slower if it is not always new (Precisely, if the number of all different paths is <= 200).\r\n\r\nThis is because although the File.getCanonicalPath() call (which is used by the old behavior) is quite slow, it has an internal cache that can hold 200 results. If you keep calling the method on these 200 paths, it will be super fast.\r\n\r\nIs your test also using a limited number of paths?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289588579","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-289588579","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":289588579,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTU4ODU3OQ==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-03-27T21:15:59Z","updated_at":"2017-03-27T21:16:19Z","author_association":"MEMBER","body":"@wangweij Each test uses it's own randomly generated path(s) (unique to that test), and we run many tests within the same JVM (close to 1000 unit tests classes). However, the paths which we add permissions for (when the test jvm starts up) is indeed limited to a few paths in the security manager policy. All of the relevant paths to the performance difference we see would be using this one root file permission: https://github.com/elastic/elasticsearch/blob/master/test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java#L116.  But the paths compared against that would be mostly unique (subpaths).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289652658","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-289652658","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":289652658,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTY1MjY1OA==","user":{"login":"wangweij","id":574013,"node_id":"MDQ6VXNlcjU3NDAxMw==","avatar_url":"https://avatars1.githubusercontent.com/u/574013?v=4","gravatar_id":"","url":"https://api.github.com/users/wangweij","html_url":"https://github.com/wangweij","followers_url":"https://api.github.com/users/wangweij/followers","following_url":"https://api.github.com/users/wangweij/following{/other_user}","gists_url":"https://api.github.com/users/wangweij/gists{/gist_id}","starred_url":"https://api.github.com/users/wangweij/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangweij/subscriptions","organizations_url":"https://api.github.com/users/wangweij/orgs","repos_url":"https://api.github.com/users/wangweij/repos","events_url":"https://api.github.com/users/wangweij/events{/privacy}","received_events_url":"https://api.github.com/users/wangweij/received_events","type":"User","site_admin":false},"created_at":"2017-03-28T03:30:29Z","updated_at":"2017-04-02T07:12:38Z","author_association":"NONE","body":"@rjernst So you granted FilePermission on /tmp/- and call checkRead on /tmp/random-sub-path? Are the 1000 tests running in parallel? It will be nice if you can create a standalone test or please tell me how I can run your test. Sorry I am not familiar with ElasticSearch.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/289662076","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-289662076","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":289662076,"node_id":"MDEyOklzc3VlQ29tbWVudDI4OTY2MjA3Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-03-28T04:49:11Z","updated_at":"2017-03-28T04:49:11Z","author_association":"MEMBER","body":"@wangweij You can run a single test as follows (just using the same one that @ywelsch used to benchmark this in the original issue description). You will need gradle 3.3.\r\n\r\n1. In `~/.gradle/gradle.properties` set `org.gradle.java.home=path/to/java/8`. This is needed because gradle does not yet work on java 9 correctly.\r\n2. Set `JAVA_HOME` to your jdk9 path.\r\n3. Set `GRADLE_OPTS` to `--add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.lang.invoke=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED`\r\n4. Run the following gradle command from the root of an elasticsearch checkout:\r\n```\r\ngradle :core:integTest -Dtests.class=org.elasticsearch.cluster.allocation.ClusterRerouteIT -Dtests.method=testDelayWithALargeAmountOfShards -Dtests.seed=4CCF7644FDF3724D\r\n```\r\n\r\nNote that we have the canonical path option turned on. To run without that option, and with the originally suggested change here (adding explicit permissions for canonical paths), I created a branch. You can check it out from [my fork](https://github.com/rjernst/elasticsearch/tree/jdk9_canonical_permissions), and you can [see the diff](https://github.com/elastic/elasticsearch/compare/master...rjernst:jdk9_canonical_permissions).\r\n\r\nOn my laptop and jdk9 b159, that test runs in about 15 seconds on master (which has `-Djdk.io.permissionsUseCanonicalPath=true`), and almost 60 seconds with the branch I linked there.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290423235","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-290423235","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":290423235,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDQyMzIzNQ==","user":{"login":"wangweij","id":574013,"node_id":"MDQ6VXNlcjU3NDAxMw==","avatar_url":"https://avatars1.githubusercontent.com/u/574013?v=4","gravatar_id":"","url":"https://api.github.com/users/wangweij","html_url":"https://github.com/wangweij","followers_url":"https://api.github.com/users/wangweij/followers","following_url":"https://api.github.com/users/wangweij/following{/other_user}","gists_url":"https://api.github.com/users/wangweij/gists{/gist_id}","starred_url":"https://api.github.com/users/wangweij/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangweij/subscriptions","organizations_url":"https://api.github.com/users/wangweij/orgs","repos_url":"https://api.github.com/users/wangweij/repos","events_url":"https://api.github.com/users/wangweij/events{/privacy}","received_events_url":"https://api.github.com/users/wangweij/received_events","type":"User","site_admin":false},"created_at":"2017-03-30T14:12:57Z","updated_at":"2017-03-30T14:36:57Z","author_association":"NONE","body":"@rjernst I can reproduce the problem here. It's 50s vs 92s on my laptop (jdk9+161). I will try to look into it. I see your branch added 2 extra permissions. When a file is accessed, are you usually using the original path or the *real* path?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290614556","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-290614556","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":290614556,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDYxNDU1Ng==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-03-31T04:43:18Z","updated_at":"2017-03-31T04:43:18Z","author_association":"MEMBER","body":"@wangweij \r\n\r\n> When a file is accessed, are you usually using the original path or the real path?\r\n\r\nI believe we would be using the original path. For example, with `java.io.tmpdir` set to `./temp` (which we use in tests, each test runner creates a cwd for the jvm that is unique), we would be using paths that start with `./temp`, not the equivalent `$PWD/temp`.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290723297","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-290723297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":290723297,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDcyMzI5Nw==","user":{"login":"wangweij","id":574013,"node_id":"MDQ6VXNlcjU3NDAxMw==","avatar_url":"https://avatars1.githubusercontent.com/u/574013?v=4","gravatar_id":"","url":"https://api.github.com/users/wangweij","html_url":"https://github.com/wangweij","followers_url":"https://api.github.com/users/wangweij/followers","following_url":"https://api.github.com/users/wangweij/following{/other_user}","gists_url":"https://api.github.com/users/wangweij/gists{/gist_id}","starred_url":"https://api.github.com/users/wangweij/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangweij/subscriptions","organizations_url":"https://api.github.com/users/wangweij/orgs","repos_url":"https://api.github.com/users/wangweij/repos","events_url":"https://api.github.com/users/wangweij/events{/privacy}","received_events_url":"https://api.github.com/users/wangweij/received_events","type":"User","site_admin":false},"created_at":"2017-03-31T14:13:17Z","updated_at":"2017-03-31T14:13:17Z","author_association":"NONE","body":"Dumped all FilePermission checks of a test run into a log. The total number is 882642 with 29275 uniq ones. I'll write a test that simulate these 882642 checks tomorrow and see how it performs.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/290969246","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-290969246","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":290969246,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDk2OTI0Ng==","user":{"login":"wangweij","id":574013,"node_id":"MDQ6VXNlcjU3NDAxMw==","avatar_url":"https://avatars1.githubusercontent.com/u/574013?v=4","gravatar_id":"","url":"https://api.github.com/users/wangweij","html_url":"https://github.com/wangweij","followers_url":"https://api.github.com/users/wangweij/followers","following_url":"https://api.github.com/users/wangweij/following{/other_user}","gists_url":"https://api.github.com/users/wangweij/gists{/gist_id}","starred_url":"https://api.github.com/users/wangweij/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangweij/subscriptions","organizations_url":"https://api.github.com/users/wangweij/orgs","repos_url":"https://api.github.com/users/wangweij/repos","events_url":"https://api.github.com/users/wangweij/events{/privacy}","received_events_url":"https://api.github.com/users/wangweij/received_events","type":"User","site_admin":false},"created_at":"2017-04-02T07:11:39Z","updated_at":"2017-04-02T07:11:39Z","author_association":"NONE","body":"The simulation on these 882642 checks shows the same behavior, i.e. jdk9 spends about 100% more time than jdk8. Of all the checks, 881303 are in the same directory (\"core/build/testrun/integTest/J0/temp\"). For jdk8 with a canonicalized path cache of size 200, 830696 checks (94.26%) are hits and 50607 (5.74%) are misses. The sub-directory names inside \"tempDir-002/d?/nodes/?/indices\" look like randomly generated strings (For example, \"cdJ1TZYqRFCMpEn44235hg\"),  but there are only 25 of them.\r\n\r\nSo the performance degradation can be explained now, which is because in jdk8 most canonicalized paths are cached so the most time consuming part is not a problem. I will think about if it is possible to make some similar optimization in jdk9. Thanks for reporting this issue about FilePermission checks in the real world.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/291453609","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-291453609","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":291453609,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MTQ1MzYwOQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-04T10:01:11Z","updated_at":"2017-04-04T10:01:11Z","author_association":"CONTRIBUTOR","body":"@wangweij thank you for investigating the issue and looking into possible solutions. This is much appreciated.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292370963","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-292370963","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":292370963,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjM3MDk2Mw==","user":{"login":"wangweij","id":574013,"node_id":"MDQ6VXNlcjU3NDAxMw==","avatar_url":"https://avatars1.githubusercontent.com/u/574013?v=4","gravatar_id":"","url":"https://api.github.com/users/wangweij","html_url":"https://github.com/wangweij","followers_url":"https://api.github.com/users/wangweij/followers","following_url":"https://api.github.com/users/wangweij/following{/other_user}","gists_url":"https://api.github.com/users/wangweij/gists{/gist_id}","starred_url":"https://api.github.com/users/wangweij/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangweij/subscriptions","organizations_url":"https://api.github.com/users/wangweij/orgs","repos_url":"https://api.github.com/users/wangweij/repos","events_url":"https://api.github.com/users/wangweij/events{/privacy}","received_events_url":"https://api.github.com/users/wangweij/received_events","type":"User","site_admin":false},"created_at":"2017-04-07T00:11:58Z","updated_at":"2017-04-07T00:24:44Z","author_association":"NONE","body":"https://bugs.openjdk.java.net/browse/JDK-8177969 filed including a link to the suggested fix. After code review, it will be pushed into jdk9.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/292409977","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-292409977","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":292409977,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MjQwOTk3Nw==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-04-07T02:47:20Z","updated_at":"2017-04-07T02:47:20Z","author_association":"MEMBER","body":"This is great news @wangweij. Thank you for your time investigating and fixing!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296562693","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-296562693","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":296562693,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjU2MjY5Mw==","user":{"login":"wangweij","id":574013,"node_id":"MDQ6VXNlcjU3NDAxMw==","avatar_url":"https://avatars1.githubusercontent.com/u/574013?v=4","gravatar_id":"","url":"https://api.github.com/users/wangweij","html_url":"https://github.com/wangweij","followers_url":"https://api.github.com/users/wangweij/followers","following_url":"https://api.github.com/users/wangweij/following{/other_user}","gists_url":"https://api.github.com/users/wangweij/gists{/gist_id}","starred_url":"https://api.github.com/users/wangweij/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wangweij/subscriptions","organizations_url":"https://api.github.com/users/wangweij/orgs","repos_url":"https://api.github.com/users/wangweij/repos","events_url":"https://api.github.com/users/wangweij/events{/privacy}","received_events_url":"https://api.github.com/users/wangweij/received_events","type":"User","site_admin":false},"created_at":"2017-04-24T07:50:45Z","updated_at":"2017-06-28T12:49:48Z","author_association":"NONE","body":"Fixed now in jdk9+166. Please take a try.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/296739979","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-296739979","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":296739979,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NjczOTk3OQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-04-24T16:50:38Z","updated_at":"2017-04-24T16:50:38Z","author_association":"CONTRIBUTOR","body":"Initial testing shows very promising results (performance on-par with \"Java 8\" mode). Thank you for this fix @wangweij!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323268058","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-323268058","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":323268058,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzI2ODA1OA==","user":{"login":"rjernst","id":289412,"node_id":"MDQ6VXNlcjI4OTQxMg==","avatar_url":"https://avatars3.githubusercontent.com/u/289412?v=4","gravatar_id":"","url":"https://api.github.com/users/rjernst","html_url":"https://github.com/rjernst","followers_url":"https://api.github.com/users/rjernst/followers","following_url":"https://api.github.com/users/rjernst/following{/other_user}","gists_url":"https://api.github.com/users/rjernst/gists{/gist_id}","starred_url":"https://api.github.com/users/rjernst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rjernst/subscriptions","organizations_url":"https://api.github.com/users/rjernst/orgs","repos_url":"https://api.github.com/users/rjernst/repos","events_url":"https://api.github.com/users/rjernst/events{/privacy}","received_events_url":"https://api.github.com/users/rjernst/received_events","type":"User","site_admin":false},"created_at":"2017-08-18T06:08:02Z","updated_at":"2017-08-18T06:08:02Z","author_association":"MEMBER","body":"@ywelsch Do you want to create a PR with your original change suggested in this issue and remove the canonicalpath override flag from jvm.options? I still see this as a blocker for 6.0, so that we can work with jdk9 on release.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/323897297","html_url":"https://github.com/elastic/elasticsearch/issues/21534#issuecomment-323897297","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21534","id":323897297,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzg5NzI5Nw==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2017-08-22T01:53:33Z","updated_at":"2017-08-22T01:53:33Z","author_association":"CONTRIBUTOR","body":"Closed by #26302","performed_via_github_app":null}]