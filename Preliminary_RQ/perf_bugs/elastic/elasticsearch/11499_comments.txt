[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109025625","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-109025625","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":109025625,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTAyNTYyNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-04T19:42:16Z","updated_at":"2015-06-04T19:42:16Z","author_association":"CONTRIBUTOR","body":"@mikemccand any thoughts about this?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109049574","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-109049574","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":109049574,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTA0OTU3NA==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2015-06-04T21:02:17Z","updated_at":"2015-06-04T21:02:17Z","author_association":"CONTRIBUTOR","body":"Can you describe the docs you're indexing?  Do you pass your own IDs\nor does ES generate them?  Do you ever replace docs or just index new ones?\n\nHow many segments are in the shard?  Do you use delete-by-query?\n\nAny custom index settings?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109060148","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-109060148","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":109060148,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTA2MDE0OA==","user":{"login":"embark","id":2575512,"node_id":"MDQ6VXNlcjI1NzU1MTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2575512?v=4","gravatar_id":"","url":"https://api.github.com/users/embark","html_url":"https://github.com/embark","followers_url":"https://api.github.com/users/embark/followers","following_url":"https://api.github.com/users/embark/following{/other_user}","gists_url":"https://api.github.com/users/embark/gists{/gist_id}","starred_url":"https://api.github.com/users/embark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/embark/subscriptions","organizations_url":"https://api.github.com/users/embark/orgs","repos_url":"https://api.github.com/users/embark/repos","events_url":"https://api.github.com/users/embark/events{/privacy}","received_events_url":"https://api.github.com/users/embark/received_events","type":"User","site_admin":false},"created_at":"2015-06-04T21:31:40Z","updated_at":"2015-06-04T21:31:40Z","author_association":"NONE","body":"Thanks for following up @mikemccand \n\nIn response:\n- The docs are JSON blobs.\n- Yes, I pass in my own IDs.\n- Mostly new docs are indexed, but replacement can happen.\n- Running `GET` on `_segments`, each shard has roughly `num_committed_segments: 231` and `num_search_segments: 229`\n- There are no deletes.\n- Custom index settings include the following:\n\n```\nindex:\n  cache:\n    field.type: soft\n    field.max_size: 1g\n    filter.max_size: 1g\n  merge:\n    policy:\n      max_merge_at_once: 8\n      max_merged_segment: 2g\n      segments_per_tier: 24\n  compound_format: false\n  compound_on_flush: false\n  shard.check_on_startup: false\n  translog.flush_threshold_ops: 50000\n  store.distributor: random\n\nindices.memory.index_buffer_size: 10%\nindices.fielddata.cache.size: 40%\nindex.store.type: niofs\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109192555","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-109192555","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":109192555,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTE5MjU1NQ==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2015-06-05T07:43:42Z","updated_at":"2015-06-05T07:43:42Z","author_association":"CONTRIBUTOR","body":"OK that's a rather high segment count, which then makes ID lookups more costly (it must visit every segment).\n\nThis is exacerbated by your high `segments_per_tier` setting and `max_merged_segment`; can you change that setting back to default?  And maybe put max_merged_segment back to its default (5g)?\n\nAlso, niofs gives worse performance for id-lookup heavy use cases; can you remove that setting (let ES use the default, which switches between niofs / mmap depending on which index file is being opened)?\n\nDo you leave plenty of RAM (50% is recommended) to the OS for IO caching?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109195304","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-109195304","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":109195304,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTE5NTMwNA==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2015-06-05T07:52:48Z","updated_at":"2015-06-05T07:52:48Z","author_association":"CONTRIBUTOR","body":"Another question: what do your IDs look like, e.g. how many bytes are they typically?  Longer IDs make things slower, and which ID you use can have an impact on performance: http://blog.mikemccandless.com/2014/05/choosing-fast-unique-identifier-uuid.html\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109878635","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-109878635","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":109878635,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTg3ODYzNQ==","user":{"login":"embark","id":2575512,"node_id":"MDQ6VXNlcjI1NzU1MTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2575512?v=4","gravatar_id":"","url":"https://api.github.com/users/embark","html_url":"https://github.com/embark","followers_url":"https://api.github.com/users/embark/followers","following_url":"https://api.github.com/users/embark/following{/other_user}","gists_url":"https://api.github.com/users/embark/gists{/gist_id}","starred_url":"https://api.github.com/users/embark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/embark/subscriptions","organizations_url":"https://api.github.com/users/embark/orgs","repos_url":"https://api.github.com/users/embark/repos","events_url":"https://api.github.com/users/embark/events{/privacy}","received_events_url":"https://api.github.com/users/embark/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T06:24:24Z","updated_at":"2015-06-08T06:24:24Z","author_association":"NONE","body":"In followup, @mikemccand, \n\nI let the all merge policies for `segments_per_tier`, `max_merged_segment`, and `max_merge_at_once`  go back to the defaults as well as `index.store.type`. There should be plenty of RAM...\n\nI let the changes soak a little, but sadly performance is still slow, and disk read IO is actually slightly higher now. \n\nMy ID's are about 13 bytes long, but I'm afraid that that the ID length isn't very changeable. The ID length was the same before the upgrade as well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/109928143","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-109928143","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":109928143,"node_id":"MDEyOklzc3VlQ29tbWVudDEwOTkyODE0Mw==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T09:29:17Z","updated_at":"2015-06-08T09:29:17Z","author_association":"CONTRIBUTOR","body":"Hmm that's odd that you see no improvement from those changes.\n\nCan you confirm segments counts per shard came down to normal (~30-40) levels once you cut back to defaults for the merge policy?\n\n13 byte IDs is not bad; I've seen much worse!\n\nWhat IO system are you using?\n\nCan you run the diagnostics plugin (https://github.com/elastic/elasticsearch-support-diagnostics) and post the results?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115484800","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-115484800","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":115484800,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTQ4NDgwMA==","user":{"login":"embark","id":2575512,"node_id":"MDQ6VXNlcjI1NzU1MTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2575512?v=4","gravatar_id":"","url":"https://api.github.com/users/embark","html_url":"https://github.com/embark","followers_url":"https://api.github.com/users/embark/followers","following_url":"https://api.github.com/users/embark/following{/other_user}","gists_url":"https://api.github.com/users/embark/gists{/gist_id}","starred_url":"https://api.github.com/users/embark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/embark/subscriptions","organizations_url":"https://api.github.com/users/embark/orgs","repos_url":"https://api.github.com/users/embark/repos","events_url":"https://api.github.com/users/embark/events{/privacy}","received_events_url":"https://api.github.com/users/embark/received_events","type":"User","site_admin":false},"created_at":"2015-06-26T03:15:03Z","updated_at":"2015-06-26T17:53:52Z","author_association":"NONE","body":"@mikemccand Sorry for the delay! And thank you for all the help so far. \n\nThe segments counts per shard are roughly 80-90 now, so a bit higher than what you expect, but still a lot lower.\n\nNot totally sure what you mean by IO system. Do you mean filesystem? (Edit: It occurs to me to tell you that I'm using spinny disks rather than SSD)\n\nHere is the diagnostic run: https://gist.github.com/embark/54ae58bdf9755ddd90ce\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/116244908","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-116244908","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":116244908,"node_id":"MDEyOklzc3VlQ29tbWVudDExNjI0NDkwOA==","user":{"login":"mikemccand","id":796508,"node_id":"MDQ6VXNlcjc5NjUwOA==","avatar_url":"https://avatars0.githubusercontent.com/u/796508?v=4","gravatar_id":"","url":"https://api.github.com/users/mikemccand","html_url":"https://github.com/mikemccand","followers_url":"https://api.github.com/users/mikemccand/followers","following_url":"https://api.github.com/users/mikemccand/following{/other_user}","gists_url":"https://api.github.com/users/mikemccand/gists{/gist_id}","starred_url":"https://api.github.com/users/mikemccand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikemccand/subscriptions","organizations_url":"https://api.github.com/users/mikemccand/orgs","repos_url":"https://api.github.com/users/mikemccand/repos","events_url":"https://api.github.com/users/mikemccand/events{/privacy}","received_events_url":"https://api.github.com/users/mikemccand/received_events","type":"User","site_admin":false},"created_at":"2015-06-28T09:38:10Z","updated_at":"2015-06-28T09:38:10Z","author_association":"CONTRIBUTOR","body":"> Here is the diagnostic run:\n\nThanks, I see lots of time spent throttling.  Can you disable or increase store merge IO throttling?  https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules-store.html#store-throttling\n\nThe default (20 MB/sec) is very low (in ES 2.0 this will auto-adapt).\n\n> The segments counts per shard are roughly 80-90 now, \n\nThat's still too high, I'm not sure why.  Was this taken while indexing was still running?  Could be there were merges in flight.\n\n> I'm using spinny disks rather than SSD\n\nOK, slow :)  Try setting `index.merge.scheduler.max_thread_count` to 1 which should net/net allow merges to complete faster.  Also see https://www.elastic.co/blog/performance-considerations-elasticsearch-indexing for more ideas.\n\nYou should probably upgrade from 1.8.0_25.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/117295355","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-117295355","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":117295355,"node_id":"MDEyOklzc3VlQ29tbWVudDExNzI5NTM1NQ==","user":{"login":"embark","id":2575512,"node_id":"MDQ6VXNlcjI1NzU1MTI=","avatar_url":"https://avatars1.githubusercontent.com/u/2575512?v=4","gravatar_id":"","url":"https://api.github.com/users/embark","html_url":"https://github.com/embark","followers_url":"https://api.github.com/users/embark/followers","following_url":"https://api.github.com/users/embark/following{/other_user}","gists_url":"https://api.github.com/users/embark/gists{/gist_id}","starred_url":"https://api.github.com/users/embark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/embark/subscriptions","organizations_url":"https://api.github.com/users/embark/orgs","repos_url":"https://api.github.com/users/embark/repos","events_url":"https://api.github.com/users/embark/events{/privacy}","received_events_url":"https://api.github.com/users/embark/received_events","type":"User","site_admin":false},"created_at":"2015-06-30T18:34:23Z","updated_at":"2015-06-30T18:34:23Z","author_association":"NONE","body":"> That's still too high, I'm not sure why. Was this taken while indexing was still running? Could be there were merges in flight.\n\nYes, indexing is constantly happening, so it was taking while indexing was running. However, I turned it off for a little and still saw around 80-90 segments.\n\nSo far nothing helps, but I'll take a look at the document!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/172638147","html_url":"https://github.com/elastic/elasticsearch/issues/11499#issuecomment-172638147","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11499","id":172638147,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MjYzODE0Nw==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-18T20:02:15Z","updated_at":"2016-01-18T20:02:15Z","author_association":"CONTRIBUTOR","body":"Nothing more in the last 7 months - closing\n","performed_via_github_app":null}]