{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498/events","html_url":"https://github.com/elastic/elasticsearch/issues/5498","id":29993005,"node_id":"MDU6SXNzdWUyOTk5MzAwNQ==","number":5498,"title":"Term aggregations extraordinarily slow on Windows (ES 1.0.1)","user":{"login":"BrandesEric","id":640877,"node_id":"MDQ6VXNlcjY0MDg3Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/640877?v=4","gravatar_id":"","url":"https://api.github.com/users/BrandesEric","html_url":"https://github.com/BrandesEric","followers_url":"https://api.github.com/users/BrandesEric/followers","following_url":"https://api.github.com/users/BrandesEric/following{/other_user}","gists_url":"https://api.github.com/users/BrandesEric/gists{/gist_id}","starred_url":"https://api.github.com/users/BrandesEric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BrandesEric/subscriptions","organizations_url":"https://api.github.com/users/BrandesEric/orgs","repos_url":"https://api.github.com/users/BrandesEric/repos","events_url":"https://api.github.com/users/BrandesEric/events{/privacy}","received_events_url":"https://api.github.com/users/BrandesEric/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-03-23T18:04:02Z","updated_at":"2015-10-12T13:18:18Z","closed_at":"2014-03-24T13:19:42Z","author_association":"NONE","active_lock_reason":null,"body":"I'm working on an app that makes liberal use of term facets.  I have a query right now that takes about **1.5** seconds using term facets.  I switched to try out the new aggregations, and the same query using aggregations now takes over 360 seconds. (**6 mins!**).  This is on a 3 node cluster running in a windows environment.  And while running, it literally makes the node that received the query completely unresponsive.  To the point where the cluster thinks it's gone.  Sometimes it never returns, either, and i have to bounce the service on the box.\n\nHere is the original query:\n\n``` javascript\n   \"query\": {\n      \"match_all\": {}\n   },\n   \"size\": 0,\n   \"facets\": {\n      \"url\": {\n         \"terms\": {\n            \"field\": \"url\",\n            \"size\":20\n         }\n      }\n   }\n```\n\nHere is the new query with aggregations:\n\n``` javascript\n   \"query\": {\n      \"match_all\": {}\n   },\n   \"size\": 0,\n   \"aggs\": {\n      \"url\": {\n         \"terms\": {\n            \"field\": \"url\",\n            \"size\":20\n         }\n      }\n   }\n```\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}