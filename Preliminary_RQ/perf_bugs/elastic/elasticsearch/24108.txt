{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/24108","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24108/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24108/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24108/events","html_url":"https://github.com/elastic/elasticsearch/issues/24108","id":221782301,"node_id":"MDU6SXNzdWUyMjE3ODIzMDE=","number":24108,"title":"Percolator: High memory usage issue when nested query is registered","user":{"login":"anatoly21","id":27484990,"node_id":"MDQ6VXNlcjI3NDg0OTkw","avatar_url":"https://avatars3.githubusercontent.com/u/27484990?v=4","gravatar_id":"","url":"https://api.github.com/users/anatoly21","html_url":"https://github.com/anatoly21","followers_url":"https://api.github.com/users/anatoly21/followers","following_url":"https://api.github.com/users/anatoly21/following{/other_user}","gists_url":"https://api.github.com/users/anatoly21/gists{/gist_id}","starred_url":"https://api.github.com/users/anatoly21/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anatoly21/subscriptions","organizations_url":"https://api.github.com/users/anatoly21/orgs","repos_url":"https://api.github.com/users/anatoly21/repos","events_url":"https://api.github.com/users/anatoly21/events{/privacy}","received_events_url":"https://api.github.com/users/anatoly21/received_events","type":"User","site_admin":false},"labels":[{"id":156502592,"node_id":"MDU6TGFiZWwxNTY1MDI1OTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Percolator","name":":Search/Percolator","color":"0e8a16","default":false,"description":"Reverse search: find queries that match a document"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2017-04-14T10:09:17Z","updated_at":"2017-04-26T09:27:48Z","closed_at":"2017-04-26T09:27:48Z","author_association":"NONE","active_lock_reason":null,"body":"ES version: 5.2.2.\r\nJDK: 1.8.0_65\r\nOS version: Ubuntu 14.04.4 \r\n\r\nWe faced high memory usage issue when using percolator.\r\nDedicated index is configured for percolator.\r\nIt works as expected and JVM heap usage picture is \r\n\r\n![without_nested_queries](https://cloud.githubusercontent.com/assets/27484990/25040396/b5e6e152-2111-11e7-92db-3182e11dc73c.JPG)\r\n\r\nAfter registering a nested nested query the picture changes and there is a steady grow of used memory and CPU on the same input document set\r\n\r\n![with_nested_query](https://cloud.githubusercontent.com/assets/27484990/25040463/2acc2f0e-2112-11e7-8a10-2edc730e4fc9.JPG)\r\n\r\nInput documents contain up to hundred of nested documents. Caching settings are by default.\r\n\r\nMemory dump:\r\n![memory1](https://cloud.githubusercontent.com/assets/27484990/25040531/a17841ba-2112-11e7-98d3-b1060a68ad4a.JPG)\r\n![memory2](https://cloud.githubusercontent.com/assets/27484990/25040536/a59bfbe2-2112-11e7-8e43-16212e0d7333.JPG)\r\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}