[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309403689","html_url":"https://github.com/elastic/elasticsearch/issues/25278#issuecomment-309403689","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278","id":309403689,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTQwMzY4OQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-19T10:41:10Z","updated_at":"2017-06-19T10:41:10Z","author_association":"MEMBER","body":"@dennisgorelik What kind of queries are you using in your percolator queries?\r\n\r\nThe percolator in 2.x and before cached all queries into memory. In 5.x the percolator this cache was removed (it didn't really scale well) and the percolator was improved to smarter select which percolator queries need to be evaluated instead of evaluating all queries all the time.  The selecting of candidate percolate queries is done based on query term extracting done at index time. Unfortunately we can't yet extract terms from all queries (range and wildcard queries for example), so in that case these queries will still always need to be evaluated.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309409364","html_url":"https://github.com/elastic/elasticsearch/issues/25278#issuecomment-309409364","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278","id":309409364,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTQwOTM2NA==","user":{"login":"dennisgorelik","id":4333866,"node_id":"MDQ6VXNlcjQzMzM4NjY=","avatar_url":"https://avatars2.githubusercontent.com/u/4333866?v=4","gravatar_id":"","url":"https://api.github.com/users/dennisgorelik","html_url":"https://github.com/dennisgorelik","followers_url":"https://api.github.com/users/dennisgorelik/followers","following_url":"https://api.github.com/users/dennisgorelik/following{/other_user}","gists_url":"https://api.github.com/users/dennisgorelik/gists{/gist_id}","starred_url":"https://api.github.com/users/dennisgorelik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dennisgorelik/subscriptions","organizations_url":"https://api.github.com/users/dennisgorelik/orgs","repos_url":"https://api.github.com/users/dennisgorelik/repos","events_url":"https://api.github.com/users/dennisgorelik/events{/privacy}","received_events_url":"https://api.github.com/users/dennisgorelik/received_events","type":"User","site_admin":false},"created_at":"2017-06-19T11:09:49Z","updated_at":"2017-06-19T11:12:13Z","author_association":"NONE","body":"@martijnvg - below are 10 examples of our percolator queries (out of 227906 total we have).\r\nAs you can see - we do not use wildcards, but we use boolean queries.\r\nWe use geo filters. Usually we specify exact lat/lng coordinates + distance, but we also use country&state exact match.\r\nDo you consider such queries - a range query?\r\n```\r\ncurl -X GET \"http://localhost:9201/percolatejobs/jobalert/_search?pretty=true\" -d \"{\\\"query\\\" : {\\\"match_all\\\" : {}}}\"\r\n{\r\n  \"took\" : 13,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 8,\r\n    \"successful\" : 8,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 227906,\r\n    \"max_score\" : 1.0,\r\n    \"hits\" : [\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"72110\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"ELECTRONICS AND ENGINEER\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"geo_distance\" : {\r\n                    \"distance\" : \"50mi\",\r\n                    \"Location\" : {\r\n                      \"lat\" : 10.765833,\r\n                      \"lon\" : 78.714722\r\n                    }\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071540\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"103943\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"ALUMINIUM\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"geo_distance\" : {\r\n                    \"distance\" : \"50mi\",\r\n                    \"Location\" : {\r\n                      \"lat\" : 19.707887,\r\n                      \"lon\" : 83.366332\r\n                    }\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071541\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"103984\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"MANAGEMENT AND PROJECT\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"term\" : {\r\n                    \"Country\" : \"IN\"\r\n                  }\r\n                },\r\n                {\r\n                  \"term\" : {\r\n                    \"State\" : \"WB\"\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071541\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"103986\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"SIS\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071542\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"103989\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"HSE AND SAFETY\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"geo_distance\" : {\r\n                    \"distance\" : \"50mi\",\r\n                    \"Location\" : {\r\n                      \"lat\" : 36.319356,\r\n                      \"lon\" : -115.022874\r\n                    }\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071542\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"104007\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"(DESKTOP AND TECH AND SUPPORT) OR (NETWORK AND ENGINEER)\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"geo_distance\" : {\r\n                    \"distance\" : \"50mi\",\r\n                    \"Location\" : {\r\n                      \"lat\" : 33.956215,\r\n                      \"lon\" : -83.987962\r\n                    }\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071542\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"104027\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"OIL AND GAS AND ENERGY AND PARTS AND PROFESSIONAL\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"geo_distance\" : {\r\n                    \"distance\" : \"50mi\",\r\n                    \"Location\" : {\r\n                      \"lat\" : 40.063582,\r\n                      \"lon\" : -75.078636\r\n                    }\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071542\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"104029\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"MANANGER\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"geo_distance\" : {\r\n                    \"distance\" : \"50mi\",\r\n                    \"Location\" : {\r\n                      \"lat\" : 33.785795,\r\n                      \"lon\" : -118.264357\r\n                    }\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071542\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"104039\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"SPECIAL AND EDUCATION AND TEACHERS\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"geo_distance\" : {\r\n                    \"distance\" : \"50mi\",\r\n                    \"Location\" : {\r\n                      \"lat\" : 39.930668,\r\n                      \"lon\" : -75.320188\r\n                    }\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071542\r\n        }\r\n      },\r\n      {\r\n        \"_index\" : \"percolatejobs\",\r\n        \"_type\" : \"jobalert\",\r\n        \"_id\" : \"104042\",\r\n        \"_score\" : 1.0,\r\n        \"_source\" : {\r\n          \"query\" : {\r\n            \"bool\" : {\r\n              \"must\" : [\r\n                {\r\n                  \"query_string\" : {\r\n                    \"fields\" : [\r\n                      \"JobTitle\",\r\n                      \"JobDescription\",\r\n                      \"CompanyName\",\r\n                      \"Salary\"\r\n                    ],\r\n                    \"query\" : \"VITAE\",\r\n                    \"analyzer\" : \"pjfqueryanalyzer\"\r\n                  }\r\n                },\r\n                {\r\n                  \"geo_distance\" : {\r\n                    \"distance\" : \"50mi\",\r\n                    \"Location\" : {\r\n                      \"lat\" : 14.629796,\r\n                      \"lon\" : 121.137723\r\n                    }\r\n                  }\r\n                }\r\n              ]\r\n            }\r\n          },\r\n          \"SystemUpdateDate\" : 1497595071542\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}\r\n\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309669962","html_url":"https://github.com/elastic/elasticsearch/issues/25278#issuecomment-309669962","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278","id":309669962,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTY2OTk2Mg==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-20T07:35:09Z","updated_at":"2017-06-20T07:35:09Z","author_association":"MEMBER","body":"@dennisgorelik At index time the percolator can't analyze `geo_distance` queries, so percolator queries containing these queries may always need to be evaluated by the `percolate` query. \r\n\r\nHowever in your case the `geo_distance` queries are part of a `bool` with two must clauses (this wouldn't be possible with should clauses), which means at index time during query analysis it is able to ignore the unsupported query. So it will preselect these queries based on the other must clause containing the `query_string` query. This will still allow the percolator to skip over a lot of percolator queries.\r\n\r\nCan you run the query that is described here:\r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/5.4/query-dsl-percolate-query.html#_how_it_works_under_the_hood\r\n\r\nThis will tell for how many queries the extraction process at index time was failed and indicates how many percolator queries always need to be evaluated when percolating. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309990544","html_url":"https://github.com/elastic/elasticsearch/issues/25278#issuecomment-309990544","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278","id":309990544,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTk5MDU0NA==","user":{"login":"dennisgorelik","id":4333866,"node_id":"MDQ6VXNlcjQzMzM4NjY=","avatar_url":"https://avatars2.githubusercontent.com/u/4333866?v=4","gravatar_id":"","url":"https://api.github.com/users/dennisgorelik","html_url":"https://github.com/dennisgorelik","followers_url":"https://api.github.com/users/dennisgorelik/followers","following_url":"https://api.github.com/users/dennisgorelik/following{/other_user}","gists_url":"https://api.github.com/users/dennisgorelik/gists{/gist_id}","starred_url":"https://api.github.com/users/dennisgorelik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dennisgorelik/subscriptions","organizations_url":"https://api.github.com/users/dennisgorelik/orgs","repos_url":"https://api.github.com/users/dennisgorelik/repos","events_url":"https://api.github.com/users/dennisgorelik/events{/privacy}","received_events_url":"https://api.github.com/users/dennisgorelik/received_events","type":"User","site_admin":false},"created_at":"2017-06-21T07:42:41Z","updated_at":"2017-06-21T07:42:41Z","author_association":"NONE","body":"\r\n\r\n@martijnvg \r\nIt looks like only 724 alerts (out of 227907 total) were marked for mandatory percolation:\r\n```\r\nGET /_search\r\n{\r\n  \"query\": {\r\n    \"term\" : {\r\n      \"query.extraction_result\" : \"failed\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n```\r\n{\r\n   \"took\": 0,\r\n   \"timed_out\": false,\r\n   \"_shards\": {\r\n      \"total\": 20,\r\n      \"successful\": 20,\r\n      \"failed\": 0\r\n   },\r\n   \"hits\": {\r\n      \"total\": 724,\r\n      \"max_score\": 5.895347,\r\n      \"hits\": [\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"13180\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"15mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 26.976171,\r\n                                       \"lon\": -82.090645\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014903959\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"1457\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"25mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 19.8853,\r\n                                       \"lon\": 75.319656\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014903997\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"10240\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"25mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 26.846511,\r\n                                       \"lon\": 80.946683\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014904008\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"3802\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"25mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 26.720249,\r\n                                       \"lon\": 88.424583\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014904015\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"16858\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"25mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 34.540024,\r\n                                       \"lon\": -112.468503\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014904105\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"221\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"25mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 35.686975,\r\n                                       \"lon\": -105.937799\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014904260\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"23996\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"25mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 33.68906,\r\n                                       \"lon\": -78.886694\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014904319\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"27614\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"25mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 38.36119,\r\n                                       \"lon\": -97.654811\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014904380\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"32521\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"25mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 33.68906,\r\n                                       \"lon\": -78.886694\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014904468\r\n            }\r\n         },\r\n         {\r\n            \"_index\": \"percolatejobs\",\r\n            \"_type\": \"jobalert\",\r\n            \"_id\": \"42273\",\r\n            \"_score\": 5.895347,\r\n            \"_source\": {\r\n               \"query\": {\r\n                  \"bool\": {\r\n                     \"must\": {\r\n                        \"match_all\": {}\r\n                     },\r\n                     \"filter\": {\r\n                        \"bool\": {\r\n                           \"must\": [\r\n                              {\r\n                                 \"geo_distance\": {\r\n                                    \"distance\": \"50mi\",\r\n                                    \"Location\": {\r\n                                       \"lat\": 18.050193,\r\n                                       \"lon\": 78.2647\r\n                                    }\r\n                                 }\r\n                              }\r\n                           ]\r\n                        }\r\n                     }\r\n                  }\r\n               },\r\n               \"SystemUpdateDate\": 1498014904646\r\n            }\r\n         }\r\n      ]\r\n   }\r\n}\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/309996901","html_url":"https://github.com/elastic/elasticsearch/issues/25278#issuecomment-309996901","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278","id":309996901,"node_id":"MDEyOklzc3VlQ29tbWVudDMwOTk5NjkwMQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-06-21T08:05:07Z","updated_at":"2017-06-21T08:05:07Z","author_association":"MEMBER","body":"Thanks @dennisgorelik, then I think in your case the preselection isn't excluding a lot of percolator queries. This can be in case a document gets percolated that contains terms that most of your percolator queries have.\r\n\r\nMaybe the cache that the percolator had before should be brought back in a different form. (it should definitively not be unbounded like it was before)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/331458919","html_url":"https://github.com/elastic/elasticsearch/issues/25278#issuecomment-331458919","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278","id":331458919,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMTQ1ODkxOQ==","user":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"created_at":"2017-09-22T14:14:08Z","updated_at":"2017-09-22T14:14:08Z","author_association":"MEMBER","body":"Closed in favour of #25445","performed_via_github_app":null}]