{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/59545","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/59545/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/59545/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/59545/events","html_url":"https://github.com/elastic/elasticsearch/issues/59545","id":656695679,"node_id":"MDU6SXNzdWU2NTY2OTU2Nzk=","number":59545,"title":"ILM delete phase is extremly slow","user":{"login":"hatharom","id":15161542,"node_id":"MDQ6VXNlcjE1MTYxNTQy","avatar_url":"https://avatars2.githubusercontent.com/u/15161542?v=4","gravatar_id":"","url":"https://api.github.com/users/hatharom","html_url":"https://github.com/hatharom","followers_url":"https://api.github.com/users/hatharom/followers","following_url":"https://api.github.com/users/hatharom/following{/other_user}","gists_url":"https://api.github.com/users/hatharom/gists{/gist_id}","starred_url":"https://api.github.com/users/hatharom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hatharom/subscriptions","organizations_url":"https://api.github.com/users/hatharom/orgs","repos_url":"https://api.github.com/users/hatharom/repos","events_url":"https://api.github.com/users/hatharom/events{/privacy}","received_events_url":"https://api.github.com/users/hatharom/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":2042400575,"node_id":"MDU6TGFiZWwyMDQyNDAwNTc1","url":"https://api.github.com/repos/elastic/elasticsearch/labels/needs:triage","name":"needs:triage","color":"c5def5","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-07-14T15:19:57Z","updated_at":"2020-07-14T16:04:55Z","closed_at":"2020-07-14T16:04:55Z","author_association":"NONE","active_lock_reason":null,"body":"ES 7.7.1 running in docker\r\n\r\nIn short: Delete phase stucks at  \"step\": \"wait-for-shard-history-leases\"\r\n\r\nIn details:\r\n\r\nI have created a basic delete policy:\r\n\r\n```\r\n\"test_policy\": {\r\n    \"version\": 1,\r\n    \"modified_date\": \"2020-07-13T11:38:15.283Z\",\r\n    \"policy\": {\r\n        \"phases\": {\r\n            \"delete\": {\r\n                \"min_age\": \"60s\",\r\n                \"actions\": {\r\n                    \"delete\": {}\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n```\r\nPUT _template/my_template\r\n\r\n```\r\n{\r\n  \"index_patterns\": [\"test-*\"], \r\n  \"settings\": {\r\n    \"number_of_shards\": 1,\r\n    \"number_of_replicas\": 1,\r\n    \"index.lifecycle.name\": \"test_policy\" \r\n  }\r\n}\r\n```\r\nthen I PUT two indices : test-2017-11-12 and test-2222\r\n\r\nExpected outcome : after ~60s (+ some time for the real work) the index get deleted\r\n\r\nActual Outcome: \r\n\r\nWhat happened (according to http://localhost:9200/test-*/_ilm/explain ) is that both indices phase is 'new' even after minutes. Then after 4-5min one index switched to \"delete\" phase and stucks there. The other one is still in 'new' phase.\r\n\r\n```\r\n\"test-2017-11-12\": {\r\n    \"index\": \"test-2017-11-12\",\r\n    \"managed\": true,\r\n    \"policy\": \"test_policy\",\r\n    \"lifecycle_date_millis\": 1594640489746,\r\n    \"age\": \"13.69m\",\r\n    \"phase\": \"delete\",\r\n    \"phase_time_millis\": 1594640734626,\r\n    \"action\": \"delete\",\r\n    \"action_time_millis\": 1594640734626,\r\n    \"step\": \"wait-for-shard-history-leases\",\r\n    \"step_time_millis\": 1594640734626,\r\n    \"phase_execution\": {\r\n        \"policy\": \"test_policy\",\r\n        \"phase_definition\": {\r\n            \"min_age\": \"60s\",\r\n            \"actions\": {\r\n                \"delete\": {}\r\n            }\r\n        },\r\n        \"version\": 1,\r\n        \"modified_date_in_millis\": 1594640295283\r\n    }\r\n}\r\n```\r\n\r\nAnd finally after 17min!!! the index gets deleted, now the other one stucks at the same phase\r\n\r\n1.What is this 'wait-for-shard-history-leases' thing? Couldn't find anything about it in the ES documentation.\r\n2.Even if one hangs at the 'delete' phase why the other index gets blocked by this? Why not all the indices over 10s age go to the delete phase?","closed_by":{"login":"dakrone","id":19060,"node_id":"MDQ6VXNlcjE5MDYw","avatar_url":"https://avatars3.githubusercontent.com/u/19060?v=4","gravatar_id":"","url":"https://api.github.com/users/dakrone","html_url":"https://github.com/dakrone","followers_url":"https://api.github.com/users/dakrone/followers","following_url":"https://api.github.com/users/dakrone/following{/other_user}","gists_url":"https://api.github.com/users/dakrone/gists{/gist_id}","starred_url":"https://api.github.com/users/dakrone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dakrone/subscriptions","organizations_url":"https://api.github.com/users/dakrone/orgs","repos_url":"https://api.github.com/users/dakrone/repos","events_url":"https://api.github.com/users/dakrone/events{/privacy}","received_events_url":"https://api.github.com/users/dakrone/received_events","type":"User","site_admin":false},"performed_via_github_app":null}