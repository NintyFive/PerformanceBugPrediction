[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/316670192","html_url":"https://github.com/elastic/elasticsearch/issues/25786#issuecomment-316670192","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786","id":316670192,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNjY3MDE5Mg==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-07-20T11:01:31Z","updated_at":"2017-07-20T11:01:31Z","author_association":"MEMBER","body":"Are you using `type:phrase` or `type:phrase_prefix` in your `multi_match`query ? Can you share some queries and give some insights regarding your performance tests (number of queries, methodology, ...). ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/316919168","html_url":"https://github.com/elastic/elasticsearch/issues/25786#issuecomment-316919168","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786","id":316919168,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNjkxOTE2OA==","user":{"login":"ShilpiRachna","id":27772104,"node_id":"MDQ6VXNlcjI3NzcyMTA0","avatar_url":"https://avatars1.githubusercontent.com/u/27772104?v=4","gravatar_id":"","url":"https://api.github.com/users/ShilpiRachna","html_url":"https://github.com/ShilpiRachna","followers_url":"https://api.github.com/users/ShilpiRachna/followers","following_url":"https://api.github.com/users/ShilpiRachna/following{/other_user}","gists_url":"https://api.github.com/users/ShilpiRachna/gists{/gist_id}","starred_url":"https://api.github.com/users/ShilpiRachna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShilpiRachna/subscriptions","organizations_url":"https://api.github.com/users/ShilpiRachna/orgs","repos_url":"https://api.github.com/users/ShilpiRachna/repos","events_url":"https://api.github.com/users/ShilpiRachna/events{/privacy}","received_events_url":"https://api.github.com/users/ShilpiRachna/received_events","type":"User","site_admin":false},"created_at":"2017-07-21T06:48:29Z","updated_at":"2017-07-21T06:48:29Z","author_association":"NONE","body":"Yes, we are using type:phrase in our query (but not type:phrase_prefix).\r\n\r\nHere's a sample query:\r\n[SampleQuery.txt](https://github.com/elastic/elasticsearch/files/1164676/SampleQuery.txt)\r\n\r\nPerformance tests were done with ~1500 different queries after indexing 1 million documents in single shard, zero replica index. We logged query performance for each query and compared the 50th, 80, 95th percentile numbers for ES 5.5 against ES 2.4.1\r\n\r\nThanks!\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/317509648","html_url":"https://github.com/elastic/elasticsearch/issues/25786#issuecomment-317509648","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786","id":317509648,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNzUwOTY0OA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2017-07-24T18:17:12Z","updated_at":"2017-07-24T18:17:12Z","author_association":"MEMBER","body":"Unlike the `unified` highlighter, the `postings` highlighter ignores phrase query and only extract the terms regardless of their position.\r\nThat could explain the performance hit when you use the `unified` highlighter. There are options in the `unified` to disable phrase query highlighting but there are not settable in es. Though you can still disable phrase query by using a different `highlight_query`.\r\nRegarding the performance tests, you should use the same version to compare highlighting perf otherwise you're just comparing two major versions with a lot more differences than just highlighting.\r\nI hope you don't mind but I'll close this issue as it is not a bug. I really appreciate that you test the new `unified` highlighter but we should continue this discussion in the forum instead (https://discuss.elastic.co/c/elasticsearch) and if your perf tests find real bugs or regressions we can create verified issues here.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/374540151","html_url":"https://github.com/elastic/elasticsearch/issues/25786#issuecomment-374540151","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786","id":374540151,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NDU0MDE1MQ==","user":{"login":"DivyaMalini","id":9256460,"node_id":"MDQ6VXNlcjkyNTY0NjA=","avatar_url":"https://avatars1.githubusercontent.com/u/9256460?v=4","gravatar_id":"","url":"https://api.github.com/users/DivyaMalini","html_url":"https://github.com/DivyaMalini","followers_url":"https://api.github.com/users/DivyaMalini/followers","following_url":"https://api.github.com/users/DivyaMalini/following{/other_user}","gists_url":"https://api.github.com/users/DivyaMalini/gists{/gist_id}","starred_url":"https://api.github.com/users/DivyaMalini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DivyaMalini/subscriptions","organizations_url":"https://api.github.com/users/DivyaMalini/orgs","repos_url":"https://api.github.com/users/DivyaMalini/repos","events_url":"https://api.github.com/users/DivyaMalini/events{/privacy}","received_events_url":"https://api.github.com/users/DivyaMalini/received_events","type":"User","site_admin":false},"created_at":"2018-03-20T10:02:07Z","updated_at":"2018-03-20T10:02:07Z","author_association":"NONE","body":"@jimczi , as per our discussion at ElasticOn18, I am using this thread to continue investigation on why move to unified highlighter, is contributing to _perf issues at high scale_ that we are dealing with. \r\n\r\nThe thread already has info on the mapping etc. Do let us know if you need any other data to help us understand the degradation in perf.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/375470797","html_url":"https://github.com/elastic/elasticsearch/issues/25786#issuecomment-375470797","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786","id":375470797,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NTQ3MDc5Nw==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2018-03-22T21:56:26Z","updated_at":"2018-03-22T21:56:26Z","author_association":"MEMBER","body":"@DivyaMalini I am not surprised that the `unified` is slower than the `postings` on a `match_phrase` query. This is expected since the `postings` highlighter ignores phrase queries,  this highlighter as meant to perform simple query terms highlighting, regardless of their positions. Did you try to override the `highlight_query` to change the `match_phrase` into a simple `match` query ?\r\nThat's what the `postings` highlighter does under the hood so the comparison would have more sense and you should be able to compare the results more easily (they should highlight the same things).\r\nA phrase query is more costly than a disjunction of terms so I'd expect more similar performance if you change the `highlight_query` in the `unified` highlighter tests.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/377263875","html_url":"https://github.com/elastic/elasticsearch/issues/25786#issuecomment-377263875","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786","id":377263875,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NzI2Mzg3NQ==","user":{"login":"DivyaMalini","id":9256460,"node_id":"MDQ6VXNlcjkyNTY0NjA=","avatar_url":"https://avatars1.githubusercontent.com/u/9256460?v=4","gravatar_id":"","url":"https://api.github.com/users/DivyaMalini","html_url":"https://github.com/DivyaMalini","followers_url":"https://api.github.com/users/DivyaMalini/followers","following_url":"https://api.github.com/users/DivyaMalini/following{/other_user}","gists_url":"https://api.github.com/users/DivyaMalini/gists{/gist_id}","starred_url":"https://api.github.com/users/DivyaMalini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DivyaMalini/subscriptions","organizations_url":"https://api.github.com/users/DivyaMalini/orgs","repos_url":"https://api.github.com/users/DivyaMalini/repos","events_url":"https://api.github.com/users/DivyaMalini/events{/privacy}","received_events_url":"https://api.github.com/users/DivyaMalini/received_events","type":"User","site_admin":false},"created_at":"2018-03-29T15:00:34Z","updated_at":"2018-03-29T15:00:34Z","author_association":"NONE","body":"Thanks @jimczi . We will try to focus on using  _match_ to get better comparisons of perf state.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398360929","html_url":"https://github.com/elastic/elasticsearch/issues/25786#issuecomment-398360929","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25786","id":398360929,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODM2MDkyOQ==","user":{"login":"ShilpiRachna","id":27772104,"node_id":"MDQ6VXNlcjI3NzcyMTA0","avatar_url":"https://avatars1.githubusercontent.com/u/27772104?v=4","gravatar_id":"","url":"https://api.github.com/users/ShilpiRachna","html_url":"https://github.com/ShilpiRachna","followers_url":"https://api.github.com/users/ShilpiRachna/followers","following_url":"https://api.github.com/users/ShilpiRachna/following{/other_user}","gists_url":"https://api.github.com/users/ShilpiRachna/gists{/gist_id}","starred_url":"https://api.github.com/users/ShilpiRachna/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShilpiRachna/subscriptions","organizations_url":"https://api.github.com/users/ShilpiRachna/orgs","repos_url":"https://api.github.com/users/ShilpiRachna/repos","events_url":"https://api.github.com/users/ShilpiRachna/events{/privacy}","received_events_url":"https://api.github.com/users/ShilpiRachna/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T11:05:27Z","updated_at":"2018-06-19T11:05:27Z","author_association":"NONE","body":"As suggested by you, we tried highlight_query with _match_ for all fields that are included for highlighting . **The query performance is much better even for single term queries.**\r\n\r\nWould like to understand why is highlight_query so much faster that search query. Our search query has 3 times the number of fields as compared to highlighted fields. Does that contribute to performance degradation with highlighting? \r\n\r\nAlso, are there any recommendations regarding the usage of  _highlight_query_ .\r\n\r\nThanks!\r\nShilpi","performed_via_github_app":null}]