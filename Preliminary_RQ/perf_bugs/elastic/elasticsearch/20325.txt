{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/20325","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20325/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20325/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20325/events","html_url":"https://github.com/elastic/elasticsearch/issues/20325","id":175086824,"node_id":"MDU6SXNzdWUxNzUwODY4MjQ=","number":20325,"title":"JDBC Input plugin slowly eating PGA memory on Clobs","user":{"login":"romychs","id":22007411,"node_id":"MDQ6VXNlcjIyMDA3NDEx","avatar_url":"https://avatars1.githubusercontent.com/u/22007411?v=4","gravatar_id":"","url":"https://api.github.com/users/romychs","html_url":"https://github.com/romychs","followers_url":"https://api.github.com/users/romychs/followers","following_url":"https://api.github.com/users/romychs/following{/other_user}","gists_url":"https://api.github.com/users/romychs/gists{/gist_id}","starred_url":"https://api.github.com/users/romychs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/romychs/subscriptions","organizations_url":"https://api.github.com/users/romychs/orgs","repos_url":"https://api.github.com/users/romychs/repos","events_url":"https://api.github.com/users/romychs/events{/privacy}","received_events_url":"https://api.github.com/users/romychs/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-09-05T14:50:38Z","updated_at":"2016-09-06T19:43:48Z","closed_at":"2016-09-05T14:54:04Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 2.3.5\n\n**Plugins installed**: [none]\n\n**JVM version**: Oracle 8u102\n\n**OS version**: RHEL 6\n\n**Description of the problem including expected versus actual behavior**: I am use jdbc input plugin to transfer log messages from oracle table to ES. Input configured like:\njdbc {\n    type => \"cdr-prod\"\n    jdbc_driver_library => \"/app/logstash/lib/ojdbc7.jar\"\n    jdbc_driver_class => \"Java::oracle.jdbc.driver.OracleDriver\"\n    jdbc_connection_string => \"jdbc:oracle:thin:<some>\"\n    jdbc_user => \"log_user\"\n    jdbc_password => \"log_passwd\"\n    jdbc_fetch_size => 200\n    schedule => \"\\* \\* \\* \\* *\"\n    statement => \"SELECT logid, SUBSTR((in_xml).getClobVal(),1,8192) in_xml, SUBSTR((out_xml).getClobVal(),1,8192) out_xml FROM log_messages WHERE  logid > :sql_last_value ORDER BY logid\n    sql_log_level => \"debug\"\n    use_column_value => true\n    tracking_column => \"logid\"\n    last_run_metadata_path => \"/app/logstash/db/log_messages.since\"\n    jdbc_validate_connection => true\n    jdbc_validation_timeout => 90\n    jdbc_pool_timeout => 15\n    connection_retry_attempts => 5\n    connection_retry_attempts_wait_time => 10\n }\nlogid is primary key, in_xml and out_xml is XMLType columns. We are seeing a constant memory leak. I Think it is because plugin does not release CLOBs, and continuously reuse connection from connection pool. Connection pool does not have any parameter for connection recycle (after some time of usage, or after some count os statement execution). \n\n**Steps to reproduce**:\n1. Log in a Oracle DB table with message in  XMLType column (some kilobytes).\n2. Running Logstash v 2.3.4 with jdbc  input plugin \n\n**Provide logs (if relevant)**:\nScream from DBA, about enormous memory consumption by log_user session.\n","closed_by":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"performed_via_github_app":null}