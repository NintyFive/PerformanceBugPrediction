[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24224828","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-24224828","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":24224828,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MjI0ODI4","user":{"login":"wkasai","id":1179757,"node_id":"MDQ6VXNlcjExNzk3NTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1179757?v=4","gravatar_id":"","url":"https://api.github.com/users/wkasai","html_url":"https://github.com/wkasai","followers_url":"https://api.github.com/users/wkasai/followers","following_url":"https://api.github.com/users/wkasai/following{/other_user}","gists_url":"https://api.github.com/users/wkasai/gists{/gist_id}","starred_url":"https://api.github.com/users/wkasai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wkasai/subscriptions","organizations_url":"https://api.github.com/users/wkasai/orgs","repos_url":"https://api.github.com/users/wkasai/repos","events_url":"https://api.github.com/users/wkasai/events{/privacy}","received_events_url":"https://api.github.com/users/wkasai/received_events","type":"User","site_admin":false},"created_at":"2013-09-11T09:45:03Z","updated_at":"2013-09-11T09:45:03Z","author_association":"NONE","body":"I met the same problem ( in 0.90.3 ), I tried another way, source().extractRawValues(...), which is able to get the array data\n\nIn this case, org.apache.lucene.codecs.compressing.LZ4.decompress() takes much time in spite of getValueByOrd(). \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24225371","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-24225371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":24225371,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MjI1Mzcx","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2013-09-11T09:55:27Z","updated_at":"2013-09-11T09:55:27Z","author_association":"CONTRIBUTOR","body":"@wkasai _source is optimized for getting all values of a few documents (to display summaries in responses for example) which explains why it can be slow for scoring, since you need to get only a few field values for many documents. This is why doc() is the recommended way of accessing field values in search scripts.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24226048","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-24226048","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":24226048,"node_id":"MDEyOklzc3VlQ29tbWVudDI0MjI2MDQ4","user":{"login":"wkasai","id":1179757,"node_id":"MDQ6VXNlcjExNzk3NTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1179757?v=4","gravatar_id":"","url":"https://api.github.com/users/wkasai","html_url":"https://github.com/wkasai","followers_url":"https://api.github.com/users/wkasai/followers","following_url":"https://api.github.com/users/wkasai/following{/other_user}","gists_url":"https://api.github.com/users/wkasai/gists{/gist_id}","starred_url":"https://api.github.com/users/wkasai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wkasai/subscriptions","organizations_url":"https://api.github.com/users/wkasai/orgs","repos_url":"https://api.github.com/users/wkasai/repos","events_url":"https://api.github.com/users/wkasai/events{/privacy}","received_events_url":"https://api.github.com/users/wkasai/received_events","type":"User","site_admin":false},"created_at":"2013-09-11T10:05:20Z","updated_at":"2013-09-11T10:07:00Z","author_association":"NONE","body":"@jpountz Thanks you for your reply. I will use doc().get for my purpose. So my concern is now the same with maciejkula's. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24438247","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-24438247","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":24438247,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NDM4MjQ3","user":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"created_at":"2013-09-14T06:55:15Z","updated_at":"2013-09-14T06:55:15Z","author_association":"MEMBER","body":"I ran a performance test on 600k docs (means **16.185.000 Lucene docs** when you consider nested docs).\nI ran about **4.945.000** calls to `org.elasticsearch.index.fielddata.ScriptDocValues$Doubles.getValues()` with a total time of **138.169ms**. It means to me somehow that one call is about **0.027 ms**.\n\nLooking at the source code we really load that in cache.\n\nWe could potentially expose more methods to optimize not using a List<Double> but use our optimized iterator, but we still unsure by how much it will really help.\n\nClosing for now but feel free to reopen or add a new one.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/24469710","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-24469710","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":24469710,"node_id":"MDEyOklzc3VlQ29tbWVudDI0NDY5NzEw","user":{"login":"wkasai","id":1179757,"node_id":"MDQ6VXNlcjExNzk3NTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1179757?v=4","gravatar_id":"","url":"https://api.github.com/users/wkasai","html_url":"https://github.com/wkasai","followers_url":"https://api.github.com/users/wkasai/followers","following_url":"https://api.github.com/users/wkasai/following{/other_user}","gists_url":"https://api.github.com/users/wkasai/gists{/gist_id}","starred_url":"https://api.github.com/users/wkasai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wkasai/subscriptions","organizations_url":"https://api.github.com/users/wkasai/orgs","repos_url":"https://api.github.com/users/wkasai/repos","events_url":"https://api.github.com/users/wkasai/events{/privacy}","received_events_url":"https://api.github.com/users/wkasai/received_events","type":"User","site_admin":false},"created_at":"2013-09-15T11:21:55Z","updated_at":"2013-09-15T11:21:55Z","author_association":"NONE","body":"I reviewed inner code, finally agreed reluctantly to using iterator in this situation, Lucene seems to provide block data access step by step.\n\nhttp://svn.apache.org/repos/asf/lucene/dev/tags/lucene_solr_4_4_0/lucene/core/src/java/org/apache/lucene/util/packed/AppendingLongBuffer.java\n\nI attemped to provide arbitrary period (including past) \"trend sort\" by counting up the ordered long arrays (time of some event occurrence for a document) with binary search. This approach requires direct index-base access to data in list. \n\nI hope elasticsearch will supply such a sort option on the future, because it seems to be useful in many real services. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63041627","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-63041627","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":63041627,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDQxNjI3","user":{"login":"ghiron","id":2124281,"node_id":"MDQ6VXNlcjIxMjQyODE=","avatar_url":"https://avatars0.githubusercontent.com/u/2124281?v=4","gravatar_id":"","url":"https://api.github.com/users/ghiron","html_url":"https://github.com/ghiron","followers_url":"https://api.github.com/users/ghiron/followers","following_url":"https://api.github.com/users/ghiron/following{/other_user}","gists_url":"https://api.github.com/users/ghiron/gists{/gist_id}","starred_url":"https://api.github.com/users/ghiron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghiron/subscriptions","organizations_url":"https://api.github.com/users/ghiron/orgs","repos_url":"https://api.github.com/users/ghiron/repos","events_url":"https://api.github.com/users/ghiron/events{/privacy}","received_events_url":"https://api.github.com/users/ghiron/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T10:47:30Z","updated_at":"2014-11-14T10:51:08Z","author_association":"CONTRIBUTOR","body":"Hi guys ,\nI have the same problem here (ES 1.3.3)\n\nI need to get some \"large\" Long arrays (btw 300 and 1000 items).\n\nMy benchmark on my own data set (~18K documents)\nFirst run (so, items are not in cache) : \n- ScriptDocValues.Longs longs = docLookup.get(\"path\") : 22 510 ns / item\n- longs.getValues() : 3 576 ns / item\n\nNext runs (items are in cache) : \n- ScriptDocValues.Longs longs = docLookup.get(\"path\") : 52 ns\n- longs.getValues() : 2 401 ns\n\nSo cache system works fine but iteration to return list is slow :-(\n\nMy full scoring script spend half of execution time on this specific piece of code. It's even slower than distance calculation.\n\nAny idea / work in progress to fix this issue ?\n\nThanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63043241","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-63043241","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":63043241,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDQzMjQx","user":{"login":"maciejkula","id":2392579,"node_id":"MDQ6VXNlcjIzOTI1Nzk=","avatar_url":"https://avatars1.githubusercontent.com/u/2392579?v=4","gravatar_id":"","url":"https://api.github.com/users/maciejkula","html_url":"https://github.com/maciejkula","followers_url":"https://api.github.com/users/maciejkula/followers","following_url":"https://api.github.com/users/maciejkula/following{/other_user}","gists_url":"https://api.github.com/users/maciejkula/gists{/gist_id}","starred_url":"https://api.github.com/users/maciejkula/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maciejkula/subscriptions","organizations_url":"https://api.github.com/users/maciejkula/orgs","repos_url":"https://api.github.com/users/maciejkula/repos","events_url":"https://api.github.com/users/maciejkula/events{/privacy}","received_events_url":"https://api.github.com/users/maciejkula/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T11:00:22Z","updated_at":"2014-11-14T11:00:22Z","author_association":"CONTRIBUTOR","body":"I know that in pre 1.0 versions reading list fields reallocated memory for the array with every element (so reading n elements required n reallocations), but I think that has been fixed since.\n\nOne thing I've found helpful is accessing the underlying array storage of the `SlicedLongList` object you get from `getValues`. This helps if you iterate over your long array: https://github.com/elasticsearch/elasticsearch/blob/1816951b6b0320e7a011436c7c7519ec2bfabc6e/src/main/java/org/elasticsearch/common/util/SlicedLongList.java\n\nOne further possibility is to access the `internalValues` of `ScriptDocValues.Longs` directly, without building an intermediate `List` on `getValues`, but I haven't had much success with that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63074078","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-63074078","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":63074078,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDc0MDc4","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T14:49:13Z","updated_at":"2014-11-14T14:49:13Z","author_association":"CONTRIBUTOR","body":"@maciejkula The trade-off is that script doc values are a bit slow but are easy to interface with scripts and have a more stable API. If you have needs for better performance, you could try to talk directly to fielddata (which is where script doc values get their data), but I would like to warn you that the API is harder to use and that we reserve ourselves the right to change it anytime (eg. it happened in 1.4 in order to improve doc values support).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63079309","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-63079309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":63079309,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDc5MzA5","user":{"login":"ghiron","id":2124281,"node_id":"MDQ6VXNlcjIxMjQyODE=","avatar_url":"https://avatars0.githubusercontent.com/u/2124281?v=4","gravatar_id":"","url":"https://api.github.com/users/ghiron","html_url":"https://github.com/ghiron","followers_url":"https://api.github.com/users/ghiron/followers","following_url":"https://api.github.com/users/ghiron/following{/other_user}","gists_url":"https://api.github.com/users/ghiron/gists{/gist_id}","starred_url":"https://api.github.com/users/ghiron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghiron/subscriptions","organizations_url":"https://api.github.com/users/ghiron/orgs","repos_url":"https://api.github.com/users/ghiron/repos","events_url":"https://api.github.com/users/ghiron/events{/privacy}","received_events_url":"https://api.github.com/users/ghiron/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T15:25:02Z","updated_at":"2014-11-14T15:46:20Z","author_association":"CONTRIBUTOR","body":"@maciejkula\nI guess I missed something in your explanation because getValues method is slow so even if I use SlicedLongList object it's still slow ?\n\n@jpountz \nHow can I use fielddata ? Do you have example ?\n\nthanks\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63082332","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-63082332","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":63082332,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDgyMzMy","user":{"login":"maciejkula","id":2392579,"node_id":"MDQ6VXNlcjIzOTI1Nzk=","avatar_url":"https://avatars1.githubusercontent.com/u/2392579?v=4","gravatar_id":"","url":"https://api.github.com/users/maciejkula","html_url":"https://github.com/maciejkula","followers_url":"https://api.github.com/users/maciejkula/followers","following_url":"https://api.github.com/users/maciejkula/following{/other_user}","gists_url":"https://api.github.com/users/maciejkula/gists{/gist_id}","starred_url":"https://api.github.com/users/maciejkula/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maciejkula/subscriptions","organizations_url":"https://api.github.com/users/maciejkula/orgs","repos_url":"https://api.github.com/users/maciejkula/repos","events_url":"https://api.github.com/users/maciejkula/events{/privacy}","received_events_url":"https://api.github.com/users/maciejkula/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T15:43:30Z","updated_at":"2014-11-14T15:43:30Z","author_association":"CONTRIBUTOR","body":"Yes, getting the data is still slow. But if (like me) you do a lot of computation on the data afterwards there is some benefit from accessing the underlying array directly.\n\nSorry, I don't have an example, I don't think I ever managed to use that successfully.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63083540","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-63083540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":63083540,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDgzNTQw","user":{"login":"ghiron","id":2124281,"node_id":"MDQ6VXNlcjIxMjQyODE=","avatar_url":"https://avatars0.githubusercontent.com/u/2124281?v=4","gravatar_id":"","url":"https://api.github.com/users/ghiron","html_url":"https://github.com/ghiron","followers_url":"https://api.github.com/users/ghiron/followers","following_url":"https://api.github.com/users/ghiron/following{/other_user}","gists_url":"https://api.github.com/users/ghiron/gists{/gist_id}","starred_url":"https://api.github.com/users/ghiron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghiron/subscriptions","organizations_url":"https://api.github.com/users/ghiron/orgs","repos_url":"https://api.github.com/users/ghiron/repos","events_url":"https://api.github.com/users/ghiron/events{/privacy}","received_events_url":"https://api.github.com/users/ghiron/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T15:50:27Z","updated_at":"2014-11-14T15:51:03Z","author_association":"CONTRIBUTOR","body":"@maciejkula : sorry bad alias on my last comment about example\nI need an equivalent to [CollectionUtils.containsAny](https://commons.apache.org/proper/commons-collections/javadocs/api-3.2.1/org/apache/commons/collections/CollectionUtils.html#containsAny%28java.util.Collection, java.util.Collection%29) function : that means one single access to all this field data and on all documents.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63091350","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-63091350","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":63091350,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDkxMzUw","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T16:36:52Z","updated_at":"2014-11-14T16:36:52Z","author_association":"CONTRIBUTOR","body":"@ghiron You should be able to have access to it through DocLookup. Then you can look at eg. `NumericRangeFieldDataFilter` to see how it is used.\n\nHowever, I'm wondering if scripts and fielddata are really what you need for your use-case. `CollectionUtils.containsAny` is typically what a filter intersection would do (but in a much more efficient way than fielddata).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/63093278","html_url":"https://github.com/elastic/elasticsearch/issues/3426#issuecomment-63093278","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","id":63093278,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDkzMjc4","user":{"login":"ghiron","id":2124281,"node_id":"MDQ6VXNlcjIxMjQyODE=","avatar_url":"https://avatars0.githubusercontent.com/u/2124281?v=4","gravatar_id":"","url":"https://api.github.com/users/ghiron","html_url":"https://github.com/ghiron","followers_url":"https://api.github.com/users/ghiron/followers","following_url":"https://api.github.com/users/ghiron/following{/other_user}","gists_url":"https://api.github.com/users/ghiron/gists{/gist_id}","starred_url":"https://api.github.com/users/ghiron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghiron/subscriptions","organizations_url":"https://api.github.com/users/ghiron/orgs","repos_url":"https://api.github.com/users/ghiron/repos","events_url":"https://api.github.com/users/ghiron/events{/privacy}","received_events_url":"https://api.github.com/users/ghiron/received_events","type":"User","site_admin":false},"created_at":"2014-11-14T16:48:38Z","updated_at":"2014-11-14T16:49:11Z","author_association":"CONTRIBUTOR","body":"@jpountz maybe I will implement this as a filter but right now it's just one of all score criteria. Use filter instead will probably drop a lot of \"matching\" (high score) documents.\nAnyway I'll look NumericRangeFieldDataFilter! Thanks\n","performed_via_github_app":null}]