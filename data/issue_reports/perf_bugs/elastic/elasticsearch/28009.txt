{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/28009","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28009/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28009/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/28009/events","html_url":"https://github.com/elastic/elasticsearch/issues/28009","id":284873130,"node_id":"MDU6SXNzdWUyODQ4NzMxMzA=","number":28009,"title":"Old generation of the heap space stuck at 100% after request circuit breaker","user":{"login":"zjxlinux","id":16369233,"node_id":"MDQ6VXNlcjE2MzY5MjMz","avatar_url":"https://avatars1.githubusercontent.com/u/16369233?v=4","gravatar_id":"","url":"https://api.github.com/users/zjxlinux","html_url":"https://github.com/zjxlinux","followers_url":"https://api.github.com/users/zjxlinux/followers","following_url":"https://api.github.com/users/zjxlinux/following{/other_user}","gists_url":"https://api.github.com/users/zjxlinux/gists{/gist_id}","starred_url":"https://api.github.com/users/zjxlinux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zjxlinux/subscriptions","organizations_url":"https://api.github.com/users/zjxlinux/orgs","repos_url":"https://api.github.com/users/zjxlinux/repos","events_url":"https://api.github.com/users/zjxlinux/events{/privacy}","received_events_url":"https://api.github.com/users/zjxlinux/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-12-28T09:12:23Z","updated_at":"2017-12-29T07:52:00Z","closed_at":"2017-12-29T07:52:00Z","author_association":"NONE","active_lock_reason":null,"body":"<!--\r\n\r\n** Please read the guidelines below. **\r\n\r\nIssues that do not follow these guidelines are likely to be closed.\r\n\r\n1.  GitHub is reserved for bug reports and feature requests. The best place to\r\n    ask a general question is at the Elastic [forums](https://discuss.elastic.co).\r\n    GitHub is not the place for general questions.\r\n\r\n2.  Is this bug report or feature request for a supported OS? If not, it\r\n    is likely to be closed.  See https://www.elastic.co/support/matrix#show_os\r\n\r\n3.  Please fill out EITHER the feature request block or the bug report block\r\n    below, and delete the other block.\r\n\r\n-->\r\n\r\n<!-- Feature request -->\r\n\r\n**Describe the feature**\r\n\r\nOur cluster always execute some aggregations queries , in order to keep the memory usable, indices.breaker.request.limit set to 10% of the heap space, which means  1.4gb . but when query reach the limit , and breaking .... it's still cause the heap space grow at 100% . and there is no OOM occur. the cluster is no response. and documents can't write to the cluster either .  how can i solve the problem?\r\n   \r\n**ES_JAVA_OPTS**     \r\n-Xmn5g -Xms15g -Xmx15g\r\n\r\n\r\njstat -gcutil -h10 16921 1000 999\r\n  S0          S1       E            O         M     CCS    YGC     YGCT     FGC    FGCT     GCT\r\n100.00   0.00 100.00 100.00  91.88  82.11   9793  327.515   345  361.468  688.984\r\n100.00   0.00 100.00 100.00  91.88  82.11   9793  327.515   345  361.468  688.984\r\n100.00   0.00 100.00 100.00  91.88  82.11   9793  327.515   345  361.468  688.984\r\n100.00   0.00 100.00 100.00  91.88  82.11   9793  327.515   345  361.468  688.984\r\n\r\n\r\n**Elasticsearch Logs:**\r\n[2017-12-28T14:27:11,773][WARN ][o.e.i.b.request          ] [request] New used memory 1574091440 [1.4gb] for data of [<reused_arrays>] would be larger than configured breaker: 1543503872 [1.4gb], breaking\r\n[2017-12-28T14:27:13,280][WARN ][o.e.i.b.request          ] [request] New used memory 1710013784 [1.5gb] for data of [<reused_arrays>] would be larger than configured breaker: 1543503872 [1.4gb], breaking\r\n[2017-12-28T14:27:57,322][WARN ][o.e.m.j.JvmGcMonitorService] [es-honey-001.yz.momo.com] [gc][63734] overhead, spent [1.1s] collecting in the last [1.4s]\r\n[2017-12-28T14:28:02,860][WARN ][o.e.m.j.JvmGcMonitorService] [es-honey-001.yz.momo.com] [gc][young][63736][9792] duration [4s], collections [1]/[4.5s], total [4s]/[5.4m], memory [10gb]->[10.5gb]/[14.3gb], all_pools {[young] [2.3gb]->[5.1mb]/[3.7gb]}{[survivor] [640mb]->[640mb]/[640mb]}{[old] [7gb]->[9.8gb]/[10gb]}\r\n[2017-12-28T14:28:02,860][WARN ][o.e.m.j.JvmGcMonitorService] [es-honey-001.yz.momo.com] [gc][63736] overhead, spent [4.1s] collecting in the last [4.5s]\r\n[2017-12-28T14:28:29,196][WARN ][o.e.m.j.JvmGcMonitorService] [es-honey-001.yz.momo.com] [gc][old][63739][162] duration [23.8s], collections [2]/[24.3s], total [23.8s]/[46.4s], memory [13.7gb]->[11.4gb]/[14.3gb], all_pools {[young] [3.1gb]->[1.4gb]/[3.7gb]}{[survivor] [640mb]->[0b]/[640mb]}{[old] [9.8gb]->[10gb]/[10gb]}\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): elasticsearch-5.5.3\r\n\r\n**Plugins installed**: [none]\r\n\r\n**JVM version** (`java -version`): java-1.8.0-oracle\r\n\r\n**OS version** : Linux xxxx 3.10.0-327.22.2.el7.x86_64  CentOS Linux release 7.2.1511 \r\n\r\nindex rate\r\n![image](https://user-images.githubusercontent.com/16369233/34406051-da1e9384-ebf1-11e7-867c-7e29ea0f03d8.png)\r\n\r\n","closed_by":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"performed_via_github_app":null}