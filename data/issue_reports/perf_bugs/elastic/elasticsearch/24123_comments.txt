[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/294661064","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-294661064","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":294661064,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NDY2MTA2NA==","user":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"created_at":"2017-04-18T03:04:43Z","updated_at":"2017-04-18T03:04:43Z","author_association":"MEMBER","body":"@tlrx Can you take a look?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298178605","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-298178605","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":298178605,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODE3ODYwNQ==","user":{"login":"abeyad","id":1631297,"node_id":"MDQ6VXNlcjE2MzEyOTc=","avatar_url":"https://avatars2.githubusercontent.com/u/1631297?v=4","gravatar_id":"","url":"https://api.github.com/users/abeyad","html_url":"https://github.com/abeyad","followers_url":"https://api.github.com/users/abeyad/followers","following_url":"https://api.github.com/users/abeyad/following{/other_user}","gists_url":"https://api.github.com/users/abeyad/gists{/gist_id}","starred_url":"https://api.github.com/users/abeyad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abeyad/subscriptions","organizations_url":"https://api.github.com/users/abeyad/orgs","repos_url":"https://api.github.com/users/abeyad/repos","events_url":"https://api.github.com/users/abeyad/events{/privacy}","received_events_url":"https://api.github.com/users/abeyad/received_events","type":"User","site_admin":false},"created_at":"2017-04-29T16:20:56Z","updated_at":"2017-04-29T16:20:56Z","author_association":"CONTRIBUTOR","body":"I believe this will be fixed by https://github.com/elastic/elasticsearch/pull/24403","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298533655","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-298533655","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":298533655,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODUzMzY1NQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2017-05-02T07:46:56Z","updated_at":"2017-05-02T07:46:56Z","author_association":"MEMBER","body":"@jjfalling Do you think you could run your tests again but on a version that includes @abeyad 's patch?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/298605792","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-298605792","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":298605792,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODYwNTc5Mg==","user":{"login":"jjfalling","id":1078616,"node_id":"MDQ6VXNlcjEwNzg2MTY=","avatar_url":"https://avatars0.githubusercontent.com/u/1078616?v=4","gravatar_id":"","url":"https://api.github.com/users/jjfalling","html_url":"https://github.com/jjfalling","followers_url":"https://api.github.com/users/jjfalling/followers","following_url":"https://api.github.com/users/jjfalling/following{/other_user}","gists_url":"https://api.github.com/users/jjfalling/gists{/gist_id}","starred_url":"https://api.github.com/users/jjfalling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjfalling/subscriptions","organizations_url":"https://api.github.com/users/jjfalling/orgs","repos_url":"https://api.github.com/users/jjfalling/repos","events_url":"https://api.github.com/users/jjfalling/events{/privacy}","received_events_url":"https://api.github.com/users/jjfalling/received_events","type":"User","site_admin":false},"created_at":"2017-05-02T11:05:09Z","updated_at":"2017-05-02T11:05:09Z","author_association":"MEMBER","body":"Sure, I'll try to test it this week. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/302361296","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-302361296","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":302361296,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMjM2MTI5Ng==","user":{"login":"jjfalling","id":1078616,"node_id":"MDQ6VXNlcjEwNzg2MTY=","avatar_url":"https://avatars0.githubusercontent.com/u/1078616?v=4","gravatar_id":"","url":"https://api.github.com/users/jjfalling","html_url":"https://github.com/jjfalling","followers_url":"https://api.github.com/users/jjfalling/followers","following_url":"https://api.github.com/users/jjfalling/following{/other_user}","gists_url":"https://api.github.com/users/jjfalling/gists{/gist_id}","starred_url":"https://api.github.com/users/jjfalling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjfalling/subscriptions","organizations_url":"https://api.github.com/users/jjfalling/orgs","repos_url":"https://api.github.com/users/jjfalling/repos","events_url":"https://api.github.com/users/jjfalling/events{/privacy}","received_events_url":"https://api.github.com/users/jjfalling/received_events","type":"User","site_admin":false},"created_at":"2017-05-18T10:09:21Z","updated_at":"2017-05-18T10:09:21Z","author_association":"MEMBER","body":"@tlrx I've done some light testing and the snapshots are faster, but still much slower then the AWS cli. I need to do more testing but I'm not sure when I will have time. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/338202066","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-338202066","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":338202066,"node_id":"MDEyOklzc3VlQ29tbWVudDMzODIwMjA2Ng==","user":{"login":"vrizopoulos","id":12719231,"node_id":"MDQ6VXNlcjEyNzE5MjMx","avatar_url":"https://avatars0.githubusercontent.com/u/12719231?v=4","gravatar_id":"","url":"https://api.github.com/users/vrizopoulos","html_url":"https://github.com/vrizopoulos","followers_url":"https://api.github.com/users/vrizopoulos/followers","following_url":"https://api.github.com/users/vrizopoulos/following{/other_user}","gists_url":"https://api.github.com/users/vrizopoulos/gists{/gist_id}","starred_url":"https://api.github.com/users/vrizopoulos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vrizopoulos/subscriptions","organizations_url":"https://api.github.com/users/vrizopoulos/orgs","repos_url":"https://api.github.com/users/vrizopoulos/repos","events_url":"https://api.github.com/users/vrizopoulos/events{/privacy}","received_events_url":"https://api.github.com/users/vrizopoulos/received_events","type":"User","site_admin":false},"created_at":"2017-10-20T13:11:52Z","updated_at":"2017-10-20T13:11:52Z","author_association":"NONE","body":"@jjfalling , any progress with this? s3 snapshot speed is still slower in comparison for both backup and restore on 5.6","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/340813884","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-340813884","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":340813884,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MDgxMzg4NA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2017-10-31T16:10:58Z","updated_at":"2017-10-31T16:10:58Z","author_association":"MEMBER","body":"@vrizopoulos Yes, we identified a slow down because of a inefficient buffer initialization in the S3 repository and I'll create a fix soon. Also, I'm investigating using a more recent version of the AWS SDK that should speed up uploads (#26993). I'll update this issue once I have more.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/343100706","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-343100706","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":343100706,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzEwMDcwNg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2017-11-09T09:42:52Z","updated_at":"2017-11-09T09:42:52Z","author_association":"MEMBER","body":"I created #27280 to reduce memory allocation when snapshoting to S3 using Elasticsearch 6.x and I saw a performance improvement. I plan to backport the change down to 6.0 and 5.6.5.\r\n\r\nNote that AWS [enabled throttling by default](https://aws.amazon.com/fr/blogs/developer/throttled-retries-now-enabled-by-default/) in March 2016 so one has to be careful when comparing `aws cli` and `repository-s3` performance because depending of the versions one is throttled and not the other one (also as you noted snapshots are rate limited to 40Mb /sec by default in Elasticsearch).\r\n\r\nAlso please note that AWS cli and the S3 repository plugin are two different beasts, the former can push files using zero copy send files system calls while the latter has a rate limit by default and does much more than just uploading files.\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/343111100","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-343111100","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":343111100,"node_id":"MDEyOklzc3VlQ29tbWVudDM0MzExMTEwMA==","user":{"login":"vrizopoulos","id":12719231,"node_id":"MDQ6VXNlcjEyNzE5MjMx","avatar_url":"https://avatars0.githubusercontent.com/u/12719231?v=4","gravatar_id":"","url":"https://api.github.com/users/vrizopoulos","html_url":"https://github.com/vrizopoulos","followers_url":"https://api.github.com/users/vrizopoulos/followers","following_url":"https://api.github.com/users/vrizopoulos/following{/other_user}","gists_url":"https://api.github.com/users/vrizopoulos/gists{/gist_id}","starred_url":"https://api.github.com/users/vrizopoulos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vrizopoulos/subscriptions","organizations_url":"https://api.github.com/users/vrizopoulos/orgs","repos_url":"https://api.github.com/users/vrizopoulos/repos","events_url":"https://api.github.com/users/vrizopoulos/events{/privacy}","received_events_url":"https://api.github.com/users/vrizopoulos/received_events","type":"User","site_admin":false},"created_at":"2017-11-09T10:23:01Z","updated_at":"2017-11-09T10:23:01Z","author_association":"NONE","body":"@tlrx, Thanks for the updates and your work on this. Based on the AWS article you've linked, it's the number of retries that gets throttled, not necessarily the transfer rate itself?\r\n\r\nRegarding the 40Mb/s default limit, is that something that be overwritten when creating the snapshot repo using the \"max_snapshot_bytes_per_sec\" \"max_restore_bytes_per_sec\" configuration keys?\r\n\r\nFinally is there perhaps a way to allow for multiple restores to execute in parallel that would provide us with a better aggregate performance?\r\n\r\nThanks","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/356873737","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-356873737","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":356873737,"node_id":"MDEyOklzc3VlQ29tbWVudDM1Njg3MzczNw==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-01-11T09:18:06Z","updated_at":"2018-01-11T09:18:06Z","author_association":"MEMBER","body":"> Based on the AWS article you've linked, it's the number of retries that gets throttled, not necessarily the transfer rate itself?\r\n\r\nYes, I linked to this article because @abeyad mentioned the issue #24403 which involves many retries when the incompatible snapshot blob is missing. \r\n\r\n> Regarding the 40Mb/s default limit, is that something that be overwritten when creating the snapshot repo using the \"max_snapshot_bytes_per_sec\" \"max_restore_bytes_per_sec\" configuration keys?\r\n\r\nYes, you can set both of them to 0 or -1 to disable the rate limiter. But test this before changing your production.\r\n\r\n> Finally is there perhaps a way to allow for multiple restores to execute in parallel that would provide us with a better aggregate performance?\r\n\r\nThe current snapshot/restore feature does not allow multiple snapshots or restores to be executed at the same time. But for a given snapshot or restore, multiple shards are snapshotted/restored in parallel. If both index-a and index-b were snapshotted at the same time, when restoring the snapshot both indices will be restored in parallel. Does that help?\r\n\r\nFinally, I'd love to have more feedback from users about repository-s3 performance on versions 5.6.5/6.0.1/6.1.0 to see the impact of #27280.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/360428649","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-360428649","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":360428649,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDQyODY0OQ==","user":{"login":"JD557","id":1187242,"node_id":"MDQ6VXNlcjExODcyNDI=","avatar_url":"https://avatars3.githubusercontent.com/u/1187242?v=4","gravatar_id":"","url":"https://api.github.com/users/JD557","html_url":"https://github.com/JD557","followers_url":"https://api.github.com/users/JD557/followers","following_url":"https://api.github.com/users/JD557/following{/other_user}","gists_url":"https://api.github.com/users/JD557/gists{/gist_id}","starred_url":"https://api.github.com/users/JD557/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JD557/subscriptions","organizations_url":"https://api.github.com/users/JD557/orgs","repos_url":"https://api.github.com/users/JD557/repos","events_url":"https://api.github.com/users/JD557/events{/privacy}","received_events_url":"https://api.github.com/users/JD557/received_events","type":"User","site_admin":false},"created_at":"2018-01-25T10:40:14Z","updated_at":"2018-01-25T10:40:14Z","author_association":"NONE","body":">Finally, I'd love to have more feedback from users about repository-s3 performance on versions 5.6.5/6.0.1/6.1.0 to see the impact of #27280.\r\n\r\nThis was an issue that was affecting us on 5.6.4 and the upgrade to 6.1.0 seems to have helped a ton (snapshots are about 30% faster).\r\n\r\nHere's a redacted output from `_cat/snapshots`:\r\n\r\n```\r\nid                   duration indices total_shards\r\nhourly-2018-01-24-11    14.9m     715         3567\r\nhourly-2018-01-24-12    16.1m     717         3577\r\nhourly-2018-01-24-13    15.4m     717         3577\r\nhourly-2018-01-24-14    16.8m     717         3577\r\n------------------------ Update ------------------\r\nhourly-2018-01-24-16    17.4m     717         3577\r\nhourly-2018-01-24-17      11m     717         3577\r\nhourly-2018-01-24-18    11.6m     717         3577\r\nhourly-2018-01-24-19      11m     717         3577\r\nhourly-2018-01-24-20    11.4m     717         3577\r\nhourly-2018-01-24-21    11.6m     717         3577\r\nhourly-2018-01-24-22    10.7m     717         3577\r\nhourly-2018-01-24-23    10.6m     717         3577\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/360432750","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-360432750","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":360432750,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDQzMjc1MA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-01-25T10:56:25Z","updated_at":"2018-01-25T10:56:25Z","author_association":"MEMBER","body":"@JD557 Thanks for the feedback!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363584033","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-363584033","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":363584033,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzU4NDAzMw==","user":{"login":"eherot","id":400447,"node_id":"MDQ6VXNlcjQwMDQ0Nw==","avatar_url":"https://avatars0.githubusercontent.com/u/400447?v=4","gravatar_id":"","url":"https://api.github.com/users/eherot","html_url":"https://github.com/eherot","followers_url":"https://api.github.com/users/eherot/followers","following_url":"https://api.github.com/users/eherot/following{/other_user}","gists_url":"https://api.github.com/users/eherot/gists{/gist_id}","starred_url":"https://api.github.com/users/eherot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eherot/subscriptions","organizations_url":"https://api.github.com/users/eherot/orgs","repos_url":"https://api.github.com/users/eherot/repos","events_url":"https://api.github.com/users/eherot/events{/privacy}","received_events_url":"https://api.github.com/users/eherot/received_events","type":"User","site_admin":false},"created_at":"2018-02-06T22:18:18Z","updated_at":"2018-02-06T22:18:18Z","author_association":"NONE","body":"Is it possible that this might affect deletes as well? I'm running 5.6.3 and snapshot deletes are quite slow:\r\n```\r\n2018-02-05 06:36:12,600 INFO      Deleting snapshot applogs-2017.10.27...\r\n2018-02-05 07:02:54,618 INFO      Deleting snapshot applogs-2017.10.28...\r\n2018-02-05 07:33:38,949 INFO      Deleting snapshot applogs-2017.10.29...\r\n2018-02-05 07:59:19,782 INFO      Deleting snapshot applogs-2017.10.30...\r\n2018-02-05 08:27:13,283 INFO      Deleting snapshot applogs-2017.10.31...\r\n```\r\nI don't know exactly what version of ES was used to make these snapshots but I don't think it was < 5.x.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/363691064","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-363691064","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":363691064,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzY5MTA2NA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-02-07T08:17:52Z","updated_at":"2018-02-07T08:17:52Z","author_association":"MEMBER","body":"@eherot Some factors can affect the performance of a deletion, but I can't tell from your previous comment if the deletion took more time than usual on your platform or did you simply notice that the deletions were slow?\r\n\r\n> Is it possible that this might affect deletes as well? I'm running 5.6.3 and snapshot deletes are quite slow:\r\n\r\nMany factors can slow down a snapshot deletion. The issue fixed by #27280 mostly impacts snapshot creation but it can affect deletion too as many files are updated during the deletion process.\r\n\r\nMost of the time the deletion is slow because the repository contains a lot of snapshots (the file `index-N` at the root of the S3 bucket is a good indicator of what is a \"lot of snapshots\") and/or the snapshots contains a lot of indices and shards. Since the snapshots are incremental, it requires to update the list of files to keep/to delete for all shards involved in the snapshot and this can also take some time.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/367004822","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-367004822","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":367004822,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NzAwNDgyMg==","user":{"login":"JD557","id":1187242,"node_id":"MDQ6VXNlcjExODcyNDI=","avatar_url":"https://avatars3.githubusercontent.com/u/1187242?v=4","gravatar_id":"","url":"https://api.github.com/users/JD557","html_url":"https://github.com/JD557","followers_url":"https://api.github.com/users/JD557/followers","following_url":"https://api.github.com/users/JD557/following{/other_user}","gists_url":"https://api.github.com/users/JD557/gists{/gist_id}","starred_url":"https://api.github.com/users/JD557/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JD557/subscriptions","organizations_url":"https://api.github.com/users/JD557/orgs","repos_url":"https://api.github.com/users/JD557/repos","events_url":"https://api.github.com/users/JD557/events{/privacy}","received_events_url":"https://api.github.com/users/JD557/received_events","type":"User","site_admin":false},"created_at":"2018-02-20T15:01:14Z","updated_at":"2018-02-20T15:01:14Z","author_association":"NONE","body":"Recently, I've noticed a huge slowdown in snapshots. After looking at the elasticsearch logs, I've found a lot of errors like this:\r\n\r\n```\r\n[2018-02-20T14:58:48,669][WARN ][o.e.r.s.S3Repository     ] [qMs-_ZD] failed to read index file [index-0]\r\ncom.fasterxml.jackson.core.JsonParseException: Duplicate field 'hourly-2018-02-16-04'\r\n at [Source: org.elasticsearch.common.bytes.BytesReference$MarkSupportingStreamInputWrapper@1e926bbd; line: -1, column: 1117]\r\n\tat com.fasterxml.jackson.core.json.JsonReadContext._checkDup(JsonReadContext.java:204) ~[jackson-core-2.8.10.jar:2.8.10]\r\n\tat com.fasterxml.jackson.core.json.JsonReadContext.setCurrentName(JsonReadContext.java:198) ~[jackson-core-2.8.10.jar:2.8.10]\r\n\tat com.fasterxml.jackson.dataformat.smile.SmileParser._handleFieldName(SmileParser.java:1552) ~[jackson-dataformat-smile-2.8.10.jar:2.8.10]\r\n\tat com.fasterxml.jackson.dataformat.smile.SmileParser.nextToken(SmileParser.java:588) ~[jackson-dataformat-smile-2.8.10.jar:2.8.10]\r\n\tat org.elasticsearch.common.xcontent.json.JsonXContentParser.nextToken(JsonXContentParser.java:52) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.index.snapshots.blobstore.BlobStoreIndexShardSnapshots.fromXContent(BlobStoreIndexShardSnapshots.java:257) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreFormat.read(BlobStoreFormat.java:113) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.repositories.blobstore.ChecksumBlobStoreFormat.readBlob(ChecksumBlobStoreFormat.java:114) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreFormat.read(BlobStoreFormat.java:89) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository$Context.buildBlobStoreIndexShardSnapshots(BlobStoreRepository.java:1070) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository$Context.delete(BlobStoreRepository.java:927) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.delete(BlobStoreRepository.java:877) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.repositories.blobstore.BlobStoreRepository.deleteSnapshot(BlobStoreRepository.java:390) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.snapshots.SnapshotsService.lambda$deleteSnapshotFromRepository$8(SnapshotsService.java:1292) ~[elasticsearch-6.1.0.jar:6.1.0]\r\n\tat org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:568) [elasticsearch-6.1.0.jar:6.1.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_161]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\n```\r\n\r\nIs it possible that the latest changes can output an incorrect JSON somewhere?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/367010630","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-367010630","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":367010630,"node_id":"MDEyOklzc3VlQ29tbWVudDM2NzAxMDYzMA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-02-20T15:18:56Z","updated_at":"2018-02-20T15:18:56Z","author_association":"MEMBER","body":"> Is it possible that the latest changes can output an incorrect JSON somewhere?\r\n\r\nI'd say no, the latest changes didn't impact the output of this file. The exception is triggered by #22073 which adds detection for duplicated fields in XContent (in your case, a SMILE file). Can you please send me the `index-0` file (tanguy at elastic.co)? I'm curious to see what it contains... It does not contain sensitive data but contains snapshots and indice names.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/376177751","html_url":"https://github.com/elastic/elasticsearch/issues/24123#issuecomment-376177751","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/24123","id":376177751,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjE3Nzc1MQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2018-03-26T14:05:52Z","updated_at":"2018-03-26T14:05:52Z","author_association":"MEMBER","body":"We talked about this today with @ywelsch and we're going to close this issue. Some improvement has been made (#27280) and we can not expect the same performance as the aws cli because the snapshot/restore process is doing more things than uploading file. Anyway, feel free to add any comment on this issue as we're always happy to have more feedback on performance changes between versions.","performed_via_github_app":null}]