[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/403431976","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-403431976","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":403431976,"node_id":"MDEyOklzc3VlQ29tbWVudDQwMzQzMTk3Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-07-09T10:20:21Z","updated_at":"2018-07-09T10:20:21Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-search-aggs","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404798552","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-404798552","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":404798552,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDc5ODU1Mg==","user":{"login":"ctrlaltdel","id":8973,"node_id":"MDQ6VXNlcjg5NzM=","avatar_url":"https://avatars3.githubusercontent.com/u/8973?v=4","gravatar_id":"","url":"https://api.github.com/users/ctrlaltdel","html_url":"https://github.com/ctrlaltdel","followers_url":"https://api.github.com/users/ctrlaltdel/followers","following_url":"https://api.github.com/users/ctrlaltdel/following{/other_user}","gists_url":"https://api.github.com/users/ctrlaltdel/gists{/gist_id}","starred_url":"https://api.github.com/users/ctrlaltdel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctrlaltdel/subscriptions","organizations_url":"https://api.github.com/users/ctrlaltdel/orgs","repos_url":"https://api.github.com/users/ctrlaltdel/repos","events_url":"https://api.github.com/users/ctrlaltdel/events{/privacy}","received_events_url":"https://api.github.com/users/ctrlaltdel/received_events","type":"User","site_admin":false},"created_at":"2018-07-13T10:51:30Z","updated_at":"2018-07-13T10:51:30Z","author_association":"NONE","body":"Pinging @s1monw @jpountz @jimczi","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404812384","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-404812384","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":404812384,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDgxMjM4NA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-07-13T11:58:33Z","updated_at":"2018-07-13T11:58:33Z","author_association":"CONTRIBUTOR","body":"@ctrlaltdel I see this as a feature rather than a bug. With that many shards on a single node, having this protection is important to keep things reasonable with many concurrent users. To me the problem is more the number of shards per node here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/404837132","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-404837132","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":404837132,"node_id":"MDEyOklzc3VlQ29tbWVudDQwNDgzNzEzMg==","user":{"login":"ctrlaltdel","id":8973,"node_id":"MDQ6VXNlcjg5NzM=","avatar_url":"https://avatars3.githubusercontent.com/u/8973?v=4","gravatar_id":"","url":"https://api.github.com/users/ctrlaltdel","html_url":"https://github.com/ctrlaltdel","followers_url":"https://api.github.com/users/ctrlaltdel/followers","following_url":"https://api.github.com/users/ctrlaltdel/following{/other_user}","gists_url":"https://api.github.com/users/ctrlaltdel/gists{/gist_id}","starred_url":"https://api.github.com/users/ctrlaltdel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctrlaltdel/subscriptions","organizations_url":"https://api.github.com/users/ctrlaltdel/orgs","repos_url":"https://api.github.com/users/ctrlaltdel/repos","events_url":"https://api.github.com/users/ctrlaltdel/events{/privacy}","received_events_url":"https://api.github.com/users/ctrlaltdel/received_events","type":"User","site_admin":false},"created_at":"2018-07-13T13:42:12Z","updated_at":"2018-07-13T13:42:12Z","author_association":"NONE","body":"@jpountz thanks for the comment.\r\n\r\nMy typical use-case here is an ELK stack running on a single machine and serving as a search engine for syslog messages. There's usually only a single query running at a given time which is coming from a kibana dashboard.\r\n\r\nIn this case running on a 24 cores machine, typical query time is now about 5 times slower when running latest version of elasticsearch than it was with 5.5.3.\r\n\r\nCould you please elaborate on how changing the number of shards here would improve performance? AFAIK, since https://github.com/elastic/elasticsearch/pull/25632 was merged, a single query can only run on 5 threads (so use maximum 5 cores) per node by default. The only way to improve this would be to actually *increase* the number of shards per index.\r\n\r\nUnfortunately there's now way to tell kibana to set the `max_concurrent_shard_requests` parameter by default and it makes use of `_msearch` queries that don't support it anyway.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412870414","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-412870414","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":412870414,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjg3MDQxNA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T13:24:54Z","updated_at":"2018-08-14T13:24:54Z","author_association":"CONTRIBUTOR","body":"> My typical use-case here is an ELK stack running on a single machine and serving as a search engine for syslog messages. There's usually only a single query running at a given time which is coming from a kibana dashboard.\r\n\r\nI agree it's a shame you can't use all your resources here. This usecase isn't typical in the way that you don't gain concurrency via multiple requests. Think of 5 requests hitting your server at the same time you will have 25 requests at most hitting your node which is a good protection. Yet, your case want to maximize resource utilization per node and it's a shame that kibana can't trigger it. I wonder if we should allow multi search to override this and then make kibana expose it? @jpountz  WDYT?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/412885123","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-412885123","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":412885123,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjg4NTEyMw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2018-08-14T14:10:01Z","updated_at":"2018-08-14T14:10:01Z","author_association":"CONTRIBUTOR","body":"+1 ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414583478","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-414583478","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":414583478,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDU4MzQ3OA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2018-08-21T07:51:04Z","updated_at":"2018-08-21T07:51:04Z","author_association":"CONTRIBUTOR","body":"I created a PR to expose this setting on `_msearch` and opened a kibana issue to expose it. I will keep this issue open until we have code committed in both elasticsearch and kibana.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/414594124","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-414594124","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":414594124,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNDU5NDEyNA==","user":{"login":"ctrlaltdel","id":8973,"node_id":"MDQ6VXNlcjg5NzM=","avatar_url":"https://avatars3.githubusercontent.com/u/8973?v=4","gravatar_id":"","url":"https://api.github.com/users/ctrlaltdel","html_url":"https://github.com/ctrlaltdel","followers_url":"https://api.github.com/users/ctrlaltdel/followers","following_url":"https://api.github.com/users/ctrlaltdel/following{/other_user}","gists_url":"https://api.github.com/users/ctrlaltdel/gists{/gist_id}","starred_url":"https://api.github.com/users/ctrlaltdel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctrlaltdel/subscriptions","organizations_url":"https://api.github.com/users/ctrlaltdel/orgs","repos_url":"https://api.github.com/users/ctrlaltdel/repos","events_url":"https://api.github.com/users/ctrlaltdel/events{/privacy}","received_events_url":"https://api.github.com/users/ctrlaltdel/received_events","type":"User","site_admin":false},"created_at":"2018-08-21T08:28:10Z","updated_at":"2018-08-21T08:28:10Z","author_association":"NONE","body":"@s1monw looks good, thanks a lot for taking care of this issue :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/420389671","html_url":"https://github.com/elastic/elasticsearch/issues/31877#issuecomment-420389671","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31877","id":420389671,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDM4OTY3MQ==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2018-09-11T19:16:07Z","updated_at":"2018-09-11T19:16:07Z","author_association":"CONTRIBUTOR","body":"this has been integrated in kibana. I am closing this.","performed_via_github_app":null}]