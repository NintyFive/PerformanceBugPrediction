{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/42432","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42432/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42432/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/42432/events","html_url":"https://github.com/elastic/elasticsearch/issues/42432","id":447575337,"node_id":"MDU6SXNzdWU0NDc1NzUzMzc=","number":42432,"title":"index slowlog settings override other indices settings ","user":{"login":"jkakavas","id":10281256,"node_id":"MDQ6VXNlcjEwMjgxMjU2","avatar_url":"https://avatars2.githubusercontent.com/u/10281256?v=4","gravatar_id":"","url":"https://api.github.com/users/jkakavas","html_url":"https://github.com/jkakavas","followers_url":"https://api.github.com/users/jkakavas/followers","following_url":"https://api.github.com/users/jkakavas/following{/other_user}","gists_url":"https://api.github.com/users/jkakavas/gists{/gist_id}","starred_url":"https://api.github.com/users/jkakavas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkakavas/subscriptions","organizations_url":"https://api.github.com/users/jkakavas/orgs","repos_url":"https://api.github.com/users/jkakavas/repos","events_url":"https://api.github.com/users/jkakavas/events{/privacy}","received_events_url":"https://api.github.com/users/jkakavas/received_events","type":"User","site_admin":false},"labels":[{"id":151561891,"node_id":"MDU6TGFiZWwxNTE1NjE4OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Logging","name":":Core/Infra/Logging","color":"0e8a16","default":false,"description":"Log management and logging utilities"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-05-23T10:31:02Z","updated_at":"2019-10-17T07:27:19Z","closed_at":"2019-10-17T07:27:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"\r\n<!-- Bug report -->\r\n\r\n**Elasticsearch version** : Tested with 6.6.1 and master\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nSlowlog settings are supposed to be per index. However, setting the slowlog settings for an index, override the respective settings in all other indices, even when these other settings have been previously configured. \r\n\r\n**Steps to reproduce**:\r\n\r\n1. Create index `test_1` and set `index.search.slowlog.level: warn` and `index.search.slowlog.threshold.query.trace` to 0. \r\n```\r\ncurl -X PUT  -H 'Content-Type: application/json' 'http://localhost:9200/test_1/_settings' -d '{\"settings\": {\"index.search.slowlog.level\": \"warn\", \"index.search.slowlog.threshold.query.trace\": 0}}'\r\n```\r\n\r\nGet the settings to verify it is set correctly\r\n\r\n```\r\ncurl -uelastic:password -X GET 'http://localhost:9200/test_1/_settings'\r\n```\r\n\r\nshould return \r\n\r\n```\r\n...\r\n\"test_1\" : {\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"search\" : {\r\n          \"slowlog\" : {\r\n            \"level\" : \"warn\",\r\n            \"threshold\" : {\r\n              \"query\" : {\r\n                \"trace\" : \"0\"\r\n              }\r\n            }\r\n          }\r\n        },\r\n...\r\n```\r\n\r\n2. Make a few searches\r\n```\r\ncurl -X GET 'http://localhost:9200/test_1/_search'\r\n```\r\n\r\nand verify nothing is printed in the `*.index_search_slowlog.log`\r\n\r\n3. Create index `test_2` and set `index.search.slowlog.level: trace` and `index.search.slowlog.threshold.query.trace` to 0. \r\n```\r\ncurl -X PUT  -H 'Content-Type: application/json' 'http://localhost:9200/test_2/_settings' -d '{\"settings\": {\"index.search.slowlog.level\": \"warn\", \"index.search.slowlog.threshold.query.trace\": 0}}'\r\n```\r\n\r\nGet the settings to verify it is set correctly\r\n\r\n\r\n```\r\ncurl -uelastic:password -X GET 'http://localhost:9200/test_2/_settings'\r\n```\r\n\r\nshould return \r\n\r\n```\r\n...\r\n\"test_2\" : {\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"search\" : {\r\n          \"slowlog\" : {\r\n            \"level\" : \"trace\",\r\n            \"threshold\" : {\r\n              \"query\" : {\r\n                \"trace\" : \"0\"\r\n              }\r\n            }\r\n          }\r\n        },\r\n...\r\n```\r\n\r\nVerify also that the settings for `test_1` have **not** been changed ( at least that's reported ): \r\n```\r\ncurl -uelastic:password -X GET 'http://localhost:9200/test_1/_settings'\r\n```\r\n\r\nshould still  return \r\n\r\n```\r\n...\r\n\"test_1\" : {\r\n    \"settings\" : {\r\n      \"index\" : {\r\n        \"search\" : {\r\n          \"slowlog\" : {\r\n            \"level\" : \"warn\",\r\n            \"threshold\" : {\r\n              \"query\" : {\r\n                \"trace\" : \"0\"\r\n              }\r\n            }\r\n          }\r\n        },\r\n...\r\n```\r\n\r\n4. Make a search in `test_1` again\r\n```\r\ncurl -X GET 'http://localhost:9200/test_1/_search'\r\n```\r\n\r\nObserve log lines such as \r\n\r\n```\r\n[2019-05-23T13:27:38,633][TRACE][i.s.s.query              ] [node-0] [test_1][0] took[218.5micros], took_millis[0], total_hits[0 hits], types[], stats[], search_type[QUERY_THEN_FETCH], total_shards[1], source[{}], id[],\r\n```\r\n\r\n in the `*.index_search_slowlog.log`\r\n","closed_by":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"performed_via_github_app":null}