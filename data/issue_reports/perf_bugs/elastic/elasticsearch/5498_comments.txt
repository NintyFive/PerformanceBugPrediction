[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38425371","html_url":"https://github.com/elastic/elasticsearch/issues/5498#issuecomment-38425371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498","id":38425371,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDI1Mzcx","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-03-24T09:37:41Z","updated_at":"2014-03-24T09:37:41Z","author_association":"CONTRIBUTOR","body":"Terms aggregations are not as optimized as terms facets (yet), especially on high-cardinality fields. I suppose this is the case of your `url` field? Could you check if you get better response times if you pass [`execution_hint: map`](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html#_execution_hint) to the terms aggregation?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38427031","html_url":"https://github.com/elastic/elasticsearch/issues/5498#issuecomment-38427031","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498","id":38427031,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDI3MDMx","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-03-24T09:59:29Z","updated_at":"2014-03-24T09:59:29Z","author_association":"CONTRIBUTOR","body":"I just noticed that you mentioned that the query made the node completely unresponsive, which is a typical symptom of memory pressure, because the garbage collector keeps running stop-the-world collections during which no thread is allowed to run. So this slowness might be mostly due to the higher memory usage of terms aggregations compared to facets (in which case the `map` execution hint should still help a bit since it requires less memory).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38440519","html_url":"https://github.com/elastic/elasticsearch/issues/5498#issuecomment-38440519","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498","id":38440519,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDQwNTE5","user":{"login":"BrandesEric","id":640877,"node_id":"MDQ6VXNlcjY0MDg3Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/640877?v=4","gravatar_id":"","url":"https://api.github.com/users/BrandesEric","html_url":"https://github.com/BrandesEric","followers_url":"https://api.github.com/users/BrandesEric/followers","following_url":"https://api.github.com/users/BrandesEric/following{/other_user}","gists_url":"https://api.github.com/users/BrandesEric/gists{/gist_id}","starred_url":"https://api.github.com/users/BrandesEric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BrandesEric/subscriptions","organizations_url":"https://api.github.com/users/BrandesEric/orgs","repos_url":"https://api.github.com/users/BrandesEric/repos","events_url":"https://api.github.com/users/BrandesEric/events{/privacy}","received_events_url":"https://api.github.com/users/BrandesEric/received_events","type":"User","site_admin":false},"created_at":"2014-03-24T12:58:28Z","updated_at":"2014-03-24T12:58:28Z","author_association":"NONE","body":"Ah, that did help tremendously, thanks!  Down to about 15 seconds from 6 minutes!  I think you're right that it was a GC pause that caused the issue.  It most seriously occurs on the dev environment which is a much less powerful cluster.  For now I will likely stick with the older term facets since the performance is still a bit better :)\n\nOne last question - my app uses ES primarily for faceting.  Would it be advisable to make any changes to the default field data cache setting?  Otherwise is the general rule the more memory the better?  In general some of the facets have cardinalities in the millions, so any way to optimize that would be helpful!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38442647","html_url":"https://github.com/elastic/elasticsearch/issues/5498#issuecomment-38442647","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498","id":38442647,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDQyNjQ3","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2014-03-24T13:19:42Z","updated_at":"2014-03-24T13:19:42Z","author_association":"CONTRIBUTOR","body":"Thanks for the feedback. Regarding the field data cache configuration, reloading a field data cache is very costly, so you should make sure that it is large enough to hold an entry for all segments and all fields that you need to facet/aggregate on (which is what the default configuration does).\n\nI'm closing this issue for now, but be reassured that we are working on improving memory/speed for terms aggregations.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/38443050","html_url":"https://github.com/elastic/elasticsearch/issues/5498#issuecomment-38443050","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498","id":38443050,"node_id":"MDEyOklzc3VlQ29tbWVudDM4NDQzMDUw","user":{"login":"BrandesEric","id":640877,"node_id":"MDQ6VXNlcjY0MDg3Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/640877?v=4","gravatar_id":"","url":"https://api.github.com/users/BrandesEric","html_url":"https://github.com/BrandesEric","followers_url":"https://api.github.com/users/BrandesEric/followers","following_url":"https://api.github.com/users/BrandesEric/following{/other_user}","gists_url":"https://api.github.com/users/BrandesEric/gists{/gist_id}","starred_url":"https://api.github.com/users/BrandesEric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BrandesEric/subscriptions","organizations_url":"https://api.github.com/users/BrandesEric/orgs","repos_url":"https://api.github.com/users/BrandesEric/repos","events_url":"https://api.github.com/users/BrandesEric/events{/privacy}","received_events_url":"https://api.github.com/users/BrandesEric/received_events","type":"User","site_admin":false},"created_at":"2014-03-24T13:23:42Z","updated_at":"2014-03-24T13:23:42Z","author_association":"NONE","body":"Sounds good, thanks for your help!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/147324158","html_url":"https://github.com/elastic/elasticsearch/issues/5498#issuecomment-147324158","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498","id":147324158,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NzMyNDE1OA==","user":{"login":"haochun","id":9320176,"node_id":"MDQ6VXNlcjkzMjAxNzY=","avatar_url":"https://avatars3.githubusercontent.com/u/9320176?v=4","gravatar_id":"","url":"https://api.github.com/users/haochun","html_url":"https://github.com/haochun","followers_url":"https://api.github.com/users/haochun/followers","following_url":"https://api.github.com/users/haochun/following{/other_user}","gists_url":"https://api.github.com/users/haochun/gists{/gist_id}","starred_url":"https://api.github.com/users/haochun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/haochun/subscriptions","organizations_url":"https://api.github.com/users/haochun/orgs","repos_url":"https://api.github.com/users/haochun/repos","events_url":"https://api.github.com/users/haochun/events{/privacy}","received_events_url":"https://api.github.com/users/haochun/received_events","type":"User","site_admin":false},"created_at":"2015-10-12T08:08:20Z","updated_at":"2015-10-12T08:08:20Z","author_association":"NONE","body":"@BrandesEric  Hello, I would like to know how you solve this problem.thank you very much!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/147396908","html_url":"https://github.com/elastic/elasticsearch/issues/5498#issuecomment-147396908","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/5498","id":147396908,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NzM5NjkwOA==","user":{"login":"BrandesEric","id":640877,"node_id":"MDQ6VXNlcjY0MDg3Nw==","avatar_url":"https://avatars3.githubusercontent.com/u/640877?v=4","gravatar_id":"","url":"https://api.github.com/users/BrandesEric","html_url":"https://github.com/BrandesEric","followers_url":"https://api.github.com/users/BrandesEric/followers","following_url":"https://api.github.com/users/BrandesEric/following{/other_user}","gists_url":"https://api.github.com/users/BrandesEric/gists{/gist_id}","starred_url":"https://api.github.com/users/BrandesEric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BrandesEric/subscriptions","organizations_url":"https://api.github.com/users/BrandesEric/orgs","repos_url":"https://api.github.com/users/BrandesEric/repos","events_url":"https://api.github.com/users/BrandesEric/events{/privacy}","received_events_url":"https://api.github.com/users/BrandesEric/received_events","type":"User","site_admin":false},"created_at":"2015-10-12T13:18:18Z","updated_at":"2015-10-12T13:18:18Z","author_association":"NONE","body":"@haochun Moved to Linux and upgraded to the 1.4 series :)  (Of course, 1.4 is old these days, so something like the 1.7 series is likely even better)\n","performed_via_github_app":null}]