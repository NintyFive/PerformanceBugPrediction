[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/394753223","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-394753223","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":394753223,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NDc1MzIyMw==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-05T15:27:58Z","updated_at":"2018-06-05T15:27:58Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-core-infra","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/397265795","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-397265795","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":397265795,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzI2NTc5NQ==","user":{"login":"jeancornic","id":1595643,"node_id":"MDQ6VXNlcjE1OTU2NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/1595643?v=4","gravatar_id":"","url":"https://api.github.com/users/jeancornic","html_url":"https://github.com/jeancornic","followers_url":"https://api.github.com/users/jeancornic/followers","following_url":"https://api.github.com/users/jeancornic/following{/other_user}","gists_url":"https://api.github.com/users/jeancornic/gists{/gist_id}","starred_url":"https://api.github.com/users/jeancornic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeancornic/subscriptions","organizations_url":"https://api.github.com/users/jeancornic/orgs","repos_url":"https://api.github.com/users/jeancornic/repos","events_url":"https://api.github.com/users/jeancornic/events{/privacy}","received_events_url":"https://api.github.com/users/jeancornic/received_events","type":"User","site_admin":false},"created_at":"2018-06-14T11:44:28Z","updated_at":"2018-06-14T11:44:28Z","author_association":"NONE","body":"Do you need more details? Or that I run some commands on the cluster?\r\n\r\nI also found out recently that this bug is responsible for stuck relocations. Somehow the ongoing bulk operation prevents the relocation from finishing completely, and the workaround I found is is to close / re-open the index.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/397398268","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-397398268","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":397398268,"node_id":"MDEyOklzc3VlQ29tbWVudDM5NzM5ODI2OA==","user":{"login":"s1monw","id":973334,"node_id":"MDQ6VXNlcjk3MzMzNA==","avatar_url":"https://avatars0.githubusercontent.com/u/973334?v=4","gravatar_id":"","url":"https://api.github.com/users/s1monw","html_url":"https://github.com/s1monw","followers_url":"https://api.github.com/users/s1monw/followers","following_url":"https://api.github.com/users/s1monw/following{/other_user}","gists_url":"https://api.github.com/users/s1monw/gists{/gist_id}","starred_url":"https://api.github.com/users/s1monw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/s1monw/subscriptions","organizations_url":"https://api.github.com/users/s1monw/orgs","repos_url":"https://api.github.com/users/s1monw/repos","events_url":"https://api.github.com/users/s1monw/events{/privacy}","received_events_url":"https://api.github.com/users/s1monw/received_events","type":"User","site_admin":false},"created_at":"2018-06-14T18:42:21Z","updated_at":"2018-06-14T18:42:21Z","author_association":"CONTRIBUTOR","body":"@bleskes this seems more of a distributed systems issue? Can you follow up","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398052999","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-398052999","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":398052999,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODA1Mjk5OQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T13:25:54Z","updated_at":"2018-06-18T13:25:54Z","author_association":"MEMBER","body":"@jeancornic what's peculiar about this issue is that the task `indices:data/write/bulk` is a top level bulk request. That one potentially creates the index (are you using this feature?) and the breaks the request into sub requests contain all operations that are targeted at specific shard and sends those off. Are you seeing any of those being stuck? you can identify them by `indices:data/write/bulk[s]*` (note the `[s]` at the end).","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398083640","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-398083640","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":398083640,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODA4MzY0MA==","user":{"login":"jeancornic","id":1595643,"node_id":"MDQ6VXNlcjE1OTU2NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/1595643?v=4","gravatar_id":"","url":"https://api.github.com/users/jeancornic","html_url":"https://github.com/jeancornic","followers_url":"https://api.github.com/users/jeancornic/followers","following_url":"https://api.github.com/users/jeancornic/following{/other_user}","gists_url":"https://api.github.com/users/jeancornic/gists{/gist_id}","starred_url":"https://api.github.com/users/jeancornic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeancornic/subscriptions","organizations_url":"https://api.github.com/users/jeancornic/orgs","repos_url":"https://api.github.com/users/jeancornic/repos","events_url":"https://api.github.com/users/jeancornic/events{/privacy}","received_events_url":"https://api.github.com/users/jeancornic/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T14:57:30Z","updated_at":"2018-06-18T14:57:30Z","author_association":"NONE","body":"@bleskes sure, follows a json extract (`group_by=parents` view).\r\nAnd no, we disabled `auto_create_index`.\r\nWe see them on several nodes, several indices.\r\n\r\n```\r\n    ...\r\n    \"pd5MT4eUSEqsOy_oq_q-vw:208477658\" : {\r\n      \"node\" : \"pd5MT4eUSEqsOy_oq_q-vw\",\r\n      \"id\" : 208477658,\r\n      \"type\" : \"netty\",\r\n      \"action\" : \"indices:data/write/bulk\",\r\n      \"description\" : \"requests[938], indices[]\",\r\n      \"start_time\" : \"2018-04-12T21:17:45.175Z\",\r\n      \"start_time_in_millis\" : 1523567865175,\r\n      \"running_time\" : \"66.7d\",\r\n      \"running_time_in_nanos\" : 5765089168375518,\r\n      \"cancellable\" : false,\r\n      \"children\" : [\r\n        {\r\n          \"node\" : \"pd5MT4eUSEqsOy_oq_q-vw\",\r\n          \"id\" : 208477692,\r\n          \"type\" : \"transport\",\r\n          \"action\" : \"indices:data/write/bulk[s]\",\r\n          \"status\" : {\r\n            \"phase\" : \"rerouted\"\r\n          },\r\n          \"description\" : \"requests[6], index[17.1523351040000.0]\",\r\n          \"start_time\" : \"2018-04-12T21:17:45.177Z\",\r\n          \"start_time_in_millis\" : 1523567865177,\r\n          \"running_time\" : \"66.7d\",\r\n          \"running_time_in_nanos\" : 5765089166199822,\r\n          \"cancellable\" : false,\r\n          \"parent_task_id\" : \"pd5MT4eUSEqsOy_oq_q-vw:208477658\",\r\n          \"children\" : [\r\n            {\r\n              \"node\" : \"pacubgT0TfeaE0sIHWzbfA\",\r\n              \"id\" : 261543271,\r\n              \"type\" : \"netty\",\r\n              \"action\" : \"indices:data/write/bulk[s]\",\r\n              \"status\" : {\r\n                \"phase\" : \"waiting_on_primary\"\r\n              },\r\n              \"description\" : \"requests[6], index[17.1523351040000.0]\",\r\n              \"start_time\" : \"2018-04-12T21:17:45.182Z\",\r\n              \"start_time_in_millis\" : 1523567865182,\r\n              \"running_time\" : \"66.7d\",\r\n              \"running_time_in_nanos\" : 5765089159914921,\r\n              \"cancellable\" : false,\r\n              \"parent_task_id\" : \"pd5MT4eUSEqsOy_oq_q-vw:208477692\",\r\n              \"children\" : [\r\n                {\r\n                  \"node\" : \"pacubgT0TfeaE0sIHWzbfA\",\r\n                  \"id\" : 261543299,\r\n                  \"type\" : \"direct\",\r\n                  \"action\" : \"indices:data/write/bulk[s][p]\",\r\n                  \"status\" : {\r\n                    \"phase\" : \"primary\"\r\n                  },\r\n                  \"description\" : \"requests[6], index[17.1523351040000.0]\",\r\n                  \"start_time\" : \"2018-04-12T21:17:45.196Z\",\r\n                  \"start_time_in_millis\" : 1523567865196,\r\n                  \"running_time\" : \"66.7d\",\r\n                  \"running_time_in_nanos\" : 5765089146064289,\r\n                  \"cancellable\" : false,\r\n                  \"parent_task_id\" : \"pacubgT0TfeaE0sIHWzbfA:261543271\"\r\n                },\r\n                {\r\n                  \"node\" : \"3lgZ2bOCQs6xXcUda6OyuQ\",\r\n                  \"id\" : 256995983,\r\n                  \"type\" : \"netty\",\r\n                  \"action\" : \"indices:data/write/bulk[s][r]\",\r\n                  \"status\" : {\r\n                    \"phase\" : \"replica\"\r\n                  },\r\n                  \"description\" : \"requests[6], index[17.1523351040000.0]\",\r\n                  \"start_time\" : \"2018-04-12T21:17:45.217Z\",\r\n                  \"start_time_in_millis\" : 1523567865217,\r\n                  \"running_time\" : \"66.7d\",\r\n                  \"running_time_in_nanos\" : 5765089124501837,\r\n                  \"cancellable\" : false,\r\n                  \"parent_task_id\" : \"pacubgT0TfeaE0sIHWzbfA:261543271\"\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    ...\r\n    \"Pnwo6h_ATI6aV0WDKnubfw:225377459\" : {\r\n      \"node\" : \"Pnwo6h_ATI6aV0WDKnubfw\",\r\n      \"id\" : 225377459,\r\n      \"type\" : \"netty\",\r\n      \"action\" : \"indices:data/write/bulk\",\r\n      \"description\" : \"requests[706], indices[]\",\r\n      \"start_time\" : \"2018-04-13T07:04:22.308Z\",\r\n      \"start_time_in_millis\" : 1523603062308,\r\n      \"running_time\" : \"66.3d\",\r\n      \"running_time_in_nanos\" : 5729892034527237,\r\n      \"cancellable\" : false,\r\n      \"children\" : [\r\n        {\r\n          \"node\" : \"Pnwo6h_ATI6aV0WDKnubfw\",\r\n          \"id\" : 225377480,\r\n          \"type\" : \"transport\",\r\n          \"action\" : \"indices:data/write/bulk[s]\",\r\n          \"status\" : {\r\n            \"phase\" : \"rerouted\"\r\n          },\r\n          \"description\" : \"requests[11], index[210.1523585220000.0]\",\r\n          \"start_time\" : \"2018-04-13T07:04:22.310Z\",\r\n          \"start_time_in_millis\" : 1523603062310,\r\n          \"running_time\" : \"66.3d\",\r\n          \"running_time_in_nanos\" : 5729892032405972,\r\n          \"cancellable\" : false,\r\n          \"parent_task_id\" : \"Pnwo6h_ATI6aV0WDKnubfw:225377459\",\r\n          \"children\" : [\r\n            {\r\n              \"node\" : \"pacubgT0TfeaE0sIHWzbfA\",\r\n              \"id\" : 279050835,\r\n              \"type\" : \"netty\",\r\n              \"action\" : \"indices:data/write/bulk[s]\",\r\n              \"status\" : {\r\n                \"phase\" : \"waiting_on_primary\"\r\n              },\r\n              \"description\" : \"requests[11], index[210.1523585220000.0]\",\r\n              \"start_time\" : \"2018-04-13T07:04:22.312Z\",\r\n              \"start_time_in_millis\" : 1523603062312,\r\n              \"running_time\" : \"66.3d\",\r\n              \"running_time_in_nanos\" : 5729892030298850,\r\n              \"cancellable\" : false,\r\n              \"parent_task_id\" : \"Pnwo6h_ATI6aV0WDKnubfw:225377480\",\r\n              \"children\" : [\r\n                {\r\n                  \"node\" : \"pacubgT0TfeaE0sIHWzbfA\",\r\n                  \"id\" : 279050836,\r\n                  \"type\" : \"direct\",\r\n                  \"action\" : \"indices:data/write/bulk[s][p]\",\r\n                  \"status\" : {\r\n                    \"phase\" : \"primary\"\r\n                  },\r\n                  \"description\" : \"requests[11], index[210.1523585220000.0]\",\r\n                  \"start_time\" : \"2018-04-13T07:04:22.312Z\",\r\n                  \"start_time_in_millis\" : 1523603062312,\r\n                  \"running_time\" : \"66.3d\",\r\n                  \"running_time_in_nanos\" : 5729892030288175,\r\n                  \"cancellable\" : false,\r\n                  \"parent_task_id\" : \"pacubgT0TfeaE0sIHWzbfA:279050835\"\r\n                },\r\n                {\r\n                  \"node\" : \"pd5MT4eUSEqsOy_oq_q-vw\",\r\n                  \"id\" : 220870271,\r\n                  \"type\" : \"netty\",\r\n                  \"action\" : \"indices:data/write/bulk[s][r]\",\r\n                  \"status\" : {\r\n                    \"phase\" : \"replica\"\r\n                  },\r\n                  \"description\" : \"requests[11], index[210.1523585220000.0]\",\r\n                  \"start_time\" : \"2018-04-13T07:04:22.320Z\",\r\n                  \"start_time_in_millis\" : 1523603062320,\r\n                  \"running_time\" : \"66.3d\",\r\n                  \"running_time_in_nanos\" : 5729892022670077,\r\n                  \"cancellable\" : false,\r\n                  \"parent_task_id\" : \"pacubgT0TfeaE0sIHWzbfA:279050835\"\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    ...\r\n   \"bGuSrzBFTUii9qto-vPdQw:2391948877\" : {\r\n      \"node\" : \"bGuSrzBFTUii9qto-vPdQw\",\r\n      \"id\" : 2391948877,\r\n      \"type\" : \"netty\",\r\n      \"action\" : \"indices:data/write/bulk\",\r\n      \"description\" : \"requests[835], indices[]\",\r\n      \"start_time\" : \"2018-06-12T16:05:56.318Z\",\r\n      \"start_time_in_millis\" : 1528819556318,\r\n      \"running_time\" : \"5.9d\",\r\n      \"running_time_in_nanos\" : 513398024435017,\r\n      \"cancellable\" : false,\r\n      \"children\" : [\r\n        {\r\n          \"node\" : \"bGuSrzBFTUii9qto-vPdQw\",\r\n          \"id\" : 2391948914,\r\n          \"type\" : \"transport\",\r\n          \"action\" : \"indices:data/write/bulk[s]\",\r\n          \"status\" : {\r\n            \"phase\" : \"rerouted\"\r\n          },\r\n          \"description\" : \"requests[4], index[841.1528651620000.1]\",\r\n          \"start_time\" : \"2018-06-12T16:05:56.323Z\",\r\n          \"start_time_in_millis\" : 1528819556323,\r\n          \"running_time\" : \"5.9d\",\r\n          \"running_time_in_nanos\" : 513398020168910,\r\n          \"cancellable\" : false,\r\n          \"parent_task_id\" : \"bGuSrzBFTUii9qto-vPdQw:2391948877\",\r\n          \"children\" : [\r\n            {\r\n              \"node\" : \"evdbfKMRT_CDufvaHRaDAA\",\r\n              \"id\" : 2819410023,\r\n              \"type\" : \"netty\",\r\n              \"action\" : \"indices:data/write/bulk[s]\",\r\n              \"status\" : {\r\n                \"phase\" : \"waiting_on_primary\"\r\n              },\r\n              \"description\" : \"requests[4], index[841.1528651620000.1]\",\r\n              \"start_time\" : \"2018-06-12T16:05:56.322Z\",\r\n              \"start_time_in_millis\" : 1528819556322,\r\n              \"running_time\" : \"5.9d\",\r\n              \"running_time_in_nanos\" : 513398020793778,\r\n              \"cancellable\" : false,\r\n              \"parent_task_id\" : \"bGuSrzBFTUii9qto-vPdQw:2391948914\",\r\n              \"children\" : [\r\n                {\r\n                  \"node\" : \"evdbfKMRT_CDufvaHRaDAA\",\r\n                  \"id\" : 2819410080,\r\n                  \"type\" : \"direct\",\r\n                  \"action\" : \"indices:data/write/bulk[s][p]\",\r\n                  \"status\" : {\r\n                    \"phase\" : \"primary\"\r\n                  },\r\n                  \"description\" : \"requests[4], index[841.1528651620000.1]\",\r\n                  \"start_time\" : \"2018-06-12T16:05:56.346Z\",\r\n                  \"start_time_in_millis\" : 1528819556346,\r\n                  \"running_time\" : \"5.9d\",\r\n                  \"running_time_in_nanos\" : 513397996695634,\r\n                  \"cancellable\" : false,\r\n                  \"parent_task_id\" : \"evdbfKMRT_CDufvaHRaDAA:2819410023\"\r\n                },\r\n                {\r\n                  \"node\" : \"FDW9DMoWTiOX7AeQ8xmdCA\",\r\n                  \"id\" : 2589448571,\r\n                  \"type\" : \"netty\",\r\n                  \"action\" : \"indices:data/write/bulk[s][r]\",\r\n                  \"status\" : {\r\n                    \"phase\" : \"replica\"\r\n                  },\r\n                  \"description\" : \"requests[4], index[841.1528651620000.1]\",\r\n                  \"start_time\" : \"2018-06-12T16:05:56.380Z\",\r\n                  \"start_time_in_millis\" : 1528819556380,\r\n                  \"running_time\" : \"5.9d\",\r\n                  \"running_time_in_nanos\" : 513397960736985,\r\n                  \"cancellable\" : false,\r\n                  \"parent_task_id\" : \"evdbfKMRT_CDufvaHRaDAA:2819410023\"\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    ...\r\n\r\n```","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398088371","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-398088371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":398088371,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODA4ODM3MQ==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T15:11:09Z","updated_at":"2018-06-18T15:11:09Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398096494","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-398096494","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":398096494,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODA5NjQ5NA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-06-18T15:34:28Z","updated_at":"2018-06-18T15:34:28Z","author_association":"MEMBER","body":"@jeancornic thanks. It seems these are stuck waiting for a replica that never responded. The two tickets that you mention are similar in nature, but I don't see anything here that point in that direction.\r\n\r\nI understand that you see this regularly. Is that true? if so, can you maybe upgrade to 6.3.0 and see how it goes? it will help reduce the scope of the search. \r\n\r\nSome more generic questions about your setup:\r\n1) Do you use dynamic mapping?\r\n2) Is there anything else of note in the logs?  The replica nodes (FDW9DMoWTiOX7AeQ8xmdCA & pd5MT4eUSEqsOy_oq_q-vw) are interesting.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/398474826","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-398474826","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":398474826,"node_id":"MDEyOklzc3VlQ29tbWVudDM5ODQ3NDgyNg==","user":{"login":"jeancornic","id":1595643,"node_id":"MDQ6VXNlcjE1OTU2NDM=","avatar_url":"https://avatars0.githubusercontent.com/u/1595643?v=4","gravatar_id":"","url":"https://api.github.com/users/jeancornic","html_url":"https://github.com/jeancornic","followers_url":"https://api.github.com/users/jeancornic/followers","following_url":"https://api.github.com/users/jeancornic/following{/other_user}","gists_url":"https://api.github.com/users/jeancornic/gists{/gist_id}","starred_url":"https://api.github.com/users/jeancornic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeancornic/subscriptions","organizations_url":"https://api.github.com/users/jeancornic/orgs","repos_url":"https://api.github.com/users/jeancornic/repos","events_url":"https://api.github.com/users/jeancornic/events{/privacy}","received_events_url":"https://api.github.com/users/jeancornic/received_events","type":"User","site_admin":false},"created_at":"2018-06-19T17:10:17Z","updated_at":"2018-06-19T17:12:03Z","author_association":"NONE","body":"@bleskes Thanks for those comments.\r\nWe see this regularly indeed, several times a week.\r\n\r\nMigrating to 6.3.0 is not very straightforward for us to be honest.\r\n\r\n1. We don't use dynamic mapping\r\n2. Investigated another task than the one in example, more recent: \r\n\r\n```\r\n\"WpsOgw9JTxivBHkMatVPrQ:2158610039\" : {\r\n      \"node\" : \"WpsOgw9JTxivBHkMatVPrQ\",\r\n      \"id\" : 2158610039,\r\n      \"type\" : \"netty\",\r\n      \"action\" : \"indices:data/write/bulk\",\r\n      \"description\" : \"requests[671], indices[]\",\r\n      \"start_time\" : \"2018-06-17T22:06:29.484Z\",\r\n      \"start_time_in_millis\" : 1529273189484,\r\n      \"running_time\" : \"1.7d\",\r\n      \"running_time_in_nanos\" : 153023445214125,\r\n      \"cancellable\" : false,\r\n      \"children\" : [\r\n        {\r\n          \"node\" : \"WpsOgw9JTxivBHkMatVPrQ\",\r\n          \"id\" : 2158610093,\r\n          \"type\" : \"transport\",\r\n          \"action\" : \"indices:data/write/bulk[s]\",\r\n          \"status\" : {\r\n            \"phase\" : \"rerouted\"\r\n          },\r\n          \"description\" : \"requests[29], index[13.1529271600000.1]\",\r\n          \"start_time\" : \"2018-06-17T22:06:29.487Z\",\r\n          \"start_time_in_millis\" : 1529273189487,\r\n          \"running_time\" : \"1.7d\",\r\n          \"running_time_in_nanos\" : 153023441823453,\r\n          \"cancellable\" : false,\r\n          \"parent_task_id\" : \"WpsOgw9JTxivBHkMatVPrQ:2158610039\",\r\n          \"children\" : [\r\n            {\r\n              \"node\" : \"63tYulq1Q7qhsMAcQXR6Bg\",\r\n              \"id\" : 1928749409,\r\n              \"type\" : \"netty\",\r\n              \"action\" : \"indices:data/write/bulk[s]\",\r\n              \"status\" : {\r\n                \"phase\" : \"waiting_on_primary\"\r\n              },\r\n              \"description\" : \"requests[29], index[13.1529271600000.1]\",\r\n              \"start_time\" : \"2018-06-17T22:06:29.488Z\",\r\n              \"start_time_in_millis\" : 1529273189488,\r\n              \"running_time\" : \"1.7d\",\r\n              \"running_time_in_nanos\" : 153023440722690,\r\n              \"cancellable\" : false,\r\n              \"parent_task_id\" : \"WpsOgw9JTxivBHkMatVPrQ:2158610093\",\r\n              \"children\" : [\r\n                {\r\n                  \"node\" : \"FDW9DMoWTiOX7AeQ8xmdCA\",\r\n                  \"id\" : 2871784213,\r\n                  \"type\" : \"netty\",\r\n                  \"action\" : \"indices:data/write/bulk[s][r]\",\r\n                  \"status\" : {\r\n                    \"phase\" : \"replica\"\r\n                  },\r\n                  \"description\" : \"requests[29], index[13.1529271600000.1]\",\r\n                  \"start_time\" : \"2018-06-17T22:06:29.544Z\",\r\n                  \"start_time_in_millis\" : 1529273189544,\r\n                  \"running_time\" : \"1.7d\",\r\n                  \"running_time_in_nanos\" : 153023387248385,\r\n                  \"cancellable\" : false,\r\n                  \"parent_task_id\" : \"63tYulq1Q7qhsMAcQXR6Bg:1928749409\"\r\n                },\r\n                {\r\n                  \"node\" : \"63tYulq1Q7qhsMAcQXR6Bg\",\r\n                  \"id\" : 1928749487,\r\n                  \"type\" : \"direct\",\r\n                  \"action\" : \"indices:data/write/bulk[s][p]\",\r\n                  \"status\" : {\r\n                    \"phase\" : \"primary\"\r\n                  },\r\n                  \"description\" : \"requests[29], index[13.1529271600000.1]\",\r\n                  \"start_time\" : \"2018-06-17T22:06:29.499Z\",\r\n                  \"start_time_in_millis\" : 1529273189499,\r\n                  \"running_time\" : \"1.7d\",\r\n                  \"running_time_in_nanos\" : 153023430180000,\r\n                  \"cancellable\" : false,\r\n                  \"parent_task_id\" : \"63tYulq1Q7qhsMAcQXR6Bg:1928749409\"\r\n                }\r\n              ]\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }\r\n```\r\n\r\nIn the logs (on the 3 nodes `WpsOgw9JTxivBHkMatVPrQ`, `63tYulq1Q7qhsMAcQXR6Bg` & `FDW9DMoWTiOX7AeQ8xmdCA`), I don't find anything relevant:\r\n\r\n* indexing slowlogs, < 500ms\r\n\r\n* some debug logs, async flush request, async roll translog generation & merge\r\n\r\n```\r\n...\r\n[2018-06-17T22:11:22,131][DEBUG][o.e.i.s.IndexShard       ] [***] [13.1529271600000.1][4] submitting async flush request\r\n...\r\n[2018-06-17T22:06:37,917][DEBUG][o.e.i.s.IndexShard       ] [***] [13.1529271600000.1][0] submitting async roll translog generation request\r\n...\r\n[2018-06-17T22:06:41,358][DEBUG][o.e.i.e.InternalEngine$EngineMergeScheduler] [***] [13.1529271600000.1][4] merge segment [_7e] done: took [25.4s], [375.2 MB], [526,460 docs], [0s stopped], [17.8s throttled], [364.3 MB written], [16.5 MB/sec throttle]\r\n...\r\n```\r\n\r\nSeeing also one\r\n\r\n```\r\n[2018-06-19T02:18:09,096][WARN ][o.e.t.n.Netty4Transport  ] [***] send message failed [channel: org.elasticsearch.transport.netty4.NettyTcpChannel@542b0ecb]\r\njava.nio.channels.ClosedChannelException: null\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe.write(...)(Unknown Source) ~[?:?]\r\n```\r\n\r\nbut 4 hours after the bulk, probably unrelated.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/399426168","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-399426168","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":399426168,"node_id":"MDEyOklzc3VlQ29tbWVudDM5OTQyNjE2OA==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2018-06-22T12:29:14Z","updated_at":"2018-06-22T12:29:14Z","author_association":"MEMBER","body":"@jeancornic thanks. Nothing pops up directly here, which means it's going to be a long search. It's good it happens frequently as it greatly increases to chance of finding out what its.\r\n\r\nThe the last log message you sent is important: \r\n```\r\n[2018-06-19T02:18:09,096][WARN ][o.e.t.n.Netty4Transport  ] [***] send message failed [channel: org.elasticsearch.transport.netty4.NettyTcpChannel@542b0ecb]\r\njava.nio.channels.ClosedChannelException: null\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe.write(...)(Unknown Source) ~[?:?]\r\n```\r\n\r\nCan you post the full stack trace for this? can you also check other nodes for transport level logs that look suspicious?\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/428029513","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-428029513","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":428029513,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODAyOTUxMw==","user":{"login":"linyy2233","id":39547259,"node_id":"MDQ6VXNlcjM5NTQ3MjU5","avatar_url":"https://avatars3.githubusercontent.com/u/39547259?v=4","gravatar_id":"","url":"https://api.github.com/users/linyy2233","html_url":"https://github.com/linyy2233","followers_url":"https://api.github.com/users/linyy2233/followers","following_url":"https://api.github.com/users/linyy2233/following{/other_user}","gists_url":"https://api.github.com/users/linyy2233/gists{/gist_id}","starred_url":"https://api.github.com/users/linyy2233/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/linyy2233/subscriptions","organizations_url":"https://api.github.com/users/linyy2233/orgs","repos_url":"https://api.github.com/users/linyy2233/repos","events_url":"https://api.github.com/users/linyy2233/events{/privacy}","received_events_url":"https://api.github.com/users/linyy2233/received_events","type":"User","site_admin":false},"created_at":"2018-10-09T01:28:24Z","updated_at":"2018-10-09T01:40:21Z","author_association":"NONE","body":"We also encountered the same problem, this task caused several nodes to load very high, and then the cluster could not write. Restart the node with high load to recover. Is there a solution? Thank you.\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/428033072","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-428033072","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":428033072,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODAzMzA3Mg==","user":{"login":"linyy2233","id":39547259,"node_id":"MDQ6VXNlcjM5NTQ3MjU5","avatar_url":"https://avatars3.githubusercontent.com/u/39547259?v=4","gravatar_id":"","url":"https://api.github.com/users/linyy2233","html_url":"https://github.com/linyy2233","followers_url":"https://api.github.com/users/linyy2233/followers","following_url":"https://api.github.com/users/linyy2233/following{/other_user}","gists_url":"https://api.github.com/users/linyy2233/gists{/gist_id}","starred_url":"https://api.github.com/users/linyy2233/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/linyy2233/subscriptions","organizations_url":"https://api.github.com/users/linyy2233/orgs","repos_url":"https://api.github.com/users/linyy2233/repos","events_url":"https://api.github.com/users/linyy2233/events{/privacy}","received_events_url":"https://api.github.com/users/linyy2233/received_events","type":"User","site_admin":false},"created_at":"2018-10-09T01:50:57Z","updated_at":"2018-10-09T01:50:57Z","author_association":"NONE","body":"node hot_threads\r\n![image](https://user-images.githubusercontent.com/39547259/46642241-b36cdb00-cba8-11e8-9b8c-2648cbc54fe9.png)\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/428374945","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-428374945","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":428374945,"node_id":"MDEyOklzc3VlQ29tbWVudDQyODM3NDk0NQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-10-09T22:28:25Z","updated_at":"2018-10-09T22:28:25Z","author_association":"CONTRIBUTOR","body":"@linyy2233 it looks like you're having a different (unrelated) problem, possibly caused by having a very large JSON number in your document? Can you open a topic on discuss.elastic.co please for further investigation? Thanks.\r\n\r\nAlso, as no reply on original ticket, closing this.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448865441","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-448865441","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":448865441,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODg2NTQ0MQ==","user":{"login":"seborys","id":44475558,"node_id":"MDQ6VXNlcjQ0NDc1NTU4","avatar_url":"https://avatars3.githubusercontent.com/u/44475558?v=4","gravatar_id":"","url":"https://api.github.com/users/seborys","html_url":"https://github.com/seborys","followers_url":"https://api.github.com/users/seborys/followers","following_url":"https://api.github.com/users/seborys/following{/other_user}","gists_url":"https://api.github.com/users/seborys/gists{/gist_id}","starred_url":"https://api.github.com/users/seborys/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seborys/subscriptions","organizations_url":"https://api.github.com/users/seborys/orgs","repos_url":"https://api.github.com/users/seborys/repos","events_url":"https://api.github.com/users/seborys/events{/privacy}","received_events_url":"https://api.github.com/users/seborys/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T04:36:11Z","updated_at":"2018-12-20T04:36:11Z","author_association":"NONE","body":"@jeancornic Did you ever get more info on this? Experiencing the same.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/448903709","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-448903709","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":448903709,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODkwMzcwOQ==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2018-12-20T07:43:40Z","updated_at":"2018-12-20T07:43:40Z","author_association":"CONTRIBUTOR","body":"For the case where tasks are stuck on replicas (Tasks are organized in a tree hierarchy, and the leaves are tasks with an action name `indices:data/write/bulk[s][r]`, i.e., ending in `[r]`), we found the root cause yesterday and created a fix (see https://github.com/elastic/elasticsearch/pull/36770). Note that there can be other reasons for stuck tasks, so if your leaf tasks are not replica tasks, they might be stuck for a different reason.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/451718096","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-451718096","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":451718096,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTcxODA5Ng==","user":{"login":"linyy2233","id":39547259,"node_id":"MDQ6VXNlcjM5NTQ3MjU5","avatar_url":"https://avatars3.githubusercontent.com/u/39547259?v=4","gravatar_id":"","url":"https://api.github.com/users/linyy2233","html_url":"https://github.com/linyy2233","followers_url":"https://api.github.com/users/linyy2233/followers","following_url":"https://api.github.com/users/linyy2233/following{/other_user}","gists_url":"https://api.github.com/users/linyy2233/gists{/gist_id}","starred_url":"https://api.github.com/users/linyy2233/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/linyy2233/subscriptions","organizations_url":"https://api.github.com/users/linyy2233/orgs","repos_url":"https://api.github.com/users/linyy2233/repos","events_url":"https://api.github.com/users/linyy2233/events{/privacy}","received_events_url":"https://api.github.com/users/linyy2233/received_events","type":"User","site_admin":false},"created_at":"2019-01-06T06:05:13Z","updated_at":"2019-01-06T06:05:13Z","author_association":"NONE","body":"Thanks, I changed this parameter to false and it does not appear.\r\nnumeric_detection","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/606215092","html_url":"https://github.com/elastic/elasticsearch/issues/31099#issuecomment-606215092","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/31099","id":606215092,"node_id":"MDEyOklzc3VlQ29tbWVudDYwNjIxNTA5Mg==","user":{"login":"IvanBoyko","id":16935427,"node_id":"MDQ6VXNlcjE2OTM1NDI3","avatar_url":"https://avatars3.githubusercontent.com/u/16935427?v=4","gravatar_id":"","url":"https://api.github.com/users/IvanBoyko","html_url":"https://github.com/IvanBoyko","followers_url":"https://api.github.com/users/IvanBoyko/followers","following_url":"https://api.github.com/users/IvanBoyko/following{/other_user}","gists_url":"https://api.github.com/users/IvanBoyko/gists{/gist_id}","starred_url":"https://api.github.com/users/IvanBoyko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IvanBoyko/subscriptions","organizations_url":"https://api.github.com/users/IvanBoyko/orgs","repos_url":"https://api.github.com/users/IvanBoyko/repos","events_url":"https://api.github.com/users/IvanBoyko/events{/privacy}","received_events_url":"https://api.github.com/users/IvanBoyko/received_events","type":"User","site_admin":false},"created_at":"2020-03-30T20:02:20Z","updated_at":"2020-03-30T20:03:50Z","author_association":"NONE","body":"We experience the same problem on 6.8.7\r\n\r\nIs there any generic workaround how to delete stuck tasks?\r\nWe are Ok to lose this data, it would be great to recover the cluster at all.\r\n\r\nExample:\r\n```\r\n    \"hep4suvHTgWKgYGcDoseCA:5469\": {\r\n      \"node\": \"hep4suvHTgWKgYGcDoseCA\",\r\n      \"id\": 5469,\r\n      \"type\": \"transport\",\r\n      \"action\": \"indices:data/write/bulk\",\r\n      \"description\": \"requests[2], indices[.monitoring-es-6-2020.03.30]\",\r\n      \"start_time_in_millis\": 1585591712424,\r\n      \"running_time_in_nanos\": 6472053578715,\r\n      \"cancellable\": false,\r\n      \"headers\": {},\r\n      \"children\": [\r\n        {\r\n          \"node\": \"hep4suvHTgWKgYGcDoseCA\",\r\n          \"id\": 5483,\r\n          \"type\": \"transport\",\r\n          \"action\": \"indices:data/write/bulk[s]\",\r\n          \"status\": {\r\n            \"phase\": \"waiting_on_primary\"\r\n          },\r\n          \"description\": \"requests[2], index[.monitoring-es-6-2020.03.30]\",\r\n          \"start_time_in_millis\": 1585591712440,\r\n          \"running_time_in_nanos\": 6472037944119,\r\n          \"cancellable\": false,\r\n          \"parent_task_id\": \"hep4suvHTgWKgYGcDoseCA:5469\",\r\n          \"headers\": {},\r\n          \"children\": [\r\n            {\r\n              \"node\": \"hep4suvHTgWKgYGcDoseCA\",\r\n              \"id\": 6148,\r\n              \"type\": \"direct\",\r\n              \"action\": \"indices:data/write/bulk[s][p]\",\r\n              \"status\": {\r\n                \"phase\": \"primary\"\r\n              },\r\n              \"description\": \"requests[2], index[.monitoring-es-6-2020.03.30]\",\r\n              \"start_time_in_millis\": 1585591720956,\r\n              \"running_time_in_nanos\": 6463522255014,\r\n              \"cancellable\": false,\r\n              \"parent_task_id\": \"hep4suvHTgWKgYGcDoseCA:5483\",\r\n              \"headers\": {}\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }\r\n```","performed_via_github_app":null}]