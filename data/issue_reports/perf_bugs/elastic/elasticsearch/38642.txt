{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/38642","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38642/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38642/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/38642/events","html_url":"https://github.com/elastic/elasticsearch/issues/38642","id":408267431,"node_id":"MDU6SXNzdWU0MDgyNjc0MzE=","number":38642,"title":"Slowlog format different than regular logs ","user":{"login":"almiche","id":14715156,"node_id":"MDQ6VXNlcjE0NzE1MTU2","avatar_url":"https://avatars0.githubusercontent.com/u/14715156?v=4","gravatar_id":"","url":"https://api.github.com/users/almiche","html_url":"https://github.com/almiche","followers_url":"https://api.github.com/users/almiche/followers","following_url":"https://api.github.com/users/almiche/following{/other_user}","gists_url":"https://api.github.com/users/almiche/gists{/gist_id}","starred_url":"https://api.github.com/users/almiche/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/almiche/subscriptions","organizations_url":"https://api.github.com/users/almiche/orgs","repos_url":"https://api.github.com/users/almiche/repos","events_url":"https://api.github.com/users/almiche/events{/privacy}","received_events_url":"https://api.github.com/users/almiche/received_events","type":"User","site_admin":false},"labels":[{"id":151561891,"node_id":"MDU6TGFiZWwxNTE1NjE4OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Logging","name":":Core/Infra/Logging","color":"0e8a16","default":false,"description":"Log management and logging utilities"}],"state":"closed","locked":false,"assignee":{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false},"assignees":[{"login":"pgomulka","id":11137008,"node_id":"MDQ6VXNlcjExMTM3MDA4","avatar_url":"https://avatars0.githubusercontent.com/u/11137008?v=4","gravatar_id":"","url":"https://api.github.com/users/pgomulka","html_url":"https://github.com/pgomulka","followers_url":"https://api.github.com/users/pgomulka/followers","following_url":"https://api.github.com/users/pgomulka/following{/other_user}","gists_url":"https://api.github.com/users/pgomulka/gists{/gist_id}","starred_url":"https://api.github.com/users/pgomulka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgomulka/subscriptions","organizations_url":"https://api.github.com/users/pgomulka/orgs","repos_url":"https://api.github.com/users/pgomulka/repos","events_url":"https://api.github.com/users/pgomulka/events{/privacy}","received_events_url":"https://api.github.com/users/pgomulka/received_events","type":"User","site_admin":false}],"milestone":null,"comments":8,"created_at":"2019-02-08T18:17:25Z","updated_at":"2019-02-11T18:12:10Z","closed_at":"2019-02-11T18:12:10Z","author_association":"NONE","active_lock_reason":null,"body":"<!-- Bug report -->\r\n\r\n**Elasticsearch version** (`bin/elasticsearch --version`): 6.6.0\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version** (`java -version`):\r\nhttp://docker.elastic.co/elasticsearch/elasticsearch:6.6.0 (Unchanged from within the image)\r\n\r\n**OS version** (`uname -a` if on a Unix-like system): http://docker.elastic.co/elasticsearch/elasticsearch:6.6.0\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nIt seems that slowlogs specifically with elasticsearch have been implemented in such a way which would not allow us to add an extra field in the logs. See below for an explanation.\r\n\r\nBelow we can see a sample log4j.properties file which is used to specify the pattern layouts used by lo4j. The first `appender.console.layout.pattern` is used to specify the layout of most logs. The same present pattern is reused below for the pattern that log4j is using for slowlogs. The problem is that the log being output is different in both cases.\r\n         \r\n`appender.console.layout.pattern = {\\\"source\\\":\\\"elasticsearch_log\\\",\\\"msg\\\":\\\"%m %throwable\\\"}%n`\r\n\r\n`appender.index_search_slowlog_rolling.layout.pattern = {\\\"source\\\":\\\"slowlog\\\",\\\"msg\\\":\\\"%m %throwable\\\"}%n `\r\n\r\nTaking a look at the raw output we can see that the log produced by the slowlog appender is does not come out as a valid JSON due to the %m field.\r\n\r\n`{\"source\":\"slowlog\",\"msg\":\"[twitter][1] took[153.3micros], took_millis[0], total_hits[0], types[], stats[], search_type[QUERY_THEN_FETCH], total_shards[3], source[{\"size\":1}], id[],  \"} `\r\n\r\n![image](https://user-images.githubusercontent.com/14715156/52572696-6151f580-2de6-11e9-8451-a334f4d02686.png)\r\n\r\nThe same is not true for regular logs which are indeed a valid json:\r\n\r\n`{\"source\":\"elasticsearch_log\",\"msg\":\"updating [index.search.slowlog.threshold.fetch.trace] from [200ms] to [0s] \"}`\r\n\r\n**Steps to reproduce**:\r\n\r\nPlease include a *minimal* but *complete* recreation of the problem, including\r\n(e.g.) index creation, mappings, settings, query etc.  The easier you make for\r\nus to reproduce it, the more likely that somebody will take the time to look at it.\r\n\r\n 1. Adding the following Pattern layouts to appender.index_search_slowlog_rolling.layout.pattern and appender.console.layout.pattern `{\\\"source\\\":\\\"slowlog\\\",\\\"msg\\\":\\\"%m %throwable\\\"}%n'\r\n2. Enable slowlogs\r\n\r\n**Provide logs (if relevant)**:\r\nSee images above ^^\r\n","closed_by":{"login":"almiche","id":14715156,"node_id":"MDQ6VXNlcjE0NzE1MTU2","avatar_url":"https://avatars0.githubusercontent.com/u/14715156?v=4","gravatar_id":"","url":"https://api.github.com/users/almiche","html_url":"https://github.com/almiche","followers_url":"https://api.github.com/users/almiche/followers","following_url":"https://api.github.com/users/almiche/following{/other_user}","gists_url":"https://api.github.com/users/almiche/gists{/gist_id}","starred_url":"https://api.github.com/users/almiche/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/almiche/subscriptions","organizations_url":"https://api.github.com/users/almiche/orgs","repos_url":"https://api.github.com/users/almiche/repos","events_url":"https://api.github.com/users/almiche/events{/privacy}","received_events_url":"https://api.github.com/users/almiche/received_events","type":"User","site_admin":false},"performed_via_github_app":null}