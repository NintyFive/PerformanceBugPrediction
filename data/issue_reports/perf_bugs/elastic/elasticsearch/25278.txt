{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/25278/events","html_url":"https://github.com/elastic/elasticsearch/issues/25278","id":236551215,"node_id":"MDU6SXNzdWUyMzY1NTEyMTU=","number":25278,"title":"ES 5.4 percolator is 3 times slower than ES 1.6 percolator","user":{"login":"dennisgorelik","id":4333866,"node_id":"MDQ6VXNlcjQzMzM4NjY=","avatar_url":"https://avatars2.githubusercontent.com/u/4333866?v=4","gravatar_id":"","url":"https://api.github.com/users/dennisgorelik","html_url":"https://github.com/dennisgorelik","followers_url":"https://api.github.com/users/dennisgorelik/followers","following_url":"https://api.github.com/users/dennisgorelik/following{/other_user}","gists_url":"https://api.github.com/users/dennisgorelik/gists{/gist_id}","starred_url":"https://api.github.com/users/dennisgorelik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dennisgorelik/subscriptions","organizations_url":"https://api.github.com/users/dennisgorelik/orgs","repos_url":"https://api.github.com/users/dennisgorelik/repos","events_url":"https://api.github.com/users/dennisgorelik/events{/privacy}","received_events_url":"https://api.github.com/users/dennisgorelik/received_events","type":"User","site_admin":false},"labels":[{"id":156502592,"node_id":"MDU6TGFiZWwxNTY1MDI1OTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Percolator","name":":Search/Percolator","color":"0e8a16","default":false,"description":"Reverse search: find queries that match a document"}],"state":"closed","locked":false,"assignee":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"assignees":[{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false}],"milestone":null,"comments":6,"created_at":"2017-06-16T17:53:27Z","updated_at":"2017-09-22T14:14:08Z","closed_at":"2017-09-22T14:14:08Z","author_association":"NONE","active_lock_reason":null,"body":"https://github.com/elastic/elasticsearch/issues/23709\r\nElasticSearch 5.4 percolator execution time is approximately 3 times longer than ElasticSearch 1.6 percolator execution time.\r\n(So the empirical rule is that percolator execution time grows approximately proportional to the ElasticSearch version number: 5.4/1.6 ~= 3).\r\n\r\nThat slowness is not very surprising, considering that percolator index size increased about 7 times (from 21.1 MB in ES 1.6 to 144 MB in ES 5.4).\r\n\r\nThis is our setup:\r\n```\r\n227,906 percolator queries (job alerts that include text query and/or location).\r\n30 documents to percolate in a single batch.\r\nProcessor: i7-7700 (4 cores with up to 4.20 GHz)\r\n```\r\n\r\nExecution time for the percolator batch\r\n```\r\nES 1.6:  9.095s\r\nES 5.4: 26.736s\r\n```\r\n\r\n```\r\nCPU utilization: 100% (on both versions of ElasticSearch)\r\n```\r\n\r\nIn the hopes of improving performance, we tried to represent percolator queries is 3 different forms:\r\n```\r\n1) \"bool/must\"\r\n2) \"bool/filter\"\r\n3) \"bool/must/filter\"\r\n```\r\nIn all 3 cases percolator index size and execution time of percolate batch changed only few percent.\r\n\r\n\r\nI see that similar issue was already reported 3 months ago and is still open:\r\n[Geo operations in ES 5.1.2 are slower than older ES](https://github.com/elastic/elasticsearch/issues/23709)\r\n","closed_by":{"login":"martijnvg","id":580421,"node_id":"MDQ6VXNlcjU4MDQyMQ==","avatar_url":"https://avatars3.githubusercontent.com/u/580421?v=4","gravatar_id":"","url":"https://api.github.com/users/martijnvg","html_url":"https://github.com/martijnvg","followers_url":"https://api.github.com/users/martijnvg/followers","following_url":"https://api.github.com/users/martijnvg/following{/other_user}","gists_url":"https://api.github.com/users/martijnvg/gists{/gist_id}","starred_url":"https://api.github.com/users/martijnvg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martijnvg/subscriptions","organizations_url":"https://api.github.com/users/martijnvg/orgs","repos_url":"https://api.github.com/users/martijnvg/repos","events_url":"https://api.github.com/users/martijnvg/events{/privacy}","received_events_url":"https://api.github.com/users/martijnvg/received_events","type":"User","site_admin":false},"performed_via_github_app":null}