{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/21692","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21692/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21692/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/21692/events","html_url":"https://github.com/elastic/elasticsearch/issues/21692","id":190657832,"node_id":"MDU6SXNzdWUxOTA2NTc4MzI=","number":21692,"title":"Bad performance of index creation on dockerized ES 5.0.1","user":{"login":"ksuszka","id":1556377,"node_id":"MDQ6VXNlcjE1NTYzNzc=","avatar_url":"https://avatars2.githubusercontent.com/u/1556377?v=4","gravatar_id":"","url":"https://api.github.com/users/ksuszka","html_url":"https://github.com/ksuszka","followers_url":"https://api.github.com/users/ksuszka/followers","following_url":"https://api.github.com/users/ksuszka/following{/other_user}","gists_url":"https://api.github.com/users/ksuszka/gists{/gist_id}","starred_url":"https://api.github.com/users/ksuszka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ksuszka/subscriptions","organizations_url":"https://api.github.com/users/ksuszka/orgs","repos_url":"https://api.github.com/users/ksuszka/repos","events_url":"https://api.github.com/users/ksuszka/events{/privacy}","received_events_url":"https://api.github.com/users/ksuszka/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-11-21T09:14:04Z","updated_at":"2018-01-17T15:51:13Z","closed_at":"2016-11-21T10:40:30Z","author_association":"NONE","active_lock_reason":null,"body":"**Elasticsearch version**: 5.0.1 from official docker image, run on Docker for Mac version 1.12.3-beta30\r\n\r\n**Plugins installed**: []\r\n\r\n**JVM version**: N/A\r\n\r\n**OS version**: OS.X 10.11.5 on host\r\n\r\n**Description of the problem including expected versus actual behavior**:\r\n\r\nCreating multiple indexes in dockerized ES 5.0.1 is much slower than in dockerized ES 2.3.3.\r\nAlso, initializing docker image for ES 5.0.1 is much slower then for ES 2.3.3 (but it is not a big issue for me)\r\n\r\n**Steps to reproduce**:\r\n 1. Run plain docker images of ES 2.3.3 and ES 5.0.1 and measure time of creating 20 indexes in each.\r\n\r\nI've prepared [bash script](https://gist.github.com/ksuszka/66072853fd32c3c7781ec0eb0ff33342) to visualize issue.\r\n\r\n**Provide logs (if relevant)**:\r\n\r\nSample output from running test script:\r\n```\r\n------------------------------------------------\r\nInitializing docker for elasticsearch:2.3.3\r\nWaiting for elasticsearch (at localhost:9200)...\r\n.........\r\nElasticsearch initialized in:\r\n\r\nreal\t0m9.267s\r\nuser\t0m0.055s\r\nsys\t0m0.068s\r\n\r\nCreating indexes in sequence...\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\nIndexes created in:\r\n\r\nreal\t0m5.161s\r\nuser\t0m0.047s\r\nsys\t0m0.052s\r\n\r\nChecking if index responds...\r\n{\"index_seq_1\":{\"aliases\":{},\"mappings\":{},\"settings\":{\"index\":{\"creation_date\":\"1479718173756\",\"number_of_shards\":\"5\",\"number_of_replicas\":\"1\",\"uuid\":\"P-ko2qJdRseoQiTk-FOOxA\",\"version\":{\"created\":\"2030399\"}}},\"warmers\":{}}}\r\n\r\nCreating indexes in parallel...\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\n{\"acknowledged\":true}\r\nIndexes created in:\r\n\r\nreal\t0m1.062s\r\nuser\t0m0.054s\r\nsys\t0m0.072s\r\n\r\nChecking if index responds...\r\n{\"index_par_1\":{\"aliases\":{},\"mappings\":{},\"settings\":{\"index\":{\"creation_date\":\"1479718179523\",\"number_of_shards\":\"5\",\"number_of_replicas\":\"1\",\"uuid\":\"gdt70ghrS6mh3_fAGfNHJg\",\"version\":{\"created\":\"2030399\"}}},\"warmers\":{}}}\r\n\r\nKilling elasticsearch\r\n904169fbdcb7010fc3df99127eaf081b04ec7415ed79e202f1fa41c069f2317c\r\n------------------------------------------------\r\nInitializing docker for elasticsearch:5.0.1\r\nWaiting for elasticsearch (at localhost:9200)...\r\n..........................\r\nElasticsearch initialized in:\r\n\r\nreal\t0m27.063s\r\nuser\t0m0.186s\r\nsys\t0m0.242s\r\n\r\nCreating indexes in sequence...\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\nIndexes created in:\r\n\r\nreal\t0m10.474s\r\nuser\t0m0.041s\r\nsys\t0m0.049s\r\n\r\nChecking if index responds...\r\n{\"index_seq_1\":{\"aliases\":{},\"mappings\":{},\"settings\":{\"index\":{\"creation_date\":\"1479718209409\",\"number_of_shards\":\"5\",\"number_of_replicas\":\"1\",\"uuid\":\"g4oac0gDSKOgkX16L1OalA\",\"version\":{\"created\":\"5000199\"},\"provided_name\":\"index_seq_1\"}}}}\r\n\r\nCreating indexes in parallel...\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\n{\"acknowledged\":true,\"shards_acknowledged\":true}\r\nIndexes created in:\r\n\r\nreal\t0m8.862s\r\nuser\t0m0.052s\r\nsys\t0m0.067s\r\n\r\nChecking if index responds...\r\n{\"index_par_1\":{\"aliases\":{},\"mappings\":{},\"settings\":{\"index\":{\"creation_date\":\"1479718221107\",\"number_of_shards\":\"5\",\"number_of_replicas\":\"1\",\"uuid\":\"rBItyGg0SzCKM3UqVqTtkQ\",\"version\":{\"created\":\"5000199\"},\"provided_name\":\"index_par_1\"}}}}\r\n\r\nKilling elasticsearch\r\n0b3fa86c87573e7c1fe1914b1ccfba10efd28dc309ddac751d89365384aeb810\r\n```\r\n\r\nAs you can see time of creating indexes is greater for ES 5.0.1 than for ES 2.3.3.\r\n\r\nIs is an issue for us, as we run our integration tests in dockerized environment and we ad-hoc create/initialize ES in those tests.","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}