[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/522910367","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-522910367","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":522910367,"node_id":"MDEyOklzc3VlQ29tbWVudDUyMjkxMDM2Nw==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2019-08-20T08:25:06Z","updated_at":"2019-08-20T08:25:06Z","author_association":"CONTRIBUTOR","body":"Thanks very much for your interest in Elasticsearch.\r\n\r\nThis appears to be a user question, and we'd like to direct these kinds of things to the [forums](https://discuss.elastic.co/). If you can stop by there, we'd appreciate it. This allows us to use GitHub for verified bug reports, feature requests, and pull requests.\r\n\r\nThere's an active community in the [forums](https://discuss.elastic.co/) that should be able to help get an answer to your question. As such, I hope you don't mind that I close this.\r\n\r\nFinally note that we track performance across releases in https://elasticsearch-benchmarks.elastic.co and you can see results between 6.8 and 7.3 e.g. for date_histogram using the [nyc_taxis track](https://github.com/elastic/rally-tracks/blob/9dcc5ab42eeadad01a943655ec0603334c2dcd33/nyc_taxis/operations/default.json#L87-L109) in https://elasticsearch-benchmarks.elastic.co/#tracks/nyc-taxis/release.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/524248693","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-524248693","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":524248693,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNDI0ODY5Mw==","user":{"login":"brenuart","id":3028601,"node_id":"MDQ6VXNlcjMwMjg2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3028601?v=4","gravatar_id":"","url":"https://api.github.com/users/brenuart","html_url":"https://github.com/brenuart","followers_url":"https://api.github.com/users/brenuart/followers","following_url":"https://api.github.com/users/brenuart/following{/other_user}","gists_url":"https://api.github.com/users/brenuart/gists{/gist_id}","starred_url":"https://api.github.com/users/brenuart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brenuart/subscriptions","organizations_url":"https://api.github.com/users/brenuart/orgs","repos_url":"https://api.github.com/users/brenuart/repos","events_url":"https://api.github.com/users/brenuart/events{/privacy}","received_events_url":"https://api.github.com/users/brenuart/received_events","type":"User","site_admin":false},"created_at":"2019-08-23T09:40:28Z","updated_at":"2019-08-23T09:40:28Z","author_association":"NONE","body":"I'm linking here to the forum post I created: https://discuss.elastic.co/t/slow-date-histogram-after-upgrading-to-7-3-0-on-dense-indexes/196475.\r\n\r\nPlease note that we could not reproduce the issue with the `nyc_taxis` dataset but with a custom one. The reason (as described in the post) is dates in the `nyc_taxis` dataset are not close enough to each other to trigger the issue.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/524871226","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-524871226","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":524871226,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNDg3MTIyNg==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2019-08-26T13:58:09Z","updated_at":"2019-08-26T13:58:09Z","author_association":"MEMBER","body":"reopening, as a performance issue between 6.8 and 7.3 seems to exist and needs to be evaluated.\r\n\r\nThanks for opening @brenuart!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/524876738","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-524876738","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":524876738,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNDg3NjczOA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2019-08-26T14:12:38Z","updated_at":"2019-08-26T14:12:38Z","author_association":"MEMBER","body":"See https://discuss.elastic.co/t/slow-date-histogram-after-upgrading-to-7-3-0-on-dense-indexes/196475/8?u=spinscale to download the four datasets mentioned in https://discuss.elastic.co/t/slow-date-histogram-after-upgrading-to-7-3-0-on-dense-indexes/196475/5\r\n\r\nhttps://drive.google.com/drive/folders/1ZIQjh00zOFyLoLY8vTEo2Tm2T0ZJ4AnD","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/524961376","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-524961376","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":524961376,"node_id":"MDEyOklzc3VlQ29tbWVudDUyNDk2MTM3Ng==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-08-26T17:56:36Z","updated_at":"2019-08-26T17:56:36Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-analytics-geo","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530040519","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530040519","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530040519,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDA0MDUxOQ==","user":{"login":"vboulaye","id":652767,"node_id":"MDQ6VXNlcjY1Mjc2Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/652767?v=4","gravatar_id":"","url":"https://api.github.com/users/vboulaye","html_url":"https://github.com/vboulaye","followers_url":"https://api.github.com/users/vboulaye/followers","following_url":"https://api.github.com/users/vboulaye/following{/other_user}","gists_url":"https://api.github.com/users/vboulaye/gists{/gist_id}","starred_url":"https://api.github.com/users/vboulaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vboulaye/subscriptions","organizations_url":"https://api.github.com/users/vboulaye/orgs","repos_url":"https://api.github.com/users/vboulaye/repos","events_url":"https://api.github.com/users/vboulaye/events{/privacy}","received_events_url":"https://api.github.com/users/vboulaye/received_events","type":"User","site_admin":false},"created_at":"2019-09-10T17:29:28Z","updated_at":"2019-09-10T17:29:28Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\nWe are in the process of upgrading our ELK stack from 6.8 to 7.3 and we see exactly the same behaviour.\r\n\r\nIn our logs the `@timestamps` are very close from each other and we see a huge degradation of the response time on the default query of kibana.\r\nIt is 4 to 5 times slower to run the default query ( >30s for the last 7 days.) \r\n\r\nI do not have a nice dataset like @brenuart created to reproduce the issue, but ran some test queries that show the problem (**839ms** in ES6.8, **4683ms** in ES7.3):\r\n\r\nIn ES 6.8\r\n```\r\nGET log-appli-2019.09.06/_search\r\n{ \r\n  \"size\": 1,\r\n  \"aggs\": {\r\n    \"2\": {\r\n      \"date_histogram\": {\r\n        \"field\": \"@timestamp\",\r\n        \"interval\": \"3h\",\r\n        \"time_zone\": \"Europe/Berlin\",\r\n        \"min_doc_count\": 1\r\n      }\r\n    }\r\n  }, \r\n  \"timeout\": \"30000ms\"\r\n}\r\n=>\r\n{\r\n  \"took\" : 839,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"skipped\" : 0,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : 53079313,\r\n    \"max_score\" : 1.0,\r\n    \"hits\" : [\r\n...\r\n\r\n```\r\n\r\nin ES 7.3\r\n```\r\nGET /log-appli-2019.09.06/_search\r\n{\r\n  \"size\": 1,\r\n  \"aggs\": {\r\n    \"2\": {\r\n      \"date_histogram\": {\r\n        \"field\": \"@timestamp\",\r\n        \"fixed_interval\": \"3h\",\r\n        \"time_zone\": \"Europe/Berlin\",\r\n        \"min_doc_count\": 1\r\n      }\r\n    }\r\n  },\r\n  \"timeout\": \"30000ms\"\r\n}\r\n\r\n\r\n=>\r\n\r\n{\r\n  \"took\" : 4683,\r\n  \"timed_out\" : false,\r\n  \"_shards\" : {\r\n    \"total\" : 5,\r\n    \"successful\" : 5,\r\n    \"skipped\" : 0,\r\n    \"failed\" : 0\r\n  },\r\n  \"hits\" : {\r\n    \"total\" : {\r\n      \"value\" : 10000,\r\n      \"relation\" : \"gte\"\r\n    },\r\n    \"max_score\" : 1.0,\r\n    \"hits\" : [\r\n...\r\n```\r\n\r\n\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530053196","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530053196","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530053196,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDA1MzE5Ng==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-09-10T18:02:45Z","updated_at":"2019-09-10T18:02:55Z","author_association":"MEMBER","body":"Thanks for the extra details @vboulaye!  We're actively looking into this issue right now, will update as we diagnose.\r\n\r\nOut of curiosity,  would you mind trying those queries again without the `time_zone` parameter?  We've seen performance issues with time zone conversion in the past (https://github.com/elastic/elasticsearch/issues/28727). I don't think that's the case here but it would be good to rule out.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530059613","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530059613","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530059613,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDA1OTYxMw==","user":{"login":"brenuart","id":3028601,"node_id":"MDQ6VXNlcjMwMjg2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3028601?v=4","gravatar_id":"","url":"https://api.github.com/users/brenuart","html_url":"https://github.com/brenuart","followers_url":"https://api.github.com/users/brenuart/followers","following_url":"https://api.github.com/users/brenuart/following{/other_user}","gists_url":"https://api.github.com/users/brenuart/gists{/gist_id}","starred_url":"https://api.github.com/users/brenuart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brenuart/subscriptions","organizations_url":"https://api.github.com/users/brenuart/orgs","repos_url":"https://api.github.com/users/brenuart/repos","events_url":"https://api.github.com/users/brenuart/events{/privacy}","received_events_url":"https://api.github.com/users/brenuart/received_events","type":"User","site_admin":false},"created_at":"2019-09-10T18:19:49Z","updated_at":"2019-09-10T18:21:31Z","author_association":"NONE","body":"@polyfractal We did the test with and without timezone with both versions. 7.3 is indeed a few seconds slower when a timezone is set.\r\nBut if you look at my report posted in the forum (https://discuss.elastic.co/t/slow-date-histogram-after-upgrading-to-7-3-0-on-dense-indexes/196475), the queries we used for testing donâ€™t have this parameter set. This was on purpose to reduce the amount of variable factors in the test case...\r\nTimezone is apparently not the (principal) culprit here.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530062611","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530062611","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530062611,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDA2MjYxMQ==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-09-10T18:27:50Z","updated_at":"2019-09-10T18:27:50Z","author_association":"MEMBER","body":"Noted, thanks for the clarification!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530239989","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530239989","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530239989,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDIzOTk4OQ==","user":{"login":"vboulaye","id":652767,"node_id":"MDQ6VXNlcjY1Mjc2Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/652767?v=4","gravatar_id":"","url":"https://api.github.com/users/vboulaye","html_url":"https://github.com/vboulaye","followers_url":"https://api.github.com/users/vboulaye/followers","following_url":"https://api.github.com/users/vboulaye/following{/other_user}","gists_url":"https://api.github.com/users/vboulaye/gists{/gist_id}","starred_url":"https://api.github.com/users/vboulaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vboulaye/subscriptions","organizations_url":"https://api.github.com/users/vboulaye/orgs","repos_url":"https://api.github.com/users/vboulaye/repos","events_url":"https://api.github.com/users/vboulaye/events{/privacy}","received_events_url":"https://api.github.com/users/vboulaye/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T06:25:52Z","updated_at":"2019-09-11T06:25:52Z","author_association":"CONTRIBUTOR","body":"Hi,\r\nI just ran my test query without the timestamp and it is a bit faster, but still above 4s.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530257244","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530257244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530257244,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDI1NzI0NA==","user":{"login":"vboulaye","id":652767,"node_id":"MDQ6VXNlcjY1Mjc2Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/652767?v=4","gravatar_id":"","url":"https://api.github.com/users/vboulaye","html_url":"https://github.com/vboulaye","followers_url":"https://api.github.com/users/vboulaye/followers","following_url":"https://api.github.com/users/vboulaye/following{/other_user}","gists_url":"https://api.github.com/users/vboulaye/gists{/gist_id}","starred_url":"https://api.github.com/users/vboulaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vboulaye/subscriptions","organizations_url":"https://api.github.com/users/vboulaye/orgs","repos_url":"https://api.github.com/users/vboulaye/repos","events_url":"https://api.github.com/users/vboulaye/events{/privacy}","received_events_url":"https://api.github.com/users/vboulaye/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T07:25:08Z","updated_at":"2019-09-11T07:25:08Z","author_association":"CONTRIBUTOR","body":"Do you think it is worth trying with version 7.2 or is this more likely to be related to the major changes in v7?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530347383","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530347383","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530347383,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDM0NzM4Mw==","user":{"login":"dliappis","id":1754575,"node_id":"MDQ6VXNlcjE3NTQ1NzU=","avatar_url":"https://avatars0.githubusercontent.com/u/1754575?v=4","gravatar_id":"","url":"https://api.github.com/users/dliappis","html_url":"https://github.com/dliappis","followers_url":"https://api.github.com/users/dliappis/followers","following_url":"https://api.github.com/users/dliappis/following{/other_user}","gists_url":"https://api.github.com/users/dliappis/gists{/gist_id}","starred_url":"https://api.github.com/users/dliappis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dliappis/subscriptions","organizations_url":"https://api.github.com/users/dliappis/orgs","repos_url":"https://api.github.com/users/dliappis/repos","events_url":"https://api.github.com/users/dliappis/events{/privacy}","received_events_url":"https://api.github.com/users/dliappis/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T11:56:17Z","updated_at":"2019-09-11T14:03:09Z","author_association":"CONTRIBUTOR","body":"@brenuart \r\n\r\nWe've attempted to reproduce the issue without success.\r\n\r\nWe used the data sets you provided and @csoulios kindly created a [Rally track](https://github.com/csoulios/date_histogram-benchmark) to help us benchmark the queries. We used a bare metal environment (separate machine for loaddriver and one dedicated node for Elasticsearch). Elasticsearch uses 1G heap, running on Java-12 and in between every experiment we cleaned up caches, slab objects, compacted memory and trimmed SSD disks as shown in \\[1\\].\r\n\r\nIn this [gist](https://gist.github.com/dliappis/2e14e396148b2beef73809a806213781) I have the comparisons for the `gaussian-sameday` data between ES 7.3.1 (contender) and 6.8.2 (baseline) and in particular for the [date histogram query](https://github.com/csoulios/date_histogram-benchmark/blob/9761db9847a679face21533648569e337c99bb32/date_histogram/challenges/timestamps-gaussian-sameday.json#L48-L67) we see:\r\n\r\n```\r\n| Metric                        | Task                     | Baseline | Contender |     Diff | Unit |\r\n|-------------------------------+--------------------------+----------+-----------+----------+------|\r\n| 50th percentile latency       | query-agg-date_histogram |  2788.58 |   2690.07 | -98.5142 | ms   |\r\n| 90th percentile latency       | query-agg-date_histogram |  2809.82 |   2741.53 | -68.2962 | ms   |\r\n| 100th percentile latency      | query-agg-date_histogram |  2884.77 |   2792.32 | -92.4499 | ms   |\r\n| 50th percentile service time  | query-agg-date_histogram |  2786.19 |    2687.6 | -98.5906 | ms   |\r\n| 90th percentile service time  | query-agg-date_histogram |  2807.42 |   2739.02 | -68.3978 | ms   |\r\n| 100th percentile service time | query-agg-date_histogram |  2882.37 |   2789.84 | -92.5238 | ms   |\r\n\r\n```\r\n\r\nThe results from another identical experiment are [here](https://gist.github.com/dliappis/2e14e396148b2beef73809a806213781#gistcomment-3023763) and again we see comparable performance between 6.8 and 7.3 for example for the 50th percentile latency difference is: `2847ms` -> 6.8 and `2690ms` -> 7.3 (so `7.3` was slightly faster)\r\n\r\n```\r\n| Metric                        | Task                     | Baseline | Contender |     Diff | Unit |\r\n|-------------------------------+--------------------------+----------+-----------+----------+------|\r\n| 50th percentile latency       | query-agg-date_histogram |  2847.59 |   2690.07 | -157.524 | ms   |\r\n| 90th percentile latency       | query-agg-date_histogram |  2884.79 |   2741.53 | -143.257 | ms   |\r\n| 100th percentile latency      | query-agg-date_histogram |  2951.17 |   2792.32 | -158.846 | ms   |\r\n| 50th percentile service time  | query-agg-date_histogram |  2845.24 |    2687.6 | -157.635 | ms   |\r\n| 90th percentile service time  | query-agg-date_histogram |  2882.45 |   2739.02 | -143.427 | ms   |\r\n| 100th percentile service time | query-agg-date_histogram |  2948.81 |   2789.84 | -158.968 | ms   |\r\n\r\n```\r\n\r\nDo you think you could give it a go yourself and see if it reproduces for you?\r\n\r\nRunning it should be fairly easy, just follow the instructions in the [README file](https://github.com/csoulios/date_histogram-benchmark#run-benchmarks) of the [custom Rally track](https://github.com/csoulios/date_histogram-benchmark).\r\n\r\nLooking forward to your feedback.\r\n\r\n\\[1\\]:\r\n\r\n```\r\nsudo /sbin/fstrim --all\r\nsync\r\nsleep 3\r\nsudo sh -c \"echo 3 > /proc/sys/vm/drop_caches\"\r\nsudo sh -c \"echo 1 > /proc/sys/vm/compact_memory\"\r\n```\r\n\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530384503","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530384503","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530384503,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDM4NDUwMw==","user":{"login":"brenuart","id":3028601,"node_id":"MDQ6VXNlcjMwMjg2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3028601?v=4","gravatar_id":"","url":"https://api.github.com/users/brenuart","html_url":"https://github.com/brenuart","followers_url":"https://api.github.com/users/brenuart/followers","following_url":"https://api.github.com/users/brenuart/following{/other_user}","gists_url":"https://api.github.com/users/brenuart/gists{/gist_id}","starred_url":"https://api.github.com/users/brenuart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brenuart/subscriptions","organizations_url":"https://api.github.com/users/brenuart/orgs","repos_url":"https://api.github.com/users/brenuart/repos","events_url":"https://api.github.com/users/brenuart/events{/privacy}","received_events_url":"https://api.github.com/users/brenuart/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T13:38:45Z","updated_at":"2019-09-11T13:38:45Z","author_association":"NONE","body":"I'll have a look this evening. Stay tuned.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530470432","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530470432","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530470432,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDQ3MDQzMg==","user":{"login":"brenuart","id":3028601,"node_id":"MDQ6VXNlcjMwMjg2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3028601?v=4","gravatar_id":"","url":"https://api.github.com/users/brenuart","html_url":"https://github.com/brenuart","followers_url":"https://api.github.com/users/brenuart/followers","following_url":"https://api.github.com/users/brenuart/following{/other_user}","gists_url":"https://api.github.com/users/brenuart/gists{/gist_id}","starred_url":"https://api.github.com/users/brenuart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brenuart/subscriptions","organizations_url":"https://api.github.com/users/brenuart/orgs","repos_url":"https://api.github.com/users/brenuart/repos","events_url":"https://api.github.com/users/brenuart/events{/privacy}","received_events_url":"https://api.github.com/users/brenuart/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T16:58:11Z","updated_at":"2019-09-11T17:55:47Z","author_association":"NONE","body":"I'm back with the results... and of course, I could **NOT** reproduce the issue with your rally challenge... Same conclusion as yours: 7.3 is faster!\r\n\r\nI looked at the differences between your test and ours and noticed that our query for 7.3 is slightly different: it makes use of `fixed_interval` instead of `interval`. I missed that point earlier - sorry about that. To make it clear, the query for 7.3 looked as follows:\r\n\r\n```\r\n{\r\n  \"aggs\": {\r\n    \"2\": {\r\n      \"date_histogram\": {\r\n        \"field\": \"@timestamp\",\r\n        \"fixed_interval\": \"1d\",\r\n        \"min_doc_count\": 1\r\n      }\r\n    }\r\n  },\r\n  \"query\": {\r\n    \"match_all\": {}\r\n  }\r\n}\r\n```\r\n\r\nTo make sure this had an impact, I quickly made the following tests through Kibana's dev console targetting two different test clusters running respectively 6.8.2 and 7.3.0. The timings were:\r\n\r\n```\r\nquery type           6.8.2    7.3.0\r\n-------------------------------------\r\ninterval               3873    4030\r\nfixed_interval          n/a   17845\r\ncalendar_interval       n/a    4089\r\n```\r\n\r\nThe most important thing here is not the difference between 6.8 and 7.3 as I executed the queries only a couple of times manually and took only the best result. \r\nHowever, using `fixed_interval_ instead of `interval` (which is now deprecated) makes a **huge** difference!\r\n\r\nI made the test with the 4 datasets (gaussian and uniform distributions). I got the same ranking as in my forum post: _gaussian_ is faster, followed by _uniform-sameday_, _1s_ and _10s_.\r\n\r\nHowever, I don't believe anymore that the date distribution in the dataset is the issue (although it has obviously some impact on the performance). `fixed_interval` is definitely where to look at...\r\n\r\nI'm really sorry I missed that initially. I pushed you in the wrong direction with an incomplete and inaccurate report. Sorry about that...\r\n\r\nFor your information, Kibana is using a `fixed_interval` in its aggregation query when it builds the histogram... That's how we noticed the slow down initially...\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530489592","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530489592","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530489592,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDQ4OTU5Mg==","user":{"login":"polyfractal","id":1224228,"node_id":"MDQ6VXNlcjEyMjQyMjg=","avatar_url":"https://avatars1.githubusercontent.com/u/1224228?v=4","gravatar_id":"","url":"https://api.github.com/users/polyfractal","html_url":"https://github.com/polyfractal","followers_url":"https://api.github.com/users/polyfractal/followers","following_url":"https://api.github.com/users/polyfractal/following{/other_user}","gists_url":"https://api.github.com/users/polyfractal/gists{/gist_id}","starred_url":"https://api.github.com/users/polyfractal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polyfractal/subscriptions","organizations_url":"https://api.github.com/users/polyfractal/orgs","repos_url":"https://api.github.com/users/polyfractal/repos","events_url":"https://api.github.com/users/polyfractal/events{/privacy}","received_events_url":"https://api.github.com/users/polyfractal/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T17:46:09Z","updated_at":"2019-09-11T17:46:09Z","author_association":"MEMBER","body":"Hm interesting, the fixed/calendar interval change _theoretically_ should have been equivalent to the now-deprecated `interval` (it's using the same parsing as before, just more explicit).  I wonder if we're doing extra/unnecessary parsing somewhere that's leading to a slowdown.\r\n\r\nOne question though @brenuart.  The interval `\"3h\"` shouldn't be valid for calendar intervals.  E.g. `calendar_interval: \"3h\"` should return this error:\r\n\r\n```\r\n{\r\n  \"error\": {\r\n    \"root_cause\": [\r\n      {\r\n        \"type\": \"x_content_parse_exception\",\r\n        \"reason\": \"[7:30] [date_histogram] failed to parse field [calendar_interval]\"\r\n      }\r\n    ],\r\n    \"type\": \"x_content_parse_exception\",\r\n    \"reason\": \"[7:30] [date_histogram] failed to parse field [calendar_interval]\",\r\n    \"caused_by\": {\r\n      \"type\": \"illegal_argument_exception\",\r\n      \"reason\": \"The supplied interval [3h] could not be parsed as a calendar interval.\"\r\n    }\r\n  },\r\n  \"status\": 400\r\n}\r\n```\r\n\r\nWhen you did the fixed vs calendar test did you use an interval like `1h` instead?  Just want to make sure we're looking at the same thing you are :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530493882","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530493882","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530493882,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDQ5Mzg4Mg==","user":{"login":"brenuart","id":3028601,"node_id":"MDQ6VXNlcjMwMjg2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3028601?v=4","gravatar_id":"","url":"https://api.github.com/users/brenuart","html_url":"https://github.com/brenuart","followers_url":"https://api.github.com/users/brenuart/followers","following_url":"https://api.github.com/users/brenuart/following{/other_user}","gists_url":"https://api.github.com/users/brenuart/gists{/gist_id}","starred_url":"https://api.github.com/users/brenuart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brenuart/subscriptions","organizations_url":"https://api.github.com/users/brenuart/orgs","repos_url":"https://api.github.com/users/brenuart/repos","events_url":"https://api.github.com/users/brenuart/events{/privacy}","received_events_url":"https://api.github.com/users/brenuart/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T17:57:08Z","updated_at":"2019-09-11T17:57:08Z","author_association":"NONE","body":"Oh god - sorry once again. Wrong copy/paste in the example query above. \r\nI used `1d` for interval - just like your own tests.\r\n\r\nPS: I updated the query above to avoid confusion.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530581087","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530581087","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530581087,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDU4MTA4Nw==","user":{"login":"vboulaye","id":652767,"node_id":"MDQ6VXNlcjY1Mjc2Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/652767?v=4","gravatar_id":"","url":"https://api.github.com/users/vboulaye","html_url":"https://github.com/vboulaye","followers_url":"https://api.github.com/users/vboulaye/followers","following_url":"https://api.github.com/users/vboulaye/following{/other_user}","gists_url":"https://api.github.com/users/vboulaye/gists{/gist_id}","starred_url":"https://api.github.com/users/vboulaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vboulaye/subscriptions","organizations_url":"https://api.github.com/users/vboulaye/orgs","repos_url":"https://api.github.com/users/vboulaye/repos","events_url":"https://api.github.com/users/vboulaye/events{/privacy}","received_events_url":"https://api.github.com/users/vboulaye/received_events","type":"User","site_admin":false},"created_at":"2019-09-11T21:52:45Z","updated_at":"2019-09-11T21:52:45Z","author_association":"CONTRIBUTOR","body":"I made some tests on my side with the various types of interval.\r\n\r\non the 7.3:\r\n\r\nfor a  `1d` interval:\r\n- interval (calendar_interval according to the doc) => 900ms\r\n- calendar_interval => 900ms\r\n- fixed_interval => 4000ms\r\n\r\nfor a  `3h` interval:\r\n- interval (fixed_interval according to the doc) => 4600ms\r\n- calendar_interval => error\r\n- fixed_interval  => 4600ms\r\n\r\nfor a  `24h` interval:\r\n- interval (fixed_interval according to the doc) => 4600ms\r\n- calendar_interval => error\r\n- fixed_interval  => 4600ms\r\n\r\non ES6.8\r\nfor a  `1d` interval:\r\n- interval (calendar_interval according to the doc) => 900ms\r\n\r\nfor a  `3h` interval:\r\n- interval (fixed_interval according to the doc) => 900ms\r\n\r\nfor a  `24h` interval:\r\n- interval (fixed_interval according to the doc) => 900ms\r\n\r\nSo there really seem to be a difference in the way the date histogram handles the fixed_interval in 7.3\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530751560","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530751560","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530751560,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDc1MTU2MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T09:48:05Z","updated_at":"2019-09-12T09:48:05Z","author_association":"MEMBER","body":"We have optimizations for the calendar_interval if the timezone is UTC. This was added because we spotted the slowdown in our benchmark:\r\nhttps://github.com/elastic/elasticsearch/blob/7.x/server/src/main/java/org/elasticsearch/common/Rounding.java#L283\r\nhttps://github.com/elastic/elasticsearch/pull/38221\r\n\r\nHowever we don't benchmark fixed_interval and they suffer from the same issue. We don't special case UTC when using a fixed interval while Joda uses a fast path that doesn't require any conversion. @spinscale could we just change the [fixed interval rounding](https://github.com/elastic/elasticsearch/blob/7.x/server/src/main/java/org/elasticsearch/common/Rounding.java#L279) to do:\r\n````\r\n        @Override\r\n        public long round(final long utcMillis) {\r\n            if (isUtc) {\r\n                return roundKey(utcMillis, interval) * interval;\r\n            }\r\n````\r\n? \r\nRegarding benchmarks, I can reproduce the slowdown in micro-benchmarks using the [Java Time Rounding](https://github.com/elastic/elasticsearch/blob/7.x/server/src/main/java/org/elasticsearch/common/Rounding.java) and the [Joda Rounding ](https://github.com/elastic/elasticsearch/blob/7.x/server/src/main/java/org/elasticsearch/common/Rounding.java#L193) with random dates and any interval. On my machine the Joda rounding is 15-20 times faster than the Java time rounding when using UTC.\r\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530756419","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530756419","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530756419,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDc1NjQxOQ==","user":{"login":"brenuart","id":3028601,"node_id":"MDQ6VXNlcjMwMjg2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3028601?v=4","gravatar_id":"","url":"https://api.github.com/users/brenuart","html_url":"https://github.com/brenuart","followers_url":"https://api.github.com/users/brenuart/followers","following_url":"https://api.github.com/users/brenuart/following{/other_user}","gists_url":"https://api.github.com/users/brenuart/gists{/gist_id}","starred_url":"https://api.github.com/users/brenuart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brenuart/subscriptions","organizations_url":"https://api.github.com/users/brenuart/orgs","repos_url":"https://api.github.com/users/brenuart/repos","events_url":"https://api.github.com/users/brenuart/events{/privacy}","received_events_url":"https://api.github.com/users/brenuart/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T10:02:02Z","updated_at":"2019-09-12T10:02:02Z","author_association":"NONE","body":"Glad you could reproduce the issue!\r\nPlease note that Kibana, in our setup at least, is building the aggregation with a timezone set to the one used by the browser - which is not UTC in our case. Does it mean that the fix you are talking about won't have any positive effect for us?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530775309","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530775309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530775309,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDc3NTMwOQ==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T11:02:03Z","updated_at":"2019-09-12T12:05:51Z","author_association":"MEMBER","body":"> Does it mean that the fix you are talking about won't have any positive effect for us?\r\n\r\nYes my proposal is too simplistic, we should be able to tackle all fixed timezone (UTC, +1, -3, ...).\r\nWe introduced a change in 6x that allows to rewrite a non-fixed timezone (Europe/Berlin) into a fixed timezone (+1, +2, ...) if all documents in a shard are in the same offset (https://github.com/elastic/elasticsearch/pull/30534) but this optimization doesn't work well with the current implementation for Java time rounding. I think that explains why you have different behavior depending on the distribution of dates that you have in the testing shard. It shouldn't be too hard to restore the 6x behavior though. Instead of handling only utc we could check that the time zone is fixed and apply something like:\r\n`````\r\n// Create the fixed offset\r\nlong fixedOffset = timeZone.getRules().isFixedOffset() ? timeZone.getRules().getOffset(Instant.EPOCH).getTotalSeconds() * 1000 : -1;\r\n\r\n       @Override\r\n        public long round(final long utcMillis) {\r\n            if (fixedOffset != -1) {\r\n                long localMillis = utcMillis + fixedOffset;\r\n                return (roundKey(localMillis, interval) * interval) - fixedOffset;\r\n            }\r\n`````\r\nThis should handle the case where a non-fixed timezone is rewritten into a fixed timezone ?","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530776540","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530776540","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530776540,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDc3NjU0MA==","user":{"login":"jimczi","id":15977469,"node_id":"MDQ6VXNlcjE1OTc3NDY5","avatar_url":"https://avatars0.githubusercontent.com/u/15977469?v=4","gravatar_id":"","url":"https://api.github.com/users/jimczi","html_url":"https://github.com/jimczi","followers_url":"https://api.github.com/users/jimczi/followers","following_url":"https://api.github.com/users/jimczi/following{/other_user}","gists_url":"https://api.github.com/users/jimczi/gists{/gist_id}","starred_url":"https://api.github.com/users/jimczi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimczi/subscriptions","organizations_url":"https://api.github.com/users/jimczi/orgs","repos_url":"https://api.github.com/users/jimczi/repos","events_url":"https://api.github.com/users/jimczi/events{/privacy}","received_events_url":"https://api.github.com/users/jimczi/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T11:06:18Z","updated_at":"2019-09-12T11:06:18Z","author_association":"MEMBER","body":"I also wonder if we should apply the same logic to the calendar interval since only UTC timezone is optimized there so the same slowdown would happen with fixed time zones.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/530802210","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-530802210","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":530802210,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMDgwMjIxMA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2019-09-12T12:29:08Z","updated_at":"2019-09-12T12:29:08Z","author_association":"MEMBER","body":"@jimczi after a quick look through the code that sounds good to me","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/531987952","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-531987952","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":531987952,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMTk4Nzk1Mg==","user":{"login":"csoulios","id":1561376,"node_id":"MDQ6VXNlcjE1NjEzNzY=","avatar_url":"https://avatars2.githubusercontent.com/u/1561376?v=4","gravatar_id":"","url":"https://api.github.com/users/csoulios","html_url":"https://github.com/csoulios","followers_url":"https://api.github.com/users/csoulios/followers","following_url":"https://api.github.com/users/csoulios/following{/other_user}","gists_url":"https://api.github.com/users/csoulios/gists{/gist_id}","starred_url":"https://api.github.com/users/csoulios/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/csoulios/subscriptions","organizations_url":"https://api.github.com/users/csoulios/orgs","repos_url":"https://api.github.com/users/csoulios/repos","events_url":"https://api.github.com/users/csoulios/events{/privacy}","received_events_url":"https://api.github.com/users/csoulios/received_events","type":"User","site_admin":false},"created_at":"2019-09-16T22:50:16Z","updated_at":"2019-09-16T22:50:16Z","author_association":"CONTRIBUTOR","body":"@brenuart and @vboulaye thank you for reporting this issue. It has been fixed in our master branch and will be backported to v7.4.1 and v7.5.0 in the following days.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/532084408","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-532084408","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":532084408,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjA4NDQwOA==","user":{"login":"vboulaye","id":652767,"node_id":"MDQ6VXNlcjY1Mjc2Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/652767?v=4","gravatar_id":"","url":"https://api.github.com/users/vboulaye","html_url":"https://github.com/vboulaye","followers_url":"https://api.github.com/users/vboulaye/followers","following_url":"https://api.github.com/users/vboulaye/following{/other_user}","gists_url":"https://api.github.com/users/vboulaye/gists{/gist_id}","starred_url":"https://api.github.com/users/vboulaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vboulaye/subscriptions","organizations_url":"https://api.github.com/users/vboulaye/orgs","repos_url":"https://api.github.com/users/vboulaye/repos","events_url":"https://api.github.com/users/vboulaye/events{/privacy}","received_events_url":"https://api.github.com/users/vboulaye/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T06:44:23Z","updated_at":"2019-09-17T06:44:23Z","author_association":"CONTRIBUTOR","body":"Thanks for the fix.\r\nWe will test it as soon as the patched version is released!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/532330474","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-532330474","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":532330474,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjMzMDQ3NA==","user":{"login":"brhardwick","id":5597656,"node_id":"MDQ6VXNlcjU1OTc2NTY=","avatar_url":"https://avatars2.githubusercontent.com/u/5597656?v=4","gravatar_id":"","url":"https://api.github.com/users/brhardwick","html_url":"https://github.com/brhardwick","followers_url":"https://api.github.com/users/brhardwick/followers","following_url":"https://api.github.com/users/brhardwick/following{/other_user}","gists_url":"https://api.github.com/users/brhardwick/gists{/gist_id}","starred_url":"https://api.github.com/users/brhardwick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brhardwick/subscriptions","organizations_url":"https://api.github.com/users/brhardwick/orgs","repos_url":"https://api.github.com/users/brhardwick/repos","events_url":"https://api.github.com/users/brhardwick/events{/privacy}","received_events_url":"https://api.github.com/users/brhardwick/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T17:53:33Z","updated_at":"2019-09-17T17:53:33Z","author_association":"NONE","body":"Is there any way to circumvent the issue temporarily while we wait for the 7.4.1 release? We are looking to do an upgrade this weekend and this bug makes the Kibana discover tab almost unusable for long date ranges. Would love any suggestions here. ","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/532572535","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-532572535","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":532572535,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjU3MjUzNQ==","user":{"login":"csoulios","id":1561376,"node_id":"MDQ6VXNlcjE1NjEzNzY=","avatar_url":"https://avatars2.githubusercontent.com/u/1561376?v=4","gravatar_id":"","url":"https://api.github.com/users/csoulios","html_url":"https://github.com/csoulios","followers_url":"https://api.github.com/users/csoulios/followers","following_url":"https://api.github.com/users/csoulios/following{/other_user}","gists_url":"https://api.github.com/users/csoulios/gists{/gist_id}","starred_url":"https://api.github.com/users/csoulios/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/csoulios/subscriptions","organizations_url":"https://api.github.com/users/csoulios/orgs","repos_url":"https://api.github.com/users/csoulios/repos","events_url":"https://api.github.com/users/csoulios/events{/privacy}","received_events_url":"https://api.github.com/users/csoulios/received_events","type":"User","site_admin":false},"created_at":"2019-09-18T08:10:04Z","updated_at":"2019-09-18T08:10:53Z","author_association":"CONTRIBUTOR","body":"@brhardwick, try using `calendar_interval` instead of `fixed_interval` in your query. Have in mind that results will not be the same as there are differences between `calendar_interval` and `fixed_interval`.\r\n\r\nYou can find more information here: \r\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-datehistogram-aggregation.html","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/538906191","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-538906191","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":538906191,"node_id":"MDEyOklzc3VlQ29tbWVudDUzODkwNjE5MQ==","user":{"login":"vboulaye","id":652767,"node_id":"MDQ6VXNlcjY1Mjc2Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/652767?v=4","gravatar_id":"","url":"https://api.github.com/users/vboulaye","html_url":"https://github.com/vboulaye","followers_url":"https://api.github.com/users/vboulaye/followers","following_url":"https://api.github.com/users/vboulaye/following{/other_user}","gists_url":"https://api.github.com/users/vboulaye/gists{/gist_id}","starred_url":"https://api.github.com/users/vboulaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vboulaye/subscriptions","organizations_url":"https://api.github.com/users/vboulaye/orgs","repos_url":"https://api.github.com/users/vboulaye/repos","events_url":"https://api.github.com/users/vboulaye/events{/privacy}","received_events_url":"https://api.github.com/users/vboulaye/received_events","type":"User","site_admin":false},"created_at":"2019-10-07T09:02:17Z","updated_at":"2019-10-07T09:02:17Z","author_association":"CONTRIBUTOR","body":"We deployed the 7.4 and the problem is fixed: the query now takes the same time with fixed_interval than with calendar_interval.\r\nThanks again!","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/538941211","html_url":"https://github.com/elastic/elasticsearch/issues/45702#issuecomment-538941211","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/45702","id":538941211,"node_id":"MDEyOklzc3VlQ29tbWVudDUzODk0MTIxMQ==","user":{"login":"brenuart","id":3028601,"node_id":"MDQ6VXNlcjMwMjg2MDE=","avatar_url":"https://avatars3.githubusercontent.com/u/3028601?v=4","gravatar_id":"","url":"https://api.github.com/users/brenuart","html_url":"https://github.com/brenuart","followers_url":"https://api.github.com/users/brenuart/followers","following_url":"https://api.github.com/users/brenuart/following{/other_user}","gists_url":"https://api.github.com/users/brenuart/gists{/gist_id}","starred_url":"https://api.github.com/users/brenuart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brenuart/subscriptions","organizations_url":"https://api.github.com/users/brenuart/orgs","repos_url":"https://api.github.com/users/brenuart/repos","events_url":"https://api.github.com/users/brenuart/events{/privacy}","received_events_url":"https://api.github.com/users/brenuart/received_events","type":"User","site_admin":false},"created_at":"2019-10-07T10:31:24Z","updated_at":"2019-10-07T10:31:24Z","author_association":"NONE","body":"Same here. Thx a lot for the quick response.","performed_via_github_app":null}]