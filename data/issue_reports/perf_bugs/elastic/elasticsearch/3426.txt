{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3426/events","html_url":"https://github.com/elastic/elasticsearch/issues/3426","id":17513439,"node_id":"MDU6SXNzdWUxNzUxMzQzOQ==","number":3426,"title":"Native custom score script: performance bottleneck in getting array fields","user":{"login":"maciejkula","id":2392579,"node_id":"MDQ6VXNlcjIzOTI1Nzk=","avatar_url":"https://avatars1.githubusercontent.com/u/2392579?v=4","gravatar_id":"","url":"https://api.github.com/users/maciejkula","html_url":"https://github.com/maciejkula","followers_url":"https://api.github.com/users/maciejkula/followers","following_url":"https://api.github.com/users/maciejkula/following{/other_user}","gists_url":"https://api.github.com/users/maciejkula/gists{/gist_id}","starred_url":"https://api.github.com/users/maciejkula/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maciejkula/subscriptions","organizations_url":"https://api.github.com/users/maciejkula/orgs","repos_url":"https://api.github.com/users/maciejkula/repos","events_url":"https://api.github.com/users/maciejkula/events{/privacy}","received_events_url":"https://api.github.com/users/maciejkula/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"assignees":[{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false}],"milestone":null,"comments":13,"created_at":"2013-08-01T15:27:17Z","updated_at":"2014-11-14T16:49:11Z","closed_at":"2013-09-14T06:55:15Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"For my searches, I use a native script custom score query which processes array (multivalued) fields from the indexed documents.\n\nTo obtain them, it gets the\n- org.elasticsearch.index.fielddata.ScriptDocValues.Doubles\n- org.elasticsearch.index.fielddata.ScriptDocValues.Longs\n  objects from doc() --- which I understand to be the most efficient way of obtaining them (as they are cached in memory).\n\nWhen profiling, however, it appears that the script spends a very large amount of time in the Doubles.getValues() and Longs.getValues() methods. While the arrays themselves are not enormous (should only rarely exceed 200 entries), repeating the operation for all documents in the index proves to be the bottleneck in custom scoring.\n\nIs there a way of getting around this bottleneck? Does it matter that the getValues methods construct the output list by extending the underlying array (and copying the memory?) every time a new value is added?\n\n(Using 0.90.2)\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}