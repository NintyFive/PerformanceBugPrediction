[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/21194395","html_url":"https://github.com/elastic/elasticsearch/issues/3354#issuecomment-21194395","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3354","id":21194395,"node_id":"MDEyOklzc3VlQ29tbWVudDIxMTk0Mzk1","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2013-07-18T16:03:55Z","updated_at":"2013-07-18T16:03:55Z","author_association":"CONTRIBUTOR","body":"Sorry for the long gist.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/64956340","html_url":"https://github.com/elastic/elasticsearch/issues/3354#issuecomment-64956340","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3354","id":64956340,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTU2MzQw","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-11-29T16:08:20Z","updated_at":"2014-11-29T16:08:20Z","author_association":"CONTRIBUTOR","body":"This is still a problem.  Updated the script to work with current master:\n\n```\necho \"This works as expected:\"\necho \"Cleanly launch three nodes\"\nrm -rf data/*\n./bin/elasticsearch -p es1.pid -d\n./bin/elasticsearch -p es2.pid -d\n./bin/elasticsearch -p es3.pid -d\nsleep 10\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_nodes=3\"\necho \"Create more replicas then we have nodes\"\ncurl -XPOST \"http://localhost:9200/test_close?pretty=true\" -d '{\n  \"settings\": {\n    \"number_of_shards\": 5,\n    \"number_of_replicas\": 3\n  }\n}'\necho \"Wait until all the shards that are going to allocate have allocated\"\nsleep 5\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true\"\necho \"Close the index\"\ncurl -XPOST \"http://localhost:9200/test_close/_close?pretty=true\"\necho \"Wait a bit and open it\"\nsleep 2\ncurl -XPOST \"http://localhost:9200/test_close/_open?pretty=true\"\ncurl -s -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_status=yellow\"\nfor pidfile in *.pid; do kill $(cat $pidfile); rm $pidfile ; done\n\necho \"PHASE 1 ******************\"\n\necho \"Currently leaves the index stuck closed\"\necho \"Cleanly launch two nodes\"\nrm -rf data/*\n./bin/elasticsearch -p es1.pid -d\n./bin/elasticsearch -p es2.pid -d\nsleep 10\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_nodes=2\"\necho \"Create more replicas then we have nodes\"\ncurl -XPOST \"http://localhost:9200/test_close?pretty=true\" -d '{\n  \"settings\": {\n    \"number_of_shards\": 5,\n    \"number_of_replicas\": 3\n  }\n}'\necho \"Wait until all the shards that are going to allocate have allocated\"\nsleep 5\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true\"\necho \"Close the index\"\ncurl -XPOST \"http://localhost:9200/test_close/_close?pretty=true\"\necho \"Wait a bit and open it\"\nsleep 2\ncurl -XPOST \"http://localhost:9200/test_close/_open?pretty=true\"\ncurl -s -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_status=yellow\"\n\nexit\n\nfor pidfile in *.pid; do kill $(cat $pidfile); rm $pidfile ; done\n\n\necho \"PHASE 2 ******************\"\n\n\necho \"Launching a new node during recovery also doesn't fix it\"\necho \"Cleanly launch two nodes\"\nrm -rf data/*\n./bin/elasticsearch -p es1.pid -d\n./bin/elasticsearch -p es2.pid -d\nsleep 10\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_nodes=2\"\necho \"Create more replicas then we have nodes\"\ncurl -XPOST \"http://localhost:9200/test_close?pretty=true\" -d '{\n  \"settings\": {\n    \"number_of_shards\": 5,\n    \"number_of_replicas\": 3\n  }\n}'\necho \"Wait until all the shards that are going to allocate have allocated\"\nsleep 5\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true\"\necho \"Close the index\"\ncurl -XPOST \"http://localhost:9200/test_close/_close?pretty=true\"\necho \"Wait a bit and open it\"\nsleep 2\ncurl -XPOST \"http://localhost:9200/test_close/_open?pretty=true\"\ncurl -s -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_status=yellow&timeout=10s\"\n./bin/elasticsearch -p es3.pid -d\ncurl -s -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_status=yellow&timeout=20s\"\nfor pidfile in *.pid; do kill $(cat $pidfile); rm $pidfile ; done\n\n\necho \"PHASE 3 ******************\"\n\n\n\necho \"Also currently leaves the index stuck closed\"\necho \"Cleanly launch three nodes\"\nrm -rf data/*\n./bin/elasticsearch -p es1.pid -d\n./bin/elasticsearch -p es2.pid -d\n./bin/elasticsearch -p es3.pid -d\nsleep 10\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_nodes=3\"\necho \"Create more replicas then we have nodes\"\ncurl -XPOST \"http://localhost:9200/test_close?pretty=true\" -d '{\n  \"settings\": {\n    \"number_of_shards\": 5,\n    \"number_of_replicas\": 3\n  }\n}'\necho \"Wait until all the shards that are going to allocate have allocated\"\nsleep 5\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true\"\necho \"Kill a server\"\nkill $(cat es3.pid)\nrm es3.pid\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_nodes=2\"\necho \"Close the index\"\ncurl -XPOST \"http://localhost:9200/test_close/_close?pretty=true\"\necho \"Wait a bit and open it\"\nsleep 2\ncurl -XPOST \"http://localhost:9200/test_close/_open?pretty=true\"\ncurl -s -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_status=yellow\"\nfor pidfile in *.pid; do kill $(cat $pidfile); rm $pidfile ; done\n\necho \"PHASE 4 ******************\"\n\n\n\necho \"But if you bring the third node back online then the index does recover\"\necho \"Cleanly launch three nodes\"\nrm -rf data/*\n./bin/elasticsearch -p es1.pid -d\n./bin/elasticsearch -p es2.pid -d\n./bin/elasticsearch -p es3.pid -d\nsleep 10\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_nodes=3\"\necho \"Create more replicas then we have nodes\"\ncurl -XPOST \"http://localhost:9200/test_close?pretty=true\" -d '{\n  \"settings\": {\n    \"number_of_shards\": 5,\n    \"number_of_replicas\": 3\n  }\n}'\necho \"Wait until all the shards that are going to allocate have allocated\"\nsleep 5\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true\"\necho \"Kill a server\"\nkill $(cat es3.pid)\nrm es3.pid\ncurl -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_nodes=2\"\necho \"Close the index\"\ncurl -XPOST \"http://localhost:9200/test_close/_close?pretty=true\"\necho \"Wait a bit and open it\"\nsleep 2\ncurl -XPOST \"http://localhost:9200/test_close/_open?pretty=true\"\ncurl -s -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_status=yellow&timeout=10s\"\n./bin/elasticsearch -p es3.pid -d\ncurl -s -XGET \"http://localhost:9200/_cluster/health?pretty=true&timeout=5s&wait_for_status=yellow&timeout=20s\"\nfor pidfile in *.pid; do kill $(cat $pidfile); rm $pidfile ; done\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65003578","html_url":"https://github.com/elastic/elasticsearch/issues/3354#issuecomment-65003578","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3354","id":65003578,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDAzNTc4","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2014-11-30T22:34:05Z","updated_at":"2014-12-01T12:37:47Z","author_association":"MEMBER","body":"The source of the matter is the fact that we don't recover a primary unless there are a quorum of shard copies available on disk somewhere to choose a primary from (index.recovery.initial_shards controls this). When opening the index, the high replica count suggests some copies are lost and not available and thus we block the selection of a primary and the recovery. Setting the replica counts to something lower (3 in the examples above, making 2 a quorum) will cause the primary to be assigned. \n\nI do think we need better transparency as what's going on. Perhaps the open API should return some information about primary not being allocated - it will be hard to get that information though.  Perhaps we should inline an allocation status report that is suggested on https://github.com/elasticsearch/elasticsearch/issues/8686#issuecomment-64808853\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/65042845","html_url":"https://github.com/elastic/elasticsearch/issues/3354#issuecomment-65042845","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3354","id":65042845,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQyODQ1","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2014-12-01T10:04:03Z","updated_at":"2014-12-01T10:04:03Z","author_association":"CONTRIBUTOR","body":"@bleskes nice idea.  Currently the `open` request just returns `acknowledged: true`, so some insight into the problem would definitely help.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/172822006","html_url":"https://github.com/elastic/elasticsearch/issues/3354#issuecomment-172822006","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3354","id":172822006,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MjgyMjAwNg==","user":{"login":"ywelsch","id":3718355,"node_id":"MDQ6VXNlcjM3MTgzNTU=","avatar_url":"https://avatars3.githubusercontent.com/u/3718355?v=4","gravatar_id":"","url":"https://api.github.com/users/ywelsch","html_url":"https://github.com/ywelsch","followers_url":"https://api.github.com/users/ywelsch/followers","following_url":"https://api.github.com/users/ywelsch/following{/other_user}","gists_url":"https://api.github.com/users/ywelsch/gists{/gist_id}","starred_url":"https://api.github.com/users/ywelsch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ywelsch/subscriptions","organizations_url":"https://api.github.com/users/ywelsch/orgs","repos_url":"https://api.github.com/users/ywelsch/repos","events_url":"https://api.github.com/users/ywelsch/events{/privacy}","received_events_url":"https://api.github.com/users/ywelsch/received_events","type":"User","site_admin":false},"created_at":"2016-01-19T11:23:09Z","updated_at":"2016-01-19T11:23:09Z","author_association":"CONTRIBUTOR","body":"#15708 makes `index.recovery.initial_shards` obsolete. This means that a single shard is only needed to successfully reopen index. #15708 is for v3.0.0 though. Can we close this @clintongormley @bleskes?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/172824609","html_url":"https://github.com/elastic/elasticsearch/issues/3354#issuecomment-172824609","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3354","id":172824609,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MjgyNDYwOQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2016-01-19T11:35:31Z","updated_at":"2016-01-19T11:35:31Z","author_association":"MEMBER","body":"+1 to closing this.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/172876003","html_url":"https://github.com/elastic/elasticsearch/issues/3354#issuecomment-172876003","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3354","id":172876003,"node_id":"MDEyOklzc3VlQ29tbWVudDE3Mjg3NjAwMw==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2016-01-19T14:50:58Z","updated_at":"2016-01-19T14:50:58Z","author_association":"CONTRIBUTOR","body":"This was either my first or second interaction with the ES team on github, btw.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/173211159","html_url":"https://github.com/elastic/elasticsearch/issues/3354#issuecomment-173211159","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/3354","id":173211159,"node_id":"MDEyOklzc3VlQ29tbWVudDE3MzIxMTE1OQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-01-20T13:55:49Z","updated_at":"2016-01-20T13:55:49Z","author_association":"CONTRIBUTOR","body":"w00t\n","performed_via_github_app":null}]