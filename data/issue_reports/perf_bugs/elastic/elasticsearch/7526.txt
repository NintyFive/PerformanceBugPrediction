{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/7526","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7526/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7526/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/7526/events","html_url":"https://github.com/elastic/elasticsearch/issues/7526","id":41625753,"node_id":"MDU6SXNzdWU0MTYyNTc1Mw==","number":7526,"title":"Performance - include/exclude terms on high cardinality fields","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23174,"node_id":"MDU6TGFiZWwyMzE3NA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Eenhancement","name":">enhancement","color":"4a4ea8","default":false,"description":null},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"},{"id":110557212,"node_id":"MDU6TGFiZWwxMTA1NTcyMTI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/high%20hanging%20fruit","name":"high hanging fruit","color":"fc6149","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-09-01T10:30:14Z","updated_at":"2015-04-09T10:16:37Z","closed_at":"2015-04-09T10:16:37Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"I have noticed that if you add an \"include\" or \"exclude\" section as part of a _terms_ or _significant_terms_ aggregation on a high-cardinality field the performance can degrade quite badly.\n\nThe root cause is that the IncludeExclude.acceptedGlobalOrdinals() method enumerates terms eagerly for all terms in the index rather than lazily for those in the result set. For a high cardinality field this can take a very long time (tens of seconds in my test). As the method name suggests, this code is run when global ordinals are used and so a work-around is for the client to use\n\n```\n\"execution_hint\" : \"map\"\n```\n\nto their agg definition to avoid the use of global ordinals. In my tests this reduced a query that took 30 seconds down to sub-second but obviously there may be memory concerns relating to not using global ordinals.\n\nThis issue is created to discuss the ways in which we could automatically \"do the right thing\" without users needing to provide execution hints or incurring other costs.\n","closed_by":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"performed_via_github_app":null}