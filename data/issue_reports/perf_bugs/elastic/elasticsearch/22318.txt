{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/22318","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22318/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22318/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/22318/events","html_url":"https://github.com/elastic/elasticsearch/issues/22318","id":197086802,"node_id":"MDU6SXNzdWUxOTcwODY4MDI=","number":22318,"title":"poor index performance when index loadVersion","user":{"login":"kubbo","id":8613477,"node_id":"MDQ6VXNlcjg2MTM0Nzc=","avatar_url":"https://avatars2.githubusercontent.com/u/8613477?v=4","gravatar_id":"","url":"https://api.github.com/users/kubbo","html_url":"https://github.com/kubbo","followers_url":"https://api.github.com/users/kubbo/followers","following_url":"https://api.github.com/users/kubbo/following{/other_user}","gists_url":"https://api.github.com/users/kubbo/gists{/gist_id}","starred_url":"https://api.github.com/users/kubbo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kubbo/subscriptions","organizations_url":"https://api.github.com/users/kubbo/orgs","repos_url":"https://api.github.com/users/kubbo/repos","events_url":"https://api.github.com/users/kubbo/events{/privacy}","received_events_url":"https://api.github.com/users/kubbo/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-12-22T03:27:59Z","updated_at":"2016-12-22T08:04:23Z","closed_at":"2016-12-22T03:45:43Z","author_association":"NONE","active_lock_reason":null,"body":"\r\n**es-version: 2.3.3**:\r\n\r\n**plugins**: [hq,ik,kopf,licence,marvel-agent,search-guard-2,search-guard-ssl ]\r\n\r\n**JVM version**:\r\n1.7.0_79\r\n**OS version**:\r\nsata disk \r\n\r\n**Description of the problem including expected versus actual behavior**:\r\nHi, I have a index(shard=60,replica=1,node=48,jvm:30G), Now total 7 billion docs,everyday  200 million  doc index(with uid ), The job is very slow and I print the stack of es, the most bulk thread  are loading version. Then os load is very high(because my sata disk).\r\n my data update one day one time(one doc update by one thread),  like the sense.whether I can disable the version load  or any suggestion ? \r\n\r\n```\r\n\"elasticsearch[N'Garai][bulk][T#28]\" #449 daemon prio=5 os_prio=0 tid=0x00007f4b35317800 nid=0xbdc runnable [0x0000000054666000]\r\n   java.lang.Thread.State: RUNNABLE\r\n        at sun.nio.ch.FileDispatcherImpl.pread0(Native Method)\r\n        at sun.nio.ch.FileDispatcherImpl.pread(FileDispatcherImpl.java:52)\r\n        at sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:220)\r\n        at sun.nio.ch.IOUtil.read(IOUtil.java:197)\r\n        at sun.nio.ch.FileChannelImpl.readInternal(FileChannelImpl.java:762)\r\n        at sun.nio.ch.FileChannelImpl.read(FileChannelImpl.java:748)\r\n        at org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.readInternal(NIOFSDirectory.java:179)\r\n        at org.apache.lucene.store.BufferedIndexInput.refill(BufferedIndexInput.java:342)\r\n        at org.apache.lucene.store.BufferedIndexInput.readByte(BufferedIndexInput.java:54)\r\n        at org.apache.lucene.store.DataInput.readVInt(DataInput.java:125)\r\n        at org.apache.lucene.store.BufferedIndexInput.readVInt(BufferedIndexInput.java:221)\r\n        at org.apache.lucene.codecs.blocktree.SegmentTermsEnumFrame.loadBlock(SegmentTermsEnumFrame.java:157)\r\n        at org.apache.lucene.codecs.blocktree.SegmentTermsEnum.seekExact(SegmentTermsEnum.java:507)\r\n        at org.elasticsearch.common.lucene.uid.PerThreadIDAndVersionLookup.lookup(PerThreadIDAndVersionLookup.java:88)\r\n        at org.elasticsearch.common.lucene.uid.Versions.loadDocIdAndVersion(Versions.java:124)\r\n        at org.elasticsearch.common.lucene.uid.Versions.loadVersion(Versions.java:140)\r\n        at org.elasticsearch.index.engine.InternalEngine.loadCurrentVersionFromIndex(InternalEngine.java:1050)\r\n        at org.elasticsearch.index.engine.InternalEngine.innerIndex(InternalEngine.java:504)\r\n        - locked <0x000000024df935a8> (a java.lang.Object)\r\n        at org.elasticsearch.index.engine.InternalEngine.index(InternalEngine.java:460)\r\n        at org.elasticsearch.index.shard.IndexShard.index(IndexShard.java:601)\r\n        at org.elasticsearch.index.engine.Engine$Index.execute(Engine.java:836)\r\n        at org.elasticsearch.action.index.TransportIndexAction.executeIndexRequestOnReplica(TransportIndexAction.java:196)\r\n        at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnReplica(TransportShardBulkAction.java:436)\r\n        at org.elasticsearch.action.bulk.TransportShardBulkAction.shardOperationOnReplica(TransportShardBulkAction.java:68)\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$AsyncReplicaAction.doRun(TransportReplicationAction.java:392)\r\n        at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37)\r\n        at org.elasticsearch.action.support.replication.TransportReplicationAction$ReplicaOperationTransportHandler.messageReceived(Tra\r\n```\r\n","closed_by":{"login":"jasontedor","id":4744941,"node_id":"MDQ6VXNlcjQ3NDQ5NDE=","avatar_url":"https://avatars3.githubusercontent.com/u/4744941?v=4","gravatar_id":"","url":"https://api.github.com/users/jasontedor","html_url":"https://github.com/jasontedor","followers_url":"https://api.github.com/users/jasontedor/followers","following_url":"https://api.github.com/users/jasontedor/following{/other_user}","gists_url":"https://api.github.com/users/jasontedor/gists{/gist_id}","starred_url":"https://api.github.com/users/jasontedor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasontedor/subscriptions","organizations_url":"https://api.github.com/users/jasontedor/orgs","repos_url":"https://api.github.com/users/jasontedor/repos","events_url":"https://api.github.com/users/jasontedor/events{/privacy}","received_events_url":"https://api.github.com/users/jasontedor/received_events","type":"User","site_admin":false},"performed_via_github_app":null}