[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/278453550","html_url":"https://github.com/elastic/elasticsearch/issues/20797#issuecomment-278453550","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20797","id":278453550,"node_id":"MDEyOklzc3VlQ29tbWVudDI3ODQ1MzU1MA==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-02-08T20:35:49Z","updated_at":"2017-02-08T20:35:49Z","author_association":"CONTRIBUTOR","body":"It's been a long time since I opened this issue but some progress has been made:\r\n - #21566 should help the query cache cache more stuff. This is important in the context of nested queries because nested mappings make Elasticsearch add a filter to every query that makes sure it cannot match nested docs.\r\n - https://issues.apache.org/jira/browse/LUCENE-7654 makes nested queries compute scores lazily, which should make them faster when used in conjunctions. It also makes `ToParentBlockJoinQuery` implement the new `scorerProvider` API, which means it will play well with `IndexOrDocValuesQuery` (https://issues.apache.org/jira/browse/LUCENE-7643).\r\n\r\nI think there is at least one other thing to look into: the implicit filters that we add because of nested mappings. For instance if you run a nested query, we will implicily add both a filter on the child query in order to make sure it may only match documents from the child space, and on the top-level query in order to make sure it may only match documents from the parent space. This makes queries more complex and thus slower to execute, and also has some bad side-effects like polluting the query cache.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/282319597","html_url":"https://github.com/elastic/elasticsearch/issues/20797#issuecomment-282319597","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/20797","id":282319597,"node_id":"MDEyOklzc3VlQ29tbWVudDI4MjMxOTU5Nw==","user":{"login":"jpountz","id":299848,"node_id":"MDQ6VXNlcjI5OTg0OA==","avatar_url":"https://avatars2.githubusercontent.com/u/299848?v=4","gravatar_id":"","url":"https://api.github.com/users/jpountz","html_url":"https://github.com/jpountz","followers_url":"https://api.github.com/users/jpountz/followers","following_url":"https://api.github.com/users/jpountz/following{/other_user}","gists_url":"https://api.github.com/users/jpountz/gists{/gist_id}","starred_url":"https://api.github.com/users/jpountz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpountz/subscriptions","organizations_url":"https://api.github.com/users/jpountz/orgs","repos_url":"https://api.github.com/users/jpountz/repos","events_url":"https://api.github.com/users/jpountz/events{/privacy}","received_events_url":"https://api.github.com/users/jpountz/received_events","type":"User","site_admin":false},"created_at":"2017-02-24T15:29:10Z","updated_at":"2017-02-24T15:29:10Z","author_association":"CONTRIBUTOR","body":"Based on changes coming to 5.4 and how they perform in the new `Nested` track (https://elasticsearch-benchmarks.elastic.co/nested/index.html), I consider this issue fixed.","performed_via_github_app":null}]