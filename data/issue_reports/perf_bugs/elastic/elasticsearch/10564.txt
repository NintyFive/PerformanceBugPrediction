{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/10564","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10564/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10564/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/10564/events","html_url":"https://github.com/elastic/elasticsearch/issues/10564","id":68054902,"node_id":"MDU6SXNzdWU2ODA1NDkwMg==","number":10564,"title":"Snapshot operation stuck, delete command doesn't work","user":{"login":"vanga","id":5126396,"node_id":"MDQ6VXNlcjUxMjYzOTY=","avatar_url":"https://avatars3.githubusercontent.com/u/5126396?v=4","gravatar_id":"","url":"https://api.github.com/users/vanga","html_url":"https://github.com/vanga","followers_url":"https://api.github.com/users/vanga/followers","following_url":"https://api.github.com/users/vanga/following{/other_user}","gists_url":"https://api.github.com/users/vanga/gists{/gist_id}","starred_url":"https://api.github.com/users/vanga/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vanga/subscriptions","organizations_url":"https://api.github.com/users/vanga/orgs","repos_url":"https://api.github.com/users/vanga/repos","events_url":"https://api.github.com/users/vanga/events{/privacy}","received_events_url":"https://api.github.com/users/vanga/received_events","type":"User","site_admin":false},"labels":[{"id":143077482,"node_id":"MDU6TGFiZWwxNDMwNzc0ODI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Distributed/Snapshot/Restore","name":":Distributed/Snapshot/Restore","color":"0e8a16","default":false,"description":"Anything directly related to the `_snapshot/*` APIs"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2015-04-13T09:35:25Z","updated_at":"2016-01-07T15:36:43Z","closed_at":"2015-04-13T12:08:31Z","author_association":"NONE","active_lock_reason":null,"body":"We take snpashots every hour to AWS S3 directly using cloud-aws plugin\nsnapshot was stuck because of a reboot on master node during the snapshot, ES version 1.4.0, ArchLinux\nCluster was later upgraded to 1.4.2 at which point we noticed that there is a snapshot stuck\nwhile trying to create a new snapshot\n`{\"error\":\"ConcurrentSnapshotExecutionException[[my_s3_repository:2015.04.13.09.16.42] a snapshot is already running]\",\"status\":503}`\ncurl localhost:9200/_snapshot/my_s3_repository/_all?pretty doesn't have the stuck snapshot in the list.\n\nDelete snapshot command never completes, it hangs forever.\nrolling restart (restarting one node after the other) didn't help.\nClean up script doesn't work for me https://github.com/imotov/elasticsearch-snapshot-cleanup/issues/2\n\nIn S3, there is no metadata file for the stuck snapshot, there are snapshot-<snapshot-name> files for some of the indices\n\nHow do I atleast forget/discard old snapshots..create a new repository and start fresh. I can not stop the whole cluster as it is a production cluster.\n\ncurl localhost:9200/_snapshot/_status?pretty\n\n```\n{\n  \"snapshots\" : [ {\n    \"snapshot\" : \"2015.03.11.06.04.39\",\n    \"repository\" : \"my_s3_repository\",\n    \"state\" : \"ABORTED\",\n    \"shards_stats\" : {\n      \"initializing\" : 0,\n      \"started\" : 0,\n      \"finalizing\" : 0,\n      \"done\" : 17,\n      \"failed\" : 3,\n      \"total\" : 20\n    },\n    \"stats\" : {\n      \"number_of_files\" : 0,\n      \"processed_files\" : 0,\n      \"total_size_in_bytes\" : 0,\n      \"processed_size_in_bytes\" : 0,\n      \"start_time_in_millis\" : 0,\n      \"time_in_millis\" : 0\n    },\n    \"indices\" : {\n      \"playground_video\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 5,\n          \"failed\" : 0,\n          \"total\" : 5\n        },\n        \"stats\" : {\n          \"number_of_files\" : 0,\n          \"processed_files\" : 0,\n          \"total_size_in_bytes\" : 0,\n          \"processed_size_in_bytes\" : 0,\n          \"start_time_in_millis\" : 0,\n          \"time_in_millis\" : 0\n        },\n        \"shards\" : {\n          \"4\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"3\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"2\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"1\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"0\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          }\n        }\n      },\n      \"playground_feed\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 4,\n          \"failed\" : 1,\n          \"total\" : 5\n        },\n        \"stats\" : {\n          \"number_of_files\" : 0,\n          \"processed_files\" : 0,\n          \"total_size_in_bytes\" : 0,\n          \"processed_size_in_bytes\" : 0,\n          \"start_time_in_millis\" : 0,\n          \"time_in_millis\" : 0\n        },\n        \"shards\" : {\n          \"4\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"2\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"3\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"0\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"1\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          }\n        }\n      },\n      \"playground_profile\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 4,\n          \"failed\" : 1,\n          \"total\" : 5\n        },\n        \"stats\" : {\n          \"number_of_files\" : 0,\n          \"processed_files\" : 0,\n          \"total_size_in_bytes\" : 0,\n          \"processed_size_in_bytes\" : 0,\n          \"start_time_in_millis\" : 0,\n          \"time_in_millis\" : 0\n        },\n        \"shards\" : {\n          \"2\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"1\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"4\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"3\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"0\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          }\n        }\n      },\n      \"playground_admin\" : {\n        \"shards_stats\" : {\n          \"initializing\" : 0,\n          \"started\" : 0,\n          \"finalizing\" : 0,\n          \"done\" : 4,\n          \"failed\" : 1,\n          \"total\" : 5\n        },\n        \"stats\" : {\n          \"number_of_files\" : 0,\n          \"processed_files\" : 0,\n          \"total_size_in_bytes\" : 0,\n          \"processed_size_in_bytes\" : 0,\n          \"start_time_in_millis\" : 0,\n          \"time_in_millis\" : 0\n        },\n        \"shards\" : {\n          \"2\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"1\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"0\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"4\" : {\n            \"stage\" : \"FAILURE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          },\n          \"3\" : {\n            \"stage\" : \"DONE\",\n            \"stats\" : {\n              \"number_of_files\" : 0,\n              \"processed_files\" : 0,\n              \"total_size_in_bytes\" : 0,\n              \"processed_size_in_bytes\" : 0,\n              \"start_time_in_millis\" : 0,\n              \"time_in_millis\" : 0\n            }\n          }\n        }\n      }\n    }\n  } ]\n}\n```\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}