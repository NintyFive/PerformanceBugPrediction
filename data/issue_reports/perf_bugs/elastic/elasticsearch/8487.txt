{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/8487","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8487/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8487/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/8487/events","html_url":"https://github.com/elastic/elasticsearch/issues/8487","id":48817717,"node_id":"MDU6SXNzdWU0ODgxNzcxNw==","number":8487,"title":"ElasticSearch 1.3.4 recovery slow on larger clusters (50+ total nodes)","user":{"login":"TrentStewart","id":9732342,"node_id":"MDQ6VXNlcjk3MzIzNDI=","avatar_url":"https://avatars0.githubusercontent.com/u/9732342?v=4","gravatar_id":"","url":"https://api.github.com/users/TrentStewart","html_url":"https://github.com/TrentStewart","followers_url":"https://api.github.com/users/TrentStewart/followers","following_url":"https://api.github.com/users/TrentStewart/following{/other_user}","gists_url":"https://api.github.com/users/TrentStewart/gists{/gist_id}","starred_url":"https://api.github.com/users/TrentStewart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TrentStewart/subscriptions","organizations_url":"https://api.github.com/users/TrentStewart/orgs","repos_url":"https://api.github.com/users/TrentStewart/repos","events_url":"https://api.github.com/users/TrentStewart/events{/privacy}","received_events_url":"https://api.github.com/users/TrentStewart/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"assignees":[{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false}],"milestone":null,"comments":14,"created_at":"2014-11-14T17:42:53Z","updated_at":"2015-11-21T21:18:52Z","closed_at":"2015-11-21T21:18:52Z","author_association":"NONE","active_lock_reason":null,"body":"We are seeing a situation on clusters running 1.3.4 with greater than 50 total nodes where shard recovery/allocation is either failing or is VERY slow.\n\nFull details:\nI currently have 6 clusters, 4 with 24 total nodes and 2 larger clusters with 53 & 63 nodes respectively.  Everything is run on VMs running Windows Server 2012 R2 within Azure.\n\nAll clusters (except the 63 node) were upgraded from 1.3.2 to 1.3.4 using an offline method of shutting down the cluster clean, swapping out the x64 Windows Service, then restarting all of the nodes.  The 63 node cluster was built last week clean with 1.3.4.\n\nFor the 24 node clusters, the clusters returned to a green status after the upgrade in less than 30 minutes and are performing very well.  I also did a rolling reboot of all of the machines to apply OS updates where I have automation that sets allocation to new_primaries, shuts down the service, reboots the machine, waits for the node to rejoin the cluster, sets allocation back to all, then waits for the cluster to return to green before proceeding to the next node.  Again for each of the 24 node clusters, it completed the entire process in just shy of 2 hours.\n\nThe 53 node cluster is our oldest cluster (with 144 indices & 3330 shards) and has under gone several upgrades using the offline method and in each scenario, the cluster returned to yellow within 15 minutes and green within 40 minutes.  Monday night we upgraded this cluster and it took 3 hours to get to yellow and 6 hours to get to green.\n\nThe 63 node cluster is our newest cluster (currently has 12 indices & 272 shards).  Last night & today while performing a rolling reboot, each node has a max of 3 shards on it, after the machine rebooted, it was taking > 10 minutes for the node to rejoin the cluster and randomly some shards would never finish initialization.\n\nWhen I query _cat/recovery?pretty=true&v&active_only=true, no shards are listed however _cat/shards would show 1 or 2 shards as INITIALIZING.  If I issued the command for reroute cancel on the initializing shards, they would almost immediately allocation and the cluster would turn green.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}