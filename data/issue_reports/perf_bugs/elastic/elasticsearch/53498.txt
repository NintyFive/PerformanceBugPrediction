{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/53498","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53498/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53498/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/53498/events","html_url":"https://github.com/elastic/elasticsearch/issues/53498","id":580078798,"node_id":"MDU6SXNzdWU1ODAwNzg3OTg=","number":53498,"title":"Range field performance regression after Lucene compression change","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"labels":[{"id":1847246588,"node_id":"MDU6TGFiZWwxODQ3MjQ2NTg4","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Performance","name":":Performance","color":"3b54f7","default":false,"description":"All issues related to Elasticsearch performance including regressions and investigations"},{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":1789304462,"node_id":"MDU6TGFiZWwxNzg5MzA0NDYy","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v7.7.0","name":"v7.7.0","color":"dddddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"assignees":[{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-03-12T16:59:04Z","updated_at":"2020-03-18T14:47:40Z","closed_at":"2020-03-18T14:47:40Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"body":"Nightly benchmarks revealed a performance regression in searches on range fields following a change to add [compression to binary doc values in Lucene](https://github.com/apache/lucene-solr/pull/1234).\r\nWhile the change reduced the disk storage costs, the benchmarks showed median search times for the benchmark increased from 12ms to 42. The affected query was on the \"noaa\" dataset with these clauses:\r\n\r\n\t{\r\n\t  \"query\": {\r\n\t\t\"bool\": {\r\n\t\t  \"must\": [\r\n\t\t\t{\r\n\t\t\t  \"term\": {\r\n\t\t\t\t\"station.country_code\": \"JA\"\r\n\t\t\t  }\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t  \"range\": {\r\n\t\t\t\t\"TRANGE\": {\r\n\t\t\t\t  \"gte\": 0,\r\n\t\t\t\t  \"lte\": 30\r\n\t\t\t\t}\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t  ]\r\n\t\t}\r\n\t  }\r\n\t}\r\n\r\nThis issue was opened to investigate the reason for the slow-down and possible fixes.\r\nThe range content shouldn't compress too much which means it should be fast to decompress given how the LZ4 compression works. However, another cost added by the Lucene change is that groups of 32 document values are now loaded when retrieving values rather than accessing single document values. This may be behind the slow-down.","closed_by":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"performed_via_github_app":null}