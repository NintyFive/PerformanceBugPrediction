[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/532127590","html_url":"https://github.com/elastic/elasticsearch/issues/46772#issuecomment-532127590","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46772","id":532127590,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjEyNzU5MA==","user":{"login":"elasticmachine","id":15837671,"node_id":"MDQ6VXNlcjE1ODM3Njcx","avatar_url":"https://avatars3.githubusercontent.com/u/15837671?v=4","gravatar_id":"","url":"https://api.github.com/users/elasticmachine","html_url":"https://github.com/elasticmachine","followers_url":"https://api.github.com/users/elasticmachine/followers","following_url":"https://api.github.com/users/elasticmachine/following{/other_user}","gists_url":"https://api.github.com/users/elasticmachine/gists{/gist_id}","starred_url":"https://api.github.com/users/elasticmachine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elasticmachine/subscriptions","organizations_url":"https://api.github.com/users/elasticmachine/orgs","repos_url":"https://api.github.com/users/elasticmachine/repos","events_url":"https://api.github.com/users/elasticmachine/events{/privacy}","received_events_url":"https://api.github.com/users/elasticmachine/received_events","type":"User","site_admin":false},"created_at":"2019-09-17T08:54:01Z","updated_at":"2019-09-17T08:54:01Z","author_association":"COLLABORATOR","body":"Pinging @elastic/es-distributed","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/532735208","html_url":"https://github.com/elastic/elasticsearch/issues/46772#issuecomment-532735208","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46772","id":532735208,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjczNTIwOA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2019-09-18T15:22:44Z","updated_at":"2019-09-18T15:22:44Z","author_association":"MEMBER","body":"> Moreover though, this should not have failed the snapshot delete call (and subsequently the whole test) and instead only have lead to a `WARN` log.\r\n\r\nThis is a bug, I've opened https://github.com/elastic/elasticsearch/pull/46832.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/532742352","html_url":"https://github.com/elastic/elasticsearch/issues/46772#issuecomment-532742352","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46772","id":532742352,"node_id":"MDEyOklzc3VlQ29tbWVudDUzMjc0MjM1Mg==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2019-09-18T15:38:33Z","updated_at":"2019-09-18T15:38:33Z","author_association":"MEMBER","body":"They are few different things in this issue:\r\n- a bug that might left the snapshot deletion process stucked (#46832)\r\n- the slowness of the tests, which has been introduced when replacing mocked objects by the internal HTTP server. I think this is also the case for Azure and S3 repository tests. I'll investigate a bit more to see what can be done but I don't think timeouts are in cause.\r\n- the origin of the `Error writing request body`, which is still unknown (I'll investigate too)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/535411244","html_url":"https://github.com/elastic/elasticsearch/issues/46772#issuecomment-535411244","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46772","id":535411244,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTQxMTI0NA==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2019-09-26T09:02:04Z","updated_at":"2019-09-26T09:02:04Z","author_association":"MEMBER","body":">     * a bug that might left the snapshot deletion process stucked (#46832)\r\n\r\nThis has been fixed and merged.\r\n\r\n\r\n\r\n>     * the slowness of the tests, which has been introduced when replacing mocked objects by the internal HTTP server. I think this is also the case for Azure and S3 repository tests. I'll investigate a bit more to see what can be done but I don't think timeouts are in cause.\r\n\r\nI investigated the slowness of the test and it appears that blob uploads take much more time in the Google tests than in the Azure or S3 tests. The Google SDK client uses multipart requests to upload blob content (both blob metadata and blob content are embedded in a multipart request body) while S3/Azure use most of the time single upload (the blob content is the request body). This adds extra parsing time on both server and client side, resulting in each blob upload taking 100-300ms in Google test and only 50-100ms in Azure/S3 tests.\r\n\r\n@original-brownbear  I'm not sure I can do much to optimize these tests for now (maybe lower the variables used in tests?)\r\n\r\n\r\n\r\n> the origin of the `Error writing request body`, which is still unknown (I'll investigate too)\r\n\r\nThis happens only once and does not reproduce after hundreds of execution. I'm going to leave this for now too and reinvestigate if it occurs another time.","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/535416556","html_url":"https://github.com/elastic/elasticsearch/issues/46772#issuecomment-535416556","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46772","id":535416556,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTQxNjU1Ng==","user":{"login":"original-brownbear","id":6490959,"node_id":"MDQ6VXNlcjY0OTA5NTk=","avatar_url":"https://avatars0.githubusercontent.com/u/6490959?v=4","gravatar_id":"","url":"https://api.github.com/users/original-brownbear","html_url":"https://github.com/original-brownbear","followers_url":"https://api.github.com/users/original-brownbear/followers","following_url":"https://api.github.com/users/original-brownbear/following{/other_user}","gists_url":"https://api.github.com/users/original-brownbear/gists{/gist_id}","starred_url":"https://api.github.com/users/original-brownbear/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/original-brownbear/subscriptions","organizations_url":"https://api.github.com/users/original-brownbear/orgs","repos_url":"https://api.github.com/users/original-brownbear/repos","events_url":"https://api.github.com/users/original-brownbear/events{/privacy}","received_events_url":"https://api.github.com/users/original-brownbear/received_events","type":"User","site_admin":false},"created_at":"2019-09-26T09:16:16Z","updated_at":"2019-09-26T09:16:16Z","author_association":"MEMBER","body":"Thanks Tanguy!\r\n\r\n> I'm not sure I can do much to optimize these tests for now (maybe lower the variables used in tests?)\r\n\r\nThanks for explaining :) I think we're good here then. I mainly pointed out the slowness as it was confusing me and I figured it might be the cause for the failing test.\r\n\r\n> This happens only once and does not reproduce after hundreds of execution. I'm going to leave this for now too and reinvestigate if it occurs another time.\r\n\r\nSounds good :)  I'll close this issue then. I couldn't reproduce it again either and I did run this through a lot more than 100 executions :D The thing is too, we won't even see this in failing test so easily now since we correctly handle bulk delete failures and just warn log them ... nothing will fail potentially :)","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/535418309","html_url":"https://github.com/elastic/elasticsearch/issues/46772#issuecomment-535418309","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/46772","id":535418309,"node_id":"MDEyOklzc3VlQ29tbWVudDUzNTQxODMwOQ==","user":{"login":"tlrx","id":642733,"node_id":"MDQ6VXNlcjY0MjczMw==","avatar_url":"https://avatars1.githubusercontent.com/u/642733?v=4","gravatar_id":"","url":"https://api.github.com/users/tlrx","html_url":"https://github.com/tlrx","followers_url":"https://api.github.com/users/tlrx/followers","following_url":"https://api.github.com/users/tlrx/following{/other_user}","gists_url":"https://api.github.com/users/tlrx/gists{/gist_id}","starred_url":"https://api.github.com/users/tlrx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tlrx/subscriptions","organizations_url":"https://api.github.com/users/tlrx/orgs","repos_url":"https://api.github.com/users/tlrx/repos","events_url":"https://api.github.com/users/tlrx/events{/privacy}","received_events_url":"https://api.github.com/users/tlrx/received_events","type":"User","site_admin":false},"created_at":"2019-09-26T09:21:13Z","updated_at":"2019-09-26T09:21:13Z","author_association":"MEMBER","body":"> I think we're good here then. I mainly pointed out the slowness as it was confusing me and I figured it might be the cause for the failing test.\r\n\r\nI think so. I should have also mention that I suspected the HTTP handler executor and tried a cached thread pool with no benefits; I quickly optimized the server side parsing but not much real gain there too and I checked the timeouts and concluded that they were not involved.\r\n\r\nThanks for reporting the issue :)","performed_via_github_app":null}]