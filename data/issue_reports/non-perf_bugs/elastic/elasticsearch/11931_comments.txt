[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/117004963","html_url":"https://github.com/elastic/elasticsearch/issues/11931#issuecomment-117004963","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11931","id":117004963,"node_id":"MDEyOklzc3VlQ29tbWVudDExNzAwNDk2Mw==","user":{"login":"navneet83","id":4686373,"node_id":"MDQ6VXNlcjQ2ODYzNzM=","avatar_url":"https://avatars0.githubusercontent.com/u/4686373?v=4","gravatar_id":"","url":"https://api.github.com/users/navneet83","html_url":"https://github.com/navneet83","followers_url":"https://api.github.com/users/navneet83/followers","following_url":"https://api.github.com/users/navneet83/following{/other_user}","gists_url":"https://api.github.com/users/navneet83/gists{/gist_id}","starred_url":"https://api.github.com/users/navneet83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/navneet83/subscriptions","organizations_url":"https://api.github.com/users/navneet83/orgs","repos_url":"https://api.github.com/users/navneet83/repos","events_url":"https://api.github.com/users/navneet83/events{/privacy}","received_events_url":"https://api.github.com/users/navneet83/received_events","type":"User","site_admin":false},"created_at":"2015-06-30T06:19:33Z","updated_at":"2015-06-30T07:03:16Z","author_association":"MEMBER","body":"This issue is reproducible in ES 1.4, 1.5 and 1.6.\n\nIn ES 1.3.5, \"unmapped_type\" is not supported. I tried with \"ignore_unmapped\" examples above. Surprisingly second query in Case3 above works fine in ES 1.3.5. So this is definitely a case of regression. Something broke between 1.3.5 and 1.4.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/117020878","html_url":"https://github.com/elastic/elasticsearch/issues/11931#issuecomment-117020878","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11931","id":117020878,"node_id":"MDEyOklzc3VlQ29tbWVudDExNzAyMDg3OA==","user":{"login":"navneet83","id":4686373,"node_id":"MDQ6VXNlcjQ2ODYzNzM=","avatar_url":"https://avatars0.githubusercontent.com/u/4686373?v=4","gravatar_id":"","url":"https://api.github.com/users/navneet83","html_url":"https://github.com/navneet83","followers_url":"https://api.github.com/users/navneet83/followers","following_url":"https://api.github.com/users/navneet83/following{/other_user}","gists_url":"https://api.github.com/users/navneet83/gists{/gist_id}","starred_url":"https://api.github.com/users/navneet83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/navneet83/subscriptions","organizations_url":"https://api.github.com/users/navneet83/orgs","repos_url":"https://api.github.com/users/navneet83/repos","events_url":"https://api.github.com/users/navneet83/events{/privacy}","received_events_url":"https://api.github.com/users/navneet83/received_events","type":"User","site_admin":false},"created_at":"2015-06-30T06:46:52Z","updated_at":"2015-06-30T06:47:59Z","author_association":"MEMBER","body":"Exception : \n[2015-06-29 23:18:46,442][DEBUG][action.search.type       ] [Smuggler] All shards failed for phase: [query]\norg.elasticsearch.search.SearchParseException: [testindex2][4]: query[ConstantScore(_:_)],from[-1],size[-1]: Parse Failure [Failed to parse source [{\"fields\":[\"firstname\",\"servers.location.name\"],\"query\":{\"match_all\":{}},\"sort\":[{\"servers.location.name\":{\"order\":\"desc\",\"ignore_unmapped\": \"true\",\"nested_filter\":{\"term\":{\"servers.location.name\":\"location5\"}},\"nested_path\":\"servers\"}}]}]]\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:735)\n    at org.elasticsearch.search.SearchService.createContext(SearchService.java:560)\n    at org.elasticsearch.search.SearchService.createAndPutContext(SearchService.java:532)\n    at org.elasticsearch.search.SearchService.executeQueryPhase(SearchService.java:294)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:231)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$5.call(SearchServiceTransportAction.java:228)\n    at org.elasticsearch.search.action.SearchServiceTransportAction$23.run(SearchServiceTransportAction.java:559)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: org.elasticsearch.index.query.QueryParsingException: [testindex2] [nested] failed to find nested object under path [servers]\n    at org.elasticsearch.index.query.support.NestedInnerQueryParseSupport.setPath(NestedInnerQueryParseSupport.java:163)\n    at org.elasticsearch.search.sort.SortParseElement.addCompoundSortField(SortParseElement.java:173)\n    at org.elasticsearch.search.sort.SortParseElement.parse(SortParseElement.java:86)\n    at org.elasticsearch.search.SearchService.parseSource(SearchService.java:719)\n    ... 9 more\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/117132130","html_url":"https://github.com/elastic/elasticsearch/issues/11931#issuecomment-117132130","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11931","id":117132130,"node_id":"MDEyOklzc3VlQ29tbWVudDExNzEzMjEzMA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-30T11:25:57Z","updated_at":"2015-06-30T11:25:57Z","author_association":"CONTRIBUTOR","body":"Hi @navneet83 \n\nThanks for the detailed reproduction!\n\n> Both the queries above run on \"testindex2\" which does not have \"servers.location.name\" field. Both the queries run fine as we have used - \"unmapped_type\"/\"ignore_unmapped\", however sort field has some integer value which is not expected\n\n`ignore_unmapped` is deprecated in favour of `unmapped_type` for this very reason: we need to know the datatype of the sort value up front.  Also see #9155 \n\n> Case 3 - Nested filter sort on testindex2 doesn't work even if \"unmapped_type\"/\"ignore_unmapped\" is used. Following examples throw error:\n\nYes, this is a known issue with eg nested, parent-child, geo, function_score, which require the field to be mapped.  We're discussing what approach to take to solve this in #11806 \n\nI think both issues are already covered in other tickets, so I'm going to close this one.  Thanks\n","performed_via_github_app":null}]