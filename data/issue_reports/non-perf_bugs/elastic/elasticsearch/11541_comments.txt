[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110094125","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110094125","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110094125,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDA5NDEyNQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T18:06:36Z","updated_at":"2015-06-08T18:06:36Z","author_association":"CONTRIBUTOR","body":"> I'd encourage you to consider returning to \"porter2\" the default algorithm when people ask for english (perhaps at elasticsearch 2.0 for compatibility reasons), because it really is quite noticeably better for result quality.\n\nUnfortunately, its also like twice as slow. Last time i benchmarked, the default porter (non-snowball, just the java impl) has a 2x overall indexing performance advantage, so overall I think we make the right tradeoff. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110095166","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110095166","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110095166,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDA5NTE2Ng==","user":{"login":"rboulton","id":73564,"node_id":"MDQ6VXNlcjczNTY0","avatar_url":"https://avatars2.githubusercontent.com/u/73564?v=4","gravatar_id":"","url":"https://api.github.com/users/rboulton","html_url":"https://github.com/rboulton","followers_url":"https://api.github.com/users/rboulton/followers","following_url":"https://api.github.com/users/rboulton/following{/other_user}","gists_url":"https://api.github.com/users/rboulton/gists{/gist_id}","starred_url":"https://api.github.com/users/rboulton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rboulton/subscriptions","organizations_url":"https://api.github.com/users/rboulton/orgs","repos_url":"https://api.github.com/users/rboulton/repos","events_url":"https://api.github.com/users/rboulton/events{/privacy}","received_events_url":"https://api.github.com/users/rboulton/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T18:11:44Z","updated_at":"2015-06-08T18:11:44Z","author_association":"CONTRIBUTOR","body":"The snowball stemmers do tend to have a significant speed overhead compared to hand-coded algorithms, yes - I can believe a 2x speed difference for the actual stemming call.  I wouldn't have expected the cost of stemming to be a significant part of the total indexing speed, though.\n\nPerhaps a bit of work on improving the speed on the porter2 algorithm would be worthwhile.  I don't believe it's had any significant effort put in to performance tuning, so there's probably some very easy gains there.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110096502","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110096502","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110096502,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDA5NjUwMg==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T18:18:33Z","updated_at":"2015-06-08T18:18:33Z","author_association":"CONTRIBUTOR","body":"> I wouldn't have expected the cost of stemming to be a significant part of the total indexing speed, though.\n\nYeah, I did this a while ago and afterwards actually spent time with snowball and tried to speed it up (and had some success). So lucene's snowball code has already diverged from snowball repository itself: perhaps there must be different performance goals in mind? What other explanation for things like (https://github.com/snowballstem/snowball/blob/master/java/org/tartarus/snowball/SnowballProgram.java#L31-L37)? Sorry that kind of thing is just terrible for performance :)\n\nTo me, IR is like, the main reason you'd use a stemmer, I'd be happy to try to fold this stuff back into snowball and improve the performance. But IIRC there were some api changes needed too (maybe some stuff moved from string -> charsequence), and I am confused about the status of snowball.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110101817","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110101817","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110101817,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDEwMTgxNw==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T18:34:55Z","updated_at":"2015-06-08T18:34:55Z","author_association":"CONTRIBUTOR","body":"to me the most promising approach could be: take the current PorterStemmer.java and create a Porter2Stemmer.java (still hand-written, just reflecting the changes). Its not very sexy but currently the hand-written code just performs much better. And its easy to test it against the snowball compiled version for correctness.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110104371","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110104371","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110104371,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDEwNDM3MQ==","user":{"login":"rboulton","id":73564,"node_id":"MDQ6VXNlcjczNTY0","avatar_url":"https://avatars2.githubusercontent.com/u/73564?v=4","gravatar_id":"","url":"https://api.github.com/users/rboulton","html_url":"https://github.com/rboulton","followers_url":"https://api.github.com/users/rboulton/followers","following_url":"https://api.github.com/users/rboulton/following{/other_user}","gists_url":"https://api.github.com/users/rboulton/gists{/gist_id}","starred_url":"https://api.github.com/users/rboulton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rboulton/subscriptions","organizations_url":"https://api.github.com/users/rboulton/orgs","repos_url":"https://api.github.com/users/rboulton/repos","events_url":"https://api.github.com/users/rboulton/events{/privacy}","received_events_url":"https://api.github.com/users/rboulton/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T18:45:35Z","updated_at":"2015-06-08T18:45:35Z","author_association":"CONTRIBUTOR","body":"The reason for things like that which are terrible for performance is that those lines of code were written 11 years ago (when I readily admit I had little experience with trying to write performant Java) with an aim of getting something working, and never revisited to improve performance. Take a look at Lucene code from the same time and you'll find some similar shockers! As I say, I'm sure there's lots of scope for improving performance.\n\nThe approach of hand writing a Porter2Stemmer.java is reasonable, using the snowball code as a reference implementation. Though it would be nicer to improve the snowball code generator so that non-english stemmers got the benefit too, the code generator is rather hard to work with, being a translation of a code generator for C, and written in not-very clean C.\n\nWhat _is_ well documented here is the algorithm, and in particular the differences between porter and porter2.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110111671","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110111671","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110111671,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDExMTY3MQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T19:18:54Z","updated_at":"2015-06-08T19:18:54Z","author_association":"CONTRIBUTOR","body":"Yeah, I guess to me given the stated differences of 5% of words impacted, and reading through the documentation, it just doesn't seem particularly crucial. I guess in my opinion, english is messy and exceptions like news can be handled with exceptions, which we let the user do easily independent of the stemmer. Any IR tests i have done have shown no significant difference, but the performance is pretty important.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110147128","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110147128","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110147128,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDE0NzEyOA==","user":{"login":"rboulton","id":73564,"node_id":"MDQ6VXNlcjczNTY0","avatar_url":"https://avatars2.githubusercontent.com/u/73564?v=4","gravatar_id":"","url":"https://api.github.com/users/rboulton","html_url":"https://github.com/rboulton","followers_url":"https://api.github.com/users/rboulton/followers","following_url":"https://api.github.com/users/rboulton/following{/other_user}","gists_url":"https://api.github.com/users/rboulton/gists{/gist_id}","starred_url":"https://api.github.com/users/rboulton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rboulton/subscriptions","organizations_url":"https://api.github.com/users/rboulton/orgs","repos_url":"https://api.github.com/users/rboulton/repos","events_url":"https://api.github.com/users/rboulton/events{/privacy}","received_events_url":"https://api.github.com/users/rboulton/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T21:29:15Z","updated_at":"2015-06-08T21:29:15Z","author_association":"CONTRIBUTOR","body":"The 5% of words which are affected tend to be more frequently encountered words (because the changes were made based on frequently reported problems), so the changes have more effect than might be thought.  I agree that an exception list is a good idea (we have one for gov.uk here https://github.com/alphagov/rummager/blob/master/config/schema/stems.yml, for example); it just seems better to use the best starting point available.\n\nOut of interest, have you done IR tests comparing something like kstem to porter (1 or 2), and have those shown any significant difference?  (Also, comparing to not stemming at all?)\n\nIn any case, I think your performance arguments are quite solid; I have different views of the relative importance of quality and speed (mainly because I'm currently working on a pretty small dataset, but one where result quality is paramount), so I'm probably not going to agree with your choice of default.\n\nIn order not to clog your tracker up with open issues, I'll close this ticket now - thank you for your feedback. If I ever get time to do performance improvements on the \"porter2\" stemmer (either to the code generator, or by hand-coding one), I'll try and push that into Lucene and open a new ticket, because other than the speed I think we've agreed on twitter that porter2 is better than porter (though agreeing whether either is good is a different question!).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110151268","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110151268","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110151268,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDE1MTI2OA==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T21:46:28Z","updated_at":"2015-06-08T21:46:28Z","author_association":"CONTRIBUTOR","body":"> Out of interest, have you done IR tests comparing something like kstem to porter (1 or 2), and have those shown any significant difference? (Also, comparing to not stemming at all?)\n\nYes. kstem has never done well in my tests. Porter does well. just removing plural/possessive also works reasonable too. I think the \"weak porter\" that terrier has is also interesting (but have not tested myself). Usually improvements are small (<= 15%) vs. not stemming with english: to me that's expected. I don't read too far into this stuff, but when i see consistent patterns across several corpora, i start to feel consensus :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/110165986","html_url":"https://github.com/elastic/elasticsearch/issues/11541#issuecomment-110165986","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11541","id":110165986,"node_id":"MDEyOklzc3VlQ29tbWVudDExMDE2NTk4Ng==","user":{"login":"rboulton","id":73564,"node_id":"MDQ6VXNlcjczNTY0","avatar_url":"https://avatars2.githubusercontent.com/u/73564?v=4","gravatar_id":"","url":"https://api.github.com/users/rboulton","html_url":"https://github.com/rboulton","followers_url":"https://api.github.com/users/rboulton/followers","following_url":"https://api.github.com/users/rboulton/following{/other_user}","gists_url":"https://api.github.com/users/rboulton/gists{/gist_id}","starred_url":"https://api.github.com/users/rboulton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rboulton/subscriptions","organizations_url":"https://api.github.com/users/rboulton/orgs","repos_url":"https://api.github.com/users/rboulton/repos","events_url":"https://api.github.com/users/rboulton/events{/privacy}","received_events_url":"https://api.github.com/users/rboulton/received_events","type":"User","site_admin":false},"created_at":"2015-06-08T22:53:14Z","updated_at":"2015-06-08T22:53:14Z","author_association":"CONTRIBUTOR","body":"Thanks for that datapoint; interesting.\n","performed_via_github_app":null}]