[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/113145815","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-113145815","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":113145815,"node_id":"MDEyOklzc3VlQ29tbWVudDExMzE0NTgxNQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-18T12:49:55Z","updated_at":"2015-06-18T12:49:55Z","author_association":"CONTRIBUTOR","body":"@spinscale any ideas?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114043840","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-114043840","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":114043840,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDA0Mzg0MA==","user":{"login":"ayashjorden","id":4204371,"node_id":"MDQ6VXNlcjQyMDQzNzE=","avatar_url":"https://avatars3.githubusercontent.com/u/4204371?v=4","gravatar_id":"","url":"https://api.github.com/users/ayashjorden","html_url":"https://github.com/ayashjorden","followers_url":"https://api.github.com/users/ayashjorden/followers","following_url":"https://api.github.com/users/ayashjorden/following{/other_user}","gists_url":"https://api.github.com/users/ayashjorden/gists{/gist_id}","starred_url":"https://api.github.com/users/ayashjorden/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ayashjorden/subscriptions","organizations_url":"https://api.github.com/users/ayashjorden/orgs","repos_url":"https://api.github.com/users/ayashjorden/repos","events_url":"https://api.github.com/users/ayashjorden/events{/privacy}","received_events_url":"https://api.github.com/users/ayashjorden/received_events","type":"User","site_admin":false},"created_at":"2015-06-22T08:52:25Z","updated_at":"2015-06-22T08:52:25Z","author_association":"NONE","body":"@clintongormley @spinscale any update on this ticket?\nWhat additional information can I provide to start investigation?\n\nThese exceptions happen to us almost every day.\n\nThanks,\nYarden\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114045054","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-114045054","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":114045054,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDA0NTA1NA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-06-22T09:00:16Z","updated_at":"2015-06-22T09:00:16Z","author_association":"MEMBER","body":"I need to take a closer look at this. Can you provide some more generic information:\n- elasticsearch version\n- java version\n- Any special usage pattern? Do you open a lot of new connections? What load is happening on that system?\n- Can you run netstat to check the number of open tcp connections?\n- Do you know if this is happening with HTTP or the transport protocol? (If you dont use HTTP, we can rule it out)\n- What is the impact of that exception in your system/cluster? Are connections broken after that? Is elasticsearch unresponsive?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114372161","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-114372161","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":114372161,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDM3MjE2MQ==","user":{"login":"ayashjorden","id":4204371,"node_id":"MDQ6VXNlcjQyMDQzNzE=","avatar_url":"https://avatars3.githubusercontent.com/u/4204371?v=4","gravatar_id":"","url":"https://api.github.com/users/ayashjorden","html_url":"https://github.com/ayashjorden","followers_url":"https://api.github.com/users/ayashjorden/followers","following_url":"https://api.github.com/users/ayashjorden/following{/other_user}","gists_url":"https://api.github.com/users/ayashjorden/gists{/gist_id}","starred_url":"https://api.github.com/users/ayashjorden/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ayashjorden/subscriptions","organizations_url":"https://api.github.com/users/ayashjorden/orgs","repos_url":"https://api.github.com/users/ayashjorden/repos","events_url":"https://api.github.com/users/ayashjorden/events{/privacy}","received_events_url":"https://api.github.com/users/ayashjorden/received_events","type":"User","site_admin":false},"created_at":"2015-06-23T06:05:21Z","updated_at":"2015-06-23T06:08:14Z","author_association":"NONE","body":"Please see the requested data below:\n1. ES cluster consists of two nodes, data/master node (listed below) and a Search-Load-Balancer (data/master=false) which a collocated Kibana 4(nodeJS) is connected to.\n\n``` json\n{\n  \"status\" : 200,\n  \"name\" : \"es01\",\n  \"cluster_name\" : \"elasticsearch\",\n  \"version\" : {\n    \"number\" : \"1.5.2\",\n    \"build_hash\" : \"62ff9868b4c8a0c45860bebb259e21980778ab1c\",\n    \"build_timestamp\" : \"2015-04-27T09:21:06Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"4.10.4\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n1. java version \"1.7.0_79\"\n   OpenJDK Runtime Environment (IcedTea 2.5.5) (7u79-2.5.5-1~deb8u1)\n   OpenJDK 64-Bit Server VM (build 24.79-b02, mixed mode)\n2. logstash 1.5.0 with updated elasticsearch output plugin 0.2.7 . I know there's a bottle neck due to ES machine CPU (2x4cors with hyper-threading)\n3. `sudo netstat -tupn|grep -F c.d|wc -l` results in 168, outside high traffic hours.\n   5.Logstash 1.5.0 is using the transport protocol, not HTTP.\n4. I don't know the impact on my cluster as the only thing I see are these errors in the logs.\n\nHope this information will be helpful,\nYarden\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114626166","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-114626166","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":114626166,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDYyNjE2Ng==","user":{"login":"szroland","id":10174523,"node_id":"MDQ6VXNlcjEwMTc0NTIz","avatar_url":"https://avatars2.githubusercontent.com/u/10174523?v=4","gravatar_id":"","url":"https://api.github.com/users/szroland","html_url":"https://github.com/szroland","followers_url":"https://api.github.com/users/szroland/followers","following_url":"https://api.github.com/users/szroland/following{/other_user}","gists_url":"https://api.github.com/users/szroland/gists{/gist_id}","starred_url":"https://api.github.com/users/szroland/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szroland/subscriptions","organizations_url":"https://api.github.com/users/szroland/orgs","repos_url":"https://api.github.com/users/szroland/repos","events_url":"https://api.github.com/users/szroland/events{/privacy}","received_events_url":"https://api.github.com/users/szroland/received_events","type":"User","site_admin":false},"created_at":"2015-06-23T20:09:36Z","updated_at":"2015-06-23T20:09:36Z","author_association":"CONTRIBUTOR","body":"Interesting that the `EPollArrayWrapper.isEventsHighKilled` method got introduced to fix file descriptor registration hitting a NullPointer exception, e.g. http://hg.openjdk.java.net/icedtea/jdk7/jdk/rev/9af467c489cc, you still seem to be hitting (another) NullPointer in that area. Maybe there is an issue with how it determines the number of max open file descriptors (e.g. `IOUtil.fdLimit()` call), but in practice the issue looks to be triggered by an FD value larger than 65535 (or whatever you have set `sun.nio.ch.maxUpdateArraySize` to, if you happen to have customized it). Overall this feels to be a JDK issue to me.\n\nAs a workaround, I'd recommend trying either one of these:\n- Try setting ulimit to 65535 maximum. Based on the error, you likely have it set higher\n- If you must keep it at a value higher than that, you could try set the JVM property `sun.nio.ch.maxUpdateArraySize` to a bit higher than whatever you specified as ulimit\n- Try upgrade to a newer version of OpenJDK if you can\n- You could try using a recent version of the Oracle JVM distribution, maybe even java 8\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114630340","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-114630340","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":114630340,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDYzMDM0MA==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-06-23T20:17:24Z","updated_at":"2015-06-23T20:17:24Z","author_association":"MEMBER","body":"@szroland very interesting. Out of curiosity: how did you make the connection between the above revision and this problem? Cant spot the missing link\n\nThanks a lot for helping!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114641211","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-114641211","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":114641211,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDY0MTIxMQ==","user":{"login":"szroland","id":10174523,"node_id":"MDQ6VXNlcjEwMTc0NTIz","avatar_url":"https://avatars2.githubusercontent.com/u/10174523?v=4","gravatar_id":"","url":"https://api.github.com/users/szroland","html_url":"https://github.com/szroland","followers_url":"https://api.github.com/users/szroland/followers","following_url":"https://api.github.com/users/szroland/following{/other_user}","gists_url":"https://api.github.com/users/szroland/gists{/gist_id}","starred_url":"https://api.github.com/users/szroland/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szroland/subscriptions","organizations_url":"https://api.github.com/users/szroland/orgs","repos_url":"https://api.github.com/users/szroland/repos","events_url":"https://api.github.com/users/szroland/events{/privacy}","received_events_url":"https://api.github.com/users/szroland/received_events","type":"User","site_admin":false},"created_at":"2015-06-23T21:03:16Z","updated_at":"2015-06-23T21:03:16Z","author_association":"CONTRIBUTOR","body":"I was just looking at the JDK source, `EPollArrayWrapper` in particular, just out of interest, what can be throwing that NullPointer. On the changelog: http://hg.openjdk.java.net/jdk8/jdk8/jdk/log/687fd7c7986d/src/solaris/classes/sun/nio/ch/EPollArrayWrapper.java I saw a ref to a NullPointer, so first I thought it was that issue exactly. But on the contrary, this change seems to be already included in the version of jvm used (e.g. the `isEventsHighKilled` method). I just referenced it to show JDK issues are not unheard of in this area, and that one in particular was another NullPointer in this same class.\n\nNote that I couldn't actually point to the root cause problem, because the `EPollArrayWrapper` code, and how it handles the `eventsLow` and `eventsHigh` structures seems consistent to me, and still the NullPointer seems to be because the eventsHigh map was not created, but a large FD did come through. The only thing I can think of is `IOUtil.fdLimit()` (a native method, so I didn't check how it worked) reporting a lower value than what FDs can actually occur in the given setup. To work around that, you can either limit FDs in linux manually, use that jvm flag to override the size of the `eventsLow` structure, so that it is always sufficiently large, or upgrade and hope someone spotted the root cause and fixed it.\n\nAdmittedly, there is a chance of the version of  `EPollArrayWrapper` in the particular JDK build not being fully consistent with the source I was looking at, which could result in my analysis not being 100% correct. I couldn't actually find the particular revision of EPollArrayWrapper that is exactly in that build. But still, the likelyhood of that is small I believe, since the code is still the same at the head revision of jdk8, http://hg.openjdk.java.net/jdk8/jdk8/jdk/log/687fd7c7986d/src/solaris/classes/sun/nio/ch/EPollArrayWrapper.java. I still recommended the upgrade, as I suspect the issue might be with the fdLimits() call, not with `EPollArrayWrapper`itself. \n\nI haven't tried actually reproducing this, although now that we know the jdk and elastic version, we could try doing that as well.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115543291","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-115543291","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":115543291,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTU0MzI5MQ==","user":{"login":"spinscale","id":667544,"node_id":"MDQ6VXNlcjY2NzU0NA==","avatar_url":"https://avatars2.githubusercontent.com/u/667544?v=4","gravatar_id":"","url":"https://api.github.com/users/spinscale","html_url":"https://github.com/spinscale","followers_url":"https://api.github.com/users/spinscale/followers","following_url":"https://api.github.com/users/spinscale/following{/other_user}","gists_url":"https://api.github.com/users/spinscale/gists{/gist_id}","starred_url":"https://api.github.com/users/spinscale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spinscale/subscriptions","organizations_url":"https://api.github.com/users/spinscale/orgs","repos_url":"https://api.github.com/users/spinscale/repos","events_url":"https://api.github.com/users/spinscale/events{/privacy}","received_events_url":"https://api.github.com/users/spinscale/received_events","type":"User","site_admin":false},"created_at":"2015-06-26T06:35:03Z","updated_at":"2015-06-26T06:35:03Z","author_association":"MEMBER","body":"@ayashjorden have you tried any of the above suggestions? Eager to get some feedback here!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115547631","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-115547631","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":115547631,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTU0NzYzMQ==","user":{"login":"ayashjorden","id":4204371,"node_id":"MDQ6VXNlcjQyMDQzNzE=","avatar_url":"https://avatars3.githubusercontent.com/u/4204371?v=4","gravatar_id":"","url":"https://api.github.com/users/ayashjorden","html_url":"https://github.com/ayashjorden","followers_url":"https://api.github.com/users/ayashjorden/followers","following_url":"https://api.github.com/users/ayashjorden/following{/other_user}","gists_url":"https://api.github.com/users/ayashjorden/gists{/gist_id}","starred_url":"https://api.github.com/users/ayashjorden/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ayashjorden/subscriptions","organizations_url":"https://api.github.com/users/ayashjorden/orgs","repos_url":"https://api.github.com/users/ayashjorden/repos","events_url":"https://api.github.com/users/ayashjorden/events{/privacy}","received_events_url":"https://api.github.com/users/ayashjorden/received_events","type":"User","site_admin":false},"created_at":"2015-06-26T06:50:31Z","updated_at":"2015-06-26T06:50:31Z","author_association":"NONE","body":"Hi @spinscale,\nSorry for the delayed response.\n\nLowering file descriptors is too risky for us because the (currently) single data node will (again) go into a 'too many open file' blitz.\n\nJVM maxUpdateArraySize and Java8 options will be in focus next week.\n\nI'll post an informative feedback once I'll have it.\n\nThanks,\nYarden\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/124441715","html_url":"https://github.com/elastic/elasticsearch/issues/11706#issuecomment-124441715","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11706","id":124441715,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNDQ0MTcxNQ==","user":{"login":"ayashjorden","id":4204371,"node_id":"MDQ6VXNlcjQyMDQzNzE=","avatar_url":"https://avatars3.githubusercontent.com/u/4204371?v=4","gravatar_id":"","url":"https://api.github.com/users/ayashjorden","html_url":"https://github.com/ayashjorden","followers_url":"https://api.github.com/users/ayashjorden/followers","following_url":"https://api.github.com/users/ayashjorden/following{/other_user}","gists_url":"https://api.github.com/users/ayashjorden/gists{/gist_id}","starred_url":"https://api.github.com/users/ayashjorden/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ayashjorden/subscriptions","organizations_url":"https://api.github.com/users/ayashjorden/orgs","repos_url":"https://api.github.com/users/ayashjorden/repos","events_url":"https://api.github.com/users/ayashjorden/events{/privacy}","received_events_url":"https://api.github.com/users/ayashjorden/received_events","type":"User","site_admin":false},"created_at":"2015-07-24T08:34:05Z","updated_at":"2015-07-24T08:34:05Z","author_association":"NONE","body":"Hi All,\nWe resolved the issue by addressing ES limit configuration issues as described at #12404 .\n\nThanks for all the help,\nYarden\n","performed_via_github_app":null}]