{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11819","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11819/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11819/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11819/events","html_url":"https://github.com/elastic/elasticsearch/issues/11819","id":90331001,"node_id":"MDU6SXNzdWU5MDMzMTAwMQ==","number":11819,"title":"Tophits aggregation for nested field ...","user":{"login":"HemaAnusha","id":12657223,"node_id":"MDQ6VXNlcjEyNjU3MjIz","avatar_url":"https://avatars1.githubusercontent.com/u/12657223?v=4","gravatar_id":"","url":"https://api.github.com/users/HemaAnusha","html_url":"https://github.com/HemaAnusha","followers_url":"https://api.github.com/users/HemaAnusha/followers","following_url":"https://api.github.com/users/HemaAnusha/following{/other_user}","gists_url":"https://api.github.com/users/HemaAnusha/gists{/gist_id}","starred_url":"https://api.github.com/users/HemaAnusha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HemaAnusha/subscriptions","organizations_url":"https://api.github.com/users/HemaAnusha/orgs","repos_url":"https://api.github.com/users/HemaAnusha/repos","events_url":"https://api.github.com/users/HemaAnusha/events{/privacy}","received_events_url":"https://api.github.com/users/HemaAnusha/received_events","type":"User","site_admin":false},"labels":[{"id":146832564,"node_id":"MDU6TGFiZWwxNDY4MzI1NjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Search/Search","name":":Search/Search","color":"0e8a16","default":false,"description":"Search-related issues that do not fall into other categories"},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-06-23T09:08:44Z","updated_at":"2018-02-14T13:27:00Z","closed_at":"2015-06-25T06:17:49Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\nAm using fields with nested type, in the mappings I kept for column1 and column2 as nested type fields..\n\nI am using the following query to get the top hits:\n\nGET partsfilter/partsfilter_type/_search\n{\n    \"size\": 10,\n     \"query\" : {\n        \"match\" : { \"description\" : \"abc\" }\n    },\n    \"aggs\" : {\n        \"column1\" : {\n            \"nested\" : {\n                \"path\" : \"column1\"\n            },\n            \"aggs\" : {\n               \"col1_agg\":\n               {\n                   \"terms\":\n                   {\n                       \"field\":\"column1.@key\",\n                       \"size\":0\n                   },\n                   \"aggs\":\n                   {\n                       \"top\":\n                       {\n                           \"top_hits\":\n                           {\n                               \"size\":1\n                           }\n                       }\n                   }\n               }\n            }\n        }\n    }\n}\n\nThis is throwing  SearchPhaseExecutionException[Failed to execute phase [query]  exception. when am removing top_hits aggs it is working fine.\nhow to write a top_hits query to work for the above case..\n","closed_by":{"login":"HemaAnusha","id":12657223,"node_id":"MDQ6VXNlcjEyNjU3MjIz","avatar_url":"https://avatars1.githubusercontent.com/u/12657223?v=4","gravatar_id":"","url":"https://api.github.com/users/HemaAnusha","html_url":"https://github.com/HemaAnusha","followers_url":"https://api.github.com/users/HemaAnusha/followers","following_url":"https://api.github.com/users/HemaAnusha/following{/other_user}","gists_url":"https://api.github.com/users/HemaAnusha/gists{/gist_id}","starred_url":"https://api.github.com/users/HemaAnusha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HemaAnusha/subscriptions","organizations_url":"https://api.github.com/users/HemaAnusha/orgs","repos_url":"https://api.github.com/users/HemaAnusha/repos","events_url":"https://api.github.com/users/HemaAnusha/events{/privacy}","received_events_url":"https://api.github.com/users/HemaAnusha/received_events","type":"User","site_admin":false},"performed_via_github_app":null}