{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11869","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11869/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11869/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11869/events","html_url":"https://github.com/elastic/elasticsearch/issues/11869","id":90873236,"node_id":"MDU6SXNzdWU5MDg3MzIzNg==","number":11869,"title":"Unable to maintain proper SAYT search results with multi field multi word data..","user":{"login":"HemaAnusha","id":12657223,"node_id":"MDQ6VXNlcjEyNjU3MjIz","avatar_url":"https://avatars1.githubusercontent.com/u/12657223?v=4","gravatar_id":"","url":"https://api.github.com/users/HemaAnusha","html_url":"https://github.com/HemaAnusha","followers_url":"https://api.github.com/users/HemaAnusha/followers","following_url":"https://api.github.com/users/HemaAnusha/following{/other_user}","gists_url":"https://api.github.com/users/HemaAnusha/gists{/gist_id}","starred_url":"https://api.github.com/users/HemaAnusha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HemaAnusha/subscriptions","organizations_url":"https://api.github.com/users/HemaAnusha/orgs","repos_url":"https://api.github.com/users/HemaAnusha/repos","events_url":"https://api.github.com/users/HemaAnusha/events{/privacy}","received_events_url":"https://api.github.com/users/HemaAnusha/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-06-25T06:48:31Z","updated_at":"2015-06-25T06:52:36Z","closed_at":"2015-06-25T06:52:35Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\nI would like to achieve proper SAYT(Search As You Type) search results like.\n1) When we give a letter need to get the data using that letter at starting position (unable to achieve this)\n2) The SAYT data should be in sorted order ( I covered this part).\n\nMy intention is to search data in multiple fields and those fields have multiple words. \n\n1) Starting I preferred QueryString , where in general query string will search on multiple fields and we can give priorities to those fields and we can use 'AND' /'OR' operations.\n\n2) But failed at special characters like ( '/', ',', '.', '(', ')' ). In order to use these characters we have to escape these characters, but that is not yielding accurate results.\n\n3) Where match queries can accept any type of characters, decided to use that and I used following analyzers in order to make match query to work on any situation.\n\nHere are my settings:\n\n\"analysis\": {\n               \"analyzer\": {\n                  \"analyzer_startswith\": {\n                     \"type\": \"custom\",\n                     \"filter\": \"lowercase\",\n                     \"tokenizer\": \"keyword\"\n                  },\n                  \"whitespace_analyzer\": {\n                     \"type\": \"custom\",\n                     \"filter\": [\n                        \"lowercase\",\n                        \"asciifolding\"\n                     ],\n                     \"tokenizer\": \"whitespace\"\n                  },\n                  \"wordAnalyzer\": {\n                     \"type\": \"custom\",\n                     \"filter\": [\n                        \"lowercase\",\n                        \"asciifolding\",\n                        \"nGram_filter\"\n                     ],\n                     \"tokenizer\": \"whitespace\"\n                  }\n               },\n               \"filter\": {\n                  \"nGram_filter\": {\n                     \"max_gram\": \"20\",\n                     \"min_gram\": \"1\",\n                     \"type\": \"nGram\",\n                     \"token_chars\": [\n                        \"letter\",\n                        \"punctuation\",\n                        \"symbol\",\n                        \"digit\"\n                     ]\n                  }\n               }\n            }\n\nHere are my mappings : \n\n \"ymme\": {\n      \"mappings\": {\n         \"ymme_type\": {\n            \"_all\": {\n               \"auto_boost\": true,\n               \"index_analyzer\": \"wordAnalyzer\",\n               \"search_analyzer\": \"whitespace_analyzer\"\n            },\n            \"properties\": {\n               \"Engine\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n               },\n               \"EngineCode\": {\n                  \"type\": \"string\",\n                  \"include_in_all\": false\n               },\n               \"Make\": {\n                  \"type\": \"string\",\n                  \"boost\": 3,\n                  \"index\": \"not_analyzed\",\n                  \"norms\": {\n                     \"enabled\": true\n                  }\n               },\n               \"MakeCode\": {\n                  \"type\": \"string\",\n                  \"include_in_all\": false\n               },\n               \"Model\": {\n                  \"type\": \"string\",\n                  \"boost\": 2,\n                  \"index\": \"not_analyzed\",\n                  \"norms\": {\n                     \"enabled\": true\n                  }\n               },\n               \"ModelCode\": {\n                  \"type\": \"string\",\n                  \"include_in_all\": false\n               },\n               \"ShortYear\": {\n                  \"type\": \"string\",\n                  \"boost\": 4,\n                  \"index\": \"not_analyzed\",\n                  \"norms\": {\n                     \"enabled\": true\n                  }\n               },\n               \"Year\": {\n                  \"type\": \"string\",\n                  \"boost\": 5,\n                  \"index\": \"not_analyzed\",\n                  \"norms\": {\n                     \"enabled\": true\n                  },\n                  \"fields\": {\n                     \"raw\": {\n                        \"type\": \"string\",\n                        \"index\": \"not_analyzed\"\n                     }\n                  }\n               },\n               \"YearCode\": {\n                  \"type\": \"string\",\n                  \"include_in_all\": false\n               }\n            }\n         }\n      }\n}\n\nNow I used query as : \n\nGET ymme/ymme_type/_search\n{\n    \"query\": {\n        \"bool\": {\n            \"must\": [\n               {\n                   \"match\": {\n                      \"_all\": \n                      {\n                          \"query\": \"2\",\n                          \"operator\": \"and\"\n                      }\n                   }\n               }\n            ]\n        }\n    }\n}\n\nEvery thing is working fine......\nBut problem is with words starting with:\nwhen I give my query as  \"query\": \"2000 Audi\",\n\n1) Here '2000' belongs to year / 'Audi' belongs to Make, so when I am entering the letter 'A'  my search result is not showing the data starting with a, searching is done from middle of the word. I know the reason that because of my analyzers. \n2) If I use match_phrase_prefix without these analyzers an every thing am unable to get the data with query:\"2000 a\", and I have to give the data in indexing order like \n\nquery:\" \"Year\"  \"Model\"    \"ShortYear\"   \"Engine\"   \"Make\" \", in this order I have search if i miss the order am unable to retrive the data with match_phrase_prefix....\n\nCan anyone give me a solution to my problem that need to get the data starting with and need to search in multiple fields multiple words by preserving special characters..\n","closed_by":{"login":"dadoonet","id":274222,"node_id":"MDQ6VXNlcjI3NDIyMg==","avatar_url":"https://avatars3.githubusercontent.com/u/274222?v=4","gravatar_id":"","url":"https://api.github.com/users/dadoonet","html_url":"https://github.com/dadoonet","followers_url":"https://api.github.com/users/dadoonet/followers","following_url":"https://api.github.com/users/dadoonet/following{/other_user}","gists_url":"https://api.github.com/users/dadoonet/gists{/gist_id}","starred_url":"https://api.github.com/users/dadoonet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dadoonet/subscriptions","organizations_url":"https://api.github.com/users/dadoonet/orgs","repos_url":"https://api.github.com/users/dadoonet/repos","events_url":"https://api.github.com/users/dadoonet/events{/privacy}","received_events_url":"https://api.github.com/users/dadoonet/received_events","type":"User","site_admin":false},"performed_via_github_app":null}