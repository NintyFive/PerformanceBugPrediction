{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11872","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11872/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11872/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11872/events","html_url":"https://github.com/elastic/elasticsearch/issues/11872","id":90894470,"node_id":"MDU6SXNzdWU5MDg5NDQ3MA==","number":11872,"title":"Score based on date timestamp are not working","user":{"login":"valentin-claras","id":4446791,"node_id":"MDQ6VXNlcjQ0NDY3OTE=","avatar_url":"https://avatars2.githubusercontent.com/u/4446791?v=4","gravatar_id":"","url":"https://api.github.com/users/valentin-claras","html_url":"https://github.com/valentin-claras","followers_url":"https://api.github.com/users/valentin-claras/followers","following_url":"https://api.github.com/users/valentin-claras/following{/other_user}","gists_url":"https://api.github.com/users/valentin-claras/gists{/gist_id}","starred_url":"https://api.github.com/users/valentin-claras/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentin-claras/subscriptions","organizations_url":"https://api.github.com/users/valentin-claras/orgs","repos_url":"https://api.github.com/users/valentin-claras/repos","events_url":"https://api.github.com/users/valentin-claras/events{/privacy}","received_events_url":"https://api.github.com/users/valentin-claras/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-06-25T08:31:58Z","updated_at":"2016-01-24T00:13:03Z","closed_at":"2015-06-25T09:57:03Z","author_association":"NONE","active_lock_reason":null,"body":"Hi,\n\nI tried to create a query with a score based on a date, but couldn't make it to work. The score I got is inconsistent.\nUsing the date alone gave me 3 identical scores where the date are actually different.\n## Timstamp\n\n```\n# Delete the index.\ncurl -XDELETE http://localhost:9200/test_date_scoring\n\n# Insert 3 documents with different dates.\ncurl -XPUT http://localhost:9200/test_date_scoring/foo/1 -d '{\n    \"title\": \"Foo 1\",\n    \"date\": \"2015-06-25T10:15:00\"\n}'\ncurl -XPUT http://localhost:9200/test_date_scoring/foo/2 -d '{\n    \"title\": \"Foo 2\",\n    \"date\": \"2015-06-25T10:15:01\"\n}'\ncurl -XPUT http://localhost:9200/test_date_scoring/foo/3 -d '{\n    \"title\": \"Foo 3\",\n    \"date\": \"2015-06-25T10:15:02\"\n}'\n\n# Query with score based on date. The 3 scores should be different.\n# Got three 1435227260000.\ncurl -XPOST http://localhost:9200/test_date_scoring/foo/_search -d '{\n    \"query\": {\n        \"function_score\": {\n            \"functions\": [\n                {\n                    \"field_value_factor\": {\n                        \"field\": \"date\"\n                    }\n                }\n            ],\n            \"boost_mode\": \"replace\"\n        }\n    }\n}'\n\n# Result\n{\n  \"took\": 3,\n  \"timed_out\": false,\n  \"_shards\": {\n    \"total\": 5,\n    \"successful\": 5,\n    \"failed\": 0\n  },\n  \"hits\": {\n    \"total\": 3,\n    \"max_score\": 1435227260000,\n    \"hits\": [\n      {\n        \"_index\": \"test_date_scoring\",\n        \"_type\": \"foo\",\n        \"_id\": \"1\",\n        \"_score\": 1435227260000,\n        \"_source\": {\n          \"title\": \"Foo 1\",\n          \"date\": \"2015-06-25T10:15:00\"\n        }\n      },\n      {\n        \"_index\": \"test_date_scoring\",\n        \"_type\": \"foo\",\n        \"_id\": \"2\",\n        \"_score\": 1435227260000,\n        \"_source\": {\n          \"title\": \"Foo 2\",\n          \"date\": \"2015-06-25T10:15:01\"\n        }\n      },\n      {\n        \"_index\": \"test_date_scoring\",\n        \"_type\": \"foo\",\n        \"_id\": \"3\",\n        \"_score\": 1435227260000,\n        \"_source\": {\n          \"title\": \"Foo 3\",\n          \"date\": \"2015-06-25T10:15:02\"\n        }\n      }\n    ]\n  }\n}\n```\n\nI made some more tests with factor and sum, and again results are not what I expected.\n## Factor\n\n```\n# Query with score based on date and 0.001 factor. Score should be the same minus three 0.\n# Got 1435227390 instead of 1435227260.\ncurl -XPOST http://localhost:9200/test_date_scoring/foo/_search -d '{\n    \"query\": {\n        \"function_score\": {\n            \"functions\": [\n                {\n                    \"field_value_factor\": {\n                        \"field\": \"date\",\n                        \"factor\": 0.001\n                    }\n                }\n            ],\n            \"boost_mode\": \"replace\"\n        }\n    }\n}'\n```\n## Sum\n\n```\n# Query with score based on date, then 1 is added. Score should be the same + 1.\n# Got 1435227260000 instead of 1435227260001.\ncurl -XPOST http://localhost:9200/test_date_scoring/foo/_search -d '{\n    \"query\": {\n        \"function_score\": {\n            \"query\": {\n                \"function_score\": {\n                    \"functions\": [\n                        {\n                            \"field_value_factor\": {\n                                \"field\": \"date\"\n                            }\n                        }\n                    ],\n                    \"boost_mode\": \"replace\"\n                }\n            },\n            \"functions\": [\n                {\n                    \"weight\": 1\n                }\n            ],\n            \"boost_mode\": \"sum\"\n        }\n    }\n}'\n```\n\nSo my question is :\n**Is this the correct behavior ? If it is, how can I base my score on a date ?**\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}