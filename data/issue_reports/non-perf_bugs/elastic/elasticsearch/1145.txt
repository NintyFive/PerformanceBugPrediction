{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1145","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1145/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1145/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1145/events","html_url":"https://github.com/elastic/elasticsearch/issues/1145","id":1264822,"node_id":"MDU6SXNzdWUxMjY0ODIy","number":1145,"title":"Scripts: arrays: \".multiValued\" returns true even when \".values\" fails","user":{"login":"Alex-Ikanow","id":851950,"node_id":"MDQ6VXNlcjg1MTk1MA==","avatar_url":"https://avatars2.githubusercontent.com/u/851950?v=4","gravatar_id":"","url":"https://api.github.com/users/Alex-Ikanow","html_url":"https://github.com/Alex-Ikanow","followers_url":"https://api.github.com/users/Alex-Ikanow/followers","following_url":"https://api.github.com/users/Alex-Ikanow/following{/other_user}","gists_url":"https://api.github.com/users/Alex-Ikanow/gists{/gist_id}","starred_url":"https://api.github.com/users/Alex-Ikanow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Alex-Ikanow/subscriptions","organizations_url":"https://api.github.com/users/Alex-Ikanow/orgs","repos_url":"https://api.github.com/users/Alex-Ikanow/repos","events_url":"https://api.github.com/users/Alex-Ikanow/events{/privacy}","received_events_url":"https://api.github.com/users/Alex-Ikanow/received_events","type":"User","site_admin":false},"labels":[{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":135860,"node_id":"MDU6TGFiZWwxMzU4NjA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.17.5","name":"v0.17.5","color":"DDDDDD","default":false,"description":null},{"id":127902,"node_id":"MDU6TGFiZWwxMjc5MDI=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v0.18.0","name":"v0.18.0","color":"DDDDDD","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2011-07-21T18:02:07Z","updated_at":"2011-08-09T15:50:15Z","closed_at":"2011-08-09T15:50:15Z","author_association":"NONE","active_lock_reason":null,"body":"(See also https://github.com/elasticsearch/elasticsearch/issues/1144)\n\nI now have a dataset with a multi-valued field (\"locs\" from the previous issue, the type happens to be a geo-point; I don't know if that's significant but I suspect not) that sometimes has a single value, eg\n\n\"fields\": {\n   \"locs\": \"40.3278286374,-74.511843005\"\n}\n\nand sometimes many values:\n\n\"fields\": {\n   \"locs\": [\n      \"40.3278286374,-74.511843005\",\n      \"40.3278286374,-74.511843005\"\n   ]\n}\n\nTwo related issues (the second of which looks like a definite bug)\n\nBoth of these are issues with mvel (tried js and got a separate problem, described in [3])\n\n1] Ideally I'd like to be able to use \"doc['locs'].values\" in both cases, eg with \"doc['locs'].values.length==1\" in the first case and \"==2\" in the second.\n\nIn practice, if I try to access any properties of \"values\" in the first case (eg \"n = doc['locs'].values.length\"), I get an error like:\n\n\"reason\": \"RuntimeException[cannot invoke getter: getValues [declr.class: org.elasticsearch.index.mapper.xcontent.geo.GeoPointDocFieldData; act.class: org.elasticsearch.index.mapper.xcontent.geo.GeoPointDocFieldData](see trace)]; nested: nested: ArrayIndexOutOfBoundsException[0]; \"\n\n2] Since the above happened, I wanted to test on \".multiValued\" and have 2 different clauses to handle the two cases. Unfortunately, \"doc['locs'].multiValued\" returns true in both cases.\n\n(As an aside: If there's any mvel workaround which would allow me to keep the code in mvel with 0.16.2 that would be awesome, I use a bunch of trig functions and wotnot later on in the script, and I'm not particularly excited to rewrite it in JS or mess around with native scripts)\n\n3] Perhaps I'm going mad, but with \"lang\":\"js\", then \"doc['locs'].values\" always failed for me (with the same ArrayIndexOutOfBoundsException[0]), ie even with 'locs' having 2 or 3 values.\n\n(Conversely, doc['locs'].lats and doc['locs'].lons worked in JS)\n","closed_by":{"login":"kimchy","id":41300,"node_id":"MDQ6VXNlcjQxMzAw","avatar_url":"https://avatars1.githubusercontent.com/u/41300?v=4","gravatar_id":"","url":"https://api.github.com/users/kimchy","html_url":"https://github.com/kimchy","followers_url":"https://api.github.com/users/kimchy/followers","following_url":"https://api.github.com/users/kimchy/following{/other_user}","gists_url":"https://api.github.com/users/kimchy/gists{/gist_id}","starred_url":"https://api.github.com/users/kimchy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kimchy/subscriptions","organizations_url":"https://api.github.com/users/kimchy/orgs","repos_url":"https://api.github.com/users/kimchy/repos","events_url":"https://api.github.com/users/kimchy/events{/privacy}","received_events_url":"https://api.github.com/users/kimchy/received_events","type":"User","site_admin":false},"performed_via_github_app":null}