{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/1161","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1161/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1161/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/1161/events","html_url":"https://github.com/elastic/elasticsearch/issues/1161","id":1287197,"node_id":"MDU6SXNzdWUxMjg3MTk3","number":1161,"title":"Server crashes when posting documents and searching them immediately afterwards","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2011-07-26T07:59:44Z","updated_at":"2011-07-26T08:39:24Z","closed_at":"2011-07-26T08:39:24Z","author_association":"NONE","active_lock_reason":null,"body":"I have a test that does a bulk post of documents into 3 indices and immediately afterwards does a _search.\n\nIt fails due to that the documents are not indexed yet for search and the server also crashes:\n\n[2011-07-26 09:55:33,174][INFO ][node                     ] [Orphan] {elasticsearch/0.17.1}[619]: initializing ...\n[2011-07-26 09:55:33,181][INFO ][plugins                  ] [Orphan] loaded [], sites []\n[2011-07-26 09:55:35,240][INFO ][node                     ] [Orphan] {elasticsearch/0.17.1}[619]: initialized\n[2011-07-26 09:55:35,240][INFO ][node                     ] [Orphan] {elasticsearch/0.17.1}[619]: starting ...\n[2011-07-26 09:55:35,366][INFO ][transport                ] [Orphan] bound_address {inet[/0.0.0.0:9301]}, publish_address {inet[/10.0.1.3:9301]}\n[2011-07-26 09:55:38,489][INFO ][cluster.service          ] [Orphan] detected_master [Ecstasy][CW7W5ET5Spm4Wug76WCcYQ][inet[/10.0.1.3:9300]], added {[Ecstasy][CW7W5ET5Spm4Wug76WCcYQ][inet[/10.0.1.3:9300]],}, reason: zen-disco-receive(from master [[Ecstasy][CW7W5ET5Spm4Wug76WCcYQ][inet[/10.0.1.3:9300]]])\n[2011-07-26 09:55:38,495][INFO ][discovery                ] [Orphan] elasticsearch/7pVYKvdARNaHqhPk0rbczA\n[2011-07-26 09:55:38,504][INFO ][http                     ] [Orphan] bound_address {inet[/0.0.0.0:9201]}, publish_address {inet[/10.0.1.3:9201]}\n[2011-07-26 09:55:38,505][INFO ][node                     ] [Orphan] {elasticsearch/0.17.1}[619]: started\n[2011-07-26 09:56:02,342][WARN ][index.shard.service      ] [Orphan] [apple.com][0] Failed to perform scheduled engine refresh\norg.elasticsearch.index.engine.RefreshFailedEngineException: [apple.com][0] Refresh failed\n    at org.elasticsearch.index.engine.robin.RobinEngine.refresh(RobinEngine.java:762)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.refresh(InternalIndexShard.java:384)\n    at org.elasticsearch.index.shard.service.InternalIndexShard$EngineRefresher$1.run(InternalIndexShard.java:613)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n    at java.lang.Thread.run(Thread.java:680)\nCaused by: java.io.FileNotFoundException: /Volumes/Private/johnnyluu/Documents/Development/third_party/elasticsearch-0.17.1/data/elasticsearch/nodes/1/indices/apple.com/0/index/_0.frq (No such file or directory)\n    at java.io.RandomAccessFile.open(Native Method)\n    at java.io.RandomAccessFile.<init>(RandomAccessFile.java:216)\n    at org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexInput$Descriptor.<init>(SimpleFSDirectory.java:69)\n    at org.apache.lucene.store.SimpleFSDirectory$SimpleFSIndexInput.<init>(SimpleFSDirectory.java:90)\n    at org.apache.lucene.store.NIOFSDirectory$NIOFSIndexInput.<init>(NIOFSDirectory.java:91)\n    at org.apache.lucene.store.NIOFSDirectory.openInput(NIOFSDirectory.java:78)\n    at org.elasticsearch.index.store.support.AbstractStore$StoreDirectory.openInput(AbstractStore.java:344)\n    at org.apache.lucene.index.SegmentCoreReaders.<init>(SegmentCoreReaders.java:85)\n    at org.apache.lucene.index.SegmentReader.get(SegmentReader.java:114)\n    at org.apache.lucene.index.IndexWriter$ReaderPool.get(IndexWriter.java:702)\n    at org.apache.lucene.index.IndexWriter$ReaderPool.getReadOnlyClone(IndexWriter.java:660)\n    at org.apache.lucene.index.DirectoryReader.<init>(DirectoryReader.java:157)\n    at org.apache.lucene.index.ReadOnlyDirectoryReader.<init>(ReadOnlyDirectoryReader.java:38)\n    at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:459)\n    at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:407)\n    at org.apache.lucene.index.DirectoryReader.doReopenFromWriter(DirectoryReader.java:414)\n    at org.apache.lucene.index.DirectoryReader.doReopen(DirectoryReader.java:427)\n    at org.apache.lucene.index.DirectoryReader.reopen(DirectoryReader.java:392)\n    at org.elasticsearch.index.engine.robin.RobinEngine.refresh(RobinEngine.java:745)\n    ... 5 more\n[2011-07-26 09:56:02,356][WARN ][index.shard.service      ] [Orphan] [apple.com][2] Failed to perform scheduled engine refresh\norg.elasticsearch.index.engine.RefreshFailedEngineException: [apple.com][2] Refresh failed\n    at org.elasticsearch.index.engine.robin.RobinEngine.refresh(RobinEngine.java:762)\n    at org.elasticsearch.index.shard.service.InternalIndexShard.refresh(InternalIndexShard.java:384)\n    at org.elasticsearch.index.shard.service.InternalIndexShard$EngineRefresher$1.run(InternalIndexShard.java:613)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)\n    at java.lang.Thread.run(Thread.java:680)\nCaused by: java.io.FileNotFoundException: _0.fdt\n    at org.apache.lucene.store.FSDirectory.fileLength(FSDirectory.java:284)\n    at org.elasticsearch.index.store.support.AbstractStore$StoreDirectory.fileLength(AbstractStore.java:310)\n    at org.elasticsearch.index.store.support.AbstractStore$StoreIndexOutput.close(AbstractStore.java:428)\n    at org.apache.lucene.util.IOUtils.closeSafely(IOUtils.java:118)\n    at org.apache.lucene.index.FieldsWriter.close(FieldsWriter.java:127)\n    at org.apache.lucene.index.StoredFieldsWriter.flush(StoredFieldsWriter.java:52)\n    at org.apache.lucene.index.DocFieldProcessor.flush(DocFieldProcessor.java:59)\n    at org.apache.lucene.index.DocumentsWriter.flush(DocumentsWriter.java:581)\n    at org.apache.lucene.index.IndexWriter.doFlush(IndexWriter.java:3543)\n    at org.apache.lucene.index.IndexWriter.flush(IndexWriter.java:3508)\n    at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:458)\n    at org.apache.lucene.index.IndexWriter.getReader(IndexWriter.java:407)\n    at org.apache.lucene.index.DirectoryReader.doReopenFromWriter(DirectoryReader.java:414)\n    at org.apache.lucene.index.DirectoryReader.doReopen(DirectoryReader.java:427)\n    at org.apache.lucene.index.DirectoryReader.reopen(DirectoryReader.java:392)\n    at org.elasticsearch.index.engine.robin.RobinEngine.refresh(RobinEngine.java:745)\n    ... 5 more\n\nHowever, if I wait 1 sec after I posted the documents I get the search results as usual.\n","closed_by":null,"performed_via_github_app":null}