[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/108889234","html_url":"https://github.com/elastic/elasticsearch/issues/11495#issuecomment-108889234","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11495","id":108889234,"node_id":"MDEyOklzc3VlQ29tbWVudDEwODg4OTIzNA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-04T13:01:41Z","updated_at":"2015-06-04T13:01:41Z","author_association":"CONTRIBUTOR","body":"Hi @jimmyjones2 \n\nYou can't get the norms memory usage all by itself, but the amount of memory that is used by Lucene for open segments (which includes norms, and things like the terms index) is available through the node stats or the indices stats under `segments.memory_in_bytes`.\n\nAs a side note, there is an open patch in Lucene to move norms fully on to disk, which will resolve the problem of heavy norms memory use.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/108928235","html_url":"https://github.com/elastic/elasticsearch/issues/11495#issuecomment-108928235","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11495","id":108928235,"node_id":"MDEyOklzc3VlQ29tbWVudDEwODkyODIzNQ==","user":{"login":"rmuir","id":504194,"node_id":"MDQ6VXNlcjUwNDE5NA==","avatar_url":"https://avatars1.githubusercontent.com/u/504194?v=4","gravatar_id":"","url":"https://api.github.com/users/rmuir","html_url":"https://github.com/rmuir","followers_url":"https://api.github.com/users/rmuir/followers","following_url":"https://api.github.com/users/rmuir/following{/other_user}","gists_url":"https://api.github.com/users/rmuir/gists{/gist_id}","starred_url":"https://api.github.com/users/rmuir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rmuir/subscriptions","organizations_url":"https://api.github.com/users/rmuir/orgs","repos_url":"https://api.github.com/users/rmuir/repos","events_url":"https://api.github.com/users/rmuir/events{/privacy}","received_events_url":"https://api.github.com/users/rmuir/received_events","type":"User","site_admin":false},"created_at":"2015-06-04T15:07:57Z","updated_at":"2015-06-04T15:07:57Z","author_association":"CONTRIBUTOR","body":"> However I've been looking in the stats, but I can't see where this memory is accounted for so I can see if it is biting me. Is it included in fielddata?\n\nNo, currently its included in the `segments` memory usage of the stats api:\n\n```\n\"segments\" : {\n    \"count\" : 4,\n    \"memory_in_bytes\" : 13160 <-- there\n```\n\nBut this statistic also includes other lucene datastructures. For 2.0, it is broken down more into categories like `norms_memory_in_bytes`, `terms_memory_in_bytes`, and so on:\n\n```\n\"segments\" : {\n    \"count\" : 4,\n    \"memory_in_bytes\" : 13160\n    ...\n    \"norms_memory_in_bytes\" : 384 <-- there\n```\n\nFinally for 2.0 if you really want to know the gory details, pass `verbose=true` to the `_segments` api:\n\n```\n\"ram_tree\" : [\n  ...\n  , {\n            \"description\" : \"norms [Lucene50NormsProducer(fields=4,active=1)]\",\n            \"size_in_bytes\" : 112,\n            \"children\" : [ {\n              \"description\" : \"field 'message' [table compressed]\",\n              \"size_in_bytes\" : 72,\n              \"children\" : [ {\n                \"description\" : \"ordinals [Packed64SingleBlock2(bitsPerValue=2,size=5,blocks=1)]\",\n                \"size_in_bytes\" : 48\n              } ]\n            } ]\n          }\n```\n\n> Is it always used, or only after I've run a query?\n\nWell you have to have norms for the field for them to be used. If you dont want them, then omit norms for fields where you dont care about scoring.\n\nToday norms for a field are lazy-loaded on-demand, per-segment for the first query against the field. Additionally, background merges will cause norms for _all fields_ to be loaded at once. So you can't rely on this laziness really: omit norms if you don't need them. For 2.0 merges will not do that.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/108936422","html_url":"https://github.com/elastic/elasticsearch/issues/11495#issuecomment-108936422","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11495","id":108936422,"node_id":"MDEyOklzc3VlQ29tbWVudDEwODkzNjQyMg==","user":{"login":"jimmyjones2","id":2991805,"node_id":"MDQ6VXNlcjI5OTE4MDU=","avatar_url":"https://avatars2.githubusercontent.com/u/2991805?v=4","gravatar_id":"","url":"https://api.github.com/users/jimmyjones2","html_url":"https://github.com/jimmyjones2","followers_url":"https://api.github.com/users/jimmyjones2/followers","following_url":"https://api.github.com/users/jimmyjones2/following{/other_user}","gists_url":"https://api.github.com/users/jimmyjones2/gists{/gist_id}","starred_url":"https://api.github.com/users/jimmyjones2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimmyjones2/subscriptions","organizations_url":"https://api.github.com/users/jimmyjones2/orgs","repos_url":"https://api.github.com/users/jimmyjones2/repos","events_url":"https://api.github.com/users/jimmyjones2/events{/privacy}","received_events_url":"https://api.github.com/users/jimmyjones2/received_events","type":"User","site_admin":false},"created_at":"2015-06-04T15:32:15Z","updated_at":"2015-06-04T15:32:15Z","author_association":"CONTRIBUTOR","body":"@rmuir Thanks for the detailed response, that explains everything. I look forward to 2.0 that has already implemented exactly what I need.\n","performed_via_github_app":null}]