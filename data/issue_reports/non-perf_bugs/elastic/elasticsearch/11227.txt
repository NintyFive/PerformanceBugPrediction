{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11227","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11227/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11227/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11227/events","html_url":"https://github.com/elastic/elasticsearch/issues/11227","id":78075926,"node_id":"MDU6SXNzdWU3ODA3NTkyNg==","number":11227,"title":"Found Elasticsearch with Aliased Index with Routing","user":{"login":"dbhattacharjee","id":797947,"node_id":"MDQ6VXNlcjc5Nzk0Nw==","avatar_url":"https://avatars1.githubusercontent.com/u/797947?v=4","gravatar_id":"","url":"https://api.github.com/users/dbhattacharjee","html_url":"https://github.com/dbhattacharjee","followers_url":"https://api.github.com/users/dbhattacharjee/followers","following_url":"https://api.github.com/users/dbhattacharjee/following{/other_user}","gists_url":"https://api.github.com/users/dbhattacharjee/gists{/gist_id}","starred_url":"https://api.github.com/users/dbhattacharjee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbhattacharjee/subscriptions","organizations_url":"https://api.github.com/users/dbhattacharjee/orgs","repos_url":"https://api.github.com/users/dbhattacharjee/repos","events_url":"https://api.github.com/users/dbhattacharjee/events{/privacy}","received_events_url":"https://api.github.com/users/dbhattacharjee/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-05-19T12:54:34Z","updated_at":"2015-05-25T11:46:06Z","closed_at":"2015-05-25T11:46:05Z","author_association":"NONE","active_lock_reason":null,"body":"We have multiple organization having identical structure of records in Database. We are using ES with aliased index and routing features for each organization. Now, when we clear the ES index and start with clean state, then search records is coming properly from ES. But when we adding multiple organizations, ES is behaving strangely. Sometimes it is sending data of another organization or sometimes it just suppress data. Even more alarming, sometimes it is sending data of record which is not even searched ! \"john\" it is retuning \"Ringo\", searching via \"Mick\" returning \"John\".\n\nBTW, we are using Symfony2 and FosElasticabundle for all of the above operations.\n\nFurther Investigations :\n\n```\nIndex only one org. Data is coming for that org.\nIndex another one org. Data is coming for that org too.\nIndex third org. Data is lost for first org !.\n```\n\nImages :\n\n```\nClean state : http://imageshack.com/i/idNW3QVCp\nWith one org. being indexed: http://imageshack.com/i/f0zTd4YEp, http://imageshack.com/i/idKl1oQrp\nWith another org. being indexed: http://imageshack.com/i/pbWP7YiNp, http://imageshack.com/i/p8eUMiDxp\nWith third org. being index: http://imageshack.com/i/ipxfEXo3p, http://imageshack.com/i/eyeS46fGp\nLog from Sf2: http://imageshack.com/i/f03ZQ8IOp\n```\n\nES Server status :\n{\n  \"_shards\" : {\n    \"total\" : 10,\n    \"successful\" : 5,\n    \"failed\" : 0\n  },\n  \"indices\" : {\n    \"organizations\" : {\n      \"index\" : {\n        \"primary_size_in_bytes\" : 54928,\n        \"size_in_bytes\" : 54928\n      },\n      \"translog\" : {\n        \"operations\" : 106\n      },\n      \"docs\" : {\n        \"num_docs\" : 50,\n        \"max_doc\" : 73,\n        \"deleted_docs\" : 23\n      },\n      \"merges\" : {\n        \"current\" : 0,\n        \"current_docs\" : 0,\n        \"current_size_in_bytes\" : 0,\n        \"total\" : 0,\n        \"total_time_in_millis\" : 0,\n        \"total_docs\" : 0,\n        \"total_size_in_bytes\" : 0\n      },\n      \"refresh\" : {\n        \"total\" : 125,\n        \"total_time_in_millis\" : 204\n      },\n      \"flush\" : {\n        \"total\" : 0,\n        \"total_time_in_millis\" : 0\n      },\n      \"shards\" : {\n        \"0\" : [ {\n          \"routing\" : {\n            \"state\" : \"STARTED\",\n            \"primary\" : true,\n            \"node\" : \"ficq9zDSRM2HJTGLk2BZ7g\",\n            \"relocating_node\" : null,\n            \"shard\" : 0,\n            \"index\" : \"organizations\"\n          },\n          \"state\" : \"STARTED\",\n          \"index\" : {\n            \"size_in_bytes\" : 15923\n          },\n          \"translog\" : {\n            \"id\" : 1432033150513,\n            \"operations\" : 42\n          },\n          \"docs\" : {\n            \"num_docs\" : 21,\n            \"max_doc\" : 21,\n            \"deleted_docs\" : 0\n          },\n          \"merges\" : {\n            \"current\" : 0,\n            \"current_docs\" : 0,\n            \"current_size_in_bytes\" : 0,\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0,\n            \"total_docs\" : 0,\n            \"total_size_in_bytes\" : 0\n          },\n          \"refresh\" : {\n            \"total\" : 25,\n            \"total_time_in_millis\" : 114\n          },\n          \"flush\" : {\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0\n          }\n        } ],\n        \"1\" : [ {\n          \"routing\" : {\n            \"state\" : \"STARTED\",\n            \"primary\" : true,\n            \"node\" : \"ficq9zDSRM2HJTGLk2BZ7g\",\n            \"relocating_node\" : null,\n            \"shard\" : 1,\n            \"index\" : \"organizations\"\n          },\n          \"state\" : \"STARTED\",\n          \"index\" : {\n            \"size_in_bytes\" : 123\n          },\n          \"translog\" : {\n            \"id\" : 1432033150524,\n            \"operations\" : 0\n          },\n          \"docs\" : {\n            \"num_docs\" : 0,\n            \"max_doc\" : 0,\n            \"deleted_docs\" : 0\n          },\n          \"merges\" : {\n            \"current\" : 0,\n            \"current_docs\" : 0,\n            \"current_size_in_bytes\" : 0,\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0,\n            \"total_docs\" : 0,\n            \"total_size_in_bytes\" : 0\n          },\n          \"refresh\" : {\n            \"total\" : 25,\n            \"total_time_in_millis\" : 1\n          },\n          \"flush\" : {\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0\n          }\n        } ],\n        \"2\" : [ {\n          \"routing\" : {\n            \"state\" : \"STARTED\",\n            \"primary\" : true,\n            \"node\" : \"ficq9zDSRM2HJTGLk2BZ7g\",\n            \"relocating_node\" : null,\n            \"shard\" : 2,\n            \"index\" : \"organizations\"\n          },\n          \"state\" : \"STARTED\",\n          \"index\" : {\n            \"size_in_bytes\" : 4782\n          },\n          \"translog\" : {\n            \"id\" : 1432033150529,\n            \"operations\" : 8\n          },\n          \"docs\" : {\n            \"num_docs\" : 8,\n            \"max_doc\" : 8,\n            \"deleted_docs\" : 0\n          },\n          \"merges\" : {\n            \"current\" : 0,\n            \"current_docs\" : 0,\n            \"current_size_in_bytes\" : 0,\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0,\n            \"total_docs\" : 0,\n            \"total_size_in_bytes\" : 0\n          },\n          \"refresh\" : {\n            \"total\" : 25,\n            \"total_time_in_millis\" : 11\n          },\n          \"flush\" : {\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0\n          }\n        } ],\n        \"3\" : [ {\n          \"routing\" : {\n            \"state\" : \"STARTED\",\n            \"primary\" : true,\n            \"node\" : \"ficq9zDSRM2HJTGLk2BZ7g\",\n            \"relocating_node\" : null,\n            \"shard\" : 3,\n            \"index\" : \"organizations\"\n          },\n          \"state\" : \"STARTED\",\n          \"index\" : {\n            \"size_in_bytes\" : 123\n          },\n          \"translog\" : {\n            \"id\" : 1432033150518,\n            \"operations\" : 0\n          },\n          \"docs\" : {\n            \"num_docs\" : 0,\n            \"max_doc\" : 0,\n            \"deleted_docs\" : 0\n          },\n          \"merges\" : {\n            \"current\" : 0,\n            \"current_docs\" : 0,\n            \"current_size_in_bytes\" : 0,\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0,\n            \"total_docs\" : 0,\n            \"total_size_in_bytes\" : 0\n          },\n          \"refresh\" : {\n            \"total\" : 25,\n            \"total_time_in_millis\" : 0\n          },\n          \"flush\" : {\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0\n          }\n        } ],\n        \"4\" : [ {\n          \"routing\" : {\n            \"state\" : \"STARTED\",\n            \"primary\" : true,\n            \"node\" : \"ficq9zDSRM2HJTGLk2BZ7g\",\n            \"relocating_node\" : null,\n            \"shard\" : 4,\n            \"index\" : \"organizations\"\n          },\n          \"state\" : \"STARTED\",\n          \"index\" : {\n            \"size_in_bytes\" : 33977\n          },\n          \"translog\" : {\n            \"id\" : 1432033150546,\n            \"operations\" : 56\n          },\n          \"docs\" : {\n            \"num_docs\" : 21,\n            \"max_doc\" : 44,\n            \"deleted_docs\" : 23\n          },\n          \"merges\" : {\n            \"current\" : 0,\n            \"current_docs\" : 0,\n            \"current_size_in_bytes\" : 0,\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0,\n            \"total_docs\" : 0,\n            \"total_size_in_bytes\" : 0\n          },\n          \"refresh\" : {\n            \"total\" : 25,\n            \"total_time_in_millis\" : 78\n          },\n          \"flush\" : {\n            \"total\" : 0,\n            \"total_time_in_millis\" : 0\n          }\n        } ]\n      }\n    }\n  }\n}\n\nIt seems ES is overwriting data of existing aliases when another org. is being indexed. But that is deal breaker. Please advice.\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}