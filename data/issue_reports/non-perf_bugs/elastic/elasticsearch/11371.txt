{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11371","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11371/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11371/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11371/events","html_url":"https://github.com/elastic/elasticsearch/issues/11371","id":81434532,"node_id":"MDU6SXNzdWU4MTQzNDUzMg==","number":11371,"title":"bulk updates with groovy script leads to long gc pauses","user":{"login":"adler","id":107646,"node_id":"MDQ6VXNlcjEwNzY0Ng==","avatar_url":"https://avatars0.githubusercontent.com/u/107646?v=4","gravatar_id":"","url":"https://api.github.com/users/adler","html_url":"https://github.com/adler","followers_url":"https://api.github.com/users/adler/followers","following_url":"https://api.github.com/users/adler/following{/other_user}","gists_url":"https://api.github.com/users/adler/gists{/gist_id}","starred_url":"https://api.github.com/users/adler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adler/subscriptions","organizations_url":"https://api.github.com/users/adler/orgs","repos_url":"https://api.github.com/users/adler/repos","events_url":"https://api.github.com/users/adler/events{/privacy}","received_events_url":"https://api.github.com/users/adler/received_events","type":"User","site_admin":false},"labels":[{"id":146834791,"node_id":"MDU6TGFiZWwxNDY4MzQ3OTE=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Infra/Scripting","name":":Core/Infra/Scripting","color":"0e8a16","default":false,"description":"Scripting abstractions, Painless, and Mustache"},{"id":23715,"node_id":"MDU6TGFiZWwyMzcxNQ==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Edocs","name":">docs","color":"db755e","default":false,"description":"General docs changes"},{"id":111416437,"node_id":"MDU6TGFiZWwxMTE0MTY0Mzc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/discuss","name":"discuss","color":"fbca04","default":false,"description":null},{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-05-27T12:58:49Z","updated_at":"2017-03-31T13:52:43Z","closed_at":"2017-03-31T13:52:43Z","author_association":"NONE","active_lock_reason":null,"body":"We are doing bulk updates for hundreds of thousands of documents. We are using a groovy script to avoid the default merging of defunct data in one field. After 5-10 thousand documents, taking only a minute or so, we see garbage collection on the old generation. It's very predictable. The old generation gc repeats while we are loading updates each hour (about 10 secs of old gen gc time per minute). After about a day or so (a few million documents), the stop the world pauses become untenable - 20-40 seconds of old gen gc per minute.\n\nWhen we discovered that we were using a script for the update, we removed it and throughput immediately improved 10x. The old gen gc virtually disappeared.\n\nOpenJDK 1.7.0_65, elasticsearch-1.4.2-1\n5 data nodes using the standard gc params \n\"-Xms7g -Xmx7g -Xss256k -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError -XX:+DisableExplicitGC\"\nbulk batch size is 100 documents. Using 10 or 20 concurrent threads.\n\nWe are looking for alternative ways to get the same semantics without a script. In the meantime, I thought I would share our experience. If nothing else, it would be great to see a note about gc in the scripting section of the docs and a note about scripting in the gc section of the docs. Let me know if you'd like any more information. \n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}