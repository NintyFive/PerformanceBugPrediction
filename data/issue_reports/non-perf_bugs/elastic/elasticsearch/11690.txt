{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11690","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11690/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11690/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11690/events","html_url":"https://github.com/elastic/elasticsearch/issues/11690","id":88634151,"node_id":"MDU6SXNzdWU4ODYzNDE1MQ==","number":11690,"title":"\"refresh\" parameter is not honored in bulk request","user":{"login":"niu-lin","id":12907027,"node_id":"MDQ6VXNlcjEyOTA3MDI3","avatar_url":"https://avatars2.githubusercontent.com/u/12907027?v=4","gravatar_id":"","url":"https://api.github.com/users/niu-lin","html_url":"https://github.com/niu-lin","followers_url":"https://api.github.com/users/niu-lin/followers","following_url":"https://api.github.com/users/niu-lin/following{/other_user}","gists_url":"https://api.github.com/users/niu-lin/gists{/gist_id}","starred_url":"https://api.github.com/users/niu-lin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niu-lin/subscriptions","organizations_url":"https://api.github.com/users/niu-lin/orgs","repos_url":"https://api.github.com/users/niu-lin/repos","events_url":"https://api.github.com/users/niu-lin/events{/privacy}","received_events_url":"https://api.github.com/users/niu-lin/received_events","type":"User","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2015-06-16T06:31:51Z","updated_at":"2015-06-16T10:11:39Z","closed_at":"2015-06-16T10:11:38Z","author_association":"NONE","active_lock_reason":null,"body":"According the documentation (https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html#bulk-refresh), there's a \"refresh\" parameter that can be used to force refresh after bulk operation and we have been using this parameter for a while. However, since 1.6.0, the parameter no longer works, with an exception thrown: \n{\"error\":\"IllegalArgumentException[Action/metadata line [1] contains an unknown parameter [refresh]]\",\"status\":500}\n\nI spent some time to dig into it, and found it's related to issue #10977 and  commit https://github.com/elastic/elasticsearch/commit/acb07c72b9d2fd6e21f9710ffbdf4573c01c9f22.\n\nThe issue is:\nThe \"refresh\" parameter is not checked in the source code before 1.6.0 which is simply ignored, began from 1.6.0, the unchecked \"refresh\" parameter will cause an exception. So I doubt the \"refresh\" parameter is never honoured.\n\nThe sample request is:\n{\"update\":{\"_id\":\"test\", \"refresh\" : true}}\n{\"doc_as_upsert\":true,\"doc\":{\"testkey\":\"testvalue\"}}\n","closed_by":{"login":"niu-lin","id":12907027,"node_id":"MDQ6VXNlcjEyOTA3MDI3","avatar_url":"https://avatars2.githubusercontent.com/u/12907027?v=4","gravatar_id":"","url":"https://api.github.com/users/niu-lin","html_url":"https://github.com/niu-lin","followers_url":"https://api.github.com/users/niu-lin/followers","following_url":"https://api.github.com/users/niu-lin/following{/other_user}","gists_url":"https://api.github.com/users/niu-lin/gists{/gist_id}","starred_url":"https://api.github.com/users/niu-lin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/niu-lin/subscriptions","organizations_url":"https://api.github.com/users/niu-lin/orgs","repos_url":"https://api.github.com/users/niu-lin/repos","events_url":"https://api.github.com/users/niu-lin/events{/privacy}","received_events_url":"https://api.github.com/users/niu-lin/received_events","type":"User","site_admin":false},"performed_via_github_app":null}