[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/116831796","html_url":"https://github.com/elastic/elasticsearch/issues/11916#issuecomment-116831796","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11916","id":116831796,"node_id":"MDEyOklzc3VlQ29tbWVudDExNjgzMTc5Ng==","user":{"login":"rusboy","id":3583960,"node_id":"MDQ6VXNlcjM1ODM5NjA=","avatar_url":"https://avatars3.githubusercontent.com/u/3583960?v=4","gravatar_id":"","url":"https://api.github.com/users/rusboy","html_url":"https://github.com/rusboy","followers_url":"https://api.github.com/users/rusboy/followers","following_url":"https://api.github.com/users/rusboy/following{/other_user}","gists_url":"https://api.github.com/users/rusboy/gists{/gist_id}","starred_url":"https://api.github.com/users/rusboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rusboy/subscriptions","organizations_url":"https://api.github.com/users/rusboy/orgs","repos_url":"https://api.github.com/users/rusboy/repos","events_url":"https://api.github.com/users/rusboy/events{/privacy}","received_events_url":"https://api.github.com/users/rusboy/received_events","type":"User","site_admin":false},"created_at":"2015-06-29T20:25:05Z","updated_at":"2015-06-29T20:25:05Z","author_association":"CONTRIBUTOR","body":"hm.. seems I found workaround solution for myself..\nit looks so, \n\n```\n{\n  \"sort\" : [\n      { \"custom-field1\" : {\"order\" : \"asc\"}},\n      { \"count\"   : {\"order\" : \"asc\"}}\n  ],\n  \"aggs\": {\n      \"group-by-custom-field1\": {\n          \"terms\": {\n             \"field\": \"custom-field1\",\n             \"size\" : 0\n           },\n           \"aggs\": {\n              \"group-by-count\" : {\n                  \"terms\": {\n                      \"field\": \"count\",\n                       \"size\" : 0\n                   }\n               }\n           }\n      }\n  }\n}\n```\n\nSort rows by grouped fields and calculate by aggregation count of values in each group. The example for case when user groups results by 2 fields (custom-field1 and count)\n\nAnyway, I would be interested to know answers on my question above.\nThanks!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/117094582","html_url":"https://github.com/elastic/elasticsearch/issues/11916#issuecomment-117094582","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11916","id":117094582,"node_id":"MDEyOklzc3VlQ29tbWVudDExNzA5NDU4Mg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-30T09:40:27Z","updated_at":"2015-06-30T09:40:27Z","author_association":"CONTRIBUTOR","body":"Hi @rusboy \n\nIt is a feature, not a bug.  The typical use case is: calculate analytics over all matching documents, and give me the top N documents as hits.\n\nTo achieve what you want (ie to only aggregate on the page of results returned in hits) you would need to do this in two steps:\n- run a query with `from`/`size`\n- run a second request with aggs, where the query matches just the doc ids from the first query\n","performed_via_github_app":null}]