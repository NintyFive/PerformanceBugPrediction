{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11388","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11388/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11388/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11388/events","html_url":"https://github.com/elastic/elasticsearch/issues/11388","id":81868598,"node_id":"MDU6SXNzdWU4MTg2ODU5OA==","number":11388,"title":"cat fielddata endpoint does funky things if field names are [id, ip, host, node, total]","user":{"login":"36degrees","id":121939,"node_id":"MDQ6VXNlcjEyMTkzOQ==","avatar_url":"https://avatars1.githubusercontent.com/u/121939?v=4","gravatar_id":"","url":"https://api.github.com/users/36degrees","html_url":"https://github.com/36degrees","followers_url":"https://api.github.com/users/36degrees/followers","following_url":"https://api.github.com/users/36degrees/following{/other_user}","gists_url":"https://api.github.com/users/36degrees/gists{/gist_id}","starred_url":"https://api.github.com/users/36degrees/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/36degrees/subscriptions","organizations_url":"https://api.github.com/users/36degrees/orgs","repos_url":"https://api.github.com/users/36degrees/repos","events_url":"https://api.github.com/users/36degrees/events{/privacy}","received_events_url":"https://api.github.com/users/36degrees/received_events","type":"User","site_admin":false},"labels":[{"id":165912659,"node_id":"MDU6TGFiZWwxNjU5MTI2NTk=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Core/Features/CAT%20APIs","name":":Core/Features/CAT APIs","color":"0e8a16","default":false,"description":"Text APIs behind /_cat"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":92913858,"node_id":"MDU6TGFiZWw5MjkxMzg1OA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/good%20first%20issue","name":"good first issue","color":"07569b","default":true,"description":"low hanging fruit"},{"id":110815527,"node_id":"MDU6TGFiZWwxMTA4MTU1Mjc=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/help%20wanted","name":"help wanted","color":"207de5","default":true,"description":"adoptme"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-05-28T10:34:55Z","updated_at":"2015-06-18T17:00:48Z","closed_at":"2015-06-18T17:00:47Z","author_association":"NONE","active_lock_reason":null,"body":"To recreate, start with a freshly started cluster (1.5.2) with nothing stored in fielddata.\n\n```\nGET /_cat/fielddata?v\n\n  id                     host                      ip         node  total \n  oXbVJr3_QNqRhTSkKB1WSw Olivers-MacBook-Pro.local 10.4.1.106 Crown    0b \n```\n\nNow create a document that contains fields with the same name as the 'meta' fields that appear in the output to fielddata.\n\n```\nPOST /lul/wat/1\n{\n  \"id\": \"hah\",\n  \"host\": \"yeah\",\n  \"ip\": 1,\n  \"node\": \"lulwat\",\n  \"total\": 5\n}\n```\n\nThen search with aggregations against those fields, to load them into fielddata.\n\n```\nPOST /lul/wat/_search\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"aggs\": {\n    \"one\": {\n      \"terms\": {\n        \"field\": \"ip\"\n      }\n    },\n    \"two\": {\n      \"terms\": {\n        \"field\": \"node\"\n      }\n    }\n  }\n}\n```\n\nNow check the _cat/fielddata endpoint again.\n\n```\nGET /_cat/fielddata?v\n\n  id                     host                      ip         node     total  node       ip\n  Bt6uoLNcS0mlVSdY1xGgSA Olivers-MacBook-Pro.local 10.4.1.106 Crown    8.9kb  Crown      10.4.1.106\n```\n\nNote that `node` and `ip` are both repeated, but we can't actually see the usage for those fields - instead we get the metadata again. For the sake of completeness...\n\n```\nPOST /lul/wat/_search\n{\n  \"query\": {\n    \"match_all\": {}\n  },\n  \"aggs\": {\n    \"one\": {\n      \"terms\": {\n        \"field\": \"ip\"\n      }\n    },\n    \"two\": {\n      \"terms\": {\n        \"field\": \"node\"\n      }\n    },\n    \"three\": {\n      \"terms\": {\n        \"field\": \"host\"\n      }\n    },\n    \"four\": {\n      \"terms\": {\n        \"field\": \"id\"\n      }\n    },\n    \"five\": {\n      \"terms\": {\n        \"field\": \"total\"\n      }\n    }\n  }\n}\n```\n\n```\nGET /_cat/fielddata?v\n\n  id                     host                      ip         node   total node   total ip         host                      id\n  oXbVJr3_QNqRhTSkKB1WSw Olivers-MacBook-Pro.local 10.4.1.106 Crown 18.4kb Crown 18.4kb 10.4.1.106 Olivers-MacBook-Pro.local oXbVJr3_QNqRhTSkKB1WSw\n```\n\nNote that locally I can recreate the field duplication, but in our production environment (1.4.0) we see even stranger things:\n\n```\n  id                     host                           ip             node          total content.source name.raw delivery.id timestamp id                      _type sections    _id created delivery.channel content.id campaign published content.sections content.topics ip             referrer topics content.created source title.raw       p property.type _parent property.id \n  NcxVMomeTC6TOTEVH9lt3Q [REDACTED]                     [REDACTED]     prd-elastic-c 2.7gb           16mb       0b     805.9kb   172.3mb NcxVMomeTC6TOTEVH9lt3Q 32.8mb    9.9mb 52.2mb  34.4mb          491.3kb    116.7mb   82.5mb       3mb          113.5mb          1.5gb [REDACTED]     110.8mb 29.9mb            31mb 10.6mb     111kb 400.7mb        26.8mb 741.5mb       1.3mb \n                 152.6kb [REDACTED]                     0b             prd-elastic-a 1.5gb          6.4mb       0b     645.1kb    86.7mb                152.6kb 17.8mb    4.7mb 36.1mb    24mb          458.4kb     79.1mb   48.3mb     1.9mb           75.1mb        859.9mb          0b    84.3mb 12.7mb              0b  4.4mb   836.9kb 197.5mb          11mb 493.9mb     861.5kb \n  CqC9hO3tT2O_j2gMPrc2Uw [REDACTED]                     [REDACTED]     prd-elastic-f 3.1gb         23.1mb       0b     865.4kb   160.3mb CqC9hO3tT2O_j2gMPrc2Uw 18.1mb    8.5mb 49.3mb  35.2mb          559.1kb    135.2mb   80.2mb       3mb          128.7mb          1.9gb [REDACTED]     124.1mb 22.8mb          35.3mb  8.1mb   577.3kb 368.8mb        22.8mb 671.8mb       1.2mb \n                   5.6kb [REDACTED]                     0b             prd-elastic-d   3gb         18.7mb       0b       1.2mb   159.9mb                  5.6kb 12.5mb    9.2mb 51.3mb    38mb          769.9kb    134.1mb     82mb     3.6mb          132.4mb          1.7gb          0b    141mb 25.7mb          58.8mb  9.5mb   399.7kb 408.7mb          23mb 709.8mb       1.3mb \n  WkXcjwj8T6yQ1X2Pb_M2ow [REDACTED]                     [REDACTED]     prd-elastic-b 1.9gb         15.8mb       0b       1.1mb    87.3mb WkXcjwj8T6yQ1X2Pb_M2ow     0b    5.1mb 34.5mb  35.9mb          593.9kb     86.5mb   60.7mb     1.9mb           79.1mb          1.1gb [REDACTED]     87.7mb 19.2mb            31mb  7.2mb   110.6kb 202.9mb        20.3mb 505.8mb       1.2mb \n                 116.6kb [REDACTED]                     38.2mb         prd-elastic-e 3.5gb         25.9mb   21.6kb         1mb   204.5mb                116.6kb     0b   11.1mb 57.2mb    34mb          724.2kb    161.6mb   90.7mb     3.6mb          152.8mb          2.1gb      38.2mb    150mb 31.5mb          29.9mb 10.2mb   615.9kb 368.8mb        32.8mb 764.5mb       1.7mb \n```\n\n`ip` and `id` are both repeated, but in the output from _some_ nodes the id and ip fields display the fielddata size for the fields, and _some_ of the nodes display the metadata as I guess they should. I haven't been able to reproduce this locally (it might have been fixed since 1.4.0?), nor have I haven't yet been able to find any pattern to which nodes display fielddata sizes and which display the metadata.\n\nThanks!\n","closed_by":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"performed_via_github_app":null}