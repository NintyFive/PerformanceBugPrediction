{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11950","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11950/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11950/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11950/events","html_url":"https://github.com/elastic/elasticsearch/issues/11950","id":92122728,"node_id":"MDU6SXNzdWU5MjEyMjcyOA==","number":11950,"title":"Intermittent delays when performing search queries","user":{"login":"mikezopa","id":10807937,"node_id":"MDQ6VXNlcjEwODA3OTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10807937?v=4","gravatar_id":"","url":"https://api.github.com/users/mikezopa","html_url":"https://github.com/mikezopa","followers_url":"https://api.github.com/users/mikezopa/followers","following_url":"https://api.github.com/users/mikezopa/following{/other_user}","gists_url":"https://api.github.com/users/mikezopa/gists{/gist_id}","starred_url":"https://api.github.com/users/mikezopa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikezopa/subscriptions","organizations_url":"https://api.github.com/users/mikezopa/orgs","repos_url":"https://api.github.com/users/mikezopa/repos","events_url":"https://api.github.com/users/mikezopa/events{/privacy}","received_events_url":"https://api.github.com/users/mikezopa/received_events","type":"User","site_admin":false},"labels":[{"id":111624690,"node_id":"MDU6TGFiZWwxMTE2MjQ2OTA=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/feedback_needed","name":"feedback_needed","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-06-30T15:20:56Z","updated_at":"2015-07-01T08:37:33Z","closed_at":"2015-07-01T08:37:33Z","author_association":"NONE","active_lock_reason":null,"body":"We have a strange problem whereby most queries take a very short amount of time to execute (<50ms), but intermittently they will take almost _exactly_ 21 seconds.\n\nWhile trying to find a solution to the problem, I stumbled across an unanswered [stack overflow question](http://stackoverflow.com/questions/29552070/intermittent-delay-on-searching-elasticsearch-using-nest) describing almost identical behaviour (and use case).\n\n**Our use case**\n\nWe have a small micro service API (using [NancyFx](http://nancyfx.org/)) which performs relatively simple queries and filters. We instantiate our ElasticClient at start up, and inject it where required.\n\nWe enabled the elasticsearch slow query log on the index, and this shows that queries never take more than ~130ms to execute (and that is seldom). It also doesn't align with these 21s \"blips\" that we see in the logs.\n\nAt the moment I wonder if it is caused by the client connections to the production cluster being dropped, however, the really odd thing is that this delay is 21 seconds. I would expect the time taken to reconnect to be more random. We have a bizarre spike if we graph the request times. 95% < 1s, 97.5% < 2s, and then nothing until this spike of the last 2.5% of requests at 21s.\n\nAny ideas on things to try would be appreciated. \n","closed_by":{"login":"mikezopa","id":10807937,"node_id":"MDQ6VXNlcjEwODA3OTM3","avatar_url":"https://avatars3.githubusercontent.com/u/10807937?v=4","gravatar_id":"","url":"https://api.github.com/users/mikezopa","html_url":"https://github.com/mikezopa","followers_url":"https://api.github.com/users/mikezopa/followers","following_url":"https://api.github.com/users/mikezopa/following{/other_user}","gists_url":"https://api.github.com/users/mikezopa/gists{/gist_id}","starred_url":"https://api.github.com/users/mikezopa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikezopa/subscriptions","organizations_url":"https://api.github.com/users/mikezopa/orgs","repos_url":"https://api.github.com/users/mikezopa/repos","events_url":"https://api.github.com/users/mikezopa/events{/privacy}","received_events_url":"https://api.github.com/users/mikezopa/received_events","type":"User","site_admin":false},"performed_via_github_app":null}