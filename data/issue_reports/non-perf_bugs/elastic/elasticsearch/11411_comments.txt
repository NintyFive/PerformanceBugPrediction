[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106804458","html_url":"https://github.com/elastic/elasticsearch/issues/11411#issuecomment-106804458","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11411","id":106804458,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjgwNDQ1OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-05-29T13:38:41Z","updated_at":"2015-05-29T13:38:41Z","author_association":"CONTRIBUTOR","body":"Hi @MarneusCalgarXP \n\nThe problem is a result of the combination of the `query_string` query with the `remove_trailing` option in the stop filter.  Because the `query_string` query supports its own mini-language, it parses the query string by consuming each token separately.\n\nThe result is that `part`, `de`, and `reve` are each passed to the analyzer separately, so the stopwords filter sees `de` as the last token in the stream, and doesn't remove it because you've set `remove_trailing` to false. This is the same problem that exists when using multi-word synonyms with the query string query... it never recognises them as synonyms.\n\nIf you use the `match` query instead, then it will analyze your query string as you expect.\n\nOne thing that surprises me is that the `simple_query_string` behaves in the same way, including `de` in the list of tokens to search for.  As far as I know, this query is supposed to consume as much continuous text as possible.  @dakrone @jdconrad any ideas here?\n\n(Btw, @MarneusCalgarXP:  you really don't want to use min/max ngrams 1..40 - your index will simply blow up.  This is not the same as using edge_ngrams. With ngrams you probably want a range more like 2..4 max.)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106864699","html_url":"https://github.com/elastic/elasticsearch/issues/11411#issuecomment-106864699","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11411","id":106864699,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjg2NDY5OQ==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2015-05-29T16:30:27Z","updated_at":"2015-05-29T16:30:27Z","author_association":"CONTRIBUTOR","body":"simple_query_string gets passed into Lucene's SimpleQueryParser.  SimpleQueryParser will, by default, tokenize on whitespace.  Each token is then passed into the field's analyzer as @clintongormley mentioned.  Whitespace tokenization can be turned off in SimpleQueryParser, in which case the entirety of the string would be passed to the analyzer.  How the analyzer actually handles it depends on which analyzer is being used.  For this single case, I believe you would get the behavior you're looking for if whitespace tokenization is turned off. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106900604","html_url":"https://github.com/elastic/elasticsearch/issues/11411#issuecomment-106900604","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11411","id":106900604,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjkwMDYwNA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-05-29T18:42:34Z","updated_at":"2015-05-29T18:42:34Z","author_association":"CONTRIBUTOR","body":"thanks @jdconrad - i'm wondering if we should turn whitespace tokenization off by default?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106901910","html_url":"https://github.com/elastic/elasticsearch/issues/11411#issuecomment-106901910","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11411","id":106901910,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjkwMTkxMA==","user":{"login":"jdconrad","id":2126764,"node_id":"MDQ6VXNlcjIxMjY3NjQ=","avatar_url":"https://avatars2.githubusercontent.com/u/2126764?v=4","gravatar_id":"","url":"https://api.github.com/users/jdconrad","html_url":"https://github.com/jdconrad","followers_url":"https://api.github.com/users/jdconrad/followers","following_url":"https://api.github.com/users/jdconrad/following{/other_user}","gists_url":"https://api.github.com/users/jdconrad/gists{/gist_id}","starred_url":"https://api.github.com/users/jdconrad/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdconrad/subscriptions","organizations_url":"https://api.github.com/users/jdconrad/orgs","repos_url":"https://api.github.com/users/jdconrad/repos","events_url":"https://api.github.com/users/jdconrad/events{/privacy}","received_events_url":"https://api.github.com/users/jdconrad/received_events","type":"User","site_admin":false},"created_at":"2015-05-29T18:50:08Z","updated_at":"2015-05-29T18:50:08Z","author_association":"CONTRIBUTOR","body":"I don't know enough about the typical analyzers to know if that solution would work well.  Unexpected behavior may result from something like the following:\nx | y\nwhere \"x \" and \" y\" end up becoming terms that get passed in. \n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/106902871","html_url":"https://github.com/elastic/elasticsearch/issues/11411#issuecomment-106902871","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11411","id":106902871,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNjkwMjg3MQ==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-05-29T18:55:19Z","updated_at":"2015-05-29T18:55:19Z","author_association":"CONTRIBUTOR","body":"ah right, in the case of keyword tokenizers... i see what you mean.  \n\nPants!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/107380679","html_url":"https://github.com/elastic/elasticsearch/issues/11411#issuecomment-107380679","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11411","id":107380679,"node_id":"MDEyOklzc3VlQ29tbWVudDEwNzM4MDY3OQ==","user":{"login":"MarneusCalgarXP","id":1315177,"node_id":"MDQ6VXNlcjEzMTUxNzc=","avatar_url":"https://avatars3.githubusercontent.com/u/1315177?v=4","gravatar_id":"","url":"https://api.github.com/users/MarneusCalgarXP","html_url":"https://github.com/MarneusCalgarXP","followers_url":"https://api.github.com/users/MarneusCalgarXP/followers","following_url":"https://api.github.com/users/MarneusCalgarXP/following{/other_user}","gists_url":"https://api.github.com/users/MarneusCalgarXP/gists{/gist_id}","starred_url":"https://api.github.com/users/MarneusCalgarXP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MarneusCalgarXP/subscriptions","organizations_url":"https://api.github.com/users/MarneusCalgarXP/orgs","repos_url":"https://api.github.com/users/MarneusCalgarXP/repos","events_url":"https://api.github.com/users/MarneusCalgarXP/events{/privacy}","received_events_url":"https://api.github.com/users/MarneusCalgarXP/received_events","type":"User","site_admin":false},"created_at":"2015-06-01T09:33:23Z","updated_at":"2015-06-01T09:33:23Z","author_association":"NONE","body":"OK, I tested, it seems to work with a match query.\nThank you all for explanations !\n","performed_via_github_app":null}]