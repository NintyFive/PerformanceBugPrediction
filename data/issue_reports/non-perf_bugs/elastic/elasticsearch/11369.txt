{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/11369","repository_url":"https://api.github.com/repos/elastic/elasticsearch","labels_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11369/labels{/name}","comments_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11369/comments","events_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11369/events","html_url":"https://github.com/elastic/elasticsearch/issues/11369","id":81422635,"node_id":"MDU6SXNzdWU4MTQyMjYzNQ==","number":11369,"title":"Incorrect keys for predicted buckets in Moving Average Aggregation","user":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"labels":[{"id":141141324,"node_id":"MDU6TGFiZWwxNDExNDEzMjQ=","url":"https://api.github.com/repos/elastic/elasticsearch/labels/:Analytics/Aggregations","name":":Analytics/Aggregations","color":"0e8a16","default":false,"description":"Aggregations"},{"id":23173,"node_id":"MDU6TGFiZWwyMzE3Mw==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/%3Ebug","name":">bug","color":"b60205","default":false,"description":null},{"id":76184120,"node_id":"MDU6TGFiZWw3NjE4NDEyMA==","url":"https://api.github.com/repos/elastic/elasticsearch/labels/v2.0.0-beta1","name":"v2.0.0-beta1","color":"dddddd","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"assignees":[{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false}],"milestone":null,"comments":1,"created_at":"2015-05-27T12:09:14Z","updated_at":"2015-05-27T14:27:19Z","closed_at":"2015-05-27T14:27:18Z","author_association":"MEMBER","active_lock_reason":null,"body":"My query:\n\n``` javascript\nGET weatherdata/_search\n{\n  \"size\": 0,\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\n          \"term\": {\n            \"element\": {\n              \"value\": \"tmax\"\n            }\n          }\n        }\n      ]\n    }\n  },\n  \"aggs\": {\n    \"maxTMax\": {\n      \"max\": {\n        \"field\": \"value\",\n        \"script\": \"_value / 10\",\n        \"format\": \"###.##\"\n      }\n    },\n    \"maxAvgTMaxMonth\": {\n      \"max_bucket\": {\n        \"buckets_path\": \"tMaxHisto>avgTMax\",\n        \"format\": \"###.##\"\n      }\n    },\n    \"minAvgTMaxMonth\": {\n      \"min_bucket\": {\n        \"buckets_path\": \"tMaxHisto>avgTMax\",\n        \"format\": \"###.##\"\n      }\n    },\n    \"tMaxHisto\": {\n      \"date_histogram\": {\n        \"field\": \"date\",\n        \"interval\": \"quarter\"\n      },\n      \"aggs\": {\n        \"avgTMax\": {\n          \"avg\": {\n            \"field\": \"value\",\n            \"script\": \"_value / 10\",\n            \"format\": \"###.##\"\n          }\n        },\n        \"movavg\": {\n          \"moving_avg\": {\n            \"buckets_path\": \"avgTMax\",\n            \"model\": \"holt\",\n            \"window\": 12,\n            \"gap_policy\": \"skip\",\n            \"predict\": 12,\n            \"settings\": {\n              \"alpha\": 0.8\n            }\n          }\n        }\n      }\n    }\n  }\n}\n```\n\nResponse snippet (the first three bucket are existing buckets, i.e. not predictions. The following 12 buckets are predictions but the bucket keys seem to start at 1986 and decrease by 20 years each time):\n\n``` json\n            {\n               \"key_as_string\": \"2005-07-01T00:00:00.000Z\",\n               \"key\": 1120176000000,\n               \"doc_count\": 11,\n               \"avgTMax\": {\n                  \"value\": 28.8,\n                  \"value_as_string\": \"28.8\"\n               },\n               \"movavg\": {\n                  \"value\": 29.15195798473475\n               }\n            },\n            {\n               \"key_as_string\": \"2005-10-01T00:00:00.000Z\",\n               \"key\": 1128124800000,\n               \"doc_count\": 11,\n               \"avgTMax\": {\n                  \"value\": 29.172727272727272,\n                  \"value_as_string\": \"29.17\"\n               },\n               \"movavg\": {\n                  \"value\": 29.024912216300212\n               }\n            },\n            {\n               \"key_as_string\": \"2006-01-01T00:00:00.000Z\",\n               \"key\": 1136073600000,\n               \"doc_count\": 4,\n               \"avgTMax\": {\n                  \"value\": 29.525,\n                  \"value_as_string\": \"29.52\"\n               },\n               \"movavg\": {\n                  \"value\": 29.34023027099398\n               }\n            },\n            {\n               \"key_as_string\": \"1986-01-01T00:00:00.000Z\",\n               \"key\": 504921600000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 29.34023027099398,\n                  \"value_as_string\": \"1970-01-01T00:00:00.029Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1966-01-01T00:00:00.000Z\",\n               \"key\": -126230400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 29.28650429104976,\n                  \"value_as_string\": \"1970-01-01T00:00:00.029Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1946-01-01T00:00:00.000Z\",\n               \"key\": -757382400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 29.232778311105537,\n                  \"value_as_string\": \"1970-01-01T00:00:00.029Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1926-01-01T00:00:00.000Z\",\n               \"key\": -1388534400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 29.179052331161316,\n                  \"value_as_string\": \"1970-01-01T00:00:00.029Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1906-01-01T00:00:00.000Z\",\n               \"key\": -2019686400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 29.125326351217094,\n                  \"value_as_string\": \"1970-01-01T00:00:00.029Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1885-12-31T00:00:00.000Z\",\n               \"key\": -2650838400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 29.071600371272872,\n                  \"value_as_string\": \"1970-01-01T00:00:00.029Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1865-12-31T00:00:00.000Z\",\n               \"key\": -3281990400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 29.01787439132865,\n                  \"value_as_string\": \"1970-01-01T00:00:00.029Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1845-12-31T00:00:00.000Z\",\n               \"key\": -3913142400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 28.96414841138443,\n                  \"value_as_string\": \"1970-01-01T00:00:00.028Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1825-12-31T00:00:00.000Z\",\n               \"key\": -4544294400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 28.910422431440207,\n                  \"value_as_string\": \"1970-01-01T00:00:00.028Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1805-12-31T00:00:00.000Z\",\n               \"key\": -5175446400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 28.856696451495985,\n                  \"value_as_string\": \"1970-01-01T00:00:00.028Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1785-12-30T00:00:00.000Z\",\n               \"key\": -5806598400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 28.802970471551763,\n                  \"value_as_string\": \"1970-01-01T00:00:00.028Z\"\n               }\n            },\n            {\n               \"key_as_string\": \"1765-12-30T00:00:00.000Z\",\n               \"key\": -6437750400000,\n               \"doc_count\": 0,\n               \"movavg\": {\n                  \"value\": 28.74924449160754,\n                  \"value_as_string\": \"1970-01-01T00:00:00.028Z\"\n               }\n            }\n```\n","closed_by":{"login":"colings86","id":236731,"node_id":"MDQ6VXNlcjIzNjczMQ==","avatar_url":"https://avatars0.githubusercontent.com/u/236731?v=4","gravatar_id":"","url":"https://api.github.com/users/colings86","html_url":"https://github.com/colings86","followers_url":"https://api.github.com/users/colings86/followers","following_url":"https://api.github.com/users/colings86/following{/other_user}","gists_url":"https://api.github.com/users/colings86/gists{/gist_id}","starred_url":"https://api.github.com/users/colings86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/colings86/subscriptions","organizations_url":"https://api.github.com/users/colings86/orgs","repos_url":"https://api.github.com/users/colings86/repos","events_url":"https://api.github.com/users/colings86/events{/privacy}","received_events_url":"https://api.github.com/users/colings86/received_events","type":"User","site_admin":false},"performed_via_github_app":null}