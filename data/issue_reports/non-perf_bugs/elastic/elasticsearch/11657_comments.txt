[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/111988232","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-111988232","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":111988232,"node_id":"MDEyOklzc3VlQ29tbWVudDExMTk4ODIzMg==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-15T09:13:39Z","updated_at":"2015-06-15T09:13:39Z","author_association":"CONTRIBUTOR","body":"We do already, as DEBUG:\n\n```\n[2015-06-15 11:13:16,339][DEBUG][cluster.service          ] [Gladiator] set local cluster state to version 10\n```\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/111988799","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-111988799","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":111988799,"node_id":"MDEyOklzc3VlQ29tbWVudDExMTk4ODc5OQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-06-15T09:17:27Z","updated_at":"2015-06-15T09:17:27Z","author_association":"MEMBER","body":"few more handy tips: \n\ndebug logging also gives you the reason for the change - we try to give it good names. He it says it got a new cluster state from the master.\n\n```\n1> [2015-06-14 04:51:45,068][DEBUG][cluster.service          ] [node_t1] processing [zen-disco-receive(from master [[node_t0][UUL8MVMFT1iz_2G5po6Haw][hotel][local[node_0]]{enable_custom_paths=true, mode=local}])]: execute\n\n```\n\nif you set the logging level of `cluster.service` to `TRACE`  you will get the complete cluster state with every change. Note though that it can be huge and so use with care.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/112273803","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-112273803","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":112273803,"node_id":"MDEyOklzc3VlQ29tbWVudDExMjI3MzgwMw==","user":{"login":"markwalkom","id":3184718,"node_id":"MDQ6VXNlcjMxODQ3MTg=","avatar_url":"https://avatars0.githubusercontent.com/u/3184718?v=4","gravatar_id":"","url":"https://api.github.com/users/markwalkom","html_url":"https://github.com/markwalkom","followers_url":"https://api.github.com/users/markwalkom/followers","following_url":"https://api.github.com/users/markwalkom/following{/other_user}","gists_url":"https://api.github.com/users/markwalkom/gists{/gist_id}","starred_url":"https://api.github.com/users/markwalkom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markwalkom/subscriptions","organizations_url":"https://api.github.com/users/markwalkom/orgs","repos_url":"https://api.github.com/users/markwalkom/repos","events_url":"https://api.github.com/users/markwalkom/events{/privacy}","received_events_url":"https://api.github.com/users/markwalkom/received_events","type":"User","site_admin":false},"created_at":"2015-06-16T03:46:06Z","updated_at":"2015-06-16T03:46:06Z","author_association":"MEMBER","body":"Sorry, by state I meant green/yellow/red :)\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153281325","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-153281325","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":153281325,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzI4MTMyNQ==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2015-11-03T07:46:40Z","updated_at":"2015-11-03T07:46:40Z","author_association":"MEMBER","body":"I've looked into this and thought how it could be implemented. The problem is that currently the cluster health status is calculated on a variety of parameters (see `ClusterHealthResponse`). The cluster health status is only evaluated when a cluster health REST request is handled. So this calculation is triggered by some user action but not based on an event from within ES itself currently.\n\nSo we have basically two problems to solve:\n1. Where do we calculate the cluster health status?\n2. How to recognize cluster state changes in general?\n\nRegarding (1), I can think of different approaches:\n- We could precalculate the cluster health status and put it into `ClusterState`. However, I am not really convinced that this a good solution as it increases the size of `ClusterState` further.\n- We could factor out the common logic and recalculate it every time it's needed (i.e. on state change and when handling the before-mentioned REST request).\n\nRegarding (2) I think we'd need to implement a `ClusterStateListener` which logs the message.\n\nApart from that, the old cluster health status could be kept around to suppress logging when the cluster health status did not change.\n\nWhat do think @clintongormley, @bleskes?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153355021","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-153355021","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":153355021,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzM1NTAyMQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-03T13:38:03Z","updated_at":"2015-11-03T13:38:03Z","author_association":"MEMBER","body":"I'm +1 on have a generic method to calculate the cluster status (it is fairly encapsulated in ClusterHealthResponse ). Note that status change only happens after specific events. Going from green to yellow to red happens on shard failures and nodes leaving the cluster. Going from red to yellow to green happens on shard started event. We can just do the calculation there and do some logging there (including the reason / what have changed).\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153366874","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-153366874","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":153366874,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzM2Njg3NA==","user":{"login":"danielmitterdorfer","id":1699576,"node_id":"MDQ6VXNlcjE2OTk1NzY=","avatar_url":"https://avatars3.githubusercontent.com/u/1699576?v=4","gravatar_id":"","url":"https://api.github.com/users/danielmitterdorfer","html_url":"https://github.com/danielmitterdorfer","followers_url":"https://api.github.com/users/danielmitterdorfer/followers","following_url":"https://api.github.com/users/danielmitterdorfer/following{/other_user}","gists_url":"https://api.github.com/users/danielmitterdorfer/gists{/gist_id}","starred_url":"https://api.github.com/users/danielmitterdorfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielmitterdorfer/subscriptions","organizations_url":"https://api.github.com/users/danielmitterdorfer/orgs","repos_url":"https://api.github.com/users/danielmitterdorfer/repos","events_url":"https://api.github.com/users/danielmitterdorfer/events{/privacy}","received_events_url":"https://api.github.com/users/danielmitterdorfer/received_events","type":"User","site_admin":false},"created_at":"2015-11-03T14:10:42Z","updated_at":"2015-11-03T14:10:42Z","author_association":"MEMBER","body":"Thanks for your thoughts. I'll give it a shot and ping you.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153371535","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-153371535","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":153371535,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzM3MTUzNQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-11-03T14:30:06Z","updated_at":"2015-11-03T14:32:50Z","author_association":"CONTRIBUTOR","body":"> We can just do the calculation there and do some logging there (including the reason / what have changed).\n\nI wonder if we could go so far as to _always_ log something at those events and raise the log level if the cluster state changed. Something like\n\n``` java\npublic static void logClusterStateChangeEvent(String eventMessage) {\n  ClusterHealth oldHealth = fetchOldHealth();\n  ClusterHealth newHealth = calculateNewHealth();\n  if (oldHealth != newHealth) {\n    logger.info(\"{} and cluster state changed from {} to {}\", eventMessage, oldHealth, newHealth);\n  } else {\n    logger.debug(\"{} and cluster state stayed {}\", eventMessage, oldHealth);\n  }\n}\n```\n\nThat way if you switched to DEBUG level logging you'd see this stream of events and it'd be really obvious which one might impact the cluster state. I kinda figure we already have logging at these events so it'd be a matter of hunting them down.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153371845","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-153371845","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":153371845,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzM3MTg0NQ==","user":{"login":"bleskes","id":1006375,"node_id":"MDQ6VXNlcjEwMDYzNzU=","avatar_url":"https://avatars1.githubusercontent.com/u/1006375?v=4","gravatar_id":"","url":"https://api.github.com/users/bleskes","html_url":"https://github.com/bleskes","followers_url":"https://api.github.com/users/bleskes/followers","following_url":"https://api.github.com/users/bleskes/following{/other_user}","gists_url":"https://api.github.com/users/bleskes/gists{/gist_id}","starred_url":"https://api.github.com/users/bleskes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bleskes/subscriptions","organizations_url":"https://api.github.com/users/bleskes/orgs","repos_url":"https://api.github.com/users/bleskes/repos","events_url":"https://api.github.com/users/bleskes/events{/privacy}","received_events_url":"https://api.github.com/users/bleskes/received_events","type":"User","site_admin":false},"created_at":"2015-11-03T14:31:18Z","updated_at":"2015-11-03T14:31:18Z","author_association":"MEMBER","body":"@nik9000 I think we can defiantly do better but watch out with logging cluster states. They can be _huge_.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153372055","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-153372055","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":153372055,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzM3MjA1NQ==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-11-03T14:32:10Z","updated_at":"2015-11-03T14:32:10Z","author_association":"CONTRIBUTOR","body":"> @nik9000 I think we can defiantly do better but watch out with logging cluster states. They can be huge.\n\nOh I didn't mean the whole thing! I just meant the health. Yeah. I know full well that they can take up megabytes of text.....\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/153372258","html_url":"https://github.com/elastic/elasticsearch/issues/11657#issuecomment-153372258","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11657","id":153372258,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MzM3MjI1OA==","user":{"login":"nik9000","id":215970,"node_id":"MDQ6VXNlcjIxNTk3MA==","avatar_url":"https://avatars2.githubusercontent.com/u/215970?v=4","gravatar_id":"","url":"https://api.github.com/users/nik9000","html_url":"https://github.com/nik9000","followers_url":"https://api.github.com/users/nik9000/followers","following_url":"https://api.github.com/users/nik9000/following{/other_user}","gists_url":"https://api.github.com/users/nik9000/gists{/gist_id}","starred_url":"https://api.github.com/users/nik9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nik9000/subscriptions","organizations_url":"https://api.github.com/users/nik9000/orgs","repos_url":"https://api.github.com/users/nik9000/repos","events_url":"https://api.github.com/users/nik9000/events{/privacy}","received_events_url":"https://api.github.com/users/nik9000/received_events","type":"User","site_admin":false},"created_at":"2015-11-03T14:33:03Z","updated_at":"2015-11-03T14:33:03Z","author_association":"CONTRIBUTOR","body":"> Oh I didn't mean the whole thing! I just meant the health. Yeah. I know full well that they can take up megabytes of text.....\n\nAnd I've fixed the comment so it looks like what I meant the first time around.\n","performed_via_github_app":null}]