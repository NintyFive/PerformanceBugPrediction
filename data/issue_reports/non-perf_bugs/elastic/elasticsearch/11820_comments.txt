[{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114614160","html_url":"https://github.com/elastic/elasticsearch/issues/11820#issuecomment-114614160","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11820","id":114614160,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDYxNDE2MA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-23T19:13:31Z","updated_at":"2015-06-23T19:13:31Z","author_association":"CONTRIBUTOR","body":"To add to this:\n- plain highlighter highlights the whole body\n- postings highlighter returns a fragment but ignores the fragment size (documented to always return a sentence)\n- fvh does the right thing\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114681903","html_url":"https://github.com/elastic/elasticsearch/issues/11820#issuecomment-114681903","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11820","id":114681903,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDY4MTkwMw==","user":{"login":"szroland","id":10174523,"node_id":"MDQ6VXNlcjEwMTc0NTIz","avatar_url":"https://avatars2.githubusercontent.com/u/10174523?v=4","gravatar_id":"","url":"https://api.github.com/users/szroland","html_url":"https://github.com/szroland","followers_url":"https://api.github.com/users/szroland/followers","following_url":"https://api.github.com/users/szroland/following{/other_user}","gists_url":"https://api.github.com/users/szroland/gists{/gist_id}","starred_url":"https://api.github.com/users/szroland/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szroland/subscriptions","organizations_url":"https://api.github.com/users/szroland/orgs","repos_url":"https://api.github.com/users/szroland/repos","events_url":"https://api.github.com/users/szroland/events{/privacy}","received_events_url":"https://api.github.com/users/szroland/received_events","type":"User","site_admin":false},"created_at":"2015-06-24T00:27:03Z","updated_at":"2015-06-24T00:27:03Z","author_association":"CONTRIBUTOR","body":"I think there is an issue with how spans are calculated for higlighting in the plain highlighter when using the span fragmenter and multiple phrases, in this case it seems to lose track of spans and practically collects a huge fragment at the end, which, having multiple matches and as such higher score, will be the top \"match\" to highlight.\n\n@paulintrognon, I guess while the root cause is fully established, you could try using `\"fragmenter\" : \"simple\"` explicitly, which will not try to be smart about keeping matches of various parts of your search together.\n\nE.g. try this:\n\n```\nPOST /test/chapter/_search\n```\n\n```\n{\n    \"fields\": \"title\",\n    \"query\": {\n        \"match_phrase\": {\n            \"content\": {\n                \"query\": \"credit card\",\n                \"slop\": 0\n            }\n        }\n    },\n    \"highlight\": {\n        \"fields\": {\n            \"content\": {\n                \"fragment_size\": 50,\n                \"number_of_fragments\": 5,\n                \"type\": \"plain\",\n                \"fragmenter\" : \"simple\"\n\n            }\n        }\n    }\n}\n```\n\nI think this provides relatively useful matches respecting the fragment size.\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/114874138","html_url":"https://github.com/elastic/elasticsearch/issues/11820#issuecomment-114874138","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11820","id":114874138,"node_id":"MDEyOklzc3VlQ29tbWVudDExNDg3NDEzOA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2015-06-24T13:52:47Z","updated_at":"2015-06-24T13:52:47Z","author_association":"CONTRIBUTOR","body":"@markharwood you were looking at the plain highlighter recently. Could you investigate this one too please?\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115638691","html_url":"https://github.com/elastic/elasticsearch/issues/11820#issuecomment-115638691","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11820","id":115638691,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTYzODY5MQ==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2015-06-26T10:40:38Z","updated_at":"2015-06-26T10:40:38Z","author_association":"CONTRIBUTOR","body":"Will do\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/115659950","html_url":"https://github.com/elastic/elasticsearch/issues/11820#issuecomment-115659950","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11820","id":115659950,"node_id":"MDEyOklzc3VlQ29tbWVudDExNTY1OTk1MA==","user":{"login":"markharwood","id":170925,"node_id":"MDQ6VXNlcjE3MDkyNQ==","avatar_url":"https://avatars0.githubusercontent.com/u/170925?v=4","gravatar_id":"","url":"https://api.github.com/users/markharwood","html_url":"https://github.com/markharwood","followers_url":"https://api.github.com/users/markharwood/followers","following_url":"https://api.github.com/users/markharwood/following{/other_user}","gists_url":"https://api.github.com/users/markharwood/gists{/gist_id}","starred_url":"https://api.github.com/users/markharwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markharwood/subscriptions","organizations_url":"https://api.github.com/users/markharwood/orgs","repos_url":"https://api.github.com/users/markharwood/repos","events_url":"https://api.github.com/users/markharwood/events{/privacy}","received_events_url":"https://api.github.com/users/markharwood/received_events","type":"User","site_admin":false},"created_at":"2015-06-26T12:26:00Z","updated_at":"2015-06-26T12:26:00Z","author_association":"CONTRIBUTOR","body":"Looking deeper the SimpleSpanFragmenter is prioritizing accuracy of match-reporting over delivering the requested sizes of fragments.\nIt is not possible to both summarize and reflect all query logic accurately and this is an example case where the trade-off being made is questionable - in the pursuit of accurately reporting phrase matches this fragmenter temporarily overrides the fragment size limit to try and tie together reported sightings of phrase components which otherwise would straddle fragments introduced by summarization logic.\n\nI can see from the code there is a deliberate policy of ignoring fragment sizes while connecting phrase elements in this query/doc so the override of your choice of fragment size is \"working as designed\" but arguably not doing a fantastic job.\n\nFor the record - the wikimedia foundation's \"experimental-highlighter\" plugin that they use on Wikipedia looks to do a decent job of summarising this text and is known to be significantly faster than the plain highlighter. See https://github.com/wikimedia/search-highlighter\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/143227110","html_url":"https://github.com/elastic/elasticsearch/issues/11820#issuecomment-143227110","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11820","id":143227110,"node_id":"MDEyOklzc3VlQ29tbWVudDE0MzIyNzExMA==","user":{"login":"paulintrognon","id":1859396,"node_id":"MDQ6VXNlcjE4NTkzOTY=","avatar_url":"https://avatars2.githubusercontent.com/u/1859396?v=4","gravatar_id":"","url":"https://api.github.com/users/paulintrognon","html_url":"https://github.com/paulintrognon","followers_url":"https://api.github.com/users/paulintrognon/followers","following_url":"https://api.github.com/users/paulintrognon/following{/other_user}","gists_url":"https://api.github.com/users/paulintrognon/gists{/gist_id}","starred_url":"https://api.github.com/users/paulintrognon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulintrognon/subscriptions","organizations_url":"https://api.github.com/users/paulintrognon/orgs","repos_url":"https://api.github.com/users/paulintrognon/repos","events_url":"https://api.github.com/users/paulintrognon/events{/privacy}","received_events_url":"https://api.github.com/users/paulintrognon/received_events","type":"User","site_admin":false},"created_at":"2015-09-25T13:39:47Z","updated_at":"2015-09-25T13:39:47Z","author_association":"NONE","body":"OK, this is very interesting.\n\nI have used  the simple fragmenter to get arround this issue, and it worked for me. Thank you all!\n","performed_via_github_app":null},{"url":"https://api.github.com/repos/elastic/elasticsearch/issues/comments/262835588","html_url":"https://github.com/elastic/elasticsearch/issues/11820#issuecomment-262835588","issue_url":"https://api.github.com/repos/elastic/elasticsearch/issues/11820","id":262835588,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MjgzNTU4OA==","user":{"login":"clintongormley","id":56599,"node_id":"MDQ6VXNlcjU2NTk5","avatar_url":"https://avatars0.githubusercontent.com/u/56599?v=4","gravatar_id":"","url":"https://api.github.com/users/clintongormley","html_url":"https://github.com/clintongormley","followers_url":"https://api.github.com/users/clintongormley/followers","following_url":"https://api.github.com/users/clintongormley/following{/other_user}","gists_url":"https://api.github.com/users/clintongormley/gists{/gist_id}","starred_url":"https://api.github.com/users/clintongormley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintongormley/subscriptions","organizations_url":"https://api.github.com/users/clintongormley/orgs","repos_url":"https://api.github.com/users/clintongormley/repos","events_url":"https://api.github.com/users/clintongormley/events{/privacy}","received_events_url":"https://api.github.com/users/clintongormley/received_events","type":"User","site_admin":false},"created_at":"2016-11-24T19:31:42Z","updated_at":"2016-11-24T19:31:42Z","author_association":"CONTRIBUTOR","body":"This appears to be fixed in 5.0 or before","performed_via_github_app":null}]